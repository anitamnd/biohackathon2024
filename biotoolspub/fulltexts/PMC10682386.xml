<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10682386</article-id>
    <article-id pub-id-type="pmid">38012145</article-id>
    <article-id pub-id-type="publisher-id">43590</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-43590-8</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scDREAMER for atlas-level integration of single-cell datasets using deep generative model paired with adversarial classifier</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1064-6238</contrib-id>
        <name>
          <surname>Shree</surname>
          <given-names>Ajita</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7856-8224</contrib-id>
        <name>
          <surname>Pavan</surname>
          <given-names>Musale Krushna</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1617-2806</contrib-id>
        <name>
          <surname>Zafar</surname>
          <given-names>Hamim</given-names>
        </name>
        <address>
          <email>hamim@iitk.ac.in</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/05pjsgx75</institution-id><institution-id institution-id-type="GRID">grid.417965.8</institution-id><institution-id institution-id-type="ISNI">0000 0000 8702 0100</institution-id><institution>Department of Computer Science and Engineering, </institution><institution>Indian Institute of Technology Kanpur, </institution></institution-wrap>Kanpur, India </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/05pjsgx75</institution-id><institution-id institution-id-type="GRID">grid.417965.8</institution-id><institution-id institution-id-type="ISNI">0000 0000 8702 0100</institution-id><institution>Department of Biological Sciences and Bioengineering, </institution><institution>Indian Institute of Technology Kanpur, </institution></institution-wrap>Kanpur, India </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/05pjsgx75</institution-id><institution-id institution-id-type="GRID">grid.417965.8</institution-id><institution-id institution-id-type="ISNI">0000 0000 8702 0100</institution-id><institution>Mehta Family Centre for Engineering in Medicine, </institution><institution>Indian Institute of Technology Kanpur, </institution></institution-wrap>Kanpur, India </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>7781</elocation-id>
    <history>
      <date date-type="received">
        <day>13</day>
        <month>7</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>14</day>
        <month>11</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Integration of heterogeneous single-cell sequencing datasets generated across multiple tissue locations, time, and conditions is essential for a comprehensive understanding of the cellular states and expression programs underlying complex biological systems. Here, we present scDREAMER (<ext-link ext-link-type="uri" xlink:href="https://github.com/Zafar-Lab/scDREAMER">https://github.com/Zafar-Lab/scDREAMER</ext-link>), a data-integration framework that employs deep generative models and adversarial training for both unsupervised and supervised (scDREAMER-Sup) integration of multiple batches. Using six real benchmarking datasets, we demonstrate that scDREAMER can overcome critical challenges including skewed cell type distribution among batches, nested batch-effects, large number of batches and conservation of development trajectory across batches. Our experiments also show that scDREAMER and scDREAMER-Sup outperform state-of-the-art unsupervised and supervised integration methods respectively in batch-correction and conservation of biological variation. Using a 1 million cells dataset, we demonstrate that scDREAMER is scalable and can perform atlas-level cross-species (e.g., human and mouse) integration while being faster than other deep-learning-based methods.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Integration of single-cell datasets is essential to gain a comprehensive understanding of complex biological systems. Here, the authors develop scDREAMER, a deep generative framework for performing unsupervised and supervised atlas-level integration, demonstrating improved bio-conservation and batch-correction.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Data integration</kwd>
      <kwd>Computational models</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">501100001403</institution-id>
            <institution>Indian Institute of Technology Kanpur (IITK)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>IITK /CS /2019236</award-id>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">The exploration of cellular heterogeneity and developmental trajectories in different tissue systems has been revolutionized by the rapid advances of single-cell RNA-sequencing technologies<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR3">3</xref></sup>. This rapid development coupled with large-scale collaborative initiatives such as the Human Cell Atlas (HCA) and Human BioMolecular Atlas Program (HuBMAP)<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR5">5</xref></sup> have increased the complexity of single-cell datasets which can include samples contributed by different laboratories<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>, generated across tissue locations, time and conditions<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR8">8</xref></sup>. Since single-cell datasets generated from similar biological contexts but different experimental conditions can share cellular features<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, integration of information from heterogeneous data sources can facilitate the discovery of major and rare cell types, improve the reconstruction of developmental trajectories<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and lead to more reliable investigation of complex biological systems. However, the intrinsic differences in measured gene expression among experimental settings contributed by factors such as sequencing protocols, library preparation, sample donors, tissue of origin, sampling time and condition inevitably create complex, nested batch effects that can diminish the value of data integration by confounding biological signals<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>. Thus the development of computational data integration methods that can reliably eliminate the complex batch effects without undermining biological variations is a major challenge in scRNA-seq analysis<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>.</p>
    <p id="Par4">Existing methods for the integration of scRNA-seq datasets can be broadly classified into two groups. The first group of methods employs cell type annotations for supervised cross-batch learning<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR14">14</xref></sup> while removing batch effects. The requirement for cell type annotations limits their applications as novel cell types cannot be captured. In comparison, unsupervised data integration methods<sup><xref ref-type="bibr" rid="CR15">15</xref>–<xref ref-type="bibr" rid="CR18">18</xref></sup> that do not require cell type annotations are more widely used. Some of these methods identify the batch-specific gene factors from the gene expression profiles<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. Methods such as BBKNN, Scanorama and Seurat v3 employ global mutual nearest neighbors (MNNs), i.e., paired cells between multiple batches for batch correction of the neighborhood using reduced-dimension cellular spaces. Harmony<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> achieves better batch mixing by applying a novel local correction. These MNN-based methods consume a large memory and low-quality MNNs can make it difficult to simultaneously identify dataset-specific cell types and the cell types that are shared by multiple datasets. Methods such as scVI<sup><xref ref-type="bibr" rid="CR20">20</xref></sup> and DESC<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> that employ deep variational autoencoders for learning cellular embeddings from scRNA-seq can also integrate data from multiple batches. However, the traditional autoencoder models are challenged due to lower fidelity in reproducing the batch-corrected expression profiles<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. Another method, iMAP<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> combines generative adversarial networks (GANs) with autoencoder for learning batch-ignorant cellular representations, however its dependence on MNN pairs to train the GAN can lead to sub-optimal integration due to low-quality MNN and unstable training of GAN<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. A recent benchmarking study<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> showed that methods such as Harmony and Seurat perform well for simple integration tasks but poorly for complex integration tasks and vice versa for Scanorama and scVI and a consistent tradeoff exists between batch-correction and preservation of biological variations.</p>
    <p id="Par5">To overcome the existing challenges, here we present a deep learning-based data integration framework, called scDREAMER (<underline>s</underline>ingle-<underline>c</underline>ell <underline>D</underline>eep gene<underline>R</underline>ativ<underline>E</underline> integr<underline>A</underline>tion <underline>M</underline>odel with adv<underline>E</underline>rsarial classifie<underline>R</underline>) that performs the integration of multiple batches in unsupervised (no cell type annotations required), semi-supervised and supervised (available cell type annotation are utilized) manner. The unsupervised version of scDREAMER employs an adversarial variational autoencoder and a batch classifier (a multi-layer neural network) which are trained adversarially for learning batch-invariant lower-dimensional cellular embeddings. The supervised version, scDREAMER-Sup, employs an additional variational autoencoder and a cell type classifier (another feed-forward neural network) to utilize available cell type annotations for a semi-supervised or supervised inference of cellular latent spaces. Using multiple real datasets consisting of up to 1 million cells and 147 batches (Supplementary Table <xref rid="MOESM1" ref-type="media">1)</xref>, we demonstrate that scDREAMER is able to overcome a variety of integration challenges including the presence of skewed cell types among batches (pancreas integration), nested batch effects (lung integration), large number of batches (heart atlas and macaque retina integration) and conservation of development trajectory across different batches (human immune integration). Using these integration tasks, we further show that scDREAMER achieves better performance in batch-correction and conservation of biological variation against that of the state-of-the-art unsupervised methods. The supervised version of scDREAMER, scDREAMER-Sup improves upon scDREAMER in terms of conservation of biological variation while retaining superior performance in batch-correction and outperforms other state-of-the-art supervised and unsupervised integration methods. For a challenging heart atlas dataset, which several methods failed to integrate due to a large number of batches and complex nested batch effects, scDREAMER and scDREAMER-Sup outperform the other methods by a large margin. Our experiments also show that scDREAMER and scDREAMER-Sup can reliably identify rare cell types. Using semi-supervised integration settings, we also demonstrate scDREAMER-Sup’s superiority over other methods in predicting the cell type labels for the cells missing annotations. Finally, using a 1 million cells dataset, we demonstrate that scDREAMER is highly scalable, can perform atlas-level data integration across different species, and achieves runtime advantage over some other deep-learning-based integration methods.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Overview of scDREAMER</title>
      <p id="Par6">Figure <xref rid="Fig1" ref-type="fig">1</xref> shows the overview of both the unsupervised and supervised models of scDREAMER. The unsupervised model (we will refer it to as scDREAMER) employs an adversarial variational autoencoder for learning the lower-dimensional representation of cells from the high-dimensional scRNA-seq data and a neural network classifier (also called a batch classifier) for the removal of batch effects. scDREAMER models the scRNA-seq data as a nonlinear function of a lower-dimensional cell-state embedding and the batch information that encodes the variation in data generation. The adversarial variational autoencoder of scDREAMER consists of three multi-layer neural networks: an encoder <italic>E</italic> that maps the high-dimensional expression data (<italic>x</italic><sub><italic>i</italic></sub>) and batch information (<italic>s</italic><sub><italic>i</italic></sub>) of a cell <italic>i</italic> to a lower-dimensional embedding <italic>z</italic><sub><italic>i</italic></sub>, a decoder <italic>D</italic>, which reconstructs the expression profile of the cell from <italic>z</italic><sub><italic>i</italic></sub> and <italic>s</italic><sub><italic>i</italic></sub>, and a discriminator <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M2"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq1.gif"/></alternatives></inline-formula> that aims to distinguish the original expression profile <italic>x</italic><sub><italic>i</italic></sub> and the expression profile reconstructed (<inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{{x}_{i}}$$\end{document}</tex-math><mml:math id="M4"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq2.gif"/></alternatives></inline-formula>) by the decoder. The adversarial variational autoencoder network of scDREAMER is trained using two loss functions: evidence lower bound (ELBO) is used for training the encoder and decoder networks, whereas Bhattacharyya loss is used for adversarial training of discriminator and autoencoder parameters. scDREAMER further incorporates a batch classifier <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M6"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq3.gif"/></alternatives></inline-formula> (a multi-layer neural network) that takes as input the lower-dimensional embedding <italic>z</italic><sub><italic>i</italic></sub> learned by the encoder and tries to predict the batch information for cell <italic>i</italic>. The batch classifier and the encoder are adversarially trained using a cross-entropy loss where the encoder tries to maximize it with an aim to generate the embeddings such that the classifier is not able to differentiate between batches and the batch classifier tries to minimize it by distinguishing the embeddings of the cells coming from different batches and hence achieving better mixing of the batches (see “Methods” section for details).<fig id="Fig1"><label>Fig. 1</label><caption><title>Overview of scDREAMER and scDREAMER-Sup.</title><p>scDREAMER consists of an adversarial variational autoencoder and a batch classifier. The adversarial variational autoencoder comprises of three networks: an encoder, a decoder, and a discriminator, and these networks are trained using ELBO and Bhattacharya loss functions. The batch classifier is adversarially trained along with the encoder using a cross-entropy loss. scDREAMER learns latent cellular embeddings such that the cells from different batches are well-mixed and different cell types are separated leading to the conservation of biological variations. scDREAMER-Sup consists of an additional variational autoencoder and a cell-type classifier in addition to the components in scDREAMER. The hierarchical variational autoencoder is trained using an ELBO loss. The cell type classifier is trained using a cross-entropy loss. scDREAMER-Sup learns latent cellular embeddings such that the cells from different batches are well-mixed with improved conservation of biological variations.</p></caption><graphic xlink:href="41467_2023_43590_Fig1_HTML" id="d32e418"/></fig></p>
      <p id="Par7">We further extended the scDREAMER model to utilize available cell type annotations (Fig. <xref rid="Fig1" ref-type="fig">1</xref>) for a guided inference of cellular latent space <italic>z</italic><sub><italic>i</italic></sub>. The extended model, scDREAMER-Sup assumes an informative prior on <italic>z</italic><sub><italic>i</italic></sub> conditioned on cell type label <italic>c</italic><sub><italic>i</italic></sub> and another Gaussian latent variable <italic>y</italic><sub><italic>i</italic></sub> that accounts for within cell type variability. For learning the hierarchically structured <italic>z</italic><sub><italic>i</italic></sub>, scDREAMER-Sup employs an additional variational autoencoder consisting of an encoder <italic>E</italic><sub><italic>y</italic></sub> that learns <italic>y</italic><sub><italic>i</italic></sub> from <italic>z</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub> and a decoder <italic>D</italic><sub><italic>y</italic></sub> that reconstructs <italic>z</italic><sub><italic>i</italic></sub> from <italic>y</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub> such that a more informative prior can be used for <italic>z</italic><sub><italic>i</italic></sub> in the adversarial variational autoencoder. The two variational autoencoders are jointly trained using an updated ELBO function (see “Methods” for details). scDREAMER-Sup further employs a feed-forward neural network (also called cell type classifier), <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M8"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq4.gif"/></alternatives></inline-formula>, for learning <italic>c</italic><sub><italic>i</italic></sub> from <italic>z</italic><sub><italic>i</italic></sub> which is trained using a cross-entropy loss using the available cell type annotations. For cells without cell type annotations, scDREAMER-Sup learns the missing cell type labels using <inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M10"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq5.gif"/></alternatives></inline-formula>. <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M12"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq6.gif"/></alternatives></inline-formula> and <inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M14"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq7.gif"/></alternatives></inline-formula> are trained in the same way as in scDREAMER.</p>
    </sec>
    <sec id="Sec4">
      <title>scDREAMER integrates pancreatic islet data generated using different sequencing protocols</title>
      <p id="Par8">We first tested scDREAMER’s ability to perform integration and batch correction across different sequencing protocols using a human pancreas dataset consisting of 16,382 cells (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1a)</xref>. The dataset consisted of nine sub-datasets generated using distinct sequencing protocols including CEL-seq, CEL-seq2, Fluidigm C1, SMART-seq2, and inDrop. The dataset harbored 14 pancreatic cell types including acinar cells, activated and quiescent stellate cells, alpha cells, beta cells, delta cells, ductal cells, endothelial cells, epsilon cells, gamma cells, macrophages, mast cells, Schwann cells and T cells. scDREAMER’s integration performance was compared against that of nine other integration methods. scDREAMER was able to almost perfectly separate all the cell types and mix the shared cell types across different protocols (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a, b). In comparison, integration by scVI, BBKNN, Scanorama, INSCT, and iMAP led to restricted mixing of the different batches (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1b–j)</xref>. While Harmony, Seurat, scDML and LIGER were also able to mix the batches well, Harmony was not able to clearly distinguish activated and quiescent stellate cells, Seurat improperly mixed some alpha cells with beta and ductal cells, scDML fragmented alpha and beta cells into multiple clusters and mixed some alpha cells with ductal and acinar cells, and LIGER mixed some alpha, beta, and gamma cells.<fig id="Fig2"><label>Fig. 2</label><caption><title>Integration of pancreatic islet data.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after integration of pancreatic islet dataset. Different colors denote different pancreatic cell types. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on batch information. Comparison of <bold>c</bold> composite bio-conservation score, <bold>d</bold> composite batch-correction score and <bold>e</bold> combined composite score metrics between scVI, Harmony, Seurat, BBKNN, Scanorama, INSCT, LIGER, iMAP, scDML and scDREAMER. <bold>f</bold> Comparison of composite isolated label scores to assess how well rare cell types are identified. <bold>g</bold> Comparison of iLISI and cLISI values. Each box-and-whisker plot summarizes LISI values (<italic>n</italic> = 8208 cells, ~50% of the cells in the dataset as suggested in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup>), the box denotes the interquartile range (IQR, the range between the 25th and 75th percentile) with the median value, whiskers indicate the maximum and minimum value within 1.5 times the IQR, outliers are denoted by black circles. <bold>h</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>i</bold> Quantitative assessment of batch-mixing of scDREAMER against LIGER and Harmony based on the percentage of positive vs true positive cells. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig2_HTML" id="d32e619"/></fig></p>
      <p id="Par9">Next, we quantitatively compared scDREAMER’s performance against that of the other methods based on four composite accuracy scores. Composite bio-conservation score measures the accuracy of a method in preserving biological variance after integration and considers global clustering accuracy (normalized mutual information (NMI) and Adjusted Rand Index (ARI)) and relative distances between clusters (cell type average silhouette width (ASW)). The accuracy of batch effect removal was measured using a composite batch-correction score which considers four different metrics including the k-nearest-neighbor batch effect test (kBET), ASW across batches, k-nearest-neighbor (kNN) graph connectivity and batch removal using PCA regression. The combined composite score computes the average of composite bio-conservation and composite batch-correction scores. We also used a composite isolated label score that evaluates the ability of a method to capture rare cell identities based on f1 score and silhouette coefficient in identifying the rare cells.</p>
      <p id="Par10">scDREAMER consistently outperformed all other methods by achieving the highest combined composite score (~12.9% improvement over the second-best method) which was driven by scDREAMER’s superior performance in both conservation of biological variance and batch correction (Fig. <xref rid="Fig2" ref-type="fig">2</xref>c–e). While scVI and Harmony performed similar to scDREAMER in terms of NMI and ARI metrics, scDREAMER, scDML and Harmony performed better in terms of cell type ASW (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a)</xref>. scDREAMER achieved the best composite batch-correction score because of its superior performance in terms of multiple batch-correction metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3b)</xref>. scDREAMER also performed well in capturing the rare cell identities as it achieved the second-best isolated f1 score (Fig. <xref rid="Fig2" ref-type="fig">2</xref>f, Supplementary Fig. <xref rid="MOESM1" ref-type="media">2c)</xref>. While Harmony was the second-best method in terms of the combined composite score, it performed poorly in terms of composite isolated label score indicating its inability to capture the rare cell identities correctly. We also measured the local inverse Simpson’s Index scores (iLISI for batch mixing and cLISI for cell-type separation) at the single-cell level and based on these metrics, scDREAMER’s performance was comparable to that of Harmony and Seurat and better than all other methods (Fig. <xref rid="Fig2" ref-type="fig">2</xref>g). We further adopted another single-cell level evaluation measure which computes the proportion of “positive” (cells connected to other cells only from the same cell type) and “true positive” (fraction of positive cells whose local and global batch distributions are congruous) cells after integration and used these summary metrics to compare scDREAMER’s performance against that of Harmony (second-best method in terms of combined composite score) and scDML (best method in terms of isolated label score). Again, scDREAMER outperformed both Harmony and scDML based on the proportion of positive and true positive cells (Fig. <xref rid="Fig2" ref-type="fig">2</xref>h, i).</p>
      <p id="Par11">To determine scDREAMER’s ability to capture novel cell types, we performed two experiments where a specific cell type (alpha and delta cells respectively) was held out during training and the trained network was later used to obtain their embeddings. For both the held-out cell types, scDREAMER captured them very well in a separate cluster (also indicated by high values of composite bio-conservation and batch correction score for the held-out cell type) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a–c)</xref> and as scDREAMER’s network weights got updated after including the held-out cell type in training for certain epochs, their representation further improved as indicated by an improvement in the combined composite score (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3c)</xref>.</p>
    </sec>
    <sec id="Sec5">
      <title>scDREAMER integrates lung cells obtained from different human donors</title>
      <p id="Par12">Next, we applied scDREAMER for the integration of lung atlas data consisting of 32,472 cells from lung transplant and biopsy samples from 16 donors sequenced using 10X and drop-seq (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a)</xref>. The integration of this dataset poses several challenges including inter-donor variability, protocol-specific batch effects (10X samples A1-A6, 1-6; drop-seq samples B1-B4), and variability across sampling type and tissue locations. Specifically, cell type composition varied between the transplant samples (1-6, B1-B4) that are obtained from lung parenchyma and the biopsy samples (A1-A6) obtained from lung airways. Two basal cell types, ciliated and secretory cells were majorly present in the biopsy samples but the transplant samples harbored them only as minor populations or in some cases the cell types were absent. The dataset also contained rare cell types present across a few donors (ionocytes). Furthermore, the endothelial and secretory cells should vary across biopsy and transplant samples due to transcriptome being affected by tissue location.</p>
      <p id="Par13">scDREAMER was able to successfully integrate the batches across sequencing protocols overcoming donor-level variation (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a, b, Supplementary Fig. <xref rid="MOESM1" ref-type="media">5a, b)</xref>. Only scDREAMER, scVI, and iMAP were clearly able to identify rare ionocytes as a separate cluster, whereas the other methods mixed them with other cell types (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a, Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b–j)</xref>. scDREAMER was able to identify all biopsy-specific cell types and also preserved basal cell subtypes. The secretory cells from the biopsy and transplant samples were separated by scDREAMER (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a). The lymphatic and endothelial cells were incorrectly merged by Harmony, Seurat and INSCT whereas Scanorama, scVI, LIGER and scDREAMER were able to identify them as separate clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b–j)</xref>. The endothelial cells were separated into three clusters by Scanorama, two of which corresponded to transplant samples indicating incomplete integration of these samples. Integration of iMAP was poor as it divided multiple cell types (e.g., macrophages, endothelial cells, etc.) into different batch-specific clusters. Integration by scDML also led to the merging of some cell types (macrophages, basal 1 and 2, dendritic cells) and fragmentation of the same cell type (T/NK cells, Type 2 cells) into multiple clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4j)</xref>. scDREAMER was able to preserve the spatial variation of endothelial cells at a higher resolution.<fig id="Fig3"><label>Fig. 3</label><caption><title>Integration of lung atlas data.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after integration of lung atlas dataset. Different colors denote different lung cell types. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>c</bold> composite bio-conservation score, <bold>d</bold> composite batch-correction score and <bold>e</bold> combined composite score metrics between scVI, Harmony, Seurat, BBKNN, Scanorama, INSCT, LIGER, iMAP, scDML and scDREAMER for the integration of lung atlas data. <bold>f</bold> Comparison of composite isolated label scores to assess how well rare cell types are identified. <bold>g</bold> Comparison of iLISI and cLISI values. Each box-and-whisker plot summarizes LISI values (<italic>n</italic> = 16,274 cells, ~50% of the cells in the dataset as suggested in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup>), the box denotes the interquartile range (IQR, the range between the 25th and 75th percentile) with the median value, whiskers indicate the maximum and minimum value within 1.5 times the IQR, outliers are denoted by black circles. <bold>h</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>i</bold> Quantitative assessment of batch-mixing of scDREAMER against scVI and Harmony based on the percentage of positive vs true positive cells. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig3_HTML" id="d32e727"/></fig></p>
      <p id="Par14">scDREAMER performed superior to all other methods in terms of both bio-conservation and batch correction achieving the highest combined composite score (Fig. <xref rid="Fig3" ref-type="fig">3</xref>c–e). scDREAMER outperformed all the methods in terms of all three bio-conservation metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a)</xref> and also performed well in terms of different batch correction metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b)</xref>. In capturing rare cell identities, scDREAMER performed comparably with the top-performing methods (Fig. <xref rid="Fig3" ref-type="fig">3</xref>f, Supplementary Fig. <xref rid="MOESM1" ref-type="media">6c)</xref> achieving the highest isolated f1 score. In terms of LISI metrics, scDREAMER performed the best in terms of cLISI and comparably to scVI and Harmony in terms of iLISI metrics outperforming all other methods (Fig. <xref rid="Fig3" ref-type="fig">3</xref>g). We further compared scDREAMER’s performance against that of scVI and Harmony (second and third-best methods based on combined composite score respectively) by measuring the proportion of positive and true positive cells. Due to the close spacing of dendritic cells and Neutrophil subtypes in the embedding, we observed the presence of a large number of negative cells for these cell types (same observation for the embedding of other methods). While scVI had the highest proportion of positive cells, scDREAMER outperformed both methods based on the proportion of true positive cells (Fig. <xref rid="Fig3" ref-type="fig">3</xref>h, i) without sacrificing much in terms of positive proportion.</p>
    </sec>
    <sec id="Sec6">
      <title>scDREAMER integrates human immune cells from peripheral blood and bone marrow of different donors</title>
      <p id="Par15">We next evaluated scDREAMER’s integration and batch correction performance for integrating 33,506 human immune cells obtained in ten batches corresponding to different donors and the cells were sampled from bone marrow and peripheral blood (PBMCs) and the sequencing was performed using two protocols (10X and smart-seq2) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7a)</xref>. Out of 33,506 cells, 9581 cells were sampled from bone marrow and comprised of three batches (Oetjen et al.<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>), and the rest 23,985 bone marrow cells comprised of seven batches (10X Genomics<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>, Freytag<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>, Sun et al.<sup><xref ref-type="bibr" rid="CR28">28</xref></sup> batches and Villani et al.<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>). While the cells in ref. <sup><xref ref-type="bibr" rid="CR29">29</xref></sup> were sequenced using smart-seq2, all other batches were sequenced using 10X Genomics protocol. This integration task poses several challenges including donor-level variability, sequencing protocol-specific batch effects, and cell types spanning multiple tissues. In addition, the dataset also contained cell subtypes that are difficult to distinguish because of transcriptional similarity (e.g., CD8<sup>+</sup> and CD4<sup>+</sup> T cells; CD14<sup>+</sup> and CD16<sup>+</sup> monocytes) and some tissue-specific cell types (e.g., monocyte progenitors, erythroid progenitors, erythrocytes and CD10<sup>+</sup> B cells were only present in bone marrow) that need to be identified as separate clusters. Finally, the dataset also harbored the developmental trajectory of erythrocytes from hematopoietic stem and progenitor cells (HSPCs) via megakaryocyte and erythroid progenitors and the conservation of this trajectory across batches is an important aspect of this integration task.</p>
      <p id="Par16">scDREAMER was able to resolve the inter-sample and inter-platform batch effects while integrating the human immune dataset as indicated by disjoint well-mixed cell type clusters (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a, b). scDREAMER was successful in clustering together the same cell types across tissues while identifying cell subtypes, such as CD8<sup>+</sup> and CD4<sup>+</sup> T cells, CD20<sup>+</sup> and CD10<sup>+</sup> B cells, CD14<sup>+</sup> and CD16<sup>+</sup> monocytes, as distinct closely located clusters. In comparison, CD20<sup>+</sup> and CD10<sup>+</sup> B cells were distantly placed in BBKNN and Scanorama embeddings (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7e, f)</xref> and CD20<sup>+</sup> B cells were fragmented into two clusters in scDML embeddings (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7j)</xref>. While scDREAMER was able to place monocyte-derived dendritic cells and plasmacytoid dendritic cells in separate clusters in close vicinity (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a, b), other methods such as Harmony, Seurat, scDML and INSCT (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7c, d, g)</xref> placed these cell subtypes far apart in the embedding. Furthermore, scVI separated monocyte-derived dendritic cells into multiple clusters, one of which was mixed with other distinct cell types (e.g., megakaryocyte progenitors, plasma cells, CD4<sup>+</sup> T cells, etc.) indicating poor clustering (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7b)</xref>. Finally, scDREAMER clearly separated tissue-specific cell types and exhibited a perfect continuum of bone marrow cell types after integration, preserving the trajectory from HSPCs to erythrocytes (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a, b, Supplementary Fig. <xref rid="MOESM1" ref-type="media">8a, b)</xref>. In contrast, methods such as Seurat, INSCT, LIGER and scDML (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7d, g, h, j)</xref> failed to conserve the trajectory of erythrocyte development, whereas, iMAP divided the erythroid trajectory into three batch-specific trajectories (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7i)</xref>.<fig id="Fig4"><label>Fig. 4</label><caption><title>Integration of human immune data.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after integration of human immune dataset. Different colors denote different cell types present in the human immune dataset. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>c</bold> composite bio-conservation score, <bold>d</bold> composite batch-correction score and <bold>e</bold> combined composite score metrics between scVI, Harmony, Seurat, BBKNN, Scanorama, INSCT, LIGER, iMAP, scDML and scDREAMER for the integration of human immune data. <bold>f</bold> Comparison of composite isolated label scores to assess how well rare cell types are identified. <bold>g</bold> Comparison of iLISI and cLISI values. Each box-and-whisker plot summarizes LISI values (<italic>n</italic> = 16,754 cells, ~50% of the cells in the dataset as suggested in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup>), the box denotes the interquartile range (IQR, the range between the 25th and 75th percentile) with the median value, whiskers indicate the maximum and minimum value within 1.5 times the IQR, outliers are denoted by black circles. <bold>h</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>i</bold> Quantitative assessment of batch-mixing of scDREAMER against scVI and Harmony based on the percentage of positive vs true positive cells. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig4_HTML" id="d32e892"/></fig></p>
      <p id="Par17">Our quantitative comparison showed that scDREAMER consistently outperformed all other methods by achieving the highest combined composite score (15.5% improvement over the second-best method) which was driven by scDREAMER’s superior performance in both biological conservation and batch correction (Fig. <xref rid="Fig4" ref-type="fig">4</xref>c–e). scDREAMER was the best-performing method in terms of kBET, and two bio-conservation metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">9a, b)</xref>. In capturing the rare cell identities, scDREAMER also performed at par with scVI and Scanorama, the top-performing methods in terms of composite isolated label scores (Fig. <xref rid="Fig4" ref-type="fig">4</xref>f, Supplementary Fig. <xref rid="MOESM1" ref-type="media">9c)</xref>. However, for batch correction, scVI and Scanorama performed poorly. In terms of LISI metrics, scDREAMER along with scVI and Harmony consistently performed better than other methods (Fig. <xref rid="Fig4" ref-type="fig">4</xref>g). We further compared scDREAMER’s performance against that of Harmony and scVI (second and third-best methods based on combined composite score respectively) by measuring the proportion of positive and true positive cells. While both scDREAMER and scVI had a comparable proportion of positive cells better than Harmony, scDREAMER outperformed both methods by a large margin based on the proportion of true positive cells (Fig. <xref rid="Fig4" ref-type="fig">4</xref>h, i).</p>
      <p id="Par18">Finally, to evaluate scDREAMER’s ability in uncovering unique biological insights, we focused on a more in-depth analysis of the dendritic cell populations after integration. Based on scRNA-seq and functional studies, Villani et al.<sup><xref ref-type="bibr" rid="CR29">29</xref></sup> characterized six different subtypes of dendritic cells—DC1 (CLEC9A<sup>+</sup>), DC2 (non-inflammatory CD1C<sup>+</sup>), DC3 (inflammatory CD1C<sup>+</sup>), DC4 (CD141<sup>−</sup>CD1C<sup>−</sup>), DC5 (AXL<sup>+</sup>), and DC6 (pDCs). Through subclustering and marker gene expression analysis, we wanted to find out if an integration method was able to separate these DC subtypes after the integration of multiple batches. scVI performed poorly in identifying the DCs as a separate cluster, the optimal clustering of scVI embeddings (considering all cells) revealed that DC1 cells were clustered with CD20<sup>+</sup> B cells and DC2 and DC3 cells were clustered with CD14<sup>+</sup> monocytes (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10a)</xref>. Given its inability to identify the dendritic cells as a separate cluster, we did not perform any subclustering. In comparison, scDREAMER and Harmony were able to identify the dendritic cells as separate clusters. Subclustering of scDREAMER-inferred dendritic cell embeddings resulted in seven clusters each of which corresponded to distinct DC subtypes (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10b)</xref>. Clusters 0 and 1 contained DC2 and DC3 cells, clusters 2 and 3 contained pDCs whereas clusters 4, 5, and 6 contained DC1, DC4, and DC5 respectively. Thus, scDREAMER was able to identify 4 (out of 6) DC subtypes as separate clusters. In comparison, optimal subclustering of Harmony embeddings of DCs revealed 4 clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10c)</xref>, out of which only two clusters corresponded to DC4 and pDCs. Harmony failed to properly distinguish other DC subtypes—DC2 and DC3 cells were mixed with DC4 cells, whereas, DC1 and DC5 cells were present across multiple clusters.</p>
    </sec>
    <sec id="Sec7">
      <title>scDREAMER-Sup utilizes available cell type labels for improved conservation of biological knowledge</title>
      <p id="Par19">Next, we evaluated scDREAMER-Sup’s ability to leverage the available cell type labels for improved integration on lung atlas and human immune datasets as these integration tasks were the most challenging. We compared scDREAMER-Sup’s performance against that of scANVI<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> and scGEN<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>, state-of-the-art supervised methods (also top performers in recent benchmarking<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>) that utilize cell type labels. scDREAMER-Sup was able to capture all the cell types in distinct clusters for both integration tasks improving upon the performance of scDREAMER. Particularly, for lung atlas integration, scDREAMER-Sup was able to separate two neutrophil subtypes which were merged by all unsupervised methods (Fig. <xref rid="Fig5" ref-type="fig">5</xref>a, b). In comparison, integration by scANVI led to restricted separation of Macrophage and dendritic cells, and merging of neutrophil subtypes while scGEN mixed some B cells and T/NK cells as well as some ciliated and secretory cells (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11a–d)</xref>. In addition, B cells and secretory cells were fragmented in multiple closely located clusters by scANVI. When integrating human immune data, scGEN and scANVI could not properly separate CD14<sup>+</sup> and CD16<sup>+</sup> monocytes as well as NK cells and NKT cells (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11e–h)</xref>. scDREAMER-Sup was able to identify these cell subtypes as disjoint clusters (Fig. <xref rid="Fig5" ref-type="fig">5</xref>i, j).</p>
      <p id="Par20">We further quantitatively evaluated the performance of scDREAMER-Sup for both supervised (cell type labels available for all cells) as well as semi-supervised settings (cell type labels available for a fraction of cells). To evaluate the integration methods in semi-supervised settings, we uniformly randomly removed cell type labels for a percentage of cells from all the cell types while we varied the percentage of missing labels (10, 20, and 50%). For both datasets across all experimental settings, scDREAMER-Sup outperformed other methods based on combined composite (25–40% improvement over next best method), composite bio-conservation (14–33% improvement over next best method), and composite batch-correction scores (21–49% improvement over next best method) (Fig. <xref rid="Fig5" ref-type="fig">5</xref>c–e, k–m). It is important to note that for both datasets, scDREAMER-Sup also outperformed all the unsupervised methods (scDREAMER was the best unsupervised method for both datasets) in terms of both bio-conservation (84.61–113.33% improvement over best unsupervised method) and batch-correction (16.05–19.72% improvement over best unsupervised method). With an increase in the percentage of missing labels, we observed a sharp drop in scGEN’s composite bio-conservation score which is indicative of the fact that scGEN requires labels for all cells and cannot account for missing cell type labels. In comparison, the performance of scDREAMER-Sup and scANVI were more robust to missing cell type labels with scDREAMER-Sup outperforming scANVI by a large margin in terms of all composite scores.</p>
      <p id="Par21">scDREAMER-Sup’s superior performance was driven by top scores in multiple bio-conservation (NMI, ARI, ASW) (Supplementary Figs. <xref rid="MOESM1" ref-type="media">12a</xref> and <xref rid="MOESM1" ref-type="media">13a)</xref> and batch-correction metrics (kBET, graph connectivity, and ASW label/batch) (Supplementary Figs. <xref rid="MOESM1" ref-type="media">12b</xref> and <xref rid="MOESM1" ref-type="media">13b)</xref> across the integration tasks and experimental settings. scDREAMER-Sup was further able to capture rare cell identities very well as indicated by its top performance in terms of isolated f1 score (Supplementary Figs. <xref rid="MOESM1" ref-type="media">12c</xref> and <xref rid="MOESM1" ref-type="media">13c)</xref>. scDREAMER-Sup further outperformed the other methods in terms of LISI metrics (Fig. <xref rid="Fig5" ref-type="fig">5</xref>f, n) across the experimental settings. Furthermore, we compared the methods by measuring the proportion of positive and true positive cells for each experimental setting. For both supervised and semi-supervised settings, scDREAMER-Sup outperformed the other two methods by achieving a higher proportion of positive and true positive cells (Fig. <xref rid="Fig5" ref-type="fig">5</xref>g, o). Since both scDREAMER-Sup and scANVI can predict the labels of the cells for which cell type annotations are missing, we also compared the accuracy of the cell label prediction for these two methods. For all the semi-supervised settings with 10, 20 and 50% cells missing labels for both the datasets, scDREAMER-Sup achieved high accuracy (Macro F1-score 0.86–0.9) in predicting the cell type labels and outperformed scANVI (10–14% and 23–33% improvement over scANVI for lung atlas and human immune dataset, respectively) (Fig. <xref rid="Fig5" ref-type="fig">5</xref>h, p).<fig id="Fig5"><label>Fig. 5</label><caption><title>scDREAMER-Sup utilizes cell type labels to improve bio-conservation.</title><p><bold>a</bold> Visualization of scDREAMER-Sup’s latent space embeddings after integration of lung atlas dataset. Different colors denote different lung cell types. <bold>b</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>c</bold> composite bio-conservation score, <bold>d</bold> composite batch-correction score, <bold>e</bold> combined composite score metrics, <bold>f</bold> iLISI and cLISI values between scGEN, scANVI, and scDREAMER-Sup for different percentages of missing cell type labels for lung atlas dataset. <bold>g</bold> Quantitative assessment of batch-mixing of scDREAMER-Sup against scANVI and scGEN based on the percentage of positive vs true positive cells for lung atlas dataset. <bold>h</bold> Comparison of cell label prediction accuracy between scDREAMER-Sup and scANVI for different percentages of missing cell type labels for the lung atlas dataset. <bold>i</bold> Visualization of scDREAMER-Sup’s latent space embeddings after integration of human immune dataset. Different colors denote different lung cell types. <bold>j</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>k</bold> composite bio-conservation score, <bold>l</bold> composite batch-correction score, <bold>m</bold> combined composite score metrics, <bold>n</bold> iLISI and cLISI values between scGEN, scANVI, and scDREAMER-Sup for different percentages of missing cell type labels for the human immune dataset. <bold>o</bold> Quantitative assessment of batch-mixing of scDREAMER-Sup against scANVI and scGEN based on the percentage of positive vs true positive cells for the human immune dataset. <bold>p</bold> Comparison of cell label prediction accuracy between scDREAMER-Sup and scANVI for different percentages of missing cell type labels for the human immune dataset. For (<bold>f</bold>) and (<bold>n</bold>), each box-and-whisker plot summarizes LISI values for 50% of the cells in the datasets as suggested in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup> ((<bold>f</bold>) <italic>n</italic> = 16,260 cells, (<bold>n</bold>) <italic>n</italic> = 16,770 cells), the box denotes the interquartile range (IQR, the range between the 25th and 75th percentile) with the median value, whiskers indicate the maximum and minimum value within 1.5 times the IQR, outliers are denoted by black circles. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig5_HTML" id="d32e1095"/></fig></p>
    </sec>
    <sec id="Sec8">
      <title>scDREAMER outperforms other methods in integrating a large number of batches with complex batch effects</title>
      <p id="Par22">We next evaluated scDREAMER’s (both unsupervised and semi-supervised) integration and batch correction on large number of batches (also large number of cells) using a human heart atlas dataset consisting of 486,134 cells spanning six heart regions namely apex, left atrium, left ventricle, right atrium, right ventricle, and septum (<ext-link ext-link-type="uri" xlink:href="https://www.heartcellatlas.org/">https://www.heartcellatlas.org/</ext-link>,<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>). All tissues were from transplant donors without a history of cardiac disease or arrhythmia. The cells were obtained in 147 batches corresponding to different donors, sequential protocols, race, gender, age range, and death-type conditions. In the original study<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>, a total of 452,136 cells were assigned to 12 major cardiac cell types using state-of-the-art machine learning methods, and the remaining 33,998 cells were not assigned any cell type label (Supplementary Fig. <xref rid="MOESM1" ref-type="media">14a)</xref>. In our analyses, we used all the cells for integration but the cells with available cell type labels were used for the evaluation. Only the available cell type labels were used for training supervised methods making it a semi-supervised integration task for them. Apart from a large number of batches, the integration task posed several challenges including variability across human donors with different genders (~55% and ~45% from male and female donors, respectively), race (93% and 6% cells from donors of Caucasian and Asian descent, respectively), and age group (spanning the age range of 40–75 years), sequencing protocol-specific batch effects, and cell types spanning different death-type conditions (265,554 cells (~40 batches) were sampled from the heart in case of circulatory death, and the rest 220,580 cells (~100 batches) were sampled from the heart in case of brain death). Furthermore, the dataset contained skewed cell type distribution, i.e., ~50 batches did not have any cell corresponding to Ventricular Cardiomyocyte and Fibroblast resulting in a multi-faceted challenging integration problem.</p>
      <p id="Par23">Among the unsupervised methods, Seurat, LIGER, scDML and iMAP failed to integrate this dataset given their huge memory requirement (tested on 512 GB memory) or inability to handle such a large number of batches. Most of the other methods that could integrate this dataset led to the mixing of atrial and ventricular cardiomyocytes given their similarity. BBKNN and Scanorama fragmented many cell types into multiple clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">14d, e)</xref>. scVI, Harmony, and scDREAMER were able to capture most cell types into distinct clusters (Fig. <xref rid="Fig6" ref-type="fig">6</xref>a, b, Supplementary Fig. <xref rid="MOESM1" ref-type="media">14b, c)</xref>. However, scVI and Harmony also led to the fragmentation of smooth muscle cells and poor batch correction for Lymphoid cells. In comparison, supervised methods were able to better capture the different cell types in distinct clusters by leveraging the available cell type labels (Fig. <xref rid="Fig6" ref-type="fig">6</xref>c, d, Supplementary Fig. <xref rid="MOESM1" ref-type="media">14g, h)</xref>. However, scANVI still failed to separate atrial and ventricular cardiomyocytes (Supplementary Fig. <xref rid="MOESM1" ref-type="media">14h)</xref>. In addition, scANVI also fragmented smooth muscle cells into multiple clusters. On the other hand, scGEN poorly handled the unassigned cells given its inability to handle missing cell type labels (Supplementary Fig. <xref rid="MOESM1" ref-type="media">14g)</xref>. scDREAMER-Sup was able to resolve the complex batch effects while integrating heart cells as indicated by disjoint well-mixed cell type clusters (Fig. <xref rid="Fig6" ref-type="fig">6</xref>c, d). Both scDREAMER and scDREAMER-Sup were able to mix the cells well across tissues, protocols, donors, genders, age groups, and death-type conditions (Supplementary Fig. <xref rid="MOESM1" ref-type="media">15)</xref>.<fig id="Fig6"><label>Fig. 6</label><caption><title>scDREAMER integrates heart atlas cells from a large number (147) of batches.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after the integration of 147 batches. Different colors denote different cell types in this large dataset consisting of ~0.5 million cells. ‘NotAssigned’ represents the cells without any cell type assignment. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on the batch information. <bold>c</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on cell types. <bold>d</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>e</bold> composite bio-conservation score, <bold>f</bold> composite batch-correction score, and <bold>g</bold> combined composite score metrics between unsupervised (scVI, Harmony, Seurat, Scanorama, INSCT, scDREAMER) and supervised (scGEN, scANVI, and scDREAMER-Sup) methods. Comparison of <bold>h</bold> composite bio-conservation score, <bold>i</bold> composite batch-correction score, and <bold>j</bold> combined composite score metrics between scGEN, scANVI and scDREAMER-Sup for different percentages of missing cell type labels for the heart atlas dataset. <bold>k</bold> Comparison of cell label prediction accuracy between scDREAMER-Sup and scANVI for different percentages of missing cell type labels for the heart atlas dataset. <bold>l</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>m</bold> Quantitative assessment of batch-mixing of scDREAMER against that of scVI and Harmony based on the percentage of positive vs. true positive cells. <bold>n</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>o</bold> Quantitative assessment of batch-mixing of scDREAMER-Sup against that of scANVI and scGEN based on the percentage of positive vs. true positive cells for the heart atlas dataset. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig6_HTML" id="d32e1199"/></fig></p>
      <p id="Par24">Quantitative analyses showed that scDREAMER performed the best among the unsupervised methods based on the combined composite score (25% improvement over the second-best method) which was driven by scDREAMER’s superior performance in batch correction (~50% improvement over the second-best method) as well as good performance in bio-conservation (Fig. <xref rid="Fig6" ref-type="fig">6</xref>e–g, Supplementary Fig. <xref rid="MOESM1" ref-type="media">16)</xref>. We could not include BBKNN in the comparison of the composite scores due to the unavailability of the majority of the metrics. However, scDREAMER outperformed BBKNN on both bio-conservation metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17a)</xref>. Moreover, we could run scDML on this dataset after the removal of 7 batches as suggested in ref. <sup><xref ref-type="bibr" rid="CR33">33</xref></sup> and in integrating the remaining 140 batches, scDREAMER outperformed scDML in terms of most of the metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17b)</xref>. Among the supervised methods, scDREAMER-Sup achieved the best combined composite score (11.5% improvement over the second-best supervised method and 26% improvement over the best unsupervised method (Fig. <xref rid="Fig6" ref-type="fig">6</xref>e–g)). We further evaluated scDREAMER-Sup’s performance in semi-supervised settings with 20 and 50% missing labels. In both settings, scDREAMER-Sup significantly outperformed scANVI and scGEN in both bio-conservation and batch correction (32–57% improvements, Fig. <xref rid="Fig6" ref-type="fig">6</xref>h–j, Supplementary Fig. <xref rid="MOESM1" ref-type="media">18a, b)</xref>. scGEN’s performance dropped sharply with an increase in the percentage of missing labels. scDREAMER-Sup and scANVI were robust to missing cell type labels with scDREAMER-Sup outperforming scANVI by a large margin in terms of all composite scores. Isolated label scores could not be computed for this dataset due to the sheer imbalance of batch sizes. We also compared the accuracy of the cell label prediction for scDREAMER-Sup and scANVI. For both the semi-supervised settings with 20 and 50% cells missing labels, scDREAMER-Sup achieved very high accuracy (macro F1-score 0.97) in predicting the cell type labels and outperformed scANVI (11.49% improvement over scANVI) (Fig. <xref rid="Fig6" ref-type="fig">6</xref>k). We further compared scDREAMER’s performance against that of Harmony and scVI (second and third-best unsupervised methods based on combined composite scores respectively) by measuring the proportion of positive and true positive cells. While all three methods had a comparable proportion of positive cells, scDREAMER outperformed both methods by a large margin based on the proportion of true positive cells (Fig. <xref rid="Fig6" ref-type="fig">6</xref>l, m). Finally, we compared the supervised methods by measuring the proportion of positive and true positive cells for each experimental setting. For all experimental settings, scDREAMER-Sup outperformed the other two methods by achieving a higher proportion of positive and true positive cells (Fig. <xref rid="Fig6" ref-type="fig">6</xref>n, o).</p>
      <p id="Par25">We further analyzed a macaque retina bipolar cells dataset consisting of 30,302 cells that originated from the fovea or periphery of the retina and consisted of 30 batches across macaques and regions. The original study showed that several integration methods failed to remove batch effects from this dataset<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>. Both scDREAMER and scDREAMER-Sup successfully integrated all 30 batches while separating the distinct cell types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">19)</xref>. In contrast, many other methods mixed some distinct cell types or fragmented same cell type into multiple clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">20)</xref>. Based on quantitative analyses also, scDREAMER-Sup was the best performer among all unsupervised and supervised methods in terms of multiple bio-conservation and batch correction metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">21)</xref>. Among the unsupervised methods, scDREAMER was the best performer based on NMI, ARI and kBET and performed comparably on all other metrics except ASW label. scDREAMER-Sup was also superior in identifying the rare cell types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">21)</xref>.</p>
    </sec>
    <sec id="Sec9">
      <title>scDREAMER robustly integrates millions of cells across different species</title>
      <p id="Par26">We finally evaluated scDREAMER’s ability to perform atlas-level integration across species using a dataset consisting of ~1 million cells from human and mouse profiled by the Human Cell Landscape (HCL)<sup><xref ref-type="bibr" rid="CR35">35</xref></sup> and Mouse Cell Atlas (MCA)<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> projects respectively. The two batches in the dataset correspond to HCL and MCA respectively. The dataset harbored 97 different cell types which had minimal overlap across the atlases (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22a)</xref>. The HCL batch comprised 599,926 cells from 63 different cell types whereas the mouse cell atlas comprised 333,778 cells from 52 different cell types. A total of 18 cell types (among the 97 cell types) were common between these two atlases. We have demonstrated scDREAMER’s scalability over a million cells and versatility in integration with this atlas-level integration task.</p>
      <p id="Par27">For this atlas-level integration task, the performance of scDREAMER and scDREAMER-Sup was compared with that of eight other unsupervised methods (scVI, Scanorama, Harmony, INSCT, BBKNN, LIGER, iMAP and scDML) and two supervised methods (scGEN and scANVI). Due to the size of the dataset, Seurat ran into memory issues. Qualitatively, we can observe that clusters by scDREAMER were better separated compared to other methods (Fig. <xref rid="Fig7" ref-type="fig">7</xref>a, b, Supplementary Fig. <xref rid="MOESM1" ref-type="media">22b–i)</xref>. scDREAMER was able to clearly distinguish some of the major cell types such as neutrophil cells, erythroid cells, fetal stromal cells and oligodendrocyte cells (Fig. <xref rid="Fig7" ref-type="fig">7</xref>a). While scVI could cluster some of these cell types such as neutrophil, erythroid and fetal stromal cells well, harmony could only cluster erythroid cells. In Harmony embeddings, similar cell types were disjointly present in multiple clusters. On the other hand, BBKNN and LIGER led to the complete mixing of multiple cell types. While Scanorama was able to better classify than BBKNN and Harmony, it was not able to properly mix the batches (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22e)</xref>. iMAP was also not able to mix the batches properly (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22h)</xref>. scDML mixed multiple cell types and fragmented some of the cell types into multiple clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22i)</xref>. Among the supervised methods, scDREAMER-Sup and scANVI led to better-separated clusters, whereas scGEN was not able to cluster the cell types properly (Fig. <xref rid="Fig7" ref-type="fig">7</xref>c, d, Supplementary Fig. <xref rid="MOESM1" ref-type="media">22j, k)</xref>.<fig id="Fig7"><label>Fig. 7</label><caption><title>scDREAMER enables robust integration of millions of cells across species.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after the integration of human (HCL) and mouse cells (MCA). Different colors denote different cell types in this large dataset consisting of ~1 million cells. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on the batch information. <bold>c</bold> Visualization of scDREAMER-Sup’s latent space embeddings after the integration of human (HCL) and mouse cells (MCA). Different colors denote different cell types. <bold>d</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>e</bold> composite bio-conservation score, <bold>f</bold> composite batch-correction score and <bold>g</bold> combined composite score metrics between scVI, Harmony, Seurat, BBKNN, Scanorama, INSCT, LIGER, iMAP, scDML, scDREAMER, scGEN, scANVI and scDREAMER-Sup for the integration of HCL and MCA cells. <bold>h</bold> Quantitative assessment of batch-mixing of scDREAMER against that of scVI, Scanorama and LIGER based on the percentage of positive vs true positive cells. <bold>i</bold> Quantitative assessment of batch-mixing of scDREAMER-Sup against that of scGEN and scANVI based on the percentage of positive vs true positive cells. <bold>j</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>k</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>l</bold> Comparison of scDREAMER runtime against that of scVI and INSCT across four different scRNA datasets consisting of 10k, 100k, 500k, and 1M cells subsampled from the cross-species integration dataset. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig7_HTML" id="d32e1341"/></fig></p>
      <p id="Par28">In quantitative comparison, scDREAMER achieved the best combined composite score among all the unsupervised methods (26.9% better than the second-best unsupervised method) and was even better than the supervised methods scANVI and scGEN, whereas overall, scDREAMER-Sup had the best combined composite score (8.75% better than that of scDREAMER) (Fig. <xref rid="Fig7" ref-type="fig">7</xref>e–g). While scDREAMER was the best batch correction method, scDREAMER-Sup achieved the best bio-conservation (best in terms of all bio-conservation metrics) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">23)</xref>. We further compared scDREAMER’s performance against that of scVI (second-best unsupervised method), Scanorama and LIGER (third-best unsupervised method) and scDREAMER-Sup’s performance against that of scGEN and scANVI by measuring the proportion of positive and true positive cells (Fig. <xref rid="Fig7" ref-type="fig">7</xref>h–k). scDREAMER outperformed Scanorama and LIGER based on the proportion of positive cells and all the unsupervised methods based on the proportion of true positive cells (Fig. <xref rid="Fig7" ref-type="fig">7</xref>h). On the other hand, based on both the proportion of positive and true positive cells, scDREAMER-Sup outperformed scGEN and scANVI by a large margin. (Fig. <xref rid="Fig7" ref-type="fig">7</xref>i).</p>
      <p id="Par29">To assess scDREAMER’s scalability with the number of cells, we measured the runtime of scDREAMER on different datasets subsampled from the atlas-integration dataset and compared the runtime against that of scVI and INSCT—two other neural network-based methods. For most of the subsampled datasets, scDREAMER outperformed the other two methods based on runtime and exhibited higher scalability with the number of cells (Fig. <xref rid="Fig7" ref-type="fig">7</xref>l). For the complete dataset consisting of ~1 million cells, training scDREAMER took only ~130 s per epoch as compared to ~154 s per epoch for scVI and ~172 s per epoch for INSCT (on a server with one Nvidia Quadro RTX 5000 GPU). We further compared the total runtime of different methods across different datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">24)</xref>. scDREAMER was one of the fastest among all the neural network-based methods across all datasets and was faster compared to some other methods (e.g., Seurat, LIGER). scDREAMER-Sup was also faster than scANVI for multiple datasets and faster than other neural network-based unsupervised methods.</p>
    </sec>
    <sec id="Sec10">
      <title>Ablation study</title>
      <p id="Par30">We performed ablation studies to examine the contribution of the two adversarial components of scDREAMER—adversarial discriminator and batch classifier. Supplementary Table <xref rid="MOESM1" ref-type="media">2</xref> compares the performance of scDREAMER in comparison to scDREAMER without the discriminator (scDREAMER-woDis) and scDREAMER without the batch classifier (scDREAMER-woBC) for different integration tasks. As can be seen, scDREAMER-woBC performs better than scDREAMER-woDis in terms of composite bio-conservation score and composite isolated label score indicating the contribution of the discriminator toward improved bio-conservation and identification of rare cell types. In contrast, the version that uses batch classifier (scDREAMER-woDis) performs better in terms of batch correction as compared to scDREAMER-woBC indicating the contribution of the batch classifier in removing batch effects. Thus, both the components play a significant role and by combining them, scDREAMER achieves the best performance in terms of combined composite score as well as composite isolated label score for different datasets.</p>
    </sec>
  </sec>
  <sec id="Sec11" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par31">Here, we introduced scDREAMER, a deep generative model for the efficient and robust integration of scRNA-seq datasets across multiple batches. The unsupervised model of scDREAMER employs an adversarial variational autoencoder for inferring the latent cellular embeddings from the high-dimensional gene expression matrices from different batches. This adversarial autoencoder also outputs the corrected expression profiles. The other component of scDREAMER, a batch classifier helps remove batch effects from the latent cellular embeddings for better mixing of cell types shared across multiple batches. Thus, scDREAMER employs a combination of two levels of adversarial training for training the adversarial VAE and the batch classifier respectively and differs from existing adversarially trained deep generative models for dimensionality reduction<sup><xref ref-type="bibr" rid="CR37">37</xref></sup> and batch integration of scRNA-seq data<sup><xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR22">22</xref></sup> (see Supplementary <xref rid="MOESM1" ref-type="media">Note 1</xref> for details). Our ablation study further demonstrated that the two adversarially trained components play important roles in improving bio-conservation and removal of batch effects respectively. We further extended scDREAMER to scDREAMER-Sup, which employs an additional variational autoencoder and a cell type classifier to utilize available cell type labels for improved bio-conservation.</p>
    <p id="Par32">Our comprehensive benchmarking of scDREAMER and scDREAMER-Sup on multiple complex data integration tasks demonstrates scDREAMER’s superiority over the state-of-the-art unsupervised and supervised integration methods respectively in terms of both conservation of biological variations and removal of batch effects. In contrast, the other methods were only able to perform well in one aspect of data integration: batch-mixing or conservation of biological variation, that too varied across datasets. scDREAMER was also a consistent performer in capturing rare cell identities. Moreover, a comparison of the fraction of true positive and positive cells further demonstrated scDREAMER’s superiority over other methods in batch-mixing. scDREAMER-Sup was found to improve upon scDREAMER and it consistently outperformed all the supervised (that utilize the cell type annotations) as well as unsupervised integration methods across various benchmarking datasets and experimental settings.</p>
    <p id="Par33">scDREAMER also demonstrated high accuracy for the integration of a large number of batches and atlases from different species despite the small number of shared cell types. Both scDREAMER and scDREAMER-Sup significantly outperformed the other methods for the integration of heart atlas across 147 batches, which many other methods failed to integrate. scDREAMER-Sup also performed superior to all other methods in predicting the cell type labels for the cells missing annotations. Moreover, the unsupervised deep learning approach of scDREAMER does not require any cell type information and can be applied when prior knowledge regarding homologous cell types is not available or the cell type annotations are missing. In case cell type labels are available (completely or partially), the supervised version of scDREAMER, scDREAMER-Sup can achieve improved performance in bio-conservation while maintaining batch-effect removal performance. As more cell atlases are generated from different species, we believe that scDREAMER will be suitable for robust integration of cross-species datasets for the discovery of shared and private cell types.</p>
    <p id="Par34">The application of scDREAMER on the heart atlas and cross-species dataset also highlights its scalability to a large number of batches and millions of cells. In fact, our runtime experiments using different down-sampled versions of the cross-species dataset showed that scDREAMER outperformed some other deep learning-based methods based on runtime. Thus scDREAMER provides a suitable deep learning-based integration model for cross-species atlas integration as the other deep learners scVI, INSCT, iMAP and scDML achieved much less accuracy for the cross-species integration task. This is particularly important as the deep learning-based methods enable the inference of latent cellular embeddings as well as corrected expression profiles which are required for several downstream applications such as trajectory inference<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> or differential expression analysis<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
    <p id="Par35">scDREAMER being a deep learning-based method may require fine-tuning of some parameters for extracting the best performance. However, in our analyses, the same parameter values performed well across multiple datasets (Supplementary Table <xref rid="MOESM1" ref-type="media">3)</xref>. Our current model assumes prior knowledge of the number of batches. An important future direction would be to explore the unsupervised treatment of batch information and whether the hierarchical structure between different batch information can be utilized when it exists (e.g., when cells from a single donor but multiple organs are present in the atlas). While we restricted our analysis to the integration of scRNA-seq datasets, our deep generative model encompasses a general framework that can accommodate other omics datasets and we plan to extend the framework of scDREAMER to multiomic datasets. Finally, given the rapid generation of atlas-level single-cell datasets<sup><xref ref-type="bibr" rid="CR38">38</xref>–<xref ref-type="bibr" rid="CR40">40</xref></sup> across multiple organs and species, we anticipate supervised and unsupervised models of scDREAMER to become invaluable methods for performing scalable and accurate integration of single-cell atlases for the exploration of different biological systems.</p>
  </sec>
  <sec id="Sec12">
    <title>Methods</title>
    <sec id="Sec13">
      <title>The scDREAMER model</title>
      <p id="Par36">The unsupervised model of scDREAMER consists of an unsupervised deep learning-based framework specifically designed to address the complex and multi-level batch effects and perform atlas-level integration ensuring effective integration as well as batch mixing. Any integration method is faced with the critical challenge of balancing a tradeoff between capturing the distinct identity of the batch-specific cell types and adequate mixing of the cell types shared across multiple batches. This challenge is even more profound for the integration of atlas-level datasets. To overcome these challenges, we formalize our scDREAMER integration model into two major components, the adversarial variational autoencoder and the batch classifier that is adversarially trained with the encoder.</p>
      <p id="Par37">scDREAMER employs an adversarial variational autoencoder for learning a lower-dimensional representation of cells from the high-dimensional scRNA-seq data. In addition, there is a neural network classifier (also called a batch classifier) for the removal of batch effects. The adversarial variational autoencoder of scDREAMER consists of three multi-layer neural networks: an encoder <italic>E</italic> that maps the high-dimensional expression data (<italic>x</italic><sub><italic>i</italic></sub>) and batch information (<italic>s</italic><sub><italic>i</italic></sub>) of a cell <italic>i</italic> to a lower-dimensional embedding <italic>z</italic><sub><italic>i</italic></sub>, a decoder <italic>D</italic>, which reconstructs the expression profile of the cell from <italic>z</italic><sub><italic>i</italic></sub> and <italic>s</italic><sub><italic>i</italic></sub>, and a discriminator <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M16"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq8.gif"/></alternatives></inline-formula> that aims to distinguish the original expression profile <italic>x</italic><sub><italic>i</italic></sub> and the expression profile reconstructed (<inline-formula id="IEq9"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{{x}_{i}}$$\end{document}</tex-math><mml:math id="M18"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq9.gif"/></alternatives></inline-formula>) by the decoder. The use of a discriminator to adversarially train the autoencoder is inspired by ref. <sup><xref ref-type="bibr" rid="CR37">37</xref></sup>.</p>
      <p id="Par38">The adversarial variational autoencoder network of scDREAMER is trained using two loss functions: evidence lower bound (ELBO) is used for training the encoder and decoder networks, whereas Bhattacharyya loss is used for adversarial training of discriminator and autoencoder parameters. The ELBO loss accounts for the KL divergence between the posterior distribution <italic>q</italic>(<italic>z</italic><sub><italic>i</italic></sub>∣<italic>s</italic><sub><italic>i</italic></sub>, <italic>x</italic><sub><italic>i</italic></sub>) and the true distribution <italic>p</italic>(<italic>z</italic><sub><italic>i</italic></sub>), and the expected likelihood of <italic>x</italic><sub><italic>i</italic></sub> given <italic>z</italic><sub><italic>i</italic></sub> over posterior probability distribution <italic>q</italic>(<italic>z</italic><sub><italic>i</italic></sub>∣<italic>s</italic><sub><italic>i</italic></sub>, <italic>x</italic><sub><italic>i</italic></sub>). The Bhattacharyya loss compares the probability distributions <italic>q</italic>(<italic>z</italic><sub><italic>i</italic></sub>∣<italic>x</italic><sub><italic>i</italic></sub>, <italic>s</italic><sub><italic>i</italic></sub>) and <italic>p</italic>(<italic>z</italic><sub><italic>i</italic></sub>) where <italic>q</italic>(<italic>z</italic><sub><italic>i</italic></sub>∣<italic>x</italic><sub><italic>i</italic></sub>, <italic>s</italic><sub><italic>i</italic></sub>) is the posterior probability distribution and <italic>p</italic>(<italic>z</italic><sub><italic>i</italic></sub>) is 0-mean Gaussian distribution, i.e., <inline-formula id="IEq10"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{N}}}}}}}}(0,I)$$\end{document}</tex-math><mml:math id="M20"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq10.gif"/></alternatives></inline-formula>.</p>
      <p id="Par39">scDREAMER further incorporates a batch classifier, <inline-formula id="IEq11"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M22"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq11.gif"/></alternatives></inline-formula> (a multi-layer neural network) that takes as input the lower-dimensional embedding <italic>z</italic><sub><italic>i</italic></sub> learned by the encoder and tries to predict the batch information <italic>s</italic><sub><italic>i</italic></sub> for each cell <italic>i</italic>. The batch classifier and the encoder are adversarially trained using a cross-entropy loss where the encoder tries to maximize it with an aim to generate the embeddings such that the classifier is not able to differentiate between batches and the batch classifier tries to minimize it by distinguishing the embeddings of the cells that are part of different batches and hence achieving better mixing of the batches.</p>
    </sec>
    <sec id="Sec14">
      <title>Adversarial variational autoencoder for representation learning of cells</title>
      <p id="Par40"><italic>E</italic> denotes the Encoder network that takes as input <italic>X</italic> (gene expression matrix) and <italic>S</italic> (set of batch information) and generates the mean <italic>μ</italic><sub><italic>Z</italic></sub> and variance <italic>σ</italic><sub><italic>Z</italic></sub> of the multivariate normal distribution (prior for <italic>z</italic>). In addition, it also learns the mean and variance of the cell-specific scaling factor <italic>l</italic><sub><italic>i</italic></sub> as used in ref. <sup><xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
      <p id="Par41">The Encoder <italic>E</italic> learns the functional form: <italic>z</italic><sub><italic>i</italic></sub> ~ <italic>N</italic><italic>o</italic><italic>r</italic><italic>m</italic><italic>a</italic><italic>l</italic>(0, <italic>I</italic>), <italic>f</italic><sub><italic>E</italic></sub>: {<italic>x</italic>, <italic>s</italic>} → {<italic>μ</italic><sub><italic>z</italic></sub>, <italic>σ</italic><sub><italic>z</italic></sub>, <italic>μ</italic><sub><italic>l</italic></sub>, <italic>σ</italic><sub><italic>l</italic></sub>}. The decoder network <italic>D</italic> takes as input the latent space embeddings <italic>z</italic> and batch information and reconstructs the gene expression matrix, <inline-formula id="IEq12"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{X}$$\end{document}</tex-math><mml:math id="M24"><mml:mover accent="true"><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq12.gif"/></alternatives></inline-formula>. It also outputs the mean and dispersion of the reconstructed gene expression vector. The scRNA-seq data can be modeled as zero-inflated negative binomial (ZINB) or negative binomial (NB) distribution.</p>
      <p id="Par42">scDREAMER aims to learn the posterior distribution of the latent variable <italic>z</italic>, <italic>p</italic>(<italic>z</italic>∣<italic>X</italic>, <italic>S</italic>, <italic>l</italic>). We use a variational inference approach where we try to learn the network parameters of <italic>E</italic> and <italic>D</italic> as denoted by <italic>ϕ</italic> = {<italic>f</italic><sub><italic>E</italic></sub>, <italic>f</italic><sub><italic>D</italic></sub>} by maximizing the Evidence Lower Bound Loss (ELBO) function:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ELBO=-KL({q}_{\phi }(z| x,s)| | p(z))-KL({q}_{\phi }(l| x,s)| | p(l))+{E}_{{q}_{\phi }(z,l| x,s)}\,log(p(x| z,s,l))$$\end{document}</tex-math><mml:math id="M26"><mml:mi>E</mml:mi><mml:mi>L</mml:mi><mml:mi>B</mml:mi><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where, the first two terms denote the KL divergence between the posterior distribution and true distribution for <italic>z</italic> and <italic>l</italic> respectively and the third term denotes the expected likelihood of <italic>x</italic> given <italic>z</italic> and <italic>l</italic> over the posterior probability distribution, <italic>q</italic><sub><italic>ϕ</italic></sub>(<italic>z</italic>, <italic>l</italic>∣<italic>x</italic>, <italic>s</italic>). In this work, we have modeled scRNA-seq data using ZINB distribution which is defined in terms of mean (<italic>μ</italic>) and dispersion (<italic>θ</italic>) parameters as:<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\forall x\in {\mathbb{N}};p(y;\mu,\theta )=\frac{{{\Gamma }}(x+\theta )}{{{\Gamma }}(x+1){{\Gamma }}(\theta )}{\left(\frac{\theta }{\theta+\mu }\right)}^{\theta }{\left(\frac{\mu }{\mu+\theta }\right)}^{x}$$\end{document}</tex-math><mml:math id="M28"><mml:mo>∀</mml:mo><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">N</mml:mi><mml:mo>;</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi><mml:mo>+</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msup></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <sec id="Sec15">
        <title>Training of discriminator</title>
        <p id="Par43">Inspired by ref. <sup><xref ref-type="bibr" rid="CR37">37</xref></sup>, scDREAMER autoencoder also incorporates an adversarial discriminator <inline-formula id="IEq13"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M30"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq13.gif"/></alternatives></inline-formula> that tries to distinguish between the reconstructed gene expression profile <inline-formula id="IEq14"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{x}$$\end{document}</tex-math><mml:math id="M32"><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq14.gif"/></alternatives></inline-formula> and the original gene expression profile <italic>x</italic> of a cell. This ensures that the distribution of the reconstructed gene expression profiles faithfully follows the distribution of the underlying original scRNA-seq profiles. <inline-formula id="IEq15"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M34"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq15.gif"/></alternatives></inline-formula> is adversarially trained along with the autoencoder, <inline-formula id="IEq16"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}=\{E,D\}$$\end{document}</tex-math><mml:math id="M36"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq16.gif"/></alternatives></inline-formula> using Bhattacharyya loss, <inline-formula id="IEq17"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}$$\end{document}</tex-math><mml:math id="M38"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq17.gif"/></alternatives></inline-formula> given by:<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}=-log\left(\mathop{\sum }\limits_{i=1}^{N}\sqrt{P({x}_{i})\times P(\bar{{x}_{i}})}\right)$$\end{document}</tex-math><mml:math id="M40"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:msqrt><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msqrt></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula><inline-formula id="IEq18"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M42"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq18.gif"/></alternatives></inline-formula> tries to maximize <inline-formula id="IEq19"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}$$\end{document}</tex-math><mml:math id="M44"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq19.gif"/></alternatives></inline-formula> whereas the autoencoder <inline-formula id="IEq20"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}$$\end{document}</tex-math><mml:math id="M46"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq20.gif"/></alternatives></inline-formula> tries to minimize <inline-formula id="IEq21"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}$$\end{document}</tex-math><mml:math id="M48"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq21.gif"/></alternatives></inline-formula> giving rise to the minimax objective function:<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{\min }\nolimits_{{{{{{{{\mathcal{{A}}}}}}}_{E}}}}\,\mathop{\max }\nolimits_{{{{{{{{\mathcal{D}}}}}}}}}\,{{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}({{\mathbb{E}}}_{x \sim {P}_{x}}{{{{{{{\mathcal{D}}}}}}}}(x),{{\mathbb{E}}}_{z \sim p(z)}{{{{{{{\mathcal{D}}}}}}}}({{{{{{{\mathcal{{A}}}}}}}_{E}}}(z)))$$\end{document}</tex-math><mml:math id="M50"><mml:msub><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>~</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi><mml:mo>~</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      </sec>
      <sec id="Sec16">
        <title>Adversarial training using a batch classifier for batch-effect removal</title>
        <p id="Par44">The batch-classifier network <inline-formula id="IEq22"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M52"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq22.gif"/></alternatives></inline-formula> learns its parameters by minimizing the cross-entropy loss thereby ensuring correct classification of embeddings into different batches while Encoder tries to fool the batch-classifier by maximizing the cross-entropy loss. <inline-formula id="IEq23"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M54"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq23.gif"/></alternatives></inline-formula> takes <italic>z</italic> (latent space embeddings) as input and <italic>s</italic> (batch information) as labels. The cross-entropy loss is given by:<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$-\mathop{\sum }\limits_{j=1}^{| S| }{s}_{j}\times log({r}_{j})$$\end{document}</tex-math><mml:math id="M56"><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>S</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>where <italic>s</italic><sub><italic>j</italic></sub> is the true label and <italic>r</italic><sub><italic>j</italic></sub> is the softmax probability of the <italic>j</italic><italic>t</italic><italic>h</italic> batch.</p>
        <p id="Par45">The batch-classifier intends to minimize the cross-entropy loss, hence classifying the latent cellular embeddings to its correct batch whereas the encoder tries to maximize the cross-entropy loss ensuring that the classifier is not able to differentiate between batches so that better mixing of data from different batches can be achieved. This gives rise to another minimax objective:<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{\max }\nolimits_{E}\,\mathop{\min }\nolimits_{{{{{{{{\mathcal{B}}}}}}}}}-\mathop{\sum }\limits_{j=1}^{| S| }{s}_{j}\times log({r}_{j})$$\end{document}</tex-math><mml:math id="M58"><mml:msub><mml:mrow><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>S</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula></p>
      </sec>
    </sec>
    <sec id="Sec17">
      <title>Implementation details</title>
      <p id="Par46">
        <list list-type="bullet">
          <list-item>
            <p id="Par47">scDREAMER has 4 neural network units correspnding to Encoder, Decoder, Discriminator and Batch-Classifier, all with multi-layer dense neural network architecture with linear relu activation at the end of each layer. For training our model, we have adopted ADAM optimizer<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>. We have used <italic>β</italic> as a scaling factor (multiplied to the KL-divergence term) to balance between the reconstruction loss and KL-divergence term while optimizing the ELBO loss. The batch size of 128 is used while training the model.</p>
          </list-item>
          <list-item>
            <p id="Par48">To facilitate and stabilize the training process and make scDREAMER robust to small perturbations, we added a penalty term in the main objective function following ref. <sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. Specifically, for each gene expression vector <italic>x</italic><sub><italic>i</italic></sub>, we down-sample <italic>x</italic><sub><italic>i</italic></sub> by keeping 80% of its UMIs to produce <italic>x</italic><sub><italic>i</italic></sub>. The latent representations for <italic>x</italic><sub><italic>i</italic></sub> and <inline-formula id="IEq24"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{x}}_{i}$$\end{document}</tex-math><mml:math id="M60"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq24.gif"/></alternatives></inline-formula> are <italic>z</italic><sub><italic>i</italic></sub> and <inline-formula id="IEq25"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{z}}_{i}$$\end{document}</tex-math><mml:math id="M62"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq25.gif"/></alternatives></inline-formula> respectively. The penalty term is defined as <inline-formula id="IEq26"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$-\mathop{\sum }\nolimits_{j=1}^{| {z}_{i}| }{({z}_{ij}-{\hat{z}}_{ij})}^{2}$$\end{document}</tex-math><mml:math id="M64"><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq26.gif"/></alternatives></inline-formula> as we want <italic>z</italic><sub><italic>i</italic></sub> and <inline-formula id="IEq27"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{z}}_{i}$$\end{document}</tex-math><mml:math id="M66"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq27.gif"/></alternatives></inline-formula> to be as close as possible. The down-sampling ratio used in our case is 80%.</p>
          </list-item>
          <list-item>
            <p id="Par49">In our evaluations across different integration tasks and experimental settings, we have used the same values for hyperparameters and the same architecture for our neural networks. We further performed a robustness study for two learning rate parameters for Pancreas data integration (Supplementary Table <xref rid="MOESM1" ref-type="media">4)</xref>, which showed that the metrics were comparable across different values of learning rate parameters.</p>
          </list-item>
        </list>
      </p>
    </sec>
    <sec id="Sec18">
      <title>Extension of scDREAMER model for utilizing cell type labels</title>
      <p id="Par50">The scDREAMER model was further extended to scDREAMER-Supervised (scDREAMER-Sup), which can leverage existing cell type annotations to further improve biological conservation while integrating scRNA-seq datasets (Fig. <xref rid="Fig1" ref-type="fig">1</xref>). Inspired by the deep generative semi-supervised learner<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> and scANVI<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>, scDREAMER-Sup employs a hierarchical structure for the inference of an informative latent embedding <italic>z</italic> guided by the available cell type annotations <italic>c</italic>. Essentially, the prior on <italic>z</italic><sub><italic>i</italic></sub> becomes more informative as it becomes conditioned on cell type label <italic>c</italic><sub><italic>i</italic></sub> and another latent variable <italic>y</italic><sub><italic>i</italic></sub> that accounts for within cell type variability. scDREAMER-Sup employs an additional variational autoencoder, <inline-formula id="IEq28"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}=\{{E}_{y},{D}_{y}\}$$\end{document}</tex-math><mml:math id="M68"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq28.gif"/></alternatives></inline-formula> for learning <italic>y</italic><sub><italic>i</italic></sub> from <italic>z</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub>, and another feed-forward neural network (also called cell type classifier), <inline-formula id="IEq29"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M70"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq29.gif"/></alternatives></inline-formula>, for learning <italic>c</italic><sub><italic>i</italic></sub> from <italic>z</italic><sub><italic>i</italic></sub>. When cell type annotations are available, those are fed to the autoencoder <inline-formula id="IEq30"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}$$\end{document}</tex-math><mml:math id="M72"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq30.gif"/></alternatives></inline-formula> along with the latent embeddings <italic>z</italic><sub><italic>i</italic></sub> from the adversarial variational autoencoder, <inline-formula id="IEq31"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}$$\end{document}</tex-math><mml:math id="M74"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq31.gif"/></alternatives></inline-formula>. In case cell type annotations are partially available, scDREAMER-Sup learns the missing cell type labels by training the cell type classifier network using a cross-entropy loss on the set of cells for which cell type annotations are available.</p>
      <sec id="Sec19">
        <title>Training cell type classifier</title>
        <p id="Par51">The cell type classifier network, <inline-formula id="IEq32"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M76"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq32.gif"/></alternatives></inline-formula> learns its parameters by minimizing the cross-entropy loss thereby ensuring correct classification of latent embeddings <italic>z</italic> into different cell type annotations. <inline-formula id="IEq33"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M78"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq33.gif"/></alternatives></inline-formula> takes as input <italic>z</italic><sub><italic>i</italic></sub> from <inline-formula id="IEq34"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}$$\end{document}</tex-math><mml:math id="M80"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq34.gif"/></alternatives></inline-formula> and <italic>c</italic><sub><italic>i</italic></sub> (cell type annotation) as label and intends to minimize cross-entropy loss, hence classifying the latent cellular embeddings to its correct cell type. The cross-entropy loss is given by:<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$-\mathop{\sum }\limits_{i=1}^{| C| }{c}_{i}\times log({r}_{i})$$\end{document}</tex-math><mml:math id="M82"><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>C</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula>where <italic>c</italic><sub><italic>i</italic></sub> is the true cell type label, <italic>r</italic><sub><italic>i</italic></sub> is the softmax probability of the <italic>i</italic><sup><italic>t</italic><italic>h</italic></sup> cell type annotation and ∣<italic>C</italic>∣ is the number of cell types.</p>
        <p id="Par52">Under semi-supervised setting, <inline-formula id="IEq35"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M84"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq35.gif"/></alternatives></inline-formula> is trained using the labeled data, i.e., the cross-entropy loss is computed using the available cell type annotations. The trained network is then used to predict the cell type annotations for the unlabeled cells.</p>
      </sec>
      <sec id="Sec20">
        <title>Variational autoencoder for learning informed prior on cellular latent space</title>
        <p id="Par53">The variational autoencoder <inline-formula id="IEq36"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}$$\end{document}</tex-math><mml:math id="M86"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq36.gif"/></alternatives></inline-formula> consists of an encoder <italic>E</italic><sub><italic>y</italic></sub> that takes as input <italic>z</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub> and generates the mean <italic>μ</italic><sub><italic>y</italic></sub> and variance <italic>σ</italic><sub><italic>y</italic></sub> of the multivariate normal distribution (prior for <italic>y</italic>). The decoder network <italic>D</italic><sub><italic>y</italic></sub> takes as input <italic>y</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub> and reconstructs latent cellular embedding <inline-formula id="IEq37"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{{z}_{i}}$$\end{document}</tex-math><mml:math id="M88"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq37.gif"/></alternatives></inline-formula>. We assume the following distributions for <italic>y</italic><sub><italic>i</italic></sub> and <italic>z</italic><sub><italic>i</italic></sub><disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${y}_{i} \sim Normal(0,I),{z}_{i} \sim Normal({f}_{z}^{{\prime} \mu }({y}_{i},{c}_{i}),{f}_{z}^{{\prime} \sigma }({y}_{i},{c}_{i}))$$\end{document}</tex-math><mml:math id="M90"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>~</mml:mo><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>~</mml:mo><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mi>σ</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq38"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{z}^{{\prime} \mu }$$\end{document}</tex-math><mml:math id="M92"><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq38.gif"/></alternatives></inline-formula> and <inline-formula id="IEq39"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{z}^{{\prime} \sigma }$$\end{document}</tex-math><mml:math id="M94"><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mi>σ</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq39.gif"/></alternatives></inline-formula> are two functions approximated by the variational autoencoder <inline-formula id="IEq40"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}$$\end{document}</tex-math><mml:math id="M96"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq40.gif"/></alternatives></inline-formula>.</p>
        <p id="Par54">We use <italic>ϕ</italic> = {<italic>f</italic><sub><italic>E</italic></sub>, <italic>f</italic><sub><italic>D</italic></sub>}, and <inline-formula id="IEq41"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\phi }^{{\prime} }=\{{f}_{{E}_{y}},{f}_{{D}_{y}}\}$$\end{document}</tex-math><mml:math id="M98"><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq41.gif"/></alternatives></inline-formula> to denote the network parameters of the two variational autoencoders (<inline-formula id="IEq42"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}$$\end{document}</tex-math><mml:math id="M100"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq42.gif"/></alternatives></inline-formula> and <inline-formula id="IEq43"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}$$\end{document}</tex-math><mml:math id="M102"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq43.gif"/></alternatives></inline-formula> respectively) of scDREAMER-Sup which we learn using variational inference by maximizing an ELBO function given by:<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{rcl}ELBO&amp;=&amp;{E}_{{q}_{\phi }(z,l| x,s)}\left[log\,p(x| z,l,s)\right]-KL({q}_{\phi }(z| x,s)\,| | \,{E}_{{q}_{{\phi }^{{\prime} }}(y| z,c)}p(z| y,c))\\ &amp;&amp;-{E}_{{q}_{\phi }(z| x,s)}\,KL({q}_{{\phi }^{{\prime} }}(y| z,c)\,| | \,p(y))-KL({q}_{\phi }(l| x,s)\,| | \,p(l))\end{array}$$\end{document}</tex-math><mml:math id="M104"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi>E</mml:mi><mml:mi>L</mml:mi><mml:mi>B</mml:mi><mml:mi>O</mml:mi></mml:mtd><mml:mtd columnalign="center"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mspace width="0.25em"/><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.25em"/><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"/><mml:mtd columnalign="center"/><mml:mtd columnalign="left"><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.25em"/><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mspace width="0.25em"/><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.25em"/><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mspace width="0.25em"/><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>equation (<xref rid="Equ9" ref-type="disp-formula">9</xref>) denotes the ELBO function for only one cell (this is without loss of generality as the cells are independent and identically distributed) and assumes the following factorization of the variational distribution<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$q(z,y,l| x,s)=q(z| x,s)q(y| z,c)q(l| x,s)$$\end{document}</tex-math><mml:math id="M106"><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula>The ELBO is derived following semi-supervised variational autoencoder literature<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>. Our variational distribution does not approximate the posterior for cell type annotation <italic>c</italic>, instead for the cases, where <italic>c</italic> is unavailable, we use the cell type classifier to generate the cell type annotations.</p>
      </sec>
      <sec id="Sec21">
        <title>Implementation details of scDREAMER-Sup</title>
        <p id="Par55">scDREAMER-Sup has three additional neural networks corresponding to the Encoder <italic>E</italic><sub><italic>y</italic></sub>, Decoder <italic>D</italic><sub><italic>y</italic></sub> and the cell type classifier <inline-formula id="IEq44"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M108"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq44.gif"/></alternatives></inline-formula>, all with multi-layer dense neural network architecture with linear relu activation at the end of each layer. For training our model, we have adopted ADAM optimizer. The batch size of 128 was used while training the model.</p>
      </sec>
      <sec id="Sec22">
        <title>Preprocessing of scRNA-seq datasets</title>
        <p id="Par56">The scRNA-seq datasets were preprocessed using the standard pipeline of Scanpy<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. Raw count expression matrices were imported as Scanpy AnnData object followed by the removal of low-quality cells based on the mitochondrial gene counts. The expression matrices were then normalized (using “scanpy.pp.normalize_total” function) and log-transformed. Finally, we selected the top 2000 highly variable genes using the function “scanpy.pp.highly_variable_genes” (with flavor parameter as “seurat”) as input to scDREAMER and other methods. The genes that were present across all the batches were considered. For the healthy heart atlas dataset, cells annotated as doublets were removed.</p>
      </sec>
    </sec>
    <sec id="Sec23">
      <title>Metrics for the evaluation of integration performance</title>
      <p id="Par57">The data integration performance of all methods was primarily evaluated based on two broad categories of metrics: (1) biological variance conservation metrics and (2) batch effect correction metrics. Following a recent study<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>, we considered NMI, ARI, and ASW (cell type) as biological conservation metrics. For the evaluation of batch effect removal, we considered four metrics: ASW (batch), principal component regression (batch), graph connectivity, and kBET. For a holistic comparison of the performance across all the metrics in both of these categories, we introduced two composite scores and a combined composite score as described below. In addition, we computed isolated label F1 and isolated label silhouette scores for evaluating a method’s ability to capture rare cell identities. We also computed single-cell level metrics: graph iLISI (for batch correction), graph cLISI (for bio-conservation), and proportion of true positive vs positive cells.</p>
      <sec id="Sec24">
        <title>Biological conservation metrics</title>
        <p id="Par58">The computation of the biological conservation metrics requires clustering of the integrated data. We have used the Louvain clustering algorithm to compute the clusters with a resolution that maximizes the NMI value. The same clustering assignment is used for computing other metrics<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>.<list list-type="bullet"><list-item><p id="Par59"><bold>Normalized mutual information (NMI):</bold> NMI compares the overlap between any two clustering assignments where the overlap is measured in terms of mutual information. The NMI value is scaled in the range of 0 to 1 based on the mean entropy for cluster assignments and cell-type labels.</p></list-item><list-item><p id="Par60"><bold>Adjusted Rand Index (ARI):</bold> Rand index compares two clustering assignments considering all pairs of points and finding agreement and disagreement between the clustering assignments<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. The adjusted rand index (ARI) accounts for the randomly correct labels and it ranges from 0 to 1 with 0 corresponding to random clustering, and 1 representing a perfect match between the clusterings<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>. For ARI calculation, we compared the cell labels with the optimized NMI Louvain clusters.</p></list-item><list-item><p id="Par61"><bold>Cell type average silhouette width (ASW):</bold> Silhouette width for cell <italic>i</italic> is given by:<disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{r}sw(i)=\frac{b(i)-a(i)}{\max \{a(i),b(i)\}}\end{array}$$\end{document}</tex-math><mml:math id="M110"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi>s</mml:mi><mml:mi>w</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>max</mml:mi><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula>where <italic>a</italic>(<italic>i</italic>) is the average of distances of cell <italic>i</italic> to the other cells in the same cluster and <italic>b</italic>(<italic>i</italic>) is the average distance of cell <italic>i</italic> from the cells in the other nearest cluster. Average silhouette width (ASW) is calculated by averaging over all cells and it ranges between −1 to 1, where −1 or 0 indicates that clusters are overlapping and 1 corresponds to well-separated and dense clusters. As a bio-conservation metric, we computed cell type ASW by considering the cell types as the clusters and scaled between 0 to 1 by the transformation ASW = (ASW + 1)/2. The PCA reduced space is used for the calculation of distances for the corrected space output method. This metric is not applicable to the graph-based method BBKNN.</p></list-item></list></p>
      </sec>
      <sec id="Sec25">
        <title>Batch correction metrics</title>
        <p id="Par62">
          <list list-type="bullet">
            <list-item>
              <p id="Par63"><bold>ASW batch:</bold> ASW is calculated between the batches of each subset based on the cell type. Here the 0 value indicates that the batches are well-mixed. So we scaled the <italic>A</italic><italic>S</italic><italic>W</italic> = 1 − <italic>a</italic><italic>b</italic><italic>s</italic>(<italic>A</italic><italic>S</italic><italic>W</italic>). Now the scaled value 0 indicates that the batches are not well-mixed, 1 indicates that batches are well-mixed.</p>
            </list-item>
            <list-item>
              <p id="Par64"><bold>Principal component regression (PCR) batch:</bold> In principal component regression (PCR) batch<sup><xref ref-type="bibr" rid="CR47">47</xref></sup>, for each principal component (<italic>P</italic><italic>C</italic><sub><italic>k</italic></sub>) (calculated using PCA), the variance contributed by each batch <italic>b</italic> is computed as:<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{r}Var(M| b)=\mathop{\sum }\limits_{k=1}^{N}Var(M| P{C}_{i})*{R}^{2}(P{C}_{i}| b)\end{array}$$\end{document}</tex-math><mml:math id="M112"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi>V</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>M</mml:mi><mml:mo>∣</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mi>V</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>M</mml:mi><mml:mo>∣</mml:mo><mml:mi>P</mml:mi><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>P</mml:mi><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula>Where <italic>V</italic><italic>a</italic><italic>r</italic>(<italic>M</italic>∣<italic>P</italic><italic>C</italic><sub><italic>i</italic></sub>) indicates the variance explained by <italic>P</italic><italic>C</italic><sub><italic>i</italic></sub> on the data matrix <italic>M</italic>, and <italic>R</italic><sup>2</sup> denotes the coefficient of determination calculated using a linear regression with <italic>P</italic><italic>C</italic><sub><italic>i</italic></sub> as the dependent and <italic>b</italic> as the independent variable.</p>
            </list-item>
            <list-item>
              <p id="Par65"><bold>Graph connectivity</bold> Graph connectivity measures whether cells from the same cell type are well connected in the kNN graph. First, we compute the kNN graph with all the cells. Then we create a subset kNN graph with the cells from a particular cell type and check the number of cells in its largest connected component.<disp-formula id="Equ13"><label>13</label><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$GC=\frac{1}{| CT| }\mathop{\sum}\limits_{c\in CT}\frac{| LCC\left.\right(G({N}_{c},{E}_{c})| }{| {N}_{c}| }$$\end{document}</tex-math><mml:math id="M114"><mml:mi>G</mml:mi><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>C</mml:mi><mml:mi>T</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mi>C</mml:mi><mml:mi>T</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mo>∣</mml:mo><mml:mi>L</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi><mml:mfenced close="("><mml:mrow/></mml:mfenced><mml:mi>G</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∣</mml:mo></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula>Where <italic>C</italic><italic>T</italic> is the set of cell types, ∣<italic>L</italic><italic>C</italic><italic>C</italic>()∣ is the number of cells in the largest connected component. <italic>G</italic>(<italic>N</italic><sub><italic>c</italic></sub>, <italic>E</italic><sub><italic>c</italic></sub>) is the kNN subgraph for cell type <italic>c</italic> with <italic>N</italic><sub><italic>c</italic></sub> as the number of cells in cell type <italic>c</italic> and <italic>E</italic><sub><italic>c</italic></sub> denoting the edges in the kNN graph containing only the cells of type <italic>c</italic>.</p>
            </list-item>
            <list-item>
              <p id="Par66"><bold>k-nearest neighbor batch effect test (</bold><bold><italic>k</italic></bold><bold><italic>B</italic></bold><bold><italic>E</italic></bold><bold><italic>T</italic></bold><bold>):</bold> k-nearest neighbor batch effect test (<italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic>)<sup><xref ref-type="bibr" rid="CR47">47</xref></sup> evaluates how well the label configuration of the k-nearest neighborhoods of cells matches the global label configuration. <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> test is performed iteratively over a random subset of cells, and the value is calculated as the total rejection rates over all the iterations. As <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> works on the kNN graph, for the embedding-based output and corrected feature output methods, we have used <italic>k</italic> = 50 for calculating the kNN graph. <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> is applied to each batch separately to account for technical effects and changes in the cell type distribution across batches. For the kNN graphs containing disconnected components, <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> is calculated on each of the connected components. The number of nearest neighbors would differ for each cell in the graph-based method like BBKNN. So diffusion-based correction is used for graph-based output to get the same number of nearest neighbors for all the cells. <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> value is scaled between 0 to 1 so that the 0 value indicates poor batch mixing and 1 indicates perfect mixing of cells. It is important to note that for the healthy heart atlas dataset, <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> could not be computed for some of the methods due to computational limitations in handling large number of cells and batches (runs getting killed even after running for 72 h on Intel Xeon Gold 6246 CPU with 512 GB memory). This behavior of <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> has also been reported in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. For such cases, <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> has been excluded when computing the composite batch correction score.</p>
            </list-item>
          </list>
        </p>
      </sec>
      <sec id="Sec26">
        <title>Isolated label metrics</title>
        <p id="Par67">We adopted two isolated label scores from ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup> to evaluate how well a method can capture rare cell identities. Isolated labels denote the cell types that are present in the least number of batches. For each of the isolated labels, isolated F1 and isolated ASW are calculated. These two metrics reveal how well the isolated cell types are separated from the rest of the cell types after integration.</p>
        <p id="Par68">For the calculation of the isolated F1 score, first, we need to determine the clusters containing the particular isolated label. Lovain clustering is used for the clustering, and the resolution of the clustering algorithm is set such that the cluster has the largest number of isolated labels. The F1 score of isolated labels is then measured against the other cells in the cluster. F1 score ranges from 0 to 1 with 0 indicating that all the cells in the cluster are from cell types other than the isolated label and 1 indicating that all the cells are from isolated labels.</p>
        <p id="Par69">Isolated label ASW is calculated considering the isolated cell type as one cluster and all other cell types in another cluster and separately computing their ASW.</p>
      </sec>
      <sec id="Sec27">
        <title>Other metrics</title>
        <p id="Par70">
          <list list-type="bullet">
            <list-item>
              <p id="Par71"><bold>Graph inverse Simpson’s index LISI:</bold> The inverse Simpson’s index is a diversity score that calculates the number of neighbors needed to be visited before appearing in the same batch again. The value of this metric ranges from 1 to B (number of batches). This LISI score is used for the evaluation of both batch correction (iLISI) and bio-conservation (cLISI)<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. To extend the LISI to the graph-based methods graph LISI<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> is used. In graph LISI, the distance over joint embeddings is replaced with the graph-based distance between the cells to get a large number of neighbors. Dijkstra’s shortest path algorithm is used to calculate the shortest distance between the cells. In cLISI, inverse Simpson’s index is calculated over the cell types, i.e., the number of neighbors one needs to visit before getting the same cell type again in the neighborhood, whereas iLISI is calculated over the batches.</p>
            </list-item>
            <list-item>
              <p id="Par72"><bold>Proportion of positive and true positive cells:</bold> We further adopted another single-cell level summary metric from ref. <sup><xref ref-type="bibr" rid="CR22">22</xref></sup> to evaluate the integration performance. For this, first, the cells are classified into positive and negative cells. Cells surrounded by the same cell type are classified as positive; otherwise, they are classified as negative. Considering the subset of positive cells only, a positive cell is classified as true positive if the distribution of batches around it is the same as the global batch distribution. The proportion of positive cells indicates the extent of biological conservation. In contrast, the true positive percentage indicates how well the batches are well-mixed. These two proportions together serve as quantitative metrics for evaluating the batch effect removal performance.</p>
            </list-item>
          </list>
        </p>
      </sec>
      <sec id="Sec28">
        <title>Composite scores</title>
        <p id="Par73">We have introduced two composite score metrics for a holistic comparison of the performance across all the metrics for biological conservation and batch correction respectively. Moreover, we computed a combined composite score that measures the average performance of a method in biological conservation and batch correction. Each composite score is computed by averaging the scaled values of all the metrics in that category. For a dataset, the scaled value for each individual metric is obtained through min-max normalization across all the competing methods.</p>
        <p id="Par74">The composite scores are calculated as follows:<list list-type="order"><list-item><p id="Par75"><bold>Composite bio-conservation score</bold> = <inline-formula id="IEq45"><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left(\frac{NM{I}^{{\prime} }+AS{W}^{{\prime} }+AR{I}^{{\prime} }}{3}\right)$$\end{document}</tex-math><mml:math id="M116"><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>N</mml:mi><mml:mi>M</mml:mi><mml:msup><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>A</mml:mi><mml:mi>S</mml:mi><mml:msup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>A</mml:mi><mml:mi>R</mml:mi><mml:msup><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq45.gif"/></alternatives></inline-formula></p></list-item><list-item><p id="Par76"><bold>Composite batch correction score</bold> = <inline-formula id="IEq46"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left(\frac{ASW{(batch)}^{{\prime} }+PCR\,{{\mbox{\_}}}batc{h}^{{\prime} }+graph{{\mbox{\_}}}\,connectivit{y}^{{\prime} }+kBE{T}^{{\prime} }}{4}\right)$$\end{document}</tex-math><mml:math id="M118"><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>A</mml:mi><mml:mi>S</mml:mi><mml:mi>W</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>P</mml:mi><mml:mi>C</mml:mi><mml:mi>R</mml:mi><mml:mspace width="0.25em"/><mml:mo>_</mml:mo><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:msup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi><mml:mo>_</mml:mo><mml:mspace width="0.25em"/><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>v</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi><mml:msup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mi>E</mml:mi><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq46.gif"/></alternatives></inline-formula></p></list-item><list-item><p id="Par77"><bold>Composite isolated label score</bold> = <inline-formula id="IEq47"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left(\frac{isolated\,{{\mbox{\_}}}f1{{\mbox{\_}}}scor{e}^{{\prime} }+isolated{{\mbox{\_}}}\,AS{W}^{{\prime} }}{2}\right)$$\end{document}</tex-math><mml:math id="M120"><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mspace width="0.25em"/><mml:mo>_</mml:mo><mml:mi>f</mml:mi><mml:mn>1</mml:mn><mml:mo>_</mml:mo><mml:mi>s</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo>_</mml:mo><mml:mspace width="0.25em"/><mml:mi>A</mml:mi><mml:mi>S</mml:mi><mml:msup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq47.gif"/></alternatives></inline-formula></p></list-item><list-item><p id="Par78"><bold>Combined composite score</bold> = <inline-formula id="IEq48"><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{1}{2}$$\end{document}</tex-math><mml:math id="M122"><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq48.gif"/></alternatives></inline-formula>(Composite bio-conservation score + Composite batch correction score)</p></list-item></list>For any metric <inline-formula id="IEq49"><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${M}_{e},{M}_{e}^{{\prime} }$$\end{document}</tex-math><mml:math id="M124"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq49.gif"/></alternatives></inline-formula> denotes the min-max scaled value across all the competing methods.</p>
      </sec>
      <sec id="Sec29">
        <title>Metric for evaluating the accuracy of cell label prediction</title>
        <p id="Par79">We have adopted macro F1-score to evaluate how well a method can predict the cell type labels for the datasets with missing cell type labels. The F1-score metric measures the classification accuracy as the harmonic mean of precision and recall. In the context of cell label prediction, multiple classes are involved and F1-score is computed for every cell type annotation (class). Macro F1-score computes the overall accuracy of a multi-class classifier by aggregation of F1-scores for all the individual classes. For the prediction of cell type labels, it is computed by taking the arithmetic mean of the F1-scores for all the cell type annotations.</p>
      </sec>
    </sec>
    <sec id="Sec30">
      <title>Competing integration methods</title>
      <p id="Par80">We have compared our method against eleven state-of-the-art integration methods: scVI<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>, Scanaroma<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>, Harmony<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>, Seurat<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>, BBKNN<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>, INSCT<sup><xref ref-type="bibr" rid="CR48">48</xref></sup>, LIGER<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>, iMAP<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, scANVI<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>, scGEN<sup><xref ref-type="bibr" rid="CR31">31</xref></sup> and scDML<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. The details about the run configuration for these methods are provided in Supplementary Table <xref rid="MOESM1" ref-type="media">5</xref>.</p>
    </sec>
    <sec id="Sec31">
      <title>Statistics and reproducibility</title>
      <p id="Par81">No statistical method was used to predetermine the sample size. No data were excluded from the analyses. The experiments involved running computational methods on previously published, publicly available datasets and did not require randomization. The investigators were not blinded to allocation during experiments and assessment of outcome.</p>
    </sec>
    <sec id="Sec32">
      <title>Reporting summary</title>
      <p id="Par82">Further information on research design is available in the <xref rid="MOESM3" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec33">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_43590_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information file</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_43590_MOESM2_ESM.pdf">
            <caption>
              <p>Peer review file</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_43590_MOESM3_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
    <sec id="Sec34">
      <title>Source data</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_43590_MOESM4_ESM.xlsx">
            <caption>
              <p>Source data</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_43590_MOESM5_ESM.txt">
            <caption>
              <p>Author Meta Data</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Ajita Shree, Musale Krushna Pavan.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-43590-8.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was partially supported by the Science and Engineering Research Board (SERB), Government of India (SRG/2020/001333) and IIT Kanpur initiation grant (IITK /CS /2019236) to H.Z. Funding for open access charge is obtained from IIT Kanpur Research I Foundation grant 20030163.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>H.Z. designed the study. A.S., M.K.P., and H.Z. developed the model and algorithm. A.S. and M.K.P. implemented the software and performed all experiments. All authors wrote and approved the manuscript.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par83"><italic>Nature Communications</italic> thanks the anonymous, reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All datasets used in this study are publicly available. The human pancreas data used in this study are available in the GEO database under accession codes “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81076">GSE81076</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81076">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81076</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE85241">GSE85241</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE85241">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE85241</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE86469">GSE86469</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE86469">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE86469</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE84133">GSE84133</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE84133">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE84133</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81608">GSE81608</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81608">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81608</ext-link>]”, and the ArrayExpress database under the accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/biostudies/arrayexpress/studies/E-MTAB-5061">E-MTAB-5061</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/biostudies/arrayexpress/studies/E-MTAB-5061">https://www.ebi.ac.uk/biostudies/arrayexpress/studies/E-MTAB-5061</ext-link>]”<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. The lung atlas data is available in the GEO database under accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE130148">GSE130148</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE130148">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE130148</ext-link>]”. The human immune data used in this study are available in the GEO database under accession codes “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE120221">GSE120221</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE120221">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE120221</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE107727">GSE107727</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE107727">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE107727</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE115189">GSE115189</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE115189">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE115189</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE128066">GSE128066</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE128066">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE128066</ext-link>]” and “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE94820">GSE94820</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE94820">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE94820</ext-link>]” and in the website of 10X Genomics (PBMC10k: <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.0/pbmc_10k_v3">https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.0/pbmc_10k_v3</ext-link>)<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. The processed human pancreas, human immune, and lung atlas datasets are available at <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/dataset/Benchmarking_atlas-level_data_integration_in_single-cell_genomics_-_integration_task_datasets_Immune_and_pancreas_/12420968">https://figshare.com/articles/dataset/Benchmarking_atlas-level_data_integration_in_single-cell_genomics_-_integration_task_datasets_Immune_and_pancreas_/12420968</ext-link><sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. The Macaque Retina dataset is available at <ext-link ext-link-type="uri" xlink:href="https://singlecell.broadinstitute.org/single_cell/study/SCP212/molecular-specification-of-retinal-cell-types-underlying-central-and-peripheral-vision-in-primates#study-download">https://singlecell.broadinstitute.org/single_cell/study/SCP212/molecular-specification-of-retinal-cell-types-underlying-central-and-peripheral-vision-in-primates#study-download</ext-link>. The Healthy Heart data used in this study is available at <ext-link ext-link-type="uri" xlink:href="https://www.heartcellatlas.org/">https://www.heartcellatlas.org/</ext-link><sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. The processed Healthy Heart data used in this study can be downloaded from <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/dataset/Batch_Alignment_of_single-cell_transcriptomics_data_using_Deep_Metric_Learning/20499630/2">https://figshare.com/articles/dataset/Batch_Alignment_of_single-cell_transcriptomics_data_using_Deep_Metric_Learning/20499630/2</ext-link><sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. The Human and Mouse cell Atlas datasets used in the study are available at <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/dataset/MCA_DGE_Data/5435866">https://figshare.com/articles/dataset/MCA_DGE_Data/5435866</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/dataset/HCL_DGE_Data/7235471">https://figshare.com/articles/dataset/HCL_DGE_Data/7235471</ext-link>, respectively. The processed Human-Mouse cell atlas data can be downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/lkmklsmn/insct/tree/master/reproducibilty">https://github.com/lkmklsmn/insct/tree/master/reproducibilty</ext-link><sup><xref ref-type="bibr" rid="CR48">48</xref></sup>. All the processed datasets for the missing label experiments (for lung atlas, human immune and heart atlas tasks) are openly available at 10.6084/m9.figshare.24354295. The details of the experimental biological datasets used in this study are further provided in Supplementary Table <xref rid="MOESM1" ref-type="media">1</xref>. All other data supporting the findings of this study are available within the article and its supplementary files. Any additional requests for information can be directed to, and will be fulfilled by, the corresponding author. <xref ref-type="sec" rid="Sec34">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The source code and usage tutorial for scDREAMER are freely available at <ext-link ext-link-type="uri" xlink:href="https://github.com/Zafar-Lab/scDREAMER">https://github.com/Zafar-Lab/scDREAMER</ext-link>, the code has also been deposited via Zenodo (10.5281/zenodo.10021620)<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. All analysis and results presented in the manuscript are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/Zafar-Lab/scDREAMER-reproducibility">https://github.com/Zafar-Lab/scDREAMER-reproducibility</ext-link>, which have also been deposited via Zenodo (10.5281/zenodo.10021936)<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par84">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA sequencing to explore immune cell heterogeneity</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2018</year>
        <volume>18</volume>
        <fpage>35</fpage>
        <lpage>45</lpage>
        <pub-id pub-id-type="doi">10.1038/nri.2017.76</pub-id>
        <?supplied-pmid 28787399?>
        <pub-id pub-id-type="pmid">28787399</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pijuan-Sala</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell molecular map of mouse gastrulation and early organogenesis</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>566</volume>
        <fpage>490</fpage>
        <lpage>495</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-0933-9</pub-id>
        <?supplied-pmid 30787436?>
        <pub-id pub-id-type="pmid">30787436</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suvà</surname>
            <given-names>ML</given-names>
          </name>
          <name>
            <surname>Tirosh</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA sequencing in cancer: lessons learned and emerging challenges</article-title>
        <source>Mol. Cell</source>
        <year>2019</year>
        <volume>75</volume>
        <fpage>7</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1016/j.molcel.2019.05.003</pub-id>
        <?supplied-pmid 31299208?>
        <pub-id pub-id-type="pmid">31299208</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rozenblatt-Rosen</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Stubbington</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
        </person-group>
        <article-title>The human cell atlas: from vision to reality</article-title>
        <source>Nature</source>
        <year>2017</year>
        <volume>550</volume>
        <fpage>451</fpage>
        <lpage>453</lpage>
        <pub-id pub-id-type="doi">10.1038/550451a</pub-id>
        <?supplied-pmid 29072289?>
        <pub-id pub-id-type="pmid">29072289</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Snyder</surname>
            <given-names>MP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The human body at cellular resolution: the NIH human biomolecular atlas program</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>574</volume>
        <fpage>187</fpage>
        <lpage>192</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1629-x</pub-id>
        <pub-id pub-id-type="pmid">31597973</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mereu</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking single-cell RNA-sequencing protocols for cell atlas projects</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2020</year>
        <volume>38</volume>
        <fpage>747</fpage>
        <lpage>755</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0469-4</pub-id>
        <?supplied-pmid 32518403?>
        <pub-id pub-id-type="pmid">32518403</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tabula Muris Consortium</surname>
          </name>
          <etal/>
        </person-group>
        <article-title>A single cell transcriptomic atlas characterizes aging tissues in the mouse</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>583</volume>
        <fpage>590</fpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2496-1</pub-id>
        <pub-id pub-id-type="pmid">32669714</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gehring</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Hwee Park</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Thomson</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Highly multiplexed single-cell RNA-seq by DNA oligonucleotide tagging of cellular proteins</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2020</year>
        <volume>38</volume>
        <fpage>35</fpage>
        <lpage>38</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0372-z</pub-id>
        <?supplied-pmid 31873215?>
        <pub-id pub-id-type="pmid">31873215</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luecken</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Current best practices in single-cell RNA-seq analysis: a tutorial</article-title>
        <source>Mol. Syst. Biol.</source>
        <year>2019</year>
        <volume>15</volume>
        <fpage>e8746</fpage>
        <pub-id pub-id-type="doi">10.15252/msb.20188746</pub-id>
        <?supplied-pmid 31217225?>
        <pub-id pub-id-type="pmid">31217225</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pandey</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Zafar</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Inference of cell state transitions and cell fate plasticity from single-cell with MARGARET</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2022</year>
        <volume>50</volume>
        <fpage>e86</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkac412</pub-id>
        <?supplied-pmid 35639499?>
        <pub-id pub-id-type="pmid">35639499</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Argelaguet</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Cuomo</surname>
            <given-names>AS</given-names>
          </name>
          <name>
            <surname>Stegle</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Computational principles and challenges in single-cell data integration</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>1202</fpage>
        <lpage>1215</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-00895-7</pub-id>
        <?supplied-pmid 33941931?>
        <pub-id pub-id-type="pmid">33941931</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lähnemann</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Eleven grand challenges in single-cell data science</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>1</fpage>
        <lpage>35</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-1926-6</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kiselev</surname>
            <given-names>VY</given-names>
          </name>
          <name>
            <surname>Yiu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hemberg</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>scmap: projection of single-cell RNA-seq data across data sets</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>359</fpage>
        <lpage>362</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4644</pub-id>
        <?supplied-pmid 29608555?>
        <pub-id pub-id-type="pmid">29608555</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ge</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Alavi</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Xing</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Bar-Joseph</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Supervised adversarial alignment of single-cell RNA-seq data</article-title>
        <source>J. Comput. Biol.</source>
        <year>2021</year>
        <volume>28</volume>
        <fpage>501</fpage>
        <lpage>513</lpage>
        <pub-id pub-id-type="doi">10.1089/cmb.2020.0439</pub-id>
        <?supplied-pmid 33470876?>
        <pub-id pub-id-type="pmid">33470876</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id>
        <?supplied-pmid 31740819?>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hie</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Bryson</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Berger</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Efficient integration of heterogeneous single-cell transcriptomes using Scanorama</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>685</fpage>
        <lpage>691</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0113-3</pub-id>
        <?supplied-pmid 31061482?>
        <pub-id pub-id-type="pmid">31061482</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Polański</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>BBKNN: fast batch alignment of single cell transcriptomes</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>964</fpage>
        <lpage>965</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btz625</pub-id>
        <?supplied-pmid 31400197?>
        <pub-id pub-id-type="pmid">31400197</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Welch</surname>
            <given-names>JD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell multi-omic integration compares and contrasts features of brain cell identity</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1873</fpage>
        <lpage>1887</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.006</pub-id>
        <?supplied-pmid 31178122?>
        <pub-id pub-id-type="pmid">31178122</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
        <?supplied-pmid 30504886?>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deep learning enables accurate clustering with batch effect removal in single-cell RNA-seq analysis</article-title>
        <source>Nat. Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>1</fpage>
        <lpage>14</lpage>
        <pub-id pub-id-type="pmid">31911652</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>iMAP: integration of multiple single-cell datasets by adversarial paired transfer networks</article-title>
        <source>Genome Biol.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>1</fpage>
        <lpage>24</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-021-02280-8</pub-id>
        <pub-id pub-id-type="pmid">33397451</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <mixed-citation publication-type="other">Kodali, N., Abernethy, J., Hays, J. &amp; Kira, Z. On convergence and stability of GANs. Preprint at <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1705.07215">https://arxiv.org/abs/1705.07215</ext-link> (2017).</mixed-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">Luecken, M. D. et al. Benchmarking atlas-level data integration in single-cell genomics. <italic>Nat. Methods</italic><bold>19</bold>, 41–50 (2022).</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <mixed-citation publication-type="other">Oetjen, K. A. et al. Human bone marrow assessment by single-cell RNA sequencing, mass cytometry, and flow cytometry. <italic>JCI Insight</italic><bold>3</bold>, e124928 (2018).</mixed-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>GX</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>
        <source>Nat. Commun.</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>14049</fpage>
        <pub-id pub-id-type="doi">10.1038/ncomms14049</pub-id>
        <?supplied-pmid 28091601?>
        <pub-id pub-id-type="pmid">28091601</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Freytag, S., Tian, L., Lönnstedt, I., Ng, M. &amp; Bahlo, M. Comparison of clustering tools in R for medium-sized 10x genomics single-cell RNA-sequencing data. <italic>F1000Res.</italic><bold>7</bold>, 1297 (2018).</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A Bayesian mixture model for clustering droplet-based single-cell transcriptomic data from population studies</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>1</fpage>
        <lpage>10</lpage>
        <pub-id pub-id-type="pmid">30602773</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Villani</surname>
            <given-names>A-C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA-seq reveals new types of human blood dendritic cells, monocytes, and progenitors</article-title>
        <source>Science</source>
        <year>2017</year>
        <volume>356</volume>
        <fpage>eaah4573</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aah4573</pub-id>
        <?supplied-pmid 28428369?>
        <pub-id pub-id-type="pmid">28428369</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xu</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Probabilistic harmonization and annotation of single-cell transcriptomics data with deep generative models</article-title>
        <source>Mol. Syst. Biol.</source>
        <year>2021</year>
        <volume>17</volume>
        <fpage>e9620</fpage>
        <pub-id pub-id-type="doi">10.15252/msb.20209620</pub-id>
        <?supplied-pmid 33491336?>
        <pub-id pub-id-type="pmid">33491336</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lotfollahi</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>scGen predicts single-cell perturbation responses</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>715</fpage>
        <lpage>721</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0494-8</pub-id>
        <?supplied-pmid 31363220?>
        <pub-id pub-id-type="pmid">31363220</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <mixed-citation publication-type="other">Kanemaru, K. et al. Spatially resolved multiomics of human cardiac niches. <italic>Nature</italic><bold>619</bold>, 801–810 (2023).</mixed-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>Batch alignment of single-cell transcriptomics data using deep metric learning</article-title>
        <source>Nat. Commun.</source>
        <year>2023</year>
        <volume>14</volume>
        <fpage>960</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-023-36635-5</pub-id>
        <?supplied-pmid 36810607?>
        <pub-id pub-id-type="pmid">36810607</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Peng</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular classification and comparative taxonomics of foveal and peripheral cells in primate retina</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>176</volume>
        <fpage>1222</fpage>
        <lpage>1237</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.01.004</pub-id>
        <?supplied-pmid 30712875?>
        <pub-id pub-id-type="pmid">30712875</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Han</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping the mouse cell atlas by microwell-seq</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>172</volume>
        <fpage>1091</fpage>
        <lpage>1107</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.02.001</pub-id>
        <?supplied-pmid 29474909?>
        <pub-id pub-id-type="pmid">29474909</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Han</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Construction of a human cell landscape at single-cell level</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>581</volume>
        <fpage>303</fpage>
        <lpage>309</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2157-4</pub-id>
        <?supplied-pmid 32214235?>
        <pub-id pub-id-type="pmid">32214235</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Mukherjee</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kannan</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>A deep adversarial variational autoencoder model for dimensionality reduction in single-cell RNA sequencing analysis</article-title>
        <source>BMC Bioinformatics</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>1</fpage>
        <lpage>11</lpage>
        <pub-id pub-id-type="doi">10.1186/s12859-020-3401-5</pub-id>
        <pub-id pub-id-type="pmid">31898485</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Litviňuková</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cells of the adult human heart</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>588</volume>
        <fpage>466</fpage>
        <lpage>472</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2797-4</pub-id>
        <?supplied-pmid 32971526?>
        <pub-id pub-id-type="pmid">32971526</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <mixed-citation publication-type="other">Suo, C. et al. Mapping the developing human immune system across organs. <italic>Science</italic><bold>376</bold>, eabo0510 (2022).</mixed-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Jones, R. C. et al. The Tabula Sapiens: a multiple-organ, single-cell transcriptomic atlas of humans. <italic>Science</italic><bold>376</bold>, eabl4896 (2022).</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Kingma, D. P. &amp; Ba, J. Adam: a method for stochastic optimization. Preprint at <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1412.6980">https://arxiv.org/abs/1412.6980</ext-link> (2014).</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ding</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Deep generative model embedding of single-cell RNA-seq profiles on hyperspheres and hyperbolic spaces</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>1</fpage>
        <lpage>17</lpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-22851-4</pub-id>
        <pub-id pub-id-type="pmid">33397941</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kingma</surname>
            <given-names>DP</given-names>
          </name>
          <name>
            <surname>Mohamed</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Jimenez Rezende</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Welling</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Semi-supervised learning with deep generative models</article-title>
        <source>Adv. Neural Inf. Process. Syst.</source>
        <year>2014</year>
        <volume>27</volume>
        <fpage>3581</fpage>
        <lpage>3589</lpage>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>1</fpage>
        <lpage>5</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id>
        <pub-id pub-id-type="pmid">29301551</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rand</surname>
            <given-names>WM</given-names>
          </name>
        </person-group>
        <article-title>Objective criteria for the evaluation of clustering methods</article-title>
        <source>J. Am. Stat. Assoc.</source>
        <year>1971</year>
        <volume>66</volume>
        <fpage>846</fpage>
        <lpage>850</lpage>
        <pub-id pub-id-type="doi">10.1080/01621459.1971.10482356</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hubert</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Arabie</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Comparing partitions</article-title>
        <source>J. Classif.</source>
        <year>1985</year>
        <volume>2</volume>
        <fpage>193</fpage>
        <lpage>218</lpage>
        <pub-id pub-id-type="doi">10.1007/BF01908075</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Büttner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Miao</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>A test metric for assessing single-cell RNA-seq batch correction</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>43</fpage>
        <lpage>49</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0254-1</pub-id>
        <?supplied-pmid 30573817?>
        <pub-id pub-id-type="pmid">30573817</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Simon</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Y-Y</given-names>
          </name>
          <name>
            <surname>Zhao</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Integration of millions of transcriptomes using batch-aware triplet neural networks</article-title>
        <source>Nat. Mach. Intell.</source>
        <year>2021</year>
        <volume>3</volume>
        <fpage>705</fpage>
        <lpage>715</lpage>
        <pub-id pub-id-type="doi">10.1038/s42256-021-00361-8</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <mixed-citation publication-type="other">Shree, A., Musale, K. P. &amp; Zafar, H. Zafar-lab/scdreamer. Zenodo 10.5281/zenodo.10021620 (2023).</mixed-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <mixed-citation publication-type="other">Shree, A., Musale, K. P. &amp; Zafar, H. Zafar-lab/scdreamer-reproducibility. Zenodo 10.5281/zenodo.10021936 (2023).</mixed-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10682386</article-id>
    <article-id pub-id-type="pmid">38012145</article-id>
    <article-id pub-id-type="publisher-id">43590</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-43590-8</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scDREAMER for atlas-level integration of single-cell datasets using deep generative model paired with adversarial classifier</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1064-6238</contrib-id>
        <name>
          <surname>Shree</surname>
          <given-names>Ajita</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7856-8224</contrib-id>
        <name>
          <surname>Pavan</surname>
          <given-names>Musale Krushna</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1617-2806</contrib-id>
        <name>
          <surname>Zafar</surname>
          <given-names>Hamim</given-names>
        </name>
        <address>
          <email>hamim@iitk.ac.in</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/05pjsgx75</institution-id><institution-id institution-id-type="GRID">grid.417965.8</institution-id><institution-id institution-id-type="ISNI">0000 0000 8702 0100</institution-id><institution>Department of Computer Science and Engineering, </institution><institution>Indian Institute of Technology Kanpur, </institution></institution-wrap>Kanpur, India </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/05pjsgx75</institution-id><institution-id institution-id-type="GRID">grid.417965.8</institution-id><institution-id institution-id-type="ISNI">0000 0000 8702 0100</institution-id><institution>Department of Biological Sciences and Bioengineering, </institution><institution>Indian Institute of Technology Kanpur, </institution></institution-wrap>Kanpur, India </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/05pjsgx75</institution-id><institution-id institution-id-type="GRID">grid.417965.8</institution-id><institution-id institution-id-type="ISNI">0000 0000 8702 0100</institution-id><institution>Mehta Family Centre for Engineering in Medicine, </institution><institution>Indian Institute of Technology Kanpur, </institution></institution-wrap>Kanpur, India </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>7781</elocation-id>
    <history>
      <date date-type="received">
        <day>13</day>
        <month>7</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>14</day>
        <month>11</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Integration of heterogeneous single-cell sequencing datasets generated across multiple tissue locations, time, and conditions is essential for a comprehensive understanding of the cellular states and expression programs underlying complex biological systems. Here, we present scDREAMER (<ext-link ext-link-type="uri" xlink:href="https://github.com/Zafar-Lab/scDREAMER">https://github.com/Zafar-Lab/scDREAMER</ext-link>), a data-integration framework that employs deep generative models and adversarial training for both unsupervised and supervised (scDREAMER-Sup) integration of multiple batches. Using six real benchmarking datasets, we demonstrate that scDREAMER can overcome critical challenges including skewed cell type distribution among batches, nested batch-effects, large number of batches and conservation of development trajectory across batches. Our experiments also show that scDREAMER and scDREAMER-Sup outperform state-of-the-art unsupervised and supervised integration methods respectively in batch-correction and conservation of biological variation. Using a 1 million cells dataset, we demonstrate that scDREAMER is scalable and can perform atlas-level cross-species (e.g., human and mouse) integration while being faster than other deep-learning-based methods.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Integration of single-cell datasets is essential to gain a comprehensive understanding of complex biological systems. Here, the authors develop scDREAMER, a deep generative framework for performing unsupervised and supervised atlas-level integration, demonstrating improved bio-conservation and batch-correction.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Data integration</kwd>
      <kwd>Computational models</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">501100001403</institution-id>
            <institution>Indian Institute of Technology Kanpur (IITK)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>IITK /CS /2019236</award-id>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">The exploration of cellular heterogeneity and developmental trajectories in different tissue systems has been revolutionized by the rapid advances of single-cell RNA-sequencing technologies<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR3">3</xref></sup>. This rapid development coupled with large-scale collaborative initiatives such as the Human Cell Atlas (HCA) and Human BioMolecular Atlas Program (HuBMAP)<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR5">5</xref></sup> have increased the complexity of single-cell datasets which can include samples contributed by different laboratories<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>, generated across tissue locations, time and conditions<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR8">8</xref></sup>. Since single-cell datasets generated from similar biological contexts but different experimental conditions can share cellular features<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, integration of information from heterogeneous data sources can facilitate the discovery of major and rare cell types, improve the reconstruction of developmental trajectories<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and lead to more reliable investigation of complex biological systems. However, the intrinsic differences in measured gene expression among experimental settings contributed by factors such as sequencing protocols, library preparation, sample donors, tissue of origin, sampling time and condition inevitably create complex, nested batch effects that can diminish the value of data integration by confounding biological signals<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>. Thus the development of computational data integration methods that can reliably eliminate the complex batch effects without undermining biological variations is a major challenge in scRNA-seq analysis<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>.</p>
    <p id="Par4">Existing methods for the integration of scRNA-seq datasets can be broadly classified into two groups. The first group of methods employs cell type annotations for supervised cross-batch learning<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR14">14</xref></sup> while removing batch effects. The requirement for cell type annotations limits their applications as novel cell types cannot be captured. In comparison, unsupervised data integration methods<sup><xref ref-type="bibr" rid="CR15">15</xref>–<xref ref-type="bibr" rid="CR18">18</xref></sup> that do not require cell type annotations are more widely used. Some of these methods identify the batch-specific gene factors from the gene expression profiles<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. Methods such as BBKNN, Scanorama and Seurat v3 employ global mutual nearest neighbors (MNNs), i.e., paired cells between multiple batches for batch correction of the neighborhood using reduced-dimension cellular spaces. Harmony<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> achieves better batch mixing by applying a novel local correction. These MNN-based methods consume a large memory and low-quality MNNs can make it difficult to simultaneously identify dataset-specific cell types and the cell types that are shared by multiple datasets. Methods such as scVI<sup><xref ref-type="bibr" rid="CR20">20</xref></sup> and DESC<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> that employ deep variational autoencoders for learning cellular embeddings from scRNA-seq can also integrate data from multiple batches. However, the traditional autoencoder models are challenged due to lower fidelity in reproducing the batch-corrected expression profiles<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. Another method, iMAP<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> combines generative adversarial networks (GANs) with autoencoder for learning batch-ignorant cellular representations, however its dependence on MNN pairs to train the GAN can lead to sub-optimal integration due to low-quality MNN and unstable training of GAN<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. A recent benchmarking study<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> showed that methods such as Harmony and Seurat perform well for simple integration tasks but poorly for complex integration tasks and vice versa for Scanorama and scVI and a consistent tradeoff exists between batch-correction and preservation of biological variations.</p>
    <p id="Par5">To overcome the existing challenges, here we present a deep learning-based data integration framework, called scDREAMER (<underline>s</underline>ingle-<underline>c</underline>ell <underline>D</underline>eep gene<underline>R</underline>ativ<underline>E</underline> integr<underline>A</underline>tion <underline>M</underline>odel with adv<underline>E</underline>rsarial classifie<underline>R</underline>) that performs the integration of multiple batches in unsupervised (no cell type annotations required), semi-supervised and supervised (available cell type annotation are utilized) manner. The unsupervised version of scDREAMER employs an adversarial variational autoencoder and a batch classifier (a multi-layer neural network) which are trained adversarially for learning batch-invariant lower-dimensional cellular embeddings. The supervised version, scDREAMER-Sup, employs an additional variational autoencoder and a cell type classifier (another feed-forward neural network) to utilize available cell type annotations for a semi-supervised or supervised inference of cellular latent spaces. Using multiple real datasets consisting of up to 1 million cells and 147 batches (Supplementary Table <xref rid="MOESM1" ref-type="media">1)</xref>, we demonstrate that scDREAMER is able to overcome a variety of integration challenges including the presence of skewed cell types among batches (pancreas integration), nested batch effects (lung integration), large number of batches (heart atlas and macaque retina integration) and conservation of development trajectory across different batches (human immune integration). Using these integration tasks, we further show that scDREAMER achieves better performance in batch-correction and conservation of biological variation against that of the state-of-the-art unsupervised methods. The supervised version of scDREAMER, scDREAMER-Sup improves upon scDREAMER in terms of conservation of biological variation while retaining superior performance in batch-correction and outperforms other state-of-the-art supervised and unsupervised integration methods. For a challenging heart atlas dataset, which several methods failed to integrate due to a large number of batches and complex nested batch effects, scDREAMER and scDREAMER-Sup outperform the other methods by a large margin. Our experiments also show that scDREAMER and scDREAMER-Sup can reliably identify rare cell types. Using semi-supervised integration settings, we also demonstrate scDREAMER-Sup’s superiority over other methods in predicting the cell type labels for the cells missing annotations. Finally, using a 1 million cells dataset, we demonstrate that scDREAMER is highly scalable, can perform atlas-level data integration across different species, and achieves runtime advantage over some other deep-learning-based integration methods.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Overview of scDREAMER</title>
      <p id="Par6">Figure <xref rid="Fig1" ref-type="fig">1</xref> shows the overview of both the unsupervised and supervised models of scDREAMER. The unsupervised model (we will refer it to as scDREAMER) employs an adversarial variational autoencoder for learning the lower-dimensional representation of cells from the high-dimensional scRNA-seq data and a neural network classifier (also called a batch classifier) for the removal of batch effects. scDREAMER models the scRNA-seq data as a nonlinear function of a lower-dimensional cell-state embedding and the batch information that encodes the variation in data generation. The adversarial variational autoencoder of scDREAMER consists of three multi-layer neural networks: an encoder <italic>E</italic> that maps the high-dimensional expression data (<italic>x</italic><sub><italic>i</italic></sub>) and batch information (<italic>s</italic><sub><italic>i</italic></sub>) of a cell <italic>i</italic> to a lower-dimensional embedding <italic>z</italic><sub><italic>i</italic></sub>, a decoder <italic>D</italic>, which reconstructs the expression profile of the cell from <italic>z</italic><sub><italic>i</italic></sub> and <italic>s</italic><sub><italic>i</italic></sub>, and a discriminator <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M2"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq1.gif"/></alternatives></inline-formula> that aims to distinguish the original expression profile <italic>x</italic><sub><italic>i</italic></sub> and the expression profile reconstructed (<inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{{x}_{i}}$$\end{document}</tex-math><mml:math id="M4"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq2.gif"/></alternatives></inline-formula>) by the decoder. The adversarial variational autoencoder network of scDREAMER is trained using two loss functions: evidence lower bound (ELBO) is used for training the encoder and decoder networks, whereas Bhattacharyya loss is used for adversarial training of discriminator and autoencoder parameters. scDREAMER further incorporates a batch classifier <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M6"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq3.gif"/></alternatives></inline-formula> (a multi-layer neural network) that takes as input the lower-dimensional embedding <italic>z</italic><sub><italic>i</italic></sub> learned by the encoder and tries to predict the batch information for cell <italic>i</italic>. The batch classifier and the encoder are adversarially trained using a cross-entropy loss where the encoder tries to maximize it with an aim to generate the embeddings such that the classifier is not able to differentiate between batches and the batch classifier tries to minimize it by distinguishing the embeddings of the cells coming from different batches and hence achieving better mixing of the batches (see “Methods” section for details).<fig id="Fig1"><label>Fig. 1</label><caption><title>Overview of scDREAMER and scDREAMER-Sup.</title><p>scDREAMER consists of an adversarial variational autoencoder and a batch classifier. The adversarial variational autoencoder comprises of three networks: an encoder, a decoder, and a discriminator, and these networks are trained using ELBO and Bhattacharya loss functions. The batch classifier is adversarially trained along with the encoder using a cross-entropy loss. scDREAMER learns latent cellular embeddings such that the cells from different batches are well-mixed and different cell types are separated leading to the conservation of biological variations. scDREAMER-Sup consists of an additional variational autoencoder and a cell-type classifier in addition to the components in scDREAMER. The hierarchical variational autoencoder is trained using an ELBO loss. The cell type classifier is trained using a cross-entropy loss. scDREAMER-Sup learns latent cellular embeddings such that the cells from different batches are well-mixed with improved conservation of biological variations.</p></caption><graphic xlink:href="41467_2023_43590_Fig1_HTML" id="d32e418"/></fig></p>
      <p id="Par7">We further extended the scDREAMER model to utilize available cell type annotations (Fig. <xref rid="Fig1" ref-type="fig">1</xref>) for a guided inference of cellular latent space <italic>z</italic><sub><italic>i</italic></sub>. The extended model, scDREAMER-Sup assumes an informative prior on <italic>z</italic><sub><italic>i</italic></sub> conditioned on cell type label <italic>c</italic><sub><italic>i</italic></sub> and another Gaussian latent variable <italic>y</italic><sub><italic>i</italic></sub> that accounts for within cell type variability. For learning the hierarchically structured <italic>z</italic><sub><italic>i</italic></sub>, scDREAMER-Sup employs an additional variational autoencoder consisting of an encoder <italic>E</italic><sub><italic>y</italic></sub> that learns <italic>y</italic><sub><italic>i</italic></sub> from <italic>z</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub> and a decoder <italic>D</italic><sub><italic>y</italic></sub> that reconstructs <italic>z</italic><sub><italic>i</italic></sub> from <italic>y</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub> such that a more informative prior can be used for <italic>z</italic><sub><italic>i</italic></sub> in the adversarial variational autoencoder. The two variational autoencoders are jointly trained using an updated ELBO function (see “Methods” for details). scDREAMER-Sup further employs a feed-forward neural network (also called cell type classifier), <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M8"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq4.gif"/></alternatives></inline-formula>, for learning <italic>c</italic><sub><italic>i</italic></sub> from <italic>z</italic><sub><italic>i</italic></sub> which is trained using a cross-entropy loss using the available cell type annotations. For cells without cell type annotations, scDREAMER-Sup learns the missing cell type labels using <inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M10"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq5.gif"/></alternatives></inline-formula>. <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M12"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq6.gif"/></alternatives></inline-formula> and <inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M14"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq7.gif"/></alternatives></inline-formula> are trained in the same way as in scDREAMER.</p>
    </sec>
    <sec id="Sec4">
      <title>scDREAMER integrates pancreatic islet data generated using different sequencing protocols</title>
      <p id="Par8">We first tested scDREAMER’s ability to perform integration and batch correction across different sequencing protocols using a human pancreas dataset consisting of 16,382 cells (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1a)</xref>. The dataset consisted of nine sub-datasets generated using distinct sequencing protocols including CEL-seq, CEL-seq2, Fluidigm C1, SMART-seq2, and inDrop. The dataset harbored 14 pancreatic cell types including acinar cells, activated and quiescent stellate cells, alpha cells, beta cells, delta cells, ductal cells, endothelial cells, epsilon cells, gamma cells, macrophages, mast cells, Schwann cells and T cells. scDREAMER’s integration performance was compared against that of nine other integration methods. scDREAMER was able to almost perfectly separate all the cell types and mix the shared cell types across different protocols (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a, b). In comparison, integration by scVI, BBKNN, Scanorama, INSCT, and iMAP led to restricted mixing of the different batches (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1b–j)</xref>. While Harmony, Seurat, scDML and LIGER were also able to mix the batches well, Harmony was not able to clearly distinguish activated and quiescent stellate cells, Seurat improperly mixed some alpha cells with beta and ductal cells, scDML fragmented alpha and beta cells into multiple clusters and mixed some alpha cells with ductal and acinar cells, and LIGER mixed some alpha, beta, and gamma cells.<fig id="Fig2"><label>Fig. 2</label><caption><title>Integration of pancreatic islet data.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after integration of pancreatic islet dataset. Different colors denote different pancreatic cell types. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on batch information. Comparison of <bold>c</bold> composite bio-conservation score, <bold>d</bold> composite batch-correction score and <bold>e</bold> combined composite score metrics between scVI, Harmony, Seurat, BBKNN, Scanorama, INSCT, LIGER, iMAP, scDML and scDREAMER. <bold>f</bold> Comparison of composite isolated label scores to assess how well rare cell types are identified. <bold>g</bold> Comparison of iLISI and cLISI values. Each box-and-whisker plot summarizes LISI values (<italic>n</italic> = 8208 cells, ~50% of the cells in the dataset as suggested in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup>), the box denotes the interquartile range (IQR, the range between the 25th and 75th percentile) with the median value, whiskers indicate the maximum and minimum value within 1.5 times the IQR, outliers are denoted by black circles. <bold>h</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>i</bold> Quantitative assessment of batch-mixing of scDREAMER against LIGER and Harmony based on the percentage of positive vs true positive cells. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig2_HTML" id="d32e619"/></fig></p>
      <p id="Par9">Next, we quantitatively compared scDREAMER’s performance against that of the other methods based on four composite accuracy scores. Composite bio-conservation score measures the accuracy of a method in preserving biological variance after integration and considers global clustering accuracy (normalized mutual information (NMI) and Adjusted Rand Index (ARI)) and relative distances between clusters (cell type average silhouette width (ASW)). The accuracy of batch effect removal was measured using a composite batch-correction score which considers four different metrics including the k-nearest-neighbor batch effect test (kBET), ASW across batches, k-nearest-neighbor (kNN) graph connectivity and batch removal using PCA regression. The combined composite score computes the average of composite bio-conservation and composite batch-correction scores. We also used a composite isolated label score that evaluates the ability of a method to capture rare cell identities based on f1 score and silhouette coefficient in identifying the rare cells.</p>
      <p id="Par10">scDREAMER consistently outperformed all other methods by achieving the highest combined composite score (~12.9% improvement over the second-best method) which was driven by scDREAMER’s superior performance in both conservation of biological variance and batch correction (Fig. <xref rid="Fig2" ref-type="fig">2</xref>c–e). While scVI and Harmony performed similar to scDREAMER in terms of NMI and ARI metrics, scDREAMER, scDML and Harmony performed better in terms of cell type ASW (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a)</xref>. scDREAMER achieved the best composite batch-correction score because of its superior performance in terms of multiple batch-correction metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3b)</xref>. scDREAMER also performed well in capturing the rare cell identities as it achieved the second-best isolated f1 score (Fig. <xref rid="Fig2" ref-type="fig">2</xref>f, Supplementary Fig. <xref rid="MOESM1" ref-type="media">2c)</xref>. While Harmony was the second-best method in terms of the combined composite score, it performed poorly in terms of composite isolated label score indicating its inability to capture the rare cell identities correctly. We also measured the local inverse Simpson’s Index scores (iLISI for batch mixing and cLISI for cell-type separation) at the single-cell level and based on these metrics, scDREAMER’s performance was comparable to that of Harmony and Seurat and better than all other methods (Fig. <xref rid="Fig2" ref-type="fig">2</xref>g). We further adopted another single-cell level evaluation measure which computes the proportion of “positive” (cells connected to other cells only from the same cell type) and “true positive” (fraction of positive cells whose local and global batch distributions are congruous) cells after integration and used these summary metrics to compare scDREAMER’s performance against that of Harmony (second-best method in terms of combined composite score) and scDML (best method in terms of isolated label score). Again, scDREAMER outperformed both Harmony and scDML based on the proportion of positive and true positive cells (Fig. <xref rid="Fig2" ref-type="fig">2</xref>h, i).</p>
      <p id="Par11">To determine scDREAMER’s ability to capture novel cell types, we performed two experiments where a specific cell type (alpha and delta cells respectively) was held out during training and the trained network was later used to obtain their embeddings. For both the held-out cell types, scDREAMER captured them very well in a separate cluster (also indicated by high values of composite bio-conservation and batch correction score for the held-out cell type) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a–c)</xref> and as scDREAMER’s network weights got updated after including the held-out cell type in training for certain epochs, their representation further improved as indicated by an improvement in the combined composite score (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3c)</xref>.</p>
    </sec>
    <sec id="Sec5">
      <title>scDREAMER integrates lung cells obtained from different human donors</title>
      <p id="Par12">Next, we applied scDREAMER for the integration of lung atlas data consisting of 32,472 cells from lung transplant and biopsy samples from 16 donors sequenced using 10X and drop-seq (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a)</xref>. The integration of this dataset poses several challenges including inter-donor variability, protocol-specific batch effects (10X samples A1-A6, 1-6; drop-seq samples B1-B4), and variability across sampling type and tissue locations. Specifically, cell type composition varied between the transplant samples (1-6, B1-B4) that are obtained from lung parenchyma and the biopsy samples (A1-A6) obtained from lung airways. Two basal cell types, ciliated and secretory cells were majorly present in the biopsy samples but the transplant samples harbored them only as minor populations or in some cases the cell types were absent. The dataset also contained rare cell types present across a few donors (ionocytes). Furthermore, the endothelial and secretory cells should vary across biopsy and transplant samples due to transcriptome being affected by tissue location.</p>
      <p id="Par13">scDREAMER was able to successfully integrate the batches across sequencing protocols overcoming donor-level variation (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a, b, Supplementary Fig. <xref rid="MOESM1" ref-type="media">5a, b)</xref>. Only scDREAMER, scVI, and iMAP were clearly able to identify rare ionocytes as a separate cluster, whereas the other methods mixed them with other cell types (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a, Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b–j)</xref>. scDREAMER was able to identify all biopsy-specific cell types and also preserved basal cell subtypes. The secretory cells from the biopsy and transplant samples were separated by scDREAMER (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a). The lymphatic and endothelial cells were incorrectly merged by Harmony, Seurat and INSCT whereas Scanorama, scVI, LIGER and scDREAMER were able to identify them as separate clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b–j)</xref>. The endothelial cells were separated into three clusters by Scanorama, two of which corresponded to transplant samples indicating incomplete integration of these samples. Integration of iMAP was poor as it divided multiple cell types (e.g., macrophages, endothelial cells, etc.) into different batch-specific clusters. Integration by scDML also led to the merging of some cell types (macrophages, basal 1 and 2, dendritic cells) and fragmentation of the same cell type (T/NK cells, Type 2 cells) into multiple clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4j)</xref>. scDREAMER was able to preserve the spatial variation of endothelial cells at a higher resolution.<fig id="Fig3"><label>Fig. 3</label><caption><title>Integration of lung atlas data.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after integration of lung atlas dataset. Different colors denote different lung cell types. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>c</bold> composite bio-conservation score, <bold>d</bold> composite batch-correction score and <bold>e</bold> combined composite score metrics between scVI, Harmony, Seurat, BBKNN, Scanorama, INSCT, LIGER, iMAP, scDML and scDREAMER for the integration of lung atlas data. <bold>f</bold> Comparison of composite isolated label scores to assess how well rare cell types are identified. <bold>g</bold> Comparison of iLISI and cLISI values. Each box-and-whisker plot summarizes LISI values (<italic>n</italic> = 16,274 cells, ~50% of the cells in the dataset as suggested in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup>), the box denotes the interquartile range (IQR, the range between the 25th and 75th percentile) with the median value, whiskers indicate the maximum and minimum value within 1.5 times the IQR, outliers are denoted by black circles. <bold>h</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>i</bold> Quantitative assessment of batch-mixing of scDREAMER against scVI and Harmony based on the percentage of positive vs true positive cells. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig3_HTML" id="d32e727"/></fig></p>
      <p id="Par14">scDREAMER performed superior to all other methods in terms of both bio-conservation and batch correction achieving the highest combined composite score (Fig. <xref rid="Fig3" ref-type="fig">3</xref>c–e). scDREAMER outperformed all the methods in terms of all three bio-conservation metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a)</xref> and also performed well in terms of different batch correction metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b)</xref>. In capturing rare cell identities, scDREAMER performed comparably with the top-performing methods (Fig. <xref rid="Fig3" ref-type="fig">3</xref>f, Supplementary Fig. <xref rid="MOESM1" ref-type="media">6c)</xref> achieving the highest isolated f1 score. In terms of LISI metrics, scDREAMER performed the best in terms of cLISI and comparably to scVI and Harmony in terms of iLISI metrics outperforming all other methods (Fig. <xref rid="Fig3" ref-type="fig">3</xref>g). We further compared scDREAMER’s performance against that of scVI and Harmony (second and third-best methods based on combined composite score respectively) by measuring the proportion of positive and true positive cells. Due to the close spacing of dendritic cells and Neutrophil subtypes in the embedding, we observed the presence of a large number of negative cells for these cell types (same observation for the embedding of other methods). While scVI had the highest proportion of positive cells, scDREAMER outperformed both methods based on the proportion of true positive cells (Fig. <xref rid="Fig3" ref-type="fig">3</xref>h, i) without sacrificing much in terms of positive proportion.</p>
    </sec>
    <sec id="Sec6">
      <title>scDREAMER integrates human immune cells from peripheral blood and bone marrow of different donors</title>
      <p id="Par15">We next evaluated scDREAMER’s integration and batch correction performance for integrating 33,506 human immune cells obtained in ten batches corresponding to different donors and the cells were sampled from bone marrow and peripheral blood (PBMCs) and the sequencing was performed using two protocols (10X and smart-seq2) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7a)</xref>. Out of 33,506 cells, 9581 cells were sampled from bone marrow and comprised of three batches (Oetjen et al.<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>), and the rest 23,985 bone marrow cells comprised of seven batches (10X Genomics<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>, Freytag<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>, Sun et al.<sup><xref ref-type="bibr" rid="CR28">28</xref></sup> batches and Villani et al.<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>). While the cells in ref. <sup><xref ref-type="bibr" rid="CR29">29</xref></sup> were sequenced using smart-seq2, all other batches were sequenced using 10X Genomics protocol. This integration task poses several challenges including donor-level variability, sequencing protocol-specific batch effects, and cell types spanning multiple tissues. In addition, the dataset also contained cell subtypes that are difficult to distinguish because of transcriptional similarity (e.g., CD8<sup>+</sup> and CD4<sup>+</sup> T cells; CD14<sup>+</sup> and CD16<sup>+</sup> monocytes) and some tissue-specific cell types (e.g., monocyte progenitors, erythroid progenitors, erythrocytes and CD10<sup>+</sup> B cells were only present in bone marrow) that need to be identified as separate clusters. Finally, the dataset also harbored the developmental trajectory of erythrocytes from hematopoietic stem and progenitor cells (HSPCs) via megakaryocyte and erythroid progenitors and the conservation of this trajectory across batches is an important aspect of this integration task.</p>
      <p id="Par16">scDREAMER was able to resolve the inter-sample and inter-platform batch effects while integrating the human immune dataset as indicated by disjoint well-mixed cell type clusters (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a, b). scDREAMER was successful in clustering together the same cell types across tissues while identifying cell subtypes, such as CD8<sup>+</sup> and CD4<sup>+</sup> T cells, CD20<sup>+</sup> and CD10<sup>+</sup> B cells, CD14<sup>+</sup> and CD16<sup>+</sup> monocytes, as distinct closely located clusters. In comparison, CD20<sup>+</sup> and CD10<sup>+</sup> B cells were distantly placed in BBKNN and Scanorama embeddings (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7e, f)</xref> and CD20<sup>+</sup> B cells were fragmented into two clusters in scDML embeddings (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7j)</xref>. While scDREAMER was able to place monocyte-derived dendritic cells and plasmacytoid dendritic cells in separate clusters in close vicinity (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a, b), other methods such as Harmony, Seurat, scDML and INSCT (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7c, d, g)</xref> placed these cell subtypes far apart in the embedding. Furthermore, scVI separated monocyte-derived dendritic cells into multiple clusters, one of which was mixed with other distinct cell types (e.g., megakaryocyte progenitors, plasma cells, CD4<sup>+</sup> T cells, etc.) indicating poor clustering (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7b)</xref>. Finally, scDREAMER clearly separated tissue-specific cell types and exhibited a perfect continuum of bone marrow cell types after integration, preserving the trajectory from HSPCs to erythrocytes (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a, b, Supplementary Fig. <xref rid="MOESM1" ref-type="media">8a, b)</xref>. In contrast, methods such as Seurat, INSCT, LIGER and scDML (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7d, g, h, j)</xref> failed to conserve the trajectory of erythrocyte development, whereas, iMAP divided the erythroid trajectory into three batch-specific trajectories (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7i)</xref>.<fig id="Fig4"><label>Fig. 4</label><caption><title>Integration of human immune data.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after integration of human immune dataset. Different colors denote different cell types present in the human immune dataset. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>c</bold> composite bio-conservation score, <bold>d</bold> composite batch-correction score and <bold>e</bold> combined composite score metrics between scVI, Harmony, Seurat, BBKNN, Scanorama, INSCT, LIGER, iMAP, scDML and scDREAMER for the integration of human immune data. <bold>f</bold> Comparison of composite isolated label scores to assess how well rare cell types are identified. <bold>g</bold> Comparison of iLISI and cLISI values. Each box-and-whisker plot summarizes LISI values (<italic>n</italic> = 16,754 cells, ~50% of the cells in the dataset as suggested in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup>), the box denotes the interquartile range (IQR, the range between the 25th and 75th percentile) with the median value, whiskers indicate the maximum and minimum value within 1.5 times the IQR, outliers are denoted by black circles. <bold>h</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>i</bold> Quantitative assessment of batch-mixing of scDREAMER against scVI and Harmony based on the percentage of positive vs true positive cells. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig4_HTML" id="d32e892"/></fig></p>
      <p id="Par17">Our quantitative comparison showed that scDREAMER consistently outperformed all other methods by achieving the highest combined composite score (15.5% improvement over the second-best method) which was driven by scDREAMER’s superior performance in both biological conservation and batch correction (Fig. <xref rid="Fig4" ref-type="fig">4</xref>c–e). scDREAMER was the best-performing method in terms of kBET, and two bio-conservation metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">9a, b)</xref>. In capturing the rare cell identities, scDREAMER also performed at par with scVI and Scanorama, the top-performing methods in terms of composite isolated label scores (Fig. <xref rid="Fig4" ref-type="fig">4</xref>f, Supplementary Fig. <xref rid="MOESM1" ref-type="media">9c)</xref>. However, for batch correction, scVI and Scanorama performed poorly. In terms of LISI metrics, scDREAMER along with scVI and Harmony consistently performed better than other methods (Fig. <xref rid="Fig4" ref-type="fig">4</xref>g). We further compared scDREAMER’s performance against that of Harmony and scVI (second and third-best methods based on combined composite score respectively) by measuring the proportion of positive and true positive cells. While both scDREAMER and scVI had a comparable proportion of positive cells better than Harmony, scDREAMER outperformed both methods by a large margin based on the proportion of true positive cells (Fig. <xref rid="Fig4" ref-type="fig">4</xref>h, i).</p>
      <p id="Par18">Finally, to evaluate scDREAMER’s ability in uncovering unique biological insights, we focused on a more in-depth analysis of the dendritic cell populations after integration. Based on scRNA-seq and functional studies, Villani et al.<sup><xref ref-type="bibr" rid="CR29">29</xref></sup> characterized six different subtypes of dendritic cells—DC1 (CLEC9A<sup>+</sup>), DC2 (non-inflammatory CD1C<sup>+</sup>), DC3 (inflammatory CD1C<sup>+</sup>), DC4 (CD141<sup>−</sup>CD1C<sup>−</sup>), DC5 (AXL<sup>+</sup>), and DC6 (pDCs). Through subclustering and marker gene expression analysis, we wanted to find out if an integration method was able to separate these DC subtypes after the integration of multiple batches. scVI performed poorly in identifying the DCs as a separate cluster, the optimal clustering of scVI embeddings (considering all cells) revealed that DC1 cells were clustered with CD20<sup>+</sup> B cells and DC2 and DC3 cells were clustered with CD14<sup>+</sup> monocytes (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10a)</xref>. Given its inability to identify the dendritic cells as a separate cluster, we did not perform any subclustering. In comparison, scDREAMER and Harmony were able to identify the dendritic cells as separate clusters. Subclustering of scDREAMER-inferred dendritic cell embeddings resulted in seven clusters each of which corresponded to distinct DC subtypes (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10b)</xref>. Clusters 0 and 1 contained DC2 and DC3 cells, clusters 2 and 3 contained pDCs whereas clusters 4, 5, and 6 contained DC1, DC4, and DC5 respectively. Thus, scDREAMER was able to identify 4 (out of 6) DC subtypes as separate clusters. In comparison, optimal subclustering of Harmony embeddings of DCs revealed 4 clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10c)</xref>, out of which only two clusters corresponded to DC4 and pDCs. Harmony failed to properly distinguish other DC subtypes—DC2 and DC3 cells were mixed with DC4 cells, whereas, DC1 and DC5 cells were present across multiple clusters.</p>
    </sec>
    <sec id="Sec7">
      <title>scDREAMER-Sup utilizes available cell type labels for improved conservation of biological knowledge</title>
      <p id="Par19">Next, we evaluated scDREAMER-Sup’s ability to leverage the available cell type labels for improved integration on lung atlas and human immune datasets as these integration tasks were the most challenging. We compared scDREAMER-Sup’s performance against that of scANVI<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> and scGEN<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>, state-of-the-art supervised methods (also top performers in recent benchmarking<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>) that utilize cell type labels. scDREAMER-Sup was able to capture all the cell types in distinct clusters for both integration tasks improving upon the performance of scDREAMER. Particularly, for lung atlas integration, scDREAMER-Sup was able to separate two neutrophil subtypes which were merged by all unsupervised methods (Fig. <xref rid="Fig5" ref-type="fig">5</xref>a, b). In comparison, integration by scANVI led to restricted separation of Macrophage and dendritic cells, and merging of neutrophil subtypes while scGEN mixed some B cells and T/NK cells as well as some ciliated and secretory cells (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11a–d)</xref>. In addition, B cells and secretory cells were fragmented in multiple closely located clusters by scANVI. When integrating human immune data, scGEN and scANVI could not properly separate CD14<sup>+</sup> and CD16<sup>+</sup> monocytes as well as NK cells and NKT cells (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11e–h)</xref>. scDREAMER-Sup was able to identify these cell subtypes as disjoint clusters (Fig. <xref rid="Fig5" ref-type="fig">5</xref>i, j).</p>
      <p id="Par20">We further quantitatively evaluated the performance of scDREAMER-Sup for both supervised (cell type labels available for all cells) as well as semi-supervised settings (cell type labels available for a fraction of cells). To evaluate the integration methods in semi-supervised settings, we uniformly randomly removed cell type labels for a percentage of cells from all the cell types while we varied the percentage of missing labels (10, 20, and 50%). For both datasets across all experimental settings, scDREAMER-Sup outperformed other methods based on combined composite (25–40% improvement over next best method), composite bio-conservation (14–33% improvement over next best method), and composite batch-correction scores (21–49% improvement over next best method) (Fig. <xref rid="Fig5" ref-type="fig">5</xref>c–e, k–m). It is important to note that for both datasets, scDREAMER-Sup also outperformed all the unsupervised methods (scDREAMER was the best unsupervised method for both datasets) in terms of both bio-conservation (84.61–113.33% improvement over best unsupervised method) and batch-correction (16.05–19.72% improvement over best unsupervised method). With an increase in the percentage of missing labels, we observed a sharp drop in scGEN’s composite bio-conservation score which is indicative of the fact that scGEN requires labels for all cells and cannot account for missing cell type labels. In comparison, the performance of scDREAMER-Sup and scANVI were more robust to missing cell type labels with scDREAMER-Sup outperforming scANVI by a large margin in terms of all composite scores.</p>
      <p id="Par21">scDREAMER-Sup’s superior performance was driven by top scores in multiple bio-conservation (NMI, ARI, ASW) (Supplementary Figs. <xref rid="MOESM1" ref-type="media">12a</xref> and <xref rid="MOESM1" ref-type="media">13a)</xref> and batch-correction metrics (kBET, graph connectivity, and ASW label/batch) (Supplementary Figs. <xref rid="MOESM1" ref-type="media">12b</xref> and <xref rid="MOESM1" ref-type="media">13b)</xref> across the integration tasks and experimental settings. scDREAMER-Sup was further able to capture rare cell identities very well as indicated by its top performance in terms of isolated f1 score (Supplementary Figs. <xref rid="MOESM1" ref-type="media">12c</xref> and <xref rid="MOESM1" ref-type="media">13c)</xref>. scDREAMER-Sup further outperformed the other methods in terms of LISI metrics (Fig. <xref rid="Fig5" ref-type="fig">5</xref>f, n) across the experimental settings. Furthermore, we compared the methods by measuring the proportion of positive and true positive cells for each experimental setting. For both supervised and semi-supervised settings, scDREAMER-Sup outperformed the other two methods by achieving a higher proportion of positive and true positive cells (Fig. <xref rid="Fig5" ref-type="fig">5</xref>g, o). Since both scDREAMER-Sup and scANVI can predict the labels of the cells for which cell type annotations are missing, we also compared the accuracy of the cell label prediction for these two methods. For all the semi-supervised settings with 10, 20 and 50% cells missing labels for both the datasets, scDREAMER-Sup achieved high accuracy (Macro F1-score 0.86–0.9) in predicting the cell type labels and outperformed scANVI (10–14% and 23–33% improvement over scANVI for lung atlas and human immune dataset, respectively) (Fig. <xref rid="Fig5" ref-type="fig">5</xref>h, p).<fig id="Fig5"><label>Fig. 5</label><caption><title>scDREAMER-Sup utilizes cell type labels to improve bio-conservation.</title><p><bold>a</bold> Visualization of scDREAMER-Sup’s latent space embeddings after integration of lung atlas dataset. Different colors denote different lung cell types. <bold>b</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>c</bold> composite bio-conservation score, <bold>d</bold> composite batch-correction score, <bold>e</bold> combined composite score metrics, <bold>f</bold> iLISI and cLISI values between scGEN, scANVI, and scDREAMER-Sup for different percentages of missing cell type labels for lung atlas dataset. <bold>g</bold> Quantitative assessment of batch-mixing of scDREAMER-Sup against scANVI and scGEN based on the percentage of positive vs true positive cells for lung atlas dataset. <bold>h</bold> Comparison of cell label prediction accuracy between scDREAMER-Sup and scANVI for different percentages of missing cell type labels for the lung atlas dataset. <bold>i</bold> Visualization of scDREAMER-Sup’s latent space embeddings after integration of human immune dataset. Different colors denote different lung cell types. <bold>j</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>k</bold> composite bio-conservation score, <bold>l</bold> composite batch-correction score, <bold>m</bold> combined composite score metrics, <bold>n</bold> iLISI and cLISI values between scGEN, scANVI, and scDREAMER-Sup for different percentages of missing cell type labels for the human immune dataset. <bold>o</bold> Quantitative assessment of batch-mixing of scDREAMER-Sup against scANVI and scGEN based on the percentage of positive vs true positive cells for the human immune dataset. <bold>p</bold> Comparison of cell label prediction accuracy between scDREAMER-Sup and scANVI for different percentages of missing cell type labels for the human immune dataset. For (<bold>f</bold>) and (<bold>n</bold>), each box-and-whisker plot summarizes LISI values for 50% of the cells in the datasets as suggested in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup> ((<bold>f</bold>) <italic>n</italic> = 16,260 cells, (<bold>n</bold>) <italic>n</italic> = 16,770 cells), the box denotes the interquartile range (IQR, the range between the 25th and 75th percentile) with the median value, whiskers indicate the maximum and minimum value within 1.5 times the IQR, outliers are denoted by black circles. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig5_HTML" id="d32e1095"/></fig></p>
    </sec>
    <sec id="Sec8">
      <title>scDREAMER outperforms other methods in integrating a large number of batches with complex batch effects</title>
      <p id="Par22">We next evaluated scDREAMER’s (both unsupervised and semi-supervised) integration and batch correction on large number of batches (also large number of cells) using a human heart atlas dataset consisting of 486,134 cells spanning six heart regions namely apex, left atrium, left ventricle, right atrium, right ventricle, and septum (<ext-link ext-link-type="uri" xlink:href="https://www.heartcellatlas.org/">https://www.heartcellatlas.org/</ext-link>,<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>). All tissues were from transplant donors without a history of cardiac disease or arrhythmia. The cells were obtained in 147 batches corresponding to different donors, sequential protocols, race, gender, age range, and death-type conditions. In the original study<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>, a total of 452,136 cells were assigned to 12 major cardiac cell types using state-of-the-art machine learning methods, and the remaining 33,998 cells were not assigned any cell type label (Supplementary Fig. <xref rid="MOESM1" ref-type="media">14a)</xref>. In our analyses, we used all the cells for integration but the cells with available cell type labels were used for the evaluation. Only the available cell type labels were used for training supervised methods making it a semi-supervised integration task for them. Apart from a large number of batches, the integration task posed several challenges including variability across human donors with different genders (~55% and ~45% from male and female donors, respectively), race (93% and 6% cells from donors of Caucasian and Asian descent, respectively), and age group (spanning the age range of 40–75 years), sequencing protocol-specific batch effects, and cell types spanning different death-type conditions (265,554 cells (~40 batches) were sampled from the heart in case of circulatory death, and the rest 220,580 cells (~100 batches) were sampled from the heart in case of brain death). Furthermore, the dataset contained skewed cell type distribution, i.e., ~50 batches did not have any cell corresponding to Ventricular Cardiomyocyte and Fibroblast resulting in a multi-faceted challenging integration problem.</p>
      <p id="Par23">Among the unsupervised methods, Seurat, LIGER, scDML and iMAP failed to integrate this dataset given their huge memory requirement (tested on 512 GB memory) or inability to handle such a large number of batches. Most of the other methods that could integrate this dataset led to the mixing of atrial and ventricular cardiomyocytes given their similarity. BBKNN and Scanorama fragmented many cell types into multiple clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">14d, e)</xref>. scVI, Harmony, and scDREAMER were able to capture most cell types into distinct clusters (Fig. <xref rid="Fig6" ref-type="fig">6</xref>a, b, Supplementary Fig. <xref rid="MOESM1" ref-type="media">14b, c)</xref>. However, scVI and Harmony also led to the fragmentation of smooth muscle cells and poor batch correction for Lymphoid cells. In comparison, supervised methods were able to better capture the different cell types in distinct clusters by leveraging the available cell type labels (Fig. <xref rid="Fig6" ref-type="fig">6</xref>c, d, Supplementary Fig. <xref rid="MOESM1" ref-type="media">14g, h)</xref>. However, scANVI still failed to separate atrial and ventricular cardiomyocytes (Supplementary Fig. <xref rid="MOESM1" ref-type="media">14h)</xref>. In addition, scANVI also fragmented smooth muscle cells into multiple clusters. On the other hand, scGEN poorly handled the unassigned cells given its inability to handle missing cell type labels (Supplementary Fig. <xref rid="MOESM1" ref-type="media">14g)</xref>. scDREAMER-Sup was able to resolve the complex batch effects while integrating heart cells as indicated by disjoint well-mixed cell type clusters (Fig. <xref rid="Fig6" ref-type="fig">6</xref>c, d). Both scDREAMER and scDREAMER-Sup were able to mix the cells well across tissues, protocols, donors, genders, age groups, and death-type conditions (Supplementary Fig. <xref rid="MOESM1" ref-type="media">15)</xref>.<fig id="Fig6"><label>Fig. 6</label><caption><title>scDREAMER integrates heart atlas cells from a large number (147) of batches.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after the integration of 147 batches. Different colors denote different cell types in this large dataset consisting of ~0.5 million cells. ‘NotAssigned’ represents the cells without any cell type assignment. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on the batch information. <bold>c</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on cell types. <bold>d</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>e</bold> composite bio-conservation score, <bold>f</bold> composite batch-correction score, and <bold>g</bold> combined composite score metrics between unsupervised (scVI, Harmony, Seurat, Scanorama, INSCT, scDREAMER) and supervised (scGEN, scANVI, and scDREAMER-Sup) methods. Comparison of <bold>h</bold> composite bio-conservation score, <bold>i</bold> composite batch-correction score, and <bold>j</bold> combined composite score metrics between scGEN, scANVI and scDREAMER-Sup for different percentages of missing cell type labels for the heart atlas dataset. <bold>k</bold> Comparison of cell label prediction accuracy between scDREAMER-Sup and scANVI for different percentages of missing cell type labels for the heart atlas dataset. <bold>l</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>m</bold> Quantitative assessment of batch-mixing of scDREAMER against that of scVI and Harmony based on the percentage of positive vs. true positive cells. <bold>n</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>o</bold> Quantitative assessment of batch-mixing of scDREAMER-Sup against that of scANVI and scGEN based on the percentage of positive vs. true positive cells for the heart atlas dataset. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig6_HTML" id="d32e1199"/></fig></p>
      <p id="Par24">Quantitative analyses showed that scDREAMER performed the best among the unsupervised methods based on the combined composite score (25% improvement over the second-best method) which was driven by scDREAMER’s superior performance in batch correction (~50% improvement over the second-best method) as well as good performance in bio-conservation (Fig. <xref rid="Fig6" ref-type="fig">6</xref>e–g, Supplementary Fig. <xref rid="MOESM1" ref-type="media">16)</xref>. We could not include BBKNN in the comparison of the composite scores due to the unavailability of the majority of the metrics. However, scDREAMER outperformed BBKNN on both bio-conservation metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17a)</xref>. Moreover, we could run scDML on this dataset after the removal of 7 batches as suggested in ref. <sup><xref ref-type="bibr" rid="CR33">33</xref></sup> and in integrating the remaining 140 batches, scDREAMER outperformed scDML in terms of most of the metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17b)</xref>. Among the supervised methods, scDREAMER-Sup achieved the best combined composite score (11.5% improvement over the second-best supervised method and 26% improvement over the best unsupervised method (Fig. <xref rid="Fig6" ref-type="fig">6</xref>e–g)). We further evaluated scDREAMER-Sup’s performance in semi-supervised settings with 20 and 50% missing labels. In both settings, scDREAMER-Sup significantly outperformed scANVI and scGEN in both bio-conservation and batch correction (32–57% improvements, Fig. <xref rid="Fig6" ref-type="fig">6</xref>h–j, Supplementary Fig. <xref rid="MOESM1" ref-type="media">18a, b)</xref>. scGEN’s performance dropped sharply with an increase in the percentage of missing labels. scDREAMER-Sup and scANVI were robust to missing cell type labels with scDREAMER-Sup outperforming scANVI by a large margin in terms of all composite scores. Isolated label scores could not be computed for this dataset due to the sheer imbalance of batch sizes. We also compared the accuracy of the cell label prediction for scDREAMER-Sup and scANVI. For both the semi-supervised settings with 20 and 50% cells missing labels, scDREAMER-Sup achieved very high accuracy (macro F1-score 0.97) in predicting the cell type labels and outperformed scANVI (11.49% improvement over scANVI) (Fig. <xref rid="Fig6" ref-type="fig">6</xref>k). We further compared scDREAMER’s performance against that of Harmony and scVI (second and third-best unsupervised methods based on combined composite scores respectively) by measuring the proportion of positive and true positive cells. While all three methods had a comparable proportion of positive cells, scDREAMER outperformed both methods by a large margin based on the proportion of true positive cells (Fig. <xref rid="Fig6" ref-type="fig">6</xref>l, m). Finally, we compared the supervised methods by measuring the proportion of positive and true positive cells for each experimental setting. For all experimental settings, scDREAMER-Sup outperformed the other two methods by achieving a higher proportion of positive and true positive cells (Fig. <xref rid="Fig6" ref-type="fig">6</xref>n, o).</p>
      <p id="Par25">We further analyzed a macaque retina bipolar cells dataset consisting of 30,302 cells that originated from the fovea or periphery of the retina and consisted of 30 batches across macaques and regions. The original study showed that several integration methods failed to remove batch effects from this dataset<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>. Both scDREAMER and scDREAMER-Sup successfully integrated all 30 batches while separating the distinct cell types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">19)</xref>. In contrast, many other methods mixed some distinct cell types or fragmented same cell type into multiple clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">20)</xref>. Based on quantitative analyses also, scDREAMER-Sup was the best performer among all unsupervised and supervised methods in terms of multiple bio-conservation and batch correction metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">21)</xref>. Among the unsupervised methods, scDREAMER was the best performer based on NMI, ARI and kBET and performed comparably on all other metrics except ASW label. scDREAMER-Sup was also superior in identifying the rare cell types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">21)</xref>.</p>
    </sec>
    <sec id="Sec9">
      <title>scDREAMER robustly integrates millions of cells across different species</title>
      <p id="Par26">We finally evaluated scDREAMER’s ability to perform atlas-level integration across species using a dataset consisting of ~1 million cells from human and mouse profiled by the Human Cell Landscape (HCL)<sup><xref ref-type="bibr" rid="CR35">35</xref></sup> and Mouse Cell Atlas (MCA)<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> projects respectively. The two batches in the dataset correspond to HCL and MCA respectively. The dataset harbored 97 different cell types which had minimal overlap across the atlases (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22a)</xref>. The HCL batch comprised 599,926 cells from 63 different cell types whereas the mouse cell atlas comprised 333,778 cells from 52 different cell types. A total of 18 cell types (among the 97 cell types) were common between these two atlases. We have demonstrated scDREAMER’s scalability over a million cells and versatility in integration with this atlas-level integration task.</p>
      <p id="Par27">For this atlas-level integration task, the performance of scDREAMER and scDREAMER-Sup was compared with that of eight other unsupervised methods (scVI, Scanorama, Harmony, INSCT, BBKNN, LIGER, iMAP and scDML) and two supervised methods (scGEN and scANVI). Due to the size of the dataset, Seurat ran into memory issues. Qualitatively, we can observe that clusters by scDREAMER were better separated compared to other methods (Fig. <xref rid="Fig7" ref-type="fig">7</xref>a, b, Supplementary Fig. <xref rid="MOESM1" ref-type="media">22b–i)</xref>. scDREAMER was able to clearly distinguish some of the major cell types such as neutrophil cells, erythroid cells, fetal stromal cells and oligodendrocyte cells (Fig. <xref rid="Fig7" ref-type="fig">7</xref>a). While scVI could cluster some of these cell types such as neutrophil, erythroid and fetal stromal cells well, harmony could only cluster erythroid cells. In Harmony embeddings, similar cell types were disjointly present in multiple clusters. On the other hand, BBKNN and LIGER led to the complete mixing of multiple cell types. While Scanorama was able to better classify than BBKNN and Harmony, it was not able to properly mix the batches (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22e)</xref>. iMAP was also not able to mix the batches properly (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22h)</xref>. scDML mixed multiple cell types and fragmented some of the cell types into multiple clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22i)</xref>. Among the supervised methods, scDREAMER-Sup and scANVI led to better-separated clusters, whereas scGEN was not able to cluster the cell types properly (Fig. <xref rid="Fig7" ref-type="fig">7</xref>c, d, Supplementary Fig. <xref rid="MOESM1" ref-type="media">22j, k)</xref>.<fig id="Fig7"><label>Fig. 7</label><caption><title>scDREAMER enables robust integration of millions of cells across species.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after the integration of human (HCL) and mouse cells (MCA). Different colors denote different cell types in this large dataset consisting of ~1 million cells. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on the batch information. <bold>c</bold> Visualization of scDREAMER-Sup’s latent space embeddings after the integration of human (HCL) and mouse cells (MCA). Different colors denote different cell types. <bold>d</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>e</bold> composite bio-conservation score, <bold>f</bold> composite batch-correction score and <bold>g</bold> combined composite score metrics between scVI, Harmony, Seurat, BBKNN, Scanorama, INSCT, LIGER, iMAP, scDML, scDREAMER, scGEN, scANVI and scDREAMER-Sup for the integration of HCL and MCA cells. <bold>h</bold> Quantitative assessment of batch-mixing of scDREAMER against that of scVI, Scanorama and LIGER based on the percentage of positive vs true positive cells. <bold>i</bold> Quantitative assessment of batch-mixing of scDREAMER-Sup against that of scGEN and scANVI based on the percentage of positive vs true positive cells. <bold>j</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>k</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>l</bold> Comparison of scDREAMER runtime against that of scVI and INSCT across four different scRNA datasets consisting of 10k, 100k, 500k, and 1M cells subsampled from the cross-species integration dataset. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig7_HTML" id="d32e1341"/></fig></p>
      <p id="Par28">In quantitative comparison, scDREAMER achieved the best combined composite score among all the unsupervised methods (26.9% better than the second-best unsupervised method) and was even better than the supervised methods scANVI and scGEN, whereas overall, scDREAMER-Sup had the best combined composite score (8.75% better than that of scDREAMER) (Fig. <xref rid="Fig7" ref-type="fig">7</xref>e–g). While scDREAMER was the best batch correction method, scDREAMER-Sup achieved the best bio-conservation (best in terms of all bio-conservation metrics) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">23)</xref>. We further compared scDREAMER’s performance against that of scVI (second-best unsupervised method), Scanorama and LIGER (third-best unsupervised method) and scDREAMER-Sup’s performance against that of scGEN and scANVI by measuring the proportion of positive and true positive cells (Fig. <xref rid="Fig7" ref-type="fig">7</xref>h–k). scDREAMER outperformed Scanorama and LIGER based on the proportion of positive cells and all the unsupervised methods based on the proportion of true positive cells (Fig. <xref rid="Fig7" ref-type="fig">7</xref>h). On the other hand, based on both the proportion of positive and true positive cells, scDREAMER-Sup outperformed scGEN and scANVI by a large margin. (Fig. <xref rid="Fig7" ref-type="fig">7</xref>i).</p>
      <p id="Par29">To assess scDREAMER’s scalability with the number of cells, we measured the runtime of scDREAMER on different datasets subsampled from the atlas-integration dataset and compared the runtime against that of scVI and INSCT—two other neural network-based methods. For most of the subsampled datasets, scDREAMER outperformed the other two methods based on runtime and exhibited higher scalability with the number of cells (Fig. <xref rid="Fig7" ref-type="fig">7</xref>l). For the complete dataset consisting of ~1 million cells, training scDREAMER took only ~130 s per epoch as compared to ~154 s per epoch for scVI and ~172 s per epoch for INSCT (on a server with one Nvidia Quadro RTX 5000 GPU). We further compared the total runtime of different methods across different datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">24)</xref>. scDREAMER was one of the fastest among all the neural network-based methods across all datasets and was faster compared to some other methods (e.g., Seurat, LIGER). scDREAMER-Sup was also faster than scANVI for multiple datasets and faster than other neural network-based unsupervised methods.</p>
    </sec>
    <sec id="Sec10">
      <title>Ablation study</title>
      <p id="Par30">We performed ablation studies to examine the contribution of the two adversarial components of scDREAMER—adversarial discriminator and batch classifier. Supplementary Table <xref rid="MOESM1" ref-type="media">2</xref> compares the performance of scDREAMER in comparison to scDREAMER without the discriminator (scDREAMER-woDis) and scDREAMER without the batch classifier (scDREAMER-woBC) for different integration tasks. As can be seen, scDREAMER-woBC performs better than scDREAMER-woDis in terms of composite bio-conservation score and composite isolated label score indicating the contribution of the discriminator toward improved bio-conservation and identification of rare cell types. In contrast, the version that uses batch classifier (scDREAMER-woDis) performs better in terms of batch correction as compared to scDREAMER-woBC indicating the contribution of the batch classifier in removing batch effects. Thus, both the components play a significant role and by combining them, scDREAMER achieves the best performance in terms of combined composite score as well as composite isolated label score for different datasets.</p>
    </sec>
  </sec>
  <sec id="Sec11" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par31">Here, we introduced scDREAMER, a deep generative model for the efficient and robust integration of scRNA-seq datasets across multiple batches. The unsupervised model of scDREAMER employs an adversarial variational autoencoder for inferring the latent cellular embeddings from the high-dimensional gene expression matrices from different batches. This adversarial autoencoder also outputs the corrected expression profiles. The other component of scDREAMER, a batch classifier helps remove batch effects from the latent cellular embeddings for better mixing of cell types shared across multiple batches. Thus, scDREAMER employs a combination of two levels of adversarial training for training the adversarial VAE and the batch classifier respectively and differs from existing adversarially trained deep generative models for dimensionality reduction<sup><xref ref-type="bibr" rid="CR37">37</xref></sup> and batch integration of scRNA-seq data<sup><xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR22">22</xref></sup> (see Supplementary <xref rid="MOESM1" ref-type="media">Note 1</xref> for details). Our ablation study further demonstrated that the two adversarially trained components play important roles in improving bio-conservation and removal of batch effects respectively. We further extended scDREAMER to scDREAMER-Sup, which employs an additional variational autoencoder and a cell type classifier to utilize available cell type labels for improved bio-conservation.</p>
    <p id="Par32">Our comprehensive benchmarking of scDREAMER and scDREAMER-Sup on multiple complex data integration tasks demonstrates scDREAMER’s superiority over the state-of-the-art unsupervised and supervised integration methods respectively in terms of both conservation of biological variations and removal of batch effects. In contrast, the other methods were only able to perform well in one aspect of data integration: batch-mixing or conservation of biological variation, that too varied across datasets. scDREAMER was also a consistent performer in capturing rare cell identities. Moreover, a comparison of the fraction of true positive and positive cells further demonstrated scDREAMER’s superiority over other methods in batch-mixing. scDREAMER-Sup was found to improve upon scDREAMER and it consistently outperformed all the supervised (that utilize the cell type annotations) as well as unsupervised integration methods across various benchmarking datasets and experimental settings.</p>
    <p id="Par33">scDREAMER also demonstrated high accuracy for the integration of a large number of batches and atlases from different species despite the small number of shared cell types. Both scDREAMER and scDREAMER-Sup significantly outperformed the other methods for the integration of heart atlas across 147 batches, which many other methods failed to integrate. scDREAMER-Sup also performed superior to all other methods in predicting the cell type labels for the cells missing annotations. Moreover, the unsupervised deep learning approach of scDREAMER does not require any cell type information and can be applied when prior knowledge regarding homologous cell types is not available or the cell type annotations are missing. In case cell type labels are available (completely or partially), the supervised version of scDREAMER, scDREAMER-Sup can achieve improved performance in bio-conservation while maintaining batch-effect removal performance. As more cell atlases are generated from different species, we believe that scDREAMER will be suitable for robust integration of cross-species datasets for the discovery of shared and private cell types.</p>
    <p id="Par34">The application of scDREAMER on the heart atlas and cross-species dataset also highlights its scalability to a large number of batches and millions of cells. In fact, our runtime experiments using different down-sampled versions of the cross-species dataset showed that scDREAMER outperformed some other deep learning-based methods based on runtime. Thus scDREAMER provides a suitable deep learning-based integration model for cross-species atlas integration as the other deep learners scVI, INSCT, iMAP and scDML achieved much less accuracy for the cross-species integration task. This is particularly important as the deep learning-based methods enable the inference of latent cellular embeddings as well as corrected expression profiles which are required for several downstream applications such as trajectory inference<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> or differential expression analysis<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
    <p id="Par35">scDREAMER being a deep learning-based method may require fine-tuning of some parameters for extracting the best performance. However, in our analyses, the same parameter values performed well across multiple datasets (Supplementary Table <xref rid="MOESM1" ref-type="media">3)</xref>. Our current model assumes prior knowledge of the number of batches. An important future direction would be to explore the unsupervised treatment of batch information and whether the hierarchical structure between different batch information can be utilized when it exists (e.g., when cells from a single donor but multiple organs are present in the atlas). While we restricted our analysis to the integration of scRNA-seq datasets, our deep generative model encompasses a general framework that can accommodate other omics datasets and we plan to extend the framework of scDREAMER to multiomic datasets. Finally, given the rapid generation of atlas-level single-cell datasets<sup><xref ref-type="bibr" rid="CR38">38</xref>–<xref ref-type="bibr" rid="CR40">40</xref></sup> across multiple organs and species, we anticipate supervised and unsupervised models of scDREAMER to become invaluable methods for performing scalable and accurate integration of single-cell atlases for the exploration of different biological systems.</p>
  </sec>
  <sec id="Sec12">
    <title>Methods</title>
    <sec id="Sec13">
      <title>The scDREAMER model</title>
      <p id="Par36">The unsupervised model of scDREAMER consists of an unsupervised deep learning-based framework specifically designed to address the complex and multi-level batch effects and perform atlas-level integration ensuring effective integration as well as batch mixing. Any integration method is faced with the critical challenge of balancing a tradeoff between capturing the distinct identity of the batch-specific cell types and adequate mixing of the cell types shared across multiple batches. This challenge is even more profound for the integration of atlas-level datasets. To overcome these challenges, we formalize our scDREAMER integration model into two major components, the adversarial variational autoencoder and the batch classifier that is adversarially trained with the encoder.</p>
      <p id="Par37">scDREAMER employs an adversarial variational autoencoder for learning a lower-dimensional representation of cells from the high-dimensional scRNA-seq data. In addition, there is a neural network classifier (also called a batch classifier) for the removal of batch effects. The adversarial variational autoencoder of scDREAMER consists of three multi-layer neural networks: an encoder <italic>E</italic> that maps the high-dimensional expression data (<italic>x</italic><sub><italic>i</italic></sub>) and batch information (<italic>s</italic><sub><italic>i</italic></sub>) of a cell <italic>i</italic> to a lower-dimensional embedding <italic>z</italic><sub><italic>i</italic></sub>, a decoder <italic>D</italic>, which reconstructs the expression profile of the cell from <italic>z</italic><sub><italic>i</italic></sub> and <italic>s</italic><sub><italic>i</italic></sub>, and a discriminator <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M16"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq8.gif"/></alternatives></inline-formula> that aims to distinguish the original expression profile <italic>x</italic><sub><italic>i</italic></sub> and the expression profile reconstructed (<inline-formula id="IEq9"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{{x}_{i}}$$\end{document}</tex-math><mml:math id="M18"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq9.gif"/></alternatives></inline-formula>) by the decoder. The use of a discriminator to adversarially train the autoencoder is inspired by ref. <sup><xref ref-type="bibr" rid="CR37">37</xref></sup>.</p>
      <p id="Par38">The adversarial variational autoencoder network of scDREAMER is trained using two loss functions: evidence lower bound (ELBO) is used for training the encoder and decoder networks, whereas Bhattacharyya loss is used for adversarial training of discriminator and autoencoder parameters. The ELBO loss accounts for the KL divergence between the posterior distribution <italic>q</italic>(<italic>z</italic><sub><italic>i</italic></sub>∣<italic>s</italic><sub><italic>i</italic></sub>, <italic>x</italic><sub><italic>i</italic></sub>) and the true distribution <italic>p</italic>(<italic>z</italic><sub><italic>i</italic></sub>), and the expected likelihood of <italic>x</italic><sub><italic>i</italic></sub> given <italic>z</italic><sub><italic>i</italic></sub> over posterior probability distribution <italic>q</italic>(<italic>z</italic><sub><italic>i</italic></sub>∣<italic>s</italic><sub><italic>i</italic></sub>, <italic>x</italic><sub><italic>i</italic></sub>). The Bhattacharyya loss compares the probability distributions <italic>q</italic>(<italic>z</italic><sub><italic>i</italic></sub>∣<italic>x</italic><sub><italic>i</italic></sub>, <italic>s</italic><sub><italic>i</italic></sub>) and <italic>p</italic>(<italic>z</italic><sub><italic>i</italic></sub>) where <italic>q</italic>(<italic>z</italic><sub><italic>i</italic></sub>∣<italic>x</italic><sub><italic>i</italic></sub>, <italic>s</italic><sub><italic>i</italic></sub>) is the posterior probability distribution and <italic>p</italic>(<italic>z</italic><sub><italic>i</italic></sub>) is 0-mean Gaussian distribution, i.e., <inline-formula id="IEq10"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{N}}}}}}}}(0,I)$$\end{document}</tex-math><mml:math id="M20"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq10.gif"/></alternatives></inline-formula>.</p>
      <p id="Par39">scDREAMER further incorporates a batch classifier, <inline-formula id="IEq11"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M22"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq11.gif"/></alternatives></inline-formula> (a multi-layer neural network) that takes as input the lower-dimensional embedding <italic>z</italic><sub><italic>i</italic></sub> learned by the encoder and tries to predict the batch information <italic>s</italic><sub><italic>i</italic></sub> for each cell <italic>i</italic>. The batch classifier and the encoder are adversarially trained using a cross-entropy loss where the encoder tries to maximize it with an aim to generate the embeddings such that the classifier is not able to differentiate between batches and the batch classifier tries to minimize it by distinguishing the embeddings of the cells that are part of different batches and hence achieving better mixing of the batches.</p>
    </sec>
    <sec id="Sec14">
      <title>Adversarial variational autoencoder for representation learning of cells</title>
      <p id="Par40"><italic>E</italic> denotes the Encoder network that takes as input <italic>X</italic> (gene expression matrix) and <italic>S</italic> (set of batch information) and generates the mean <italic>μ</italic><sub><italic>Z</italic></sub> and variance <italic>σ</italic><sub><italic>Z</italic></sub> of the multivariate normal distribution (prior for <italic>z</italic>). In addition, it also learns the mean and variance of the cell-specific scaling factor <italic>l</italic><sub><italic>i</italic></sub> as used in ref. <sup><xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
      <p id="Par41">The Encoder <italic>E</italic> learns the functional form: <italic>z</italic><sub><italic>i</italic></sub> ~ <italic>N</italic><italic>o</italic><italic>r</italic><italic>m</italic><italic>a</italic><italic>l</italic>(0, <italic>I</italic>), <italic>f</italic><sub><italic>E</italic></sub>: {<italic>x</italic>, <italic>s</italic>} → {<italic>μ</italic><sub><italic>z</italic></sub>, <italic>σ</italic><sub><italic>z</italic></sub>, <italic>μ</italic><sub><italic>l</italic></sub>, <italic>σ</italic><sub><italic>l</italic></sub>}. The decoder network <italic>D</italic> takes as input the latent space embeddings <italic>z</italic> and batch information and reconstructs the gene expression matrix, <inline-formula id="IEq12"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{X}$$\end{document}</tex-math><mml:math id="M24"><mml:mover accent="true"><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq12.gif"/></alternatives></inline-formula>. It also outputs the mean and dispersion of the reconstructed gene expression vector. The scRNA-seq data can be modeled as zero-inflated negative binomial (ZINB) or negative binomial (NB) distribution.</p>
      <p id="Par42">scDREAMER aims to learn the posterior distribution of the latent variable <italic>z</italic>, <italic>p</italic>(<italic>z</italic>∣<italic>X</italic>, <italic>S</italic>, <italic>l</italic>). We use a variational inference approach where we try to learn the network parameters of <italic>E</italic> and <italic>D</italic> as denoted by <italic>ϕ</italic> = {<italic>f</italic><sub><italic>E</italic></sub>, <italic>f</italic><sub><italic>D</italic></sub>} by maximizing the Evidence Lower Bound Loss (ELBO) function:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ELBO=-KL({q}_{\phi }(z| x,s)| | p(z))-KL({q}_{\phi }(l| x,s)| | p(l))+{E}_{{q}_{\phi }(z,l| x,s)}\,log(p(x| z,s,l))$$\end{document}</tex-math><mml:math id="M26"><mml:mi>E</mml:mi><mml:mi>L</mml:mi><mml:mi>B</mml:mi><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where, the first two terms denote the KL divergence between the posterior distribution and true distribution for <italic>z</italic> and <italic>l</italic> respectively and the third term denotes the expected likelihood of <italic>x</italic> given <italic>z</italic> and <italic>l</italic> over the posterior probability distribution, <italic>q</italic><sub><italic>ϕ</italic></sub>(<italic>z</italic>, <italic>l</italic>∣<italic>x</italic>, <italic>s</italic>). In this work, we have modeled scRNA-seq data using ZINB distribution which is defined in terms of mean (<italic>μ</italic>) and dispersion (<italic>θ</italic>) parameters as:<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\forall x\in {\mathbb{N}};p(y;\mu,\theta )=\frac{{{\Gamma }}(x+\theta )}{{{\Gamma }}(x+1){{\Gamma }}(\theta )}{\left(\frac{\theta }{\theta+\mu }\right)}^{\theta }{\left(\frac{\mu }{\mu+\theta }\right)}^{x}$$\end{document}</tex-math><mml:math id="M28"><mml:mo>∀</mml:mo><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">N</mml:mi><mml:mo>;</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi><mml:mo>+</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msup></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <sec id="Sec15">
        <title>Training of discriminator</title>
        <p id="Par43">Inspired by ref. <sup><xref ref-type="bibr" rid="CR37">37</xref></sup>, scDREAMER autoencoder also incorporates an adversarial discriminator <inline-formula id="IEq13"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M30"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq13.gif"/></alternatives></inline-formula> that tries to distinguish between the reconstructed gene expression profile <inline-formula id="IEq14"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{x}$$\end{document}</tex-math><mml:math id="M32"><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq14.gif"/></alternatives></inline-formula> and the original gene expression profile <italic>x</italic> of a cell. This ensures that the distribution of the reconstructed gene expression profiles faithfully follows the distribution of the underlying original scRNA-seq profiles. <inline-formula id="IEq15"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M34"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq15.gif"/></alternatives></inline-formula> is adversarially trained along with the autoencoder, <inline-formula id="IEq16"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}=\{E,D\}$$\end{document}</tex-math><mml:math id="M36"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq16.gif"/></alternatives></inline-formula> using Bhattacharyya loss, <inline-formula id="IEq17"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}$$\end{document}</tex-math><mml:math id="M38"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq17.gif"/></alternatives></inline-formula> given by:<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}=-log\left(\mathop{\sum }\limits_{i=1}^{N}\sqrt{P({x}_{i})\times P(\bar{{x}_{i}})}\right)$$\end{document}</tex-math><mml:math id="M40"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:msqrt><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msqrt></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula><inline-formula id="IEq18"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M42"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq18.gif"/></alternatives></inline-formula> tries to maximize <inline-formula id="IEq19"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}$$\end{document}</tex-math><mml:math id="M44"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq19.gif"/></alternatives></inline-formula> whereas the autoencoder <inline-formula id="IEq20"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}$$\end{document}</tex-math><mml:math id="M46"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq20.gif"/></alternatives></inline-formula> tries to minimize <inline-formula id="IEq21"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}$$\end{document}</tex-math><mml:math id="M48"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq21.gif"/></alternatives></inline-formula> giving rise to the minimax objective function:<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{\min }\nolimits_{{{{{{{{\mathcal{{A}}}}}}}_{E}}}}\,\mathop{\max }\nolimits_{{{{{{{{\mathcal{D}}}}}}}}}\,{{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}({{\mathbb{E}}}_{x \sim {P}_{x}}{{{{{{{\mathcal{D}}}}}}}}(x),{{\mathbb{E}}}_{z \sim p(z)}{{{{{{{\mathcal{D}}}}}}}}({{{{{{{\mathcal{{A}}}}}}}_{E}}}(z)))$$\end{document}</tex-math><mml:math id="M50"><mml:msub><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>~</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi><mml:mo>~</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      </sec>
      <sec id="Sec16">
        <title>Adversarial training using a batch classifier for batch-effect removal</title>
        <p id="Par44">The batch-classifier network <inline-formula id="IEq22"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M52"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq22.gif"/></alternatives></inline-formula> learns its parameters by minimizing the cross-entropy loss thereby ensuring correct classification of embeddings into different batches while Encoder tries to fool the batch-classifier by maximizing the cross-entropy loss. <inline-formula id="IEq23"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M54"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq23.gif"/></alternatives></inline-formula> takes <italic>z</italic> (latent space embeddings) as input and <italic>s</italic> (batch information) as labels. The cross-entropy loss is given by:<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$-\mathop{\sum }\limits_{j=1}^{| S| }{s}_{j}\times log({r}_{j})$$\end{document}</tex-math><mml:math id="M56"><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>S</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>where <italic>s</italic><sub><italic>j</italic></sub> is the true label and <italic>r</italic><sub><italic>j</italic></sub> is the softmax probability of the <italic>j</italic><italic>t</italic><italic>h</italic> batch.</p>
        <p id="Par45">The batch-classifier intends to minimize the cross-entropy loss, hence classifying the latent cellular embeddings to its correct batch whereas the encoder tries to maximize the cross-entropy loss ensuring that the classifier is not able to differentiate between batches so that better mixing of data from different batches can be achieved. This gives rise to another minimax objective:<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{\max }\nolimits_{E}\,\mathop{\min }\nolimits_{{{{{{{{\mathcal{B}}}}}}}}}-\mathop{\sum }\limits_{j=1}^{| S| }{s}_{j}\times log({r}_{j})$$\end{document}</tex-math><mml:math id="M58"><mml:msub><mml:mrow><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>S</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula></p>
      </sec>
    </sec>
    <sec id="Sec17">
      <title>Implementation details</title>
      <p id="Par46">
        <list list-type="bullet">
          <list-item>
            <p id="Par47">scDREAMER has 4 neural network units correspnding to Encoder, Decoder, Discriminator and Batch-Classifier, all with multi-layer dense neural network architecture with linear relu activation at the end of each layer. For training our model, we have adopted ADAM optimizer<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>. We have used <italic>β</italic> as a scaling factor (multiplied to the KL-divergence term) to balance between the reconstruction loss and KL-divergence term while optimizing the ELBO loss. The batch size of 128 is used while training the model.</p>
          </list-item>
          <list-item>
            <p id="Par48">To facilitate and stabilize the training process and make scDREAMER robust to small perturbations, we added a penalty term in the main objective function following ref. <sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. Specifically, for each gene expression vector <italic>x</italic><sub><italic>i</italic></sub>, we down-sample <italic>x</italic><sub><italic>i</italic></sub> by keeping 80% of its UMIs to produce <italic>x</italic><sub><italic>i</italic></sub>. The latent representations for <italic>x</italic><sub><italic>i</italic></sub> and <inline-formula id="IEq24"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{x}}_{i}$$\end{document}</tex-math><mml:math id="M60"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq24.gif"/></alternatives></inline-formula> are <italic>z</italic><sub><italic>i</italic></sub> and <inline-formula id="IEq25"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{z}}_{i}$$\end{document}</tex-math><mml:math id="M62"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq25.gif"/></alternatives></inline-formula> respectively. The penalty term is defined as <inline-formula id="IEq26"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$-\mathop{\sum }\nolimits_{j=1}^{| {z}_{i}| }{({z}_{ij}-{\hat{z}}_{ij})}^{2}$$\end{document}</tex-math><mml:math id="M64"><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq26.gif"/></alternatives></inline-formula> as we want <italic>z</italic><sub><italic>i</italic></sub> and <inline-formula id="IEq27"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{z}}_{i}$$\end{document}</tex-math><mml:math id="M66"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq27.gif"/></alternatives></inline-formula> to be as close as possible. The down-sampling ratio used in our case is 80%.</p>
          </list-item>
          <list-item>
            <p id="Par49">In our evaluations across different integration tasks and experimental settings, we have used the same values for hyperparameters and the same architecture for our neural networks. We further performed a robustness study for two learning rate parameters for Pancreas data integration (Supplementary Table <xref rid="MOESM1" ref-type="media">4)</xref>, which showed that the metrics were comparable across different values of learning rate parameters.</p>
          </list-item>
        </list>
      </p>
    </sec>
    <sec id="Sec18">
      <title>Extension of scDREAMER model for utilizing cell type labels</title>
      <p id="Par50">The scDREAMER model was further extended to scDREAMER-Supervised (scDREAMER-Sup), which can leverage existing cell type annotations to further improve biological conservation while integrating scRNA-seq datasets (Fig. <xref rid="Fig1" ref-type="fig">1</xref>). Inspired by the deep generative semi-supervised learner<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> and scANVI<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>, scDREAMER-Sup employs a hierarchical structure for the inference of an informative latent embedding <italic>z</italic> guided by the available cell type annotations <italic>c</italic>. Essentially, the prior on <italic>z</italic><sub><italic>i</italic></sub> becomes more informative as it becomes conditioned on cell type label <italic>c</italic><sub><italic>i</italic></sub> and another latent variable <italic>y</italic><sub><italic>i</italic></sub> that accounts for within cell type variability. scDREAMER-Sup employs an additional variational autoencoder, <inline-formula id="IEq28"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}=\{{E}_{y},{D}_{y}\}$$\end{document}</tex-math><mml:math id="M68"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq28.gif"/></alternatives></inline-formula> for learning <italic>y</italic><sub><italic>i</italic></sub> from <italic>z</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub>, and another feed-forward neural network (also called cell type classifier), <inline-formula id="IEq29"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M70"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq29.gif"/></alternatives></inline-formula>, for learning <italic>c</italic><sub><italic>i</italic></sub> from <italic>z</italic><sub><italic>i</italic></sub>. When cell type annotations are available, those are fed to the autoencoder <inline-formula id="IEq30"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}$$\end{document}</tex-math><mml:math id="M72"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq30.gif"/></alternatives></inline-formula> along with the latent embeddings <italic>z</italic><sub><italic>i</italic></sub> from the adversarial variational autoencoder, <inline-formula id="IEq31"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}$$\end{document}</tex-math><mml:math id="M74"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq31.gif"/></alternatives></inline-formula>. In case cell type annotations are partially available, scDREAMER-Sup learns the missing cell type labels by training the cell type classifier network using a cross-entropy loss on the set of cells for which cell type annotations are available.</p>
      <sec id="Sec19">
        <title>Training cell type classifier</title>
        <p id="Par51">The cell type classifier network, <inline-formula id="IEq32"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M76"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq32.gif"/></alternatives></inline-formula> learns its parameters by minimizing the cross-entropy loss thereby ensuring correct classification of latent embeddings <italic>z</italic> into different cell type annotations. <inline-formula id="IEq33"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M78"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq33.gif"/></alternatives></inline-formula> takes as input <italic>z</italic><sub><italic>i</italic></sub> from <inline-formula id="IEq34"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}$$\end{document}</tex-math><mml:math id="M80"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq34.gif"/></alternatives></inline-formula> and <italic>c</italic><sub><italic>i</italic></sub> (cell type annotation) as label and intends to minimize cross-entropy loss, hence classifying the latent cellular embeddings to its correct cell type. The cross-entropy loss is given by:<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$-\mathop{\sum }\limits_{i=1}^{| C| }{c}_{i}\times log({r}_{i})$$\end{document}</tex-math><mml:math id="M82"><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>C</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula>where <italic>c</italic><sub><italic>i</italic></sub> is the true cell type label, <italic>r</italic><sub><italic>i</italic></sub> is the softmax probability of the <italic>i</italic><sup><italic>t</italic><italic>h</italic></sup> cell type annotation and ∣<italic>C</italic>∣ is the number of cell types.</p>
        <p id="Par52">Under semi-supervised setting, <inline-formula id="IEq35"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M84"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq35.gif"/></alternatives></inline-formula> is trained using the labeled data, i.e., the cross-entropy loss is computed using the available cell type annotations. The trained network is then used to predict the cell type annotations for the unlabeled cells.</p>
      </sec>
      <sec id="Sec20">
        <title>Variational autoencoder for learning informed prior on cellular latent space</title>
        <p id="Par53">The variational autoencoder <inline-formula id="IEq36"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}$$\end{document}</tex-math><mml:math id="M86"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq36.gif"/></alternatives></inline-formula> consists of an encoder <italic>E</italic><sub><italic>y</italic></sub> that takes as input <italic>z</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub> and generates the mean <italic>μ</italic><sub><italic>y</italic></sub> and variance <italic>σ</italic><sub><italic>y</italic></sub> of the multivariate normal distribution (prior for <italic>y</italic>). The decoder network <italic>D</italic><sub><italic>y</italic></sub> takes as input <italic>y</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub> and reconstructs latent cellular embedding <inline-formula id="IEq37"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{{z}_{i}}$$\end{document}</tex-math><mml:math id="M88"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq37.gif"/></alternatives></inline-formula>. We assume the following distributions for <italic>y</italic><sub><italic>i</italic></sub> and <italic>z</italic><sub><italic>i</italic></sub><disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${y}_{i} \sim Normal(0,I),{z}_{i} \sim Normal({f}_{z}^{{\prime} \mu }({y}_{i},{c}_{i}),{f}_{z}^{{\prime} \sigma }({y}_{i},{c}_{i}))$$\end{document}</tex-math><mml:math id="M90"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>~</mml:mo><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>~</mml:mo><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mi>σ</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq38"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{z}^{{\prime} \mu }$$\end{document}</tex-math><mml:math id="M92"><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq38.gif"/></alternatives></inline-formula> and <inline-formula id="IEq39"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{z}^{{\prime} \sigma }$$\end{document}</tex-math><mml:math id="M94"><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mi>σ</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq39.gif"/></alternatives></inline-formula> are two functions approximated by the variational autoencoder <inline-formula id="IEq40"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}$$\end{document}</tex-math><mml:math id="M96"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq40.gif"/></alternatives></inline-formula>.</p>
        <p id="Par54">We use <italic>ϕ</italic> = {<italic>f</italic><sub><italic>E</italic></sub>, <italic>f</italic><sub><italic>D</italic></sub>}, and <inline-formula id="IEq41"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\phi }^{{\prime} }=\{{f}_{{E}_{y}},{f}_{{D}_{y}}\}$$\end{document}</tex-math><mml:math id="M98"><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq41.gif"/></alternatives></inline-formula> to denote the network parameters of the two variational autoencoders (<inline-formula id="IEq42"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}$$\end{document}</tex-math><mml:math id="M100"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq42.gif"/></alternatives></inline-formula> and <inline-formula id="IEq43"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}$$\end{document}</tex-math><mml:math id="M102"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq43.gif"/></alternatives></inline-formula> respectively) of scDREAMER-Sup which we learn using variational inference by maximizing an ELBO function given by:<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{rcl}ELBO&amp;=&amp;{E}_{{q}_{\phi }(z,l| x,s)}\left[log\,p(x| z,l,s)\right]-KL({q}_{\phi }(z| x,s)\,| | \,{E}_{{q}_{{\phi }^{{\prime} }}(y| z,c)}p(z| y,c))\\ &amp;&amp;-{E}_{{q}_{\phi }(z| x,s)}\,KL({q}_{{\phi }^{{\prime} }}(y| z,c)\,| | \,p(y))-KL({q}_{\phi }(l| x,s)\,| | \,p(l))\end{array}$$\end{document}</tex-math><mml:math id="M104"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi>E</mml:mi><mml:mi>L</mml:mi><mml:mi>B</mml:mi><mml:mi>O</mml:mi></mml:mtd><mml:mtd columnalign="center"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mspace width="0.25em"/><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.25em"/><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"/><mml:mtd columnalign="center"/><mml:mtd columnalign="left"><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.25em"/><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mspace width="0.25em"/><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.25em"/><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mspace width="0.25em"/><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>equation (<xref rid="Equ9" ref-type="disp-formula">9</xref>) denotes the ELBO function for only one cell (this is without loss of generality as the cells are independent and identically distributed) and assumes the following factorization of the variational distribution<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$q(z,y,l| x,s)=q(z| x,s)q(y| z,c)q(l| x,s)$$\end{document}</tex-math><mml:math id="M106"><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula>The ELBO is derived following semi-supervised variational autoencoder literature<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>. Our variational distribution does not approximate the posterior for cell type annotation <italic>c</italic>, instead for the cases, where <italic>c</italic> is unavailable, we use the cell type classifier to generate the cell type annotations.</p>
      </sec>
      <sec id="Sec21">
        <title>Implementation details of scDREAMER-Sup</title>
        <p id="Par55">scDREAMER-Sup has three additional neural networks corresponding to the Encoder <italic>E</italic><sub><italic>y</italic></sub>, Decoder <italic>D</italic><sub><italic>y</italic></sub> and the cell type classifier <inline-formula id="IEq44"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M108"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq44.gif"/></alternatives></inline-formula>, all with multi-layer dense neural network architecture with linear relu activation at the end of each layer. For training our model, we have adopted ADAM optimizer. The batch size of 128 was used while training the model.</p>
      </sec>
      <sec id="Sec22">
        <title>Preprocessing of scRNA-seq datasets</title>
        <p id="Par56">The scRNA-seq datasets were preprocessed using the standard pipeline of Scanpy<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. Raw count expression matrices were imported as Scanpy AnnData object followed by the removal of low-quality cells based on the mitochondrial gene counts. The expression matrices were then normalized (using “scanpy.pp.normalize_total” function) and log-transformed. Finally, we selected the top 2000 highly variable genes using the function “scanpy.pp.highly_variable_genes” (with flavor parameter as “seurat”) as input to scDREAMER and other methods. The genes that were present across all the batches were considered. For the healthy heart atlas dataset, cells annotated as doublets were removed.</p>
      </sec>
    </sec>
    <sec id="Sec23">
      <title>Metrics for the evaluation of integration performance</title>
      <p id="Par57">The data integration performance of all methods was primarily evaluated based on two broad categories of metrics: (1) biological variance conservation metrics and (2) batch effect correction metrics. Following a recent study<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>, we considered NMI, ARI, and ASW (cell type) as biological conservation metrics. For the evaluation of batch effect removal, we considered four metrics: ASW (batch), principal component regression (batch), graph connectivity, and kBET. For a holistic comparison of the performance across all the metrics in both of these categories, we introduced two composite scores and a combined composite score as described below. In addition, we computed isolated label F1 and isolated label silhouette scores for evaluating a method’s ability to capture rare cell identities. We also computed single-cell level metrics: graph iLISI (for batch correction), graph cLISI (for bio-conservation), and proportion of true positive vs positive cells.</p>
      <sec id="Sec24">
        <title>Biological conservation metrics</title>
        <p id="Par58">The computation of the biological conservation metrics requires clustering of the integrated data. We have used the Louvain clustering algorithm to compute the clusters with a resolution that maximizes the NMI value. The same clustering assignment is used for computing other metrics<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>.<list list-type="bullet"><list-item><p id="Par59"><bold>Normalized mutual information (NMI):</bold> NMI compares the overlap between any two clustering assignments where the overlap is measured in terms of mutual information. The NMI value is scaled in the range of 0 to 1 based on the mean entropy for cluster assignments and cell-type labels.</p></list-item><list-item><p id="Par60"><bold>Adjusted Rand Index (ARI):</bold> Rand index compares two clustering assignments considering all pairs of points and finding agreement and disagreement between the clustering assignments<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. The adjusted rand index (ARI) accounts for the randomly correct labels and it ranges from 0 to 1 with 0 corresponding to random clustering, and 1 representing a perfect match between the clusterings<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>. For ARI calculation, we compared the cell labels with the optimized NMI Louvain clusters.</p></list-item><list-item><p id="Par61"><bold>Cell type average silhouette width (ASW):</bold> Silhouette width for cell <italic>i</italic> is given by:<disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{r}sw(i)=\frac{b(i)-a(i)}{\max \{a(i),b(i)\}}\end{array}$$\end{document}</tex-math><mml:math id="M110"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi>s</mml:mi><mml:mi>w</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>max</mml:mi><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula>where <italic>a</italic>(<italic>i</italic>) is the average of distances of cell <italic>i</italic> to the other cells in the same cluster and <italic>b</italic>(<italic>i</italic>) is the average distance of cell <italic>i</italic> from the cells in the other nearest cluster. Average silhouette width (ASW) is calculated by averaging over all cells and it ranges between −1 to 1, where −1 or 0 indicates that clusters are overlapping and 1 corresponds to well-separated and dense clusters. As a bio-conservation metric, we computed cell type ASW by considering the cell types as the clusters and scaled between 0 to 1 by the transformation ASW = (ASW + 1)/2. The PCA reduced space is used for the calculation of distances for the corrected space output method. This metric is not applicable to the graph-based method BBKNN.</p></list-item></list></p>
      </sec>
      <sec id="Sec25">
        <title>Batch correction metrics</title>
        <p id="Par62">
          <list list-type="bullet">
            <list-item>
              <p id="Par63"><bold>ASW batch:</bold> ASW is calculated between the batches of each subset based on the cell type. Here the 0 value indicates that the batches are well-mixed. So we scaled the <italic>A</italic><italic>S</italic><italic>W</italic> = 1 − <italic>a</italic><italic>b</italic><italic>s</italic>(<italic>A</italic><italic>S</italic><italic>W</italic>). Now the scaled value 0 indicates that the batches are not well-mixed, 1 indicates that batches are well-mixed.</p>
            </list-item>
            <list-item>
              <p id="Par64"><bold>Principal component regression (PCR) batch:</bold> In principal component regression (PCR) batch<sup><xref ref-type="bibr" rid="CR47">47</xref></sup>, for each principal component (<italic>P</italic><italic>C</italic><sub><italic>k</italic></sub>) (calculated using PCA), the variance contributed by each batch <italic>b</italic> is computed as:<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{r}Var(M| b)=\mathop{\sum }\limits_{k=1}^{N}Var(M| P{C}_{i})*{R}^{2}(P{C}_{i}| b)\end{array}$$\end{document}</tex-math><mml:math id="M112"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi>V</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>M</mml:mi><mml:mo>∣</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mi>V</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>M</mml:mi><mml:mo>∣</mml:mo><mml:mi>P</mml:mi><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>P</mml:mi><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula>Where <italic>V</italic><italic>a</italic><italic>r</italic>(<italic>M</italic>∣<italic>P</italic><italic>C</italic><sub><italic>i</italic></sub>) indicates the variance explained by <italic>P</italic><italic>C</italic><sub><italic>i</italic></sub> on the data matrix <italic>M</italic>, and <italic>R</italic><sup>2</sup> denotes the coefficient of determination calculated using a linear regression with <italic>P</italic><italic>C</italic><sub><italic>i</italic></sub> as the dependent and <italic>b</italic> as the independent variable.</p>
            </list-item>
            <list-item>
              <p id="Par65"><bold>Graph connectivity</bold> Graph connectivity measures whether cells from the same cell type are well connected in the kNN graph. First, we compute the kNN graph with all the cells. Then we create a subset kNN graph with the cells from a particular cell type and check the number of cells in its largest connected component.<disp-formula id="Equ13"><label>13</label><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$GC=\frac{1}{| CT| }\mathop{\sum}\limits_{c\in CT}\frac{| LCC\left.\right(G({N}_{c},{E}_{c})| }{| {N}_{c}| }$$\end{document}</tex-math><mml:math id="M114"><mml:mi>G</mml:mi><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>C</mml:mi><mml:mi>T</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mi>C</mml:mi><mml:mi>T</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mo>∣</mml:mo><mml:mi>L</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi><mml:mfenced close="("><mml:mrow/></mml:mfenced><mml:mi>G</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∣</mml:mo></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula>Where <italic>C</italic><italic>T</italic> is the set of cell types, ∣<italic>L</italic><italic>C</italic><italic>C</italic>()∣ is the number of cells in the largest connected component. <italic>G</italic>(<italic>N</italic><sub><italic>c</italic></sub>, <italic>E</italic><sub><italic>c</italic></sub>) is the kNN subgraph for cell type <italic>c</italic> with <italic>N</italic><sub><italic>c</italic></sub> as the number of cells in cell type <italic>c</italic> and <italic>E</italic><sub><italic>c</italic></sub> denoting the edges in the kNN graph containing only the cells of type <italic>c</italic>.</p>
            </list-item>
            <list-item>
              <p id="Par66"><bold>k-nearest neighbor batch effect test (</bold><bold><italic>k</italic></bold><bold><italic>B</italic></bold><bold><italic>E</italic></bold><bold><italic>T</italic></bold><bold>):</bold> k-nearest neighbor batch effect test (<italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic>)<sup><xref ref-type="bibr" rid="CR47">47</xref></sup> evaluates how well the label configuration of the k-nearest neighborhoods of cells matches the global label configuration. <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> test is performed iteratively over a random subset of cells, and the value is calculated as the total rejection rates over all the iterations. As <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> works on the kNN graph, for the embedding-based output and corrected feature output methods, we have used <italic>k</italic> = 50 for calculating the kNN graph. <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> is applied to each batch separately to account for technical effects and changes in the cell type distribution across batches. For the kNN graphs containing disconnected components, <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> is calculated on each of the connected components. The number of nearest neighbors would differ for each cell in the graph-based method like BBKNN. So diffusion-based correction is used for graph-based output to get the same number of nearest neighbors for all the cells. <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> value is scaled between 0 to 1 so that the 0 value indicates poor batch mixing and 1 indicates perfect mixing of cells. It is important to note that for the healthy heart atlas dataset, <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> could not be computed for some of the methods due to computational limitations in handling large number of cells and batches (runs getting killed even after running for 72 h on Intel Xeon Gold 6246 CPU with 512 GB memory). This behavior of <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> has also been reported in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. For such cases, <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> has been excluded when computing the composite batch correction score.</p>
            </list-item>
          </list>
        </p>
      </sec>
      <sec id="Sec26">
        <title>Isolated label metrics</title>
        <p id="Par67">We adopted two isolated label scores from ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup> to evaluate how well a method can capture rare cell identities. Isolated labels denote the cell types that are present in the least number of batches. For each of the isolated labels, isolated F1 and isolated ASW are calculated. These two metrics reveal how well the isolated cell types are separated from the rest of the cell types after integration.</p>
        <p id="Par68">For the calculation of the isolated F1 score, first, we need to determine the clusters containing the particular isolated label. Lovain clustering is used for the clustering, and the resolution of the clustering algorithm is set such that the cluster has the largest number of isolated labels. The F1 score of isolated labels is then measured against the other cells in the cluster. F1 score ranges from 0 to 1 with 0 indicating that all the cells in the cluster are from cell types other than the isolated label and 1 indicating that all the cells are from isolated labels.</p>
        <p id="Par69">Isolated label ASW is calculated considering the isolated cell type as one cluster and all other cell types in another cluster and separately computing their ASW.</p>
      </sec>
      <sec id="Sec27">
        <title>Other metrics</title>
        <p id="Par70">
          <list list-type="bullet">
            <list-item>
              <p id="Par71"><bold>Graph inverse Simpson’s index LISI:</bold> The inverse Simpson’s index is a diversity score that calculates the number of neighbors needed to be visited before appearing in the same batch again. The value of this metric ranges from 1 to B (number of batches). This LISI score is used for the evaluation of both batch correction (iLISI) and bio-conservation (cLISI)<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. To extend the LISI to the graph-based methods graph LISI<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> is used. In graph LISI, the distance over joint embeddings is replaced with the graph-based distance between the cells to get a large number of neighbors. Dijkstra’s shortest path algorithm is used to calculate the shortest distance between the cells. In cLISI, inverse Simpson’s index is calculated over the cell types, i.e., the number of neighbors one needs to visit before getting the same cell type again in the neighborhood, whereas iLISI is calculated over the batches.</p>
            </list-item>
            <list-item>
              <p id="Par72"><bold>Proportion of positive and true positive cells:</bold> We further adopted another single-cell level summary metric from ref. <sup><xref ref-type="bibr" rid="CR22">22</xref></sup> to evaluate the integration performance. For this, first, the cells are classified into positive and negative cells. Cells surrounded by the same cell type are classified as positive; otherwise, they are classified as negative. Considering the subset of positive cells only, a positive cell is classified as true positive if the distribution of batches around it is the same as the global batch distribution. The proportion of positive cells indicates the extent of biological conservation. In contrast, the true positive percentage indicates how well the batches are well-mixed. These two proportions together serve as quantitative metrics for evaluating the batch effect removal performance.</p>
            </list-item>
          </list>
        </p>
      </sec>
      <sec id="Sec28">
        <title>Composite scores</title>
        <p id="Par73">We have introduced two composite score metrics for a holistic comparison of the performance across all the metrics for biological conservation and batch correction respectively. Moreover, we computed a combined composite score that measures the average performance of a method in biological conservation and batch correction. Each composite score is computed by averaging the scaled values of all the metrics in that category. For a dataset, the scaled value for each individual metric is obtained through min-max normalization across all the competing methods.</p>
        <p id="Par74">The composite scores are calculated as follows:<list list-type="order"><list-item><p id="Par75"><bold>Composite bio-conservation score</bold> = <inline-formula id="IEq45"><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left(\frac{NM{I}^{{\prime} }+AS{W}^{{\prime} }+AR{I}^{{\prime} }}{3}\right)$$\end{document}</tex-math><mml:math id="M116"><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>N</mml:mi><mml:mi>M</mml:mi><mml:msup><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>A</mml:mi><mml:mi>S</mml:mi><mml:msup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>A</mml:mi><mml:mi>R</mml:mi><mml:msup><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq45.gif"/></alternatives></inline-formula></p></list-item><list-item><p id="Par76"><bold>Composite batch correction score</bold> = <inline-formula id="IEq46"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left(\frac{ASW{(batch)}^{{\prime} }+PCR\,{{\mbox{\_}}}batc{h}^{{\prime} }+graph{{\mbox{\_}}}\,connectivit{y}^{{\prime} }+kBE{T}^{{\prime} }}{4}\right)$$\end{document}</tex-math><mml:math id="M118"><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>A</mml:mi><mml:mi>S</mml:mi><mml:mi>W</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>P</mml:mi><mml:mi>C</mml:mi><mml:mi>R</mml:mi><mml:mspace width="0.25em"/><mml:mo>_</mml:mo><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:msup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi><mml:mo>_</mml:mo><mml:mspace width="0.25em"/><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>v</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi><mml:msup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mi>E</mml:mi><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq46.gif"/></alternatives></inline-formula></p></list-item><list-item><p id="Par77"><bold>Composite isolated label score</bold> = <inline-formula id="IEq47"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left(\frac{isolated\,{{\mbox{\_}}}f1{{\mbox{\_}}}scor{e}^{{\prime} }+isolated{{\mbox{\_}}}\,AS{W}^{{\prime} }}{2}\right)$$\end{document}</tex-math><mml:math id="M120"><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mspace width="0.25em"/><mml:mo>_</mml:mo><mml:mi>f</mml:mi><mml:mn>1</mml:mn><mml:mo>_</mml:mo><mml:mi>s</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo>_</mml:mo><mml:mspace width="0.25em"/><mml:mi>A</mml:mi><mml:mi>S</mml:mi><mml:msup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq47.gif"/></alternatives></inline-formula></p></list-item><list-item><p id="Par78"><bold>Combined composite score</bold> = <inline-formula id="IEq48"><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{1}{2}$$\end{document}</tex-math><mml:math id="M122"><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq48.gif"/></alternatives></inline-formula>(Composite bio-conservation score + Composite batch correction score)</p></list-item></list>For any metric <inline-formula id="IEq49"><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${M}_{e},{M}_{e}^{{\prime} }$$\end{document}</tex-math><mml:math id="M124"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq49.gif"/></alternatives></inline-formula> denotes the min-max scaled value across all the competing methods.</p>
      </sec>
      <sec id="Sec29">
        <title>Metric for evaluating the accuracy of cell label prediction</title>
        <p id="Par79">We have adopted macro F1-score to evaluate how well a method can predict the cell type labels for the datasets with missing cell type labels. The F1-score metric measures the classification accuracy as the harmonic mean of precision and recall. In the context of cell label prediction, multiple classes are involved and F1-score is computed for every cell type annotation (class). Macro F1-score computes the overall accuracy of a multi-class classifier by aggregation of F1-scores for all the individual classes. For the prediction of cell type labels, it is computed by taking the arithmetic mean of the F1-scores for all the cell type annotations.</p>
      </sec>
    </sec>
    <sec id="Sec30">
      <title>Competing integration methods</title>
      <p id="Par80">We have compared our method against eleven state-of-the-art integration methods: scVI<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>, Scanaroma<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>, Harmony<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>, Seurat<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>, BBKNN<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>, INSCT<sup><xref ref-type="bibr" rid="CR48">48</xref></sup>, LIGER<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>, iMAP<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, scANVI<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>, scGEN<sup><xref ref-type="bibr" rid="CR31">31</xref></sup> and scDML<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. The details about the run configuration for these methods are provided in Supplementary Table <xref rid="MOESM1" ref-type="media">5</xref>.</p>
    </sec>
    <sec id="Sec31">
      <title>Statistics and reproducibility</title>
      <p id="Par81">No statistical method was used to predetermine the sample size. No data were excluded from the analyses. The experiments involved running computational methods on previously published, publicly available datasets and did not require randomization. The investigators were not blinded to allocation during experiments and assessment of outcome.</p>
    </sec>
    <sec id="Sec32">
      <title>Reporting summary</title>
      <p id="Par82">Further information on research design is available in the <xref rid="MOESM3" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec33">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_43590_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information file</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_43590_MOESM2_ESM.pdf">
            <caption>
              <p>Peer review file</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_43590_MOESM3_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
    <sec id="Sec34">
      <title>Source data</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_43590_MOESM4_ESM.xlsx">
            <caption>
              <p>Source data</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_43590_MOESM5_ESM.txt">
            <caption>
              <p>Author Meta Data</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Ajita Shree, Musale Krushna Pavan.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-43590-8.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was partially supported by the Science and Engineering Research Board (SERB), Government of India (SRG/2020/001333) and IIT Kanpur initiation grant (IITK /CS /2019236) to H.Z. Funding for open access charge is obtained from IIT Kanpur Research I Foundation grant 20030163.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>H.Z. designed the study. A.S., M.K.P., and H.Z. developed the model and algorithm. A.S. and M.K.P. implemented the software and performed all experiments. All authors wrote and approved the manuscript.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par83"><italic>Nature Communications</italic> thanks the anonymous, reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All datasets used in this study are publicly available. The human pancreas data used in this study are available in the GEO database under accession codes “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81076">GSE81076</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81076">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81076</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE85241">GSE85241</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE85241">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE85241</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE86469">GSE86469</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE86469">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE86469</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE84133">GSE84133</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE84133">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE84133</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81608">GSE81608</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81608">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81608</ext-link>]”, and the ArrayExpress database under the accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/biostudies/arrayexpress/studies/E-MTAB-5061">E-MTAB-5061</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/biostudies/arrayexpress/studies/E-MTAB-5061">https://www.ebi.ac.uk/biostudies/arrayexpress/studies/E-MTAB-5061</ext-link>]”<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. The lung atlas data is available in the GEO database under accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE130148">GSE130148</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE130148">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE130148</ext-link>]”. The human immune data used in this study are available in the GEO database under accession codes “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE120221">GSE120221</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE120221">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE120221</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE107727">GSE107727</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE107727">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE107727</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE115189">GSE115189</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE115189">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE115189</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE128066">GSE128066</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE128066">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE128066</ext-link>]” and “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE94820">GSE94820</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE94820">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE94820</ext-link>]” and in the website of 10X Genomics (PBMC10k: <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.0/pbmc_10k_v3">https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.0/pbmc_10k_v3</ext-link>)<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. The processed human pancreas, human immune, and lung atlas datasets are available at <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/dataset/Benchmarking_atlas-level_data_integration_in_single-cell_genomics_-_integration_task_datasets_Immune_and_pancreas_/12420968">https://figshare.com/articles/dataset/Benchmarking_atlas-level_data_integration_in_single-cell_genomics_-_integration_task_datasets_Immune_and_pancreas_/12420968</ext-link><sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. The Macaque Retina dataset is available at <ext-link ext-link-type="uri" xlink:href="https://singlecell.broadinstitute.org/single_cell/study/SCP212/molecular-specification-of-retinal-cell-types-underlying-central-and-peripheral-vision-in-primates#study-download">https://singlecell.broadinstitute.org/single_cell/study/SCP212/molecular-specification-of-retinal-cell-types-underlying-central-and-peripheral-vision-in-primates#study-download</ext-link>. The Healthy Heart data used in this study is available at <ext-link ext-link-type="uri" xlink:href="https://www.heartcellatlas.org/">https://www.heartcellatlas.org/</ext-link><sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. The processed Healthy Heart data used in this study can be downloaded from <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/dataset/Batch_Alignment_of_single-cell_transcriptomics_data_using_Deep_Metric_Learning/20499630/2">https://figshare.com/articles/dataset/Batch_Alignment_of_single-cell_transcriptomics_data_using_Deep_Metric_Learning/20499630/2</ext-link><sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. The Human and Mouse cell Atlas datasets used in the study are available at <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/dataset/MCA_DGE_Data/5435866">https://figshare.com/articles/dataset/MCA_DGE_Data/5435866</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/dataset/HCL_DGE_Data/7235471">https://figshare.com/articles/dataset/HCL_DGE_Data/7235471</ext-link>, respectively. The processed Human-Mouse cell atlas data can be downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/lkmklsmn/insct/tree/master/reproducibilty">https://github.com/lkmklsmn/insct/tree/master/reproducibilty</ext-link><sup><xref ref-type="bibr" rid="CR48">48</xref></sup>. All the processed datasets for the missing label experiments (for lung atlas, human immune and heart atlas tasks) are openly available at 10.6084/m9.figshare.24354295. The details of the experimental biological datasets used in this study are further provided in Supplementary Table <xref rid="MOESM1" ref-type="media">1</xref>. All other data supporting the findings of this study are available within the article and its supplementary files. Any additional requests for information can be directed to, and will be fulfilled by, the corresponding author. <xref ref-type="sec" rid="Sec34">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The source code and usage tutorial for scDREAMER are freely available at <ext-link ext-link-type="uri" xlink:href="https://github.com/Zafar-Lab/scDREAMER">https://github.com/Zafar-Lab/scDREAMER</ext-link>, the code has also been deposited via Zenodo (10.5281/zenodo.10021620)<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. All analysis and results presented in the manuscript are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/Zafar-Lab/scDREAMER-reproducibility">https://github.com/Zafar-Lab/scDREAMER-reproducibility</ext-link>, which have also been deposited via Zenodo (10.5281/zenodo.10021936)<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par84">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA sequencing to explore immune cell heterogeneity</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2018</year>
        <volume>18</volume>
        <fpage>35</fpage>
        <lpage>45</lpage>
        <pub-id pub-id-type="doi">10.1038/nri.2017.76</pub-id>
        <?supplied-pmid 28787399?>
        <pub-id pub-id-type="pmid">28787399</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pijuan-Sala</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell molecular map of mouse gastrulation and early organogenesis</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>566</volume>
        <fpage>490</fpage>
        <lpage>495</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-0933-9</pub-id>
        <?supplied-pmid 30787436?>
        <pub-id pub-id-type="pmid">30787436</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suvà</surname>
            <given-names>ML</given-names>
          </name>
          <name>
            <surname>Tirosh</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA sequencing in cancer: lessons learned and emerging challenges</article-title>
        <source>Mol. Cell</source>
        <year>2019</year>
        <volume>75</volume>
        <fpage>7</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1016/j.molcel.2019.05.003</pub-id>
        <?supplied-pmid 31299208?>
        <pub-id pub-id-type="pmid">31299208</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rozenblatt-Rosen</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Stubbington</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
        </person-group>
        <article-title>The human cell atlas: from vision to reality</article-title>
        <source>Nature</source>
        <year>2017</year>
        <volume>550</volume>
        <fpage>451</fpage>
        <lpage>453</lpage>
        <pub-id pub-id-type="doi">10.1038/550451a</pub-id>
        <?supplied-pmid 29072289?>
        <pub-id pub-id-type="pmid">29072289</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Snyder</surname>
            <given-names>MP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The human body at cellular resolution: the NIH human biomolecular atlas program</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>574</volume>
        <fpage>187</fpage>
        <lpage>192</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1629-x</pub-id>
        <pub-id pub-id-type="pmid">31597973</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mereu</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking single-cell RNA-sequencing protocols for cell atlas projects</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2020</year>
        <volume>38</volume>
        <fpage>747</fpage>
        <lpage>755</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0469-4</pub-id>
        <?supplied-pmid 32518403?>
        <pub-id pub-id-type="pmid">32518403</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tabula Muris Consortium</surname>
          </name>
          <etal/>
        </person-group>
        <article-title>A single cell transcriptomic atlas characterizes aging tissues in the mouse</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>583</volume>
        <fpage>590</fpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2496-1</pub-id>
        <pub-id pub-id-type="pmid">32669714</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gehring</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Hwee Park</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Thomson</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Highly multiplexed single-cell RNA-seq by DNA oligonucleotide tagging of cellular proteins</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2020</year>
        <volume>38</volume>
        <fpage>35</fpage>
        <lpage>38</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0372-z</pub-id>
        <?supplied-pmid 31873215?>
        <pub-id pub-id-type="pmid">31873215</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luecken</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Current best practices in single-cell RNA-seq analysis: a tutorial</article-title>
        <source>Mol. Syst. Biol.</source>
        <year>2019</year>
        <volume>15</volume>
        <fpage>e8746</fpage>
        <pub-id pub-id-type="doi">10.15252/msb.20188746</pub-id>
        <?supplied-pmid 31217225?>
        <pub-id pub-id-type="pmid">31217225</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pandey</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Zafar</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Inference of cell state transitions and cell fate plasticity from single-cell with MARGARET</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2022</year>
        <volume>50</volume>
        <fpage>e86</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkac412</pub-id>
        <?supplied-pmid 35639499?>
        <pub-id pub-id-type="pmid">35639499</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Argelaguet</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Cuomo</surname>
            <given-names>AS</given-names>
          </name>
          <name>
            <surname>Stegle</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Computational principles and challenges in single-cell data integration</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>1202</fpage>
        <lpage>1215</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-00895-7</pub-id>
        <?supplied-pmid 33941931?>
        <pub-id pub-id-type="pmid">33941931</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lähnemann</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Eleven grand challenges in single-cell data science</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>1</fpage>
        <lpage>35</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-1926-6</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kiselev</surname>
            <given-names>VY</given-names>
          </name>
          <name>
            <surname>Yiu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hemberg</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>scmap: projection of single-cell RNA-seq data across data sets</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>359</fpage>
        <lpage>362</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4644</pub-id>
        <?supplied-pmid 29608555?>
        <pub-id pub-id-type="pmid">29608555</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ge</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Alavi</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Xing</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Bar-Joseph</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Supervised adversarial alignment of single-cell RNA-seq data</article-title>
        <source>J. Comput. Biol.</source>
        <year>2021</year>
        <volume>28</volume>
        <fpage>501</fpage>
        <lpage>513</lpage>
        <pub-id pub-id-type="doi">10.1089/cmb.2020.0439</pub-id>
        <?supplied-pmid 33470876?>
        <pub-id pub-id-type="pmid">33470876</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id>
        <?supplied-pmid 31740819?>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hie</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Bryson</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Berger</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Efficient integration of heterogeneous single-cell transcriptomes using Scanorama</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>685</fpage>
        <lpage>691</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0113-3</pub-id>
        <?supplied-pmid 31061482?>
        <pub-id pub-id-type="pmid">31061482</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Polański</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>BBKNN: fast batch alignment of single cell transcriptomes</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>964</fpage>
        <lpage>965</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btz625</pub-id>
        <?supplied-pmid 31400197?>
        <pub-id pub-id-type="pmid">31400197</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Welch</surname>
            <given-names>JD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell multi-omic integration compares and contrasts features of brain cell identity</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1873</fpage>
        <lpage>1887</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.006</pub-id>
        <?supplied-pmid 31178122?>
        <pub-id pub-id-type="pmid">31178122</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
        <?supplied-pmid 30504886?>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deep learning enables accurate clustering with batch effect removal in single-cell RNA-seq analysis</article-title>
        <source>Nat. Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>1</fpage>
        <lpage>14</lpage>
        <pub-id pub-id-type="pmid">31911652</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>iMAP: integration of multiple single-cell datasets by adversarial paired transfer networks</article-title>
        <source>Genome Biol.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>1</fpage>
        <lpage>24</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-021-02280-8</pub-id>
        <pub-id pub-id-type="pmid">33397451</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <mixed-citation publication-type="other">Kodali, N., Abernethy, J., Hays, J. &amp; Kira, Z. On convergence and stability of GANs. Preprint at <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1705.07215">https://arxiv.org/abs/1705.07215</ext-link> (2017).</mixed-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">Luecken, M. D. et al. Benchmarking atlas-level data integration in single-cell genomics. <italic>Nat. Methods</italic><bold>19</bold>, 41–50 (2022).</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <mixed-citation publication-type="other">Oetjen, K. A. et al. Human bone marrow assessment by single-cell RNA sequencing, mass cytometry, and flow cytometry. <italic>JCI Insight</italic><bold>3</bold>, e124928 (2018).</mixed-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>GX</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>
        <source>Nat. Commun.</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>14049</fpage>
        <pub-id pub-id-type="doi">10.1038/ncomms14049</pub-id>
        <?supplied-pmid 28091601?>
        <pub-id pub-id-type="pmid">28091601</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Freytag, S., Tian, L., Lönnstedt, I., Ng, M. &amp; Bahlo, M. Comparison of clustering tools in R for medium-sized 10x genomics single-cell RNA-sequencing data. <italic>F1000Res.</italic><bold>7</bold>, 1297 (2018).</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A Bayesian mixture model for clustering droplet-based single-cell transcriptomic data from population studies</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>1</fpage>
        <lpage>10</lpage>
        <pub-id pub-id-type="pmid">30602773</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Villani</surname>
            <given-names>A-C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA-seq reveals new types of human blood dendritic cells, monocytes, and progenitors</article-title>
        <source>Science</source>
        <year>2017</year>
        <volume>356</volume>
        <fpage>eaah4573</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aah4573</pub-id>
        <?supplied-pmid 28428369?>
        <pub-id pub-id-type="pmid">28428369</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xu</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Probabilistic harmonization and annotation of single-cell transcriptomics data with deep generative models</article-title>
        <source>Mol. Syst. Biol.</source>
        <year>2021</year>
        <volume>17</volume>
        <fpage>e9620</fpage>
        <pub-id pub-id-type="doi">10.15252/msb.20209620</pub-id>
        <?supplied-pmid 33491336?>
        <pub-id pub-id-type="pmid">33491336</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lotfollahi</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>scGen predicts single-cell perturbation responses</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>715</fpage>
        <lpage>721</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0494-8</pub-id>
        <?supplied-pmid 31363220?>
        <pub-id pub-id-type="pmid">31363220</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <mixed-citation publication-type="other">Kanemaru, K. et al. Spatially resolved multiomics of human cardiac niches. <italic>Nature</italic><bold>619</bold>, 801–810 (2023).</mixed-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>Batch alignment of single-cell transcriptomics data using deep metric learning</article-title>
        <source>Nat. Commun.</source>
        <year>2023</year>
        <volume>14</volume>
        <fpage>960</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-023-36635-5</pub-id>
        <?supplied-pmid 36810607?>
        <pub-id pub-id-type="pmid">36810607</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Peng</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular classification and comparative taxonomics of foveal and peripheral cells in primate retina</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>176</volume>
        <fpage>1222</fpage>
        <lpage>1237</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.01.004</pub-id>
        <?supplied-pmid 30712875?>
        <pub-id pub-id-type="pmid">30712875</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Han</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping the mouse cell atlas by microwell-seq</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>172</volume>
        <fpage>1091</fpage>
        <lpage>1107</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.02.001</pub-id>
        <?supplied-pmid 29474909?>
        <pub-id pub-id-type="pmid">29474909</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Han</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Construction of a human cell landscape at single-cell level</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>581</volume>
        <fpage>303</fpage>
        <lpage>309</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2157-4</pub-id>
        <?supplied-pmid 32214235?>
        <pub-id pub-id-type="pmid">32214235</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Mukherjee</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kannan</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>A deep adversarial variational autoencoder model for dimensionality reduction in single-cell RNA sequencing analysis</article-title>
        <source>BMC Bioinformatics</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>1</fpage>
        <lpage>11</lpage>
        <pub-id pub-id-type="doi">10.1186/s12859-020-3401-5</pub-id>
        <pub-id pub-id-type="pmid">31898485</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Litviňuková</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cells of the adult human heart</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>588</volume>
        <fpage>466</fpage>
        <lpage>472</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2797-4</pub-id>
        <?supplied-pmid 32971526?>
        <pub-id pub-id-type="pmid">32971526</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <mixed-citation publication-type="other">Suo, C. et al. Mapping the developing human immune system across organs. <italic>Science</italic><bold>376</bold>, eabo0510 (2022).</mixed-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Jones, R. C. et al. The Tabula Sapiens: a multiple-organ, single-cell transcriptomic atlas of humans. <italic>Science</italic><bold>376</bold>, eabl4896 (2022).</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Kingma, D. P. &amp; Ba, J. Adam: a method for stochastic optimization. Preprint at <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1412.6980">https://arxiv.org/abs/1412.6980</ext-link> (2014).</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ding</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Deep generative model embedding of single-cell RNA-seq profiles on hyperspheres and hyperbolic spaces</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>1</fpage>
        <lpage>17</lpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-22851-4</pub-id>
        <pub-id pub-id-type="pmid">33397941</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kingma</surname>
            <given-names>DP</given-names>
          </name>
          <name>
            <surname>Mohamed</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Jimenez Rezende</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Welling</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Semi-supervised learning with deep generative models</article-title>
        <source>Adv. Neural Inf. Process. Syst.</source>
        <year>2014</year>
        <volume>27</volume>
        <fpage>3581</fpage>
        <lpage>3589</lpage>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>1</fpage>
        <lpage>5</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id>
        <pub-id pub-id-type="pmid">29301551</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rand</surname>
            <given-names>WM</given-names>
          </name>
        </person-group>
        <article-title>Objective criteria for the evaluation of clustering methods</article-title>
        <source>J. Am. Stat. Assoc.</source>
        <year>1971</year>
        <volume>66</volume>
        <fpage>846</fpage>
        <lpage>850</lpage>
        <pub-id pub-id-type="doi">10.1080/01621459.1971.10482356</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hubert</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Arabie</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Comparing partitions</article-title>
        <source>J. Classif.</source>
        <year>1985</year>
        <volume>2</volume>
        <fpage>193</fpage>
        <lpage>218</lpage>
        <pub-id pub-id-type="doi">10.1007/BF01908075</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Büttner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Miao</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>A test metric for assessing single-cell RNA-seq batch correction</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>43</fpage>
        <lpage>49</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0254-1</pub-id>
        <?supplied-pmid 30573817?>
        <pub-id pub-id-type="pmid">30573817</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Simon</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Y-Y</given-names>
          </name>
          <name>
            <surname>Zhao</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Integration of millions of transcriptomes using batch-aware triplet neural networks</article-title>
        <source>Nat. Mach. Intell.</source>
        <year>2021</year>
        <volume>3</volume>
        <fpage>705</fpage>
        <lpage>715</lpage>
        <pub-id pub-id-type="doi">10.1038/s42256-021-00361-8</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <mixed-citation publication-type="other">Shree, A., Musale, K. P. &amp; Zafar, H. Zafar-lab/scdreamer. Zenodo 10.5281/zenodo.10021620 (2023).</mixed-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <mixed-citation publication-type="other">Shree, A., Musale, K. P. &amp; Zafar, H. Zafar-lab/scdreamer-reproducibility. Zenodo 10.5281/zenodo.10021936 (2023).</mixed-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10682386</article-id>
    <article-id pub-id-type="pmid">38012145</article-id>
    <article-id pub-id-type="publisher-id">43590</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-43590-8</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scDREAMER for atlas-level integration of single-cell datasets using deep generative model paired with adversarial classifier</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1064-6238</contrib-id>
        <name>
          <surname>Shree</surname>
          <given-names>Ajita</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7856-8224</contrib-id>
        <name>
          <surname>Pavan</surname>
          <given-names>Musale Krushna</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1617-2806</contrib-id>
        <name>
          <surname>Zafar</surname>
          <given-names>Hamim</given-names>
        </name>
        <address>
          <email>hamim@iitk.ac.in</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/05pjsgx75</institution-id><institution-id institution-id-type="GRID">grid.417965.8</institution-id><institution-id institution-id-type="ISNI">0000 0000 8702 0100</institution-id><institution>Department of Computer Science and Engineering, </institution><institution>Indian Institute of Technology Kanpur, </institution></institution-wrap>Kanpur, India </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/05pjsgx75</institution-id><institution-id institution-id-type="GRID">grid.417965.8</institution-id><institution-id institution-id-type="ISNI">0000 0000 8702 0100</institution-id><institution>Department of Biological Sciences and Bioengineering, </institution><institution>Indian Institute of Technology Kanpur, </institution></institution-wrap>Kanpur, India </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/05pjsgx75</institution-id><institution-id institution-id-type="GRID">grid.417965.8</institution-id><institution-id institution-id-type="ISNI">0000 0000 8702 0100</institution-id><institution>Mehta Family Centre for Engineering in Medicine, </institution><institution>Indian Institute of Technology Kanpur, </institution></institution-wrap>Kanpur, India </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>7781</elocation-id>
    <history>
      <date date-type="received">
        <day>13</day>
        <month>7</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>14</day>
        <month>11</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Integration of heterogeneous single-cell sequencing datasets generated across multiple tissue locations, time, and conditions is essential for a comprehensive understanding of the cellular states and expression programs underlying complex biological systems. Here, we present scDREAMER (<ext-link ext-link-type="uri" xlink:href="https://github.com/Zafar-Lab/scDREAMER">https://github.com/Zafar-Lab/scDREAMER</ext-link>), a data-integration framework that employs deep generative models and adversarial training for both unsupervised and supervised (scDREAMER-Sup) integration of multiple batches. Using six real benchmarking datasets, we demonstrate that scDREAMER can overcome critical challenges including skewed cell type distribution among batches, nested batch-effects, large number of batches and conservation of development trajectory across batches. Our experiments also show that scDREAMER and scDREAMER-Sup outperform state-of-the-art unsupervised and supervised integration methods respectively in batch-correction and conservation of biological variation. Using a 1 million cells dataset, we demonstrate that scDREAMER is scalable and can perform atlas-level cross-species (e.g., human and mouse) integration while being faster than other deep-learning-based methods.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Integration of single-cell datasets is essential to gain a comprehensive understanding of complex biological systems. Here, the authors develop scDREAMER, a deep generative framework for performing unsupervised and supervised atlas-level integration, demonstrating improved bio-conservation and batch-correction.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Data integration</kwd>
      <kwd>Computational models</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">501100001403</institution-id>
            <institution>Indian Institute of Technology Kanpur (IITK)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>IITK /CS /2019236</award-id>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">The exploration of cellular heterogeneity and developmental trajectories in different tissue systems has been revolutionized by the rapid advances of single-cell RNA-sequencing technologies<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR3">3</xref></sup>. This rapid development coupled with large-scale collaborative initiatives such as the Human Cell Atlas (HCA) and Human BioMolecular Atlas Program (HuBMAP)<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR5">5</xref></sup> have increased the complexity of single-cell datasets which can include samples contributed by different laboratories<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>, generated across tissue locations, time and conditions<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR8">8</xref></sup>. Since single-cell datasets generated from similar biological contexts but different experimental conditions can share cellular features<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, integration of information from heterogeneous data sources can facilitate the discovery of major and rare cell types, improve the reconstruction of developmental trajectories<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and lead to more reliable investigation of complex biological systems. However, the intrinsic differences in measured gene expression among experimental settings contributed by factors such as sequencing protocols, library preparation, sample donors, tissue of origin, sampling time and condition inevitably create complex, nested batch effects that can diminish the value of data integration by confounding biological signals<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>. Thus the development of computational data integration methods that can reliably eliminate the complex batch effects without undermining biological variations is a major challenge in scRNA-seq analysis<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>.</p>
    <p id="Par4">Existing methods for the integration of scRNA-seq datasets can be broadly classified into two groups. The first group of methods employs cell type annotations for supervised cross-batch learning<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR14">14</xref></sup> while removing batch effects. The requirement for cell type annotations limits their applications as novel cell types cannot be captured. In comparison, unsupervised data integration methods<sup><xref ref-type="bibr" rid="CR15">15</xref>–<xref ref-type="bibr" rid="CR18">18</xref></sup> that do not require cell type annotations are more widely used. Some of these methods identify the batch-specific gene factors from the gene expression profiles<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. Methods such as BBKNN, Scanorama and Seurat v3 employ global mutual nearest neighbors (MNNs), i.e., paired cells between multiple batches for batch correction of the neighborhood using reduced-dimension cellular spaces. Harmony<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> achieves better batch mixing by applying a novel local correction. These MNN-based methods consume a large memory and low-quality MNNs can make it difficult to simultaneously identify dataset-specific cell types and the cell types that are shared by multiple datasets. Methods such as scVI<sup><xref ref-type="bibr" rid="CR20">20</xref></sup> and DESC<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> that employ deep variational autoencoders for learning cellular embeddings from scRNA-seq can also integrate data from multiple batches. However, the traditional autoencoder models are challenged due to lower fidelity in reproducing the batch-corrected expression profiles<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. Another method, iMAP<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> combines generative adversarial networks (GANs) with autoencoder for learning batch-ignorant cellular representations, however its dependence on MNN pairs to train the GAN can lead to sub-optimal integration due to low-quality MNN and unstable training of GAN<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. A recent benchmarking study<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> showed that methods such as Harmony and Seurat perform well for simple integration tasks but poorly for complex integration tasks and vice versa for Scanorama and scVI and a consistent tradeoff exists between batch-correction and preservation of biological variations.</p>
    <p id="Par5">To overcome the existing challenges, here we present a deep learning-based data integration framework, called scDREAMER (<underline>s</underline>ingle-<underline>c</underline>ell <underline>D</underline>eep gene<underline>R</underline>ativ<underline>E</underline> integr<underline>A</underline>tion <underline>M</underline>odel with adv<underline>E</underline>rsarial classifie<underline>R</underline>) that performs the integration of multiple batches in unsupervised (no cell type annotations required), semi-supervised and supervised (available cell type annotation are utilized) manner. The unsupervised version of scDREAMER employs an adversarial variational autoencoder and a batch classifier (a multi-layer neural network) which are trained adversarially for learning batch-invariant lower-dimensional cellular embeddings. The supervised version, scDREAMER-Sup, employs an additional variational autoencoder and a cell type classifier (another feed-forward neural network) to utilize available cell type annotations for a semi-supervised or supervised inference of cellular latent spaces. Using multiple real datasets consisting of up to 1 million cells and 147 batches (Supplementary Table <xref rid="MOESM1" ref-type="media">1)</xref>, we demonstrate that scDREAMER is able to overcome a variety of integration challenges including the presence of skewed cell types among batches (pancreas integration), nested batch effects (lung integration), large number of batches (heart atlas and macaque retina integration) and conservation of development trajectory across different batches (human immune integration). Using these integration tasks, we further show that scDREAMER achieves better performance in batch-correction and conservation of biological variation against that of the state-of-the-art unsupervised methods. The supervised version of scDREAMER, scDREAMER-Sup improves upon scDREAMER in terms of conservation of biological variation while retaining superior performance in batch-correction and outperforms other state-of-the-art supervised and unsupervised integration methods. For a challenging heart atlas dataset, which several methods failed to integrate due to a large number of batches and complex nested batch effects, scDREAMER and scDREAMER-Sup outperform the other methods by a large margin. Our experiments also show that scDREAMER and scDREAMER-Sup can reliably identify rare cell types. Using semi-supervised integration settings, we also demonstrate scDREAMER-Sup’s superiority over other methods in predicting the cell type labels for the cells missing annotations. Finally, using a 1 million cells dataset, we demonstrate that scDREAMER is highly scalable, can perform atlas-level data integration across different species, and achieves runtime advantage over some other deep-learning-based integration methods.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Overview of scDREAMER</title>
      <p id="Par6">Figure <xref rid="Fig1" ref-type="fig">1</xref> shows the overview of both the unsupervised and supervised models of scDREAMER. The unsupervised model (we will refer it to as scDREAMER) employs an adversarial variational autoencoder for learning the lower-dimensional representation of cells from the high-dimensional scRNA-seq data and a neural network classifier (also called a batch classifier) for the removal of batch effects. scDREAMER models the scRNA-seq data as a nonlinear function of a lower-dimensional cell-state embedding and the batch information that encodes the variation in data generation. The adversarial variational autoencoder of scDREAMER consists of three multi-layer neural networks: an encoder <italic>E</italic> that maps the high-dimensional expression data (<italic>x</italic><sub><italic>i</italic></sub>) and batch information (<italic>s</italic><sub><italic>i</italic></sub>) of a cell <italic>i</italic> to a lower-dimensional embedding <italic>z</italic><sub><italic>i</italic></sub>, a decoder <italic>D</italic>, which reconstructs the expression profile of the cell from <italic>z</italic><sub><italic>i</italic></sub> and <italic>s</italic><sub><italic>i</italic></sub>, and a discriminator <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M2"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq1.gif"/></alternatives></inline-formula> that aims to distinguish the original expression profile <italic>x</italic><sub><italic>i</italic></sub> and the expression profile reconstructed (<inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{{x}_{i}}$$\end{document}</tex-math><mml:math id="M4"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq2.gif"/></alternatives></inline-formula>) by the decoder. The adversarial variational autoencoder network of scDREAMER is trained using two loss functions: evidence lower bound (ELBO) is used for training the encoder and decoder networks, whereas Bhattacharyya loss is used for adversarial training of discriminator and autoencoder parameters. scDREAMER further incorporates a batch classifier <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M6"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq3.gif"/></alternatives></inline-formula> (a multi-layer neural network) that takes as input the lower-dimensional embedding <italic>z</italic><sub><italic>i</italic></sub> learned by the encoder and tries to predict the batch information for cell <italic>i</italic>. The batch classifier and the encoder are adversarially trained using a cross-entropy loss where the encoder tries to maximize it with an aim to generate the embeddings such that the classifier is not able to differentiate between batches and the batch classifier tries to minimize it by distinguishing the embeddings of the cells coming from different batches and hence achieving better mixing of the batches (see “Methods” section for details).<fig id="Fig1"><label>Fig. 1</label><caption><title>Overview of scDREAMER and scDREAMER-Sup.</title><p>scDREAMER consists of an adversarial variational autoencoder and a batch classifier. The adversarial variational autoencoder comprises of three networks: an encoder, a decoder, and a discriminator, and these networks are trained using ELBO and Bhattacharya loss functions. The batch classifier is adversarially trained along with the encoder using a cross-entropy loss. scDREAMER learns latent cellular embeddings such that the cells from different batches are well-mixed and different cell types are separated leading to the conservation of biological variations. scDREAMER-Sup consists of an additional variational autoencoder and a cell-type classifier in addition to the components in scDREAMER. The hierarchical variational autoencoder is trained using an ELBO loss. The cell type classifier is trained using a cross-entropy loss. scDREAMER-Sup learns latent cellular embeddings such that the cells from different batches are well-mixed with improved conservation of biological variations.</p></caption><graphic xlink:href="41467_2023_43590_Fig1_HTML" id="d32e418"/></fig></p>
      <p id="Par7">We further extended the scDREAMER model to utilize available cell type annotations (Fig. <xref rid="Fig1" ref-type="fig">1</xref>) for a guided inference of cellular latent space <italic>z</italic><sub><italic>i</italic></sub>. The extended model, scDREAMER-Sup assumes an informative prior on <italic>z</italic><sub><italic>i</italic></sub> conditioned on cell type label <italic>c</italic><sub><italic>i</italic></sub> and another Gaussian latent variable <italic>y</italic><sub><italic>i</italic></sub> that accounts for within cell type variability. For learning the hierarchically structured <italic>z</italic><sub><italic>i</italic></sub>, scDREAMER-Sup employs an additional variational autoencoder consisting of an encoder <italic>E</italic><sub><italic>y</italic></sub> that learns <italic>y</italic><sub><italic>i</italic></sub> from <italic>z</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub> and a decoder <italic>D</italic><sub><italic>y</italic></sub> that reconstructs <italic>z</italic><sub><italic>i</italic></sub> from <italic>y</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub> such that a more informative prior can be used for <italic>z</italic><sub><italic>i</italic></sub> in the adversarial variational autoencoder. The two variational autoencoders are jointly trained using an updated ELBO function (see “Methods” for details). scDREAMER-Sup further employs a feed-forward neural network (also called cell type classifier), <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M8"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq4.gif"/></alternatives></inline-formula>, for learning <italic>c</italic><sub><italic>i</italic></sub> from <italic>z</italic><sub><italic>i</italic></sub> which is trained using a cross-entropy loss using the available cell type annotations. For cells without cell type annotations, scDREAMER-Sup learns the missing cell type labels using <inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M10"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq5.gif"/></alternatives></inline-formula>. <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M12"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq6.gif"/></alternatives></inline-formula> and <inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M14"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq7.gif"/></alternatives></inline-formula> are trained in the same way as in scDREAMER.</p>
    </sec>
    <sec id="Sec4">
      <title>scDREAMER integrates pancreatic islet data generated using different sequencing protocols</title>
      <p id="Par8">We first tested scDREAMER’s ability to perform integration and batch correction across different sequencing protocols using a human pancreas dataset consisting of 16,382 cells (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1a)</xref>. The dataset consisted of nine sub-datasets generated using distinct sequencing protocols including CEL-seq, CEL-seq2, Fluidigm C1, SMART-seq2, and inDrop. The dataset harbored 14 pancreatic cell types including acinar cells, activated and quiescent stellate cells, alpha cells, beta cells, delta cells, ductal cells, endothelial cells, epsilon cells, gamma cells, macrophages, mast cells, Schwann cells and T cells. scDREAMER’s integration performance was compared against that of nine other integration methods. scDREAMER was able to almost perfectly separate all the cell types and mix the shared cell types across different protocols (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a, b). In comparison, integration by scVI, BBKNN, Scanorama, INSCT, and iMAP led to restricted mixing of the different batches (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1b–j)</xref>. While Harmony, Seurat, scDML and LIGER were also able to mix the batches well, Harmony was not able to clearly distinguish activated and quiescent stellate cells, Seurat improperly mixed some alpha cells with beta and ductal cells, scDML fragmented alpha and beta cells into multiple clusters and mixed some alpha cells with ductal and acinar cells, and LIGER mixed some alpha, beta, and gamma cells.<fig id="Fig2"><label>Fig. 2</label><caption><title>Integration of pancreatic islet data.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after integration of pancreatic islet dataset. Different colors denote different pancreatic cell types. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on batch information. Comparison of <bold>c</bold> composite bio-conservation score, <bold>d</bold> composite batch-correction score and <bold>e</bold> combined composite score metrics between scVI, Harmony, Seurat, BBKNN, Scanorama, INSCT, LIGER, iMAP, scDML and scDREAMER. <bold>f</bold> Comparison of composite isolated label scores to assess how well rare cell types are identified. <bold>g</bold> Comparison of iLISI and cLISI values. Each box-and-whisker plot summarizes LISI values (<italic>n</italic> = 8208 cells, ~50% of the cells in the dataset as suggested in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup>), the box denotes the interquartile range (IQR, the range between the 25th and 75th percentile) with the median value, whiskers indicate the maximum and minimum value within 1.5 times the IQR, outliers are denoted by black circles. <bold>h</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>i</bold> Quantitative assessment of batch-mixing of scDREAMER against LIGER and Harmony based on the percentage of positive vs true positive cells. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig2_HTML" id="d32e619"/></fig></p>
      <p id="Par9">Next, we quantitatively compared scDREAMER’s performance against that of the other methods based on four composite accuracy scores. Composite bio-conservation score measures the accuracy of a method in preserving biological variance after integration and considers global clustering accuracy (normalized mutual information (NMI) and Adjusted Rand Index (ARI)) and relative distances between clusters (cell type average silhouette width (ASW)). The accuracy of batch effect removal was measured using a composite batch-correction score which considers four different metrics including the k-nearest-neighbor batch effect test (kBET), ASW across batches, k-nearest-neighbor (kNN) graph connectivity and batch removal using PCA regression. The combined composite score computes the average of composite bio-conservation and composite batch-correction scores. We also used a composite isolated label score that evaluates the ability of a method to capture rare cell identities based on f1 score and silhouette coefficient in identifying the rare cells.</p>
      <p id="Par10">scDREAMER consistently outperformed all other methods by achieving the highest combined composite score (~12.9% improvement over the second-best method) which was driven by scDREAMER’s superior performance in both conservation of biological variance and batch correction (Fig. <xref rid="Fig2" ref-type="fig">2</xref>c–e). While scVI and Harmony performed similar to scDREAMER in terms of NMI and ARI metrics, scDREAMER, scDML and Harmony performed better in terms of cell type ASW (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a)</xref>. scDREAMER achieved the best composite batch-correction score because of its superior performance in terms of multiple batch-correction metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3b)</xref>. scDREAMER also performed well in capturing the rare cell identities as it achieved the second-best isolated f1 score (Fig. <xref rid="Fig2" ref-type="fig">2</xref>f, Supplementary Fig. <xref rid="MOESM1" ref-type="media">2c)</xref>. While Harmony was the second-best method in terms of the combined composite score, it performed poorly in terms of composite isolated label score indicating its inability to capture the rare cell identities correctly. We also measured the local inverse Simpson’s Index scores (iLISI for batch mixing and cLISI for cell-type separation) at the single-cell level and based on these metrics, scDREAMER’s performance was comparable to that of Harmony and Seurat and better than all other methods (Fig. <xref rid="Fig2" ref-type="fig">2</xref>g). We further adopted another single-cell level evaluation measure which computes the proportion of “positive” (cells connected to other cells only from the same cell type) and “true positive” (fraction of positive cells whose local and global batch distributions are congruous) cells after integration and used these summary metrics to compare scDREAMER’s performance against that of Harmony (second-best method in terms of combined composite score) and scDML (best method in terms of isolated label score). Again, scDREAMER outperformed both Harmony and scDML based on the proportion of positive and true positive cells (Fig. <xref rid="Fig2" ref-type="fig">2</xref>h, i).</p>
      <p id="Par11">To determine scDREAMER’s ability to capture novel cell types, we performed two experiments where a specific cell type (alpha and delta cells respectively) was held out during training and the trained network was later used to obtain their embeddings. For both the held-out cell types, scDREAMER captured them very well in a separate cluster (also indicated by high values of composite bio-conservation and batch correction score for the held-out cell type) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a–c)</xref> and as scDREAMER’s network weights got updated after including the held-out cell type in training for certain epochs, their representation further improved as indicated by an improvement in the combined composite score (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3c)</xref>.</p>
    </sec>
    <sec id="Sec5">
      <title>scDREAMER integrates lung cells obtained from different human donors</title>
      <p id="Par12">Next, we applied scDREAMER for the integration of lung atlas data consisting of 32,472 cells from lung transplant and biopsy samples from 16 donors sequenced using 10X and drop-seq (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a)</xref>. The integration of this dataset poses several challenges including inter-donor variability, protocol-specific batch effects (10X samples A1-A6, 1-6; drop-seq samples B1-B4), and variability across sampling type and tissue locations. Specifically, cell type composition varied between the transplant samples (1-6, B1-B4) that are obtained from lung parenchyma and the biopsy samples (A1-A6) obtained from lung airways. Two basal cell types, ciliated and secretory cells were majorly present in the biopsy samples but the transplant samples harbored them only as minor populations or in some cases the cell types were absent. The dataset also contained rare cell types present across a few donors (ionocytes). Furthermore, the endothelial and secretory cells should vary across biopsy and transplant samples due to transcriptome being affected by tissue location.</p>
      <p id="Par13">scDREAMER was able to successfully integrate the batches across sequencing protocols overcoming donor-level variation (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a, b, Supplementary Fig. <xref rid="MOESM1" ref-type="media">5a, b)</xref>. Only scDREAMER, scVI, and iMAP were clearly able to identify rare ionocytes as a separate cluster, whereas the other methods mixed them with other cell types (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a, Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b–j)</xref>. scDREAMER was able to identify all biopsy-specific cell types and also preserved basal cell subtypes. The secretory cells from the biopsy and transplant samples were separated by scDREAMER (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a). The lymphatic and endothelial cells were incorrectly merged by Harmony, Seurat and INSCT whereas Scanorama, scVI, LIGER and scDREAMER were able to identify them as separate clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b–j)</xref>. The endothelial cells were separated into three clusters by Scanorama, two of which corresponded to transplant samples indicating incomplete integration of these samples. Integration of iMAP was poor as it divided multiple cell types (e.g., macrophages, endothelial cells, etc.) into different batch-specific clusters. Integration by scDML also led to the merging of some cell types (macrophages, basal 1 and 2, dendritic cells) and fragmentation of the same cell type (T/NK cells, Type 2 cells) into multiple clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4j)</xref>. scDREAMER was able to preserve the spatial variation of endothelial cells at a higher resolution.<fig id="Fig3"><label>Fig. 3</label><caption><title>Integration of lung atlas data.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after integration of lung atlas dataset. Different colors denote different lung cell types. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>c</bold> composite bio-conservation score, <bold>d</bold> composite batch-correction score and <bold>e</bold> combined composite score metrics between scVI, Harmony, Seurat, BBKNN, Scanorama, INSCT, LIGER, iMAP, scDML and scDREAMER for the integration of lung atlas data. <bold>f</bold> Comparison of composite isolated label scores to assess how well rare cell types are identified. <bold>g</bold> Comparison of iLISI and cLISI values. Each box-and-whisker plot summarizes LISI values (<italic>n</italic> = 16,274 cells, ~50% of the cells in the dataset as suggested in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup>), the box denotes the interquartile range (IQR, the range between the 25th and 75th percentile) with the median value, whiskers indicate the maximum and minimum value within 1.5 times the IQR, outliers are denoted by black circles. <bold>h</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>i</bold> Quantitative assessment of batch-mixing of scDREAMER against scVI and Harmony based on the percentage of positive vs true positive cells. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig3_HTML" id="d32e727"/></fig></p>
      <p id="Par14">scDREAMER performed superior to all other methods in terms of both bio-conservation and batch correction achieving the highest combined composite score (Fig. <xref rid="Fig3" ref-type="fig">3</xref>c–e). scDREAMER outperformed all the methods in terms of all three bio-conservation metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a)</xref> and also performed well in terms of different batch correction metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b)</xref>. In capturing rare cell identities, scDREAMER performed comparably with the top-performing methods (Fig. <xref rid="Fig3" ref-type="fig">3</xref>f, Supplementary Fig. <xref rid="MOESM1" ref-type="media">6c)</xref> achieving the highest isolated f1 score. In terms of LISI metrics, scDREAMER performed the best in terms of cLISI and comparably to scVI and Harmony in terms of iLISI metrics outperforming all other methods (Fig. <xref rid="Fig3" ref-type="fig">3</xref>g). We further compared scDREAMER’s performance against that of scVI and Harmony (second and third-best methods based on combined composite score respectively) by measuring the proportion of positive and true positive cells. Due to the close spacing of dendritic cells and Neutrophil subtypes in the embedding, we observed the presence of a large number of negative cells for these cell types (same observation for the embedding of other methods). While scVI had the highest proportion of positive cells, scDREAMER outperformed both methods based on the proportion of true positive cells (Fig. <xref rid="Fig3" ref-type="fig">3</xref>h, i) without sacrificing much in terms of positive proportion.</p>
    </sec>
    <sec id="Sec6">
      <title>scDREAMER integrates human immune cells from peripheral blood and bone marrow of different donors</title>
      <p id="Par15">We next evaluated scDREAMER’s integration and batch correction performance for integrating 33,506 human immune cells obtained in ten batches corresponding to different donors and the cells were sampled from bone marrow and peripheral blood (PBMCs) and the sequencing was performed using two protocols (10X and smart-seq2) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7a)</xref>. Out of 33,506 cells, 9581 cells were sampled from bone marrow and comprised of three batches (Oetjen et al.<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>), and the rest 23,985 bone marrow cells comprised of seven batches (10X Genomics<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>, Freytag<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>, Sun et al.<sup><xref ref-type="bibr" rid="CR28">28</xref></sup> batches and Villani et al.<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>). While the cells in ref. <sup><xref ref-type="bibr" rid="CR29">29</xref></sup> were sequenced using smart-seq2, all other batches were sequenced using 10X Genomics protocol. This integration task poses several challenges including donor-level variability, sequencing protocol-specific batch effects, and cell types spanning multiple tissues. In addition, the dataset also contained cell subtypes that are difficult to distinguish because of transcriptional similarity (e.g., CD8<sup>+</sup> and CD4<sup>+</sup> T cells; CD14<sup>+</sup> and CD16<sup>+</sup> monocytes) and some tissue-specific cell types (e.g., monocyte progenitors, erythroid progenitors, erythrocytes and CD10<sup>+</sup> B cells were only present in bone marrow) that need to be identified as separate clusters. Finally, the dataset also harbored the developmental trajectory of erythrocytes from hematopoietic stem and progenitor cells (HSPCs) via megakaryocyte and erythroid progenitors and the conservation of this trajectory across batches is an important aspect of this integration task.</p>
      <p id="Par16">scDREAMER was able to resolve the inter-sample and inter-platform batch effects while integrating the human immune dataset as indicated by disjoint well-mixed cell type clusters (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a, b). scDREAMER was successful in clustering together the same cell types across tissues while identifying cell subtypes, such as CD8<sup>+</sup> and CD4<sup>+</sup> T cells, CD20<sup>+</sup> and CD10<sup>+</sup> B cells, CD14<sup>+</sup> and CD16<sup>+</sup> monocytes, as distinct closely located clusters. In comparison, CD20<sup>+</sup> and CD10<sup>+</sup> B cells were distantly placed in BBKNN and Scanorama embeddings (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7e, f)</xref> and CD20<sup>+</sup> B cells were fragmented into two clusters in scDML embeddings (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7j)</xref>. While scDREAMER was able to place monocyte-derived dendritic cells and plasmacytoid dendritic cells in separate clusters in close vicinity (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a, b), other methods such as Harmony, Seurat, scDML and INSCT (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7c, d, g)</xref> placed these cell subtypes far apart in the embedding. Furthermore, scVI separated monocyte-derived dendritic cells into multiple clusters, one of which was mixed with other distinct cell types (e.g., megakaryocyte progenitors, plasma cells, CD4<sup>+</sup> T cells, etc.) indicating poor clustering (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7b)</xref>. Finally, scDREAMER clearly separated tissue-specific cell types and exhibited a perfect continuum of bone marrow cell types after integration, preserving the trajectory from HSPCs to erythrocytes (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a, b, Supplementary Fig. <xref rid="MOESM1" ref-type="media">8a, b)</xref>. In contrast, methods such as Seurat, INSCT, LIGER and scDML (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7d, g, h, j)</xref> failed to conserve the trajectory of erythrocyte development, whereas, iMAP divided the erythroid trajectory into three batch-specific trajectories (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7i)</xref>.<fig id="Fig4"><label>Fig. 4</label><caption><title>Integration of human immune data.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after integration of human immune dataset. Different colors denote different cell types present in the human immune dataset. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>c</bold> composite bio-conservation score, <bold>d</bold> composite batch-correction score and <bold>e</bold> combined composite score metrics between scVI, Harmony, Seurat, BBKNN, Scanorama, INSCT, LIGER, iMAP, scDML and scDREAMER for the integration of human immune data. <bold>f</bold> Comparison of composite isolated label scores to assess how well rare cell types are identified. <bold>g</bold> Comparison of iLISI and cLISI values. Each box-and-whisker plot summarizes LISI values (<italic>n</italic> = 16,754 cells, ~50% of the cells in the dataset as suggested in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup>), the box denotes the interquartile range (IQR, the range between the 25th and 75th percentile) with the median value, whiskers indicate the maximum and minimum value within 1.5 times the IQR, outliers are denoted by black circles. <bold>h</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>i</bold> Quantitative assessment of batch-mixing of scDREAMER against scVI and Harmony based on the percentage of positive vs true positive cells. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig4_HTML" id="d32e892"/></fig></p>
      <p id="Par17">Our quantitative comparison showed that scDREAMER consistently outperformed all other methods by achieving the highest combined composite score (15.5% improvement over the second-best method) which was driven by scDREAMER’s superior performance in both biological conservation and batch correction (Fig. <xref rid="Fig4" ref-type="fig">4</xref>c–e). scDREAMER was the best-performing method in terms of kBET, and two bio-conservation metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">9a, b)</xref>. In capturing the rare cell identities, scDREAMER also performed at par with scVI and Scanorama, the top-performing methods in terms of composite isolated label scores (Fig. <xref rid="Fig4" ref-type="fig">4</xref>f, Supplementary Fig. <xref rid="MOESM1" ref-type="media">9c)</xref>. However, for batch correction, scVI and Scanorama performed poorly. In terms of LISI metrics, scDREAMER along with scVI and Harmony consistently performed better than other methods (Fig. <xref rid="Fig4" ref-type="fig">4</xref>g). We further compared scDREAMER’s performance against that of Harmony and scVI (second and third-best methods based on combined composite score respectively) by measuring the proportion of positive and true positive cells. While both scDREAMER and scVI had a comparable proportion of positive cells better than Harmony, scDREAMER outperformed both methods by a large margin based on the proportion of true positive cells (Fig. <xref rid="Fig4" ref-type="fig">4</xref>h, i).</p>
      <p id="Par18">Finally, to evaluate scDREAMER’s ability in uncovering unique biological insights, we focused on a more in-depth analysis of the dendritic cell populations after integration. Based on scRNA-seq and functional studies, Villani et al.<sup><xref ref-type="bibr" rid="CR29">29</xref></sup> characterized six different subtypes of dendritic cells—DC1 (CLEC9A<sup>+</sup>), DC2 (non-inflammatory CD1C<sup>+</sup>), DC3 (inflammatory CD1C<sup>+</sup>), DC4 (CD141<sup>−</sup>CD1C<sup>−</sup>), DC5 (AXL<sup>+</sup>), and DC6 (pDCs). Through subclustering and marker gene expression analysis, we wanted to find out if an integration method was able to separate these DC subtypes after the integration of multiple batches. scVI performed poorly in identifying the DCs as a separate cluster, the optimal clustering of scVI embeddings (considering all cells) revealed that DC1 cells were clustered with CD20<sup>+</sup> B cells and DC2 and DC3 cells were clustered with CD14<sup>+</sup> monocytes (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10a)</xref>. Given its inability to identify the dendritic cells as a separate cluster, we did not perform any subclustering. In comparison, scDREAMER and Harmony were able to identify the dendritic cells as separate clusters. Subclustering of scDREAMER-inferred dendritic cell embeddings resulted in seven clusters each of which corresponded to distinct DC subtypes (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10b)</xref>. Clusters 0 and 1 contained DC2 and DC3 cells, clusters 2 and 3 contained pDCs whereas clusters 4, 5, and 6 contained DC1, DC4, and DC5 respectively. Thus, scDREAMER was able to identify 4 (out of 6) DC subtypes as separate clusters. In comparison, optimal subclustering of Harmony embeddings of DCs revealed 4 clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10c)</xref>, out of which only two clusters corresponded to DC4 and pDCs. Harmony failed to properly distinguish other DC subtypes—DC2 and DC3 cells were mixed with DC4 cells, whereas, DC1 and DC5 cells were present across multiple clusters.</p>
    </sec>
    <sec id="Sec7">
      <title>scDREAMER-Sup utilizes available cell type labels for improved conservation of biological knowledge</title>
      <p id="Par19">Next, we evaluated scDREAMER-Sup’s ability to leverage the available cell type labels for improved integration on lung atlas and human immune datasets as these integration tasks were the most challenging. We compared scDREAMER-Sup’s performance against that of scANVI<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> and scGEN<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>, state-of-the-art supervised methods (also top performers in recent benchmarking<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>) that utilize cell type labels. scDREAMER-Sup was able to capture all the cell types in distinct clusters for both integration tasks improving upon the performance of scDREAMER. Particularly, for lung atlas integration, scDREAMER-Sup was able to separate two neutrophil subtypes which were merged by all unsupervised methods (Fig. <xref rid="Fig5" ref-type="fig">5</xref>a, b). In comparison, integration by scANVI led to restricted separation of Macrophage and dendritic cells, and merging of neutrophil subtypes while scGEN mixed some B cells and T/NK cells as well as some ciliated and secretory cells (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11a–d)</xref>. In addition, B cells and secretory cells were fragmented in multiple closely located clusters by scANVI. When integrating human immune data, scGEN and scANVI could not properly separate CD14<sup>+</sup> and CD16<sup>+</sup> monocytes as well as NK cells and NKT cells (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11e–h)</xref>. scDREAMER-Sup was able to identify these cell subtypes as disjoint clusters (Fig. <xref rid="Fig5" ref-type="fig">5</xref>i, j).</p>
      <p id="Par20">We further quantitatively evaluated the performance of scDREAMER-Sup for both supervised (cell type labels available for all cells) as well as semi-supervised settings (cell type labels available for a fraction of cells). To evaluate the integration methods in semi-supervised settings, we uniformly randomly removed cell type labels for a percentage of cells from all the cell types while we varied the percentage of missing labels (10, 20, and 50%). For both datasets across all experimental settings, scDREAMER-Sup outperformed other methods based on combined composite (25–40% improvement over next best method), composite bio-conservation (14–33% improvement over next best method), and composite batch-correction scores (21–49% improvement over next best method) (Fig. <xref rid="Fig5" ref-type="fig">5</xref>c–e, k–m). It is important to note that for both datasets, scDREAMER-Sup also outperformed all the unsupervised methods (scDREAMER was the best unsupervised method for both datasets) in terms of both bio-conservation (84.61–113.33% improvement over best unsupervised method) and batch-correction (16.05–19.72% improvement over best unsupervised method). With an increase in the percentage of missing labels, we observed a sharp drop in scGEN’s composite bio-conservation score which is indicative of the fact that scGEN requires labels for all cells and cannot account for missing cell type labels. In comparison, the performance of scDREAMER-Sup and scANVI were more robust to missing cell type labels with scDREAMER-Sup outperforming scANVI by a large margin in terms of all composite scores.</p>
      <p id="Par21">scDREAMER-Sup’s superior performance was driven by top scores in multiple bio-conservation (NMI, ARI, ASW) (Supplementary Figs. <xref rid="MOESM1" ref-type="media">12a</xref> and <xref rid="MOESM1" ref-type="media">13a)</xref> and batch-correction metrics (kBET, graph connectivity, and ASW label/batch) (Supplementary Figs. <xref rid="MOESM1" ref-type="media">12b</xref> and <xref rid="MOESM1" ref-type="media">13b)</xref> across the integration tasks and experimental settings. scDREAMER-Sup was further able to capture rare cell identities very well as indicated by its top performance in terms of isolated f1 score (Supplementary Figs. <xref rid="MOESM1" ref-type="media">12c</xref> and <xref rid="MOESM1" ref-type="media">13c)</xref>. scDREAMER-Sup further outperformed the other methods in terms of LISI metrics (Fig. <xref rid="Fig5" ref-type="fig">5</xref>f, n) across the experimental settings. Furthermore, we compared the methods by measuring the proportion of positive and true positive cells for each experimental setting. For both supervised and semi-supervised settings, scDREAMER-Sup outperformed the other two methods by achieving a higher proportion of positive and true positive cells (Fig. <xref rid="Fig5" ref-type="fig">5</xref>g, o). Since both scDREAMER-Sup and scANVI can predict the labels of the cells for which cell type annotations are missing, we also compared the accuracy of the cell label prediction for these two methods. For all the semi-supervised settings with 10, 20 and 50% cells missing labels for both the datasets, scDREAMER-Sup achieved high accuracy (Macro F1-score 0.86–0.9) in predicting the cell type labels and outperformed scANVI (10–14% and 23–33% improvement over scANVI for lung atlas and human immune dataset, respectively) (Fig. <xref rid="Fig5" ref-type="fig">5</xref>h, p).<fig id="Fig5"><label>Fig. 5</label><caption><title>scDREAMER-Sup utilizes cell type labels to improve bio-conservation.</title><p><bold>a</bold> Visualization of scDREAMER-Sup’s latent space embeddings after integration of lung atlas dataset. Different colors denote different lung cell types. <bold>b</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>c</bold> composite bio-conservation score, <bold>d</bold> composite batch-correction score, <bold>e</bold> combined composite score metrics, <bold>f</bold> iLISI and cLISI values between scGEN, scANVI, and scDREAMER-Sup for different percentages of missing cell type labels for lung atlas dataset. <bold>g</bold> Quantitative assessment of batch-mixing of scDREAMER-Sup against scANVI and scGEN based on the percentage of positive vs true positive cells for lung atlas dataset. <bold>h</bold> Comparison of cell label prediction accuracy between scDREAMER-Sup and scANVI for different percentages of missing cell type labels for the lung atlas dataset. <bold>i</bold> Visualization of scDREAMER-Sup’s latent space embeddings after integration of human immune dataset. Different colors denote different lung cell types. <bold>j</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>k</bold> composite bio-conservation score, <bold>l</bold> composite batch-correction score, <bold>m</bold> combined composite score metrics, <bold>n</bold> iLISI and cLISI values between scGEN, scANVI, and scDREAMER-Sup for different percentages of missing cell type labels for the human immune dataset. <bold>o</bold> Quantitative assessment of batch-mixing of scDREAMER-Sup against scANVI and scGEN based on the percentage of positive vs true positive cells for the human immune dataset. <bold>p</bold> Comparison of cell label prediction accuracy between scDREAMER-Sup and scANVI for different percentages of missing cell type labels for the human immune dataset. For (<bold>f</bold>) and (<bold>n</bold>), each box-and-whisker plot summarizes LISI values for 50% of the cells in the datasets as suggested in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup> ((<bold>f</bold>) <italic>n</italic> = 16,260 cells, (<bold>n</bold>) <italic>n</italic> = 16,770 cells), the box denotes the interquartile range (IQR, the range between the 25th and 75th percentile) with the median value, whiskers indicate the maximum and minimum value within 1.5 times the IQR, outliers are denoted by black circles. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig5_HTML" id="d32e1095"/></fig></p>
    </sec>
    <sec id="Sec8">
      <title>scDREAMER outperforms other methods in integrating a large number of batches with complex batch effects</title>
      <p id="Par22">We next evaluated scDREAMER’s (both unsupervised and semi-supervised) integration and batch correction on large number of batches (also large number of cells) using a human heart atlas dataset consisting of 486,134 cells spanning six heart regions namely apex, left atrium, left ventricle, right atrium, right ventricle, and septum (<ext-link ext-link-type="uri" xlink:href="https://www.heartcellatlas.org/">https://www.heartcellatlas.org/</ext-link>,<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>). All tissues were from transplant donors without a history of cardiac disease or arrhythmia. The cells were obtained in 147 batches corresponding to different donors, sequential protocols, race, gender, age range, and death-type conditions. In the original study<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>, a total of 452,136 cells were assigned to 12 major cardiac cell types using state-of-the-art machine learning methods, and the remaining 33,998 cells were not assigned any cell type label (Supplementary Fig. <xref rid="MOESM1" ref-type="media">14a)</xref>. In our analyses, we used all the cells for integration but the cells with available cell type labels were used for the evaluation. Only the available cell type labels were used for training supervised methods making it a semi-supervised integration task for them. Apart from a large number of batches, the integration task posed several challenges including variability across human donors with different genders (~55% and ~45% from male and female donors, respectively), race (93% and 6% cells from donors of Caucasian and Asian descent, respectively), and age group (spanning the age range of 40–75 years), sequencing protocol-specific batch effects, and cell types spanning different death-type conditions (265,554 cells (~40 batches) were sampled from the heart in case of circulatory death, and the rest 220,580 cells (~100 batches) were sampled from the heart in case of brain death). Furthermore, the dataset contained skewed cell type distribution, i.e., ~50 batches did not have any cell corresponding to Ventricular Cardiomyocyte and Fibroblast resulting in a multi-faceted challenging integration problem.</p>
      <p id="Par23">Among the unsupervised methods, Seurat, LIGER, scDML and iMAP failed to integrate this dataset given their huge memory requirement (tested on 512 GB memory) or inability to handle such a large number of batches. Most of the other methods that could integrate this dataset led to the mixing of atrial and ventricular cardiomyocytes given their similarity. BBKNN and Scanorama fragmented many cell types into multiple clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">14d, e)</xref>. scVI, Harmony, and scDREAMER were able to capture most cell types into distinct clusters (Fig. <xref rid="Fig6" ref-type="fig">6</xref>a, b, Supplementary Fig. <xref rid="MOESM1" ref-type="media">14b, c)</xref>. However, scVI and Harmony also led to the fragmentation of smooth muscle cells and poor batch correction for Lymphoid cells. In comparison, supervised methods were able to better capture the different cell types in distinct clusters by leveraging the available cell type labels (Fig. <xref rid="Fig6" ref-type="fig">6</xref>c, d, Supplementary Fig. <xref rid="MOESM1" ref-type="media">14g, h)</xref>. However, scANVI still failed to separate atrial and ventricular cardiomyocytes (Supplementary Fig. <xref rid="MOESM1" ref-type="media">14h)</xref>. In addition, scANVI also fragmented smooth muscle cells into multiple clusters. On the other hand, scGEN poorly handled the unassigned cells given its inability to handle missing cell type labels (Supplementary Fig. <xref rid="MOESM1" ref-type="media">14g)</xref>. scDREAMER-Sup was able to resolve the complex batch effects while integrating heart cells as indicated by disjoint well-mixed cell type clusters (Fig. <xref rid="Fig6" ref-type="fig">6</xref>c, d). Both scDREAMER and scDREAMER-Sup were able to mix the cells well across tissues, protocols, donors, genders, age groups, and death-type conditions (Supplementary Fig. <xref rid="MOESM1" ref-type="media">15)</xref>.<fig id="Fig6"><label>Fig. 6</label><caption><title>scDREAMER integrates heart atlas cells from a large number (147) of batches.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after the integration of 147 batches. Different colors denote different cell types in this large dataset consisting of ~0.5 million cells. ‘NotAssigned’ represents the cells without any cell type assignment. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on the batch information. <bold>c</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on cell types. <bold>d</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>e</bold> composite bio-conservation score, <bold>f</bold> composite batch-correction score, and <bold>g</bold> combined composite score metrics between unsupervised (scVI, Harmony, Seurat, Scanorama, INSCT, scDREAMER) and supervised (scGEN, scANVI, and scDREAMER-Sup) methods. Comparison of <bold>h</bold> composite bio-conservation score, <bold>i</bold> composite batch-correction score, and <bold>j</bold> combined composite score metrics between scGEN, scANVI and scDREAMER-Sup for different percentages of missing cell type labels for the heart atlas dataset. <bold>k</bold> Comparison of cell label prediction accuracy between scDREAMER-Sup and scANVI for different percentages of missing cell type labels for the heart atlas dataset. <bold>l</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>m</bold> Quantitative assessment of batch-mixing of scDREAMER against that of scVI and Harmony based on the percentage of positive vs. true positive cells. <bold>n</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>o</bold> Quantitative assessment of batch-mixing of scDREAMER-Sup against that of scANVI and scGEN based on the percentage of positive vs. true positive cells for the heart atlas dataset. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig6_HTML" id="d32e1199"/></fig></p>
      <p id="Par24">Quantitative analyses showed that scDREAMER performed the best among the unsupervised methods based on the combined composite score (25% improvement over the second-best method) which was driven by scDREAMER’s superior performance in batch correction (~50% improvement over the second-best method) as well as good performance in bio-conservation (Fig. <xref rid="Fig6" ref-type="fig">6</xref>e–g, Supplementary Fig. <xref rid="MOESM1" ref-type="media">16)</xref>. We could not include BBKNN in the comparison of the composite scores due to the unavailability of the majority of the metrics. However, scDREAMER outperformed BBKNN on both bio-conservation metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17a)</xref>. Moreover, we could run scDML on this dataset after the removal of 7 batches as suggested in ref. <sup><xref ref-type="bibr" rid="CR33">33</xref></sup> and in integrating the remaining 140 batches, scDREAMER outperformed scDML in terms of most of the metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17b)</xref>. Among the supervised methods, scDREAMER-Sup achieved the best combined composite score (11.5% improvement over the second-best supervised method and 26% improvement over the best unsupervised method (Fig. <xref rid="Fig6" ref-type="fig">6</xref>e–g)). We further evaluated scDREAMER-Sup’s performance in semi-supervised settings with 20 and 50% missing labels. In both settings, scDREAMER-Sup significantly outperformed scANVI and scGEN in both bio-conservation and batch correction (32–57% improvements, Fig. <xref rid="Fig6" ref-type="fig">6</xref>h–j, Supplementary Fig. <xref rid="MOESM1" ref-type="media">18a, b)</xref>. scGEN’s performance dropped sharply with an increase in the percentage of missing labels. scDREAMER-Sup and scANVI were robust to missing cell type labels with scDREAMER-Sup outperforming scANVI by a large margin in terms of all composite scores. Isolated label scores could not be computed for this dataset due to the sheer imbalance of batch sizes. We also compared the accuracy of the cell label prediction for scDREAMER-Sup and scANVI. For both the semi-supervised settings with 20 and 50% cells missing labels, scDREAMER-Sup achieved very high accuracy (macro F1-score 0.97) in predicting the cell type labels and outperformed scANVI (11.49% improvement over scANVI) (Fig. <xref rid="Fig6" ref-type="fig">6</xref>k). We further compared scDREAMER’s performance against that of Harmony and scVI (second and third-best unsupervised methods based on combined composite scores respectively) by measuring the proportion of positive and true positive cells. While all three methods had a comparable proportion of positive cells, scDREAMER outperformed both methods by a large margin based on the proportion of true positive cells (Fig. <xref rid="Fig6" ref-type="fig">6</xref>l, m). Finally, we compared the supervised methods by measuring the proportion of positive and true positive cells for each experimental setting. For all experimental settings, scDREAMER-Sup outperformed the other two methods by achieving a higher proportion of positive and true positive cells (Fig. <xref rid="Fig6" ref-type="fig">6</xref>n, o).</p>
      <p id="Par25">We further analyzed a macaque retina bipolar cells dataset consisting of 30,302 cells that originated from the fovea or periphery of the retina and consisted of 30 batches across macaques and regions. The original study showed that several integration methods failed to remove batch effects from this dataset<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>. Both scDREAMER and scDREAMER-Sup successfully integrated all 30 batches while separating the distinct cell types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">19)</xref>. In contrast, many other methods mixed some distinct cell types or fragmented same cell type into multiple clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">20)</xref>. Based on quantitative analyses also, scDREAMER-Sup was the best performer among all unsupervised and supervised methods in terms of multiple bio-conservation and batch correction metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">21)</xref>. Among the unsupervised methods, scDREAMER was the best performer based on NMI, ARI and kBET and performed comparably on all other metrics except ASW label. scDREAMER-Sup was also superior in identifying the rare cell types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">21)</xref>.</p>
    </sec>
    <sec id="Sec9">
      <title>scDREAMER robustly integrates millions of cells across different species</title>
      <p id="Par26">We finally evaluated scDREAMER’s ability to perform atlas-level integration across species using a dataset consisting of ~1 million cells from human and mouse profiled by the Human Cell Landscape (HCL)<sup><xref ref-type="bibr" rid="CR35">35</xref></sup> and Mouse Cell Atlas (MCA)<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> projects respectively. The two batches in the dataset correspond to HCL and MCA respectively. The dataset harbored 97 different cell types which had minimal overlap across the atlases (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22a)</xref>. The HCL batch comprised 599,926 cells from 63 different cell types whereas the mouse cell atlas comprised 333,778 cells from 52 different cell types. A total of 18 cell types (among the 97 cell types) were common between these two atlases. We have demonstrated scDREAMER’s scalability over a million cells and versatility in integration with this atlas-level integration task.</p>
      <p id="Par27">For this atlas-level integration task, the performance of scDREAMER and scDREAMER-Sup was compared with that of eight other unsupervised methods (scVI, Scanorama, Harmony, INSCT, BBKNN, LIGER, iMAP and scDML) and two supervised methods (scGEN and scANVI). Due to the size of the dataset, Seurat ran into memory issues. Qualitatively, we can observe that clusters by scDREAMER were better separated compared to other methods (Fig. <xref rid="Fig7" ref-type="fig">7</xref>a, b, Supplementary Fig. <xref rid="MOESM1" ref-type="media">22b–i)</xref>. scDREAMER was able to clearly distinguish some of the major cell types such as neutrophil cells, erythroid cells, fetal stromal cells and oligodendrocyte cells (Fig. <xref rid="Fig7" ref-type="fig">7</xref>a). While scVI could cluster some of these cell types such as neutrophil, erythroid and fetal stromal cells well, harmony could only cluster erythroid cells. In Harmony embeddings, similar cell types were disjointly present in multiple clusters. On the other hand, BBKNN and LIGER led to the complete mixing of multiple cell types. While Scanorama was able to better classify than BBKNN and Harmony, it was not able to properly mix the batches (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22e)</xref>. iMAP was also not able to mix the batches properly (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22h)</xref>. scDML mixed multiple cell types and fragmented some of the cell types into multiple clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22i)</xref>. Among the supervised methods, scDREAMER-Sup and scANVI led to better-separated clusters, whereas scGEN was not able to cluster the cell types properly (Fig. <xref rid="Fig7" ref-type="fig">7</xref>c, d, Supplementary Fig. <xref rid="MOESM1" ref-type="media">22j, k)</xref>.<fig id="Fig7"><label>Fig. 7</label><caption><title>scDREAMER enables robust integration of millions of cells across species.</title><p><bold>a</bold> Visualization of scDREAMER’s latent space embeddings after the integration of human (HCL) and mouse cells (MCA). Different colors denote different cell types in this large dataset consisting of ~1 million cells. <bold>b</bold> Visualization of scDREAMER’s latent space embeddings, cells are colored based on the batch information. <bold>c</bold> Visualization of scDREAMER-Sup’s latent space embeddings after the integration of human (HCL) and mouse cells (MCA). Different colors denote different cell types. <bold>d</bold> Visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on the batch information. Comparison of <bold>e</bold> composite bio-conservation score, <bold>f</bold> composite batch-correction score and <bold>g</bold> combined composite score metrics between scVI, Harmony, Seurat, BBKNN, Scanorama, INSCT, LIGER, iMAP, scDML, scDREAMER, scGEN, scANVI and scDREAMER-Sup for the integration of HCL and MCA cells. <bold>h</bold> Quantitative assessment of batch-mixing of scDREAMER against that of scVI, Scanorama and LIGER based on the percentage of positive vs true positive cells. <bold>i</bold> Quantitative assessment of batch-mixing of scDREAMER-Sup against that of scGEN and scANVI based on the percentage of positive vs true positive cells. <bold>j</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>k</bold> Qualitative assessment of batch-mixing by visualization of scDREAMER-Sup’s latent space embeddings, cells are colored based on three categories—positive, negative and true positive. <bold>l</bold> Comparison of scDREAMER runtime against that of scVI and INSCT across four different scRNA datasets consisting of 10k, 100k, 500k, and 1M cells subsampled from the cross-species integration dataset. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43590_Fig7_HTML" id="d32e1341"/></fig></p>
      <p id="Par28">In quantitative comparison, scDREAMER achieved the best combined composite score among all the unsupervised methods (26.9% better than the second-best unsupervised method) and was even better than the supervised methods scANVI and scGEN, whereas overall, scDREAMER-Sup had the best combined composite score (8.75% better than that of scDREAMER) (Fig. <xref rid="Fig7" ref-type="fig">7</xref>e–g). While scDREAMER was the best batch correction method, scDREAMER-Sup achieved the best bio-conservation (best in terms of all bio-conservation metrics) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">23)</xref>. We further compared scDREAMER’s performance against that of scVI (second-best unsupervised method), Scanorama and LIGER (third-best unsupervised method) and scDREAMER-Sup’s performance against that of scGEN and scANVI by measuring the proportion of positive and true positive cells (Fig. <xref rid="Fig7" ref-type="fig">7</xref>h–k). scDREAMER outperformed Scanorama and LIGER based on the proportion of positive cells and all the unsupervised methods based on the proportion of true positive cells (Fig. <xref rid="Fig7" ref-type="fig">7</xref>h). On the other hand, based on both the proportion of positive and true positive cells, scDREAMER-Sup outperformed scGEN and scANVI by a large margin. (Fig. <xref rid="Fig7" ref-type="fig">7</xref>i).</p>
      <p id="Par29">To assess scDREAMER’s scalability with the number of cells, we measured the runtime of scDREAMER on different datasets subsampled from the atlas-integration dataset and compared the runtime against that of scVI and INSCT—two other neural network-based methods. For most of the subsampled datasets, scDREAMER outperformed the other two methods based on runtime and exhibited higher scalability with the number of cells (Fig. <xref rid="Fig7" ref-type="fig">7</xref>l). For the complete dataset consisting of ~1 million cells, training scDREAMER took only ~130 s per epoch as compared to ~154 s per epoch for scVI and ~172 s per epoch for INSCT (on a server with one Nvidia Quadro RTX 5000 GPU). We further compared the total runtime of different methods across different datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">24)</xref>. scDREAMER was one of the fastest among all the neural network-based methods across all datasets and was faster compared to some other methods (e.g., Seurat, LIGER). scDREAMER-Sup was also faster than scANVI for multiple datasets and faster than other neural network-based unsupervised methods.</p>
    </sec>
    <sec id="Sec10">
      <title>Ablation study</title>
      <p id="Par30">We performed ablation studies to examine the contribution of the two adversarial components of scDREAMER—adversarial discriminator and batch classifier. Supplementary Table <xref rid="MOESM1" ref-type="media">2</xref> compares the performance of scDREAMER in comparison to scDREAMER without the discriminator (scDREAMER-woDis) and scDREAMER without the batch classifier (scDREAMER-woBC) for different integration tasks. As can be seen, scDREAMER-woBC performs better than scDREAMER-woDis in terms of composite bio-conservation score and composite isolated label score indicating the contribution of the discriminator toward improved bio-conservation and identification of rare cell types. In contrast, the version that uses batch classifier (scDREAMER-woDis) performs better in terms of batch correction as compared to scDREAMER-woBC indicating the contribution of the batch classifier in removing batch effects. Thus, both the components play a significant role and by combining them, scDREAMER achieves the best performance in terms of combined composite score as well as composite isolated label score for different datasets.</p>
    </sec>
  </sec>
  <sec id="Sec11" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par31">Here, we introduced scDREAMER, a deep generative model for the efficient and robust integration of scRNA-seq datasets across multiple batches. The unsupervised model of scDREAMER employs an adversarial variational autoencoder for inferring the latent cellular embeddings from the high-dimensional gene expression matrices from different batches. This adversarial autoencoder also outputs the corrected expression profiles. The other component of scDREAMER, a batch classifier helps remove batch effects from the latent cellular embeddings for better mixing of cell types shared across multiple batches. Thus, scDREAMER employs a combination of two levels of adversarial training for training the adversarial VAE and the batch classifier respectively and differs from existing adversarially trained deep generative models for dimensionality reduction<sup><xref ref-type="bibr" rid="CR37">37</xref></sup> and batch integration of scRNA-seq data<sup><xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR22">22</xref></sup> (see Supplementary <xref rid="MOESM1" ref-type="media">Note 1</xref> for details). Our ablation study further demonstrated that the two adversarially trained components play important roles in improving bio-conservation and removal of batch effects respectively. We further extended scDREAMER to scDREAMER-Sup, which employs an additional variational autoencoder and a cell type classifier to utilize available cell type labels for improved bio-conservation.</p>
    <p id="Par32">Our comprehensive benchmarking of scDREAMER and scDREAMER-Sup on multiple complex data integration tasks demonstrates scDREAMER’s superiority over the state-of-the-art unsupervised and supervised integration methods respectively in terms of both conservation of biological variations and removal of batch effects. In contrast, the other methods were only able to perform well in one aspect of data integration: batch-mixing or conservation of biological variation, that too varied across datasets. scDREAMER was also a consistent performer in capturing rare cell identities. Moreover, a comparison of the fraction of true positive and positive cells further demonstrated scDREAMER’s superiority over other methods in batch-mixing. scDREAMER-Sup was found to improve upon scDREAMER and it consistently outperformed all the supervised (that utilize the cell type annotations) as well as unsupervised integration methods across various benchmarking datasets and experimental settings.</p>
    <p id="Par33">scDREAMER also demonstrated high accuracy for the integration of a large number of batches and atlases from different species despite the small number of shared cell types. Both scDREAMER and scDREAMER-Sup significantly outperformed the other methods for the integration of heart atlas across 147 batches, which many other methods failed to integrate. scDREAMER-Sup also performed superior to all other methods in predicting the cell type labels for the cells missing annotations. Moreover, the unsupervised deep learning approach of scDREAMER does not require any cell type information and can be applied when prior knowledge regarding homologous cell types is not available or the cell type annotations are missing. In case cell type labels are available (completely or partially), the supervised version of scDREAMER, scDREAMER-Sup can achieve improved performance in bio-conservation while maintaining batch-effect removal performance. As more cell atlases are generated from different species, we believe that scDREAMER will be suitable for robust integration of cross-species datasets for the discovery of shared and private cell types.</p>
    <p id="Par34">The application of scDREAMER on the heart atlas and cross-species dataset also highlights its scalability to a large number of batches and millions of cells. In fact, our runtime experiments using different down-sampled versions of the cross-species dataset showed that scDREAMER outperformed some other deep learning-based methods based on runtime. Thus scDREAMER provides a suitable deep learning-based integration model for cross-species atlas integration as the other deep learners scVI, INSCT, iMAP and scDML achieved much less accuracy for the cross-species integration task. This is particularly important as the deep learning-based methods enable the inference of latent cellular embeddings as well as corrected expression profiles which are required for several downstream applications such as trajectory inference<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> or differential expression analysis<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
    <p id="Par35">scDREAMER being a deep learning-based method may require fine-tuning of some parameters for extracting the best performance. However, in our analyses, the same parameter values performed well across multiple datasets (Supplementary Table <xref rid="MOESM1" ref-type="media">3)</xref>. Our current model assumes prior knowledge of the number of batches. An important future direction would be to explore the unsupervised treatment of batch information and whether the hierarchical structure between different batch information can be utilized when it exists (e.g., when cells from a single donor but multiple organs are present in the atlas). While we restricted our analysis to the integration of scRNA-seq datasets, our deep generative model encompasses a general framework that can accommodate other omics datasets and we plan to extend the framework of scDREAMER to multiomic datasets. Finally, given the rapid generation of atlas-level single-cell datasets<sup><xref ref-type="bibr" rid="CR38">38</xref>–<xref ref-type="bibr" rid="CR40">40</xref></sup> across multiple organs and species, we anticipate supervised and unsupervised models of scDREAMER to become invaluable methods for performing scalable and accurate integration of single-cell atlases for the exploration of different biological systems.</p>
  </sec>
  <sec id="Sec12">
    <title>Methods</title>
    <sec id="Sec13">
      <title>The scDREAMER model</title>
      <p id="Par36">The unsupervised model of scDREAMER consists of an unsupervised deep learning-based framework specifically designed to address the complex and multi-level batch effects and perform atlas-level integration ensuring effective integration as well as batch mixing. Any integration method is faced with the critical challenge of balancing a tradeoff between capturing the distinct identity of the batch-specific cell types and adequate mixing of the cell types shared across multiple batches. This challenge is even more profound for the integration of atlas-level datasets. To overcome these challenges, we formalize our scDREAMER integration model into two major components, the adversarial variational autoencoder and the batch classifier that is adversarially trained with the encoder.</p>
      <p id="Par37">scDREAMER employs an adversarial variational autoencoder for learning a lower-dimensional representation of cells from the high-dimensional scRNA-seq data. In addition, there is a neural network classifier (also called a batch classifier) for the removal of batch effects. The adversarial variational autoencoder of scDREAMER consists of three multi-layer neural networks: an encoder <italic>E</italic> that maps the high-dimensional expression data (<italic>x</italic><sub><italic>i</italic></sub>) and batch information (<italic>s</italic><sub><italic>i</italic></sub>) of a cell <italic>i</italic> to a lower-dimensional embedding <italic>z</italic><sub><italic>i</italic></sub>, a decoder <italic>D</italic>, which reconstructs the expression profile of the cell from <italic>z</italic><sub><italic>i</italic></sub> and <italic>s</italic><sub><italic>i</italic></sub>, and a discriminator <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M16"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq8.gif"/></alternatives></inline-formula> that aims to distinguish the original expression profile <italic>x</italic><sub><italic>i</italic></sub> and the expression profile reconstructed (<inline-formula id="IEq9"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{{x}_{i}}$$\end{document}</tex-math><mml:math id="M18"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq9.gif"/></alternatives></inline-formula>) by the decoder. The use of a discriminator to adversarially train the autoencoder is inspired by ref. <sup><xref ref-type="bibr" rid="CR37">37</xref></sup>.</p>
      <p id="Par38">The adversarial variational autoencoder network of scDREAMER is trained using two loss functions: evidence lower bound (ELBO) is used for training the encoder and decoder networks, whereas Bhattacharyya loss is used for adversarial training of discriminator and autoencoder parameters. The ELBO loss accounts for the KL divergence between the posterior distribution <italic>q</italic>(<italic>z</italic><sub><italic>i</italic></sub>∣<italic>s</italic><sub><italic>i</italic></sub>, <italic>x</italic><sub><italic>i</italic></sub>) and the true distribution <italic>p</italic>(<italic>z</italic><sub><italic>i</italic></sub>), and the expected likelihood of <italic>x</italic><sub><italic>i</italic></sub> given <italic>z</italic><sub><italic>i</italic></sub> over posterior probability distribution <italic>q</italic>(<italic>z</italic><sub><italic>i</italic></sub>∣<italic>s</italic><sub><italic>i</italic></sub>, <italic>x</italic><sub><italic>i</italic></sub>). The Bhattacharyya loss compares the probability distributions <italic>q</italic>(<italic>z</italic><sub><italic>i</italic></sub>∣<italic>x</italic><sub><italic>i</italic></sub>, <italic>s</italic><sub><italic>i</italic></sub>) and <italic>p</italic>(<italic>z</italic><sub><italic>i</italic></sub>) where <italic>q</italic>(<italic>z</italic><sub><italic>i</italic></sub>∣<italic>x</italic><sub><italic>i</italic></sub>, <italic>s</italic><sub><italic>i</italic></sub>) is the posterior probability distribution and <italic>p</italic>(<italic>z</italic><sub><italic>i</italic></sub>) is 0-mean Gaussian distribution, i.e., <inline-formula id="IEq10"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{N}}}}}}}}(0,I)$$\end{document}</tex-math><mml:math id="M20"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq10.gif"/></alternatives></inline-formula>.</p>
      <p id="Par39">scDREAMER further incorporates a batch classifier, <inline-formula id="IEq11"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M22"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq11.gif"/></alternatives></inline-formula> (a multi-layer neural network) that takes as input the lower-dimensional embedding <italic>z</italic><sub><italic>i</italic></sub> learned by the encoder and tries to predict the batch information <italic>s</italic><sub><italic>i</italic></sub> for each cell <italic>i</italic>. The batch classifier and the encoder are adversarially trained using a cross-entropy loss where the encoder tries to maximize it with an aim to generate the embeddings such that the classifier is not able to differentiate between batches and the batch classifier tries to minimize it by distinguishing the embeddings of the cells that are part of different batches and hence achieving better mixing of the batches.</p>
    </sec>
    <sec id="Sec14">
      <title>Adversarial variational autoencoder for representation learning of cells</title>
      <p id="Par40"><italic>E</italic> denotes the Encoder network that takes as input <italic>X</italic> (gene expression matrix) and <italic>S</italic> (set of batch information) and generates the mean <italic>μ</italic><sub><italic>Z</italic></sub> and variance <italic>σ</italic><sub><italic>Z</italic></sub> of the multivariate normal distribution (prior for <italic>z</italic>). In addition, it also learns the mean and variance of the cell-specific scaling factor <italic>l</italic><sub><italic>i</italic></sub> as used in ref. <sup><xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
      <p id="Par41">The Encoder <italic>E</italic> learns the functional form: <italic>z</italic><sub><italic>i</italic></sub> ~ <italic>N</italic><italic>o</italic><italic>r</italic><italic>m</italic><italic>a</italic><italic>l</italic>(0, <italic>I</italic>), <italic>f</italic><sub><italic>E</italic></sub>: {<italic>x</italic>, <italic>s</italic>} → {<italic>μ</italic><sub><italic>z</italic></sub>, <italic>σ</italic><sub><italic>z</italic></sub>, <italic>μ</italic><sub><italic>l</italic></sub>, <italic>σ</italic><sub><italic>l</italic></sub>}. The decoder network <italic>D</italic> takes as input the latent space embeddings <italic>z</italic> and batch information and reconstructs the gene expression matrix, <inline-formula id="IEq12"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{X}$$\end{document}</tex-math><mml:math id="M24"><mml:mover accent="true"><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq12.gif"/></alternatives></inline-formula>. It also outputs the mean and dispersion of the reconstructed gene expression vector. The scRNA-seq data can be modeled as zero-inflated negative binomial (ZINB) or negative binomial (NB) distribution.</p>
      <p id="Par42">scDREAMER aims to learn the posterior distribution of the latent variable <italic>z</italic>, <italic>p</italic>(<italic>z</italic>∣<italic>X</italic>, <italic>S</italic>, <italic>l</italic>). We use a variational inference approach where we try to learn the network parameters of <italic>E</italic> and <italic>D</italic> as denoted by <italic>ϕ</italic> = {<italic>f</italic><sub><italic>E</italic></sub>, <italic>f</italic><sub><italic>D</italic></sub>} by maximizing the Evidence Lower Bound Loss (ELBO) function:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ELBO=-KL({q}_{\phi }(z| x,s)| | p(z))-KL({q}_{\phi }(l| x,s)| | p(l))+{E}_{{q}_{\phi }(z,l| x,s)}\,log(p(x| z,s,l))$$\end{document}</tex-math><mml:math id="M26"><mml:mi>E</mml:mi><mml:mi>L</mml:mi><mml:mi>B</mml:mi><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where, the first two terms denote the KL divergence between the posterior distribution and true distribution for <italic>z</italic> and <italic>l</italic> respectively and the third term denotes the expected likelihood of <italic>x</italic> given <italic>z</italic> and <italic>l</italic> over the posterior probability distribution, <italic>q</italic><sub><italic>ϕ</italic></sub>(<italic>z</italic>, <italic>l</italic>∣<italic>x</italic>, <italic>s</italic>). In this work, we have modeled scRNA-seq data using ZINB distribution which is defined in terms of mean (<italic>μ</italic>) and dispersion (<italic>θ</italic>) parameters as:<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\forall x\in {\mathbb{N}};p(y;\mu,\theta )=\frac{{{\Gamma }}(x+\theta )}{{{\Gamma }}(x+1){{\Gamma }}(\theta )}{\left(\frac{\theta }{\theta+\mu }\right)}^{\theta }{\left(\frac{\mu }{\mu+\theta }\right)}^{x}$$\end{document}</tex-math><mml:math id="M28"><mml:mo>∀</mml:mo><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">N</mml:mi><mml:mo>;</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi><mml:mo>+</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msup></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <sec id="Sec15">
        <title>Training of discriminator</title>
        <p id="Par43">Inspired by ref. <sup><xref ref-type="bibr" rid="CR37">37</xref></sup>, scDREAMER autoencoder also incorporates an adversarial discriminator <inline-formula id="IEq13"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M30"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq13.gif"/></alternatives></inline-formula> that tries to distinguish between the reconstructed gene expression profile <inline-formula id="IEq14"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{x}$$\end{document}</tex-math><mml:math id="M32"><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq14.gif"/></alternatives></inline-formula> and the original gene expression profile <italic>x</italic> of a cell. This ensures that the distribution of the reconstructed gene expression profiles faithfully follows the distribution of the underlying original scRNA-seq profiles. <inline-formula id="IEq15"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M34"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq15.gif"/></alternatives></inline-formula> is adversarially trained along with the autoencoder, <inline-formula id="IEq16"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}=\{E,D\}$$\end{document}</tex-math><mml:math id="M36"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq16.gif"/></alternatives></inline-formula> using Bhattacharyya loss, <inline-formula id="IEq17"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}$$\end{document}</tex-math><mml:math id="M38"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq17.gif"/></alternatives></inline-formula> given by:<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}=-log\left(\mathop{\sum }\limits_{i=1}^{N}\sqrt{P({x}_{i})\times P(\bar{{x}_{i}})}\right)$$\end{document}</tex-math><mml:math id="M40"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:msqrt><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msqrt></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula><inline-formula id="IEq18"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{D}}}}}}}}$$\end{document}</tex-math><mml:math id="M42"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq18.gif"/></alternatives></inline-formula> tries to maximize <inline-formula id="IEq19"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}$$\end{document}</tex-math><mml:math id="M44"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq19.gif"/></alternatives></inline-formula> whereas the autoencoder <inline-formula id="IEq20"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}$$\end{document}</tex-math><mml:math id="M46"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq20.gif"/></alternatives></inline-formula> tries to minimize <inline-formula id="IEq21"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}$$\end{document}</tex-math><mml:math id="M48"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq21.gif"/></alternatives></inline-formula> giving rise to the minimax objective function:<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{\min }\nolimits_{{{{{{{{\mathcal{{A}}}}}}}_{E}}}}\,\mathop{\max }\nolimits_{{{{{{{{\mathcal{D}}}}}}}}}\,{{{{{{{\mathcal{{L}}}}}}}_{{{{{{{{\mathcal{B}}}}}}}}}}}({{\mathbb{E}}}_{x \sim {P}_{x}}{{{{{{{\mathcal{D}}}}}}}}(x),{{\mathbb{E}}}_{z \sim p(z)}{{{{{{{\mathcal{D}}}}}}}}({{{{{{{\mathcal{{A}}}}}}}_{E}}}(z)))$$\end{document}</tex-math><mml:math id="M50"><mml:msub><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>~</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi><mml:mo>~</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mi class="MJX-tex-caligraphic" mathvariant="script">D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      </sec>
      <sec id="Sec16">
        <title>Adversarial training using a batch classifier for batch-effect removal</title>
        <p id="Par44">The batch-classifier network <inline-formula id="IEq22"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M52"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq22.gif"/></alternatives></inline-formula> learns its parameters by minimizing the cross-entropy loss thereby ensuring correct classification of embeddings into different batches while Encoder tries to fool the batch-classifier by maximizing the cross-entropy loss. <inline-formula id="IEq23"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{B}}}}}}}}$$\end{document}</tex-math><mml:math id="M54"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq23.gif"/></alternatives></inline-formula> takes <italic>z</italic> (latent space embeddings) as input and <italic>s</italic> (batch information) as labels. The cross-entropy loss is given by:<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$-\mathop{\sum }\limits_{j=1}^{| S| }{s}_{j}\times log({r}_{j})$$\end{document}</tex-math><mml:math id="M56"><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>S</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>where <italic>s</italic><sub><italic>j</italic></sub> is the true label and <italic>r</italic><sub><italic>j</italic></sub> is the softmax probability of the <italic>j</italic><italic>t</italic><italic>h</italic> batch.</p>
        <p id="Par45">The batch-classifier intends to minimize the cross-entropy loss, hence classifying the latent cellular embeddings to its correct batch whereas the encoder tries to maximize the cross-entropy loss ensuring that the classifier is not able to differentiate between batches so that better mixing of data from different batches can be achieved. This gives rise to another minimax objective:<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{\max }\nolimits_{E}\,\mathop{\min }\nolimits_{{{{{{{{\mathcal{B}}}}}}}}}-\mathop{\sum }\limits_{j=1}^{| S| }{s}_{j}\times log({r}_{j})$$\end{document}</tex-math><mml:math id="M58"><mml:msub><mml:mrow><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">B</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>S</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula></p>
      </sec>
    </sec>
    <sec id="Sec17">
      <title>Implementation details</title>
      <p id="Par46">
        <list list-type="bullet">
          <list-item>
            <p id="Par47">scDREAMER has 4 neural network units correspnding to Encoder, Decoder, Discriminator and Batch-Classifier, all with multi-layer dense neural network architecture with linear relu activation at the end of each layer. For training our model, we have adopted ADAM optimizer<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>. We have used <italic>β</italic> as a scaling factor (multiplied to the KL-divergence term) to balance between the reconstruction loss and KL-divergence term while optimizing the ELBO loss. The batch size of 128 is used while training the model.</p>
          </list-item>
          <list-item>
            <p id="Par48">To facilitate and stabilize the training process and make scDREAMER robust to small perturbations, we added a penalty term in the main objective function following ref. <sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. Specifically, for each gene expression vector <italic>x</italic><sub><italic>i</italic></sub>, we down-sample <italic>x</italic><sub><italic>i</italic></sub> by keeping 80% of its UMIs to produce <italic>x</italic><sub><italic>i</italic></sub>. The latent representations for <italic>x</italic><sub><italic>i</italic></sub> and <inline-formula id="IEq24"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{x}}_{i}$$\end{document}</tex-math><mml:math id="M60"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq24.gif"/></alternatives></inline-formula> are <italic>z</italic><sub><italic>i</italic></sub> and <inline-formula id="IEq25"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{z}}_{i}$$\end{document}</tex-math><mml:math id="M62"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq25.gif"/></alternatives></inline-formula> respectively. The penalty term is defined as <inline-formula id="IEq26"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$-\mathop{\sum }\nolimits_{j=1}^{| {z}_{i}| }{({z}_{ij}-{\hat{z}}_{ij})}^{2}$$\end{document}</tex-math><mml:math id="M64"><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq26.gif"/></alternatives></inline-formula> as we want <italic>z</italic><sub><italic>i</italic></sub> and <inline-formula id="IEq27"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{z}}_{i}$$\end{document}</tex-math><mml:math id="M66"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq27.gif"/></alternatives></inline-formula> to be as close as possible. The down-sampling ratio used in our case is 80%.</p>
          </list-item>
          <list-item>
            <p id="Par49">In our evaluations across different integration tasks and experimental settings, we have used the same values for hyperparameters and the same architecture for our neural networks. We further performed a robustness study for two learning rate parameters for Pancreas data integration (Supplementary Table <xref rid="MOESM1" ref-type="media">4)</xref>, which showed that the metrics were comparable across different values of learning rate parameters.</p>
          </list-item>
        </list>
      </p>
    </sec>
    <sec id="Sec18">
      <title>Extension of scDREAMER model for utilizing cell type labels</title>
      <p id="Par50">The scDREAMER model was further extended to scDREAMER-Supervised (scDREAMER-Sup), which can leverage existing cell type annotations to further improve biological conservation while integrating scRNA-seq datasets (Fig. <xref rid="Fig1" ref-type="fig">1</xref>). Inspired by the deep generative semi-supervised learner<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> and scANVI<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>, scDREAMER-Sup employs a hierarchical structure for the inference of an informative latent embedding <italic>z</italic> guided by the available cell type annotations <italic>c</italic>. Essentially, the prior on <italic>z</italic><sub><italic>i</italic></sub> becomes more informative as it becomes conditioned on cell type label <italic>c</italic><sub><italic>i</italic></sub> and another latent variable <italic>y</italic><sub><italic>i</italic></sub> that accounts for within cell type variability. scDREAMER-Sup employs an additional variational autoencoder, <inline-formula id="IEq28"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}=\{{E}_{y},{D}_{y}\}$$\end{document}</tex-math><mml:math id="M68"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq28.gif"/></alternatives></inline-formula> for learning <italic>y</italic><sub><italic>i</italic></sub> from <italic>z</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub>, and another feed-forward neural network (also called cell type classifier), <inline-formula id="IEq29"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M70"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq29.gif"/></alternatives></inline-formula>, for learning <italic>c</italic><sub><italic>i</italic></sub> from <italic>z</italic><sub><italic>i</italic></sub>. When cell type annotations are available, those are fed to the autoencoder <inline-formula id="IEq30"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}$$\end{document}</tex-math><mml:math id="M72"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq30.gif"/></alternatives></inline-formula> along with the latent embeddings <italic>z</italic><sub><italic>i</italic></sub> from the adversarial variational autoencoder, <inline-formula id="IEq31"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}$$\end{document}</tex-math><mml:math id="M74"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq31.gif"/></alternatives></inline-formula>. In case cell type annotations are partially available, scDREAMER-Sup learns the missing cell type labels by training the cell type classifier network using a cross-entropy loss on the set of cells for which cell type annotations are available.</p>
      <sec id="Sec19">
        <title>Training cell type classifier</title>
        <p id="Par51">The cell type classifier network, <inline-formula id="IEq32"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M76"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq32.gif"/></alternatives></inline-formula> learns its parameters by minimizing the cross-entropy loss thereby ensuring correct classification of latent embeddings <italic>z</italic> into different cell type annotations. <inline-formula id="IEq33"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M78"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq33.gif"/></alternatives></inline-formula> takes as input <italic>z</italic><sub><italic>i</italic></sub> from <inline-formula id="IEq34"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}$$\end{document}</tex-math><mml:math id="M80"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq34.gif"/></alternatives></inline-formula> and <italic>c</italic><sub><italic>i</italic></sub> (cell type annotation) as label and intends to minimize cross-entropy loss, hence classifying the latent cellular embeddings to its correct cell type. The cross-entropy loss is given by:<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$-\mathop{\sum }\limits_{i=1}^{| C| }{c}_{i}\times log({r}_{i})$$\end{document}</tex-math><mml:math id="M82"><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>C</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula>where <italic>c</italic><sub><italic>i</italic></sub> is the true cell type label, <italic>r</italic><sub><italic>i</italic></sub> is the softmax probability of the <italic>i</italic><sup><italic>t</italic><italic>h</italic></sup> cell type annotation and ∣<italic>C</italic>∣ is the number of cell types.</p>
        <p id="Par52">Under semi-supervised setting, <inline-formula id="IEq35"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M84"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq35.gif"/></alternatives></inline-formula> is trained using the labeled data, i.e., the cross-entropy loss is computed using the available cell type annotations. The trained network is then used to predict the cell type annotations for the unlabeled cells.</p>
      </sec>
      <sec id="Sec20">
        <title>Variational autoencoder for learning informed prior on cellular latent space</title>
        <p id="Par53">The variational autoencoder <inline-formula id="IEq36"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}$$\end{document}</tex-math><mml:math id="M86"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq36.gif"/></alternatives></inline-formula> consists of an encoder <italic>E</italic><sub><italic>y</italic></sub> that takes as input <italic>z</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub> and generates the mean <italic>μ</italic><sub><italic>y</italic></sub> and variance <italic>σ</italic><sub><italic>y</italic></sub> of the multivariate normal distribution (prior for <italic>y</italic>). The decoder network <italic>D</italic><sub><italic>y</italic></sub> takes as input <italic>y</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>i</italic></sub> and reconstructs latent cellular embedding <inline-formula id="IEq37"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar{{z}_{i}}$$\end{document}</tex-math><mml:math id="M88"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq37.gif"/></alternatives></inline-formula>. We assume the following distributions for <italic>y</italic><sub><italic>i</italic></sub> and <italic>z</italic><sub><italic>i</italic></sub><disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${y}_{i} \sim Normal(0,I),{z}_{i} \sim Normal({f}_{z}^{{\prime} \mu }({y}_{i},{c}_{i}),{f}_{z}^{{\prime} \sigma }({y}_{i},{c}_{i}))$$\end{document}</tex-math><mml:math id="M90"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>~</mml:mo><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>~</mml:mo><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mi>σ</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq38"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{z}^{{\prime} \mu }$$\end{document}</tex-math><mml:math id="M92"><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq38.gif"/></alternatives></inline-formula> and <inline-formula id="IEq39"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{z}^{{\prime} \sigma }$$\end{document}</tex-math><mml:math id="M94"><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mi>σ</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq39.gif"/></alternatives></inline-formula> are two functions approximated by the variational autoencoder <inline-formula id="IEq40"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}$$\end{document}</tex-math><mml:math id="M96"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq40.gif"/></alternatives></inline-formula>.</p>
        <p id="Par54">We use <italic>ϕ</italic> = {<italic>f</italic><sub><italic>E</italic></sub>, <italic>f</italic><sub><italic>D</italic></sub>}, and <inline-formula id="IEq41"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\phi }^{{\prime} }=\{{f}_{{E}_{y}},{f}_{{D}_{y}}\}$$\end{document}</tex-math><mml:math id="M98"><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq41.gif"/></alternatives></inline-formula> to denote the network parameters of the two variational autoencoders (<inline-formula id="IEq42"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{E}}}$$\end{document}</tex-math><mml:math id="M100"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq42.gif"/></alternatives></inline-formula> and <inline-formula id="IEq43"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{{A}}}}}}}_{Y}}}$$\end{document}</tex-math><mml:math id="M102"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq43.gif"/></alternatives></inline-formula> respectively) of scDREAMER-Sup which we learn using variational inference by maximizing an ELBO function given by:<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{rcl}ELBO&amp;=&amp;{E}_{{q}_{\phi }(z,l| x,s)}\left[log\,p(x| z,l,s)\right]-KL({q}_{\phi }(z| x,s)\,| | \,{E}_{{q}_{{\phi }^{{\prime} }}(y| z,c)}p(z| y,c))\\ &amp;&amp;-{E}_{{q}_{\phi }(z| x,s)}\,KL({q}_{{\phi }^{{\prime} }}(y| z,c)\,| | \,p(y))-KL({q}_{\phi }(l| x,s)\,| | \,p(l))\end{array}$$\end{document}</tex-math><mml:math id="M104"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi>E</mml:mi><mml:mi>L</mml:mi><mml:mi>B</mml:mi><mml:mi>O</mml:mi></mml:mtd><mml:mtd columnalign="center"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mspace width="0.25em"/><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.25em"/><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"/><mml:mtd columnalign="center"/><mml:mtd columnalign="left"><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.25em"/><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mspace width="0.25em"/><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.25em"/><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:mspace width="0.25em"/><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>equation (<xref rid="Equ9" ref-type="disp-formula">9</xref>) denotes the ELBO function for only one cell (this is without loss of generality as the cells are independent and identically distributed) and assumes the following factorization of the variational distribution<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$q(z,y,l| x,s)=q(z| x,s)q(y| z,c)q(l| x,s)$$\end{document}</tex-math><mml:math id="M106"><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>∣</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula>The ELBO is derived following semi-supervised variational autoencoder literature<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>. Our variational distribution does not approximate the posterior for cell type annotation <italic>c</italic>, instead for the cases, where <italic>c</italic> is unavailable, we use the cell type classifier to generate the cell type annotations.</p>
      </sec>
      <sec id="Sec21">
        <title>Implementation details of scDREAMER-Sup</title>
        <p id="Par55">scDREAMER-Sup has three additional neural networks corresponding to the Encoder <italic>E</italic><sub><italic>y</italic></sub>, Decoder <italic>D</italic><sub><italic>y</italic></sub> and the cell type classifier <inline-formula id="IEq44"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{C}}}}}}}}$$\end{document}</tex-math><mml:math id="M108"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">C</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq44.gif"/></alternatives></inline-formula>, all with multi-layer dense neural network architecture with linear relu activation at the end of each layer. For training our model, we have adopted ADAM optimizer. The batch size of 128 was used while training the model.</p>
      </sec>
      <sec id="Sec22">
        <title>Preprocessing of scRNA-seq datasets</title>
        <p id="Par56">The scRNA-seq datasets were preprocessed using the standard pipeline of Scanpy<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. Raw count expression matrices were imported as Scanpy AnnData object followed by the removal of low-quality cells based on the mitochondrial gene counts. The expression matrices were then normalized (using “scanpy.pp.normalize_total” function) and log-transformed. Finally, we selected the top 2000 highly variable genes using the function “scanpy.pp.highly_variable_genes” (with flavor parameter as “seurat”) as input to scDREAMER and other methods. The genes that were present across all the batches were considered. For the healthy heart atlas dataset, cells annotated as doublets were removed.</p>
      </sec>
    </sec>
    <sec id="Sec23">
      <title>Metrics for the evaluation of integration performance</title>
      <p id="Par57">The data integration performance of all methods was primarily evaluated based on two broad categories of metrics: (1) biological variance conservation metrics and (2) batch effect correction metrics. Following a recent study<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>, we considered NMI, ARI, and ASW (cell type) as biological conservation metrics. For the evaluation of batch effect removal, we considered four metrics: ASW (batch), principal component regression (batch), graph connectivity, and kBET. For a holistic comparison of the performance across all the metrics in both of these categories, we introduced two composite scores and a combined composite score as described below. In addition, we computed isolated label F1 and isolated label silhouette scores for evaluating a method’s ability to capture rare cell identities. We also computed single-cell level metrics: graph iLISI (for batch correction), graph cLISI (for bio-conservation), and proportion of true positive vs positive cells.</p>
      <sec id="Sec24">
        <title>Biological conservation metrics</title>
        <p id="Par58">The computation of the biological conservation metrics requires clustering of the integrated data. We have used the Louvain clustering algorithm to compute the clusters with a resolution that maximizes the NMI value. The same clustering assignment is used for computing other metrics<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>.<list list-type="bullet"><list-item><p id="Par59"><bold>Normalized mutual information (NMI):</bold> NMI compares the overlap between any two clustering assignments where the overlap is measured in terms of mutual information. The NMI value is scaled in the range of 0 to 1 based on the mean entropy for cluster assignments and cell-type labels.</p></list-item><list-item><p id="Par60"><bold>Adjusted Rand Index (ARI):</bold> Rand index compares two clustering assignments considering all pairs of points and finding agreement and disagreement between the clustering assignments<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. The adjusted rand index (ARI) accounts for the randomly correct labels and it ranges from 0 to 1 with 0 corresponding to random clustering, and 1 representing a perfect match between the clusterings<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>. For ARI calculation, we compared the cell labels with the optimized NMI Louvain clusters.</p></list-item><list-item><p id="Par61"><bold>Cell type average silhouette width (ASW):</bold> Silhouette width for cell <italic>i</italic> is given by:<disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{r}sw(i)=\frac{b(i)-a(i)}{\max \{a(i),b(i)\}}\end{array}$$\end{document}</tex-math><mml:math id="M110"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi>s</mml:mi><mml:mi>w</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>max</mml:mi><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula>where <italic>a</italic>(<italic>i</italic>) is the average of distances of cell <italic>i</italic> to the other cells in the same cluster and <italic>b</italic>(<italic>i</italic>) is the average distance of cell <italic>i</italic> from the cells in the other nearest cluster. Average silhouette width (ASW) is calculated by averaging over all cells and it ranges between −1 to 1, where −1 or 0 indicates that clusters are overlapping and 1 corresponds to well-separated and dense clusters. As a bio-conservation metric, we computed cell type ASW by considering the cell types as the clusters and scaled between 0 to 1 by the transformation ASW = (ASW + 1)/2. The PCA reduced space is used for the calculation of distances for the corrected space output method. This metric is not applicable to the graph-based method BBKNN.</p></list-item></list></p>
      </sec>
      <sec id="Sec25">
        <title>Batch correction metrics</title>
        <p id="Par62">
          <list list-type="bullet">
            <list-item>
              <p id="Par63"><bold>ASW batch:</bold> ASW is calculated between the batches of each subset based on the cell type. Here the 0 value indicates that the batches are well-mixed. So we scaled the <italic>A</italic><italic>S</italic><italic>W</italic> = 1 − <italic>a</italic><italic>b</italic><italic>s</italic>(<italic>A</italic><italic>S</italic><italic>W</italic>). Now the scaled value 0 indicates that the batches are not well-mixed, 1 indicates that batches are well-mixed.</p>
            </list-item>
            <list-item>
              <p id="Par64"><bold>Principal component regression (PCR) batch:</bold> In principal component regression (PCR) batch<sup><xref ref-type="bibr" rid="CR47">47</xref></sup>, for each principal component (<italic>P</italic><italic>C</italic><sub><italic>k</italic></sub>) (calculated using PCA), the variance contributed by each batch <italic>b</italic> is computed as:<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{r}Var(M| b)=\mathop{\sum }\limits_{k=1}^{N}Var(M| P{C}_{i})*{R}^{2}(P{C}_{i}| b)\end{array}$$\end{document}</tex-math><mml:math id="M112"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi>V</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>M</mml:mi><mml:mo>∣</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mi>V</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>M</mml:mi><mml:mo>∣</mml:mo><mml:mi>P</mml:mi><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>P</mml:mi><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula>Where <italic>V</italic><italic>a</italic><italic>r</italic>(<italic>M</italic>∣<italic>P</italic><italic>C</italic><sub><italic>i</italic></sub>) indicates the variance explained by <italic>P</italic><italic>C</italic><sub><italic>i</italic></sub> on the data matrix <italic>M</italic>, and <italic>R</italic><sup>2</sup> denotes the coefficient of determination calculated using a linear regression with <italic>P</italic><italic>C</italic><sub><italic>i</italic></sub> as the dependent and <italic>b</italic> as the independent variable.</p>
            </list-item>
            <list-item>
              <p id="Par65"><bold>Graph connectivity</bold> Graph connectivity measures whether cells from the same cell type are well connected in the kNN graph. First, we compute the kNN graph with all the cells. Then we create a subset kNN graph with the cells from a particular cell type and check the number of cells in its largest connected component.<disp-formula id="Equ13"><label>13</label><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$GC=\frac{1}{| CT| }\mathop{\sum}\limits_{c\in CT}\frac{| LCC\left.\right(G({N}_{c},{E}_{c})| }{| {N}_{c}| }$$\end{document}</tex-math><mml:math id="M114"><mml:mi>G</mml:mi><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>C</mml:mi><mml:mi>T</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mi>C</mml:mi><mml:mi>T</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mo>∣</mml:mo><mml:mi>L</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi><mml:mfenced close="("><mml:mrow/></mml:mfenced><mml:mi>G</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∣</mml:mo></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43590_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula>Where <italic>C</italic><italic>T</italic> is the set of cell types, ∣<italic>L</italic><italic>C</italic><italic>C</italic>()∣ is the number of cells in the largest connected component. <italic>G</italic>(<italic>N</italic><sub><italic>c</italic></sub>, <italic>E</italic><sub><italic>c</italic></sub>) is the kNN subgraph for cell type <italic>c</italic> with <italic>N</italic><sub><italic>c</italic></sub> as the number of cells in cell type <italic>c</italic> and <italic>E</italic><sub><italic>c</italic></sub> denoting the edges in the kNN graph containing only the cells of type <italic>c</italic>.</p>
            </list-item>
            <list-item>
              <p id="Par66"><bold>k-nearest neighbor batch effect test (</bold><bold><italic>k</italic></bold><bold><italic>B</italic></bold><bold><italic>E</italic></bold><bold><italic>T</italic></bold><bold>):</bold> k-nearest neighbor batch effect test (<italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic>)<sup><xref ref-type="bibr" rid="CR47">47</xref></sup> evaluates how well the label configuration of the k-nearest neighborhoods of cells matches the global label configuration. <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> test is performed iteratively over a random subset of cells, and the value is calculated as the total rejection rates over all the iterations. As <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> works on the kNN graph, for the embedding-based output and corrected feature output methods, we have used <italic>k</italic> = 50 for calculating the kNN graph. <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> is applied to each batch separately to account for technical effects and changes in the cell type distribution across batches. For the kNN graphs containing disconnected components, <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> is calculated on each of the connected components. The number of nearest neighbors would differ for each cell in the graph-based method like BBKNN. So diffusion-based correction is used for graph-based output to get the same number of nearest neighbors for all the cells. <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> value is scaled between 0 to 1 so that the 0 value indicates poor batch mixing and 1 indicates perfect mixing of cells. It is important to note that for the healthy heart atlas dataset, <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> could not be computed for some of the methods due to computational limitations in handling large number of cells and batches (runs getting killed even after running for 72 h on Intel Xeon Gold 6246 CPU with 512 GB memory). This behavior of <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> has also been reported in ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. For such cases, <italic>k</italic><italic>B</italic><italic>E</italic><italic>T</italic> has been excluded when computing the composite batch correction score.</p>
            </list-item>
          </list>
        </p>
      </sec>
      <sec id="Sec26">
        <title>Isolated label metrics</title>
        <p id="Par67">We adopted two isolated label scores from ref. <sup><xref ref-type="bibr" rid="CR24">24</xref></sup> to evaluate how well a method can capture rare cell identities. Isolated labels denote the cell types that are present in the least number of batches. For each of the isolated labels, isolated F1 and isolated ASW are calculated. These two metrics reveal how well the isolated cell types are separated from the rest of the cell types after integration.</p>
        <p id="Par68">For the calculation of the isolated F1 score, first, we need to determine the clusters containing the particular isolated label. Lovain clustering is used for the clustering, and the resolution of the clustering algorithm is set such that the cluster has the largest number of isolated labels. The F1 score of isolated labels is then measured against the other cells in the cluster. F1 score ranges from 0 to 1 with 0 indicating that all the cells in the cluster are from cell types other than the isolated label and 1 indicating that all the cells are from isolated labels.</p>
        <p id="Par69">Isolated label ASW is calculated considering the isolated cell type as one cluster and all other cell types in another cluster and separately computing their ASW.</p>
      </sec>
      <sec id="Sec27">
        <title>Other metrics</title>
        <p id="Par70">
          <list list-type="bullet">
            <list-item>
              <p id="Par71"><bold>Graph inverse Simpson’s index LISI:</bold> The inverse Simpson’s index is a diversity score that calculates the number of neighbors needed to be visited before appearing in the same batch again. The value of this metric ranges from 1 to B (number of batches). This LISI score is used for the evaluation of both batch correction (iLISI) and bio-conservation (cLISI)<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. To extend the LISI to the graph-based methods graph LISI<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> is used. In graph LISI, the distance over joint embeddings is replaced with the graph-based distance between the cells to get a large number of neighbors. Dijkstra’s shortest path algorithm is used to calculate the shortest distance between the cells. In cLISI, inverse Simpson’s index is calculated over the cell types, i.e., the number of neighbors one needs to visit before getting the same cell type again in the neighborhood, whereas iLISI is calculated over the batches.</p>
            </list-item>
            <list-item>
              <p id="Par72"><bold>Proportion of positive and true positive cells:</bold> We further adopted another single-cell level summary metric from ref. <sup><xref ref-type="bibr" rid="CR22">22</xref></sup> to evaluate the integration performance. For this, first, the cells are classified into positive and negative cells. Cells surrounded by the same cell type are classified as positive; otherwise, they are classified as negative. Considering the subset of positive cells only, a positive cell is classified as true positive if the distribution of batches around it is the same as the global batch distribution. The proportion of positive cells indicates the extent of biological conservation. In contrast, the true positive percentage indicates how well the batches are well-mixed. These two proportions together serve as quantitative metrics for evaluating the batch effect removal performance.</p>
            </list-item>
          </list>
        </p>
      </sec>
      <sec id="Sec28">
        <title>Composite scores</title>
        <p id="Par73">We have introduced two composite score metrics for a holistic comparison of the performance across all the metrics for biological conservation and batch correction respectively. Moreover, we computed a combined composite score that measures the average performance of a method in biological conservation and batch correction. Each composite score is computed by averaging the scaled values of all the metrics in that category. For a dataset, the scaled value for each individual metric is obtained through min-max normalization across all the competing methods.</p>
        <p id="Par74">The composite scores are calculated as follows:<list list-type="order"><list-item><p id="Par75"><bold>Composite bio-conservation score</bold> = <inline-formula id="IEq45"><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left(\frac{NM{I}^{{\prime} }+AS{W}^{{\prime} }+AR{I}^{{\prime} }}{3}\right)$$\end{document}</tex-math><mml:math id="M116"><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>N</mml:mi><mml:mi>M</mml:mi><mml:msup><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>A</mml:mi><mml:mi>S</mml:mi><mml:msup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>A</mml:mi><mml:mi>R</mml:mi><mml:msup><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq45.gif"/></alternatives></inline-formula></p></list-item><list-item><p id="Par76"><bold>Composite batch correction score</bold> = <inline-formula id="IEq46"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left(\frac{ASW{(batch)}^{{\prime} }+PCR\,{{\mbox{\_}}}batc{h}^{{\prime} }+graph{{\mbox{\_}}}\,connectivit{y}^{{\prime} }+kBE{T}^{{\prime} }}{4}\right)$$\end{document}</tex-math><mml:math id="M118"><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>A</mml:mi><mml:mi>S</mml:mi><mml:mi>W</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>P</mml:mi><mml:mi>C</mml:mi><mml:mi>R</mml:mi><mml:mspace width="0.25em"/><mml:mo>_</mml:mo><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:msup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi><mml:mo>_</mml:mo><mml:mspace width="0.25em"/><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>v</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi><mml:msup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mi>E</mml:mi><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq46.gif"/></alternatives></inline-formula></p></list-item><list-item><p id="Par77"><bold>Composite isolated label score</bold> = <inline-formula id="IEq47"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left(\frac{isolated\,{{\mbox{\_}}}f1{{\mbox{\_}}}scor{e}^{{\prime} }+isolated{{\mbox{\_}}}\,AS{W}^{{\prime} }}{2}\right)$$\end{document}</tex-math><mml:math id="M120"><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mspace width="0.25em"/><mml:mo>_</mml:mo><mml:mi>f</mml:mi><mml:mn>1</mml:mn><mml:mo>_</mml:mo><mml:mi>s</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo>_</mml:mo><mml:mspace width="0.25em"/><mml:mi>A</mml:mi><mml:mi>S</mml:mi><mml:msup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq47.gif"/></alternatives></inline-formula></p></list-item><list-item><p id="Par78"><bold>Combined composite score</bold> = <inline-formula id="IEq48"><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{1}{2}$$\end{document}</tex-math><mml:math id="M122"><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq48.gif"/></alternatives></inline-formula>(Composite bio-conservation score + Composite batch correction score)</p></list-item></list>For any metric <inline-formula id="IEq49"><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${M}_{e},{M}_{e}^{{\prime} }$$\end{document}</tex-math><mml:math id="M124"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43590_Article_IEq49.gif"/></alternatives></inline-formula> denotes the min-max scaled value across all the competing methods.</p>
      </sec>
      <sec id="Sec29">
        <title>Metric for evaluating the accuracy of cell label prediction</title>
        <p id="Par79">We have adopted macro F1-score to evaluate how well a method can predict the cell type labels for the datasets with missing cell type labels. The F1-score metric measures the classification accuracy as the harmonic mean of precision and recall. In the context of cell label prediction, multiple classes are involved and F1-score is computed for every cell type annotation (class). Macro F1-score computes the overall accuracy of a multi-class classifier by aggregation of F1-scores for all the individual classes. For the prediction of cell type labels, it is computed by taking the arithmetic mean of the F1-scores for all the cell type annotations.</p>
      </sec>
    </sec>
    <sec id="Sec30">
      <title>Competing integration methods</title>
      <p id="Par80">We have compared our method against eleven state-of-the-art integration methods: scVI<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>, Scanaroma<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>, Harmony<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>, Seurat<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>, BBKNN<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>, INSCT<sup><xref ref-type="bibr" rid="CR48">48</xref></sup>, LIGER<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>, iMAP<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, scANVI<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>, scGEN<sup><xref ref-type="bibr" rid="CR31">31</xref></sup> and scDML<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. The details about the run configuration for these methods are provided in Supplementary Table <xref rid="MOESM1" ref-type="media">5</xref>.</p>
    </sec>
    <sec id="Sec31">
      <title>Statistics and reproducibility</title>
      <p id="Par81">No statistical method was used to predetermine the sample size. No data were excluded from the analyses. The experiments involved running computational methods on previously published, publicly available datasets and did not require randomization. The investigators were not blinded to allocation during experiments and assessment of outcome.</p>
    </sec>
    <sec id="Sec32">
      <title>Reporting summary</title>
      <p id="Par82">Further information on research design is available in the <xref rid="MOESM3" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec33">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_43590_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information file</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_43590_MOESM2_ESM.pdf">
            <caption>
              <p>Peer review file</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_43590_MOESM3_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
    <sec id="Sec34">
      <title>Source data</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_43590_MOESM4_ESM.xlsx">
            <caption>
              <p>Source data</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_43590_MOESM5_ESM.txt">
            <caption>
              <p>Author Meta Data</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Ajita Shree, Musale Krushna Pavan.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-43590-8.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was partially supported by the Science and Engineering Research Board (SERB), Government of India (SRG/2020/001333) and IIT Kanpur initiation grant (IITK /CS /2019236) to H.Z. Funding for open access charge is obtained from IIT Kanpur Research I Foundation grant 20030163.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>H.Z. designed the study. A.S., M.K.P., and H.Z. developed the model and algorithm. A.S. and M.K.P. implemented the software and performed all experiments. All authors wrote and approved the manuscript.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par83"><italic>Nature Communications</italic> thanks the anonymous, reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All datasets used in this study are publicly available. The human pancreas data used in this study are available in the GEO database under accession codes “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81076">GSE81076</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81076">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81076</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE85241">GSE85241</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE85241">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE85241</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE86469">GSE86469</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE86469">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE86469</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE84133">GSE84133</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE84133">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE84133</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81608">GSE81608</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81608">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81608</ext-link>]”, and the ArrayExpress database under the accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/biostudies/arrayexpress/studies/E-MTAB-5061">E-MTAB-5061</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/biostudies/arrayexpress/studies/E-MTAB-5061">https://www.ebi.ac.uk/biostudies/arrayexpress/studies/E-MTAB-5061</ext-link>]”<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. The lung atlas data is available in the GEO database under accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE130148">GSE130148</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE130148">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE130148</ext-link>]”. The human immune data used in this study are available in the GEO database under accession codes “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE120221">GSE120221</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE120221">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE120221</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE107727">GSE107727</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE107727">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE107727</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE115189">GSE115189</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE115189">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE115189</ext-link>]”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE128066">GSE128066</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE128066">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE128066</ext-link>]” and “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE94820">GSE94820</ext-link> [<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE94820">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE94820</ext-link>]” and in the website of 10X Genomics (PBMC10k: <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.0/pbmc_10k_v3">https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.0/pbmc_10k_v3</ext-link>)<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. The processed human pancreas, human immune, and lung atlas datasets are available at <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/dataset/Benchmarking_atlas-level_data_integration_in_single-cell_genomics_-_integration_task_datasets_Immune_and_pancreas_/12420968">https://figshare.com/articles/dataset/Benchmarking_atlas-level_data_integration_in_single-cell_genomics_-_integration_task_datasets_Immune_and_pancreas_/12420968</ext-link><sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. The Macaque Retina dataset is available at <ext-link ext-link-type="uri" xlink:href="https://singlecell.broadinstitute.org/single_cell/study/SCP212/molecular-specification-of-retinal-cell-types-underlying-central-and-peripheral-vision-in-primates#study-download">https://singlecell.broadinstitute.org/single_cell/study/SCP212/molecular-specification-of-retinal-cell-types-underlying-central-and-peripheral-vision-in-primates#study-download</ext-link>. The Healthy Heart data used in this study is available at <ext-link ext-link-type="uri" xlink:href="https://www.heartcellatlas.org/">https://www.heartcellatlas.org/</ext-link><sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. The processed Healthy Heart data used in this study can be downloaded from <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/dataset/Batch_Alignment_of_single-cell_transcriptomics_data_using_Deep_Metric_Learning/20499630/2">https://figshare.com/articles/dataset/Batch_Alignment_of_single-cell_transcriptomics_data_using_Deep_Metric_Learning/20499630/2</ext-link><sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. The Human and Mouse cell Atlas datasets used in the study are available at <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/dataset/MCA_DGE_Data/5435866">https://figshare.com/articles/dataset/MCA_DGE_Data/5435866</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/dataset/HCL_DGE_Data/7235471">https://figshare.com/articles/dataset/HCL_DGE_Data/7235471</ext-link>, respectively. The processed Human-Mouse cell atlas data can be downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/lkmklsmn/insct/tree/master/reproducibilty">https://github.com/lkmklsmn/insct/tree/master/reproducibilty</ext-link><sup><xref ref-type="bibr" rid="CR48">48</xref></sup>. All the processed datasets for the missing label experiments (for lung atlas, human immune and heart atlas tasks) are openly available at 10.6084/m9.figshare.24354295. The details of the experimental biological datasets used in this study are further provided in Supplementary Table <xref rid="MOESM1" ref-type="media">1</xref>. All other data supporting the findings of this study are available within the article and its supplementary files. Any additional requests for information can be directed to, and will be fulfilled by, the corresponding author. <xref ref-type="sec" rid="Sec34">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The source code and usage tutorial for scDREAMER are freely available at <ext-link ext-link-type="uri" xlink:href="https://github.com/Zafar-Lab/scDREAMER">https://github.com/Zafar-Lab/scDREAMER</ext-link>, the code has also been deposited via Zenodo (10.5281/zenodo.10021620)<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. All analysis and results presented in the manuscript are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/Zafar-Lab/scDREAMER-reproducibility">https://github.com/Zafar-Lab/scDREAMER-reproducibility</ext-link>, which have also been deposited via Zenodo (10.5281/zenodo.10021936)<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par84">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA sequencing to explore immune cell heterogeneity</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2018</year>
        <volume>18</volume>
        <fpage>35</fpage>
        <lpage>45</lpage>
        <pub-id pub-id-type="doi">10.1038/nri.2017.76</pub-id>
        <?supplied-pmid 28787399?>
        <pub-id pub-id-type="pmid">28787399</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pijuan-Sala</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell molecular map of mouse gastrulation and early organogenesis</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>566</volume>
        <fpage>490</fpage>
        <lpage>495</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-0933-9</pub-id>
        <?supplied-pmid 30787436?>
        <pub-id pub-id-type="pmid">30787436</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suvà</surname>
            <given-names>ML</given-names>
          </name>
          <name>
            <surname>Tirosh</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA sequencing in cancer: lessons learned and emerging challenges</article-title>
        <source>Mol. Cell</source>
        <year>2019</year>
        <volume>75</volume>
        <fpage>7</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1016/j.molcel.2019.05.003</pub-id>
        <?supplied-pmid 31299208?>
        <pub-id pub-id-type="pmid">31299208</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rozenblatt-Rosen</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Stubbington</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
        </person-group>
        <article-title>The human cell atlas: from vision to reality</article-title>
        <source>Nature</source>
        <year>2017</year>
        <volume>550</volume>
        <fpage>451</fpage>
        <lpage>453</lpage>
        <pub-id pub-id-type="doi">10.1038/550451a</pub-id>
        <?supplied-pmid 29072289?>
        <pub-id pub-id-type="pmid">29072289</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Snyder</surname>
            <given-names>MP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The human body at cellular resolution: the NIH human biomolecular atlas program</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>574</volume>
        <fpage>187</fpage>
        <lpage>192</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1629-x</pub-id>
        <pub-id pub-id-type="pmid">31597973</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mereu</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking single-cell RNA-sequencing protocols for cell atlas projects</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2020</year>
        <volume>38</volume>
        <fpage>747</fpage>
        <lpage>755</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0469-4</pub-id>
        <?supplied-pmid 32518403?>
        <pub-id pub-id-type="pmid">32518403</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tabula Muris Consortium</surname>
          </name>
          <etal/>
        </person-group>
        <article-title>A single cell transcriptomic atlas characterizes aging tissues in the mouse</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>583</volume>
        <fpage>590</fpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2496-1</pub-id>
        <pub-id pub-id-type="pmid">32669714</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gehring</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Hwee Park</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Thomson</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Highly multiplexed single-cell RNA-seq by DNA oligonucleotide tagging of cellular proteins</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2020</year>
        <volume>38</volume>
        <fpage>35</fpage>
        <lpage>38</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0372-z</pub-id>
        <?supplied-pmid 31873215?>
        <pub-id pub-id-type="pmid">31873215</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luecken</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Current best practices in single-cell RNA-seq analysis: a tutorial</article-title>
        <source>Mol. Syst. Biol.</source>
        <year>2019</year>
        <volume>15</volume>
        <fpage>e8746</fpage>
        <pub-id pub-id-type="doi">10.15252/msb.20188746</pub-id>
        <?supplied-pmid 31217225?>
        <pub-id pub-id-type="pmid">31217225</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pandey</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Zafar</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Inference of cell state transitions and cell fate plasticity from single-cell with MARGARET</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2022</year>
        <volume>50</volume>
        <fpage>e86</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkac412</pub-id>
        <?supplied-pmid 35639499?>
        <pub-id pub-id-type="pmid">35639499</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Argelaguet</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Cuomo</surname>
            <given-names>AS</given-names>
          </name>
          <name>
            <surname>Stegle</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Computational principles and challenges in single-cell data integration</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>1202</fpage>
        <lpage>1215</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-00895-7</pub-id>
        <?supplied-pmid 33941931?>
        <pub-id pub-id-type="pmid">33941931</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lähnemann</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Eleven grand challenges in single-cell data science</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>1</fpage>
        <lpage>35</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-1926-6</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kiselev</surname>
            <given-names>VY</given-names>
          </name>
          <name>
            <surname>Yiu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hemberg</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>scmap: projection of single-cell RNA-seq data across data sets</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>359</fpage>
        <lpage>362</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4644</pub-id>
        <?supplied-pmid 29608555?>
        <pub-id pub-id-type="pmid">29608555</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ge</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Alavi</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Xing</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Bar-Joseph</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Supervised adversarial alignment of single-cell RNA-seq data</article-title>
        <source>J. Comput. Biol.</source>
        <year>2021</year>
        <volume>28</volume>
        <fpage>501</fpage>
        <lpage>513</lpage>
        <pub-id pub-id-type="doi">10.1089/cmb.2020.0439</pub-id>
        <?supplied-pmid 33470876?>
        <pub-id pub-id-type="pmid">33470876</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id>
        <?supplied-pmid 31740819?>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hie</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Bryson</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Berger</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Efficient integration of heterogeneous single-cell transcriptomes using Scanorama</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>685</fpage>
        <lpage>691</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0113-3</pub-id>
        <?supplied-pmid 31061482?>
        <pub-id pub-id-type="pmid">31061482</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Polański</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>BBKNN: fast batch alignment of single cell transcriptomes</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>964</fpage>
        <lpage>965</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btz625</pub-id>
        <?supplied-pmid 31400197?>
        <pub-id pub-id-type="pmid">31400197</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Welch</surname>
            <given-names>JD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell multi-omic integration compares and contrasts features of brain cell identity</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1873</fpage>
        <lpage>1887</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.006</pub-id>
        <?supplied-pmid 31178122?>
        <pub-id pub-id-type="pmid">31178122</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
        <?supplied-pmid 30504886?>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deep learning enables accurate clustering with batch effect removal in single-cell RNA-seq analysis</article-title>
        <source>Nat. Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>1</fpage>
        <lpage>14</lpage>
        <pub-id pub-id-type="pmid">31911652</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>iMAP: integration of multiple single-cell datasets by adversarial paired transfer networks</article-title>
        <source>Genome Biol.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>1</fpage>
        <lpage>24</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-021-02280-8</pub-id>
        <pub-id pub-id-type="pmid">33397451</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <mixed-citation publication-type="other">Kodali, N., Abernethy, J., Hays, J. &amp; Kira, Z. On convergence and stability of GANs. Preprint at <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1705.07215">https://arxiv.org/abs/1705.07215</ext-link> (2017).</mixed-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">Luecken, M. D. et al. Benchmarking atlas-level data integration in single-cell genomics. <italic>Nat. Methods</italic><bold>19</bold>, 41–50 (2022).</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <mixed-citation publication-type="other">Oetjen, K. A. et al. Human bone marrow assessment by single-cell RNA sequencing, mass cytometry, and flow cytometry. <italic>JCI Insight</italic><bold>3</bold>, e124928 (2018).</mixed-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>GX</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>
        <source>Nat. Commun.</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>14049</fpage>
        <pub-id pub-id-type="doi">10.1038/ncomms14049</pub-id>
        <?supplied-pmid 28091601?>
        <pub-id pub-id-type="pmid">28091601</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Freytag, S., Tian, L., Lönnstedt, I., Ng, M. &amp; Bahlo, M. Comparison of clustering tools in R for medium-sized 10x genomics single-cell RNA-sequencing data. <italic>F1000Res.</italic><bold>7</bold>, 1297 (2018).</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A Bayesian mixture model for clustering droplet-based single-cell transcriptomic data from population studies</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>1</fpage>
        <lpage>10</lpage>
        <pub-id pub-id-type="pmid">30602773</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Villani</surname>
            <given-names>A-C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA-seq reveals new types of human blood dendritic cells, monocytes, and progenitors</article-title>
        <source>Science</source>
        <year>2017</year>
        <volume>356</volume>
        <fpage>eaah4573</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aah4573</pub-id>
        <?supplied-pmid 28428369?>
        <pub-id pub-id-type="pmid">28428369</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xu</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Probabilistic harmonization and annotation of single-cell transcriptomics data with deep generative models</article-title>
        <source>Mol. Syst. Biol.</source>
        <year>2021</year>
        <volume>17</volume>
        <fpage>e9620</fpage>
        <pub-id pub-id-type="doi">10.15252/msb.20209620</pub-id>
        <?supplied-pmid 33491336?>
        <pub-id pub-id-type="pmid">33491336</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lotfollahi</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>scGen predicts single-cell perturbation responses</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>715</fpage>
        <lpage>721</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0494-8</pub-id>
        <?supplied-pmid 31363220?>
        <pub-id pub-id-type="pmid">31363220</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <mixed-citation publication-type="other">Kanemaru, K. et al. Spatially resolved multiomics of human cardiac niches. <italic>Nature</italic><bold>619</bold>, 801–810 (2023).</mixed-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>Batch alignment of single-cell transcriptomics data using deep metric learning</article-title>
        <source>Nat. Commun.</source>
        <year>2023</year>
        <volume>14</volume>
        <fpage>960</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-023-36635-5</pub-id>
        <?supplied-pmid 36810607?>
        <pub-id pub-id-type="pmid">36810607</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Peng</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular classification and comparative taxonomics of foveal and peripheral cells in primate retina</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>176</volume>
        <fpage>1222</fpage>
        <lpage>1237</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.01.004</pub-id>
        <?supplied-pmid 30712875?>
        <pub-id pub-id-type="pmid">30712875</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Han</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping the mouse cell atlas by microwell-seq</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>172</volume>
        <fpage>1091</fpage>
        <lpage>1107</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.02.001</pub-id>
        <?supplied-pmid 29474909?>
        <pub-id pub-id-type="pmid">29474909</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Han</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Construction of a human cell landscape at single-cell level</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>581</volume>
        <fpage>303</fpage>
        <lpage>309</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2157-4</pub-id>
        <?supplied-pmid 32214235?>
        <pub-id pub-id-type="pmid">32214235</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Mukherjee</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kannan</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>A deep adversarial variational autoencoder model for dimensionality reduction in single-cell RNA sequencing analysis</article-title>
        <source>BMC Bioinformatics</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>1</fpage>
        <lpage>11</lpage>
        <pub-id pub-id-type="doi">10.1186/s12859-020-3401-5</pub-id>
        <pub-id pub-id-type="pmid">31898485</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Litviňuková</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cells of the adult human heart</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>588</volume>
        <fpage>466</fpage>
        <lpage>472</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2797-4</pub-id>
        <?supplied-pmid 32971526?>
        <pub-id pub-id-type="pmid">32971526</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <mixed-citation publication-type="other">Suo, C. et al. Mapping the developing human immune system across organs. <italic>Science</italic><bold>376</bold>, eabo0510 (2022).</mixed-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Jones, R. C. et al. The Tabula Sapiens: a multiple-organ, single-cell transcriptomic atlas of humans. <italic>Science</italic><bold>376</bold>, eabl4896 (2022).</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Kingma, D. P. &amp; Ba, J. Adam: a method for stochastic optimization. Preprint at <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1412.6980">https://arxiv.org/abs/1412.6980</ext-link> (2014).</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ding</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Deep generative model embedding of single-cell RNA-seq profiles on hyperspheres and hyperbolic spaces</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>1</fpage>
        <lpage>17</lpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-22851-4</pub-id>
        <pub-id pub-id-type="pmid">33397941</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kingma</surname>
            <given-names>DP</given-names>
          </name>
          <name>
            <surname>Mohamed</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Jimenez Rezende</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Welling</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Semi-supervised learning with deep generative models</article-title>
        <source>Adv. Neural Inf. Process. Syst.</source>
        <year>2014</year>
        <volume>27</volume>
        <fpage>3581</fpage>
        <lpage>3589</lpage>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>1</fpage>
        <lpage>5</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id>
        <pub-id pub-id-type="pmid">29301551</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rand</surname>
            <given-names>WM</given-names>
          </name>
        </person-group>
        <article-title>Objective criteria for the evaluation of clustering methods</article-title>
        <source>J. Am. Stat. Assoc.</source>
        <year>1971</year>
        <volume>66</volume>
        <fpage>846</fpage>
        <lpage>850</lpage>
        <pub-id pub-id-type="doi">10.1080/01621459.1971.10482356</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hubert</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Arabie</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Comparing partitions</article-title>
        <source>J. Classif.</source>
        <year>1985</year>
        <volume>2</volume>
        <fpage>193</fpage>
        <lpage>218</lpage>
        <pub-id pub-id-type="doi">10.1007/BF01908075</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Büttner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Miao</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>A test metric for assessing single-cell RNA-seq batch correction</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>43</fpage>
        <lpage>49</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0254-1</pub-id>
        <?supplied-pmid 30573817?>
        <pub-id pub-id-type="pmid">30573817</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Simon</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Y-Y</given-names>
          </name>
          <name>
            <surname>Zhao</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Integration of millions of transcriptomes using batch-aware triplet neural networks</article-title>
        <source>Nat. Mach. Intell.</source>
        <year>2021</year>
        <volume>3</volume>
        <fpage>705</fpage>
        <lpage>715</lpage>
        <pub-id pub-id-type="doi">10.1038/s42256-021-00361-8</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <mixed-citation publication-type="other">Shree, A., Musale, K. P. &amp; Zafar, H. Zafar-lab/scdreamer. Zenodo 10.5281/zenodo.10021620 (2023).</mixed-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <mixed-citation publication-type="other">Shree, A., Musale, K. P. &amp; Zafar, H. Zafar-lab/scdreamer-reproducibility. Zenodo 10.5281/zenodo.10021936 (2023).</mixed-citation>
    </ref>
  </ref-list>
</back>
