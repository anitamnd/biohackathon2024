<?properties open_access?>
<?properties manuscript?>
<?origin nihpa?>
<?iso-abbr Nat. Methods?>
<?submitter-system nihms?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 8068858?>
<?submitter-authority myNCBI?>
<?submitter-login nature-structure?>
<?submitter-name Nature Publishing Group?>
<?domain nihpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5330805</article-id>
    <article-id pub-id-type="pmid">28114287</article-id>
    <article-id pub-id-type="doi">10.1038/nmeth.4150</article-id>
    <article-id pub-id-type="manuscript">nihpa838884</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Single-cell mRNA quantification and differential analysis with Census</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Qiu</surname>
          <given-names>Xiaojie</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hill</surname>
          <given-names>Andrew</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Packer</surname>
          <given-names>Jonathan</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lin</surname>
          <given-names>Dejun</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ma</surname>
          <given-names>Yi-An</given-names>
        </name>
        <xref ref-type="aff" rid="A3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Trapnell</surname>
          <given-names>Cole</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref rid="FN1" ref-type="author-notes">*</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Department of Genome Sciences, University of Washington, Seattle, WA, 98195, USA</aff>
    <aff id="A2"><label>2</label>Molecular &amp; Cellular Biology Program, University of Washington, Seattle, WA, 98195, USA</aff>
    <aff id="A3"><label>3</label>Department of Applied Mathematics, University of Washington, Seattle, WA 98195, USA</aff>
    <author-notes>
      <corresp id="FN1"><label>*</label>Corresponding author: <email>coletrap@uw.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>4</day>
      <month>1</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>23</day>
      <month>1</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>3</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>23</day>
      <month>7</month>
      <year>2017</year>
    </pub-date>
    <volume>14</volume>
    <issue>3</issue>
    <fpage>309</fpage>
    <lpage>315</lpage>
    <!--elocation-id from pubmed: 10.1038/nmeth.4150-->
    <permissions>
      <license xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:<ext-link ext-link-type="uri" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</ext-link></license-p>
      </license>
    </permissions>
    <abstract>
      <p id="P1">Single-cell gene expression studies promise to unveil rare cell types and cryptic states in development and disease through a stunningly high-resolution view of gene regulation. However, measurements from single-cell RNA-Seq are highly variable, frustrating efforts to assay how expression differs between cells. We introduce Census, an algorithm available through our single-cell analysis toolkit Monocle 2, which converts relative RNA-Seq expression levels into relative transcript counts without the need for experimental spike-in controls. We show that analyzing changes in relative transcript counts leads to dramatic improvements in accuracy compared to normalized read counts and enables new statistical tests for identifying developmentally regulated genes. We explore the power of Census through reanalysis of single-cell studies in several developmental and disease contexts. Census counts can be analyzed with widely used regression techniques to reveal changes in cell fate-dependent gene expression, splicing patterns, and allelic imbalances, demonstrating that Census enables robust single-cell analysis at multiple layers of gene regulation.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <sec sec-type="intro" id="S1">
    <title>Introduction</title>
    <p id="P2">Differential gene expression analysis, typically powered by statistical regression, is central to nearly all single-cell transcriptomic studies. As experiments now capture tens of thousands of cells<sup><xref rid="R1" ref-type="bibr">1</xref>,<xref rid="R2" ref-type="bibr">2</xref></sup>, such regressions could in principle be used to detect gene regulatory changes across individual cells as a function of developmental progression, position in an embryo, or genetic sequence. However, they report measurements with high variability, frustrating efforts to build models that can detect such changes<sup><xref rid="R3" ref-type="bibr">3</xref>,<xref rid="R4" ref-type="bibr">4</xref></sup>. Numerous studies have reported high rates of “drop-out”, wherein some cells of a nominally homogeneous population express high levels of a gene and others none at all. Drop-outs have spurred the deployment of hurdle models<sup><xref rid="R5" ref-type="bibr">5</xref></sup> that overcome limitations over simpler regression approaches, typically at a cost in speed, numerical stability, or design flexibility for the user.</p>
    <p id="P3">Single-cell protocols that use exogenous RNA “spike-in” standards<sup><xref rid="R6" ref-type="bibr">6</xref></sup> or unique molecular identifiers<sup><xref rid="R7" ref-type="bibr">7</xref>,<xref rid="R8" ref-type="bibr">8</xref></sup> (UMIs) enable analysis to be performed at the level of transcript counts rather than read counts. Previous work by Grun <italic>et al.</italic> suggested that comparing UMIs, rather than read counts, between cells would improve regression analysis. However, because UMI protocols work by counting 3’ end tags, they are limited to measuring gene expression and do not report expression at allele- or isoform-resolution. Spike-in-based protocols, which convert a cell’s relative abundances to transcript counts through a linear regression between the spikes’ normalized read counts and their known molecular concentrations, can report measurements at this resolution. However, exogenous standards must be carefully calibrated for single-cell experiments lest they dominate the libraries, and may be subject to different rates of degradation or reverse transcription than endogenous RNA. Many published studies have chosen to forgo the use of spike-in controls, restricting subsequent reanalysis.</p>
    <p id="P4">Here, we introduce Census, an algorithm that converts conventional measures of relative expression such as transcript per million (TPM) in single cells to relative transcript counts without the need for spike-in standards or UMIs. “Census counts” eliminate much of the apparent technical variability in single-cell experiments and are thus easier to model with standard regression techniques than normalized read counts. We demonstrate the power of transcript count analysis with a new regression model, BEAM (Branch Expression Analysis Modeling), for detecting genes that change following fate decisions in development. We also analyze Census counts at the splice isoform and allele level, demonstrating that our approach robustly detects developmental regulation at those resolutions. Census and BEAM are implemented in Monocle 2, the second major release of our open-source single-cell analysis toolkit.</p>
  </sec>
  <sec sec-type="results" id="S2">
    <title>Results</title>
    <sec id="S3">
      <title>Estimating relative transcript counts in spike-in-free experiments</title>
      <p id="P5">Census exploits two properties of single-cell RNA-Seq datasets produced with current protocols (<xref rid="F1" ref-type="fig">Figure 1a</xref>). First, mRNA degradation following cell lysis and inefficiencies in the reverse transcription reaction result in the capture of as few as 10% of the transcripts in a cell as cDNA. Second, most protocols rely on template-switching reverse transcriptases primed at the polyA tail of mRNAs and thus generate full-length cDNAs<sup><xref rid="R9" ref-type="bibr">9</xref></sup>. Such protocols typically generate libraries in which genes are detected most frequently as a single cDNA molecule (<xref rid="F1" ref-type="fig">Figure 1b</xref>, <xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 1</xref>). Thus, all detectably expressed genes measured at or below the mode of the (log-transformed) relative abundance distribution in each cell should be present at around 1 cDNA copy (see <bold>Methods</bold>).</p>
      <p id="P6">We assessed Census’ accuracy by re-analyzing several experiments that included spike-in controls<sup><xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R10" ref-type="bibr">10</xref>,<xref rid="R11" ref-type="bibr">11</xref>,<xref rid="R12" ref-type="bibr">12</xref>,<xref rid="R13" ref-type="bibr">13</xref>,<xref rid="R14" ref-type="bibr">14</xref>,<xref rid="R15" ref-type="bibr">15</xref></sup>. Reanalysis of developing lung epithelial cells with Census recovered estimates of total per-cell transcript counts that were correlated with but not equal to those derived by linear regression against spike-in controls (<xref rid="F1" ref-type="fig">Figure 1c</xref>), likely because of Census’ inability to control for non-linear cDNA amplification during library construction. However, changes in Census counts between groups of cells collected at the same time points were highly similar to changes measured via spike-in controls (<xref rid="F1" ref-type="fig">Figure 1d,e</xref>). Census produced accurate changes in relative transcript counts for seven additional datasets, including two based on UMIs<sup><xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R10" ref-type="bibr">10</xref>,<xref rid="R13" ref-type="bibr">13</xref></sup>, demonstrating that the algorithm can work well with different single-cell RNA-Seq protocols. (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 1,2</xref>). Downsampling and simulation experiments determined that Census counts faithfully capture changes in expression between groups of cells with as few as 100,000 reads per cell and over a wide range of mRNA capture rates (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 3, 4</xref>). Taken together, these benchmarking experiments show that Census recovers an accurate measure of changes in relative transcript counts between single cells without the need for spike-in controls.</p>
    </sec>
    <sec id="S4" sec-type="methods">
      <title>Census counts improve differential analysis accuracy</title>
      <p id="P7">We next assessed whether using Census counts improved downstream differential analysis. We tested several popular tools<sup><xref rid="R16" ref-type="bibr">16</xref>,<xref rid="R17" ref-type="bibr">17</xref></sup> for differential expression with both read counts and relative transcript counts, including two tools specifically developed for single-cell data, Monocle<sup><xref rid="R18" ref-type="bibr">18</xref></sup>, and SCDE<sup><xref rid="R19" ref-type="bibr">19</xref></sup> (<xref rid="F2" ref-type="fig">Figure 2a</xref>, <xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 5</xref>). When provided with read counts as a measure of expression, consensus between the tools was poor, with only 1,971 of 5,805 (34%) differentially expressed genes (DEGs) reported by all tools (except SCDE, which has very high precision but low recall), and few agreed with those reported by a nonparametric, permutation-based test between spike-in derived expression levels (<xref rid="F2" ref-type="fig">Figure 2b</xref>, Methods). Tools designed for bulk RNA-Seq analysis, such as DESeq2<sup><xref rid="R17" ref-type="bibr">17</xref></sup>, produce false discovery rates as high as 61%. SCDE, which includes explicit modeling of drop-outs returned few false positives but also captured a smaller fraction of the true positive set.</p>
      <p id="P8">Repeating these tests using Census counts showed marked improvements in differential expression accuracy compared to read counts and TPM (<xref rid="F2" ref-type="fig">Figure 2a</xref>). We attribute the improvements to the fact that the negative binomial distribution, which underlies most commonly used RNA-Seq analysis software<sup><xref rid="R16" ref-type="bibr">16</xref>,<xref rid="R18" ref-type="bibr">18</xref>,<xref rid="R19" ref-type="bibr">19</xref></sup>, fits relative transcript count data much better than read count data, as noted by Grun <italic>et al.</italic><sup><xref rid="R4" ref-type="bibr">4</xref></sup> (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 5</xref>). For example, when targeting a false discovery rate of 10%, DESeq2’s empirical false discovery rate dropped dramatically from 61% to 22% with little to no drop in sensitivity, which remains as high as 82%. Monocle’s false discovery rate dropped from 53% to 11%. Importantly, using Census counts dramatically improved agreement between the tools, which all agreed on 2,437 DEGs among a total of 4,220 (70%), similar to the 62% (2,367 / 3,793) consensus genes obtained with spike-in derived levels (<xref rid="F2" ref-type="fig">Figure 2b</xref>). Census also improved DE accuracy relative to gold standards derived from bulk RNA-Seq<sup><xref rid="R18" ref-type="bibr">18</xref></sup> measurements (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 6</xref>). Taken together, our benchmarks demonstrate that single-cell relative transcript counts produced by Census can be more accurately compared with commonly used differential analysis methods than normalized read counts, and are thus preferable when spike-in standards or UMIs are unavailable.</p>
    </sec>
    <sec id="S5" sec-type="methods">
      <title>Differential analysis of branch points in developmental trajectories reveals regulators of cell fate</title>
      <p id="P9">Many single-cell gene expression studies aim to identify gene regulatory circuits that control cell-fate decisions made during development<sup><xref rid="R20" ref-type="bibr">20</xref>,<xref rid="R21" ref-type="bibr">21</xref></sup>. We recently developed Monocle, an algorithm that organizes single cells along trajectories and can describe the gene expression changes executed during cell differentiation. Monocle introduced the concept of “pseudotime”, which quantifies each cell’s progress through development. Pseudotime resolves cascades of gene regulatory changes that accompany differentiation and other dynamic cellular programs<sup><xref rid="R18" ref-type="bibr">18</xref></sup>. Monocle produces more reliable tests for differential expression along a trajectory when provided with Census counts than with relative expression values (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 7</xref>).</p>
      <p id="P10">Single-cell trajectories can have multiple outcomes, such as during the generation of alternative developmental lineages<sup><xref rid="R22" ref-type="bibr">22</xref></sup>. Analyzing cells at branch points where cells are diverted along two or more mutually exclusive paths could reveal the mechanisms by which such decisions are made. For example, scrutinizing genes upregulated in common myeloid progenitors but downregulated in common lymphoid progenitors has shed light on the molecular regulation of cell fate in hematopoiesis<sup><xref rid="R23" ref-type="bibr">23</xref>,<xref rid="R24" ref-type="bibr">24</xref></sup>.</p>
      <p id="P11">To explore a developmental fate decision at single-cell resolution, we reanalyzed RNA-seq data from a recent study investigating the specification of the distal lung epithelium<sup><xref rid="R25" ref-type="bibr">25</xref></sup>. Treutlein <italic>et al.</italic> sequenced developing epithelial cells to define the cellular intermediates giving rise to type I (AT1) and type II (AT2) pneumocytes. Monocle reconstructed a trajectory with a single branch point leading from progenitors to two outcomes corresponding to the AT1 and AT2 fates. The beginning of the trajectory contained cells with high levels of markers of active proliferation<sup><xref rid="R26" ref-type="bibr">26</xref></sup> (<italic>Ccnb2, Cdk1</italic>), whereas these genes were expressed at much lower levels after the branch point (<xref rid="F3" ref-type="fig">Figure 3a</xref>). High expression of a known marker of AT1 cells<sup><xref rid="R27" ref-type="bibr">27</xref></sup> (<italic>Pdpn</italic>) was restricted to cells on one branch of the tree, whereas cells expressing an AT2 marker<sup><xref rid="R28" ref-type="bibr">28</xref></sup> (<italic>Sftpb</italic>) at high levels were located on the other branch. Cells classified as AT1 and AT2 according to known markers by Treutlein <italic>et al.</italic> fell exclusively along the branches, with what the authors termed “bipotent progenitors (BP)” at or near the branch point. (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 8</xref>).</p>
      <p id="P12">To detect cell fate-dependent genes in a statistically robust manner, we developed BEAM, a generalized linear modeling (GLM) <sup><xref rid="R29" ref-type="bibr">29</xref></sup> strategy for analyzing branched single-cell trajectories (<xref rid="F3" ref-type="fig">Figure 3b</xref>; <xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 9</xref>, see Methods). BEAM identified 1,219 genes (FDR &lt; 5%) as either AT1- or AT2- fate dependent, including canonical markers<sup><xref rid="R27" ref-type="bibr">27</xref></sup> such as as <italic>Pdpn</italic> and <italic>Sftpb</italic> (<xref rid="F3" ref-type="fig">Figure 3c</xref>). AT1-restricted genes were strongly enriched for ontological terms related to tube development, cytoskeletal remodeling, and cell morphogenesis (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 10</xref>, <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>), while AT2-restricted genes were enriched for terms related to lipid processing, consistent with the production of lipid-rich surfactant by AT2 cells in the mature lung. Regulatory DNA elements proximal to these genes were enriched for binding sites of 74 transcription factors, eleven of which exhibited significant branch-dependent expression. <xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 11</xref>) These factors included several such as Tcf7l2 that are well known to regulate lung development<sup><xref rid="R30" ref-type="bibr">30</xref>-<xref rid="R35" ref-type="bibr">35</xref></sup>.</p>
    </sec>
    <sec id="S6">
      <title>Disruption of interferon signaling induces a branch in the dendritic cell LPS stimulation trajectory</title>
      <p id="P13">Branch points in single-cell trajectories represent steps in a program of transcriptional change in which cells must choose between one of several mutually exclusive gene expression programs. Branches could arise not only during development, but also in response to mutations, treatment with drugs, or other cellular perturbations. We reanalyzed a recent study<sup><xref rid="R36" ref-type="bibr">36</xref></sup> from Shalek and colleagues, which dissected the transcriptional response of murine bone marrow-derived dendritic cells (BMDCs) to lipopolysaccharide (LPS) (<xref rid="F4" ref-type="fig">Figure 4a</xref>). In BMDCs, LPS triggers a paracrine feedback loop of type I interferon signaling mediated in part by <italic>Stat1</italic><sup><xref rid="R37" ref-type="bibr">37</xref>-<xref rid="R39" ref-type="bibr">39</xref></sup>. The authors compared BMDCs from wild-type (WT) mice to those from mice that lack the receptor for <italic>Interferon alpha</italic> (<italic>Ifnar1</italic>-/-) or <italic>Stat1</italic> (<italic>Stat1</italic>-/-). Monocle recovered a trajectory with a single branch point, with cells from <italic>Infar</italic>-/- or Stat1-/- mice distributed on an alternative trajectory in response to LPS stimulation compared with those from WT mice (<xref rid="F4" ref-type="fig">Figure 4b</xref>).</p>
      <p id="P14">BEAM identified 870 genes (FDR &lt; 5%), many associated with interferon signaling, dependent on this branch (<xref rid="F4" ref-type="fig">Figure 4c</xref>, <xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 12</xref>). Peaks corresponding to open chromatin collected by Lavin et al<sup><xref rid="R40" ref-type="bibr">40</xref></sup> proximal to branch-dependent genes are enriched for <italic>Stat1/2</italic> and <italic>Irf1</italic>/<italic>2</italic> binding motifs (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 13</xref>). These factors were themselves significantly branch-dependent, with branching pseudotimes substantially earlier than their putative targets, confirming that BEAM can distinguish the regulatory factors that drive branching in single-cell trajectories from genes downstream (<xref rid="F4" ref-type="fig">Figure 4e, f</xref>). Monocle 2 and BEAM demonstrated that loss of a key paracrine loop generates an “alternative trajectory”, suggesting that single-cell trajectory analysis can be useful for defining how a signaling pathway regulates a larger process.</p>
    </sec>
    <sec id="S7" sec-type="methods">
      <title>Census counts enable single-cell differential splicing analysis</title>
      <p id="P15">Methods for detecting splicing changes in single-cell RNA-Seq experiments are beginning to appear, but have grappled with isoform-level measurement variability. For example, Welch <italic>et al.</italic> described SingleSplice<sup><xref rid="R41" ref-type="bibr">41</xref></sup>, which uses a hurdle model to compare observed variation in isoform frequencies against expected technical variation, but its contrasts are limited to tests for excess variability within groups of cells, rather than as a function of arbitrary variables in a regression, and it requires calibration with spike-in standards.</p>
      <p id="P16">We used Census to estimate isoform-level transcript counts in differentiating myoblasts, a classic model system for vertebrate splicing. Modeling isoform counts from each gene as a Dirichlet-multinomial distribution captured pseudotime-dependent shifts in splicing in 74 genes (FDR &lt; 0.1), including well-characterized components of the molecular machinery required for muscle contraction such as tropomyosin <italic>TPM1,</italic> which has been intensely studied in myoblasts as a model of alternative splicing<sup><xref rid="R42" ref-type="bibr">42</xref>,<xref rid="R43" ref-type="bibr">43</xref></sup> (<xref rid="F5" ref-type="fig">Figure 5</xref>). <italic>TPM1</italic> has three well-characterized sets of alternatively spliced exons, with exons 6b and 9b excluded in myoblasts but included in myotubes<sup><xref rid="R44" ref-type="bibr">44</xref></sup>. These exons became progressively more frequent in <italic>TPM1</italic> mRNAs, with inclusion of exon 6b preceding inclusion of exon 9b. Each isoform of the 74 differentially spliced genes showed one of seven distinct pseudotemporal expression patterns, (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 14a, b</xref>) coinciding with shifts in the actin family from widely expressed members (<italic>ACTB, ACGT</italic>) partly replaced with muscle specific ones (<italic>ACTA1, ACTA2</italic>). (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 14c</xref>). Our analysis supports the view that cytoskeletal reorganization during myoblast differentiation is globally coordinated not only at the level of genes but across individual splice variants.</p>
    </sec>
    <sec id="S8" sec-type="methods">
      <title>Census counts enable allelic balance analysis in single cells</title>
      <p id="P17">Single-cell analysis could in principle shed light on the degree to which the two alleles of each gene are regulated in a coordinated manner. Recently, Deng <italic>et al.</italic> tracked gene expression genome wide in single-cells from pre-implantation mouse embryos of mixed genetic background (CAST/EiJ × C57BL/6J) <sup><xref rid="R45" ref-type="bibr">45</xref></sup>. Coupling allele-level relative abundances from Kallisto<sup><xref rid="R46" ref-type="bibr">46</xref></sup> with Census produced relative allele transcript counts which, when modeled similarly to isoform counts, recapitulated many of the key observations made in the initial study. As expected, nearly all RNAs matched the maternal allele in zygotes and early 2-cell embyros, consistent with little to no transcription from the embryonic genome (<xref rid="F6" ref-type="fig">Figure 6a</xref>). Allelic balance for most genes equilibrated to 50% as transcription from the embryonic genome began in mid- to late- 2-cell embryos, with the X chromosome notably excepted (<xref rid="F6" ref-type="fig">Figure 6a</xref>). Inactivation of the paternal X chromosome in female embryos was manifest by the 16-cell stage, with progressively fewer genes exhibiting contributions from the paternal X (<xref rid="F6" ref-type="fig">Figure 6b, c</xref>), although genes known to escape inactivation were notably excepted (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 15</xref>).</p>
      <p id="P18">In addition to pre-implantation allelic dynamics, Deng <italic>et al.</italic> reported widespread stochastic monoallelic gene expression in individual cells. This claim has been challenged by Kim <italic>et al</italic>. <sup><xref rid="R47" ref-type="bibr">47</xref></sup>, who analyzed allele-specific expression in embryonic stem cells using a statistical model that attributed much of the apparent stochastic monoallelic expression to technical sources. We tested whether using Census to estimate allelic transcript counts instead of allelic read counts would reduce the apparent stochastic monoallelic expression to expected levels. Consistent with the generative model used by Kim <italic>et al</italic>., the expected rate of monoallelic expression was near 100% for genes expressed at a single copy, and decreased with increasing expression (<xref rid="F6" ref-type="fig">Figure 6e</xref>). Of 6,608 “allele-informative” genes in the genome, 95.0% produced observed monoallelic transcript counts within the expected range. In contrast, only 77% of genes fell within the range obtained by fitting similar models to normalized read counts for each allele. We interpret this to mean that a substantial portion of apparent monoallelic expression arose because the sequenced libraries correspond to a small proportion of the true RNA molecules in each cell (due to dropout), a technical artifact that is accounted for when allelic gene expression is modeled using Census-estimated relative transcript counts but not when it is modeled using normalized read counts.</p>
    </sec>
  </sec>
  <sec sec-type="discussion" id="S9">
    <title>Discussion</title>
    <p id="P19">Efforts to detect changes in gene regulation in development have grappled with high technical and biological variability, demanding specialized statistical methods that explicitly model drop-outs and other nuisance variation. Here, we show that analyzing changes in relative transcript counts leads to dramatic reductions in apparent technical variability compared to normalized read counts, making single-cell RNA-Seq compatible with widely used regression techniques. We have developed Census, a normalization algorithm that can convert relative expression levels from read counts into per-cell transcript counts without the need for spike-in standards or UMIs. The algorithm requires only that genes are most frequently present at 1 cDNA molecule in each cell’s library. We show through reanalysis of several datasets that this is the case with most current protocols, owing to mRNA capture rates lower than 50% and their generation of full-length cDNAs during reverse transcription. Census cannot control for amplification biases, and thus does not produce estimates of lysate mRNA abundances that perfectly match those derived with spike-ins or UMIs. When spike-ins or UMIs are available, transcript counts should be recovered using them rather than Census. However, we show through extensive benchmarking that differential analysis results with Census counts are highly concordant with those from spike-ins. Importantly, tools widely used for bulk RNA-Seq analysis that perform poorly when provided with read counts work vastly better with Census counts, alleviating the need for software tailored for single-cell RNA-Seq.</p>
    <p id="P20">To illustrate their power, we have developed three regression-based methods for detecting changes in Census counts. The first, BEAM, builds on our previous work tracking gene expression changes in single-cell trajectories, helping pinpoint the moment at which cell-fate decisions occur in a complex biological process. BEAM identified hundreds of genes differentially regulated during specification of the type I and type II pneumocytes in the alveolar epithelium. Surprisingly, branched cell trajectories arise not only in development, but also in response to genetic perturbations, suggesting that branch analysis may be useful in many biological contexts. The second method uses Census counts to find genes undergoing pseudotime-dependent changes in splicing. Reanalysis of differentiating myoblasts showed widespread alteration in isoform ratios in genes involved in muscle contraction and cytoskeletal structure, with some genes such as TPM1 showing a sequence of pseudotime-dependent shifts. The third method captures changes in allelic transcript counts derived with Census. By reanalyzing data from pre-implantation embryos, we confirmed the authors’ timing of transcriptional activation of the embryonic genome and X chromosome inactivation. In contrast to the original study, we do not see substantial evidence of random, monoallelic expression on the autosomes, and attribute this observation to inadequate modeling of dropouts in normalized read counts. Monoallelic expression at the transcript count level was in line with expectations under a simple overdispersed binomial regression model.</p>
    <p id="P21">Together, our analyses show that single-cell differential expression analyses conducted at the level of normalized transcript counts are more robust and accurate than analyses of normalized read counts. We provide a new algorithm, Census, that makes relative transcript count analysis widely accessible, as well as examples of regression models, in particular BEAM, that leverage them for high-resolution dissection of gene regulation. We expect that such techniques will continue to unveil new mechanisms of gene regulation, including at the allele and isoform level, in development and disease.</p>
  </sec>
  <sec id="S10">
    <title>Data Availability Statement</title>
    <sec id="S11">
      <title>Code availability</title>
      <p id="P22">A version of monocle 2 (version: 1.99) used to produce all the figures, supplementary data is provided in <xref rid="SD2" ref-type="supplementary-material">Supplementary Software</xref>. The newest Monocle 2 is available through Bioconductor as well as GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/cole-trapnell-lab/monocle-release">https://github.com/cole-trapnell-lab/monocle-release</ext-link>). <xref rid="SD2" ref-type="supplementary-material">Supplementary Software</xref> also includes a helper package including helper functions as well as all analysis code which can reproduce all figures in this study.</p>
    </sec>
    <sec id="S12">
      <title>Data availability</title>
      <p id="P23">Eleven public sc RNA-seq datasets are used in this study, of which 8 datasets used ERCC spike-in. Here is a summary list of all the data:</p>
      <p id="P24">Datasets with spike-in:</p>
      <p id="P25"><bold>Lung</bold>: GSE52583<sup><xref rid="R25" ref-type="bibr">25</xref></sup></p>
      <p id="P26"><bold>Noise model</bold>: GSE54695 <sup><xref rid="R4" ref-type="bibr">4</xref></sup></p>
      <p id="P27"><bold>Neuron reprogramming</bold>: GSE67310 <sup><xref rid="R15" ref-type="bibr">15</xref></sup></p>
      <p id="P28"><bold>Human Preimplantation Embryos</bold>: E-MTAB-3929 <sup><xref rid="R10" ref-type="bibr">10</xref></sup></p>
      <p id="P29"><bold>Pancreas</bold>: E-MTAB-5061<sup><xref rid="R11" ref-type="bibr">11</xref></sup></p>
      <p id="P30"><bold>Cortex</bold>: <ext-link ext-link-type="uri" xlink:href="http://linnarssonlab.org/cortex/">http://linnarssonlab.org/cortex/</ext-link><sup><xref rid="R12" ref-type="bibr">12</xref></sup></p>
      <p id="P31"><bold>Marker-free</bold>: GSE54006 <sup><xref rid="R13" ref-type="bibr">13</xref></sup></p>
      <p id="P32"><bold>Quantitative assessment data</bold>: GSE51254 <sup><xref rid="R14" ref-type="bibr">14</xref></sup></p>
      <p id="P33">Datasets without spike-in:</p>
      <p id="P34"><bold>HSMM</bold>: GSE52529 <sup><xref rid="R18" ref-type="bibr">18</xref></sup></p>
      <p id="P35"><bold>Dendritic cell knockout</bold>: GSE41265 <sup><xref rid="R36" ref-type="bibr">36</xref></sup></p>
      <p id="P36"><bold>Allele-specific gene expression</bold>: GSE45719 <sup><xref rid="R45" ref-type="bibr">45</xref></sup></p>
    </sec>
  </sec>
  <sec id="S13">
    <title>Online Methods</title>
    <sec id="S14">
      <title>A generative model for single-cell RNA-seq experiments with a spike-in ladder</title>
      <p id="P37">Census is motivated by a generative model of single-cell (sc) RNA-Seq similar to the one developed by Kim <italic>et al.</italic><sup><xref rid="R47" ref-type="bibr">47</xref></sup>. When performing sc-RNA-seq, each individual cell is lysed to recover its endogenous RNA molecules, some fraction of which may be degraded or lost. Lysis thus involves an RNA recovery rate <italic>α</italic>. Spike-in transcripts are then added into the cell lysate. Note that spike-in transcripts are added to the lysate as naked RNA, and thus may be degraded at different rates from the endogenous RNA. We denote the ladder recovery rate as <italic>β</italic>. The RNA counts in the lysate can be written:
<disp-formula id="FD1"><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mi>Cell lysate</mml:mi><mml:mo>:</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>l</mml:mi></mml:msubsup></mml:mtd><mml:mtd><mml:mo>≈</mml:mo></mml:mtd><mml:mtd><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>c</mml:mi></mml:msubsup></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mi>S</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>l</mml:mi></mml:msubsup></mml:mtd><mml:mtd><mml:mo>≈</mml:mo></mml:mtd><mml:mtd><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula>where <italic>Y<sup>l</sup></italic>, <italic>S<sup>l</sup></italic>, <italic>S</italic>, are the transcript counts of endogenous RNA in cell lysate, spike-in transcript counts in cell lysate and the spike-in transcript counts added into the cell lysate. The first subscript in all variables (here and below) corresponds to cell while the second subscript corresponds to gene index. Note that we are not able to directly observe 
<inline-formula id="FD2"><mml:math id="M2" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>c</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula>, the true transcript counts for gene <italic>j</italic> in cell <italic>i</italic> and thus <italic>α</italic> is an unknown variable.</p>
      <p id="P38">The RNA molecules and spike-in transcripts will then be subjected to reverse transcription and amplified to make a cDNA library. The expected number of cDNA molecules generated from each RNA molecules is denoted by <italic>θ</italic>. The cDNA counts can be written:
<disp-formula id="FD3"><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:mi>cDNA</mml:mi><mml:mo>:</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup></mml:mtd><mml:mtd><mml:mo>=</mml:mo></mml:mtd><mml:mtd><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>l</mml:mi></mml:msubsup><mml:mo>⋅</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mi>S</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup></mml:mtd><mml:mtd><mml:mo>=</mml:mo></mml:mtd><mml:mtd><mml:mrow><mml:msubsup><mml:mi>S</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>l</mml:mi></mml:msubsup><mml:mo>⋅</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <italic>Y<sup>d</sup></italic>, <italic>S<sup>d</sup></italic>, are the cDNA counts of endogenous RNA, spike-in cDNA counts successfully converted from the corresponding transcript counts <italic>Y<sup>l</sup></italic>, <italic>S<sup>l</sup></italic> in cell lysate under a uniform capture rate <italic>θ</italic>, which for current protocols is less than 1.</p>
      <p id="P39">Our model generates sequencing reads from the cDNA. The relative cDNA abundances are calculated as 
<inline-formula id="FD4"><mml:math id="M4" overflow="scroll"><mml:mrow><mml:mfrac><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula> for endogenous RNA, or 
<inline-formula id="FD5"><mml:math id="M5" overflow="scroll"><mml:mrow><mml:mfrac><mml:msubsup><mml:mi>S</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula> for spike-in RNA.</p>
      <p id="P40">The model then generates <italic>γ</italic> reads per cDNA molecule on average; with sufficient sequencing, <italic>γ</italic> will be larger than 1; we expect each cDNA molecule to generate at least one sequencing read. This process can be regarded as a multinomial sampling of <italic>R</italic> reads 
<inline-formula id="FD6"><mml:math id="M6" overflow="scroll"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>γ</mml:mi><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> from the distribution of relative cDNA abundances mentioned above which can be represented as:
<disp-formula id="FD7"><mml:math id="M7" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">Read counts</mml:mi><mml:mo>:</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>r</mml:mi></mml:msubsup><mml:mo>∼</mml:mo><mml:mi mathvariant="italic">multinomial</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>i</mml:mi><mml:mi>e</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup><mml:mo>∼</mml:mo><mml:mi mathvariant="italic">multinomial</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:msubsup><mml:mi>S</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>d</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula>where 
<inline-formula id="FD8"><mml:math id="M8" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mi>i</mml:mi><mml:mi>e</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula>, denotes the reads sampled for cDNA from the endogenous RNA or spike- in RNA in cell <italic>i</italic>, 
<inline-formula id="FD9"><mml:math id="M9" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>r</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> denotes the reads sampled for cDNA from the endogenous RNA <italic>j</italic> or spike-in RNA <italic>j</italic> in cell <italic>i</italic>.</p>
      <p id="P41">The model described here is essentially a special case of the model in Kim <italic>et al.</italic>, and differs mainly in that their model describes transcript-level capture rates and sequencing rates with beta and gamma distributions, respectively. In contrast, we simply use global constants for these rates. As Census does not make use of variance estimates from the generative model, this simpler model is sufficient for calculating key statistics (e.g. mode of the transcript counts) needed to convert relative to absolute abundances.</p>
    </sec>
    <sec id="S15">
      <title>A simulator for the sc-RNA-seq process</title>
      <p id="P42">To generate an <italic>in silico</italic> library for a single cell, we built a simulator that first selects <italic>G</italic> genes at random from a relative expression profile (<italic>P<sub>bulk</sub></italic>) derived from a bulk RNA-Seq experiment to represent the hypothetical relative abundance of a single-cell in cell lysate. These values are rescaled to proportions (i.e. summing to 1), or <italic>ρ<sub>scaled</sub></italic>. 
<disp-formula id="FD10"><mml:math id="M10" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mi mathvariant="italic">scaled</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mi mathvariant="italic">scale</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="italic">uniform</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi mathvariant="italic">bulk</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal">G</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p>
      <p id="P43">These proportions are then used to parameterize a multinomial distribution from which <italic>T</italic> transcripts are drawn to obtain the transcripts in the library space where we also consider there is <italic>α<sub>i</sub></italic> percentage of the RNA is degraded. Therefore, we have:
<disp-formula id="FD11"><mml:math id="M11" display="block" overflow="scroll"><mml:mrow><mml:mi>library</mml:mi><mml:mo>:</mml:mo><mml:msubsup><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>l</mml:mi></mml:msubsup><mml:mo>∼</mml:mo><mml:mi mathvariant="italic">multinomial</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mi mathvariant="italic">scaled</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>To this pool of transcripts, a fixed number of spike-in transcripts are added, forming a mixture of simulated “endogenous” and “spike-in” mRNAs where the degradation of spike-in transcripts is represented by <italic>β<sub>i</sub></italic>. Of these, <italic>θ<sub>i</sub></italic> percent are selected uniformly at random to simulate incomplete mRNA capture by the reverse transcription process. Finally, the abundances of these cDNAs relative to one another were used to parameterize another multinomial, from which <italic>R<sub>i</sub></italic> reads are sampled. The read counts are then used to calculate the relative abundance for the spike-in and the endogenous RNA.</p>
      <p id="P44">In this study, we systematically simulated the sc RNA-seq process obtained from bulk RNA-Seq measurements made in Trapnell and Cacchiarelli <italic>et al</italic><sup><xref rid="R18" ref-type="bibr">18</xref></sup> by varying the gene number G, capture rate θ, endogenous RNA degradation α, spike-in degradation β, total endogenous transcript count T and total number of reads R. Results based on simulation are shown in <xref rid="SD3" ref-type="supplementary-material">Supplemental Figure 4</xref>.</p>
    </sec>
    <sec id="S16">
      <title>Estimating the capture rate based on spike-in ladder</title>
      <p id="P45">Similar to Kim <italic>et al.</italic><sup><xref rid="R47" ref-type="bibr">47</xref></sup>, spike-in transcripts can be used to infer the rate at which lysate RNAs are converted to cDNA. The probability of observing a particular spike-in transcript in the sequenced read counts can be used to estimate the capture rate <italic>θ</italic>. For a given spike-in transcript <italic>i</italic> with transcript counts <italic>s</italic> calculated using the above procedure, the probability to observe at least one copy of this transcript is <italic>p</italic> = 1 – (1 – <italic>θ</italic>)<italic><sup>s</sup></italic>. We assume the capture rate, <italic>θ</italic>, is the same for all spike transcripts and thus can use the following objective function to estimate the capture rate using all spike transcripts:
<disp-formula id="FD12"><mml:math id="M12" display="block" overflow="scroll"><mml:mrow><mml:munder><mml:mrow><mml:mi>min</mml:mi><mml:mspace width="0.2em"/></mml:mrow><mml:mi>θ</mml:mi></mml:munder><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>s</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>o</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></disp-formula>where 
<inline-formula id="FD13"><mml:math id="M13" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>o</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> is the probability for all transcripts with <italic>s</italic> copies have non-zero TPM values. In order to robustly estimate <italic>θ</italic>, we assume a constant capture rate for cells collected in each time point (lung or neuron experiment) or the whole dataset (other experiments) and pool them for estimating <italic>θ</italic>.</p>
    </sec>
    <sec id="S17">
      <title>Census</title>
      <p id="P46">Census aims to convert relative abundances X<italic><sub>ij</sub></italic> into lysate transcript counts Y<italic><sub>ij</sub></italic>. Without loss of generality, we consider relative abundances is on the TPM scale, and assume that a gene’s TPM value is proportional to the relative frequencies of its mRNA within the total pool of mRNA in a given cell’s lysate, i.e., 
<inline-formula id="FD14"><mml:math id="M14" overflow="scroll"><mml:mrow><mml:msub><mml:mi>TPM</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mo>∝</mml:mo><mml:mfrac><mml:msub><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>. The generative model discussed above predicts that when only a minority of the transcripts in a cell is captured in the library, signal from most detectably expressed genes will originate from a single mRNA. Because the number of sequencing reads per transcript is proportionate to molecular frequency after normalizing for length (i.e. TPM or FPKM), all such genes in a given cell should have similar TPM values.</p>
      <p id="P47">Census works by first identifying the (log-transformed) TPM value in each cell <italic>i</italic>, written as 
<inline-formula id="FD15"><mml:math id="M15" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>x</mml:mi><mml:mi>i</mml:mi><mml:mo>∗</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula>, that corresponds to genes from which signal originates from a single transcript. Because our generative model predicts that these most detectable genes should fall into this category, we simply estimate 
<inline-formula id="FD16"><mml:math id="M16" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>x</mml:mi><mml:mi>i</mml:mi><mml:mo>∗</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> as the mode of the log-transformed TPM distribution for cell <italic>i</italic>. This mode is obtained by log-transforming the TPM values, performing a Gaussian kernel density estimation and then identifying the peak of the distribution. Given the TPM value for a single transcript in cell <italic>i</italic>, it is straightforward to convert all relative abundances to their lysate transcript counts. We estimate the total number of mRNAs captured for cell <italic>i:</italic>
<disp-formula id="FD17"><mml:math id="M17" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>θ</mml:mi></mml:mfrac><mml:mo>.</mml:mo><mml:mfrac><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mi>F</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mi>i</mml:mi><mml:mo>∗</mml:mo></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>F</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi mathvariant="italic">ε</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>where <italic>F<sub>x</sub></italic> represents the cumulative distribution function for the TPM values for cell <italic>i</italic>, <italic>ε</italic> is a TPM value below which no mRNA is believed to be present (by default, <italic>ε</italic> = 0.1), and <italic>n<sub>i</sub></italic> is the number of genes with TPM values in the interval 
<inline-formula id="FD18"><mml:math id="M18" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ε</mml:mi><mml:mo>,</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mi>i</mml:mi><mml:mo>∗</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. That is, we simply calculate the total number of single-mRNA genes and divide this number by the fraction of the library contributed by them to estimate the total number of captured mRNAs in the cell. This number is scaled by 
<inline-formula id="FD19"><mml:math id="M19" overflow="scroll"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>θ</mml:mi></mml:mfrac></mml:mrow></mml:math></inline-formula> to yield an estimate for the number of mRNAs that were in the cell’s lysate, including those that were not actually captured. This scaling step is performed mainly to facilitate comparison with spike-in derived estimates. While we do not know the capture rate <italic>θ a priori</italic>, it is a highly protocol-dependent quantity that appears to have little dependence on cell type or state. Throughout our analysis, we assume a value of 0.25, which is close to the lung and neuron experiments of Truetlein et al.</p>
      <p id="P48">With an estimate of the total lysate mRNAs <italic>M<sub>i</sub></italic> in cell <italic>i</italic>, we simply rescale its TPM values into mRNA counts for each gene:
<disp-formula id="FD20"><mml:math id="M20" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:mfrac><mml:msub><mml:mi>M</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:mfrac></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec id="S18">
      <title>Limitations of Census</title>
      <p id="P49">Census and our generative model of single-cell RNA-Seq assume that TPM is proportional to the true relative abundance in the cell lysis, i.e., 
<inline-formula id="FD21"><mml:math id="M21" overflow="scroll"><mml:mrow><mml:msub><mml:mi>TPM</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mo>∝</mml:mo><mml:mfrac><mml:msub><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>Y</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>. However, non-linear amplification at any stage of the library construction protocol could distort this relationship. We can see this distortion when fitting the linear regression model, log(TPM<italic><sub>ij</sub></italic>) = <italic>k</italic> ∗ log(<italic>Y<sub>ij</sub></italic>) + <italic>b</italic>, to the spike-in data recovers a value of <italic>k</italic> that deviates from 1, which indicates that TPM<italic><sub>ij</sub></italic> ∝ (<italic>Y<sub>ij</sub></italic>)<sup><italic>k</italic></sup>. In practice, we find that <italic>k</italic> ranges from around 0.5 to near 1, depending on the protocol and the laboratory. We have not observed <italic>k</italic> much larger than 1.</p>
      <p id="P50">The inability to estimate <italic>k</italic> without making strong assumptions surrounding the expected number of total RNAs in a given cell means that Census and indeed any measure of relative abundance not normalized by spike-in standards will be limited in its ability to recapitulate the transcript counts derive from spike-based conversion. We argue here that this limitation is not onerous in differential analysis because its impact on fold changes between cells is small.</p>
    </sec>
    <sec id="S19">
      <title>Testing for branch-dependent expression</title>
      <p id="P51">Monocle assigns each cell a pseudotime value and a “State” encoding the segment of the trajectory it resides upon based on the PQ-tree algorithm (see the <xref rid="SD2" ref-type="supplementary-material">supplemental material</xref> for Trapnell and Cacchiarelli et al for further information<sup><xref rid="R18" ref-type="bibr">18</xref></sup>). Transcript counts values were variance-stabilized<sup><xref rid="R49" ref-type="bibr">49</xref></sup> via the technique described by Anders and Huber prior to tree construction.</p>
      <p id="P52">In Monocle 2, we extended the capability to test for branch-dependent gene expression by formulating the problem as a contrast between two negative binomial GLMs.</p>
      <p id="P53">The null model
<disp-formula id="FD22"><mml:math id="M22" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">NB</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">Census counts</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mi mathvariant="italic">sm.</mml:mi><mml:mspace width="0.2em"/><mml:mi mathvariant="italic">ns</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">Pseudotime</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>for the test assumes the gene being tested is not a branch specific gene, whereas the alternative model:
<disp-formula id="FD23"><mml:math id="M23" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">NB</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">Census counts</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mi mathvariant="italic">sm.</mml:mi><mml:mspace width="0.2em"/><mml:mi mathvariant="italic">ns</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">Pseudotime</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi mathvariant="italic">Branch</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="italic">sm.</mml:mi><mml:mspace width="0.2em"/><mml:mi mathvariant="italic">ns</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">Pseudotime</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mi mathvariant="italic">Branch</mml:mi></mml:mrow></mml:math></disp-formula>assumes that the gene is a branch specific gene where : represents an interaction term between branch and transformed pseudotime, NB means negative binomial distribution. Each model includes a natural spline (here with three degrees of freedom) describing smooth changes in mean expression as a function of pseudotime. The null model fits only a single curve, whereas the alternative will fit a distinct curve for each branch. Our current implementation of Monocle 2 relies on VGAM’s “smart” spline fitting functionality, hence the use of the <italic>sm.ns()</italic> function instead of the more widely used <italic>ns()</italic> function from the splines package in R<sup><xref rid="R50" ref-type="bibr">50</xref></sup>. Likelihood ratio testing was performed with the VGAM <italic>lrtest()</italic> function, similar to Monocle’s other differential expression tests<sup><xref rid="R50" ref-type="bibr">50</xref></sup>. A significant branch-dependent genes means that the gene has distinct expression dynamics along each branch, with smoothed curves that have different shapes.</p>
      <p id="P54">To fit the full model, each cell must be assigned to the appropriate branch, which is coded through the factor “Branch” in the above model formula. Monocle’s function for testing branch dependence accepts an argument specifying which branches are to be compared. These arguments are specified using the ‘State’ attribute assigned by Monocle during trajectory reconstructions. For example, in our analysis of the Truetlein <italic>et al</italic> data <sup><xref rid="R25" ref-type="bibr">25</xref></sup>, Monocle reconstructed a trajectory with two branches (<italic>L<sub>AT1</sub></italic>, <italic>L<sub>AT2</sub></italic> for AT1 and AT2 lineages, respectively), and three states (<italic>S<sub>BP</sub></italic>, <italic>S<sub>AT</sub></italic><sub>1</sub>, <italic>S<sub>AT</sub></italic><sub>2</sub> for progenitor, AT1, or AT2 cells). The user specifies that he or she wants to compare <italic>L<sub>AT</sub></italic><sub>1</sub> and <italic>L<sub>AT</sub></italic><sub>2</sub> by providing <italic>S<sub>AT</sub></italic><sub>1</sub> and <italic>S<sub>AT</sub></italic><sub>2</sub> as arguments to the function. Monocle then assigns all the cells with state <italic>S<sub>AT</sub></italic><sub>1</sub> to branch <italic>L<sub>AT</sub></italic><sub>1</sub> and similarly for the <italic>AT</italic>2 cells. However, the cells with <italic>S<sub>BP</sub></italic> must be members of both branches, because they are on the path from each branch back to the root of the tree. In order to ensure the independence of data points required for the LRT as well as the robustness and stability of our algorithm, we implemented a strategy to partition the progenitor cells into two groups, with each branch receiving a group. The groups are computed by simply ranking the progenitor cells by pseudotime and assigning the odd-numbered cells to one group and the even numbered cells to the other. We assign the first progenitor to both branches to ensure they start at the same time which is required for downstream spline fitting and clustering. The branch plots in <xref rid="F3" ref-type="fig">Figure 3d</xref> visualize the branch specific spline curves fit by this method.</p>
    </sec>
    <sec id="S20">
      <title>Branch time point detection</title>
      <p id="P55">The branching time point for each gene can be quantified by fitting a separate spline curves for each branch from all the progenitor to each cell fate. To robustly detect the pseudotime point 
<inline-formula id="FD24"><mml:math id="M24" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>t</mml:mi><mml:mi>β</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> when a gene <italic>i</italic> with a branching expression pattern starts to diverge between two cell fates <italic>L</italic><sub>1</sub>, <italic>L</italic><sub>2</sub>, we developed the branch time point detection algorithm. The algorithm starts from the end of stretched pseudotime (pseudotime <italic>t</italic> = 100, see below) to calculate the divergence (<italic>D<sub>i</sub></italic> (<italic>t</italic> = 100) = <italic>x<sub>L<sub>1</sub></sub></italic>(<italic>t</italic> = 100) – <italic>x<sub>L<sub>2</sub></sub></italic> (<italic>t</italic> = 100)) of gene <italic>i</italic>’s expression (<italic>x<sub>L<sub>1</sub></sub></italic>(<italic>t</italic> = 100), <italic>x<sub>L<sub>2</sub></sub></italic>(<italic>t</italic> = 100)) between two cell fates, <italic>L</italic><sub>1</sub>
<italic>L</italic><sub>2</sub>, (for a branching gene, the divergence at this moment should be large if not the largest across pseudotime). It then moves backwards to find the latest intersection point between two fitted spline curves, which corresponds to the time when the gene starts to diverge between two branches. To add further flexibility, the algorithm moves forward to find the time point when the gene expression diverges up to a user controllable threshold (<italic>ε</italic>), or <italic>D</italic><sub>i</sub> (<italic>t</italic>) ≥ <italic>ε</italic>(<italic>t</italic>), and defines this time point as the branch time point, 
<inline-formula id="FD25"><mml:math id="M25" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>t</mml:mi><mml:mi>β</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula>, for that particular gene <italic>i</italic>.</p>
    </sec>
    <sec id="S21">
      <title>Analysis of human skeletal muscle myoblasts</title>
      <p id="P56">We used the HSMM data from our previous publication<sup><xref rid="R18" ref-type="bibr">18</xref></sup> to benchmark the performance of developmental tree reconstruction and pseudotime DEG test between relative abundance or census counts. Relative abundances are converted into transcript counts using Census with default parameters with parameter <italic>t</italic>* estimated from the relative abundance data for each cell. Potential contaminating fibroblast cells with transcript counts of <italic>Mef2c</italic> less than 5 and <italic>Myf5</italic> less than 1 were removed which yields 142 cells for downstream analysis.</p>
      <p id="P57">The union of genes which are differentially expressed between the four time points in relative abundance or recovered transcript counts scale are used to reduce dimension and order the cells. Transcript counts were variance stabilized. The ordering of developmental trajectories between these two approaches is compared using spearman correlation. Pseudotime tests are performed on both the relative abundance and transcript counts scale where the pseudotime dependent genes are collected as those with q values less than 0.05 (Benjamini-Hochberg correction). The benchmark set is obtained from the permutation test based on a modified algorithm from the glm.perm package as previously described (see <bold><italic>section Benchmarking differential expression analysis</italic></bold> in <xref rid="SD2" ref-type="supplementary-material">supplementary notes</xref>).</p>
      <p id="P58">Differential splicing analysis was conducted by first converting isoform-level TPM values from Cufflinks to transcript counts using Census with default parameters. Each gene’s isoform-level transcript counts <italic>Z</italic><sub>1</sub>, … ,<italic>Z</italic><sub><italic>k</italic></sub> were then modeled using a generalized linear model with a Dirichlet-multinomial response using the VGAM package (version 1.0-1). The Dirichlet-multinomial distribution is a compound distribution, where the probabilities that parameterize a multinomial are themselves drawn from a Dirichlet distribution with an additional over dispersion parameter <italic>ϕ</italic>. That is, the Dirichlet encodes the frequencies of the isoforms <bold><italic>π</italic></bold> and the variation in this frequency vector, while the multinomial captures the sampling of actual transcripts according to these frequencies. The Dirichlet has proven effective in previous analyses of splicing changes in bulk RNA-Seq studies <sup><xref rid="R51" ref-type="bibr">51</xref></sup>.</p>
      <p id="P59">To test for pseudotime-dependent shifts in the frequencies of the isoforms produced by each gene, we fit the following model to the observed isoform-level Census RNA counts:
<disp-formula id="FD26"><mml:math id="M26" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">Dirmultinomial</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>∣</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">π</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">ϕ</mml:mi></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mi mathvariant="italic">sm</mml:mi><mml:mo>.</mml:mo><mml:mi mathvariant="italic">ns</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">Pseudotime</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>Only isoforms with at least one copy detected in at least 15 cells were included in the model for each gene, in order to ensure numerical stability within VGAM. We then compared this full model to the null
<disp-formula id="FD27"><mml:math id="M27" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">Dirmultinomial</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>∣</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">π</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">ϕ</mml:mi></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></disp-formula>by likelihood ratio test. Note that each gene’s <italic>ϕ</italic> was estimated by maximum likelihood separately, as we did not wish to assume that these dispersion parameters are a smooth function of expression level, as is commonly done in RNA-Seq.</p>
    </sec>
    <sec id="S22">
      <title>Analysis of pre-implantation embryos</title>
      <p id="P60">Allele-specific relative gene expression values (transcripts per million) were estimated by applying Kallisto<sup><xref rid="R46" ref-type="bibr">46</xref></sup> to the raw reads of Deng <italic>et al.</italic><sup><xref rid="R45" ref-type="bibr">45</xref></sup> using an allele-specific transcriptome index. This index consisted of cDNA sequences from GENCODE vM9, corresponding to the paternal (C57BL/6J) alleles, plus the same sequences with maternal (CAST/EiJ) SNP alleles overlaid (CAST genotypes from Keane <italic>et al.</italic>
<sup><xref rid="R52" ref-type="bibr">52</xref></sup>; only homozygous variants relative to the C57BL/6J reference were used).</p>
      <p id="P61">The TPM values for the two alleles for each gene were converted to allelic RNA counts using Census with default parameters. The number of RNA molecules from each allele of each gene were modeled using a quasibinomial GLM. The quasibinomial is a binomial that allows for over (or under) dispersion with respect to the binomial through a parameter <italic><bold>ϕ</bold></italic>. Its probability mass function is:
<disp-formula id="FD28"><mml:math id="M28" display="block" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mi>n</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>k</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow><mml:mi>p</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="italic">kϕ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>p</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="italic">kϕ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></disp-formula>where <italic>p</italic> encodes the probability that an RNA originated from the maternal allele (without loss of generality).</p>
      <p id="P62">Quasibinomial GLMs were fit to each gene using VGAM, using the option “dispersion=0” to direct VGAM to estimate the dispersion parameter for each model from each gene’s maternal and paternal RNA counts <italic>Z<sub>m</sub></italic> and <italic>Z<sub>p</sub></italic>, respectively. To test for embryo stage-dependent allelic balance shifts in each gene, we fit a full model
<disp-formula id="FD29"><mml:math id="M29" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">quasibinomial</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mi mathvariant="italic">stage</mml:mi></mml:mrow></mml:math></disp-formula>And a null
<disp-formula id="FD30"><mml:math id="M30" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">quasibinomial</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></disp-formula>to these data, and compared them using an F-test <sup><xref rid="R29" ref-type="bibr">29</xref></sup>. As for isoform-level modeling, the dispersion parameter was fit separately for each gene. We note that the quasibinomial is similar to the beta-binomial, the two category case of the Dirichlet-Multinomial. We explored the use of the beta-binomial for this analysis, and while we reached qualitatively similar conclusions regarding escape from X inactivation and monoallelic expression, we felt that the quasibinomial provided a better fit for the data.</p>
      <p id="P63">Analysis of X chromosome inactivation was performed on female embryos at the 4-, 16- and early blastocyst stages. Embryos were sexed by hierarchically clustering cells on the basis of variance stabilized transcript counts for genes on the Y chromosome. Cells fell into two clearly defined clusters, only one of which expressed “informative” Y genes. Embryos comprised of these cells were annotated as male.</p>
      <p id="P64">To quantify the number of genes escaping X inactivation at each stage, we used the quasibinomial GLMs to assess the probability that less than 10% of the RNA from a gene originated from the inactive chromosome. (10% is a widely accepted threshold for escape from X inactivation<sup><xref rid="R53" ref-type="bibr">53</xref>,<xref rid="R54" ref-type="bibr">54</xref></sup>). To do so, we constructed a 95% prediction interval on the allelic ratio for each gene by simulating random variates from its GLM via the VGAM package’s simulate.vlm(). That is, we calculated the number of simulated observations that were less than 10% percent maternal or paternal. Using this statistic, we calculated a significance score for contribution from the maternal and paternal alleles for each gene on the X chromosome, corrected these for multiple testing (via Benjamini-Hochberg), and reported the number of genes with significant maternal and paternal contributions.</p>
      <p id="P65">We used a similar simulation-based procedure to construct prediction intervals for expected monoallelic expression. After fitting a quasibinomial GLM for each (autosomal) gene’s allele RNA counts, we simulated 100 random variates from each gene’s model and counted the number of times the model reported RNAs from only one of the two alleles. We then collected these counts into quantiles based on the gene’s expression level to generate 95% prediction intervals for monoallelic expression as a function of expression level. The exact same fitting, simulation, and prediction interval estimation procedure was used for both RNA counts and estimated allelic read counts from Kallisto.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="S23">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD2">
      <label>1</label>
      <caption>
        <p id="P66"><bold>Supplementary table 1</bold>:</p>
        <p id="P67">Sheet 1. Gene ontology (biological process) gene sets significantly enriched in each cluster of branch-dependent gene for lung epithelial analysis (qval &lt; 0.1, Benjamini-Hochberg correction; see Methods)</p>
        <p id="P68">Sheet 2. Gene ontology (biological process) gene sets significantly enriched in each cluster of branch-dependent genes for the <italic>Stat1</italic>-/- and <italic>Ifnar1</italic>-/- analysis (qval &lt; 0.1, Benjamini-Hochberg correction)</p>
        <p id="P69"><bold>Supplementary table 2</bold>:</p>
        <p id="P70">Variables used in Census, BEAM, isoform and allele switch analysis. (a) A table describing all variables used in the Census algorithm. (b) The same for BEAM. (c) The same for isoform switch analysis. (d) The same for allele switch analysis.</p>
        <p id="P71"><bold>Supplementary file 1</bold>:</p>
        <p id="P72">Text file storing the result (p-value) from the permutation test used in benchmarking differential gene expression based on spike-in transcript counts. Each row corresponds to a gene.</p>
        <p id="P73"><bold>Supplementary software 1</bold>:</p>
        <p id="P74">A tarball includes a version of monocle 2 (version: 1.99), a helper package as well as all analysis code which can reproduce all figures in this study.</p>
      </caption>
      <media xlink:href="NIHMS838884-supplement-1.docx" orientation="portrait" xlink:type="simple" id="d36e2615" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD3">
      <label>2</label>
      <caption>
        <p id="P75"><bold>Supplementary figure 1. Assessment of spike-in free relative transcript count recovery in 7 additional experiments</bold> (a) Fitting the probability of observing a spike-in transcript at a given copy number based on a binomial model for the data from Grun <italic>et al</italic>
<sup><xref rid="R4" ref-type="bibr">4</xref></sup>. Each point indicates a different spike-in transcript. The Y axis shows the fraction of cells in the experiment in which the spike was detected (non-zero relative expression). The curve shows the probability of observation, learned as described in the methods. (b) Distribution of the corresponding transcript counts in cell lysate as well as cDNA space for the most frequent log10(TPM). (c) MA plot for expressed genes based on contrasts of cells from 2i and serum medium. (d) Fold changes for expressed genes based on contrasts of cells from 2i and serum medium. (e, f) The same plots as in (a, b) for ESC dataset <sup><xref rid="R10" ref-type="bibr">10</xref></sup>. (g, h) the same plots as in (c, d) for the contrast of cells from embryonic day 5 and day 6 in ESC dataset. (i) Estimated capture rate of the neuron dataset by different days <sup><xref rid="R15" ref-type="bibr">15</xref></sup>. (j) the same plot as in b for the neuron dataset. (k, l) The same plots as in (c, d) for the contrast of cells from day 22 and day 0 in the neuron dataset. (m, n) The same plots as in (a, b) for pancreas dataset <sup><xref rid="R11" ref-type="bibr">11</xref></sup>. (o, p) the same plots as in (c, d) for the contrast of cells from the annotated alpha cells and beta cells in pancreas dataset. (q, r) The same plots as in (a, b) for cortex dataset <sup><xref rid="R12" ref-type="bibr">12</xref></sup>. (s, t) the same plots as in (c, d) for the contrast of cells from the annotated ependymal astrocyte cells and mural endothelial cells in pancreas dataset. (u, v) The same plots as in (a, b) for marker-free dataset <sup><xref rid="R13" ref-type="bibr">13</xref></sup>. (w, x) the same plots as in (c, d) for the contrast of cells from the annotated CD11c+ cells and CD11c+ cells after two hours LPS stimulation in marker-free dataset. (y, z) The same plots as in (a, b) for quantitative assessment dataset <sup><xref rid="R14" ref-type="bibr">14</xref></sup>. (aa, ab) the same plots as in (c, d) for the contrast of cells from a random sample set A cells and a different random sample set B in quantitative assessment dataset. In (b, f, j, n, r, v, z) the cDNA counts were calculated by multiplying the modes of the transcript count in cell lysate by the estimated capture rate.</p>
        <p id="P76"><bold>Supplementary figure 2. Library sequencing depths for each group of co-captured cells</bold>. (a) Raw read counts per cell for the lung epithelial data. (b) Number of detected ERCC spike-in transcripts per cell for lung epithelial data. (c) Fitting the probability of observing a spike-in transcript at a given copy number based on a binomial model. Different spike-in transcripts across all cells in each time point with the same copy number is pooled. (d) Capture rate estimated for each time point. Different spike-in transcripts across all cells in each time point with the same copy number is pooled. (e) Raw read counts for the dendritic cell data from Shalek <italic>et al.</italic> used in this analysis. For details on the binomial model, see method for more details.</p>
        <p id="P77"><bold>Supplementary figure 3. Robustness of Census to sequencing depth</bold>. (a) MA plot of expressed genes for the contrast of E14.5 and E18.5 cells under downsampled read depths. (b) Fold-change of expressed genes for the contrast of E14.5 and E18.5 cells under downsampled read depths.</p>
        <p id="P78"><bold>Supplemental figure 4. Census accuracy compared to spike-in based conversion over various experimental designs under the generative model</bold>. (a) Transcript counts corresponding to the mode of the relative abundance as a function of the fraction of endogenous mRNA and ladder transcripts successfully converted to cDNA (capture rate). (b-e) Transcript counts corresponding to the mode of the relative abundance as a function of ladder degradation rate, mRNA degradation rate, number of genes expressed in the cell and total mRNAs, respectively. For all panels, blue lines correspond to the cDNA space while the red lines correspond to the cell lysate space.</p>
        <p id="P79"><bold>Supplementary figure 5. Gene expression as measured by read counts and transcript counts</bold>. (a) Distribution of expression values on the read count and transcript count scale for three representative cells. (b) Genes passing a chi-squared goodness of fit test for the negative binomial (NB) and its zero-inflated variant (ZINB). (c) The number of genes that can be fitted by the fitdistrplus package without throwing a numerical exception. (d) Differential expression (DE) analysis accuracy from various tools provided with TPM, normalized read counts, and transcript counts estimated with spike-ins, Census, TPM scaled to 100, 000 total transcripts, TPM using negative binomial distribution and TPM scaled to the true total calculated from the spike-in regression. Cells from E14.5 and E18.5 from Treutlein et al. were provided to each tool. A permutation-based test was applied to the spike-in-based expression levels to determine a ground truth set of DE genes. (e) Differential expression (DE) analysis accuracy from various tools provided with TPM, normalized read counts, and transcript counts estimated with spike-ins, Census, TPM scaled to 100, 000 total transcripts, TPM using negative binomial distribution and TPM scaled to the true total calculated from the spike-in regression. Cells from E16.5 and E18.5 from Treutlein et al. were provided to each tool. A permutation-based test was applied to the spike-in-based expression levels to determine a ground truth set of DE genes. (f) Receiver-operating characteristic (ROC) curves showing differential expression (DE) analysis accuracy from various tools provided TPM rounded to the nearest integer number as well as transcript counts generated by multiplying the relative abundances in each cell times 100,000 total transcripts. Similar to <xref rid="F2" ref-type="fig">Figure 2</xref>, cells from E14.5 and E18.5 from Treutlein et al. were provided to each tool. A permutation-based test was applied to the spike-in-based expression levels to determine a ground truth set of DE genes. (g) Consensus in differential analysis results between Monocle, DESeq2, edgeR, and permutation tests using different measures of expression. The total height of each bar reflects the size of the union of DE genes reported by any of the four tests. The smaller bar reports the number of DE genes identified by all tests. (h) ROC curves showing differential expression (DE) analysis accuracy from various tools provided TPM, normalized read counts, and transcript counts estimated with spike-ins or Census, TPM scaled to 100, 000 total transcripts, TPM using negative binomial distribution and TPM scaled to the true total calculated from the spike-in regression. Cells from E16.5 and E18.5 from Treutlein et al. were provided to each tool. A permutation-based test was applied to the spike-in-based expression levels to determine a ground truth set of DE genes. (i) Same as in panel g. All the above analysis is based on lung epithelial dataset.</p>
        <p id="P80"><bold>Supplementary figure 6. Concordance of different approaches for differential expression analysis in single-cell RNA-Seq using bulk RNA-seq as the ground truth</bold>. (a) Accuracy for several popular tools for differential expression analysis of cells from Trapnell and Cacchiarelli <italic>et al</italic>. using a matched bulk RNA-Seq collected in that study as a gold standard. (b) ROC curves and the area under them for each method from the experiment shown in (a). (c) Differential expression (DE) analysis accuracy from various tools provided with TPM, transcript counts estimated with spike-ins, UMI or Census. (d) Receiver-operating characteristic (ROC) curves showing differential expression (DE) analysis accuracy from various tools provided with TPM, transcript counts estimated with spike-ins, UMI or Census. Panel c, d is based on the noise model dataset with UMI counts.</p>
        <p id="P81"><bold>Supplementary figure 7. Single-cell trajectory reconstruction using TPM values and transcript counts</bold>. (a) HSMM trajectory reconstructed with TPMs. (b) HSMM trajectory reconstructed with variance-stabilized transcript counts. Note that the pseudotime ordering is not affected by the rotation of tree. (c) Cell-to-cell map between the two orderings. (d) Overlap between genes that are significantly differentially expressed as a function of pseudotime as calculated with TPM and transcript counts. Only the genes for which a permutation-based p-value could be computed with glmperm are shown here. (e) Benchmarking results for Monocle 2 and DESeq for a pseudotime-dependence test relative to a permutation control (see Methods for details). (f) ROC curves and the area under them for each method from the experiment shown in (e). (g) Overlap between significantly enriched GO terms for the pseudotime dependent genes calculated from TPM or transcript counts (h) Relative significance scores for gene sets under a hypergeometric test for enrichment within pseudotime dependent genes. Positive values indicate that a gene set is more significantly enriched when using TPM values to order cells, while negative values indicate a gene set is more significant when using transcript counts. “Muscle related” gene sets are those from REACTOME with “muscle” or “myo” in the name. (e.g. “Muscle development”)</p>
        <p id="P82"><bold>Supplementary figure 8. Monocle’s Single-cell trajectory of developing murine pneumocytes</bold>. Cells are colored according to type assignments made by Truetlein <italic>et al</italic>. Only cells collected at E18.5 were assigned in the original study. Bounding boxes show Monocle’s assignment of cells to types based on the topology of the trajectory.</p>
        <p id="P83"><bold>Supplementary figure 9. Clustering and motif enrichment analysis of branch-dependent genes according to bilineage expression kinetics</bold>. Branch-dependent genes identified by BEAM can be further assessed for common functions and potential upstream regulators. The expression for each gene along the two trajectories is used to cluster genes into groups that share branch-dependent expression kinetics. Regulatory elements (e.g. defined by DNaseI-Seq) can be collected for each group and tested for enrichment with specific transcription factor binding site motifs.</p>
        <p id="P84"><bold>Supplementary figure 10. BEAM analysis reveals branch-dependent gene expression during lung epithelial specification</bold>. (a) Hierarchical clustering of normalized expression in terms of transcript counts for all the significant branch genes identified by BEAM (FDR &lt; 5%). Each column represents a cell ordered along the trajectory. The center of the heatmap corresponds to the beginning of the trajectory. Moving left proceeds down the AT1 branch, whereas moving right proceeds down the AT2 branch. Each row represents the transcript counts for a gene on each branch. Rows are hierarchically clustered using Pearson’s correlation with Ward’s method. (b) TF motif enrichment within the hypersensitive sites proximal to the branching genes in each of the kinetic clusters. Motifs corresponding to transcription factors that are themselves significantly branch dependent are labeled in red. (c) Hierarchical clustering of normalized expression in terms of Census counts for markers of pneumocyte specification as defined by Treutlein <italic>et al.</italic> and cell cycle genes. Each column represents a cell ordered along the trajectory. The center of the heatmap corresponds to the beginning of the trajectory. Moving left proceeds down the AT1 branch, whereas moving right proceeds down the AT2 branch. Each row represents the smoothed BEAM expression curve for a gene on each branch. Rows are transformed to Z-scores prior to hierarchically clustering using Pearson’s correlation with Ward’s method. (d) Pseudotime distribution of branch points for markers of early and late pneumocyte specification as defined by Truetlein <italic>et al</italic>.</p>
        <p id="P85"><bold>Supplementary figure 11. Branching expression kinetics for predicted and known regulators of lung epithelial cell fate and function</bold>. (a) Significant branching TFs which also have binding motifs enriched in the upstream of significant branching genes shown in supplementary figure 10a. (b) Known regulators of lung epithelial cell fate specification.</p>
        <p id="P86"><bold>Supplementary figure 12. Robustness of BEAM analysis to number of cells collected</bold>. The original set of cells from the KO experiment from Shalek et al. were downsampled randomly at progressively lower proportions of the original dataset. For each subset, cells were re-ordered with Monocle 2, and BEAM tests were then performed. Three different subsets were performed per proportion. (a) Example trajectories for each proportion. (b) Fraction of cells assigned to the same branch as in the full dataset. (c) Pearson correlation of pseudotime for cells included in each sample compared to the relative ordering of these cells in the full dataset. (d) Precision and (e) Recall of genes reported as significantly branch-dependent by BEAM for each sample of the cells, using the branch-dependent genes from the full dataset as the “ground truth”. (f) Spearman rank correlation of p-values returned by BEAM for all genes compared to their p-values when BEAM is given the full dataset. Red (blue) dots in panels d, e, f correspond to cell downsampling with cell ordering fixed using transcript count data (TPM expression data), green dots cell downsampling with cell re-ordering as in panels a, b. For TPM data, the same ordering as for transcript counts is used.</p>
        <p id="P87"><bold>Supplementary figure 13. Significant enriched motifs</bold>. Transcription factor binding motifs significantly enriched in regulatory elements upstream of genes in cluster 5 (hypergeometric test, FDR &lt; 10%. See methods).</p>
        <p id="P88"><bold>Supplementary figure 14. Differential splicing during cell differentiation with Census</bold>. (a) A Dirichlet-multinomial regression of detected changes in relative transcript counts for the isoforms of 74 genes during skeletal myoblast differentiation. All detectably expressed isoforms of genes with pseudotime-dependent splicing were clustered, allowing isoforms of a gene to fall into different clusters. Each row represents the pseudotime-smoothed expression curve for an isoform. Rows are transformed to Z-scores prior to hierarchically clustering using Pearson’s correlation with Ward’s method. (b) Pseudotime clusters spanned by the isoforms of individual genes. (c) Transcript counts for detectably expressed isoforms of the actin family of proteins. Black lines indicate the expected transcript count from a negative binomial regression of expression as a function of pseudotime.</p>
        <p id="P89"><bold>Supplementary figure 15. Example of allelic specific expression with Census</bold>. Allelic transcript counts from Census for genes known to be silenced in late blastocysts or post-implantation embryos (<italic>Atrx, Huwe1</italic>), or before the 8-cell stage (<italic>Kif4, Rlim</italic>). Lines indicate the average count the maternal and paternal allele at each stage.</p>
      </caption>
      <media xlink:href="NIHMS838884-supplement-2.pdf" orientation="portrait" xlink:type="simple" id="d36e2737" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD4">
      <label>3</label>
      <media xlink:href="NIHMS838884-supplement-3.docx" orientation="portrait" xlink:type="simple" id="d36e2741" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD5">
      <label>4</label>
      <media xlink:href="NIHMS838884-supplement-4.docx" orientation="portrait" xlink:type="simple" id="d36e2745" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S24">
    <p>We thank Jianghong Shi, Song Xu for technical discussions and Martin Kircher for cluster computation support. We are grateful to Jay Shendure, Ron Hause, Darren Cusanovich, Bruce Trapnell, Jeff Whitsett and members of the Trapnell laboratory for comments on manuscript. This work was supported by NIH Grant DP2 HD088158. C.T. is partly supported by a Dale. F. Frey Award for Breakthrough Scientists and an Alfred P. Sloan Foundation Research Fellowship. A.H. is supported by an NSF Graduate Research Fellowship.</p>
  </ack>
  <fn-group>
    <fn id="FN2" fn-type="con">
      <p>
        <bold>Author Contributions</bold>
      </p>
      <p>X.Q. and C.T. designed Census and the regression methods. X.Q. implemented the methods. X.Q. and A.H performed the analysis. J.P, D.L, and Y.M contributed to technical design. C.T. conceived the project. All authors wrote the manuscript.</p>
    </fn>
    <fn fn-type="COI-statement" id="FN3">
      <p>
        <bold>Competing Financial Interest Statement</bold>
      </p>
      <p>The authors declare no relevant financial interests.</p>
    </fn>
  </fn-group>
  <ref-list>
    <ref id="R1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Macosko</surname>
            <given-names>EZ</given-names>
          </name>
          <name>
            <surname>Basu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Nemesh</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Shekhar</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets</article-title>
        <year>2015</year>
        <pub-id pub-id-type="doi">10.1016/j.cell.2015.05.002</pub-id>
      </element-citation>
    </ref>
    <ref id="R2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Klein</surname>
            <given-names>AM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Droplet barcoding for single-cell transcriptomics applied to embryonic stem cells</article-title>
        <source>Cell</source>
        <volume>161</volume>
        <fpage>1187</fpage>
        <lpage>1201</lpage>
        <year>2015</year>
        <pub-id pub-id-type="pmid">26000487</pub-id>
      </element-citation>
    </ref>
    <ref id="R3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shalek</surname>
            <given-names>AK</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell transcriptomics reveals bimodality in expression and splicing in immune cells</article-title>
        <source>Nature</source>
        <year>2013</year>
        <pub-id pub-id-type="doi">10.1038/nature12172</pub-id>
      </element-citation>
    </ref>
    <ref id="R4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grün</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Kester</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>van Oudenaarden</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Validation of noise models for single-cell transcriptomics</article-title>
        <source>Nature methods</source>
        <volume>11</volume>
        <fpage>637</fpage>
        <lpage>640</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">24747814</pub-id>
      </element-citation>
    </ref>
    <ref id="R5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Finak</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MAST: a flexible statistical framework for assessing transcriptional changes and characterizing heterogeneity in single-cell RNA sequencing data</article-title>
        <source>Genome biology</source>
        <volume>16</volume>
        <fpage>278</fpage>
        <year>2015</year>
        <pub-id pub-id-type="pmid">26653891</pub-id>
      </element-citation>
    </ref>
    <ref id="R6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Synthetic spike-in standards for RNA-seq experiments</article-title>
        <source>Genome Research</source>
        <volume>21</volume>
        <fpage>1543</fpage>
        <lpage>1551</lpage>
        <year>2011</year>
        <pub-id pub-id-type="pmid">21816910</pub-id>
      </element-citation>
    </ref>
    <ref id="R7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fu</surname>
            <given-names>GK</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>PH</given-names>
          </name>
          <name>
            <surname>Fodor</surname>
            <given-names>SPA</given-names>
          </name>
        </person-group>
        <article-title>Counting individual DNA molecules by the stochastic attachment of diverse labels</article-title>
        <source>Proceedings of the National Academy of Sciences of the United States of America</source>
        <volume>108</volume>
        <fpage>9026</fpage>
        <lpage>9031</lpage>
        <year>2011</year>
        <pub-id pub-id-type="pmid">21562209</pub-id>
      </element-citation>
    </ref>
    <ref id="R8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hug</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Schuler</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Measurement of the number of molecules of a single mRNA species in a complex mRNA preparation</article-title>
        <source>Journal of theoretical biology</source>
        <volume>221</volume>
        <fpage>615</fpage>
        <lpage>624</lpage>
        <year>2003</year>
        <pub-id pub-id-type="pmid">12713944</pub-id>
      </element-citation>
    </ref>
    <ref id="R9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Picelli</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Faridani</surname>
            <given-names>OR</given-names>
          </name>
          <name>
            <surname>Bj o rklund</surname>
            <given-names>AK</given-names>
          </name>
          <name>
            <surname>Winberg</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Full-length RNA-seq from single cells using Smart-seq2</article-title>
        <year>2014</year>
        <pub-id pub-id-type="doi">10.1038/nprot.2014.006</pub-id>
      </element-citation>
    </ref>
    <ref id="R10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Petropoulos</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-Cell RNA-Seq Reveals Lineage and X Chromosome Dynamics in Human Preimplantation Embryos</article-title>
        <source>Cell</source>
        <volume>165</volume>
        <fpage>1012</fpage>
        <lpage>1026</lpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">27062923</pub-id>
      </element-citation>
    </ref>
    <ref id="R11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Segerstolpe</surname>
            <given-names>Å</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-Cell Transcriptome Profiling of Human Pancreatic Islets in Health and Type 2 Diabetes</article-title>
        <source>Cell Metabolism</source>
        <volume>24</volume>
        <fpage>593</fpage>
        <lpage>607</lpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">27667667</pub-id>
      </element-citation>
    </ref>
    <ref id="R12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeisel</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Brain structure. Cell types in the mouse cortex and hippocampus revealed by single-cell RNA-seq</article-title>
        <source>Science</source>
        <volume>347</volume>
        <fpage>1138</fpage>
        <lpage>1142</lpage>
        <year>2015</year>
        <pub-id pub-id-type="pmid">25700174</pub-id>
      </element-citation>
    </ref>
    <ref id="R13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jaitin</surname>
            <given-names>DA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel single-cell RNA-seq for marker-free decomposition of tissues into cell types</article-title>
        <source>Science</source>
        <volume>343</volume>
        <fpage>776</fpage>
        <lpage>779</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">24531970</pub-id>
      </element-citation>
    </ref>
    <ref id="R14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>AR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Quantitative assessment of single-cell RNA-sequencing methods</article-title>
        <source>Nature methods</source>
        <volume>11</volume>
        <fpage>41</fpage>
        <lpage>46</lpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">24141493</pub-id>
      </element-citation>
    </ref>
    <ref id="R15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Treutlein</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Dissecting direct reprogramming from fibroblast to neuron using single-cell RNA-seq</article-title>
        <source>Nature</source>
        <volume>534</volume>
        <fpage>391</fpage>
        <lpage>395</lpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">27281220</pub-id>
      </element-citation>
    </ref>
    <ref id="R16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Robinson</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Smyth</surname>
            <given-names>GK</given-names>
          </name>
        </person-group>
        <article-title>edgeR: a Bioconductor package for differential expression analysis of digital gene expression data</article-title>
        <source>Bioinformatics</source>
        <volume>26</volume>
        <fpage>139</fpage>
        <lpage>140</lpage>
        <year>2010</year>
        <pub-id pub-id-type="pmid">19910308</pub-id>
      </element-citation>
    </ref>
    <ref id="R17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Love</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Huber</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Anders</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2</article-title>
        <source>Genome biology</source>
        <volume>15</volume>
        <year>2014</year>
      </element-citation>
    </ref>
    <ref id="R18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The dynamics and regulators of cell fate decisions are revealed by pseudotemporal ordering of single cells</article-title>
        <source>Nature Biotechnology</source>
        <volume>32</volume>
        <fpage>381</fpage>
        <lpage>386</lpage>
        <year>2014</year>
      </element-citation>
    </ref>
    <ref id="R19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kharchenko</surname>
            <given-names>PV</given-names>
          </name>
          <name>
            <surname>Silberstein</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Scadden</surname>
            <given-names>DT</given-names>
          </name>
        </person-group>
        <article-title>Bayesian approach to single-cell differential expression analysis</article-title>
        <source>Nature methods</source>
        <volume>11</volume>
        <fpage>740</fpage>
        <lpage>742</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">24836921</pub-id>
      </element-citation>
    </ref>
    <ref id="R20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tang</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Tracing the derivation of embryonic stem cells from the inner cell mass by single-cell RNA-Seq analysis</article-title>
        <source>Cell stem cell</source>
        <volume>6</volume>
        <fpage>468</fpage>
        <lpage>478</lpage>
        <year>2010</year>
        <pub-id pub-id-type="pmid">20452321</pub-id>
      </element-citation>
    </ref>
    <ref id="R21">
      <label>21</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Buganim</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell expression analyses during cellular reprogramming reveal an early stochastic and a late hierarchic phase</article-title>
        <source>Cell</source>
        <volume>150</volume>
        <fpage>1209</fpage>
        <lpage>1222</lpage>
        <year>2012</year>
        <pub-id pub-id-type="pmid">22980981</pub-id>
      </element-citation>
    </ref>
    <ref id="R22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhou</surname>
            <given-names>JX</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Understanding gene circuits at cell-fate branch points for rational cell reprogramming</article-title>
        <source>Trends in genetics : TIG</source>
        <volume>27</volume>
        <fpage>55</fpage>
        <lpage>62</lpage>
        <year>2011</year>
        <pub-id pub-id-type="pmid">21146896</pub-id>
      </element-citation>
    </ref>
    <ref id="R23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moignard</surname>
            <given-names>V</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Decoding the regulatory network of early blood development from single-cell gene expression measurements</article-title>
        <source>Nature Biotechnology</source>
        <volume>33</volume>
        <fpage>269</fpage>
        <lpage>276</lpage>
        <year>2015</year>
      </element-citation>
    </ref>
    <ref id="R24">
      <label>24</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Marco</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Bifurcation analysis of single-cell gene expression data reveals epigenetic landscape</article-title>
        <source>Proceedings of the National Academy of Sciences of the United States of America</source>
        <volume>111</volume>
        <fpage>E5643</fpage>
        <lpage>50</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">25512504</pub-id>
      </element-citation>
    </ref>
    <ref id="R25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Treutlein</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Reconstructing lineage hierarchies of the distal lung epithelium using single-cell RNA-seq</article-title>
        <source>Nature</source>
        <volume>509</volume>
        <fpage>371</fpage>
        <lpage>375</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">24739965</pub-id>
      </element-citation>
    </ref>
    <ref id="R26">
      <label>26</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hochegger</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Takeda</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hunt</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>Cyclin-dependent kinases and cell-cycle transitions: does one fit all?</article-title>
        <source>Nature Reviews Molecular Cell Biology</source>
        <volume>9</volume>
        <fpage>910</fpage>
        <lpage>916</lpage>
        <year>2008</year>
        <pub-id pub-id-type="pmid">18813291</pub-id>
      </element-citation>
    </ref>
    <ref id="R27">
      <label>27</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Desai</surname>
            <given-names>TJ</given-names>
          </name>
          <name>
            <surname>Brownfield</surname>
            <given-names>DG</given-names>
          </name>
          <name>
            <surname>Krasnow</surname>
            <given-names>MA</given-names>
          </name>
        </person-group>
        <article-title>Alveolar progenitor and stem cells in lung development, renewal and cancer</article-title>
        <source>Nature</source>
        <volume>507</volume>
        <fpage>190</fpage>
        <lpage>194</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">24499815</pub-id>
      </element-citation>
    </ref>
    <ref id="R28">
      <label>28</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chi</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Garnier</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Hawgood</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Colten</surname>
            <given-names>HR</given-names>
          </name>
        </person-group>
        <article-title>Identification of a novel alternatively spliced mRNA of murine pulmonary surfactant protein B</article-title>
        <source>Am J Respir Cell Mol Biol</source>
        <volume>19</volume>
        <fpage>107</fpage>
        <lpage>113</lpage>
        <year>1998</year>
        <pub-id pub-id-type="pmid">9651186</pub-id>
      </element-citation>
    </ref>
    <ref id="R29">
      <label>29</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>MCCULLAGH</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Nelder</surname>
            <given-names>JA</given-names>
          </name>
        </person-group>
        <source>Generalized Linear Models</source>
        <edition>Second Edition</edition>
        <publisher-name>CRC Press</publisher-name>
        <year>1989</year>
      </element-citation>
    </ref>
    <ref id="R30">
      <label>30</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shu</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Foxp2 and Foxp1 cooperatively regulate lung and esophagus development</article-title>
        <source>Development (Cambridge, England)</source>
        <volume>134</volume>
        <fpage>1991</fpage>
        <lpage>2000</lpage>
        <year>2007</year>
      </element-citation>
    </ref>
    <ref id="R31">
      <label>31</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yin</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>An FGF-WNT gene regulatory network controls lung mesenchyme development</article-title>
        <source>Developmental Biology</source>
        <volume>319</volume>
        <fpage>426</fpage>
        <lpage>436</lpage>
        <year>2008</year>
        <pub-id pub-id-type="pmid">18533146</pub-id>
      </element-citation>
    </ref>
    <ref id="R32">
      <label>32</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shu</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>ZHANG</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Lu</surname>
            <given-names>MM</given-names>
          </name>
          <name>
            <surname>Morrisey</surname>
            <given-names>EE</given-names>
          </name>
        </person-group>
        <article-title>Characterization of a new subfamily of winged-helix/forkhead (Fox) genes that are expressed in the lung and act as transcriptional repressors</article-title>
        <source>J Biol Chem</source>
        <volume>276</volume>
        <fpage>27488</fpage>
        <lpage>27497</lpage>
        <year>2001</year>
        <pub-id pub-id-type="pmid">11358962</pub-id>
      </element-citation>
    </ref>
    <ref id="R33">
      <label>33</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wan</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Kruppel-like factor 5 is required for perinatal lung morphogenesis and function</article-title>
        <source>Development (Cambridge, England)</source>
        <volume>135</volume>
        <fpage>2563</fpage>
        <lpage>2572</lpage>
        <year>2008</year>
      </element-citation>
    </ref>
    <ref id="R34">
      <label>34</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xu</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>C/EBP{alpha} is required for pulmonary cytoprotection during hyperoxia</article-title>
        <source>Am J Physiol Lung Cell Mol Physiol</source>
        <volume>297</volume>
        <fpage>L286</fpage>
        <lpage>98</lpage>
        <year>2009</year>
        <pub-id pub-id-type="pmid">19465518</pub-id>
      </element-citation>
    </ref>
    <ref id="R35">
      <label>35</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Okubo</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Hogan</surname>
            <given-names>BLM</given-names>
          </name>
        </person-group>
        <article-title>Hyperactive Wnt signaling changes the developmental potential of embryonic lung endoderm</article-title>
        <source>Journal of Biology</source>
        <volume>3</volume>
        <fpage>11</fpage>
        <year>2004</year>
        <pub-id pub-id-type="pmid">15186480</pub-id>
      </element-citation>
    </ref>
    <ref id="R36">
      <label>36</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shalek</surname>
            <given-names>AK</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA-seq reveals dynamic paracrine control of cellular variation</article-title>
        <source>Nature</source>
        <year>2014</year>
        <pub-id pub-id-type="doi">10.1038/nature13437</pub-id>
      </element-citation>
    </ref>
    <ref id="R37">
      <label>37</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Darnell</surname>
            <given-names>JE</given-names>
          </name>
          <name>
            <surname>Kerr</surname>
            <given-names>IM</given-names>
          </name>
          <name>
            <surname>Stark</surname>
            <given-names>GR</given-names>
          </name>
        </person-group>
        <article-title>Jak-STAT pathways and transcriptional activation in response to IFNs and other extracellular signaling proteins</article-title>
        <source>Science</source>
        <volume>264</volume>
        <fpage>1415</fpage>
        <lpage>1421</lpage>
        <year>1994</year>
        <pub-id pub-id-type="pmid">8197455</pub-id>
      </element-citation>
    </ref>
    <ref id="R38">
      <label>38</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Honda</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>IRF-7 is the master regulator of type-I interferon-dependent immune responses</article-title>
        <source>Nature</source>
        <volume>434</volume>
        <fpage>772</fpage>
        <lpage>777</lpage>
        <year>2005</year>
        <pub-id pub-id-type="pmid">15800576</pub-id>
      </element-citation>
    </ref>
    <ref id="R39">
      <label>39</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gautier</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A type I interferon autocrine-paracrine loop is involved in Toll-like receptor-induced interleukin-12p70 secretion by dendritic cells</article-title>
        <source>J Exp Med</source>
        <volume>201</volume>
        <fpage>1435</fpage>
        <lpage>1446</lpage>
        <year>2005</year>
        <pub-id pub-id-type="pmid">15851485</pub-id>
      </element-citation>
    </ref>
    <ref id="R40">
      <label>40</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lavin</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Tissue-resident macrophage enhancer landscapes are shaped by the local microenvironment</article-title>
        <source>Cell</source>
        <volume>159</volume>
        <fpage>1312</fpage>
        <lpage>1326</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">25480296</pub-id>
      </element-citation>
    </ref>
    <ref id="R41">
      <label>41</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Welch</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Prins</surname>
            <given-names>JF</given-names>
          </name>
        </person-group>
        <article-title>Robust detection of alternative splicing in a population of single cells</article-title>
        <source>Nucleic acids research</source>
        <volume>44</volume>
        <fpage>e73</fpage>
        <lpage>e73</lpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">26740580</pub-id>
      </element-citation>
    </ref>
    <ref id="R42">
      <label>42</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Perrin</surname>
            <given-names>BJ</given-names>
          </name>
          <name>
            <surname>Ervasti</surname>
            <given-names>JM</given-names>
          </name>
        </person-group>
        <article-title>The actin gene family: function follows isoform</article-title>
        <source>Cytoskeleton (Hoboken)</source>
        <volume>67</volume>
        <fpage>630</fpage>
        <lpage>634</lpage>
        <year>2010</year>
        <pub-id pub-id-type="pmid">20737541</pub-id>
      </element-citation>
    </ref>
    <ref id="R43">
      <label>43</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tondeleir</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Vandamme</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Vandekerckhove</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Ampe</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Lambrechts</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Actin isoform expression patterns during mammalian development and in pathology: insights from mouse models</article-title>
        <source>Cell Motil Cytoskeleton</source>
        <volume>66</volume>
        <fpage>798</fpage>
        <lpage>815</lpage>
        <year>2009</year>
        <pub-id pub-id-type="pmid">19296487</pub-id>
      </element-citation>
    </ref>
    <ref id="R44">
      <label>44</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gunning</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>O’Neill</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Hardeman</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Tropomyosin-based regulation of the actin cytoskeleton in time and space</article-title>
        <source>Physiol Rev</source>
        <volume>88</volume>
        <fpage>1</fpage>
        <lpage>35</lpage>
        <year>2008</year>
        <pub-id pub-id-type="pmid">18195081</pub-id>
      </element-citation>
    </ref>
    <ref id="R45">
      <label>45</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Deng</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Ramsköld</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Reinius</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Sandberg</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA-seq reveals dynamic, random monoallelic gene expression in mammalian cells</article-title>
        <year>2014</year>
        <pub-id pub-id-type="doi">10.1126/science.1245316</pub-id>
      </element-citation>
    </ref>
    <ref id="R46">
      <label>46</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bray</surname>
            <given-names>NL</given-names>
          </name>
          <name>
            <surname>Pimentel</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Melsted</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Near-optimal probabilistic RNA-seq quantification</article-title>
        <source>Nature Biotechnology</source>
        <volume>34</volume>
        <fpage>525</fpage>
        <lpage>527</lpage>
        <year>2016</year>
      </element-citation>
    </ref>
    <ref id="R47">
      <label>47</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kim</surname>
            <given-names>JK</given-names>
          </name>
          <name>
            <surname>Kolodziejczyk</surname>
            <given-names>AA</given-names>
          </name>
          <name>
            <surname>Illicic</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Characterizing noise structure in single-cell RNA-seq distinguishes genuine from technical stochastic allelic expression</article-title>
        <source>Nature Communications</source>
        <volume>6</volume>
        <fpage>8687</fpage>
        <year>2015</year>
      </element-citation>
    </ref>
    <ref id="R48">
      <label>48</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Amit</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Unbiased reconstruction of a mammalian transcriptional network mediating pathogen responses</article-title>
        <source>Science</source>
        <volume>326</volume>
        <fpage>257</fpage>
        <lpage>263</lpage>
        <year>2009</year>
        <pub-id pub-id-type="pmid">19729616</pub-id>
      </element-citation>
    </ref>
    <ref id="R49">
      <label>49</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Anders</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Huber</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Differential expression analysis for sequence count data</article-title>
        <source>Genome biology</source>
        <volume>11</volume>
        <year>2010</year>
      </element-citation>
    </ref>
    <ref id="R50">
      <label>50</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Yee</surname>
            <given-names>TW</given-names>
          </name>
        </person-group>
        <source>Vector Generalized Linear and Additive Models</source>
        <publisher-name>Springer</publisher-name>
        <year>2015</year>
        <pub-id pub-id-type="doi">10.1007/978-1-4939-2818-7</pub-id>
      </element-citation>
    </ref>
  </ref-list>
  <ref-list>
    <title>Method-only Reference</title>
    <ref id="R51">
      <label>51</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Katz</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>ET</given-names>
          </name>
          <name>
            <surname>Airoldi</surname>
            <given-names>EM</given-names>
          </name>
          <name>
            <surname>Burge</surname>
            <given-names>CB</given-names>
          </name>
        </person-group>
        <article-title>Analysis and design of RNA sequencing experiments for identifying isoform regulation</article-title>
        <source>Nature methods</source>
        <volume>7</volume>
        <fpage>1009</fpage>
        <lpage>1015</lpage>
        <year>2010</year>
        <pub-id pub-id-type="pmid">21057496</pub-id>
      </element-citation>
    </ref>
    <ref id="R52">
      <label>52</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Keane</surname>
            <given-names>TM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mouse genomic variation and its effect on phenotypes and gene regulation</article-title>
        <source>Nature</source>
        <volume>477</volume>
        <fpage>289</fpage>
        <lpage>294</lpage>
        <year>2011</year>
        <pub-id pub-id-type="pmid">21921910</pub-id>
      </element-citation>
    </ref>
    <ref id="R53">
      <label>53</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Corbel</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Diabangouaya</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Gendrel</surname>
            <given-names>AV</given-names>
          </name>
          <name>
            <surname>Chow</surname>
            <given-names>JC</given-names>
          </name>
          <name>
            <surname>Heard</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Unusual chromatin status and organization of the inactive X chromosome in murine trophoblast giant cells</article-title>
        <source>Development (Cambridge, England)</source>
        <volume>140</volume>
        <fpage>861</fpage>
        <lpage>872</lpage>
        <year>2013</year>
      </element-citation>
    </ref>
    <ref id="R54">
      <label>54</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yang</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Babak</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Shendure</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Disteche</surname>
            <given-names>CM</given-names>
          </name>
        </person-group>
        <article-title>Global survey of escape from X inactivation by RNA-sequencing in mouse</article-title>
        <source>Genome Research</source>
        <volume>20</volume>
        <fpage>614</fpage>
        <lpage>622</lpage>
        <year>2010</year>
        <pub-id pub-id-type="pmid">20363980</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <title>Census approximates relative transcript counts in single cells without external RNA standards</title>
      <p>(a) The typical procedure for estimating lysate mRNA abundances via spike-in standards in single-cell RNA-Seq. Losses at various stages alter the distribution of relative gene expression levels within a single cell. (b) Distribution of the transcript counts corresponding to each cell’s most frequently observed relative abundance (i.e. TPM) in cDNA or lysate RNA space in the lung epithelial data from Treutlein <italic>et al</italic>. Modes are obtained by log-transforming the data, performing a Gaussian kernel density estimation, and then exponentiating back to the original scale. (c) Total transcripts per lung epithelial cell estimated via spike-in controls versus counts from the spike-free algorithm in Census. Blue line indicates linear regression. Black line indicates perfect concordance. (d) MA plot for expressed genes based on contrasts between cells from E14.5 and cells from all other time points. The top panels show Census transcript counts while the bottom panels show transcript counts derived by spike-in regression. (e) Fold changes for expressed genes based on data from Census transcripts or transcripts with spike-in regression of contrasts between cells from E14.5 and cells from all other time points.</p>
    </caption>
    <graphic xlink:href="nihms838884f1"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <title>Use of Census counts improves accuracy of differential expression analysis and can be performed on libraries with or without spike controls</title>
      <p>(a) Receiver-operating characteristic (ROC) curves showing differential expression (DE) analysis accuracy from various tools provided with relative expression levels, normalized read counts, and transcript counts estimated with spike-ins or Census. Cells from E14.5 and E18.5 from Treutlein <italic>et al.</italic> were provided to each tool. A permutation-based test was applied to the spike-in-based expression levels to determine a ground truth set of DE genes. In addition to Census and spike controls, we include transcript counts derived by scaling the TPM values by the correct per-cell total RNAs. This control shares Census’ inability to control for amplification bias, but begins with the same total per-cell transcript counts available through spike-ins. Comparing this control to spike-based regression reveals the impact of amplification bias on differential analysis in single cells. Comparing it to Census assesses how error in estimating total transcript counts translates into error in differential analysis. (b) Consensus in differential analysis results between Monocle, DESeq2, edgeR, and permutation tests using different measures of expression. The total height of each bar reflects the size of the union of DE genes reported by any of the four tests. The smaller bar reports the number of DE genes identified by all tests.</p>
    </caption>
    <graphic xlink:href="nihms838884f2"/>
  </fig>
  <fig id="F3" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <title>BEAM identifies genes with branch-dependent expression and potential drivers during lung epithelial fate specification</title>
      <p>(a) Monocle 2 recovers a branched single-cell trajectory beginning with bronchoalveolar progenitors (BP) and terminating at type I (AT1) and type II (AT2) pneumocytes. High expression of known markers of proliferation (<italic>Ccnb2, Cdk2</italic>) is restricted to progenitor cells, whereas high expression of known AT1 (Pdpn) and AT2 (Sftpb) markers is restricted to their corresponding lineages. Size of circles denotes level of expression. (b) Branching Expression Analysis Modeling (BEAM) is a statistical framework for identifying genes with expression that changes over a single-cell trajectory in a branch-dependent manner. BEAM first uses generalized linear models with natural splines to perform a regression on the data in which the branch assignments of the cells are known (alternative model), fitting a separate curve for each branch. It also performs another regression in which the branch assignments are not known (null model), fitting a single curve for all the data, and then compares these models via a likelihood ratio test. (c) Null and alternative model fits for the AT1/2 markers (<italic>Ager</italic> / <italic>Sftpb</italic>) and housekeeping genes (<italic>Hprt</italic> and <italic>Pgk1</italic>). Solid lines indicate the smoothed expression curves for each branch in the alternative model while dashed line corresponding to the fitted curve in the null model used in the BEAM test.</p>
    </caption>
    <graphic xlink:href="nihms838884f3"/>
  </fig>
  <fig id="F4" orientation="portrait" position="float">
    <label>Figure 4</label>
    <caption>
      <title>Loss of interferon signaling generates a branch in the trajectory followed by immune-stimulated dendritic cells</title>
      <p>(a) Experimental design used by Shalek <italic>et al.</italic> to compare BMDCs from <italic>Ifnar1</italic>-/- and <italic>Stat1</italic>-/- knockout mice against the wild type as they respond to LPS. (b) Single-cell trajectory recovered by Monocle 2. (c) Kinetic clusters of branch-dependent genes identified by BEAM are functionally enriched for interferon signaling and other immune-related processes. (d) Branch time point for the significant branching antiviral regulators and their significant branching targets collected from Fig. 4 of. <sup><xref rid="R48" ref-type="bibr">48</xref></sup>) (e) Branch time points for the TFs with motifs enriched in nearby DHS site from significant branch genes from cluster 5 and their potential target genes in cluster 5 (panel c). For all boxplots in this study, the upper and lower “hinges” correspond to the first and third quartiles (the 25th and 75th percentiles). The whiskers extend from the upper (or lower) hinge to the highest (or lowest) value that is within 1.5 * IQR of the hinge, where IQR is the inter-quartile range, or distance between the first and third quartiles. Data beyond the end of the whiskers are outliers and plotted as points. The center line corresponds to the median.</p>
    </caption>
    <graphic xlink:href="nihms838884f4"/>
  </fig>
  <fig id="F5" orientation="portrait" position="float">
    <label>Figure 5</label>
    <caption>
      <title>Census enables robust analysis of differential splicing during cell differentiation</title>
      <p>(a) Splicing structure of TPM1, with the three alternatively spliced sets of exons highlighted. (b) Percent-spliced-in (PSI) values for TPM1 alternative exons. PSI values were computed by summing Census counts for isoforms including each exon and dividing by the total TPM1 transcript count in each cell. Black lines indicate loess smoothing of the PSI values as a function of pseudotime.</p>
    </caption>
    <graphic xlink:href="nihms838884f5"/>
  </fig>
  <fig id="F6" orientation="portrait" position="float">
    <label>Figure 6</label>
    <caption>
      <title>Census detects shifts in allelic balance in single cells during embryogenesis</title>
      <p>(a) A quasibinomial regression model detects changes in allelic balance in single cells as a function of embryo stage. (b) Spread of X chromosome inactivation as measured by Census for female embryos at the 4-cell, 16-cell, and early blastocyst stage. Compare with Fig 2B from Deng <italic>et a l</italic><sup><xref rid="R45" ref-type="bibr">45</xref></sup>. (c) Number of genes with at least 10% contribution from the maternal and paternal copies of X chromosome. (d) Observed monoallelic expression in single cells from late stage embryos as measured by Census transcript counts (top) or normalized read counts (bottom). Red line indicates median fraction of monoallelic calls as a function of average transcript count across cells. Only autosomal genes are shown. Black bars indicate 95% prediction interval generated by a quasibinomial regression model fit to each gene, with the median of the gene intervals indicated by the blue line. Light red points indicate individual genes that fall outside the prediction interval.</p>
    </caption>
    <graphic xlink:href="nihms838884f6"/>
  </fig>
</floats-group>
