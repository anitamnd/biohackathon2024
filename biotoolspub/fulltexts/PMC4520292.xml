<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">J Appl Crystallogr</journal-id>
    <journal-id journal-id-type="iso-abbrev">J Appl Crystallogr</journal-id>
    <journal-id journal-id-type="publisher-id">J. Appl. Cryst.</journal-id>
    <journal-title-group>
      <journal-title>Journal of Applied Crystallography</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0021-8898</issn>
    <issn pub-type="epub">1600-5767</issn>
    <publisher>
      <publisher-name>International Union of Crystallography</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4520292</article-id>
    <article-id pub-id-type="publisher-id">rg5089</article-id>
    <article-id pub-id-type="doi">10.1107/S1600576715009607</article-id>
    <article-id pub-id-type="coden">JACGAR</article-id>
    <article-id pub-id-type="pii">S1600576715009607</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Computer Programs</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><italic>BINoculars</italic>: data reduction and analysis software for two-dimensional detectors in surface X-ray diffraction</article-title>
      <alt-title>
        <italic>BINoculars</italic>
      </alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Roobol</surname>
          <given-names>Sander</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="corresp" rid="cor">*</xref>
        <xref ref-type="author-notes" rid="aunote1">‡</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Onderwaater</surname>
          <given-names>Willem</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Drnec</surname>
          <given-names>Jakub</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Felici</surname>
          <given-names>Roberto</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Frenken</surname>
          <given-names>Joost</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="author-notes" rid="aunote2">§</xref>
      </contrib>
      <aff id="a"><label>a</label>Huygens-Kamerlingh Onnes Laboratory, Leiden University, PO Box 9504, 2300 RA Leiden, <country>The Netherlands</country></aff>
      <aff id="b"><label>b</label>ESRF, 71 avenue des Martyrs, 38000 Grenoble, <country>France</country></aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor">Correspondence e-mail: <email>binoculars@uithetblauw.nl</email></corresp>
      <fn id="aunote1" fn-type="current-aff">
        <label>‡</label>
        <p>Present address: ASML Netherlands B.V., De Run 6501, 5504 DR, Veldhoven, The Netherlands.</p>
      </fn>
      <fn id="aunote2" fn-type="current-aff">
        <label>§</label>
        <p>Present address: Advanced Research Center for Nanolithography, PO Box 41883, 1009 DB Amsterdam, The Netherlands.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <day>01</day>
      <month>8</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>6</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>6</month>
      <year>2015</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>48</volume>
    <issue>Pt 4</issue>
    <issue-id pub-id-type="publisher-id">j150400</issue-id>
    <fpage>1324</fpage>
    <lpage>1329</lpage>
    <history>
      <date date-type="received">
        <day>26</day>
        <month>12</month>
        <year>2014</year>
      </date>
      <date date-type="accepted">
        <day>19</day>
        <month>5</month>
        <year>2015</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© Sander Roobol et al. 2015</copyright-statement>
      <copyright-year>2015</copyright-year>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0/uk/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution Licence, which permits
unrestricted use, distribution, and reproduction in any medium, provided the original authors and source are cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:type="simple" xlink:href="http://dx.doi.org/10.1107/S1600576715009607">A full version of this article is available from Crystallography Journals Online.</self-uri>
    <abstract abstract-type="toc">
      <p><italic>BINoculars</italic> is a tool for data reduction and analysis of large sets of surface diffraction data that have been acquired with a two-dimensional X-ray detector.</p>
    </abstract>
    <abstract>
      <p><italic>BINoculars</italic> is a tool for data reduction and analysis of large sets of surface diffraction data that have been acquired with a two-dimensional X-ray detector. The intensity of each pixel of a two-dimensional detector is projected onto a three-dimensional grid in reciprocal-lattice coordinates using a binning algorithm. This allows for fast acquisition and processing of high-resolution data sets and results in a significant reduction of the size of the data set. The subsequent analysis then proceeds in reciprocal space. It has evolved from the specific needs of the ID03 beamline at the ESRF, but it has a modular design and can be easily adjusted and extended to work with data from other beamlines or from other measurement techniques. This paper covers the design and the underlying methods employed in this software package and explains how <italic>BINoculars</italic> can be used to improve the workflow of surface X-ray diffraction measurements and analysis.</p>
    </abstract>
    <kwd-group>
      <kwd>data analysis</kwd>
      <kwd>data reduction</kwd>
      <kwd>reciprocal-space mapping</kwd>
      <kwd>X-ray diffraction</kwd>
    </kwd-group>
  </article-meta>
</front>
<body>
  <sec id="sec1">
    <label>1.</label>
    <title>Introduction   </title>
    <p>Over the past decade there have been several developments that have radically changed data acquisition in X-ray diffraction experiments. The primary development is that nearly all point detectors have been replaced by two-dimensional detectors, such as the MAXIPIX detector (Ponchut <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb16"> ▸</xref>), that collect spatially resolved information from a region in reciprocal space in a single shot. Secondly, by synchronizing the data acquisition with the actuation of the diffractometer motors, it is now possible to perform continuous scans during diffractometer movements. Even though this was demonstrated 50 years ago (Arndt &amp; Phillips, 1961<xref ref-type="bibr" rid="bb2"> ▸</xref>), it has only recently become routine practice (Shayduk &amp; Braun, 2008<xref ref-type="bibr" rid="bb20"> ▸</xref>). Thirdly, the high photon flux at third-generation synchrotrons (Winick, 1998<xref ref-type="bibr" rid="bb24"> ▸</xref>) allows integration times of the order of tens of milliseconds rather than seconds, thus enabling time-dependent observations of dynamic processes rather than the slow acquisition of static information.</p>
    <p>The result of these developments is that the data acquisition rate has increased by six to seven orders of magnitude, from typically 1 point per second to millions of points per second, and so the amount of data collected during one experiment has increased dramatically. Today’s computer hardware can keep up with that increased demand, but the development of software to analyse these large data sets has been lagging behind, which has kept most users from exploiting the full potential of modern surface diffraction beamlines. <italic>BINoculars</italic> aims to fill this gap by taking a novel approach to data reduction in surface X-ray diffraction (SXRD) experiments.</p>
    <p>Currently, data reduction is typically performed by integrating a region of the image from a two-dimensional detector, sometimes coupled with another integration to determine the background level. Compared to a traditional point detector, this is already a step forward because a single image contains information about the signal and the background. The sample does not need to be rocked in order to determine the background signal, as in the case of a point detector, which speeds up the acquisition. The other advantages are mostly qualitative: the large acceptance angle of the detector, in combination with its good angular resolution, is very convenient during diffractometer and sample alignment, and makes it possible to visually identify peaks by their shape (<italic>i.e.</italic> one can easily distinguish between a powder ring, a crystal truncation rod or a region of diffuse background). <italic>BINoculars</italic> improves on this, and takes full advantage of a two-dimensional detector, by treating every pixel individually.</p>
    <p><italic>BINoculars</italic> takes a series of images from a two-dimensional detector, calculates for each pixel the corresponding reciprocal-lattice coordinates <inline-formula><inline-graphic xlink:href="j-48-01324-efi1.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, and reduces the image collection to a single data set by averaging the intensities of pixels taken at identical <inline-formula><inline-graphic xlink:href="j-48-01324-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> positions (within a user-specified resolution). This transformation and averaging are illustrated in Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref>. To allow online analysis during data acquisition, <italic>BINoculars</italic> can run on a high-performance cluster to process large data sets. For example, the result of a full hour of continuous scanning, adding up to a total of approximately <inline-formula><inline-graphic xlink:href="j-48-01324-efi3.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> pixels, can be processed in a matter of minutes. In addition, <italic>BINoculars</italic> provides tools to further process the data, including visualization, curve fitting and crystal truncation rod integration. The latter can be seen as an implementation of the reciprocal-space integration method, recently described by Drnec <italic>et al.</italic> (2014<xref ref-type="bibr" rid="bb5"> ▸</xref>). As a whole, <italic>BINoculars</italic> can be seen as an <italic>N</italic>-dimensional generalization of <italic>PyFAI</italic> (Kieffer &amp; Karkoulis, 2013<xref ref-type="bibr" rid="bb10"> ▸</xref>), <italic>xrayutilities</italic> (Kriegner <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb11"> ▸</xref>) and <italic>FEP3D</italic> (Gaudet <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb7"> ▸</xref>), optimized for (but not limited to) surface X-ray diffraction.</p>
  </sec>
  <sec id="sec2">
    <label>2.</label>
    <title>Implementation   </title>
    <p><italic>BINoculars</italic> has been written in Python, an open-source scripting language that is very suitable for scientific software, thanks to its powerful and clear syntax and the extensive support for numerical calculations <italic>via</italic> the <italic>NumPy</italic> and <italic>SciPy</italic> libraries (Perez <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb14"> ▸</xref>).</p>
    <p><italic>BINoculars</italic> has been designed to process large data sets and its operation is usually CPU bound. An ordinary desktop computer can easily take many hours to deal with a data set obtained in 1 h (<italic>e.g.</italic> <inline-formula><inline-graphic xlink:href="j-48-01324-efi3.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> pixels with 16 bit per pixel). To allow online analysis during data acquisition at a beamline, <italic>BINoculars</italic> can use a computing cluster to distribute the load over multiple computers.</p>
    <p>To keep <italic>BINoculars</italic> modular and flexible, the workflow for processing data is separated into four modules: the <italic>dispatcher</italic> is in charge of the whole process and handles job parallelization and distribution, the <italic>input</italic> class gathers the experimental data, and the <italic>projection</italic> class converts the raw data into the coordinates of choice. Finally, the processed data are binned on a discrete grid and stored in a <italic>space</italic> class, which provides generic tools for further analysis. The specific behaviour of the <italic>dispatcher</italic>, <italic>input</italic> and <italic>projection</italic> modules can be changed independently. For these modules, the user can choose from several different implementations, each having a different set of features. This process is illustrated in Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>.</p>
    <p>The <italic>input</italic> class collects the raw two-dimensional detector images and assigns metadata to each individual pixel. These metadata are used later on by the <italic>projection</italic> class to make the conversion to the desired coordinate system [<italic>e.g.</italic> <inline-formula><inline-graphic xlink:href="j-48-01324-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> for a typical SXRD experiment]. The <italic>input</italic> class is specific to a certain experimental setup. As an example, for the ID03 beamline at the ESRF (Balmes <italic>et al.</italic>, 2009<xref ref-type="bibr" rid="bb3"> ▸</xref>), a separate class has been written for each of the experimental hutches. In many ways the two experimental hutches are identical, for example the same numbering scheme is used for the images taken by the X-ray cameras, but one of the diffractometers operates at a constant detector–sample distance while the other does not. The <italic>input</italic> class takes care of all these technicalities, and writing a new <italic>input</italic> is the most important task when adding support for another experimental setup. In addition, the work done by the <italic>input</italic> class is often the most computationally intensive step in the entire process of <italic>BINoculars</italic>. Although it is likely that a significant performance gain can be obtained by implementing this part of the code in C rather than Python, the code is intimately related to the continuously evolving experimental practices of the beamline, and as such a high-level language is a better choice.</p>
    <p>The next step is performed by the <italic>projection</italic> class, which converts the data collected by an <italic>input</italic> class into the appropriate coordinate system for binning. For an SXRD experiment, the <italic>input</italic> class will typically return a series of detector images with corresponding diffractometer angles for each pixel, and the <italic>projection</italic> class will convert the angles into reciprocal-space coordinates <inline-formula><inline-graphic xlink:href="j-48-01324-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> for each image. In some cases, there are several projections that are useful. For example, for the ID03 beamline it is sometimes necessary to project onto the scattering angle <inline-formula><inline-graphic xlink:href="j-48-01324-efi7.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> rather than <inline-formula><inline-graphic xlink:href="j-48-01324-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> coordinates [although an alternative route would be to perform a coordinate transformation afterwards to convert the <inline-formula><inline-graphic xlink:href="j-48-01324-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>
<italic>space</italic> into a <inline-formula><inline-graphic xlink:href="j-48-01324-efi7.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>
<italic>space</italic>].</p>
    <p>Once the data have been gathered and projected on the desired coordinate system, the binning operation is performed by a class called <italic>space</italic>. This class represents an <italic>n</italic>-dimensional regular grid: it is a discrete subset of a vector space, where each dimension has a fixed step size. Many mathematical operations can be performed with <italic>spaces</italic>, including addition, subtraction, slicing, projections and coordinate transformations. To bin an image, the <inline-formula><inline-graphic xlink:href="j-48-01324-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> coordinates of each pixel of the image are mapped onto the nearest discrete <italic>space</italic> grid location. Then the pixel intensities are accumulated at every discrete grid location, using the histogram operation <italic>bincount</italic> from <italic>NumPy</italic>. In addition, the number of contributions per coordinate is stored in order to calculate the mean intensity per bin rather than the integrated intensity. This binning operation is the essential data reduction step performed by <italic>BINoculars</italic>: hence the name of the program.</p>
    <p>The <italic>dispatcher</italic> orchestrates the entire process: it asks <italic>input</italic> for the sequence of images from the two-dimensional detector, delegates it to the appropriate <italic>projection</italic> and performs the binning operation by feeding the projection result into a <italic>space</italic>. Two <italic>dispatcher</italic> implementations are currently present: one for local processing using multiple processor cores on a single computer, and one that distributes tasks over a high-performance cluster managed using OAR (<ext-link ext-link-type="uri" xlink:href="https://oar.imag.fr/">https://oar.imag.fr/</ext-link>). Support for other types of clusters can easily be added. When running on a computing cluster, the <italic>dispatcher</italic> gathers all intermediate spaces calculated by the individual nodes (for example using a shared filesystem) and they are added together to form the final resulting <italic>space. Spaces</italic> are stored on disk using the HDF5 file format (Folk <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb6"> ▸</xref>).</p>
    <p>After a <italic>space</italic> has been created, the size of the data set has typically been reduced by a factor 10 to 100, and further analysis can usually be performed on a standard workstation. However, loading a high-resolution large-area three-dimensional data set can require several GB of memory, and for some operations it is required to have several copies in memory. If this is a problem, it is also possible to work with a subset of the data, either by selecting a smaller region or by reducing the resolution or by reducing the dimensionality.</p>
    <p><italic>BINoculars</italic> provides various tools for analysis, including mathematical operations, plotting and exporting. For ultimate flexibility it is possible to directly manipulate a <italic>BINoculars</italic> space from a Python script, but in many cases the standard tools are sufficient. In addition, a fitting and integration tool is available to calculate the structure factors of a crystal truncation rod to be directly inserted into the fitting program <italic>ROD</italic> (Vlieg, 2000<xref ref-type="bibr" rid="bb23"> ▸</xref>). It takes as input a reciprocal mesh which it slices by a user-specified resolution and the resulting data are either fitted (typically with a two-dimensional Lorentzian) using a least-squares optimization or simply integrated. The error is estimated from equation (2)<xref ref-type="disp-formula" rid="fd2"/>, as will be described in more detail in the next section.</p>
  </sec>
  <sec id="sec3">
    <label>3.</label>
    <title>Binning and error handling   </title>
    <p><italic>BINoculars</italic> calculates the average intensity of multiple contributions, originating from different pixels and/or detector positions, to a single reciprocal-space bin. This operation is similar but not identical to averaging a series of repeated measurements taken by a point detector at a fixed position. This section discusses the implications of the binning operation for the background intensity and the estimation of statistical errors.</p>
    <p>When using a point detector, the typical surface diffraction experiment is set up such that there is a unique detector position for each set of reciprocal-space coordinates <inline-formula><inline-graphic xlink:href="j-48-01324-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>. In practice, this means reducing the degrees of freedom of the diffractometer to three, <italic>e.g.</italic> by working with a constant surface normal and a fixed angle of incidence. When taking series of repeated observations at a certain reciprocal-space location, the systematic error in each measurement can be assumed to be constant (after the usual correction for variations in the total beam intensity), and the only variation is given by the shot noise of the incoming photons.</p>
    <p>Using a two-dimensional detector, the spatial extent of the detector introduces two more degrees of freedom, meaning there is no longer a unique detector position for a given reciprocal-space coordinate. This is usually solved by selecting one pixel of the detector to correspond with ‘the detector position’, and ignoring the fact that the other pixels are at a slightly different position. However, <italic>BINoculars</italic> does take the spatial extent of the detector into account, and calculates the average intensity at each location in reciprocal space, regardless of the detector position.</p>
    <p>This means that multiple measurements, even when spaced closely together in time, exhibit variations not only due to the statistical nature of the process but also due to a systematic error, possibly resulting from different detector positions. This error is caused by differences in background originating from scatterers other than the sample, as is illustrated in Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref>. Flight tubes and slits between the sample and the detector can be used to reduce this background, but they also decrease the aperture of the two-dimensional detector. This reduces the range of <inline-formula><inline-graphic xlink:href="j-48-01324-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> locations over which data can be collected in one acquisition. This means that a careful trade-off needs to be made between acquisition speed and background suppression.</p>
    <p>In some cases it is possible to subtract the background <inline-formula><inline-graphic xlink:href="j-48-01324-efi14.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, either by measuring it directly when the sample is not in the beam or by estimating it from the data set itself in regions in reciprocal space where the sample only weakly contributes to the total observed intensity. The latter approach will be explored in more detail in §4<xref ref-type="sec" rid="sec4"/>.</p>
    <p>The remaining error reflects the counting statistics in the number of detected photons and is typically assumed to obey Poisson statistics (Robinson, 1991<xref ref-type="bibr" rid="bb18"> ▸</xref>). For a single observation of <italic>I</italic> counts, the standard deviation σ is estimated using <inline-formula><inline-graphic xlink:href="j-48-01324-efi15.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>. With <italic>N</italic> independent observations <inline-formula><inline-graphic xlink:href="j-48-01324-efi16.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> in a single bin, each with its own <inline-formula><inline-graphic xlink:href="j-48-01324-efi17.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, the average intensity is<disp-formula id="fd1"><graphic xlink:href="j-48-01324-efd1.jpg" mimetype="image" mime-subtype="gif" position="float"/></disp-formula>and the variance can be estimated under the assumption of normality (<italic>N</italic> or <inline-formula><inline-graphic xlink:href="j-48-01324-efi16.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> sufficiently large) using <disp-formula id="fd2"><graphic xlink:href="j-48-01324-efd2.jpg" mimetype="image" mime-subtype="gif" position="float"/></disp-formula>Assuming we have a separate estimate of the background intensity <inline-formula><inline-graphic xlink:href="j-48-01324-efi14.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> in this bin with a corresponding variance <inline-formula><inline-graphic xlink:href="j-48-01324-efi20.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, the variance <inline-formula><inline-graphic xlink:href="j-48-01324-efi21.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> of the signal <inline-formula><inline-graphic xlink:href="j-48-01324-efi22.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> is now given by <disp-formula id="fd3"><graphic xlink:href="j-48-01324-efd3.jpg" mimetype="image" mime-subtype="gif" position="float"/></disp-formula>Of course, if the background was also obtained by averaging <italic>N</italic> measurements, <inline-formula><inline-graphic xlink:href="j-48-01324-efi20.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> would also take the form <inline-formula><inline-graphic xlink:href="j-48-01324-efi24.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
  </sec>
  <sec id="sec4">
    <label>4.</label>
    <title>Demonstration   </title>
    <p>Four different examples will be discussed to show the capabilities and limitations of <italic>BINoculars</italic>.</p>
    <p>Fig. 4<xref ref-type="fig" rid="fig4"> ▸</xref> shows a high-resolution (0.0002 reciprocal-lattice units or r.l.u.’s), large-area <inline-formula><inline-graphic xlink:href="j-48-01324-efi25.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> surface in reciprocal space, covering the first reciprocal unit cell of an Au(111) surface, submerged in an electrochemical cell filled with sulfate-containing electrolyte (pH 7) and kept at −800 mV <italic>versus</italic> Ag/AgCl reference electrode. The gold surface exhibited the so-called herringbone reconstruction (Barth <italic>et al.</italic>, 1990<xref ref-type="bibr" rid="bb4"> ▸</xref>), which is a regular structure with a (<inline-formula><inline-graphic xlink:href="j-48-01324-efi26.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>) periodicity that is organized into a zigzag pattern on an even larger scale. The <inline-formula><inline-graphic xlink:href="j-48-01324-efi27.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> superstructure peaks originating from this reconstruction (Steadman <italic>et al.</italic>, 2000<xref ref-type="bibr" rid="bb21"> ▸</xref>; Peters <italic>et al.</italic>, 2000<xref ref-type="bibr" rid="bb15"> ▸</xref>) are well resolved in the scan. The differences between this diffraction pattern and the pattern reported in the literature for the same surface in ultra-high vacuum are not fully understood; however, they are likely to be due to the sample preparation procedure in the electrochemical cell. The data set was acquired in just 111 min.</p>
    <p>Fig. 5<xref ref-type="fig" rid="fig5"> ▸</xref> shows a data set that is strongly affected by background intensity. Like Fig. 4<xref ref-type="fig" rid="fig4"> ▸</xref>, the data set is built up from a series of ω scans, and in this case those scans are clearly visible as arcs after processing by <italic>BINoculars</italic>. The problem is that the background intensity depends not only on the position of a pixel but also on the position of the camera. In other words, when moving the camera by only a small amount, such that a certain feature remains in the field of view (in this case a move in γ between the consecutive ω arcs), the contribution of the background intensity to that feature can change significantly, as illustrated in Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref>.</p>
    <p>This particular data set has been obtained using the high-pressure flow reactor setup at ID03 (van Rijn <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb17"> ▸</xref>), which has a beryllium dome around the sample. The dome acts as a strong X-ray scatterer only 14 mm away from the sample. It is not possible to lower the resulting background intensity using slits without dramatically reducing the aperture of the detector. However, for this sample it proved possible to estimate and subtract the background level, the result of which is shown in the middle panel of Fig. 5<xref ref-type="fig" rid="fig5"> ▸</xref>. For each pixel of the detector, the background was estimated as the average intensity of that pixel in all images in a single ω scan. The average is calculated by fitting a Poisson distribution, as this turned out to give better rejection of outliers (which are in fact the diffraction peaks) than a simple mean or median calculation. This process was then repeated for each ω scan, resulting in an estimate of the background intensity that was subtracted from the raw data.</p>
    <p>The background subtraction procedure described here is not generally applicable as powder rings are treated as background. In addition, the amount of background is strongly dependent on the experimental setup, and the other data sets shown here did not need any background correction. Therefore this procedure is currently not part of <italic>BINoculars</italic>, although it is likely to become part of the ID03-specific <italic>input</italic> module in the near future.</p>
    <p>The third example, Fig. 6<xref ref-type="fig" rid="fig6"> ▸</xref>, shows the output of the crystal truncation rod (CTR) fitting module. The original data set is a single <italic>l</italic> scan along the CTR. After processing by <italic>BINoculars</italic>, during which the <italic>input</italic> module also takes care of the polarization correction factor necessary to obtain the structure factors (Vlieg, 1997<xref ref-type="bibr" rid="bb22"> ▸</xref>), the three-dimensional rod can be visualized in reciprocal space. The data set is then segmented into small intervals along <italic>l</italic>. Each section is analysed separately by a numerical integration algorithm to calculate the structure factors as a function of <italic>l</italic>. This method has recently been described by Drnec <italic>et al.</italic> (2014<xref ref-type="bibr" rid="bb5"> ▸</xref>).</p>
    <p>At lower <italic>l</italic> the detector is more perpendicular to the surface, and for some samples it might be useful to augment the <italic>l</italic> scan with rocking scans at low <italic>l</italic>. <italic>BINoculars</italic> can easily deal with such a hybrid data set, since it starts by processing the data into the three-dimensional rod, after which the integration procedure (taking place in reciprocal space) is performed completely independently of the original character of the raw data.</p>
    <p>The fourth example demonstrates that <italic>BINoculars</italic> can be used with other coordinate systems than <inline-formula><inline-graphic xlink:href="j-48-01324-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>. Fig. 7<xref ref-type="fig" rid="fig7"> ▸</xref> shows the reflected intensity from a (PbSe)<sub>4+δ</sub>(TiSe<sub>2</sub>)<sub>4</sub> sample. It is constructed from images taken at different incidence angles that are projected onto <inline-formula><inline-graphic xlink:href="j-48-01324-efi29.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="j-48-01324-efi30.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, the in-plane and out-of-plane momentum transfer. This two-dimensional projection allows detailed analysis of the in-plane X-ray scattering that cannot easily be obtained by conventional methods. In addition, the integration to obtain the specular rod (<inline-formula><inline-graphic xlink:href="j-48-01324-efi31.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>) can be easily performed.</p>
  </sec>
  <sec id="sec5">
    <label>5.</label>
    <title>Conclusion   </title>
    <p><italic>BINoculars</italic> unlocks the full power of two-dimensional detectors and helps visualize surface diffraction patterns to an extent that was previously only achievable with low-energy electron diffraction in ultra-high vacuum conditions, or by increasing the X-ray energy and sacrificing <italic>k</italic>-space resolution and dynamic range (Gustafson <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb9"> ▸</xref>), or by taking an impractical amount of time. In addition, <italic>BINoculars</italic> simplifies structure determination by providing a quick, easy and accurate method to integrate crystal truncation rods.</p>
    <p><italic>BINoculars</italic> is open source under the terms of the GNU General Public Licence (<ext-link ext-link-type="uri" xlink:href="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</ext-link>) and is available online (<ext-link ext-link-type="uri" xlink:href="http://binoculars.uithetblauw.nl/">http://binoculars.uithetblauw.nl/</ext-link>; <ext-link ext-link-type="uri" xlink:href="https://github.com/id03/binoculars">https://github.com/id03/binoculars</ext-link>).</p>
  </sec>
</body>
<back>
  <ack>
    <p>This project has been financially supported by a Dutch SmartMix grant and the NIMIC partner organizations through NIMIC, a public–private partnership. The authors thank Marco Salluzzo for providing the SrTiO<sub>3</sub> sample data set and Sabrina Disch for the (PbSe)<sub>4+δ</sub>(TiSe<sub>2</sub>)<sub>4</sub> data set.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="bb2">
      <mixed-citation publication-type="other">Arndt, U. W. &amp; Phillips, D. C. (1961). <italic>Acta Cryst.</italic>
<bold>14</bold>, 807–818.</mixed-citation>
    </ref>
    <ref id="bb3">
      <mixed-citation publication-type="other">Balmes, O., van Rijn, R., Wermeille, D., Resta, A., Petit, L., Isern, H., Dufrane, T. &amp; Felici, R. (2009). <italic>Catal. Today</italic>, <bold>145</bold>, 220–226.</mixed-citation>
    </ref>
    <ref id="bb4">
      <mixed-citation publication-type="other">Barth, J. V., Brune, H., Ertl, G. &amp; Behm, R. J. (1990). <italic>Phys. Rev. B</italic>, <bold>42</bold>, 9307–9318.</mixed-citation>
    </ref>
    <ref id="bb5">
      <mixed-citation publication-type="other">Drnec, J., Zhou, T., Pintea, S., Onderwaater, W., Vlieg, E., Renaud, G. &amp; Felici, R. (2014). <italic>J. Appl. Cryst.</italic>
<bold>47</bold>, 365–377.</mixed-citation>
    </ref>
    <ref id="bb6">
      <mixed-citation publication-type="other">Folk, M., Heber, G., Koziol, Q., Pourmal, E. &amp; Robinson, D. (2011). <italic>Proceedings of the EDBT/ICDT 2011 Joint Conference, Workshop on Array Databases</italic>, Uppsala, Sweden, p. 36.</mixed-citation>
    </ref>
    <ref id="bb7">
      <mixed-citation publication-type="other">Gaudet, S., De Keyser, K., Lambert-Milot, S., Jordan-Sweet, J., Detavernier, C., Lavoie, C. &amp; Desjardins, P. (2013). <italic>J. Vac. Sci. Technol. A</italic>, <bold>31</bold>, 021505.</mixed-citation>
    </ref>
    <ref id="bb9">
      <mixed-citation publication-type="other">Gustafson, J., Shipilin, M., Zhang, C., Stierle, A., Hejral, U., Ruett, U., Gutowski, O., Carlsson, P. A., Skoglundh, M. &amp; Lundgren, E. (2014). <italic>Science</italic>, <bold>343</bold>, 758–761.</mixed-citation>
    </ref>
    <ref id="bb10">
      <mixed-citation publication-type="other">Kieffer, J. &amp; Karkoulis, D. (2013). <italic>J. Phys. Conf. Ser.</italic>
<bold>425</bold>, 202012.</mixed-citation>
    </ref>
    <ref id="bb11">
      <mixed-citation publication-type="other">Kriegner, D., Wintersberger, E. &amp; Stangl, J. (2013). <italic>J. Appl. Cryst.</italic>
<bold>46</bold>, 1162–1170.</mixed-citation>
    </ref>
    <ref id="bb12">
      <mixed-citation publication-type="other">Moore, D. B., Beekman, M., Disch, S. &amp; Johnson, D. C. (2014). <italic>Angew. Chem. Int. Ed.</italic>
<bold>53</bold>, 5672–5675.</mixed-citation>
    </ref>
    <ref id="bb14">
      <mixed-citation publication-type="other">Perez, F., Granger, B. E. &amp; Hunter, J. D. (2011). <italic>Comput. Sci. Eng.</italic>
<bold>13</bold>, 13–21.</mixed-citation>
    </ref>
    <ref id="bb15">
      <mixed-citation publication-type="other">Peters, K. F., Steadman, P., Isern, H., Alvarez, J. &amp; Ferrer, S. (2000). <italic>Surf. Sci.</italic>
<bold>467</bold>, 10–22.</mixed-citation>
    </ref>
    <ref id="bb16">
      <mixed-citation publication-type="other">Ponchut, C., Rigal, J. M., Clément, J., Papillon, E., Homs, A. &amp; Petitdemange, S. (2011). <italic>J. Instrum.</italic>
<bold>6</bold>, C01069.</mixed-citation>
    </ref>
    <ref id="bb17">
      <mixed-citation publication-type="other">Rijn, R. van, Ackermann, M., Balmes, O., Dufrane, T., Geluk, A., Gonzalez, H., Isern, H., de Kuyper, E., Petit, L., Sole, V. A., Wermeille, D., Felici, R. &amp; Frenken, J. W. M. (2010). <italic>Rev. Sci. Instrum.</italic>
<bold>81</bold>, 014101.</mixed-citation>
    </ref>
    <ref id="bb18">
      <mixed-citation publication-type="other">Robinson, I. (1991). <italic>Handbook on Synchrotron Radiation</italic>, Vol. III. Amsterdam: North Holland</mixed-citation>
    </ref>
    <ref id="bb19">
      <mixed-citation publication-type="other">Salluzzo, M., Gariglio, S., Torrelles, X., Ristic, Z., Di Capua, R., Drnec, J., Sala, M. M., Ghiringhelli, G., Felici, R. &amp; Brookes, N. B. (2013). <italic>Adv. Mater.</italic>
<bold>25</bold>, 2333–2338.</mixed-citation>
    </ref>
    <ref id="bb20">
      <mixed-citation publication-type="other">Shayduk, R. &amp; Braun, W. (2008). <italic>J. Appl. Cryst.</italic>
<bold>41</bold>, 768–775.</mixed-citation>
    </ref>
    <ref id="bb21">
      <mixed-citation publication-type="other">Steadman, P., Peters, K., Isern, H., Alvarez, J. &amp; Ferrer, S. (2000). <italic>Phys. Rev. B</italic>, <bold>62</bold>, R2295–R2298.</mixed-citation>
    </ref>
    <ref id="bb22">
      <mixed-citation publication-type="other">Vlieg, E. (1997). <italic>J. Appl. Cryst.</italic>
<bold>30</bold>, 532–543.</mixed-citation>
    </ref>
    <ref id="bb23">
      <mixed-citation publication-type="other">Vlieg, E. (2000). <italic>J. Appl. Cryst.</italic>
<bold>33</bold>, 401–405.</mixed-citation>
    </ref>
    <ref id="bb24">
      <mixed-citation publication-type="other">Winick, H. (1998). <italic>J. Synchrotron Rad.</italic>
<bold>5</bold>, 168–175.</mixed-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="fig1" position="float">
    <label>Figure 1</label>
    <caption>
      <p>A graphical overview of the process performed by <italic>BINoculars</italic>. The data displayed here are a rocking scan through <inline-formula><inline-graphic xlink:href="j-48-01324-efi32.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, the diffraction pattern from a Pt(110) surface. Upper panel, raw data acquired by the two-dimensional detector with the corresponding angles ω, δ, γ from a six-circle diffractometer (Vlieg, 1997<xref ref-type="bibr" rid="bb22"> ▸</xref>). Middle panel, the diffractometer angles are mapped onto reciprocal-space coordinates <inline-formula><inline-graphic xlink:href="j-48-01324-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>. Lower panel, the averaged intensity of pixels on a regular grid of volumetric bins (voxels) is calculated. Part of the bins are removed for clarity. Note that the data in reciprocal space in the lower panel are constructed from a series of images over a larger range and with a denser sampling in ω than shown in the other panels.</p>
    </caption>
    <graphic xlink:href="j-48-01324-fig1"/>
  </fig>
  <fig id="fig2" position="float">
    <label>Figure 2</label>
    <caption>
      <p>Block diagram of the process performed by <italic>BINoculars</italic> for a typical data set from a diffraction experiment. The <italic>dispatcher</italic> distributes the load over multiple nodes from a computing cluster. The <italic>input</italic> class gathers the experimental data and calculates the diffractometer angles for each pixel. The <italic>projection</italic> class converts the angles to <inline-formula><inline-graphic xlink:href="j-48-01324-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> coordinates. The intensities are binned on a discrete grid by the <italic>space</italic> class, and finally the intermediate results from each node are combined into a single <italic>space</italic>.</p>
    </caption>
    <graphic xlink:href="j-48-01324-fig2"/>
  </fig>
  <fig id="fig3" position="float">
    <label>Figure 3</label>
    <caption>
      <p>The wide opening angle of the slits, which is required to capture a region in reciprocal space with a two-dimensional detector, results in a non-uniform background across the detector (indicated in grey in the figure). This background originates from scatterers other than the sample, for example a beryllium window. This means that when taking two images at slightly different detector positions, such that there is some overlap between the two captured regions, the background intensity in the overlapping region is not constant.</p>
    </caption>
    <graphic xlink:href="j-48-01324-fig3"/>
  </fig>
  <fig id="fig4" position="float">
    <label>Figure 4</label>
    <caption>
      <p>A large-area survey (upper panel) in reciprocal space of the herringbone reconstructed Au(111) surface, taken at <inline-formula><inline-graphic xlink:href="j-48-01324-efi35.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>. The data set has been obtained in 111 min using a series of continuous-acquisition ω scans. A zoom-in (lower panel) around the <inline-formula><inline-graphic xlink:href="j-48-01324-efi36.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> crystal truncation rod (indicated by the circle in the inset) shows the satellite peaks caused by the <inline-formula><inline-graphic xlink:href="j-48-01324-efi37.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> unit cell (indicated by triangles) and those originating from the longer range ordering of the zigzag domains (indicated by crosses). Loading this data set requires 1 GB of memory.</p>
    </caption>
    <graphic xlink:href="j-48-01324-fig4"/>
  </fig>
  <fig id="fig5" position="float">
    <label>Figure 5</label>
    <caption>
      <p>Some data sets require further processing to remove the curved background artefacts. This figure shows the <inline-formula><inline-graphic xlink:href="j-48-01324-efi38.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> plane from a Pt(110) sample in the high-pressure flow reactor setup at ID03. The surface exhibited a <inline-formula><inline-graphic xlink:href="j-48-01324-efi39.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> reconstruction (which has not been described before in the literature) during high-temperature high-pressure exposure to NO and H<sub>2</sub>. The setup had a relatively high diffuse background that could be corrected for by estimating the background level for each pixel of the detector, once per scan in ω. The left panel shows the raw data, the middle panel the data after background correction. The right panel shows the intensity profiles along the line <inline-formula><inline-graphic xlink:href="j-48-01324-efi40.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> for a direct comparison between raw and corrected data. The small peaks at <inline-formula><inline-graphic xlink:href="j-48-01324-efi41.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> originate from scattering from the Be dome; this is also visible in the left and middle panel as a diagonal line.</p>
    </caption>
    <graphic xlink:href="j-48-01324-fig5"/>
  </fig>
  <fig id="fig6" position="float">
    <label>Figure 6</label>
    <caption>
      <p>The left panel shows an <italic>l</italic> scan along the <inline-formula><inline-graphic xlink:href="j-48-01324-efi42.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> crystal truncation rod of a SrTiO<sub>3</sub> (100) surface (Salluzzo <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb19"> ▸</xref>) projected on the <italic>kl</italic> plane after processing by <italic>BINoculars</italic>. A series of two-dimensional Lorentzians has been fitted to slices at constant <italic>l</italic> (corresponding to small <italic>hk</italic> surfaces), which has resulted in the structure factors shown in the right panel.</p>
    </caption>
    <graphic xlink:href="j-48-01324-fig6"/>
  </fig>
  <fig id="fig7" position="float">
    <label>Figure 7</label>
    <caption>
      <p>Reflectivity scan of (PbSe)<sub>4+δ</sub>(TiSe<sub>2</sub>)<sub>4</sub>, a telluride misfit layer compound (Moore <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb12"> ▸</xref>). This sample has a multilayer structure with well defined out-of-plane stacking but rotational disorder between layers. This gives rise to oscillations in the reflectivity curve, combined with broad in-plane scattering. The left panel shows the projection of the images taken at different incident angles onto <inline-formula><inline-graphic xlink:href="j-48-01324-efi29.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="j-48-01324-efi30.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>. The right panel shows the specular rod obtained by integration along <inline-formula><inline-graphic xlink:href="j-48-01324-efi29.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> from −0.005 to 0.005 Å<sup>−1</sup>.</p>
    </caption>
    <graphic xlink:href="j-48-01324-fig7"/>
  </fig>
</floats-group>
