<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6034344</article-id>
    <article-id pub-id-type="publisher-id">2262</article-id>
    <article-id pub-id-type="doi">10.1186/s12859-018-2262-7</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methodology Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>BARCOSEL: a tool for selecting an optimal barcode set for high-throughput sequencing</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-3121-4047</contrib-id>
        <name>
          <surname>Somervuo</surname>
          <given-names>Panu</given-names>
        </name>
        <address>
          <email>panu.somervuo@helsinki.fi</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Koskinen</surname>
          <given-names>Patrik</given-names>
        </name>
        <address>
          <email>j.patrik.koskinen@gmail.com</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Mei</surname>
          <given-names>Peng</given-names>
        </name>
        <address>
          <email>tfmei@hotmail.com</email>
        </address>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Holm</surname>
          <given-names>Liisa</given-names>
        </name>
        <address>
          <email>liisa.holm@helsinki.fi</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Auvinen</surname>
          <given-names>Petri</given-names>
        </name>
        <address>
          <email>petri.auvinen@helsinki.fi</email>
        </address>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Paulin</surname>
          <given-names>Lars</given-names>
        </name>
        <address>
          <email>lars.paulin@helsinki.fi</email>
        </address>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label>Mathematical Biology Group, Department of Biosciences, FIN-00014 University of Helsinki, P.O.Box 65 Finland </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0410 2071</institution-id><institution-id institution-id-type="GRID">grid.7737.4</institution-id><institution>Holm Group, Institute of Biotechnology, </institution></institution-wrap>FIN-00014 University of Helsinki, P.O.Box 56 Finland </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0410 2071</institution-id><institution-id institution-id-type="GRID">grid.7737.4</institution-id><institution>DNA Sequencing and Genomics Laboratory, Institute of Biotechnology, </institution></institution-wrap>FIN-00014 University of Helsinki, P.O.Box 56 Finland </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>5</day>
      <month>7</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>5</day>
      <month>7</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2018</year>
    </pub-date>
    <volume>19</volume>
    <elocation-id>257</elocation-id>
    <history>
      <date date-type="received">
        <day>5</day>
        <month>1</month>
        <year>2018</year>
      </date>
      <date date-type="accepted">
        <day>25</day>
        <month>6</month>
        <year>2018</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2018</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold> This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver(<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p>Current high-throughput sequencing platforms provide capacity to sequence multiple samples in parallel. Different samples are labeled by attaching a short sample specific nucleotide sequence, barcode, to each DNA molecule prior pooling them into a mix containing a number of libraries to be sequenced simultaneously. After sequencing, the samples are binned by identifying the barcode sequence within each sequence read.</p>
        <p>In order to tolerate sequencing errors, barcodes should be sufficiently apart from each other in sequence space. An additional constraint due to both nucleotide usage and basecalling accuracy is that the proportion of different nucleotides should be in balance in each barcode position. The number of samples to be mixed in each sequencing run may vary and this introduces a problem how to select the best subset of available barcodes at sequencing core facility for each sequencing run. There are plenty of tools available for de novo barcode design, but they are not suitable for subset selection.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p>We have developed a tool which can be used for three different tasks: 1) selecting an optimal barcode set from a larger set of candidates, 2) checking the compatibility of user-defined set of barcodes, e.g. whether two or more libraries with existing barcodes can be combined in a single sequencing pool, and 3) augmenting an existing set of barcodes.</p>
        <p>In our approach the selection process is formulated as a minimization problem. We define the cost function and a set of constraints and use integer programming to solve the resulting combinatorial problem. Based on the desired number of barcodes to be selected and the set of candidate sequences given by user, the necessary constraints are automatically generated and the optimal solution can be found. The method is implemented in C programming language and web interface is available at <ext-link ext-link-type="uri" xlink:href="http://ekhidna2.biocenter.helsinki.fi/barcosel">http://ekhidna2.biocenter.helsinki.fi/barcosel</ext-link>.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p>Increasing capacity of sequencing platforms raises the challenge of mixing barcodes. Our method allows the user to select a given number of barcodes among the larger existing barcode set so that both sequencing errors are tolerated and the nucleotide balance is optimized. The tool is easy to access via web browser.</p>
      </sec>
      <sec>
        <title>Electronic supplementary material</title>
        <p>The online version of this article (10.1186/s12859-018-2262-7) contains supplementary material, which is available to authorized users.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Barcode</kwd>
      <kwd>DNA</kwd>
      <kwd>Integer programming</kwd>
      <kwd>Multiplexing</kwd>
      <kwd>Optimization</kwd>
      <kwd>Sequencing</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Biocenter Finland</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2018</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p>It is a common practice to pool several samples together in order to maximize the usage of the capacity of high-throughput sequencing platforms. For example, at the moment, a single lane of Illumina HiSeqX produces hundreds of millions reads per run and the new NovaSeq can produce billions of sequences per run. If application requires only few tens of millions of reads per sample, it would be waste of resources to allocate an entire lane for a single sample. Therefore, several sequencing libraries are pooled together and sequenced in parallel using the same lane in the sequencing apparatus. This introduces the problem how to separate different samples after sequencing. A standard solution is to use a short barcode sequence for labeling different samples. These barcode sequences are attached to the fragments during the library preparation. The two processes, mixing the samples and then separating them after sequencing are also called multiplexing and demultiplexing, respectively.</p>
    <p>In order to work properly, barcode sequences should be sufficiently different from each other. Redundancy in the barcode sequence provides the possibility for error correction. For example, in order to tolerate a single nucleotide mismatch in barcode detection, different barcode sequences should be at least three nucleotide mismatches apart from each other. More generally, in order to tolerate <italic>m</italic> mismatches, the distance between all barcode pairs should be at least 2<italic>m</italic>+1. Sequencing technology may give further restrictions for barcodes being optimal. For example, in Illumina sequencers, the nucleotides are detected using two lasers, red laser for A/C and green laser for G/T. For optimal detection, these two nucleotide groups should be in balance between all barcodes in each barcode position. Experiments show that reduced diversity in nucleotide composition results in data loss [<xref ref-type="bibr" rid="CR1">1</xref>]. Besides nucleotide diversity being important in cluster identification, obtaining a good nucleotide balance is important for successful basecalling to be performed.</p>
    <p>De novo barcode design, i.e. the process where the set of barcodes is constructed from scratch, is a solved problem and several tools are available for it, e.g. [<xref ref-type="bibr" rid="CR2">2</xref>–<xref ref-type="bibr" rid="CR4">4</xref>]. One of the first barcode designs was [<xref ref-type="bibr" rid="CR5">5</xref>], where Hamming distance was used to measure the dissimilarity between the barcodes. Hamming distance has also been used in [<xref ref-type="bibr" rid="CR6">6</xref>]. Taking into account insertions and deletions results in Levenshtein distance (also called edit distance), see e.g. [<xref ref-type="bibr" rid="CR7">7</xref>]. Sequence similarity, complexity, GC content, and self-hybridization are taken into account in [<xref ref-type="bibr" rid="CR8">8</xref>] and [<xref ref-type="bibr" rid="CR9">9</xref>] includes nucleotide balance between barcodes which is important especially when multiplexing small number of samples using Illumina platform.</p>
    <p>However, none of the aforementioned tools are applicable in the situation where the user wants to select an optimal set of barcodes among the existing barcodes. The only tool [<xref ref-type="bibr" rid="CR4">4</xref>] which reports to do subset selection does it so that the user cannot even define the number of resulting barcodes and furthermore, the nucleotide balance is not taken into account, see Additional file <xref rid="MOESM1" ref-type="media">1</xref>. Selecting the subset randomly among the larger set of candidate barcodes has the assumption that all barcode subsets are equal. This is not the case since although the criterion for the minimum pairwise distance would be satisfied, different subsets have different nucleotide balances. In a sequencing center, the barcode selection is a practical daily problem. It would be waste of resources to order a unique set for each individual experiment. In the other extreme, if the same set of barcodes should be re-used in all future sequencing runs, in order to retain the nucleotide balance, the number of samples to be multiplexed should remain the same in all sequencing runs which would be highly restrictive.</p>
    <p>At the moment, Illumina provides tables giving instructions how to select its own barcodes for multiplexing with various number of samples [<xref ref-type="bibr" rid="CR10">10</xref>]. In these recommendations, nucleotide balance is taken into account. However, the tables are for Illumina’s fixed set of barcodes. Our tool lets the user provide her own set of candidate barcodes to be selected from. After the user has defined how many barcodes are needed, the tool finds an optimal set which satisfies the threshold for minimum pairwise sequence distances and importantly, the nucleotide balance has been optimized.</p>
    <p>Three tasks for which our tool can be applied are shown in Fig. <xref rid="Fig1" ref-type="fig">1</xref>. The main application is to select an optimal barcode set from given candidates (Fig. <xref rid="Fig1" ref-type="fig">1</xref><xref rid="Fig1" ref-type="fig">a</xref>). Another application is to check the barcode distances and nucleotide balance of user selected barcodes (Fig. <xref rid="Fig1" ref-type="fig">1</xref><xref rid="Fig1" ref-type="fig">b</xref>). For example, if there are two libraries, it can be used to check whether the barcodes in them are compatible to be sequenced together. Third application is to augment a set of barcodes (Fig. <xref rid="Fig1" ref-type="fig">1</xref><xref rid="Fig1" ref-type="fig">c</xref>). This is the case where the user wants to add new samples to an existing sequencing library. Optimal barcodes for new samples are found taking into account the already existing ones.
<fig id="Fig1"><label>Fig. 1</label><caption><p>Applications of BARCOSEL. BARCOSEL can be used in three different modes depicted in panels <bold>a</bold>) selecting an optimal barcode set from candidates, <bold>b</bold>) checking user-defined set of barcodes, and <bold>c</bold>) augmenting an existing set of barcodes</p></caption><graphic xlink:href="12859_2018_2262_Fig1_HTML" id="MO1"/></fig>
</p>
  </sec>
  <sec id="Sec2">
    <title>Methods</title>
    <p>Selecting a subset of barcodes among a set of candidate barcodes is a combinatorial problem. Let <italic>x</italic><sub><italic>i</italic></sub> denote the indicator for presence or absence of barcode <italic>i</italic>. The number of variables <italic>x</italic><sub><italic>i</italic></sub> is the number of all candidate barcode sequences given by user and they can get only binary values. The number of all possible subsets is restricted by the requirement of minimum distance between the barcodes. Further restrictions are introduced due to required nucleotide balance in the optimal set. The task is to select <italic>n</italic> barcodes among the set of user-defined candidate barcodes. After we have defined a cost function, we can use linear integer programming [<xref ref-type="bibr" rid="CR11">11</xref>] for minimizing it. For optimal barcode selection, we define the following cost function to be minimized: 
<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \begin{aligned} {} \sum\limits_{l=1}^{L} \lvert n_{l}^{A} + n_{l}^{C} &amp;- n/2 \rvert + \lvert n_{l}^{G} + n_{l}^{T} - n/2 \rvert \\[-4pt] &amp;\quad+ \lvert n_{l}^{A} - n/4 \rvert + \lvert n_{l}^{C} - n/4 \rvert + \lvert n_{l}^{G} - n/4 \rvert \\&amp;\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad+ \lvert n_{l}^{T} - n/4, \rvert \end{aligned}  $$ \end{document}</tex-math><mml:math id="M2"><mml:mtable><mml:mtr><mml:mtd><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:munderover><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msubsup></mml:mtd><mml:mtd><mml:mo>−</mml:mo><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>|</mml:mo><mml:mo>+</mml:mo><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>|</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mspace width="1em"/><mml:mo>+</mml:mo><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mn>4</mml:mn><mml:mo>|</mml:mo><mml:mo>+</mml:mo><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mn>4</mml:mn><mml:mo>|</mml:mo><mml:mo>+</mml:mo><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mn>4</mml:mn><mml:mo>|</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mo>+</mml:mo><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mn>4</mml:mn><mml:mo>,</mml:mo><mml:mo>|</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12859_2018_2262_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
    <p>where <italic>L</italic> is the barcode length and <inline-formula id="IEq1"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$n_{l}^{A}$\end{document}</tex-math><mml:math id="M4"><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2018_2262_Article_IEq1.gif"/></alternatives></inline-formula>, <inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$n_{l}^{C}$\end{document}</tex-math><mml:math id="M6"><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2018_2262_Article_IEq2.gif"/></alternatives></inline-formula>, <inline-formula id="IEq3"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$n_{l}^{G}$\end{document}</tex-math><mml:math id="M8"><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2018_2262_Article_IEq3.gif"/></alternatives></inline-formula>, <inline-formula id="IEq4"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$n_{l}^{T}$\end{document}</tex-math><mml:math id="M10"><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2018_2262_Article_IEq4.gif"/></alternatives></inline-formula> are the number of nucleotides A,C,G,T, respectively, in barcode position <italic>l</italic> in a selected set of <italic>n</italic> barcodes. This measures the nucleotide balance between the barcodes. The first two terms in (<xref rid="Equ1" ref-type="">1</xref>) are for the balance of the two nucleotide groups for two Illumina lasers. The following four terms are for measuring the balance between single nucleotides. If all four nucleotides are in balance, also the nucleotide-pair groups are in balance and the first two terms are not needed in the cost function. However, if no perfect nucleotide balance can be found, the two first terms are important since they guide the solution towards the balance between the A/C and G/T groups. In addition to terms in (<xref rid="Equ1" ref-type="">1</xref>), the final cost function includes also four terms for global nucleotide balance between A,C,G, and T irrespective of their positions. The number of different nucleotides <inline-formula id="IEq5"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$n_{l}^{\{A,C,G,T\}}$\end{document}</tex-math><mml:math id="M12"><mml:msubsup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>C</mml:mi><mml:mo>,</mml:mo><mml:mi>G</mml:mi><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2018_2262_Article_IEq5.gif"/></alternatives></inline-formula> in a selected barcode set is calculated using the barcode sequences with the help of indicator variables <italic>x</italic><sub><italic>i</italic></sub>.</p>
    <p>We have three types of constraints when minimizing the cost function. Since there are absolute differences in the equation, they must be formulated suitably for linear programming. Here we utilize the fact that min|<italic>x</italic>| corresponds to min<italic>t</italic> so that <italic>t</italic>≥<italic>x</italic> and <italic>t</italic>≥−<italic>x</italic>, where <italic>t</italic> is an auxiliary variable. For each nucleotide position in a barcode, there are six terms with absolute differences. We apply the method above to each of them and introduce six auxiliary variables for each barcode position. The values of the auxiliary variables are continuous, i.e., they are not restricted to be integers. For each auxiliary variable, there are two constraints. This way, if barcode length is eight nucleotides, there will be 48 auxiliary variables and 96 constraints. In addition, there are four auxiliary variables and eight constraints for the global nucleotide balance. It is noteworthy that the number of nucleotide balance constraints does not depend on the number of barcode candidates, it only depends on the length of the barcodes. The second type of constraints are for preventing too similar barcodes to be present in the optimal set. The similarity is measured using user-defined distance (Hamming or Levenshtein). If the distance between two barcodes <italic>j</italic> and <italic>k</italic> is below the given threshold, they both should not be present at the same time in the optimal barcode set. This constraint is formulated as <italic>x</italic><sub><italic>j</italic></sub>+<italic>x</italic><sub><italic>k</italic></sub>≤1. Forbidden barcode pairs are detected by calculating the distances between all barcodes sequences. Note that although here we use Hamming or Levenshtein distance, it is straightforward to use any other sequence distance. How the constraint is formulated to deny illegal barcode pairs remains the same regardless of the sequence dissimilarity function. The third type of constraints is a single equation. It defines the number of selected barcodes. In case the number of all candidate barcodes is <italic>M</italic> and the number of barcodes to be selected is <italic>n</italic>, the last constraint is <inline-formula id="IEq6"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\sum \limits _{i=1}^{M} x_{i} = n$\end{document}</tex-math><mml:math id="M14"><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:math><inline-graphic xlink:href="12859_2018_2262_Article_IEq6.gif"/></alternatives></inline-formula>.</p>
    <p>After generating the constraints described above, any integer programming solver can be used. We have integrated C-library lpsolve version 5.5 [<xref ref-type="bibr" rid="CR12">12</xref>] in our software. User provides a set of candidate barcodes in a FASTA file and the desired number of barcodes to be selected. Output is a FASTA file which contains the selected barcodes and a graphical diagnostic plot which shows the position-wise and global nucleotide balance. Minimum barcode distance is a strict criterion, so if a solution is found, it is guaranteed that no barcode pair in a selected set is below the chosen threshold.</p>
  </sec>
  <sec id="Sec3" sec-type="results">
    <title>Results</title>
    <p>Our tool is available through web interface, see Fig. <xref rid="Fig2" ref-type="fig">2</xref>. User can give a set of candidate barcodes in FASTA format and the number of barcodes to be selected. In order to help getting started, our web page contains an example set of 288 barcodes which can be used to select barcodes from. The user can define a minimum distance between barcodes using either Hamming distance (number of nucleotide differences between two barcodes in the gapless alignment) or Levenshtein distance (number of substitutions, insertions, and deletions to convert one barcode sequence into another). The default minimum barcode distance is 3 using Hamming distance. When user wants to only check the nucleotide balance in an existing barcode set and whether the barcode distances exceed the given threshold value, the number of barcodes to be selected can be defined to be equal to the total number of barcodes in the input set. When user wants to expand an existing subset of barcodes, the initial subset is provided using Advanced menu. The desired number of new barcodes which optimally expand the existing subset is selected from candidate barcodes.
<fig id="Fig2"><label>Fig. 2</label><caption><p>Web interface to BARCOSEL. User needs to give only two inputs: (1) Candidate barcodes in FASTA format and (2) the number of barcodes to be selected. Sequences can imported either by copy-pasting them in a text box or uploading a FASTA file. After user has pressed submit button, the web page is returned containing an optimal set of barcodes and an image showing nucleotide balance in each barcode position. In case no solution can be found, user gets a report. Optional input parameters become available when pressing Advanced button. These include (3) an initial set of barcodes if BARCOSEL is used to augment an existing set, (4) distance type (Hamming or Levenshtein) and minimum barcode distance required (default is 3 tolerating one sequencing error), and (5) parameters related to lpsolve: maximum computation time (default is 10 seconds), branch-and-bound search depth (0 means no restrictions), and basis crash parameter related to initialization. There is no need to change lpsolve related parameters unless no acceptable solution is found with default values</p></caption><graphic xlink:href="12859_2018_2262_Fig2_HTML" id="MO2"/></fig>
</p>
    <p>We have applied our method to a barcode set consisting of 288 candidate sequences having a length of 8 nucleotides. These barcodes were initially designed using TagGD software [<xref ref-type="bibr" rid="CR8">8</xref>] and further screened to be suitable for PCR [<xref ref-type="bibr" rid="CR13">13</xref>]. We have used this set for selecting various number of barcode sets for different purposes. Some examples are shown in Table <xref rid="Tab1" ref-type="table">1</xref>. The best possible position-wise nucleotide balance depends on the number of barcodes to be selected. Only when it is a multiple of four, there can be an equal number of A, C, G, and T in every barcode position resulting in perfect balance and cost function equal to zero. In this case also the solution is found fast, usually within only few seconds. In other cases, when the best solution differs from zero, even when the global optimum has been found, the search process will continue. For this reason, there is a user-defined time limit to stop the search. When it exceeds, the best solution found so far is returned. With our data, less than 20 s was always enough to get a satisfactory solution. Additional user-defined parameters include the maximum depth of branch and bound search. If acceptable solution is not found, it might be beneficial to widen the search at the cost of its depth. Another parameter is the initialization method of the search which can be changed.
<table-wrap id="Tab1"><label>Table 1</label><caption><p>Examples of optimal 8bp barcode sets with 8,12,16, and 24 barcodes</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">Set A (8)</th><th align="left">Set B (12)</th><th align="left">Set C (16)</th><th align="left">Set D (24)</th></tr></thead><tbody><tr><td align="left">
AACACATC
</td><td align="left">
AGTTGCTG
</td><td align="left">
ACACAGGC
</td><td align="left">
ACACAGGC
</td></tr><tr><td align="left">
AGAGTGCG
</td><td align="left">
ATAGAGTC
</td><td align="left">
ACTGTTAG
</td><td align="left">
AGCCTACT
</td></tr><tr><td align="left">
CCGTATAT
</td><td align="left">
ATCATTGC
</td><td align="left">
ATAGAGTC
</td><td align="left">
AGTTCCGC
</td></tr><tr><td align="left">
CTTGGTTG
</td><td align="left">
CAGTTCCA
</td><td align="left">
ATTAGCTG
</td><td align="left">
ATACGGAT
</td></tr><tr><td align="left">
GAGATAAC
</td><td align="left">
CATGGAAT
</td><td align="left">
CAGTTCCA
</td><td align="left">
ATGACGAA
</td></tr><tr><td align="left">
GTACAGGA
</td><td align="left">
CGCAAGCT
</td><td align="left">
CCGTATAT
</td><td align="left">
ATGGTCTC
</td></tr><tr><td align="left">
TCTCGCCT
</td><td align="left">
GAGATAAC
</td><td align="left">
CGCAAGCT
</td><td align="left">
CAGTTCCA
</td></tr><tr><td align="left">
TGCTCCGA
</td><td align="left">
GCAGATAA
</td><td align="left">
CTGGCACA
</td><td align="left">
CATGTTGA
</td></tr><tr><td align="left"/><td align="left">
GGCTCTTG
</td><td align="left">
GACACTAA
</td><td align="left">
CCTGAACC
</td></tr><tr><td align="left"/><td align="left">
TCGCCAGA
</td><td align="left">
GGAGTAGA
</td><td align="left">
CGAACTTC
</td></tr><tr><td align="left"/><td align="left">
TCTCGCCT
</td><td align="left">
GGCTCTTG
</td><td align="left">
CTCCGGTT
</td></tr><tr><td align="left"/><td align="left">
TTACCGGG
</td><td align="left">
GGGAGATC
</td><td align="left">
CTGAATCA
</td></tr><tr><td align="left"/><td align="left"/><td align="left">
TACTGCAG
</td><td align="left">
GAAAGAAG
</td></tr><tr><td align="left"/><td align="left"/><td align="left">
TATCCAGT
</td><td align="left">
GAGATTGT
</td></tr><tr><td align="left"/><td align="left"/><td align="left">
TCTCGCCT
</td><td align="left">
GCATCACG
</td></tr><tr><td align="left"/><td align="left"/><td align="left">
TTACTGGC
</td><td align="left">
GCCGAATG
</td></tr><tr><td align="left"/><td align="left"/><td align="left"/><td align="left">
GCTGAAGA
</td></tr><tr><td align="left"/><td align="left"/><td align="left"/><td align="left">
GGCTCTTG
</td></tr><tr><td align="left"/><td align="left"/><td align="left"/><td align="left">
TACTGCAG
</td></tr><tr><td align="left"/><td align="left"/><td align="left"/><td align="left">
TATCTGTG
</td></tr><tr><td align="left"/><td align="left"/><td align="left"/><td align="left">
TCTCGCCT
</td></tr><tr><td align="left"/><td align="left"/><td align="left"/><td align="left">
TGAGAGAT
</td></tr><tr><td align="left"/><td align="left"/><td align="left"/><td align="left">
TGCTCCGA
</td></tr><tr><td align="left"/><td align="left"/><td align="left"/><td align="left">
TTGAGTAC
</td></tr></tbody></table><table-wrap-foot><p>Each barcode is at least three mismatches apart from each other (using Hamming distance) within the set allowing one nucleotide error in sequencing to be corrected. Proportions of all four nucleotides A,C,G,T are in balance in each barcode position</p></table-wrap-foot></table-wrap>
</p>
    <p>Figure <xref rid="Fig3" ref-type="fig">3</xref> shows examples of four optimal barcode sets. When the number of barcodes in the set is even, it is possible to get perfect balance between A/C and G/T groups in every barcode position (Fig. <xref rid="Fig3" ref-type="fig">3</xref><xref rid="Fig3" ref-type="fig">a</xref>). When the number is odd, this is not possible, however, it is still possible to get perfect nucleotide balance over the barcode length, see the rightmost column in Fig. <xref rid="Fig3" ref-type="fig">3</xref><xref rid="Fig3" ref-type="fig">b</xref>. This means that the nucleotide usage between A,C,G, and T will be the same in sequencing, at least for the barcode. When the number of barcodes is a multiple of four, it is possible to get perfect nucleotide balance in every barcode position (Fig. <xref rid="Fig3" ref-type="fig">3</xref><xref rid="Fig3" ref-type="fig">c</xref>). If the number of barcodes is large, it is possible to get near perfect balance even when the number of barcodes is odd (Fig. <xref rid="Fig3" ref-type="fig">3</xref><xref rid="Fig3" ref-type="fig">d</xref>).
<fig id="Fig3"><label>Fig. 3</label><caption><p>Nucleotide balances of optimal sets with varying number of barcodes. Horizontal axis is the barcode position, total indicates the nucleotide balance over the entire barcode length. In Illumina sequencing, nucleotide groups A/C and G/T should be in balance for optimal detection in each position. Total balance is important for equal consumption of nucleotides during sequencing. <bold>a</bold> 10 barcodes. <bold>b</bold> 11 barcodes. <bold>c</bold> 12 barcodes. <bold>d</bold> 75 barcodes</p></caption><graphic xlink:href="12859_2018_2262_Fig3_HTML" id="MO3"/></fig>
</p>
  </sec>
  <sec id="Sec4" sec-type="discussion">
    <title>Discussion</title>
    <p>Although in principle there are no restrictions for the size of the data the method can handle, in practice the computation time grows when the size of the input barcode set increases. For a practical advice, our tool is mostly applicable for selecting a subset of barcodes from an existing larger set which does not exceed several thousands of candidates. In particular, our tool is not meant to be used in the situation where the user first enumerates all possible 8-mers (65,536 barcodes) and then starts selecting a subset of it. For this kind of application it is better (faster) to use de novo barcode design tools. We have mainly used our tool for RNA-seq and genome re-sequencing, where the number of libraries to be multiplexed varies between 10 and 20, and the size of the input data consists of a few hundreds of barcode candidates, see e.g. [<xref ref-type="bibr" rid="CR14">14</xref>]. The optimization of nucleotide balance is most important with small number of samples. When the number of libraries to be multiplexed becomes larger and therefore larger number of barcodes are used together, the nucleotide balance will become eventually evenly distributed even by chance. In such cases it suffices to check that the sequence distances (measured by Hamming or Levenshtein distance) between all barcode pairs are adequate.</p>
    <p>Finally, for large number of multiplexed samples, the method of dual indexing can be used. In this method two different barcodes are attached to each sample. For example, if there is a need to multiplex 384 samples, it can be done as a combination of 24-barcode P7 index set and 16-barcode P5 index set (24∗16=384).</p>
  </sec>
  <sec id="Sec5" sec-type="conclusion">
    <title>Conclusions</title>
    <p>Increasing capacity of sequencing platforms raises the challenge of mixing barcodes during the protocols in RNA-seq, whole genome sequencing, and amplicon sequencing approaches. The number of samples to be mixed may vary which introduces a problem how to select the best barcode combination for each sequencing run. Instead of designing a new barcode set from scratch for each sequencing run, the practical problem is how to select the best combination of barcodes from available existing set of barcodes. This is the task we have developed our method for. Our tool selects the desired number of barcodes in such a way that the nucleotide balance of barcodes is optimized. In addition, user can set a minimum distance between barcodes to tolerate sequencing errors. We have successfully used our method in several sequencing projects of various kinds of assays. Web interface to our tool is available at <ext-link ext-link-type="uri" xlink:href="http://ekhidna2.biocenter.helsinki.fi/barcosel">http://ekhidna2.biocenter.helsinki.fi/barcosel</ext-link>. It contains instructions and an example candidate barcode set to be used for subset selection.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Additional file</title>
    <sec id="Sec6">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="12859_2018_2262_MOESM1_ESM.pdf">
            <label>Additional file 1</label>
            <caption>
              <p>Barcode selection using BARCOSEL and R-package DNABarcodes. (PDF 78 kb)</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Electronic supplementary material</bold>
      </p>
      <p>The online version of this article (10.1186/s12859-018-2262-7) contains supplementary material, which is available to authorized users.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>None.</p>
    <sec id="d29e1403">
      <title>Funding</title>
      <p>Funding from Biocenter Finland is greatly acknowledged. Funding body did not play any role in the design of the study and collection, analysis, and interpretation of data and in writing the manuscript.</p>
    </sec>
    <sec id="d29e1408">
      <title>Availability of data and materials</title>
      <p>Web interface to our tool is available at <ext-link ext-link-type="uri" xlink:href="http://ekhidna2.biocenter.helsinki.fi/barcosel">http://ekhidna2.biocenter.helsinki.fi/barcosel</ext-link>.</p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>LP, PA, and PM initiated the project. PS developed and implemented the method. PK and LH implemented the web interface. All authors contributed to the writing of the manuscript. All authors read and approved the final version of the manuscript.</p>
  </notes>
  <notes notes-type="COI-statement">
    <sec id="d29e1424">
      <title>Ethics approval and consent to participate</title>
      <p>Not applicable.</p>
    </sec>
    <sec id="d29e1429">
      <title>Consent for publication</title>
      <p>Not applicable.</p>
    </sec>
    <sec id="d29e1434">
      <title>Competing interests</title>
      <p>The authors declare that they have no competing interests.</p>
    </sec>
    <sec id="d29e1439">
      <title>Publisher’s Note</title>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </sec>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1</label>
      <mixed-citation publication-type="other">Krueger F, Andrews S, Osborne C. Large scale loss of data in low-diversity illumina sequencing libraries can be recovered by deferred cluster calling. PLoS ONE. 2011. 10.1371/journal.pone.0016607.</mixed-citation>
    </ref>
    <ref id="CR2">
      <label>2</label>
      <mixed-citation publication-type="other">D F. Barcrawl and bartab: software tools for the design and implementation of barcoded primers for highly multiplexed dna sequencing. BMC Bioinformatics. 2009. 10.1186/1471-2105-10-362.</mixed-citation>
    </ref>
    <ref id="CR3">
      <label>3</label>
      <mixed-citation publication-type="other">Faircloth B, Glenn T. Not all sequence tags are created equal: designing and validating sequence identification tags robust to indels. PLoS ONE. 2012. 10.1371/journal.pone.0042543.</mixed-citation>
    </ref>
    <ref id="CR4">
      <label>4</label>
      <mixed-citation publication-type="other">Buschmann T. Dnabarcodes: an r package for the systematic construction of dna sample tags. Bioinformatics. 2017. 10.1093/bioinformatics/btw759.</mixed-citation>
    </ref>
    <ref id="CR5">
      <label>5</label>
      <mixed-citation publication-type="other">Hamady M, Walker J, Harris J, Gold N, Knight R. Error-correcting barcoded primers for pyrosequencing hundreds of samples in multiplex. Nat Methods. 2008. 10.1038/nmeth.1184.</mixed-citation>
    </ref>
    <ref id="CR6">
      <label>6</label>
      <mixed-citation publication-type="other">Bystrykh L. Generalized dna barcode design based on hamming codes. PLoS ONE. 2012. 10.1371/journal.pone.0036852.</mixed-citation>
    </ref>
    <ref id="CR7">
      <label>7</label>
      <mixed-citation publication-type="other">Buschmann T, Bystrykh L. Levenshtein error-correcting barcodes for multiplexed dna sequencing. BMC Bioinformatics. 2013. 10.1186/1471-2105-14-272.</mixed-citation>
    </ref>
    <ref id="CR8">
      <label>8</label>
      <mixed-citation publication-type="other">Costea P, Lundeberg J, Akan P. Taggd: fast and accurate software for dna tag generation and demultiplexing. PLoS ONE. 2013. 10.1371/journal.pone.0057521.</mixed-citation>
    </ref>
    <ref id="CR9">
      <label>9</label>
      <mixed-citation publication-type="other">Herten K, Hestand M, Vermeesch J, Van Houdt J. Gbsx: a toolkit for experimental design and demultiplexing genotyping by sequencing experiments. BMC Bioinformatics. 2015. 10.1186/s12859-015-0514-3.</mixed-citation>
    </ref>
    <ref id="CR10">
      <label>10</label>
      <mixed-citation publication-type="other">Illumina. Truseq library prep pooling guide. Technical report. 2015. Document # 15042173 v01.</mixed-citation>
    </ref>
    <ref id="CR11">
      <label>11</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Nemhauser</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Wolsey</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <source>Integer and Combinatorial Optimization</source>
        <year>1999</year>
        <publisher-loc>New York</publisher-loc>
        <publisher-name>Wiley</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12</label>
      <mixed-citation publication-type="other">Berkelaar M, Eikland K, Notebaert P. Open Source (Mixed-Integer) Linear Programming System. <ext-link ext-link-type="uri" xlink:href="http://lpsolve.sourceforge.net/5.5/">http://lpsolve.sourceforge.net/5.5/</ext-link>. Accessed 11 Nov 2017.</mixed-citation>
    </ref>
    <ref id="CR13">
      <label>13</label>
      <mixed-citation publication-type="other">Kalendar R, Lee D, Schulman A. Fastpcr software for pcr, in silico pcr, and oligonucleotide assembly and analysis. DNA Cloning Assem Methods. 2014. 10.1007/978-1-62703-764-8_18.</mixed-citation>
    </ref>
    <ref id="CR14">
      <label>14</label>
      <mixed-citation publication-type="other">Salojärvi J, Smolander O, Nieminen K, Rajaraman S, Safronov O, Safdari P, Lamminmäki A, Immanen J, Lan T, Tanskanen J, Rastas P, Amiryousefi A, Jayaprakash B, Kammonen J, Hagqvist R, Eswaran G, Ahonen V, Serra J, Asiegbu F, de Dios Barajas-Lopez J, Blande D, Blokhina O, Blomster T, Broholm S, Brosche M, Cui F, Dardick C, Ehonen S, Elomaa P, Escamez S, Fagerstedt K, Fujii H, Gauthier A, Gollan P, Halimaa P, Heino P, Himanen K, Hollender C, Kangasjärvi S, Kauppinen L, Kelleher C, Kontunen-Soppela S, Koskinen J, Kovalchuk A, Kärenlampi S, Kärkönen A, Lim K, Leppälä J, Macpherson L, Mikola J, Mouhu K, Mähönen A, Niinemets U, Oksanen E, Overmyer K, Palva E, Pazouki L, Pennanen V, Puhakainen T, Poczai P, Possen B, Punkkinen M, Rahikainen M, Rousi M, Ruonala R, van der Schoot C, Shapiguzov A, Sierla M, Sipilä T, Sutela S, Teeri T, Tervahauta A, Vaattovaara A, Vahala J, Vetchinnikova L, Welling A, Wrzaczek M, Xu E, Paulin L, Schulman A, Lascoux M, Albert V, Auvinen P, Helariutta Y, Kangasjärvi J. Genome sequencing and population genomic analyses provide insights into the adaptive landscape of silver birch. Nat Genet. 2017. 10.1038/ng.3862.</mixed-citation>
    </ref>
  </ref-list>
</back>
