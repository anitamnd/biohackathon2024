<?all-math-mml yes?>
<?use-mml?>
<?properties open_access?>
<?properties manuscript?>
<?ManuscriptPrefix new?>
<?iso-abbr Nat. Biotechnol.?>
<?submitter-system ukmss?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 1005?>
<?submitter-authority publisher?>
<?submitter-login NPG?>
<?submitter-name Nature Publishing Group?>
<?domain wtpa?>
<?origin ukpmcpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">9604648</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">20305</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Biotechnol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Biotechnol.</journal-id>
    <journal-title-group>
      <journal-title>Nature biotechnology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1087-0156</issn>
    <issn pub-type="epub">1546-1696</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6420049</article-id>
    <article-id pub-id-type="pmid">30718882</article-id>
    <article-id pub-id-type="doi">10.1038/s41587-018-0010-1</article-id>
    <article-id pub-id-type="manuscript">ems80982</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Ultra-fast search of all deposited bacterial and viral genomic data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Bradley</surname>
          <given-names>Phelim</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Den Bakker</surname>
          <given-names>Henk C</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rocha</surname>
          <given-names>Eduardo P. C.</given-names>
        </name>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref ref-type="aff" rid="A4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>McVean</surname>
          <given-names>Gil</given-names>
        </name>
        <xref ref-type="aff" rid="A5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Iqbal</surname>
          <given-names>Zamin</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A6">6</xref>
        <xref ref-type="corresp" rid="CR1">*</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Wellcome Trust Centre for Human Genetics, University of Oxford, UK</aff>
    <aff id="A2"><label>2</label>Center for Food Safety, Department of Food Science and Technology, University of Georgia, Georgia, USA</aff>
    <aff id="A3"><label>3</label>UMR 3525, CNRS, Paris, France</aff>
    <aff id="A4"><label>4</label>Microbial Evolutionary Genomics, Institut Pasteur, CNRS URA2171, Paris, France</aff>
    <aff id="A5"><label>5</label>Big Data Institute, Li Ka Shing Centre for Health Information and Discovery, University of Oxford, Oxford, UK</aff>
    <aff id="A6"><label>6</label>EMBL-EBI, Hinxton, UK</aff>
    <author-notes>
      <corresp id="CR1"><label>*</label>Corresponding author, <email>zi@ebi.ac.uk</email></corresp>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>10</day>
      <month>1</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>04</day>
      <month>2</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>2</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>04</day>
      <month>8</month>
      <year>2019</year>
    </pub-date>
    <volume>37</volume>
    <issue>2</issue>
    <fpage>152</fpage>
    <lpage>159</lpage>
    <!--elocation-id from pubmed: 10.1038/s41587-018-0010-1-->
    <permissions>
      <license>
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:<ext-link ext-link-type="uri" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</ext-link></license-p>
      </license>
    </permissions>
    <abstract>
      <p id="P1">Exponentially increasing amounts of unprocessed bacterial and viral genomic sequence data are stored in the global archives. The ability to query these data for sequence search-terms would facilitate both basic research and applications such as real-time genomic epidemiology and surveillance. However, this is not possible with current methods. To solve this problem, we combine knowledge of microbial population genomics with computational methods devised for web-search to produce a searchable data structure named Bitsliced Genomic Signature Index (BIGSI). We indexed the entire global corpus of 447,833 bacterial and viral whole genome sequence datasets using 4 orders of magnitude less storage than previous methods. We applied our BIGSI search function to rapidly find resistance genes MCR-1/2/3, determine the host-range of 2827 plasmids, and quantify antibiotic resistance in archived datasets. Our index can grow incrementally as new (unprocessed or assembled) sequence datasets are deposited and can scale to millions of datasets.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P2">Whole genome sequencing (WGS) of bacteria and viruses offers unparalleled resolution for a whole range of research questions including contact tracing, mapping the spread of drug resistance, identifying zoonoses and investigating the biology of infectious diseases. Genome sequence data is deposited in public archives such as the European Nucleotide Archive (ENA) and the Sequence Read Archive (SRA), which mirror their underlying data. The volume of archived microbial sequence data has doubled in size every two years, and is likely to grow at an increasing pace<xref rid="R1" ref-type="bibr">1</xref>–<xref rid="R6" ref-type="bibr">6</xref>. However, it is currently impossible to search these archives for DNA sequence of interest, such as mutations or genes. This functionality would transform infectious disease management, by enabling rapid identification of already-sequenced organisms that are highly similar to an outbreak strain, or by enabling studies of antibiotic resistance mutations, genes or plasmids.</p>
  <p id="P3">At first sight BLAST<xref rid="R7" ref-type="bibr">7</xref> and its successor<xref rid="R8" ref-type="bibr">8</xref>,<xref rid="R9" ref-type="bibr">9</xref> algorithms seem to enable these searches, by performing alignment of query sequences against large databases. There are two reasons why these tools do not suffice. First, they would not scale to databases the size of the ENA or beyond. Second, they require assembled genomes as input - if applied to raw sequence data they would only find matches completely contained within a single read. However assembly is fundamentally lossy when the input data contains multiple strains, and the highly heterogeneous historical data in the ENA would result in very variable assemblies, particularly of plasmids <xref rid="R10" ref-type="bibr">10</xref>–<xref rid="R12" ref-type="bibr">12</xref>.</p>
  <p id="P4">The first scalable method for searching raw sequences, named Sequence Bloom Tree (SBT)<xref rid="R13" ref-type="bibr">13</xref>, comprised a k-mer (fixed-length DNA word) index. SBT enabled detection of specific transcripts in RNA-seq data, and allowed users to search archived datasets for the first time. SBT, methods based on SBTs<xref rid="R14" ref-type="bibr">14</xref>–<xref rid="R16" ref-type="bibr">16</xref> and methods such as <italic>Cortex</italic>, <italic>vari</italic> and <italic>McCortex</italic><xref rid="R17" ref-type="bibr">17</xref>–<xref rid="R19" ref-type="bibr">19</xref> are all constrained by a scaling dependence on the total number of k-mers in the union of datasets indexed. For species such as humans, where there is considerable k-mer sharing between datasets, SBTs work very well; efficiencies can also be gained by leveraging patterns of sharing between datasets<xref rid="R20" ref-type="bibr">20</xref>. However, bacterial and viral genomes encapsulate billions of years of evolution; indeed even within one bacterial species there can be enormous diversity due to horizontal transfer of DNA (<xref ref-type="supplementary-material" rid="SD2">Supplementary Figure 1</xref>). We show this diversity renders previous methods unable to scale. We solve the problem with an alternative type of k-mer index, using a fixed-length binary “signature” of each dataset. We call our data structure a Bitsliced Genomic Signature Index (BIGSI).</p>
  <p id="P5">Searching the DNA archive is one example of a “document retrieval” problem, a subject which has been intensely studied and successfully implemented at massive scale by internet search engines. Our “search terms” are k-mers from SNPs/alleles, and our “web-pages” are raw read datasets or assemblies. Bitsliced signatures were once used for text search<xref rid="R21" ref-type="bibr">21</xref>,<xref rid="R22" ref-type="bibr">22</xref>, but were largely abandoned after Zobel et al showed in 1998 that an alternative method (inverted indexes) performed better for natural language<xref rid="R23" ref-type="bibr">23</xref>. One notable exception in 2017 was the Microsoft Bing search engine<xref rid="R24" ref-type="bibr">24</xref>, which revived their use. For our use case, where each new microbial dataset brings new variation, bitsliced signatures provide much better scaling than inverted indexes. Web and (microbial) DNA search have different dimensionality, as the language of microbial genomes is vastly more complex than English. Our ENA/SRA dataset was only 10<sup>6</sup> documents but contained 10<sup>10</sup> unique terms (here, k-mers), and this would continue to increase with more data, whereas Google indexes 10<sup>12</sup> documents containing (we estimate) 10<sup>8</sup> terms with a much more slowly growing lexicon.</p>
  <p id="P6">Here, we use BIGSI to index the entire bacterial and viral WGS content in the ENA as of December 2016 (see <xref ref-type="fig" rid="F1">Figure 1</xref> for context), and apply it to solve basic microbial surveillance problems. We also make a demonstration search publicly available at <ext-link ext-link-type="uri" xlink:href="http://bigsi.io">http://bigsi.io</ext-link>.</p>
  <sec sec-type="results" id="S1">
    <title>Results</title>
    <p id="P7">We developed a data structure suitable for storing microbial genomic data, the bitsliced genomic signature index (BIGSI). We use the generic term “dataset” to refer to either an assembled genome or unassembled sequence read-files from clonal or non-clonal samples. BIGSI combines a k-mer index with constraints on sequence queries, described below. A bloom filter is a data structure<xref rid="R25" ref-type="bibr">25</xref> which stores data (here, k-mers) in a bit-vector (array of zeroes and ones) and answers set-membership queries (“is this k-mer contained in the set?”) probabilistically. The false negative rate is zero, and the false positive rate is controlled by 2 parameters (size of bit-vector and the number of (hash) functions used to generate the binary encoding, see <xref ref-type="fig" rid="F2">Figure 2</xref> and <xref ref-type="sec" rid="S8">Online Methods</xref>), creating a trade-off between false-positive rate and compression. We describe how we set the bloom filter parameters below. BIGSI encodes data as a matrix in which each column is a bloom filter of the k-mers in a dataset. Querying for presence of a k-mer involves applying the Bloom filter hash functions to this k-mer, which each return an integer, and taking the rows of the matrix (“bitslices”) indexed by these integers; datasets (columns) containing the k-mer have a 1 in all those rows. Fast (O(1)) access to the rows is achieved using a hash mapping from row index to the corresponding bitarray. <xref ref-type="fig" rid="F2">Figure 2</xref> shows how data is processed and stored, and how queries are made; details are in <xref ref-type="sec" rid="S8">Online Methods</xref>. Incorporating a new dataset simply requires the addition of a new column, without needing to rebuild the index. However, since appending a new column to a BIGSI requires modifying every key in the index this is an expensive operation. Our solution is to batch new inserts, building a new index per batch, and then merging indexes. Our implementation supports both disk-based and in-memory stores but all measurements in this report are from the disk-based store. Although we use BIGSI as a k-mer index, it can be viewed as a probabilistic coloured de Bruijn graph<xref rid="R17" ref-type="bibr">17</xref>,<xref rid="R26" ref-type="bibr">26</xref>. A comparison of functionality supported by BIGSI compared with other tools is shown in <xref ref-type="supplementary-material" rid="SD3">Supplementary Table 1</xref>.</p>
    <p id="P8">To search for a sequence, we query the index for all the k-mers within it. Exact matching requires all k-mers be present (threshold T=100%), and can be implemented as a fast AND operation on bit-vectors. Inexact matching, primarily used for long alleles, requires the presence of some proportion (T&lt;100%) of k-mers be present, and is slower as the bits are unpacked and summed. The relationship between proportion of k-mers present (“k-mer identity”) and the more traditional sequence identity used by BLAST, is non-linear but monotonic (<xref ref-type="sec" rid="S8">Online Methods</xref>, <xref ref-type="supplementary-material" rid="SD2">Supplementary Figures 2,3</xref>). In creating BIGSI we use a relatively high per k-mer error rate of ~0.3 to enable a higher bloom filter compression rate, but require a longer minimum query length (61) (<xref ref-type="sec" rid="S8">Online Methods</xref>). For example, to search for and genotype a single nucleotide polymorphism (SNP), we create a sequence probe for each allele, with <italic>k</italic>-1 bases on either side, and demand multiple k-mers from the query be present, reducing the false positive rate for SNP allele detection exponentially. The theoretical false discovery rate for an SNP allele from a probe of length (2<italic>k</italic>-1) with our bloom filter parameters is 10<sup>-29</sup> per column, which is well below the expected error rate from the underlying sequence data (~10<sup>-2</sup>).</p>
    <p id="P9">We measured query speed by first building a BIGSI of 3,480 datasets of <italic>Mycobacterium tuberculosis</italic> obtained from<xref rid="R27" ref-type="bibr">27</xref>, and genotyping 68,269 SNPs. Searching all of these datasets for these SNPs took less than 90 minutes on a single CPU core which translates to a genotyping rate of more than 46,000 genotypes per second. We validated SNP genotyping accuracy using a subset of 100 of the <italic>M. tuberculosis</italic> datasets for which we had high quality SNP calls using samtools<xref rid="R28" ref-type="bibr">28</xref> (see <xref ref-type="sec" rid="S8">Methods</xref>). The concordance between methods was 99.997% with a total of only 286/682,690 discrepancies. We measured accuracy of longer allele detection by searching (with T = 70% match) for a catalogue of <italic>E. coli</italic> Multi Locus Sequence Type (MLST) alleles and choosing the best scored allele for each gene. We then compared calls on a set of 954 datasets with the MLST allele calls from a high-quality caller: SRST2<xref rid="R29" ref-type="bibr">29</xref>. Where both methods made a call (6483/6678 alleles), there was 99.9% agreement; otherwise SRST2 failed (n = 167), or BIGSI failed to find an allele version above T=70% (n = 28).</p>
  </sec>
  <sec id="S2">
    <title>Benchmarking BIGSI</title>
    <p id="P10">We benchmarked the empirical scaling properties of BIGSI against the Sequence Bloom Tree (SBT)<xref rid="R13" ref-type="bibr">13</xref> and the Split Sequence Bloom Tree<xref rid="R15" ref-type="bibr">15</xref> (SSBT) using a dataset of 10,000 random microbial sequence datasets from the ENA. We compared build and query times, and peak storage requirements on 21 subsets ranging from 100 to 10,000 samples. For each subset, we built a BIGSI, an SBT and an SSBT using two different parameter settings: one optimized for speed (recommended by the authors in Lemma 1, and subsequent text, of Solomon et al<xref rid="R13" ref-type="bibr">13</xref> and the SBT/SSBT user manual) (SBT-fast/SSBT-fast), and another optimized for compression (SBT-small/SSBT-small) (<xref ref-type="sec" rid="S8">Online methods</xref>). For database sizes of more than 2,000 samples, peak storage requirements of SBT-fast and SSBT-fast exceeded our available disk space (1 Tb; by comparison the total storage required for the input data was 403 Gb; <xref ref-type="sec" rid="S8">Online methods</xref>).</p>
    <p id="P11">We queried the resulting indexes for 2,157 antimicrobial resistance genes with a mean length of 937 bp and total query length 2,021,655 bp. SBT-fast, SBT-small, SSBT-fast, SSBT-small and BIGSI returned near-identical hits from the exact match search, with only 1 difference across all queries (measured on N = 1,000 database size). With the inexact search, concordance was &gt;99% with the differences likely due to differences between methods in the construction of the underlying bloom filters. Inexact (T = 40%) query times versus peak storage requirements for the various methods are shown in <xref ref-type="fig" rid="F3">Figure 3</xref>; BIGSI maintains good query performance in small space for all input data sizes, whereas (since they need to build an uncompressed tree of bloom filters before compressing it) both SBT and SSBT trade storage requirements for performance (we quantify performance below). SSBT-fast and SBT-fast have query time comparable to or better than BIGSI but require orders of magnitude more storage to build the uncompressed tree. SBT-small and SSBT-small have almost equivalent storage as BIGSI, but slower query performance, due to saturation of internal bloom filters within the sequence bloom tree, a result of the total number of unique k-mers being significantly larger than the number of unique k-mers in any individual dataset. With 2,000 samples in the index, the SBT-fast query was only slightly slower than BIGSI’s (292s vs 274s) but required 132X (878GB/6.6GB) more storage during construction, and 9X (57.5GB/6.6GB) more storage after compression. Further details in <xref ref-type="sec" rid="S8">Online Methods</xref>. Similar results were found for exact queries (T = 100%, <xref ref-type="supplementary-material" rid="SD2">Supplementary Figure 4</xref>); exact match searches with BIGSI were up to 2-3X faster than inexact queries.</p>
    <p id="P12">To ensure our SBT comparison was fair, we also benchmarked BIGSI and SBT on the same human RNA-seq dataset used in <xref rid="R13" ref-type="bibr">13</xref>,<xref rid="R15" ref-type="bibr">15</xref>,<xref rid="R30" ref-type="bibr">30</xref>, using the prebuilt SBT index provided by the authors. We measured the query time of 1000 RNA transcripts randomly selected from the 214,294 known transcripts (reported in <xref rid="R13" ref-type="bibr">13</xref>), and compressed index size. BIGSI has faster query time than SBT in smaller space for these datasets (360 s and 144 Gb for BIGSI, and 2221 s and 200 Gb for SBT (T = 70%); details in <xref ref-type="sec" rid="S8">Online methods</xref> and full results, including for exact search, in <xref ref-type="supplementary-material" rid="SD3">Supplementary Table 2</xref>).</p>
    <p id="P13">Finally, we simulated the scaling of storage requirements required to build SBT-fast, and BIGSI for dataset of up to 1 million genomes of two types: genomes with high proportions of k-mer sharing (e.g. human), and genomes with lower proportions of k-mer sharing (e.g. bacteria) (<xref ref-type="supplementary-material" rid="SD2">Supplementary Figure 5</xref>). BIGSI scales linearly with number of datasets, performing identically in both cases. For the low k-mer-sharing simulation an unsaturated (i.e. fast) SBT/SSBT would require 4 orders of magnitude more storage than BIGSI to construct (tens of Pb rather than 3 Tb).</p>
  </sec>
  <sec id="S3">
    <title>An index of all bacterial and viral sequence in the ENA</title>
    <p id="P14">We downloaded the entire set of 469,654 bacterial, viral and parasitic WGS datasets in the ENA as of December 2016. After a step to exclude eukaryotic genomes on the basis of size (<xref ref-type="sec" rid="S8">Online Methods</xref>), we were left with 447,833 datasets, from which we created a BIGSI index. This index, named the ‘all-microbial index’ required 1.5 TB of storage, &lt;1% of the original data size (170 TB) and contained more than 60 billion unique k-mers. Data download took 6 weeks, and we built bloom filters ‘on the fly’. Combining the complete set of bloom filters took approximately 2 days (<xref ref-type="sec" rid="S8">Online Methods</xref>). We estimate that the intermediate storage required to build an SBT-fast/SSBT-fast of the same data with recommended bloom filter size equal to the number of unique k-mers in the collection, would be &gt;6.7PB.</p>
    <p id="P15">We used our ‘all-microbial index’ for several analyses. First, we estimated the species and abundances present in each dataset that within the all-microbial-index using the Bayesian abundance estimator Bracken<xref rid="R31" ref-type="bibr">31</xref>, which parses output from the read-classifier Kraken<xref rid="R32" ref-type="bibr">32</xref> (<xref ref-type="sec" rid="S8">Online Methods</xref>). Using this method, we found that more than 90% of the input datasets were from only 20 genera, and 65% of the input datasets were from the 5 most common bacterial genera (<italic>Salmonella</italic>, <italic>Streptococcus</italic>, <italic>Staphylococcus</italic>, <italic>Escherichia</italic> and <italic>Mycobacterium</italic>); counts for the most prevalent bacterial genera in the all-microbial index are shown in <xref ref-type="supplementary-material" rid="SD2">Supplementary Figure 6</xref>.</p>
  </sec>
  <sec id="S4">
    <title>Ultrafast gene search using the all-microbial index</title>
    <p id="P16">We searched for exact matches to the mobilized colistin resistance genes <italic>MCR-1/2/3</italic><xref rid="R33" ref-type="bibr">33</xref>–<xref rid="R37" ref-type="bibr">37</xref> in the all-microbial-index. Searching for all 3 genes in 10x more genomes than has been previously reported took just 1.73 s seconds in total. We did not detect <italic>MCR-2</italic>. <italic>MCR-1</italic> was present in 169 datasets from 3 species (<italic>Escherichia coli</italic>, <italic>Salmonella enterica</italic>, <italic>Enterobacter aerogenes)</italic> and <italic>MCR-3</italic> was present in 34 datasets from 3 species (<italic>E. coli</italic>, <italic>S. enterica</italic>, <italic>Klebsiella pneumoniae</italic>) (Supplementary Data 1). Our all microbial index therefore enables almost instant detection of drug resistance genes, or indeed any other gene studied, across the global corpus.</p>
  </sec>
  <sec id="S5">
    <title>Host-range of plasmids in the all-microbial index</title>
    <p id="P17">We downloaded a set of 2,827 plasmids from the ENA (<xref ref-type="sec" rid="S8">Online Methods</xref>, Supplementary Data 2) and ran an inexact (T = 40%) search for them in the all-microbial-index. We restricted analysis to hits with T &gt; 90%. The total length of query sequences was 227 Mbp, and the query took 2,120 CPU hours (11 days) on a single server using 8 cores and 1.5 Gb RAM per process. The search returned 665,619 hits with 121,758 unique accessions across 258 genera. Since contamination could confound observations of a plasmid in a genus, we excluded all datasets containing evidence of more than one genus at abundance above 0.1%. Only 41% (184,652) of datasets and 62% of search hits passed this filter.</p>
    <p id="P18">In the filtered output we identified plasmids shared by closely related genera, for example <italic>Escherichia</italic>, <italic>Shigella</italic> and <italic>Salmonella</italic> or <italic>Enterococcus</italic>, <italic>Streptococcus</italic> and <italic>Staphylococcus</italic>. We found 37 plasmids present in at least five datasets from at least two genera (<xref ref-type="fig" rid="F4">Figure 4</xref>, Supplementary Data 2, 3); and 5 plasmids that were present in multiple orders and families. The plasmid pETHIS-1 (GenBank identifier: AF012911) was found in 5 phyla, 10 taxonomic classes and 17 genera. This plasmid is used as an expression vector and its identification in so many species serves as a positive control, confirming that BIGSI can detect common plasmids. Of more biological interest, the Tn916 conjugative transposon encoding tetracycline resistance that was first found in <italic>Enterococcus faecium</italic> and is known to have broad host range<xref rid="R38" ref-type="bibr">38</xref> (GenBank identifier: U09422) was found in Streptococcus (n = 3,951), Staphylococcus (n = 1,212), Enterococcus (n = 43), Clostridioides (n = 29), Listeria (n = 19) and Erysipelothrix (n = 11).</p>
    <p id="P19">Sampling biases in the ENA preclude inference about plasmid distribution, but they do allow us to ask if plasmids bearing antibiotic resistance genes are more widely distributed than those plasmids that do not have antibiotic resistance genes. We defined “phylogenetic spread” of a plasmid as the median of the pairwise distances along a large subunit rRNA tree (incorporating branch lengths) between all pairs of genera in which the plasmid is detected. We tested whether plasmids harboring at least 3 antibiotic resistance genes are more widely distributed across this phylogeny than plasmids with no antibiotic resistance genes by comparing the 95% quantile of these two distributions, and found that they are (<xref ref-type="fig" rid="F5">Figure 5</xref>). We tested for significance using a permutation test (p = 0.0024, 1 million replicates) (<xref ref-type="supplementary-material" rid="SD2">Supplementary Figure 7</xref>). Since the sampling of the ENA data is biased towards the <italic>Enterobacteriaceae</italic>, we would restrict this conclusion to that family.</p>
    <p id="P20">The distribution of different versions of the machinery for conjugation of DNA between bacteria has previously been analysed in 1,124 genomes<xref rid="R39" ref-type="bibr">39</xref> using sensitive, but slow, protein profile searches for relaxase (MOB) and type 4 secretion system (T4SS) genes. We undertook a similar analysis of the whole ENA, by using an exact match search of the all-microbial-index for nucleotide alleles corresponding to previously identified MOB and T4SS “types” (alleles defined in amino acid space). We applied the same contamination filter mentioned above (restricting to 184,652 datasets), and required exact matches to at least one MOB and one T4SS be present to be considered a putative conjugative system. 36,030 datasets met these criteria, giving an estimate of 19.5% of bacteria in the ENA containing a conjugative system, which is consistent with the previous estimate of 18% in Guglielmini et al<xref rid="R39" ref-type="bibr">39</xref>. This proportion varied by phylum (minimum 0.5% in <italic>Spirochaetes</italic> and maximum 31.7% in <italic>Firmicutes,</italic> full data in <xref ref-type="supplementary-material" rid="SD3">Supplementary Table 3</xref>, and MOB type distribution in <xref ref-type="supplementary-material" rid="SD2">Supplementary Figure 8</xref>). These data could be mined further to explore the potential spread of antibiotic resistance genes. For example, by analysing datasets shown to contain MOB<sub>T</sub> we observed genetic flux between <italic>Staphylococcus</italic> and <italic>Streptococcus</italic>, but not between either of them and <italic>Salmonella</italic>. We also found MOB<sub>Q</sub> in <italic>Salmonella</italic> and <italic>Streptococcus</italic> but not <italic>Staphylococcus</italic>, indicating a different probability of cross-genus (and cross-phylum) transfer by conjugation (Supplementary Data 4).</p>
  </sec>
  <sec id="S6">
    <title>Antibiotic resistance genes in the ENA</title>
    <p id="P21">To understand whether antibiotic resistance gene prevalence in the ENA has changed over time, we downloaded the set of 2,157 sequences associated with antibiotic resistance from the the Comprehensive Antibiotic Resistance Database (CARD) database (v1.1.7)<xref rid="R40" ref-type="bibr">40</xref> searched for this set of genes in the all-microbial-index with thresholds of 100% and 70% (full results for both searches are in Supplementary Data 5). An exact search for a single gene took an average of 1.1s and returned an average of 438 hits, whereas the corresponding figures for an inexact search (T = 70%) were 34.4s and 5,320 hits. We show the prevalence over time in 3 genera, and in total, in <xref ref-type="fig" rid="F6">Figure 6</xref>. Focusing only on <italic>Staphylococcus</italic>, we found that the proportion of datasets containing <italic>mecA</italic> gene (methicillin resistance), fell from 70% in 2013 to 40% in 2016, and that prevalence of <italic>tet</italic> and <italic>aac</italic> genes also decreased (<xref ref-type="fig" rid="F6">Figure 6b</xref>). For <italic>Klebsiella</italic> however, the prevalence of all resistance genes that we screened for in the all-microbial dataset increased over time (<xref ref-type="fig" rid="F6">Figure 6c</xref>).</p>
    <p id="P22">In <italic>M. tuberculosis,</italic> antibiotic resistance mainly arises through amino acid mutations in specific genes <xref rid="R1" ref-type="bibr">1</xref>,<xref rid="R41" ref-type="bibr">41</xref>. We genotyped the all-microbial-index, which contains 30,226 <italic>M. tuberculosis</italic> genome datasets, for the 206 resistance mutations enumerated by Walker <italic>et al.</italic><xref rid="R27" ref-type="bibr">27</xref>. This exercise took only 103 minutes on a single-core, which is approximately 10,000x faster than typing each dataset individually with the fast resistance prediction software <italic>Mykrobe predictor</italic><xref rid="R1" ref-type="bibr">1</xref>. Our results indicate an increase in prevalence of MDR-TB in the ENA since 2011 (<xref ref-type="fig" rid="F6">Figure 6d</xref>). It should be noted that one cannot infer anything about global prevalence from this, as the contents of the ENA are subject to sampling biases (that is, are dependent on specific research studies rather than containing an unbiased sampling of isolates from tuberculosis patients). Indeed, the latest WHO estimates for 2016<xref rid="R42" ref-type="bibr">42</xref>, put MDR prevalence at 6.6% as compared with the 18.9% of datasets deposited in the ENA/SRA in 2016 that we detected (<xref ref-type="fig" rid="F6">Figure 6d</xref>).</p>
  </sec>
  <sec sec-type="discussion" id="S7">
    <title>Discussion</title>
    <p id="P23">Hundreds of thousands of bacterial and viral samples are sequenced and shared every year, and this number is growing exponentially. A scalable online sequence search facility that could access all deposited sequence data would unlock the archives for fundamental research, clinical microbiology and public health, in much the same way that web-search allows people to narrow down to web-pages of interest. In particular, there is a pressing need for a global infrastructure for surveillance and management of infectious diseases<xref rid="R43" ref-type="bibr">43</xref>,<xref rid="R44" ref-type="bibr">44</xref>. Until now, this has not been possible. We have developed a data structure (BIGSI) to meet this need, and have indexed the entire bacterial and viral WGS content of the global DNA archive. BIGSI allows tracking of several key entities: genes, SNPs, plasmids, MLST types, or clusters defined by SNPs. Importantly, new datasets can be readily and quickly added to our index, allowing it to grow as new datasets are sequenced. Our indexing method works for both raw data and assembled genomes, so it is poised for a future in which finished reference genomes are routine.</p>
    <p id="P24">BIGSI was designed with SNP or indel genotyping and allele search queries in mind. It allows a user to identify datasets worthy of in-depth study, as well as enabling global monitoring of specific alleles. Nevertheless, BIGSI has limitations, which it shares with previous k-mer tools such as the SBT; we give the main ones here, but also see <xref ref-type="sec" rid="S8">Online Methods</xref>. It is a k-mer index and is therefore as lossy as all de Bruijn methods. Reconstruction of stored genomes is impossible and repeat regions cannot be resolved. Also BIGSI does not store coverage information which rules out queries in which copy number is important. One example of such a query is detecting azithromycin resistance in <italic>Neisseria gonorrhoeae</italic>, in which the level of resistance is mediated by the number of rRNA genes containing a particular SNP<xref rid="R45" ref-type="bibr">45</xref>. BIGSI only supports nucleotide k-mers although we would note that an extension to amino acid search would be straightforward, because bloom filters are agnostic to what they are storing. Finally, BIGSI is optimized for very diverse datasets, in which the combined unique k-mer count is much higher than that of any individual sample e.g. the entire microbial ENA/SRA. Where samples are less diverse (eg. human), we expect SSBT or Mantis to be a better choice, as they take advantage of compression from sample similarity.</p>
    <p id="P25">In the future we envisage that sequencing data volumes will continue to grow and the user-base that wants to access and exploit those data will increase to include clinical and public health practitioners. There will be a pressing need for quick and accurate sequence searches across the global corpus of microbial sequences. MASH combined with both nucleotide and protein BIGSI could be a powerful combined approach to achieve this goal. We are now investigating implementing our BIGSI as a live service at the EMBL-EBI, to be updated as data is added to the ENA. These and complementary approaches will put shared DNA resources at everyone’s fingertips.</p>
  </sec>
  <sec sec-type="methods" id="S8" specific-use="web-only">
    <title>Online Methods</title>
    <sec id="S9">
      <title>Code availability</title>
      <p id="P26">An open source implementation of BIGSI can be found at <ext-link ext-link-type="uri" xlink:href="https://github.com/phelimb/BIGSI">https://github.com/phelimb/BIGSI</ext-link>. BIGSI v0.3.0 supports disk-based indexing via Berkeley-DB, or rocksDB, and distributed in-memory (via redis (<ext-link ext-link-type="uri" xlink:href="https://redis.io">https://redis.io</ext-link>)) key-value stores and can be extended to any key-value store. The benchmarking uses the rocksDB key-value store, and v0.2.0 of BIGSI, and the all-microbial index uses Berkeley-DB and BIGSI version v0.1.7.</p>
    </sec>
    <sec id="S10">
      <title>BIGSI construction and querying</title>
      <p id="P27">BIGSI indexes a set of N (number of datasets) bloom filters by position in the bloom filter. Each bloom filter must be constructed with the same parameters (m, <italic>η</italic>), where m is the bloom filter’s length in bits and <italic>η</italic> is the number of hash functions applied to each k-mer. The same hash functions must also be used to construct each bloom filter. To construct a BIGSI, the N bloom filters are column-wise concatenate into a matrix. The row index and row bit-vectors are then inserted into a hash table or key-value store as key-value pairs so that row lookups can be done in O(1) time. This set of key-value pairs can be stored on disk, in memory or distributed across several machines and is indexed via a hash index (a b-tree would be an alternative option). To insert a new bloom filter we simply append it as a column to the existing bitmatrix. To query the BIGSI for a k-mer we hash the k-mer η times, look up the resulting keys in the key-value store, and take the bit-wise AND of the resulting bit-vectors (See <xref ref-type="fig" rid="F1">Figure 1</xref>).</p>
    </sec>
    <sec id="S11">
      <title>Parameter choices</title>
      <p id="P28">The choice of BIGSI parameters (m, <italic>η</italic>), depends on: the maximum number of k-mers expected in any dataset (<italic>K<sub>max</sub></italic>), the number of datasets (N) expected, the smallest number of unique k-mers in a query sequence (<italic>L<sub>min</sub></italic>) to be supported, the k-mer size (k) and the maximum number of acceptable false discoveries per query (<italic>q<sub>max</sub></italic>). The expected number of false discoveries (V) for any query can be calculated as <italic>q</italic> = <italic>E</italic>[<italic>V</italic>] = <italic>Np<sup>L</sup></italic> where p is the false positive rate of the bloom filter and <italic>L</italic> is the number of unique k-mers in the query, assuming independence of the k-mers and bloom filters. Parameters m and <italic>η</italic> determine false positive rate for a bloom filter with <italic>K<sub>max</sub></italic> elements – if there are fewer elements, then the false positive rate will be lower. We assume below that all bloom filters have the maximum number of unique k-mers inserted to give an upper bound on error rate. However, the independence assumption mentioned above is strictly speaking false for real data archives (such as the ENA/SRA) which have biased distribution of datasets across the phylogeny. If there is an enrichment of datasets from some genus, then those columns (bloom filters) will be more similar, and conditional on a false positive in one column, the probability of a false positive in the similar columns will be elevated.</p>
      <p id="P29">To keep q below a chosen threshold <italic>q</italic> &lt; <italic>q<sub>max</sub></italic> for a given N and k, p must be chosen to satisfy q for the smallest allowable number of unique k-mers in a query <italic>L<sub>min</sub></italic>: <disp-formula id="FD1"><mml:math display="block" id="M1" overflow="scroll"><mml:mrow><mml:msup><mml:mi>p</mml:mi><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mtext mathvariant="italic">min</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mtext mathvariant="italic">max</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mi>N</mml:mi></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p id="P30">Therefore, the desired bloom filter false positive rate is <disp-formula id="FD2"><mml:math display="block" id="M2" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mtext mathvariant="italic">max</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mi>N</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mtext mathvariant="italic">min</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p id="P31">Since, for a given number of inserted k-mers (n), and desired false positive rate (p), optimal bloom filter parameters can be determined by the following formula<xref rid="R48" ref-type="bibr">48</xref>
<disp-formula id="FD3"><mml:math display="block" id="M3" overflow="scroll"><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>n</mml:mi><mml:mtext mathvariant="italic">ln</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>ln</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD4"><mml:math display="block" id="M4" overflow="scroll"><mml:mrow><mml:mi>η</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mtext mathvariant="italic">ln</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ln</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> which becomes: <disp-formula id="FD5"><mml:math display="block" id="M5" overflow="scroll"><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mtext mathvariant="italic">max</mml:mtext></mml:mrow></mml:msub><mml:mtext mathvariant="italic">ln</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mtext mathvariant="italic">max</mml:mtext></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mtext mathvariant="italic">min</mml:mtext></mml:mrow></mml:msub><mml:mtext mathvariant="italic">ln</mml:mtext><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD6"><mml:math display="block" id="M6" overflow="scroll"><mml:mrow><mml:mi>η</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mtext mathvariant="italic">ln</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mtext mathvariant="italic">max</mml:mtext></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mtext mathvariant="italic">min</mml:mtext></mml:mrow></mml:msub><mml:mtext mathvariant="italic">ln</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p id="P32">For example, given <disp-formula id="FD7"><mml:math display="block" id="M7" overflow="scroll"><mml:mrow><mml:mi>N</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mn>6</mml:mn></mml:msup><mml:mo>;</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mtext mathvariant="italic">max</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mn>7</mml:mn></mml:msup><mml:mo>;</mml:mo><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mtext mathvariant="italic">min</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>31</mml:mn><mml:mspace width="0.3em"/><mml:mi>k</mml:mi><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>s</mml:mi><mml:mo>;</mml:mo><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>31</mml:mn><mml:mo>;</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mtext mathvariant="italic">max</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></disp-formula> the resulting expected number of false positives per k-mer lookup per bloom filter (p), would be: <disp-formula id="FD8"><mml:math display="block" id="M8" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mtext mathvariant="italic">max</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mi>N</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mtext mathvariant="italic">min</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mfrac><mml:mn>3</mml:mn><mml:mn>5</mml:mn></mml:mfrac></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mn>0.2511</mml:mn><mml:mo>…</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p id="P33">Solving the above equations gives: <disp-formula id="FD9"><mml:math display="block" id="M9" overflow="scroll"><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>28</mml:mn><mml:mo>,</mml:mo><mml:mn>755</mml:mn><mml:mo>,</mml:mo><mml:mn>176</mml:mn><mml:mo>;</mml:mo><mml:mi>η</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></disp-formula></p>
      <p id="P34">Finally we note that any path through the de Bruijn graph which was not in the original genome will be classified as present by BIGSI (as all the k-mers are present), creating a false positive which is not considered in the above modelling. This can only happen if a query includes k-mers repeated in a genome.</p>
    </sec>
    <sec id="S12">
      <title>BIGSI parameters for all-microbial-index</title>
      <p id="P35">We assume initially that a bacterial dataset contains at most 10 million k-mers since bacterial genomes are generally under 6 Mb in length, leaving 4 million k-mers available for some sequencing errors which escape de-noising, and plasmid variation. Unless otherwise specified we use BIGSI parameters m=25,000,000, <italic>η</italic> = 3 for all analyses. For these parameters, the upper bound on number of false discoveries, <italic>q<sub>max</sub></italic> for an SNP allele from a probe (flanks plus allele) of length (<italic>L<sub>min</sub></italic> 2k-1=61) is 10<sup>-9</sup> (if <italic>K<sub>max</sub></italic> = 10<sup>7</sup>, <italic>N</italic> = 10<sup>6</sup>).</p>
    </sec>
    <sec id="S13">
      <title>K-mer identity and scoring</title>
      <p id="P36">If, for example, the k-mer size is 31, each SNP difference between the query and the nearest sequence in the index causes a window of 31 absent k-mers. Therefore k-mer identity drops more rapidly than sequence identity; e.g for k=31, matches with sequence identity above 80% can be detected (<xref ref-type="supplementary-material" rid="SD2">Supplementary Figure 2</xref>). Therefore, BIGSI most naturally enables exact or close match searches, or situations where combinatorial searching is feasible, such as querying all sequences 2 SNP different from a given allele, or all single amino acid changes in a gene. Datasets containing matches for a more divergent allele can be sought by searching for subsequences (seeds).</p>
      <p id="P37">Although BIGSI does not carry out an alignment, an approximation to a megaBLAST alignment score can be inferred from the presence/absence pattern of k-mers in the query. To approximate a megaBLAST score, we take the presence/absence vector for a query of <italic>L</italic> k-mers. From this, we estimate the approximate number of mismatches of the query from the hit by counting the number of zeroes in contiguous runs of length greater than 1, and dividing by the k-mer size. From these estimated mismatches and matches we calculate a score for an ungapped alignment, with p-values calculated using the same scheme as BLAST. By default the costs are -2 for a mismatch and +1 for matched position. This approximation deteriorates as k-mer identity drops (see <xref ref-type="supplementary-material" rid="SD2">Supplementary Figure 2</xref>). Nevertheless, we show the strong correlation (r=0.998) between MegaBLAST score and BIGSI score for 100 <italic>E. coli</italic> AMR genes using a BIGSI of RefSeq-bacteria (release 81) in <xref ref-type="supplementary-material" rid="SD2">Supplementary Figure 3</xref>.</p>
    </sec>
    <sec id="S14">
      <title>Benchmarking query time and storage requirements of BIGSI, SBT, and SSBT</title>
      <p id="P38">We randomly chose 10,000 microbial cleaned de Bruijn graphs from the all-microbial-index accessions and we then further randomly sub-sampled these into collections of 10, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000 datasets. A BIGSI of each set of datasets was built with parameters (m = 2.5 × 10<sup>7</sup>;<italic>η</italic> = 3). A SBT and SSBT were built for each set of datasets with <italic>η</italic> = 1 and bloom filter size (m) equal to the count of the total number of k-mers in the collections of graphs, as recommend in the text following Lemma 1 of Solomon et al<xref rid="R13" ref-type="bibr">13</xref>, called “SBT-fast” and “SSBT-fast” respectively. Redis hyperloglog was used to count the unique k-mers in the set of cleaned graphs for each increment. A SBT and a SSBT were built for each dataset with m = 2.5 × 10<sup>7</sup>;<italic>η</italic> = 3 (the same bloom filter parameters as BIGSI), called “SBT-small” and “SSBT-small”.</p>
      <p id="P39">Construction and query time analyses were run on an Amazon Web Service i3.8xlarge instance with 32vCPUs, 224 GiB of memory and 4 x 1.9 TB non-volatile SSD-backed instance storage. SBT-fast construction exceeded 1TB for 3000 datasets, the practical limit we set, and as a result SBT-fast was not built for increments above 2,000 datasets.</p>
      <p id="P40">The search time comparison was run with ‘bt query‘ and ‘bigsi search –seqfile $f‘, using k-mer thresholds 40% and 100%. A full table of results can be found in <xref ref-type="supplementary-material" rid="SD3">Supplementary Data 6</xref>.</p>
      <p id="P41">As mentioned above, SBT-fast and SSBT-fast construction failed for databases &gt; 2,000 due to excessive disk requirements, but we were able to calculate a lower bound for the peak disk-use for database sizes &gt; 2,000; query times were extrapolated linearly (these points are shown as triangles on <xref ref-type="fig" rid="F3">Figure 3</xref>; details of lower bound below).</p>
      <p id="P42">There were approximately 4.4 × 10<sup>9</sup> unique k-mers in the union of all 10,000 datasets, almost 1000 times more than in a typical individual dataset. It would require ~11TB of storage to build SBT-fast, 350X more space than is required by BIGSI. By contrast, querying SBT-small took 65X longer and SSBT-small 448X longer than a BIGSI of the same database size (N=10,000). SSBT-small was nearly 7X slower than SBT-small, perhaps due to the lower proportion of shared k-mers between datasets. Even for this small benchmark dataset, constructing unsaturated (i.e. fast) SBTs and SSBTs for larger numbers of datasets is prohibitive in terms of storage requirements; we address scaling further below. Query times for SBT/SSBT-slow were unacceptable for this benchmark, and so we excluded them as candidates for storing the ENA/SRA, which is 50X bigger than this benchmark dataset.</p>
      <p id="P43">Simulation of storage requirements for a BIGSI for N datasets is given by: <disp-formula id="FD10"><mml:math display="block" id="M10" overflow="scroll"><mml:mrow><mml:mi>B</mml:mi><mml:mi>I</mml:mi><mml:mi>G</mml:mi><mml:mi>S</mml:mi><mml:msub><mml:mi>I</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">[</mml:mo><mml:mi>b</mml:mi><mml:mi>y</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>m</mml:mi><mml:mi>N</mml:mi></mml:mrow><mml:mn>8</mml:mn></mml:mfrac></mml:mrow></mml:math></disp-formula></p>
      <p id="P44">Although it is possible to append to an SBT incrementally, as new microbial datasets will keep adding new k-mers, this will lead to saturation of the root-level bloom filter in the SBT, and a collapse in query performance. This can be avoided by reconstructing the SBT, ensuring the bloom filters are large enough to support the full set of k-mers. This was borne out by our benchmarking. In simulating scaling to a million genomes, we therefore focussed on SBT-fast rather than SBT-small. As the best case for a binary tree with N leaves is 2N-1 nodes, we estimate: <disp-formula id="FD11"><mml:math display="block" id="M11" overflow="scroll"><mml:mrow><mml:mi>S</mml:mi><mml:mi>B</mml:mi><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">[</mml:mo><mml:mi>b</mml:mi><mml:mi>y</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mn>8</mml:mn></mml:mfrac></mml:mrow></mml:math></disp-formula> where <italic>N<sub>k</sub></italic> is the total number of k-mers in the combined set of datasets and also equal to the size of the bloom filter required. This is a lower bound for the peak storage use. See Supplementary Data 6, for the close correspondence between this theoretical estimate and the empirical measurement in our benchmark datasets. As a result, we can calculate lower bounds for the peak disk usage for SBT/SSBT; when the explosion of disk usage made construction of indexes for the benchmark datasets with size&gt;2000 datasets, we used this lower bound to plot (suitably labelled) extrapolated datapoints.</p>
    </sec>
    <sec id="S15">
      <title>Benchmarking against Mantis</title>
      <p id="P45">We attempted to benchmark against Mantis but despite assistance from the authors we were unable to resolve a number of issues: large numbers of false positive hits on some data, and a bug causing segmentation faults when trying to build more than 3000 datasets. We reluctantly excluded Mantis from our benchmarking due to limitations of time. As currently implemented, the Mantis data structure does not support incremental insertion, as it needs up-front the full set of k-mers and for each k-mer, the list of datasets containing it (“colour class”, stored as a bit-vector). There is currently an intermediate stage where the uncompressed colour-class matrix is held in RAM, scaling quadratically in number of datasets.</p>
    </sec>
    <sec id="S16">
      <title>Benchmarking query time and storage requirements of BIGSI on RNA-seq data</title>
      <p id="P46">De Bruijn graphs (k=31) were constructed and cleaned from the downloaded RNA-seq fastq files listed in<xref rid="R13" ref-type="bibr">13</xref>. A BIGSI was built with bloom filter parameters <italic>m</italic> = 4000000000; <italic>η</italic> = 1 by chunking into 1,600 batches, building in parallel and then combining into a final index. The SBT and the 214,294 transcripts were provided by the authors (personal correspondence). 1,000 transcripts were randomly selected from the full set and queried with ‘bt query‘ and ‘bigsi search –seqfile $f‘ respectively. Since the SBT was pre-built by the authors, and therefore compressed, we used a RocksDB back-end store for BIGSI, which used Snappy (<ext-link ext-link-type="uri" xlink:href="https://google.github.io/snappy/">https://google.github.io/snappy/</ext-link>) for bitslice compression. This gave us a compressed BIGSI index, allowing us to compare compressed index size.</p>
    </sec>
    <sec id="S17">
      <title>Using an array of BIGSI to support variable dataset size</title>
      <p id="P47">A limitation of BIGSI is that <italic>K<sub>max</sub></italic>, the maximum number of k-mers per dataset, must be set in advance. One way to extend BIGSI to datasets with varying k-mer cardinality (e.g. metagenomic data) is to build multiple BIGSIs with different <italic>K<sub>max</sub></italic>, e.g. <italic>K<sub>max</sub></italic> = 10<sup>5</sup>, 10<sup>6</sup>, 10<sup>7</sup>, <italic>etc</italic> …, and insert each sequence into the appropriate level by k-mer counting before insertion. Queries can then be sent to all the indexes in parallel and then results combined.</p>
    </sec>
    <sec id="S18">
      <title>Genotyping accuracy measurement on TB</title>
      <p id="P48">Conservative SNP calls were made using Cortex<xref rid="R17" ref-type="bibr">17</xref> (independent workflow, k=31) on 3480 <italic>Mycobacterium tuberculosis</italic> datasets from Walker et al<xref rid="R27" ref-type="bibr">27</xref>. Singleton variants were discarded, and a de-duplicated list of 68,695 SNPs was constructed. We generated “probe sets” consisting of a reference and alternate alleles of these variants from the NC_000962.3 reference. An index of the 3,480 datasets was built and 100 random datasets were genotyped at the 68,695 sites as follows: Each allele of the probe-set is searched for in the BIGSI resulting in Boolean presence/absence of each allele. This requires querying for multiple probes for each variant. If only a reference allele is present the genotype is returned as 0/0, if only an alternate allele 1/1, if both 0/1 and if neither -/-. We compared the concordance of genotypes of the 100 random datasets with those generated with the samtools pipeline from Walker et al<xref rid="R27" ref-type="bibr">27</xref>, excluding filtered positions. As described in the main text, the concordance between methods was 99.997% with a total of 286/682,690 discrepancies. The majority of these discrepancies (203/286) were mixed (heterozygous) calls from BIGSI; samtools had been run with a haploid model it did not make any mixed calls, so we expect some of these were correct.</p>
    </sec>
    <sec id="S19">
      <title>Indexing of ENA snapshot</title>
      <p id="P49">The fastqs from accessions listed in Supplementary Data 7 were downloaded via ENA’s Globus FTP and included all WGS bacteria and viruses, but also eukaryotic parasites with larger genomes, which we did not intend to index. We removed the eukaryotic genomes implicitly, by setting thresholds to exclude datasets with too many k-mers for a 5Mb genome. De Bruijn graphs (k=31) were constructed and cleaned from the downloaded fastq files using mccortex<xref rid="R19" ref-type="bibr">19</xref> v0.0.3-539-g22e27b7.</p>
      <p id="P50">mccortex31 build -t 1 -m 7G -k 31 -s "DATASET_ID" -1 “FASTQ_FILES”</p>
      <p id="P51">mccortex31 clean -m 7GB -B 2 -U -T</p>
      <p id="P52">De Bruijn graph error cleaning and tip trimming were performed using mccortex. Bloom filters were built using the k-mers from the cleaned graphs with parameters (m = 2.5 × 10<sup>7</sup>;<italic>η</italic> = 3, <italic>K<sub>max</sub></italic> = 10<sup>7</sup>) with BIGSI v0.2 as follows:</p>
      <p id="P53">cbg init –k 31 –m 25000000 –h 3</p>
      <p id="P54">cbg bloom –c “CLEANED_GRAPH_FILE”</p>
      <p id="P55">Of the full set of datasets, 4.6% (21,822/ 469,654) fastq files failed to produce a resulting bloom filter. Of these 21,822: 7,799 exceed the maximum number of k-mers allowed after error cleaning (namely 10<sup>7</sup>) and 14,023 exceeded the maximum number of k-mers allowed in the raw dataset (namely ~7x10<sup>9</sup>).</p>
      <p id="P56">The unique k-mers in the union of the cleaned graphs were counted using the redis (v3.2.6) hyperloglog (<ext-link ext-link-type="uri" xlink:href="https://redis.io/commands#hyperloglog">https://redis.io/commands#hyperloglog</ext-link>) approximate cardinality counter. In the union of all cleaned graphs there were 6.05 × 10<sup>10</sup> ± 5 × 10<sup>7</sup> k-mers. We estimate this number would have been at least an order of magnitude higher without the denoising step where mccortex removed sequencing errors.</p>
    </sec>
    <sec id="S20">
      <title>Species identification</title>
      <p id="P57">The proportion of species in each dataset was determined using Kraken<xref rid="R32" ref-type="bibr">32</xref> and Bracken<xref rid="R31" ref-type="bibr">31</xref>. Kraken v0.10.5 was run on the k-mers from each cleaned de Bruijn graph using the minikraken 20141208 database. The resulting taxonomy labels assigned by Kraken were then analysed by Bracken vfd88a06a to estimate the proportion of k-mers originating from each species present in a dataset. Bracken failed to report species abundance for 12,889 datasets. The taxonomic data for the remaining 434,944 datasets is reported in Supplementary Data 6.</p>
    </sec>
    <sec id="S21">
      <title>Plasmid search and exclusion of contaminated datasets</title>
      <p id="P58">2,826 plasmid sequences were taken from the ENA plasmid pages (<ext-link ext-link-type="uri" xlink:href="www.ebi.ac.uk/genomes/plasmid.html">www.ebi.ac.uk/genomes/plasmid.html</ext-link>; December 2016) (See Supplementary Data 2) and downloaded from the ENA. We then queried the all-microbial-index for these sequences with a proportion of k-mers threshold of 40% (T=40%) present and filtered for hits with T &gt;= 90% for downstream analysis. Queries were run with 1 GB cachesize (memory) per process and parallelised across 8 vCPUs.</p>
      <p id="P59">In order to determine distribution of plasmids across taxa, while avoiding ENA/SRA metadata errors, we filtered these hits for datasets which (were bacteria and) had no secondary genus above 0.1% frequency. This criterion was chosen to avoid multi copy plasmids from contaminating species establishing false positive hits within a non-host genus. 41% (184652/447,833) of accessions and 62% (415,181/668,720) of search hits passed this filter. We then filtered for all plasmids which had been seen at least 5 times each in more than one genus and had less than 99% of their observations in the most frequent genus. We found 37 plasmids across 13 genera matched these criteria. By simulating mixtures of <italic>S. enterica</italic> and <italic>E. coli</italic> at relative abundances of 0.0001, 0.001, 0.01, 0.02, 0.05, 0.1, 0.15, 0.2, 0.25, 0.3 we found we could observe the minority species above 2% frequency (the limit of detection was not lower because we had applied Kraken <italic>after</italic> error-cleaning of de Bruijn graphs). All 37 plasmids reported had at least one observation at a copy number of 5 (which, since we could detect contaminants at 2% frequency, would correspond to a copy number of above 250 if it came from a contaminant) and 16/37 had an observation at 2000x copy number.</p>
    </sec>
    <sec id="S22">
      <title>Phylogenetic spread of plasmids</title>
      <p id="P60">We excluded contaminated samples as above, and plasmids with no hits in the all-microbial-index. We used the APE R package to calculate a cophenetic distance matrix between all genera in the Silva large subunit ribosomal RNA tree (release s123_LSU, <ext-link ext-link-type="uri" xlink:href="https://www.arb-silva.de/projects/living-tree/">https://www.arb-silva.de/projects/living-tree/</ext-link>). For all plasmids, we took the N genera in which they were found and calculated the N-choose-2 distances between these using the above matrix, and took the median (mean showed same result).</p>
    </sec>
    <sec id="S23">
      <title>Conjugative system search</title>
      <p id="P61">MOB (MOB_B, MOB_C, MOB_CQ, MOB_F, MOB_H, MOB_P,MOB_T, MOB_V) and T4SS sequences (VirB4_TRaU, VirD4_TcpA) as defined in Guglielmini et al <xref rid="R39" ref-type="bibr">39</xref> and Supplementary Data 8 in the all-microbial-index with T=100%. Full search results are available in Supplementary Data 9. Results were filtered for bacteria and contamination following the same method as described in “Plasmid search”. Accessions with at least one MOB and T4SS were said to contain a putative conjugative system. BIGSI does not return copy number, or location on chromosome or plasmid, so it was not possible to determine if the genes were co-located on a chromosome or on a plasmid.</p>
    </sec>
    <sec id="S24">
      <title>MCR-1,2,3</title>
      <p id="P62">We searched for MCR-1, MCR-2, MCR-3 in the all-microbial-index using k-mer percent threshold T=100%. See Supplementary Data 1 for sequences and results.</p>
    </sec>
    <sec id="S25">
      <title>Searching for ABR genes in the ENA</title>
      <p id="P63">We downloaded all 2157 sequences associated with antimicrobial resistance from the CARD database (v1.1.7)<xref rid="R40" ref-type="bibr">40</xref>. We searched for these in the all-microbial-index with thresholds of 100% and 70%, using a 1 Gb cache size, and 8 CPUs. A full table of the search results can be found in Supplementary Data 5.</p>
    </sec>
    <sec id="S26">
      <title>Searching for <italic>M. tuberculosis</italic> variants in the ENA</title>
      <p id="P64">We searched the all-microbial-index for the variants from the catalogue described in <xref rid="R27" ref-type="bibr">27</xref> by generating “probe sets” consisting of a reference and alternate alleles of these variants from the NC_000962.3 reference and searching for these alleles. If only a reference allele is present the genotype is returned as 0/0, if only an alternate allele 1/1, if both 0/1 and if neither -/-. From the resulting genotypes we classified each of the datasets as resistant or susceptible to 12 antibiotics following the model described in<xref rid="R27" ref-type="bibr">27</xref>. The date when this data was first available to the public was extracted from its ENA metadata. Datasets were classed as MDR (multi-drug resistant) if resistant to isoniazid and rifampicin, as XDR (extensively drug-resistant) if MDR and also resistant to a fluoroquinolone, and any of capreomycin, kanamycin and amikacin, and as Resistant if resistant to any antibiotic but not MDR or XDR, and susceptible otherwise.</p>
    </sec>
    <sec id="S27">
      <title>Trade-offs and limitations in BIGSI</title>
      <p id="P65">BIGSI can be considered a coloured de Bruijn graph, but we would note that it is optimized for search (genotyping), not traversal of the graph. Although one could search for remote homologs using exact matching of short seeds followed by graph traversal, this would require additional software development to handle false positive edges. BIGSI is able to achieve speed, compression and accuracy by using queries that are longer than the indexing k-mer size (here 31) – the relatively highly false-positive rate at a single k-mer is dropped exponentially with each extra unique k-mer in the query. This does however mean that short or low-complexity queries should only be used in circumstances where a higher error rate is acceptable (e.g. we require &gt;=63bp queries and &gt;=21 unique kmers for the all-microbial-index).</p>
    </sec>
    <sec sec-type="data-availability" id="S28">
      <title>Data availability</title>
      <p id="P66">All of the underlying genomic data for this study is publicly available at the ENA.</p>
      <p id="P67"><xref ref-type="supplementary-material" rid="SD3">Supplementary Tables 1-3</xref> are available in a single supplementary document.</p>
      <p id="P68"><xref ref-type="supplementary-material" rid="SD2">Supplementary Figures 1-8</xref> are available in a single supplementary document.</p>
      <p id="P69">Supplementary Data files 1-7 can be found here: <ext-link ext-link-type="uri" xlink:href="ftp.ebi.ac.uk/pub/software/bigsi/nat_biotech_2018/supp">ftp.ebi.ac.uk/pub/software/bigsi/nat_biotech_2018/supp</ext-link>. Contents are : data 1-MCR search results, data 2 – plasmid search results, data 3 – counts of 5 specific plasmids across genera, data 4 – counts of MOB types across genera, data 5 – CARD antibiotic resistance gene search results (T=70%), data 6 – benchmarking results, data 7 – Bracken taxonomic results, data 8 – MOB type definition fasta, data 9 - MOB and T4SS search results (T=100%).</p>
      <p id="P70">The all-microbial-index itself is available here: <ext-link ext-link-type="uri" xlink:href="ftp.ebi.ac.uk/pub/software/bigsi/nat_biotech_2018/all-microbial-index/">ftp.ebi.ac.uk/pub/software/bigsi/nat_biotech_2018/all-microbial-index/</ext-link>. In order to facilitate reproducibility for others without having to download and process 170Tb of raw data, we make the 26Tb of cleaned de Bruijn (binary) graph files for the entire all-microbial-index snapshot of the ENA available at <ext-link ext-link-type="uri" xlink:href="ftp.ebi.ac.uk/pub/software/bigsi/nat_biotech_2018/ctx">ftp.ebi.ac.uk/pub/software/bigsi/nat_biotech_2018/ctx</ext-link>. An archive of our code, plus the underlying data for our figures, can be found here: at <ext-link ext-link-type="uri" xlink:href="ftp.ebi.ac.uk/pub/software/bigsi/nat_biotech_2018/code">ftp.ebi.ac.uk/pub/software/bigsi/nat_biotech_2018/code</ext-link> and at <ext-link ext-link-type="uri" xlink:href="ftp.ebi.ac.uk/pub/software/bigsi/nat_biotech_2018/data_underlying_figures">ftp.ebi.ac.uk/pub/software/bigsi/nat_biotech_2018/data_underlying_figures</ext-link></p>
      <p id="P71">We have also made a public instance of our index of the ENA available at <ext-link ext-link-type="uri" xlink:href="http://bigsi.io">http://bigsi.io</ext-link>, where the user can paste sequence and search. This instance uses BIGSI v0.1.7 (using berkeleyDB) and is hosted by CLIMB (<ext-link ext-link-type="uri" xlink:href="http://www.climb.ac.uk/">http://www.climb.ac.uk/</ext-link>) on a 3Tb RAM server.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="SM">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>Reporting Summary</label>
      <media xlink:href="NIHMS80982-supplement-Reporting_Summary.pdf" mimetype="application" mime-subtype="pdf" orientation="portrait" xlink:type="simple" id="d36e1628" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>Suppl figures</label>
      <media xlink:href="NIHMS80982-supplement-Suppl_figures.docx" mimetype="application" mime-subtype="octet-stream" orientation="portrait" xlink:type="simple" id="d36e1632" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD3">
      <label>Suppl tables</label>
      <media xlink:href="NIHMS80982-supplement-Suppl_tables.docx" mimetype="application" mime-subtype="octet-stream" orientation="portrait" xlink:type="simple" id="d36e1636" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S29">
    <title>Acknowledgements</title>
    <p>We would like to thank, for critical reading and helpful suggestions: Grace Blackwell, Robyn Ffrancon, Martin Hunt, Jerome Kelleher, Janet Thornton, Rob Patro, Kerri Malone, John Marioni, Andrew Page, Simon Gog, Timo Bellman, Florian Gauger. For enormous assistance with data download from EBI: Robert Esnouf, Guy Cochrane. For hosting our BIGSI demonstration: CLIMB. We acknowledge funding from Wellcome Trust Core Award Grant Number 203141/Z/16/Z. ZI was funded by a Wellcome Trust/Royal Society Sir Henry Dale Fellowship, grant number 102541/A/13/Z. GM was funded by Wellcome Trust grant 100956/Z/13/Z. ER was funded by the ANR MAGISBAC grant number ANR-14-CE10-0007-02. PB was funded by Wellcome Trust Studentship H5RZCO00.</p>
  </ack>
  <fn-group>
    <fn fn-type="con" id="FN1">
      <p id="P72">
        <bold>Author Contributions</bold>
      </p>
      <p id="P73">ZI, GM designed and oversaw the study, PB invented the method, developed software and performed analyses, HdB performed analyses for the plasmid study, EPCR co-designed and analysed the conjugative system and plasmid analysis, ZI wrote the paper, all authors made detailed feedback on the paper.</p>
    </fn>
    <fn fn-type="COI-statement" id="FN2">
      <p id="P74">
        <bold>Competing Financial Interests</bold>
      </p>
      <p id="P75">GM is a cofounder of, holder of shares in, and consultant to Genomics PLC.</p>
    </fn>
  </fn-group>
  <ref-list>
    <ref id="R1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bradley</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Rapid antibiotic-resistance predictions from genome sequence data for Staphylococcus aureus and Mycobacterium tuberculosis</article-title>
        <source>Nat Commun</source>
        <year>2015</year>
        <volume>6</volume>
        <comment>10063</comment>
        <pub-id pub-id-type="doi">10.1038/ncomms10063</pub-id>
      </element-citation>
    </ref>
    <ref id="R2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Brown</surname>
            <given-names>AC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Rapid Whole-Genome Sequencing of Mycobacterium tuberculosis Isolates Directly from Clinical Samples</article-title>
        <source>J Clin Microbiol</source>
        <year>2015</year>
        <volume>53</volume>
        <fpage>2230</fpage>
        <lpage>2237</lpage>
        <pub-id pub-id-type="doi">10.1128/JCM.00486-15</pub-id>
        <pub-id pub-id-type="pmid">25972414</pub-id>
      </element-citation>
    </ref>
    <ref id="R3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Quick</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Real-time, portable genome sequencing for Ebola surveillance</article-title>
        <source>Nature</source>
        <year>2016</year>
        <volume>530</volume>
        <fpage>228</fpage>
        <lpage>232</lpage>
        <pub-id pub-id-type="doi">10.1038/nature16996</pub-id>
        <pub-id pub-id-type="pmid">26840485</pub-id>
      </element-citation>
    </ref>
    <ref id="R4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schmidt</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of bacterial pathogens and antimicrobial resistance directly from clinical urines by nanopore-based metagenomic sequencing</article-title>
        <source>J Antimicrob Chemother</source>
        <year>2017</year>
        <volume>72</volume>
        <fpage>104</fpage>
        <lpage>114</lpage>
        <pub-id pub-id-type="doi">10.1093/jac/dkw397</pub-id>
        <pub-id pub-id-type="pmid">27667325</pub-id>
      </element-citation>
    </ref>
    <ref id="R5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Votintseva</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Same-Day Diagnostic and Surveillance Data for Tuberculosis via Whole-Genome Sequencing of Direct Respiratory Samples</article-title>
        <source>J Clin Microbiol</source>
        <year>2017</year>
        <volume>55</volume>
        <fpage>1285</fpage>
        <lpage>1298</lpage>
        <pub-id pub-id-type="doi">10.1128/JCM.02483-16</pub-id>
        <pub-id pub-id-type="pmid">28275074</pub-id>
      </element-citation>
    </ref>
    <ref id="R6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shea</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive Whole-Genome Sequencing and Reporting of Drug Resistance Profiles on Clinical Cases of Mycobacterium tuberculosis in New York State</article-title>
        <source>J Clin Microbiol</source>
        <year>2017</year>
        <volume>55</volume>
        <fpage>1871</fpage>
        <lpage>1882</lpage>
        <pub-id pub-id-type="doi">10.1128/JCM.00298-17</pub-id>
        <pub-id pub-id-type="pmid">28381603</pub-id>
      </element-citation>
    </ref>
    <ref id="R7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Altschul</surname>
            <given-names>SF</given-names>
          </name>
          <name>
            <surname>Gish</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Miller</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Myers</surname>
            <given-names>EW</given-names>
          </name>
          <name>
            <surname>Lipman</surname>
            <given-names>DJ</given-names>
          </name>
        </person-group>
        <article-title>Basic local alignment search tool</article-title>
        <source>J Mol Biol</source>
        <year>1990</year>
        <volume>215</volume>
        <fpage>403</fpage>
        <lpage>410</lpage>
        <pub-id pub-id-type="doi">10.1016/S0022-2836(05)80360-2</pub-id>
        <pub-id pub-id-type="pmid">2231712</pub-id>
      </element-citation>
    </ref>
    <ref id="R8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kent</surname>
            <given-names>WJ</given-names>
          </name>
        </person-group>
        <article-title>BLAT--the BLAST-like alignment tool</article-title>
        <source>Genome Res</source>
        <year>2002</year>
        <volume>12</volume>
        <fpage>656</fpage>
        <lpage>664</lpage>
        <comment>Article published online before March 2002</comment>
        <pub-id pub-id-type="doi">10.1101/gr.229202</pub-id>
        <pub-id pub-id-type="pmid">11932250</pub-id>
      </element-citation>
    </ref>
    <ref id="R9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Morgulis</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Database indexing for production MegaBLAST searches</article-title>
        <source>Bioinformatics</source>
        <year>2008</year>
        <volume>24</volume>
        <fpage>1757</fpage>
        <lpage>1764</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btn322</pub-id>
        <pub-id pub-id-type="pmid">18567917</pub-id>
      </element-citation>
    </ref>
    <ref id="R10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Arredondo-Alonso</surname>
            <given-names>AWR</given-names>
          </name>
          <name>
            <surname>Schaik</surname>
            <given-names>WV</given-names>
          </name>
          <name>
            <surname>Schurch</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>On the (im)possibility of reconstructing plasmids from whole-genome short-read sequencing data</article-title>
        <source>Microbial Genomics</source>
        <year>2017</year>
        <pub-id pub-id-type="doi">10.1099/mgen.0.000128</pub-id>
      </element-citation>
    </ref>
    <ref id="R11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bradnam</surname>
            <given-names>KR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Assemblathon 2: evaluating de novo methods of genome assembly in three vertebrate species</article-title>
        <source>Gigascience</source>
        <year>2013</year>
        <volume>2</volume>
        <fpage>10</fpage>
        <pub-id pub-id-type="doi">10.1186/2047-217X-2-10</pub-id>
        <pub-id pub-id-type="pmid">23870653</pub-id>
      </element-citation>
    </ref>
    <ref id="R12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Earl</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Assemblathon 1: a competitive assessment of de novo short read assembly methods</article-title>
        <source>Genome Res</source>
        <year>2011</year>
        <volume>21</volume>
        <fpage>2224</fpage>
        <lpage>2241</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.126599.111</pub-id>
        <pub-id pub-id-type="pmid">21926179</pub-id>
      </element-citation>
    </ref>
    <ref id="R13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Solomon</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Kingsford</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Fast search of thousands of short-read sequencing experiments</article-title>
        <source>Nat Biotechnol</source>
        <year>2016</year>
        <volume>34</volume>
        <fpage>300</fpage>
        <lpage>302</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3442</pub-id>
        <pub-id pub-id-type="pmid">26854477</pub-id>
      </element-citation>
    </ref>
    <ref id="R14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pandey</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mantis: A Fast, Small, and Exact Large-Scale Sequence-Search Index</article-title>
        <source>Cell Syst</source>
        <year>2018</year>
        <volume>7</volume>
        <fpage>201</fpage>
        <lpage>207 e204</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2018.05.021</pub-id>
        <pub-id pub-id-type="pmid">29936185</pub-id>
      </element-citation>
    </ref>
    <ref id="R15">
      <label>15</label>
      <element-citation publication-type="confproc">
        <person-group person-group-type="author">
          <name>
            <surname>Solomon</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Kingsford</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <conf-name>International Conference on Research in Computational Molecular Biology</conf-name>
        <publisher-name>Springer</publisher-name>
        <fpage>257</fpage>
        <lpage>271</lpage>
      </element-citation>
    </ref>
    <ref id="R16">
      <label>16</label>
      <element-citation publication-type="confproc">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Harris</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Chikhi</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Medvedev</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <conf-name>International Conference on Research in Computational Molecular Biology</conf-name>
        <publisher-name>Springer</publisher-name>
        <fpage>272</fpage>
        <lpage>286</lpage>
      </element-citation>
    </ref>
    <ref id="R17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Iqbal</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Caccamo</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Turner</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Flicek</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>McVean</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>De novo assembly and genotyping of variants using colored de Bruijn graphs</article-title>
        <source>Nat Genet</source>
        <year>2012</year>
        <volume>44</volume>
        <fpage>226</fpage>
        <lpage>232</lpage>
        <pub-id pub-id-type="doi">10.1038/ng.1028</pub-id>
        <pub-id pub-id-type="pmid">22231483</pub-id>
      </element-citation>
    </ref>
    <ref id="R18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Muggli</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Succinct colored de Bruijn graphs</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <fpage>3181</fpage>
        <lpage>3187</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btx067</pub-id>
        <pub-id pub-id-type="pmid">28200001</pub-id>
      </element-citation>
    </ref>
    <ref id="R19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Turner</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Garimella</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Iqbal</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>McVean</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Integrating long-range connectivity information into de Bruijn graphs</article-title>
        <source>Biorxiv</source>
        <year>2017</year>
        <pub-id pub-id-type="doi">10.1101/147777</pub-id>
      </element-citation>
    </ref>
    <ref id="R20">
      <label>20</label>
      <element-citation publication-type="confproc">
        <person-group person-group-type="author">
          <name>
            <surname>Almodaresi</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Pandey</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Patro</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <conf-name>17th International Workshop on Algorithms in Bioinformatics (WABI 2017)</conf-name>
        <publisher-name>Schloss Dagstuhl--Leibniz-Zentrum fuer Informatik</publisher-name>
      </element-citation>
    </ref>
    <ref id="R21">
      <label>21</label>
      <element-citation publication-type="confproc">
        <person-group person-group-type="author">
          <name>
            <surname>Wong</surname>
            <given-names>HKT</given-names>
          </name>
          <name>
            <surname>L</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Olken</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Rotem</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Wong</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <conf-name>Proceedings of the 11th international conference on Very Large Data Bases</conf-name>
        <person-group person-group-type="editor">
          <name>
            <surname>Pirotte</surname>
            <given-names>Alain</given-names>
          </name>
          <name>
            <surname>Vassiliou</surname>
            <given-names>Yannis</given-names>
          </name>
        </person-group>
        <publisher-loc>Stockholm, Sweden</publisher-loc>
        <year>1985</year>
        <volume>11</volume>
        <fpage>448</fpage>
        <lpage>457</lpage>
      </element-citation>
    </ref>
    <ref id="R22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shepherd</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>P</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Chu</surname>
            <given-names>CK</given-names>
          </name>
        </person-group>
        <article-title>A Fixed-Size Bloom Filter for Searching Textual Documents</article-title>
        <source>The Computer Journal</source>
        <year>1989</year>
        <volume>32</volume>
        <pub-id pub-id-type="doi">10.1093/comjnl/32.3.212</pub-id>
      </element-citation>
    </ref>
    <ref id="R23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zobel</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Moffat</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Ramamohanarao</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Inverted Files Versus Signature Files For Text Indexing</article-title>
        <source>ACM Trans Database Syst</source>
        <year>1998</year>
        <volume>23</volume>
        <fpage>453</fpage>
        <lpage>490</lpage>
        <pub-id pub-id-type="doi">10.1145/296854.277632</pub-id>
      </element-citation>
    </ref>
    <ref id="R24">
      <label>24</label>
      <element-citation publication-type="confproc">
        <person-group person-group-type="author">
          <name>
            <surname>Goodwin</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>H</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Luu</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Clemmer</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Curmei</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Elnikety</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>He</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <conf-name>40th International ACM SIGIR Conference on Research and Development in Information Retrieval</conf-name>
        <publisher-name>ACM</publisher-name>
      </element-citation>
    </ref>
    <ref id="R25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>BH</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Space/time trade-offs in hash coding with allowable errors</article-title>
        <source>Commun ACM</source>
        <year>1970</year>
        <volume>13</volume>
        <fpage>422</fpage>
        <lpage>426</lpage>
        <pub-id pub-id-type="doi">10.1145/362686.362692</pub-id>
      </element-citation>
    </ref>
    <ref id="R26">
      <label>26</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pell</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Scaling metagenome sequence assembly with probabilistic de Bruijn graphs</article-title>
        <source>Proc Natl Acad Sci U S A</source>
        <year>2012</year>
        <volume>109</volume>
        <fpage>13272</fpage>
        <lpage>13277</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1121464109</pub-id>
        <pub-id pub-id-type="pmid">22847406</pub-id>
      </element-citation>
    </ref>
    <ref id="R27">
      <label>27</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Walker</surname>
            <given-names>TM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Whole-genome sequencing for prediction of Mycobacterium tuberculosis drug susceptibility and resistance: a retrospective cohort study</article-title>
        <source>Lancet Infect Dis</source>
        <year>2015</year>
        <volume>15</volume>
        <fpage>1193</fpage>
        <lpage>1202</lpage>
        <pub-id pub-id-type="doi">10.1016/S1473-3099(15)00062-6</pub-id>
        <pub-id pub-id-type="pmid">26116186</pub-id>
      </element-citation>
    </ref>
    <ref id="R28">
      <label>28</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The Sequence Alignment/Map format and SAMtools</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>2078</fpage>
        <lpage>2079</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp352</pub-id>
        <pub-id pub-id-type="pmid">19505943</pub-id>
      </element-citation>
    </ref>
    <ref id="R29">
      <label>29</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Inouye</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SRST2: Rapid genomic surveillance for public health and hospital microbiology labs</article-title>
        <source>Genome Med</source>
        <year>2014</year>
        <volume>6</volume>
        <fpage>90</fpage>
        <pub-id pub-id-type="doi">10.1186/s13073-014-0090-6</pub-id>
        <pub-id pub-id-type="pmid">25422674</pub-id>
      </element-citation>
    </ref>
    <ref id="R30">
      <label>30</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pandey</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>A</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Bender</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Ferdman</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Johnson</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Patro</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Mantis: A Fast, Small, and Exact Large-Scale Sequence Search Index</article-title>
        <source>Biorxiv</source>
        <year>2017</year>
        <pub-id pub-id-type="doi">10.1101/217372</pub-id>
      </element-citation>
    </ref>
    <ref id="R31">
      <label>31</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>B</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Thielen</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <article-title>Bracken: estimating species abundance in metagenomics data</article-title>
        <source>PeerJ Computer Science</source>
        <year>2017</year>
        <volume>3</volume>
        <pub-id pub-id-type="doi">10.7717/peerj-cs.104</pub-id>
      </element-citation>
    </ref>
    <ref id="R32">
      <label>32</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wood</surname>
            <given-names>DE</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <article-title>Kraken: ultrafast metagenomic sequence classification using exact alignments</article-title>
        <source>Genome Biol</source>
        <year>2014</year>
        <volume>15</volume>
        <fpage>R46</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2014-15-3-r46</pub-id>
        <pub-id pub-id-type="pmid">24580807</pub-id>
      </element-citation>
    </ref>
    <ref id="R33">
      <label>33</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>IY</given-names>
          </name>
          <name>
            <surname>Gao</surname>
            <given-names>GF</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Dissemination of the mcr-1 colistin resistance gene</article-title>
        <source>Lancet Infect Dis</source>
        <year>2016</year>
        <volume>16</volume>
        <fpage>146</fpage>
        <lpage>147</lpage>
        <pub-id pub-id-type="doi">10.1016/S1473-3099(15)00533-2</pub-id>
        <pub-id pub-id-type="pmid">26711359</pub-id>
      </element-citation>
    </ref>
    <ref id="R34">
      <label>34</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lu</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MCR-1.6, a New MCR Variant Carried by an IncP Plasmid in a Colistin-Resistant Salmonella enterica Serovar Typhimurium Isolate from a Healthy Individual</article-title>
        <source>Antimicrob Agents Chemother</source>
        <year>2017</year>
        <volume>61</volume>
        <pub-id pub-id-type="doi">10.1128/AAC.02632-16</pub-id>
      </element-citation>
    </ref>
    <ref id="R35">
      <label>35</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Matamoros</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>H</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Arcilla</surname>
            <given-names>MS</given-names>
          </name>
          <name>
            <surname>Willemse</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Melles</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Penders</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Vinh</surname>
            <given-names>TN</given-names>
          </name>
          <name>
            <surname>Thi</surname>
            <given-names>HN</given-names>
          </name>
          <collab>COMBAT consortium</collab>
          <name>
            <surname>Jong</surname>
            <given-names>MDd</given-names>
          </name>
          <name>
            <surname>Schultsz</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Global Phylogenetic Analysis Of Escherichia coli And Plasmids Carrying The mcr-1 Gene Indicates Bacterial Diversity But Plasmid Restriction</article-title>
        <source>Biorxiv</source>
        <year>2017</year>
      </element-citation>
    </ref>
    <ref id="R36">
      <label>36</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xavier</surname>
            <given-names>BB</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of a novel plasmid-mediated colistin-resistance gene, mcr-2, in Escherichia coli, Belgium, June 2016</article-title>
        <source>Euro Surveill</source>
        <year>2016</year>
        <volume>21</volume>
        <pub-id pub-id-type="doi">10.2807/1560-7917.ES.2016.21.27.30280</pub-id>
      </element-citation>
    </ref>
    <ref id="R37">
      <label>37</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yin</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Novel Plasmid-Mediated Colistin Resistance Gene mcr-3 in Escherichia coli</article-title>
        <source>MBio</source>
        <year>2017</year>
        <volume>8</volume>
        <pub-id pub-id-type="doi">10.1128/mBio.00543-17</pub-id>
      </element-citation>
    </ref>
    <ref id="R38">
      <label>38</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ciric</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>J</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Elvira de Vries</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Agerso</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Mullany</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Roberts</surname>
            <given-names>AP</given-names>
          </name>
        </person-group>
        <article-title>The Tn916/Tn1545 Family of Conjugative Transposons</article-title>
        <source>Madame Curie Bioscience Database</source>
        <year>2013</year>
        <comment>[Internet]</comment>
      </element-citation>
    </ref>
    <ref id="R39">
      <label>39</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guglielmini</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Quintais</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Garcillan-Barcia</surname>
            <given-names>MP</given-names>
          </name>
          <name>
            <surname>de la Cruz</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Rocha</surname>
            <given-names>EP</given-names>
          </name>
        </person-group>
        <article-title>The repertoire of ICE in prokaryotes underscores the unity, diversity, and ubiquity of conjugation</article-title>
        <source>PLoS Genet</source>
        <year>2011</year>
        <volume>7</volume>
        <fpage>e1002222</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pgen.1002222</pub-id>
        <pub-id pub-id-type="pmid">21876676</pub-id>
      </element-citation>
    </ref>
    <ref id="R40">
      <label>40</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jia</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CARD 2017: expansion and model-centric curation of the comprehensive antibiotic resistance database</article-title>
        <source>Nucleic Acids Res</source>
        <year>2017</year>
        <volume>45</volume>
        <fpage>D566</fpage>
        <lpage>D573</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkw1004</pub-id>
        <pub-id pub-id-type="pmid">27789705</pub-id>
      </element-citation>
    </ref>
    <ref id="R41">
      <label>41</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eldholm</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Balloux</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Antimicrobial Resistance in Mycobacterium tuberculosis: The Odd One Out</article-title>
        <source>Trends Microbiol</source>
        <year>2016</year>
        <volume>24</volume>
        <fpage>637</fpage>
        <lpage>648</lpage>
        <pub-id pub-id-type="doi">10.1016/j.tim.2016.03.007</pub-id>
        <pub-id pub-id-type="pmid">27068531</pub-id>
      </element-citation>
    </ref>
    <ref id="R42">
      <label>42</label>
      <element-citation publication-type="book">
        <collab>Organisation WH</collab>
        <source>Global Tuberculosis Report 2017</source>
        <year>2017</year>
      </element-citation>
    </ref>
    <ref id="R43">
      <label>43</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gardy</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Loman</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Towards a genomics-informed, real-time, global pathogen surveillance system</article-title>
        <source>Nature Reviews Genetics</source>
        <year>2017</year>
      </element-citation>
    </ref>
    <ref id="R44">
      <label>44</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schatz</surname>
            <given-names>MC</given-names>
          </name>
          <name>
            <surname>Phillippy</surname>
            <given-names>AM</given-names>
          </name>
        </person-group>
        <article-title>The rise of a digital immune system</article-title>
        <source>Gigascience</source>
        <year>2012</year>
        <fpage>1</fpage>
        <lpage>4</lpage>
        <pub-id pub-id-type="doi">10.1186/2047-217X-1-4</pub-id>
        <pub-id pub-id-type="pmid">23587310</pub-id>
      </element-citation>
    </ref>
    <ref id="R45">
      <label>45</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eyre</surname>
            <given-names>DW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>WGS to predict antibiotic MICs for Neisseria gonorrhoeae</article-title>
        <source>J Antimicrob Chemother</source>
        <year>2017</year>
        <volume>72</volume>
        <fpage>1937</fpage>
        <lpage>1947</lpage>
        <pub-id pub-id-type="doi">10.1093/jac/dkx067</pub-id>
        <pub-id pub-id-type="pmid">28333355</pub-id>
      </element-citation>
    </ref>
    <ref id="R46">
      <label>46</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Durbin</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Fast and accurate short read alignment with Burrows-Wheeler transform</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>1754</fpage>
        <lpage>1760</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp324</pub-id>
        <pub-id pub-id-type="pmid">19451168</pub-id>
      </element-citation>
    </ref>
    <ref id="R47">
      <label>47</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Langmead</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Pop</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <article-title>Ultrafast and memory-efficient alignment of short DNA sequences to the human genome</article-title>
        <source>Genome Biol</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>R25</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2009-10-3-r25</pub-id>
        <pub-id pub-id-type="pmid">19261174</pub-id>
      </element-citation>
    </ref>
    <ref id="R48">
      <label>48</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Broder</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Mitzenmacher</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Network Applications of Bloom Filters: A Survey</article-title>
        <source>Internet Mathematics</source>
        <year>2004</year>
        <volume>1</volume>
        <fpage>485</fpage>
        <lpage>509</lpage>
        <pub-id pub-id-type="doi">10.1080/15427951.2004.10129096</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <boxed-text id="BX1" position="float" orientation="portrait">
    <caption>
      <title>Editors summary</title>
    </caption>
    <p>The global set of bacterial and viral sequences can be rapidly searched using a data structure inspired by web-search algorithms.</p>
  </boxed-text>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <title>Sequence matching methods.</title>
      <p>a) Mapping of sequence reads to a reference genome from the same species, assuming relatively low divergence; requirement to map millions of reads in acceptable time and return an alignment and mapping score. Common tools: bwa<xref rid="R46" ref-type="bibr">46</xref> and bowtie<xref rid="R47" ref-type="bibr">47</xref>. b) BLAST<xref rid="R7" ref-type="bibr">7</xref> compares a query string with a database of reference genomes (in the figure we show RefSeq genomes in a dotted box) covering a massive phylogenetic range. BLAST takes k-mers from the query, and for each k-mer it creates a “neighbourhood” of k-mers within a fixed edit distance (edits are shown in red, b(iii)), and searches for these in the reference genome database. Alignment is only done by extending from these hits. Blast can be applied to nucleotide and protein searches and can find close and remote homology matches. c) MASH stores a tiny fingerprint of each reference in the database (in this case RefSeq). Querying with an assembly, the fingerprint of the assembly is compared with that of RefSeq to find the closest reference. d) Sequence Bloom Tree<xref rid="R13" ref-type="bibr">13</xref> was the first scalable method to search through raw unassembled readsets (unassembled readsets are shown as “piles” of reads (short lines), all in same colour to signify same species), by indexing the k-mers in the data and then compressing the index. Designed for human data, SBT can be applied to find which RNA-seq datasets contain a given transcript. e) BIGSI can search the complete set of raw sequence data for bacteria and viruses. RefSeq is shown in a dotted box amongst unassembled readsets; different colours to signify the massive range of species and phyla. The different input data for SBT and BIGSI mean that these methods have different speed and compression trade-offs.</p>
    </caption>
    <graphic xlink:href="emss-80982-f001"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <title>BIGSI encoding.</title>
      <p>a) In step 1, each input dataset (raw sequence data in FASTQ format or assembly) is converted to a non-redundant list of k-mers (with an optional denoising step to remove sequencing errors, detailed in <xref ref-type="sec" rid="S8">Online Methods</xref>). A fixed set of <bold><italic>η</italic></bold> hash functions (<bold><italic>h</italic><sub>1</sub>, <italic>h</italic><sub>2</sub>, …</bold>) is applied to each k-mer (<bold><italic>η</italic></bold> =3 in this figure), giving a tuple of positions which are all set to 1 in a bit-vector (a Bloom Filter). b) In step 2 each dataset is stored as a fixed length bloom filter, as a column in a rectangular matrix. To query the BIGSI for k-mer AAT, the <bold><italic>η</italic></bold> hash functions are applied to the query k-mer, returning <bold><italic>η</italic></bold> rows to be checked (namely 3,7,5 here). All columns (datasets) that have 1 in all of those <bold><italic>η</italic></bold> rows contain the query k-mer: these rows that are checked are called “bitslices”. A hash, mapping from row index to corresponding bit-array is stored to allow fast, i.e. O(1), access to each row when needed. Adding a new dataset requires adding a new column. c) Naïve encoding is shown to contrast with the BIGSI approach. A complete list of all k-mers in all datasets form the rows of a large matrix, and columns are datasets. For any given k-mer, entries are set to one for datasets containing that k-mer. When a new dataset is added, the matrix grows vertically (new k-mers added) and horizontally (new column for new dataset).</p>
    </caption>
    <graphic xlink:href="emss-80982-f002"/>
  </fig>
  <fig id="F3" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <title>Speed and space trade-offs as index grows.</title>
      <p>Benchmarking of BIGSI against fast and small versions of each of SBT and SSBT, using a set of 2,157 antimicrobial resistance genes as a query dataset. We performed inexact search (T = 40%) and show query speed vs. peak disk size when searching databases of sizes from 10–10,000 microbial datasets. Both axes are on a log scale; the diameter of a dot represents the number of datasets indexed. To compare two methods it is necessary to compare dots of the same size. The ideal method would produce dots towards the bottom-left. For database sizes greater than 2000, we were unable to build the SBT-fast/SSBT-fast as their uncompressed disk usage exceeded available space; triangles signify estimated values based a calculated lower bound for disk use (as k-mer content is known), and extrapolated query times (<xref ref-type="sec" rid="S8">Online Methods</xref>).</p>
    </caption>
    <graphic xlink:href="emss-80982-f003"/>
  </fig>
  <fig id="F4" orientation="portrait" position="float">
    <label>Figure 4</label>
    <caption>
      <title>Phylogenetic distribution of plasmid sequences.</title>
      <p>Plasmid sequences (37) that are found at least 5 times in more than one genus in the all-microbial-index are shown. The heatmap shows the frequency of each plasmid in each genus. The plasmids/genera were hierarchically clustered using the UPGMA algorithm and Euclidean distance metric. The plasmid at the left (AF012911) with extremely wide phylogenetic distribution is a known cloning vector. The large amount of sharing between <italic>Escherichia</italic>, <italic>Salmonella</italic> and <italic>Shigella</italic> is consistent with known promiscuity within <italic>Enterobacteriaceae</italic>.</p>
    </caption>
    <graphic xlink:href="emss-80982-f004"/>
  </fig>
  <fig id="F5" orientation="portrait" position="float">
    <label>Figure 5</label>
    <caption>
      <title>Plasmid spread and antibiotic resistance genes.</title>
      <p>A comparison of phylogenetic spread (median of pairwise distances between all pairs of genera in which a plasmid is seen) of plasmids containing at least 3 antibiotic resistance genes (n=98, purple) with those bearing none (n=665, peach) is shown. Histograms are normalized to allow comparison (probability densities). The 95% quantiles of the distributions are 1.11 (no resistance genes) and 1.99 (&gt;=3 genes). Distance measured on the large subunit rRNA tree from SILVA. Units of phylogenetic spread are substitutions per site; it is possible to have a distance&gt;1 since it is measured up to the common ancestor and back down again.</p>
    </caption>
    <graphic xlink:href="emss-80982-f005"/>
  </fig>
  <fig id="F6" orientation="portrait" position="float">
    <label>Figure 6</label>
    <caption>
      <title>Antibiotic resistance gene prevalence in ENA over time.</title>
      <p>a) Counts of samples in the all-microbial index containing a range of antibiotic resistance genes; each gene treated independently, so a single dataset containing both CTX-M and OXA for example, will be counted twice b) Year-by-year frequency (defined by date of public availability) in <italic>Staphylococci</italic> (dominated by <italic>S. aureus</italic>) of <italic>mecA</italic>, and all <italic>tet</italic> and <italic>aac</italic> genes, which encode resistance to methicillin, tetracycline and aminoglycosides respectively. c) Year-by-year frequency in <italic>Klebsiella</italic> of various antibiotic resistance genes; increase in prevalence since 2014 may be due to increased Extended Spectrum Beta-Lactamase surveillance and sampling of KPC resistant <italic>Klebsiella</italic> globally. d) Year-by-year breakdown of <italic>M. tuberculosis</italic> datasets, classified by genotypes as resistant (R), pan-susceptible (S), multiple drug resistant (MDR), extensively drug resistant (XDR) as follows. All datasets were genotyped for variants from the resistance catalog from<xref rid="R27" ref-type="bibr">27</xref>, then classified as resistant or susceptible to 12 antibiotics based on their genotype. Datasets were classed as MDR (multi-drug resistant) if resistant to isoniazid and rifampicin, as XDR (extensively drug-resistant) if MDR and also resistant to a fluoroquinolone, and any of capreomycin, kanamycin and amikacin, and as Resistant if resistant to any antibiotic but not MDR or XDR, and susceptible otherwise. Error bars around the estimated frequency (mean) in (b–d) show the 95% confidence interval calculated using the Wilson binomial confidence test.</p>
    </caption>
    <graphic xlink:href="emss-80982-f006"/>
  </fig>
</floats-group>
