<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-archivearticle1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS One</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS ONE</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-id journal-id-type="pmc">plosone</journal-id>
    <journal-title-group>
      <journal-title>PLoS ONE</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1932-6203</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3499510</article-id>
    <article-id pub-id-type="pmid">23166601</article-id>
    <article-id pub-id-type="publisher-id">PONE-D-12-21125</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pone.0048941</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
      <subj-group subj-group-type="Discipline-v2">
        <subject>Biology</subject>
        <subj-group>
          <subject>Computational Biology</subject>
          <subj-group>
            <subject>Genomics</subject>
            <subj-group>
              <subject>Genome Analysis Tools</subject>
              <subj-group>
                <subject>Transcriptomes</subject>
              </subj-group>
            </subj-group>
          </subj-group>
          <subj-group>
            <subject>Molecular Genetics</subject>
            <subj-group>
              <subject>Gene Duplication</subject>
            </subj-group>
          </subj-group>
          <subj-group>
            <subject>Biological Data Management</subject>
            <subject>Microarrays</subject>
            <subject>Sequence Analysis</subject>
          </subj-group>
        </subj-group>
        <subj-group>
          <subject>Genomics</subject>
          <subj-group>
            <subject>Genome Analysis Tools</subject>
            <subj-group>
              <subject>Transcriptomes</subject>
            </subj-group>
          </subj-group>
          <subj-group>
            <subject>Genome Expression Analysis</subject>
            <subject>Genome Sequencing</subject>
          </subj-group>
        </subj-group>
        <subj-group>
          <subject>Theoretical Biology</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v2">
        <subject>Computer Science</subject>
        <subj-group>
          <subject>Algorithms</subject>
        </subj-group>
        <subj-group>
          <subject>Computer Modeling</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Piecewise Polynomial Representations of Genomic Tracks</article-title>
      <alt-title alt-title-type="running-head">Piecewise Polynomial Genomic Tracks</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Tarabichi</surname>
          <given-names>Maxime</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Detours</surname>
          <given-names>Vincent</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="aff2">
          <sup>2</sup>
        </xref>
        <xref ref-type="corresp" rid="cor1">
          <sup>*</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Konopka</surname>
          <given-names>Tomasz</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">
          <sup>1</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="aff1">
      <label>1</label>
      <addr-line>IRIBHM, Université Libre de Bruxelles, Brussels, Belgium</addr-line>
    </aff>
    <aff id="aff2">
      <label>2</label>
      <addr-line>Welbio, Université Libre de Bruxelles, Brussels, Belgium</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Liu</surname>
          <given-names>Zhanjiang</given-names>
        </name>
        <role>Editor</role>
        <xref ref-type="aff" rid="edit1"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>Auburn University, United States of America</addr-line>
    </aff>
    <author-notes>
      <corresp id="cor1">* E-mail: <email>vdetours@ulb.ac.be</email></corresp>
      <fn fn-type="COI-statement">
        <p><bold>Competing Interests: </bold>The authors have declared that no competing interests exist.</p>
      </fn>
      <fn fn-type="con">
        <p>Conceived and designed the experiments: MT VD TK. Performed the experiments: MT VD TK. Analyzed the data: MT VD TK. Contributed reagents/materials/analysis tools: MT VD TK. Wrote the paper: MT VD TK.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2012</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>15</day>
      <month>11</month>
      <year>2012</year>
    </pub-date>
    <volume>7</volume>
    <issue>11</issue>
    <elocation-id>e48941</elocation-id>
    <history>
      <date date-type="received">
        <day>13</day>
        <month>7</month>
        <year>2012</year>
      </date>
      <date date-type="accepted">
        <day>1</day>
        <month>10</month>
        <year>2012</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2012 Tarabichi et al</copyright-statement>
      <copyright-year>2012</copyright-year>
      <copyright-holder>Tarabichi et al</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are properly credited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p>Genomic data from micro-array and sequencing projects consist of associations of measured values to chromosomal coordinates. These associations can be thought of as functions in one dimension and can thus be stored, analyzed, and interpreted as piecewise-polynomial curves. We present a general framework for building piecewise polynomial representations of genome-scale signals and illustrate some of its applications via examples. We show that piecewise constant segmentation, a typical step in copy-number analyses, can be carried out within this framework for both array and (DNA) sequencing data offering advantages over existing methods in each case. Higher-order polynomial curves can be used, for example, to detect trends and/or discontinuities in transcription levels from RNA-seq data. We give a concrete application of piecewise linear functions to diagnose and quantify alignment quality at exon borders (splice sites). Our software (source and object code) for building piecewise polynomial models is available at <ext-link ext-link-type="uri" xlink:href="http://sourceforge.net/projects/locsmoc/">http://sourceforge.net/projects/locsmoc/</ext-link>.</p>
    </abstract>
    <funding-group>
      <funding-statement>MT is supported by funding from F.R.I.A. of the Belgian Fonds de la Recherche Scientifique (FNRS). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
    </funding-group>
    <counts>
      <page-count count="10"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec id="s1">
    <title>Introduction</title>
    <p>Genomic studies often involve associations of measurements with genomic coordinates. In high-throughput sequencing studies, for example, one has information about genomic features such as copy-number, expression, or binding affinity at near single-nucleotide resolution. Such tracks can be thought of describing functions in a one-dimensional space parameterized by a natural coordinate. We here discuss the role piecewise polynomial curves (PPCs) can play to conveniently store, process, and interpret such data. We argue PPCs can be incorporated into existing analysis pipelines and open opportunities to view data from new perspectives.</p>
    <p>PPCs are functions over a one-dimensional space that can be formulated as simple polynomials within contiguous finite intervals. Piecewise constant functions, which are special instances of PPCs, describe properties that are fixed on a genomic range and indicate the positions where these properties change discontinuously. They are already in widespread use in genomics under the guise of run-length encodings or segmentations, for example in context of studying regions of copy-number variation (see <xref rid="pone.0048941-Lai1" ref-type="bibr">[1]</xref>–<xref rid="pone.0048941-Willenbrock1" ref-type="bibr">[3]</xref> and references therein).</p>
    <p>Higher-order PPCs, i.e. piecewise linear or piecewise quadratic functions, are more general objects capable of describing both abrupt and gradual changes. Similarly to the discontinuities already mentioned, gradual changes can also be informative. For example, GC content at a locus is actually a property of a neighborhood and thus changes slowly from one position to the next. In high-throughput sequencing studies, signals have short range correlations associated with the read length. Rolling patterns can be observed in alignment coverage as well as in derived tracks such as high-resolution mappability scores <xref rid="pone.0048941-Lee1" ref-type="bibr">[4]</xref>. In such applications, it is desirable to optimally encode a signal and piecewise-linear segments are natural candidates for the job (<xref ref-type="fig" rid="pone-0048941-g001">Figure 1</xref>).</p>
    <fig id="pone-0048941-g001" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pone.0048941.g001</object-id>
      <label>Figure 1</label>
      <caption>
        <title>Modeling of signals.</title>
        <p>A sample signal (gray bars) modeled/smoothed using (A) a piecewise-linear function (blue line) and (B) loess smoothing (blue and red dots, different settings). The PPC representation captures trends and highlights discontinuities.</p>
      </caption>
      <graphic xlink:href="pone.0048941.g001"/>
    </fig>
    <p>The motivation for replacing raw data with functional models is similar to that for using regression to summarize linearly related points. Good models capture the essence of data, suppress noise, and provide an output that can be interpreted meaningfully. In this sense modeling can be regarded as a lossy compression scheme. Whereas it can be dangerous if applied too aggressively, it need not be detrimental to downstream analysis. For instance, in another context, lossy compression of base quality scores in fastq files has been shown not to be detrimental to identification of single-nucleotide variants <xref rid="pone.0048941-Wan1" ref-type="bibr">[5]</xref>, <xref rid="pone.0048941-Kozantis1" ref-type="bibr">[6]</xref>. At the same time, the functional form of the PPCs can enable novel types of analysis. In the literature on modeling of gene-expression time-series, for example, the ability to describe data in terms of mathematical functions is a key ingredient in algorithms inferring regulatory mechanisms between genes <xref rid="pone.0048941-BarJoseph1" ref-type="bibr">[7]</xref>, <xref rid="pone.0048941-Konopka1" ref-type="bibr">[8]</xref>. In genomics, the functional form can describe a region as opposed to individual locations and thereby offers a robust framework to compare trends and biases between technologies and samples.</p>
    <p>In practice, building effective piecewise polynomial models for genomic signals (<xref ref-type="fig" rid="pone-0048941-g001">Figure 1</xref>) is nontrivial for several reasons. First, the length of a chromosome or genome, denoted as <inline-formula><inline-graphic xlink:href="pone.0048941.e001.jpg"/></inline-formula>, can be on the order of <inline-formula><inline-graphic xlink:href="pone.0048941.e002.jpg"/></inline-formula> or more. Second, genomic signals often contain a large number of domains with distinct patterns. Characterizing these events is often the objective of bioinformatic studies, for example in finding copy-number breakpoints or splice-sites in transcriptomics, but the space of possible event locations scales super-exponentially with <inline-formula><inline-graphic xlink:href="pone.0048941.e003.jpg"/></inline-formula>. Third, although genomic features are sometimes measured at near single-nucleotide resolution, relevant signals often show regional correlation. These can reflect a certain read length in a high-throughput sequencing study or reveal biological properties such as the distribution of genes along a genome. Whatever the reason, regional correlations imply that a signal of actual length <inline-formula><inline-graphic xlink:href="pone.0048941.e004.jpg"/></inline-formula> can often be encoded using much fewer values via run-length encoding. Denoting <inline-formula><inline-graphic xlink:href="pone.0048941.e005.jpg"/></inline-formula> as the number of runs, one can have <inline-formula><inline-graphic xlink:href="pone.0048941.e006.jpg"/></inline-formula>. Thus, run-length encoding provides a natural reference to which curve smoothing can be compared to.</p>
    <p>In light of these characteristics, one can understand why polynomials have been used in internal processing in some applications involving short signals (e.g. <xref rid="pone.0048941-Picard1" ref-type="bibr">[9]</xref>), but they have rarely been used for representation of long genomic tracks: Conventional data smoothing methods turn out to be inappropriate for genomics due to computational complexity or due to their smoothing assumptions. <xref ref-type="sec" rid="s4">Methods</xref> developed for short signals are impractical if they require <inline-formula><inline-graphic xlink:href="pone.0048941.e007.jpg"/></inline-formula> time or space resources. This applies to many sophisticated segmentation methods which work top-down <xref rid="pone.0048941-Picard1" ref-type="bibr">[9]</xref>. <xref ref-type="sec" rid="s4">Methods</xref> which work in the spirit of a convolution, for example a basic moving average or locally weighted regression (loess) can require only <inline-formula><inline-graphic xlink:href="pone.0048941.e008.jpg"/></inline-formula> or <inline-formula><inline-graphic xlink:href="pone.0048941.e009.jpg"/></inline-formula> resources, where <inline-formula><inline-graphic xlink:href="pone.0048941.e010.jpg"/></inline-formula> is the width of a predefined window. However, they require the user to specify a window width, which may not be obvious in practice <xref rid="pone.0048941-Magi1" ref-type="bibr">[2]</xref>. Another disadvantage of convolution methods is that they blur sharp contrast (<xref ref-type="fig" rid="pone-0048941-g001">Figure 1</xref>). This is undesirable for biological reasons and also leads these methods to provide output that is less amenable to run-length encoding than the original signal. Thus, although these smoothings eliminate local noise, they can inflate rather than compress the size of a signal.</p>
    <p>In order to smooth signals in regions where it is appropriate and simultaneously preserve discontinuous boundaries, an adaptive approach employing functional representations is required. Segmented regression <xref rid="pone.0048941-Muggeo1" ref-type="bibr">[10]</xref> and some spline-based techniques <xref rid="pone.0048941-Hansen1" ref-type="bibr">[11]</xref>, <xref rid="pone.0048941-Wallstrom1" ref-type="bibr">[12]</xref> fall in this category. Some implementations use greedy search and/or invoke constraints limiting the model complexity, but top-down techniques can still require quadratic resources in time or memory when the signal contains a large number of domains. Implementations from non-genomic fields typically also assume maximal continuity conditions. This does not immediately rule out their use in genomics, but imposes unnecessary conditions. Lastly, whereas some implementations rely on minimizations of objective functions, a more intuitive approach for pattern detection in genomics is based on distributions (poisson, binomial, generalized t-distributions, etc.).</p>
    <p>We here describe a general tool appropriate for producing PPCs for genomic signals. The algorithm builds on selected techniques from the spline literature and adapts them to the genomic context. As a result, it is suitable for processing very long signals with multiple domains in time sub-quadratic in the length of the input. Technically, the algorithm does not attempt to define and minimize a global objective function for a piecewise polynomial model. Instead, it produces approximate or acceptable models that satisfy a-priori set conditions and show discontinuities where these conditions are broken (<xref ref-type="fig" rid="pone-0048941-g001">Figure 1</xref>). It accepts run-length encoded curves as input and thereby exploits one of the regularities of genomic sequences. It can output both continuous and discontinuous models.</p>
    <p>The rest of this paper is structured as follows. In the results section, we illustrate some of the possible applications of piecewise polynomial curves in bioinformatics with examples: signal compression, improved detection of genomic copy-number from array and sequencing data, and characterization of alignment artifacts and gene-expression patterns in RNA-seq. Many of these are supplemented by additional calculations in the <xref ref-type="supplementary-material" rid="pone.0048941.s001">Text S1</xref>. In the discussion section, we summarize the applications and comment on the general outlook. Our algorithm for generating PPC models is reviewed in the methods section and in the <xref ref-type="supplementary-material" rid="pone.0048941.s001">Text S1</xref>.</p>
  </sec>
  <sec id="s2">
    <title>Results</title>
    <p>In this section, we illustrate the versatility of piecewise polynomial curves in bioinformatic applications through a series of examples.</p>
    <sec id="s2a">
      <title>Signal Compression</title>
      <p>To demonstrate the use of PPCs as a compression scheme, we generated synthetic sequencing data by placing single reads of length <inline-formula><inline-graphic xlink:href="pone.0048941.e011.jpg"/></inline-formula> nt uniformly at random on ‘chromosomes’ of length 1Mnt. We created data of various coverage depth and saved the coverage tracks using run length encoding. We then calculated PPCs models with poisson error model for all the signals (Methods). As the smoothing algorithm is stochastic and produces different solutions when started with different seeds, we repeated the smoothing procedure 10 times for each data signal. We measured memory requirements to represent the coverage tracks and their PPC models by loading the signals into tables in R and applying the object.size function. Results show that high-coverage signals can be compressed with high inverse compression ratios (<xref ref-type="table" rid="pone-0048941-t001">Table 1</xref> and <xref ref-type="supplementary-material" rid="pone.0048941.s001">Text S1</xref>
<inline-formula><inline-graphic xlink:href="pone.0048941.e012.jpg"/></inline-formula>). Low coverage signals are ‘compressed’ less as knot operations pass the acceptance criteria less frequently (Methods) and because their run-length encoding is more efficient to begin with.</p>
      <table-wrap id="pone-0048941-t001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0048941.t001</object-id>
        <label>Table 1</label>
        <caption>
          <title>Compression due to PPCs.</title>
        </caption>
        <alternatives>
          <graphic id="pone-0048941-t001-1" xlink:href="pone.0048941.t001"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col align="left" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1"/>
                <td colspan="2" align="left" rowspan="1">Memory (ICR)</td>
                <td colspan="2" align="left" rowspan="1">Mean Len.</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">P</td>
                <td align="left" rowspan="1" colspan="1">O</td>
                <td align="left" rowspan="1" colspan="1">8r/nt</td>
                <td align="left" rowspan="1" colspan="1">250r/nt</td>
                <td align="left" rowspan="1" colspan="1">8r/nt</td>
                <td align="left" rowspan="1" colspan="1">250r/nt</td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">0</td>
                <td align="left" rowspan="1" colspan="1">3.6</td>
                <td align="left" rowspan="1" colspan="1">22.1</td>
                <td align="left" rowspan="1" colspan="1">21.3</td>
                <td align="left" rowspan="1" colspan="1">39.0</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">2.2</td>
                <td align="left" rowspan="1" colspan="1">13.1</td>
                <td align="left" rowspan="1" colspan="1">22.1</td>
                <td align="left" rowspan="1" colspan="1">38.2</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">2</td>
                <td align="left" rowspan="1" colspan="1">0</td>
                <td align="left" rowspan="1" colspan="1">8.4</td>
                <td align="left" rowspan="1" colspan="1">67.8</td>
                <td align="left" rowspan="1" colspan="1">51.0</td>
                <td align="left" rowspan="1" colspan="1">125.9</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">2</td>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">4.9</td>
                <td align="left" rowspan="1" colspan="1">30.2</td>
                <td align="left" rowspan="1" colspan="1">48.8</td>
                <td align="left" rowspan="1" colspan="1">90.1</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
        <table-wrap-foot>
          <fn id="nt101">
            <label/>
            <p><inline-formula><inline-graphic xlink:href="pone.0048941.e013.jpg"/></inline-formula> and <inline-formula><inline-graphic xlink:href="pone.0048941.e014.jpg"/></inline-formula> denote error model parameter <inline-formula><inline-graphic xlink:href="pone.0048941.e015.jpg"/></inline-formula> and the order of the PPCs, respectively. ICR stands for inverse compression ratio. Mean Len. describes the typical segment length in the PPCs. For reference, mean lengths in uncompressed signals are <inline-formula><inline-graphic xlink:href="pone.0048941.e016.jpg"/></inline-formula> and <inline-formula><inline-graphic xlink:href="pone.0048941.e017.jpg"/></inline-formula> for the low and high coverage density signals. r/nt stands for reads per nucleotide. Note: since the PPC algorithm is stochastic, values may vary from signal to signal and from one run to another.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>Similar compression performance is achievable on real signals originating from sequencing projects. We downloaded human genome mappability tracks for 100bp paired-end reads <xref rid="pone.0048941-Lee1" ref-type="bibr">[4]</xref> and saved them as run-length-encoded signals. We then computed PPC models using various settings (<xref ref-type="fig" rid="pone-0048941-g002">Figure 2</xref>). Constraining first order PPC to give a model with 1% maximal deviation, we found the tracks can be represented with inverse compression ratios between 5 and 10 (depending on chromosome). Allowing deviations of 2% can push the ratios up to 20.</p>
      <fig id="pone-0048941-g002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0048941.g002</object-id>
        <label>Figure 2</label>
        <caption>
          <title>Representations of mappability track of human chromosome 21.</title>
          <p>MSE is mean square error between a model and the original track (solid lines, left scale). ICR is inverse compression ratio (dotted lines, right scale). Red points summarize performance of an approach averaging the track in windows of fixed width. Blue and green points summarize performance of PPCs with order 0 and 1, respectively. Points represent computed values, lines are drawn to show trend. The plot shows that for given ICR, the PPC models produce fits with lower mean square error than averages in fixed windows.</p>
        </caption>
        <graphic xlink:href="pone.0048941.g002"/>
      </fig>
    </sec>
    <sec id="s2b">
      <title>Copy Number Detection</title>
      <p>Genomic regions of constant copy number are often described via long segments <xref rid="pone.0048941-Lai1" ref-type="bibr">[1]</xref>–<xref rid="pone.0048941-Willenbrock1" ref-type="bibr">[3]</xref>. As these are actually piecewise polynomial curves of order zero, we here discuss the application of our smoothing algorithm to that context. The aim here is not to propose a new copy-number calling procedure, but rather to point out certain issues where the PPC smoothing may be of use.</p>
      <sec id="s2b1">
        <title>Array-based signals</title>
        <p>In an array experiment studying copy-numbers, DNA from a sample is hybridized on probes sampling positions along a genome. A well-regarded algorithm <xref rid="pone.0048941-Lai1" ref-type="bibr">[1]</xref> for copy-detection using these probes is circular binary segmentation (CBS) <xref rid="pone.0048941-Venkatraman1" ref-type="bibr">[13]</xref>. It begins by treating a chromosome as a single segment and then breaks it up iteratively if co-localized groups of probes have, according to an empirical t-test, statistically different mean intensity from the rest. Our algorithm also supports segmentation using the t-test (Methods), but works differently than CBS in that it starts by treating single probes as segments and then joins them together.</p>
        <p>To compare these closely related algorithms, we started by simulating synthetic signals of lengths <inline-formula><inline-graphic xlink:href="pone.0048941.e018.jpg"/></inline-formula> probes (1250 signals for each length) by sampling random numbers from a normal distribution with zero mean and unit standard deviation. We then added between one and ten events in windows of length in the range <inline-formula><inline-graphic xlink:href="pone.0048941.e019.jpg"/></inline-formula> and amplitudes selected from the same normal distribution (<xref ref-type="fig" rid="pone-0048941-g003">Figure 3</xref>). We ran CBS (default parameters) and our algorithm with the t-test method (Methods, <inline-formula><inline-graphic xlink:href="pone.0048941.e020.jpg"/></inline-formula>) on the simulated data. Since the PPC algorithm is stochastic, we also considered composite PPC segmentations by taking median segment values from 5 independent runs. For each chromosome, we computed the probe-wise sum of squared distances between segmented and simulated signals. Finally, we measured the proportion of times CBS gave a lower error than PPC (<xref ref-type="table" rid="pone-0048941-t002">Table 2</xref>). This gave us a measure of segmentation quality independent of copy-number calling.</p>
        <fig id="pone-0048941-g003" orientation="portrait" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pone.0048941.g003</object-id>
          <label>Figure 3</label>
          <caption>
            <title>CGH signals with aberrations.</title>
            <p>Dots are probe intensities, horizontal lines indicate true copy-number levels (green), and segments output by CBS (red) and the median of 5 PPC runs (blue). Where some lines are not visible, it is because multiple segments overlap. Both signals contain 1500 probes. (A) Situation where CBS outperforms the PPC method. (B) Situation with multiple copy-number events where PPC segments outperform CBS (missed events around positions 200 and 950).</p>
          </caption>
          <graphic xlink:href="pone.0048941.g003"/>
        </fig>
        <table-wrap id="pone-0048941-t002" orientation="portrait" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pone.0048941.t002</object-id>
          <label>Table 2</label>
          <caption>
            <title>Array segmentation methods.</title>
          </caption>
          <alternatives>
            <graphic id="pone-0048941-t002-2" xlink:href="pone.0048941.t002"/>
            <table frame="hsides" rules="groups">
              <colgroup span="1">
                <col align="left" span="1"/>
                <col align="center" span="1"/>
                <col align="center" span="1"/>
                <col align="center" span="1"/>
                <col align="center" span="1"/>
                <col align="center" span="1"/>
              </colgroup>
              <thead>
                <tr>
                  <td align="left" rowspan="1" colspan="1"/>
                  <td align="left" rowspan="1" colspan="1"/>
                  <td colspan="4" align="left" rowspan="1">Number of CN events</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">Passes</td>
                  <td align="left" rowspan="1" colspan="1">Probes</td>
                  <td align="left" rowspan="1" colspan="1">1</td>
                  <td align="left" rowspan="1" colspan="1">3</td>
                  <td align="left" rowspan="1" colspan="1">6</td>
                  <td align="left" rowspan="1" colspan="1">9</td>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1</td>
                  <td align="left" rowspan="1" colspan="1">300</td>
                  <td align="left" rowspan="1" colspan="1">0.63</td>
                  <td align="left" rowspan="1" colspan="1">
                    <bold>0.48</bold>
                  </td>
                  <td align="left" rowspan="1" colspan="1">0.51</td>
                  <td align="left" rowspan="1" colspan="1">
                    <bold>0.37</bold>
                  </td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1</td>
                  <td align="left" rowspan="1" colspan="1">1500</td>
                  <td align="left" rowspan="1" colspan="1">0.94</td>
                  <td align="left" rowspan="1" colspan="1">0.88</td>
                  <td align="left" rowspan="1" colspan="1">0.75</td>
                  <td align="left" rowspan="1" colspan="1">0.67</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1</td>
                  <td align="left" rowspan="1" colspan="1">50000</td>
                  <td align="left" rowspan="1" colspan="1">1</td>
                  <td align="left" rowspan="1" colspan="1">1</td>
                  <td align="left" rowspan="1" colspan="1">1</td>
                  <td align="left" rowspan="1" colspan="1">1</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">5</td>
                  <td align="left" rowspan="1" colspan="1">300</td>
                  <td align="left" rowspan="1" colspan="1">0.55</td>
                  <td align="left" rowspan="1" colspan="1">
                    <bold>0.38</bold>
                  </td>
                  <td align="left" rowspan="1" colspan="1">
                    <bold>0.34</bold>
                  </td>
                  <td align="left" rowspan="1" colspan="1">
                    <bold>0.25</bold>
                  </td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">5</td>
                  <td align="left" rowspan="1" colspan="1">1500</td>
                  <td align="left" rowspan="1" colspan="1">0.90</td>
                  <td align="left" rowspan="1" colspan="1">0.78</td>
                  <td align="left" rowspan="1" colspan="1">0.57</td>
                  <td align="left" rowspan="1" colspan="1">
                    <bold>0.41</bold>
                  </td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">5</td>
                  <td align="left" rowspan="1" colspan="1">50000</td>
                  <td align="left" rowspan="1" colspan="1">1</td>
                  <td align="left" rowspan="1" colspan="1">1</td>
                  <td align="left" rowspan="1" colspan="1">1</td>
                  <td align="left" rowspan="1" colspan="1">1</td>
                </tr>
              </tbody>
            </table>
          </alternatives>
          <table-wrap-foot>
            <fn id="nt102">
              <label/>
              <p>Entries in the table indicate the proportion of times (out of 125 observations in each category) that top-down segmentation outperforms the bottom-up approach. Values smaller than <inline-formula><inline-graphic xlink:href="pone.0048941.e021.jpg"/></inline-formula> (highlighted) indicate the bottom-up approach (PPC) is more appropriate than top-down (CBS) for short signals and signals with many copy-number events. Performance improves by averaging several PPC models. Note: since the PPC algorithm is stochastic, proportions can vary slightly from one run to another (variation is on the order of <inline-formula><inline-graphic xlink:href="pone.0048941.e022.jpg"/></inline-formula>).</p>
            </fn>
          </table-wrap-foot>
        </table-wrap>
        <p>Results show CBS often outperforms our algorithm for signals with few copy-number events (<xref ref-type="fig" rid="pone-0048941-g003">Figure 3A</xref>) and for signals with very large number of probes in which each event is supported by many probes. In these situations, the error attributed to the PPC approach can be high. However, it originates from very short segments (<xref ref-type="fig" rid="pone-0048941-g003">Figure 3A</xref>), which can have minimal impact on copy-number calling (<xref ref-type="supplementary-material" rid="pone.0048941.s001">Text S1</xref>
<inline-formula><inline-graphic xlink:href="pone.0048941.e023.jpg"/></inline-formula>). For signals with coarse to medium resolution and a large (<inline-formula><inline-graphic xlink:href="pone.0048941.e024.jpg"/></inline-formula>) number of events, which are not uncommon when studying cancer samples, it is the bottom-up approach that often gives smaller errors (<xref ref-type="fig" rid="pone-0048941-g003">Figure 3B</xref>). We therefore conclude that CBS is an excellent tool in most situations, but that the PPC approach may be an interesting alternative in niche analyses.</p>
        <p><xref ref-type="supplementary-material" rid="pone.0048941.s001">Text S1</xref><inline-formula><inline-graphic xlink:href="pone.0048941.e025.jpg"/></inline-formula> contains additional calculations relating to array segmentation, including comparisons with two other segmentation methods, GLAD <xref rid="pone.0048941-Hupe1" ref-type="bibr">[14]</xref> and HMM <xref rid="pone.0048941-Fridlyand1" ref-type="bibr">[15]</xref>.</p>
      </sec>
      <sec id="s2b2">
        <title>Sequencing-based signals</title>
        <p>In the context of sequencing, one approach to detect copy numbers changes is through read depth <xref rid="pone.0048941-Magi1" ref-type="bibr">[2]</xref> (alternative methods involve analysis of insert sizes between paired-end reads). The underlying logic is that a genomic region that has been deleted will not be represented in a sample. Thus, when sequenced reads are aligned to a reference genome, the coverage depth within that region will be reduced relative to other regions. Similar reasoning applies when copy number is increased.</p>
        <p>Because coverage signals in sequencing samples have a finite auto-correlation length, many algorithms for copy-number detection developed for microarray platforms tend to produce segmentations with too many events, taking a prohibitive amount of time in the process <xref rid="pone.0048941-Magi1" ref-type="bibr">[2]</xref>, <xref rid="pone.0048941-Yoon1" ref-type="bibr">[16]</xref>. A workaround, used in all methods for segmentation of sequencing coverage, is to divide a signal into non-overlapping windows of fixed width, compute coverage in each window, and then perform segmentation or copy-number calling using those values. This works because the averages in neighboring windows become independent and thus resemble data produced by sparse microarrays. The drawback of this approach, however, is that a long window width required to remove the auto-correlation implies that breakpoints cannot be inferred at resolution better than the window width. It follows that it may be beneficial to define short segments via an approach like PPC instead of adopting fixed intervals by <italic>fiat</italic>.</p>
        <p>To investigate this issue, we again generated synthetic data. We first created a set of <inline-formula><inline-graphic xlink:href="pone.0048941.e026.jpg"/></inline-formula> paired chromosomes with random sequence and considered them as a reference genome. We then produced a derived genome with modified copy numbers by selecting a subsequence of around 2 kilobases in each chromosome and deleted, duplicated, or left it in place in either one or both copies. Next, we generated perfectly matching single-end 75bp reads from this aberrant genome and obtained a sample with coverage depth 30. We aligned the reads to the original genome using Bowtie <xref rid="pone.0048941-Langmead1" ref-type="bibr">[17]</xref> and computed the coverage tracks.</p>
        <p>Next, we segmented the coverage signals using fixed windows of various lengths and using our approach with various parameters settings, which each led to segmentations with a characteristic (median) length. We labeled each window/segment as copy-number aberrant if more than half of its width overlapped a region with actual copy-number change. This procedure is somewhat arbitrary, but is blind to the segmentation method. We can thus regard these labels as the best possible classification achievable by a perfect copy-number caller given the segmentations. We computed the number of bases in the synthetic genome that can be regarded as true positive, false positive, true negative and false negatives (<xref ref-type="fig" rid="pone-0048941-g004">Figure 4</xref>). The results show that for segments with median length greater than the read length, the PPC segments consistently outperform the fixed-window approach (higher true positive and true negative rates, lower false positive and false negative rates). For shorter segments, the perfect classifiers would give comparable results with fixed windows and PPC segments.</p>
        <fig id="pone-0048941-g004" orientation="portrait" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pone.0048941.g004</object-id>
          <label>Figure 4</label>
          <caption>
            <title>Fixed vs dynamic windows of sequencing coverage.</title>
            <p>Red circles indicate the best possible classification performance based on signal processed into fixed windows of various lengths. Blue diamonds show equivalent measures for dynamically defined segments with a certain median length. Note the scales on the vertical axes do not reach zero.</p>
          </caption>
          <graphic xlink:href="pone.0048941.g004"/>
        </fig>
        <p>The calculation based on the “perfect” classifier supports the argument that working with dynamically defined segments can improve performance relative to fixed-width windowing. However, the relevance of the calculation to actual practice relies on the assumption that real classifiers show similar trends. To see this is indeed the case, recall that segmentation algorithms based on long windows generally give acceptable results while windows that are much shorter than the auto-correlation length do not <xref rid="pone.0048941-Magi1" ref-type="bibr">[2]</xref>. Thus, real classifiers can plausibly achieve close-to-perfect performance with long windows but not for short ones. To verify this intuition explicitly, we performed classification of the synthetic data using support vector machines. The details and results, consistent with the reasoning above, appear in <xref ref-type="supplementary-material" rid="pone.0048941.s001">Text S1</xref>
<inline-formula><inline-graphic xlink:href="pone.0048941.e027.jpg"/></inline-formula>.</p>
        <p>To conclude this section, we discuss normalization of real sequencing data. Raw coverage signals are often normalized to remove biases due to read capture or mappability. To demonstrate that avoiding fixed-length windows can enhance this normalization step, we started by downloading alignments (hg18) of full-genome sequencing sample NA12891 from the 1000 Genomes Project <xref rid="pone.0048941-The1" ref-type="bibr">[18]</xref>. We computed the coverage tracks and smoothed them (poisson smoothing, <inline-formula><inline-graphic xlink:href="pone.0048941.e028.jpg"/></inline-formula>) to obtain variable-length windows with median lengths around 100 and mean lengths around 150 (numbers vary by chromosome). We then looked up the fraction of each segment overlapping bases C or G and computed the mutual information (MI) between CG content and coverage depth. We found MIs around <inline-formula><inline-graphic xlink:href="pone.0048941.e029.jpg"/></inline-formula> (<xref ref-type="supplementary-material" rid="pone.0048941.s001">Text S1</xref>
<inline-formula><inline-graphic xlink:href="pone.0048941.e030.jpg"/></inline-formula>). For each chromosome, we divided the coverage track into windows of fixed width equal to the median and mean found by the PPC approach and then recomputed the MIs. We found that in all but two chromosomes, calculations using dynamically defined segments produced higher mutual informations than the fixed window approach (differences are around <inline-formula><inline-graphic xlink:href="pone.0048941.e031.jpg"/></inline-formula>). This result opens the opportunity to study CG bias in sequencing data by controlling for length of dynamical windows. One possibility for doing this would be to adapt the technique presented in <xref rid="pone.0048941-Yoon1" ref-type="bibr">[16]</xref>.</p>
      </sec>
    </sec>
    <sec id="s2c">
      <title>RNA-seq Coverage</title>
      <p>In addition to enhancing segmentation analyses, the generality of the PPC modeling framework also permits us to explore genomic data in novel ways. We here explore PPCs of linear order in the context of RNA sequencing.</p>
      <p>In an RNA sequencing study, reads originate from mRNA transcripts rather than raw DNA. Thus coverage is high predominantly on exons of annotated genes and low elsewhere. The coverage depth on the exons depends on gene expression level, splicing events, and can contain a number of biases (e.g. <xref rid="pone.0048941-Zheng1" ref-type="bibr">[19]</xref>, <xref rid="pone.0048941-Roberts1" ref-type="bibr">[20]</xref>). As a result, coverage can vary even within single genes or even single exons (<xref ref-type="fig" rid="pone-0048941-g005">Figure 5</xref>).</p>
      <fig id="pone-0048941-g005" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0048941.g005</object-id>
        <label>Figure 5</label>
        <caption>
          <title>Smoothing of coverage tracks.</title>
          <p>Randomly selected exons with mean coverage density above 50, exon width greater than 100, and where segment slopes near both boundaries are (A) positive in inward direction and longer than 25nt; (B) negative in inward direction and longer than 25nt. Dashed lines indicate exon boundaries. Examples capture segments contributing to the tails of the histograms in <xref ref-type="fig" rid="pone-0048941-g006">Figure 6</xref>.</p>
        </caption>
        <graphic xlink:href="pone.0048941.g005"/>
      </fig>
      <p>We began by studying a coverage track from a human thyroid sample from the publicly available bodymap dataset (Illumina sequencing, 50bp paired-end reads; dataset consists of 16 samples originating from various human healthy tissue types) <xref rid="pone.0048941-Illumina1" ref-type="bibr">[21]</xref>. We aligned the sample on the hg19 reference genome using Tophat <xref rid="pone.0048941-Trapnell1" ref-type="bibr">[22]</xref> (v. 2.0.0) with and without exon junction libraries, and computed the coverage tracks. We found genomic ranges labeled as exons in the refGene annotation set <xref rid="pone.0048941-Dreszer1" ref-type="bibr">[23]</xref> and eliminated overlapping regions.</p>
      <p>We computed piecewise linear models using poisson smoothing with parameter <inline-formula><inline-graphic xlink:href="pone.0048941.e032.jpg"/></inline-formula> (<xref ref-type="fig" rid="pone-0048941-g005">Figure 5</xref>). As the resulting PPCs can be continuous or discontinuous, we looked at the positions of discontinuities. Among the exons with coverage density greater than the median, 87% showed a discontinuity at the position specified as a boundary by the refGene annotation or within 3 bases from it. The high rate is consistent with the notion that non-exonic sequence is spliced out and quickly degraded. However, the result opens the opportunity to identify and study the cases where an RNA-seq signal does not conform.</p>
      <p>We investigated slopes near boundaries between long (width <inline-formula><inline-graphic xlink:href="pone.0048941.e033.jpg"/></inline-formula> nt) and highly covered exons (depth <inline-formula><inline-graphic xlink:href="pone.0048941.e034.jpg"/></inline-formula>) and neighboring introns and intergenic regions. Unsurprisingly, a vast majority of segments just outside exons are either flat or downward sloping as seen from the exon boundary. Segments on inside boundaries, in contrast, are more likely to be upward sloping than downward sloping as seen from the exon boundary (<xref ref-type="fig" rid="pone-0048941-g005">Figures 5</xref> and <xref ref-type="fig" rid="pone-0048941-g006">6</xref>, and <xref ref-type="supplementary-material" rid="pone.0048941.s001">Text S1</xref>). The bias is acceptable at the <inline-formula><inline-graphic xlink:href="pone.0048941.e035.jpg"/></inline-formula> and <inline-formula><inline-graphic xlink:href="pone.0048941.e036.jpg"/></inline-formula> ends of genes and indeed also appears near boundaries in synthetically generated signals. However, given the accepted view that RNA transcripts are long strands spanning multiple exons, a strong bias is not expected in general.</p>
      <fig id="pone-0048941-g006" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0048941.g006</object-id>
        <label>Figure 6</label>
        <caption>
          <title>Segments close to inner exon boundaries Positive (negative) lengths indicate upward (downward) sloping segments.</title>
          <p>Colors emphasize sign of slope. (A) Unsupervised alignment. (B) Using splice junctions library.</p>
        </caption>
        <graphic xlink:href="pone.0048941.g006"/>
      </fig>
      <p>Strong slope biases are qualitatively observed in other samples in the bodymap dataset, including those from other tissues and those sequenced with 75 bp and 100 bp single-end protocols. They are also present when the same computation is repeated counting only segments from inner exons, i.e. those not classified as first or last in any known gene isoform. The universality is therefore likely an artifact due to well-known difficulties in aligning relatively short reads across exon junctions. Indeed, it is greatly reduced when alignment is performed in supervised mode using the same splice junction library used in the slope bias test (<xref ref-type="fig" rid="pone-0048941-g006">Figure 6B</xref>). However, the bias is not removed completely (binomial test, <inline-formula><inline-graphic xlink:href="pone.0048941.e037.jpg"/></inline-formula>).</p>
      <p>As the histograms in <xref ref-type="fig" rid="pone-0048941-g006">Figure 6</xref> contain information about the sign of the slopes but not their magnitudes, it is in principle possible that the bias arises due to segments that are very shallow. We thus investigated in more detail the subgroup of boundary segments on inner exons that are steep (slope magnitude greater than 0.7) and longer than 25nt. We counted 7086 upward- and 5871 downward-sloping segments, respectively (binomial test, <inline-formula><inline-graphic xlink:href="pone.0048941.e038.jpg"/></inline-formula>), showing that the bias is not purely cosmetic.</p>
      <p>Although the bias might not carry direct biological meaning, it does have important consequences. For instance, lower apparent coverage near exon boundaries reduces power to detect variants or to use those variants to estimate allelic ratios. This may not be a problem for highly-expressed genes in well-annotated organisms, but becomes increasingly relevant when studying weakly expressed genes, especially if they are not included in the splice library or when overall coverage is low. In addition, taking the slope bias as an indicator of alignment quality prompts questions about the reliability of the alignment near exon boundaries and possibly elsewhere.</p>
      <p>To finish this section, we mention that steep and long segments also occur well away from exon boundaries. This may indicate additional artifacts or perhaps novel locations of transcription start/end sites. Previous reports <xref rid="pone.0048941-Roberts1" ref-type="bibr">[20]</xref> noticed sequence-specific biases in read start and end locations, so we computed position weight matrices (PWM) for sequences around features found by the PPCs. We observed strong signals in PWM computed around exon boundaries (as controls) but did not find similarly striking effects around steep long segments entirely inside exons and far from the boundaries. Thus, these coverage patterns are either due to sampling or are regulated in ways not captured by PWM. In any case, the ability to evaluate slopes at loci opens opportunity to systematically study trends across as well as within samples.</p>
    </sec>
  </sec>
  <sec id="s3">
    <title>Discussion</title>
    <p>Piecewise polynomial curves (PPCs) are a compact and versatile description of one-dimensional signals that have different behaviors in different domains. Encoding genomic signals using PPCs can serve two main purposes: to compress data by eliminating noise, and to provide a representation that has greater interpretability value than the original.</p>
    <p>We presented a general tool for constructing PPC models for genomic data. It is related to conventional model-building methods, but unlike regression or smoothing splines, the method does not aim to minimize a global objective function. Instead, the goal is to provide PPC representations of the input data that respects user-specified criteria. A positive consequence of this is that outliers in the data are never quietly incorporated into a model. Rather, they create breakpoints/discontinuities that can be later identified and interpreted as needed. This approach also allows us to take advantage of peculiarities of genomic data such as run-length encoding of the input.</p>
    <p>The smoothing program provides output in <inline-formula><inline-graphic xlink:href="pone.0048941.e039.jpg"/></inline-formula> time, where <inline-formula><inline-graphic xlink:href="pone.0048941.e040.jpg"/></inline-formula> is proportional to the length of the input (measured in bytes, which can be smaller that length of signal due to run length encoding). In contrast to smoothing methods such as loess, the PPC representation can sometimes provide significant compression both in memory and disk. Moreover, PPCs can be stored in a tabular data-structure similar to those currently used for piecewise-constant curves (e.g. wiggle files). They thus provide an accessible extension to existing data storage formats.</p>
    <p>Extensions to the described method are possible, particularly in the direction of applying Monte-Carlo techniques (e.g. <xref rid="pone.0048941-Hansen1" ref-type="bibr">[11]</xref>, <xref rid="pone.0048941-Wallstrom1" ref-type="bibr">[12]</xref>). Our algorithm could provide an input to such an approach. We did not investigate such an extension here as it would increase running time.</p>
    <p>We demonstrated piecewise constant curves can be useful in identifying copy-number changes in both array- and sequencing-based data. The bottom-up approach is particularly suited for studying signals with multiple copy-number changes. For sequencing data, the dynamic formation of segments is an alternative to windowing with a-priori specified width, which is an essential stage in all currently available methods. Furthermore, the generality of the PPC could perhaps be exploited in the future to build even better classifiers. For example, information from piecewise-linear representations of the coverage signal may help improve breakpoint detection at the expense of added curve smoothing time.</p>
    <p>We also showed that a piecewise linear representation of RNA-seq coverage can be used to analyze systematic biases. Our example involved a well-known problem of aligning reads across splice sites. The PPC representation of coverage reveals the magnitude of this bias and suggests that using splice libraries during the alignment procedure need not necessary eliminate it completely.</p>
    <p>Other applications of piecewise polynomial curves are possible. In particular, wherever piecewise constant (i.e. run-length encoded) curves are used, it is natural to ask whether benefit in terms of compression or interpretability might be drawn from a representation using first- or higher-order polynomials. Signals encoded by PPCs need not be limited to the types above; they can just as well be SNP data, binding affinities, normalization factors, probability mass functions, or any other function in one dimension.</p>
  </sec>
  <sec sec-type="methods" id="s4">
    <title>Methods</title>
    <p>Our algorithm works from the bottom up, i.e. it starts with an input with a large number of segments and then joins pairs of these together. This produces a more compact description of the data in which the fused segments are represented by polynomial functions. In brief (see <xref ref-type="supplementary-material" rid="pone.0048941.s001">Text S1</xref>
<inline-formula><inline-graphic xlink:href="pone.0048941.e041.jpg"/></inline-formula> for technical and implementation details), the algorithm starts by reading a run-length encoded input signal from disk. We call the start positions of these runs, borrowing from the literature on splines, as ‘knots.’ The algorithm marks all knots as candidates for processing and visits them in a random order. At each knot, the algorithm attempts to remove the knot by replacing the segments adjacent to it by a single longer segment (<xref ref-type="fig" rid="pone-0048941-g007">Figure 7A</xref>), by adjusting the endpoints of the adjacent segments (<xref ref-type="fig" rid="pone-0048941-g007">Figure 7B</xref>), or by moving the location of the knot (<xref ref-type="fig" rid="pone-0048941-g007">Figure 7C</xref>), in this order. Once one such pass over all the knots is complete, the whole process starts again, but only visiting those knots that have been modified in the previous pass or whose immediate neighbors were. The procedure ends either when all knots are removed or when no further changes to the PPC are consistent with the adjustment criteria. The PPC model is finally output to disk in a tabular format showing the segment lengths and the polynomial coefficients.</p>
    <fig id="pone-0048941-g007" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pone.0048941.g007</object-id>
      <label>Figure 7</label>
      <caption>
        <title>Operations on knots.</title>
        <p>Gray horizontal segments represent original data, black segments represent the PPC representation. Vertical lines show positions of knots and need not be evenly spaced in actual data. (A) Knot removal. (B) Adjustment that removes a discontinuity. (C) Adjustment of a knot position.</p>
      </caption>
      <graphic xlink:href="pone.0048941.g007"/>
    </fig>
    <p>Knot operations (<xref ref-type="fig" rid="pone-0048941-g007">Figure 7</xref>) involve generating a new polynomial line fitting the original data and in some cases this is aided by a local error minimization calculation. Since we work with curves rather than collections of points, we define local error as an integral of the squared difference between curves (this is a difference between our approach and traditional point-based regression techniques.) Although we sometimes minimize error to produce well-fitting polynomials, we stress this is only performed locally. The approach does not guarantee or even attempt to find a globally optimal fit.</p>
    <p>Whether a given knot operation is carried out or rejected depends on the smoothing “method” and an associated numerical parameter <inline-formula><inline-graphic xlink:href="pone.0048941.e042.jpg"/></inline-formula>. We implemented a number of distinct “methods” to make the tool applicable in a range of applications. These methods compare areas <inline-formula><inline-graphic xlink:href="pone.0048941.e043.jpg"/></inline-formula> under the original segments, labelled by an index <inline-formula><inline-graphic xlink:href="pone.0048941.e044.jpg"/></inline-formula>, of the input curve and the corresponding areas <inline-formula><inline-graphic xlink:href="pone.0048941.e045.jpg"/></inline-formula> under polynomials.</p>
    <p>One method accepts knot changes as long as the relative differences in areas below the original run-length encoded signal and corresponding sections of the PPC are below a threshold, i.e. if the condition <inline-formula><inline-graphic xlink:href="pone.0048941.e046.jpg"/></inline-formula> holds for all <inline-formula><inline-graphic xlink:href="pone.0048941.e047.jpg"/></inline-formula>. Another method is motivated by the Poisson distribution. It accepts changes to the PPC as long as the areas satisfy the condition <inline-formula><inline-graphic xlink:href="pone.0048941.e048.jpg"/></inline-formula> for all <inline-formula><inline-graphic xlink:href="pone.0048941.e049.jpg"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="pone.0048941.e050.jpg"/></inline-formula> can be used to modulate under- or over-dispersion of the distribution. Both methods are suitable for data originating from high-throughput sequencing. Finally, the last method is based on an empirical t-test statistic computed from segments adjacent to the knot, with <inline-formula><inline-graphic xlink:href="pone.0048941.e051.jpg"/></inline-formula> acting as a p-value cutoff (<xref ref-type="supplementary-material" rid="pone.0048941.s001">Text S1</xref>
<inline-formula><inline-graphic xlink:href="pone.0048941.e052.jpg"/></inline-formula>). This method is suitable for copy-number detection in array CGH or read-based sequencing of DNA. In all the methods, the focus is on checking the signal conforms to a set of criteria specified by the user and distinguishes the algorithm from canonical spline-building approaches.</p>
    <p>A corollary to the tune-ability of the acceptance of knot operations is that the algorithm can be run in a continuum between two limits: a strict limit in which the PPC output is identical to the input, and a loose limit in which the output signal contains only one polynomial segment. Between these limits, the procedure can produce smooth, discontinuous, as well as mixed models.</p>
    <p>Because the order of knot adjustment is randomized, repeated application of the algorithm on a given input can produce slightly different results. This has a number of positive effects. First, randomization implies that very little computation is required to determine which knot should be adjusted at any one stage. Second, the variability in the results can be regarded as a measure on uncertainty in the resulting model. Finally, stochasticity enables our approach to sample a fairly large space of possible solutions and is less prone to produce sub-optimal models than a method using steepest descent. We note however that our approach is not a full Monte-Carlo method as it terminates as soon as a locally optimal PPC model is found.</p>
    <p>As for implementation, our approach stipulates random access to all knots and efficient removal of any knot. We achieved these requirements using a data structure crossing a hash map and linked list. The hybrid structure requires more book-keeping than a simple array, but pays off in knot-removal performance. The smoothing program completes up to <inline-formula><inline-graphic xlink:href="pone.0048941.e053.jpg"/></inline-formula> passes, where <inline-formula><inline-graphic xlink:href="pone.0048941.e054.jpg"/></inline-formula> is the number of segments in the original data. In each pass, it compares at most <inline-formula><inline-graphic xlink:href="pone.0048941.e055.jpg"/></inline-formula> data elements so its asymptotic complexity is <inline-formula><inline-graphic xlink:href="pone.0048941.e056.jpg"/></inline-formula>. For genomic data, it can be the case that <inline-formula><inline-graphic xlink:href="pone.0048941.e057.jpg"/></inline-formula> so this is a significant optimization over any method not exploiting run-length encoding.</p>
    <p>In practice, the program can create a PPC model for a signal originating from an array (<inline-formula><inline-graphic xlink:href="pone.0048941.e058.jpg"/></inline-formula> probes) in less that 0.5 seconds on a personal computer with 3.2Ghz processor. Processing a human RNA-seq sample takes about 10 seconds per chromosome. Processing of a human whole-genome sequencing coverage track can take up to 15 minutes per chromosome. For the full-genome signals, the program can require access to 16GB of RAM.</p>
  </sec>
  <sec sec-type="supplementary-material" id="s5">
    <title>Supporting Information</title>
    <supplementary-material content-type="local-data" id="pone.0048941.s001">
      <label>Text S1</label>
      <caption>
        <p>
          <bold>Details on algorithm and additional results and examples.</bold>
        </p>
        <p>(PDF)</p>
      </caption>
      <media xlink:href="pone.0048941.s001.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>We thank members of IRIBHM for discussions.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="pone.0048941-Lai1">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Lai</surname><given-names>W</given-names></name>, <name><surname>Johnson</surname><given-names>M</given-names></name>, <name><surname>Kucherlapati</surname><given-names>R</given-names></name>, <name><surname>Park</surname><given-names>P</given-names></name> (<year>2005</year>) <article-title>Comparative analysis of algorithms for identifying amplifications and deletions in array cgh data</article-title>. <source>Bioinformatics</source>
<volume>21</volume>: <fpage>3763</fpage>–<lpage>3770</lpage>.<pub-id pub-id-type="pmid">16081473</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Magi1">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>Magi</surname><given-names>A</given-names></name>, <name><surname>Tattini</surname><given-names>L</given-names></name>, <name><surname>Pippucci</surname><given-names>T</given-names></name>, <name><surname>Torricelli</surname><given-names>F</given-names></name>, <name><surname>Benelli</surname><given-names>M</given-names></name> (<year>2011</year>) <article-title>Read count approach to DNA copy number variants detection</article-title>. <source>Bioinformatics</source>
<volume>28</volume>: <fpage>470</fpage>–<lpage>478</lpage>.<pub-id pub-id-type="pmid">22199393</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Willenbrock1">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Willenbrock</surname><given-names>H</given-names></name>, <name><surname>Fridlyand</surname><given-names>J</given-names></name> (<year>2005</year>) <article-title>A comparison study: applying segmentation to array cgh data for downstram analysis</article-title>. <source>Bioinformatics</source>
<volume>21</volume>: <fpage>4084</fpage>–<lpage>4091</lpage>.<pub-id pub-id-type="pmid">16159913</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Lee1">
      <label>4</label>
      <mixed-citation publication-type="other">Lee H, Schatz M (2012) Genomic dark matter: The reliability of short read mapping illustrated by the genome mappability score. Bioinformatics Adv. access: xxx.</mixed-citation>
    </ref>
    <ref id="pone.0048941-Wan1">
      <label>5</label>
      <mixed-citation publication-type="journal"><name><surname>Wan</surname><given-names>R</given-names></name>, <name><surname>Anh</surname><given-names>VN</given-names></name>, <name><surname>Asai</surname><given-names>K</given-names></name> (<year>2011</year>) <article-title>Transformations for the compression of FASTQ quality scores of next generation sequencing data</article-title>. <source>Bioinformatics</source>
<volume>28</volume>: <fpage>628</fpage>–<lpage>635</lpage>.<pub-id pub-id-type="pmid">22171329</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Kozantis1">
      <label>6</label>
      <mixed-citation publication-type="journal"><name><surname>Kozantis</surname><given-names>C</given-names></name>, <name><surname>Saunders</surname><given-names>C</given-names></name>, <name><surname>Kruglyak</surname><given-names>S</given-names></name>, <name><surname>Bafna</surname><given-names>V</given-names></name>, <name><surname>Varghese</surname><given-names>G</given-names></name> (<year>2011</year>) <article-title>Compressing genomic sequence fragments using slimgene</article-title>. <source>Journal of Computational Biology</source>
<volume>18</volume>: <fpage>401</fpage>–<lpage>413</lpage>.<pub-id pub-id-type="pmid">21385043</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-BarJoseph1">
      <label>7</label>
      <mixed-citation publication-type="journal"><name><surname>Bar-Joseph</surname><given-names>Z</given-names></name>, <name><surname>Gerber</surname><given-names>GK</given-names></name>, <name><surname>Gifford</surname><given-names>DK</given-names></name>, <name><surname>Jaakkola</surname><given-names>T</given-names></name>, <name><surname>Simon</surname><given-names>I</given-names></name> (<year>2003</year>) <article-title>Continuous representations of time-series gene expression data</article-title>. <source>Journal of Computational Biology</source>
<volume>10</volume>: <fpage>341</fpage>–<lpage>356</lpage>.<pub-id pub-id-type="pmid">12935332</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Konopka1">
      <label>8</label>
      <mixed-citation publication-type="journal"><name><surname>Konopka</surname><given-names>T</given-names></name> (<year>2011</year>) <article-title>Automated analysis of biological oscillator models using mode decomposition</article-title>. <source>Bioinformatics</source>
<volume>27</volume>: <fpage>961</fpage>–<lpage>967</lpage>.<pub-id pub-id-type="pmid">21317138</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Picard1">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>Picard</surname><given-names>F</given-names></name>, <name><surname>Lebarbier</surname><given-names>E</given-names></name>, <name><surname>Hoebeke</surname><given-names>M</given-names></name>, <name><surname>Rigaill</surname><given-names>G</given-names></name>, <name><surname>Thiam</surname><given-names>B</given-names></name>, <etal>et al</etal> (<year>2011</year>) <article-title>Joint segmentation, calling, and normalization of multiple CGH profiles</article-title>. <source>Biostatistics</source>
<volume>12</volume>: <fpage>413</fpage>–<lpage>428</lpage>.<pub-id pub-id-type="pmid">21209153</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Muggeo1">
      <label>10</label>
      <mixed-citation publication-type="journal"><name><surname>Muggeo</surname><given-names>VMR</given-names></name> (<year>2003</year>) <article-title>Estimating regression models with unknown break-points</article-title>. <source>Statistics in Medicine</source>
<volume>22</volume>: <fpage>3055</fpage>–<lpage>3071</lpage>.<pub-id pub-id-type="pmid">12973787</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Hansen1">
      <label>11</label>
      <mixed-citation publication-type="journal"><name><surname>Hansen</surname><given-names>M</given-names></name>, <name><surname>Kooperberg</surname><given-names>C</given-names></name> (<year>2002</year>) <article-title>Spline adaptation in extended linear models</article-title>. <source>Statistical Science</source>
<volume>17</volume>: <fpage>2</fpage>–<lpage>51</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0048941-Wallstrom1">
      <label>12</label>
      <mixed-citation publication-type="other">Wallstrom G, Liebner J, Kaas R (2008) An implementation of bayesian adaptive regression splines (BARS) in C with S and R wrappers. Journal of Statistical Software 26.</mixed-citation>
    </ref>
    <ref id="pone.0048941-Venkatraman1">
      <label>13</label>
      <mixed-citation publication-type="journal"><name><surname>Venkatraman</surname><given-names>E</given-names></name>, <name><surname>Olshem</surname><given-names>A</given-names></name> (<year>2007</year>) <article-title>A faster circular binary segmentation algorithm for the analysis of array CGH data</article-title>. <source>Bioinformatics</source>
<volume>23</volume>: <fpage>657</fpage>–<lpage>663</lpage>.<pub-id pub-id-type="pmid">17234643</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Hupe1">
      <label>14</label>
      <mixed-citation publication-type="journal"><name><surname>Hupe</surname><given-names>P</given-names></name>, <name><surname>Stransky</surname><given-names>N</given-names></name>, <name><surname>Thiery</surname><given-names>J</given-names></name>, <name><surname>Radvanyi</surname><given-names>F</given-names></name>, <name><surname>Barillot</surname><given-names>E</given-names></name> (<year>2004</year>) <article-title>Analysis of array cgh data: from signal ratio to gain and loss of dna regions</article-title>. <source>Bioinformatics</source>
<volume>20</volume>: <fpage>3413</fpage>–<lpage>3422</lpage>.<pub-id pub-id-type="pmid">15381628</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Fridlyand1">
      <label>15</label>
      <mixed-citation publication-type="journal"><name><surname>Fridlyand</surname><given-names>J</given-names></name>, <name><surname>Snijders</surname><given-names>A</given-names></name>, <name><surname>Pinkel</surname><given-names>D</given-names></name>, <name><surname>Albertson</surname><given-names>D</given-names></name>, <name><surname>Jain</surname><given-names>A</given-names></name> (<year>2004</year>) <article-title>Hidden markov models approach to the analysis of array cgh data</article-title>. <source>J Multivar Anal</source>
<volume>90</volume>: <fpage>132</fpage>.</mixed-citation>
    </ref>
    <ref id="pone.0048941-Yoon1">
      <label>16</label>
      <mixed-citation publication-type="journal"><name><surname>Yoon</surname><given-names>S</given-names></name>, <name><surname>Xuan</surname><given-names>Z</given-names></name>, <name><surname>Makaraov</surname><given-names>V</given-names></name>, <name><surname>Ye</surname><given-names>K</given-names></name>, <name><surname>Sebat</surname><given-names>J</given-names></name> (<year>2009</year>) <article-title>Sensitive and accurate detection of copy number variants using read depth of coverage</article-title>. <source>Genome Research</source>
<volume>19</volume>: <fpage>1586</fpage>–<lpage>1592</lpage>.<pub-id pub-id-type="pmid">19657104</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Langmead1">
      <label>17</label>
      <mixed-citation publication-type="journal"><name><surname>Langmead</surname><given-names>B</given-names></name>, <name><surname>Trapnell</surname><given-names>C</given-names></name>, <name><surname>Pop</surname><given-names>M</given-names></name>, <name><surname>Salzberg</surname><given-names>S</given-names></name> (<year>2009</year>) <article-title>Ultrafast and memory-efficient alignment of short DNA sequences to the human genome</article-title>. <source>Genome Biology</source>
<volume>10</volume>: <fpage>R25</fpage>.<pub-id pub-id-type="pmid">19261174</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-The1">
      <label>18</label>
      <mixed-citation publication-type="journal"><collab>The 1000 Genomes Project Consortium</collab> (<year>2010</year>) <article-title>A map of human genome variation from population-scale sequencing</article-title>. <source>Nature</source>
<volume>467</volume>: <fpage>1061</fpage>–<lpage>1073</lpage>.<pub-id pub-id-type="pmid">20981092</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Zheng1">
      <label>19</label>
      <mixed-citation publication-type="other">Zheng W, Chung L, Zhao H (2011) Bias detection and correction in rna-sequencing data. BMC Bioinformatics 22.</mixed-citation>
    </ref>
    <ref id="pone.0048941-Roberts1">
      <label>20</label>
      <mixed-citation publication-type="journal"><name><surname>Roberts</surname><given-names>A</given-names></name>, <name><surname>Trapnell</surname><given-names>C</given-names></name>, <name><surname>Donaghey</surname><given-names>J</given-names></name>, <name><surname>Rinn</surname><given-names>J</given-names></name>, <name><surname>Pachter</surname><given-names>L</given-names></name> (<year>2011</year>) <article-title>Improving RNA-seq expression estimates by correcting for fragment bias</article-title>. <source>Genome Biology</source>
<volume>12</volume>: <fpage>R22</fpage>.<pub-id pub-id-type="pmid">21410973</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Illumina1">
      <label>21</label>
      <mixed-citation publication-type="other">Illumina RNA-Seq of human individual tissues and mixture of 16 tissues. <ext-link ext-link-type="uri" xlink:href="http://wwwebiacuk/arrayexpress/E-MTAB-513">http://wwwebiacuk/arrayexpress/E-MTAB-513</ext-link>. Accessed 2012 Oct 10.</mixed-citation>
    </ref>
    <ref id="pone.0048941-Trapnell1">
      <label>22</label>
      <mixed-citation publication-type="journal"><name><surname>Trapnell</surname><given-names>C</given-names></name>, <name><surname>Pachter</surname><given-names>L</given-names></name>, <name><surname>Salzberg</surname><given-names>S</given-names></name> (<year>2009</year>) <article-title>Tophat: discovering splice junctions with RNA-seq</article-title>. <source>Bioinformatics</source>
<volume>25</volume>: <fpage>1105</fpage>–<lpage>1111</lpage>.<pub-id pub-id-type="pmid">19289445</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0048941-Dreszer1">
      <label>23</label>
      <mixed-citation publication-type="journal"><name><surname>Dreszer</surname><given-names>T</given-names></name>, <name><surname>Karolchik</surname><given-names>D</given-names></name>, <name><surname>Zweig</surname><given-names>A</given-names></name>, <name><surname>Hinrichs</surname><given-names>A</given-names></name>, <name><surname>Raney</surname><given-names>B</given-names></name>, <etal>et al</etal> (<year>2012</year>) <article-title>The UCSC genome browser database: extensions and updates 2011</article-title>. <source>Nucleic Acids Research</source>
<volume>40</volume>: <fpage>D918</fpage>–<lpage>D923</lpage>.<pub-id pub-id-type="pmid">22086951</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
