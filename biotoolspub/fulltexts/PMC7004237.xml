<?properties open_access?>
<?subarticle report37677?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Wellcome Open Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">Wellcome Open Res</journal-id>
    <journal-id journal-id-type="pmc">Wellcome Open Res</journal-id>
    <journal-title-group>
      <journal-title>Wellcome Open Research</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2398-502X</issn>
    <publisher>
      <publisher-name>F1000 Research Limited</publisher-name>
      <publisher-loc>London, UK</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7004237</article-id>
    <article-id pub-id-type="doi">10.12688/wellcomeopenres.15603.1</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software Tool Article</subject>
      </subj-group>
      <subj-group>
        <subject>Articles</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Antibiotic resistance prediction for
<italic>Mycobacterium tuberculosis</italic> from genome sequence data with Mykrobe</article-title>
      <fn-group content-type="pub-status">
        <fn>
          <p>[version 1; peer review: 2 approved, 1 approved with reservations]</p>
        </fn>
      </fn-group>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Hunt</surname>
          <given-names>Martin</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Formal Analysis</role>
        <role content-type="http://credit.casrai.org/">Investigation</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Software</role>
        <role content-type="http://credit.casrai.org/">Validation</role>
        <role content-type="http://credit.casrai.org/">Visualization</role>
        <role content-type="http://credit.casrai.org/">Writing – Original Draft Preparation</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bradley</surname>
          <given-names>Phelim</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Software</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-3967-3037</contrib-id>
        <xref ref-type="aff" rid="a1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lapierre</surname>
          <given-names>Simon Grandjean</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Original Draft Preparation</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-3646-1573</contrib-id>
        <xref ref-type="aff" rid="a3">3</xref>
        <xref ref-type="aff" rid="a4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Heys</surname>
          <given-names>Simon</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Software</role>
        <xref ref-type="aff" rid="a1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Thomsit</surname>
          <given-names>Mark</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Software</role>
        <xref ref-type="aff" rid="a1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hall</surname>
          <given-names>Michael B.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Formal Analysis</role>
        <role content-type="http://credit.casrai.org/">Investigation</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-3683-6208</contrib-id>
        <xref ref-type="aff" rid="a1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Malone</surname>
          <given-names>Kerri M.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Visualization</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-3974-0810</contrib-id>
        <xref ref-type="aff" rid="a1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wintringer</surname>
          <given-names>Penelope</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Software</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-6544-8605</contrib-id>
        <xref ref-type="aff" rid="a1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Walker</surname>
          <given-names>Timothy M.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-0421-9264</contrib-id>
        <xref ref-type="aff" rid="a2">2</xref>
        <xref ref-type="aff" rid="a5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Cirillo</surname>
          <given-names>Daniela M.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Comas</surname>
          <given-names>Iñaki</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-5504-9408</contrib-id>
        <xref ref-type="aff" rid="a7">7</xref>
        <xref ref-type="aff" rid="a8">8</xref>
        <xref ref-type="aff" rid="a9">9</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Farhat</surname>
          <given-names>Maha R.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a10">10</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fowler</surname>
          <given-names>Phillip</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-0912-4483</contrib-id>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gardy</surname>
          <given-names>Jennifer</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a11">11</xref>
        <xref ref-type="aff" rid="a12">12</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ismail</surname>
          <given-names>Nazir</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a13">13</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kohl</surname>
          <given-names>Thomas A.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a14">14</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Mathys</surname>
          <given-names>Vanessa</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-5218-927X</contrib-id>
        <xref ref-type="aff" rid="a15">15</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Merker</surname>
          <given-names>Matthias</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a14">14</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Niemann</surname>
          <given-names>Stefan</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a14">14</xref>
        <xref ref-type="aff" rid="a16">16</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Omar</surname>
          <given-names>Shaheed Vally</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a13">13</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Sintchenko</surname>
          <given-names>Vitali</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a17">17</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Smith</surname>
          <given-names>Grace</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a18">18</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>van Soolingen</surname>
          <given-names>Dick</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a19">19</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Supply</surname>
          <given-names>Philip</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a20">20</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Tahseen</surname>
          <given-names>Sabira</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-6887-8149</contrib-id>
        <xref ref-type="aff" rid="a21">21</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wilcox</surname>
          <given-names>Mark</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a22">22</xref>
        <xref ref-type="aff" rid="a23">23</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Arandjelovic</surname>
          <given-names>Irena</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-3753-8248</contrib-id>
        <xref ref-type="aff" rid="a24">24</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Peto</surname>
          <given-names>Tim E. A.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Crook</surname>
          <given-names>Derrick W.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Funding Acquisition</role>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-0590-2850</contrib-id>
        <xref ref-type="aff" rid="a2">2</xref>
        <xref ref-type="aff" rid="a25">25</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Iqbal</surname>
          <given-names>Zamin</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Funding Acquisition</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Project Administration</role>
        <role content-type="http://credit.casrai.org/">Supervision</role>
        <role content-type="http://credit.casrai.org/">Validation</role>
        <role content-type="http://credit.casrai.org/">Writing – Original Draft Preparation</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-8466-7547</contrib-id>
        <xref ref-type="corresp" rid="c1">a</xref>
        <xref ref-type="aff" rid="a1">1</xref>
      </contrib>
      <aff id="a1"><label>1</label>European Bioinformatics Institute, Cambridge, UK</aff>
      <aff id="a2"><label>2</label>Nuffield Department of Medicine, University of Oxford, Oxford, UK</aff>
      <aff id="a3"><label>3</label>Centre de Recherche du Centre Hospitalier de l'Universite de Montreal, Montreal, Canada</aff>
      <aff id="a4"><label>4</label>Infectiology &amp; immunology department, Universite de Montreal Microbiology, Montreal, Canada</aff>
      <aff id="a5"><label>5</label>Oxford University Clinical Research Unit, Ho Chi Minh City, Vietnam</aff>
      <aff id="a6"><label>6</label>Emerging Bacterial Pathogens Unit, WHO collaborating Centre and TB Supranational Reference laboratory, IRCCS San Raffaele Scientific institute, Milan, Italy</aff>
      <aff id="a7"><label>7</label>Instituto de Biomedicina de Valencia (IBV-CSIC), Valencia, Spain</aff>
      <aff id="a8"><label>8</label>FISABIO Public Health, Valencia, Spain</aff>
      <aff id="a9"><label>9</label>CIBER in Epidemiology and Public Health, Madrid, Spain</aff>
      <aff id="a10"><label>10</label>Harvard Medical School, Boston, USA</aff>
      <aff id="a11"><label>11</label>British Columbia Centre for Disease Control, Vancouver, Canada</aff>
      <aff id="a12"><label>12</label>Bill and Melinda Gates Foundation, Seattle, USA</aff>
      <aff id="a13"><label>13</label>National Institute for Communicable Diseases (NICD), Johannesburg, South Africa</aff>
      <aff id="a14"><label>14</label>Forschungszentrum Borstel, Leibniz Lungenzentrum, Borstel, Germany</aff>
      <aff id="a15"><label>15</label>Unit Bacterial Diseases Service, Infectious Diseases in Humans, Sciensano, Brussels, Belgium</aff>
      <aff id="a16"><label>16</label>German Center for Infection Research, Borstel Site, Borstel, Germany</aff>
      <aff id="a17"><label>17</label>Centre for Infectious Diseases and Microbiology - Public Health, University of Sydney, Sydney, Australia</aff>
      <aff id="a18"><label>18</label>National Mycobacterial Reference Service, Public Health England Public Health Laboratory, Birmingham, UK</aff>
      <aff id="a19"><label>19</label>National Institute for Public Health and the Environment (RIVM), Bilthoven, The Netherlands</aff>
      <aff id="a20"><label>20</label>Univ. Lille, CNRS, Inserm, CHU Lille, Institut Pasteur de Lille, U1019 - UMR 8204 - CIIL - Centre d'Infection et d'Immunite de Lille, Lille, France</aff>
      <aff id="a21"><label>21</label>National TB Reference Laboratory, National TB control Program, Islamabad, Pakistan</aff>
      <aff id="a22"><label>22</label>Leeds Teaching Hospital NHS Trust, Leeds, UK</aff>
      <aff id="a23"><label>23</label>University of Leeds, Leeds, UK</aff>
      <aff id="a24"><label>24</label>Faculty of Medicine, Institute of Microbiology and Immunology, Belgrade, Serbia</aff>
      <aff id="a25"><label>25</label>National Infection Service, Public Health England, UK</aff>
    </contrib-group>
    <author-notes>
      <corresp id="c1">
        <label>a</label>
        <email xlink:href="mailto:zi@ebi.ac.uk">zi@ebi.ac.uk</email>
      </corresp>
      <fn fn-type="con">
        <p>MH, PB and ZI developed all methods. MH and ZI analysed data. MH, ZI and SGL wrote the manuscript. PB, SH, and MT wrote the
<italic>Mykrobe</italic> codebase. PW did software and user-interface testing. MH wrote and ran the analysis pipeline, and contributed to the nanopore-specific sections of the
<italic>Mykrobe</italic> codebase. SGL designed and contributed to WHO drug regimen analysis; MH encoded the WHO regimen algorithm, applied it and analysed the results. MBH contributed to Oxford nanopore methods and data analysis. KM contributed to the figures and WHO analysis. All other authors contributed sample data, read the paper and provided detailed feedback.</p>
      </fn>
      <fn fn-type="COI-statement">
        <p>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>2</day>
      <month>12</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2019</year>
    </pub-date>
    <volume>4</volume>
    <elocation-id>191</elocation-id>
    <history>
      <date date-type="accepted">
        <day>22</day>
        <month>11</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright: © 2019 Hunt M et al.</copyright-statement>
      <copyright-year>2019</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="wellcomeopenres-4-17090.pdf"/>
    <abstract>
      <p>Two billion people are infected with
<italic>Mycobacterium tuberculosis</italic>, leading to 10 million new cases of active tuberculosis and 1.5 million deaths annually. Universal access to drug susceptibility testing (DST) has become a World Health Organization priority. We previously developed a software tool,
<italic>Mykrobe predictor</italic>, which provided offline species identification and drug resistance predictions for
<italic>M. tuberculosis </italic>from whole genome sequencing (WGS) data. Performance was insufficient to support the use of WGS as an alternative to conventional phenotype-based DST, due to mutation catalogue limitations. </p>
      <p> Here we present a new tool,
<italic>Mykrobe</italic>, which provides the same functionality based on a new software implementation. Improvements include i) an updated mutation catalogue giving greater sensitivity to detect pyrazinamide resistance, ii) support for user-defined resistance catalogues, iii) improved identification of non-tuberculous mycobacterial species, and iv) an updated statistical model for Oxford Nanopore Technologies sequencing data.
<italic>Mykrobe</italic> is released under MIT license at https://github.com/mykrobe-tools/mykrobe. We incorporate mutation catalogues from the CRyPTIC consortium et al. (2018) and from Walker et al. (2015), and make improvements based on performance on an initial set of 3206 and an independent set of 5845
<italic>M. tuberculosis</italic> Illumina sequences. To give estimates of error rates, we use a prospectively collected dataset of 4362
<italic>M. tuberculosis isolates</italic>. Using culture based DST as the reference, we estimate
<italic>Mykrobe</italic> to be 100%, 95%, 82%, 99% sensitive and 99%, 100%, 99%, 99% specific for rifampicin, isoniazid, pyrazinamide and ethambutol resistance prediction respectively. We benchmark against four other tools on 10207 (=5845+4362) samples, and also show that
<italic>Mykrobe</italic> gives concordant results with nanopore data. </p>
      <p> We measure the ability of
<italic>Mykrobe</italic>-based DST to guide personalized therapeutic regimen design in the context of complex drug susceptibility profiles, showing 94% concordance of implied regimen with that driven by phenotypic DST, higher than all other benchmarked tools.</p>
    </abstract>
    <kwd-group kwd-group-type="author">
      <kwd>Antimicrobial resistance</kwd>
      <kwd>tuberculosis</kwd>
      <kwd>diagnostic</kwd>
      <kwd>nanopore</kwd>
      <kwd>whole genome sequencing</kwd>
      <kwd>antibiotic treatment</kwd>
    </kwd-group>
    <funding-group>
      <award-group id="fund-1" xlink:href="http://dx.doi.org/10.13039/501100000288">
        <funding-source>Royal Society</funding-source>
        <award-id>102541</award-id>
      </award-group>
      <award-group id="fund-2" xlink:href="http://dx.doi.org/10.13039/100000865">
        <funding-source>Bill and Melinda Gates Foundation</funding-source>
        <award-id>OPP1133541</award-id>
      </award-group>
      <award-group id="fund-3" xlink:href="https://doi.org/10.13039/100004440">
        <funding-source>Wellcome Trust</funding-source>
        <award-id>102541</award-id>
        <award-id>200205</award-id>
      </award-group>
      <award-group id="fund-4" xlink:href="http://dx.doi.org/10.13039/100004440">
        <funding-source>Wellcome Trust</funding-source>
        <award-id>214560</award-id>
      </award-group>
      <funding-statement>ZI was funded by a Wellcome Trust/Royal Society Sir Henry Dale Fellowship, grant number 102541. MH was supported by Wellcome Trust/Newton Fund-MRC Collaborative Award [200205]; and Bill &amp; Melinda Gates Foundation Trust [OPP1133541]. TMW is a Wellcome Trust Clinical Career Development Fellow, grant number 214560. </funding-statement>
      <funding-statement>
        <italic>The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</italic>
      </funding-statement>
    </funding-group>
  </article-meta>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>The software tool
<italic>Mykrobe predictor</italic>
<sup><xref rid="ref-1" ref-type="bibr">1</xref></sup>, released in 2015, identified isolates to the species level and predicted the drug susceptibility testing (DST) profile of
<italic>Staphylococcus aureus</italic> and
<italic>Mycobacterium tuberculosis</italic> directly from genomic sequencing data.
<italic>Mykrobe predictor</italic> was developed to address four needs. First, it provided robust genotyping of single nucleotide polymorphisms (SNPs), insertions and deletions (indel) and gene alleles, independently of the location of mutations (where "location" is used both in the sense of coordinate, and in the sense of chromosomal versus plasmid). It also did this with error rates that did not depend on the phylogenetic position of the isolate of interest, a characteristic of all reference-genome methods
<sup><xref rid="ref-2" ref-type="bibr">2</xref></sup>. We did this by building a de Bruijn “genome graph” representation of known variation in the species, incorporating both resistant and susceptible alleles, and also nearby variation that might affect
<italic>k</italic>-mer matching (equivalent to neighbouring mutations affecting a PCR probe (see Figure 1 of
<xref rid="ref-1" ref-type="bibr">1</xref>)). Second, it identified target species, with prior knowledge of likely contaminants, and prevented misdiagnosis of resistance due to shared elements. Third, it predicted phenotype from genotype, including from low (within-isolate) frequency alleles. Fourth, it integrated these functionalities in a fast, lightweight, internet-free and user-friendly platform.</p>
    <p>In that initial publication
<sup><xref rid="ref-1" ref-type="bibr">1</xref></sup>, for
<italic>M. tuberculosis</italic>, the drug resistance conferring mutation panel was based on first and second generation line probe assays (LPA) (HAIN Lifesciences, Nehren, Germany) resulting in low sensitivity but high specificity. We also showed that detecting minor populations of resistant alleles improved the ability to predict resistance for some second-line drugs (amikacin, capreomycin, ofloxacin), although the low number of samples with associated second-line phenotypic data left this analysis underpowered, and needing replication.</p>
    <p>There were a number of improvements we wished to make over the 2015
<italic>Mykrobe predictor</italic> codebase. First, we wanted a cleaner codebase. Second we wanted users to be able to specify their own resistance catalogue. The latest
<italic>Mykrobe predictor</italic> catalogue, updated since publication, was based on Walker
<italic>et al.</italic>
<sup><xref rid="ref-3" ref-type="bibr">3</xref></sup>. Walker
<italic>et al.</italic> derived this catalogue by analysing the same 3500 samples which were used in the initial
<italic>Mykrobe predictor</italic> performance analysis
<sup><xref rid="ref-1" ref-type="bibr">1</xref></sup> - thus no independent test or validation dataset were available to properly estimate error rates. Finally, we wanted to further develop the support for nanopore data which had been improved by the use of a slightly different statistical model
<sup><xref rid="ref-4" ref-type="bibr">4</xref></sup>, but only tested on
<italic>N</italic> = 5 replicates of a single strain of
<italic>M. bovis</italic> substrain BCG.</p>
    <p>A number of other tools for detection of resistance-associated alleles have been released: ABRicate (Seemann), ARIBA
<sup><xref rid="ref-5" ref-type="bibr">5</xref></sup>, ARGs-OAP
<sup><xref rid="ref-6" ref-type="bibr">6</xref></sup>, ARG-ANNOT
<sup><xref rid="ref-7" ref-type="bibr">7</xref></sup>, CASTB
<sup><xref rid="ref-8" ref-type="bibr">8</xref></sup>, KvarQ
<sup><xref rid="ref-9" ref-type="bibr">9</xref></sup>, MTBseq
<sup><xref rid="ref-10" ref-type="bibr">10</xref></sup>, PhyResSe
<sup><xref rid="ref-11" ref-type="bibr">11</xref></sup>, RAST
<sup><xref rid="ref-12" ref-type="bibr">12</xref></sup>, ResFinder
<sup><xref rid="ref-13" ref-type="bibr">13</xref></sup>, RGI
<sup><xref rid="ref-14" ref-type="bibr">14</xref></sup>, SRST2
<sup><xref rid="ref-15" ref-type="bibr">15</xref></sup>, SSTAR
<sup><xref rid="ref-16" ref-type="bibr">16</xref></sup>, and TB-Profiler
<sup><xref rid="ref-17" ref-type="bibr">17</xref></sup>. The majority look for gene presence, primarily in
<italic>enterobacteriaceae</italic>, but some also look for SNP and indel mutations. In particular, SRST2 which maps reads to a panel of alleles (tested on
<italic>S. aureus</italic>,
<italic>Streptococcus pneumoniae</italic>,
<italic>Salmonella enterica</italic> serovar Typhimurium,
<italic>Shigella sonnei</italic>,
<italic>Enterococcus faecium</italic>,
<italic>Listeria monocytogenes</italic> and
<italic>Klebsiella pneumoniae</italic>), and ARIBA which performs local assembly (tested on
<italic>E. faecium</italic>,
<italic>S. sonnei</italic> and
<italic>Neisseria gonorrhoeae</italic>). In the specific case of
<italic>M. tuberculosis</italic>, where there is very little recombination, resistance prediction is dominated by the ability to correctly genotype SNPs and indels. Various tools have been developed to achieve this. These include the web-tool PhyResSE
<sup><xref rid="ref-11" ref-type="bibr">11</xref></sup>, KvarQ
<sup><xref rid="ref-9" ref-type="bibr">9</xref></sup> which uses
<italic>k</italic>-mers, and TB-Profiler
<sup><xref rid="ref-17" ref-type="bibr">17</xref></sup> which uses mapping; earlier versions were benchmarked in
<xref rid="ref-18" ref-type="bibr">18</xref>. Another tool, MTBseq
<sup><xref rid="ref-10" ref-type="bibr">10</xref></sup> is a general mapping-based WGS pipeline for
<italic>M. tuberculosis</italic> which can in particular be used to predict resistance. Our expectation was that for
<italic>M. tuberculosis</italic>, the resistance panel would be the key determinant of sensitivity and specificity, as was previously demonstrated for
<italic>S. aureus</italic>
<sup><xref rid="ref-19" ref-type="bibr">19</xref></sup>. We confirm this below.</p>
    <p>In a recent study on resistance to first-line tuberculosis (TB) drugs (rifampicin, isoniazid, ethambutol and pyrazinamide)
<sup><xref rid="ref-20" ref-type="bibr">20</xref></sup> the authors show, for the first time, that sequencing-based prediction of susceptibility is accurate enough for clinical use. They classify resistance-associated gene mutations as i) resistance-causing mutations, ii) definitely not resistance-causing mutations, or iii) unknown significance mutations. Their resistance mutation catalogue included variants from a systematic review from Miotto
<italic>et al.</italic>
<sup><xref rid="ref-21" ref-type="bibr">21</xref></sup> and some new
<italic>pncA</italic> mutations from
<xref rid="ref-22" ref-type="bibr">22</xref>. It also characterised all frame-shifts in
<italic>pncA</italic> and
<italic>katG</italic> as causing resistance to pyrazinamide or isoniazid respectively. Using phenotyping as gold standard, they measured performance characteristics of WGS-based DST, including sensitivity and specificity, on the samples for which a prediction can be made with high confidence. They propose a workflow where a sample is sequenced, and if an "unknown significance" mutation is seen, then no resistance/susceptibility prediction is made, but the sample is instead referred for phenotyping. This provides a means whereby healthcare systems can leverage the advantages of WGS for rapid and comprehensive DST, be informed when a given sample is pushing against the limits of our knowledge, and revert to slower but well-understood and trusted phenotyping in order to provide clinicians with reliable results, and prospectively enrich available databases.</p>
    <p>In this study we evaluate our new lightweight offline species-identification and resistance prediction tool, named simply
<italic>Mykrobe</italic>
<sup><xref rid="ref-23" ref-type="bibr">23</xref></sup>. The species-identification methodology is unchanged since
<sup><xref rid="ref-1" ref-type="bibr">1</xref></sup>, but after publication
<italic>Mykrobe predictor</italic> was heavily evaluated by Public Health England, and in order to pass their acceptance criteria, we improved our species-informative probes. We report the results of applying these prospectively at PHE below, but this study primarily concerns improvements in resistance prediction. We first combine the resistance catalogue from The CRyPTIC Consortium
<italic>et al.</italic>
<sup><xref rid="ref-20" ref-type="bibr">20</xref></sup> with the pre-existing second-line drug resistance catalogue from Walker
<italic>et al.</italic>
<sup><xref rid="ref-3" ref-type="bibr">3</xref></sup>. We treat this catalogue as our first candidate catalogue and improve it in an iterative process, evaluating it on successive datasets.</p>
    <p>We benchmark
<italic>Mykrobe</italic> against a range of other tools: ARIBA (using the same catalogue as
<italic>Mykrobe</italic>, as a control), and also KvarQ, MTBseq, and TB-profiler using their inbuilt catalogues. In contrast to the approach introduced in
<xref rid="ref-20" ref-type="bibr">20</xref>,
<italic>Mykrobe</italic> has no concept of "unknown significance", predicting susceptibility if there is no known resistance mutation. We quantify the trade-offs between these approaches.</p>
    <p>The World Health Organisation (WHO) publishes guidelines for TB treatment including drug susceptible, single drug-resistant, multidrug-resistant (MDR-TB) and extensively drug-resistant TB (XDR-TB)
<sup><xref rid="ref-24" ref-type="bibr">24</xref>–
<xref rid="ref-27" ref-type="bibr">27</xref></sup>. These guidelines are regularly reviewed and updated to appropriately reflect, and adapt to, the evolution of
<italic>M. tuberculosis</italic> resistance and the availability of novel TB drugs, whether new or re-purposed. Based on latest WHO recommendations, we simulate the ability of
<italic>Mykrobe</italic> to guide personalized therapeutic regimen design and compare the
<italic>Mykrobe</italic>-inferred regimen against that implied by phenotypic testing. We find that
<italic>Mykrobe</italic> compares favourably with the gold-standard approach and is superior to the other tools we benchmark. We believe that this is a novel and important metric for the evaluation of an
<italic>in silico</italic> DST tool.</p>
    <p>One ongoing challenge for the development of
<italic>in silico</italic> DST, is that only limited phenotype and sequence data are shared openly for reuse and validation. We address both of these problems in this paper. First, we make available all our underlying data both in public and in easily-reusable text format. Second, we chose to publish in this journal specifically because we can update the paper as the catalogue is modified and when competitor tools are updated, to give current results pointing to the latest underlying data.</p>
  </sec>
  <sec sec-type="results">
    <title>Results</title>
    <sec>
      <title>Species identification</title>
      <p><italic>Mykrobe predictor</italic> was evaluated extensively by Public Health England (PHE) for species identification of
<italic>Mycobacteria</italic> in 2016 and a need to improve on the identification of non-tuberculous Mycobacteria (NTMs) was identified. As a result, a new set of probes was built by augmenting the initial training set to 1018 samples, building a pooled de Bruijn graph, and searching for species informative contigs (method described in
<xref rid="ref-1" ref-type="bibr">1</xref>) to use as probes. These were evaluated in a PHE laboratory where all mycobacterial samples were prospectively sequenced over the course of one year, and the results published
<sup><xref rid="ref-28" ref-type="bibr">28</xref></sup>: of 1902 samples for which Line Probe Assay (LPA) testing had identified a clinically important mycobacterium and whole genome sequencing data was also available, 1825 (96%) were correctly identified to the species level by
<italic>Mykrobe</italic> (treating the LPA as gold standard).
<italic>Mykrobe</italic>
<sup><xref rid="ref-23" ref-type="bibr">23</xref></sup> incorrectly identified 33 isolates as a different species within the same complex (6 MTBC, 3
<italic>M. abscessus</italic> complex, 7
<italic>M. avium</italic> complex, and 17
<italic>M. fortuitum</italic> complex isolates). We have adopted the same probes in
<italic>Mykrobe</italic>, and no further evaluation has been done in this study.</p>
    </sec>
    <sec>
      <title>Drug resistance prediction</title>
      <p><bold>Data.</bold> We re-use the sequencing and phenotype data from
<xref rid="ref-1" ref-type="bibr">1</xref>,
<xref rid="ref-54" ref-type="bibr">54</xref> and
<xref rid="ref-51" ref-type="bibr">51</xref>; the latter included only first-line phenotypes, so in this study we augment that data with second-line phenotype data. We also remove in advance those samples which were identified as likely sample-swaps in
<xref rid="ref-51" ref-type="bibr">51</xref>. We split the samples into three disjoint datasets:</p>
      <list list-type="bullet">
        <list-item>
          <p>Training set:
<italic>N</italic> = 3206 isolates, from
<xref rid="ref-1" ref-type="bibr">1</xref>)</p>
        </list-item>
        <list-item>
          <p>Prospective set:
<italic>N</italic> = 4362 isolates from
<xref rid="ref-20" ref-type="bibr">20</xref>; specifically these were the only isolates that were sampled prospectively (from Italy, Germany, the Netherlands and the UK) to enable realistic error-estimates.</p>
        </list-item>
        <list-item>
          <p>Global set:
<italic>N</italic> = 5845, the remaining isolates from
<xref rid="ref-20" ref-type="bibr">20</xref>.</p>
        </list-item>
      </list>
      <p>See
<xref ref-type="fig" rid="f1">Figure 1</xref> and
<italic>Source data</italic>
<monospace><ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/sample_data_tsv/7556789">sample_data.tsv</ext-link></monospace>
<sup><xref rid="ref-29" ref-type="bibr">29</xref></sup> for a per-country breakdown of the datasets.</p>
      <fig fig-type="figure" id="f1" orientation="portrait" position="anchor">
        <label>Figure 1. </label>
        <caption>
          <p>Global (
<bold>a</bold>) and European (
<bold>b</bold>) origin of samples included in this study. Numbers represent the total numbers of samples from each region or country. Colours represent the proportion in each study dataset (see Source data
<monospace><ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/sample_data_tsv/7556789">sample_data.tsv</ext-link></monospace> for complete details
<sup><xref rid="ref-29" ref-type="bibr">29</xref></sup>).</p>
        </caption>
        <graphic xlink:href="wellcomeopenres-4-17090-g0000"/>
      </fig>
      <p><bold>Initial development of resistance panel.</bold> We started with a mutation catalogue (candidate panel 1, CP1) built by combining those from
<xref rid="ref-20" ref-type="bibr">20</xref> for first-line drugs and
<xref rid="ref-3" ref-type="bibr">3</xref> for second-line drugs. An iterative process was used to remove variants from the panel after running
<italic>Mykrobe</italic> on each dataset (see Methods and
<xref ref-type="fig" rid="f2">Figure 2</xref> for details). First, CP1 was evaluated on the Training set. This resulted in the removal of six variants from the panel which had positive predictive value less than 5%, producing candidate panel 2, CP2 (see Methods for details). CP1 is given in
<italic>Source data</italic>
<monospace><ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/panel_CP1_tsv/7605383">panel.CP1.tsv</ext-link></monospace>
<sup><xref rid="ref-30" ref-type="bibr">30</xref></sup>,
<monospace><ext-link ext-link-type="uri" xlink:href="panel.CP1.json">panel.CP1.json</ext-link></monospace>
<sup><xref rid="ref-31" ref-type="bibr">31</xref></sup>, and the six variants removed from CP1 to generate CP2 are in
<italic>Source data</italic>
<monospace><ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/removed_variants_tsv/7605380">removed_variants.tsv</ext-link></monospace>
<sup><xref rid="ref-32" ref-type="bibr">32</xref></sup>. We then measured the performance of
<italic>Mykrobe</italic> with this panel on the large Global dataset.</p>
      <fig fig-type="figure" id="f2" orientation="portrait" position="anchor">
        <label>Figure 2. </label>
        <caption>
          <title>Process for developing the new
<italic>Mykrobe</italic> variant panel.</title>
          <p>See main text for details.</p>
        </caption>
        <graphic xlink:href="wellcomeopenres-4-17090-g0001"/>
      </fig>
      <p><bold>Resistance prediction performance on Global dataset.</bold> We show in
<xref ref-type="fig" rid="f3">Figure 3</xref> a comparison of three sets of predictions on the Global dataset: those from
<xref rid="ref-20" ref-type="bibr">20</xref>, those from
<italic>Mykrobe</italic> using the panel ("Walker-2015") used by our previous software
<italic>Mykrobe predictor</italic>, and those from
<italic>Mykrobe</italic> using CP2 (complete results are in
<italic>Extended data</italic> file
<monospace><ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/accuracy_stats_tsv/7605398">accuracy_stats.tsv</ext-link></monospace>
<sup><xref rid="ref-33" ref-type="bibr">33</xref></sup>). The greatest difference in performance based on Walker-2015 and CP2 is in pyrazinamide, where sensitivity increases from 25% in Walker-2015 to 74% in CP2, at the cost of specificity falling from 98% to 94%. Numerous rare variants were the source of reduced pyrazinamide specificity in CP2, most of which also cause true-positives (
<italic>Extended data</italic> file
<monospace><ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/variant_counts_tsv/7605407">variant_counts.tsv</ext-link></monospace>
<sup><xref rid="ref-34" ref-type="bibr">34</xref></sup>). However, 21 of these variants resulted in 29 false-positives and no true-positives and were therefore removed from CP2 to make CP3. We did however notice that of these 21, 16 were in the resistance catalogue from
<xref rid="ref-22" ref-type="bibr">22</xref>, which provides direct experimental evidence for their impact, and so we may reinstate them in future given further data.</p>
      <fig fig-type="figure" id="f3" orientation="portrait" position="anchor">
        <label>Figure 3. </label>
        <caption>
          <title>Comparison of NEJM-2018 (results from
<xref rid="ref-20" ref-type="bibr">20</xref>),
<italic>Mykrobe</italic> using the Walker-2015 panel and
<italic>Mykrobe</italic> using candidate panel 2 (CP2) on the Global dataset.</title>
          <p>Counts of susceptible samples are shown on the left, broken down for each tool/panel into those correctly identified as susceptible (in the colour of the tool/panel), those falsely identified as resistant coloured red and no-calls coloured grey. Similarly, resistant samples are shown on the right, with those correctly identified as resistant coloured by the tool/panel, those falsely identified as susceptible in red, and no-calls in grey. Note that second-line drugs were not considered in NEJM-2018, and so are not shown. E, ethambutol; H, isoniazid; Z, pyrazinamide; R, rifampicin; Am, amikacin; Cm, capreomycin; Cfx, ciprofloxacin; Km, kanamycin; Mfx, moxifloxacin; Ofx, ofloxacin; S, streptomycin.</p>
        </caption>
        <graphic xlink:href="wellcomeopenres-4-17090-g0002"/>
      </fig>
      <p>The difference between Walker-2015 (86% sensitivity, 89% specificity) and CP2 (84% sensitivity, 89% specificity) for ethambutol is explained by two variants in the
<italic>embB</italic> gene. The first site, M306, is included in all panels. However, in Walker-2015 it is present as any non-synonymous change, whereas in NEJM-2018 (and hence CP1 and CP2) only the more specific M306I and M306V are included. The variant M306L (in all samples found as ATG changed to CTG) causes 27 correct resistant calls, but also 14 false-positives. The second site is Q497K, which is in both Walker-2015 and CP1, causes 15 true-positive and 5 false-positive calls on the Global dataset, but was excluded from CP2 because its only contribution was 3 false-positives on the Training dataset.</p>
      <p>In terms of bottom-line statistics on this, our largest dataset containing the widest range of resistance alleles, Very Major Error rate (VME, missed resistance) for the first-line drugs was 4.9%, 6.2%, 14.7%, 26.0% for rifampicin, isoniazid, ethambutol, pyrazinamide respectively, with corresponding negative predictive values of 95.7%, 93.6%, 93.8%, 90.1%. The Major Error rate (false resistance prediction) was: 2.0%, 2.0%, 11.0%, 6.9% respectively. These results can be seen in
<xref rid="T1" ref-type="table">Table 1b</xref>. We discuss below how the approach taken in
<xref rid="ref-20" ref-type="bibr">20</xref> improved on this VME despite using essentially the same catalogue.</p>
      <table-wrap id="T1" orientation="portrait" position="anchor">
        <label>Table 1. </label>
        <caption>
          <title>Performance of
<italic>Mykrobe</italic> during development of the variant panel.</title>
          <p>TP, number of phenotypically resistant samples that correctly identified as resistant ("true positives"); FP, number of phenotypically susceptible samples which are falsely identified as resistant ("false positives"); TN, number of phenotypically susceptible samples that are correctly identified as susceptible ("true negatives"); FN, number of phenotypically resistant samples that are incorrectly identified as susceptible ("false negative"); VME, very major error rate (false-negative rate); ME, major error rate (false-positive rate); PPV, positive predictive value; NPV, negative predictive value. 95% binomial confidence intervals calculated using the Wilson score interval.</p>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th align="left" colspan="9" rowspan="1">(a) Candidate panel 1, Training dataset</th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">Drug</th>
              <th align="right" rowspan="1" colspan="1">TP</th>
              <th align="right" rowspan="1" colspan="1">FP</th>
              <th align="right" rowspan="1" colspan="1">TN</th>
              <th align="right" rowspan="1" colspan="1">FN</th>
              <th align="center" rowspan="1" colspan="1">VME (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">ME (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">PPV (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">NPV (95% CI)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ethambutol</td>
              <td align="right" rowspan="1" colspan="1">209</td>
              <td align="right" rowspan="1" colspan="1">121</td>
              <td align="right" rowspan="1" colspan="1">2807</td>
              <td align="right" rowspan="1" colspan="1">22</td>
              <td align="center" rowspan="1" colspan="1">9.52(6.4-14.0%)</td>
              <td align="center" rowspan="1" colspan="1">4.13(3.5-4.9%)</td>
              <td align="center" rowspan="1" colspan="1">63.33(58.0-68.3%)</td>
              <td align="center" rowspan="1" colspan="1">99.22(98.8-99.5%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Isoniazid</td>
              <td align="right" rowspan="1" colspan="1">564</td>
              <td align="right" rowspan="1" colspan="1">32</td>
              <td align="right" rowspan="1" colspan="1">2538</td>
              <td align="right" rowspan="1" colspan="1">38</td>
              <td align="center" rowspan="1" colspan="1">6.31(4.6-8.5%)</td>
              <td align="center" rowspan="1" colspan="1">1.25(0.9-1.8%)</td>
              <td align="center" rowspan="1" colspan="1">94.63(92.5-96.2%)</td>
              <td align="center" rowspan="1" colspan="1">98.52(98.0-98.9%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Rifampicin</td>
              <td align="right" rowspan="1" colspan="1">373</td>
              <td align="right" rowspan="1" colspan="1">40</td>
              <td align="right" rowspan="1" colspan="1">2714</td>
              <td align="right" rowspan="1" colspan="1">11</td>
              <td align="center" rowspan="1" colspan="1">2.86(1.6-5.1%)</td>
              <td align="center" rowspan="1" colspan="1">1.45(1.1-2.0%)</td>
              <td align="center" rowspan="1" colspan="1">90.31(87.1-92.8%)</td>
              <td align="center" rowspan="1" colspan="1">99.6(99.3-99.8%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Amikacin</td>
              <td align="right" rowspan="1" colspan="1">56</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">702</td>
              <td align="right" rowspan="1" colspan="1">8</td>
              <td align="center" rowspan="1" colspan="1">12.5(6.5-22.8%)</td>
              <td align="center" rowspan="1" colspan="1">0.43(0.1-1.2%)</td>
              <td align="center" rowspan="1" colspan="1">94.92(86.1-98.3%)</td>
              <td align="center" rowspan="1" colspan="1">98.87(97.8-99.4%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Capreomycin</td>
              <td align="right" rowspan="1" colspan="1">51</td>
              <td align="right" rowspan="1" colspan="1">36</td>
              <td align="right" rowspan="1" colspan="1">669</td>
              <td align="right" rowspan="1" colspan="1">10</td>
              <td align="center" rowspan="1" colspan="1">16.39(9.2-27.6%)</td>
              <td align="center" rowspan="1" colspan="1">5.11(3.7-7.0%)</td>
              <td align="center" rowspan="1" colspan="1">58.62(48.1-68.4%)</td>
              <td align="center" rowspan="1" colspan="1">98.53(97.3-99.2%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ciprofloxacin</td>
              <td align="right" rowspan="1" colspan="1">19</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="right" rowspan="1" colspan="1">243</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-16.8%)</td>
              <td align="center" rowspan="1" colspan="1">1.62(0.6-4.1%)</td>
              <td align="center" rowspan="1" colspan="1">82.61(62.9-93.0%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(98.4-100.0%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Kanamycin</td>
              <td align="right" rowspan="1" colspan="1">11</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="right" rowspan="1" colspan="1">528</td>
              <td align="right" rowspan="1" colspan="1">6</td>
              <td align="center" rowspan="1" colspan="1">35.29(17.3-58.7%)</td>
              <td align="center" rowspan="1" colspan="1">0.19(0.0-1.1%)</td>
              <td align="center" rowspan="1" colspan="1">91.67(64.6-98.5%)</td>
              <td align="center" rowspan="1" colspan="1">98.88(97.6-99.5%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Moxifloxacin</td>
              <td align="right" rowspan="1" colspan="1">17</td>
              <td align="right" rowspan="1" colspan="1">5</td>
              <td align="right" rowspan="1" colspan="1">549</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="center" rowspan="1" colspan="1">19.05(7.7-40.0%)</td>
              <td align="center" rowspan="1" colspan="1">0.9(0.4-2.1%)</td>
              <td align="center" rowspan="1" colspan="1">77.27(56.6-89.9%)</td>
              <td align="center" rowspan="1" colspan="1">99.28(98.2-99.7%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ofloxacin</td>
              <td align="right" rowspan="1" colspan="1">19</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="right" rowspan="1" colspan="1">763</td>
              <td align="right" rowspan="1" colspan="1">6</td>
              <td align="center" rowspan="1" colspan="1">24.0(11.5-43.4%)</td>
              <td align="center" rowspan="1" colspan="1">0.52(0.2-1.3%)</td>
              <td align="center" rowspan="1" colspan="1">82.61(62.9-93.0%)</td>
              <td align="center" rowspan="1" colspan="1">99.22(98.3-99.6%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Streptomycin</td>
              <td align="right" rowspan="1" colspan="1">344</td>
              <td align="right" rowspan="1" colspan="1">18</td>
              <td align="right" rowspan="1" colspan="1">1355</td>
              <td align="right" rowspan="1" colspan="1">39</td>
              <td align="center" rowspan="1" colspan="1">10.18(7.5-13.6%)</td>
              <td align="center" rowspan="1" colspan="1">1.31(0.8-2.1%)</td>
              <td align="center" rowspan="1" colspan="1">95.03(92.3-96.8%)</td>
              <td align="center" rowspan="1" colspan="1">97.2(96.2-97.9%)</td>
            </tr>
            <tr>
              <th align="left" colspan="9" rowspan="1">(b) Candidate panel 2, Global dataset</th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">Drug</th>
              <th align="right" rowspan="1" colspan="1">TP</th>
              <th align="right" rowspan="1" colspan="1">FP</th>
              <th align="right" rowspan="1" colspan="1">TN</th>
              <th align="right" rowspan="1" colspan="1">FN</th>
              <th align="center" rowspan="1" colspan="1">VME (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">ME (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">PPV (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">NPV (95% CI)</th>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ethambutol</td>
              <td align="right" rowspan="1" colspan="1">1338</td>
              <td align="right" rowspan="1" colspan="1">434</td>
              <td align="right" rowspan="1" colspan="1">3499</td>
              <td align="right" rowspan="1" colspan="1">230</td>
              <td align="center" rowspan="1" colspan="1">14.67(13.0-16.5%)</td>
              <td align="center" rowspan="1" colspan="1">11.03(10.1-12.1%)</td>
              <td align="center" rowspan="1" colspan="1">75.51(73.5-77.5%)</td>
              <td align="center" rowspan="1" colspan="1">93.83(93.0-94.6%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Isoniazid</td>
              <td align="right" rowspan="1" colspan="1">2781</td>
              <td align="right" rowspan="1" colspan="1">54</td>
              <td align="right" rowspan="1" colspan="1">2704</td>
              <td align="right" rowspan="1" colspan="1">184</td>
              <td align="center" rowspan="1" colspan="1">6.21(5.4-7.1%)</td>
              <td align="center" rowspan="1" colspan="1">1.96(1.5-2.5%)</td>
              <td align="center" rowspan="1" colspan="1">98.1(97.5-98.5%)</td>
              <td align="center" rowspan="1" colspan="1">93.63(92.7-94.5%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Pyrazinamide</td>
              <td align="right" rowspan="1" colspan="1">750</td>
              <td align="right" rowspan="1" colspan="1">177</td>
              <td align="right" rowspan="1" colspan="1">2408</td>
              <td align="right" rowspan="1" colspan="1">264</td>
              <td align="center" rowspan="1" colspan="1">26.04(23.4-28.8%)</td>
              <td align="center" rowspan="1" colspan="1">6.85(5.9-7.9%)</td>
              <td align="center" rowspan="1" colspan="1">80.91(78.3-83.3%)</td>
              <td align="center" rowspan="1" colspan="1">90.12(88.9-91.2%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Rifampicin</td>
              <td align="right" rowspan="1" colspan="1">2634</td>
              <td align="right" rowspan="1" colspan="1">60</td>
              <td align="right" rowspan="1" colspan="1">2990</td>
              <td align="right" rowspan="1" colspan="1">136</td>
              <td align="center" rowspan="1" colspan="1">4.91(4.2-5.8%)</td>
              <td align="center" rowspan="1" colspan="1">1.97(1.5-2.5%)</td>
              <td align="center" rowspan="1" colspan="1">97.77(97.1-98.3%)</td>
              <td align="center" rowspan="1" colspan="1">95.65(94.9-96.3%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Amikacin</td>
              <td align="right" rowspan="1" colspan="1">100</td>
              <td align="right" rowspan="1" colspan="1">5</td>
              <td align="right" rowspan="1" colspan="1">1495</td>
              <td align="right" rowspan="1" colspan="1">21</td>
              <td align="center" rowspan="1" colspan="1">17.36(11.6-25.1%)</td>
              <td align="center" rowspan="1" colspan="1">0.33(0.1-0.8%)</td>
              <td align="center" rowspan="1" colspan="1">95.24(89.3-97.9%)</td>
              <td align="center" rowspan="1" colspan="1">98.61(97.9-99.1%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Capreomycin</td>
              <td align="right" rowspan="1" colspan="1">97</td>
              <td align="right" rowspan="1" colspan="1">26</td>
              <td align="right" rowspan="1" colspan="1">1600</td>
              <td align="right" rowspan="1" colspan="1">42</td>
              <td align="center" rowspan="1" colspan="1">30.22(23.2-38.3%)</td>
              <td align="center" rowspan="1" colspan="1">1.6(1.1-2.3%)</td>
              <td align="center" rowspan="1" colspan="1">78.86(70.8-85.1%)</td>
              <td align="center" rowspan="1" colspan="1">97.44(96.6-98.1%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ciprofloxacin</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="right" rowspan="1" colspan="1">33</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="center" rowspan="1" colspan="1">80.0(37.6-96.4%)</td>
              <td align="center" rowspan="1" colspan="1">10.81(4.3-24.7%)</td>
              <td align="center" rowspan="1" colspan="1">20.0(3.6-62.4%)</td>
              <td align="center" rowspan="1" colspan="1">89.19(75.3-95.7%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Kanamycin</td>
              <td align="right" rowspan="1" colspan="1">88</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">1410</td>
              <td align="right" rowspan="1" colspan="1">47</td>
              <td align="center" rowspan="1" colspan="1">34.81(27.3-43.2%)</td>
              <td align="center" rowspan="1" colspan="1">0.21(0.1-0.6%)</td>
              <td align="center" rowspan="1" colspan="1">96.7(90.8-98.9%)</td>
              <td align="center" rowspan="1" colspan="1">96.77(95.7-97.6%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Moxifloxacin</td>
              <td align="right" rowspan="1" colspan="1">14</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="right" rowspan="1" colspan="1">85</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="center" rowspan="1" colspan="1">17.65(6.2-41.0%)</td>
              <td align="center" rowspan="1" colspan="1">1.16(0.2-6.3%)</td>
              <td align="center" rowspan="1" colspan="1">93.33(70.2-98.8%)</td>
              <td align="center" rowspan="1" colspan="1">96.59(90.5-98.8%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ofloxacin</td>
              <td align="right" rowspan="1" colspan="1">329</td>
              <td align="right" rowspan="1" colspan="1">19</td>
              <td align="right" rowspan="1" colspan="1">1348</td>
              <td align="right" rowspan="1" colspan="1">59</td>
              <td align="center" rowspan="1" colspan="1">15.21(12.0-19.1%)</td>
              <td align="center" rowspan="1" colspan="1">1.39(0.9-2.2%)</td>
              <td align="center" rowspan="1" colspan="1">94.54(91.6-96.5%)</td>
              <td align="center" rowspan="1" colspan="1">95.81(94.6-96.7%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Streptomycin</td>
              <td align="right" rowspan="1" colspan="1">462</td>
              <td align="right" rowspan="1" colspan="1">32</td>
              <td align="right" rowspan="1" colspan="1">2276</td>
              <td align="right" rowspan="1" colspan="1">217</td>
              <td align="center" rowspan="1" colspan="1">31.96(28.6-35.6%)</td>
              <td align="center" rowspan="1" colspan="1">1.39(1.0-2.0%)</td>
              <td align="center" rowspan="1" colspan="1">93.52(91.0-95.4%)</td>
              <td align="center" rowspan="1" colspan="1">91.3(90.1-92.3%)</td>
            </tr>
            <tr>
              <th align="left" colspan="9" rowspan="1">(c) Candidate panel 3, prospective dataset</th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">Drug</th>
              <th align="right" rowspan="1" colspan="1">TP</th>
              <th align="right" rowspan="1" colspan="1">FP</th>
              <th align="right" rowspan="1" colspan="1">TN</th>
              <th align="right" rowspan="1" colspan="1">FN</th>
              <th align="center" rowspan="1" colspan="1">VME (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">ME (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">PPV (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">NPV (95% CI)</th>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ethambutol</td>
              <td align="right" rowspan="1" colspan="1">71</td>
              <td align="right" rowspan="1" colspan="1">48</td>
              <td align="right" rowspan="1" colspan="1">4171</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="center" rowspan="1" colspan="1">1.39(0.2-7.5%)</td>
              <td align="center" rowspan="1" colspan="1">1.14(0.9-1.5%)</td>
              <td align="center" rowspan="1" colspan="1">59.66(50.7-68.0%)</td>
              <td align="center" rowspan="1" colspan="1">99.98(99.9-100.0%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Isoniazid</td>
              <td align="right" rowspan="1" colspan="1">312</td>
              <td align="right" rowspan="1" colspan="1">19</td>
              <td align="right" rowspan="1" colspan="1">3931</td>
              <td align="right" rowspan="1" colspan="1">17</td>
              <td align="center" rowspan="1" colspan="1">5.17(3.3-8.1%)</td>
              <td align="center" rowspan="1" colspan="1">0.48(0.3-0.7%)</td>
              <td align="center" rowspan="1" colspan="1">94.26(91.2-96.3%)</td>
              <td align="center" rowspan="1" colspan="1">99.57(99.3-99.7%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Pyrazinamide</td>
              <td align="right" rowspan="1" colspan="1">102</td>
              <td align="right" rowspan="1" colspan="1">23</td>
              <td align="right" rowspan="1" colspan="1">4047</td>
              <td align="right" rowspan="1" colspan="1">23</td>
              <td align="center" rowspan="1" colspan="1">18.4(12.6-26.1%)</td>
              <td align="center" rowspan="1" colspan="1">0.57(0.4-0.8%)</td>
              <td align="center" rowspan="1" colspan="1">81.6(73.9-87.4%)</td>
              <td align="center" rowspan="1" colspan="1">99.43(99.2-99.6%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Rifampicin</td>
              <td align="right" rowspan="1" colspan="1">133</td>
              <td align="right" rowspan="1" colspan="1">35</td>
              <td align="right" rowspan="1" colspan="1">4140</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-2.8%)</td>
              <td align="center" rowspan="1" colspan="1">0.84(0.6-1.2%)</td>
              <td align="center" rowspan="1" colspan="1">79.17(72.4-84.6%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(99.9-100.0%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Amikacin</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">59</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="center" rowspan="1" colspan="1">25.0(4.6-69.9%)</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-6.1%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(43.9-100.0%)</td>
              <td align="center" rowspan="1" colspan="1">98.33(91.2-99.7%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Capreomycin</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">59</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-56.1%)</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-6.1%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(43.9-100.0%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(93.9-100.0%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ciprofloxacin</td>
              <td align="right" rowspan="1" colspan="1">30</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">199</td>
              <td align="right" rowspan="1" colspan="1">19</td>
              <td align="center" rowspan="1" colspan="1">38.78(26.4-52.7%)</td>
              <td align="center" rowspan="1" colspan="1">1.49(0.5-4.3%)</td>
              <td align="center" rowspan="1" colspan="1">90.91(76.4-96.9%)</td>
              <td align="center" rowspan="1" colspan="1">91.28(86.8-94.3%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Kanamycin</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">54</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-49.0%)</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-6.6%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(51.0-100.0%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(93.4-100.0%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Moxifloxacin</td>
              <td align="right" rowspan="1" colspan="1">19</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">41</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="center" rowspan="1" colspan="1">5.0(0.9-23.6%)</td>
              <td align="center" rowspan="1" colspan="1">6.82(2.3-18.2%)</td>
              <td align="center" rowspan="1" colspan="1">86.36(66.7-95.2%)</td>
              <td align="center" rowspan="1" colspan="1">97.62(87.7-99.6%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ofloxacin</td>
              <td align="right" rowspan="1" colspan="1">21</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">42</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="center" rowspan="1" colspan="1">4.55(0.8-21.8%)</td>
              <td align="center" rowspan="1" colspan="1">6.67(2.3-17.8%)</td>
              <td align="center" rowspan="1" colspan="1">87.5(69.0-95.7%)</td>
              <td align="center" rowspan="1" colspan="1">97.67(87.9-99.6%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Streptomycin</td>
              <td align="right" rowspan="1" colspan="1">36</td>
              <td align="right" rowspan="1" colspan="1">16</td>
              <td align="right" rowspan="1" colspan="1">685</td>
              <td align="right" rowspan="1" colspan="1">21</td>
              <td align="center" rowspan="1" colspan="1">36.84(25.5-49.8%)</td>
              <td align="center" rowspan="1" colspan="1">2.28(1.4-3.7%)</td>
              <td align="center" rowspan="1" colspan="1">69.23(55.7-80.1%)</td>
              <td align="center" rowspan="1" colspan="1">97.03(95.5-98.0%)</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <p><bold>Resistance prediction performance on Prospective dataset</bold> Different resistance mutations occur at varying frequencies across the world. Therefore, in order for an error-rate estimate to be generalisable into clinical practise, the underlying data needs to be sampled in a way that is representative of prevalence somewhere. We used the Prospective dataset to get realistic estimates of error rates in the (low burden) countries from which these data were sampled. We show in
<xref ref-type="fig" rid="f4">Figure 4</xref> a comparison of the predictions for that dataset from
<xref rid="ref-20" ref-type="bibr">20</xref>,
<italic>Mykrobe</italic> using the old
<italic>Mykrobe predictor</italic> panel (Mykrobe-2015)
<sup><xref rid="ref-3" ref-type="bibr">3</xref></sup>, and
<italic>Mykrobe</italic> with CP3.</p>
      <fig fig-type="figure" id="f4" orientation="portrait" position="anchor">
        <label>Figure 4. </label>
        <caption>
          <p>Comparison of NEJM-2018, Walker-2015 and candidate panel 3 (CP3) on the Prospective dataset for (
<bold>a</bold>) first-line drugs and (
<bold>b</bold>) second-line drugs. Counts of susceptible samples are shown on the left, broken down for each tool/panel into those correctly identified as susceptible (in the colour of the tool/panel), those falsely identified as resistant coloured red and no-calls coloured grey. Similarly, resistant samples are shown on the right, with those correctly identified as resistant coloured by the tool/panel, those falsely identified as susceptible in red, and no-calls in grey. Note that second-line drugs were not considered in NEJM-2018. E, ethambutol; H, isoniazid; Z, pyrazinamide; R, rifampicin; Am, amikacin; Cm, capreomycin; Cfx, ciprofloxacin; Km, kanamycin; Mfx, moxifloxacin; Ofx, ofloxacin; S, streptomycin.</p>
        </caption>
        <graphic xlink:href="wellcomeopenres-4-17090-g0003"/>
      </fig>
      <p>Sensitivity, specificity, and error rates are shown in
<xref rid="T1" ref-type="table">Table 1c</xref>. Very Major Error rate (missed resistance) for the first-line drugs was 0.0%, 5.2%, 1.4%, 18.4% for rifampicin, isoniazid, ethambutol, pyrazinamide respectively, with corresponding negative predictive values of 100.0%, 99.6%, 100.0%, 99.4%. Thus, in this prevalence setting,
<italic>Mykrobe</italic> predicting susceptibility to the four first-line drugs would meet clinical requirements. The Major Error rate (false resistance prediction) was also low: 0.8%/0.5%/1.1%/0.6% respectively.</p>
      <p>We noted that ciprofloxacin sensitivity was lower for CP3, compared to Walker-2015. This was caused by the (standard line probe assay) variant D94A in the
<italic>gyrA</italic> gene having been removed from CP2 to make CP3, because it caused one false-positive and no true-positive calls on the Global data set. However, on the Prospective data set its inclusion causes four true-positives and no false-positives.</p>
      <p>Based on the above results, the three variants embB M306L and Q497K, and gyrA D94A were added to CP3, to make the final variant panel. These final variants are given in
<italic>Source data</italic>
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/panel_final_tsv/7605395">panel.final.tsv</ext-link>
<sup><xref rid="ref-35" ref-type="bibr">35</xref></sup>,
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/panel_final_json/7605428">panel.final.json</ext-link>
<sup><xref rid="ref-36" ref-type="bibr">36</xref></sup>, which are the same as those used by default in the new
<italic>Mykrobe</italic> release version 0.7.0. The accuracy statistics of candidate panels 1, 2, and 3 on the Training, Global and Prospective datasets are given in
<xref rid="T1" ref-type="table">Table 1 (a), (b), and (c)</xref> respectively. The results of the final release panel on each of the datasets are in
<xref rid="T2" ref-type="table">Table 2</xref>.</p>
      <table-wrap id="T2" orientation="portrait" position="anchor">
        <label>Table 2. </label>
        <caption>
          <title>Accuracy statistics of
<italic>Mykrobe</italic> using the final panel on (a) Training, (b) Global, and (c) Prospective datasets.</title>
          <p>TP, true-positive; FP, false-positive; TN, true-negative; FN, false-negative; VME, very major error rate (false-negative rate); ME, major error rate (false-positive rate); PPV, positive predictive value; NPV, negative predictive value. 95% binomial confidence intervals calculated using the Wilson score interval.</p>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th align="left" colspan="9" rowspan="1">(a) Training dataset</th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">Drug</th>
              <th align="right" rowspan="1" colspan="1">TP</th>
              <th align="right" rowspan="1" colspan="1">FP</th>
              <th align="right" rowspan="1" colspan="1">TN</th>
              <th align="right" rowspan="1" colspan="1">FN</th>
              <th align="center" rowspan="1" colspan="1">VME (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">ME (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">PPV (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">NPV (95% CI)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ethambutol</td>
              <td align="right" rowspan="1" colspan="1">209</td>
              <td align="right" rowspan="1" colspan="1">125</td>
              <td align="right" rowspan="1" colspan="1">2803</td>
              <td align="right" rowspan="1" colspan="1">22</td>
              <td align="center" rowspan="1" colspan="1">9.52(6.4-14.0%)</td>
              <td align="center" rowspan="1" colspan="1">4.27(3.6-5.1%)</td>
              <td align="center" rowspan="1" colspan="1">62.57(57.3-67.6%)</td>
              <td align="center" rowspan="1" colspan="1">99.22(98.8-99.5%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Isoniazid</td>
              <td align="right" rowspan="1" colspan="1">564</td>
              <td align="right" rowspan="1" colspan="1">32</td>
              <td align="right" rowspan="1" colspan="1">2538</td>
              <td align="right" rowspan="1" colspan="1">38</td>
              <td align="center" rowspan="1" colspan="1">6.31(4.6-8.5%)</td>
              <td align="center" rowspan="1" colspan="1">1.25(0.9-1.8%)</td>
              <td align="center" rowspan="1" colspan="1">94.63(92.5-96.2%)</td>
              <td align="center" rowspan="1" colspan="1">98.52(98.0-98.9%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Rifampicin</td>
              <td align="right" rowspan="1" colspan="1">373</td>
              <td align="right" rowspan="1" colspan="1">40</td>
              <td align="right" rowspan="1" colspan="1">2714</td>
              <td align="right" rowspan="1" colspan="1">11</td>
              <td align="center" rowspan="1" colspan="1">2.86(1.6-5.1%)</td>
              <td align="center" rowspan="1" colspan="1">1.45(1.1-2.0%)</td>
              <td align="center" rowspan="1" colspan="1">90.31(87.1-92.8%)</td>
              <td align="center" rowspan="1" colspan="1">99.6(99.3-99.8%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Amikacin</td>
              <td align="right" rowspan="1" colspan="1">55</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="right" rowspan="1" colspan="1">704</td>
              <td align="right" rowspan="1" colspan="1">9</td>
              <td align="center" rowspan="1" colspan="1">14.06(7.6-24.6%)</td>
              <td align="center" rowspan="1" colspan="1">0.14(0.0-0.8%)</td>
              <td align="center" rowspan="1" colspan="1">98.21(90.6-99.7%)</td>
              <td align="center" rowspan="1" colspan="1">98.74(97.6-99.3%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Capreomycin</td>
              <td align="right" rowspan="1" colspan="1">49</td>
              <td align="right" rowspan="1" colspan="1">10</td>
              <td align="right" rowspan="1" colspan="1">695</td>
              <td align="right" rowspan="1" colspan="1">12</td>
              <td align="center" rowspan="1" colspan="1">19.67(11.6-31.3%)</td>
              <td align="center" rowspan="1" colspan="1">1.42(0.8-2.6%)</td>
              <td align="center" rowspan="1" colspan="1">83.05(71.5-90.5%)</td>
              <td align="center" rowspan="1" colspan="1">98.3(97.1-99.0%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ciprofloxacin</td>
              <td align="right" rowspan="1" colspan="1">19</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="right" rowspan="1" colspan="1">243</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-16.8%)</td>
              <td align="center" rowspan="1" colspan="1">1.62(0.6-4.1%)</td>
              <td align="center" rowspan="1" colspan="1">82.61(62.9-93.0%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(98.4-100.0%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Kanamycin</td>
              <td align="right" rowspan="1" colspan="1">11</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">529</td>
              <td align="right" rowspan="1" colspan="1">6</td>
              <td align="center" rowspan="1" colspan="1">35.29(17.3-58.7%)</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-0.7%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(74.1-100.0%)</td>
              <td align="center" rowspan="1" colspan="1">98.88(97.6-99.5%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Moxifloxacin</td>
              <td align="right" rowspan="1" colspan="1">17</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="right" rowspan="1" colspan="1">550</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="center" rowspan="1" colspan="1">19.05(7.7-40.0%)</td>
              <td align="center" rowspan="1" colspan="1">0.72(0.3-1.8%)</td>
              <td align="center" rowspan="1" colspan="1">80.95(60.0-92.3%)</td>
              <td align="center" rowspan="1" colspan="1">99.28(98.2-99.7%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ofloxacin</td>
              <td align="right" rowspan="1" colspan="1">19</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">764</td>
              <td align="right" rowspan="1" colspan="1">6</td>
              <td align="center" rowspan="1" colspan="1">24.0(11.5-43.4%)</td>
              <td align="center" rowspan="1" colspan="1">0.39(0.1-1.1%)</td>
              <td align="center" rowspan="1" colspan="1">86.36(66.7-95.2%)</td>
              <td align="center" rowspan="1" colspan="1">99.22(98.3-99.6%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Streptomycin</td>
              <td align="right" rowspan="1" colspan="1">340</td>
              <td align="right" rowspan="1" colspan="1">16</td>
              <td align="right" rowspan="1" colspan="1">1357</td>
              <td align="right" rowspan="1" colspan="1">43</td>
              <td align="center" rowspan="1" colspan="1">11.23(8.4-14.8%)</td>
              <td align="center" rowspan="1" colspan="1">1.17(0.7-1.9%)</td>
              <td align="center" rowspan="1" colspan="1">95.51(92.8-97.2%)</td>
              <td align="center" rowspan="1" colspan="1">96.93(95.9-97.7%)</td>
            </tr>
            <tr>
              <th align="left" colspan="9" rowspan="1">(b) Global dataset</th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">Drug</th>
              <th align="right" rowspan="1" colspan="1">TP</th>
              <th align="right" rowspan="1" colspan="1">FP</th>
              <th align="right" rowspan="1" colspan="1">TN</th>
              <th align="right" rowspan="1" colspan="1">FN</th>
              <th align="center" rowspan="1" colspan="1">VME (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">ME (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">PPV (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">NPV (95% CI)</th>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ethambutol</td>
              <td align="right" rowspan="1" colspan="1">1381</td>
              <td align="right" rowspan="1" colspan="1">449</td>
              <td align="right" rowspan="1" colspan="1">3484</td>
              <td align="right" rowspan="1" colspan="1">187</td>
              <td align="center" rowspan="1" colspan="1">11.93(10.4-13.6%)</td>
              <td align="center" rowspan="1" colspan="1">11.42(10.5-12.4%)</td>
              <td align="center" rowspan="1" colspan="1">75.46(73.4-77.4%)</td>
              <td align="center" rowspan="1" colspan="1">94.91(94.1-95.6%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Isoniazid</td>
              <td align="right" rowspan="1" colspan="1">2781</td>
              <td align="right" rowspan="1" colspan="1">54</td>
              <td align="right" rowspan="1" colspan="1">2704</td>
              <td align="right" rowspan="1" colspan="1">184</td>
              <td align="center" rowspan="1" colspan="1">6.21(5.4-7.1%)</td>
              <td align="center" rowspan="1" colspan="1">1.96(1.5-2.5%)</td>
              <td align="center" rowspan="1" colspan="1">98.1(97.5-98.5%)</td>
              <td align="center" rowspan="1" colspan="1">93.63(92.7-94.5%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Pyrazinamide</td>
              <td align="right" rowspan="1" colspan="1">750</td>
              <td align="right" rowspan="1" colspan="1">148</td>
              <td align="right" rowspan="1" colspan="1">2437</td>
              <td align="right" rowspan="1" colspan="1">264</td>
              <td align="center" rowspan="1" colspan="1">26.04(23.4-28.8%)</td>
              <td align="center" rowspan="1" colspan="1">5.73(4.9-6.7%)</td>
              <td align="center" rowspan="1" colspan="1">83.52(81.0-85.8%)</td>
              <td align="center" rowspan="1" colspan="1">90.23(89.0-91.3%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Rifampicin</td>
              <td align="right" rowspan="1" colspan="1">2634</td>
              <td align="right" rowspan="1" colspan="1">60</td>
              <td align="right" rowspan="1" colspan="1">2990</td>
              <td align="right" rowspan="1" colspan="1">136</td>
              <td align="center" rowspan="1" colspan="1">4.91(4.2-5.8%)</td>
              <td align="center" rowspan="1" colspan="1">1.97(1.5-2.5%)</td>
              <td align="center" rowspan="1" colspan="1">97.77(97.1-98.3%)</td>
              <td align="center" rowspan="1" colspan="1">95.65(94.9-96.3%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Amikacin</td>
              <td align="right" rowspan="1" colspan="1">100</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="right" rowspan="1" colspan="1">1496</td>
              <td align="right" rowspan="1" colspan="1">21</td>
              <td align="center" rowspan="1" colspan="1">17.36(11.6-25.1%)</td>
              <td align="center" rowspan="1" colspan="1">0.27(0.1-0.7%)</td>
              <td align="center" rowspan="1" colspan="1">96.15(90.5-98.5%)</td>
              <td align="center" rowspan="1" colspan="1">98.62(97.9-99.1%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Capreomycin</td>
              <td align="right" rowspan="1" colspan="1">97</td>
              <td align="right" rowspan="1" colspan="1">25</td>
              <td align="right" rowspan="1" colspan="1">1601</td>
              <td align="right" rowspan="1" colspan="1">42</td>
              <td align="center" rowspan="1" colspan="1">30.22(23.2-38.3%)</td>
              <td align="center" rowspan="1" colspan="1">1.54(1.0-2.3%)</td>
              <td align="center" rowspan="1" colspan="1">79.51(71.5-85.7%)</td>
              <td align="center" rowspan="1" colspan="1">97.44(96.6-98.1%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ciprofloxacin</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="right" rowspan="1" colspan="1">33</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="center" rowspan="1" colspan="1">80.0(37.6-96.4%)</td>
              <td align="center" rowspan="1" colspan="1">10.81(4.3-24.7%)</td>
              <td align="center" rowspan="1" colspan="1">20.0(3.6-62.4%)</td>
              <td align="center" rowspan="1" colspan="1">89.19(75.3-95.7%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Kanamycin</td>
              <td align="right" rowspan="1" colspan="1">88</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">1410</td>
              <td align="right" rowspan="1" colspan="1">47</td>
              <td align="center" rowspan="1" colspan="1">34.81(27.3-43.2%)</td>
              <td align="center" rowspan="1" colspan="1">0.21(0.1-0.6%)</td>
              <td align="center" rowspan="1" colspan="1">96.7(90.8-98.9%)</td>
              <td align="center" rowspan="1" colspan="1">96.77(95.7-97.6%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Moxifloxacin</td>
              <td align="right" rowspan="1" colspan="1">14</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="right" rowspan="1" colspan="1">85</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="center" rowspan="1" colspan="1">17.65(6.2-41.0%)</td>
              <td align="center" rowspan="1" colspan="1">1.16(0.2-6.3%)</td>
              <td align="center" rowspan="1" colspan="1">93.33(70.2-98.8%)</td>
              <td align="center" rowspan="1" colspan="1">96.59(90.5-98.8%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ofloxacin</td>
              <td align="right" rowspan="1" colspan="1">329</td>
              <td align="right" rowspan="1" colspan="1">19</td>
              <td align="right" rowspan="1" colspan="1">1348</td>
              <td align="right" rowspan="1" colspan="1">59</td>
              <td align="center" rowspan="1" colspan="1">15.21(12.0-19.1%)</td>
              <td align="center" rowspan="1" colspan="1">1.39(0.9-2.2%)</td>
              <td align="center" rowspan="1" colspan="1">94.54(91.6-96.5%)</td>
              <td align="center" rowspan="1" colspan="1">95.81(94.6-96.7%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Streptomycin</td>
              <td align="right" rowspan="1" colspan="1">462</td>
              <td align="right" rowspan="1" colspan="1">27</td>
              <td align="right" rowspan="1" colspan="1">2281</td>
              <td align="right" rowspan="1" colspan="1">217</td>
              <td align="center" rowspan="1" colspan="1">31.96(28.6-35.6%)</td>
              <td align="center" rowspan="1" colspan="1">1.17(0.8-1.7%)</td>
              <td align="center" rowspan="1" colspan="1">94.48(92.1-96.2%)</td>
              <td align="center" rowspan="1" colspan="1">91.31(90.1-92.4%)</td>
            </tr>
            <tr>
              <th align="left" colspan="9" rowspan="1">(c) Prospective dataset</th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">Drug</th>
              <th align="right" rowspan="1" colspan="1">TP</th>
              <th align="right" rowspan="1" colspan="1">FP</th>
              <th align="right" rowspan="1" colspan="1">TN</th>
              <th align="right" rowspan="1" colspan="1">FN</th>
              <th align="center" rowspan="1" colspan="1">VME (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">ME (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">PPV (95% CI)</th>
              <th align="center" rowspan="1" colspan="1">NPV (95% CI)</th>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ethambutol</td>
              <td align="right" rowspan="1" colspan="1">71</td>
              <td align="right" rowspan="1" colspan="1">49</td>
              <td align="right" rowspan="1" colspan="1">4170</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="center" rowspan="1" colspan="1">1.39(0.2-7.5%)</td>
              <td align="center" rowspan="1" colspan="1">1.16(0.9-1.5%)</td>
              <td align="center" rowspan="1" colspan="1">59.17(50.2-67.5%)</td>
              <td align="center" rowspan="1" colspan="1">99.98(99.9-100.0%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Isoniazid</td>
              <td align="right" rowspan="1" colspan="1">312</td>
              <td align="right" rowspan="1" colspan="1">19</td>
              <td align="right" rowspan="1" colspan="1">3931</td>
              <td align="right" rowspan="1" colspan="1">17</td>
              <td align="center" rowspan="1" colspan="1">5.17(3.3-8.1%)</td>
              <td align="center" rowspan="1" colspan="1">0.48(0.3-0.7%)</td>
              <td align="center" rowspan="1" colspan="1">94.26(91.2-96.3%)</td>
              <td align="center" rowspan="1" colspan="1">99.57(99.3-99.7%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Pyrazinamide</td>
              <td align="right" rowspan="1" colspan="1">102</td>
              <td align="right" rowspan="1" colspan="1">22</td>
              <td align="right" rowspan="1" colspan="1">4048</td>
              <td align="right" rowspan="1" colspan="1">23</td>
              <td align="center" rowspan="1" colspan="1">18.4(12.6-26.1%)</td>
              <td align="center" rowspan="1" colspan="1">0.54(0.4-0.8%)</td>
              <td align="center" rowspan="1" colspan="1">82.26(74.6-88.0%)</td>
              <td align="center" rowspan="1" colspan="1">99.44(99.2-99.6%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Rifampicin</td>
              <td align="right" rowspan="1" colspan="1">133</td>
              <td align="right" rowspan="1" colspan="1">32</td>
              <td align="right" rowspan="1" colspan="1">4143</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-2.8%)</td>
              <td align="center" rowspan="1" colspan="1">0.77(0.5-1.1%)</td>
              <td align="center" rowspan="1" colspan="1">80.61(73.9-85.9%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(99.9-100.0%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Amikacin</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">59</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="center" rowspan="1" colspan="1">25.0(4.6-69.9%)</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-6.1%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(43.9-100.0%)</td>
              <td align="center" rowspan="1" colspan="1">98.33(91.2-99.7%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Capreomycin</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">59</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-56.1%)</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-6.1%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(43.9-100.0%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(93.9-100.0%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ciprofloxacin</td>
              <td align="right" rowspan="1" colspan="1">34</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">199</td>
              <td align="right" rowspan="1" colspan="1">15</td>
              <td align="center" rowspan="1" colspan="1">30.61(19.5-44.5%)</td>
              <td align="center" rowspan="1" colspan="1">1.49(0.5-4.3%)</td>
              <td align="center" rowspan="1" colspan="1">91.89(78.7-97.2%)</td>
              <td align="center" rowspan="1" colspan="1">92.99(88.8-95.7%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Kanamycin</td>
              <td align="right" rowspan="1" colspan="1">4</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">54</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-49.0%)</td>
              <td align="center" rowspan="1" colspan="1">0.0(0.0-6.6%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(51.0-100.0%)</td>
              <td align="center" rowspan="1" colspan="1">100.0(93.4-100.0%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Moxifloxacin</td>
              <td align="right" rowspan="1" colspan="1">19</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">41</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="center" rowspan="1" colspan="1">5.0(0.9-23.6%)</td>
              <td align="center" rowspan="1" colspan="1">6.82(2.3-18.2%)</td>
              <td align="center" rowspan="1" colspan="1">86.36(66.7-95.2%)</td>
              <td align="center" rowspan="1" colspan="1">97.62(87.7-99.6%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ofloxacin</td>
              <td align="right" rowspan="1" colspan="1">21</td>
              <td align="right" rowspan="1" colspan="1">3</td>
              <td align="right" rowspan="1" colspan="1">42</td>
              <td align="right" rowspan="1" colspan="1">1</td>
              <td align="center" rowspan="1" colspan="1">4.55(0.8-21.8%)</td>
              <td align="center" rowspan="1" colspan="1">6.67(2.3-17.8%)</td>
              <td align="center" rowspan="1" colspan="1">87.5(69.0-95.7%)</td>
              <td align="center" rowspan="1" colspan="1">97.67(87.9-99.6%)</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Streptomycin</td>
              <td align="right" rowspan="1" colspan="1">36</td>
              <td align="right" rowspan="1" colspan="1">16</td>
              <td align="right" rowspan="1" colspan="1">685</td>
              <td align="right" rowspan="1" colspan="1">21</td>
              <td align="center" rowspan="1" colspan="1">36.84(25.5-49.8%)</td>
              <td align="center" rowspan="1" colspan="1">2.28(1.4-3.7%)</td>
              <td align="center" rowspan="1" colspan="1">69.23(55.7-80.1%)</td>
              <td align="center" rowspan="1" colspan="1">97.03(95.5-98.0%)</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
    <sec>
      <title>Performance evaluation on Oxford Nanopore Technologies data</title>
      <p>We evaluated
<italic>Mykrobe</italic> performance on five samples where we had both Oxford Nanopore Technologies (ONT) and Illumina sequence data. The resistance calls made by
<italic>Mykrobe</italic> on the Illumina and ONT data were in complete agreement, with the same variant calls made on each sample and therefore the same resistance profiles. Three of the samples were susceptible to all drugs (ERS3036287, ERS3036289, and ERS3036290), one sample (ERS3036288) was resistant to isoniazid, and the fifth sample (ERS3036286) was resistant to seven of the 11 drugs called by
<italic>Mykrobe</italic> (
<italic>Source data</italic>
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/ont_tsv/7605443">ont.tsv</ext-link>)
<sup><xref rid="ref-37" ref-type="bibr">37</xref></sup>.</p>
    </sec>
    <sec>
      <title>Minor alleles improve prediction</title>
      <p>Phenotypic tests by the indirect proportion method are defined in such a way as to call an isolate resistant if more than some proportion
<italic>P</italic> of bacilli are resistant
<sup><xref rid="ref-38" ref-type="bibr">38</xref></sup> - typically
<italic>P</italic> = 0.01. Whole genome sequencing to a depth of 30-50x after several weeks of culture is by comparison relatively insensitive to minor populations. If we exclude for a moment the issues of clonal interference between resistant alleles, and selection due to culture, any single minor resistant allele detectable by sequencing should easily be detectable by phenotyping. This is essentially the motivation for
<italic>Mykrobe</italic> using minor alleles to predict resistance. To do this, instead of specifying a minimum frequency threshold to detect minor alleles,
<italic>Mykrobe</italic> performs a likelihood comparison between two statistical models: first, coverage on minor allele due to sequencing error (at rate around 0.01) and second, coverage on minor allele due to a minor population at frequency 0.2. In practise, with coverage around 30-50x, this results in a minor population being detected when has frequency above around 8-10%.</p>
      <p>Having made minor changes to the catalogue from CP1 to CP2, we measured performance on the Global dataset, to finalise catalog and parameters (described below) before evaluating on the (final) Prospective dataset. The one remaining parameter that could be changed was the frequency of minor allele in the second model above, set to 0.2. We measured the impact of resistance calls driven by minor alleles using CP2 on the Global set - results are shown in
<xref rid="T3" ref-type="table">Table 3</xref>. These results are broadly in concordance with those reported in
<xref rid="ref-1" ref-type="bibr">1</xref> on the Training set. For second line drugs, the use of minor variants increases sensitivity without impacting false positive rate. In fact for amikacin, kanamycin, ofloxacin and streptomycin there were no false positive calls at all, and the proportion of resistance which was explained by minor alleles varied from around 1%-10%. For rifampicin and isoniazid, although the net contribution was positive, the error rate was slightly higher (8.3% and 6.7% of minor-allele-driven resistance calls were false). For ethambutol and pyrazinamide, however, although there were 29 and 45 true resistant calls made due to minor alleles, the proportion of false positive minor-driven resistant calls was even higher: 38% and 15%, respectively. If we compare the error rates in minor-allele-driven resistance calls for first-line drugs (6.7%, 8.3%, 38.3, 15.0% for rifampicin, isoniazid, ethambutol, pyrazinamide, see
<xref rid="T3" ref-type="table">Table 3</xref>) with the overall rates driven primarily by major-allele calls (2.0%, 2.0%, 11.0%, 6.9%, see
<xref rid="T1" ref-type="table">Table 1b</xref>) we see the relative differences between drugs are preserved - indeed the minor-allele-driven rates are all 3-4x the overall rates. Thus, the catalogue drives some or much of the between-drug differences. There are several potential explanations for the higher error rates for minor-allele calls. First, mutations that cause a low-level increase in MIC (minimum inhibitory concentration) may not cause a resistant phenotype if in a minor population - this is particularly likely for ethambutol where most mutations only increase the MIC slightly. Second, for pyrazinamide the phenotypic test is defined differently to most other drugs - the critical proportion
<italic>P</italic> at which resistance is detected is 0.1 rather than 0.01 as for other drugs
<sup><xref rid="ref-38" ref-type="bibr">38</xref></sup>. In other words, the pyrazinamide phenotypic test is less sensitive to low frequency populations than those for other drugs.</p>
      <table-wrap id="T3" orientation="portrait" position="anchor">
        <label>Table 3. </label>
        <caption>
          <title>Minority variant calls made by
<italic>Mykrobe</italic> using CP2 on the Global dataset.</title>
          <p>The second column shows the number of samples where the resistance phenotype is known for the given drug. Column 4, headed "Minor R calls" shows the number of resistant calls due to a minor population resistance allele. Column 5, headed "Error rate of minor R calls", shows the percentage of minor-allele-driven resistant calls that were incorrect versus phenotype.</p>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th align="center" rowspan="1" colspan="1">Drug</th>
              <th align="center" rowspan="1" colspan="1">Samples</th>
              <th align="center" rowspan="1" colspan="1">Resistant
<break/>samples</th>
              <th align="center" rowspan="1" colspan="1">Minor R
<break/>calls</th>
              <th align="center" rowspan="1" colspan="1">Error rate of
<break/>minor R calls (%)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ethambutol</td>
              <td align="center" rowspan="1" colspan="1">5501</td>
              <td align="center" rowspan="1" colspan="1">1568</td>
              <td align="center" rowspan="1" colspan="1">47</td>
              <td align="center" rowspan="1" colspan="1">38.3</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Isoniazid</td>
              <td align="center" rowspan="1" colspan="1">5723</td>
              <td align="center" rowspan="1" colspan="1">2965</td>
              <td align="center" rowspan="1" colspan="1">24</td>
              <td align="center" rowspan="1" colspan="1">8.33</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Pyrazinamide</td>
              <td align="center" rowspan="1" colspan="1">3599</td>
              <td align="center" rowspan="1" colspan="1">1014</td>
              <td align="center" rowspan="1" colspan="1">53</td>
              <td align="center" rowspan="1" colspan="1">15.09</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Rifampicin</td>
              <td align="center" rowspan="1" colspan="1">5820</td>
              <td align="center" rowspan="1" colspan="1">2770</td>
              <td align="center" rowspan="1" colspan="1">45</td>
              <td align="center" rowspan="1" colspan="1">6.67</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Amikacin</td>
              <td align="center" rowspan="1" colspan="1">1621</td>
              <td align="center" rowspan="1" colspan="1">121</td>
              <td align="center" rowspan="1" colspan="1">9</td>
              <td align="center" rowspan="1" colspan="1">0.0</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Capreomycin</td>
              <td align="center" rowspan="1" colspan="1">1765</td>
              <td align="center" rowspan="1" colspan="1">139</td>
              <td align="center" rowspan="1" colspan="1">10</td>
              <td align="center" rowspan="1" colspan="1">10.0</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Kanamycin</td>
              <td align="center" rowspan="1" colspan="1">1548</td>
              <td align="center" rowspan="1" colspan="1">135</td>
              <td align="center" rowspan="1" colspan="1">9</td>
              <td align="center" rowspan="1" colspan="1">0.0</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Ofloxacin</td>
              <td align="center" rowspan="1" colspan="1">1755</td>
              <td align="center" rowspan="1" colspan="1">388</td>
              <td align="center" rowspan="1" colspan="1">37</td>
              <td align="center" rowspan="1" colspan="1">0.0</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">Streptomycin</td>
              <td align="center" rowspan="1" colspan="1">2987</td>
              <td align="center" rowspan="1" colspan="1">679</td>
              <td align="center" rowspan="1" colspan="1">10</td>
              <td align="center" rowspan="1" colspan="1">0.0</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <p>In contrast to the above, for second-line drugs the pattern is different, with
<italic>lower</italic> error rates for minor-driven calls. The number of samples with second-line phenotypes is too low to draw strong conclusions. We would like to see these results replicated with comprehensive phenotyping and deep sequencing.</p>
      <p>In theory the
<italic>Mykrobe</italic> statistical test described above could have been modified to use a second model with higher minor-allele frequency than the current value of 0.2 - essentially demanding a higher frequency to reduce false positives. Indeed, it might be possible to fit different thresholds per drug, improving results on our dataset. However, we had concerns about generalisability. A recent publication
<sup><xref rid="ref-39" ref-type="bibr">39</xref></sup> showed how sequencing the same isolate with Illumina HiSeq, MiSeq and NextSeq could give different pictures of minor allele variation, including very different minor allele frequencies. We therefore elected to leave the model unchanged.</p>
    </sec>
    <sec>
      <title>Evaluating policy of ignoring unknown mutations in resistance genes</title>
      <p>A key component of the approach taken by the CRyPTIC consortium in
<xref rid="ref-20" ref-type="bibr">20</xref> was to refuse to make predictions if an unknown mutation was detected in a resistance-associated gene, and divert such samples to phenotyping. By contrast,
<italic>Mykrobe</italic> genotypes known SNPs and indels, but does not detect novel mutations, and makes predictions of phenotypes based on these data only. In particular, if no resistance mutation from its catalogue is detected,
<italic>Mykrobe</italic> makes a Susceptible prediction. Our prior expectation was that this would come at the cost of a higher false susceptible rate for
<italic>Mykrobe</italic>. This was indeed the case - see the red components of the bars on the right hand side of
<xref ref-type="fig" rid="f3">Figure 3</xref>. However, in addition, on both the Global and Prospective datasets, we find that
<italic>Mykrobe</italic> calls more true positives and negatives (i.e. correct resistant and susceptible calls) - see the grey segments of bars on
<xref ref-type="fig" rid="f3">Figure 3</xref> (in particular on the left) where the CRyPTIC approach avoids making a call. The results (see
<xref rid="T4" ref-type="table">Table 4</xref>) are consistent across the four first-line drugs: on the Global set
<italic>Mykrobe</italic> misses around 60-170 resistant samples that the CRyPTIC process theoretically detects by reverting to phenotyping (with the caveat that phenotypic assays are themselves not 100% reliable). Although this is accompanied by more rapid detection of 100-300 more susceptible samples (which CRyPTIC detects later, by phenotyping), this provides strong motivation to add the ability to detect novel variants to
<italic>Mykrobe</italic> in future releases. We note that this functionality is also missing from the other tools we benchmarked against, and that all of them could add this. Finally, we recall again that the global set is a heterogeneous combination of datasets sampled in different ways. The prospective set is prospectively sampled, though from low-burden countries in Europe. On that dataset we find the
<italic>Mykrobe</italic> approach pays far less penalty, missing 0, 9, 2 and 17 samples resistant to rifampicin, isoniazid, ethambutol and pyrazinamide, respectively, while detecting 215, 184, 486, 76 susceptible samples earlier (without phenotyping).</p>
      <table-wrap id="T4" orientation="portrait" position="anchor">
        <label>Table 4. </label>
        <caption>
          <title>Comparing the impact of no-calls when an unknown mutation is detected (process used in
<xref rid="ref-20" ref-type="bibr">20</xref>) versus that of
<italic>Mykrobe</italic>.</title>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th align="left" colspan="5" rowspan="1">Global dataset</th>
            </tr>
            <tr>
              <th align="left" rowspan="1" colspan="1">Tool</th>
              <th align="right" rowspan="1" colspan="1">Drug</th>
              <th align="right" rowspan="1" colspan="1">TN</th>
              <th align="right" rowspan="1" colspan="1">TP</th>
              <th align="right" rowspan="1" colspan="1">FN</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe</td>
              <td align="right" rowspan="1" colspan="1">Rifampicin</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>2990</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">
                <bold>2634</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">136</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">NEJM-2018</td>
              <td align="right" rowspan="1" colspan="1">Rifampicin</td>
              <td align="right" rowspan="1" colspan="1">2833</td>
              <td align="right" rowspan="1" colspan="1">2614</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>72</bold>
              </td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe</td>
              <td align="right" rowspan="1" colspan="1">Isoniazid</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>2704</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">
                <bold>2781</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">187</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">NEJM-2018</td>
              <td align="right" rowspan="1" colspan="1">Isoniazid</td>
              <td align="right" rowspan="1" colspan="1">2564</td>
              <td align="right" rowspan="1" colspan="1">2747</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>86</bold>
              </td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe</td>
              <td align="right" rowspan="1" colspan="1">Ethambutol</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>3484</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">
                <bold>1381</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">187</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">NEJM-2018</td>
              <td align="right" rowspan="1" colspan="1">Ethambutol</td>
              <td align="right" rowspan="1" colspan="1">3149</td>
              <td align="right" rowspan="1" colspan="1">1339</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>82</bold>
              </td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe</td>
              <td align="right" rowspan="1" colspan="1">Pyrazinamide</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>2437</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">
                <bold>750</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">264</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">NEJM-2018</td>
              <td align="right" rowspan="1" colspan="1">Pyrazinamide</td>
              <td align="right" rowspan="1" colspan="1">2176</td>
              <td align="right" rowspan="1" colspan="1">732</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>90</bold>
              </td>
            </tr>
            <tr>
              <th align="left" colspan="5" rowspan="1">Prospective dataset</th>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe</td>
              <td align="right" rowspan="1" colspan="1">Rifampicin</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>4143</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">
                <bold>133</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">NEJM-2018</td>
              <td align="right" rowspan="1" colspan="1">Rifampicin</td>
              <td align="right" rowspan="1" colspan="1">3928</td>
              <td align="right" rowspan="1" colspan="1">124</td>
              <td align="right" rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe</td>
              <td align="right" rowspan="1" colspan="1">Isoniazid</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>3931</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">
                <bold>312</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">17</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">NEJM-2018</td>
              <td align="right" rowspan="1" colspan="1">Isoniazid</td>
              <td align="right" rowspan="1" colspan="1">3747</td>
              <td align="right" rowspan="1" colspan="1">311</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>8</bold>
              </td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe</td>
              <td align="right" rowspan="1" colspan="1">Ethambutol</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>4170</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">71</td>
              <td align="right" rowspan="1" colspan="1">49</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">NEJM-2018</td>
              <td align="right" rowspan="1" colspan="1">Ethambutol</td>
              <td align="right" rowspan="1" colspan="1">3684</td>
              <td align="right" rowspan="1" colspan="1">71</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>47</bold>
              </td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe</td>
              <td align="right" rowspan="1" colspan="1">Pyrazinamide</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>4048</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">102</td>
              <td align="right" rowspan="1" colspan="1">23</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">NEJM-2018</td>
              <td align="right" rowspan="1" colspan="1">Pyrazinamide</td>
              <td align="right" rowspan="1" colspan="1">3972</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>109</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">
                <bold>6</bold>
              </td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
    <sec>
      <title>Benchmarking against other tools</title>
      <p>In order to separate the effect of mutation catalogue and genotyping method, we gave ARIBA the same catalogue (namely the final release panel described above) as
<italic>Mykrobe</italic> (with small differences, see
<italic>Methods</italic> for details). For the other tools, we simply used their default catalogues in their latest versions at the time of benchmarking. The sensitivity, specificity, and error rates for
<italic>Mykrobe</italic>, ARIBA, KvarQ, MTBseq, and TB-Profiler when applied to the Prospective dataset, summarised across all drugs, is given in
<xref rid="T5" ref-type="table">Table 5</xref> (full data are in the
<italic>Extended data</italic> file
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/accuracy_stats_tsv/7605398">accuracy_stats.tsv</ext-link>
<sup><xref rid="ref-33" ref-type="bibr">33</xref></sup>).</p>
      <table-wrap id="T5" orientation="portrait" position="anchor">
        <label>Table 5. </label>
        <caption>
          <title>Accuracy statistics of each tool and each dataset, using all available drugs.</title>
          <p>All values are percentages. The best value for each statistic is shown in bold. Drugs used for each dataset are as follows. Training: Amikacin, Capreomycin, Ciprofloxacin, Ethambutol, Isoniazid, Kanamycin, Moxifloxacin, Ofloxacin, Rifampicin, Streptomycin; Global and Prospective: Amikacin, Capreomycin, Ciprofloxacin, Ethambutol, Isoniazid, Kanamycin, Moxifloxacin, Ofloxacin, Pyrazinamide, Rifampicin, Streptomycin. VME, very major error rate (false-negative rate); ME, major error rate (false-positive rate); PPV, positive predictive value; NPV, negative predictive value.</p>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th align="left" colspan="7" rowspan="1">(a) Training dataset</th>
            </tr>
            <tr>
              <th align="left" rowspan="1" colspan="1">Tool</th>
              <th align="center" rowspan="1" colspan="1">Sensitivity</th>
              <th align="center" rowspan="1" colspan="1">Specificity</th>
              <th align="center" rowspan="1" colspan="1">VME</th>
              <th align="center" rowspan="1" colspan="1">ME</th>
              <th align="center" rowspan="1" colspan="1">PPV</th>
              <th align="center" rowspan="1" colspan="1">NPV</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" rowspan="1" colspan="1">ARIBA</td>
              <td align="center" rowspan="1" colspan="1">90.04</td>
              <td align="center" rowspan="1" colspan="1">97.91</td>
              <td align="center" rowspan="1" colspan="1">9.96</td>
              <td align="center" rowspan="1" colspan="1">2.09</td>
              <td align="center" rowspan="1" colspan="1">85.59</td>
              <td align="center" rowspan="1" colspan="1">98.62</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">KvarQ</td>
              <td align="center" rowspan="1" colspan="1">80.81</td>
              <td align="center" rowspan="1" colspan="1">98.03</td>
              <td align="center" rowspan="1" colspan="1">19.19</td>
              <td align="center" rowspan="1" colspan="1">1.97</td>
              <td align="center" rowspan="1" colspan="1">84.96</td>
              <td align="center" rowspan="1" colspan="1">97.38</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">MTBseq</td>
              <td align="center" rowspan="1" colspan="1">82.68</td>
              <td align="center" rowspan="1" colspan="1">97.65</td>
              <td align="center" rowspan="1" colspan="1">17.32</td>
              <td align="center" rowspan="1" colspan="1">2.35</td>
              <td align="center" rowspan="1" colspan="1">82.91</td>
              <td align="center" rowspan="1" colspan="1">97.62</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>91.64</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>98.21</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>8.36</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>1.79</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>87.57</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>98.84</bold>
              </td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">TB-Profiler</td>
              <td align="center" rowspan="1" colspan="1">89.71</td>
              <td align="center" rowspan="1" colspan="1">95.02</td>
              <td align="center" rowspan="1" colspan="1">10.29</td>
              <td align="center" rowspan="1" colspan="1">4.98</td>
              <td align="center" rowspan="1" colspan="1">71.25</td>
              <td align="center" rowspan="1" colspan="1">98.53</td>
            </tr>
            <tr>
              <th align="left" colspan="7" rowspan="1">(b) global dataset</th>
            </tr>
            <tr>
              <th align="left" rowspan="1" colspan="1">Tool</th>
              <th align="center" rowspan="1" colspan="1">Sensitivity</th>
              <th align="center" rowspan="1" colspan="1">Specificity</th>
              <th align="center" rowspan="1" colspan="1">VME</th>
              <th align="center" rowspan="1" colspan="1">ME</th>
              <th align="center" rowspan="1" colspan="1">PPV</th>
              <th align="center" rowspan="1" colspan="1">NPV</th>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">ARIBA</td>
              <td align="center" rowspan="1" colspan="1">87.30</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>96.22</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">12.70</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>3.78</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>91.64</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">94.11</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">KvarQ</td>
              <td align="center" rowspan="1" colspan="1">79.99</td>
              <td align="center" rowspan="1" colspan="1">95.81</td>
              <td align="center" rowspan="1" colspan="1">20.01</td>
              <td align="center" rowspan="1" colspan="1">4.19</td>
              <td align="center" rowspan="1" colspan="1">90.05</td>
              <td align="center" rowspan="1" colspan="1">90.99</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">MTBseq</td>
              <td align="center" rowspan="1" colspan="1">81.34</td>
              <td align="center" rowspan="1" colspan="1">96.03</td>
              <td align="center" rowspan="1" colspan="1">18.66</td>
              <td align="center" rowspan="1" colspan="1">3.97</td>
              <td align="center" rowspan="1" colspan="1">90.67</td>
              <td align="center" rowspan="1" colspan="1">91.56</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>88.12</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">96.16</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>11.88</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">3.84</td>
              <td align="center" rowspan="1" colspan="1">91.58</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>94.47</bold>
              </td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">TB-Profiler</td>
              <td align="center" rowspan="1" colspan="1">87.39</td>
              <td align="center" rowspan="1" colspan="1">92.89</td>
              <td align="center" rowspan="1" colspan="1">12.61</td>
              <td align="center" rowspan="1" colspan="1">7.11</td>
              <td align="center" rowspan="1" colspan="1">85.36</td>
              <td align="center" rowspan="1" colspan="1">93.95</td>
            </tr>
            <tr>
              <th align="left" colspan="7" rowspan="1">(c) prospective dataset</th>
            </tr>
            <tr>
              <th align="left" rowspan="1" colspan="1">Tool</th>
              <th align="center" rowspan="1" colspan="1">Sensitivity</th>
              <th align="center" rowspan="1" colspan="1">Specificity</th>
              <th align="center" rowspan="1" colspan="1">VME</th>
              <th align="center" rowspan="1" colspan="1">ME</th>
              <th align="center" rowspan="1" colspan="1">PPV</th>
              <th align="center" rowspan="1" colspan="1">NPV</th>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">ARIBA</td>
              <td align="center" rowspan="1" colspan="1">90.10</td>
              <td align="center" rowspan="1" colspan="1">98.87</td>
              <td align="center" rowspan="1" colspan="1">9.90</td>
              <td align="center" rowspan="1" colspan="1">1.13</td>
              <td align="center" rowspan="1" colspan="1">78.74</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>99.54</bold>
              </td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">KvarQ</td>
              <td align="center" rowspan="1" colspan="1">84.11</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>99.21</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">15.89</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.79</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">83.19</td>
              <td align="center" rowspan="1" colspan="1">99.26</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">MTBseq</td>
              <td align="center" rowspan="1" colspan="1">85.82</td>
              <td align="center" rowspan="1" colspan="1">99.00</td>
              <td align="center" rowspan="1" colspan="1">14.18</td>
              <td align="center" rowspan="1" colspan="1">1.00</td>
              <td align="center" rowspan="1" colspan="1">80.05</td>
              <td align="center" rowspan="1" colspan="1">99.34</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>90.22</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">99.16</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>9.78</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.84</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>83.39</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>99.54</bold>
              </td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">TB-Profiler</td>
              <td align="center" rowspan="1" colspan="1">83.01</td>
              <td align="center" rowspan="1" colspan="1">97.24</td>
              <td align="center" rowspan="1" colspan="1">16.99</td>
              <td align="center" rowspan="1" colspan="1">2.76</td>
              <td align="center" rowspan="1" colspan="1">58.33</td>
              <td align="center" rowspan="1" colspan="1">99.19</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <p>On each of the three datasets,
<italic>Mykrobe</italic> is the most sensitive, has the lowest very major error rate (false susceptible error rate), and the highest negative predictive value.
<italic>Mykrobe</italic> has the best specificity, major error rate (false resistant rate) and positive predictive value on the Training dataset, and the best or second-best results for those statistics on the Global and Prospective datasets.</p>
      <p>A breakdown of the results on the Prospective dataset, showing each drug separately, is given in
<xref ref-type="fig" rid="f5">Figure 5</xref>.
<italic>Mykrobe</italic> and ARIBA, as expected, are very similar except for the high false-positive rate for isoniazid for ARIBA, resulting in a PPV of 82% for ARIBA compared to 94% for
<italic>Mykrobe</italic>. Manual inspection revealed that the extra incorrect calls were caused by assembly errors in the
<italic>katG</italic> gene, resulting in false-positive calls because the gene appeared to be incomplete.</p>
      <fig fig-type="figure" id="f5" orientation="portrait" position="anchor">
        <label>Figure 5. </label>
        <caption>
          <p>Comparison of ARIBA, KvarQ, MTBseq,
<italic>Mykrobe</italic> (with final release panel) and TB-Profiler on the prospective dataset for (
<bold>a</bold>) first-line drugs and (
<bold>b</bold>) second-line drugs. Counts of susceptible samples are shown on the left, with true-negatives coloured by the tool/panel and false-positives coloured red. Similarly, resistant samples are shown on the right, with true-positives coloured by the tool/panel and false-negatives in red. E, ethambutol; H, isoniazid; Z, pyrazinamide; R, rifampicin; Am, amikacin; Cm, capreomycin; Cfx, ciprofloxacin; Km, kanamycin; Mfx, moxifloxacin; Ofx, ofloxacin; S, streptomycin.</p>
        </caption>
        <graphic xlink:href="wellcomeopenres-4-17090-g0004"/>
      </fig>
      <p>The memory usage and run time averaged across all runs of each tool is given in
<xref rid="T6" ref-type="table">Table 6</xref>, and in
<italic>Extended data</italic> files we have: summary boxplots in
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/run_time_boxplots_pdf/7605431">run_time_boxplots.pdf</ext-link>
<sup><xref rid="ref-40" ref-type="bibr">40</xref></sup> and
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/memory_boxplots_pdf/7605434">memory_boxplots.pdf</ext-link>
<sup><xref rid="ref-41" ref-type="bibr">41</xref></sup>, and the complete data in
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/run_time_memory_tsv/7605437">run_time_memory.tsv</ext-link>
<sup><xref rid="ref-42" ref-type="bibr">42</xref></sup>. ARIBA, KvarQ,
<italic>Mykrobe</italic> and TB-Profiler all have low RAM usage (less than 1.1 GB), whereas MTBseq requires 12GB of RAM. KvarQ and MTBseq had the longest running time, taking on average 22 and 42 minutes respectively per sample. ARIBA,
<italic>Mykrobe</italic> and TB-Profiler are fast, typically running in less than 5 minutes, with
<italic>Mykrobe</italic> having the shortest median run time (3.2 minutes).</p>
      <table-wrap id="T6" orientation="portrait" position="anchor">
        <label>Table 6. </label>
        <caption>
          <title>Run time and peak RAM usage.</title>
          <p>Values for each tool are the median across all runs.</p>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th align="left" rowspan="1" colspan="1">Tool</th>
              <th align="right" rowspan="1" colspan="1">RAM (MB)</th>
              <th align="right" rowspan="1" colspan="1">Time (m)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" rowspan="1" colspan="1">ARIBA</td>
              <td align="right" rowspan="1" colspan="1">124</td>
              <td align="right" rowspan="1" colspan="1">3.6</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">KvarQ</td>
              <td align="right" rowspan="1" colspan="1">38</td>
              <td align="right" rowspan="1" colspan="1">22.2</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">MTBseq</td>
              <td align="right" rowspan="1" colspan="1">12201</td>
              <td align="right" rowspan="1" colspan="1">41.6</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe</td>
              <td align="right" rowspan="1" colspan="1">1057</td>
              <td align="right" rowspan="1" colspan="1">3.2</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">TB-Profiler</td>
              <td align="right" rowspan="1" colspan="1">863</td>
              <td align="right" rowspan="1" colspan="1">4.5</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
    <sec>
      <title>Impact of
<italic>Mykrobe</italic> on initial choice of WHO-recommended regimen</title>
      <p>The World Health Organisation (WHO) now recommends systematic access to drug susceptibility testing and specific TB treatment regimens based on individual drug resistance profiles. We therefore ask, if we were to base the choice of a patient’s initial multi-drug therapy purely on the genotyping results from
<italic>Mykrobe</italic>, how accurate would this choice of treatment regimen be? We encoded the most recently published WHO TB treatment recommendations (
<monospace><ext-link ext-link-type="uri" xlink:href="https://github.com/iqbal-lab-org/tb-amr-benchmarking/blob/master/python/evalrescallers/who_treatment.py">https://github.com/iqbal-lab-org/tb-amr-benchmarking/blob/master/python/evalrescallers/who_treatment.py</ext-link></monospace>), and used this to infer both the recommended drug regimen implied by the known phenotype of each sample, and that implied by
<italic>Mykrobe</italic>’s resistance prediction (on the combined global and prospective datasets). The most recent WHO recommended regimens for MDR-TB involve a number of drugs for which phenotyping is rarely performed and for which the genetic basis of drug resistance is only partially understood (e.g. bedaquiline, linezolid). In these cases, drug administration and implementation of WHO recommendations in clinical contexts most often relies on the assumption of drug susceptibility. Given that, and the scarcity of available genotypic to phenotypic correlation data for those drugs, all isolates were treated as susceptible to bedaquiline and linezolid in this analysis. Also, given the absence of recent updated (2018) WHO recommendations for pre-XDR and XDR TB, this analysis model relies on previous recommendations
<sup><xref rid="ref-24" ref-type="bibr">24</xref>,
<xref rid="ref-25" ref-type="bibr">25</xref></sup> which therefore limits the clinical significance of the analysis for the limited number of extensively resistant TB isolates. It also highlights the need for data, new guidance and subsequent update of the
<italic>Mykrobe</italic> performance analysis for those most resistant isolates.</p>
      <p><xref ref-type="fig" rid="f6">Figure 6</xref> presents comprehensive resistance profiles, associated WHO-recommended regimen and a comparison of phenotype- and
<italic>Mykrobe</italic>-driven therapies for all isolates. We immediately observe that for 98.6% (= 4842
<italic>/</italic>(4842 + 69)) of phenotypically pan-susceptible isolates,
<italic>Mykrobe</italic> would correctly imply first-line treatment (regimen 1 in the figure). We excluded those pan-susceptible isolates from the figure for increased clarity. Full results are available in
<italic>Extended data</italic> file
<monospace><ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/who_regimen_counts_tsv/7851689">who_regimen_counts.tsv</ext-link></monospace>
<sup><xref rid="ref-43" ref-type="bibr">43</xref></sup>.</p>
      <fig fig-type="figure" id="f6" orientation="portrait" position="anchor">
        <label>Figure 6. </label>
        <caption>
          <title>Comparison of drug regimen calls inferred from phenotype information and
<italic>Mykrobe</italic> results, on the global and prospective datasets combined.</title>
          <p>See supplementary files
<monospace><ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/regimen_plot_global_pdf/10616762">regimen_plot.global.pdf</ext-link></monospace>,
<monospace><ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/regimen_plot_prospective_pdf/10617554">regimen_plot.prospective.pdf</ext-link></monospace> for the same plot for each of the global and prospective sets separately. On the left, “R” and “S” show the drug phenotypes used to identify the regimen. For example, resistance to isoniazid and moxifloxacin, and susceptibility to rifampicin, pyrazinamide and ethambutol implies drug regimen 3. Coloured dots show the drugs that are included in the regimen, where a line joining drugs represents interchangeability. The ribbons on the right show the mapping of phenotype-inferred regimens (left) to
<italic>Mykrobe</italic>-inferred regimens (right), with numbers showing the number of samples allocated to each regimen. 4,842 samples called as regimen 1 by both methods are not shown. H, isoniazid; R, rifampicin; Z, pyrazinamide; E, ethambutol; Lfx, levofloxacin; Mfx, moxifloxacin; Gfx, gatifloxacin; S, streptomycin; Am, amikacin; Km, kanamycin; Cm, capreomycin; Eto, ethionamide; Cs, cycloserine; Trd, terizidone; Cfz, clofazimine; Lzd, linezolid; Bdq, bedaquiline; X, other WHO second-line drugs to which isolate is shown to be susceptible.</p>
        </caption>
        <graphic xlink:href="wellcomeopenres-4-17090-g0005"/>
      </fig>
      <p><bold>Key error modes for Regimens 2-9</bold> The most frequent clinically significant error mode was wrongly recommending a pan-susceptible TB regimen for mono-isoniazid resistant isolates, which occurred in 53 (12%) of the 451 mono-resistant (regimen 2) isolates. We describe below how all other benchmarked tools shared this error mode.
<xref ref-type="fig" rid="f6">Figure 6</xref> also illustrates other, rarer, cases of non-MDR-TB and non-XDR-TB resistant isolates (regimens 3 to 9) for which a disagreement between phenotype-driven and
<italic>Mykrobe</italic>-driven regimens results from undetected resistance (lines moving upwards as we go from left to right) or false-resistant genotyping results (line moving downwards as we go from left to right). Of the 187 isolates assigned to regimens 3–9 using phenotype data,
<italic>Mykrobe</italic> suggested a pan-susceptible regimen (regimen 1) in 45 cases, and a RR-, MDR- or XDR-TB regimens (10, 11 or 12, respectively) in 3, 16 or 7 cases, respectively.</p>
      <p><bold>RR-TB, MDR-TB and pre-XDR-TB regimens.</bold> A significant number of discrepancies between phenotype-driven and
<italic>Mykrobe</italic>-driven regimens revolve around regimen 10 (RR-TB), regimen 11 (the most recent WHO-recommended MDR-TB regimen), and regimen 12 (pre-XDR-TB) (see
<xref ref-type="fig" rid="f6">Figure 6</xref> for regimen details). Regimens 10 and 11 only differ in that regimen 10 includes isoniazid, and is recommended if the isolate is known to be susceptible to that drug, or if the phenotype is unknown. Conversely, when comprehensive DST results are available, if they confirm a resistance profile including resistance to isoniazid, rifampicin a fluoroquinolone and/or an injectable aminoglycoside, a customized regimen including as many drugs to which the isolate is confirmed to be susceptible as possible is recommended. Given the limited number of XDR-TB isolates in our data, this analysis focused on quinolone resistant pre-XDR samples (regimen 12) for which we had sufficient data to recognise appropriate or erroneous treatment patterns. There were 2903 rifampicin resistant
<italic>M. tuberculosis</italic> isolates for which first-line drug phenotyping justified initiation of RR-TB (
<italic>N</italic> = 253), MDR-TB (
<italic>N</italic> = 2619), or pre-XDR-TB (
<italic>N</italic> = 31) treatment regimen.</p>
      <p><italic>Mykrobe</italic> assigned 96 of the 253 phenotype-inferred RR-TB (regimen 10) isolates to that same regimen (8 of these had an unknown isoniazid phenotype). False-negative rifampicin calls by
<italic>Mykrobe</italic> in 33 of the 253 (=13.0%) isolates resulted in a predicted pan-susceptible treatment (regimen 1). 54 of the 253 isolates were classified as MDR-TB (regimen 11) by
<italic>Mykrobe</italic>, comprising 35 isolates with unknown isoniazid phenotype and 19 false-positive isoniazid calls. The remaining 70 isolates all had unknown phenotypes for isoniazid and moxifloxacin, whereas
<italic>Mykrobe</italic> predicted resistance to these drugs and assigned them to XDR-TB regimen 12.</p>
      <p>There were 2619 isolates classified as MDR-TB (regimen 11) from the phenotype data. The majority of isolates (1727/2619=65.9%) are appropriately assigned by
<italic>Mykrobe</italic> to the MDR-TB regimen. A minority of isolates (103/2619=3.9%) are falsely identified as being less resistant and consequently directed (upwards in the figure) towards regimens 1–9. False-negative isoniazid calls resulted in 92 of the 2619 isolates (=3.5%) to be wrongly allocated to regimen 10 (RR-TB). The remaining 692 of the 2619 isolates (=26.4%) were identified as resistant to moxifloxacin, classifying them as regimen 12. Moxifloxacin phenotypic susceptibility testing results for 689 of these isolates was unknown, whereas
<italic>Mykrobe</italic> determined them to be resistant and so directed the samples to a pre-XDR-TB regimen instead of an MDR-TB regimen. We can estimate what proportion of these 692 samples were correctly assigned to an XDR-TB regimen instead of to MDR-TB using the positive predictive value estimated from those samples with phenotypes (see
<xref rid="T2" ref-type="table">Table 2</xref>). We estimate that for 644/692 (=93%) samples, the
<italic>Mykrobe</italic>-driven regimen choice was accurate. We emphasise that this model relies on WHO recommendations which are expected to be updated in the specific case of pre-XDR-TB and XDR-TB.</p>
      <p><bold>Comparison with other tools.</bold> We find
<italic>Mykrobe</italic> resulted in the correct regimen choice for 93.9% of samples using the latest panel, a 1.2% improvement over
<italic>Mykrobe</italic> with the 2015 panel, and a 1% improvement over ARIBA using the same 2019 panel. We counted a tool as correct for RR-TB and MDR-TB isolates where phenotype data for isoniazid and/or moxifloxacin resistance was unknown, but the tool assigned MDR-TB or XDR-TB because of resistance calls for one or both of those drugs. All benchmarked tools performed reasonably similarly, with the worst performance by TB-profiler (89% correct). Per-tool accuracy of regimen choice is shown in
<xref rid="T7" ref-type="table">Table 7</xref>, and
<xref rid="T8" ref-type="table">Table 8</xref>, with the best-performing tool for each regimen highlighted. For 4 of the 11 regimens (numbers 1 (pan-susceptible), 2 (INH mono-resistant), 8 (pyrazinamide-mono resistant) and 10 (rifampicin-mono resistant)),
<italic>Mykrobe</italic> achieves the highest success rate. In particular, the INH-mono-resistant case, highlighted above as a concern for
<italic>Mykrobe</italic>, is also an issue for other tools.</p>
      <table-wrap id="T7" orientation="portrait" position="anchor">
        <label>Table 7. </label>
        <caption>
          <title>Benchmarking regimen success rates for different callers, on the global and prospective datasets combined.</title>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th align="left" rowspan="1" colspan="1">Tool</th>
              <th align="right" rowspan="1" colspan="1">Correct
<break/>regimen</th>
              <th align="right" rowspan="1" colspan="1">Incorrect
<break/>regimen</th>
              <th align="right" rowspan="1" colspan="1">Percent
<break/>correct</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe-2019</td>
              <td align="right" rowspan="1" colspan="1">7939</td>
              <td align="right" rowspan="1" colspan="1">513</td>
              <td align="right" rowspan="1" colspan="1">93.9</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">ARIBA</td>
              <td align="right" rowspan="1" colspan="1">7853</td>
              <td align="right" rowspan="1" colspan="1">599</td>
              <td align="right" rowspan="1" colspan="1">92.9</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe-2015</td>
              <td align="right" rowspan="1" colspan="1">7839</td>
              <td align="right" rowspan="1" colspan="1">613</td>
              <td align="right" rowspan="1" colspan="1">92.7</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">MTBseq</td>
              <td align="right" rowspan="1" colspan="1">7770</td>
              <td align="right" rowspan="1" colspan="1">682</td>
              <td align="right" rowspan="1" colspan="1">91.9</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">KvarQ</td>
              <td align="right" rowspan="1" colspan="1">7710</td>
              <td align="right" rowspan="1" colspan="1">742</td>
              <td align="right" rowspan="1" colspan="1">91.2</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">TB-Profiler</td>
              <td align="right" rowspan="1" colspan="1">7519</td>
              <td align="right" rowspan="1" colspan="1">933</td>
              <td align="right" rowspan="1" colspan="1">89.0</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <table-wrap id="T8" orientation="portrait" position="anchor">
        <label>Table 8. </label>
        <caption>
          <title>Regimen success rate broken down by regimen, on the global and prospective datasets combined.</title>
          <p>The regimens are: 1, DS-TB; 2, Mono-H DR-TB; 3, Mono-H DR-TB; 4, H-Z DR-TB; 5, H-E DR-TB; 6, H-Z-E DR-TB; 7, H-Z-E DR-TB; 8, Mono-Z DR-TB; 9, Mono-E DR-TB; 10, RR-TB; 11, MDR-TB; 12, pre/XDR-TB.</p>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th align="center" colspan="13" rowspan="1">Regimen</th>
            </tr>
            <tr>
              <th align="left" rowspan="1" colspan="1">Tool</th>
              <th align="right" rowspan="1" colspan="1">1</th>
              <th align="right" rowspan="1" colspan="1">2</th>
              <th align="right" rowspan="1" colspan="1">3</th>
              <th align="right" rowspan="1" colspan="1">4</th>
              <th align="right" rowspan="1" colspan="1">5</th>
              <th align="right" rowspan="1" colspan="1">6</th>
              <th align="right" rowspan="1" colspan="1">7</th>
              <th align="right" rowspan="1" colspan="1">8</th>
              <th align="right" rowspan="1" colspan="1">9</th>
              <th align="right" rowspan="1" colspan="1">10</th>
              <th align="right" rowspan="1" colspan="1">11</th>
              <th align="right" rowspan="1" colspan="1">12</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe-2019</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>98.6</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">
                <bold>77.4</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>21.4</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">55.2</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>6.7</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>72.1</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">
                <bold>9.1</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">
                <bold>79.4</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">92.4</td>
              <td align="right" rowspan="1" colspan="1">87.1</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Mykrobe-2015</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>98.6</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">68.3</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">10.7</td>
              <td align="right" rowspan="1" colspan="1">55.2</td>
              <td align="right" rowspan="1" colspan="1">0.0</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">71.2</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>9.1</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">78.7</td>
              <td align="right" rowspan="1" colspan="1">90.5</td>
              <td align="right" rowspan="1" colspan="1">87.1</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">ARIBA</td>
              <td align="right" rowspan="1" colspan="1">97.5</td>
              <td align="right" rowspan="1" colspan="1">69.2</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>21.4</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">55.2</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>6.7</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">71.2</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>9.1</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">78.7</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>92.7</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">87.1</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">KvarQ</td>
              <td align="right" rowspan="1" colspan="1">98.5</td>
              <td align="right" rowspan="1" colspan="1">69.2</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>21.4</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">27.6</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>6.7</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">65.4</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>9.1</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">77.9</td>
              <td align="right" rowspan="1" colspan="1">86.1</td>
              <td align="right" rowspan="1" colspan="1">83.9</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">MTBseq</td>
              <td align="right" rowspan="1" colspan="1">98.0</td>
              <td align="right" rowspan="1" colspan="1">67.2</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">28.6</td>
              <td align="right" rowspan="1" colspan="1">41.4</td>
              <td align="right" rowspan="1" colspan="1">0.0</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">68.3</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>9.1</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">77.1</td>
              <td align="right" rowspan="1" colspan="1">89.3</td>
              <td align="right" rowspan="1" colspan="1">83.9</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">TB-Profiler</td>
              <td align="right" rowspan="1" colspan="1">92.9</td>
              <td align="right" rowspan="1" colspan="1">66.1</td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>21.4</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">
                <bold>58.6</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">
                <bold>6.7</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">0</td>
              <td align="right" rowspan="1" colspan="1">11.5</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>9.1</bold>
              </td>
              <td align="right" rowspan="1" colspan="1">77.5</td>
              <td align="right" rowspan="1" colspan="1">91.6</td>
              <td align="right" rowspan="1" colspan="1">
                <bold>90.3</bold>
              </td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
  </sec>
  <sec sec-type="discussion">
    <title>Discussion</title>
    <p>Although sequencing-based diagnostic information for
<italic>M. tuberculosis</italic> has been available for some years
<sup><xref rid="ref-1" ref-type="bibr">1</xref>,
<xref rid="ref-9" ref-type="bibr">9</xref>,
<xref rid="ref-11" ref-type="bibr">11</xref>,
<xref rid="ref-17" ref-type="bibr">17</xref>,
<xref rid="ref-44" ref-type="bibr">44</xref></sup>, the results have not been sufficiently good to justify replacing (or partially replacing) phenotyping. However, very recently the CRyPTIC consortium showed that for first-line drugs, a prediction of susceptibility was now sufficiently accurate to support therapeutic management in routine clinical settings
<sup><xref rid="ref-20" ref-type="bibr">20</xref></sup>. Indeed this has been implemented now in Public Health England, RIVM (Netherlands) and the Wadsworth Centre (New York). In this study we introduce our reimplemented resistance prediction tool,
<italic>Mykrobe</italic>, with initial mutation catalogue taken from that study
<sup><xref rid="ref-20" ref-type="bibr">20</xref></sup> for first-line drugs, and
<xref rid="ref-3" ref-type="bibr">3</xref> for second-line drugs. We evaluate
<italic>Mykrobe</italic> in a number of ways. We show that the new catalogue does indeed give improved results over that from
<xref rid="ref-3" ref-type="bibr">3</xref> used in our old implementation
<italic>Mykrobe predictor</italic>, in particular increasing power to detect pyrazinamide resistance from 25% to 74% (global set, containing 1014 resistant samples) and 72% to 82% (prospective set, containing 125 resistant samples). This is achieved by considering all frameshifts of length 1 or 2 in
<italic>pncA</italic> as causing pyrazinamide resistance, and comes at the cost of a increased major error rate (rising from 2.2% on the global set for the previous catalogue based on
<xref rid="ref-3" ref-type="bibr">3</xref> to 5.7% for current
<italic>Mykrobe</italic> (although there was no increase in major error rate in the prospective set, changing from 0.7% to 0.5%)). Given the poor performance of pyrazinamide phenotypic testing, some proportion of the discrepancies are probably due to phenotypic error
<sup><xref rid="ref-45" ref-type="bibr">45</xref>,
<xref rid="ref-46" ref-type="bibr">46</xref></sup>.</p>
    <p>A key component in the approach of
<xref rid="ref-20" ref-type="bibr">20</xref> was to flag novel mutations in resistance-associated genes, and refuse to make a prediction in those cases. In a putative clinical setting this would delay getting (conservative, correct) results until phenotypic DST was completed. By contrast
<italic>Mykrobe</italic> does not do this, and predicts susceptibility when there is no mutation from the catalogue. We are able to compare and contrast these approaches, as we are using the same data, and conclude that the novel-mutation-aware approach is preferable to that used by
<italic>Mykrobe</italic> (and, as far as we can tell, all other benchmarked tools). Essentially, novel (off-catalogue) mutations are an effective flag for very major errors (missed resistance). Our feeling is that the cost (delays for susceptible samples containing novel mutations) is outweighed by the benefit (avoiding some false susceptible calls). Modifying
<italic>Mykrobe</italic> to follow that policy is therefore something we would like to do in the future. Of the other tools we tested, MTBSeq and TB-profiler would most easily be able to adopt this approach, as they both already do full SNP discovery for every sample.</p>
    <p>In general
<italic>Mykrobe</italic> outperforms all the other benchmarked tools, having the best sensitivity and best or second-best specificity on each of the three datasets.
<italic>Mykrobe</italic> supports error-prone ONT reads, and we show that ONT and Illumina data produce identical results, although we would wish to have tested on more than five samples. Motivated by the fact that low frequency resistant populations will sweep to fixation under drug pressure, and by the results in the
<italic>Mykrobe predictor</italic> paper
<sup><xref rid="ref-1" ref-type="bibr">1</xref></sup>,
<italic>Mykrobe</italic> predicts resistance if it detects known resistance alleles at low frequencies (in practise above 10%, for illumina data only). For isoniazid, rifampicin and the second line drugs, this results in detection of more resistant isolates, at limited cost in false positives (see
<xref rid="T3" ref-type="table">Table 3</xref>). However for ethambutol and pyrazinamide the proportion of these extra calls that are false is unacceptably high (38% and 15%, respectively). Possible reasons for different performance for these drugs are given above; future versions of
<italic>Mykrobe</italic> are likely to exclude minor alleles for these drugs.</p>
    <p>We introduce the idea of measuring how sequencing-based diagnostic for TB drug resistance impact potential regimen choice, and include a powerful way to visualise it. The idea is explicitly not to suggest this could directly advise physicians, but instead to provide a different metric for clinically important errors. Our analysis has limitations. First, we have only partial phenotyping data for second line TB drugs, and in fact none for the new and repurposed TB drugs. Second, WHO guidelines are ever evolving and may differ from clinical expert opinions when it comes to the choice of personalized therapeutic regimens. Nevertheless, we can clearly see that the richer resistance profile from WGS data leads to more differentiated choices of regimen. We look forward to impending large and fully phenotyped datasets, for example from the CRyPTIC consortium, where tens of thousands of global samples will have quantitative phenotype data for 14 drugs. In addition, CRyPTIC is set up to deliver improved resistance catalogues, which we intend to incorporate into
<italic>Mykrobe</italic>.</p>
    <p>The pipelines for running the analyses in this paper are fully automated, all the way to generating figures, tables of results and
<italic>Extended data</italic>, and we intend to update the paper as results improve (and as competitor tools are updated; a future update will benchmark the latest TB-profiler release, which appeared during the preparation of this paper). Our recommendations for
<italic>in silico</italic> DST tools such as
<italic>Mykrobe</italic> reflect our own learnings: use minor populations to improve predictions, flag novel mutations in resistance genes, and allow user-defined catalogues to facilitate comparisons and testing.</p>
  </sec>
  <sec sec-type="conclusions">
    <title>Conclusions</title>
    <p>Antibiotic resistance prediction is of critical importance for the roll-out of sequencing-based diagnostics for TB. We have demonstrated here our new tool
<italic>Mykrobe</italic>, supporting both nanopore and Illumina data.
<italic>Mykrobe</italic> provides simple, automated and lightweight results which we evaluate thoroughly on over 10,000 isolates. We find that
<italic>Mykrobe</italic> outperforms other tools, and (by implementing our catalogue in a second tool, ARIBA) confirm that the primary determinant of success is the resistance catalogue. We find that considering minor populations, and flagging novel (off catalogue) mutations in resistance genes improve results. Finally, we introduce a new metric to highlight errors which impact initial choice of therapeutic regimen, achieving an accuracy of 95%.</p>
    <p>The field has further to go before we can say we are fully fit for purpose, especially for the second-line, novel and repurposed drugs. A genomic resistance predictor must by necessity be a living and growing project, and our intention is that this document should also be updated in parallel, providing evidence and also open underlying data. We will be updating it to include benchmarking of future panels of
<italic>Mykrobe</italic>, and updated versions of other tools.</p>
  </sec>
  <sec sec-type="methods">
    <title>Methods</title>
    <sec>
      <title>Implementation</title>
      <p><bold><italic>Species identification</italic></bold>. A hierarchy of sequence probes are used to identify species and “phylogroup” (in this case Non Tuberculous Mycobacteria (NTM)) or
<italic>Mycobacterium tuberculosis</italic> Complex (MTBC)). This is done by building a de Bruijn graph of a training set of samples of known species, identifying which species each unitig (maximal non-branching path) is seen in, and then selecting probes (unitigs) which are highly differentiated between species, and between phylogroups. The method was previously described in Bradley
<italic>et al.</italic>
<sup><xref rid="ref-1" ref-type="bibr">1</xref></sup>.</p>
      <p><bold><italic>Lineage identification with MTBC</italic></bold>.
<italic>Mykrobe</italic> currently uses the lineage-informative SNPs from
<xref rid="ref-47" ref-type="bibr">47</xref> to assign lineage within the MTBC.</p>
      <p><bold><italic>New statistical model for genotyping</italic></bold>. In order to use a de Bruijn graph to genotype a catalogue of variants (SNPs and indels) we first convert the list of variant sites into a set of sequence ‘probes’ of length 2
<italic>k −</italic> 1. If the resistance mutations are defined in amino acid space, we first convert these into a set of possible codon changes in DNA space. In the simple case, we then represent these alleles as two short sequences (of length 2
<italic>k −</italic> 1) - one “reference” or “susceptible” allele, and the other “alternate” or “resistant” allele. However, if there is another SNP or indel within
<italic>k</italic> bases, any sample with this variant would have different susceptible or resistant allele
<italic>k</italic>-mers. We therefore build equivalent susceptible or resistant alleles for each variant within
<italic>k</italic> bases of our SNP of interest. These lead to at least two alleles for each SNP, and several more if there is background variation within
<italic>k</italic> bases. To construct a catalogue of these background variants, we used all SNPs and indels called in 200 samples selected at random from the Training set.</p>
      <p>From this set of probes, we construct our reference de Bruijn graph. Given an input FASTQ file, the de Bruijn graph is created, and intersected with this reference graph. For each probe allele we calculate the proportion of
<italic>k</italic>-mers with non-zero
<italic>k</italic>-mer coverage, and the median
<italic>k</italic>-mer depth on each probe. For all mutations in the panel we iterate through all possible nucleotide changes that would generate the specified amino acid change (if appropriate), and find the resistant allele and susceptible allele with the highest coverage. We then compare three competing
<italic>k</italic>-mer producing Poisson models: homozygous reference (‘0/0’), heterozygous (‘0/1’) (frequency=50%), and homozygous alternate (‘1/1’) specified as follows</p>
      <p>0/0:</p>
      <p>
        <disp-formula id="e1">
          <mml:math id="math1">
            <mml:mspace width="3em"/>
            <mml:mrow>
              <mml:mtext>KmerCount</mml:mtext>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mtext>ref</mml:mtext>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>∼</mml:mo>
              <mml:mtext>Pois</mml:mtext>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mi>D</mml:mi>
              <mml:mo>(</mml:mo>
              <mml:mn>1</mml:mn>
              <mml:mo>-</mml:mo>
              <mml:mi>ε</mml:mi>
              <mml:mo>)),</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>
        <disp-formula id="e2">
          <mml:math id="math2">
            <mml:mrow>
              <mml:mtext>KmerCount</mml:mtext>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mtext>alt</mml:mtext>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>∼</mml:mo>
              <mml:mtext>Pois</mml:mtext>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:mfrac>
                    <mml:mrow>
                      <mml:mi>D</mml:mi>
                      <mml:mi>ε</mml:mi>
                    </mml:mrow>
                    <mml:mn>3</mml:mn>
                  </mml:mfrac>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
              <mml:mtext>;</mml:mtext>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>1/1:</p>
      <p>
        <disp-formula id="e3">
          <mml:math id="math3">
            <mml:mrow>
              <mml:mtext>KmerCount</mml:mtext>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mtext>ref</mml:mtext>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>∼</mml:mo>
              <mml:mtext>Pois</mml:mtext>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:mfrac>
                    <mml:mrow>
                      <mml:mi>D</mml:mi>
                      <mml:mi>ε</mml:mi>
                    </mml:mrow>
                    <mml:mn>3</mml:mn>
                  </mml:mfrac>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
              <mml:mtext>,</mml:mtext>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>
        <disp-formula id="e4">
          <mml:math id="math4">
            <mml:mspace width="2.5em"/>
            <mml:mrow>
              <mml:mtext>KmerCount</mml:mtext>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mtext>alt</mml:mtext>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>∼</mml:mo>
              <mml:mtext>Pois(</mml:mtext>
              <mml:mi>D</mml:mi>
              <mml:mo>(</mml:mo>
              <mml:mn>1</mml:mn>
              <mml:mo>-</mml:mo>
              <mml:mi>ε</mml:mi>
              <mml:mo>));</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>0/1:</p>
      <p>
        <disp-formula id="e5">
          <mml:math id="math5">
            <mml:mrow>
              <mml:mtext>KmerCount</mml:mtext>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mtext>ref</mml:mtext>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>∼</mml:mo>
              <mml:mtext>Pois</mml:mtext>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:mfrac>
                    <mml:mi>D</mml:mi>
                    <mml:mn>2</mml:mn>
                  </mml:mfrac>
                  <mml:mo>+</mml:mo>
                  <mml:mfrac>
                    <mml:mi>D</mml:mi>
                    <mml:mn>2</mml:mn>
                  </mml:mfrac>
                  <mml:mfrac>
                    <mml:mi>ε</mml:mi>
                    <mml:mn>3</mml:mn>
                  </mml:mfrac>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
              <mml:mo>,</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>
        <disp-formula id="e6">
          <mml:math id="math6">
            <mml:mrow>
              <mml:mtext>KmerCount</mml:mtext>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mtext>alt</mml:mtext>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>∼</mml:mo>
              <mml:mtext>Pois</mml:mtext>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:mfrac>
                    <mml:mi>D</mml:mi>
                    <mml:mn>2</mml:mn>
                  </mml:mfrac>
                  <mml:mo>+</mml:mo>
                  <mml:mfrac>
                    <mml:mi>D</mml:mi>
                    <mml:mn>2</mml:mn>
                  </mml:mfrac>
                  <mml:mfrac>
                    <mml:mi>ε</mml:mi>
                    <mml:mn>3</mml:mn>
                  </mml:mfrac>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
              <mml:mo>;</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>where KmerCount() is a function returning the number of
<italic>k</italic>-mers observed from a given allele (i.e., the sum of the
<italic>k</italic>-mer coverages along an allele),
<italic>L</italic> is the number of
<italic>k</italic>-mers in that allele,
<italic>D</italic> is the genome-wide average depth of coverage, which corresponds to an expected
<italic>k</italic>-mer coverage of
<italic>D′</italic> =
<italic>D</italic>(
<italic>R − k</italic> + 1)
<italic>/R</italic>,
<italic/> is the expected
<italic>k</italic>-mer count along the allele (
<italic/> =
<italic>LD′</italic> ), and
<italic>ε</italic> is the expected error rate. The log-likelihood of each allele is summed, and the maximum likelihood model is chosen. The confidence is given by the difference between the log-likelihoods of the two most likely models.</p>
      <p>The following filters are applied to the resulting genotype calls resulting in a NULL call for the variant:</p>
      <list list-type="bullet">
        <list-item>
          <p>LOW_GT_CONF: If the confidence of the call is below a certain value (default 150 for Illumina, dynamically assigned for nanopore)</p>
        </list-item>
        <list-item>
          <p>LOW_PERCENT_COVERAGE: If proportion of
<italic>k</italic>-mers on the allele with non-zero coverage is not 100%</p>
        </list-item>
        <list-item>
          <p>LOW_TOTAL_DEPTH: If the total depth on a variant (reference + alternate) is less than min_proportion_expected_depth (default 0.30) of expected depth.</p>
        </list-item>
      </list>
      <p><bold><italic>Oxford Nanopore evaluation</italic></bold>. For Oxford nanopore data, which has a much higher per-base error rate than Illumina, the LOW_GT_CONF filter default value is determined empirically from the input data, as follows. First, the SNPs/indels are genotyped as described above using a default error rate of 15%. Restricting to variants called as homozygous (and assuming these calls are correct), the rate of error
<italic>k</italic>-mers appearing on the wrong allele is estimated by dividing the total
<italic>k</italic>-mer depth on all the non-called alleles by the total
<italic>k</italic>-mer depth seen across both alleles in all calls. Next, the coverages on 10,000 SNPs are simulated as follows: for each SNP sample the depth on the "true" allele from a Poisson distribution with mean equal to the mean depth, and the depth on the "false" allele by sampling from a binomial distribution, with the number of trials equal to the mean depth, and probability equal to the estimated incorrect
<italic>k</italic>-mer error rate. The genotype confidence of each SNP is calculated, and together these 10,000 simulated SNPs give us a modelled genotype confidence distribution. We then choose the genotype confidence cutoff to be the value that would retain 90% of the simulated SNP calls (this is the default - the precise value can be changed by the user). Genotyping is then re-run with the estimated
<italic>k</italic>-mer error rate and this GT_CONF threshold.</p>
    </sec>
    <sec>
      <title>Operation</title>
      <p><italic>Mykrobe</italic> is available for Linux (command-line only), Mac (command-line or graphical user-interface (GUI) application) and Windows (GUI only). For Linux, Python 2 or 3 (minimum versions 2.7 or 3.4+) is required to install and run the software.</p>
      <p><bold><italic>Command-line version</italic></bold>. Installation of the command line version is via cloning the git repository and running some install commands (documented here:
<ext-link ext-link-type="uri" xlink:href="https://github.com/Mykrobe-tools/mykrobe">https://github.com/Mykrobe-tools/mykrobe</ext-link>), or by using bioconda:</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;#000000">conda install -c bioconda mykrobe</styled-content>
        </preformat>
      </p>
      <p>Drug resistance predictions can be obtained from a sample using the single command of the form:</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;#000000">mykrobe predict --format json --seq reads.fastq --output out.json sample_name species</styled-content>
        </preformat>
      </p>
      <p>where
<monospace>“sample_name”</monospace> can be replaced with the name of the sample being run (any text will do). The
<monospace>“species”</monospace> parameter can be
<monospace>“tb”</monospace> or
<monospace>“staph”</monospace> to use the built-in panels, or
<monospace>“custom”</monospace> for a user-generated panel (an example is shown later). The output file
<monospace>“out.json”</monospace> contains variant and drug resistance calls, and details of the run, such as the version number of
<italic>Mykrobe</italic> and input parameters. It is in the standard JSON format, which can be easily parsed by standard libraries in most programming languages. Below is an example excerpt of the “susceptibility” section of the output, which contains resistance calls.</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;#000000">"susceptibility": {
    "Isoniazid": {"predict": "S"},
    "Rifampicin": {
        "predict": "R",
        "called_by": {
            "rpoB_I491F-ATC761277TTC": {
                "genotype": [1,1],
                "genotype_likelihoods": [
                    -18289.715541997128,
                    -99999999,
                    -120.40490302280631
                ],
                "info": {
                    "coverage": {
                        "reference": {
                            "percent_coverage": 0.0,
                            "median_depth": 0,
                            "min_non_zero_depth": 0,
                            "kmer_count": 0,
                            "klen": 21
                        },
                        "alternate": {
                            "percent_coverage": 100.0,
                            "median_depth": 150,
                            "min_non_zero_depth": 148,
                            "kmer_count": 3010,
                            "klen": 21
                        }
                    },
                    "expected_depths": [
                        145.0
                    ],
                    "conf": 18169
                }
            }
        }
    }
}</styled-content>
        </preformat>
      </p>
      <p>In the above example, the sample has been called as susceptible to Isoniazid (
<monospace>"predict": "S"</monospace>) and resistant to rifampicin (
<monospace>"predict": "R"</monospace>) because it has the variant I491F in the
<italic>rpoB</italic> gene. The string ATC761277TTC tells us that this is a change from ATC to TTC at position 761277 of the reference genome H37Rv3. The various tag meanings are given in
<xref rid="T9" ref-type="table">Table 9</xref>.</p>
      <table-wrap id="T9" orientation="portrait" position="anchor">
        <label>Table 9. </label>
        <caption>
          <title>JSON file tags.</title>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th align="left" rowspan="1" colspan="1">Tag</th>
              <th align="left" rowspan="1" colspan="1">Meaning</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" rowspan="1" colspan="1">genotype</td>
              <td align="left" rowspan="1" colspan="1">values 0/0, 0/1 or 1/1</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">genotype_likelihood</td>
              <td align="left" rowspan="1" colspan="1">log likelihood of genotype. The closer to zero, the more likely it is.</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">percent_coverage</td>
              <td align="left" rowspan="1" colspan="1">proportion of
<italic>k</italic>-mers in allele present with
<italic>k</italic>-mer coverage&gt;0</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <p>Results can optionally be exported to a CSV file.</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;#000000">mykrobe predict --format csv --seq reads.fastq --output out.csv sample_name species</styled-content>
        </preformat>
      </p>
      <p>The above example would export as follows</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;#000000">sample     drug          susceptibility    called_by
1234       Isoniazid     S
1234       Rifampicin    R                 rpoB_I491F-ATC761277TTC:0:3010:18619</styled-content>
        </preformat>
      </p>
      <p>where the format of the
<monospace>called_by</monospace> column is
<monospace>variant_name:reference_kmer_count:alt_kmer_count:conf</monospace>.</p>
      <p><bold><italic>Using Mykrobe with user-defined panels for M. tuberculosis</italic></bold>. As described above,
<italic>Mykrobe</italic> requires a set of sequence probes, which are generated from the list of variant sites. The panel of variant sites need to be in a tab-delimited file that has the gene name, variant, and whether the variant is a change in protein or DNA sequence. For example:</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;#000000">pncA     G12GC    DNA
gyrA     D94G     PROT
fabG1    T-8X     DNA</styled-content>
        </preformat>
      </p>
      <p>There are three variants in this example. The first is a change from G to GC at position 12 in the DNA sequence of the
<italic>pncA</italic> gene. The second variant is an amino acid change from D to G at position 94 in the
<italic>embB</italic> gene. The final variant is eight nucleotides upstream of the
<italic>fabG1</italic> gene, where the T in the reference genome is changed to A, C, or G (i.e. X is a wildcard). Note that all positions are relative to the gene, not the complete genome sequence. The following command produces a FASTA file of probe sequences</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;#000000">mykrobe variants make-probes reference.fasta -g reference.gb -t panel.tsv &gt; probes.fasta</styled-content>
        </preformat>
      </p>
      <p>where
<monospace>reference.fasta</monospace> and
<monospace>reference.gb</monospace> are FASTA and GenBank format files of the reference sequence and annotation respectively. Note that background variants can also be included in the probe set, which requires the variants in one or more VCF files, and MongoDB to be installed. The following BASH commands will add variants to a new database.</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;#000000">db=$PWD/mongo-db/
mkdir $db
mongod --quiet --dbpath $db &amp;
sleep 10
for f in ‘cat vcfs.txt‘
do
    mykrobe variants add --db_name mtb $f reference.fasta
done</styled-content>
        </preformat>
      </p>
      <p>In the above commands, the file
<monospace>vcfs.txt</monospace> contains a list of the VCF file names (one file name per line), and the variants from each VCF file are added in turn to the database. Then the same command as above can be run to make the probe sequences, but with the extra option
<monospace>--db_name mtb</monospace>.</p>
      <p>In addition to the probes FASTA file, a JSON file that maps each variant to a list of drugs is required to run the “predict” subcommand of
<italic>Mykrobe</italic>. For example, the JSON file corresponding to the above example three variants is as follows.</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;#000000">{"pncA_G12GC": ["Pyrazinamide"],
 "gyrA_D94G": ["Ciprofloxacin", "Ofloxacin", "Moxifloxacin"],
 "fabG1_T-8X": ["Isoniazid"]}</styled-content>
        </preformat>
      </p>
      <p>The probes FASTA file
<monospace>probes.fasta</monospace> and JSON file of variant to drug(s)
<monospace>variants.json</monospace> can be used with
<italic>Mykrobe</italic> with the command</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;#000000">mykrobe predict --seq reads.fastq --output out.json --panel custom \
  --custom_probe_set_path probes.fasta --custom_variant_to_resistance_json variants.json \
  &lt;any sample name&gt; tb</styled-content>
        </preformat>
      </p>
      <p><bold><italic>Graphical user-interface app for Mac and Windows</italic></bold>. The interface for
<italic>Mykrobe</italic> graphical app is shown in
<xref ref-type="fig" rid="f7">Figure 7</xref>.</p>
      <fig fig-type="figure" id="f7" orientation="portrait" position="anchor">
        <label>Figure 7. </label>
        <caption>
          <p>(
<bold>a</bold>) Start page of the
<italic>Mykrobe</italic> application. Users can drag-and-drop or select their sequence files. Once selected,
<italic>Mykrobe</italic> starts the analysis process. (
<bold>b</bold>) Once the analysis is complete, the user is shown the resistance profile - which drugs is the isolate predicted to be resistant to, and susceptible to. (
<bold>c</bold>) Resistance profile can be broken down into first and second line drugs. (
<bold>d</bold>) The identified genetic substrate for resistance prediction can be seen in the "Evidence" tab. Here, evidence for isoniazid and rifampicin resistance is observed in variants
<italic>KatG</italic> position 315 and
<italic>rpoB</italic> position 450, respectively. (
<bold>e</bold>) The species and lineage prediction can be seen in the "Species" tab. Here the sample is
<italic>Mycobacterium tuberculosis</italic> of European/American lineage.</p>
        </caption>
        <graphic xlink:href="wellcomeopenres-4-17090-g0006"/>
      </fig>
      <p><bold><italic>Containerised releases</italic></bold>. A Docker container can be obtained using the command</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;#000000">docker pull quay.io/biocontainers/mykrobe:0.7.0--py37h2666aa9_0</styled-content>
        </preformat>
      </p>
      <p><bold><italic>Variant panel development</italic></bold>. The new
<italic>Mykrobe</italic> variant catalogue was developed using the Training and Global datasets as follows (see also
<xref ref-type="fig" rid="f2">Figure 2</xref>). We started with the catalogue of variants from
<xref rid="ref-20" ref-type="bibr">20</xref> for the first line drugs, which we call NEJM-2018. This was used together with the remaining drugs from the existing
<italic>Mykrobe predictor</italic> release panel (Walker-2015), and the fluoroquinolones separated into ciprofloxacin, moxifloxacin and ofloxacin. This combined set of variant sites was called candidate panel 1 (CP1). Note that this includes all frameshifts of length 1 and 2 in
<italic>pncA</italic> and
<italic>katG</italic>, implying resistance to pyrazinamide and isoniazid respectively.
<italic>Mykrobe</italic> was run on the Training dataset using CP1 and the results were compared against the known phenotypes for those samples. All variants that had positive predictive value less than 5% were removed from CP1, to make candidate panel 2 (CP2). Next, the process was repeated, removing variants from CP2 to make candidate panel 3 (CP3), based on the results of running
<italic>Mykrobe</italic> with CP2 on the Global data set. All removed variants are provided in the
<italic>Source data</italic> file
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/removed_variants_tsv/7605380">removed_variants.tsv</ext-link>
<sup><xref rid="ref-32" ref-type="bibr">32</xref></sup>. Finally, three removed variants were reinstated into the panel because they were found to have positive predictive value greater than 5% on later datasets (these were identified using the results from the Walker-2015 panel). The final panel is included as the default set of variants in release 0.7.0 of
<italic>Mykrobe</italic>.</p>
      <p><bold><italic>Comparison with other tools</italic></bold>. Since our combined Training, Global, and prospective datasets consist of more than ten thousand samples, we only benchmarked
<italic>Mykrobe</italic> against tools which could be run on the command-line (not web or user-interface applications). Specifically, we tested
<ext-link ext-link-type="uri" xlink:href="https://github.com/sanger-pathogens/ariba">ARIBA</ext-link> (version 2.13.2),
<ext-link ext-link-type="uri" xlink:href="https://github.com/kvarq/kvarq">KvarQ</ext-link> (commit d693f561d205c9a3f9b9c705e2fefecdeb715cc8),
<ext-link ext-link-type="uri" xlink:href="https://github.com/jodyphelan/TBProfiler">MTBseq</ext-link> (version 1.0.3) and
<ext-link ext-link-type="uri" xlink:href="https://github.com/jodyphelan/TBProfiler">TB-Profiler</ext-link> (commit 327e431c3e9de2897a885fabe6bfede1421b2470). In order to separate the impact of catalogue from the different genotyping processes applied by different methods, we modified ARIBA to use the same catalogue as
<italic>Mykrobe</italic>, but for the other tools we used their in-built catalogues.</p>
      <p>ARIBA was modified by adding an option to use the same variant panel as the final
<italic>Mykrobe</italic> release panel, but with the following differences. First, since ARIBA performs local assembly, it was modified to call resistance to pyrazinamide or isoniazid if the
<italic>pncA</italic> or
<italic>katG</italic> genes respectively were not completely assembled without internal stop codons. This is different from the
<italic>Mykrobe</italic> variant panel, which instead includes all nonsense mutations and indels of length 1 and 2 in those genes. Second, unlike
<italic>Mykrobe</italic>, ARIBA was not set to report resistance-conferring synonymous changes in gene sequences. We note that ARIBA code version 2.13.2 was run for this study, but using the built-in panel from version 2.13.3, which corresponds to the final
<italic>Mykrobe</italic> release panel. These versions only differ in that 2.13.2 has a variant panel corresponding to CP3.</p>
      <p><italic>Mykrobe</italic> and ARIBA explicitly have the fluoroquinolones ciprofloxacin, moxifloxacin, and ofloxacin in their variant catalogues. However, KvarQ, MTBseq and TB-Profiler simply call fluoroquinolone resistance without distinguishing between the three drugs. Therefore when reporting results, a fluoroquinolone call was taken to imply resistance to all three of ciprofloxacin, moxifloxacin, and ofloxacin.</p>
      <p>The benchmarking pipeline was implemented using Nextflow
<sup><xref rid="ref-48" ref-type="bibr">48</xref></sup>, Singularity
<sup><xref rid="ref-49" ref-type="bibr">49</xref></sup> and Python scripts, and is freely available under the MIT licence (code available here:
<ext-link ext-link-type="uri" xlink:href="https://github.com/iqbal-lab-org/tb-amr-benchmarking">https://github.com/iqbal-lab-org/tb-amr-benchmarking</ext-link> ; commit version used was 3e768c025ee54f154116dc6b2f7100a844081609). Running time and peak RAM usage of the tools was gathered using the output of the UNIX command time -v, using the fields “Elapsed (wall clock) time” and “Maximum resident set size”. The benchmarking pipeline outputs all data in a single JSON file (included as
<italic>Extended data</italic> file
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/pipeline_json_gz/7605509">pipeline.json.gz</ext-link>
<sup><xref rid="ref-50" ref-type="bibr">50</xref></sup>), which was then used to generate the results of this study, including all tables and figures, with the separate code repository (code here:
<ext-link ext-link-type="uri" xlink:href="https://github.com/iqbal-lab-org/tb-amr-benchmarking-paper/">https://github.com/iqbal-lab-org/tb-amr-benchmarking-paper/</ext-link> ; the version/commit used to generate this paper was 59e1b442dd04ec8e16656334ab9ea7d5cefaa871). Singularity containers of the two repositories are available at
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.10623410.v1">https://doi.org/10.6084/m9.figshare.10623410.v1</ext-link> and
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.10650515.v1">https://doi.org/10.6084/m9.figshare.10650515.v1</ext-link>.</p>
      <p><bold><italic>Oxford nanopore samples</italic></bold>.
<italic>Mykrobe</italic> was evaluated on five samples sequenced using both Illumina and Oxford Nanopore Technologies (ONT) MinION (ENA project ERP113349; sample and run accessions are in additional file
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/ont_tsv/7605443">ont.tsv</ext-link>). Raw nanopore fast5 files were basecalled with ONT Albacore (version 2.1.7) using the command</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;#000000">read_fast5_basecaller.py --flowcell FLO-MIN106 --kit SQK-LSK108 --recursive --barcoding \
 --input data_in --output data_out --output_format fastq</styled-content>
        </preformat>
      </p>
      <p>Porechop (version 0.2.3) was then used to trim adapters from the reads and to do additional basecalling. When demultiplexing is done by Porechop on the Albacore demultiplexed folders, Porechop will assign reads to a barcode where both Albacore and it agree. All reads where there is disagreement between the two are placed in the “unclassified” category. The resulting FASTQ files for each barcode were aligned to the
<italic>M. tuberculosis</italic> H37Rv reference (NC_000962.3
<sup><xref rid="ref-51" ref-type="bibr">51</xref></sup>) using minimap2
<sup><xref rid="ref-52" ref-type="bibr">52</xref></sup> with the
<monospace>map-ont</monospace> option. The resulting SAM file was sorted, indexed, and converted to FASTQ using SAMtools
<sup><xref rid="ref-53" ref-type="bibr">53</xref></sup>. When converting the SAM file to FASTQ, all unmapped reads (SAM flag
<monospace>0x4</monospace>) were filtered out. The final
<italic>Mykrobe</italic> panel from release 0.7.0 was run on the samples, separately on each of the Illumina and ONT reads. For ONT reads, the option
<monospace>--ont</monospace> was used to trigger the use of the dynamic genotype confidence cutoff, as described above.</p>
    </sec>
    <sec>
      <title>WHO regimen analysis</title>
      <p>Using previously published WHO guidelines for treatment of drug susceptible and drug resistant
<italic>M. tuberculosis</italic>, we established a set of rules to associate any given drug resistance profile to a recommended drug regimen (
<italic>Extended data</italic> file
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/who_regimens_tsv/7605476">who_regimens.tsv</ext-link>
<sup><xref rid="ref-54" ref-type="bibr">54</xref></sup> presents treatment rules)
<sup><xref rid="ref-24" ref-type="bibr">24</xref>,
<xref rid="ref-25" ref-type="bibr">25</xref></sup>. Regimens including multiple new drugs (such as bedaquiline and delamanid, where the basis of drug resistance is poorly understood and phenotyping is rare), were included in this model, but isolates were assumed to be susceptible, since phenotype data for these drugs was unavailable, and is not assumed to be available for the WHO protocols.
<sup><xref rid="ref-26" ref-type="bibr">26</xref></sup>.</p>
    </sec>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <sec>
      <title>Source data</title>
      <p>Figshare: sample_data.tsv.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7556789.v1">https://doi.org/10.6084/m9.figshare.7556789.v1</ext-link>
<sup><xref rid="ref-29" ref-type="bibr">29</xref></sup>.</p>
      <p>This project contains European Nucleotide Archive accession numbers for Illumina sequence data and associated metatdata.</p>
      <p>Figshare: ont.tsv.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605443.v1">https://doi.org/10.6084/m9.figshare.7605443.v1</ext-link>
<sup><xref rid="ref-37" ref-type="bibr">37</xref></sup>.</p>
      <p>This project contains European Nucleotide Archive accession numbers for ONT data, and matched illumina data, along with phenotypes and known resistance alleles.</p>
      <p>Figshare: panel.CP1.tsv.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605383.v1">https://doi.org/10.6084/m9.figshare.7605383.v1</ext-link>
<sup><xref rid="ref-30" ref-type="bibr">30</xref></sup>
</p>
      <p>Figshare: panel.CP1.json.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605416.v1">https://doi.org/10.6084/m9.figshare.7605416.v1</ext-link>
<sup><xref rid="ref-31" ref-type="bibr">31</xref></sup>.</p>
      <p>Figshare: panel.CP2.tsv.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605386.v1">https://doi.org/10.6084/m9.figshare.7605386.v1</ext-link>
<sup><xref rid="ref-55" ref-type="bibr">55</xref></sup>.</p>
      <p>Figshare: panel.CP2.json.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605422.v1">https://doi.org/10.6084/m9.figshare.7605422.v1</ext-link>
<sup><xref rid="ref-56" ref-type="bibr">56</xref></sup>.</p>
      <p>Figshare: panel.CP3.tsv.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605389.v1">https://doi.org/10.6084/m9.figshare.7605389.v1</ext-link>
<sup><xref rid="ref-57" ref-type="bibr">57</xref></sup>.</p>
      <p>Figshare: panel.CP3.json.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605425.v1">https://doi.org/10.6084/m9.figshare.7605425.v1</ext-link>
<sup><xref rid="ref-58" ref-type="bibr">58</xref></sup>.</p>
      <p>Figshare: panel.final.tsv.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605395.v1">https://doi.org/10.6084/m9.figshare.7605395.v1</ext-link>
<sup><xref rid="ref-35" ref-type="bibr">35</xref></sup>.</p>
      <p>Figshare: panel.final.json.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605428.v1">https://doi.org/10.6084/m9.figshare.7605428.v1</ext-link>
<sup><xref rid="ref-36" ref-type="bibr">36</xref></sup>.</p>
      <p>These files contain candidate panels 1, 2 and 3, and the final panel, in TSV and JSON file formats.</p>
      <p>Figshare: removed_variants.tsv.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605380.v1">https://doi.org/10.6084/m9.figshare.7605380.v1</ext-link>
<sup><xref rid="ref-32" ref-type="bibr">32</xref></sup>
</p>
      <p>This file contains the variants removed from candidate panels 1 and 2 during development of the final variant panel.</p>
      <p>Figshare: run_time_memory.tsv.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605437.v1">https://doi.org/10.6084/m9.figshare.7605437.v1</ext-link>
<sup><xref rid="ref-42" ref-type="bibr">42</xref></sup>.</p>
      <p>This file contains the run time and peak memory usage of each tool on each sample.</p>
    </sec>
    <sec>
      <title>Extended data</title>
      <p>Figshare: accuracy_stats.tsv.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605398.v1">https://doi.org/10.6084/m9.figshare.7605398.v1</ext-link>
<sup><xref rid="ref-33" ref-type="bibr">33</xref></sup>.</p>
      <p>This file contains the summary statistics for each tool and drug.</p>
      <p>Figshare: variant_counts.tsv.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605407.v1">https://doi.org/10.6084/m9.figshare.7605407.v1</ext-link>
<sup><xref rid="ref-34" ref-type="bibr">34</xref></sup>.</p>
      <p>This file contains the number of true- and false-positive calls for each tool and each reported variant.</p>
      <p>Figshare: run_time_boxplots.pdf.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605431.v1">https://doi.org/10.6084/m9.figshare.7605431.v1</ext-link>
<sup><xref rid="ref-40" ref-type="bibr">40</xref></sup>.</p>
      <p>Figshare: memory_boxplots.pdf.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605434.v1">https://doi.org/10.6084/m9.figshare.7605434.v1</ext-link>
<sup><xref rid="ref-41" ref-type="bibr">41</xref></sup>.</p>
      <p>These files contain boxplots summarising the run time of each tool, generated from the file run_time_and_memory.tsv.</p>
      <p>Figshare: who_regimen_counts.tsv.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7851689.v1">https://doi.org/10.6084/m9.figshare.7851689.v1</ext-link>
<sup><xref rid="ref-43" ref-type="bibr">43</xref></sup>.</p>
      <p>This file contains WHO regimen counts for each tool and dataset.</p>
      <p>Figshare: pipeline.json.gz.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605509.v1">https://doi.org/10.6084/m9.figshare.7605509.v1</ext-link>
<sup><xref rid="ref-50" ref-type="bibr">50</xref></sup>.</p>
      <p>This file contains the otuput of the benchmarking pipeline.</p>
      <p>Figshare: who_regimens.tsv.
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.7605476.v2">https://doi.org/10.6084/m9.figshare.7605476.v2</ext-link>
<sup><xref rid="ref-54" ref-type="bibr">54</xref></sup>.</p>
      <p>This file contains drug regimens defined by the WHO.</p>
      <p>Data are available under the terms of the
<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/publicdomain/zero/1.0/">Creative Commons Zero "No rights reserved" data waiver</ext-link> (CC0 1.0 Public domain dedication).</p>
    </sec>
  </sec>
  <sec>
    <title>Software availability</title>
    <p>Mykrobe is available at:
<ext-link ext-link-type="uri" xlink:href="http://mykrobe.com">http://mykrobe.com</ext-link>.</p>
    <p>Source code available from:
<ext-link ext-link-type="uri" xlink:href="https://github.com/Mykrobe-tools/mykrobe">https://github.com/Mykrobe-tools/mykrobe</ext-link>.</p>
    <p>Archived source code at time of publication:
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.3549926">https://doi.org/10.5281/zenodo.3549926</ext-link>
<sup><xref rid="ref-23" ref-type="bibr">23</xref></sup>.</p>
    <p>License:
<ext-link ext-link-type="uri" xlink:href="https://github.com/Mykrobe-tools/mykrobe/blob/master/LICENSE">MIT License</ext-link>.</p>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>We would like to thank Sarah Walker for critical reading of a draft of this paper.</p>
  </ack>
  <ref-list>
    <ref id="ref-1">
      <label>1</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bradley</surname><given-names>P</given-names></name><name><surname>Gordon</surname><given-names>NC</given-names></name><name><surname>Walker</surname><given-names>TM</given-names></name><etal/></person-group>:
<article-title>Rapid antibiotic-resistance predictions from genome sequence data for
<italic>Staphylococcus aureus</italic> and
<italic>Mycobacterium tuberculosis</italic>.</article-title><source><italic toggle="yes">Nat Commun.</italic></source><year>2015</year>;<volume>6</volume>(<issue>1</issue>):<fpage>10063</fpage>.
<pub-id pub-id-type="doi">10.1038/ncomms10063</pub-id><!--<pub-id pub-id-type="pmcid">4703848</pub-id>--><?supplied-pmid 26686880?><pub-id pub-id-type="pmid">26686880</pub-id></mixed-citation>
    </ref>
    <ref id="ref-2">
      <label>2</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bertels</surname><given-names>F</given-names></name><name><surname>Silander</surname><given-names>OK</given-names></name><name><surname>Pachkov</surname><given-names>M</given-names></name><etal/></person-group>:
<article-title>Automated Reconstruction of Whole-Genome Phylogenies from Short-Sequence Reads.</article-title><source><italic toggle="yes">Mol Biol Evol.</italic></source><year>2014</year>;<volume>31</volume>(<issue>5</issue>):<fpage>1077</fpage>–<lpage>1088</lpage>.
<pub-id pub-id-type="doi">10.1093/molbev/msu088</pub-id><!--<pub-id pub-id-type="pmcid">3995342</pub-id>--><?supplied-pmid 24600054?><pub-id pub-id-type="pmid">24600054</pub-id></mixed-citation>
    </ref>
    <ref id="ref-3">
      <label>3</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Walker</surname><given-names>TM</given-names></name><name><surname>Kohl</surname><given-names>TA</given-names></name><name><surname>Omar</surname><given-names>SV</given-names></name><etal/></person-group>:
<article-title>Whole-genome sequencing for prediction of Mycobacterium tuberculosis drug susceptibility and resistance: a retrospective cohort study.</article-title><source><italic toggle="yes">Lancet Infect Dis.</italic></source><year>2015</year>;<volume>15</volume>(<issue>10</issue>):<fpage>1193</fpage>–<lpage>1202</lpage>.
<pub-id pub-id-type="doi">10.1016/S1473-3099(15)00062-6</pub-id><!--<pub-id pub-id-type="pmcid">4579482</pub-id>--><?supplied-pmid 26116186?><pub-id pub-id-type="pmid">26116186</pub-id></mixed-citation>
    </ref>
    <ref id="ref-4">
      <label>4</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Votintseva</surname><given-names>AA</given-names></name><name><surname>Bradley</surname><given-names>P</given-names></name><name><surname>Pankhurst</surname><given-names>L</given-names></name><etal/></person-group>:
<article-title>Same-Day Diagnostic and Surveillance Data for Tuberculosis via Whole-Genome Sequencing of Direct Respiratory Samples.</article-title><source><italic toggle="yes">J Clin Microbiol.</italic></source><year>2017</year>;<volume>55</volume>(<issue>5</issue>):<fpage>1285</fpage>–<lpage>1298</lpage>.
<pub-id pub-id-type="doi">10.1128/JCM.02483-16</pub-id><!--<pub-id pub-id-type="pmcid">5405248</pub-id>--><?supplied-pmid 28275074?><pub-id pub-id-type="pmid">28275074</pub-id></mixed-citation>
    </ref>
    <ref id="ref-5">
      <label>5</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name><name><surname>Mather</surname><given-names>AE</given-names></name><name><surname>Sánchez-Busó</surname><given-names>L</given-names></name><etal/></person-group>:
<article-title>ARIBA: rapid antimicrobial resistance genotyping directly from sequencing reads.</article-title><source><italic toggle="yes">Microb Genom.</italic></source><year>2017</year>;<volume>3</volume>(<issue>10</issue>):<fpage>e000131</fpage>.
<pub-id pub-id-type="doi">10.1099/mgen.0.000131</pub-id><!--<pub-id pub-id-type="pmcid">5695208</pub-id>--><?supplied-pmid 29177089?><pub-id pub-id-type="pmid">29177089</pub-id></mixed-citation>
    </ref>
    <ref id="ref-6">
      <label>6</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yang</surname><given-names>Y</given-names></name><name><surname>Jiang</surname><given-names>X</given-names></name><name><surname>Chai</surname><given-names>B</given-names></name><etal/></person-group>:
<article-title>ARGs-OAP: online analysis pipeline for antibiotic resistance genes detection from metagenomic data using an integrated structured ARG-database.</article-title><source><italic toggle="yes">Bioinformatics.</italic></source><year>2016</year>;<volume>32</volume>(<issue>15</issue>):<fpage>2346</fpage>–<lpage>2351</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btw136</pub-id><?supplied-pmid 27153579?><pub-id pub-id-type="pmid">27153579</pub-id></mixed-citation>
    </ref>
    <ref id="ref-7">
      <label>7</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gupta</surname><given-names>SK</given-names></name><name><surname>Padmanabhan</surname><given-names>BR</given-names></name><name><surname>Diene</surname><given-names>SM</given-names></name><etal/></person-group>:
<article-title>ARG-ANNOT, a new bioinformatic tool to discover antibiotic resistance genes in bacterial genomes.</article-title><source><italic toggle="yes">Antimicrob Agents Chemother.</italic></source><year>2014</year>;<volume>58</volume>(<issue>1</issue>):<fpage>212</fpage>–<lpage>220</lpage>.
<pub-id pub-id-type="doi">10.1128/AAC.01310-13</pub-id><!--<pub-id pub-id-type="pmcid">3910750</pub-id>--><?supplied-pmid 24145532?><pub-id pub-id-type="pmid">24145532</pub-id></mixed-citation>
    </ref>
    <ref id="ref-8">
      <label>8</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Iwai</surname><given-names>H</given-names></name><name><surname>Kato-Miyazawa</surname><given-names>M</given-names></name><name><surname>Kirikae</surname><given-names>T</given-names></name><etal/></person-group>:
<article-title>CASTB (the comprehensive analysis server for the
<italic>Mycobacterium tuberculosis</italic> complex): A publicly accessible web server for epidemiological analyses, drug-resistance prediction and phylogenetic comparison of clinical isolates.</article-title><source><italic toggle="yes">Tuberculosis (Edinb).</italic></source><year>2015</year>;<volume>95</volume>(<issue>6</issue>):<fpage>843</fpage>–<lpage>844</lpage>.
<pub-id pub-id-type="doi">10.1016/j.tube.2015.09.002</pub-id><?supplied-pmid 26542225?><pub-id pub-id-type="pmid">26542225</pub-id></mixed-citation>
    </ref>
    <ref id="ref-9">
      <label>9</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Steiner</surname><given-names>A</given-names></name><name><surname>Stucki</surname><given-names>D</given-names></name><name><surname>Coscolla</surname><given-names>M</given-names></name><etal/></person-group>:
<article-title>KvarQ: targeted and direct variant calling from fastq reads of bacterial genomes.</article-title><source><italic toggle="yes">BMC Genomics.</italic></source><year>2014</year>;<volume>15</volume>(<issue>1</issue>):<fpage>881</fpage>.
<pub-id pub-id-type="doi">10.1186/1471-2164-15-881</pub-id><!--<pub-id pub-id-type="pmcid">PMC4197298</pub-id>--><?supplied-pmid 25297886?><pub-id pub-id-type="pmid">25297886</pub-id></mixed-citation>
    </ref>
    <ref id="ref-10">
      <label>10</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kohl</surname><given-names>TA</given-names></name><name><surname>Utpatel</surname><given-names>C</given-names></name><name><surname>Schleusener</surname><given-names>V</given-names></name><etal/></person-group>:
<article-title>MTBseq: a comprehensive pipeline for whole genome sequence analysis of
<italic>Mycobacterium tuberculosis</italic> complex isolates.</article-title><source><italic toggle="yes">PeerJ.</italic></source><year>2018</year>;<volume>6</volume>:<fpage>e5895</fpage>.
<pub-id pub-id-type="doi">10.7717/peerj.5895</pub-id><!--<pub-id pub-id-type="pmcid">6238766</pub-id>--><?supplied-pmid 30479891?><pub-id pub-id-type="pmid">30479891</pub-id></mixed-citation>
    </ref>
    <ref id="ref-11">
      <label>11</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Feuerriegel</surname><given-names>S</given-names></name><name><surname>Schleusener</surname><given-names>V</given-names></name><name><surname>Beckert</surname><given-names>P</given-names></name><etal/></person-group>:
<article-title>PhyResSE: a Web Tool Delineating
<italic>Mycobacterium tuberculosis</italic> Antibiotic Resistance and Lineage from Whole-Genome Sequencing Data.</article-title><source><italic toggle="yes">J Clin Microbiol.</italic></source><year>2015</year>;<volume>53</volume>(<issue>6</issue>):<fpage>1908</fpage>–<lpage>1914</lpage>.
<pub-id pub-id-type="doi">10.1128/JCM.00025-15</pub-id><!--<pub-id pub-id-type="pmcid">4432036</pub-id>--><?supplied-pmid 25854485?><pub-id pub-id-type="pmid">25854485</pub-id></mixed-citation>
    </ref>
    <ref id="ref-12">
      <label>12</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Davis</surname><given-names>JJ</given-names></name><name><surname>Boisvert</surname><given-names>S</given-names></name><name><surname>Brettin</surname><given-names>T</given-names></name><etal/></person-group>:
<article-title>Antimicrobial Resistance Prediction in PATRIC and RAST.</article-title><source><italic toggle="yes">Sci Rep.</italic></source><year>2016</year>;<volume>6</volume>(<issue>1</issue>):<fpage>27930</fpage>.
<pub-id pub-id-type="doi">10.1038/srep27930</pub-id><!--<pub-id pub-id-type="pmcid">4906388</pub-id>--><?supplied-pmid 27297683?><pub-id pub-id-type="pmid">27297683</pub-id></mixed-citation>
    </ref>
    <ref id="ref-13">
      <label>13</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zankari</surname><given-names>E</given-names></name><name><surname>Hasman</surname><given-names>H</given-names></name><name><surname>Cosentino</surname><given-names>S</given-names></name><etal/></person-group>:
<article-title>Identification of acquired antimicrobial resistance genes.</article-title><source><italic toggle="yes">J Antimicrob Chemother.</italic></source><year>2012</year>;<volume>67</volume>(<issue>11</issue>):<fpage>2640</fpage>–<lpage>2644</lpage>.
<pub-id pub-id-type="doi">10.1093/jac/dks261</pub-id><!--<pub-id pub-id-type="pmcid">3468078</pub-id>--><?supplied-pmid 22782487?><pub-id pub-id-type="pmid">22782487</pub-id></mixed-citation>
    </ref>
    <ref id="ref-14">
      <label>14</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McArthur</surname><given-names>AG</given-names></name><name><surname>Waglechner</surname><given-names>N</given-names></name><name><surname>Nizam</surname><given-names>F</given-names></name><etal/></person-group>:
<article-title>The comprehensive antibiotic resistance database.</article-title><source><italic toggle="yes">Antimicrob Agents Chemother.</italic></source><year>2013</year>;<volume>57</volume>(<issue>7</issue>):<fpage>3348</fpage>–<lpage>3357</lpage>.
<pub-id pub-id-type="doi">10.1128/AAC.00419-13</pub-id><!--<pub-id pub-id-type="pmcid">3697360</pub-id>--><?supplied-pmid 23650175?><pub-id pub-id-type="pmid">23650175</pub-id></mixed-citation>
    </ref>
    <ref id="ref-15">
      <label>15</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Inouye</surname><given-names>M</given-names></name><name><surname>Dashnow</surname><given-names>H</given-names></name><name><surname>Raven</surname><given-names>LA</given-names></name><etal/></person-group>:
<article-title>SRST2: Rapid genomic surveillance for public health and hospital microbiology labs.</article-title><source><italic toggle="yes">Genome Med.</italic></source><year>2014</year>;<volume>6</volume>(<issue>11</issue>):<fpage>90</fpage>.
<pub-id pub-id-type="doi">10.1186/s13073-014-0090-6</pub-id><!--<pub-id pub-id-type="pmcid">4237778</pub-id>--><?supplied-pmid 25422674?><pub-id pub-id-type="pmid">25422674</pub-id></mixed-citation>
    </ref>
    <ref id="ref-16">
      <label>16</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>de Man</surname><given-names>TJ</given-names></name><name><surname>Limbago</surname><given-names>BM</given-names></name></person-group>:
<article-title>SSTAR, a Stand-Alone Easy-To-Use Antimicrobial Resistance Gene Predictor.</article-title><source><italic toggle="yes">mSphere.</italic></source><year>2016</year>;<volume>1</volume>(<issue>1</issue>): pii: e00050-15.
<pub-id pub-id-type="doi">10.1128/mSphere.00050-15</pub-id><!--<pub-id pub-id-type="pmcid">4863618</pub-id>--><?supplied-pmid 27303709?><pub-id pub-id-type="pmid">27303709</pub-id></mixed-citation>
    </ref>
    <ref id="ref-17">
      <label>17</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Coll</surname><given-names>F</given-names></name><name><surname>McNerney</surname><given-names>R</given-names></name><name><surname>Preston</surname><given-names>MD</given-names></name><etal/></person-group>:
<article-title>Rapid determination of anti-tuberculosis drug resistance from whole-genome sequences.</article-title><source><italic toggle="yes">Genome Med.</italic></source><year>2015</year>;<volume>7</volume>(<issue>1</issue>):<fpage>51</fpage>.
<pub-id pub-id-type="doi">10.1186/s13073-015-0164-0</pub-id><!--<pub-id pub-id-type="pmcid">4446134</pub-id>--><?supplied-pmid 26019726?><pub-id pub-id-type="pmid">26019726</pub-id></mixed-citation>
    </ref>
    <ref id="ref-18">
      <label>18</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schleusener</surname><given-names>V</given-names></name><name><surname>Köser</surname><given-names>CU</given-names></name><name><surname>Beckert</surname><given-names>P</given-names></name><etal/></person-group>:
<article-title><italic>Mycobacterium tuberculosis</italic> resistance prediction and lineage classification from genome sequencing: comparison of automated analysis tools.</article-title><source><italic toggle="yes">Sci Rep.</italic></source><year>2017</year>;<volume>7</volume>:<fpage>46327</fpage>.
<pub-id pub-id-type="doi">10.1038/srep46327</pub-id><?supplied-pmid 28425484?><pub-id pub-id-type="pmid">28425484</pub-id></mixed-citation>
    </ref>
    <ref id="ref-19">
      <label>19</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mason</surname><given-names>A</given-names></name><name><surname>Foster</surname><given-names>D</given-names></name><name><surname>Bradley</surname><given-names>P</given-names></name><etal/></person-group>:
<article-title>Accuracy of Different Bioinformatics Methods in Detecting Antibiotic Resistance and Virulence Factors from
<italic>Staphylococcus aureus</italic> Whole-Genome Sequences.</article-title><source><italic toggle="yes">J Clin Microbiol.</italic></source><year>2018</year>;<volume>56</volume>(<issue>9</issue>): pii: e01815-17.
<pub-id pub-id-type="doi">10.1128/JCM.01815-17</pub-id><!--<pub-id pub-id-type="pmcid">6113501</pub-id>--><?supplied-pmid 29925638?><pub-id pub-id-type="pmid">29925638</pub-id></mixed-citation>
    </ref>
    <ref id="ref-20">
      <label>20</label>
      <mixed-citation publication-type="journal"><collab>The CRyPTIC Consortium and the 100,000 Genomes Project.</collab><article-title>Prediction of Susceptibility to First-Line Tuberculosis Drugs by DNA Sequencing.</article-title><source><italic toggle="yes">N Engl J Med</italic></source><year>2018</year>;<volume>379</volume>(<issue>15</issue>):<fpage>1403</fpage>–<lpage>1415</lpage>.
<pub-id pub-id-type="doi">10.1056/NEJMoa1800474</pub-id><pub-id pub-id-type="pmid">30280646</pub-id></mixed-citation>
    </ref>
    <ref id="ref-21">
      <label>21</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Miotto</surname><given-names>P</given-names></name><name><surname>Tessema</surname><given-names>B</given-names></name><name><surname>Tagliani</surname><given-names>E</given-names></name><etal/></person-group>:
<article-title>A standardised method for interpreting the association between mutations and phenotypic drug resistance in
<italic>Mycobacterium tuberculosis</italic>.</article-title><source><italic toggle="yes">Eur Respir J.</italic></source><year>2017</year>;<volume>50</volume>(<issue>6</issue>): pii: 1701354.
<pub-id pub-id-type="doi">10.1183/13993003.01354-2017</pub-id><!--<pub-id pub-id-type="pmcid">5898944</pub-id>--><?supplied-pmid 29284687?><pub-id pub-id-type="pmid">29284687</pub-id></mixed-citation>
    </ref>
    <ref id="ref-22">
      <label>22</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yadon</surname><given-names>AN</given-names></name><name><surname>Maharaj</surname><given-names>K</given-names></name><name><surname>Adamson</surname><given-names>JH</given-names></name><etal/></person-group>:
<article-title>A comprehensive characterization of pnca polymorphisms that confer resistance to pyrazinamide.</article-title><source><italic toggle="yes">Nat Commun.</italic></source><year>2017</year>;<volume>8</volume>(<issue>1</issue>):<fpage>588</fpage>. Article.
<pub-id pub-id-type="doi">10.1038/s41467-017-00721-2</pub-id><!--<pub-id pub-id-type="pmcid">5605632</pub-id>--><?supplied-pmid 28928454?><pub-id pub-id-type="pmid">28928454</pub-id></mixed-citation>
    </ref>
    <ref id="ref-23">
      <label>23</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>lab</surname><given-names>I</given-names></name></person-group>:
<article-title>Mykrobe-tools/mykrobe: v0.7.0</article-title>.<year>November 2019</year><pub-id pub-id-type="doi">10.5281/zenodo.3549926</pub-id></mixed-citation>
    </ref>
    <ref id="ref-24">
      <label>24</label>
      <mixed-citation publication-type="journal"><collab>World Health Organisation: </collab><article-title>Who treatment guidelines for drug-resistant tuberculosis</article-title>.<year>2016</year><ext-link ext-link-type="uri" xlink:href="https://apps.who.int/iris/bitstream/handle/10665/250125/9789241549639-webannexes-eng.pdf">Reference Source</ext-link></mixed-citation>
    </ref>
    <ref id="ref-25">
      <label>25</label>
      <mixed-citation publication-type="journal"><collab>World Health Organisation: </collab><article-title>Guidelines for treatment of drug-susceptible tuberculosis and patient care (2017 update)</article-title>.<year>2017</year><ext-link ext-link-type="uri" xlink:href="https://apps.who.int/iris/bitstream/handle/10665/255052/9789241550000-eng.pdf">Reference Source</ext-link></mixed-citation>
    </ref>
    <ref id="ref-26">
      <label>26</label>
      <mixed-citation publication-type="journal"><collab>World Health Organisation: </collab><article-title>Who treatment guidelines for multidrug- and rifampicin-resistant tuberculosis - 2018 update</article-title>.<year>2018</year><ext-link ext-link-type="uri" xlink:href="https://www.who.int/tb/areas-of-work/drug-resistant-tb/guideline-update2018/en/">Reference Source</ext-link></mixed-citation>
    </ref>
    <ref id="ref-27">
      <label>27</label>
      <mixed-citation publication-type="journal"><collab>World Health Organisation: </collab><article-title>Who treatment guidelines for isoniazid-resistant tuberculosis: Supplement to the who treatment guidelines for drug-resistant tuberculosis</article-title>.<year>2018</year>.
<?supplied-pmid 30285343?><pub-id pub-id-type="pmid">30285343</pub-id></mixed-citation>
    </ref>
    <ref id="ref-28">
      <label>28</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Quan</surname><given-names>TP</given-names></name><name><surname>Bawa</surname><given-names>Z</given-names></name><name><surname>Foster</surname><given-names>D</given-names></name><etal/></person-group>:
<article-title>Evaluation of Whole-Genome Sequencing for Mycobacterial Species Identification and Drug Susceptibility Testing in a Clinical Setting: a Large-Scale Prospective Assessment of Performance against Line Probe Assays and Phenotyping.</article-title><source><italic toggle="yes">J Clin Microbiol.</italic></source><year>2018</year>;<volume>56</volume>(<issue>2</issue>):<fpage>pii: e01480</fpage>–<lpage>17</lpage>.
<pub-id pub-id-type="doi">10.1128/JCM.01480-17</pub-id><!--<pub-id pub-id-type="pmcid">5786738</pub-id>--><?supplied-pmid 29167290?><pub-id pub-id-type="pmid">29167290</pub-id></mixed-citation>
    </ref>
    <ref id="ref-29">
      <label>29</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>sample_data.tsv</article-title>.<year> Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7556789.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-30">
      <label>30</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>panel.cp1.tsv</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605383.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-31">
      <label>31</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>panel.cp1.json</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605416.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-32">
      <label>32</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>removed_variants.tsv</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare7605380.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-33">
      <label>33</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>accuracy_stats.tsv</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605398.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-34">
      <label>34</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>variant_counts.tsv</article-title>.<year> Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605407.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-35">
      <label>35</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>panel.final.tsv</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605395.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-36">
      <label>36</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>panel.final.json</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605428.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-37">
      <label>37</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>ont.tsv</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605443.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-38">
      <label>38</label>
      <mixed-citation publication-type="journal"><collab>World Health Organisation: </collab><article-title>Technical manual for drug susceptibility testing of medicines used in the treatment of tuberculosis</article-title>.<year>2018</year><ext-link ext-link-type="uri" xlink:href="http://apps.who.int/medicinedocs/documents/s23565en/s23565en.pdf">Reference Source</ext-link></mixed-citation>
    </ref>
    <ref id="ref-39">
      <label>39</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wyllie</surname><given-names>David</given-names></name><name><surname>Trien</surname><given-names>Do</given-names></name><name><surname>Myers</surname><given-names>Richard</given-names></name><etal/></person-group>:
<article-title><italic>M. tuberculosis</italic> microvariation is common and is associated with transmission: analysis of three years prospective universal sequencing in england.</article-title><source><italic toggle="yes">Biorxiv.</italic></source><year>2019</year><pub-id pub-id-type="doi">10.1101/681502</pub-id></mixed-citation>
    </ref>
    <ref id="ref-40">
      <label>40</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>run_time_boxplots.pdf</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605431.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-41">
      <label>41</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>memory_boxplots.pdf</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605434.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-42">
      <label>42</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>run_time_memory.tsv</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605437.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-43">
      <label>43</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>who_regimen_counts.tsv</article-title>.<year> Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7851689.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-44">
      <label>44</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Meehan</surname><given-names>CJ</given-names></name><name><surname>Goig</surname><given-names>GA</given-names></name><name><surname>Kohl</surname><given-names>TA</given-names></name><etal/></person-group>:
<article-title>Whole genome sequencing of
<italic>Mycobacterium tuberculosis</italic>: current standards and open issues.</article-title><source><italic toggle="yes">Nat Rev Microbiol.</italic></source><year>2019</year>;<volume>17</volume>(<issue>9</issue>):<fpage>533</fpage>–<lpage>545</lpage>.
<pub-id pub-id-type="doi">10.1038/s41579-019-0214-5</pub-id><?supplied-pmid 31209399?><pub-id pub-id-type="pmid">31209399</pub-id></mixed-citation>
    </ref>
    <ref id="ref-45">
      <label>45</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Piersimoni</surname><given-names>C</given-names></name><name><surname>Mustazzolu</surname><given-names>A</given-names></name><name><surname>Giannoni</surname><given-names>F</given-names></name><etal/></person-group>:
<article-title>Prevention of false resistance results obtained in testing the susceptibility of
<italic>mycobacterium tuberculosis</italic> to pyrazinamide with the bactec mgit 960 system using a reduced inoculum.</article-title><source><italic toggle="yes">J Clin Microbiol.</italic></source><year>2013</year>;<volume>51</volume>(<issue>1</issue>):<fpage>291</fpage>–<lpage>4</lpage>.
<pub-id pub-id-type="doi">10.1128/JCM.01838-12</pub-id><!--<pub-id pub-id-type="pmcid">3536208</pub-id>--><?supplied-pmid 23100351?><pub-id pub-id-type="pmid">23100351</pub-id></mixed-citation>
    </ref>
    <ref id="ref-46">
      <label>46</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hoffner</surname><given-names>S</given-names></name><name><surname>Angeby</surname><given-names>K</given-names></name><name><surname>Sturegård</surname><given-names>E</given-names></name><etal/></person-group>:
<article-title>Proficiency of drug susceptibility testing of
<italic>Mycobacterium tuberculosis</italic> against pyrazinamide: the Swedish experience.</article-title><source><italic toggle="yes">Int J Tuberc Lung Dis.</italic></source><year>2013</year>;<volume>17</volume>(<issue>11</issue>):<fpage>1486</fpage>–<lpage>90</lpage>.
<pub-id pub-id-type="doi">10.5588/ijtld.13.0195</pub-id><?supplied-pmid 24125455?><pub-id pub-id-type="pmid">24125455</pub-id></mixed-citation>
    </ref>
    <ref id="ref-47">
      <label>47</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stucki</surname><given-names>D</given-names></name><name><surname>Malla</surname><given-names>B</given-names></name><name><surname>Hostettler</surname><given-names>S</given-names></name><etal/></person-group>:
<article-title>Two new rapid SNP-typing methods for classifying
<italic>Mycobacterium tuberculosis</italic> complex into the main phylogenetic lineages.</article-title><source><italic toggle="yes">PLoS One.</italic></source><year>2012</year>;<volume>7</volume>(<issue>7</issue>):<fpage>e41253</fpage>.
<pub-id pub-id-type="doi">10.1371/journal.pone.0041253</pub-id><!--<pub-id pub-id-type="pmcid">3401130</pub-id>--><?supplied-pmid 22911768?><pub-id pub-id-type="pmid">22911768</pub-id></mixed-citation>
    </ref>
    <ref id="ref-48">
      <label>48</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Di Tommaso</surname><given-names>P</given-names></name><name><surname>Chatzou</surname><given-names>M</given-names></name><name><surname>Floden</surname><given-names>EW</given-names></name><etal/></person-group>:
<article-title>Nextflow enables reproducible computational workflows.</article-title><source><italic toggle="yes">Nat Biotechnol.</italic></source><year>2017</year>;<volume>35</volume>(<issue>4</issue>):<fpage>316</fpage>–<lpage>319</lpage>.
<pub-id pub-id-type="doi">10.1038/nbt.3820</pub-id><?supplied-pmid 28398311?><pub-id pub-id-type="pmid">28398311</pub-id></mixed-citation>
    </ref>
    <ref id="ref-49">
      <label>49</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kurtzer</surname><given-names>GM</given-names></name><name><surname>Sochat</surname><given-names>V</given-names></name><name><surname>Bauer</surname><given-names>MW</given-names></name></person-group>:
<article-title>Singularity: Scientific containers for mobility of compute.</article-title><source><italic toggle="yes">PLoS One.</italic></source><year>2017</year>;<volume>12</volume>(<issue>5</issue>):<fpage>e0177459</fpage>.
<pub-id pub-id-type="doi">10.1371/journal.pone.0177459</pub-id><!--<pub-id pub-id-type="pmcid">5426675</pub-id>--><?supplied-pmid 28494014?><pub-id pub-id-type="pmid">28494014</pub-id></mixed-citation>
    </ref>
    <ref id="ref-50">
      <label>50</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>pipeline.json.gz</article-title>.<year>Nov 2019</year>.</mixed-citation>
    </ref>
    <ref id="ref-51">
      <label>51</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cole</surname><given-names>ST</given-names></name><name><surname>Brosch</surname><given-names>R</given-names></name><name><surname>Parkhill</surname><given-names>J</given-names></name><etal/></person-group>:
<article-title>Deciphering the biology of
<italic>Mycobacterium tuberculosis</italic> from the complete genome sequence.</article-title><source><italic toggle="yes">Nature.</italic></source><year>1998</year>;<volume>393</volume>(<issue>6685</issue>):<fpage>537</fpage>–<lpage>544</lpage>.
<pub-id pub-id-type="doi">10.1038/31159</pub-id><?supplied-pmid 9634230?><pub-id pub-id-type="pmid">9634230</pub-id></mixed-citation>
    </ref>
    <ref id="ref-52">
      <label>52</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>H</given-names></name></person-group>:
<article-title>Minimap2: pairwise alignment for nucleotide sequences.</article-title><source><italic toggle="yes">Bioinformatics.</italic></source><year>2018</year>;<volume>34</volume>(<issue>18</issue>):<fpage>3094</fpage>–<lpage>3100</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/bty191</pub-id><!--<pub-id pub-id-type="pmcid">6137996</pub-id>--><?supplied-pmid 29750242?><pub-id pub-id-type="pmid">29750242</pub-id></mixed-citation>
    </ref>
    <ref id="ref-53">
      <label>53</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>H</given-names></name><name><surname>Handsaker</surname><given-names>B</given-names></name><name><surname>Wysoker</surname><given-names>A</given-names></name><etal/></person-group>:
<article-title>The Sequence Alignment/Map format and SAMtools.</article-title><source><italic toggle="yes">Bioinformatics.</italic></source><year>2009</year>;<volume>25</volume>(<issue>16</issue>):<fpage>2078</fpage>–<lpage>2079</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btp352</pub-id><!--<pub-id pub-id-type="pmcid">2723002</pub-id>--><?supplied-pmid 19505943?><pub-id pub-id-type="pmid">19505943</pub-id></mixed-citation>
    </ref>
    <ref id="ref-54">
      <label>54</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>who_regimens.tsv</article-title>.<year> Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605476.v2</pub-id></mixed-citation>
    </ref>
    <ref id="ref-55">
      <label>55</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>panel.cp2.tsv</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605386.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-56">
      <label>56</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>panel.cp2.json</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605422.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-57">
      <label>57</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>panel.cp3.tsv</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605389.v1</pub-id></mixed-citation>
    </ref>
    <ref id="ref-58">
      <label>58</label>
      <mixed-citation publication-type="data"><person-group person-group-type="author"><name><surname>Hunt</surname><given-names>M</given-names></name></person-group>:
<article-title>panel.cp3.json</article-title>.<year>Nov 2019</year><pub-id pub-id-type="doi">10.6084/m9.figshare.7605425.v1</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<sub-article id="report37677" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.21956/wellcomeopenres.17090.r37677</article-id>
    <title-group>
      <article-title>Reviewer response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Meehan</surname>
          <given-names>Conor J.</given-names>
        </name>
        <xref ref-type="aff" rid="r37677a1">1</xref>
        <role>Referee</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-0724-8343</contrib-id>
      </contrib>
      <aff id="r37677a1"><label>1</label>School of Chemistry and Biosciences, University of Bradford, Bradford, UK</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>5</day>
      <month>2</month>
      <year>2020</year>
    </pub-date>
    <permissions>
      <copyright-statement>Copyright: © 2020 Meehan CJ</copyright-statement>
      <copyright-year>2020</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access peer review report distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <related-article related-article-type="peer-reviewed-article" id="d35e7870" ext-link-type="doi" xlink:href="10.12688/wellcomeopenres.15603.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>The article by Hunt
<italic>et al.</italic> outlines the substantial improvements and validation of the new version of Mykrobe. The previous version was quite widely used and I think that the data and methods presented here will benefit the TB community greatly.</p>
    <p> I do not have any comments to be addressed outside of what the other two reviewers already raised. I think readability needs improving, including outlining the TB drug resistance problem more prominently in the introduction, clearly separating what was results from the previous version and what is new here and ensuring the methods, including dataset selection, are in the methods section as appropriate.</p>
    <p>I confirm that I have read this submission and believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
<sub-article id="report37245" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.21956/wellcomeopenres.17090.r37245</article-id>
    <title-group>
      <article-title>Reviewer response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>MacCannell</surname>
          <given-names>Duncan</given-names>
        </name>
        <xref ref-type="aff" rid="r37245a1">1</xref>
        <role>Referee</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-8869-1840</contrib-id>
      </contrib>
      <aff id="r37245a1"><label>1</label>Office of Advanced Molecular Detection, National Center for Emerging and Zoonotic Infectious Diseases, Centers for Disease Control and Prevention, Atlanta, GA, USA</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>29</day>
      <month>1</month>
      <year>2020</year>
    </pub-date>
    <permissions>
      <copyright-statement>Copyright: © 2020 MacCannell D</copyright-statement>
      <copyright-year>2020</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access peer review report distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <related-article related-article-type="peer-reviewed-article" id="d35e7936" ext-link-type="doi" xlink:href="10.12688/wellcomeopenres.15603.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve-with-reservations</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>Thank you for the opportunity to review this manuscript from Hunt and colleagues on the development and validation of genotypic antibiotic resistance prediction for Mycobacterium tuberculosis using the open source Mykrobe platform. Building upon the existing Mykrobe Predictor platform, Mykrobe includes a number of important improvements for mycobacteriological analysis, including significant refactoring of the codebase, reengineering and algorithmic improvements, an updated catalog of functional susceptibility data and corresponding genotypic predictors, expansion to include new sequencing platforms, such as the ONT MinION, and renewed emphasis of user-centric and user-configurable design.</p>
    <p> Major comments:
<list list-type="bullet"><list-item><p>PAGE 5: The geographic breakdown of training, prospective and global sample subsets seems disproportionate. Presumably, this is due to the training and prospective datasets from specific sites having more reliable or complete data and functional susceptibility information? The multi-phased development and validation of the resistance prediction panel is otherwise well-described (text and Figure 2) and adequate, but the geographic sampling bias should at the very least be explained. PPV and NPV performance metrics were all impressive, with low overall error rate; critical discrepancies were adequately addressed or explained. </p></list-item></list> Without delving into the primary data, the dataset tables on Page 10 using the final Mykrobe panel would seem to suggest significant underlying differences in PPV/NPV/VME/ME between datasets.</p>
    <p> This could be an issue if the characteristics of the three test populations used to develop and refine the final Mykrobe panel are not relatively homogenous.</p>
    <p> Minor comments:
<list list-type="order"><list-item><p>PAGE 9: Interestingly (Figure 4), ciprofloxacin resistance false positivity seems to have increased slightly with Mykrobe-CP3, without corresponding shifts in the prediction of other fluoroquinolones.  This is noted on Page 9, which implicates D94A in gyrA, and discusses adjustments that were made to CP3 to accomodate. While I'm not by any means an expert in the specific mechanisms of fluoroquinolone resistance in TB, presumably Mfx and Ofx should also show some degree of impact? Seems odd.</p></list-item><list-item><p>PAGE 11-12: Assessing the impact of minor alleles and unknown mutations was a welcome addition to this report. Thank you.</p></list-item><list-item><p>PAGE 13-14: Comparative benchmarking with other software, using default databases and settings. Mykrobe performance appears to be most on-par with ARIBA (Page 13), albeit with significantly higher peak RAM utilization (Page 15). Summary tables from Page 13 and graphical breakdowns in Figure 5 may be slightly redundant and some of this could likely be condensed or moved to a supplemental.</p></list-item><list-item><p>The flow diagram on Page 16 is particularly useful in teasing apart the genotypic prediction and proposed drug regimen data. These data clearly underscore the difficulty in consistently assigning regimens from TB genotype data. (For example -- last paragraph, page 16: unless I'm misreading, Mykrobe genotype predictions missed a full 1/3 of calls for MDR-TB regimen). Even so, the overall performance (Table 7) shows a marked overall improvement over existing tools and previous iterations.</p></list-item></list> Overall - Very well done and an enjoyable manuscript to read, with clear improvements to the performance and execution of Mykrobe. Many thanks for allowing me to review.</p>
    <p>I confirm that I have read this submission and believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard, however I have significant reservations, as outlined above.</p>
  </body>
</sub-article>
<sub-article id="report37246" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.21956/wellcomeopenres.17090.r37246</article-id>
    <title-group>
      <article-title>Reviewer response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Colman</surname>
          <given-names>Rebecca E.</given-names>
        </name>
        <xref ref-type="aff" rid="r37246a1">1</xref>
        <xref ref-type="aff" rid="r37246a2">2</xref>
        <role>Referee</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-6854-2100</contrib-id>
      </contrib>
      <aff id="r37246a1"><label>1</label>Foundation for Innovative New Diagnostics (FIND), Geneva, Switzerland</aff>
      <aff id="r37246a2"><label>2</label>University of California, San Diego, CA, USA</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>19</day>
      <month>12</month>
      <year>2019</year>
    </pub-date>
    <permissions>
      <copyright-statement>Copyright: © 2019 Colman RE</copyright-statement>
      <copyright-year>2019</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access peer review report distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <related-article related-article-type="peer-reviewed-article" id="d35e8033" ext-link-type="doi" xlink:href="10.12688/wellcomeopenres.15603.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>Hunt and co-authors describe the improvements and testing of an antibiotic resistance prediction tool for
<italic>Mycobacterium tuberculosis</italic> using NGS data. The authors clearly describe the improvements on the original
<italic>Mykrobe predictor</italic> software resulting in this new version,
<italic>Mykrobe.</italic> Improvements being: mutation catalog update, ability to use other mutation catalogs, improved identification of non-tuberculosis Mycobacterial species, and ability to use tool with Oxford Nanopore data. The software is freely available at mykrobe.com and has source code and documentation on Github. Additionally the data presented in the paper can be found on figshare. The development of the mutation panels and data interpretation is demonstrated on three datasets: training, prospective, and global set. The benchmarking against four other prediction tools is useful to show improvements and performance. Although only five Oxford Nanopore samples were used, they did show agreement in drug resistant variant calls. The case study of using
<italic>Mykrobe</italic> predictions to guide personalized regimens is an extremely useful comparison and illustrates valuable clinical application of this type of tool.</p>
    <p> The manuscript is scientifically sound without further changes. However, the following minor comments should be considered to increase the readability of the manuscript.</p>
    <p> The paper is very lengthy and full of information, however it is hard to read and digest all the information contained within the manuscript. The abstract is concise and clear it would be beneficial for structure and format to be mirrored throughout the manuscript. For example, the introduction contains a lot of text dedicated to explaining the first version,
<italic>Mykrobe predictor,</italic> and does not put the tool in context of tuberculosis until the fourth paragraph. Perhaps clearly outlining the need for this tool and then summarize how the original version has been improved will streamline the introduction and increase the impact of the work, as right now some of the benefits of the software are buried in a large amount of text.  </p>
    <p> Throughout the results section, there are portions that make more sense in the methods section, and then present on the results for only this study in the results section. For example, in the results species identification section, it is unclear which are the results for this manuscript versus previous findings. Additionally in the minor alleles prediction section, the rationale behind the work should be moved to the methods.</p>
    <p> In the results section, the table 1 does not include sensitivity/specificity as stated in the body. The data is there to calculate these values but the specific sensitivity and specificity values are not included. Additionally, the sensitivity and specificity stated in the abstract are not found elsewhere in the paper – they can be calculated with data given, but would be beneficial to have in results.</p>
    <p> The methods section should be organized to mirror the order of the results section as this would enable readers to quickly reference methods when reading the results section. In the methods variant panel development section, it is unclear what data sets CP2 and CP3 are run on to generate the next panels. This is clear in the figure 2, but text was unclear.</p>
    <p>I confirm that I have read this submission and believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
