<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?subarticle report44297?>
<?properties open_access?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Wellcome Open Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">Wellcome Open Res</journal-id>
    <journal-title-group>
      <journal-title>Wellcome Open Research</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2398-502X</issn>
    <publisher>
      <publisher-name>F1000 Research Limited</publisher-name>
      <publisher-loc>London, UK</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8287537</article-id>
    <article-id pub-id-type="doi">10.12688/wellcomeopenres.16791.1</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software Tool Article</subject>
      </subj-group>
      <subj-group>
        <subject>Articles</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Ultraplex: A rapid, flexible, all-in-one fastq demultiplexer</article-title>
      <fn-group content-type="pub-status">
        <fn>
          <p>[version 1; peer review: 2 approved]</p>
        </fn>
      </fn-group>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Wilkins</surname>
          <given-names>Oscar G</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Data Curation</role>
        <role content-type="http://credit.casrai.org/">Formal Analysis</role>
        <role content-type="http://credit.casrai.org/">Investigation</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Software</role>
        <role content-type="http://credit.casrai.org/">Validation</role>
        <role content-type="http://credit.casrai.org/">Visualization</role>
        <role content-type="http://credit.casrai.org/">Writing – Original Draft Preparation</role>
        <xref rid="c1" ref-type="corresp">a</xref>
        <xref rid="a1" ref-type="aff">1</xref>
        <xref rid="a2" ref-type="aff">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Capitanchik</surname>
          <given-names>Charlotte</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Data Curation</role>
        <role content-type="http://credit.casrai.org/">Formal Analysis</role>
        <role content-type="http://credit.casrai.org/">Investigation</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Software</role>
        <role content-type="http://credit.casrai.org/">Validation</role>
        <role content-type="http://credit.casrai.org/">Visualization</role>
        <role content-type="http://credit.casrai.org/">Writing – Original Draft Preparation</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-9590-2792</contrib-id>
        <xref rid="a1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Luscombe</surname>
          <given-names>Nicholas M.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Funding Acquisition</role>
        <role content-type="http://credit.casrai.org/">Project Administration</role>
        <role content-type="http://credit.casrai.org/">Supervision</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-5293-4778</contrib-id>
        <xref rid="a1" ref-type="aff">1</xref>
        <xref rid="a3" ref-type="aff">3</xref>
        <xref rid="a4" ref-type="aff">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ule</surname>
          <given-names>Jernej</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Funding Acquisition</role>
        <role content-type="http://credit.casrai.org/">Project Administration</role>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Supervision</role>
        <role content-type="http://credit.casrai.org/">Writing – Original Draft Preparation</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-2452-4277</contrib-id>
        <xref rid="a1" ref-type="aff">1</xref>
        <xref rid="a2" ref-type="aff">2</xref>
      </contrib>
      <aff id="a1"><label>1</label>The Francis Crick Institute, London, UK</aff>
      <aff id="a2"><label>2</label>Department of Neuromuscular Diseases, UCL Queen Square Institute of Neurology, London, UK</aff>
      <aff id="a3"><label>3</label>UCL Genetics Institute, Department of Genetics, Environment and Evolution, University College London, London, UK</aff>
      <aff id="a4"><label>4</label>Okinawa Institute of Science &amp; Technology Graduate University, Okinawa, Japan</aff>
    </contrib-group>
    <author-notes>
      <corresp id="c1">
        <label>a</label>
        <email xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="mailto:oscar.wilkins@crick.ac.uk">oscar.wilkins@crick.ac.uk</email>
      </corresp>
      <fn fn-type="COI-statement">
        <p>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>7</day>
      <month>6</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2021</year>
    </pub-date>
    <volume>6</volume>
    <elocation-id>141</elocation-id>
    <history>
      <date date-type="accepted">
        <day>20</day>
        <month>5</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright: © 2021 Wilkins OG et al.</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xmlns:xlink="http://www.w3.org/1999/xlink" content-type="pdf" xlink:href="wellcomeopenres-6-18522.pdf"/>
    <abstract>
      <p><bold>Background: </bold>The first step of virtually all next generation sequencing analysis involves the splitting of the raw sequencing data into separate files using sample-specific barcodes, a process known as “demultiplexing”. However, we found that existing software for this purpose was either too inflexible or too computationally intensive for fast, streamlined processing of raw, single end fastq files containing combinatorial barcodes.</p>
      <p><bold>Results:</bold> Here, we introduce a fast and uniquely flexible demultiplexer, named Ultraplex, which splits a raw FASTQ file containing barcodes either at a single end or at both 5’ and 3’ ends of reads, trims the sequencing adaptors and low-quality bases, and moves unique molecular identifiers (UMIs) into the read header, allowing subsequent removal of PCR duplicates. Ultraplex is able to perform such single or combinatorial demultiplexing on both single- and paired-end sequencing data, and can process an entire Illumina HiSeq lane, consisting of nearly 500 million reads, in less than 20 minutes.</p>
      <p><bold>Conclusions:</bold> Ultraplex greatly reduces computational burden and pipeline complexity for the demultiplexing of complex sequencing libraries, such as those produced by various CLIP and ribosome profiling protocols, and is also very user friendly, enabling streamlined, robust data processing. Ultraplex is available on PyPi and Conda and via
<ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://github.com/ulelab/ultraplex" ext-link-type="uri">Github</ext-link>.</p>
    </abstract>
    <kwd-group kwd-group-type="author">
      <kwd>Demultiplexing</kwd>
      <kwd>fastq</kwd>
      <kwd>iCLIP</kwd>
      <kwd>UMI</kwd>
      <kwd>ribosome profiling</kwd>
    </kwd-group>
    <funding-group>
      <award-group xmlns:xlink="http://www.w3.org/1999/xlink" id="fund-1" xlink:href="http://dx.doi.org/10.13039/100010438">
        <funding-source>Francis Crick Institute</funding-source>
      </award-group>
      <award-group xmlns:xlink="http://www.w3.org/1999/xlink" id="fund-2" xlink:href="http://dx.doi.org/10.13039/501100000265">
        <funding-source>Medical Research Council</funding-source>
        <award-id>FC010110</award-id>
      </award-group>
      <award-group xmlns:xlink="http://www.w3.org/1999/xlink" id="fund-3" xlink:href="http://dx.doi.org/10.13039/100010269">
        <funding-source>Wellcome Trust</funding-source>
        <award-id>215593</award-id>
        <award-id>FC001002</award-id>
      </award-group>
      <award-group xmlns:xlink="http://www.w3.org/1999/xlink" id="fund-4" xlink:href="http://dx.doi.org/10.13039/501100000289">
        <funding-source>Cancer Research UK</funding-source>
        <award-id>FC010110</award-id>
      </award-group>
      <award-group xmlns:xlink="http://www.w3.org/1999/xlink" id="fund-5" xlink:href="http://dx.doi.org/10.13039/501100004199">
        <funding-source>Okinawa Institute of Science and Technology Graduate University</funding-source>
      </award-group>
      <funding-statement>This work was supported by the Wellcome Trust (215593 to OW, and Joint Investigator Award 215593 to JU and NML) and by the Francis Crick Institute which receives its core funding from Cancer Research UK (FC001002), the UK Medical Research Council (FC001002), and the Wellcome Trust (FC001002). NML is a Winton Group Leader in recognition of the Winton Charitable Foundation's support towards the establishment of the Francis Crick Institute, and also receives core funding from the Okinawa Institute of Science &amp; Technology Graduate University.</funding-statement>
      <funding-statement>
        <italic toggle="yes">The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</italic>
      </funding-statement>
    </funding-group>
  </article-meta>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>Next generation sequencing (NGS) has greatly reduced the cost of obtaining large amounts of sequence data, as hundreds of millions, or even billions, of reads can be generated in a single sequencing run (
<xref rid="ref-6" ref-type="bibr">Goodwin
<italic toggle="yes">et al.</italic>, 2016</xref>). However, despite a greatly reduced cost per read, the cost of each sequencing run is still high. To reduce the cost per sample, a single sequencing run will typically involve multiplexing of multiple samples. To enable identification of which sample a given read is derived from, sample-specific “barcodes” (short, defined DNA sequences) are introduced during library preparation. Following sequencing, software is required to detect these barcodes and split the reads into separate files. Only after demultiplexing can read alignment and other downstream analysis be performed.</p>
    <p>For commercial library preparation methods (for example, Lexogen Quant-seq or Illumina Truseq), demultiplexing is typically performed during the generation of fastq files from the raw read data. For Illumina sequencing, the software used for this is Bcl2fastq. However, many in-house library preparation protocols use custom barcodes that are introduced via adaptors in such a way that they are present at 5’ and/or 3’ ends of reads, such as iCLIP (individual nucleotide crosslinking and immunoprecipitation) (
<xref rid="ref-7" ref-type="bibr">Huppertz
<italic toggle="yes">et al.</italic>, 2014</xref>;
<xref rid="ref-9" ref-type="bibr">König
<italic toggle="yes">et al.</italic>, 2010</xref>) or related protocols to study protein-RNA interactions and RNA methylation (
<xref rid="ref-11" ref-type="bibr">Lee &amp; Ule, 2018</xref>), as well as ribosome profiling and many others (
<xref rid="ref-19" ref-type="bibr">Sugimoto
<italic toggle="yes">et al.</italic>, 2015</xref>). In such cases of ‘complex multiplexed libraries’, demultiplexing is typically performed at a later stage, using a fastq file consisting of all the raw reads as input. In addition to barcodes, iCLIP-style reads contain unique molecular identifiers (UMIs), which enable removal of PCR duplicates and may be spread across multiple positions in the read (
<xref rid="ref-9" ref-type="bibr">König
<italic toggle="yes">et al.</italic>, 2010</xref>;
<xref rid="ref-18" ref-type="bibr">Smith
<italic toggle="yes">et al.</italic>, 2017</xref>;
<xref rid="f1" ref-type="fig">Figure 1A</xref>). Furthermore, combinatorial barcoding may be used, where each sample is identified by a unique combination of 5’ and 3’ barcodes. This allows more samples to be multiplexed on a single lane, can reduce technical variation by enabling earlier mixing of samples and enables incorporation of extra UMI nucleotides to increase UMI complexity, thus reducing the chance of UMI saturation at signal peaks (
<xref rid="ref-2" ref-type="bibr">Blazquez
<italic toggle="yes">et al.</italic>, 2018</xref>).</p>
    <fig position="float" fig-type="figure" id="f1">
      <label>Figure 1. </label>
      <caption>
        <title>The Ultraplex workflow.</title>
        <p><bold>A</bold>: An example read from a typical iCLIP/ribo-seq library, consisting of twin barcodes, UMIs present at multiple positions, a 3’ sequencing adaptor, and a read derived from a small RNA fragment.
<bold>B</bold>: Flow diagram of the processing of an example read, using combinatorial demultiplexing with single end sequencing data.</p>
      </caption>
      <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="wellcomeopenres-6-18522-g0000" position="float"/>
    </fig>
    <p>Over the last decade, great effort has been made to improve the accuracy and speed of demultiplexing algorithms (
<xref rid="ref-1" ref-type="bibr">Aronesty, 2013</xref>;
<xref rid="ref-8" ref-type="bibr">Kong, 2011</xref>;
<xref rid="ref-10" ref-type="bibr">Lab, 2014</xref>;
<xref rid="ref-12" ref-type="bibr">Liu, 2019</xref>;
<xref rid="ref-13" ref-type="bibr">Martin, 2011</xref>;
<xref rid="ref-14" ref-type="bibr">Murray &amp; Borevitz, 2018</xref>;
<xref rid="ref-16" ref-type="bibr">Roehr
<italic toggle="yes">et al.</italic>, 2017</xref>;
<xref rid="ref-17" ref-type="bibr">Schubert
<italic toggle="yes">et al.</italic>, 2016</xref>). However, despite the large number of software packages being available for demultiplexing, we found that only
<ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://github.com/tomazc/iCount" ext-link-type="uri">iCount demultiplex</ext-link> (
<xref rid="ref-9" ref-type="bibr">König
<italic toggle="yes">et al.</italic>, 2010</xref>) was capable of demultiplexing lanes featuring experimental barcodes split over the 5’ and 3’ of single end reads and additionally allowing that different 5’ barcodes may have different sets of accompanying 3’ barcodes (
<xref rid="T1" ref-type="table">Table 1</xref>). For such libraries, using any of the other available options would require the demultiplexer to be run multiple times, with different settings for each intermediate file, increasing time and pipeline complexity.
While the iCount demultiplex algorithm offers the greatest flexibility, it is limited by speed (a full lane can take more than eight hours to process), which presents a significant bottleneck in the analysis pipeline. Others have used Flexbar for demultiplexing iCLIP data (
<xref rid="ref-3" ref-type="bibr">Busch
<italic toggle="yes">et al.</italic>, 2020</xref>); however, Flexbar is unable to perform combinatorial 5’ and 3’ demultiplexing on single end data, and does not allow different 5’ barcodes to be associated with different sets of 3’ barcodes.</p>
    <table-wrap position="anchor" id="T1">
      <label>Table 1. </label>
      <caption>
        <title>A comparison of feature sets of various demultiplexers.</title>
      </caption>
      <table frame="hsides" rules="groups" content-type="article-table">
        <thead>
          <tr>
            <th align="left" valign="top" rowspan="1" colspan="1">Software</th>
            <th align="left" valign="top" rowspan="1" colspan="1">Combinatorial
<break/>demultiplexing for both
<break/>single- and paired-end data</th>
            <th align="left" valign="top" rowspan="1" colspan="1">Unique 3’
<break/>barcodes for
<break/>each 5’ barcode</th>
            <th align="left" valign="top" rowspan="1" colspan="1">Remove
<break/>adaptors</th>
            <th align="left" valign="top" rowspan="1" colspan="1">Quality
<break/>trim</th>
            <th align="left" valign="top" rowspan="1" colspan="1">Move UMIs
<break/>to read
<break/>header</th>
            <th align="left" valign="top" rowspan="1" colspan="1">Multi-threaded</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <bold>Cutadapt</bold>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
          </tr>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <bold>Demultiplex</bold>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">N/A</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
          </tr>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <bold>Flexbar 3.0</bold>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
          </tr>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <bold>FASTX-Toolkit</bold>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">N/A</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
          </tr>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <bold>Btrim</bold>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
          </tr>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <bold>Axe</bold>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
          </tr>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <bold>deML</bold>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
          </tr>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <bold>AdaptorRemoval2</bold>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
          </tr>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <bold>iCount demultiplex</bold>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
            <td align="left" valign="top" rowspan="1" colspan="1">Yes</td>
            <td align="left" valign="top" rowspan="1" colspan="1">No</td>
          </tr>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <bold>
                <italic toggle="yes">Ultraplex</italic>
              </bold>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <italic toggle="yes">Yes</italic>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <italic toggle="yes">Yes</italic>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <italic toggle="yes">Yes</italic>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <italic toggle="yes">Yes</italic>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <italic toggle="yes">Yes</italic>
            </td>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <italic toggle="yes">Yes</italic>
            </td>
          </tr>
        </tbody>
      </table>
    </table-wrap>
    <p>We set out to create a demultiplexer suitable for processing the types of reads found in complex multiplexed libraries, without the caveats of existing software. Importantly, we wanted this software to run as quickly and efficiently as possible. We therefore required fully multithreaded operation, to take advantage of modern CPU architectures, and all processing to be performed in a single read-write cycle, so as to avoid read/write bottlenecks. By testing it on iCLIP libraries, we demonstrated that the resulting software, Ultraplex, meets all of these requirements. Thus, Ultraplex has broad applicability by greatly reducing the processing time for complex multiplexed libraries.</p>
  </sec>
  <sec sec-type="methods">
    <title>Methods</title>
    <sec>
      <title>Implementation</title>
      <p>Our software needed to be efficient, multithreaded and capable of performing all desired processing steps in a single read-write cycle (
<xref rid="f1" ref-type="fig">Figure 1B</xref>). To this end, we utilised the high performance fastq decompression and parsing of dnaio and Cutadapt, and also used its reader/worker implementation and quality/adapter trimmer cython functions (
<xref rid="ref-13" ref-type="bibr">Martin, 2011</xref>). However, we developed bespoke solutions to demultiplexing, UMI detection and the writing of processed fastqs to enable fully multithreaded operation (at the time of writing cutadapt demultiplexing was single-threaded only), and allow more flexible demultiplexing (
<xref rid="f2" ref-type="fig">Figure 2</xref>).</p>
      <fig position="float" fig-type="figure" id="f2">
        <label>Figure 2. </label>
        <caption>
          <title>The Ultraplex pipeline.</title>
          <p>The major steps of the Ultraplex pipeline are outlined. Steps that use modified code based on Cutadapt are indicated.</p>
        </caption>
        <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="wellcomeopenres-6-18522-g0001" position="float"/>
      </fig>
      <p>NGS data typically consists of hundreds of millions of reads. For efficient performance, it is therefore essential to minimise the number of function calls required for each read that is processed. For this reason, Ultraplex first generates all possible DNA sequences (including those with undefined “N” bases) of the same length as the barcodes (ignoring UMIs), then tests each sequence against each user-defined barcode to find the best matches (reads with more than one best match are discarded). By storing these precalculated best matches in a python dictionary, each read can be matched to its correct barcode or barcode pair at approximately O(1) efficiency. Typically barcodes are &lt;= 5 bases, meaning the sequence-barcode best match function is called at most 3,125 (5
<sup>5</sup>) times during dictionary generation, rather than 10
<sup>8</sup>–10
<sup>9</sup> times if barcode matches were calculated for each read individually, as was the case in iCount demultiplexer.</p>
      <p>Current multiplexing approaches use barcodes of the same type (i.e. 5’ or 3’), of consistent length, with 5’ or 3’ barcodes present at the same position within the read relative to the 5' or 3' end, respectively (
<xref rid="f3" ref-type="fig">Figure 3</xref>). Such consistent design of multiplexing is important to ensure that all reads have mutually exclusive barcodes. We designed Ultraplex to enable flexible demultiplexing of any complex libraries that follow these described prerequisites. For data in which barcodes may be at unknown positions, however, alternative algorithms are required.</p>
      <fig position="float" fig-type="figure" id="f3">
        <label>Figure 3. </label>
        <caption>
          <title>Examples of compatible and incompatible barcodes.</title>
          <p>“N” bases are randomers which would typically be used as UMIs. “b” bases are barcode bases. Compatible barcodes must have the same number of “b” bases, which must be at the same position relative to the 5’ or 3’ end of the read for 5’ and 3’ barcodes, respectively. Blue boxes indicate problematic regions of barcode.</p>
        </caption>
        <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="wellcomeopenres-6-18522-g0002" position="float"/>
      </fig>
      <p>Ultraplex allows UMIs of different barcodes to vary in length (
<xref rid="f3" ref-type="fig">Figure 3</xref>). It optionally allows each 5’ barcode to be paired with an array of 3’ barcodes, provided these 3’ barcodes are consistent, but 3’ barcodes linked to different 5’ barcodes
<italic toggle="yes">do not</italic> need to be consistent with each other. All other existing demultiplexers would require multiple runs for such complex demultiplexing, increasing pipeline complexity and run-time, and therefore Ultraplex increases the flexibility, convenience and speed of demultiplexing.</p>
      <p>When single end sequencing is used with samples containing 3’ barcodes, only cDNAs which are short enough will contain the 3’ barcode in the sequencing read (e.g. inserts of maximal length of ~90 nt will be possible for SR100, depending on barcode length). Ultraplex allows for combinatorial demultiplexing with single end data (with the above caveats), which is not possible in most other demultiplexers (
<xref rid="T1" ref-type="table">Table 1</xref>). To reduce the likelihood of erroneous detection of 3’ barcodes during single end operation, Ultraplex requires by default that at least three nucleotides of the 3’ sequencing adaptor are detected and trimmed for a 3’ barcode to be assigned; this ensures that the end of the forward read genuinely corresponds to the end of the insert, and should thus contain a 3’ barcode. Moreover, it can also demultiplex paired end sequences in which a 3’ barcode is present at the 5’ end of the reverse read, with the forward and reverse reads stored in separate FASTQ files. Ultraplex uses the forward read to detect the 5’ barcode, and the reverse read to detect the 3' barcode.</p>
      <p>We envisage that most users of Ultraplex will run the software on a high-performance computing cluster (HPCC). HPCCs typically have large amounts of free storage space and have many separate computational nodes, on which multiple jobs can be run in parallel. To take advantage of this, we added two additional running modes, "ultra", which writes uncompressed temporary files and then compresses after concatenation, and "sbatch compression", which uses SLURM to send each compression job to a separate HPCC node. As such, the sbatch compression mode can only be used in conjunction with ultra mode, and can only be run on HPCCs with SLURM job management. The use of these two modes reduces run time by a further ~30%. These combined improvements bring an &gt;40x increase in speed as compared to iCount, currently the only alternative tool for single-step demultiplexing of single end sequencing libraries featuring combinatorial barcodes.</p>
    </sec>
    <sec>
      <title>Operation</title>
      <p><italic toggle="yes">Ultraplex</italic> is a command-line tool which can be installed via pip or conda. It requires at least two input arguments: a comma-separated values (.csv) file of barcodes, and a compressed fastq file. A simple command would be:</p>
      <p>
        <preformat preformat-type="computer code" position="float" xml:space="preserve">
          <styled-content style="color:#000000">ultraplex -b my_barcodes.csv -i my_fastq.fastq.gz</styled-content>
        </preformat>
      </p>
      <p>The first column of the barcode csv file should correspond to the 5’ barcodes; additional columns (separated by commas) correspond to any 3’ barcodes which are linked to the 5’ barcode. Optionally, each barcode can be assigned a sample name using a colon spacer (5’ barcodes cannot be assigned a sample name if linked to 3’ barcodes, as this would be ambiguous). N characters denote positions that correspond to UMIs. An example barcode csv could be as follows:</p>
      <p>
        <preformat preformat-type="computer code" position="float" xml:space="preserve">
          <styled-content style="color:#000000">NNNATGCNN
NNNATTANNN:sample_2
NNNGCGGN,NNAA:sample_3,NNNTT</styled-content>
        </preformat>
      </p>
      <p>This barcode csv corresponds to four samples: two with only a 5’ barcode, and two with a shared 5’ but unique 3’ barcode. Only samples 2 and 3 are explicitly named. Note the consistency of the positioning of barcodes relative to the 5’ or 3’ ends (
<xref rid="f3" ref-type="fig">Figure 3</xref>).</p>
      <p>There are many optional arguments: -d (output directory for files), -m5 and -m3 (the number of mismatches allowed during 5’ and 3’ barcode detection), -q (the minimum phred quality during 3’ quality trimming), -t (number of threads used during operation), -a (the 3’ adaptor for the forward read), -o (an output filename prefix), -sb (sbatch compression for slurm clusters), -u (ultra mode, described above), -l (the minimum length of the read to be written out), -i2 (a second fastq for paired-end demultiplexing), -a2 (the sequencing adaptor to be trimmed for the reverse read), -inm/--ignore_no_match (does not write out reads which are not matched to sample).</p>
    </sec>
  </sec>
  <sec sec-type="results">
    <title>Results</title>
    <p>We benchmarked Ultraplex against iCount for a sequencing lane of 482,988,240 single end reads, consisting of 30 multiplexed iCLIP samples, where 17 have only a 5’ barcode, and the remainder have both 5’ and 3’ barcodes. Our testing was run on a high-performance computing cluster where each CPU node is an 8-core Intel E5-2640 Haswell CPU running at 2.6GHz, with hyperthreading enabled (two threads per core), running Linux 3.10.0–957.1.3.el7.x86_64. iCount was run with additional flags --
<monospace>min_adapter_overlap 3 -mis 1 -ml 0</monospace> and Ultraplex with
<monospace>-mt 3 -m5 1 -q 0 -l 17</monospace>. Using Ultraplex with both ultra and sb modes, 16 threads and 64GB memory, the lane was demultiplexed in 21.7 minutes, but we could push this as low as 15.6 minutes by allowing 32 threads and 128GB memory (
<xref rid="f4" ref-type="fig">Figure 4A</xref>). Given 64GB memory and matched settings, iCount took 662 minutes (~ 11 hours). Even without ultra and sb modes enabled, Ultraplex only took 32.5 minutes. We also tested Ultraplex with lower resources; given eight threads and 16GB memory, the lane was demultiplexed in 43.4 minutes with ultra and sb modes enabled, and 64.7 minutes without. This demonstrates that even with modest resource allocation, Ultraplex is a very fast demultiplexer.</p>
    <fig position="float" fig-type="figure" id="f4">
      <label>Figure 4. </label>
      <caption>
        <title>Performance of Ultraplex vs. iCount demultiplex.</title>
        <p><bold>A</bold>: Runtime in minutes of iCount vs. Ultraplex (UP) with various parameters.
<bold>B</bold>: Number of demultiplexed reads per barcode assigned by Ultraplex and iCount.
<bold>C</bold>,
<bold>D</bold>: Number of uniquely mapped and multimapped reads per sample after STAR mapping of the 30 iCLIP samples demultiplexed using Ultraplex or iCount.</p>
      </caption>
      <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="wellcomeopenres-6-18522-g0003" position="float"/>
    </fig>
    <p>Next we compared the output of iCount and Ultraplex to check consistency. Reassuringly, Ultraplex gave exactly the same results over the four different test runs. Comparing iCount to Ultraplex, the number of reads assigned per barcode were mostly the same, bar a few samples where iCount assigned slightly more reads (
<xref rid="f4" ref-type="fig">Figure 4B</xref>). To explore this, we further filtered reads with cutadapt quality trimming removing 3’ nucleotides with PHRED score of less than 30, kept reads with a minimum length of 20 nucleotides, and mapped them to the human genome using STAR. The biggest deviance between iCount and Ultraplex assigned reads was found for the sample NNNNCCGGANNN. For this sample, only 0.99% (2090/211347) of the iCount-specific reads mapped to the genome, and 90% (1898/2090) of these were assigned as “spliced”, meaning the read had to be split to be mapped, indicative of low-quality mapping. The remaining 99.01% of the iCount-specific reads were determined by STAR to be too short to map. When comparing the total number of mapped reads for all samples (both unique and multi-mapped), we found the final results of Ultraplex and iCount were near-identical (
<xref rid="f4" ref-type="fig">Figure 4C,D</xref>). Thus, Ultraplex produces essentially identical results to iCount, but is &gt;40x faster.</p>
  </sec>
  <sec sec-type="conclusions">
    <title>Conclusions</title>
    <p>The processing of iCLIP-style sequencing libraries consists of many sequential steps, which requires complex pipelines (
<xref rid="ref-3" ref-type="bibr">Busch
<italic toggle="yes">et al.</italic>, 2020</xref>;
<xref rid="ref-4" ref-type="bibr">Chakrabarti
<italic toggle="yes">et al.</italic>, 2018</xref>). By performing multiple processing steps in one read/write cycle, and by using a multi-threaded and computationally efficient method, Ultraplex greatly improves the speed and ease of the initial steps of demultiplexing the fastq file. In our testing we find Ultraplex to be up to 40 times faster than the currently used iCount software. Furthermore, Ultraplex allows for extremely flexible demultiplexing, simplifying the analysis when multiple samples with varying barcode arrangements are sequenced together. By removing the largest time bottleneck in the CLIP analysis workflow, we now make it possible to go from multiplexed fastq to sample crosslinks in a matter of hours using a pipeline such as
<ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://nf-co.re/clipseq" ext-link-type="uri">nf-core/clipseq</ext-link> (
<xref rid="ref-5" ref-type="bibr">Ewels
<italic toggle="yes">et al.</italic>, 2020</xref>).</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <sec>
      <title>Underlying data</title>
      <p>ArrayExpress: Ultraplex: An ultra-fast, flexible, all-in-one fastq demultiplexer. Accession number E-MTAB-10349;
<ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://identifiers.org/arrayexpress:E-MTAB-10349" ext-link-type="uri">https://identifiers.org/arrayexpress:E-MTAB-10349</ext-link>.</p>
    </sec>
  </sec>
  <sec>
    <title>Software availability</title>
    <p>Source code available from:
<ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://github.com/ulelab/ultraplex" ext-link-type="uri">https://github.com/ulelab/ultraplex</ext-link>
</p>
    <p>Archived source code at time of publication:
<ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://doi.org/10.5281/zenodo.4651285" ext-link-type="uri">https://doi.org/10.5281/zenodo.4651285</ext-link> (
<xref rid="ref-15" ref-type="bibr">Wilkins
<italic toggle="yes">et al.</italic>, 2021</xref>)</p>
    <p>License:
<ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://opensource.org/licenses/MIT" ext-link-type="uri">MIT</ext-link>
</p>
    <p>Software is also on
<ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pypi.org/project/ultraplex/" ext-link-type="uri">PyPi</ext-link> and
<ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://anaconda.org/bioconda/ultraplex" ext-link-type="uri">Bioconda</ext-link>.</p>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgements</title>
    <p>We would like to thank Martina Hallegger for the use of her sequencing lane in our testing and validation. We would also like to thank Robert Goldstone for his comments.</p>
  </ack>
  <ref-list>
    <ref id="ref-1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aronesty</surname><given-names>E</given-names></name></person-group>:
<article-title>Comparison of Sequencing Utility Programs.</article-title><source><italic toggle="yes">Open Bioinforma J.</italic></source><year>2013</year>;<volume>7</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>8</lpage>.
<pub-id pub-id-type="doi">10.2174/1875036201307010001</pub-id></mixed-citation>
    </ref>
    <ref id="ref-2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Blazquez</surname><given-names>L</given-names></name><name><surname>Emmett</surname><given-names>W</given-names></name><name><surname>Faraway</surname><given-names>R</given-names></name><etal/></person-group>:
<article-title>Exon Junction Complex Shapes the Transcriptome by Repressing Recursive Splicing.</article-title><source><italic toggle="yes">Mol Cell.</italic></source><year>2018</year>;<volume>72</volume>(<issue>3</issue>):<fpage>496</fpage>–<lpage>509.e9</lpage>.
<pub-id pub-id-type="doi">10.1016/j.molcel.2018.09.033</pub-id><!--<pub-id pub-id-type="pmcid">6224609</pub-id>--><?supplied-pmid 30388411?><pub-id pub-id-type="pmid">30388411</pub-id></mixed-citation>
    </ref>
    <ref id="ref-3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Busch</surname><given-names>A</given-names></name><name><surname>Brüggemann</surname><given-names>M</given-names></name><name><surname>Ebersberger</surname><given-names>S</given-names></name><etal/></person-group>:
<article-title>iCLIP Data Analysis: A Complete Pipeline from Sequencing Reads to RBP Binding Sites.</article-title><source><italic toggle="yes">Methods.</italic></source><year>2020</year>;<volume>178</volume>:<fpage>49</fpage>–<lpage>62</lpage>.
<pub-id pub-id-type="doi">10.1016/j.ymeth.2019.11.008</pub-id><?supplied-pmid 31751605?><pub-id pub-id-type="pmid">31751605</pub-id></mixed-citation>
    </ref>
    <ref id="ref-4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chakrabarti</surname><given-names>AM</given-names></name><name><surname>Haberman</surname><given-names>N</given-names></name><name><surname>Praznik</surname><given-names>A</given-names></name><etal/></person-group>:
<article-title>Data Science Issues in Studying Protein-RNA Interactions with CLIP Technologies.</article-title><source><italic toggle="yes">Annu Rev Biomed Data Sci.</italic></source><year>2018</year>;<volume>1</volume>(<issue>1</issue>):<fpage>235</fpage>–<lpage>61</lpage>.
<pub-id pub-id-type="doi">10.1146/annurev-biodatasci-080917-013525</pub-id></mixed-citation>
    </ref>
    <ref id="ref-5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ewels</surname><given-names>PA</given-names></name><name><surname>Peltzer</surname><given-names>A</given-names></name><name><surname>Fillinger</surname><given-names>S</given-names></name><etal/></person-group>:
<article-title>The Nf-Core Framework for Community-Curated Bioinformatics Pipelines.</article-title><source><italic toggle="yes">Nat Biotechnol.</italic></source><year>2020</year>;<volume>38</volume>(<issue>3</issue>):<fpage>276</fpage>–<lpage>78</lpage>.
<pub-id pub-id-type="doi">10.1038/s41587-020-0439-x</pub-id><?supplied-pmid 32055031?><pub-id pub-id-type="pmid">32055031</pub-id></mixed-citation>
    </ref>
    <ref id="ref-6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Goodwin</surname><given-names>S</given-names></name><name><surname>McPherson</surname><given-names>JD</given-names></name><name><surname>McCombie</surname><given-names>WR</given-names></name></person-group>:
<article-title>Coming of Age: Ten Years of next-Generation Sequencing Technologies.</article-title><source><italic toggle="yes">Nat Rev Genet.</italic></source><year>2016</year>;<volume>17</volume>(<issue>6</issue>):<fpage>333</fpage>–<lpage>51</lpage>.
<pub-id pub-id-type="doi">10.1038/nrg.2016.49</pub-id><?supplied-pmid 27184599?><pub-id pub-id-type="pmid">27184599</pub-id></mixed-citation>
    </ref>
    <ref id="ref-7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huppertz</surname><given-names>I</given-names></name><name><surname>Attig</surname><given-names>J</given-names></name><name><surname>D’Ambrogio</surname><given-names>A</given-names></name><etal/></person-group>:
<article-title>iCLIP: Protein-RNA Interactions at Nucleotide Resolution.</article-title><source><italic toggle="yes">Methods.</italic></source><year>2014</year>;<volume>65</volume>(<issue>3</issue>):<fpage>274</fpage>–<lpage>87</lpage>.
<pub-id pub-id-type="doi">10.1016/j.ymeth.2013.10.011</pub-id><!--<pub-id pub-id-type="pmcid">3988997</pub-id>--><?supplied-pmid 24184352?><pub-id pub-id-type="pmid">24184352</pub-id></mixed-citation>
    </ref>
    <ref id="ref-8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kong</surname><given-names>Y</given-names></name></person-group>:
<article-title>Btrim: A Fast, Lightweight Adapter and Quality Trimming Program for next-Generation Sequencing Technologies.</article-title><source><italic toggle="yes">Genomics.</italic></source><year>2011</year>;<volume>98</volume>(<issue>2</issue>):<fpage>152</fpage>–<lpage>53</lpage>.
<pub-id pub-id-type="doi">10.1016/j.ygeno.2011.05.009</pub-id><?supplied-pmid 21651976?><pub-id pub-id-type="pmid">21651976</pub-id></mixed-citation>
    </ref>
    <ref id="ref-9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>König</surname><given-names>J</given-names></name><name><surname>Zarnack</surname><given-names>K</given-names></name><name><surname>Rot</surname><given-names>G</given-names></name><etal/></person-group>:
<article-title>iCLIP Reveals the Function of hnRNP Particles in Splicing at Individual Nucleotide Resolution.</article-title><source><italic toggle="yes">Nat Struct Mol Biol.</italic></source><year>2010</year>;<volume>17</volume>(<issue>7</issue>):<fpage>909</fpage>–<lpage>15</lpage>.
<pub-id pub-id-type="doi">10.1038/nsmb.1838</pub-id><!--<pub-id pub-id-type="pmcid">3000544</pub-id>--><?supplied-pmid 20601959?><pub-id pub-id-type="pmid">20601959</pub-id></mixed-citation>
    </ref>
    <ref id="ref-10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lab</surname><given-names>H</given-names></name></person-group>:
<article-title>FASTX Toolkit.</article-title><source><italic toggle="yes">Cold Spring Harb. Lab. Cold Spring Harb.</italic> NY.
</source><year>2014</year>.
<ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://hannonlab.cshl.edu/fastx_toolkit/" ext-link-type="uri">Reference Source</ext-link></mixed-citation>
    </ref>
    <ref id="ref-11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>FCY</given-names></name><name><surname>Ule</surname><given-names>J</given-names></name></person-group>:
<article-title>Advances in CLIP Technologies for Studies of Protein-RNA Interactions.</article-title><source><italic toggle="yes">Mol Cell.</italic></source><year>2018</year>;<volume>69</volume>(<issue>3</issue>):<fpage>354</fpage>–<lpage>69</lpage>.
<pub-id pub-id-type="doi">10.1016/j.molcel.2018.01.005</pub-id><?supplied-pmid 29395060?><pub-id pub-id-type="pmid">29395060</pub-id></mixed-citation>
    </ref>
    <ref id="ref-12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>D</given-names></name></person-group>:
<article-title>Fuzzysplit: Demultiplexing and Trimming Sequenced DNA with a Declarative Language.</article-title><source><italic toggle="yes">PeerJ.</italic></source><year>2019</year>;<volume>7</volume>:<fpage>e7170</fpage>.
<pub-id pub-id-type="doi">10.7717/peerj.7170</pub-id><!--<pub-id pub-id-type="pmcid">6589082</pub-id>--><?supplied-pmid 31249738?><pub-id pub-id-type="pmid">31249738</pub-id></mixed-citation>
    </ref>
    <ref id="ref-13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Martin</surname><given-names>M</given-names></name></person-group>:
<article-title>Cutadapt Removes Adapter Sequences from High-Throughput Sequencing Reads.</article-title><source><italic toggle="yes">EMBnet.journal.</italic></source><year>2011</year>;<volume>17</volume>(<issue>1</issue>):<fpage>10</fpage>–<lpage>12</lpage>.
<pub-id pub-id-type="doi">10.14806/ej.17.1.200</pub-id></mixed-citation>
    </ref>
    <ref id="ref-14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Murray</surname><given-names>KD</given-names></name><name><surname>Borevitz</surname><given-names>JO</given-names></name></person-group>:
<article-title>Axe: Rapid, Competitive Sequence Read Demultiplexing Using a Trie.</article-title><source><italic toggle="yes">Bioinformatics.</italic></source><year>2018</year>;<volume>34</volume>(<issue>22</issue>):<fpage>3924</fpage>–<lpage>25</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/bty432</pub-id><?supplied-pmid 29868827?><pub-id pub-id-type="pmid">29868827</pub-id></mixed-citation>
    </ref>
    <ref id="ref-15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wilkins</surname><given-names>OG</given-names></name><name><surname>Capitanchik</surname><given-names>C</given-names></name><name><surname>Chakrabarti</surname><given-names>N</given-names></name></person-group>:
<article-title>ulelab/ultraplex: Ultraplex release.</article-title>(Version 1.1.4).
<source><italic toggle="yes">Zenodo.</italic></source><year>2021</year>.
<pub-id pub-id-type="doi">10.5281/zenodo.4651285</pub-id></mixed-citation>
    </ref>
    <ref id="ref-16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Roehr</surname><given-names>JT</given-names></name><name><surname>Dieterich</surname><given-names>C</given-names></name><name><surname>Reinert</surname><given-names>K</given-names></name></person-group>:
<article-title>Flexbar 3.0 - SIMD and Multicore Parallelization.</article-title><source><italic toggle="yes">Bioinformatics.</italic></source><year>2017</year>;<volume>33</volume>(<issue>18</issue>):<fpage>2941</fpage>–<lpage>42</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btx330</pub-id><?supplied-pmid 28541403?><pub-id pub-id-type="pmid">28541403</pub-id></mixed-citation>
    </ref>
    <ref id="ref-17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schubert</surname><given-names>M</given-names></name><name><surname>Lindgreen</surname><given-names>S</given-names></name><name><surname>Orlando</surname><given-names>L</given-names></name></person-group>:
<article-title>AdapterRemoval v2: Rapid Adapter Trimming, Identification, and Read Merging.</article-title><source><italic toggle="yes">BMC Res Notes.</italic></source><year>2016</year>;<volume>9</volume>:<fpage>88</fpage>.
<pub-id pub-id-type="doi">10.1186/s13104-016-1900-2</pub-id><!--<pub-id pub-id-type="pmcid">4751634</pub-id>--><?supplied-pmid 26868221?><pub-id pub-id-type="pmid">26868221</pub-id></mixed-citation>
    </ref>
    <ref id="ref-18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smith</surname><given-names>T</given-names></name><name><surname>Heger</surname><given-names>A</given-names></name><name><surname>Sudbery</surname><given-names>I</given-names></name></person-group>:
<article-title>UMI-Tools: Modeling Sequencing Errors in Unique Molecular Identifiers to Improve Quantification Accuracy.</article-title><source><italic toggle="yes">Genome Res.</italic></source><year>2017</year>;<volume>27</volume>(<issue>3</issue>):<fpage>491</fpage>–<lpage>99</lpage>.
<pub-id pub-id-type="doi">10.1101/gr.209601.116</pub-id><!--<pub-id pub-id-type="pmcid">5340976</pub-id>--><?supplied-pmid 28100584?><pub-id pub-id-type="pmid">28100584</pub-id></mixed-citation>
    </ref>
    <ref id="ref-19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sugimoto</surname><given-names>Y</given-names></name><name><surname>Vigilante</surname><given-names>A</given-names></name><name><surname>Darbo</surname><given-names>E</given-names></name><etal/></person-group>:
<article-title>hiCLIP Reveals the
<italic toggle="yes">in Vivo</italic> Atlas of mRNA Secondary Structures Recognized by Staufen 1.</article-title><source><italic toggle="yes">Nature.</italic></source><year>2015</year>;<volume>519</volume>(<issue>7544</issue>):<fpage>491</fpage>–<lpage>94</lpage>.
<pub-id pub-id-type="doi">10.1038/nature14280</pub-id><!--<pub-id pub-id-type="pmcid">4376666</pub-id>--><?supplied-pmid 25799984?><pub-id pub-id-type="pmid">25799984</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<sub-article article-type="peer-review" id="report44297">
  <front-stub>
    <article-id pub-id-type="doi">10.21956/wellcomeopenres.18522.r44297</article-id>
    <title-group>
      <article-title>Reviewer response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Kudla</surname>
          <given-names>Grzegorz</given-names>
        </name>
        <xref rid="r44297a1" ref-type="aff">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r44297a1"><label>1</label>MRC Human Genetics Unit, Institute for Genetics and Molecular Medicine, The University of Edinburgh, Edinburgh, UK</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>16</day>
      <month>7</month>
      <year>2021</year>
    </pub-date>
    <permissions>
      <copyright-statement>Copyright: © 2021 Kudla G</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access peer review report distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <related-article xmlns:xlink="http://www.w3.org/1999/xlink" related-article-type="peer-reviewed-article" ext-link-type="doi" id="relatedArticleReport44297" xlink:href="10.12688/wellcomeopenres.16791.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>Wilkins
<italic toggle="yes"> et al. </italic>describe a new software tool, called Ultraplex, for demultiplexing of fastq files. Demultiplexing is an essential data preprocessing step in the analysis of various functional genomic experiments, including CLIP, iCLIP, eCLIP, PAR-CLIP, CRAC, Ribo-Seq, CLASH, and others.</p>
    <p> Ultraplex inputs sequencing data in fastq format, and it outputs fastq files that have been separated using the barcode (index) information included in reads. The tool is flexible: it can process split barcodes distributed between 5' and 3' ends of reads; it processes UMI information to facilitate the removal of PCR duplicates; it allows processing of single- and paired-end data; and, thanks to the integration of the cutadapt tool, it allows trimming of adapter sequences and low quality nucleotides. As such, ultraplex can facilitate data analysis by running the entire data preprocessing as a single command.</p>
    <p> I found the tool easy to install using pip, and intuitive to run. There is extensive documentation on github. The performance and outputs are as described in the manuscript. In future updates, it would be useful to add a functionality to allow processing of barcodes of different lengths, since those are sometimes used in the same run to increase nucleotide diversity in each cycle of sequencing.</p>
    <p>Are the conclusions about the tool and its performance adequately supported by the findings presented in the article?</p>
    <p>Yes</p>
    <p>Is the rationale for developing the new software tool clearly explained?</p>
    <p>Yes</p>
    <p>Is the description of the software tool technically sound?</p>
    <p>Yes</p>
    <p>Are sufficient details of the code, methods and analysis (if applicable) provided to allow replication of the software development and its use by others?</p>
    <p>Yes</p>
    <p>Is sufficient information provided to allow interpretation of the expected output datasets and any results generated using the tool?</p>
    <p>Yes</p>
    <p>Reviewer Expertise:</p>
    <p>RNA biology, RNA-protein interactions, RNA-RNA interactions</p>
    <p>I confirm that I have read this submission and believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
<sub-article article-type="peer-review" id="report44299">
  <front-stub>
    <article-id pub-id-type="doi">10.21956/wellcomeopenres.18522.r44299</article-id>
    <title-group>
      <article-title>Reviewer response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Cereda</surname>
          <given-names>Matteo</given-names>
        </name>
        <xref rid="r44299a1" ref-type="aff">1</xref>
        <role>Referee</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-1799-5537</contrib-id>
      </contrib>
      <aff id="r44299a1"><label>1</label>Cancer Genomics and Bioinformatics Unit, IIGM-Italian Institute for Genomic Medicine, Turin, Italy</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>6</month>
      <year>2021</year>
    </pub-date>
    <permissions>
      <copyright-statement>Copyright: © 2021 Cereda M</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access peer review report distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <related-article xmlns:xlink="http://www.w3.org/1999/xlink" related-article-type="peer-reviewed-article" ext-link-type="doi" id="relatedArticleReport44299" xlink:href="10.12688/wellcomeopenres.16791.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>In this work, Wilkins
<italic toggle="yes">et al.</italic> provide a fast and flexible multithreaded demultiplexer that can be applied to many NGS approaches solving the complex issue of combinatorial demultiplexing. The algorithm can deal with different experimental designs optimizing the computational cost. The software comes with a well-structured repository and all functions are clearly explained.</p>
    <p> This Reviewer would suggest mentioning in the Introduction other examples of sequencing technologies (i.e. single cells, clonal tracking) that can take advantage of Ultraplex. </p>
    <p>
      <bold>Minor:</bold>
      <list list-type="bullet">
        <list-item>
          <p>How would the computational cost increase with barcodes longer than 5nt (up to 10 max)?</p>
        </list-item>
      </list>
    </p>
    <p>Are the conclusions about the tool and its performance adequately supported by the findings presented in the article?</p>
    <p>Yes</p>
    <p>Is the rationale for developing the new software tool clearly explained?</p>
    <p>Yes</p>
    <p>Is the description of the software tool technically sound?</p>
    <p>Yes</p>
    <p>Are sufficient details of the code, methods and analysis (if applicable) provided to allow replication of the software development and its use by others?</p>
    <p>Yes</p>
    <p>Is sufficient information provided to allow interpretation of the expected output datasets and any results generated using the tool?</p>
    <p>Yes</p>
    <p>Reviewer Expertise:</p>
    <p>bioinformatics; alternative splicing; cancer genomics</p>
    <p>I confirm that I have read this submission and believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
