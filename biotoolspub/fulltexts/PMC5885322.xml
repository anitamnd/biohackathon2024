<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Genomics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Genomics</journal-id>
    <journal-title-group>
      <journal-title>BMC Genomics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2164</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5885322</article-id>
    <article-id pub-id-type="publisher-id">4625</article-id>
    <article-id pub-id-type="doi">10.1186/s12864-018-4625-x</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>EnrichedHeatmap: an R/Bioconductor package for comprehensive visualization of genomic signal associations</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Gu</surname>
          <given-names>Zuguang</given-names>
        </name>
        <address>
          <email>z.gu@dkfz.de</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Eils</surname>
          <given-names>Roland</given-names>
        </name>
        <address>
          <email>r.eils@dkfz.de</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Schlesner</surname>
          <given-names>Matthias</given-names>
        </name>
        <address>
          <email>m.schlesner@dkfz.de</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ishaque</surname>
          <given-names>Naveed</given-names>
        </name>
        <address>
          <email>n.ishaque@dkfz.de</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0492 0584</institution-id><institution-id institution-id-type="GRID">grid.7497.d</institution-id><institution>Division of Theoretical Bioinformatics (B080), </institution><institution>German Cancer Research Center (DKFZ), </institution></institution-wrap>Im Neuenheimer Feld 280, 69120 Heidelberg, Germany </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0492 0584</institution-id><institution-id institution-id-type="GRID">grid.7497.d</institution-id><institution>Heidelberg Center for Personalized Oncology (DKFZ-HIPO), German Cancer Research Center (DKFZ), </institution></institution-wrap>Im Neuenheimer Feld 280, 69120 Heidelberg, Germany </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2190 4373</institution-id><institution-id institution-id-type="GRID">grid.7700.0</institution-id><institution>Department for Bioinformatics and Functional Genomics, </institution><institution>Institute for Pharmacy and Molecular Biotechnology (IPMB) and BioQuant Center, Heidelberg University, </institution></institution-wrap>Im Neuenheimer Feld 267, 69120 Heidelberg, Germany </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>4</day>
      <month>4</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>4</day>
      <month>4</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2018</year>
    </pub-date>
    <volume>19</volume>
    <elocation-id>234</elocation-id>
    <history>
      <date date-type="received">
        <day>24</day>
        <month>11</month>
        <year>2017</year>
      </date>
      <date date-type="accepted">
        <day>27</day>
        <month>3</month>
        <year>2018</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s). 2018</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold>This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
      </license>
    </permissions>
    <trans-abstract xml:lang="de" id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">High-throughput sequencing data are dramatically increasing in volume. Thus, there is urgent need for efficient tools to perform fast and integrative analysis of multiple data types. Enriched heatmap is a specific form of heatmap that visualizes how genomic signals are enriched over specific target regions. It is commonly used and efficient at revealing enrichment patterns especially for high dimensional genomic and epigenomic datasets.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">We present a new R package named <italic>EnrichedHeatmap</italic> that efficiently visualizes genomic signal enrichment. It provides advanced solutions for normalizing genomic signals within target regions as well as offering highly customizable visualizations. The major advantage of <italic>EnrichedHeatmap</italic> is the ability to conveniently generate parallel heatmaps as well as complex annotations, which makes it easy to integrate and visualize comprehensive overviews of the patterns and associations within and between complex datasets.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3"><italic>EnrichedHeatmap</italic> facilitates comprehensive understanding of high dimensional genomic and epigenomic data. The power of <italic>EnrichedHeatmap</italic> is demonstrated by visualization of the complex associations between DNA methylation, gene expression and various histone modifications.</p>
      </sec>
    </trans-abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Visualization</kwd>
      <kwd>Parallel heatmap</kwd>
      <kwd>Genomic signal enrichment</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>the German Cancer Research Center-Heidelberg Center for Personalized Oncology (DKFZ-HIPO)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>BMBF-funded de.NBI HD-HuB network</institution>
        </funding-source>
        <award-id>#031A537A, #031A537C</award-id>
        <principal-award-recipient>
          <name>
            <surname>Gu</surname>
            <given-names>Zuguang</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2018</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par8">With increasing accessibility and application of high throughput sequencing methods, there is a rise in the number of complex genomic and epigenomics studies. Thus, methods for integrative analysis are urgently required to provide comprehensive overviews of high dimensional multi-omics dataset to better understand biological systems [<xref ref-type="bibr" rid="CR1">1</xref>]. Among them, effective visualization methods are of special importance as it helps to give an intuitive interpretation of the underlying data.</p>
    <p id="Par9">A common task for integrative visualization is to study how various genomic signals are enriched over specific genomic targets. Genomic signals can be represented as numeric values associating genomic locations, e.g. reads coverage in windows from whole genome sequencing data, DNA methylation rates for CpG sites from whole genome bisulfite sequencing data, or the intensities of histone modification in peak regions from ChIP sequencing data. The associated genomic signal values can also be binary to represent the existence of genomic features in the genome. While genomic targets are also genomic regions where the enrichment patterns are visualized. In many cases, genomic targets are gene-related features such as transcription start sites (TSS) or gene body. Generally, it can be any type of genomic features of interest, e.g. CpG islands (CGIs) if the aim is to study the methylation change at CGI borders. Current tools such as <italic>deeptools</italic> [<xref ref-type="bibr" rid="CR2">2</xref>] and <italic>ngs.plot</italic> [<xref ref-type="bibr" rid="CR3">3</xref>] are broadly used and successful at revealing potential enrichment patterns. However, they are limited at handling more complex cases without using external software, e.g. to summarize enrichment of signals difference of histone modifications between two subgroups of samples, or to visualize the correlation pattern between DNA methylation and expression of associated genes around TSS. Additionally, as stand-alone software tools, they are restricted to their built-in functionalities. For example, <italic>deeptools</italic> only supports to order rows by simple statistics such as row means in the heatmap, while it depends on external software to calculate more specific row orderings. <italic>Genomation</italic> [<xref ref-type="bibr" rid="CR4">4</xref>] is an R package which visualizes enrichment for multiple types of signals simultaneously, but the functionality is very limited and difficult for more complex visualizations.</p>
    <p id="Par10">Here we present a new R package named <italic>EnrichedHeatmap</italic> that provides advanced and extensible solutions for summarizing and organizing enrichment heatmaps. Compared to available tools, the major advantages of <italic>EnrichedHeatmap</italic> are: 1) it is built on the framework of <italic>ComplexHeatmap</italic> package [<xref ref-type="bibr" rid="CR5">5</xref>], thus enriched heatmaps can be flexibly combined with normal heatmaps and row annotation graphics, which makes it easy to integrate additional information to build complete overviews of the associations in complex datasets; 2) ordering and subgrouping rows in heatmaps are important for highlighting and comparing enrichment patterns. <italic>EnrichedHeatmap</italic> supports ordering methods such as pre-calculated orderings or flexible hierarchical clustering methods. <italic>EnrichedHeatmap</italic> also proposes new methods based on the closeness of signals regions relative to genomic targets to visualize how consistently close the signals are enriched to target regions. Also <italic>EnrichedHeatmap</italic> supports splitting of rows in heatmaps into groups by broad partitioning methods in R such as <italic>k</italic>-means or <italic>k</italic>-medoid clustering, or simply by a pre-defined category variable; 3) <italic>EnrichedHeatmap</italic> supports several methods to summarize mean signals for different types of genomic signals, depending on whether they are single point position-based signals or region-based signals. It also supports row smoothing to enhance the visual effect of the enrichment; 4) <italic>EnrichedHeatmap</italic> is capable of visualizing discrete signals such as chromatin state segmentations from <italic>ChromHMM</italic> [<xref ref-type="bibr" rid="CR6">6</xref>]; 5) <italic>EnrichedHeatmap</italic> utilizes the <italic>GRanges</italic> data structure [<xref ref-type="bibr" rid="CR7">7</xref>] which is the base data structure for handling genomic data in R and thus it can be seamlessly integrated into Bioconductor workflows; The power of <italic>EnrichedHeatmap</italic> is demonstrated by comprehensive visualization of various epigenomic signals over gene TSS to show the complex transcriptional regulation patterns.</p>
  </sec>
  <sec id="Sec2">
    <title>Implementation</title>
    <p id="Par11">Generally, the visualization of the signal enrichment over genomic targets can be standardized into two major steps where associations between genomic signals and target regions are firstly normalized into matrices and secondly the matrices are visualized as heatmaps with methods specifically for ordering rows to strengthen the pattern of enrichment. In this section, we describe the implementation of <italic>EnrichedHeatmap</italic> in detail and highlight the advantages and uniqueness of <italic>EnrichedHeatmap</italic> compared to other available tools.</p>
    <sec id="Sec3">
      <title>Normalize the associations</title>
      <p id="Par12">For a specific type of genomic signal (e.g. DNA methylation at CpG sites), associations to target regions are firstly normalized into a matrix where rows correspond to target regions e.g. gene-related regions and columns correspond to genomic windows around the targets. Target regions are extended upstream and/or downstream and the flanking regions are split into small windows of equal size. Each target is split into <italic>k</italic> windows as well with<disp-formula id="Equa"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ k=\left({n}_1+{n}_2\right)\bullet r/\left(1-r\right) $$\end{document}</tex-math><mml:math id="M2" display="block"><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mfenced><mml:mo>∙</mml:mo><mml:mi>r</mml:mi><mml:mo>/</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="12864_2018_4625_Article_Equa.gif" position="anchor"/></alternatives></disp-formula>where <italic>n</italic><sub>1</sub> is the number of upstream windows, <italic>n</italic><sub>2</sub> is the number of downstream windows and <italic>r</italic> is the ratio of target columns presented in the matrix. Note, due to the unequal widths of target regions, widths of the windows inside targets are different for different targets as well. The default value of <italic>r</italic> is set as follows to ensures the mean width of target windows is the same as the width of upstream/downstream windows:<disp-formula id="Equb"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ r={\mu}_L/\left({\mu}_L+{L}_1+{L}_2\right) $$\end{document}</tex-math><mml:math id="M4" display="block"><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>/</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>L</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>L</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="12864_2018_4625_Article_Equb.gif" position="anchor"/></alternatives></disp-formula>where μ<sub>L</sub> is the mean width of target regions. <italic>L</italic><sub>1</sub> and <italic>L</italic><sub>2</sub> are extensions of target regions in upstream and downstream.</p>
      <p id="Par13">It is highly possible that multiple genomic signals overlap to one single window e.g. multiple CpG sites locating in one window, or one genomic signal spanning multiple windows. To summarize mean signal in every window, <italic>EnrichedHeatmap</italic> provides four averaging methods to summarize the signals for the window depending on whether the averaging is applied with background or not. As illustrated in Fig. <xref rid="Fig1" ref-type="fig">1a</xref>, for a given window (marked as red line), denote <italic>n</italic> as the number of signal regions which overlap to the window (it is 5 in Fig. <xref rid="Fig1" ref-type="fig">1a</xref>), <italic>w</italic><sub><italic>i</italic></sub> as the width of the intersected segment (black thick lines) for the <italic>i</italic><sup>th</sup> signal region, and <italic>x</italic><sub><italic>i</italic></sub> as the value associated with the signal region. If there is no value associated with the signal regions, <italic>EnrichedHeatmap</italic> sets <italic>x</italic><sub><italic>i</italic></sub> = 1 by default.<fig id="Fig1"><label>Fig. 1</label><caption><p>Implementation of EnrichedHeatmap. <bold>a</bold> Averaging model. The red line represents one window in the target regions or in the flanking regions when normalizing genomic signals to target regions. Black lines represent genomic signals that overlap to the given window. <bold>b</bold> Comparison between original methylation values and smoothed values. Grey color means no available methylation value associated for the window. Methylation data is from lung tissue in Roadmap dataset. Only data on chromosome 21 is used. Note the two heatmaps are independent and have different orderings. <bold>c</bold> Comparison between different row ordering methods. The three heatmaps correspond to ordering by enriched scores, by hierarchical clustering with Euclidean distance and by hierarchical clustering with closeness distance. The genomic signals are regions showing significant negative correlation between DNA methylation and expression of target genes</p></caption><graphic xlink:href="12864_2018_4625_Fig1_HTML" id="MO1"/></fig></p>
      <p id="Par14">The “absolute” method denoted as <italic>v</italic><sub><italic>a</italic></sub> simply calculates the mean value from all signal regions regardless of their width:<disp-formula id="Equc"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {v}_a=\frac{\sum_{i=1}^n{x}_i}{n} $$\end{document}</tex-math><mml:math id="M6" display="block"><mml:msub><mml:mi>v</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mi>n</mml:mi></mml:mfrac></mml:math><graphic xlink:href="12864_2018_4625_Article_Equc.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par15">The “weighted” method denoted as <italic>v</italic><sub><italic>w</italic></sub> calculates the mean value from all signal regions weighted by the width of their intersections:<disp-formula id="Equd"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {v}_w=\frac{\sum_{i=1}^n{x}_i{w}_i}{\sum_{i=1}^n{w}_i} $$\end{document}</tex-math><mml:math id="M8" display="block"><mml:msub><mml:mi>v</mml:mi><mml:mi>w</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="12864_2018_4625_Article_Equd.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par16">“Absolute” and “weighted” methods are applied when background values should not be taken into consideration. For example, when summarizing mean DNA methylation in a window, non-CpG background should always be ignored, because methylation is only associated with CpG sites.</p>
      <p id="Par17">The “w0” method denote as <italic>v</italic><sub><italic>w</italic>0</sub> calculates the weighted mean between the intersected segments and un-intersected parts:<disp-formula id="Eque"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {v}_{w0}=\frac{\sum_{i=1}^n{x}_i{w}_i}{W+{W}^{\prime }} $$\end{document}</tex-math><mml:math id="M10" display="block"><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>w</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>W</mml:mi><mml:mo>+</mml:mo><mml:msup><mml:mi>W</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="12864_2018_4625_Article_Eque.gif" position="anchor"/></alternatives></disp-formula>where <italic>W</italic> is the sum of width of all intersected segments (<inline-formula id="IEq1"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ W={\sum}_{i=1}^n{w}_i $$\end{document}</tex-math><mml:math id="M12" display="inline"><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12864_2018_4625_Article_IEq1.gif"/></alternatives></inline-formula>) and <italic>W′</italic> is the sum of width of the non-intersected parts. For example, the “w0” method can be applied to summarize mean histone modification intensity or mean CG content in a given window.</p>
      <p id="Par18">The “coverage” method denoted as <italic>v</italic><sub><italic>c</italic></sub> is defined as the mean signal averaged by the width of the window:<disp-formula id="Equf"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {v}_c=\frac{\sum_i^n{x}_i{w}_i}{L} $$\end{document}</tex-math><mml:math id="M14" display="block"><mml:msub><mml:mi>v</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mi>L</mml:mi></mml:mfrac></mml:math><graphic xlink:href="12864_2018_4625_Article_Equf.gif" position="anchor"/></alternatives></disp-formula>where <italic>L</italic> is the width of the window itself. Note when <italic>x</italic><sub><italic>i</italic></sub> = 1, <italic>v</italic><sub><italic>c</italic></sub> is the mean base pair coverage for the signal regions overlapped in the window. Since signal regions may overlap to each other, thus <italic>L</italic> ≤ <italic>W</italic> + <italic>W′</italic>. When signal regions do not overlap to each other, “w0” method and “coverage” method are identical.</p>
      <p id="Par19"><italic>EnrichedHeatmap</italic> is capable of visualizing discrete signals. For a list of signals with <italic>n</italic> levels, internally <italic>n</italic> normalized matrices with “coverage” method are generated where each matrix corresponds to the enrichment of signal regions with one single signal level. When summarizing from <italic>n</italic> matrices into one final matrix, the signal levels are recoded with their numeric level orders, and for a single window, the numeric order of the signal level which shows maximum coverage is assigned to it. If none of the signal region overlaps to this window, zero value is assigned. <italic>EnrichedHeatmap</italic> has special visualization designed for discrete signal enrichment and since the final matrix is numeric, rows can be reordered by hierarchical clustering or partitioned by <italic>k</italic>-means clustering. Examples of visualizing discrete signals can be found in vignettes of the package.</p>
      <p id="Par20"><italic>EnrichedHeatmap</italic> supports smoothing of the average signals in the normalized matrix by local regression [<xref ref-type="bibr" rid="CR8">8</xref>] or loess regression. It also imputes missing values by smoothing when no background value is provided. These functionalities particularly improve visualization for genomic signals that might be sparse in some parts of the genome, e.g. DNA methylation signals distal from CpG islands. On the other hand, a lot of other methods can be used to enhance <italic>EnrichedHeatmap</italic> only with a complete matrix without missing values, e.g. hierarchical clustering for row orderings. Figure <xref rid="Fig1" ref-type="fig">1b</xref> compares original methylation and smoothed methylation signals around gene TSS where rows are ordered by enriched scores (The definition of enriched scores will be introduced in a later section). It clearly shows smoothing dramatically improves the row ordering and the visual effect of the methylation heatmap. Since it can be possible that no CpG site exists in certain windows (window size is 50 bp in the two heatmaps in Fig. <xref rid="Fig1" ref-type="fig">1b</xref>) thus with no methylation values associated, it results in many grey grids in the first heatmap which represent missing values, which significantly disturbs the visualization. As a comparison, after smoothing and missing value imputation, it gives a clean and continuous methylation pattern in the heatmap. Although it might not be biologically correct to assign methylation values to non-CpG windows, it greatly improves the exploratory interpretability of the data.</p>
      <p id="Par21"><italic>EnrichedHeatmap</italic> additionally supports a special scenario which associates signals to targets by mappings if the connections between signals and targets have already been constructed. By default, <italic>EnrichedHeatmap</italic> tries to overlap every signal region to every target region. However, there can be prior knowledge of the relations between signals and targets. In the example in Fig. <xref rid="Fig2" ref-type="fig">2</xref> (this example will be discussed in detail in later section), we have defined a type of region named “correlated region” where it shows significant correlations between DNA methylation and expression of the host gene, in other words, there is already a gene associated to each correlated region. When normalizing correlated regions to gene TSS, it is possible that TSS of two genes are very close, and thus, correlated regions can be wrongly assigned to multiple genes if ignoring mappings between correlated regions and genes.<fig id="Fig2"><label>Fig. 2</label><caption><p>Comprehensive visualization of associations between gene expression, DNA methylation and four histone modifications from Roadmap dataset. In both top and bottom heatmap lists, rows correspond to same genes with different signals associated. Detailed explanation of data processing and R code for the plot can be found in Additional file <xref rid="MOESM1" ref-type="media">1</xref></p></caption><graphic xlink:href="12864_2018_4625_Fig2_HTML" id="MO2"/></fig></p>
    </sec>
    <sec id="Sec4">
      <title>Heatmap visualization</title>
      <p id="Par22">The normalized matrix is essentially a normal matrix with extra enrichment parameters attached. <italic>EnrichedHeatmap</italic> inherits and extends the <italic>ComplexHeatmap</italic> package, thus it provides great flexibility to arrange heatmaps as well as complex annotations, which is unique compared to other tools. On top of enriched heatmaps is a special type of annotation graphic which summarizes the enrichment across targets and can be directly corresponded to the patterns in the heatmap. An important feature of this annotation is it supports to summarize the positive and negative signals separately if signals to visualize are correlations or difference between subgroups (e.g. heatmap “meth_corr” in Fig. <xref rid="Fig2" ref-type="fig">2</xref>). Enrichment patterns are summarized separately if heatmaps are split by rows by <italic>k</italic>-means clustering or any pre-defined partitioning variables. With the framework of <italic>ComplexHeatmap</italic>, the enriched heatmaps can be concatenated with normal heatmaps as well as row annotations simply by “+” operator:</p>
      <p id="Par23">
EnrichedHeatmap(…) + Heatmap(…) + rowAnnotation(…) + …
</p>
      <p id="Par24">where the rows in all heatmaps and row annotations correspond and the main heatmap can be chosen to globally control the row ordering and subgrouping of all heatmaps.</p>
      <p id="Par25">Row ordering for the normalized matrix is crucial to enhance the patterns of enrichment. Rows can be ordered by certain types of scores calculated by rows (e.g. row means) or by clustering methods implemented in base or extended packages in R. <italic>EnrichedHeatmap</italic> provides two additional row ordering methods:<list list-type="order"><list-item><p id="Par26"><italic>Rows are ordered by enriched scores.</italic> For each row in the normalized matrix, denote the vector for the associated values as <bold><italic>x</italic></bold> and it is split into <bold><italic>x</italic></bold><sub><bold>1</bold></sub>, <bold><italic>x</italic></bold><sub><bold>2</bold></sub> and <bold><italic>x</italic></bold><sub><bold>3</bold></sub> which correspond to values in upstream of the target, target itself and downstream of the target. The corresponding lengths of the three sub-vectors are denoted as <italic>n</italic><sub>1</sub>, <italic>n</italic><sub>2</sub> and <italic>n</italic><sub>3</sub>. The enriched score denoted as <italic>s</italic><sub><italic>e</italic></sub> is calculated as the sum of <bold><italic>x</italic></bold> weighted by the distance to target.</p></list-item></list></p>
      <p id="Par27">
        <disp-formula id="Equg">
          <alternatives>
            <tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {s}_e={\sum}_{i=1}^{n_1}{x}_{1i}\bullet \frac{i}{n_1}+{\sum}_{k=1}^{n_2}{x}_{2k}\bullet \left|{n}_2/2-\left|k-{n}_2/2\right|\right|+{\sum}_{j=1}^{n_3}{x}_{3j}\bullet \frac{n_3-j+1}{n_3} $$\end{document}</tex-math>
            <mml:math id="M16" display="block">
              <mml:msub>
                <mml:mi>s</mml:mi>
                <mml:mi>e</mml:mi>
              </mml:msub>
              <mml:mo>=</mml:mo>
              <mml:msubsup>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:msub>
                  <mml:mi>n</mml:mi>
                  <mml:mn>1</mml:mn>
                </mml:msub>
              </mml:msubsup>
              <mml:msub>
                <mml:mi>x</mml:mi>
                <mml:mrow>
                  <mml:mn>1</mml:mn>
                  <mml:mi>i</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:mo>∙</mml:mo>
              <mml:mfrac>
                <mml:mi>i</mml:mi>
                <mml:msub>
                  <mml:mi>n</mml:mi>
                  <mml:mn>1</mml:mn>
                </mml:msub>
              </mml:mfrac>
              <mml:mo>+</mml:mo>
              <mml:msubsup>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>k</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:msub>
                  <mml:mi>n</mml:mi>
                  <mml:mn>2</mml:mn>
                </mml:msub>
              </mml:msubsup>
              <mml:msub>
                <mml:mi>x</mml:mi>
                <mml:mrow>
                  <mml:mn>2</mml:mn>
                  <mml:mi>k</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:mo>∙</mml:mo>
              <mml:mfenced close="|" open="|">
                <mml:mrow>
                  <mml:msub>
                    <mml:mi>n</mml:mi>
                    <mml:mn>2</mml:mn>
                  </mml:msub>
                  <mml:mo>/</mml:mo>
                  <mml:mn>2</mml:mn>
                  <mml:mo>−</mml:mo>
                  <mml:mfenced close="|" open="|">
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>−</mml:mo>
                      <mml:msub>
                        <mml:mi>n</mml:mi>
                        <mml:mn>2</mml:mn>
                      </mml:msub>
                      <mml:mo>/</mml:mo>
                      <mml:mn>2</mml:mn>
                    </mml:mrow>
                  </mml:mfenced>
                </mml:mrow>
              </mml:mfenced>
              <mml:mo>+</mml:mo>
              <mml:msubsup>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>j</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:msub>
                  <mml:mi>n</mml:mi>
                  <mml:mn>3</mml:mn>
                </mml:msub>
              </mml:msubsup>
              <mml:msub>
                <mml:mi>x</mml:mi>
                <mml:mrow>
                  <mml:mn>3</mml:mn>
                  <mml:mi>j</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:mo>∙</mml:mo>
              <mml:mfrac>
                <mml:mrow>
                  <mml:msub>
                    <mml:mi>n</mml:mi>
                    <mml:mn>3</mml:mn>
                  </mml:msub>
                  <mml:mo>−</mml:mo>
                  <mml:mi>j</mml:mi>
                  <mml:mo>+</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:msub>
                  <mml:mi>n</mml:mi>
                  <mml:mn>3</mml:mn>
                </mml:msub>
              </mml:mfrac>
            </mml:math>
            <graphic xlink:href="12864_2018_4625_Article_Equg.gif" position="anchor"/>
          </alternatives>
        </disp-formula>
      </p>
      <p id="Par28">Generally, when there is more signal centred on the target region, it has a higher enriched score.<list list-type="simple"><list-item><label>2.</label><p id="Par29"><italic>Rows are ordered by hierarchical clustering with closeness distance.</italic> The column order in the normalized matrix represents the spatial order of windows located from upstream to downstream of the target. <italic>EnrichedHeatmap</italic> defines the closeness distance to measure how spatially close the signal regions of two different targets are based on the relative distance to targets. For any two rows in the normalized matrix where the associated values are denoted as <bold><italic>x</italic></bold> and <bold><italic>y</italic></bold>, the distance based on closeness of signal regions in the two rows is defined as:</p></list-item></list></p>
      <p id="Par30">
        <disp-formula id="Equh">
          <alternatives>
            <tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {d}_{closeness}=\frac{\sum_{i=1}^n{\sum}_{j=1}^n\left|i-j\right|\bullet I\left(i,j\right)}{\sum_{i=1}^n{\sum}_{j=1}^nI\left(i,j\right)} $$\end{document}</tex-math>
            <mml:math id="M18" display="block">
              <mml:msub>
                <mml:mi>d</mml:mi>
                <mml:mtext mathvariant="italic">closeness</mml:mtext>
              </mml:msub>
              <mml:mo>=</mml:mo>
              <mml:mfrac>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                  <mml:msubsup>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>j</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                  <mml:mfenced close="|" open="|">
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>−</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:mfenced>
                  <mml:mo>∙</mml:mo>
                  <mml:mi>I</mml:mi>
                  <mml:mfenced close=")" open="(" separators=",">
                    <mml:mi>i</mml:mi>
                    <mml:mi>j</mml:mi>
                  </mml:mfenced>
                </mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                  <mml:msubsup>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>j</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                  <mml:mi>I</mml:mi>
                  <mml:mfenced close=")" open="(" separators=",">
                    <mml:mi>i</mml:mi>
                    <mml:mi>j</mml:mi>
                  </mml:mfenced>
                </mml:mrow>
              </mml:mfrac>
            </mml:math>
            <graphic xlink:href="12864_2018_4625_Article_Equh.gif" position="anchor"/>
          </alternatives>
        </disp-formula>
        <disp-formula id="Equi">
          <alternatives>
            <tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ I\left(i,j\right)=\left\{\begin{array}{c}1,\kern0.5em {x}_i\ne 0\ \mathrm{and}\ {y}_j\ne 0\\ {}0,\kern0.5em \mathrm{else}\end{array}\right. $$\end{document}</tex-math>
            <mml:math id="M20" display="block">
              <mml:mi>I</mml:mi>
              <mml:mfenced close=")" open="(" separators=",">
                <mml:mi>i</mml:mi>
                <mml:mi>j</mml:mi>
              </mml:mfenced>
              <mml:mo>=</mml:mo>
              <mml:mfenced close="" open="{">
                <mml:mtable>
                  <mml:mtr>
                    <mml:mtd>
                      <mml:maligngroup/>
                      <mml:mn>1</mml:mn>
                      <mml:mo>,</mml:mo>
                      <mml:mspace width="0.5em"/>
                      <mml:malignmark/>
                      <mml:msub>
                        <mml:mi>x</mml:mi>
                        <mml:mi>i</mml:mi>
                      </mml:msub>
                      <mml:mo>≠</mml:mo>
                      <mml:mn>0</mml:mn>
                      <mml:mspace width="0.25em"/>
                      <mml:mtext>and</mml:mtext>
                      <mml:mspace width="0.25em"/>
                      <mml:msub>
                        <mml:mi>y</mml:mi>
                        <mml:mi>j</mml:mi>
                      </mml:msub>
                      <mml:mo>≠</mml:mo>
                      <mml:mn>0</mml:mn>
                    </mml:mtd>
                  </mml:mtr>
                  <mml:mtr>
                    <mml:mtd>
                      <mml:maligngroup/>
                      <mml:mn>0</mml:mn>
                      <mml:mo>,</mml:mo>
                      <mml:mspace width="0.5em"/>
                      <mml:malignmark/>
                      <mml:mtext>else</mml:mtext>
                    </mml:mtd>
                  </mml:mtr>
                </mml:mtable>
              </mml:mfenced>
            </mml:math>
            <graphic xlink:href="12864_2018_4625_Article_Equi.gif" position="anchor"/>
          </alternatives>
        </disp-formula>
      </p>
      <p id="Par31">Figure <xref rid="Fig1" ref-type="fig">1c</xref> compares row ordering by enriched scores, hierarchical clustering with Euclidean distance and hierarchical clustering with closeness distance. Note dendrograms generated by hierarchical clustering for rows in the latter two heatmaps are additionally reordered by the enriched scores to place enrichment patterns that are close to targets to the top of the heatmap as much as possible. Generally, when the top annotation which summarises mean enrichment across targets is added to the heatmap as well, ordering rows merely by enriched scores is not recommended because it provides redundant information as the top enriched annotation (left heatmap in Fig. <xref rid="Fig1" ref-type="fig">1c</xref>), and on the other hand, it fails to reveal spatial clusters as the other two methods. While hierarchal clustering with Euclidean distance is good at clustering enrichment patterns, it does not take column order into account, thus, it still can be possible that two spatially close clusters are separated in the heatmap (middle heatmap in Fig. <xref rid="Fig1" ref-type="fig">1c</xref>). By using closeness distance, it clearly sorts and clusters the enrichment patterns (right heatmap in Fig. <xref rid="Fig1" ref-type="fig">1c</xref>).</p>
    </sec>
  </sec>
  <sec id="Sec5">
    <title>Results</title>
    <p id="Par32">Figure <xref rid="Fig2" ref-type="fig">2</xref> visualizes complex associations between gene expression, DNA methylation, and four histone modifications over gene TSS through a list of heatmaps by using Roadmap dataset [<xref ref-type="bibr" rid="CR9">9</xref>]. In the analysis, 27 samples are separated into two subgroups that correspond to embryonic cells and mature cells. Rows are split according to differential expression and methylation pattern into three clusters. In each row cluster, rows are clustered based on the closeness of regions showing significant negative correlation between methylation and gene expression (we term them as “negCR”). For methylation and each histone modification, three heatmaps are used to illustrate the correlation to gene expression as well as the distribution of the signal among samples (by mean signals across all samples and mean signal differences between two subgroups). All heatmaps and annotations are arranged into two lines and rows in all heatmaps correspond to same genes. The top 10 most significantly differentially expressed genes between embryonic and mature cells are marked on left of the expression heatmap. A detailed explanation of data processing and step-by-step explanation of the R code can be found in Additional file <xref rid="MOESM1" ref-type="media">1</xref>.</p>
    <p id="Par33">Generally, genes in cluster 1 and 2 have high expression, long gene length (annotation “Gene length”) and low methylation over TSS (heatmap “meth_mean”) which correspond well with the enrichment of CpG islands over TSS (heatmap “CGI”), while genes in cluster 3 have low expression, short gene length, and intermediate mean methylation with almost no CGIs overlapping TSS. There is enrichment for significant negative CRs (negCRs) downstream of TSS in cluster 1 and 2 (solid and dashed green lines in annotation of “meth_corr” heatmap, the peaks of the enrichment locate at approximately + 2 kb of TSS.) while for cluster 3 genes, the enrichment of negCRs is very close to TSS. By associating the heatmap “CGI”, “meth_corr”, “meth_mean” and “meth_diff” together, we can make the conclusion that for genes in cluster 1 and 2, negCRs are enriched at the downstream border of CGI over TSS with high methylation variability, and even for cluster 3 genes there is also a trend that the negCRs are enriched at close downstream of TSS. This gives rise to the hypothesis that transcription factors can bind to chromatin in the gene body (in the lowly methylated negCRs) and are prevented to bind or move further into the gene body by DNA methylation after the negCRs.</p>
    <p id="Par34">H3K4me3 is a histone mark which is enriched at active TSS or promoters. Heatmap “H3K4me3_mean” shows strong enrichment of the mean signal over TSS for cluster 1 and cluster 2 genes with high expression. Such enrichment corresponds very well to the low TSS DNA-methylation. Interestingly, strong positive correlation to expression dominates in cluster 1 and the signals are significantly higher in embryonic cells (heatmap “H3K4me3_diff”). The peak for the enrichment of correlation signals in cluster 1 (solid red line in annotation of heatmap “H3K4me3_corr”) is broader than the mean signals while it is very similar as the enrichment peak for negCRs. For cluster 2 genes, the regions showing positive correlations are enriched at downstream border of H3K4me3 peaks while directly at the H3K4me3 peaks shows negative correlation although the correlation signals are weak and signal difference is small. Surprisingly, strong positive correlations dominate cluster 3 although the mean signals are very weak.</p>
    <p id="Par35">H3K4me1 is an active mark enriched at enhancers and promoter flanking regions. Nevertheless, it shows negative correlation at the TSS (solid and dashed green lines in annotation of heatmap “H3K4me1_corr”), especially strong for cluster 1. The peak for the negative correlation enrichment correlates well with CGI and low TSS-methylation, however the signals are low at TSS (heatmap “H3K4me1_mean”). Flanking TSS is dominated by positive correlations and the signal difference is comparably large in cluster 1 (solid brown line in annotation of heatmap “H3K4me1_diff”).</p>
    <p id="Par36">H3K27ac is also an active mark enriched in both active enhancers and promoters, and it generally shows positive correlations to expression in all three clusters (heatmap “H3K27ac_corr”). Interestingly the mean signals are the strongest in cluster 2 and mature cells have significantly higher signal intensity than embryonic cells (dashed blue line in annotation of heatmap “H3K27ac_diff”). The peak for the correlation signal enrichment is comparably broader than other marks.</p>
    <p id="Par37">H3K27me3 is a repressive mark and it generally shows negative correlation around TSS at relatively low level, excluding cluster 1 where there are no dominant correlation patterns (heatmap “H3K27me3_corr”). The signals are lower and sparser compared to other marks.</p>
  </sec>
  <sec id="Sec6">
    <title>Discussion</title>
    <p id="Par38">The heatmap visualization provides an intuitive way of showing the spatial associations between genomic signals and target regions. Here we have developed the <italic>EnrichedHeatmap</italic> package which facilitates the discovery of enrichment pattern of such associations. <italic>EnrichedHeatmap</italic> is capable of processing continuous signals, binary signals and discrete signals, and it provides different normalization methods for different types of genomic signals. More importantly, <italic>EnrichedHeatmap</italic> allows associating multiple sources of information through parallel heatmaps and annotations in an easy and modular way, which greatly facilitates the integrative analysis with multiple omic datasets.</p>
    <p id="Par39">The parallel heatmap visualization brings difficulty of setting proper row orders to discover patterns in all heatmaps simultaneously. Most of the available tools simply order rows based on the row means of the normalized matrix, which actually loses the information of how spatially similar the signal regions distribute in different target regions. Here we recommend ordering rows by hierarchical clustering on the normalized matrix as it highlights similar patterns for the signal regions that locate in spatially similar neighborhood of their associated target regions. Another difficulty raised is since there are multiple heatmaps that contain different data types, selecting a main heatmap to perform hierarchical clustering is also crucial for better displaying the association patterns. The solution to this problem depends on what key message users want to present. In Fig. <xref rid="Fig2" ref-type="fig">2</xref>, the hierarchical clustering is applied on the negCR matrix because the key message of the visualization is to show the association pattern between DNA methylation and gene expression around gene TSS. Moreover, since columns in the normalized matrix correspond to spatial distance to target regions, only clustering rows on subset of matrix which shows strong enrichment patterns helps to give a clearer view of the underlying pattern. E.g. in the vignette along with the package where the association between chromatin states and gene TSS is visualized, the row clustering is only applied to the subset of matrix which corresponds to 1 kb upstream and downstream of gene TSS because we observe there are very strong and consistent enrichment of active and bivalent TSS states in it while in flanking regions the chromatin states are more diverse and inconsistent.</p>
    <p id="Par40">Splitting rows in heatmaps helps to enhance the distinct patterns in different categories of target regions. <italic>EnrichedHeatmap</italic> allows splitting rows either by categorical variables or by <italic>k</italic>-means clustering. Generally speaking, the choice of how to split rows should be biological meaningful. In Fig. <xref rid="Fig2" ref-type="fig">2</xref>, rows of all heatmaps are split according to the methylation in 1 kb upstream and 2 kb downstream of gene TSS because we observe the methylation shows distinct difference and in the content of the analysis, methylation difference at gene TSS is always a dominant mark of transcription regulation.</p>
  </sec>
  <sec id="Sec7">
    <title>Conclusions</title>
    <p id="Par41">The <italic>EnrichedHeatmap</italic> package provides a flexible and powerful way to simultaneously visualize enrichment of various genomic signals over target regions. We believe it will be a useful tool for R/Bioconductor workflows to allow for more comprehensive understanding of high dimensional genomic and epigenomic data.</p>
  </sec>
  <sec id="Sec8">
    <title>Availability and requirements</title>
    <p id="Par42">
      <bold>Project name:</bold>
      <italic>EnrichedHeatmap</italic>
    </p>
    <p id="Par43"><bold>Project home page:</bold><ext-link ext-link-type="uri" xlink:href="http://bioconductor.org/packages/EnrichedHeatmap/">http://bioconductor.org/packages/EnrichedHeatmap/</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://github.com/jokergoo/EnrichedHeatmap">https://github.com/jokergoo/EnrichedHeatmap</ext-link></p>
    <p id="Par44"><bold>Operation systems:</bold> Platform independent</p>
    <p id="Par45"><bold>Programming language:</bold> R (&gt; = 3.3.0)</p>
    <p id="Par46"><bold>License:</bold> GPL (&gt; = 2)</p>
    <p id="Par47"><bold>Restrictions to use by non-academics:</bold> None</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Additional files</title>
    <sec id="Sec9">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="12864_2018_4625_MOESM1_ESM.gz">
            <label>Additional file 1:</label>
            <caption>
              <p>Data and source code for producing Figs. <xref rid="Fig1" ref-type="fig">1</xref> and <xref rid="Fig2" ref-type="fig">2</xref>. (GZ 45195 kb)</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>CGI</term>
        <def>
          <p id="Par4">CpG islands</p>
        </def>
      </def-item>
      <def-item>
        <term>CR</term>
        <def>
          <p id="Par5">Correlated regions</p>
        </def>
      </def-item>
      <def-item>
        <term>negCR</term>
        <def>
          <p id="Par6">Significantly negatively correlated regions</p>
        </def>
      </def-item>
      <def-item>
        <term>TSS</term>
        <def>
          <p id="Par7">Transcription start sites</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Electronic supplementary material</bold>
      </p>
      <p>The online version of this article (10.1186/s12864-018-4625-x) contains supplementary material, which is available to authorized users.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>Not applicable.</p>
    <sec id="FPar1">
      <title>Funding</title>
      <p id="Par48">This work was supported by the German Cancer Research Center-Heidelberg Center for Personalized Oncology (DKFZ-HIPO) and the BMBF-funded de.NBI HD-HuB network (#031A537A, #031A537C).</p>
    </sec>
    <sec id="FPar2">
      <title>Availability of data and materials</title>
      <p id="Par49">The whole genome bisulfite sequencing data for lung tissue from Roadmap project (<ext-link ext-link-type="uri" xlink:href="http://egg2.wustl.edu/roadmap/web_portal/">http://egg2.wustl.edu/roadmap/web_portal/</ext-link>) was used to produce Fig. <xref rid="Fig1" ref-type="fig">1</xref> and the complete Roadmap dataset was used to produce Fig. <xref rid="Fig2" ref-type="fig">2</xref>. Detailed explanation of data processing and R code for the analysis can be found in Additional file <xref rid="MOESM1" ref-type="media">1</xref>.</p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>ZG implemented the package and drafted the manuscript. ZG and NI interpreted data. RE, MS and NI supervised the project and critically revised the manuscript. All authors conceived the project, have read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="COI-statement">
    <sec id="FPar3">
      <title>Ethics approval and consent to participate</title>
      <p id="Par50">Not applicable.</p>
    </sec>
    <sec id="FPar4">
      <title>Consent for publication</title>
      <p id="Par51">Not applicable.</p>
    </sec>
    <sec id="FPar5">
      <title>Competing interests</title>
      <p id="Par52">The authors declare that they have no competing interests.</p>
    </sec>
    <sec id="FPar6">
      <title>Publisher’s Note</title>
      <p id="Par53">Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </sec>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stricker</surname>
            <given-names>SH</given-names>
          </name>
          <name>
            <surname>Köferle</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Beck</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>From profiles to function in epigenomics</article-title>
        <source>Nat Rev Genet</source>
        <year>2016</year>
        <volume>18</volume>
        <fpage>51</fpage>
        <lpage>66</lpage>
        <pub-id pub-id-type="doi">10.1038/nrg.2016.138</pub-id>
        <?supplied-pmid 27867193?>
        <pub-id pub-id-type="pmid">27867193</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ramírez</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Dündar</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Diehl</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Grüning</surname>
            <given-names>BA</given-names>
          </name>
          <name>
            <surname>Manke</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>deepTools: a flexible platform for exploring deep-sequencing data</article-title>
        <source>Nucleic Acids Res</source>
        <year>2014</year>
        <volume>42</volume>
        <fpage>W187</fpage>
        <lpage>W191</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gku365</pub-id>
        <?supplied-pmid 24799436?>
        <pub-id pub-id-type="pmid">24799436</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Shao</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Nestler</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>ngs.plot: Quick mining and visualization of next-generation sequencing data by integrating genomic databases</article-title>
        <source>BMC Genomics</source>
        <year>2014</year>
        <volume>15</volume>
        <fpage>284</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2164-15-284</pub-id>
        <?supplied-pmid 24735413?>
        <pub-id pub-id-type="pmid">24735413</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Akalin</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Franke</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Vlahovi ek</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Mason</surname>
            <given-names>CE</given-names>
          </name>
          <name>
            <surname>Schubeler</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Genomation: a toolkit to summarize, annotate and visualize genomic intervals</article-title>
        <source>Bioinformatics</source>
        <year>2015</year>
        <volume>31</volume>
        <fpage>1127</fpage>
        <lpage>1129</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btu775</pub-id>
        <?supplied-pmid 25417204?>
        <pub-id pub-id-type="pmid">25417204</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Eils</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Schlesner</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Complex heatmaps reveal patterns and correlations in multidimensional genomic data</article-title>
        <source>Bioinformatics</source>
        <year>2016</year>
        <volume>32</volume>
        <fpage>2847</fpage>
        <lpage>2849</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw313</pub-id>
        <?supplied-pmid 27207943?>
        <pub-id pub-id-type="pmid">27207943</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ernst</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Kellis</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Chromatin-state discovery and genome annotation with ChromHMM</article-title>
        <source>Nat Protoc</source>
        <year>2017</year>
        <volume>12</volume>
        <fpage>2478</fpage>
        <lpage>2492</lpage>
        <pub-id pub-id-type="doi">10.1038/nprot.2017.124</pub-id>
        <?supplied-pmid 29120462?>
        <pub-id pub-id-type="pmid">29120462</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lawrence</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Huber</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Pagès</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Aboyoun</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Carlson</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gentleman</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Software for computing and annotating genomic ranges</article-title>
        <source>PLoS Comput Biol</source>
        <year>2013</year>
        <volume>9</volume>
        <fpage>e1003118</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1003118</pub-id>
        <?supplied-pmid 23950696?>
        <pub-id pub-id-type="pmid">23950696</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Loader</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <source>locfit: local regression, likelihood and density estimation</source>
        <year>2013</year>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kundaje</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Meuleman</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Ernst</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Bilenky</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Yen</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Heravi-Moussavi</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrative analysis of 111 reference human epigenomes</article-title>
        <source>Nature</source>
        <year>2015</year>
        <volume>518</volume>
        <fpage>317</fpage>
        <lpage>330</lpage>
        <pub-id pub-id-type="doi">10.1038/nature14248</pub-id>
        <?supplied-pmid 25693563?>
        <pub-id pub-id-type="pmid">25693563</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
