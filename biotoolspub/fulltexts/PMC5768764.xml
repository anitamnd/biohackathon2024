<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5768764</article-id>
    <article-id pub-id-type="publisher-id">2505</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-017-02505-0</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Monitoring single-cell gene regulation under dynamically controllable conditions with integrated microfluidics and software</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Kaiser</surname>
          <given-names>Matthias</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Jug</surname>
          <given-names>Florian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7123-198X</contrib-id>
        <name>
          <surname>Julou</surname>
          <given-names>Thomas</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7137-8962</contrib-id>
        <name>
          <surname>Deshpande</surname>
          <given-names>Siddharth</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7879-5216</contrib-id>
        <name>
          <surname>Pfohl</surname>
          <given-names>Thomas</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Silander</surname>
          <given-names>Olin K.</given-names>
        </name>
        <address>
          <email>olinsilander@gmail.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Myers</surname>
          <given-names>Gene</given-names>
        </name>
        <address>
          <email>myers@mpi-cbg.de</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>van Nimwegen</surname>
          <given-names>Erik</given-names>
        </name>
        <address>
          <email>erik.vannimwegen@unibas.ch</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 1937 0642</institution-id><institution-id institution-id-type="GRID">grid.6612.3</institution-id><institution>Biozentrum, </institution><institution>University of Basel and Swiss Institute of Bioinformatics, </institution></institution-wrap>Klingelbergstrasse 50/70, 4056 Basel, Switzerland </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2113 4567</institution-id><institution-id institution-id-type="GRID">grid.419537.d</institution-id><institution>Max Planck Institute of Molecular Cell Biology and Genetics, </institution></institution-wrap>Pfotenhauerstraße 108, 01307 Dresden, Germany </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 1937 0642</institution-id><institution-id institution-id-type="GRID">grid.6612.3</institution-id><institution>Department of Chemistry, </institution><institution>University of Basel, </institution></institution-wrap>Spitalstrasse 51, 4056 Basel, Switzerland </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2097 4740</institution-id><institution-id institution-id-type="GRID">grid.5292.c</institution-id><institution>Present Address: Department of Bionanoscience, </institution><institution>TU Delft, </institution></institution-wrap>Van der Maasweg 9, 2629 HZ Delft, The Netherlands </aff>
      <aff id="Aff5"><label>5</label>Present Address: Institute of Natural and Mathematical Sciences, Massey University Auckland, Private Bag 102904, North Shore, 0745 New Zealand </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>15</day>
      <month>1</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>15</day>
      <month>1</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2018</year>
    </pub-date>
    <volume>9</volume>
    <elocation-id>212</elocation-id>
    <history>
      <date date-type="received">
        <day>24</day>
        <month>10</month>
        <year>2017</year>
      </date>
      <date date-type="accepted">
        <day>6</day>
        <month>12</month>
        <year>2017</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2018</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Much is still not understood about how gene regulatory interactions control cell fate decisions in single cells, in part due to the difficulty of directly observing gene regulatory processes in vivo. We introduce here a novel integrated setup consisting of a microfluidic chip and accompanying analysis software that enable long-term quantitative tracking of growth and gene expression in single cells. The dual-input Mother Machine (DIMM) chip enables controlled and continuous variation of external conditions, allowing direct observation of gene regulatory responses to changing conditions in single cells. The Mother Machine Analyzer (MoMA) software achieves unprecedented accuracy in segmenting and tracking cells, and streamlines high-throughput curation with a novel leveraged editing procedure. We demonstrate the power of the method by uncovering several novel features of an iconic gene regulatory program: the induction of <italic>Escherichia coli</italic>’s <italic>lac</italic> operon in response to a switch from glucose to lactose.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">How gene regulatory pathways control cell fate decisions in single cells is not fully understood. Here the authors present an integrated dual-input microfluidic chip and a linked analysis software, enabling tracking of gene regulatory responses of single bacterial cells to changing conditions.</p>
    </abstract>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2018</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Gene regulation is one of the key processes that underlie the complex behavior of biological systems, allowing cells to adapt to varying environments, and allowing multi-cellular organisms to express a large number of phenotypically distinct cell types from a single genotype. In spite of more than half a century of intense study since the discovery of the basic mechanism of gene regulation<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>, much remains to be understood about the ways in which gene regulatory interactions control cell fate decisions. Because of a number of challenges, it is still difficult to directly observe and measure gene regulation in vivo. First, gene regulation is inherently stochastic, and genetically identical cells in homogeneous environments often exhibit heterogeneous behaviors<sup><xref ref-type="bibr" rid="CR2">2</xref>,<xref ref-type="bibr" rid="CR3">3</xref></sup>. This implies that bulk expression measurements are often misleading, thus necessitating methods for studying gene regulation in single cells. Second, while methods such as flow cytometry, smFISH, and single-cell RNA-seq provide snapshots of gene expression distributions across single cells (see e.g. refs. <sup><xref ref-type="bibr" rid="CR3">3</xref>–<xref ref-type="bibr" rid="CR5">5</xref></sup>), understanding the processes that shape these distributions often requires that single-cell gene expression be followed in time (e.g. refs. <sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR7">7</xref></sup>). The most common approach in such studies is to grow cells on a surface while tracking gene expression and growth using quantitative fluorescence time-lapse microscopy (QFTM).</p>
    <p id="Par4">Three key issues currently limit the power of such studies. First, to capture crucial regulatory events, long-term observations stretching over many cell cycles are often required. Second, measuring gene regulatory responses requires the ability to accurately control and vary environmental conditions. And third, to accurately characterize the statistics of single-cell responses, powerful image-analysis tools are needed to automatically extract large numbers of quantitative phenotypes from the time-lapse measurements. Considering bacteria, while it is possible to expose cells growing on surfaces to changing conditions<sup><xref ref-type="bibr" rid="CR8">8</xref>–<xref ref-type="bibr" rid="CR10">10</xref></sup>, gathering long time courses is not possible because the microcolonies grow out of the field of view or start to form multiple layers.</p>
    <p id="Par5">Recently developed microfluidic devices solve this problem by growing cells in micro-fabricated geometries that confine their location and movement<sup><xref ref-type="bibr" rid="CR11">11</xref>–<xref ref-type="bibr" rid="CR13">13</xref></sup>. An especially attractive design is the so-called Mother Machine<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>, in which cells grow single-file within narrow growth-channels that are perpendicularly connected to a main flow-channel that supplies nutrients and washes away cells extruding from the growth channels. However, all current designs expect a single media to be used as input, necessitating manual switching of the input to alter conditions, e.g. refs. <sup><xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR15">15</xref></sup>, which precludes the accurate temporal control of the growth environment that is desired to study gene regulation in vivo.</p>
    <p id="Par6">In addition, beyond specific technical problems, many researchers are likely discouraged from studying gene regulation using a combination of microfluidics and time-lapse microscopy, because of the high costs associated with establishing the necessary methods. One not only needs to obtain designs for microfluidic devices, learn how to manufacture these, and work out experimental protocols for performing time-lapse experiments, one also needs sophisticated image-analysis and post-processing methods to obtain accurate quantitative information from the data. While there are a number of software tools for analyzing QFTM data of micro-colonies on agar<sup><xref ref-type="bibr" rid="CR16">16</xref>–<xref ref-type="bibr" rid="CR18">18</xref></sup>, they perform poorly on data from microfluidic devices such as the Mother Machine, because cells undergo larger movements between consecutive frames. In addition, phase contrast images in microfluidic devices often suffer from non-uniformity due to varying background and opacity. For this reason, most require a dedicated fluorescent reporter to assist segmentation. Although a number of labs are analyzing data from microfluidic devices using various inhouse image-analysis solutions<sup><xref ref-type="bibr" rid="CR11">11</xref>,<xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR19">19</xref>–<xref ref-type="bibr" rid="CR21">21</xref></sup>, there is currently no publically available tool that allows automated analysis of such data with the throughput and accuracy required for quantifying growth and gene expression in large data sets.</p>
    <p id="Par7">To address these problems, we here present an integrated experimental and computational setup for studying gene regulation in single cells using microfluidics in combination with time-lapse microscopy. Our approach consists of the combination of, first, a new microfluidic device, called the dual-input Mother Machine (DIMM), that allows arbitrary time-varying mixtures of two input media, such that cells can be exposed to a precisely controlled set of varying external conditions. Second, to enable high-throughput and high accuracy analysis of phenotypic measurements from the DIMM, we accompany it with a software suite, called MoMA (Mother Machine Analyzer). The Mother Machine Analyzer takes specific advantage of the geometry of the device to accurately segment and track cells using only phase-contrast images, and further provides a curation user interface with leveraged-editing, meaning that a set of related errors are often fixed with a single click. The combination of MoMA’s accuracy and curation efficiency allows analyses of data sets involving millions of single-cell observations. Third, we provide several methods for precise quantification and characterization of the accuracy of growth and gene expression measurements. By making the entire framework including the microfluidic device’s design, protocols for manufacture and time-lapse experiments, the open source MoMA software, and post-processing methods, all jointly available, we aim to dramatically lower the entrance costs for researchers to adopt this methodology. To demonstrate the power of the method, we apply it to the iconic <italic>lac</italic> operon regulatory system that underlies the discovery of gene regulation, and uncovers several novel unexpected features of its stochastic induction dynamics.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>The dual-input Mother Machine</title>
      <p id="Par8">The design of our DIMM device closely follows that of the original Mother Machine<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>, consisting of a main channel and small dead-end growth channels that open into the main channel (Fig. <xref rid="Fig1" ref-type="fig">1a, c</xref>). Nutrients diffuse from the main channel into the growth-channels in which cells are trapped (Fig. <xref rid="Fig1" ref-type="fig">1c</xref>), and as the cells in the growth-channels grow and divide, cells closest to the channel’s exit are pushed out and are transported away by the flow in the main channel. In contrast to previous designs, our device has dual-input ports and mixing serpentines which, in combination with programmable pumps, allow for arbitrary time-dependent mixing of two input media. The two inputs meet in a dial-a-wave junction<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> consisting of two inlets and three outlets (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>). While the middle outlet feeds into the main channel of the device, the outer outlets function as waste channels and allow the flow in the middle outlet to vary from carrying only one of the two inputs (black in Fig. <xref rid="Fig1" ref-type="fig">1b</xref>), to carrying only the other input (green in Fig. <xref rid="Fig1" ref-type="fig">1b</xref>), without getting backflow into the inactive inlet. Note that arbitrary mixtures of the two input media are possible (see Methods, Performance of the environmental control) so that, for example, dynamically changing concentrations of particular nutrients or stressors can be realized. Details on the loading of the DIMM are provided in the Methods (Priming and loading of the microfluidic devices).<fig id="Fig1"><label>Fig. 1</label><caption><p>The dual-input Mother Machine. <bold>a</bold> Overview of the dual-input Mother Machine (DIMM) design. <bold>b</bold> Dial-a-wave junction in three different switching states, top: 100% from input 1 (unlabeled) and 0% from input 2 (green), middle: 50% from both inputs, bottom: 0% from input 1 and 100% from input 2. <bold>c</bold> Phase contrast image of growing <italic>Escherichia coli</italic> cells in three growth-channels of the DIMM. <bold>d</bold> A time series of a single growth-channel containing <italic>E. coli</italic> cells expressing LacZ-GFP from the <italic>lac</italic> promoter while being exposed to media which alternate between containing glucose and lactose as a carbon source. <bold>e</bold> Overview of the automated and curation phases of the MoMA analysis pipeline. <bold>f</bold> Histogram of the fraction of curated frames per single growth-channel time course. <bold>g</bold> Estimated measurement errors on cell size (blue) and number of GFP molecules (red). Dark blue points indicate the typical range of cell sizes. Error bars show standard errors. The black line shows the fitted function <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$1.01{\mathrm{/}}\sqrt {\left( x \right)}$$\end{document}</tex-math><mml:math id="M2"><mml:mn>1.01</mml:mn><mml:mi mathvariant="normal">∕</mml:mi><mml:msqrt><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced></mml:msqrt></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq1.gif"/></alternatives></inline-formula></p></caption><graphic xlink:href="41467_2017_2505_Fig1_HTML" id="d29e488"/></fig></p>
      <p id="Par9">To demonstrate the power of our approach, we applied it to the archetypical example of a gene regulatory system: the induction of <italic>Escherichia coli</italic>’s <italic>lac</italic> operon when switching between glucose and lactose as a carbon source. We used a modified <italic>E. coli</italic> MG1655 strain that carries a translational <italic>lacZ-gfp</italic> (green fluorescent protein) fusion at its native locus<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>. Time lapse movies of 22−24 h were obtained in duplicate for three different setups (1. a constant supply of M9 minimal media+0.2% glucose, 2. a constant supply of M9+0.2% lactose, and 3. switching between these two media every 4 h), taking a frame every 3 min (see Supplementary Movie <xref rid="MOESM3" ref-type="media">1</xref> (<ext-link ext-link-type="uri" xlink:href="https://www.youtube.com/watch?v=2Tznm868fmc">https://www.youtube.com/watch?v=2Tznm868fmc</ext-link> (2015))). Together with additional control conditions (strain without GFP, and switching media where lactose is supplemented with 500 μ<sc>m</sc> IPTG (isopropyl β-D-1-thiogalactopyranoside), we thus analyzed eight different time-lapse experiments all together, amounting to data from 180 growth-channels, more than 10,000 full cell cycles, and more than 500,000 single-cell observations (Supplementary Table <xref rid="MOESM1" ref-type="media">1</xref>).</p>
    </sec>
    <sec id="Sec4">
      <title>Image analysis and data processing</title>
      <p id="Par10">The analysis of the image sequences acquired by a DIMM is performed in three phases by the MoMA software suite (see Methods, The Mother Machine Analyzer, and following sections). Although MoMA, by default, uses phase contrast images to segment and track the cells, leaving all fluorescent channels for measurement of gene expression and allowing tracking on non-fluorescent (e.g. wild-type) cells, the user can opt to let MoMA use fluorescence images for tracking. The first automated phase begins by registering the frames of a movie to sub-pixel accuracy to correct for jitter and stage drift. Then the growth-channels in each time frame are cropped out and reorganized into a time-series for each channel. Each growth-channel movie is then segmented and tracked. Unlike most image analysis tools that first segment each of the images and then link these segmentations into a tracking, MoMA uses an algorithm that first over-predicts a hierarchy of feasible cell objects (segmentations) for each time point and then simultaneously selects what it thinks are the true cells and the tracking links between them<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. This is accomplished by formulating prior information as a collection of integer linear constraints that guarantee only valid cell trackings satisfy the constraints, and finding among this space of valid trackings, the one of minimum cost. Since cost reflects the likelihood of the solution considering both the observations and prior constraints, this is equivalent to finding the maximum a posteriori solution in Bayesian statistics. We use Gurobi, a potent off-the-shelf integer linear program solver to do so (see Methods).</p>
      <p id="Par11">In the second curation phase, an interactive graphical user interface is opened that allows users to browse the results, identify errors, and correct them. In contrast to existing methods, where data curation is performed by directly editing the segmentations or linking graphs, MoMA offers various possibilities to browse through alternate segmentation hypotheses and tracking paths. Once a user makes an adjustment, e.g. by selecting an alternative segment or link, MoMA formulates the user’s choice as an additional constraint and restarts the optimization in order to find the new optimum solution incorporating this constraint. In this way corrections automatically percolate to nearby time points, typically fixing multiple mistakes at once. For the individual growth-channels of the 22–24 h time courses analyzed here, an average 0.3% of frames required a curation directive, and roughly half of the growth-channels required no curation at all (Fig. <xref rid="Fig1" ref-type="fig">1f</xref>). In our hands, it typically takes 1–2 min to curate 100 frames (see Methods, Curations statistics).</p>
      <p id="Par12">In the final quantification phase, we developed methods to quantitate the sizes of cells and the amount of fluorescent reporter, as well as to quantify the size of the errors on these measurements. When growing in a constant environment, cell sizes across the cell cycle closely follow an exponential growth curve in both conditions (median squared-correlation <italic>R</italic><sup>2</sup> ≈ 0.99, see Methods, Cell size and growth rate estimation) and this allows us to estimate an upper bound on the errors of individual size measurements, which we find to be approximately 3% (Fig. <xref rid="Fig1" ref-type="fig">1g</xref>, and see Methods, Cell size and growth rate estimation). Growth rates of individual cell cycles can be estimated within an error of 1–3% and we find average growth rates of 0.75 (glucose) and 0.69 (lactose) doublings per hour, which vary by 17% across cells (see Methods, Cell size and growth rate estimation). Growth rates during the lactose and glucose phases of the switching conditions have virtually the same distribution as in the corresponding constant conditions (see Methods, Cell size and growth rate estimation).</p>
      <p id="Par13">We observed that cell fluorescence spreads significantly beyond the cell, approximately as a Cauchy distribution as a function of distance from the cell, and we use a Bayesian mixture model to accurately estimate the fluorescence of a given cell (see Methods, Cell fluorescence estimation). This procedure removes auto-fluorescence due to the PDMS (polydimethylsiloxane) but not the auto-fluorescence of the cell and media. Using measurements on wild-type cells, we observed that auto-fluorescence is proportional to cell size and used this to subtract the contribution of auto-fluorescence to GFP fluorescence measurements (see Methods, Cell auto-fluorescence estimation). Finally, to estimate the conversion factor between fluorescence level and the number of GFP molecules we adapted the method of Rosenfeld et al.<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> which is based on the assumption that fluctuations in the fluorescence levels of two daughter cells immediately after division derive from random binomial partitioning of the mother’s GFP molecules to the two daughters. We substantially improve on this method by (a) taking advantage of the DIMM design to use data only from the glucose phases in which no GFP synthesis occurs, (b) incorporating the slow fluorescence decay due to bleaching and protein decay (see Methods, Estimating GFP's bleaching and degradation), and (c) taking into account that fluctuations in the sizes of the daughters contribute significantly to the fluorescence fluctuations. We integrated all this into a Bayesian procedure and determined the posterior distribution of the conversion factor between fluorescence and number of LacZ-GFP tetramers (see Methods, Estimating the conversion factor between fluorescence and number of GFP molecules). Using this we find that, when growing in lactose, cells contain 3000–6000 GFP molecules at birth and 6000–12,000 GFP molecules just before division. Finally, we estimated the measurement errors of individual GFP measurements by quantifying the deviations of measured GFP levels from a simple exponential decay during the glucose phases of the switching experiment. In contrast to the relative error on size estimates, which are approximately independent of absolute size, we find that the error on GFP molecule number <italic>G</italic> scales as <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$1{\mathrm{/}}\sqrt G$$\end{document}</tex-math><mml:math id="M4"><mml:mn>1</mml:mn><mml:mi mathvariant="normal">∕</mml:mi><mml:msqrt><mml:mi>G</mml:mi></mml:msqrt></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq2.gif"/></alternatives></inline-formula> (Fig. <xref rid="Fig1" ref-type="fig">1g</xref>), which suggests that this measurement error is likely dominated by shot noise.</p>
      <p id="Par14">One problem encountered with sophisticated image analysis for cell tracking is that methods often poorly generalize to data from setups other than the specific one used in developing the methods. However, MoMA’s novel approach in which segmentation and tracking are treated as a joint optimization problem under a system of constraints ensures a high level of robustness to changes in the setup. To directly demonstrate MoMA’s general applicability, we reached out to MoMA’s emerging user community and obtained time-lapse data sets that were produced in other labs, using different microfluidic devices, different strains and species of bacteria, and different growth conditions (Supplementary Table <xref rid="MOESM1" ref-type="media">2</xref>). We confirmed that MoMA shows excellent performance on these data sets, both in terms of the needed curation interactions (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>), and the quality of the resulting growth curves (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>). We find that, depending on strains and conditions, growth rate fluctuations range between 10 and 20% of the average growth rate (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>), and that the accuracy of estimated growth rates is determined to a large extent by the number of measurements per cell cycle (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>).</p>
    </sec>
    <sec id="Sec5">
      <title>Single-cell dynamics of the <italic>lac</italic> operon</title>
      <p id="Par15">Figure <xref rid="Fig2" ref-type="fig">2a</xref> illustrates how our methodology allows accurate tracking of growth and gene expression across lineages of single cells as the environment is varied. As an example application, we focused our analysis on the single-cell dynamics of <italic>lac</italic> operon induction. Even before the discovery of gene regulation, it was already known that the induction of the <italic>lac</italic> operon is stochastic, with different single cells inducing at different times<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>. Further support for the stochasticity of this system has come from studies showing that, when exponentially growing populations are treated with artificial inducers such as IPTG or TMG (methyl-β-D-thiogalactoside), population snapshots often show a bimodal distribution of <italic>lac</italic> expression in single cells. The current consensus is that, in order for a cell to switch from a low expression to a high expression state, a sufficiently large stochastic burst of <italic>lac</italic> operon expression is needed<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR28">28</xref></sup>. A first attempt to measure the distribution of <italic>lac</italic> induction lag times in single cells was made by Boulineau et al.<sup><xref ref-type="bibr" rid="CR10">10</xref></sup>, and a wide distribution of lag times was observed. However, the lack of a precise control of the growth media in that work not only precluded accurate time resolution of the lag times, but also caused the switch from glucose to lactose to be so gradual that only some cells experienced a transient reduction in growth rate, while others continued without any change in growth rate.<fig id="Fig2"><label>Fig. 2</label><caption><p>Tracking single-cell dynamics of <italic>lac</italic> operon induction. <bold>a</bold> Dynamics of growth and gene expression in lineages of single cells in an environment that switches between M9+0.2% glucose and M9+0.2% lactose every 4 h. Cell size (black, logarithmic scale) and expression of LacZ-GFP (green, linear scale) are shown as a function of time for a lineage of cells at the bottom of the growth-channel (bottom row) together with first-generation offspring and second-generation offspring cells (second row from the bottom, and top two rows, respectively). The dashed vertical lines show the lineage of cell divisions by connecting each mother cell to its two daughter cells. <bold>b</bold> Reverse cumulative distributions of lag times to LacZ-GFP induction in single cells at the first (red), second (blue), and third (green) switch from glucose to lactose. <bold>c</bold> Estimated probability distribution (mean and standard deviation) of single-cell lag times for the first switch in 3-min intervals. The inset shows the correlation in lag times for pairs of cells that had the same mother 1, 2, or 3 generations in the past</p></caption><graphic xlink:href="41467_2017_2505_Fig2_HTML" id="d29e652"/></fig></p>
      <p id="Par16">In contrast, we find that upon a controlled sudden switch from glucose to lactose, the effect on growth is not stochastic at all: all cells completely arrest growth within 3 min of the switch (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). Other aspects that are extremely reproducible are the fact that all cells exit growth arrest as soon as LacZ-GFP is at detectable levels (i.e. 100−200 molecules), and that LacZ-GFP production is halted almost immediately after switching back to glucose (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4</xref>). Thus, while induction of the <italic>lac</italic> operon is highly stochastic, its shutdown and the coupling of growth to <italic>lac</italic> expression appears essentially deterministic.</p>
      <p id="Par17">Interestingly, while it might have been expected that, after exiting growth arrest, initial growth rates would be low when LacZ-GFP levels are still far below steady-state levels, we find that cells immediately grow at rates that are close to those observed in constant lactose, and reach steady-state growth rates within an hour of induction (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5</xref>). We estimated instantaneous growth rate as a function of LacZ-GFP concentration and found only a substantial decrease when concentration is more than 10-fold below the steady-state levels of 2000–3000 molecules per μm of cell length (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5</xref>). That is, cells can sustain high growth rates in lactose with <italic>lac</italic> operon expression that is fivefold or more below steady-state levels, in line with previous observations<sup><xref ref-type="bibr" rid="CR10">10</xref></sup>. This raises the question as to why LacZ steady-state levels are so much higher than required for growth. One intriguing possibility is that such high expression levels allow for a memory of growth in lactose that lasts over several generations, something that has been observed previously at the population level<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. Indeed, during the glucose phase the total fluorescence in each cell shows a slow exponential decay, mostly due to bleaching, and approximately halves at each cell division (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). By the time of the second switch to lactose, LacZ-GFP levels have diluted back to low levels, but the remaining <italic>lac</italic> expression is enough to ensure that all progeny of cells that induced in the first switch continue growth without an obvious decrease in growth rate, and quickly recommence LacZ-GFP production (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6</xref>).</p>
      <p id="Par18">Our methodology allows, for the first time, the accurate measurement of the distribution of lag times for single cells to exit their growth arrest after the first switch from glucose to lactose. We not only observe a wide distribution of lag times, but find that this distribution is multi-modal: 27% of cells induce within 25–45 min, 68% induce within 50–240 min, and 5% of cells do not induce at all (Fig. <xref rid="Fig2" ref-type="fig">2b, c</xref>). Importantly, this observation is directly at odds with the current view in the literature that all lags are determined by the waiting time to a single stochastic event. Instead, the multi-modal distribution suggests that naive cells can exist in different states that determine their ability to respond to lactose.</p>
      <p id="Par19">We investigated whether lag times correlate with simple physiological quantities such as growth rate, cell cycle stage, or LacZ-GFP levels at the time of the switch, but found that none of these variables correlate with lag times (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>). However, we find strong correlations of the lag times of cells that had the same mother, grand-mother, or even great-grandmother cell (Fig. <xref rid="Fig2" ref-type="fig">2c</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">8</xref>). It is especially striking that these genealogical correlations are larger for lag time than for any other physiological quantity that we measured, including quantities such as cell size and LacZ-GFP concentration, that are known to be directly inherited from the mother (Supplementary Fig. <xref rid="MOESM1" ref-type="media">9</xref>). In particular, only lag time shows significant correlations in cousins and second cousins. These results strongly suggest that lag time is controlled by an inheritable epigenetic factor that, in contrast to other physiological quantities such as LacZ-GFP expression, growth rate, and cell size, shows significant correlations over 2–3 generations.</p>
      <p id="Par20">Although a full investigation of the mechanistic interpretation of the multi-modal lag time distribution is beyond the scope of this work, we can propose an interpretation that we consider most plausible. We propose that the first and second modes of the lag distribution correspond to cells that, at the time of the switch, have either nonzero expression of both LacZ-GFP and LacY permease, or zero expression of either of these molecules. When both LacY and LacZ-GFP molecules are present at the switch, lactose can presumably immediately enter the cell, where it is metabolized into allolactose, causing <italic>lac</italic> operon derepression and LacZ-GFP production. In contrast, when no LacY/LacZ-GFP is present, lactose can either not enter the cell, or it cannot be metabolized, and cells first have to wait for a stochastic burst of <italic>lac</italic> operon expression, causing a longer lag time. If this interpretation is correct, then no long lags should be observed when an artificial inducer is added that can diffuse into the cell without LacY permease and binds directly to the LacI repressor. Indeed, when we add IPTG to the medium containing lactose we only observe short lags (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). Our interpretation also requires that, when growing in glucose, the majority of cells should contain either no LacY or no LacZ-GFP at all. This prediction is consistent with our LacZ-GFP measurements in glucose that predict the distribution of lacZ-GFP per cell significantly overlaps zero molecules (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11</xref>). It is also broadly consistent with previous observations that, in similar growth conditions, roughly 50% of cells contain no LacY<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>, and 65% of the cells contain no LacZ<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>. Finally, we note that Choi et al.<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> estimated that, when growing in the absence of lactose, small bursts in which around 40 LacY molecules are produced occur every 2–3 cell cycles, which is consistent with the waiting times of up to 240 min that we observe for cells of the second mode of the distribution.</p>
    </sec>
  </sec>
  <sec id="Sec6" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par21">We have here presented an integrated experimental and computational setup for quantifying gene expression dynamics at the single-cell level over long periods of time in dynamically changing environments that are precisely controlled. This methodology opens up a wide array of possibilities for studying gene regulatory mechanisms at the single-cell level. A single experiment with our setup was able to uncover several novel and unexpected features of one of the most intensely studied regulatory systems: <italic>lac</italic> operon expression under growth conditions that change between glucose and lactose as a carbon source. However, the technology enables many other types of investigations, e.g. it can be used to quantify how expression fluctuations affect growth rates at the single-cell level, to investigate how regulatory responses depend on the concentration and length of exposure to an inducing nutrient or stress, and how memories of regulatory responses are maintained across lineages of cells. More generally, its power extends beyond the scope of gene regulation studies. For example, it is becoming increasingly appreciated that single-cell heterogeneity plays an important role in persistence and evolution of resistance to antibiotics, and our methodology could be used to accurately quantify how single-cell growth and survival varies as a function of both the concentration and time of exposure to particular antibiotics, and as a function of the physiological states of the cells. In summary, we believe that the integrated experimental and computational methodology that we present here will be an important tool for studying gene regulatory mechanisms at the single-cell level. As detailed in the Data Availability section below, to facilitate access of other labs to our integrated methodology, we have collected all relevant information in a web repository, including files with the CAD designs of the device, information on fabrication of the device, detailed protocols for running the experiments, and links to the open source MoMA software. MoMA and its documentation, including tutorial videos are available online<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> and, to make MoMA easily available to any user of ImageJ, we have also made MoMA available as a Fiji plugin.</p>
  </sec>
  <sec id="Sec7" sec-type="materials|methods">
    <title>Methods</title>
    <sec id="Sec8">
      <title>Design and fabrication of the microfluidics devices</title>
      <p id="Par22"><italic>Escherichia coli</italic> cells take on different sizes depending on the media they are grown in, e.g. LB versus M9 minimal medium. Since the growth-channels aim to trap the cells growing in single file, the width of the channels needs to match the width of the cells as closely as possible. To account for this, our DIMM device contains channels with a range of widths, ranging from 0.8 to 1.6 μm, and lengths of 25 μm on one side of the device, and 55 μm on the other. For the results presented here, the growth-channel sections were ~0.9 μm (height) x ~0.8 μm (width), and 25 μm (length). These dimensions worked nicely with cells growing in M9+0.2% glucose or 0.2% lactose respectively. Experiments with other media and strains might require slightly different dimensions. In order to reduce the flow rates compared to the original mother machine device, the dimensions of the main channels were reduced to a diameter of 6 μm (height) by 50 μm (width) in the device presented here. The resulting flow rates are discussed in more detail in the section discussing loading and flow control. We note that reflections from the PDMS in the main channel can affect the phase contrast images near the top of the growth-channels, such that a segment of the growth-channels nearest to the exit needs to be discarded. To minimize this effect it is advisable to keep the main channel relatively shallow.</p>
      <p id="Par23">The device was designed using AutoCAD<sup>®</sup> (AUTODESK<sup>®</sup>) and is freely available at Metafluidics, an open repository for fluidic systems<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. We outsourced both the production of the photomask and the production of the masters to pour the PDMS devices from. A 5″ quartz mask with chrome layer was ordered from the Compugraphics Jena GmbH. Using this mask, Microresist (Berlin) produced the master using UV-lithography with SU-8 photoresists (for more details see ref. <sup><xref ref-type="bibr" rid="CR11">11</xref></sup>). To make the chips, we use the Sylgard Elastomer Kit 184 with a 1:10 curing agent to base ratio. Curing was performed at 65 °C overnight or longer. Harris Uni-Core 0.75 mm biopsy punches were used to create in- and outlets. Before bonding, both the PDMS mold and a cover slip were washed with isopropanol and dried with air. Surface activation was done in a plasma cleaner (PDC-32G, Harrick Plasma) operated at high intensity with vacuum at 1500 mTorr for 40 s. After bonding the devices were incubated at 65 °C for at least 1 h.</p>
    </sec>
    <sec id="Sec9">
      <title>Performance of the environmental control</title>
      <p id="Par24">The design presented here not only allows switching between different media but also allows for continuous control over the ratios of two different input media. Because flows in micro-channels are strictly laminar, only diffusive mixing occurs at these scales<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. To keep the design simple we introduced 2D mixing serpentines to the device. These serpentines guarantee that the media coming together in the junction are flowing together long enough to allow for diffusive mixing before the mix reaches the cells. The required length of these mixing serpentines depends on the flow speed (fluid velocity), the width of the micro-channels, and the diffusion coefficient of the molecule of interest in the medium used<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>.</p>
      <p id="Par25">To demonstrate mixing in the device we used M9 minimal medium labeled with fluorescein (1 g/ml) (Syringe 2) mixed with unlabeled M9 minimal medium (Syringe 1). We first obtained a reference fluorescence level for the medium containing fluorescein by measuring fluorescence every 15 s for 70 min, and taking the average of these 280 measurements. For 13 different relative flow rates of the two syringes, ranging from 20% of the total flow from Syringe 2 to 80% of the total flow from Syringe 2, we then measured fluorescence every 15 s for 10 min (40 min) and divided this by the reference fluorescence level to obtain a relative fluorescence. We then calculated the mean and standard deviation of 40 relative fluorescence levels for each relative flow rate. The results are shown in Fig. <xref rid="Fig3" ref-type="fig">3a</xref>, demonstrating how the system presented here can generate different mixing ratios and thus can be used to precisely control the growth environment. Figure <xref rid="Fig3" ref-type="fig">3b</xref> shows the normalized fluorescent intensity along a section through the main channel downstream of the mixing serpentines at different flow regimes. Because of small imperfections in the mold the intensity profile is not perfectly symmetrical even in the unmixed state (black line). However in the different mixed states, the shape of the profile stays the same indicating complete mixing is guaranteed in the flow regimes tested here.<fig id="Fig3"><label>Fig. 3</label><caption><p>Mixing of fluorescein-labeled medium with non-labeled medium at different input flow rate ratios. <bold>a</bold> Total fluorescence was measured in a square region in the main channel downstream of the mixing serpentines as the input ratio was changed in a stepwise manner from 0% fluorescein input to 100% fluorescein input (up: blue) and back to 0% fluorescein input again (down: red). The fluorescence measured for the mixture relative to the fluorescence measured for pure fluorescein-labeled medium (Syringe 2 only) is plot against the input of Syringe 2 as a fraction of the total input from both Syringes 1 and 2. <bold>b</bold> Normalized fluorescence along a section through the main channel downstream of the mixing serpentines at different mixing ratios</p></caption><graphic xlink:href="41467_2017_2505_Fig3_HTML" id="d29e815"/></fig></p>
    </sec>
    <sec id="Sec10">
      <title>Strains and growth conditions</title>
      <p id="Par26">Strains were streaked from freezer stocks onto LB plates before experiments. Overnight precultures were grown from single colonies in M9 minimal medium supplemented with the same carbon source that the cells were to experience in the initial phase of the experiment (0.2% glucose or 0.2% lactose). The next day, cells were diluted 100-fold into fresh medium with the same carbon source. Cells were harvested after 4–6 h to be concentrated and loaded into the microfluidic device (typically, a culture at OD ≈ 0.2 was concentrated 100-fold). Growth occurred at 37 °C for both the precultures and the microscopy experiments. The growth conditions used during the microscopy experiments are described in Table <xref rid="Tab1" ref-type="table">1</xref>.<table-wrap id="Tab1"><label>Table 1</label><caption><p>Experimental conditions used in this study</p></caption><table frame="hsides" rules="groups"><thead><tr><th><bold>Condition</bold></th><th><bold>Sequence of growth media</bold></th><th><bold>Strain</bold></th></tr></thead><tbody><tr><td rowspan="2">No GFP</td><td>12 h: M9+0.2% glucose</td><td rowspan="2">MG1655</td></tr><tr><td>12 h: M9+0.2% lactose</td></tr><tr><td>Glucose</td><td>22 h: M9+0.2% glucose</td><td>ASC662</td></tr><tr><td>Lactose</td><td>22 h: M9+0.2% lactose</td><td>ASC662</td></tr><tr><td rowspan="6">Switch</td><td>4 h: M9+0.2% glucose</td><td rowspan="6">ASC662</td></tr><tr><td>4 h: M9+0.2% lactose</td></tr><tr><td>4 h: M9+0.2% glucose</td></tr><tr><td>4 h: M9+0.2% lactose</td></tr><tr><td>4 h: M9+0.2% glucose</td></tr><tr><td>4 h: M9+0.2% lactose</td></tr><tr><td rowspan="4">Switch IPTG</td><td>4 h: M9+0.2% glucose</td><td rowspan="4">ASC662</td></tr><tr><td>4 h: M9+0.2% lactose+500 μ<sc>m</sc> IPTG</td></tr><tr><td>4 h: M9+0.2% glucose</td></tr><tr><td>4 h: M9+0.2% lactose+500 μ<sc>m</sc> IPTG</td></tr></tbody></table><table-wrap-foot><p>Strain MG1655 is a reference K12 strain<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>, and ASC662 was derived from it by integrating a translational fusion <italic>lacZ-gfp</italic> in the native <italic>lac</italic> operon<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>. Note that for each condition, the first step of its sequence of growth media was preceded by 2 h in the same media (in order to reach growth steady-state under fluorescence illumination conditions) that were discarded from the data analysis</p></table-wrap-foot></table-wrap></p>
    </sec>
    <sec id="Sec11">
      <title>Priming and loading of the microfluidic devices</title>
      <p id="Par27">The DIMM design presented here has two inlets and two outlets. This leads to some complications in the cell loading process compared to the original Mother Machine design. Here we describe the adjusted loading procedure we developed. As described in ref. <sup><xref ref-type="bibr" rid="CR11">11</xref></sup>, a mixture of salmon sperm DNA (10 mg/ml) and BSA (bovine serum albumin, 10 mg/ml) (at a ratio 1:3) is used to passivate the device before loading the cells. The salmon sperm DNA is denatured at 95 °C for 10 min and is mixed with the BSA after cooling down. This passivation buffer is also added to the growth medium in the experiment in a concentration of 1/100. In addition, one medium was always labeled with non-fluorescent microspheres (Polybead<sup>®</sup> polystyrene 1 μm beads) to monitor medium flow at the dial-a-wave junction. As shown in Fig. <xref rid="Fig4" ref-type="fig">4a</xref>, the two dial-a-wave waste channels cannot be pressured separately because they both end in the same outlet. Therefore to prevent blockage of one of the waste channels by passivation buffer it is recommended to flow water into the waste channel outlet while the passivation buffer is loaded into the cell outlet. Once the main channel (with the growth-channels) is filled with passivation buffer and the inlets (input 1 and input 2) are full of liquid (mixture of water and passivation buffer), both the flow of water and of passivation buffer can be stopped. The device is now incubated for ca. 1 h at 37 °C before the loading of the cells is started.<fig id="Fig4"><label>Fig. 4</label><caption><p>Priming and loading of the device. <bold>a</bold> Passivation buffer loading. To prevent blocking of the waste channels by passivation buffer, the waste channels are loaded with water through the waste channel outlet (blue) while loading of passivation buffer is done through the cell outlet (orange). Putting both outlets under pressure assures complete loading of the main channel with passivation buffer while the waste channels stay clear of passivation buffer. <bold>b</bold> A constant flow in both inlets (input 1 and input 2) prevents cells entering the inlets during the loading. The concentrated cell solution can be loaded through the cell outlet. First some pressure is applied to fill the whole main channel with cells. Afterwards the pressure is controlled to maintain zero flow in the main channel (red) while there is a constant flow through the inlets and in the waste channels (green) to remove cells that make it up to the dial-a-wave junction</p></caption><graphic xlink:href="41467_2017_2505_Fig4_HTML" id="d29e995"/></fig></p>
      <p id="Par28">After the passivation step, cell loading can begin. To get rid of the passivation buffer, the two inlets are connected to the pumps with the two different media that will be used in the experiment. At this point the tubing for the waste outlet can also be installed and connected to a waste container. Both pumps are now set to a flow rate of 1.5 μl/min. When all channels are clear, this flow regime will lead to a 50:50 ratio between the two inputs at the dial-a-wave junction. If the device leaks at this point or fails to establish a 50:50 ratio at the dial-a-wave junction (one medium is labeled with beads to check the flow under the microscope), most likely the resistance of some channel is altered by a blockage and the device cannot be used. If the device works properly, the dial-a-wave junction can be switched to the medium that will be used first. This step is necessary to ensure that the cells that are loaded afterwards only encounter the media condition in which they will begin growth. For a complete switch we use flow rates of 0.6 μl/min for the inactive inlet and 2.4 μl/min for the active one (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>). After a few minutes (depending on the flow rate) the main channel and cell outlet should be free of the medium from the initial input and the cell loading process can begin. The cells are harvested in exponential phase and are concentrated by centrifugation (~100−200×). Once the device is fully switched to the desired input, one can load the cells using a 1 ml syringe into the tubing that will later serve as the waste tube. This tubing is inserted into the cell outlet and can be pressured by hand to flow the cells into the main channel (the loading process is observed under the microscope). It is important not to stop the flow at the inlets during the whole loading process. This allows cell loading without getting cells into the inlets where they might become stuck and grow. Once the cells reach the growth-channels we used a custom-made clamp to hold a precise level of pressure on the 1 ml syringe for cell loading. The pressure here has to be continuously adjusted to make sure the cells stop flowing in the main channel and can enter the growth-channels. As shown in Fig. <xref rid="Fig4" ref-type="fig">4b</xref> there is a constant flow through the inlets and the waste channels (green) while the main channel is pressured to achieve zero flow where the growth-channels are (red). If cells move up to the dial-a-wave junction they are removed through the waste channels and the inlets stay clear. Loading continues until a satisfactory number of channels contain cells (typically 20−60 min). When complete, the 1 ml syringe used for loading is removed, and the end of its tubing is put into the waste container together with the tubing from the waste channel outlet. After loading the cells are allowed to recover for at least 2 h before the experiment starts.</p>
      <p id="Par29">Growth media are delivered from air-tight glass syringes (Hamilton) that are connected to the device using PTFE tubing with an inner diameter of 0.56 mm and an outer diameter of 1.07 mm. The syringes are controlled by two low pressure pumps (Cetoni GmbH) so that the total flow during the experiment is 3 μl/min.</p>
    </sec>
    <sec id="Sec12">
      <title>Microscopy and data preprocessing</title>
      <p id="Par30">An inverted Nikon TI-E microscope equipped with a motorized xy-stage with linear encoders was used to perform the experiments. All experiments were performed in an incubator maintained at 37 °C. The sample was fixed on the stage using metal clamps and focus was maintained using the Perfect Focus System from Nikon. Images were recorded using a CFI Plan Apochromat Lambda DM ×100 objective (NA 1.45, WD 0.13 mm) and a CMOS camera (Hamamatsu Orca-Flash 4.0). The setup was controlled using Micro-Manager<sup><xref ref-type="bibr" rid="CR33">33</xref></sup> and timelapse movies were recorded with its Multi-Dimensional Acquisition engine (customized using runnables). Every 3 min one phase contrast image and one GFP fluorescence image were acquired, typically for six different positions. Phase contrast images were acquired using 100 ms exposure with the transmitted light source at full power (CoolLED pE-100). Images of GFP fluorescence were acquired using 2 s exposure, illuminating the sample with a Lumencor SpectraX (Cyan LED) set to 17% and dimmed using a ND4 filter in the light path; the excitation (475/35 nm) and emission filters (525/50 nm) were used with a dichroic beam-splitter at 495 nm. For the switching experiments images of the dial-a-wave junction were also acquired. Here the GFP channel was replaced with an additional phase contrast image with a short exposure time (10 ms) to visualize the beads in the flow.</p>
      <p id="Par31">The MoMA tracking software expects to be given image data sets in which a single growth-channel is present, with the growth-channel opening at the top, and with phase contrast being the first channel. With our microfluidic design, the camera field of view covers ca. 30 growth-channels so the images must be split into individual growth-channels and preprocessed in order to match MoMA’s requirements. The preprocessing consists of the following tasks:<list list-type="order"><list-item><p id="Par32">Load the microscopy data set, one position at a time, in a format-independent manner using the Bio-Formats library (in order to open a specific position, one must use the Java API rather than functions available in ImageJ).</p></list-item><list-item><p id="Par33">Register all frames to the first frame of the first channel in order to correct the sample drift over time, as well as the jitter introduced by acquiring multiple positions in parallel. To do this, we develop HyperStackReg, a custom extension of the StackReg ImageJ plugin that is able to handle hyperstacks, i.e. data sets with several channels.</p></list-item><list-item><p id="Par34">Crop the image to keep only the area of the growth-channels and rotate the images (so that the growth-channel opening is at the top).</p></list-item><list-item><p id="Par35">Save images as a tiff data set with one file per frame.</p></list-item><list-item><p id="Par36">Straighten the image so that growth-channels are oriented vertically (using bicubic interpolation).</p></list-item><list-item><p id="Par37">Identify the growth-channels in the first-phase contrast frame and save one data set per cropped growth-channel.</p></list-item></list></p>
      <p id="Par38">All steps are run in Fiji with the help of two utility plugin released together with MoMA: HyperStackReg and MMPreprocess. This preprocessing step is documented extensively on MoMA’s Wiki<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>, including how to run it from the command line. Note that in order to preprocess data sets from the command line, Fiji must be run using a virtual window environment (using Xvfb), since the headless mode is not compatible with some important ImageJ features.</p>
    </sec>
    <sec id="Sec13">
      <title>The Mother Machine Analyzer</title>
      <p id="Par39">Today’s predominant tracking methods originated in the 1960s<sup><xref ref-type="bibr" rid="CR34">34</xref>,<xref ref-type="bibr" rid="CR35">35</xref></sup> and were developed to track single or a hand-full of objects with complex distinguishing features such as ships or airplanes. However, here we require the tracking of objects that are visually almost identical. In some cases this can be resolved by maintaining multiple association hypotheses over multiple time points<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>. However, although particle trackers and state space models can produce high-quality results, proofreading (data curation) is always required in order to guarantee error-free tracks. Notably, computer-assisted approaches for proofreading are usually not related to the method that produced the automated results in the first place.</p>
      <p id="Par40">Interactive error correction is rarely part of available tracking systems and usually turns out to be difficult to implement and integrate, leaving the user with an inflexible patchwork of multiple tools. Part of the reason for this is the way classical tracking models work. Their local and iterative solvers are highly specialized, not offering intrinsic possibilities to constrain the space of possible solutions in a user-driven way. In other words, they intrinsically do not offer any interaction capabilities that can be employed by users to prevent the tracking system from making certain mistakes.</p>
      <p id="Par41">Assignment Models promise to make a difference in all these respects. The novelty of this type of tracking system is the way in which solutions are found. A tracking problem is formulated as a global optimization problem under constraints that can be solved using discrete optimization methods. MoMA is based on such an optimization-based assignment model that allows the user to furnish constraints in an interactive manner. Hence, we can offer unprecedented user interactions for data curation—a process we call leveraged editing.</p>
      <p id="Par42">In particular, MoMA offers the following leveraged editing primitives: (i) Forcing solutions to contain a selected cell (segment), (ii) forcing solutions not to include specific segments, (iii) forcing a cell to a given movement or division (assignment), or to (iv) avoid such an assignment, and (v) specifying the number of cells visible at a given time. We will show that the very nature of the underlying optimization problem allows us to seamlessly incorporate these leveraged editing primitives.</p>
    </sec>
    <sec id="Sec14">
      <title>Automated tracking with MoMA</title>
      <p id="Par43">Here we briefly review the class of tracking methods called assignment models<sup><xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR37">37</xref>–<xref ref-type="bibr" rid="CR40">40</xref></sup>. We provide sufficient technical detail to prepare the reader for later sections, introducing leveraged editing primitives used in MoMA.</p>
      <p id="Par44">Tracking consists of two equally important tasks: Cells need to be segmented in each frame, and segments of the same cell in consecutive frames need to be linked. Tracking by assignment approaches these tasks by formulating and solving a joint global optimization problem. In this context, the segmentation task consists of selecting a subset of segments in each image, i.e. corresponding to the cells in the image. To do this, the algorithm first generates a large collection of possible segment hypotheses that are contained in a (possibly heavy) oversegmentation of the images. Joint segmentation and tracking then boils down to enumerating many potential subsets of segments together with potential ways of linking (assigning) these between consecutive frames. To identify, among all these possible joint segment/assignment subsets, an optimal solution, each of the potential segments and assignments is given a cost. The cost of a joint segmentation/assignment hypothesis aims to reflect how unlikely it is that the corresponding dynamics occurs in the real system, i.e. the corresponding movement, growth, and division of the cells in our system. That is, the total cost can be thought of as a negative log-likelihood of the segmentation/assignment hypothesis<sup><xref ref-type="bibr" rid="CR38">38</xref>,<xref ref-type="bibr" rid="CR41">41</xref></sup> and an optimal solution minimizes this cost.</p>
      <p id="Par45">The cost function is designed to reflect the knowledge of domain experts. To give an example, in our application, the cost function for a cell division assignment that links one segment to two segments in the next frame contains a term that evaluates the size of the three segments to be linked which implements the physical constraint that the sum of the sizes of the two daughter cells should be similar to that of the mother cell. Structural knowledge about which assignments can be chosen simultaneously is encoded in terms of constraints that ensure that only physically meaningful solutions can be chosen. That is, solutions that do not describe impossible events like cells popping into existence out of nowhere, cells moving to two places at once, etc. In our implementation, these constraints force or prohibit certain segments and assignments to be jointly contained in a segmentation/assignment solution. Notably, in formulating these constraints we of course take advantage of the fact that the microfluidic device organizes cells into one-dimensional arrays.</p>
      <p id="Par46">Once the segmentation and tracking problem has been formalized in this manner in terms of costs and constraints, well-established discrete optimization methods can be used to obtain a solution that is (i) feasible, i.e., free of conflicts, and (ii) cost-minimal. In the following we will put these notions on formal grounds. A more in-depth description can be found in ref. <sup><xref ref-type="bibr" rid="CR23">23</xref></sup>, where we described in detail the assignment model upon which MoMA operates. In the next section we will briefly summarize this model in order to lay the foundation to understand the leveraged editing primitives introduced thereafter.</p>
    </sec>
    <sec id="Sec15">
      <title>The assignment tracking system in MoMA</title>
      <p id="Par47">First, an excess of segment hypotheses <italic>H</italic><sup>(<italic>t</italic>)</sup> is generated for each frame <italic>t</italic>, with many hypotheses partially overlapping and thereby providing alternative and mutually exclusive interpretations of where the cells are appearing in the image<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. To represent possible solutions, a binary segmentation variable <italic>h</italic><sup>(<italic>t</italic>)</sup> is associated to each possible segment hypothesis in <italic>H</italic><sup>(<italic>t</italic>)</sup>. Whenever <italic>h</italic><sup>(<italic>t</italic>)</sup> = 1, it indicates that this segment hypothesis is part of the proposed solution. Similarly, a set of assignment hypotheses <italic>A</italic><sup>(<italic>t</italic>)</sup> and associated binary assignment variables <italic>a</italic><sup>(<italic>t</italic>)</sup> are generated, that link segment hypotheses at time point <italic>t</italic> to segment hypotheses at <italic>t</italic>+1. For example, a mapping assignment <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$a_{i \mapsto j}^{(t)}$$\end{document}</tex-math><mml:math id="M6"><mml:msubsup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>↦</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq3.gif"/></alternatives></inline-formula> connects two segment hypotheses <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$h_i^{(t)}$$\end{document}</tex-math><mml:math id="M8"><mml:msubsup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq4.gif"/></alternatives></inline-formula> and <inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$h_j^{(t + 1)}$$\end{document}</tex-math><mml:math id="M10"><mml:msubsup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq5.gif"/></alternatives></inline-formula>.</p>
      <p id="Par48">Thus, a proposed segment/assignment solution consists of a selection of binary segmentation and assignment variables <italic>v</italic> that are set to 1. As mentioned above, a cost function is defined that associates to every such variable <italic>v</italic>, a cost <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$c_v \in {\Bbb R}$$\end{document}</tex-math><mml:math id="M12"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">R</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq6.gif"/></alternatives></inline-formula> of including it in a solution. For details on the cost function used for mother machine devices, we refer to ref. <sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. In a nutshell, the cost measures how much a segment/assignment deviates from the expected appearance/dynamic behavior of bacterial cells. The total cost <italic>C</italic> of a particular solution is then simply the summed cost over all active variables<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C = \mathop {\sum}\limits_i v_i \cdot c_{v_i}.$$\end{document}</tex-math><mml:math id="M14" display="block"><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par49">Linear constraints are used to restrict the solution space to only include conflict-free and structurally sound solutions. As a simple example, two segment hypotheses that offer conflicting explanations of a particular pixel cannot simultaneously be active in any feasible solution. To introduce some notation that will be required below, we look in detail at one particular constraint. Continuity constraints ensure that each active segment at frame <italic>t</italic> (i.e. each cell) must be involved in exactly one assignment entering from frame <italic>t</italic>−1 and must also be involved in exactly one assignment towards <italic>t</italic>+1. In other words, each cell must have a past and a future. Formally, this statement can be written as<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\forall t \in \{ 2, \ldots ,T - 1\} ,\forall h^{(t)} \in H^{(t)}:\mathop {\sum}\limits_{a^{(t - 1)} \in {{\Gamma }}_{\mathrm{L}}\left( {h^{(t)}} \right)} a^{(t - 1)} = h^{(t)} = \mathop {\sum}\limits_{a^{(t)} \in {{\Gamma }}_{\mathrm{R}}\left( {h^{(t)}} \right)} a^{(t)}.$$\end{document}</tex-math><mml:math id="M16" display="block"><mml:mo>∀</mml:mo><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mo>∀</mml:mo><mml:msup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>:</mml:mo><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>Γ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">L</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>Γ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">R</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula>Here we image time frames ordered from left to right and use the notation <italic>Γ</italic><sub>L</sub>(<italic>h</italic>) to denote the set of assignments directly to the left of segmentation variable <italic>h</italic> (i.e. its left neighborhood) and <italic>Γ</italic><sub>R</sub>(<italic>h</italic>) to denote the set of assignments directly to the right of <italic>h</italic> (its right neighborhood). That is, the left neighborhood <italic>Γ</italic><sub>L</sub>(<italic>h</italic>) is the set of all assignments entering <italic>h f</italic>rom the previous frame and the right neighborhood <italic>Γ</italic><sub>R</sub>(<italic>h</italic>) is the set of all assignments leaving <italic>h</italic> towards the next frame. The equation above then says that, for each cell at time <italic>t</italic>, there should be one assignment in the previous time frame, and one in the following time frame.</p>
      <p id="Par50">A globally optimal solution, i.e. picking a set of conflict-free assignments of minimal cost can be achieved by solving an integer linear program (ILP)<sup><xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR38">38</xref>–<xref ref-type="bibr" rid="CR40">40</xref></sup>.</p>
      <p id="Par51">An ILP is an optimization problem that is fully specified by (i) an objective function that is a linear function of a set of variables <inline-formula id="IEq7"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\cal V}$$\end{document}</tex-math><mml:math id="M18"><mml:mi mathvariant="script">V</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq7.gif"/></alternatives></inline-formula>, and (ii) a set of constraints that are formalized as (in-)equalities on these variables. The space of feasible solutions is defined by all variable assignments that obey all constraints. An optimal solution is a feasible solution that minimizes the objective function.</p>
      <p id="Par52">The joint segmentation and tracking formulation introduced above is already in ILP form: The set of variables <inline-formula id="IEq8"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\cal V}$$\end{document}</tex-math><mml:math id="M20"><mml:mi mathvariant="script">V</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq8.gif"/></alternatives></inline-formula> comprises binary segmentation and assignment variables. The objective to minimize is the cost <italic>C</italic> defined in Eq. (<xref rid="Equ1" ref-type="">1</xref>). Note that this is a linear function of the variables <inline-formula id="IEq9"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$v \in {\cal V}$$\end{document}</tex-math><mml:math id="M22"><mml:mi>v</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">V</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq9.gif"/></alternatives></inline-formula>. In Eq. (<xref rid="Equ2" ref-type="">2</xref>) we also gave an example of how constraints can be formalized as linear equalities.</p>
      <p id="Par54">Integer linear programming is a well-understood problem<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>, and given the above formulation we can turn to off-the-shelf solvers like Gurobi to find an optimal solution. Although finding an optimal ILP solution is NP-hard, recent success solving relatively large tracking problems<sup><xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR38">38</xref>–<xref ref-type="bibr" rid="CR40">40</xref></sup> suggests that assignment models pose well-natured instances to be solved as ILPs.</p>
      <p id="Par55">In the following we will make use of a particular feature of many ILP solvers, namely the ability to perform “warm-starts”. One speaks about a warm start if a solver can benefit from residual intermediate results created during a preceding optimization. This can speed-up optimization significantly as shown in ref. <sup><xref ref-type="bibr" rid="CR23">23</xref></sup>.</p>
      <p id="Par56">Additional performance for solving the ILP underlying a tracking instance can be gained by reducing variable redundancy via substitution. The set of variables <inline-formula id="IEq10"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\cal V}$$\end{document}</tex-math><mml:math id="M24"><mml:mi mathvariant="script">V</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq10.gif"/></alternatives></inline-formula> contains variables <italic>h</italic> for available segments, and <italic>a</italic>, for available assignments. However, note that whenever the segmentation variable for a segment <italic>i</italic> is active, i.e. <italic>h</italic><sub><italic>i</italic></sub> = 1, then at least one assignment <italic>a</italic> that involves a segment <italic>i</italic> must be active as well. Using these constraints, the segmentation variables can be removed from the model entirely<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. That is, after adequate constraints are added to the ILP, each occurrence of <inline-formula id="IEq11"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$h_i^{(t)}$$\end{document}</tex-math><mml:math id="M26"><mml:msubsup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq11.gif"/></alternatives></inline-formula> can be substituted by a sum over all assignment variables in <italic>Γ</italic><sub>L</sub><inline-formula id="IEq12"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {h_i^{(t)}} \right)$$\end{document}</tex-math><mml:math id="M28"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msubsup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq12.gif"/></alternatives></inline-formula> (or <italic>Γ</italic><sub>R</sub><inline-formula id="IEq13"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {h_i^{(t)}} \right)$$\end{document}</tex-math><mml:math id="M30"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msubsup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq13.gif"/></alternatives></inline-formula>).</p>
    </sec>
    <sec id="Sec16">
      <title>Leveraged editing of tracking solutions</title>
      <p id="Par57">In this section we discuss how MoMA modifies the underlying optimization problem in response to user feedback. MoMA first of all provides the user with a graphical interface that allows the user to browse through the tracking solution that the optimization has provided for a given movie. The basic idea of leveraged editing is simple: When a user identifies a segmentation or tracking error, (s)he suggests the correct alternative or simply points at the error in the graphical interface, leaving the algorithm to search for a corrected solution to the model. In MoMA, the given feedback is incorporated into the ILP via additional constraints. Using warm-starts allows optimizing the modified problem fast enough for interactive use. Fixing a single error will usually resolve a bulk of transitive errors. These interaction-based modifications and re-optimizations are iterated until the found solution is satisfactory to the user, i.e., appears to be free of errors.</p>
      <p id="Par58">Here we introduce five specific interaction primitives implemented in MoMA. We will see that they do not introduce significant changes to the existing assignment tracking formulation and can be implemented efficiently. To illustrate how leveraged editing works in practice, a tutorial movie is available on MoMA’s Wiki page<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>, showing several of these primitives in action.</p>
      <p id="Par59">One possible error is that the tracking may have failed to include a particular cell, possibly even across multiple frames. In this case, the user wants to choose an adequate segment and force it to be included in the tracking solution. In MoMA this can be achieved by hovering the mouse over the part of the image where a cell was not picked up by the original optimization. Segment hypotheses located at the mouse position will be highlighted interactively, and simply clicking on any highlighted segment will cause (i) adequate modifications of the ILP (as described below), and (ii) a re-run of the solver to obtain an optimal solution for the given data, now constrained to include the forced segment.</p>
      <p id="Par60">Technically this can be achieved by adding a single constraint to the ILP, namely <italic>h</italic><sub>i</sub> = 1 where <italic>h</italic><sub><italic>i</italic></sub> is the chosen segment. Applying the redundancy reduction discussed in the previous section, the constraint to be added can be expressed in terms of assignment variables as<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop {\sum}\limits_{a \in {{\Gamma }}_{\mathrm{R}}\left( h \right)} a = 1,$$\end{document}</tex-math><mml:math id="M32" display="block"><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>Γ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">R</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:munder><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula>where <italic>Γ</italic><sub>R</sub>(<italic>h</italic>) is the right neighborhood of <italic>h</italic>, i.e. the set of all assignments leaving <italic>h</italic> towards the next frame.</p>
      <p id="Par61">In addition to allowing users to force missing segments to be included, the user can also tell MoMA to exclude certain segments from solutions. The re-solved ILP will correspond to the minimal cost solution for the data, constraint to exclude the chosen segment. Analogously to forcing segments, the constraint to be added to the ILP is<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop {\sum}\limits_{a \in {{\Gamma }}_{\mathrm{R}}\left( h \right)} a = 0.$$\end{document}</tex-math><mml:math id="M34" display="block"><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>Γ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">R</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:munder><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par62">Instead of interacting with segments, a user might want to directly work with individual assignments. To do so, users can browse through a library of available assignments. Assignments can be included or excluded from tracking solutions.</p>
      <p id="Par63">Browsing the library of available assignments can be done in only a few mouse-clicks. Since there is precisely one binary variable <italic>a</italic> corresponding to the chosen assignment, the constraint to be added to the ILP to force or exclude this assignment is simply <italic>a</italic> = 1 and <italic>a</italic> = 0, respectively.</p>
      <p id="Par64">The last interaction primitive of MoMA is particularly powerful, often capable of fixing multiple tracking errors at once. The idea is simply to let MoMA know how many cells are contained in a given time point. We constrain the solution space to only allow solutions that contain <italic>k</italic> segmented cells at time point <italic>t</italic>. Formally this is accomplished by adding the constraint<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop {\sum}\limits_{h \in H^{(t)}} \mathop {\sum}\limits_{v \in {{\Gamma }}_{\mathrm{R}}(h)} v = k,$$\end{document}</tex-math><mml:math id="M36" display="block"><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:munder><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>Γ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">R</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>where <italic>H</italic><sup>(<italic>t</italic>)</sup> is the set of all segments existing at time <italic>t</italic>.</p>
    </sec>
    <sec id="Sec17">
      <title>Installation of MoMA</title>
      <p id="Par65">The installation of MoMA can be performed via Fiji<sup><xref ref-type="bibr" rid="CR43">43</xref>,<xref ref-type="bibr" rid="CR44">44</xref></sup>. In Fiji, simply activate the MoMA update site. Once installed, the Fiji updater will automatically install future versions of MoMA containing new features and bugfixes. The MoMA Wiki pages contain further information about how to install and use MoMA<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>.</p>
    </sec>
    <sec id="Sec18">
      <title>Implementation of MoMA</title>
      <p id="Par66">MoMA is implemented in Java, using the imaging library ImgLib2<sup><xref ref-type="bibr" rid="CR45">45</xref></sup> and other components from the open source universe around ImageJ and Fiji<sup><xref ref-type="bibr" rid="CR43">43</xref>,<xref ref-type="bibr" rid="CR44">44</xref></sup>. For solving ILPs we use Gurobi. The source code of MoMA is a Maven project, hosted on GitHub<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>.</p>
    </sec>
    <sec id="Sec19">
      <title>Additional features of MoMA</title>
      <p id="Par67">Additional useful features of MoMA include (i) the ability to optimize (solve) only parts of a loaded data set, (ii) save a fully or partially curated data set, and (iii) the possibility to export a found tracking solution for downstream processing.</p>
      <p id="Par68">If a loaded data set contains 1000 or even more time points, the optimization of MoMA’s assignment model can take tens of seconds. While this is still fast, e.g. when compared to the data acquisition time for such a data set, leveraged editing can become cumbersome when the user is forced to wait tens of seconds between interactions for the optimization to finish. In order to guarantee fast interactive response times, MoMA allows users to define a subrange of time points [<italic>t</italic><sub><italic>a</italic></sub>, <italic>t</italic><sub><italic>b</italic></sub>] across which to perform the optimization.</p>
      <p id="Par69">All assignments that are not in [<italic>t</italic><sub><italic>a</italic></sub>, <italic>t</italic><sub><italic>b</italic></sub>] are either set to the value computed at a previous (partial) optimization run, or simply clamped to be 0. Formally this can be expressed by<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\forall t \,\notin \,\left[ {t_a, \ldots ,t_b} \right],\forall a^{(t)} \in A^{(t)}:a^{(t)} = \left[ {\begin{array}{*{20}{l}} {1} \hfill &amp; {{\mathrm{if}}\,a^{(t)}\,{\mathrm{was}}\,{\mathrm{set}}\,{\mathrm{to}}\,{\mathrm{1}}\,{\mathrm{previously}},{\mathrm{or}}} \hfill \\ {0} \hfill &amp; {{\mathrm{otherwise}}{\mathrm{.}}} \hfill \end{array}} \right.$$\end{document}</tex-math><mml:math id="M38" display="block"><mml:mo>∀</mml:mo><mml:mi>t</mml:mi><mml:mspace width="0.3em"/><mml:mo>∉</mml:mo><mml:mspace width="0.3em"/><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mo>∀</mml:mo><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>:</mml:mo><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfenced close="" open="[" separators=""><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi mathvariant="normal">if</mml:mi><mml:mspace width="0.3em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mspace width="0.3em"/><mml:mi mathvariant="normal">was</mml:mi><mml:mspace width="0.3em"/><mml:mi mathvariant="normal">set</mml:mi><mml:mspace width="0.3em"/><mml:mi mathvariant="normal">to</mml:mi><mml:mspace width="0.3em"/><mml:mi mathvariant="normal">1</mml:mi><mml:mspace width="0.3em"/><mml:mi mathvariant="normal">previously</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="normal">or</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mn>0</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi mathvariant="normal">otherwise</mml:mi><mml:mi mathvariant="normal">.</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par70">Once correct solutions are found, it is important that users can save and load the curations that they performed. Leveraged editing primitive introduces additional constraint to the underlying optimization problem, and MoMA is capable of serializing all edits to file.</p>
      <p id="Par71">But not only leveraged edits can be saved, also MoMA’s segmentation and tracking results can be exported for subsequent downstream processing. An exhaustive list of exportable data is given below. MoMA’s Wiki page contains a formal specification of the used data format<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>.<list list-type="bullet"><list-item><p id="Par72">Data source.</p></list-item><list-item><p id="Par73">Total number of cells observed in the data set.</p></list-item><list-item><p id="Par74">Number of channels in the raw data, i.e. phase contrast and fluorescent channels.</p></list-item><list-item><p id="Par75">Growth channel (growth-channel) height and image height in pixels.</p></list-item><list-item><p id="Par76">(Vertical) position of the growth-channel in the image.</p></list-item><list-item><p id="Par77">For each cell, its cell id, and lineage information (the ids of its ancestors).</p></list-item><list-item><p id="Par78">For each time point in the life of each cell: position in the growth-channel [pixels and cell number]; bounding box area; intensity histogram, intensity percentiles, and pixel intensities for all channels.</p></list-item></list></p>
    </sec>
    <sec id="Sec20">
      <title>Curation statistics</title>
      <p id="Par79">MoMA was tested on Mother Machine data with ~30 frames per cell cycle, stable focus over the experiment and both phase contrast and fluorescence imaged. To estimate the time the user needs to spend to curate data sets, we analyzed an unbiased selection of growth-channels and measured the time spend curating. For the selection of the growth-channels there was no visual inspection of the growth-channels other than checking that they harbor cells on the first frame. Therefore, this sample also harbored growth-channels in which the cells are lost during the experiment, and some that show structural defects. We only used the times for the growth-channels in which we had cells until the end of the experiment. Defect growth-channels were excluded as well. There are also rare growth-channels in which a cell is lysing or shows other abnormalities. In such cases, even with the eyes of an experienced observer, it is difficult to decide on the border of such cells, and such growth-channels were excluded as well.</p>
      <p id="Par80">Figure <xref rid="Fig1" ref-type="fig">1f</xref> shows a histogram of the fraction of frames needing curation across the growth-channels. Roughly half of the growth-channels required no curation at all, and most growth-channels require less than 1% of frames curated, with about 3% of frames needing curation in the worst case.</p>
      <p id="Par81">To give an impression of the amount of time that these curation statistics correspond to, in our hands, Fig. <xref rid="Fig5" ref-type="fig">5</xref> shows the distribution of curation times per 100 frames across the growth-channels we analyzed. For each growth-channel, the total number of curated frames was extracted from the serialized file of curation interactions that MoMA saves. The inset of Fig. <xref rid="Fig5" ref-type="fig">5</xref> shows that curation times are generally correlated with the fraction of frames that required curation.<fig id="Fig5"><label>Fig. 5</label><caption><p>Histogram of the curation times per 100 frames for a representative set of growth-channels. The inset shows a scatter plot of curation times (per 100 frames) as a function of the fraction of frames that were curated. The line shows a linear regression (least squares) fit</p></caption><graphic xlink:href="41467_2017_2505_Fig5_HTML" id="d29e2295"/></fig></p>
      <p id="Par82">All the curating with MoMA was performed on a MacBookPro (2.4 GHz Intel Core i7, 8 GB of memory). On this setup loading, initialization and the first round of optimization of a data set with 480 frames with two channels typically takes around 1 min. After curating the data the export step takes another 30 s.</p>
    </sec>
    <sec id="Sec21">
      <title>Cell size and growth rate estimation</title>
      <p id="Par83">From the imaging data we obtain, for each cell, pictures for each time point during its life-cycle. As an estimate of cell size, the software provides the dimension of the rectangular bounding-box within which the cell is contained. We have found that, both on our own data as on the data from other devices and microscopy setups, virtually all cells accurately follow simple exponential growth curves as a function of time, supporting the robustness of the estimation procedure. However, it is clear that the cell size estimation is quite coarse and we aimed to quantify the accuracy of these size estimates. This is difficult to do directly because we do not have independent measurements of cell sizes that can be used as a gold standard. However, if we find that the estimated cell size <italic>s</italic>(<italic>t</italic>) accurately follows a simple exponential or linear form as a function of time <italic>t</italic>, then this suggests the errors in cell size are at most as large as the fluctuations of <italic>s</italic>(<italic>t</italic>) away from the simple exponential or linear growth law.</p>
      <p id="Par84">Let <italic>s</italic>(<italic>t</italic>) be the estimated size of the cell at time <italic>t</italic> and <inline-formula id="IEq14"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$x(t) = {\mathrm{log}}[s(t)]$$\end{document}</tex-math><mml:math id="M40"><mml:mi>x</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">log</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq14.gif"/></alternatives></inline-formula>. We used the data sets from the constant environments and used all cells which were monitored from birth to division, corresponding to 4016 cell cycles in glucose and 3387 cell cycles in lactose. For each cell cycle, we calculated the Pearson correlation between <italic>x</italic>(<italic>t</italic>) and <italic>t</italic> across the cell cycle, as well as the Pearson correlation between <italic>s</italic>(<italic>t</italic>) and <italic>t</italic>. Figure <xref rid="Fig6" ref-type="fig">6</xref> shows the cumulative distributions of the squared Pearson correlation of the growth curves with exponential (black) and linear (orange) functions for cells grown in lactose (Fig. <xref rid="Fig6" ref-type="fig">6a</xref>) and in glucose (Fig. <xref rid="Fig6" ref-type="fig">6b</xref>).<fig id="Fig6"><label>Fig. 6</label><caption><p>Exponential growth curves and the distribution of growth rates. <bold>a</bold> Cumulative distributions of the squared Pearson correlations between the estimated sizes of the cells and time (orange), or estimated log-sizes and time (black) for the cells grown in lactose. <bold>b</bold> As in panel <bold>a</bold> but for cells grown in glucose. <bold>c</bold> Distribution of growth rates of individual cell cycles in glucose (blue) and lactose (red). <bold>d</bold> Distribution of relative errors of the growth rate estimates in glucose (blue) and lactose (red). <bold>e</bold> Distribution of growth rates of individual cell cycles during the first (red), second (blue), and third (green) time segments in glucose of the experiments with switching conditions. For comparison, the black curve shows the growth rate distribution in constant glucose. <bold>f</bold> As in panel <bold>e</bold> but for the time segments in lactose</p></caption><graphic xlink:href="41467_2017_2505_Fig6_HTML" id="d29e2429"/></fig></p>
      <p id="Par85">We see that the growth curves are very well described by exponential functions of time, i.e. the median squared correlation coefficient is approximately 0.99 and almost all cells have correlation coefficients larger than 0.98. Correlation coefficients are substantially lower for fits to linear growth curves. Note that, whereas correlation coefficients are still very high for the linear growth fits, the log-likelihood for a growth-curve with squared correlation <italic>r</italic><sup>2</sup> and <italic>T</italic> time points scales as <inline-formula id="IEq15"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$- T\,{\mathrm{log}}[1 - r^2]$$\end{document}</tex-math><mml:math id="M42"><mml:mo>-</mml:mo><mml:mi>T</mml:mi><mml:mspace width="0.3em"/><mml:mi mathvariant="normal">log</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq15.gif"/></alternatives></inline-formula>. Thus, for a typical cell-cycle with <italic>T</italic> = 30 time points, the likelihood ratio between a fit with <italic>r</italic><sup>2</sup> = 0.99 and one with <italic>r</italic><sup>2</sup> = 0.98 is <inline-formula id="IEq16"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathrm{exp}}(20.8) \approx 10^9$$\end{document}</tex-math><mml:math id="M44"><mml:mi mathvariant="normal">exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>20.8</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>≈</mml:mo><mml:mn>1</mml:mn><mml:msup><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mn>9</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq16.gif"/></alternatives></inline-formula>. That is, the differences in the qualities of the linear and exponential fits are highly significant.</p>
      <p id="Par86">Since the elongation of cells is very well described by an exponential model, we can estimate the measurement error by studying the residuals of these fits. These residuals represent an upper bound on length measurement errors since they also include biological fluctuations around constant exponential growth. For each cell size observation in each cell cycle, we calculate the squared residual from the exponential fit, and obtained a squared relative error by dividing by the square of the estimated size. We then stratified the errors according to size and calculated, for each size class, the means and standard deviations of the squared relative errors. Taking the square-roots of these values we finally obtain the relative errors of the size measurements as a function of estimated size (Fig. <xref rid="Fig1" ref-type="fig">1g</xref>). We find that the measurement error on size is between 2 and 3%, and approximately independent of the length itself.</p>
      <p id="Par87">To estimate the average growth rate of an individual cell cycle we use linear regression of the log-sizes <inline-formula id="IEq17"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$x(t) = {\mathrm{log}}[s(t)]$$\end{document}</tex-math><mml:math id="M46"><mml:mi>x</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">log</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq17.gif"/></alternatives></inline-formula> across the time points <italic>t</italic> in the cell-cycle, i.e. assuming all deviations from a perfect linear relationship <italic>x</italic>(<italic>t</italic>) = <italic>a</italic>(<italic>t</italic>−<italic>t</italic><sub>0</sub>)+<italic>x</italic><sub>0</sub> are due to errors in the log-size estimates <italic>x</italic>(<italic>t</italic>). Marginalizing over the cell-size <italic>x</italic><sub>0</sub> at the time of birth <italic>t</italic><sub>0</sub>, we find that the standard-deviation of the posterior distribution over growth-rate <italic>a</italic> is given by<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma (a) = \sqrt {\frac{{{\mathrm{var}}(x)(1 - r^2)}}{{(T - 1){\mathrm{var}}(t)}}} ,$$\end{document}</tex-math><mml:math id="M48" display="block"><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msqrt><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">var</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>T</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi mathvariant="normal">var</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:msqrt><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula>where var(<italic>x</italic>) and var(<italic>t</italic>) are the variances of the log-sizes <italic>x</italic>(<italic>t</italic>) and measurement times <italic>t</italic>, <italic>T</italic> is the number of measurements in the cell cycle, and <italic>r</italic> is the Pearson-correlation of the linear fit. The relative error on the estimated slope <italic>a</italic><sub>*</sub> = cov(<italic>x</italic>, <italic>t</italic>)/var(<italic>t</italic>) is given by the ratio <italic>σ</italic>(<italic>a</italic>)/<italic>a</italic><sub>*</sub>.</p>
      <p id="Par88">Figure <xref rid="Fig6" ref-type="fig">6c</xref> shows the distribution of growth rates that we observe in constant glucose and lactose, and Fig. <xref rid="Fig6" ref-type="fig">6d</xref> shows the distribution of relative errors on growth rate. For the large majority of cell cycles, the error on the estimate of the growth rate is between 1 and 3%. The average growth rate is a bit higher in glucose (0.75 doublings per hour) than in lactose (0.69 doublings per hour). Notably, the variation in the growth rates of individual cell cycles is much larger than the measurement errors on these growth rates, indicating that growth rates vary considerably across single cells. We find that growth rates vary by about 17% in both glucose and lactose (i.e. one standard deviation), and we observe cell cycles that differ by more than twofold in their growth rates.</p>
      <p id="Par89">We also investigated whether growth rates during the switching conditions vary systematically from growth rates in the corresponding constant conditions. Figure <xref rid="Fig6" ref-type="fig">6</xref> shows the distribution of growth rates for individual cell cycle separately for the first, second, and third time segment in both glucose (Fig. <xref rid="Fig6" ref-type="fig">6e</xref>) and lactose (Fig. <xref rid="Fig6" ref-type="fig">6f</xref>) during the switching conditions.</p>
      <p id="Par90">We see that the growth rate distributions during individual time segments in the switching experiments are very similar to the distributions in the corresponding constant conditions. The only exception is the slightly higher growth rates in the first time segment in glucose during the switching conditions. Although we have not investigated the origin of the slightly higher growth rates in this time segment in detail, we believe that it results from a combination of two effects. First, we note that the growth rates in glucose are slightly higher in all three segments during the switching conditions than in the constant conditions. This suggests that a subtle change in the conditions on the day of the experiment may have caused slightly increased growth rates during the switching conditions. Second, when fluorescence measurements are taken, the light from the illumination causes some small stress to the cells, which is reflected in slightly lower growth rates compared to conditions where no fluorescence measurements are taken. As a consequence, we observe that cells slightly lower their growth rates during the first hours of the experiment. To correct for this systematic effect we only start recording measurements in each experiment, after 2 h in conditions with illumination. We hypothesize that during the first glucose segment in the switching experiments, the cells had not yet fully adapted to the illumination conditions.</p>
    </sec>
    <sec id="Sec22">
      <title>Cell fluorescence estimation</title>
      <p id="Par91">To estimate the GFP content of each cell, we post-process the fluorescence data as follows. The raw data consist of fluorescence intensities for all pixels within the segment of the picture containing the cell. This segment is 100 pixels wide, with the growth-channel covering approximately 13 pixels in the center of the picture. We first obtain column-sums <italic>c</italic><sub><italic>i</italic></sub> by summing the pixel intensities of all pixels in each of the 100 columns <italic>i</italic>. Note that we assume that these column sums are dominated by the fluorescence coming from the cell in question, i.e. that the fluorescence coming from neighboring cells above and below the cell are negligible. We find that this is a good approximation when cells in a given growth-channel all have similar fluorescences but note that, in conditions where neighboring cells may have fluorescences that differ by orders of magnitude, this assumption may break down. Figure <xref rid="Fig7" ref-type="fig">7</xref> shows the profiles of column sums <italic>c</italic><sub><italic>i</italic></sub> for a cell at three time points of its cell cycle while growing in lactose (top three panels) and for a cell growing in glucose (bottom three panels). From prior biological knowledge, we know that GFP is highly expressed during the growth on lactose, and that it is very lowly expressed during the growth on glucose.<fig id="Fig7"><label>Fig. 7</label><caption><p>Examples of the horizontal profiles of column sums <italic>c</italic><sub><italic>i</italic></sub> of fluorescence intensities (blue dots) for three cells during growth on lactose (top panels) and during growth on glucose (bottom panels). The three panels show, from left to right, the profiles at the start, the middle, and at the end of the cell cycle of two example cells. The red curves show the fits to the mixture model of a fixed background plus a Cauchy-distributed signal</p></caption><graphic xlink:href="41467_2017_2505_Fig7_HTML" id="d29e2791"/></fig></p>
      <p id="Par92">Remarkably, the growth-channel (central 13 pixel positions in the figures) is not detectable at all in the fluorescence curves. Instead, the fluorescence signal shows a long-tailed peak centered in the middle of the growth-channel, extending far beyond the width of the growth-channel, and reaching a minimum at positions halfway between neighboring growth-channels, i.e. near the left and right ends of the profiles in Fig. <xref rid="Fig7" ref-type="fig">7</xref>. As the cell grows, i.e. from the leftmost to rightmost panel, the length of the segment grows and the column-sums grow proportionally to the segment length. Notably, the minimal fluorescence level is almost twice as high when growing in lactose compared to when growing in glucose. We conclude from these observations that the fluorescence from each cell spreads over significant distances across the image and that this also causes background levels to depend on the overall expression levels in neighboring growth-channels. Therefore, to properly estimate the amount of fluorescence emerging from the cell we need to fit the background intensity within each segment and we need a mathematical model for the long-tailed shape of the peak.</p>
      <p id="Par93">We found that the shape of the peak is very well described by a Cauchy (or Lorentzian) distribution, giving an overall form of the fluorescence profile:<disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$c_i = {\mathrm{noise}} + B + \frac{A}{{1 + \left( {\frac{{i - i_{{\mathrm{mid}}}}}{w}} \right)^2}},$$\end{document}</tex-math><mml:math id="M50" display="block"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">noise</mml:mi><mml:mo>+</mml:mo><mml:mi>B</mml:mi><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>i</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">mid</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula>where <italic>i</italic> is the horizontal position, <italic>i</italic><sub>mid</sub> is the center of the peak, <italic>w</italic> its width, <italic>A</italic> the amplitude of the signal, ‘noise’ is the measurement noise, and <italic>B</italic> the background fluorescence. Assuming that the measurement noise is Gaussian distributed, it is straight forward to fit this model using expectation maximization. We find that, systematically, the center <italic>i</italic><sub>mid</sub> ≈ 50–52, and the width <italic>w</italic> ≈ 5–6 pixels. We interpret the amplitude <italic>A</italic> to be proportional to the total number of GFP molecules in the cell, and the background <italic>B</italic> to correspond to the combined effects of the camera offset, the auto-fluorescence of the microfluidic chip and the media, and stray fluorescence from neighboring cells. The expectation maximization procedure for fitting the fluorescence profile is<list list-type="order"><list-item><p id="Par94">Find the maximum and minimal fluorescence column-sums <italic>c</italic><sub>max</sub> and <italic>c</italic><sub>min</sub> across the profile.</p></list-item><list-item><p id="Par95">Initialize <italic>B</italic> to <italic>c</italic><sub>min</sub>, <italic>A</italic> to <italic>c</italic><sub>max</sub>−<italic>c</italic><sub>min</sub>, <italic>w</italic> to 5.5 and <italic>i</italic><sub>mid</sub> to 50, i.e. in the middle of the profile.</p></list-item><list-item><p id="Par96">Calculate a theoretical profile:<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho _i = \left[ {1 + \left( {\frac{{i - i_{{\mathrm{mid}}}}}{w}} \right)^2} \right]^{ - 1},$$\end{document}</tex-math><mml:math id="M52" display="block"><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>i</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">mid</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>and its integral <inline-formula id="IEq18"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho = \mathop {\sum}\nolimits_{i = 1}^N \rho _i$$\end{document}</tex-math><mml:math id="M54"><mml:mi>ρ</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq18.gif"/></alternatives></inline-formula>.</p></list-item><list-item><p id="Par97">Set a new value of the background <italic>B</italic>′:<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$B^{\prime} = \frac{1}{N}\mathop {\sum}\limits_{i = 1}^N \frac{{Bc_i}}{{B + A\rho _i}}.$$\end{document}</tex-math><mml:math id="M56" display="block"><mml:msup><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mi>B</mml:mi><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>B</mml:mi><mml:mo>+</mml:mo><mml:mi>A</mml:mi><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula></p></list-item><list-item><p id="Par98">Set a new value for the amplitude <italic>A</italic>′:<disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A^{\prime} = \frac{1}{\rho }\mathop {\sum}\limits_{i = 1}^N \frac{{Ac_i\rho _i}}{{B + A\rho _i}}.$$\end{document}</tex-math><mml:math id="M58" display="block"><mml:msup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mi>A</mml:mi><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>B</mml:mi><mml:mo>+</mml:mo><mml:mi>A</mml:mi><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula></p></list-item><list-item><p id="Par99">Using the updated values <italic>A</italic>′ and <italic>B</italic>′, calculate an updated profile <italic>ρ</italic><sub><italic>i</italic></sub> and optimize <italic>i</italic><sub>mid</sub> by finding the zero of the derivative:<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop {\sum}\limits_{i = 1}^N \left( {i - i_{{\mathrm{mid}}}} \right)\rho _i^2\left( { - 1 + \frac{{c_i}}{{B^{\prime} + A^{\prime}\rho _i}}} \right).$$\end{document}</tex-math><mml:math id="M60" display="block"><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>i</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">mid</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:msubsup><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula></p></list-item><list-item><p id="Par100">Using the updated values <italic>A</italic>′, <italic>B</italic>′, and <italic>i</italic><sub>mid</sub>, optimize <italic>w</italic> by finding the zero of the derivative:</p></list-item></list><disp-formula id="Equ13"><label>13</label><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop {\sum}\limits_{i = 1}^N \rho _i(1 - \rho _i)\left( { - 1 + \frac{{c_i}}{{B^{\prime} + A^{\prime}\rho _i}}} \right).$$\end{document}</tex-math><mml:math id="M62" display="block"><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par101">The accuracy of this method to estimate the total fluorescence of the cell can be quantified by taking advantage of the precise environment control allowed by our new setup, as discussed in the next section. We distribute a post-processing script with the MoMA code that allows users to apply this fluorescence amplitude estimation to exported output files from MoMA.</p>
    </sec>
    <sec id="Sec23">
      <title>Cell auto-fluorescence estimation</title>
      <p id="Par102">In addition to the background fluorescence of the PDMS and stray fluorescence from nearby cells that are corrected for by the methods described in the previous section, there is background fluorescence coming from the auto-fluorescence of the cells and media. To estimate this auto-fluorescence, we measured the wild-type strain of <italic>E. coli</italic> MG1655, i.e. without the fluorescent reporter, in the conditions where we switch between glucose and lactose. We observed that the estimated total fluorescence, i.e. the amplitude <italic>A</italic> from the previous section, correlates well with the size of the cells during their cell cycle. That is, fitting a linear relationship <italic>A</italic> = <italic>aS</italic>+<italic>b</italic> of the fluorescence <italic>A</italic> as a function of the estimated cell size <italic>S</italic> typically yields Pearson correlation coefficients of <italic>r</italic> ≈ 0.9. Moreover, we observed that the vast majority of fits were consistent with <italic>b</italic> = 0, i.e. the total fluorescence being directly proportional to cell size, supporting that this signal corresponds to the auto-fluorescence of the cell. Note that any uniform fluorescence coming from the growth medium would also be accounted for by this procedure (in the parameter <italic>a</italic>).</p>
      <p id="Par103">To fit the auto-fluorescence <italic>a</italic> (per micrometre of cell length) we selected all cells that were observed for a full cell cycle, who never got within 100 pixels of the end of the growth-channel during their cell cycle, and whose length as a function of time was well fit by a simple exponential growth curve (<italic>r</italic><sup>2</sup> ≥ 0.99). This latter restriction mainly serves to remove cells that had a transient stop in growth after the first switch to lactose. In total there were 284 cells that passed all these criteria. For each of these cells we replaced the directly estimated sizes <italic>S</italic><sub><italic>t</italic></sub> at each time point <italic>t</italic>, with the sizes <inline-formula id="IEq19"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde S_t$$\end{document}</tex-math><mml:math id="M64"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq19.gif"/></alternatives></inline-formula> estimated from the exponential fit of <italic>S</italic><sub><italic>t</italic></sub> as a function of time (reasoning that these estimates are more accurate than the direct measurements). For each cell we then fit a function <inline-formula id="IEq20"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A_t = a\tilde S_t$$\end{document}</tex-math><mml:math id="M66"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq20.gif"/></alternatives></inline-formula>, assuming Gaussian measurement noise of unknown variance.</p>
      <p id="Par104">That is, for a single cell we write<disp-formula id="Equ14"><label>14</label><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$P\left( {D|a,\sigma } \right) \propto \sigma ^{ - T}\,{\mathrm{exp}}\left[ { - \mathop {\sum}\limits_t \frac{{\left( {A_t - a\tilde S_t} \right)^2}}{{2\sigma ^2}}} \right].$$\end{document}</tex-math><mml:math id="M68" display="block"><mml:mi>P</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>D</mml:mi><mml:mo>∣</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>σ</mml:mi></mml:mrow></mml:mfenced><mml:mo>∝</mml:mo><mml:msup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mspace width="0.3em"/><mml:mi mathvariant="normal">exp</mml:mi><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:mo>-</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mi>a</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par105">Using a scale prior on <italic>σ</italic> of the form <italic>P</italic>(<italic>σ</italic>) ∝ 1/<italic>σ</italic>, and integrating over <italic>σ</italic> we obtain<disp-formula id="Equ15"><label>15</label><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$P(a|D) \propto \left[ {\left\langle {\tilde S^2} \right\rangle \left( {a - \frac{{\left\langle {A\tilde S} \right\rangle }}{{\left\langle {\tilde S^2} \right\rangle }}} \right)^2 + \left\langle {A^2} \right\rangle - \frac{{\left\langle {A\tilde S} \right\rangle }}{{\left\langle {\tilde S^2} \right\rangle }}} \right]^{ - T/2},$$\end{document}</tex-math><mml:math id="M70" display="block"><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>∣</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∝</mml:mo><mml:msup><mml:mrow><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>a</mml:mi><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:mi>A</mml:mi><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:mi>A</mml:mi><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mi>T</mml:mi><mml:mo>∕</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ15.gif" position="anchor"/></alternatives></disp-formula>where <italic>T</italic> is the number of time points in the cell cycle and the averages are over the time points in the cell cycle.</p>
      <p id="Par106">The optimal value of <italic>a</italic> is given by<disp-formula id="Equ16"><label>16</label><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$a_ \ast = \frac{{\left\langle {A\tilde S} \right\rangle }}{{\left\langle {\tilde S^2} \right\rangle }}.$$\end{document}</tex-math><mml:math id="M72" display="block"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:mi>A</mml:mi><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ16.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par107">Approximating the posterior by a Gaussian we obtain for the standard deviation of the estimated <italic>a</italic><disp-formula id="Equ17"><label>17</label><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma _a = \sqrt {\frac{1}{T}\left[ {\frac{{\left\langle {A^2} \right\rangle }}{{\left\langle {\tilde S^2} \right\rangle }} - a_ \ast ^2} \right]} .$$\end{document}</tex-math><mml:math id="M74" display="block"><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:mfrac><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>-</mml:mo><mml:msubsup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:msqrt><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ17.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par108">Figure <xref rid="Fig8" ref-type="fig">8a</xref> shows the estimated value <italic>a</italic><sub>*</sub> and its error bar <italic>σ</italic><sub><italic>a</italic></sub> for each of the 284 cells. Note that, although most cells have fluorescence values between 400 and 500 per μm, there are some outliers at higher fluorescence. This is also evident from the combined probability density of <italic>a</italic> values (Fig. <xref rid="Fig8" ref-type="fig">8b</xref>).<fig id="Fig8"><label>Fig. 8</label><caption><p>Estimating auto-fluorescence and fluorescence decay. <bold>a</bold> Estimated auto-fluorescence per micrometre cell length <italic>a</italic><sub>*</sub> and its error bar <italic>σ</italic><sub><italic>a</italic></sub> for 284 cells for which fluorescence was fit as a function of cell size. The red line (<italic>a</italic> = 433.5) is the fit obtained when all cells are assumed to have a common fluorescence per micrometre <italic>a</italic>. The green line is obtained with a mixture model that allows for “outliers” from a uniform distribution (<italic>a</italic> = 421.8). <bold>b</bold> The joint probability density of <italic>a</italic> given by the mixture of Gaussian distributions for all 284 cells. <bold>c</bold> GFP decay (including bleaching) was estimated by fitting observations of decreasing GFP levels during the glucose phases in the switching experiments, when no GFP is synthesized, to an exponential function of time. The panel shows the cumulative distribution of the Pearson correlations between the estimated log-GFP levels and time. <bold>d</bold> Estimated decay rates for individual cells (vertical axis) as a function of absolute GFP level of the cell (horizontal axis). The dashed line shows the overall estimated rate used in subsequent analysis</p></caption><graphic xlink:href="41467_2017_2505_Fig8_HTML" id="d29e3968"/></fig></p>
      <p id="Par109">If we assume there is one common background fluorescence per micrometre <italic>α</italic> for all cells, then the probability of the data given <italic>α</italic> is given by<disp-formula id="Equ18"><label>18</label><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$P(D|\alpha ) = \mathop {\prod}\limits_c \frac{1}{{\sigma _a(c)}}{\mathrm{exp}}\left[ { - \frac{{\left( {a_ \ast (c) - \alpha } \right)^2}}{{2\sigma _a(c)^2}}} \right],$$\end{document}</tex-math><mml:math id="M76" display="block"><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>D</mml:mi><mml:mo>∣</mml:mo><mml:mi>α</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo> ∏</mml:mo></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">exp</mml:mi><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:mi>α</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ18.gif" position="anchor"/></alternatives></disp-formula>where the product is over the 284 cells <italic>c</italic>.</p>
      <p id="Par110">Maximizing this function with respect to <italic>α</italic> yields<disp-formula id="Equ19"><label>19</label><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha = \mathop {\sum}\limits_c \frac{{a_ \ast (c)}}{{\sigma _a(c)^2}}\left[ {\mathop {\sum}\limits_c \frac{1}{{\sigma _a(c)^2}}} \right]^{ - 1} = 433.5.$$\end{document}</tex-math><mml:math id="M78" display="block"><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mn>433.5</mml:mn><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ19.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par111">If we allow that there are some ‘outlier’ cells whose value of <italic>a</italic> is described by a uniform distribution of width <italic>W</italic> = <italic>a</italic><sub>max</sub> − <italic>a</italic><sub>min</sub>, then the likelihood of the data as a function of <italic>α</italic> and the fraction of non-outlier measurements <italic>ρ</italic> is given by<disp-formula id="Equ20"><label>20</label><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$P(D|\alpha ,\rho ) = \mathop {\prod}\limits_c \left[ {\frac{{1 - \rho }}{W} + \frac{{\rho \,{\mathrm{exp}}\left( { - \frac{{\left( {\alpha - a_ \ast (c)} \right)^2}}{{2\sigma _a(c)^2}}} \right)}}{{\sqrt {2\pi } \sigma _a(c)}}} \right].$$\end{document}</tex-math><mml:math id="M80" display="block"><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>D</mml:mi><mml:mo>∣</mml:mo><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo> ∏</mml:mo></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:munder><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>ρ</mml:mi><mml:mspace width="0.3em"/><mml:mi mathvariant="normal">exp</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>α</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:msqrt><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:msqrt><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ20.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par112">Maximizing this function with respect to <italic>α</italic> and <italic>ρ</italic> yields <italic>α</italic> = 421.8 and <italic>ρ</italic> = 0.31. In the following we will use this latter value of <italic>α</italic> for the auto-fluorescence per micrometre of cell length. For each cell with estimated size <italic>S</italic> and total fluorescence <italic>A</italic>, we thus obtain an auto-fluorescence corrected fluorescence level <inline-formula id="IEq21"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde A = A - \alpha S$$\end{document}</tex-math><mml:math id="M82"><mml:mi>Ã</mml:mi><mml:mo>=</mml:mo><mml:mi>A</mml:mi><mml:mo>-</mml:mo><mml:mi>α</mml:mi><mml:mi>S</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq21.gif"/></alternatives></inline-formula>.</p>
    </sec>
    <sec id="Sec24">
      <title>Estimating GFP’s bleaching and degradation</title>
      <p id="Par113">As shown in Fig. <xref rid="Fig2" ref-type="fig">2a</xref>, while the <italic>lac</italic> operon is induced in the lactose phases, GFP production ceases during the glucose phases. In this regime, the total cell fluorescence slowly decreases during the cell cycle, and approximately divides in half at each cell division. We reasoned that the slow continuous decay of fluorescence during the cell cycles is the result of GFP bleaching and, potentially, also some GFP degradation. Inspection of the data indeed shows that the total fluorescence decrease is captured well by an exponential model. For this analysis, we consider only observations between 30 min after the switch to glucose and before the next switch to lactose, and to cells with at least 10 points in this time window. This corresponded to 33,052 independent cell observations over 1220 cells.</p>
      <p id="Par114">As shown in Fig. <xref rid="Fig8" ref-type="fig">8c</xref>, the GFP degradation across time is well fit by an exponential model for most cells. Assuming that a cell undergoes bleaching+GFP degradation at a rate <italic>μ</italic> per second, we estimated <italic>μ</italic> for each cell from a linear regression of log(GFP level) against time (Fig. <xref rid="Fig8" ref-type="fig">8d</xref>). Combining information from the estimates of individual rates for each cell and their standard deviations, we estimate the overall rate <italic>μ</italic><sub>*</sub> to be equal to 5.3×10<sup>−5</sup> ± 5×10<sup>−7</sup> (mean ± s.d.) per second. Note that this corresponds to a loss of about 18% of the GFP signal per hour due to bleaching and GFP decay.</p>
    </sec>
    <sec id="Sec25">
      <title>Accuracy of the fluorescence estimation</title>
      <p id="Par115">We also took advantage of our unique ability to study the growth regime where no GFP is produced to quantify the measurement errors on the total GFP. Since, in the glucose phases of the switching experiments, the GFP dynamics is dominated by bleaching and degradation, and well described by an exponential decay model, we computed the squared residuals (normalized by the squared value) from the independent fits of log(GFP) as a function of time for each cell. As for the analysis of measurement errors on length, residuals are stratified into bins based on total GFP, and the means and standard errors of the normalized squared residuals (i.e. relative to total GFP) are computed for each bin (Fig. <xref rid="Fig2" ref-type="fig">2g</xref>). We find that the squared relative error on the GFP measurement scales inversely with the total GFP level (i.e. a power-law fit has exponent 1.01), which indicates that, as in shot noise, the squared error is inversely proportional to total GFP level. In practice, the absolute error is around 20 molecules when the cell has 200 GFP molecules (i.e. 10%), and around 80 molecules when the total is 4000 GFP molecules (i.e. 2%).</p>
    </sec>
    <sec id="Sec26">
      <title>Estimating the fluorescence per GFP molecule</title>
      <p id="Par116">To estimate the conversion factor between the background-corrected total fluorescence <inline-formula id="IEq22"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde A$$\end{document}</tex-math><mml:math id="M84"><mml:mi>Ã</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq22.gif"/></alternatives></inline-formula> and the number of GFP molecules, we will use data on the fluctuations in fluorescence levels of newborn sibling pairs. To avoid confounding effects from GFP production, we collected division events from the glucose phases in our switching experiments, when GFP production has ceased. Collecting division events from these phases has the added advantage that absolute GFP levels vary over a considerable range across cells during these phases, allowing us to quantify the size of fluctuations in sibling fluorescence as a function of total fluorescence. Our observations consist of fluorescence levels at birth (<italic>x</italic><sub><italic>i</italic></sub>, <italic>y</italic><sub><italic>i</italic></sub>) for sibling pairs of daughters, where <italic>i</italic> runs from 1 to <italic>N</italic>, with <italic>N</italic> the total number of such sibling pairs. Using the same criteria as in the decay analysis for mothers and daughters, we collected <italic>N</italic> = 357 sibling pairs. GFP levels at birth were estimated in each daughter cell as average of the levels at all time points corrected for the previously estimated decay. Assuming that the GFP molecules in the mother cell are distributed randomly between the daughters, the fluctuations in the numbers of GFP molecules going to each daughter should be binomial distributed, and this has been used previously to infer a conversion factor between GFP molecule numbers and fluorescence levels<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. In particular, assuming binomial fluctuations, the expectation of the square of the difference <inline-formula id="IEq23"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\langle {(n_i - m_i)^2} \right\rangle$$\end{document}</tex-math><mml:math id="M86"><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq23.gif"/></alternatives></inline-formula> should be equal to the total count <italic>n</italic><sub><italic>i</italic></sub>+<italic>m</italic><sub><italic>i</italic></sub>. Given a conversion factor <italic>λ</italic>, such that the GFP molecule counts correspond to (<italic>n</italic><sub><italic>i</italic></sub>, <italic>m</italic><sub><italic>i</italic></sub>) = <italic>λ</italic>(<italic>x</italic><sub><italic>i</italic></sub>, <italic>y</italic><sub><italic>i</italic></sub>), one can estimate <italic>λ</italic> by observing<disp-formula id="Equ21"><label>21</label><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$1 = \left\langle {\frac{{\left( {n_i - m_i} \right)^2}}{{n_i + m_i}}} \right\rangle = \lambda \left\langle {\frac{{\left( {x_i - y_i} \right)^2}}{{x_i + y_i}}} \right\rangle .$$\end{document}</tex-math><mml:math id="M88" display="block"><mml:mn>1</mml:mn><mml:mo>=</mml:mo><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>λ</mml:mi><mml:mfenced close="⟩" open="⟨" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ21.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par117">However, using this “naive” approach, we find that the conversion factor <italic>λ</italic> systematically decreases with total fluorescence (Fig. <xref rid="Fig9" ref-type="fig">9a</xref>), changing by as much as fourfold depending on whether division events with low or high absolute fluorescence are used. This result implies that the variance of fluorescence fluctuations grows faster than linear with total fluorescence, suggesting that there are additional fluctuations with variance proportional to total fluorescence squared. Inspection of the data strongly suggests that these additional fluctuations derive from fluctuations in the cell size of the daughters. That is, in addition to the binomial fluctuations there are fluctuations caused by the daughters having unequal size. Practically, cell size at birth is estimated in each daughter cell by extrapolating the linear fit of log(length) as a function of time. Indeed, we observe a substantial correlation between the relative sizes of the siblings and the relative amounts of fluorescence each sibling receives (Fig. <xref rid="Fig9" ref-type="fig">9b</xref>, Pearson correlation <italic>r</italic> = 0.44).<fig id="Fig9"><label>Fig. 9</label><caption><p>Estimating the conversion factor between fluorescence intensity and number of GFP molecules. <bold>a</bold> Estimated conversion factor <italic>λ</italic>, using the “naive” method which assumes there are only binomial fluctuations, as a function of total fluorescence. Division events were divided into bins based on the mother’s total fluorescence. Bin size was 5000. <bold>b</bold> Correlation between fluctuations in fluorescence and cytoplasm size of two sibling cells immediately after birth. Each dot corresponds to a pair of sister cells with the horizontal axes showing the fraction of the total cytoplasm of the mother and the vertical axis showing the fraction of the total fluorescence of the mother taken up by the first sister. <bold>c</bold> Posterior distribution <italic>P</italic>(<italic>λ</italic>|<italic>D</italic>) of the conversion factor <italic>λ</italic> given the data on our sibling pairs (blue curve). The red line shows the maximum likelihood value <italic>λ</italic><sub>*</sub> = 0.0361. The black lines show the estimated conversion factors that are obtained assuming binomial noise only. The solid line results from using all data, and the dashed lines result from different subsets at different absolute fluorescence values as in the left panel</p></caption><graphic xlink:href="41467_2017_2505_Fig9_HTML" id="d29e4741"/></fig></p>
      <p id="Par118">We thus developed a more sophisticated model, which takes into account fluctuations in the cell sizes, the binomial fluctuations, as well as measurement noise. For a given division event <italic>i</italic>, let <italic>ρ</italic><sub><italic>i</italic></sub> denote the measured fraction of the cytoplasm that went to the first daughter, and let <italic>q</italic><sub><italic>i</italic></sub> = <italic>x</italic><sub><italic>i</italic></sub>/(<italic>x</italic><sub><italic>i</italic></sub>+<italic>y</italic><sub><italic>i</italic></sub>) be the measured fraction of the fluorescence that went to the first daughter. We will assume that <italic>q</italic><sub><italic>i</italic></sub> is a noisy measurement of the true fraction of molecules <italic>q</italic> = <italic>n</italic><sub><italic>i</italic></sub>/(<italic>n</italic><sub><italic>i</italic></sub>+<italic>m</italic><sub><italic>i</italic></sub>) that went to the first daughter, and that <italic>ρ</italic><sub><italic>i</italic></sub> is a noisy measurement of the true fraction of the mother’s cytoplasm <italic>ρ</italic> that went to the first daughter. Given <italic>ρ</italic> and a total number of molecules <italic>n</italic> = (<italic>n</italic><sub><italic>i</italic></sub>+<italic>m</italic><sub><italic>i</italic></sub>), the molecule numbers (<italic>n</italic><sub><italic>i</italic></sub>, <italic>m</italic><sub><italic>i</italic></sub>) will show binomial fluctuations and the fraction <italic>q</italic> will have a variance var(<italic>q</italic>) = <italic>ρ</italic>(1−<italic>ρ</italic>)/<italic>n</italic>. In addition to this variance we will assume there is a total measurement noise of variance <italic>v</italic>, so that the total expected square-deviation between the measurements <italic>q</italic><sub><italic>i</italic></sub> and <italic>ρ</italic><sub><italic>i</italic></sub> should be <italic>v</italic>+<italic>ρ</italic>(1−<italic>ρ</italic>)/<italic>n</italic>. We will assume that the sum of these fluctuations due to the binomial noise and measurement noise is approximately Gaussian distributed. Finally, we will assume that the binomial variance <italic>ρ</italic>(1−<italic>ρ</italic>)/<italic>n</italic> is well approximated by the measured values <italic>ρ</italic><sub><italic>i</italic></sub>(1−<italic>ρ</italic><sub><italic>i</italic></sub>)/(<italic>λ</italic>(<italic>x</italic><sub><italic>i</italic></sub>+<italic>y</italic><sub><italic>i</italic></sub>)).</p>
      <p id="Par119">Under this model, the probability of observing the fraction <italic>q</italic><sub><italic>i</italic></sub>, given the measured volume fraction <italic>ρ</italic><sub><italic>i</italic></sub>, the conversion factor <italic>λ</italic>, and the total measurement noise <italic>v</italic> is given by<disp-formula id="Equ22"><label>22</label><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$P\left( {q_i|\rho _i,\lambda ,v} \right) = \left( {v + \frac{{\rho _i(1 - \rho _i)}}{{\lambda \left( {x_i + y_i} \right)}}} \right)^{ - 1/2}{\mathrm{exp}}\left[ { - \frac{{\left( {q_i - \rho _i} \right)^2}}{{2\left( {v + \frac{{\rho _i(1 - \rho _i)}}{{\lambda \left( {x_i + y_i} \right)}}} \right)}}} \right].$$\end{document}</tex-math><mml:math id="M90" display="block"><mml:mi>P</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>v</mml:mi><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>λ</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo>∕</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="normal">exp</mml:mi><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>v</mml:mi><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>λ</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ22.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par120">The log-likelihood of <italic>λ</italic> and <italic>v</italic> is now given by a sum over the <italic>N</italic> division events:<disp-formula id="Equ23"><label>23</label><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L(\lambda ,v) = - \frac{1}{2}\mathop {\sum}\limits_{i = 1}^N \frac{{(q_i - \rho _i)^2}}{{\left( {v + \frac{{\rho _i(1 - \rho _i)}}{{\lambda (x_i + y_i)}}} \right)}} + \log \left[ {v + \frac{{\rho _i(1 - \rho _i)}}{{\lambda (x_i + y_i)}}} \right].$$\end{document}</tex-math><mml:math id="M92" display="block"><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>v</mml:mi><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>λ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mo> log</mml:mo><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:mi>v</mml:mi><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>λ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ23.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par121">To obtain the posterior probability of <italic>λ</italic> we marginalize over the unknown variance <italic>v</italic> (using a uniform prior). That is, we calculate <inline-formula id="IEq24"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L(\lambda ) = {\mathrm{log}}\left[ {{\int} {\mathrm{exp}}[L(\lambda ,v)]{\rm d}v} \right]$$\end{document}</tex-math><mml:math id="M94"><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">log</mml:mi><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:mo>∫</mml:mo><mml:mi mathvariant="normal">exp</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mi mathvariant="normal">d</mml:mi><mml:mi>v</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2505_Article_IEq24.gif"/></alternatives></inline-formula>, performing the integral numerically. Using this model, the maximal likelihood value of <italic>λ</italic> is given by<disp-formula id="Equ24"><label>24</label><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\lambda _ \ast = 0.0361,$$\end{document}</tex-math><mml:math id="M96" display="block"><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.0361</mml:mn><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2505_Article_Equ24.gif" position="anchor"/></alternatives></disp-formula>and the symmetric 95% posterior probability interval is given by <italic>λ</italic> ∈ [0.026, 0.112].</p>
      <p id="Par122">Figure <xref rid="Fig9" ref-type="fig">9c</xref> shows the posterior distribution <italic>P</italic>(<italic>λ</italic>|<italic>D</italic>) obtained with our model. For comparison, Fig. <xref rid="Fig9" ref-type="fig">9c</xref> also shows the conversion factors that would be obtained with the naive method that assumes there is only binomial noise, i.e. using all data the number of molecules would be underestimated by almost twofold.</p>
    </sec>
    <sec id="Sec27">
      <title>Data availability</title>
      <p id="Par123">
        <list list-type="bullet">
          <list-item>
            <p id="Par124">The designs of the DIMM device, as well as a handbook with detailed experimental methods, are available from Metafluidics web repository at <ext-link ext-link-type="uri" xlink:href="https://metafluidics.org/devices/dual-input-mother-machine/">https://metafluidics.org/devices/dual-input-mother-machine/</ext-link>.</p>
          </list-item>
          <list-item>
            <p id="Par125">The MoMA software and source code is available on Github: <ext-link ext-link-type="uri" xlink:href="https://github.com/fjug/MoMA">https://github.com/fjug/MoMA</ext-link>. For end users, MoMA is also available as a Fiji plugin at <ext-link ext-link-type="uri" xlink:href="http://sites.imagej.net/MoMA">http://sites.imagej.net/MoMA</ext-link>.</p>
          </list-item>
          <list-item>
            <p id="Par126">Extensive documentation is provided as a Wiki page containing information about MoMA’s installation and use, as well as tutorial videos: <ext-link ext-link-type="uri" xlink:href="https://github.com/fjug/MoMA/wiki">https://github.com/fjug/MoMA/wiki</ext-link>.</p>
          </list-item>
          <list-item>
            <p id="Par127">Raw image data of the analyzed growth-channels as well as processed data (estimated cell sizes and fluorescence levels) for all experiments presented in the paper are available from Zenodo at https://doi.org/10.5281/zenodo.746230. A README file is provided with detailed explanation as to which file corresponds to which experiment, and the file format of the processed data files.</p>
          </list-item>
          <list-item>
            <p id="Par128">A movie from a time lapse experiment in which <italic>E. coli</italic> ASC622 cells grow in the DIMM under conditions that switch (every 4 h) between glucose and lactose as a carbon source is available on Youtube: <ext-link ext-link-type="uri" xlink:href="https://www.youtube.com/watch?v=2Tznm868fmc">https://www.youtube.com/watch?v=2Tznm868fmc</ext-link>. This movie is also available as Supplementary Movie <xref rid="MOESM3" ref-type="media">1</xref>.</p>
          </list-item>
        </list>
      </p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Electronic supplementary material</title>
    <sec id="Sec28">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2017_2505_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2017_2505_MOESM2_ESM.pdf">
            <caption>
              <p>Description of Additional Supplementary Files</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2017_2505_MOESM3_ESM.mp4">
            <caption>
              <p>Supplementary Movie 1</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>Matthias Kaiser, Florian Jug and Thomas Julou contributed equally to this work.</p>
    </fn>
    <fn>
      <p>
        <bold>Electronic supplementary material</bold>
      </p>
      <p><bold>Supplementary Information</bold> accompanies this paper at 10.1038/s41467-017-02505-0.</p>
    </fn>
    <fn>
      <p><bold>Publisher's note:</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank Benjamin Sellner, Urs Jenal, Christian Schwall, James Locke, and Lydia Robert for sharing their raw data with us, to allow us to demonstrate MoMA’s general applicability on data sets from different labs and setups.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>O.S., G.M., and E.v.N. designed the research. M.K., O.S., S.D., and T.P. designed and prototyped the DIMM device. M.K. and T.J. designed and performed the experiments. F.J. designed and wrote the MoMA software. T.J. and E.v.N. developed and applied data processing methods. M.K., T.J., and E.v.N. analyzed the data. M.K., F.J., T.J,. O.S., G.M., and E.v.N. wrote the paper.</p>
  </notes>
  <notes notes-type="COI-statement">
    <sec id="FPar1">
      <title>Competing interests</title>
      <p id="Par129">The authors declare no competing financial interests.</p>
    </sec>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jacob</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Monod</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Genetic regulatory mechanisms in the synthesis of proteins</article-title>
        <source>J. Mol. Biol.</source>
        <year>1961</year>
        <volume>3</volume>
        <fpage>318</fpage>
        <lpage>356</lpage>
        <pub-id pub-id-type="doi">10.1016/S0022-2836(61)80072-7</pub-id>
        <?supplied-pmid 13718526?>
        <pub-id pub-id-type="pmid">13718526</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Elowitz</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Levine</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Siggia</surname>
            <given-names>ED</given-names>
          </name>
          <name>
            <surname>Swain</surname>
            <given-names>PS</given-names>
          </name>
        </person-group>
        <article-title>Stochastic gene expression in a single cell</article-title>
        <source>Science</source>
        <year>2002</year>
        <volume>297</volume>
        <fpage>1183</fpage>
        <lpage>1186</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1070919</pub-id>
        <?supplied-pmid 12183631?>
        <pub-id pub-id-type="pmid">12183631</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ozbudak</surname>
            <given-names>EM</given-names>
          </name>
          <name>
            <surname>Thattai</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Kurtser</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Grossman</surname>
            <given-names>AD</given-names>
          </name>
          <name>
            <surname>van Oudenaarden</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Regulation of noise in the expression of a single gene</article-title>
        <source>Nat. Genet.</source>
        <year>2002</year>
        <volume>31</volume>
        <fpage>69</fpage>
        <lpage>73</lpage>
        <pub-id pub-id-type="doi">10.1038/ng869</pub-id>
        <?supplied-pmid 11967532?>
        <pub-id pub-id-type="pmid">11967532</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Taniguchi</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Quantifying <italic>E. coli</italic> proteome and transcriptome with single-molecule sensitivity in single cells</article-title>
        <source>Science</source>
        <year>2010</year>
        <volume>329</volume>
        <fpage>533</fpage>
        <lpage>538</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1188308</pub-id>
        <?supplied-pmid 20671182?>
        <pub-id pub-id-type="pmid">20671182</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hashimshony</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Wagner</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Sher</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Yanai</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>CEL-Seq: single-cell RNA-Seq by multiplexed linear amplification</article-title>
        <source>Cell Rep.</source>
        <year>2012</year>
        <volume>2</volume>
        <fpage>666</fpage>
        <lpage>673</lpage>
        <pub-id pub-id-type="doi">10.1016/j.celrep.2012.08.003</pub-id>
        <?supplied-pmid 22939981?>
        <pub-id pub-id-type="pmid">22939981</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cai</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Dalal</surname>
            <given-names>CK</given-names>
          </name>
          <name>
            <surname>Elowitz</surname>
            <given-names>MB</given-names>
          </name>
        </person-group>
        <article-title>Frequency-modulated nuclear localization bursts coordinate gene regulation</article-title>
        <source>Nature</source>
        <year>2008</year>
        <volume>455</volume>
        <fpage>485</fpage>
        <lpage>490</lpage>
        <pub-id pub-id-type="doi">10.1038/nature07292</pub-id>
        <?supplied-pmid 18818649?>
        <pub-id pub-id-type="pmid">18818649</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kiviet</surname>
            <given-names>DJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Stochasticity of metabolism and growth at the single-cell level</article-title>
        <source>Nature</source>
        <year>2014</year>
        <volume>514</volume>
        <fpage>376</fpage>
        <lpage>379</lpage>
        <pub-id pub-id-type="doi">10.1038/nature13582</pub-id>
        <?supplied-pmid 25186725?>
        <pub-id pub-id-type="pmid">25186725</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ducret</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A microscope automated fluidic system to study bacterial processes in real time</article-title>
        <source>PLoS ONE</source>
        <year>2009</year>
        <volume>4</volume>
        <fpage>e7282</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0007282</pub-id>
        <?supplied-pmid 19789641?>
        <pub-id pub-id-type="pmid">19789641</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Robert</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Pre-dispositions and epigenetic inheritance in the <italic>Escherichia coli</italic> lactose operon bistable switch</article-title>
        <source>Mol. Syst. Biol.</source>
        <year>2010</year>
        <volume>6</volume>
        <fpage>357</fpage>
        <pub-id pub-id-type="doi">10.1038/msb.2010.12</pub-id>
        <?supplied-pmid 20393577?>
        <pub-id pub-id-type="pmid">20393577</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Boulineau</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell dynamics reveals sustained growth during diauxic shifts</article-title>
        <source>PLoS ONE</source>
        <year>2013</year>
        <volume>8</volume>
        <fpage>e61686</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0061686</pub-id>
        <?supplied-pmid 23637881?>
        <pub-id pub-id-type="pmid">23637881</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Robust growth of <italic>Escherichia coli</italic></article-title>
        <source>Curr. Biol.</source>
        <year>2010</year>
        <volume>20</volume>
        <fpage>1099</fpage>
        <lpage>1103</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cub.2010.04.045</pub-id>
        <?supplied-pmid 20537537?>
        <pub-id pub-id-type="pmid">20537537</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ullman</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High-throughput gene expression analysis at the level of single proteins using a microfluidic turbidostat and automated cell tracking</article-title>
        <source>Philos. Trans. R. Soc. Lond. B: Biol. Sci.</source>
        <year>2012</year>
        <volume>368</volume>
        <fpage>20120025</fpage>
        <pub-id pub-id-type="doi">10.1098/rstb.2012.0025</pub-id>
        <pub-id pub-id-type="pmid">23267179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lambert</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Kussell</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Memory and fitness optimization of bacteria under fluctuating environments</article-title>
        <source>PLoS Genet.</source>
        <year>2014</year>
        <volume>10</volume>
        <fpage>e1004556</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pgen.1004556</pub-id>
        <?supplied-pmid 25255314?>
        <pub-id pub-id-type="pmid">25255314</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Norman</surname>
            <given-names>TM</given-names>
          </name>
          <name>
            <surname>Lord</surname>
            <given-names>ND</given-names>
          </name>
          <name>
            <surname>Paulsson</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Losick</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Memory and modularity in cell-fate decision making</article-title>
        <source>Nature</source>
        <year>2013</year>
        <volume>503</volume>
        <fpage>481</fpage>
        <lpage>486</lpage>
        <pub-id pub-id-type="doi">10.1038/nature12804</pub-id>
        <?supplied-pmid 24256735?>
        <pub-id pub-id-type="pmid">24256735</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Long</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Measuring bacterial adaptation dynamics at the single-cell level using a microfluidic chemostat and time-lapse fluorescence microscopy</article-title>
        <source>Analyst</source>
        <year>2014</year>
        <volume>139</volume>
        <fpage>5254</fpage>
        <lpage>5262</lpage>
        <pub-id pub-id-type="doi">10.1039/C4AN00877D</pub-id>
        <?supplied-pmid 25137302?>
        <pub-id pub-id-type="pmid">25137302</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sliusarenko</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Heinritz</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Emonet</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Jacobs-Wagner</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>High-throughput, subpixel precision analysis of bacterial morphogenesis and intracellular spatio-temporal dynamics</article-title>
        <source>Mol. Microbiol.</source>
        <year>2011</year>
        <volume>80</volume>
        <fpage>612</fpage>
        <lpage>627</lpage>
        <pub-id pub-id-type="doi">10.1111/j.1365-2958.2011.07579.x</pub-id>
        <?supplied-pmid 21414037?>
        <pub-id pub-id-type="pmid">21414037</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Young</surname>
            <given-names>JW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Measuring single-cell gene expression dynamics in bacteria using fluorescence time-lapse microscopy</article-title>
        <source>Nat. Protoc.</source>
        <year>2012</year>
        <volume>7</volume>
        <fpage>80</fpage>
        <lpage>88</lpage>
        <pub-id pub-id-type="doi">10.1038/nprot.2011.432</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Paintdakhi</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Oufti: an integrated software package for high-accuracy, high-throughput quantitative microscopy analysis</article-title>
        <source>Mol. Microbiol.</source>
        <year>2016</year>
        <volume>99</volume>
        <fpage>767</fpage>
        <lpage>777</lpage>
        <pub-id pub-id-type="doi">10.1111/mmi.13264</pub-id>
        <?supplied-pmid 26538279?>
        <pub-id pub-id-type="pmid">26538279</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tanouchi</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A noisy linear map underlies oscillations in cell size and gene expression in bacteria</article-title>
        <source>Nature</source>
        <year>2015</year>
        <volume>523</volume>
        <fpage>357</fpage>
        <lpage>360</lpage>
        <pub-id pub-id-type="doi">10.1038/nature14562</pub-id>
        <?supplied-pmid 26040722?>
        <pub-id pub-id-type="pmid">26040722</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Taheri-Araghi</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cell-size control and homeostasis in bacteria</article-title>
        <source>Curr. Biol.</source>
        <year>2015</year>
        <volume>25</volume>
        <fpage>385</fpage>
        <lpage>391</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cub.2014.12.009</pub-id>
        <?supplied-pmid 25544609?>
        <pub-id pub-id-type="pmid">25544609</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hashimoto</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Noise-driven growth rate gain in clonal cellular populations</article-title>
        <source>Proc. Natl. Acad. Sci. USA</source>
        <year>2016</year>
        <volume>113</volume>
        <fpage>3251</fpage>
        <lpage>3256</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1519412113</pub-id>
        <?supplied-pmid 26951676?>
        <pub-id pub-id-type="pmid">26951676</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Ferry, M. S., Razinkov, I. A. &amp; Hasty, J. in <italic>Methods in Enzymology</italic>, Vol. 497 of Synthetic Biology, Part A (ed. Voigt, C.) 295–372 (Academic Press, Cambridge, MA, 2011).</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <mixed-citation publication-type="other">Jug, F. et al. in <italic>Bayesian and Graphical Models for Biomedical Imaging</italic> (eds Jorge Cardoso, M., Simpson, I., Arbel, T., Precup, D. &amp; Ribbens, A.) (Springer, Cambridge, MA, 2014).</mixed-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rosenfeld</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Young</surname>
            <given-names>JW</given-names>
          </name>
          <name>
            <surname>Alon</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Swain</surname>
            <given-names>PS</given-names>
          </name>
          <name>
            <surname>Elowitz</surname>
            <given-names>MB</given-names>
          </name>
        </person-group>
        <article-title>Gene regulation at the single-cell level</article-title>
        <source>Science</source>
        <year>2005</year>
        <volume>307</volume>
        <fpage>1962</fpage>
        <lpage>1965</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1106914</pub-id>
        <?supplied-pmid 15790856?>
        <pub-id pub-id-type="pmid">15790856</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Novick</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Weiner</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Enzyme induction as an all-or-none phenomenon</article-title>
        <source>Proc. Natl. Acad. Sci. USA</source>
        <year>1957</year>
        <volume>43</volume>
        <fpage>553</fpage>
        <lpage>566</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.43.7.553</pub-id>
        <?supplied-pmid 16590055?>
        <pub-id pub-id-type="pmid">16590055</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ozbudak</surname>
            <given-names>EM</given-names>
          </name>
          <name>
            <surname>Thattai</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Lim</surname>
            <given-names>HN</given-names>
          </name>
          <name>
            <surname>Shraiman</surname>
            <given-names>BI</given-names>
          </name>
          <name>
            <surname>Van Oudenaarden</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Multistability in the lactose utilization network of <italic>Escherichia coli</italic></article-title>
        <source>Nature</source>
        <year>2004</year>
        <volume>427</volume>
        <fpage>737</fpage>
        <lpage>740</lpage>
        <pub-id pub-id-type="doi">10.1038/nature02298</pub-id>
        <?supplied-pmid 14973486?>
        <pub-id pub-id-type="pmid">14973486</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Choi</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Cai</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Frieda</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>XS</given-names>
          </name>
        </person-group>
        <article-title>A stochastic single-molecule event triggers phenotype switching of a bacterial cell</article-title>
        <source>Science</source>
        <year>2008</year>
        <volume>322</volume>
        <fpage>442</fpage>
        <lpage>446</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1161427</pub-id>
        <?supplied-pmid 18927393?>
        <pub-id pub-id-type="pmid">18927393</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bhogale</surname>
            <given-names>PM</given-names>
          </name>
          <name>
            <surname>Sorg</surname>
            <given-names>RA</given-names>
          </name>
          <name>
            <surname>Veening</surname>
            <given-names>JW</given-names>
          </name>
          <name>
            <surname>Berg</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>What makes the lac-pathway switch: identifying the fluctuations that trigger phenotype switching in gene regulatory systems</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2014</year>
        <volume>42</volume>
        <fpage>11321</fpage>
        <lpage>11328</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gku839</pub-id>
        <?supplied-pmid 25245949?>
        <pub-id pub-id-type="pmid">25245949</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cai</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Friedman</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>XS</given-names>
          </name>
        </person-group>
        <article-title>Stochastic protein expression in individual cells at the single molecule level</article-title>
        <source>Nature</source>
        <year>2006</year>
        <volume>440</volume>
        <fpage>358</fpage>
        <lpage>362</lpage>
        <pub-id pub-id-type="doi">10.1038/nature04599</pub-id>
        <?supplied-pmid 16541077?>
        <pub-id pub-id-type="pmid">16541077</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <mixed-citation publication-type="other">Jug, F. Moma—the mothermachine analyzer. <ext-link ext-link-type="uri" xlink:href="https://github.com/fjug/MoMA">https://github.com/fjug/MoMA</ext-link> (2016).</mixed-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <mixed-citation publication-type="other">Metafluidics. Open repository for fluidic systems. <ext-link ext-link-type="uri" xlink:href="https://metafluidics.org/devices/dual-input-mother-machine/">https://metafluidics.org/devices/dual-input-mother-machine/</ext-link> (2017).</mixed-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stroock</surname>
            <given-names>AD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Chaotic mixer for microchannels</article-title>
        <source>Science</source>
        <year>2002</year>
        <volume>295</volume>
        <fpage>647</fpage>
        <lpage>651</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1066238</pub-id>
        <?supplied-pmid 11809963?>
        <pub-id pub-id-type="pmid">11809963</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Edelstein</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Amodaj</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Hoover</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Vale</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Stuurman</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Computer control of microscopes using <italic>μ</italic>Manager</article-title>
        <source>Curr. Protoc. Mol. Biol.</source>
        <year>2010</year>
        <volume>Unit 14.20</volume>
        <fpage>1</fpage>
        <lpage>17</lpage>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kalman</surname>
            <given-names>RE</given-names>
          </name>
        </person-group>
        <article-title>A new approach to linear filtering and prediction problems</article-title>
        <source>J. Basic Eng.</source>
        <year>1960</year>
        <volume>82</volume>
        <fpage>35</fpage>
        <lpage>45</lpage>
        <pub-id pub-id-type="doi">10.1115/1.3662552</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <mixed-citation publication-type="other">Bar-Shalom, Y. <italic>Multitarget-Multisensor Tracking: Advanced Applications</italic> Vol. 391 (Artech House, Norwood, MA, 1990).</mixed-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chenouard</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Bloch</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Olivo-Marin</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Multiple hypothesis tracking for cluttered biological image sequences</article-title>
        <source>IEEE Trans. Pattern Anal. Mach. Intell.</source>
        <year>2013</year>
        <volume>35</volume>
        <fpage>2736</fpage>
        <lpage>3750</lpage>
        <pub-id pub-id-type="doi">10.1109/TPAMI.2013.97</pub-id>
        <?supplied-pmid 24051732?>
        <pub-id pub-id-type="pmid">24051732</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <mixed-citation publication-type="other">Jiang, H., Fels, S. &amp; Little, J. J. in <italic>Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition (CVPR)</italic> 1–8 https://doi.org/10.1109/cvpr.2007.383180.24 (2007).</mixed-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Kausler, B. X. et al. in <italic>ECCV’12: Proceedings of the 12th European Conference on Computer Vision</italic> (eds Fitzgibbon, A., Lazebnik, S., Perona, P., Sato, Y. &amp; Schmid, C.) 144–157 (Springer-Verlag, Berlin, Heidelberg, 2012).</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <mixed-citation publication-type="other">Funke, J., Anders, B., Hamprecht, F. A., Cardona, A. &amp; Cook, M. in <italic>CVPR ’12: Proceedings of the 2012 IEEE Conference on Computer Vision and Pattern Recognition (CVPR)</italic> 1004–1011 (IEEE Computer Society, Washington, DC, 2012).</mixed-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Schiegg, M., Hanslovsky, P., Kausler, B. X. &amp; Hufnagel, L. in <italic>Proceedings of the IEEE Conference on Computer Vision</italic><italic>ICCV 2013</italic>, 2928–2935 (IEEE, Sydney, 2013).</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Padfield, D., Rittscher, J. &amp; Roysam, B. in <italic>IPMI ’09: Proceedings of the 21st International Conference on Information Processing in Medical Imaging</italic> (Springer-Verlag, Berlin, Heidelberg, 2009).</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <mixed-citation publication-type="other">Schrivjer, A. <italic>Theory of Linear and Integer Programming</italic> (John Wiley &amp; Sons, New York, NY, 1998).</mixed-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schindelin</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fiji: an open-source platform for biological-image analysis</article-title>
        <source>Nat. Methods</source>
        <year>2012</year>
        <volume>9</volume>
        <fpage>676</fpage>
        <lpage>682</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2019</pub-id>
        <?supplied-pmid 22743772?>
        <pub-id pub-id-type="pmid">22743772</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schindelin</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Rueden</surname>
            <given-names>CT</given-names>
          </name>
          <name>
            <surname>Hiner</surname>
            <given-names>MC</given-names>
          </name>
          <name>
            <surname>Eliceiri</surname>
            <given-names>KW</given-names>
          </name>
        </person-group>
        <article-title>The ImageJ ecosystem: an open platform for biomedical image analysis</article-title>
        <source>Mol. Reprod. Dev.</source>
        <year>2015</year>
        <volume>82</volume>
        <fpage>518</fpage>
        <lpage>529</lpage>
        <pub-id pub-id-type="doi">10.1002/mrd.22489</pub-id>
        <?supplied-pmid 26153368?>
        <pub-id pub-id-type="pmid">26153368</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pietzsch</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Preibisch</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Tomancak</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Saalfeld</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>ImgLib2—generic image processing in Java</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <fpage>3009</fpage>
        <lpage>3011</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bts543</pub-id>
        <?supplied-pmid 22962343?>
        <pub-id pub-id-type="pmid">22962343</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Blattner</surname>
            <given-names>FR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The complete genome sequence of <italic>Escherichia coli</italic> K-12</article-title>
        <source>Science</source>
        <year>1997</year>
        <volume>277</volume>
        <fpage>1453</fpage>
        <lpage>1462</lpage>
        <pub-id pub-id-type="doi">10.1126/science.277.5331.1453</pub-id>
        <?supplied-pmid 9278503?>
        <pub-id pub-id-type="pmid">9278503</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
