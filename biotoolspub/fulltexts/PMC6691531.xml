<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Biol</journal-id>
    <journal-title-group>
      <journal-title>Genome Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1474-7596</issn>
    <issn pub-type="epub">1474-760X</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6691531</article-id>
    <article-id pub-id-type="publisher-id">1764</article-id>
    <article-id pub-id-type="doi">10.1186/s13059-019-1764-6</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>BERMUDA: a novel deep transfer learning method for single-cell RNA sequencing batch correction reveals hidden high-resolution cellular subtypes</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5826-1842</contrib-id>
        <name>
          <surname>Wang</surname>
          <given-names>Tongxin</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Johnson</surname>
          <given-names>Travis S.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Shao</surname>
          <given-names>Wei</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lu</surname>
          <given-names>Zixiao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Helm</surname>
          <given-names>Bryan R.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Zhang</surname>
          <given-names>Jie</given-names>
        </name>
        <address>
          <email>jizhan@iu.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Huang</surname>
          <given-names>Kun</given-names>
        </name>
        <address>
          <email>kunhuang@iu.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 0790 959X</institution-id><institution-id institution-id-type="GRID">grid.411377.7</institution-id><institution>Department of Computer Science, </institution><institution>Indiana University Bloomington, </institution></institution-wrap>Bloomington, IN USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2285 7943</institution-id><institution-id institution-id-type="GRID">grid.261331.4</institution-id><institution>Department of Biomedical Informatics, </institution><institution>The Ohio State University, </institution></institution-wrap>Columbus, OH USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2287 3919</institution-id><institution-id institution-id-type="GRID">grid.257413.6</institution-id><institution>Department of Medicine, </institution><institution>Indiana University School of Medicine, </institution></institution-wrap>Indianapolis, IN USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0000 8877 7471</institution-id><institution-id institution-id-type="GRID">grid.284723.8</institution-id><institution>Guangdong Provincial Key Laboratory of Medical Image Processing, </institution><institution>Southern Medical University, </institution></institution-wrap>Guangzhou, China </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2287 3919</institution-id><institution-id institution-id-type="GRID">grid.257413.6</institution-id><institution>Department of Medical and Molecular Genetics, </institution><institution>Indiana University School of Medicine, </institution></institution-wrap>Indianapolis, IN USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2287 2027</institution-id><institution-id institution-id-type="GRID">grid.448342.d</institution-id><institution>Regenstrief Institute, </institution></institution-wrap>Indianapolis, IN USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>12</day>
      <month>8</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>12</day>
      <month>8</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2019</year>
    </pub-date>
    <volume>20</volume>
    <elocation-id>165</elocation-id>
    <history>
      <date date-type="received">
        <day>9</day>
        <month>5</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>17</day>
        <month>7</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s). 2019</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold>This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">To fully utilize the power of single-cell RNA sequencing (scRNA-seq) technologies for identifying cell lineages and bona fide transcriptional signals, it is necessary to combine data from multiple experiments. We present <italic>BERMUDA</italic> (Batch Effect ReMoval Using Deep Autoencoders), a novel transfer-learning-based method for batch effect correction in scRNA-seq data. <italic>BERMUDA</italic> effectively combines different batches of scRNA-seq data with vastly different cell population compositions and amplifies biological signals by transferring information among batches. We demonstrate that <italic>BERMUDA</italic> outperforms existing methods for removing batch effects and distinguishing cell types in multiple simulated and real scRNA-seq datasets.</p>
      <sec>
        <title>Electronic supplementary material</title>
        <p>The online version of this article (10.1186/s13059-019-1764-6) contains supplementary material, which is available to authorized users.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Single cell</kwd>
      <kwd>RNA-seq</kwd>
      <kwd>Batch effect</kwd>
      <kwd>Transfer learning</kwd>
      <kwd>Autoencoder</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Indiana University School of Medicine</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Indiana University Precision Health Initiative</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>National Cancer Institute Informatics Technology for Cancer Research</institution>
        </funding-source>
        <award-id>U01CA188547</award-id>
        <principal-award-recipient>
          <name>
            <surname>Huang</surname>
            <given-names>Kun</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>National Institute of Health</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2019</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par2">Single-cell transcriptional dynamics are important for understanding molecular physiology and disease dysregulation within heterogeneous tissues. Until recently, the standard techniques for single-cell analysis were flow cytometry [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR2">2</xref>] and fluorescence imaging of tissue on slides [<xref ref-type="bibr" rid="CR3">3</xref>, <xref ref-type="bibr" rid="CR4">4</xref>]. Though these techniques have provided tremendous insights, they are limited to a small, pre-defined set of molecular markers [<xref ref-type="bibr" rid="CR1">1</xref>]. More recently, high-throughput techniques such as RNA sequencing (RNA-seq) were established to measure expression of thousands of genes, but were designed for bulk tissue samples [<xref ref-type="bibr" rid="CR5">5</xref>, <xref ref-type="bibr" rid="CR6">6</xref>]. Single-cell RNA sequencing (scRNA-seq) was developed to characterize high-throughput gene expression profiles for populations of individual cells, which has enabled an unprecedented resolution of cellular heterogeneity in complex tissues. Widespread adoption of scRNA-seq techniques has produced large complex datasets, which present new computational challenges for evaluating experimental reproducibility and combining data from different batches and platforms [<xref ref-type="bibr" rid="CR5">5</xref>, <xref ref-type="bibr" rid="CR7">7</xref>–<xref ref-type="bibr" rid="CR11">11</xref>].</p>
    <p id="Par3">There have been many attempts to combine gene expression data from different experiments to achieve a more comprehensive understanding of the underlying cellular heterogeneity. The first generation of tools was adapted from a linear model analysis of microarrays [<xref ref-type="bibr" rid="CR12">12</xref>–<xref ref-type="bibr" rid="CR14">14</xref>] and was subsequently modified for RNA-seq data via generalized linear [<xref ref-type="bibr" rid="CR15">15</xref>] or negative binomial models [<xref ref-type="bibr" rid="CR16">16</xref>]. These methods represent the foundation of batch effect removal when scRNA-seq data from different sequencing runs are combined; however, scRNA-seq poses additional challenges when combining disparate data. Unlike microarray or whole-tissue RNA-seq, scRNA-seq is especially prone to “drop out” events in which RNA is not amplified during library preparation [<xref ref-type="bibr" rid="CR17">17</xref>, <xref ref-type="bibr" rid="CR18">18</xref>]. Cell types and proportions may vary substantially across samples [<xref ref-type="bibr" rid="CR19">19</xref>, <xref ref-type="bibr" rid="CR20">20</xref>]. Both technical and biological variability contribute to strong batch effects (i.e., systematic variance) that must be overcome to meaningfully combine datasets as is fundamental in comparative and bioinformatic studies [<xref ref-type="bibr" rid="CR21">21</xref>, <xref ref-type="bibr" rid="CR22">22</xref>].</p>
    <p id="Par4"><italic>Seurat-CCA</italic> (<italic>Seurat v2</italic>) [<xref ref-type="bibr" rid="CR22">22</xref>] and <italic>mnnCorrect</italic> [<xref ref-type="bibr" rid="CR20">20</xref>] were the first methods proposed to combine scRNA-seq data from multiple batches. <italic>Seurat v2</italic> uses canonical correlation analysis (CCA) to project cells from different experiments to a common bias-reduced low-dimensional representation. However, this type of correction does not account for the variations in cellular heterogeneity among studies, e.g., cell types and proportions. Alternatively, <italic>mnnCorrect</italic> utilizes mutual nearest neighbors (MNN) to account for heterogeneity among batches, recognizing matching cell types via MNN pairs [<xref ref-type="bibr" rid="CR20">20</xref>]. By identifying the corresponding cells, a cell-specific correction can be learned for each MNN pair. As a consequence of local batch correction, <italic>mnnCorrect</italic> avoids the assumption of similar cell population compositions between batches assumed by previous methods. Following <italic>mnnCorrect</italic>, a series of new methods have been developed to integrate scRNA-seq data from different experiments [<xref ref-type="bibr" rid="CR23">23</xref>–<xref ref-type="bibr" rid="CR27">27</xref>]. For example, <italic>Seurat v3</italic> [<xref ref-type="bibr" rid="CR23">23</xref>] uses MNN pairs between the reference batch and query batches to detect “anchors” in the reference batch. “Anchors” represent cells in a shared biological state across batches and are further used to guide the batch correction process through CCA. <italic>BBKNN</italic> [<xref ref-type="bibr" rid="CR24">24</xref>] leverages neighborhood graphs to more efficiently cluster and visualize cell types. More recently, scRNA-seq batch correction is conducted by using deep learning approaches. For example, <italic>scVI</italic> [<xref ref-type="bibr" rid="CR28">28</xref>] utilizes deep generative models to approximate the underlying distributions of the observed expression profiles and can be used in multiple analysis tasks including batch correction. However, most existing batch correction methods for scRNA-seq data rely on similarities between individual cells, which do not fully utilize the clustering structures of different cell populations to identify the optimal batch-corrected subspace.</p>
    <p id="Par5">In this paper, by considering scRNA-seq data from different batches as different domains, we took advantage of the domain adaptation framework in deep transfer learning to properly remove batch effects by finding a low-dimensional representation of the data. The proposed method, <italic>BERMUDA</italic> (Batch Effect ReMoval Using Deep Autoencoders), utilizes the similarities between cell clusters to align corresponding cell populations among different batches. We demonstrate that <italic>BERMUDA</italic> outperforms existing methods at combining different batches and separating cell types in the joint dataset based on UMAP visualizations and proposed evaluation metrics. By optimizing the maximum mean discrepancy (MMD) [<xref ref-type="bibr" rid="CR29">29</xref>] between clusters across different batches, <italic>BERMUDA</italic> combines batches with <italic>vastly different cell population compositions</italic> as long as there is one common cell type shared between a pair of batches. Compared to existing methods, <italic>BERMUDA</italic> can also better preserve biological signals that exist in a subset of batches when removing batch effects. These improvements provide a novel deep learning solution to a persistent problem in scRNA-seq data analysis, while demonstrating state-of-the-art practice in batch effect correction.</p>
  </sec>
  <sec id="Sec2">
    <title>Results</title>
    <sec id="Sec3">
      <title>Framework of <italic>BERMUDA</italic></title>
      <p id="Par6">We propose <italic>BERMUDA</italic>, a novel unsupervised framework to remove batch effects across different batches by training an autoencoder (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a). After preprocessing the scRNA-seq data to select highly variable genes, we first used a graph-based clustering algorithm to detect cell clusters in each batch individually. Then, we applied a correlation-based approach to evaluate the similarity between cell clusters from different batches. Each pair of cell clusters was assigned a similarity score, which was later used as the coefficient in the transfer loss. Next, an autoencoder was trained using the standardized and scaled transcript-per-million (TPM) value of highly variable genes to learn a low-dimensional embedding of the gene expression profiles where the systematic biases across different batches were removed (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b). In order to successfully remove batch effects, we propose a novel approach by combining the reconstruction loss with the transfer loss when training the autoencoder. The reconstruction loss was calculated between the input and output of the autoencoder, which helped to learn a low-dimensional embedding that properly represented the original high-dimensional gene expression data. The transfer loss was calculated by estimating the difference of distributions between pairs of cell clusters using the low-dimensional representation, which helped to merge similar clusters from different batches. The <italic>mini-batch gradient descent</italic> algorithm in deep learning was used to train <italic>BERMUDA</italic> where reconstruction loss and transfer loss were calculated from a sampled “mini-batch” during each iteration of the training process. The total loss in each iteration was then calculated by adding reconstruction loss and transfer loss with a regularization parameter (Eq. <xref rid="Equ8" ref-type="">8</xref>), and the parameters in <italic>BERMUDA</italic> were then updated using gradient descent. Finally, the low-dimensional code learnt from the trained autoencoder was used for further downstream analysis.<fig id="Fig1"><label>Fig. 1</label><caption><p>Overview of <italic>BERMUDA</italic> for removing batch effects in scRNA-seq data. <bold>a</bold> The workflow of <italic>BERMUDA</italic>. Circles and triangles represent cells from <italic>Batch 1</italic> and <italic>Batch 2</italic>, respectively. Different colors represent different cell types. A graph-based clustering algorithm was first applied on each batch individually to detect cell clusters. Then, MetaNeighbor, a method based on Spearman correlation, was used to identify similar clusters between batches. An autoencoder was subsequently trained to perform batch correction on the code of the autoencoder. The code of the autoencoder is a low-dimensional representation of the original data without batch effects and can be used for further analysis. <bold>b</bold> Training an autoencoder to remove batch effects. The blue solid lines represent training with the cells in <italic>Batch 1</italic> and the blue dashed lines represent training with cells in <italic>Batch 2</italic>. The black dashed lines represent the calculation of losses. The loss function we optimized contains two components: the reconstruction loss between the input and the output of the autoencoder, and the MMD-based transfer loss between the codes of similar clusters</p></caption><graphic xlink:href="13059_2019_1764_Fig1_HTML" id="MO1"/></fig></p>
      <p id="Par7">The popularly used UMAP [<xref ref-type="bibr" rid="CR30">30</xref>] method was utilized to visualize the cell type clustering results. In addition, three evaluation metrics are proposed to evaluate the performance of BERMUDA: <italic>divergence_score</italic>, <italic>entropy_score</italic>, and <italic>silhouette_score</italic> (See the “Methods” section). <italic>Divergence</italic>_<italic>score</italic> is an average of divergence of shared cell populations between pairs of batches, which indicates whether shared cell populations among different batches are mixed properly. <italic>Entropy</italic>_<italic>score</italic> is an average of local entropy of distinct cell populations between pairs of batches, which can evaluate whether cell populations not shared by all the batches remain separate from other cells after batch correction. <italic>Silhouette</italic>_<italic>score</italic> is calculated using cell type labels as cluster labels, which measures the quality of cell type assignment in the aligned dataset.</p>
    </sec>
    <sec id="Sec4">
      <title>Comparison of the performance of <italic>BERMUDA</italic> versus existing methods under different cell population compositions</title>
      <p id="Par8">We compared the performance of <italic>BERMUDA</italic> versus several existing state-of-the-art batch correction methods for scRNA-seq data (<italic>mnnCorrect</italic> [<xref ref-type="bibr" rid="CR20">20</xref>], <italic>BBKNN</italic> [<xref ref-type="bibr" rid="CR24">24</xref>], <italic>Seurat v2</italic> (v2.3.4) [<xref ref-type="bibr" rid="CR22">22</xref>], <italic>Seurat v3</italic> (v3.0.0) [<xref ref-type="bibr" rid="CR23">23</xref>], and <italic>scVI</italic> [<xref ref-type="bibr" rid="CR28">28</xref>]) using four datasets (Table <xref rid="Tab1" ref-type="table">1</xref>). To evaluate the performance of each method under different cell population compositions, we performed multiple data analysis experiments on each dataset with cell type labels (Table <xref rid="Tab2" ref-type="table">2</xref>). For some experiments, we removed some cell types from specific batches to create different cell type distribution configurations. We performed three different experiments (“<italic>Experiment all</italic>”, “<italic>Experiment removal1</italic>”, and “<italic>Experiment removal2</italic>”) on each of the simulated datasets (2D Gaussian dataset and Splatter dataset). Specifically, for <italic>Experiment all</italic>, we applied each method to all the cells in the dataset. For <italic>Experiment removal1</italic>, we removed Type1 from <italic>Batch1</italic> and applied each method on this reduced dataset. For <italic>Experiment removal2</italic>, we removed Type1 from <italic>Batch1</italic> and Type4 from <italic>Batch2</italic> at the same time. We performed two different experiments (“<italic>Experiment all</italic>”, “<italic>Experiment removal”</italic>) on the human pancreas dataset. For <italic>Experiment all</italic>, we applied each method to all the cells in the entire dataset. For <italic>Experiment removal</italic>, we removed alpha and beta cells from <italic>Baron batch</italic> and alpha and beta cells from <italic>Segerstolpe batch</italic> (if applicable) and evaluated each method using this reduced dataset. We also applied <italic>BERMUDA</italic> to two batches of peripheral blood mononuclear cells (PBMCs).<table-wrap id="Tab1"><label>Table 1</label><caption><p>Datasets used for evaluation of <italic>BERMUDA</italic></p></caption><table frame="hsides" rules="groups"><thead><tr><th>Dataset</th><th>Batch</th><th>Protocol</th><th>Number of cells</th><th>Cell types (number of cells)</th></tr></thead><tbody><tr><td rowspan="2">2D Gaussian</td><td>Batch1</td><td>Simulation</td><td>2000</td><td>Type1 (855), Type2 (237), Type3 (373), Type4 (535)</td></tr><tr><td>Batch2</td><td>Simulation</td><td>2000</td><td>Type1 (379), Type2 (656), Type3 (102), Type4 (863)</td></tr><tr><td rowspan="2">Splatter</td><td>Batch1</td><td>Splatter</td><td>2000</td><td>Type1 (810), Type2 (616), Type3 (388), Type4 (186)</td></tr><tr><td>Batch2</td><td>Splatter</td><td>1000</td><td>Type1 (439), Type2 (262), Type3 (201), Type4 (98)</td></tr><tr><td rowspan="3">Pancreas</td><td>Muraro</td><td>CEL-Seq2</td><td>2042</td><td>alpha (812), beta (448), gamma (101), delta (193), epsilon (3), acinar (219), ductal (245), endothelial﻿ (21)</td></tr><tr><td>Baron</td><td>inDrop</td><td>8012</td><td>alpha (2326), beta (2525), gamma (255), delta (601), epsilon (18), acinar (958), ductal (1077), endothelial﻿ (252)</td></tr><tr><td>Segerstolpe</td><td>SMART-seq2</td><td>2061</td><td>alpha (886), beta (270), gamma (197), delta (114), epsilon (7), acinar (185), ductal (386), endothelial﻿ (16)</td></tr><tr><td rowspan="2">PBMC</td><td>PBMC</td><td>10x Chromium</td><td>8381</td><td/></tr><tr><td>Pan T cell</td><td>10x Chromium</td><td>3555</td><td/></tr></tbody></table><table-wrap-foot><p>For the consistency in the paper, we refer to each pancreas and PBMC dataset, e.g., the Muraro dataset, as a batch, and refer to multiple batches investigating similar biological systems, e.g., pancreas, as a dataset. Type1 to Type4 in the 2D Gaussian dataset and the Splatter dataset refer to the virtual cell types that were generated using simulation techniques</p></table-wrap-foot></table-wrap><table-wrap id="Tab2"><label>Table 2</label><caption><p>Experiments performed for comparing <italic>BERMUDA</italic> with existing methods</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Dataset</th><th>Batch</th><th>Experiment name</th><th>Cell type removed</th></tr></thead><tbody><tr><td rowspan="3">2D Gaussian</td><td rowspan="3"><italic>Batch1, Batch2</italic></td><td><italic>Experiment all</italic></td><td>NA</td></tr><tr><td><italic>Experiment removal1</italic></td><td>Type1 from <italic>Batch1</italic></td></tr><tr><td><italic>Experiment removal2</italic></td><td><p>Type1 from <italic>Batch1</italic>,</p><p>Type4 from <italic>Batch2</italic></p></td></tr><tr><td rowspan="3">Splatter</td><td rowspan="3"><italic>Batch1, Batch2</italic></td><td><italic>Experiment all</italic></td><td>NA</td></tr><tr><td><italic>Experiment removal1</italic></td><td>Type1 from <italic>Batch1</italic></td></tr><tr><td><italic>Experiment removal2</italic></td><td><p>Type1 from <italic>Batch1</italic>,</p><p>Type4 from <italic>Batch2</italic></p></td></tr><tr><td rowspan="4">Pancreas</td><td rowspan="2"><italic>Muraro batch, Baron batch</italic></td><td><italic>Experiment all</italic></td><td>NA</td></tr><tr><td><italic>Experiment removal</italic></td><td>alpha and beta from <italic>Baron batch</italic></td></tr><tr><td rowspan="2"><p><italic>Muraro batch,</italic></p><p><italic>Baron batch,</italic></p><p><italic>Segerstolpe batch</italic></p></td><td><italic>Experiment all</italic></td><td>NA</td></tr><tr><td><italic>Experiment removal</italic></td><td><p>alpha and beta from <italic>Baron batch</italic>,</p><p>alpha and beta from <italic>Segerstolpe batch</italic></p></td></tr><tr><td>PBMC</td><td><p><italic>PBMC batch</italic>,</p><p><italic>pan T cell batch</italic></p></td><td>NA</td><td>NA</td></tr></tbody></table></table-wrap></p>
    </sec>
    <sec id="Sec5">
      <title><italic>BERMUDA</italic> outperformed existing methods in removing batch effects on simulated data</title>
      <p id="Par9">To assess the performance of <italic>BERMUDA</italic> for batch effect removal, we first applied it to a simulated dataset (referred to as “2D Gaussian dataset”) with four shared virtual cell types, where the expression profiles were generated from a two-dimensional biological subspace following the method in [<xref ref-type="bibr" rid="CR20">20</xref>] (See the “Methods” section). In order to recover and better visualize the underlying biological subspace, we set the number of neurons in the bottleneck layer of the autoencoder to two. We compared the performance of <italic>BERMUDA</italic> to other existing methods in three different scenarios:<list list-type="bullet"><list-item><p id="Par10">All the cells from the two batches (referred to as “<italic>Experiment all</italic>”);</p></list-item><list-item><p id="Par11">Removing Type1 in <italic>Batch1</italic> (referred to as “<italic>Experiment removal1</italic>”);</p></list-item><list-item><p id="Par12">Removing Type1 in <italic>Batch1</italic> and Type4 in <italic>Batch2</italic> at the same time (referred to as “<italic>Experiment removal2</italic>”).</p></list-item></list></p>
      <p id="Par13"><italic>Experiment removal2</italic> represented the most difficult case in these three scenarios because only two cell types were shared by both batches. We evaluated the results by inspecting the two-dimensional visualizations (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S1). Ideally, the visualizations generated after proper batch correction should contain four separate cell clusters (each representing a cell type), and the clusters for shared cell types should contain a homogenous mixture of cells from both batches. In <italic>Experiment removal2</italic>, <italic>BERMUDA</italic> properly removed batch effects (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a1, a2) while both <italic>mnnCorrect</italic> and <italic>BBKNN</italic> generated false similarities between cell types that did not exist in the original data (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a4, a5). Specifically, in <italic>Experiment removal2</italic>, clusters corresponding to Type1 and Type4 were closely connected in the <italic>mnnCorrect</italic> results (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a4), and clusters corresponding to Type1, Type3, and Type4 were not as well separated in the <italic>BBKNN</italic> results (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a5). Moreover, only <italic>BERMUDA</italic> produced proper batch correction consistently across three different experiments (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S1). For example, <italic>BBKNN</italic> incorrectly separated Type1 from the same batch into two distinct clusters in <italic>Experiment removal1</italic> (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S1b5). This suggests that although <italic>mnnCorrect</italic> and <italic>BBKNN</italic> can handle differences in cell population composition among different batches, their performance was less optimal compared with <italic>BERMUDA</italic> when such differences were large.<fig id="Fig2"><label>Fig. 2</label><caption><p>Removing batch effects in simulated scRNA-seq data. <bold>a</bold> UMAP visualizations of results for <italic>Experiment removal2</italic> on 2D Gaussian dataset, where Type1 from <italic>Batch1</italic> and Type4 from <italic>Batch2</italic> were removed. BERMUDA_0.85 and BERMUDA_0.90 represent results of <italic>BERMUDA</italic> with <italic>S</italic><sub><italic>thr</italic></sub> = 0.85 and 0.90, respectively. <bold>b</bold> UMAP visualizations of results for <italic>Experiment removal2</italic> on Splatter dataset, where Type1 from <italic>Batch1</italic> and Type 4 from <italic>Batch2</italic> were removed</p></caption><graphic xlink:href="13059_2019_1764_Fig2_HTML" id="MO2"/></fig></p>
      <p id="Par14">In order to compare <italic>BERMUDA</italic> with the popularly used scRNA-seq data analysis tool <italic>Seurat v2</italic> [<xref ref-type="bibr" rid="CR22">22</xref>] and the recently proposed <italic>Seurat v3</italic> [<xref ref-type="bibr" rid="CR23">23</xref>] and <italic>scVI</italic> [<xref ref-type="bibr" rid="CR28">28</xref>] (where the workflows were designed for scRNA-seq count data), we evaluated <italic>BERMUDA</italic> using two batches of simulated single-cell RNA sequence counts generated by Splatter [<xref ref-type="bibr" rid="CR31">31</xref>] (referred to as “Splatter dataset”). We conducted multiple batch correction experiments using different cell populations:<list list-type="bullet"><list-item><p id="Par15">All the cells from two batches (referred to as “<italic>Experiment all</italic>”);</p></list-item><list-item><p id="Par16">Removing Type1 in <italic>Batch1</italic> (referred to as “<italic>Experiment removal1</italic>”);</p></list-item><list-item><p id="Par17">Removing Type1 in <italic>Batch1</italic> and Type4 in <italic>Batch2</italic> (referred to as “<italic>Experiment removal2</italic>”).</p></list-item></list></p>
      <p id="Par18">Again, <italic>Experiment removal2</italic> was the most difficult scenario. When only two cell types were shared between two batches in <italic>Experiment removal2</italic>, only <italic>BERMUDA</italic> properly removed batch effects (Fig. <xref rid="Fig2" ref-type="fig">2</xref>b1, b2). Although <italic>scVI</italic> could align corresponding cell types (Fig. <xref rid="Fig2" ref-type="fig">2</xref>b8), it could not remove batch effects at a more granular level to properly merge cells from different batches within each cell type (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S2c8). The other methods improperly merged Type1 with Type4 in the UMAP visualizations (Fig. <xref rid="Fig2" ref-type="fig">2</xref>b4–b7). Moreover, <italic>BERMUDA</italic> was the only method that could consistently remove batch effects in all three cases. When all four cell types were shared in both batches, we observed that all the methods properly merged cells of the same type (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S2a). However, <italic>BBKNN</italic> and <italic>Seurat v2</italic> produced much lower <italic>silhouette</italic>_<italic>score</italic> values due to the inflated variance within cell clusters compared to the original data (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S2d1). Also, when the difference in cell type distributions was introduced in <italic>Experiment removal1</italic>, we observed that <italic>BBKNN</italic> and <italic>Seurat v2</italic> could no longer mix the same cell type from different batches properly (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S2b5, b6). The results of <italic>Seurat v2</italic> were anticipated since it was designed to align different batches globally without considering the population differences among batches. The inconsistent results of <italic>BBKNN</italic> under different cell type distributions indicated that the neighborhood graphs generated by <italic>BBKNN</italic> may not always be reliable due to the fact that the method mainly focused on computational efficiency.</p>
      <p id="Par19">The observations through UMAP visualizations were further confirmed by evaluating the results through the proposed <italic>divergence</italic>_<italic>score</italic>, <italic>entropy</italic>_<italic>score</italic>, and <italic>silhouette</italic>_<italic>score</italic> (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S2d). In <italic>Experiment removal2</italic>, <italic>scVI</italic> could not properly align cells from different batches within each cell type, resulting in a high <italic>divergence</italic>_<italic>score</italic> (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S2d5, d6). Other existing methods produced low <italic>silhouette</italic>_<italic>score</italic> values (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S2d6, d7) since they were not able to separate different cell types correctly. We observed that <italic>BERMUDA</italic> consistently yielded the best performance in all three cases when evaluated using the proposed metrics (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S2d).</p>
      <p id="Par20">By evaluating <italic>BERMUDA</italic> on two different simulated datasets, we demonstrate that it achieves better performance than existing methods in removing batch effects, especially when the difference of cell population compositions among batches is large.</p>
    </sec>
    <sec id="Sec6">
      <title><italic>BERMUDA</italic> outperformed existing methods in removing batch effects on human pancreas data</title>
      <p id="Par21">To further evaluate <italic>BERMUDA</italic> using biological data, we applied it to publicly available human pancreas datasets that were generated utilizing different scRNA-seq protocols. Muraro et al. [<xref ref-type="bibr" rid="CR32">32</xref>] used CEL-Seq2, a multiplexed linear amplification RNA sequencing technique. This dataset will be referred to as “<italic>Muraro batch</italic>.” Baron et al. [<xref ref-type="bibr" rid="CR33">33</xref>] used a droplet RNA-seq technology. We refer to this dataset as “<italic>Baron batch</italic>.” In addition to evaluating our method using all the cells in both batches (referred to as “<italic>Experiment all</italic>,” Fig. <xref rid="Fig3" ref-type="fig">3</xref>a, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4a), we also removed alpha and beta cells from <italic>Baron batch</italic> (referred to as “<italic>Experiment removal</italic>”, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4b, c) to simulate vast differences in cell type distributions found in real scRNA-seq data.<fig id="Fig3"><label>Fig. 3</label><caption><p>Removing batch effects in scRNA-seq data of pancreas cells. <bold>a</bold> UMAP visualizations of batch effect removal results for <italic>Experiment all</italic> on pancreas dataset. Identified alpha and beta cell subpopulations in the <italic>Baron batch</italic> are highlighted with dashed circles. <bold>b</bold> Expression patterns of differently expressed genes within alpha and beta cells colored by log-transformed TPM values. Statistical significance of differential expression analysis is listed in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S1-S2</p></caption><graphic xlink:href="13059_2019_1764_Fig3_HTML" id="MO3"/></fig></p>
      <p id="Par22"><italic>BERMUDA</italic> achieved competitive results in both cases compared to <italic>mnnCorrect</italic>, <italic>BBKNN</italic>, <italic>Seurat v2</italic>, <italic>Seurat v3</italic>, and <italic>scVI</italic>. Specifically, in <italic>Experiment removal</italic>, the performance of <italic>Seurat v2</italic> deteriorated when alpha and beta cells were removed from the <italic>Baron batch</italic> (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4d) because only utilizing CCA was not capable of addressing the case where only a subset of cell types was shared among batches. <italic>BBKNN</italic> and <italic>scVI</italic> separated different cell types into different clusters, but could not mix cells from different batches within clusters properly (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a5, a8, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4a5, a8), producing high <italic>divergence</italic>_<italic>score</italic> values (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4d1). <italic>Seurat v3</italic> and <italic>mnnCorrect</italic> were designed to cope with cell type distributions across datasets being different. However, <italic>Seurat v3</italic> could not produce consistent results with clear separation between cell types when the cell population composition varied within the same set of data. For example, <italic>Seurat v3</italic> produced a UMAP visualization that represented alpha, beta, gamma, and delta cells as tightly connected clusters when alpha and beta cells from the <italic>Baron batch</italic> were removed. This differed from both the original data and the <italic>Seurat v3</italic> result in <italic>Experiment all</italic> (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a7, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4b7). The <italic>mnnCorrect</italic> method produced relatively good results across both cases (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a4, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4b4). However, <italic>BERMUDA</italic> still outperformed all of these existing methods when evaluated using the three proposed metrics simultaneously (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4d).</p>
    </sec>
    <sec id="Sec7">
      <title><italic>BERMUDA</italic> preserved batch-specific biological signals in human pancreas data</title>
      <p id="Par23">In this paper, we use “batch-specific” biological signals to refer to bona fide biological signals that are not shared among all the batches. A homogeneous mixture of the same cell type among different batches is an important indicator of proper batch corrections. However, an overly batch-corrected homogeneous mixture could lead to loss of the subtle batch-specific biological signals that may contain information about potential biomarkers of batch-specific cell subtypes, which could defeat the purpose of carrying out scRNA-seq experiments. One advantage of <italic>BERMUDA</italic> is the ability to balance between maintaining a more homogeneous mixture of cell types and retaining the subtle structures within cell types, which is accomplished by adjusting the value of <italic>S</italic><sub><italic>thr</italic></sub>. A lower <italic>S</italic><sub><italic>thr</italic></sub> value can merge the same cell type from different batches more homogeneously. However, increasing the value of <italic>S</italic><sub><italic>thr</italic></sub> can also be helpful, as it allows subtle batch-specific biological signals to be preserved. We demonstrate that <italic>S</italic><sub><italic>thr</italic></sub> values between 0.85 and 0.90 can produce proper batch correction in different datasets consistently (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S8, S9). For example, in <italic>Experiment all</italic> on the pancreas dataset, <italic>BERMUDA</italic> produced competitive results for both <italic>S</italic><sub><italic>thr</italic></sub> values (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4d1). Each cell type was separated as a single cluster with a homogenous mixture of cells from both batches when <italic>S</italic><sub><italic>thr</italic></sub> = 0.85 (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a1). In addition, we observed two closely connected cell clusters of alpha and beta cells from the <italic>Baron batch</italic> when <italic>S</italic><sub><italic>thr</italic></sub> = 0.90 (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a2), which was consistent with the original, uncorrected data (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a3). When <italic>S</italic><sub><italic>thr</italic></sub> = 0.90, only one of two connected clusters in alpha or beta cells in <italic>Baron batch</italic> merged with the corresponding cells in the <italic>Muraro batch</italic>, whereas the other remained unmixed (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a2, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4a2). This observation was confirmed by the <italic>mnnCorrect</italic> and <italic>Seurat v3</italic> results, although both with a subtler distinction of clusters (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a4, a7). The consistent observation indicated that observed cell clusters inferred alpha or beta cell subtypes that only appeared in the <italic>Baron batch</italic>, which could be detected when <italic>S</italic><sub><italic>thr</italic></sub> = 0.90.</p>
      <p id="Par24">To further investigate the potential cell subtypes, we performed differential gene expression analysis within alpha cells and beta cells on two pairs of cell populations. For alpha cells, we examined differential gene expression between the mixed cluster from <italic>Muraro batch</italic> versus the unmixed cluster from <italic>Baron batch</italic>. We also separately examined differential gene expression between the mixed and unmixed cluster from <italic>Baron batch</italic>. For beta cells, we performed the same two sets of differential gene expression analysis between the respective mixed cluster and the unmixed cluster. We used the “FindMarkers” function in <italic>Seurat v2</italic> [<xref ref-type="bibr" rid="CR22">22</xref>] to identify genes that have significantly different expression patterns in both pairs of cell populations (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S1-S2), which resulted in genes related to important pancreatic functions. For example, <italic>ARX</italic> and <italic>MAFB</italic> (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S1, Fig. <xref rid="Fig3" ref-type="fig">3</xref>b1, b4) were significantly under-expressed in the unmixed alpha cells compared with the mixed alpha cells. <italic>PDX1</italic>, <italic>MAFA</italic>, and <italic>MAFB</italic> were significantly under-expressed in the unmixed beta cells compared with the mixed beta cells (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S2, Fig. <xref rid="Fig3" ref-type="fig">3</xref>b2–b4). Previous studies [<xref ref-type="bibr" rid="CR34">34</xref>, <xref ref-type="bibr" rid="CR35">35</xref>] have shown that <italic>ARX</italic> plays a key role in the differentiation of pancreatic islet cells. Moreover, the decrease of <italic>MAFA</italic>, <italic>MAFB</italic>, and <italic>PDX1</italic> expression levels have been found in human type 2 diabetes islet alpha and beta cells, which can be associated to islet cell dysfunction [<xref ref-type="bibr" rid="CR36">36</xref>]. Identification of the aforementioned transcriptomic signatures suggested that the refined cell clusters that only exist in <italic>Baron batch</italic> may contain cell subpopulations with altered pancreatic functions, which may warrant further biological investigation. As mentioned above, such cell subpopulations were also identified in <italic>Seurat v3</italic> and <italic>mnnCorrect</italic>.</p>
      <p id="Par25">By applying our method to human pancreas datasets, we demonstrate that <italic>BERMUDA</italic> effectively removes batch effects under different cell population compositions across batches. <italic>BERMUDA</italic> outperforms existing methods in combining corresponding cell types, preserving subtle cell clusters that are not shared by all the batches, and properly separating different cell types. We also show that <italic>BERMUDA</italic> can preserve and even amplify biologically meaningful structures within cell types when integrating different batches.</p>
    </sec>
    <sec id="Sec8">
      <title><italic>BERMUDA</italic> properly mapped human pan T cells to PBMCs</title>
      <p id="Par26">In order to show that <italic>BERMUDA</italic> can transfer information between batches with more complicated cell populations and reveal biological signals that might remain hidden when analyzing each batch individually, we also applied <italic>BERMUDA</italic> to two large scRNA-seq datasets of peripheral blood mononuclear cells (PBMCs) generated from the 10x Genomics Chromium platform (i.e., “<italic>PBMC batch</italic>” and “<italic>pan T cell batch</italic>”). <italic>PBMC batch</italic> and <italic>pan T cell batch</italic> were acquired from different healthy donors. We expected that cell types in the <italic>pan T cell batch</italic> should be a subset of those in the <italic>PBMC batch</italic>, while the <italic>PBMC batch</italic> could contain other cell types such as B cells and monocytes. From the UMAP visualization of the uncorrected data (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S5c), we speculated that the <italic>pan T cell batch</italic> should roughly correspond to the largest cell cluster in the <italic>PBMC batch</italic>, while the other two smaller clusters should represent non-T cells in the <italic>PBMC batch</italic>. As shown in Fig. <xref rid="Fig4" ref-type="fig">4</xref>b, <italic>BERMUDA</italic> successfully retained the two PBMC-specific clusters, while mapping the T cell population properly.<fig id="Fig4"><label>Fig. 4</label><caption><p>Removing batch effects in scRNA-seq data of PBMCs. <bold>a</bold> Expression patterns of marker genes of immune cells colored by log-transformed TPM values. <bold>b</bold> The UMAP visualization of results produced by <italic>BERMUDA</italic> colored by batches. Different cell types were identified by analyzing expression patterns of maker genes and are highlighted by dashed circles. <italic>BERMUDA</italic> correctly combined the corresponding cell types between different batches while preserved cell types not shared by both batches as separate clusters. <bold>c</bold> The UMAP visualization of <italic>pan T cell batch</italic>. No obvious clustering structure was observed when visualizing <italic>pan T cell batch</italic> individually</p></caption><graphic xlink:href="13059_2019_1764_Fig4_HTML" id="MO4"/></fig></p>
      <p id="Par27">Since the obtained data did not include pre-defined cell type labels, we evaluated the results by inspecting the expression patterns of marker genes using the UMAP visualizations. We identified seven major cell types in our results through corresponding marker genes: CD4 T cells (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a1, a3), CD8 T cells (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a3), B cells (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a2), CD1c+ dendritic cells (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a6), CD14+ monocytes (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a4), CD16+ monocytes (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a5), and NK/NKT cells (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a7–a8). Cell types that only existed in the <italic>PBMC batch</italic> (B cells, CD14+ monocytes, CD16+ monocytes, CD1c+ dendritic cells) retained a similar structure with the uncorrected original data (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S5a-c), which further demonstrated that our method can combine batches while preserving biological information that only existed in a subset of batches. Interestingly, the UMAP visualization of <italic>pan T cell batch</italic> alone did not show any clear clustering structures. However, different cell types within <italic>pan T cell batch</italic> were further distinguished as different clusters by combining with PBMC cells. This indicates that <italic>BERMUDA</italic> is capable of effectively transferring the biological information from one batch to another and extracting biological insights from batches that might not be evident by studying each batch individually.</p>
      <p id="Par28">Conversely, <italic>Seurat v2</italic> and <italic>Seurat v3</italic> could not align the overlapping cell types from two batches properly (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S5f, g). <italic>BBKNN</italic> overly corrected batch effects and lost the structure within the T cell cluster and the monocyte cluster observed in the original uncorrected data (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S5e). <italic>mnnCorrect</italic> and <italic>scVI</italic> were able to align the shared cell types between two batches. However, <italic>scVI</italic> did not produce a homogeneous mixture of both batches within pan T cells, while <italic>mnnCorrect</italic> produced a more heterogeneous structure within the T cell cluster when comparing to the uncorrected data visually (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S5d, h).</p>
    </sec>
    <sec id="Sec9">
      <title><italic>BERMUDA</italic> can be generalized to combine multiple batches</title>
      <p id="Par29">Since <italic>BERMUDA</italic> is based on applying MMD loss to similar clusters from different batches for batch effect removal, it can be easily generalized to deal with multiple batches simultaneously. Here, we demonstrate such capability by including another human pancreas dataset generated by Segerstolpe et al. [<xref ref-type="bibr" rid="CR37">37</xref>] (referred to as “<italic>Segerstolpe batch</italic>”). The <italic>Segerstolpe batch</italic> was generated using the sequencing platform SMART-seq2 technology and contained 2061 cells of interest.</p>
      <p id="Par30">Similar to the previous scenarios, two experiments were performed on the human pancreas dataset: one with all the cells in the dataset (referred to as “<italic>Experiment all</italic>”, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S6) and one with alpha and beta cells removed from both the <italic>Baron batch</italic> and the <italic>Segerstolpe batch</italic> (referred to as “<italic>Experiment removal</italic>,” Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S7). <italic>BERMUDA</italic> consistently produced competitive results in both experiments (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S6c, S7c). Moreover, the aforementioned potential alpha and beta cell subpopulations in the <italic>Baron batch</italic> were also consistently observed when setting <italic>S</italic><sub><italic>thr</italic></sub> = 0.90. This demonstrates that our method can naturally handle multiple batches simultaneously and generate consistent and robust results when number of batches increases.</p>
    </sec>
  </sec>
  <sec id="Sec10">
    <title>Discussion</title>
    <p id="Par31">With the rapid advances of single-cell sequencing technologies and the accumulation of large scRNA-seq data, it is important to combine data from different samples or studies to fully harness the power of scRNA-seq techniques, infer cell lineages, and identify bona fide transcriptional signals. Proper removal of batch effects between scRNA-seq experiments has become an urgent issue. Batch effects arise from many potential sources, such as different protocol-, platform-, or lab-specific artifacts. In addition, cell type compositions differ among scRNA-seq experiments because of underlying biological variation. This increases the difficulty of distinguishing bona fide biological signals from systematic biases and accurately representing combined data from multiple sources.</p>
    <p id="Par32">In this study, we propose <italic>BERMUDA</italic>, a novel batch correction method based on the deep transfer learning framework. We considered scRNA-seq data from different batches as different domains and utilized domain adaptation approaches to project the original data to a lower-dimensional space without batch effects. We demonstrated that <italic>BERMUDA</italic> can properly combine data from different batches in both simulated data and real datasets as long as there is one common cell type shared by a pair of batches. We observed that <italic>BERMUDA</italic> outperformed existing methods (<italic>mnnCorrect</italic>, <italic>BBKNN</italic>, <italic>Seurat v2</italic>, <italic>Seurat v3</italic>, and <italic>scVI</italic>) in three aspects: homogeneously mixing the same cell type from different batches, maintaining the purity of batch-specific cell clusters, and separating different cell types in the combined dataset. By training an autoencoder with MMD loss on pairs of similar clusters, <italic>BERMUDA</italic> can effectively perform batch correction without considering the specific sources of batch effects. Because of this, <italic>BERMUDA</italic> is capable of removing batch effects resulting from various sources, such as simulated batch effects, batch effects from the same platform in the PMBC dataset, and batch effects generated by different platforms in the human pancreas dataset. Moreover, by using a deep neural network framework and training through the mini-batch gradient descent algorithm, <italic>BERMUDA</italic> is scalable to large numbers of cells, which is beneficial for the rapid adoption of scRNA-seq experiments.</p>
    <p id="Par33"><italic>BERMUDA</italic> only requires batches to share at least one common cell type with another batch, which is distinct from existing methods that do not account for cell type distributions across batches. Because <italic>BERMUDA</italic> performs batch correction based on similarity among cell clusters, it accommodates variation in both cell composition across batches and also different cell populations. Rather than considering a global batch effect, <italic>BERMUDA</italic> removes batch effects locally by combining similar clusters while maintaining the global structure of the data. By applying this approach, knowledge from one batch can be transferred to another, which augments biological insights that cannot be observed when examining each batch individually. For example, when directly visualizing the <italic>pan T cell batch</italic>, it did not show obvious clustering structures (Fig. <xref rid="Fig4" ref-type="fig">4</xref>c). However, by combining it with PBMCs, pan T cells were properly mapped to the corresponding cell clusters in the <italic>PBMC batch</italic>, providing a higher resolution of cell subtypes within the <italic>pan T cell batch</italic> (Fig. <xref rid="Fig4" ref-type="fig">4</xref>b).</p>
    <p id="Par34">Typically, there is a trade-off between removing batch effects and retaining experimental specific biological signals, causing some existing methods (such as <italic>BBKNN</italic> and <italic>Seurat v2</italic>) to lose subtle biological signals while merging multiple batches for a more homogenous mixture of cells [<xref ref-type="bibr" rid="CR38">38</xref>, <xref ref-type="bibr" rid="CR39">39</xref>]. <italic>BERMUDA</italic> can preserve and amplify the sensitivity to biological differences in the original data while properly removing batch effects. Specifically, the trade-off between a more homogeneous mixture within cell types and preserving more batch-specific biological signals could be adjusted by changing the <italic>S</italic><sub><italic>thr</italic></sub> value, where a higher <italic>S</italic><sub><italic>thr</italic></sub> value can help to retain more biological signals that only exist in a subset of batches. We demonstrate experimentally that <italic>BERMUDA</italic> is robust and can outperform existing methods in a wide range of <italic>S</italic><sub><italic>thr</italic></sub> values, and choosing <italic>S</italic><sub><italic>thr</italic></sub> between 0.85 and 0.90 can consistently yield a good balance between proper batch correction and preserving batch-specific biological signals (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S8, S9).</p>
    <p id="Par35"><italic>BERMUDA</italic> also has limitations. Since the design of <italic>BERMUDA</italic> is based on similarity between cell clusters, it can remove batch effects from scRNA-seq data with distinct cell populations effectively. However, clusters may not always be well separated due to technical or biological noise. Moreover, scRNA-seq data can also be continuously variable—such as data generated for cell differentiation. While <italic>BERMUDA</italic> was originally designed with a focus on scRNA-seq data with distinct cell populations, it can also accommodate such data by adjusting the resolution in the graph-based clustering algorithm and the trade-off between reconstruction loss and transfer loss to align clusters at a more granular level. It is also the focus of our future work to improve <italic>BERMUDA</italic> to accommodate these data even more effectively. Another limitation is that the use of k-nearest neighbor in the clustering algorithm (integrated in <italic>Seurat v2</italic>) may not scale well to extremely large datasets [<xref ref-type="bibr" rid="CR24">24</xref>]; though, a neural-network-based framework for batch correction is capable of accommodating large datasets. However, novel clustering algorithms could be applied in the future to speed up the clustering process. For example, Ren et al. [<xref ref-type="bibr" rid="CR40">40</xref>] proposed a novel framework for clustering large scRNA-seq data, which reduced the computational complexity to O(n) while maintaining a high clustering accuracy.</p>
  </sec>
  <sec id="Sec11">
    <title>Conclusions</title>
    <p id="Par36">Removing batch effects is essential for the analysis of data from multiple scRNA-seq experiments and multiple technical platforms. Here we introduce <italic>BERMUDA</italic>, a novel batch correction method for scRNA-seq data based on deep transfer learning. We use an autoencoder to learn a low-dimensional representation of the original gene expression profiles while removing the batch effects locally by incorporating MMD loss on similar cell clusters. <italic>BERMUDA</italic> provides several improvements compared to existing methods. Firstly, by introducing three different metrics to evaluate the batch correction performance we demonstrate that <italic>BERMUDA</italic> outperforms existing methods in merging the same cell types, preserving cell types not shared by all the batches, and separating different cell types. Secondly, <italic>BERMUDA</italic> can properly remove batch effects even when the cell population compositions across different batches are vastly different. Thirdly, <italic>BERMUDA</italic> can preserve batch-specific biological signals and discover new information that might be hard to extract by analyzing each batch individually. Finally, <italic>BERMUDA</italic> can be easily generalized to handle multiple batches and can scale to large datasets.</p>
  </sec>
  <sec id="Sec12">
    <title>Methods</title>
    <sec id="Sec13">
      <title>Datasets used for performance evaluation</title>
      <p id="Par37">For consistency, in this paper, an individual dataset will be referred to as a “batch.” Multiple batches investigating similar biological problems will be referred to as a “dataset.” We applied <italic>BERMUDA</italic> on simulated datasets, human pancreas cell datasets, and PBMC datasets to assess its performance (Table <xref rid="Tab1" ref-type="table">1</xref>). We used two methods to generate simulated datasets for evaluating the performance of <italic>BERMUDA</italic>. For the 2D Gaussian dataset, we followed [<xref ref-type="bibr" rid="CR20">20</xref>] to generate highly synthetic data with batch effects. We simulated two batches of four different cell types according to different bivariate normal distributions in a two-dimensional biological subspace. The cell population composition of each batch was generated randomly. Then we randomly projected the data to a 100-dimensional space to simulate the high-dimensional gene expression data. Gene-specific batch effects were generated by adding Gaussian noise to the high-dimensional data. For the Splatter dataset, we used the Splatter [<xref ref-type="bibr" rid="CR31">31</xref>] package to simulate RNA sequence counts of two batches with four different cell populations. Splatter can directly simulate multiple batches following similar cell type compositions at the same time. We set the cell population composition to be 0.4, 0.3, 0.2, and 0.1 among the four simulated cell types.</p>
      <p id="Par38">To evaluate whether <italic>BERMUDA</italic> can remove batch effects in real scRNA-seq data and extract meaningful biological insights, we also applied it to datasets of human pancreas cells and PBMCs. The pancreas dataset was obtained from Gene Expression Omnibus (GSE85241 for <italic>Muraro batch</italic> [<xref ref-type="bibr" rid="CR32">32</xref>], GSE84133 for <italic>Baron batch</italic> [<xref ref-type="bibr" rid="CR33">33</xref>]) and The European Bioinformatics Institute (E-MTAB-5061 for <italic>Segerstolpe batch</italic> [<xref ref-type="bibr" rid="CR37">37</xref>]). The PBMC dataset was obtained from 10x Genomics support datasets. To effectively compare the difference between the cases where all the cell types or only a subset of those were shared among batches, we only retained the shared cell types in the pancreas dataset. The details of the datasets are shown in Table <xref rid="Tab1" ref-type="table">1</xref>.</p>
    </sec>
    <sec id="Sec14">
      <title>Framework of <italic>BERMUDA</italic></title>
      <p id="Par39"><italic>BERMUDA</italic> is a novel unsupervised framework for batch correction across different batches (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a). The workflow of <italic>BERMUDA</italic> includes the following five steps: (1) preprocessing of scRNA-seq data, (2) clustering of cells in each batch individually, (3) identifying similar cell clusters across different batches, (4) removing batch effects by training an autoencoder (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b), and (5) utilizing the batch-corrected codes for further downstream analysis. We introduce each step in detail in the following sections.</p>
    </sec>
    <sec id="Sec15">
      <title>Preprocessing</title>
      <p id="Par40">Gene expression levels from each cell were first quantified using transcript-per-million values (TPM). First, we restricted the analysis to genes that were highly variable based on <italic>Seurat v2</italic> [<xref ref-type="bibr" rid="CR22">22</xref>]. Gene expression values were normalized as<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {G}_{ij}={\log}_2\left({\mathrm{TPM}}_{ij}+1\right), $$\end{document}</tex-math><mml:math id="M2" display="block"><mml:maligngroup/><mml:msub><mml:mi>G</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mo>log</mml:mo><mml:mn>2</mml:mn></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>TPM</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par41">where TPM<sub><italic>ij</italic></sub> is the TPM of gene <italic>i</italic> in cell <italic>j</italic>. We subsequently standardized expression per batch as<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {G}_{ij}^{\prime }=\frac{G_{ij}-{\overline{G}}_i}{\sigma_i}, $$\end{document}</tex-math><mml:math id="M4" display="block"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:maligngroup/><mml:msubsup><mml:mi>G</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>G</mml:mi><mml:mo stretchy="true">¯</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfrac><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par42">where <italic>G</italic>′<sub><italic>ij</italic></sub> is the standardized expression level of gene <italic>i</italic> in cell <italic>j</italic>. <inline-formula id="IEq1"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\overline{G}}_i $$\end{document}</tex-math><mml:math id="M6" display="inline"><mml:msub><mml:mover accent="true"><mml:mi>G</mml:mi><mml:mo stretchy="true">¯</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq1.gif"/></alternatives></inline-formula> is the mean expression level for gene <italic>i</italic> and <italic>σ</italic><sub><italic>i</italic></sub> is the standard deviation of expression level for gene <italic>i</italic>. Then, we linearly scaled the expression level of each gene to [0, 1].</p>
    </sec>
    <sec id="Sec16">
      <title>Clustering of cells and identifying similar cell clusters</title>
      <p id="Par43">Cell clusters were identified from each batch individually following the pipeline in <italic>Seurat v2</italic> [<xref ref-type="bibr" rid="CR22">22</xref>]. <italic>Seurat v2</italic> implemented a clustering algorithm based on optimizing the modularity function on a k-nearest neighbor graph. We then used MetaNeighbor [<xref ref-type="bibr" rid="CR8">8</xref>] to determine the similarity between clusters from different batches based on Spearman correlation. For <italic>n</italic> batches each contains <italic>c</italic><sub><italic>i</italic></sub> clusters, <italic>i</italic> = 1, 2, …, <italic>n</italic>, MetaNeighbor produces a similarity score for each pair of cell clusters by calculating the mean of area under the receiver operator characteristic curve (AUROC) in cross-validation. We denote <inline-formula id="IEq2"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_1,{j}_1,{i}_2,{j}_2} $$\end{document}</tex-math><mml:math id="M8" display="inline"><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq2.gif"/></alternatives></inline-formula> as the similarity score between cluster <italic>j</italic><sub>1</sub> in batch <italic>i</italic><sub>1</sub> and cluster <italic>j</italic><sub>2</sub> in batch <italic>i</italic><sub>2</sub>. Because we were interested in similar clusters across different batches, we set the similarity score between clusters within the same batch to 0. For each cluster, we considered the most similar cluster in each of the other batches, such that<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_{a,}{j}_a,{i}_b,{j}_b}=\left\{\begin{array}{c}{M}_{i_a,{j}_a,{i}_b,{j}_b},\kern0.5em \mathrm{if}\ {M}_{i_a,{j}_a,{i}_b,{j}_b}=\max \left\{\ {M}_{i_a,{j}_a,{i}_b,j},j=1,2,\dots, {c}_{i_b}\right\},{i}_a\ne {i}_b\\ {}0,\kern0.5em \mathrm{otherwise}\end{array}\right.. $$\end{document}</tex-math><mml:math id="M10" display="block"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:maligngroup/><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfenced close="" open="{"><mml:mtable><mml:mtr><mml:mtd><mml:maligngroup/><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.5em"/><mml:malignmark/><mml:mtext>if</mml:mtext><mml:mspace width="0.25em"/><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>max</mml:mo><mml:mfenced close="}" open="{" separators=",,,,"><mml:mrow><mml:mspace width="0.25em"/><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn><mml:mo>…</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:msub></mml:mfenced><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>≠</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:maligngroup/><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="0.5em"/><mml:malignmark/><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable></mml:mfenced><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par44">We further made the similarity scores between two clusters symmetrical by modifying <inline-formula id="IEq3"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_a,{j}_a,{i}_b{j}_b} $$\end{document}</tex-math><mml:math id="M12" display="inline"><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq3.gif"/></alternatives></inline-formula> as<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_a,{j}_a,{i}_b,{j}_b}=\max \left\{{M}_{i_a,{j}_a,{i}_b,{j}_b},{M}_{i_b,{j}_b,{i}_a,{j}_a}\right\},{i}_a,{i}_b=1,2,\dots, n,{j}_a=1,2,\dots, {c}_{i_a},{j}_b=1,2,\dots, {c}_{i_b}. $$\end{document}</tex-math><mml:math id="M14" display="block"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:maligngroup/><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>max</mml:mo><mml:mfenced close="}" open="{" separators=","><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mfenced><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:msub><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par45">Instead of considering mutual nearest cell clusters, our criterion for identifying similar cell clusters summarized in Eqs. <xref rid="Equ3" ref-type="">3</xref> and <xref rid="Equ4" ref-type="">4</xref> can accommodate the case where a cell cluster in one batch corresponds to multiple clusters in another batch, which makes <italic>BERMUDA</italic> more robust to the results in the clustering step. Considering the case where cluster <italic>j</italic><sub>1</sub> in batch <italic>i</italic><sub>1</sub> was identified to be similar to both cluster <italic>j</italic><sub>2</sub> and <italic>j</italic><sub>3</sub> in batch <italic>i</italic><sub>2</sub> with high confidence by MetaNeighbor (e.g., <inline-formula id="IEq4"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_1,{j}_1,{i}_2,{j}_2}={M}_{i_2,{j}_2,{i}_1,{j}_1}=0.99 $$\end{document}</tex-math><mml:math id="M16" display="inline"><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.99</mml:mn></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq4.gif"/></alternatives></inline-formula>, <inline-formula id="IEq5"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_1,{j}_1,{i}_2,{j}_3}={M}_{i_2,{j}_3,{i}_1,{j}_1}=0.98 $$\end{document}</tex-math><mml:math id="M18" display="inline"><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.98</mml:mn></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq5.gif"/></alternatives></inline-formula>), where cluster <italic>j</italic><sub>2</sub> and <italic>j</italic><sub>3</sub> in batch <italic>i</italic><sub>2</sub> might be separated from a single, larger cluster by the clustering algorithm. If we only considered mutual nearest clusters, we would have only aligned cluster <italic>j</italic><sub>1</sub> in batch <italic>i</italic><sub>1</sub> with cluster <italic>j</italic><sub>2</sub> in batch <italic>i</italic><sub>2</sub>. However, by using our proposed criterion, according to Eqs. <xref rid="Equ3" ref-type="">3</xref> and <xref rid="Equ4" ref-type="">4</xref>, we can get <inline-formula id="IEq6"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_1,{j}_1,{i}_2,{j}_3}={M}_{i_2,{j}_3,{i}_1,{j}_1}=0.98 $$\end{document}</tex-math><mml:math id="M20" display="inline"><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.98</mml:mn></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq6.gif"/></alternatives></inline-formula> (<inline-formula id="IEq7"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_1,{j}_1,{i}_2,{j}_3}=0 $$\end{document}</tex-math><mml:math id="M22" display="inline"><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq7.gif"/></alternatives></inline-formula>, <inline-formula id="IEq8"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_2,{j}_3,{i}_1,{j}_1}=0.98 $$\end{document}</tex-math><mml:math id="M24" display="inline"><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.98</mml:mn></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq8.gif"/></alternatives></inline-formula> from Eq. <xref rid="Equ3" ref-type="">3</xref> and <inline-formula id="IEq9"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_1,{j}_1,{i}_2,{j}_3}=\max \left({M}_{i_1,{j}_1,{i}_2,{j}_3},{M}_{i_2,{j}_3,{i}_1,{j}_1}\right)=0.98 $$\end{document}</tex-math><mml:math id="M26" display="inline"><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>max</mml:mo><mml:mfenced close=")" open="(" separators=","><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub></mml:mfenced><mml:mo>=</mml:mo><mml:mn>0.98</mml:mn></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq9.gif"/></alternatives></inline-formula> from Eq. <xref rid="Equ4" ref-type="">4</xref>), which faithfully captured the similarity relationships identified.</p>
      <p id="Par46">Finally, we binarized <inline-formula id="IEq10"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_a,{j}_a,{i}_b,{j}_b} $$\end{document}</tex-math><mml:math id="M28" display="inline"><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq10.gif"/></alternatives></inline-formula> with a threshold value <italic>S</italic><sub><italic>thr</italic></sub>, where<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_a,{j}_a,{i}_b,{j}_b}=1\ \mathrm{if}\ {M}_{i_a,{j}_a,{i}_b,{j}_b}\ge {S}_{thr},{i}_a,{i}_b=1,2,\dots, n,{j}_a=1,2,\dots, {c}_{i_a},{j}_b=1,2,\dots, {c}_{i_b}. $$\end{document}</tex-math><mml:math id="M30" display="block"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:maligngroup/><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mspace width="0.25em"/><mml:mtext>if</mml:mtext><mml:mspace width="0.25em"/><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>≥</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi mathvariant="italic">thr</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:msub><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par47">This can prevent finding a spurious counterpart for a cluster (e.g., cluster <italic>j</italic><sub>2</sub> in batch <italic>i</italic><sub>1</sub>) if such cluster was specific to only one batch. In this case, the similarity scores between cluster <italic>j</italic><sub>2</sub> in batch <italic>i</italic><sub>1</sub> to any other clusters should be lower than <italic>S</italic><sub><italic>thr</italic></sub>, which set <inline-formula id="IEq11"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{i_1,{j}_2,i,j}=0,\forall i,j $$\end{document}</tex-math><mml:math id="M32" display="inline"><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>∀</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq11.gif"/></alternatives></inline-formula> (Eq. <xref rid="Equ5" ref-type="">5</xref>). In this way, cluster <italic>j</italic><sub>2</sub> in batch <italic>i</italic><sub>1</sub> will not be aligned to other clusters during the training process of <italic>BERMUDA</italic>. <italic>S</italic><sub><italic>thr</italic></sub> was chosen empirically and we observed that <italic>BERMUDA</italic> achieved robust and competitive results across different datasets when <italic>S</italic><sub><italic>thr</italic></sub> was between 0.85 and 0.90 (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S8, S9).</p>
    </sec>
    <sec id="Sec17">
      <title>Batch correction using an autoencoder</title>
      <p id="Par48"><italic>BERMUDA</italic> uses an autoencoder to project the original uncorrected gene expression profiles to a low-dimensional space to remove the experimental artifacts across different batches (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b). An autoencoder can be represented as a function <bold>x</bold><sup>′</sup> = <italic>f</italic>(<bold>x</bold>) = <italic>f</italic><sub><italic>decoder</italic></sub>(<italic>f</italic><sub><italic>encoder</italic></sub>(<bold>x</bold>)), where <italic>f</italic> reconstructs the input gene expression profile <bold>x</bold> through the neural network. To avoid trivial solutions, autoencoders usually incorporate a bottleneck layer that learns a low-dimensional embedding of the input data called code, e.g., <bold>z</bold> = <italic>f</italic><sub><italic>encoder</italic></sub>(<bold>x</bold>). In <italic>BERMUDA</italic>, we used an autoencoder with three hidden layers, and the default number of neurons in each hidden layer were 200, 20, and 200. For the synthetic data generated from bivariate Gaussian distributions, we set the neurons in each hidden layer as 20, 2, and 20 to reconstruct the two-dimensional biological plane.</p>
      <p id="Par49">The mini-batch gradient descent algorithm commonly adopted in deep learning was used to train <italic>BERMUDA</italic>. Mini-batch gradient descent is a variation of the gradient descent algorithm and is widely adopted in the field of deep learning. For each iteration in each epoch during the training process of <italic>BERMUDA</italic>, a “mini-batch” <bold>X</bold> = {<bold>x</bold><sub>1</sub>, <bold>x</bold><sub>2</sub>, …, <bold>x</bold><sub>B</sub>} was sampled from the dataset, which contained <italic>n</italic><sub><italic>mb</italic></sub> cells from each cluster (<inline-formula id="IEq12"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ B={n}_{mb}\sum \limits_{i=1}^n{c}_i $$\end{document}</tex-math><mml:math id="M34" display="inline"><mml:mi>B</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi mathvariant="italic">mb</mml:mi></mml:msub><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq12.gif"/></alternatives></inline-formula>). We used <italic>n</italic><sub><italic>mb</italic></sub> = 50 in our experiments. However, we observed that <italic>BERMUDA</italic> was robust to the choice of <italic>n</italic><sub><italic>mb</italic></sub> and can outperform existing methods under a wide range of <italic>n</italic><sub><italic>mb</italic></sub> values (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S10). The loss was calculated on the entire mini-batch and the parameters in <italic>BERMUDA</italic> were then updated using gradient descent. In each epoch, multiple iterations were performed to cover all the cells in the dataset.</p>
      <p id="Par50">The loss function for training the autoencoder consisted of two parts. The first part is a reconstruction loss between the output layer and the input layer defined by mean squared error<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {L}_1\left(\mathbf{X}\right)=\sum \limits_{i=1}^B{\left\Vert {\mathbf{x}}_i-{\mathbf{x}}_i^{\prime}\right\Vert}_2^2, $$\end{document}</tex-math><mml:math id="M36" display="block"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:maligngroup/><mml:msub><mml:mi>L</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">X</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:msubsup><mml:mfenced close="‖" open="‖"><mml:mrow><mml:msub><mml:mi mathvariant="bold">x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mi mathvariant="bold">x</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:mfenced><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par51">where <bold>x</bold><sub><italic>i</italic></sub> and <inline-formula id="IEq13"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\mathbf{x}}_i^{\prime } $$\end{document}</tex-math><mml:math id="M38" display="inline"><mml:msubsup><mml:mi mathvariant="bold">x</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2019_1764_Article_IEq13.gif"/></alternatives></inline-formula> are input and reconstructed expression profile of the <italic>i</italic>-th cell in a mini-batch. The second part is a novel maximum mean discrepancy (MMD) based loss [<xref ref-type="bibr" rid="CR29">29</xref>] that estimates the differences in distributions among similar cell clusters in different batches. MMD is a non-parametric distance estimate between distributions based on the reproducing kernel Hilbert space (RKHS) and has proven to be highly effective in many deep transfer learning tasks [<xref ref-type="bibr" rid="CR41">41</xref>–<xref ref-type="bibr" rid="CR44">44</xref>]. Since MMD does not require density estimates as an intermediate step and does not assume any parametric density on the data, it can be applied to different domains [<xref ref-type="bibr" rid="CR45">45</xref>]. MMD is also memory-efficient, fast to compute, and performs well on high dimensional data with low sample size [<xref ref-type="bibr" rid="CR46">46</xref>, <xref ref-type="bibr" rid="CR47">47</xref>]. Considering the case where only a subset of the cell population is shared among batches, instead of applying MMD loss on batches entirely, we only considered the loss between pairs of similar cell clusters among different batches. So, the MMD-based loss can be defined as<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {L}_2\left(\mathbf{X}\right)={\sum}_{i_a,{i}_b,{j}_a,{j}_b}{M}_{i_a,{j}_a,{i}_b,{j}_b}\bullet MMD\left({\mathbf{Z}}_{i_a,{j}_a},{\mathbf{Z}}_{i_b,{j}_b}\right), $$\end{document}</tex-math><mml:math id="M40" display="block"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:maligngroup/><mml:msub><mml:mi>L</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">X</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>∙</mml:mo><mml:mi mathvariant="italic">MMD</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:msub><mml:mi mathvariant="bold">Z</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi mathvariant="bold">Z</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mfenced><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par52">where <bold>Z</bold><sub><italic>i</italic>, <italic>j</italic></sub> is the code of the input <bold>X</bold><sub><italic>i</italic>, <italic>j</italic></sub>, and <bold>X</bold><sub><italic>i</italic>, <italic>j</italic></sub> is the expression profiles of cells from cluster <italic>j</italic> of batch <italic>i</italic> in the mini-batch <bold>X</bold>. <italic>MMD</italic>(∙) equals to zero when the underlying distributions of the observed samples are the same. By minimizing the MMD loss between the distributions of similar clusters, the autoencoder can be trained to remove batch effects in the bottleneck layer. In summary, the total loss function on a mini-batch can be written as<disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ L\left(\mathbf{X}\right)={L}_1\left(\mathbf{X}\right)+\lambda {L}_2\left(\mathbf{X}\right), $$\end{document}</tex-math><mml:math id="M42" display="block"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:maligngroup/><mml:mi>L</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">X</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mi>L</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">X</mml:mi></mml:mfenced><mml:mo>+</mml:mo><mml:mi>λ</mml:mi><mml:msub><mml:mi>L</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">X</mml:mi></mml:mfenced><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par53">where <italic>λ</italic> is a regularization parameter. We followed the strategy introduced by Ganin et al. [<xref ref-type="bibr" rid="CR48">48</xref>] to gradually increase <italic>λ</italic> during the training process. The regularization parameter at epoch <italic>p</italic> is calculated as<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\lambda}_p=\frac{2}{1+{e}^{-\frac{10p}{np}}}-1, $$\end{document}</tex-math><mml:math id="M44" display="block"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:maligngroup/><mml:msub><mml:mi>λ</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>2</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>10</mml:mn><mml:mi>p</mml:mi></mml:mrow><mml:mi mathvariant="italic">np</mml:mi></mml:mfrac></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par54">where <italic>np</italic> is the number of total epochs in training. This can help the autoencoder to first focus on finding a proper low-dimensional representation of the original gene expression data, then focus on aligning the distributions of similar clusters in the low-dimensional space.</p>
    </sec>
    <sec id="Sec18">
      <title>Performance evaluation</title>
      <p id="Par55">To evaluate the performance of <italic>BERMUDA</italic>, we examined the outputs when specific cell types were removed from their respective batches. We then used three metrics to compare algorithm performance. First, we used a k-nearest-neighbor based divergence estimation method [<xref ref-type="bibr" rid="CR49">49</xref>] to evaluate the quality of merging the shared cell population among batches. For <italic>n</italic> scRNA-seq batches with gene expression profiles <bold>X</bold><sub>1</sub>, <bold>X</bold><sub>2</sub>, …, <bold>X</bold><sub><italic>n</italic></sub> and their corresponding batch-corrected low-dimensional embeddings <bold>Z</bold><sub>1</sub>, <bold>Z</bold><sub>2</sub>, …, <bold>Z</bold><sub><italic>n</italic></sub>, we define<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ divergence\_ score=\frac{1}{n_{div}}{\sum}_{i\ne j,s\left({\mathbf{Z}}_i,{\mathbf{Z}}_j\right)\ne \varnothing, s\left({\mathbf{Z}}_j,{\mathbf{Z}}_i\right)\ne \varnothing }D\left(s\left({\mathbf{Z}}_i,{\mathbf{Z}}_j\right),s\left({\mathbf{Z}}_j,{\mathbf{Z}}_i\right)\right), $$\end{document}</tex-math><mml:math id="M46" display="block"><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>s</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>≠</mml:mo><mml:mi class="MJX-variant">∅</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>≠</mml:mo><mml:mi class="MJX-variant">∅</mml:mi></mml:mrow></mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par56">where <italic>s</italic>(<bold>Z</bold><sub><italic>i</italic></sub>, <bold>Z</bold><sub><italic>j</italic></sub>) is the cell population in <bold>Z</bold><sub><italic>i</italic></sub> that is shared by <bold>Z</bold><sub><italic>j</italic></sub>, <italic>D</italic>(<bold>Z</bold><sub><italic>i</italic></sub>, <bold>Z</bold><sub><italic>j</italic></sub>) is the divergence estimation of the two distributions given samples <bold>Z</bold><sub><italic>i</italic></sub> and <bold>Z</bold><sub><italic>j</italic></sub>, and <italic>n</italic><sub><italic>div</italic></sub> = ∣ {(<italic>i</italic>, <italic>j</italic>)| <italic>i</italic> ≠ <italic>j</italic>, <italic>s</italic>(<bold>Z</bold><sub><italic>i</italic></sub>, <bold>Z</bold><sub><italic>j</italic></sub>) ≠ ∅ , <italic>s</italic>(<bold>Z</bold><sub><italic>j</italic></sub>, <bold>Z</bold><sub><italic>i</italic></sub>) ≠ ∅ }∣ is the number of pairs of batches with shared cell population. Since proper removal of batch effects should produce results where the distributions of shared cell populations among different batches are similar, a smaller <italic>divergence</italic>_<italic>score</italic> is preferred, indicating that the shared cell population between different batches are homogeneously mixed. Second, we used entropy to evaluate whether a cell population that only exists in a certain batch remains distinct from other populations after correction. We define<disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ entropy\_ score=\frac{1}{n_{ent}}\sum \limits_{i\ne j,d\left({\mathbf{Z}}_i,{\mathbf{Z}}_j\right)\ne \varnothing}\frac{1}{\left|d\left({\mathbf{Z}}_i,{\mathbf{Z}}_j\right)\right|}\sum \limits_{\mathbf{k}\in d\left({\mathbf{Z}}_i,{\mathbf{Z}}_j\right)\ }E\left(\mathbf{k}\right), $$\end{document}</tex-math><mml:math id="M48" display="block"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:maligngroup/><mml:mtext mathvariant="italic">entropy</mml:mtext><mml:mo>_</mml:mo><mml:mtext mathvariant="italic">score</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msub><mml:mi>n</mml:mi><mml:mi mathvariant="italic">ent</mml:mi></mml:msub></mml:mfrac><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:msub><mml:mi mathvariant="bold">Z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi mathvariant="bold">Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mfenced><mml:mo>≠</mml:mo><mml:mo>∅</mml:mo></mml:mrow></mml:munder><mml:mfrac><mml:mn>1</mml:mn><mml:mfenced close="|" open="|"><mml:mrow><mml:mi>d</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:msub><mml:mi mathvariant="bold">Z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi mathvariant="bold">Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mfenced></mml:mrow></mml:mfenced></mml:mfrac><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi mathvariant="bold">k</mml:mi><mml:mo>∈</mml:mo><mml:mi>d</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:msub><mml:mi mathvariant="bold">Z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi mathvariant="bold">Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mfenced><mml:mspace width="0.25em"/></mml:mrow></mml:munder><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">k</mml:mi></mml:mfenced><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par57">where <italic>d</italic>(<bold>Z</bold><sub><italic>i</italic></sub>, <bold>Z</bold><sub><italic>j</italic></sub>) is the cell population in <bold>Z</bold><sub><italic>i</italic></sub> that is not shared by <bold>Z</bold><sub><italic>j</italic></sub>, and <italic>n</italic><sub><italic>ent</italic></sub> = ∣ {(<italic>i</italic>, <italic>j</italic>)| <italic>i</italic> ≠ <italic>j</italic>, <italic>d</italic>(<bold>Z</bold><sub><italic>i</italic></sub>, <bold>Z</bold><sub><italic>j</italic></sub>) ≠  ∅ }∣ is the number of pairs of batches where there exists distinct cell population in <bold>Z</bold><sub><italic>i</italic></sub> from <bold>Z</bold><sub><italic>j</italic></sub>. <italic>E</italic>(<bold>k</bold>) is the estimation of entropy locally around cell <bold>k</bold> defined as<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ E\left(\mathbf{k}\right)=\sum \limits_{i=1}^n{p}_i\log \left({p}_i\right), $$\end{document}</tex-math><mml:math id="M50" display="block"><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mi>log</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par58">where <italic>p</italic><sub><italic>i</italic></sub> is the proportion of cells from batch <italic>i</italic> among the <italic>NN</italic>-nearest neighbors of cell <bold>k</bold>. We chose <italic>NN</italic> = 100 in our evaluations. When batch effects are removed properly, a cell type that only exists in a batch should not be mixed with cells from other batches. So, a smaller <italic>entropy</italic>_<italic>score</italic> is desired, suggesting that biological signals only contained in a subset of batches are properly preserved during correction. Note that when all the batches share the same cell types, we did <italic>not</italic> calculate <italic>entropy</italic>_<italic>score</italic> during evaluation since there is no batch-specific cell population.</p>
      <p id="Par59">The divergence and entropy estimations were calculated for pairs of batches and then averaged to acquire a summary of the batch correction performance among multiple batches. When the dimensionality of the embedding was high, <italic>divergence</italic>_<italic>score</italic> and <italic>entropy</italic>_<italic>score</italic> were calculated based on the two-dimensional UMAP [<xref ref-type="bibr" rid="CR30">30</xref>] embeddings of the data to derive robust estimations of divergence and entropy. UMAP is a general dimensionality reduction algorithm that can achieve competitive results compared to t-SNE [<xref ref-type="bibr" rid="CR50">50</xref>], while preserves more global structures of the data.</p>
      <p id="Par60">Third, since <italic>divergence</italic>_<italic>score</italic> and <italic>entropy</italic>_<italic>score</italic> are both proposed to evaluate the mixture of cells among batches, we also compared a metric to evaluate the separation of different cell types after batch effects being removed. To this end, we calculated the silhouette coefficient with clusters defined by cell types. For a cell <bold>k</bold>, let <italic>a</italic>(<bold>k</bold>) be the average distance between <bold>k</bold> and all the other cells within the same cluster and <italic>b</italic>(<bold>k</bold>) be the smallest average distance between <bold>k</bold> and all the cells in any other cluster, we define the silhouette coefficient of cell <bold>k</bold> as<disp-formula id="Equ13"><label>13</label><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ S\left(\mathbf{k}\right)=\frac{b\left(\mathbf{k}\right)-a\left(\mathbf{k}\right)}{\max \left\{a\left(\mathbf{k}\right),b\left(\mathbf{k}\right)\right\}}. $$\end{document}</tex-math><mml:math id="M52" display="block"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:maligngroup/><mml:mi>S</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">k</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>b</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">k</mml:mi></mml:mfenced><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">k</mml:mi></mml:mfenced></mml:mrow><mml:mrow><mml:mo>max</mml:mo><mml:mfenced close="}" open="{" separators=","><mml:mrow><mml:mi>a</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">k</mml:mi></mml:mfenced></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">k</mml:mi></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par61">The average silhouette coefficient of all the cells from different batches is calculated after batch effect removal, such that<disp-formula id="Equ14"><label>14</label><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ silhouette\_ score=\frac{1}{\sum \limits_{i=1}^n\mid \left\{\mathbf{k}|\mathbf{k}\in {\mathbf{Z}}_i\right\}\mid}\sum \limits_{i=1}^n\sum \limits_{\mathbf{k}\in {\mathbf{Z}}_i}S\left(\mathbf{k}\right). $$\end{document}</tex-math><mml:math id="M54" display="block"><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>l</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>s</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mi>S</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:math><graphic xlink:href="13059_2019_1764_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par62">A larger <italic>silhouette</italic>_<italic>score</italic> indicates that the cell type assignment in the aligned dataset is more appropriate, where a cell is close to cells of the same type and distant from cells of different types. <italic>S</italic>(<bold>k</bold>) is calculated using Euclidean distance on the two-dimensional UMAP embeddings of the results.</p>
    </sec>
    <sec id="Sec19">
      <title>Performance comparison with popular batch correction methods</title>
      <p id="Par63">We compared <italic>BERMUDA</italic> with several existing state-of-the-art batch correction methods for scRNA-seq data, including <italic>mnnCorrect</italic> [<xref ref-type="bibr" rid="CR20">20</xref>], <italic>BBKNN</italic> [<xref ref-type="bibr" rid="CR24">24</xref>], <italic>Seurat v2</italic> (v2.3.4) [<xref ref-type="bibr" rid="CR22">22</xref>], <italic>Seurat v3</italic> (v3.0.0) [<xref ref-type="bibr" rid="CR23">23</xref>], and <italic>scVI</italic> [<xref ref-type="bibr" rid="CR28">28</xref>]. <italic>BBKNN</italic> and <italic>mnnCorrect</italic> were applied to log-transformed TPM data of variable genes. <italic>Seurat v2</italic>, <italic>Seurat v3</italic>, and <italic>scVI</italic> were applied on the datasets following the recommended workflow [<xref ref-type="bibr" rid="CR22">22</xref>, <xref ref-type="bibr" rid="CR23">23</xref>, <xref ref-type="bibr" rid="CR28">28</xref>]. Due to the restriction of the workflow, we did not apply <italic>Seurat v2</italic>, <italic>Seurat v3</italic>, and <italic>scVI</italic> on the Gaussian simulated gene expression data. To demonstrate the necessity of batch correction methods for scRNA-seq data, we also compared <italic>BERMUDA</italic> with batch correction methods for microarray and bulk RNA-seq data, such as <italic>combat</italic> [<xref ref-type="bibr" rid="CR14">14</xref>] and <italic>limma</italic> [<xref ref-type="bibr" rid="CR15">15</xref>] (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S3).</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Additional files</title>
    <sec id="Sec20">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="13059_2019_1764_MOESM1_ESM.pdf">
            <label>Additional file 1:</label>
            <caption>
              <p>Supplementary figures and tables (PDF 3839 kb)</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="13059_2019_1764_MOESM2_ESM.docx">
            <label>Additional file 2:</label>
            <caption>
              <p>Review history (DOCX 44 kb)</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank Ms. Megan Metzger for the help in editing the manuscript.</p>
    <sec id="FPar1">
      <title>Review history</title>
      <p id="Par64">The review history is available as Additional file <xref rid="MOESM2" ref-type="media">2</xref></p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>TW, TSJ, JZ, and KH conceived the project. TW, TSJ, and WS conceived and designed the experiments. TW, TSJ, and ZL performed the experiments and analyzed the data. TW and KH developed the structure and arguments for the paper. TW, TSJ, and JZ wrote the manuscript. WS, BRH, JZ, and KH edited and revised the manuscript. All the authors reviewed and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>This work was supported by Indiana University Precision Health Initiative, the National Health Institute F31 Fellowship [F31LM013056], and National Cancer Institute Informatics Technology for Cancer Research (NCI ITCR) U01 [CA188547].</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The pancreas dataset was obtained from Gene Expression Omnibus (GSE85241 for <italic>Muraro batch</italic> [<xref ref-type="bibr" rid="CR32">32</xref>], GSE84133 for <italic>Baron batch</italic> [<xref ref-type="bibr" rid="CR33">33</xref>]) and The European Bioinformatics Institute (E-MTAB-5061 for <italic>Segerstolpe batch</italic> [<xref ref-type="bibr" rid="CR37">37</xref>]). The PBMC dataset was obtained from 10x Genomics support datasets (<ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/2.1.0/pbmc8k">https://support.10xgenomics.com/single-cell-gene-expression/datasets/2.1.0/pbmc8k</ext-link> for <italic>PBMC batch</italic> and <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/2.1.0/t_3k">https://support.10xgenomics.com/single-cell-gene-expression/datasets/2.1.0/t_3k</ext-link> for <italic>Pan T Cell batch</italic>). The implementation of <italic>BERMUDA</italic> can be downloaded from Github (<ext-link ext-link-type="uri" xlink:href="https://github.com/txWang/BERMUDA">https://github.com/txWang/BERMUDA</ext-link>) [<xref ref-type="bibr" rid="CR51">51</xref>] and from Zenodo (DOI: 10.5281/zenodo.3339320) [<xref ref-type="bibr" rid="CR52">52</xref>].</p>
  </notes>
  <notes>
    <title>Ethics approval and consent to participate</title>
    <p id="Par65">Not applicable.</p>
  </notes>
  <notes>
    <title>Consent for publication</title>
    <p id="Par66">Not applicable.</p>
  </notes>
  <notes notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par67">The authors declare that they have no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Saeys</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Van Gassen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lambrecht</surname>
            <given-names>BN</given-names>
          </name>
        </person-group>
        <article-title>Computational flow cytometry: helping to make sense of high-dimensional immunology data</article-title>
        <source>Nat Rev Immunol</source>
        <year>2016</year>
        <volume>16</volume>
        <fpage>449</fpage>
        <pub-id pub-id-type="doi">10.1038/nri.2016.56</pub-id>
        <pub-id pub-id-type="pmid">27320317</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Bodovitz</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Single cell analysis: the new frontier in ‘omics’</article-title>
        <source>Trends Biotechnol</source>
        <year>2010</year>
        <volume>28</volume>
        <issue>6</issue>
        <fpage>281</fpage>
        <lpage>290</lpage>
        <pub-id pub-id-type="doi">10.1016/j.tibtech.2010.03.002</pub-id>
        <pub-id pub-id-type="pmid">20434785</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huang</surname>
            <given-names>WE</given-names>
          </name>
          <name>
            <surname>Stoecker</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Griffiths</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Newbold</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Daims</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Whiteley</surname>
            <given-names>AS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Raman-FISH: combining stable-isotope Raman spectroscopy and fluorescence in situ hybridization for the single cell analysis of identity and function</article-title>
        <source>Environ Microbiol</source>
        <year>2007</year>
        <volume>9</volume>
        <issue>8</issue>
        <fpage>1878</fpage>
        <lpage>1889</lpage>
        <pub-id pub-id-type="doi">10.1111/j.1462-2920.2007.01352.x</pub-id>
        <pub-id pub-id-type="pmid">17635536</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Puppels</surname>
            <given-names>GJ</given-names>
          </name>
          <name>
            <surname>de Mul</surname>
            <given-names>FF</given-names>
          </name>
          <name>
            <surname>Otto</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Greve</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Robert-Nicoud</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Arndt-Jovin</surname>
            <given-names>DJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Studying single living cells and chromosomes by confocal Raman microspectroscopy</article-title>
        <source>Nature.</source>
        <year>1990</year>
        <volume>347</volume>
        <issue>6290</issue>
        <fpage>301</fpage>
        <lpage>303</lpage>
        <pub-id pub-id-type="doi">10.1038/347301a0</pub-id>
        <pub-id pub-id-type="pmid">2205805</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Consortium</surname>
            <given-names>SM-I</given-names>
          </name>
        </person-group>
        <article-title>A comprehensive assessment of RNA-seq accuracy, reproducibility and information content by the sequencing quality control Consortium</article-title>
        <source>Nat Biotechnol</source>
        <year>2014</year>
        <volume>32</volume>
        <issue>9</issue>
        <fpage>903</fpage>
        <lpage>914</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.2957</pub-id>
        <pub-id pub-id-type="pmid">25150838</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
          <name>
            <surname>Mason</surname>
            <given-names>CE</given-names>
          </name>
          <name>
            <surname>Mane</surname>
            <given-names>SM</given-names>
          </name>
          <name>
            <surname>Stephens</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gilad</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>RNA-seq: an assessment of technical reproducibility and comparison with gene expression arrays</article-title>
        <source>Genome Res</source>
        <year>2008</year>
        <volume>18</volume>
        <issue>9</issue>
        <fpage>1509</fpage>
        <lpage>1517</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.079558.108</pub-id>
        <pub-id pub-id-type="pmid">18550803</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Consortium</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Reid</surname>
            <given-names>LH</given-names>
          </name>
          <name>
            <surname>Jones</surname>
            <given-names>WD</given-names>
          </name>
          <name>
            <surname>Shippy</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Warrington</surname>
            <given-names>JA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The MicroArray Quality Control (MAQC) project shows inter- and intraplatform reproducibility of gene expression measurements</article-title>
        <source>Nat Biotechnol</source>
        <year>2006</year>
        <volume>24</volume>
        <issue>9</issue>
        <fpage>1151</fpage>
        <lpage>1161</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt1239</pub-id>
        <pub-id pub-id-type="pmid">16964229</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Crow</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Paul</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Ballouz</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>ZJ</given-names>
          </name>
          <name>
            <surname>Gillis</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Characterizing the replicability of cell types defined by single cell RNA-sequencing data using MetaNeighbor</article-title>
        <source>Nat Commun</source>
        <year>2018</year>
        <volume>9</volume>
        <issue>1</issue>
        <fpage>884</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-018-03282-0</pub-id>
        <pub-id pub-id-type="pmid">29491377</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Draghici</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Khatri</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Eklund</surname>
            <given-names>AC</given-names>
          </name>
          <name>
            <surname>Szallasi</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Reliability and reproducibility issues in DNA microarray measurements</article-title>
        <source>Trends Genet</source>
        <year>2006</year>
        <volume>22</volume>
        <issue>2</issue>
        <fpage>101</fpage>
        <lpage>109</lpage>
        <pub-id pub-id-type="doi">10.1016/j.tig.2005.12.005</pub-id>
        <pub-id pub-id-type="pmid">16380191</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Labaj</surname>
            <given-names>PP</given-names>
          </name>
          <name>
            <surname>Kreil</surname>
            <given-names>DP</given-names>
          </name>
        </person-group>
        <article-title>Sensitivity, specificity, and reproducibility of RNA-Seq differential expression calls</article-title>
        <source>Biol Direct</source>
        <year>2016</year>
        <volume>11</volume>
        <issue>1</issue>
        <fpage>66</fpage>
        <pub-id pub-id-type="doi">10.1186/s13062-016-0169-7</pub-id>
        <pub-id pub-id-type="pmid">27993156</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shi</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Campbell</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Jones</surname>
            <given-names>WD</given-names>
          </name>
          <name>
            <surname>Campagne</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Wen</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Walker</surname>
            <given-names>SJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The MicroArray Quality Control (MAQC)-II study of common practices for the development and validation of microarray-based predictive models</article-title>
        <source>Nat Biotechnol</source>
        <year>2010</year>
        <volume>28</volume>
        <issue>8</issue>
        <fpage>827</fpage>
        <lpage>838</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.1665</pub-id>
        <pub-id pub-id-type="pmid">20676074</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Grennan</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Badner</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Gershon</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Jin</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Removing batch effects in analysis of expression microarray data: an evaluation of six batch adjustment methods</article-title>
        <source>PLoS One</source>
        <year>2011</year>
        <volume>6</volume>
        <issue>2</issue>
        <fpage>e17238</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0017238</pub-id>
        <pub-id pub-id-type="pmid">21386892</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Diboun</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Wernisch</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Orengo</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Koltzenburg</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Microarray analysis after RNA amplification can detect pronounced differences in gene expression using limma</article-title>
        <source>BMC Genomics</source>
        <year>2006</year>
        <volume>7</volume>
        <fpage>252</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2164-7-252</pub-id>
        <pub-id pub-id-type="pmid">17029630</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Johnson</surname>
            <given-names>WE</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Rabinovic</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Adjusting batch effects in microarray expression data using empirical Bayes methods</article-title>
        <source>Biostatistics.</source>
        <year>2007</year>
        <volume>8</volume>
        <issue>1</issue>
        <fpage>118</fpage>
        <lpage>127</lpage>
        <pub-id pub-id-type="doi">10.1093/biostatistics/kxj037</pub-id>
        <pub-id pub-id-type="pmid">16632515</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ritchie</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>Phipson</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Law</surname>
            <given-names>CW</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>limma powers differential expression analyses for RNA-sequencing and microarray studies</article-title>
        <source>Nucleic Acids Res</source>
        <year>2015</year>
        <volume>43</volume>
        <issue>7</issue>
        <fpage>e47</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkv007</pub-id>
        <pub-id pub-id-type="pmid">25605792</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Leek</surname>
            <given-names>JT</given-names>
          </name>
        </person-group>
        <article-title>svaseq: removing batch effects and other unwanted noise from sequencing data</article-title>
        <source>Nucleic Acids Res</source>
        <year>2014</year>
        <volume>42</volume>
        <issue>21</issue>
        <fpage>e161</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gku864</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>WV</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>JJ</given-names>
          </name>
        </person-group>
        <article-title>An accurate and robust imputation method scImpute for single-cell RNA-seq data</article-title>
        <source>Nat Commun</source>
        <year>2018</year>
        <volume>9</volume>
        <issue>1</issue>
        <fpage>997</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-018-03405-7</pub-id>
        <pub-id pub-id-type="pmid">29520097</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Troup</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Ho</surname>
            <given-names>JW</given-names>
          </name>
        </person-group>
        <article-title>CIDR: ultrafast and accurate clustering through imputation for single-cell RNA-seq data</article-title>
        <source>Genome Biol</source>
        <year>2017</year>
        <volume>18</volume>
        <issue>1</issue>
        <fpage>59</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1188-0</pub-id>
        <pub-id pub-id-type="pmid">28351406</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Herring</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Sheng</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Ping</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Simmons</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Quantitative assessment of cell population diversity in single-cell landscapes</article-title>
        <source>PLoS Biol</source>
        <year>2018</year>
        <volume>16</volume>
        <issue>10</issue>
        <fpage>e2006687</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pbio.2006687</pub-id>
        <pub-id pub-id-type="pmid">30346945</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Haghverdi</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>Morgan</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Batch effects in single-cell RNA-sequencing data are corrected by matching mutual nearest neighbors</article-title>
        <source>Nat Biotechnol</source>
        <year>2018</year>
        <volume>36</volume>
        <issue>5</issue>
        <fpage>421</fpage>
        <lpage>427</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4091</pub-id>
        <pub-id pub-id-type="pmid">29608177</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Johnson</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Abrams</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Mapping neuronal cell types using integrative multi-species modeling of human and mouse single cell Rna sequencing</article-title>
        <source>Pac Symp Biocomput</source>
        <year>2016</year>
        <volume>22</volume>
        <fpage>599</fpage>
        <lpage>610</lpage>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat Biotechnol</source>
        <year>2018</year>
        <volume>36</volume>
        <issue>5</issue>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Hafemeister</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Mauck</surname>
            <given-names>WM</given-names>
            <suffix>3rd</suffix>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive integration of single-cell data</article-title>
        <source>Cell.</source>
        <year>2019</year>
        <volume>177</volume>
        <issue>7</issue>
        <fpage>1888</fpage>
        <lpage>1902</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">Park J-E, Polanski K, Meyer K, Teichmann SA. Fast batch alignment of single cell transcriptomes unifies multiple mouse cell atlases into an integrated landscape. bioRxiv. 2018. 10.1101/397042.</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <mixed-citation publication-type="other">Barkas N, Petukhov V, Nikolaeva D, Lozinsky Y, Demharter S, Khodosevich K, et al. Wiring together large single-cell RNA-seq sample collections. bioRxiv. 2018. 10.1101/460246.</mixed-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <mixed-citation publication-type="other">Korsunsky I, Fan J, Slowikowski K, Zhang F, Wei K, Baglaenko Y, et al. Fast, sensitive, and accurate integration of single cell data with Harmony. bioRxiv. 2018. 10.1101/461954.</mixed-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Welch J, Kozareva V, Ferreira A, Vanderburg C, Martin C, Macosko E. Integrative inference of brain cell similarities and differences from single-cell genomics. bioRxiv. 2018. 10.1101/459891.arXiv:1802.03426.</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <issue>12</issue>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <mixed-citation publication-type="other">Gretton A, Sejdinovic D, Strathmann H, Balakrishnan S, Pontil M, Fukumizu K, et al. Optimal kernel choice for large-scale two-sample tests. Stateline: NIPS; 2012. p. 1205–13.</mixed-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <mixed-citation publication-type="other">McInnes L, Healy J, Melville J. Umap: Uniform manifold approximation and projection for dimension reduction. arXiv. 2018;1802:03426.</mixed-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zappia</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Phipson</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Oshlack</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Splatter: simulation of single-cell RNA sequencing data</article-title>
        <source>Genome Biol</source>
        <year>2017</year>
        <volume>18</volume>
        <issue>1</issue>
        <fpage>174</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1305-0</pub-id>
        <pub-id pub-id-type="pmid">28899397</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Muraro</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Dharmadhikari</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Grun</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Groen</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Dielen</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Jansen</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell transcriptome atlas of the human pancreas</article-title>
        <source>Cell Syst.</source>
        <year>2016</year>
        <volume>3</volume>
        <issue>4</issue>
        <fpage>385</fpage>
        <lpage>394</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2016.09.002</pub-id>
        <pub-id pub-id-type="pmid">27693023</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baron</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Veres</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wolock</surname>
            <given-names>SL</given-names>
          </name>
          <name>
            <surname>Faust</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Gaujoux</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Vetere</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell transcriptomic map of the human and mouse pancreas reveals inter- and intra-cell population structure</article-title>
        <source>Cell Syst</source>
        <year>2016</year>
        <volume>3</volume>
        <issue>4</issue>
        <fpage>346</fpage>
        <lpage>360</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2016.08.011</pub-id>
        <pub-id pub-id-type="pmid">27667365</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Collombat</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Mansouri</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hecksher-Sorensen</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Serup</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Krull</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Gradwohl</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Opposing actions of Arx and Pax4 in endocrine pancreas development</article-title>
        <source>Genes Dev</source>
        <year>2003</year>
        <volume>17</volume>
        <issue>20</issue>
        <fpage>2591</fpage>
        <lpage>2603</lpage>
        <pub-id pub-id-type="doi">10.1101/gad.269003</pub-id>
        <pub-id pub-id-type="pmid">14561778</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gage</surname>
            <given-names>BK</given-names>
          </name>
          <name>
            <surname>Asadi</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Baker</surname>
            <given-names>RK</given-names>
          </name>
          <name>
            <surname>Webber</surname>
            <given-names>TD</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Itoh</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The role of ARX in human pancreatic endocrine specification</article-title>
        <source>PLoS One</source>
        <year>2015</year>
        <volume>10</volume>
        <issue>12</issue>
        <fpage>e0144100</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0144100</pub-id>
        <pub-id pub-id-type="pmid">26633894</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guo</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Dai</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Guo</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Taylor</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Harmon</surname>
            <given-names>JS</given-names>
          </name>
          <name>
            <surname>Sander</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Inactivation of specific beta cell transcription factors in type 2 diabetes</article-title>
        <source>J Clin Invest</source>
        <year>2013</year>
        <volume>123</volume>
        <issue>8</issue>
        <fpage>3305</fpage>
        <lpage>3316</lpage>
        <pub-id pub-id-type="doi">10.1172/JCI65390</pub-id>
        <pub-id pub-id-type="pmid">23863625</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Segerstolpe</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Palasantza</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Eliasson</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Andersson</surname>
            <given-names>EM</given-names>
          </name>
          <name>
            <surname>Andreasson</surname>
            <given-names>AC</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell transcriptome profiling of human pancreatic islets in health and type 2 diabetes</article-title>
        <source>Cell Metab</source>
        <year>2016</year>
        <volume>24</volume>
        <issue>4</issue>
        <fpage>593</fpage>
        <lpage>607</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cmet.2016.08.020</pub-id>
        <pub-id pub-id-type="pmid">27667667</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Johnson TS, Wang T, Huang Z, Yu CY, Wu Y, Han Y, et al. LAmbDA: label ambiguous domain adaptation dataset integration reduces batch effects and improves subtype detection. Bioinformatics. 2019. 10.1093/bioinformatics/btz295.</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huang</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Torre</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Dueck</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Shaffer</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Bonasio</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SAVER: gene expression recovery for single-cell RNA sequencing</article-title>
        <source>Nat Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <issue>7</issue>
        <fpage>539</fpage>
        <lpage>542</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0033-z</pub-id>
        <pub-id pub-id-type="pmid">29941873</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Ren X, Zheng L, Zhang Z. SSCC: a computational framework for rapid and accurate clustering of large-scale single cell RNA-seq data. Genomics, Proteomics &amp; Bioinformatics. 2019;17(2):201–10.</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Ghifary</surname>
            <given-names>Muhammad</given-names>
          </name>
          <name>
            <surname>Kleijn</surname>
            <given-names>W. Bastiaan</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>Mengjie</given-names>
          </name>
        </person-group>
        <article-title>Domain Adaptive Neural Networks for Object Recognition</article-title>
        <source>Lecture Notes in Computer Science</source>
        <year>2014</year>
        <publisher-loc>Cham</publisher-loc>
        <publisher-name>Springer International Publishing</publisher-name>
        <fpage>898</fpage>
        <lpage>904</lpage>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <mixed-citation publication-type="other">Long M, Cao Y, Wang J, Jordan MI. Learning transferable features with deep adaptation networks. Lille: ICML; 2015. p. 97–105.</mixed-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <mixed-citation publication-type="other">Long M, Zhu H, Wang J, Jordan MI. Deep transfer learning with joint adaptation networks. Sydney: ICML; 2017. p. 2208–17.</mixed-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <mixed-citation publication-type="other">Wei Y, Zhang Y, Huang J, Yang Q. Transfer Learning via Learning to Transfer. Stockholm: ICML; 2018. p. 5085–94.</mixed-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gretton</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Borgwardt</surname>
            <given-names>KM</given-names>
          </name>
          <name>
            <surname>Rasch</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Scholkopf</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Smola</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>A kernel two-sample test</article-title>
        <source>J Mach Learn Res</source>
        <year>2012</year>
        <volume>13</volume>
        <fpage>723</fpage>
        <lpage>773</lpage>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Borgwardt</surname>
            <given-names>KM</given-names>
          </name>
          <name>
            <surname>Gretton</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Rasch</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Kriegel</surname>
            <given-names>HP</given-names>
          </name>
          <name>
            <surname>Scholkopf</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Smola</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <article-title>Integrating structured biological data by kernel maximum mean discrepancy</article-title>
        <source>Bioinformatics.</source>
        <year>2006</year>
        <volume>22</volume>
        <issue>14</issue>
        <fpage>e49</fpage>
        <lpage>e57</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btl242</pub-id>
        <pub-id pub-id-type="pmid">16873512</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <mixed-citation publication-type="other">Gretton A, Borgwardt KM, Rasch M, Scholkopf B, Smola AJ. A kernel method for the two-sample-problem. Vancouver: NIPS; 2006. p. 513–20.</mixed-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <mixed-citation publication-type="other">Ganin Y, Lempitsky V. Unsupervised Domain Adaptation by Backpropagation. Lille: ICML; 2015. p. 1180–9.</mixed-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Kulkarni</surname>
            <given-names>SR</given-names>
          </name>
          <name>
            <surname>Verdu</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Divergence estimation for multidimensional densities via k-nearest-neighbor distances</article-title>
        <source>IEEE Trans Inf Theory</source>
        <year>2009</year>
        <volume>55</volume>
        <issue>5</issue>
        <fpage>2392</fpage>
        <lpage>2405</lpage>
        <pub-id pub-id-type="doi">10.1109/TIT.2009.2016060</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lvd</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Hinton G. Visualizing data using t-SNE</article-title>
        <source>J Mach Learn Res</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>2579</fpage>
        <lpage>2605</lpage>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <mixed-citation publication-type="other">Wang T, Johnson TS, Shao W, Lu Z, Helm BR, Zhang J, et al. BERMUDA: a novel deep transfer learning method for single-cell RNA sequencing batch correction reveals hidden high-resolution cellular subtypes. Source Code. Github; 2019. <ext-link ext-link-type="uri" xlink:href="https://github.com/txWang/BERMUDA">https://github.com/txWang/BERMUDA</ext-link>. Accessed 17 July 2019.</mixed-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <mixed-citation publication-type="other">Wang T, Johnson TS, Shao W, Lu Z, Helm BR, Zhang J, et al. BERMUDA: a novel deep transfer learning method for single-cell RNA sequencing batch correction reveals hidden high-resolution cellular subtypes. Source Code. Zenodo. 2019. 10.5281/zenodo.3339320.</mixed-citation>
    </ref>
  </ref-list>
</back>
