<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3117331</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btr251</article-id>
    <article-id pub-id-type="publisher-id">btr251</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Ismb/Eccb 2011 Proceedings Papers Committee July 17 to July 19, 2011, Vienna, Austria</subject>
      </subj-group>
      <subj-group>
        <subject>Original Papers</subject>
        <subj-group>
          <subject>Applied Bioinformatics</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Systematic exploration of error sources in pyrosequencing flowgram data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Balzer</surname>
          <given-names>Susanne</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="AFF1">
          <sup>2</sup>
        </xref>
        <xref ref-type="corresp" rid="COR1">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Malde</surname>
          <given-names>Ketil</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jonassen</surname>
          <given-names>Inge</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="AFF1">
          <sup>3</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="AFF1"><sup>1</sup>Institute of Marine Research, P.O. Box 1870, N−5817 Bergen, <sup>2</sup>Department of Informatics, University of Bergen, P.O. Box 7803, N-5020 Bergen and <sup>3</sup>Computational Biology Unit, Uni Computing, Thormøhlensgate 55, N-5008 Bergen, Norway</aff>
    <author-notes>
      <corresp id="COR1">* To whom correspondence should be addressed.</corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>1</day>
      <month>7</month>
      <year>2011</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>14</day>
      <month>6</month>
      <year>2011</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>14</day>
      <month>6</month>
      <year>2011</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>27</volume>
    <issue>13</issue>
    <fpage>i304</fpage>
    <lpage>i309</lpage>
    <permissions>
      <copyright-statement>© The Author(s) 2011. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2011</copyright-year>
      <license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by-nc/2.5">
        <license-p><!--CREATIVE COMMONS-->This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/2.5">http://creativecommons.org/licenses/by-nc/2.5</ext-link>), which permits unrestricted non-commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Motivation:</bold> 454 pyrosequencing, by Roche Diagnostics, has emerged as an alternative to Sanger sequencing when it comes to read lengths, performance and cost, but shows higher per-base error rates. Although there are several tools available for noise removal, targeting different application fields, data interpretation would benefit from a better understanding of the different error types.</p>
      <p><bold>Results:</bold> By exploring 454 raw data, we quantify to what extent different factors account for sequencing errors. In addition to the well-known homopolymer length inaccuracies, we have identified errors likely to originate from other stages of the sequencing process. We use our findings to extend the flowsim pipeline with functionalities to simulate these errors, and thus enable a more realistic simulation of 454 pyrosequencing data with flowsim.</p>
      <p><bold>Availability:</bold> The flowsim pipeline is freely available under the General Public License from <ext-link ext-link-type="uri" xlink:href="http://biohaskell.org/Applications/FlowSim">http://biohaskell.org/Applications/FlowSim</ext-link>.</p>
      <p>
        <bold>Contact:</bold>
        <email>susanne.balzer@imr.no</email>
      </p>
    </abstract>
    <counts>
      <page-count count="6"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="intro" id="SEC1">
    <title>1 INTRODUCTION</title>
    <p>Second-generation sequencing techniques have revolutionized DNA sequencing. In comparison with Illumina (Solexa/Genome Analyzer) and Applied Biosystems (SOLiD), 454 pyrosequencing stands out with its longer reads (up to ~500 bp). However, higher sequencing error rates compared with traditional Sanger sequencing and the lack of a detailed understanding of error characteristics still hamper the effective utilization of pyrosequencing.</p>
    <p>In <italic>de novo</italic> whole-genome sequencing, high coverage may compensate for erroneous sequences. However, erroneous reads are problematic for SNP detection (<xref ref-type="bibr" rid="B15">Quinlan <italic>et al.</italic>, 2008</xref>) and especially for metagenomics, as they can lead to a considerable overestimation of diversity in a sample (<xref ref-type="bibr" rid="B13">Quince <italic>et al.</italic>, 2009</xref>). Hence, there has been a strong focus on examining the quality of 454 pyrosequencing data and noise removal. Also artificial duplicates are an important issue, because they may lead to incorrect conclusions about the abundance of species and genes (<xref ref-type="bibr" rid="B4">Gomez-Alvarez <italic>et al.</italic>, 2009</xref>).</p>
    <sec id="SEC1.1">
      <title>1.1 The 454 pyrosequencing technology</title>
      <p>The 454 pyrosequencing technology is based on sequencing-by-synthesis which is performed in parallel on around one million beads deposited in wells on a plate. Each bead carries around 10 million molecules resulting from emulsion PCR (emPCR) starting from one single DNA fragment. The sequencing is performed by cyclic flowing (T, A, C, G) of nucleotide reagents over the plate, every bead giving rise to at most one DNA sequence (‘read’). Each flow produces a light signal in each of the beads, either a very weak signal (‘negative flow value’, in practice being between 0 and 0.5, indicating that no base was incorporated) or a stronger signal (‘positive flow value’), proportional to the length of a homopolymer run (<xref ref-type="bibr" rid="B11">Margulies <italic>et al.</italic>, 2005</xref>).</p>
      <p>This chemical process implicates two characteristics that are intrinsic to 454 pyrosequencing data: when the light signal is too strong or too weak, this leads to an over- or under-call for the corresponding nucleotide type. For example, a flow value of 2.48 for nucleotide C gives a homopolymer length of two, while a flow value of 2.52 will give three nucleotides. Apparent substitution errors can occur when an over-call follows an under-call or vice versa. Compared with the called DNA sequence, the underlying flow values thus contain additional information relevant for base calling accuracy and for comparison of reads, which is why analyses often are carried out in ‘flowspace’ as opposed to ‘nucleotide space’.</p>
      <p>The latest 454 pyrosequencing version, GS FLX Titanium (referred to as Titanium in the rest of the paper), uses 200 flow cycles, which corresponds to 800 flows. The results of one sequencing run include the light signal intensity data (‘flow values’) for each well and the base called DNA sequence together with quality information. This is stored in a binary SFF (standard flowgram format) file.</p>
    </sec>
    <sec id="SEC1.2">
      <title>1.2 Duplicate reads</title>
      <p>Earlier studies have revealed that between 4–44% (<xref ref-type="bibr" rid="B12">Niu <italic>et al.</italic>, 2010</xref>) and 11–35% (<xref ref-type="bibr" rid="B4">Gomez-Alvarez <italic>et al.</italic>, 2009</xref>) of sequences in a typical metagenomic dataset are exact or almost-exact duplicates. Both tools 454 Replicate Filter (<xref ref-type="bibr" rid="B4">Gomez-Alvarez <italic>et al.</italic>, 2009</xref>) and cd-hit-454 (<xref ref-type="bibr" rid="B12">Niu <italic>et al.</italic>, 2010</xref>) are based on the CD-HIT clustering algorithm (<xref ref-type="bibr" rid="B10">Li and Godzik, 2006</xref>) and provide a fast way of removing duplicates from pyrosequencing data. While this is a crucial step for the success of metagenomic studies based on 454 pyrosequencing data, we have not observed a comparably high percentage of exact or almost-exact duplicates in shotgun data generated in the context of projects we are involved in.</p>
    </sec>
    <sec id="SEC1.3">
      <title>1.3 Erroneous reads</title>
      <p>There are several factors that account for erroneous base calls or reads, especially inaccuracies in the sequencing chemistry, leading to slightly too high or low flow values, and carry-forward and incomplete extension errors (<xref ref-type="bibr" rid="B11">Margulies <italic>et al.</italic>, 2005</xref>), accumulating over the read, which reflects the stochastic nature of the base incorporation chemistry. Furthermore, it has been shown that a low percentage of reads accounts for a high percentage of errors (<xref ref-type="bibr" rid="B7">Huse <italic>et al.</italic>, 2007</xref>) and that sequencing quality decreases toward the end of a read (<xref ref-type="bibr" rid="B2">Balzer <italic>et al.</italic>, 2010</xref>; <xref ref-type="bibr" rid="B6">Hoff, 2009</xref>). We have earlier described the characteristics of these inaccuracies, calculated the empirical distributions of flow values and included the results in our simulation tool flowsim (<xref ref-type="bibr" rid="B2">Balzer <italic>et al.</italic>, 2010</xref>). However, these models do not adequately explain all the sequencing errors that we have observed, which is reflected in the fact that, when applied to whole-genome shotgun sequencing, our simulator produces data giving better assemblies than does real data (<xref ref-type="sec" rid="SEC3">Section 3</xref>). Here, we report on a more careful examination of other error sources and suggest a new pipeline for a more realistic simulation of 454 pyrosequencing reads. We are not able to establish the exact source of these errors, but hypothesize that a portion of the errors are introduced during PCR library preparation.</p>
    </sec>
    <sec id="SEC1.4">
      <title>1.4 Filtering and trimming</title>
      <p>Some of these error patterns, but not all of them, are addressed by the 454 quality-trimming and read-filtering algorithms. A detailed description is given in the 454 manual (<xref ref-type="bibr" rid="B16">Roche Applied Science, 2008</xref>). However, in some applications, improved results are obtained when applying a stricter quality-filtering and -trimming (compared with 454 default settings) or using additional algorithms and tools. Several research groups have suggested methods for noise removal and quality-trimming, the requirements on data quality obviously varying with respect to applications. Whole-read filtering strategies include the complete removal of: chimeric reads, reads with undetermined bases (i.e. <italic>N</italic>'s) or reads showing a certain percentage of flow values in the interval [0.5, 0.7] (termed ‘dubious flow values’) before reaching a certain flow cycle (<xref ref-type="bibr" rid="B7">Huse <italic>et al.</italic>, 2007</xref>; <xref ref-type="bibr" rid="B9">Kunin <italic>et al.</italic>, 2009</xref>; <xref ref-type="bibr" rid="B14">Quince <italic>et al.</italic>, 2011</xref>). Trimming approaches focus on: a stricter read-trimming based on quality scores, adaptor removal [e.g. with LUCY (<xref ref-type="bibr" rid="B3">Chou and Holmes, 2001</xref>)], but also more sophisticated approaches such as multiple assembly strategies with reads obtained by applying several trimming settings (<ext-link ext-link-type="uri" xlink:href="http://www.genome.ou.edu/informatics.html">http://www.genome.ou.edu/informatics.html</ext-link>).</p>
    </sec>
  </sec>
  <sec id="SEC2">
    <title>2 FACTORS FOR SEQUENCE QUALITY</title>
    <p>In this study, we characterize error patterns derived from Titanium 454 pyrosequencing data and estimate to what extent different error types account for sequencing errors.</p>
    <sec id="SEC2.1">
      <title>2.1 Adaptors</title>
      <p>Sequences are limited in length by the number of flow cycles. Ideally, clones should be sufficiently long so that the end of the clone is not reached during sequencing, which means that also the adaptor is not reached. If the clone is shorter, the adaptor sequence will be included at the end of the read. This part of the sequence should be masked by the Roche analysis pipeline. However, the trimming procedure sometimes fails if only part of the adaptor is contained in the read or if there are sequencing errors in the adaptor sequence. We have observed both cases in shotgun data from different genomes.</p>
      <p>In genome assembly, residual adaptors can block contig extension at the end of reads, especially in lower coverage regions and when working with assemblers that do not use a broad overlap window.</p>
    </sec>
    <sec id="SEC2.2">
      <title>2.2 Pyrosequencing errors</title>
      <p>The light signal strength from the chemical reaction in the sequencing process is the basis for correct determination of homopolymer lengths and hence responsible for data accuracy. Slightly too high or too low signal strengths can lead to over- or under-calls.</p>
      <p>Carry-forward errors occur when the flushing between the flows is not sufficient and leftover nucleotides are present in a well. Also the incomplete extension of a template due to insufficient nucleotides within a flow can cause a read to get out-of-sync. These errors are collectively referred to as CAFIE. The Roche software adjusts the flow values in an attempt to correct for these errors, and both the flow values and the DNA data in the SFF file correspond to the corrected data (Roger Winer, Roche Diagnostics, personal communication).</p>
    </sec>
    <sec id="SEC2.3">
      <title>2.3 Putative PCR errors</title>
      <p>In a previous work, we derived empirical distributions from <italic>Dicentrarchus labrax</italic> (sea bass) Titanium data: by mapping 454 data to the originating reference genome (<xref ref-type="bibr" rid="B8">Kuhl <italic>et al.</italic>, 2010</xref>), we characterized the distributions of flow values belonging to each homopolymer length (<xref ref-type="bibr" rid="B2">Balzer <italic>et al.</italic>, 2010</xref>). These flow value distributions, one distribution per homopolymer length, overlap, causing over- and under-calls (<xref ref-type="fig" rid="F1">Fig. 1</xref>). By examining them in detail, an interesting and hitherto unexplained pattern emerges: the flow value distributions often contain one major peak around the integral value representing the correct homopolymer length, but then also smaller peaks around the neighboring integral values (<xref ref-type="fig" rid="F1">Figs 1</xref> and <xref ref-type="fig" rid="F3">3</xref>). Although these neighboring peaks have been observed previously, we have not seen any convincing explanation for them. Hypothesizing that they are caused by errors in the emulsion PCR performed prior to sequencing, we make an attempt to estimate to what extent PCR errors contribute to the overall error rate.
<fig id="F1" position="float"><label>Fig. 1.</label><caption><p>Empirical flow values distributions (<italic>D.labrax</italic>) and derived intervals.</p></caption><graphic xlink:href="btr251f1"/></fig>
<fig id="F2" position="float"><label>Fig. 2.</label><caption><p>Bins for homopolymer lengths 0, 1 and 2, based on different flow value interval sizes from <xref ref-type="table" rid="T1">Table 1</xref>.</p></caption><graphic xlink:href="btr251f2"/></fig>
<fig id="F3" position="float"><label>Fig. 3.</label><caption><p>Flow value histograms for <italic>G.morhua</italic> mate-pair reads (forward matches, <italic>N</italic>=7 016 764). The <italic>y</italic>-axis is on a log10 scale. The 15 flow cycles correspond to the 42 positions of the linker sequence. The gray areas contain correct base calls. Subpeaks point toward putative PCR errors.</p></caption><graphic xlink:href="btr251f3"/></fig>
<table-wrap id="T1" position="float"><label>Table 1.</label><caption><p>Flow value intervals from empirical distributions (<italic>D.labrax</italic>)</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th align="left" rowspan="1" colspan="1">Size (%)</th><th align="left" rowspan="1" colspan="1">0-distribution</th><th align="left" rowspan="1" colspan="1">1-distribution</th><th align="left" rowspan="1" colspan="1">2-distribution</th><th align="left" rowspan="1" colspan="1">3-distribution</th></tr></thead><tbody align="left"><tr><td align="left" rowspan="1" colspan="1">5</td><td align="left" rowspan="1" colspan="1">[0.00, 0.02]</td><td align="left" rowspan="1" colspan="1">[1.01, 1.02]</td><td align="left" rowspan="1" colspan="1">[2.00, 2.02]</td><td align="left" rowspan="1" colspan="1">[3.01, 3.03]</td></tr><tr><td align="left" rowspan="1" colspan="1">10</td><td align="left" rowspan="1" colspan="1">[0.00, 0.04]</td><td align="left" rowspan="1" colspan="1">[1.01, 1.03]</td><td align="left" rowspan="1" colspan="1">[2.00, 2.03]</td><td align="left" rowspan="1" colspan="1">[3.00, 3.04]</td></tr><tr><td align="left" rowspan="1" colspan="1">25</td><td align="left" rowspan="1" colspan="1">[0.00, 0.07]</td><td align="left" rowspan="1" colspan="1">[1.00, 1.04]</td><td align="left" rowspan="1" colspan="1">[1.97, 2.05]</td><td align="left" rowspan="1" colspan="1">[2.97, 3.07]</td></tr><tr><td align="left" rowspan="1" colspan="1">50</td><td align="left" rowspan="1" colspan="1">[0.00, 0.11]</td><td align="left" rowspan="1" colspan="1">[0.96, 1.07]</td><td align="left" rowspan="1" colspan="1">[1.93, 2.09]</td><td align="left" rowspan="1" colspan="1">[2.90, 3.12]</td></tr><tr><td align="left" rowspan="1" colspan="1">75</td><td align="left" rowspan="1" colspan="1">[0.00, 0.14]</td><td align="left" rowspan="1" colspan="1">[0.92, 1.12]</td><td align="left" rowspan="1" colspan="1">[1.86, 2.16]</td><td align="left" rowspan="1" colspan="1">[2.81, 3.20]</td></tr><tr><td align="left" rowspan="1" colspan="1">90</td><td align="left" rowspan="1" colspan="1">[0.00, 0.18]</td><td align="left" rowspan="1" colspan="1">[0.86, 1.18]</td><td align="left" rowspan="1" colspan="1">[1.78, 2.24]</td><td align="left" rowspan="1" colspan="1">[2.69, 3.30]</td></tr><tr><td align="left" rowspan="1" colspan="1">95</td><td align="left" rowspan="1" colspan="1">[0.00, 0.22]</td><td align="left" rowspan="1" colspan="1">[0.81, 1.23]</td><td align="left" rowspan="1" colspan="1">[1.72, 2.31]</td><td align="left" rowspan="1" colspan="1">[2.61, 3.39]</td></tr></tbody></table></table-wrap></p>
      <p>In order to quantify and compare the number of errors caused by overlapping distributions with the errors in neighboring peaks, we classified flow values according to narrow intervals around the integral values. Based on the empirical unsmoothed flow value distributions from <italic>D.labrax</italic> (<xref ref-type="bibr" rid="B2">Balzer <italic>et al.</italic>, 2010</xref>), the intervals were constructed so that they would contain a certain percentage (the middle part) of flow values for each homopolymer length. The intervals are slightly asymmetric (<xref ref-type="table" rid="T1">Table 1</xref>), which corresponds to earlier observations that insertion errors are more common than deletions (<xref ref-type="bibr" rid="B7">Huse <italic>et al.</italic>, 2007</xref>; <xref ref-type="bibr" rid="B15">Quinlan <italic>et al.</italic>, 2008</xref>). For flow values of the 0-distribution (assumed not to correspond to incorporation of a nucleotide, i.e. negative flow values), the interval extends to one side only.</p>
      <p>We constructed several series of intervals, containing from 5% (conservative) to 95% (liberal) of the flow values (<xref ref-type="table" rid="T1">Table 1</xref> and <xref ref-type="fig" rid="F1">Fig. 1</xref>). In order to decompose the distribution of flow values observed for homopolymers of length <italic>n</italic>, we assigned each associated flow value to one of several bins. First, flow values that would give a correct homopolymer length call (values between <italic>n</italic> −0.5 and <italic>n</italic>+0.49) were assigned into bin 3. Then, values that were likely to be associated with a neighboring peak at <italic>n</italic> −1 or <italic>n</italic>+1 (subpeaks in <xref ref-type="fig" rid="F1">Figs 1</xref> and <xref ref-type="fig" rid="F3">3</xref>) were assigned to bins 1 and 5, respectively (using the values from <xref ref-type="table" rid="T1">Table 1</xref> as threshold values). Intermediate values were assigned into bins 2 and 4, while values outside the ranges of bins 1 and 5 were discarded (extreme under- or over-calls).</p>
      <p>As an example, when considering a homopolymer of length 2, we would define our bins as follows (using the rather conservative 25% intervals, see <xref ref-type="table" rid="T1">Table 1</xref> and <xref ref-type="fig" rid="F2">Fig. 2</xref>): bin 3 contains correct base calls and is thus predefined as [1.5, 2.49]. All flow values that do not fall into this bin are counted as erroneous. Of all flow values in the range [0.5, 1.49], 25% are in [1.0, 1.04]. This interval thus defines bin 1 for homopolymer length 2. Flow values in this bin are assumed to originate from the 1-distribution and are thus—by our hypothesis—likely to be caused by PCR errors. Bin 5 is accordingly defined as [2.97, 3.07] and corresponds to PCR errors giving a triple homopolymer.</p>
      <p>Furthermore, flow values that lie beyond bin 1 or 5 are counted as extreme miscalls of unknown origin (‘extreme errors’, see <xref ref-type="table" rid="T2">Table 2</xref>).
<table-wrap id="T2" position="float"><label>Table 2.</label><caption><p>Estimated fraction of error types in percentage of overall errors</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th align="left" rowspan="1" colspan="1">Size (%)</th><th align="left" rowspan="1" colspan="1">Pyrosequencing errors (%)</th><th align="left" rowspan="1" colspan="1">Putative PCR errors (%)</th><th align="left" rowspan="1" colspan="1">Extreme errors (%)</th></tr></thead><tbody align="left"><tr><td align="left" rowspan="1" colspan="1">5</td><td align="left" rowspan="1" colspan="1">80.18</td><td align="left" rowspan="1" colspan="1">3.97</td><td align="left" rowspan="1" colspan="1">15.85</td></tr><tr><td align="left" rowspan="1" colspan="1">10</td><td align="left" rowspan="1" colspan="1">79.28</td><td align="left" rowspan="1" colspan="1">5.78</td><td align="left" rowspan="1" colspan="1">14.94</td></tr><tr><td align="left" rowspan="1" colspan="1">25</td><td align="left" rowspan="1" colspan="1">75.69</td><td align="left" rowspan="1" colspan="1">11.17</td><td align="left" rowspan="1" colspan="1">13.14</td></tr><tr><td align="left" rowspan="1" colspan="1">50</td><td align="left" rowspan="1" colspan="1">67.15</td><td align="left" rowspan="1" colspan="1">24.65</td><td align="left" rowspan="1" colspan="1">8.20</td></tr><tr><td align="left" rowspan="1" colspan="1">75</td><td align="left" rowspan="1" colspan="1">59.18</td><td align="left" rowspan="1" colspan="1">36.89</td><td align="left" rowspan="1" colspan="1">3.93</td></tr><tr><td align="left" rowspan="1" colspan="1">90</td><td align="left" rowspan="1" colspan="1">51.62</td><td align="left" rowspan="1" colspan="1">47.02</td><td align="left" rowspan="1" colspan="1">1.36</td></tr><tr><td align="left" rowspan="1" colspan="1">95</td><td align="left" rowspan="1" colspan="1">46.63</td><td align="left" rowspan="1" colspan="1">52.77</td><td align="left" rowspan="1" colspan="1">0.60</td></tr></tbody></table></table-wrap></p>
      <p>For each flow value together with the correct homopolymer length, we can now determine into which bin it falls. From the absolute counts, we can then for any sequence or set of sequences calculate the fraction of ‘putative PCR errors’ (<xref ref-type="table" rid="T2">Table 2</xref>), which is the sum of errors falling into bins 1 and 5 divided by the total number of erroneous base calls.</p>
      <p>We used BLASTN (<xref ref-type="bibr" rid="B1">Altschul <italic>et al.</italic>, 1990</xref>) to map 21 mate-pair runs from <italic>Gadus morhua</italic> (Atlantic cod) against the known mate-pair linker sequence (TCGTATAACTTCGTATAATGTATGCTATAC GAAGTTATTACG) and its reverse complement, assigning each flow value to the corresponding true homopolymer length as known from the linker sequence. This gave us a total of 17 834 274 reads, where 16 836 422 matched the linker sequence or its reverse complement (47% each) when a bit score cutoff of 67 was used. The 997 833 (6%) reads did not or not uniquely match either the linker or its reverse complement.</p>
      <p>Further, we discarded 17% of the remaining reads because they had lost synchronism (<xref ref-type="sec" rid="SEC2.2">Section 2.2</xref>) or were implausible, or did not match the linker over the whole length of 42 bp, which left us with a total of 14 050 646 complete matches.</p>
      <p>From those reads, we examined the flow values for each of the 60 flows (15 flow cycles; 18 positions with negative flow values not leading to a base call; flows 1 and 60 were not counted in error calculations since they could be part of longer homopolymers) that were needed to sequence the 42 bp of the linker (<xref ref-type="fig" rid="F3">Fig. 3</xref>). We assigned each flow value to one of the bins described above. From the total number of errors in each bin, we could calculate the percentage in relation to all observed errors (<xref ref-type="table" rid="T2">Table 2</xref>). In total, we observed a per-flow error rate of 0.153% (including negative flows), which is believed to underestimate the true error rate, first because we have filtered out bad alignments prior to our analysis, and also because the linker sequence only contains 1- and 2mers, and longer homopolymer runs are more likely to contain errors than shorter ones.</p>
      <p>Even when using the conservative estimates, we get a fraction of 4–25% putative PCR errors in relation to all errors (<xref ref-type="table" rid="T2">Table 2</xref>).</p>
      <p>This corroborates our theory that PCR errors might be an important error source in pyrosequencing. Notably, the fraction of PCR errors decreases with respect to the corresponding flow cycle in a read (<xref ref-type="fig" rid="F4">Fig. 4</xref>).
<fig id="F4" position="float"><label>Fig. 4.</label><caption><p>Putative PCR and pyrosequencing error rates with respect to flow cycles (for underlying flow value intervals of size 5 and 95%).</p></caption><graphic xlink:href="btr251f4"/></fig></p>
    </sec>
  </sec>
  <sec id="SEC3">
    <title>3 SIMULATING PYROSEQUENCING DATA</title>
    <p>We have in our previous work (<xref ref-type="bibr" rid="B2">Balzer <italic>et al.</italic>, 2010</xref>) presented flowsim, a simulation tool for 454 pyrosequencing data that uses empirical distributions of flow values to accurately model the pyrosequencing results and that provides the simulated data as SFF files.</p>
    <sec id="SEC3.1">
      <title>3.1 The flowsim simulation pipeline</title>
      <p>In order to extend flowsim and to take into account the various error types described above, the software is now split into several independent tools, each tool modeling a separate stage in the sequencing process.</p>
      <p>The flowsim pipeline currently comprises the following utilities:
<list list-type="bullet"><list-item><p>clonesim, which simulates shearing of an input genome according to a user-specified distribution of clone lengths.</p></list-item><list-item><p>gelfilter, which selects a subset of input clones according to a minimum and a maximum clone size.</p></list-item><list-item><p>duplicator, which introduces artificial duplicates of clones.</p></list-item><list-item><p>cr&gt;kitsim, which attaches the end of the A-adaptor (which consists of the four letter ‘key’ at the beginning of reads, typically TCAG), and the B-adaptor.</p></list-item><list-item><p>cr&gt;mutator, which mutates the input sequences with random insertions, deletions and substitutions at user-specified rates.</p></list-item><list-item><p>cr&gt;flowsim, which simulates pyrosequencing of a set of input sequences, calculates quality scores, filters and quality-trims the reads, and outputs the resulting SFF file.</p></list-item></list></p>
      <p>With the exception of flowsim which outputs an SFF file, all utilities work with Fasta sequences as input and output, and by default read from standard input and write to standard output. Thus, a simple command for creating 100 000 reads from an input genome, using default parameters, would be:
<disp-quote><p>‘clonesim -c 100000 input.fasta | kitsim | flowsim -o out.sff’.</p></disp-quote></p>
      <p>The separation into multiple programs provides more flexibility, and it is easy for users to implement and apply additional tools. For instance, a user could simulate amplicon sequencing by replacing clonesim with a program that simulates amplicons, and use the remaining flowsim pipeline to simulate the 454 sequencing process. Similarly, mate-pair libraries can be simulated by interposing a program that simulates circularization and fragmentation.</p>
    </sec>
    <sec id="SEC3.2">
      <title>3.2 Simulation results</title>
      <p>For simulation, we used a 764 Mb genomic scaffold from sea bass (<italic>D.labrax</italic>) generated from Sanger sequencing (<xref ref-type="bibr" rid="B8">Kuhl <italic>et al.</italic>, 2010</xref>), where we also had available approximately 30× coverage 454 shotgun reads for comparison.</p>
      <p>We used flowsim to simulate a high number of reads corresponding to 10× coverage, providing sufficient clone lengths for 800 flows (Titanium), using empirical distributions as flow model and quality degradation along the sequence, but only taking into account homopolymer length errors arising from the flow value distributions (i.e. we did not make use of kitsim or mutator). We assembled our simulated reads using Newbler beta version 2.5 (provided by Roche Diagnostics) and compared the assembly results, namely contig sizes, with the assembly of randomly chosen real <italic>D.labrax</italic> Titanium reads corresponding to equal coverage. Our assemblies of simulated reads were substantially better than those of real data in terms of contig sizes.</p>
      <p>When carrying out earlier simulations from <italic>Escherichia coli</italic> (<xref ref-type="bibr" rid="B2">Balzer <italic>et al.</italic>, 2010</xref>), we assumed strain-specific differences to be responsible for discrepancies between the assembly of real shotgun data and that of simulated data. Since we are now comparing reads that we simulated from the <italic>D.labrax</italic> reference scaffold with shotgun reads from the same individual, we can exclude this factor. Examining the simulation accuracy of flowsim, we identified the following factors to be potentially relevant for our assemblies having better statistics than the assemblies of real reads: coverage (average overall coverage, coverage distribution, zero-coverage regions), adaptors, putative PCR errors, pyrosequencing errors. Other errors, such as multiple DNA fragments associated with one bead, are likely to have been eliminated by the Roche quality-filtering.</p>
      <p>In <xref ref-type="sec" rid="SEC2">Section 2</xref>, we have examined each of these sources of variability and can make use of the updated flowsim pipeline described above for further simulations.</p>
      <p>After having added errors to the same simulated clones that we used in earlier assemblies, i.e. first attaching adaptor sequences and subsequently introducing PCR noise at rates comparable with those found in real shotgun data, we ran flowsim and performed a new assembly of our simulated reads. It still outperforms an assembly of real reads, but assembly statistics like contig sizes and the percentage of aligned reads and bases are closer to the assembly of real reads when simulating additional error sources. We will also more closely examine to what extent the real pyrosequencing <italic>D.labrax</italic> data contain heterozygosity (coming from a diploid fish) and how a similar effect can be introduced into the simulated reads.</p>
      <p>While the current version of our simulator uses a uniform coverage distribution over the input genome, we assume that this approach is not sufficiently realistic. Typically, there is greater than a 100-fold variation in coverage (<xref ref-type="bibr" rid="B5">Harismendy <italic>et al.</italic>, 2009</xref>). This is in agreement with our data, finding per-base coverage up to 760 in <italic>D.labrax</italic> (average 33) and 1152 in <italic>E.coli</italic> (average 110).</p>
      <p>Using cd-hit-454 (<xref ref-type="bibr" rid="B12">Niu <italic>et al.</italic>, 2010</xref>), we observed duplicate read rates between 2.73 and 19.13% for <italic>D.labrax</italic> and between 0.19 and 10.71% for <italic>E.coli</italic>, with 98–100% sequence identity, while—as expected—our simulated reads (<italic>D.labrax</italic>, 10−30× coverage) only contained very few (0.01%) duplicates or almost-duplicates.</p>
    </sec>
  </sec>
  <sec sec-type="discussion" id="SEC4">
    <title>4 DISCUSSION AND CONCLUSIONS</title>
    <p>In this study, we have explored different error sources of 454 pyrosequencing. Previously, light signal distributions from the pyrosequencing chemistry and carry-forward/incomplete extension have been seen as the major sources of noise. Neighboring peaks in flow value distributions, observed in earlier analyses when aligning reads to a reference, were believed to arise from biological differences between reads and reference, but by matching reads against a known mate-pair linker sequence and only using these short alignments for our analyses, we eliminate this source of error. We speculate that, beside pyrosequencing errors due to inaccuracies in the sequencing process, also errors from the PCR library preparation step could account for a high percentage of observed errors. Hence, we present an empirical approach to support our assumptions, based on the presence of strong neighboring peaks in the distributions of flow values that correspond to the linker sequence. We see a clear decrease in the proportion of errors assigned to neighboring peaks as we move towards the end of the read, which is most likely due to the increase in pyrosequencing errors caused by widening flow value distributions. This implies that neighboring peak errors occur at an approximately constant rate along the read.</p>
    <p>Furthermore, it is difficult to see how the neighboring peaks could arise from known error sources. Random noise in flow values should result in distributions similar to Gaussian, and we see no reason for CAFIE errors to concentrate around integral values. Thus, we believe that the neighboring peaks are caused by real differences in the library clones, but we cannot currently suggest an explanation on how these arise.</p>
    <p>Finally, our new additions to the simulation pipeline enable us to simulate many of the identified errors, and we see that the resulting assemblies are approaching those obtained from real data. Nevertheless, we are examining further factors that we believe to be relevant in read simulation and quality assessment.</p>
  </sec>
</body>
<back>
  <ack>
    <title>ACKNOWLEDGEMENTS</title>
    <p>The authors wish to thank Dr Richard Reinhardt, Max Planck Institute for Molecular Genetics, Berlin, and Dr Kjetill Jakobsen, University of Oslo, and the Cod Genome Project team for kindly providing us with Titanium raw data. We also would like to acknowledge Anders Lanzén, University of Bergen, Dr Niina Haiminen, IBM T.J. Watson Research Center, Dr Christopher Quince, University of Glasgow and Markus Grohme, TH Wildau, for the fruitful discussions and assistance in analyses.</p>
    <p><italic>Funding</italic>: <funding-source>National Program for Research in Functional Genomics in Norway (FUGE)</funding-source> in the Research Council of Norway.</p>
    <p><italic>Conflict of Interest:</italic> none declared.</p>
  </ack>
  <ref-list>
    <title>REFERENCES</title>
    <ref id="B1">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Altschul</surname>
            <given-names>S.F.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Basic local alignment search tool</article-title>
        <source>J. Mol. Biol.</source>
        <year>1990</year>
        <volume>215</volume>
        <fpage>403</fpage>
        <lpage>410</lpage>
        <pub-id pub-id-type="pmid">2231712</pub-id>
      </element-citation>
    </ref>
    <ref id="B2">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Balzer</surname>
            <given-names>S.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Characteristics of 454 pyrosequencing data–enabling realistic simulation with flowsim</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>i420</fpage>
        <lpage>i425</lpage>
        <pub-id pub-id-type="pmid">20823302</pub-id>
      </element-citation>
    </ref>
    <ref id="B3">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chou</surname>
            <given-names>H.H.</given-names>
          </name>
          <name>
            <surname>Holmes</surname>
            <given-names>M.H.</given-names>
          </name>
        </person-group>
        <article-title>DNA sequence quality trimming and vector removal</article-title>
        <source>Bioinformatics</source>
        <year>2001</year>
        <volume>17</volume>
        <fpage>1093</fpage>
        <lpage>1104</lpage>
        <pub-id pub-id-type="pmid">11751217</pub-id>
      </element-citation>
    </ref>
    <ref id="B4">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gomez-Alvarez</surname>
            <given-names>V.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Systematic artifacts in metagenomes from complex microbial communities</article-title>
        <source>ISME J.</source>
        <year>2009</year>
        <volume>3</volume>
        <fpage>1314</fpage>
        <lpage>1317</lpage>
        <pub-id pub-id-type="pmid">19587772</pub-id>
      </element-citation>
    </ref>
    <ref id="B5">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Harismendy</surname>
            <given-names>O.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Evaluation of next generation sequencing platforms for population targeted sequencing studies</article-title>
        <source>Genome Biol.</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>R32</fpage>
        <pub-id pub-id-type="pmid">19327155</pub-id>
      </element-citation>
    </ref>
    <ref id="B6">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hoff</surname>
            <given-names>K.J.</given-names>
          </name>
        </person-group>
        <article-title>The effect of sequencing errors on metagenomic gene prediction</article-title>
        <source>BMC Genomics</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>520</fpage>
        <pub-id pub-id-type="pmid">19909532</pub-id>
      </element-citation>
    </ref>
    <ref id="B7">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huse</surname>
            <given-names>S.M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Accuracy and quality of massively parallel DNA pyrosequencing</article-title>
        <source>Genome Biol.</source>
        <year>2007</year>
        <volume>8</volume>
        <fpage>R143</fpage>
        <pub-id pub-id-type="pmid">17659080</pub-id>
      </element-citation>
    </ref>
    <ref id="B8">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kuhl</surname>
            <given-names>H.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The European sea bass Dicentrarchus labrax genome puzzle: comparative BAC-mapping and low coverage shotgun sequencing</article-title>
        <source>BMC Genomics</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>68</fpage>
        <pub-id pub-id-type="pmid">20105308</pub-id>
      </element-citation>
    </ref>
    <ref id="B9">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kunin</surname>
            <given-names>V.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Wrinkles in the rare biosphere: pyrosequencing errors can lead to artificial inflation of diversity estimates</article-title>
        <source>Environ. Microbiol.</source>
        <year>2009</year>
        <volume>12</volume>
        <fpage>118</fpage>
        <lpage>123</lpage>
        <pub-id pub-id-type="pmid">19725865</pub-id>
      </element-citation>
    </ref>
    <ref id="B10">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>W.</given-names>
          </name>
          <name>
            <surname>Godzik</surname>
            <given-names>A.</given-names>
          </name>
        </person-group>
        <article-title>Cd-hit: a fast program for clustering and comparing large sets of protein or nucleotide sequences</article-title>
        <source>Bioinformatics</source>
        <year>2006</year>
        <volume>22</volume>
        <fpage>1658</fpage>
        <lpage>1659</lpage>
        <pub-id pub-id-type="pmid">16731699</pub-id>
      </element-citation>
    </ref>
    <ref id="B11">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Margulies</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genome sequencing in microfabricated high-density picolitre reactors</article-title>
        <source>Nature</source>
        <year>2005</year>
        <volume>437</volume>
        <fpage>376</fpage>
        <lpage>380</lpage>
        <pub-id pub-id-type="pmid">16056220</pub-id>
      </element-citation>
    </ref>
    <ref id="B12">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Niu</surname>
            <given-names>B.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Artificial and natural duplicates in pyrosequencing reads of metagenomic data</article-title>
        <source>BMC Bioinformatics</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>187</fpage>
        <pub-id pub-id-type="pmid">20388221</pub-id>
      </element-citation>
    </ref>
    <ref id="B13">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Quince</surname>
            <given-names>C.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Accurate determination of microbial diversity from 454 pyrosequencing data</article-title>
        <source>Nat. Methods</source>
        <year>2009</year>
        <volume>6</volume>
        <fpage>639</fpage>
        <lpage>641</lpage>
        <pub-id pub-id-type="pmid">19668203</pub-id>
      </element-citation>
    </ref>
    <ref id="B14">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Quince</surname>
            <given-names>C.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Removing noise from pyrosequenced amplicons</article-title>
        <source>BMC Bioinformatics</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>38</fpage>
        <pub-id pub-id-type="pmid">21276213</pub-id>
      </element-citation>
    </ref>
    <ref id="B15">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Quinlan</surname>
            <given-names>A.R.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Pyrobayes: an improved base caller for SNP discovery in pyrosequences</article-title>
        <source>Nat. Methods</source>
        <year>2008</year>
        <volume>5</volume>
        <fpage>179</fpage>
        <lpage>181</lpage>
        <pub-id pub-id-type="pmid">18193056</pub-id>
      </element-citation>
    </ref>
    <ref id="B16">
      <element-citation publication-type="other">
        <comment>Roche Applied Science (2008) Genome Sequencer Data Analysis Software Manual, Software Version 2.0.00, Roche Diagnostics GmbH.</comment>
      </element-citation>
    </ref>
  </ref-list>
</back>
