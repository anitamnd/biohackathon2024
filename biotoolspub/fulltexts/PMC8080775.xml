<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Sci Rep</journal-id>
    <journal-id journal-id-type="iso-abbrev">Sci Rep</journal-id>
    <journal-title-group>
      <journal-title>Scientific Reports</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2045-2322</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8080775</article-id>
    <article-id pub-id-type="pmid">33911090</article-id>
    <article-id pub-id-type="publisher-id">87402</article-id>
    <article-id pub-id-type="doi">10.1038/s41598-021-87402-9</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>COSMAS: a lightweight toolbox for cardiac optical mapping analysis</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Tomek</surname>
          <given-names>Jakub</given-names>
        </name>
        <address>
          <email>jakub.tomek.mff@gmail.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wang</surname>
          <given-names>Zhinuo Jenny</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Burton</surname>
          <given-names>Rebecca-Ann Beatrice</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Herring</surname>
          <given-names>Neil</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bub</surname>
          <given-names>Gil</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.4991.5</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8948</institution-id><institution>Department of Physiology, Anatomy, and Genetics, </institution><institution>University of Oxford, </institution></institution-wrap>Oxford, UK </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.4991.5</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8948</institution-id><institution>Department of Computer Science, </institution><institution>University of Oxford, </institution></institution-wrap>Oxford, UK </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.4991.5</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8948</institution-id><institution>Department of Pharmacology, </institution><institution>University of Oxford, </institution></institution-wrap>Oxford, UK </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.14709.3b</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8649</institution-id><institution>Department of Physiology, </institution><institution>McGill University, </institution></institution-wrap>Montréal, Canada </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>28</day>
      <month>4</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>28</day>
      <month>4</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2021</year>
    </pub-date>
    <volume>11</volume>
    <elocation-id>9147</elocation-id>
    <history>
      <date date-type="received">
        <day>18</day>
        <month>1</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>22</day>
        <month>3</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2021</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Optical mapping is widely used in experimental cardiology, as it allows visualization of cardiac membrane potential and calcium transients. However, optical mapping measurements from a single heart or cell culture can produce several gigabytes of data, warranting automated computer analysis. Here we present COSMAS, a software toolkit for automated analysis of optical mapping recordings in cardiac preparations. COSMAS generates activation and conduction velocity maps, as well as visualizations of action potential and calcium transient duration, S1-S2 protocol analysis, and alternans mapping. The software is built around our recent ‘comb’ algorithm for segmentation of action potentials and calcium transients, offering excellent performance and high resistance to noise. A core feature of our software is that it is based on scripting as opposed to relying on a graphical user interface for user input. The central role of scripts in the analysis pipeline enables batch processing and promotes reproducibility and transparency in the interpretation of large cardiac data sets. Finally, the code is designed to be easily extended, allowing researchers to add functionality if needed. COSMAS is provided in two languages, Matlab and Python, and is distributed with a user guide and sample scripts, so that accessibility to researchers is maximized.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Data processing</kwd>
      <kwd>Image processing</kwd>
      <kwd>Software</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100010269</institution-id>
            <institution>Wellcome Trust</institution>
          </institution-wrap>
        </funding-source>
        <award-id>214290/Z/18/Z</award-id>
        <award-id>Sir Henry Dale Fellowship</award-id>
        <principal-award-recipient>
          <name>
            <surname>Wang</surname>
            <given-names>Zhinuo Jenny</given-names>
          </name>
          <name>
            <surname>Burton</surname>
            <given-names>Rebecca-Ann Beatrice</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Medical sciences Division, University of Oxford</institution>
        </funding-source>
        <award-id>The Returning Carers’ Fund</award-id>
        <principal-award-recipient>
          <name>
            <surname>Burton</surname>
            <given-names>Rebecca-Ann Beatrice</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000274</institution-id>
            <institution>British Heart Foundation</institution>
          </institution-wrap>
        </funding-source>
        <award-id>PG/18/4/33521</award-id>
        <award-id>FS/SCRF/20/32005</award-id>
        <principal-award-recipient>
          <name>
            <surname>Burton</surname>
            <given-names>Rebecca-Ann Beatrice</given-names>
          </name>
          <name>
            <surname>Herring</surname>
            <given-names>Neil</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Royal Society, United Kingdom</institution>
        </funding-source>
        <award-id>109371/Z/15/Z</award-id>
        <principal-award-recipient>
          <name>
            <surname>Burton</surname>
            <given-names>Rebecca-Ann Beatrice</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100005617</institution-id>
            <institution>BHF Centre of Research Excellence, Oxford</institution>
          </institution-wrap>
        </funding-source>
        <award-id>RE/08/004</award-id>
        <principal-award-recipient>
          <name>
            <surname>Herring</surname>
            <given-names>Neil</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Canadian Heart and Stroke Foundation</institution>
        </funding-source>
        <award-id>HSFC G-18-0022123</award-id>
        <principal-award-recipient>
          <name>
            <surname>Bub</surname>
            <given-names>Gil</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000038</institution-id>
            <institution>Natural Sciences and Engineering Research Council of Canada</institution>
          </institution-wrap>
        </funding-source>
        <award-id>RGPIN-2018-05346</award-id>
        <principal-award-recipient>
          <name>
            <surname>Bub</surname>
            <given-names>Gil</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2021</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Introduction</title>
    <p id="Par2">Optical mapping of explanted hearts or cell cultures is an integral part of experimental cardiac research, allowing detailed observation of action potentials (AP) and calcium transients (CaT) in cardiac preparations<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR3">3</xref></sup>. It contributed to our understanding of arrhythmogenesis with regards to, e.g. reentrant spiral activation<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, autonomic modulation<sup><xref ref-type="bibr" rid="CR5">5</xref>,<xref ref-type="bibr" rid="CR6">6</xref></sup>, post-infarction conduction abnormalities<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>, cardiac alternans<sup><xref ref-type="bibr" rid="CR8">8</xref>,<xref ref-type="bibr" rid="CR9">9</xref></sup>, and reentry following acute myocardial infarction<sup><xref ref-type="bibr" rid="CR10">10</xref></sup>. While optical mapping offers excellent spatial resolution of the recordings compared to electrophysiological techniques such as monophasic AP mapping or electrode arrays, the hundreds to thousands of signal traces produced in a single optical mapping recording generally require automated computer-based processing.
</p>
    <p id="Par3">Despite the widespread use of optical mapping techniques in cardiac research, there are surprisingly few standardized tools for their analysis. Both available software packages, Rhythm<sup><xref ref-type="bibr" rid="CR11">11</xref></sup> and the recently published ElectroMap<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR13">13</xref></sup> are relatively complex, generally require a large amount of parameters to be set, and are controlled via sophisticated graphical user interface (GUI). A major advantage of GUI-controlled software is that even a person with no programming or data analysis background can use it to analyze data. On the other hand, GUI based software greatly limits its use in a wide variety of scenarios, such as headless operation—i.e. running remotely on a server, cluster or cloud without a GUI. Indeed, the need for flexible batch processing was one of the motivations for rewriting ImageJ<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>. In the specific context of cardiac data analysis, the GUI approach presents multiple limitations. First, it exposes the user to a wide range of functionality, boxes for setting of a wide array of parameters, and method selectors, many of which may be irrelevant for a particular task the user tries to do. This may be overwhelming particularly for the users with low data analysis experience, for whom it may be difficult to identify and select appropriate methods and parameters. Second, the software architecture of GUI tools is often dictated by the GUI handling code, which makes it hard to extend or modify them when the pre-built functionality is insufficient. Ultimately, Rhythm and ElectroMap require separate processing for each recording analyzed, not supporting batch mode processing. This can work well for analyzing a small number of files (especially with ElectroMap’s helpful option to store and load a set of processing parameters) but can quickly become a bottleneck for a larger-scale analysis. Optical mapping can easily produce hundreds of recordings in a single sequence of experiments, and manually loading, processing, and storing the results using a GUI is rather time-consuming. This is particularly true when one realizes, midway in the analysis, that the processing parameters need to be changed, and the whole process needs to be started over.</p>
    <p id="Par4">In this article, we present a new software toolkit COSMAS (COmb-based Software for optical-Mapping AnalysiS) for analysis of cardiac optical mapping data, such as from Langendorff hearts or in vitro cardiac cell cultures. It is built around the comb algorithm for detection of APs or CaTs in recordings with known activation rate (e.g. under external pacing or regular sinus rhythm)<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>, offering a high quality of processing in a range of common tasks arising in optical mapping of membrane potential or calcium. This includes activation mapping, conduction velocity extraction, mapping of AP and CaT duration, S1-S2 protocols, and processing of duration and amplitude alternans. COSMAS is designed to be used via straightforward scripting, avoiding the complexity of GUI, being simple (633 lines of code versus 9115 of ElectroMap, excluding comments, empty lines, and external libraries), and naturally supporting batch processing.</p>
    <p id="Par5">Two functionally identical versions of COSMAS are provided, one implemented in MATLAB, and one in Python 3, giving the user choice of  which language to use. This is in contrast with Rhythm and ElectroMap, which both require MATLAB (ElectroMap can be run as a stand-alone, but it cannot be adjusted in this form).</p>
  </sec>
  <sec id="Sec2">
    <title>Methods</title>
    <p id="Par6">The general structure of analysis using COSMAS is given in Fig. <xref rid="Fig1" ref-type="fig">1</xref>A. A concrete sample script computing and plotting a map of average activation pattern is shown in Fig. <xref rid="Fig1" ref-type="fig">1</xref>B, with the figure produced in Fig. <xref rid="Fig1" ref-type="fig">1</xref>C. A common practice in our lab is to run similar code in a for-loop over all recordings from a sequence of experiments, extracting the features of interest, and then having the results conveniently stored in Matlab variables, ready for further processing and/or visualization. Below is described the functionality provided by COSMAS for the steps involved in processing optical mapping data.<fig id="Fig1"><label>Figure 1</label><caption><p>Illustration of COSMAS use. (<bold>A</bold>) General structure of a processing script, (<bold>B</bold>) a concrete example of a script in Matlab, (<bold>C</bold>) the figures produced, showing isochronal activation lines (in ms) and local estimation of conduction velocity.</p></caption><graphic xlink:href="41598_2021_87402_Fig1_HTML" id="MO1"/></fig></p>
    <p id="Par7">COSMAS makes extensive use of the comb algorithm<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>, which is a local-minima-finding algorithm that leverages the knowledge of the activation pattern of the recording (the algorithm description is included in Supplementary Materials). The high-level intuition of the algorithm, illustrated in Fig. <xref rid="Fig2" ref-type="fig">2</xref>A, is that a ‘comb’ is constructed with teeth at predefined distances apart (e.g. if pacing stimuli are applied 150 frames apart, the comb has teeth 150 frames apart as well), and it is slid over the recording, measuring the average signal under the teeth. Subsequently, the position of comb with the lowest average signal is selected, and a small-radius local search is carried out around each comb tooth (within ‘refinementWidth’ ms around the initial location), selecting the ultimate signal minima locations. This approach avoids a range of artefacts inherent to threshold-based approaches and is highly resistant to noise (Fig. <xref rid="Fig2" ref-type="fig">2</xref>B, Supplementary Figure <xref rid="MOESM1" ref-type="media">1</xref>). In addition, the comb-detected minima are guaranteed to be spaced correctly with regards to the known activation rate. Approaches not using this (such as variants of thresholding) can spuriously detect action potentials too close or too far from each other.<fig id="Fig2"><label>Figure 2</label><caption><p>The comb algorithm and its noise-resistance. (<bold>A</bold>) Illustration of comb positioning in a recording of calcium transients in rat heart paced every 140 ms. Three distinct positions of comb are shown, with the average value under comb teeth being given in the legend. The dashed comb has the lowest average value, being the best comb position for extraction of signal minima. (<bold>B</bold>) An example of the trace of 20 calcium transients (generated using the computer model ToR-ORd<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>) with no added noise (top), heavy noise (center), and an extremely high amount of noise added (bottom). COSMAS detected calcium transient peak times with a median error of only 8 ms for heavily noisy signal and only 17 ms in the extremely noisy signal, demonstrating the robustness of the algorithm to noise. Further quantitative data on noise-resistance versus the number of beats in a recording are given in Supplementary Figure <xref rid="MOESM1" ref-type="media">1</xref>.</p></caption><graphic xlink:href="41598_2021_87402_Fig2_HTML" id="MO2"/></fig></p>
    <sec id="Sec3">
      <title>Data reading and preprocessing</title>
      <p id="Par8">COSMAS has two functions for reading data, reflecting the two most common imaging data formats: TIF stack (with slices corresponding to single frames), and an image sequence in a folder (TIF, PNG, or JPG images can be read). Both functions return a 3D matrix representing the recording, with the third dimension corresponding to time coordinates. The user can use alternative means of loading nonstandard or proprietary formats, as long as the result is in the same form of 3D matrix. This general approach makes COSMAS readily useful for any kind of optical mapping data.</p>
      <p id="Par9">In addition to reading the data, the user has the option to carry out spatial binning on each frame of the data read, trading reduced spatial resolution for improved signal-to-noise ratio.</p>
      <p id="Par10">Subsequently, a binary mask may be applied to each frame of the stack using COSMAS, which is useful to discard irrelevant pixels such as the area around a heart, for Langendorff heart imaging, or the area around a dish with a cell culture. COSMAS also contains a function to provide a maximum-contrast averaged image of the recording, which may be useful for detecting such areas and drawing the mask.</p>
      <p id="Par11">Given the easy-to-interpret representation of a recording, the user may apply any additional filtering not implemented in COSMAS that they implement on their own.</p>
    </sec>
    <sec id="Sec4">
      <title>Main analysis</title>
      <p id="Par12">The analysis of a recording is carried out slightly differently for cases when the recording contains multiple passes of a wave (at least three) than when it contains only a single wave pass. In both cases, the user is provided with spatial and temporal information on activation pattern (and thus conduction velocity), signal amplitude, duration, or baseline, as well as a map of signal recovery (e.g. repolarization for AP data). There is also a third ‘hybrid’ option, combining both approaches.</p>
    </sec>
    <sec id="Sec5">
      <title>Multi-wave processing</title>
      <p id="Par13">The general approach is that individual wave passes are segmented in the recording and the properties of each wave pass are measured separately. They are then provided to the user in both the raw form and as an averaged value over the entire recording. The concrete steps are as follows:<list list-type="order"><list-item><p id="Par14">A “recording clock” is obtained on the spatial average trace of the whole recording as the set of midpoints between peak activations (Fig. <xref rid="Fig3" ref-type="fig">3</xref>A,B, dotted lines). Signal peaks in the averaged curve are found using the comb algorithm. COSMAS contains a switch allowing the extraction of peak activations either as signal maxima (for calcium imaging) or as signal minima (arising in voltage mapping). The recording clock is not meant to provide a good segmentation of single APs and CaTs, but merely to provide a global set of “bins” to which recorded data are later assigned in a consistent way. In this way, COSMAS keeps track of the specific wave pass to which an extracted feature belongs.</p></list-item><list-item><p id="Par15">For each pixel in the recording, its trace over time is extracted from the 3D matrix representing the recording. The following processing and analysis functions is then applied on this trace:<list list-type="alpha-lower"><list-item><p id="Par16">It may be smoothed using the Savitzky-Golay filter, which was chosen for its capability of removing noise while preserving genuine sharp changes in signal intensity, such as AP upstrokes.</p></list-item><list-item><p id="Par17">Temporal baseline drift may be subtracted using polynomial smoothing. If this is carried out, the mean of the original signal is re-added after the baseline subtraction. In this way, the general offset of the recording is maintained, allowing e.g. the monitoring of photobleaching as the reduction in the signal baseline over consecutive recordings.</p></list-item></list><list list-type="simple"><list-item><label>c.</label><p id="Par18">Signal diastoles (points of least activation) are extracted via the comb algorithm, which supports both upward- and downward-pointing signal, and the diastoles separate the signal into single cardiac activations (APs/CaTs) (Fig. <xref rid="Fig3" ref-type="fig">3</xref>C,D). While the comb algorithm by default supports only regularly activated recording, the user may also provide a custom comb with arbitrary distances between ‘comb teeth’, which can be used to process even irregularly activated recordings. For every single cardiac activation found using the comb, the following features are extracted (illustrated in Fig. <xref rid="Fig3" ref-type="fig">3</xref>E):<list list-type="simple"><list-item><label>i.</label><p id="Par19">Signal baseline is extracted as the first value or the average between the first and the last values, as determined by the user.</p></list-item><list-item><label>ii.</label><p id="Par20">The amplitude of the activation is computed as the difference between peak of the signal and the baseline.</p></list-item><list-item><label>iii.</label><p id="Par21">Cardiac activation duration at the user-defined level of recovery is obtained via thresholding (providing, e.g., AP duration at a given level of repolarization). Linear interpolation is used at the threshold crossing with the signal to obtain a more precise value. The recovery time at the given level is also stored (corresponding, e.g., to the time at which 80% recovery was achieved in an AP), allowing the study of dispersion of repolarization.</p><p id="Par22">It may occur that the signal segment between two points of a recording clock crosses a given threshold at multiple points in time, leading to multiple objects being segmented, even though there is only one which is true cardiac activation. This usually arises from large amount of noise, or from motion artefacts. COSMAS offers three options for selecting the segmented object from which the features are extracted:</p></list-item></list><disp-quote><p><list list-type="order"><list-item><p id="Par23">‘first’—the first segmented object in the segment is taken</p></list-item><list-item><p id="Par24">‘largest’—the segmented object with the longest duration is taken</p></list-item><list-item><p id="Par25">‘augmented’—in this case, the information on the time of maximum activation rate in each AP/CaT is used to augment the decision making about which segmented object to select:<list list-type="alpha-lower"><list-item><p id="Par26">The derivative of the whole smoothed trace (i.e. before it is split into segments corresponding to single activations) is approximated as the difference between consecutive values.</p></list-item><list-item><p id="Par27">Subsequently, the comb algorithm is applied to this signal to find the times of peak activation rate (corresponding to AP or CaT upstrokes). Thanks to the comb algorithm working on the whole trace, this is much more robust to noise than selecting the peak activation rate in a single AP/CaT only.</p></list-item><list-item><p id="Par28">When the ‘augmented’ object detection is then used for a trace segment corresponding to a single activation, the time point of the peak activation rate in this segment (coming from the previous step) is extracted (there is exactly one) and the segmented object with smallest distance from this point is selected.</p></list-item></list></p></list-item></list></p></disp-quote></p></list-item><list-item><label>iv.</label><p id="Par29">Activation time (used for activation mapping) is estimated as the time when half-maximal amplitude of the cardiac activation is achieved (again using linear interpolation to obtain a precise estimate).</p></list-item><list-item><label>v.</label><p id="Par30">The activation time is subsequently converted to global time coordinates (i.e. not just within the single cardiac activation, but within the whole recording), and the nearest global recording clock time that precedes the activation time is subtracted from it (Fig. <xref rid="Fig3" ref-type="fig">3</xref>F). In this way, the activation times of all single pixels are synchronized using the global recording clock, allowing the extraction of meaningful activation maps. The time of recovery of cardiac activations extracted in the previous step is normalized to the global clock in the same way.</p></list-item><list-item><label>vi.</label><p id="Par31">The extracted features (baseline, amplitude, duration, recovery time, and activation time) are assigned to an appropriate “bin” that is bracketed by two recording clock markers. This is done by taking the half-time of the single activation and seeing in which bin in the global recording clock it belongs. The activation is ignored if its half-time falls before the first clock boundary, or after the last one, to prevent processing of potentially incomplete activations at the start/end of the recording.</p></list-item></list></p></list-item><list-item><p id="Par32">Spatial maps of all the features are returned to the user, along with their spatial and temporal (over beats) averages.</p></list-item></list><fig id="Fig3"><label>Figure 3</label><caption><p>Illustration of stimulus segmentation and feature extraction. (<bold>A</bold>) Average trace of a voltage mapping recording in rat heart at 130 ms basic cycle length (the lower the intensity, the higher the membrane potential), showing the recording clock (half-points between peak activations). (<bold>B</bold>) Average trace of a calcium mapping recording in rat heart at 85 ms basic cycle length (the higher the intensity, the higher the calcium concentration), showing amplitude alternans. (<bold>C</bold>) Single-pixel trace from the recording used in (<bold>A</bold>), also showing the points corresponding to the points of smallest activation (“diastoles”, solid black lines), as well as the global clock (dotted black lines). (<bold>D</bold>) Single-pixel trace from the recording in (<bold>B</bold>), showing pronounced calcium alternans. This recording illustrates, among other things, that despite baseline subtraction and signal smoothing, no single threshold can be used to satisfactorily segment distinct CaTs, while the comb-based approach of COSMAS correctly identifies CaTs as the intervals between diastoles. (<bold>E</bold>) Illustrations of features extracted on a single rat AP. (<bold>F</bold>) Illustration of how activation times are treated. Within single activation, the local activation time is first extracted (15.79 ms after the preceding diastole). This corresponds to the global time (within the whole recording) of 568.79 ms, from which the time of the preceding clock boundary is subtracted, and COSMAS records that the activation came 71.79 ms after the preceding clock. In this way, even though each pixel’s trace may have diastoles detected at different times, all pixels are synchronized to the same global clock, which allows extraction of meaningful activation maps for each pass of a cardiac wave.</p></caption><graphic xlink:href="41598_2021_87402_Fig3_HTML" id="MO3"/></fig></p>
      <sec id="Sec6">
        <title>Single-wave processing</title>
        <p id="Par33">COSMAS also contains functionality to process recordings where only a single pass of a wave is recorded. The processing of such data is analogical to the step 2c of the multiple-wave processing. No separation into distinct waves is carried out, and all the features are extracted on the whole duration of the recording (i.e. there is no assumption on the rate of activation in this case). Given that a single wave is present, no averaging over multiple passes is performed.</p>
      </sec>
      <sec id="Sec7">
        <title>Hybrid processing</title>
        <p id="Par34">A third option for processing the data is to split a regularly-activated multi-wave stack into smaller substacks, with each corresponding to a single pass of the cardiac wave, which are subsequently averaged and processed using the functionality for single-wave processing (Supplementary Figure <xref rid="MOESM1" ref-type="media">2</xref>). The first point of splitting is extracted as the first point of the recording clock (as in multi-wave processing, step 1), with further splitting points being placed at multiples of basic cycle length after that. In this way, all sub-stacks contain a length of signal corresponding to a single basic cycle length, and the signals are naturally aligned, allowing direct averaging without the need for further alignment.</p>
        <p id="Par35">The hybrid processing is advantageous for signal with severe noise perturbation, occasional movement artefact or instability, which could give artefactual outputs for one or several wave passes in the multi-wave processing approach. At the same time, this approach loses the temporal information of multiple wave passes which can be analyzed separately and it does not allow analysis of recordings where signal features change substantially over time (e.g. alternans).</p>
      </sec>
    </sec>
    <sec id="Sec8">
      <title>Postprocessing</title>
      <p id="Par36">COSMAS returns all of its outputs in a form that is easy to interpret straight away, with matrices representing spatial maps of features and averaged values of these, but it also has several additional functions facilitating the most common post-processing tasks. First, a function to plot activation maps is provided (utilizing the function ‘contourf’ in Matlab and ‘matplotlib.pyplot.contour’ in Python, both with default parametrization). Second, a function for estimation of conducting velocity (CV) is provided, allowing the measurement of CV between multiple points in an activation map. Third, a function to compute local CV and the resulting conduction vector field as per the method by Bayly et al.<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> is provided. Fourth, it contains a function to generate maps of alternans in any mapped feature, such as duration, amplitude, etc. When alternans is processed, the feature maps corresponding to even passes of a wave through the heart/dish are averaged, and the same is done for odd wave pass maps. Based on these even/odd maps, alternans behavior in each pixel is defined as either ‘large-to-small’ or ‘sMAPE’ (symmetric mean absolute percentage error), which are defined below.</p>
      <p id="Par37">The ‘large-to-small’ alternans is defined, for each pixel (i,j), as <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{\mathrm{max}(ma{p}_{even}\left(i,j\right), ma{p}_{odd}\left(i,j\right))}{\mathrm{min}(ma{p}_{even}\left(i,j\right), ma{p}_{odd}\left(i,j\right))}$$\end{document}</tex-math><mml:math id="M2"><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">max</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi mathvariant="italic">even</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mfenced><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi mathvariant="italic">odd</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mfenced><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">min</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi mathvariant="italic">even</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mfenced><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi mathvariant="italic">odd</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mfenced><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="41598_2021_87402_Article_IEq1.gif"/></alternatives></inline-formula>., i.e. the ratio of larger-to-smaller feature (e.g. CaT amplitude) value between even and odd wave passes.</p>
      <p id="Par38">The ‘sMAPE’ alternans is defined, for a pixel (i,j), as:<disp-formula id="Equa"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{|ma{p}_{even}\left(i,j\right)- ma{p}_{odd}\left(i,j\right)|}{ma{p}_{even}\left(i,j\right)+ ma{p}_{odd}\left(i,j\right)}$$\end{document}</tex-math><mml:math id="M4" display="block"><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi></mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi mathvariant="italic">even</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mfenced><mml:mo>-</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi mathvariant="italic">odd</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mfenced><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi mathvariant="italic">even</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mfenced><mml:mo>+</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi mathvariant="italic">odd</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41598_2021_87402_Article_Equa.gif" position="anchor"/></alternatives></disp-formula></p>
    </sec>
    <sec id="Sec9">
      <title>Computational performance</title>
      <p id="Par39">Using a new PC with AMD Threadripper 3970X and a fast SSD, the Matlab version of COSMAS can process a single 1000-frame recording of 32 × 32 pixel images (binned to 16 × 16) in under a second, including loading the data and carrying out all analyses (the runtime is ca. 2 s in the Python version of COSMAS). On an older computer with Xeon 1650v3 and magnetic drive (7200 rpm), the runtime per such recording is ca. 2.4 s in Matlab. The analysis code is encapsulated in a function and it is straightforward to analyze multiple recordings in parallel, further reducing the runtime.</p>
    </sec>
    <sec id="Sec10">
      <title>Comparison with ElectroMap</title>
      <p id="Par40">When making a comparison of outputs between COSMAS and ElectroMap<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>, simulation parameters were made as similar as possible. When generating data for Fig. <xref rid="Fig9" ref-type="fig">9</xref> in “<xref rid="Sec12" ref-type="sec">Results</xref>” section, both tools used fourth order polynomial baseline subtraction, Savitzky-Golay filtering with window size of 11, and no spatial filtering. The ‘hybrid’ activation detection was used in COSMAS, which best corresponded to ElectroMap’s activation detection method where multiple wave propagations were averaged before the detection process.</p>
      <p id="Par41">When generating data for Fig. <xref rid="Fig10" ref-type="fig">10</xref> in “<xref rid="Sec12" ref-type="sec">Results</xref>” section, parameters of signal pre-processing were again fourth order polynomial baseline subtraction, Savitzky-Golay filter with window size of 11, and no spatial filtering. Multi-wave processing type was used in COSMAS (being the only approach suitable for alternans analysis), and a corresponding method of analysis was used in ElectroMap, avoiding averaging of multiple CaTs before their processing. The CaT “release” alternans was computed in ElectroMap, which corresponds to what COSMAS reports; baselines in both COSMAS and ElectroMap were taken as the first value in each segmented CaT. When computing alternans magnitude, ElectroMap uses the following formula: <inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$1-\frac{Ca amplitud{e}_{smaller}}{Ca amplitud{e}_{larger}}$$\end{document}</tex-math><mml:math id="M6"><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mi>C</mml:mi><mml:mi>a</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>p</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi><mml:mi>u</mml:mi><mml:mi>d</mml:mi><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mi mathvariant="italic">smaller</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mi>a</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>p</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi><mml:mi>u</mml:mi><mml:mi>d</mml:mi><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mi mathvariant="italic">larger</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math><inline-graphic xlink:href="41598_2021_87402_Article_IEq2.gif"/></alternatives></inline-formula>, and the same was computed using COSMAS for the purpose of comparison in Fig. <xref rid="Fig10" ref-type="fig">10</xref>.</p>
      <p id="Par42">When testing the effect of noise on processing in both tools, the raw data were perturbed with Gaussian noise of a given standard deviation (the same data were then used for both tools).</p>
    </sec>
    <sec id="Sec11">
      <title>Data description</title>
      <p id="Par43">Voltage and calcium dye imaging were performed on Langendorff perfused SD rat hearts (300–350 g animal weight) at physiological temperature. The Langendorff heart mapping data in Figs. <xref rid="Fig2" ref-type="fig">2</xref>A, <xref rid="Fig4" ref-type="fig">4</xref>, <xref rid="Fig5" ref-type="fig">5</xref>, <xref rid="Fig6" ref-type="fig">6</xref>, <xref rid="Fig7" ref-type="fig">7</xref> are a subset of data used in<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, with the cited article containing details on experimental and imaging conditions. The hearts were perfused with oxygenated Tyrode solution (flow rate of 10 ml/min; in mM: NaCl 120.3, KCl 4, MgSO<sub>4</sub> ∗ 7H<sub>2</sub>0 1.3, NaH20P4 1.2, CaCl<sub>2</sub> 1.2, NaHCO<sub>3</sub> 25.2, glucose 11). Blebbistatin at the concentration of 10 μM was used to prevent motion artifacts during imaging and pluronic (10% solution, 100 μl per 200 ml of Tyrode solution) was used to aid dye loading. After mechanical uncoupling, a thin plastic tube was inserted to the left ventricle via the left atrial appendage and mitral valve to prevent perfusate pressure build-up. Dyes were injected through a gel membrane into the plastic tube above the perfusion cannula. 100 μl of Rhod-2 (1 mg in 1 ml solution; delivered over 2 min) and 20 μl of RH-237 (5 mg in 1 ml solution; delivered over 1 min) were used . Data in Figs. <xref rid="Fig1" ref-type="fig">1</xref>, <xref rid="Fig3" ref-type="fig">3</xref>, <xref rid="Fig9" ref-type="fig">9</xref>, <xref rid="Fig10" ref-type="fig">10</xref>, and Supplementary Figure <xref rid="MOESM1" ref-type="media">2</xref>–<xref rid="MOESM1" ref-type="media">4</xref> were extracted using the same imaging setup and experimental conditions, except that no calcium dye was used.<fig id="Fig4"><label>Figure 4</label><caption><p>Activation mapping in a voltage-mapped Langendorff rat heart before and after isoproterenol application. (<bold>A</bold>) Activation map from a wave pass in control condition; isochronal lines are given in milliseconds, and the map is visualised with a minimum activation time of 0. Spatial resolution is 16 × 16 pixels. Red arrows with annotations highlight pixels from which traces are shown in (<bold>C</bold>,<bold>D</bold>), with the arrow labels corresponding to the row and column indices within the activation map. (<bold>B</bold>) Analogous activation map from a wave pass in the same heart after isoproterenol administration (20 nM). (<bold>C</bold>) Traces of the three pixels highlighted via the red arrows. The black lines show activation times (points of half-maximum activation) as determined by COSMAS. The time shown on the x axis is taken relative to the preceding clock, and the traces were mean-subtracted on the y axis to facilitate their visualisation in a single plot. (<bold>D</bold>) Traces of the same three pixels in the map extracted from the heart after isoproterenol administration.</p></caption><graphic xlink:href="41598_2021_87402_Fig4_HTML" id="MO6"/></fig><fig id="Fig5"><label>Figure 5</label><caption><p>Spatial heterogeneity in rat hearts with a healed infarct. (<bold>A</bold>) A map of AP duration at 80% recovery. The zone under the red semi-circle corresponds to the infarct border zone (BZ), with the zone above the semi-circle being non-infarcted zone. Red arrows point to pixels from which sample traces in the (<bold>B</bold>) panel are extracted. (<bold>B</bold>) Sample traces from border and non-infarcted zone verifying the prolongation of the APs in the border zone (manifesting both earlier depolarization and later depolarization). The traces were scaled to have a similar amplitude and baseline, facilitating visual comparison. (<bold>C</bold>) Average activation map in the same recording. (<bold>D</bold>) Local conduction velocity visualization for panel (<bold>C</bold>), estimated by Bayly’s method<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>, implemented in COSMAS.</p></caption><graphic xlink:href="41598_2021_87402_Fig5_HTML" id="MO7"/></fig><fig id="Fig6"><label>Figure 6</label><caption><p>Examples of alternans maps and traces. (<bold>A</bold>) Calcium transient amplitude alternans map corresponding to discordant alternans, with warmer colors corresponding to alternans with large amplitude. Dark blue zones are nodal lines separating zones of alternans in opposite phases. The pixels marked by red arrows with annotations giving the row and column indices are used in the subsequent panel. (<bold>B</bold>) Sample traces from the three marked pixels in the recording in (<bold>A</bold>), verifying that the alternans is discordant (blue and yellow traces have opposite phases) and that there is a lack of alternans in the nodal lines (red trace). (<bold>C</bold>,<bold>D</bold>) Similar format to (<bold>A</bold>,<bold>B</bold>), but showing spatially heterogeneous alternans in an infarcted heart, where alternans arises only in the infarct border zone (BZ) but not the non-infarcted zone (NZ).</p></caption><graphic xlink:href="41598_2021_87402_Fig6_HTML" id="MO8"/></fig><fig id="Fig7"><label>Figure 7</label><caption><p>An example of CaT amplitude restitution in S1-S2 protocol. In the top image is shown the relative CaT amplitude of the S2 stimulus versus S1 stimuli, demonstrating that for short S2 coupling interval, the CaT amplitude is reduced. CaT amplitude is defined as the upstroke amplitude (i.e. from the start of the CaT to the peak). Below the restitution curve are two examples of traces from which the curve was extracted: for S2 = 60 ms and S2 = 130 ms. The S1 coupling interval was 150 ms.</p></caption><graphic xlink:href="41598_2021_87402_Fig7_HTML" id="MO9"/></fig></p>
      <p id="Par44">Data used to demonstrate noise-resistance of COSMAS in Fig. <xref rid="Fig2" ref-type="fig">2</xref>A,B and Supplementary Figure <xref rid="MOESM1" ref-type="media">1</xref> were generated by pacing the ToR-ORd model of human ventricular myocyte<sup><xref ref-type="bibr" rid="CR16">16</xref></sup> at 2 Hz for 1000 beats, copying the last recorded calcium transient a given number of times to obtain a sequence of calcium transients. The data were subsequently normalized to 0–1 range and additive zero-mean Gaussian noise of the given standard deviation was added.</p>
      <p id="Par45">The cardiac monolayer data in Fig. <xref rid="Fig8" ref-type="fig">8</xref> were obtained using the protocols described in<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. In brief, optical mapping was performed on Rhod-4-AM (10 µM, AAT Bioquest, Sunnyvale, CA) treated cardiac monolayers (P1-P3 SD neonatal ventricular rat myocytes). Rhod-4-AM was diluted in tyrodes solution (in mM: NaCl, 135; MgCl<sub>2</sub> 1; KCl, 5.4; CaCl<sub>2</sub>, 1.5; NaH<sub>2</sub>PO<sub>4</sub>, 0.33; glucose, 5; and HEPES 5 adjusted to pH 7.4 with NaOH). Culture imaging was conducted at room temperature. The spiral wave in Fig. <xref rid="Fig8" ref-type="fig">8</xref> was extracted using the same culturing protocol and solution, but was imaged by measuring contraction artifacts using off-axis illumination as described by Burton et al.<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>.<fig id="Fig8"><label>Figure 8</label><caption><p>Application of COSMAS to a dish of calcium-imaged monolayer. (<bold>A</bold>) Sample pixel trace (1 Hz pacing). (<bold>B</bold>) Activation map extracted from a culture dish showing calcium-based propagation (top) and a map of CaT duration (CaTD) measured at 80% recovery (bottom). (<bold>C</bold>) Sample trace from a recording obtained off-axis cell culture imaging<sup><xref ref-type="bibr" rid="CR19">19</xref></sup> showing characteristic “double-hump” motion transient morphology corresponding to cellular contraction and relaxation. (<bold>D</bold>) The activation map of a slow-conducting spiral wave imaged using off-axis imaging, with chaotic culture activation around the spiral. (<bold>E</bold>) The map of temporal standard deviation of duration of cellular activation, computed over multiple wave passes.</p></caption><graphic xlink:href="41598_2021_87402_Fig8_HTML" id="MO10"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec12">
    <title>Results</title>
    <p id="Par46">Here we present a range of applications of COSMAS to optical mapping data.</p>
    <sec id="Sec13">
      <title>Activation mapping in Langendorff rat hearts</title>
      <p id="Par47">COSMAS may be used to assess the effect of a given treatment on the pattern of activation and conduction velocity. For example, conduction acceleration may be observed after isoproterenol administration in rat hearts (Fig. <xref rid="Fig4" ref-type="fig">4</xref>A,B). In Fig. <xref rid="Fig4" ref-type="fig">4</xref>C,D are shown three traces before and after isoproterenol administration from pixels highlighted in Fig. <xref rid="Fig4" ref-type="fig">4</xref>A, with the activation times detected by COSMAS shown as black lines. Importantly, these are raw traces before any processing (carried out by COSMAS internally to find the activation times shown), showing that the extraction of activation times does not introduce biases/shifts in timing. They also demonstrate that COSMAS can work with noisy signals of varying amplitude.</p>
    </sec>
    <sec id="Sec14">
      <title>Observing heterogeneity in infarcted Langendorff rat hearts</title>
      <p id="Par48">The fact that COSMAS returns maps of various features makes it readily applicable to studies on spatial heterogeneity. For example, a map of AP duration at 75% recovery (APD75) shows that the border zone of a healed infarct in a rat has longer APD75 than the surrounding myocardium (Fig. <xref rid="Fig5" ref-type="fig">5</xref>A,B). Activation map extracted from the same recording also shows slower stimulus propagation in the infarct border zone (Fig. <xref rid="Fig5" ref-type="fig">5</xref>C,D), which leads to the wavefront curving around the infarct. Reduced conduction velocity in a border zone of a healed infarct is a known hallmark of border zone remodeling associated with downregulation of fast sodium current and myocyte uncoupling<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
    </sec>
    <sec id="Sec15">
      <title>Alternans mapping</title>
      <p id="Par49">COSMAS can be used to analyze alternans in cardiac recordings, such as CaT amplitude alternans (Fig. <xref rid="Fig6" ref-type="fig">6</xref>). For example, it can reveal nodal lines in the setting of discordant alternans, where the tissue zones on either side of the nodal line oscillate in the opposite phase, with one zone showing a diminished CaT and another an enlarged one<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>
<bold>(</bold>Fig. <xref rid="Fig6" ref-type="fig">6</xref>A,B). It can also visualize heterogeneity in alternans magnitude, such as in rat hearts with a healed myocardial infarction, where the border zone is particularly prone to alternans formation<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> (Fig. <xref rid="Fig6" ref-type="fig">6</xref>C,D).</p>
    </sec>
    <sec id="Sec16">
      <title>Custom comb design enables S1S2 protocol analysis</title>
      <p id="Par50">While the simplest form of the comb algorithm serves to process regularly activated recordings (searching for a set of minima in a recording that are a constant number of frames apart), COSMAS also enables the user to provide a custom ‘comb’, where the signal minima to-be-found have intervals of any length between them. This provides the possibility to process recordings with any a priori known activation pattern. For example, for S1-S2 protocol with three S1 = 150 ms stimuli and a single S2 = 60 ms stimulus (Fig. <xref rid="Fig7" ref-type="fig">7</xref>, bottom left), the user can construct a comb searching for 3 minima that are 150 ms apart, and then another minimum that is to be found 60 ms after the last S1. Using a custom comb for each distinct S2 coupling interval, features such as signal amplitude or duration may be extracted from S1S2 recordings; an example of S1S2 restitution of CaT amplitude is given in Fig. <xref rid="Fig7" ref-type="fig">7</xref>, top. We note that in case of measurements of tissue-level response to S1-S2 protocol, the diastolic intervals may differ somewhat in different regions due to conduction velocity restitution properties. In such a case, the width of local search around the initial positioning of the comb teeth is best increased (via the ‘refinementWidth’ parameter) so that the minima search covers the range of activation times observed in the sample.</p>
    </sec>
    <sec id="Sec17">
      <title>Optical mapping of cell cultures and spiral waves</title>
      <p id="Par51">The applications of COSMAS are not limited to macroscopic Langendorff heart imaging, as presented in previous sections, but can just as well be used to process recordings from calcium-imaged cardiac monolayers without additional customization. Figure <xref rid="Fig8" ref-type="fig">8</xref> illustrates a sample calcium trace in such a culture (Fig. <xref rid="Fig8" ref-type="fig">8</xref>A), as well as an activation and an 80% recovery duration map extracted from a dish (Fig. <xref rid="Fig8" ref-type="fig">8</xref>B).</p>
      <p id="Par52">While COSMAS is aimed primarily at the analysis of non-arrhythmic phenomena and features, it can also process periodic arrhythmia, such as a reentrant spiral wave (Fig. <xref rid="Fig8" ref-type="fig">8</xref>C,D), imaged using the off-axis illumination technique<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. The spiral wave shown in Fig. <xref rid="Fig8" ref-type="fig">8</xref>D was surrounded by highly chaotic wavelets and seemingly random spurious activity, producing fragmented and difficult to interpret activation pattern around the edges of the image. COSMAS is intrinsically capable of detecting such sites of irregular activation in the recording processed (and possibly excluding them from further analysis). This is demonstrated in Fig. <xref rid="Fig8" ref-type="fig">8</xref>E, which shows the temporal standard deviation of the estimated APD75, computed over all the spiral wave passes. In sites where the activation is regular, the signal shape is consistent across wave passes, yielding low standard deviation value. Conversely in sites of nonperiodic activation, the comb algorithm does not segment the tissue activation correctly, instead forcing the nonperiodic signal to fit within the periodic comb, producing poor segmentation and thus high temporal standard deviation of the APD75 (or other features) extracted.</p>
    </sec>
    <sec id="Sec18">
      <title>Comparison of key functionality to ElectroMap</title>
      <p id="Par53">In this section, we compare the COSMAS’ functionality for activation mapping and calcium alternans mapping with that of ElectroMap, a recently published comprehensive software for analysis of optical mapping data<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>. First, we evaluated the robustness of activation mapping to three levels of additional Gaussian noise (Fig. <xref rid="Fig9" ref-type="fig">9</xref>A), observing the correlation of recorded activation times after noise addition to the activation times recorded in the baseline recording (Fig. <xref rid="Fig9" ref-type="fig">9</xref>B). At baseline conditions with no noise, both tools are in excellent agreement with regards to the activation times (Fig. <xref rid="Fig9" ref-type="fig">9</xref>A, R<sup>2</sup> &gt; 0.99, Supplementary Figure <xref rid="MOESM1" ref-type="media">3</xref>). With the addition of light Gaussian noise, standard deviation sd = 100 signal intensity units, the activation pattern was essentially unchanged in both tools, with COSMAS showing marginally tighter correlation to the noise-free activation times (R<sup>2</sup> = 0.995 vs 0.991 in ElectroMap). With intermediate level noise (sd = 250), the resulting maps are less smooth in both tools (Fig. <xref rid="Fig9" ref-type="fig">9</xref>A), and the correlation plots show more frequent deviations from the noise-free activation times (Fig. <xref rid="Fig9" ref-type="fig">9</xref>B). COSMAS manifests a slightly worse R<sup>2</sup> correlation value than ElectroMap in this scenario (R<sup>2</sup> = 0.93 vs 0.967), but this is driven by a single outlier point (coming from the bottom left corner of the recording which has the poorest signal quality) to which the R<sup>2</sup> statistic is notoriously sensitive. When the single outlier is removed, COSMAS’ R<sup>2</sup> is slightly better than that of ElectroMap (0.981 vs 0.967), suggesting that the average deviation from the original recording is lower (which can be also seen in Fig. <xref rid="Fig9" ref-type="fig">9</xref>b, 2nd column, where the spread of COSMAS’ points excluding the outlier is smaller than in ElectroMap). With a high level of noise added (sd = 500), while both tools show a markedly deteriorated quality of activation map detection, the COSMAS’ output shows a better resemblance with the original mapping pattern (Fig. <xref rid="Fig9" ref-type="fig">9</xref>A). The R<sup>2</sup> statistic is also markedly better in COSMAS compared to ElectroMap (0.884 vs 0.591, Fig. <xref rid="Fig9" ref-type="fig">9</xref>B).<fig id="Fig9"><label>Figure 9</label><caption><p>Robustness of COSMAS’ and ElectroMap’s activation mapping to noise. (<bold>A</bold>) The four rows of images correspond to a baseline recording, and then the same recording with three levels of added noise (Gaussian noise with standard deviation of 100, 250, and 500). The first column shows a sample pixel trace from the center of the field of view, the second column gives the activation maps produced by COSMAS, with the third column displaying activation maps produced by ElectroMap. (<bold>B</bold>) A measure of how the extracted activation pattern changes with added noise. In the three columns is shown, for both tools, the correlation of activation times in the noisy recordings (x-axis) versus the activation times in control recording (y-axis). Tight correlation means that there is little change in activation detection with the added noise. Above the correlation plots is given the R<sup>2</sup> statistic, corresponding to goodness-of-fit. In COSMAS, noise sd = 250, the R<sup>2</sup> value in parentheses gives the statistic value after removal of one outlier point which perturbs the statistic markedly. Parameters of COSMAS and ElectroMap were matched whenever possible (see Methods for details). The original data with no added noise come from Langendorff-perfused rat hearts paced at 150 ms basic cycle length.</p></caption><graphic xlink:href="41598_2021_87402_Fig9_HTML" id="MO4"/></fig></p>
      <p id="Par54">Subsequently, we similarly evaluated the robustness of alternans mapping to added Gaussian noise in matching conditions (Fig. <xref rid="Fig10" ref-type="fig">10</xref>A). In the recording with no added noise, both tools produce relatively similar outputs, showing the pattern of nodal lines (Fig. <xref rid="Fig10" ref-type="fig">10</xref>A, R<sup>2</sup> = 0.88; Supplementary Figure <xref rid="MOESM1" ref-type="media">4</xref>A). However, ElectroMap reports a small degree of alternans even when alternans is not present (Supplementary Figure <xref rid="MOESM1" ref-type="media">4</xref>B), leading to a somewhat lower contrast in its alternans maps. COSMAS’ alternans mapping appears relatively resistant to increasing levels of noise, maintaining a stable visual pattern (Fig. <xref rid="Fig10" ref-type="fig">10</xref>A, B, R<sup>2</sup> = 0.957, 0.866, 0.789 for the three levels of added noise versus original recording). While ElectroMap was resistant to a small amount of noise added, the alternans maps deteriorated when noise with standard deviation of 20 or 30 was added (Fig. <xref rid="Fig10" ref-type="fig">10</xref>A, B, R<sup>2</sup> = 0.836, 0.664, 0.422 for the three levels of added noise).<fig id="Fig10"><label>Figure 10</label><caption><p>Robustness of COSMAS’ and ElectroMap’s alternans mapping to noise. The structure of the figure is identical to Figure <xref rid="MOESM1" ref-type="media">9</xref>. Sample traces in (<bold>A</bold>) come from pixel row = 13, column = 7 in the recording. Given different amplitude of the calcium signal, lower amount of Gaussian noise was applied. Parameters of COSMAS and ElectroMap were matched whenever possible, including the alternans metric (see “<xref rid="Sec2" ref-type="sec">Methods</xref>” section for details). The original data with no added noise come from Langendorff-perfused rat hearts paced at 85 ms basic cycle length.</p></caption><graphic xlink:href="41598_2021_87402_Fig10_HTML" id="MO5"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec19">
    <title>Discussion</title>
    <p id="Par55">This work presents and demonstrates COSMAS, a tool for automated analysis of optical mapping data from cardiac preparations, such as explanted hearts or cardiac cell cultures grown in monolayers. Two key aims of COSMAS are to provide high-quality processing and to maintain simplicity of methods and code. Unlike previous tools for optical mapping data analysis that were implemented in MATLAB<sup><xref ref-type="bibr" rid="CR11">11</xref>,<xref ref-type="bibr" rid="CR12">12</xref></sup>, COSMAS is provided both as a MATLAB library and also as a Python library, thus being more accessible to researchers without MATLAB access.</p>
    <p id="Par56">COSMAS offers powerful functionality to extract activation maps, signal duration, amplitude, and baseline, as well as analyze alternans in these features. The quality of processing follows from the use of the comb algorithm<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>, which leverages knowledge of the pattern of activation in the cardiac preparation to reduce the impact of noise, while also avoiding a range of segmentation artefacts that arise in common algorithms of segmentation, such as thresholding. Our comparison of COSMAS and a recently published high-quality software for optical mapping analysis ElectroMap<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> suggests that with regards to activation mapping, and CaT amplitude mapping, COSMAS performs as well as or better than ElectroMap in common tasks, and is more resistant to noise in the data (Figs. <xref rid="Fig8" ref-type="fig">8</xref>, <xref rid="Fig9" ref-type="fig">9</xref>). On the other hand, ElectroMap is a more comprehensive tool that allows analysis of several features that are currently not supported in COSMAS (e.g. mapping of time constant of recovery of CaTs) and its GUI-based nature may be helpful for analysis of small datasets.</p>
    <p id="Par57">The relative simplicity of COSMAS is enabled by its focus on the most common tasks in optical mapping, the avoidance of GUI, and the utilization of prior knowledge of the activation rate in the analyzed recordings. The simplicity is advantageous in the following ways:</p>
    <p id="Par58">First, the simplicity arising from script-based design, as opposed to GUI, means that it is easy to write fully automated analyses that can load a whole batch of experiments, analyze them, and then perform statistics or visualization on them to produce publication-ready figures. This not only saves large amounts of time, but it also prevents potential user mistakes such as inconsistent parametrization between recordings and mistakes in storing or loading output, increasing analysis reproducibility. Similar design considerations have driven redesigns in other scientific software platforms<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>.</p>
    <p id="Par59">Second, it means the methodology is transparent. It is tractable why the software produces its outputs and, when compared to more complex methods, potential problems are easier to find and fix. We have a first-hand experience of difficulties arising from complex solutions related to our previous data analysis software Ccoffinn for comprehensive analysis of high-resolution mapping data recorded in cell cultures<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. In most applications of Ccoffinn by other groups that we are aware of, our help was needed for reading and preprocessing data, for setting optimal parameters, and for interpreting the outputs. We hope that the simplicity of COSMAS makes it a far more approachable tool.</p>
    <p id="Par60">Third, the design and structuring of the codes makes it much easier to extend COSMAS with further functionality compared to software with architecture predetermined by a GUI. Implementing a simple change, such as the addition of a parameter or a pre-processing step, is much more challenging in a GUI-based complex tool. Given that working with MATLAB’s GUI is a relatively specialized skill, we consider a GUI-based design a major limitation with regards to user adaptability of the software.</p>
    <p id="Par61">Ultimately, avoiding complex approaches to signal analysis also means that COSMAS offers excellent computational performance, allowing the processing of hundreds to thousands of recordings per hour on a common PC (depending on hardware and data resolution). The combination of script-based automation and fast runtime makes COSMAS suitable for applications in large-scale drug screening<sup><xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR24">24</xref></sup>.</p>
  </sec>
  <sec id="Sec20">
    <title>Limitations</title>
    <p id="Par62">The most obvious limitation of COSMAS is tightly linked to its reliance on the comb algorithm for segmentation of stimuli: it requires the user to have a prior knowledge of the activation pattern of the recording. At the same time, it can be argued that fixed-rate pacing or other known-pattern protocol (such as S1S2) should be used for most domains of COSMAS’ application, making the limitation relatively theoretical. One obvious example is alternans, which is typically evoked by fixed-rate rapid pacing, but even experiments measuring conduction velocity do benefit from fixed-rate activation. For example, when a drug is suspected to change conduction velocity, but it also changes heart rate, using fixed-rate pacing makes it possible to tease apart the effect of the drug on conduction properties from the effect of conduction velocity restitution.</p>
    <p id="Par63">Ultimately, even for recordings where the pattern of excitation is not controlled by the user (e.g. spontaneously beating cultures in multi-well plates used in high-throughput studies), it may be often very easy to automatically extract the times of activation. This may be achieved, e.g. using thresholding on the spatial average of the whole recording (which tends to be very low-noise in general, allowing simple thresholding to work adequately), and taking the signal maximum in each segment above the threshold as an activation time. A custom comb may be then automatically constructed based on intervals between thus detected activation times (substituting the need of prior knowledge of activation rate). This may then be provided to COSMAS, allowing high-quality segmentation of APs and CaTs for each pixel’s trace in such recordings (for which thresholding would not have worked adequately due to much lower signal-to-noise ratio).</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Information</title>
    <sec id="Sec21">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41598_2021_87402_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher's note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary Information</title>
    <p>The online version contains supplementary material available at 10.1038/s41598-021-87402-9.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>ZJW is funded via Wellcome trust (214290/Z/18/Z). RABB is funded by a Sir Henry Dale Wellcome Trust and Royal Society (United Kingdom) Fellowship (109371/Z/15/Z) and acknowledges support from The Returning Carers’ Fund, Medical Sciences Division, University of Oxford (United Kingdom) and the British Heart Foundation (Project Grant PG/18/4/33521). NH is a British Heart Foundation Senior Clinical Research Fellowship (FS/SCRF/20/32005) at the University of Oxford and acknowledge support from the BHF Centre of Research Excellence (RE/08/004), Oxford. GB acknowledges support from the Canadian Heart and Stroke Foundation (HSFC G-18-0022123) and the Natural Sciences and Engineering Research Council of Canada (RGPIN-2018-05346). This research was funded in whole, or in part, by the Wellcome Trust [Grant number 109371/Z/15/Z]. For the purpose of open access, the author has applied a CC BY public copyright licence to any Author Accepted Manuscript version arising from this submission.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>J.T. has conceived the study, designed and developed the Matlab version of COSMAS, wrote demonstration scripts and user guide, produced figures, and wrote the initial article draft. Z.J.W., R.A.B., N.H., and G.B. subsequently edited the manuscript. ZJW translated the Matlab version of COSMAS to Python. J.T., R.A.B., and N.H. provided experimental data used in the study. Discussions and collaborative projects with R.A.B., N.H., and G.B. shaped the functionality included in COSMAS, and thus its design. GB supervised the project.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>Imaging datasets analysed in the study are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/jtmff/cosmas">https://github.com/jtmff/cosmas</ext-link>. </p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The codes, data, sample scripts illustrating common use cases, and a user guide are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/jtmff/cosmas">https://github.com/jtmff/cosmas</ext-link>.</p>
  </notes>
  <notes id="FPar1" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par64">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>O’Shea</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Kabir</surname>
            <given-names>SN</given-names>
          </name>
          <name>
            <surname>Holmes</surname>
            <given-names>AP</given-names>
          </name>
          <name>
            <surname>Lei</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Fabritz</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Rajpoot</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Pavlovic</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Cardiac optical mapping—State-of-the-art and future challenges</article-title>
        <source>Int. J. Biochem. Cell Biol.</source>
        <year>2020</year>
        <volume>126</volume>
        <fpage>105804</fpage>
        <pub-id pub-id-type="doi">10.1016/j.biocel.2020.105804</pub-id>
        <?supplied-pmid 32681973?>
        <pub-id pub-id-type="pmid">32681973</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Efimov</surname>
            <given-names>IR</given-names>
          </name>
          <name>
            <surname>Nikolski</surname>
            <given-names>VP</given-names>
          </name>
          <name>
            <surname>Salama</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Optical imaging of the heart</article-title>
        <source>Circ. Res.</source>
        <year>2004</year>
        <pub-id pub-id-type="doi">10.1161/01.RES.0000130529.18016.35</pub-id>
        <?supplied-pmid 15242982?>
        <pub-id pub-id-type="pmid">15242982</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tung</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Optical imaging of arrhythmias in tissue culture</article-title>
        <source>J. Electrocardiol.</source>
        <year>2006</year>
        <volume>39</volume>
        <fpage>S2</fpage>
        <lpage>S6</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jelectrocard.2006.04.010</pub-id>
        <?supplied-pmid 17015066?>
        <pub-id pub-id-type="pmid">17015066</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Davidenko</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Pertsov</surname>
            <given-names>AV</given-names>
          </name>
          <name>
            <surname>Salomonsz</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Baxter</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Jalife</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Stationary and drifting spiral waves of excitation in isolated cardiac muscle</article-title>
        <source>Nature</source>
        <year>1992</year>
        <volume>355</volume>
        <fpage>349</fpage>
        <lpage>351</lpage>
        <pub-id pub-id-type="doi">10.1038/355349a0</pub-id>
        <?supplied-pmid 1731248?>
        <pub-id pub-id-type="pmid">1731248</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kalla</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Chotalia</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Coughlan</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Hao</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Crabtree</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Tomek</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Bub</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Paterson</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Herring</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Protection against ventricular fibrillation via cholinergic receptor stimulation and the generation of nitric oxide</article-title>
        <source>J. Physiol.</source>
        <year>2016</year>
        <volume>594</volume>
        <fpage>3981</fpage>
        <lpage>3992</lpage>
        <pub-id pub-id-type="doi">10.1113/JP271588</pub-id>
        <?supplied-pmid 26752781?>
        <pub-id pub-id-type="pmid">26752781</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Myles</surname>
            <given-names>RC</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Kang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Bers</surname>
            <given-names>DM</given-names>
          </name>
          <name>
            <surname>Ripplinger</surname>
            <given-names>CM</given-names>
          </name>
        </person-group>
        <article-title>Local β-adrenergic stimulation overcomes source-sink mismatch to generate focal arrhythmia</article-title>
        <source>Circ. Res.</source>
        <year>2012</year>
        <pub-id pub-id-type="doi">10.1161/CIRCRESAHA.111.262345</pub-id>
        <?supplied-pmid 22539768?>
        <pub-id pub-id-type="pmid">22539768</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mills</surname>
            <given-names>WR</given-names>
          </name>
          <name>
            <surname>Mal</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Forudi</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Popovic</surname>
            <given-names>ZB</given-names>
          </name>
          <name>
            <surname>Penn</surname>
            <given-names>MS</given-names>
          </name>
          <name>
            <surname>Laurita</surname>
            <given-names>KR</given-names>
          </name>
        </person-group>
        <article-title>Optical mapping of late myocardial infarction in rats</article-title>
        <source>Am. J. Physiol. Heart Circ. Physiol.</source>
        <year>2006</year>
        <pub-id pub-id-type="doi">10.1152/ajpheart.00437.2005</pub-id>
        <?supplied-pmid 17012360?>
        <pub-id pub-id-type="pmid">17012360</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gardner</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Lang</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Cregg</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Dunbar</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Woodward</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Silver</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Ripplinger</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Habecker</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Targeting protein tyrosine phosphatase sigma after myocardial infarction restores cardiac sympathetic innervation and prevents arrhythmias</article-title>
        <source>Nat. Commun.</source>
        <year>2015</year>
        <volume>6</volume>
        <fpage>6235</fpage>
        <pub-id pub-id-type="doi">10.1038/ncomms7235</pub-id>
        <?supplied-pmid 25639594?>
        <pub-id pub-id-type="pmid">25639594</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tomek</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Hao</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Tomková</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Lewis</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Carr</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Paterson</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Rodriguez</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Bub</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Herring</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Β-Adrenergic receptor stimulation and alternans in the border zone of a healed infarct: An ex vivo Study and Computational Investigation of Arrhythmogenesis</article-title>
        <source>Front. Physiol.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>350</fpage>
        <pub-id pub-id-type="doi">10.3389/fphys.2019.00350</pub-id>
        <?supplied-pmid 30984029?>
        <pub-id pub-id-type="pmid">30984029</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Takahashi</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>van Dessel</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Lopshire</surname>
            <given-names>JC</given-names>
          </name>
          <name>
            <surname>Groh</surname>
            <given-names>WJ</given-names>
          </name>
          <name>
            <surname>Miller</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zipes</surname>
            <given-names>DP</given-names>
          </name>
        </person-group>
        <article-title>Optical mapping of the functional reentrant circuit of ventricular tachycardia in acute myocardial infarction</article-title>
        <source>Heart Rhythm</source>
        <year>2004</year>
        <pub-id pub-id-type="doi">10.1016/j.hrthm.2004.05.005</pub-id>
        <?supplied-pmid 15851199?>
        <pub-id pub-id-type="pmid">15851199</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Laughner</surname>
            <given-names>JI</given-names>
          </name>
          <name>
            <surname>Ng</surname>
            <given-names>FS</given-names>
          </name>
          <name>
            <surname>Sulkin</surname>
            <given-names>MS</given-names>
          </name>
          <name>
            <surname>Arthur</surname>
            <given-names>RM</given-names>
          </name>
          <name>
            <surname>Efimov</surname>
            <given-names>IR</given-names>
          </name>
        </person-group>
        <article-title>Processing and analysis of cardiac optical mapping data obtained with potentiometric dyes</article-title>
        <source>Am. J. Physiol. Heart Circ. Physiol.</source>
        <year>2012</year>
        <volume>303</volume>
        <fpage>H753</fpage>
        <lpage>H765</lpage>
        <pub-id pub-id-type="doi">10.1152/ajpheart.00404.2012</pub-id>
        <?supplied-pmid 22821993?>
        <pub-id pub-id-type="pmid">22821993</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>O’Shea</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Holmes</surname>
            <given-names>AP</given-names>
          </name>
          <name>
            <surname>Yu</surname>
            <given-names>TY</given-names>
          </name>
          <name>
            <surname>Winter</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Wells</surname>
            <given-names>SP</given-names>
          </name>
          <name>
            <surname>Correia</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Boukens</surname>
            <given-names>BJ</given-names>
          </name>
          <name>
            <surname>De Groot</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>Chu</surname>
            <given-names>GS</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ElectroMap: High-throughput open-source software for analysis and mapping of cardiac electrophysiology</article-title>
        <source>Sci. Rep.</source>
        <year>2019</year>
        <pub-id pub-id-type="doi">10.1038/s41598-018-38263-2</pub-id>
        <?supplied-pmid 31831797?>
        <pub-id pub-id-type="pmid">31831797</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>O’Shea</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Winter</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Holmes</surname>
            <given-names>AP</given-names>
          </name>
          <name>
            <surname>Johnson</surname>
            <given-names>DM</given-names>
          </name>
          <name>
            <surname>Correia</surname>
            <given-names>JN</given-names>
          </name>
          <name>
            <surname>Kirchhof</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Fabritz</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Rajpoot</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Pavlovic</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Temporal irregularity quantification and mapping of optical action potentials using wave morphology similarity</article-title>
        <source>Prog. Biophys. Mol. Biol.</source>
        <year>2020</year>
        <pub-id pub-id-type="doi">10.1016/j.pbiomolbio.2019.12.004</pub-id>
        <?supplied-pmid 31899215?>
        <pub-id pub-id-type="pmid">31899215</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rueden</surname>
            <given-names>CT</given-names>
          </name>
          <name>
            <surname>Schindelin</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Hiner</surname>
            <given-names>MC</given-names>
          </name>
          <name>
            <surname>DeZonia</surname>
            <given-names>BE</given-names>
          </name>
          <name>
            <surname>Walter</surname>
            <given-names>AE</given-names>
          </name>
          <name>
            <surname>Arena</surname>
            <given-names>ET</given-names>
          </name>
          <name>
            <surname>Eliceiri</surname>
            <given-names>KW</given-names>
          </name>
        </person-group>
        <article-title>Image J2: ImageJ for the next generation of scientific image data</article-title>
        <source>BMC Bioinformatics</source>
        <year>2017</year>
        <pub-id pub-id-type="doi">10.1186/s12859-017-1934-z</pub-id>
        <?supplied-pmid 29187165?>
        <pub-id pub-id-type="pmid">29187165</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tomek</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>A ‘comb’ algorithm for accurate detection of calcium transients and action potentials in regularly activating cardiac preparations</article-title>
        <source>bioRxiv</source>
        <year>2019</year>
        <pub-id pub-id-type="doi">10.1101/757294</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tomek</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Bueno-Orovio</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Passini</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Minchole</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Britton</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Bartolucci</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Severi</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Shrier</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Virag</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Development, calibration, and validation of a novel human ventricular myocyte model in health, disease, and drug block</article-title>
        <source>Elife</source>
        <year>2019</year>
        <volume>8</volume>
        <fpage>e48890</fpage>
        <pub-id pub-id-type="doi">10.7554/eLife.48890</pub-id>
        <?supplied-pmid 31868580?>
        <pub-id pub-id-type="pmid">31868580</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bayly</surname>
            <given-names>PV</given-names>
          </name>
          <name>
            <surname>KenKnight</surname>
            <given-names>BH</given-names>
          </name>
          <name>
            <surname>Rogers</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Hillsley</surname>
            <given-names>RE</given-names>
          </name>
          <name>
            <surname>Ideker</surname>
            <given-names>RE</given-names>
          </name>
          <name>
            <surname>Smith</surname>
            <given-names>WM</given-names>
          </name>
        </person-group>
        <article-title>Estimation of conduction velocity vector fields from epicardial mapping data</article-title>
        <source>IEEE Trans. Biomed. Eng.</source>
        <year>1998</year>
        <volume>45</volume>
        <fpage>563</fpage>
        <lpage>571</lpage>
        <pub-id pub-id-type="doi">10.1109/10.668746</pub-id>
        <?supplied-pmid 9581054?>
        <pub-id pub-id-type="pmid">9581054</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Burton</surname>
            <given-names>RAB</given-names>
          </name>
          <name>
            <surname>Tomek</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Ambrosi</surname>
            <given-names>CM</given-names>
          </name>
          <name>
            <surname>Larsen</surname>
            <given-names>HE</given-names>
          </name>
          <name>
            <surname>Sharkey</surname>
            <given-names>AR</given-names>
          </name>
          <name>
            <surname>Capel</surname>
            <given-names>RA</given-names>
          </name>
          <name>
            <surname>Corbett</surname>
            <given-names>AD</given-names>
          </name>
          <name>
            <surname>Bilton</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Klimas</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Stephens</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Optical interrogation of sympathetic neuronal effects on macroscopic cardiomyocyte network dynamics</article-title>
        <source>iScience</source>
        <year>2020</year>
        <pub-id pub-id-type="doi">10.1016/j.isci.2020.101334</pub-id>
        <?supplied-pmid 33364585?>
        <pub-id pub-id-type="pmid">33364585</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Burton</surname>
            <given-names>RAB</given-names>
          </name>
          <name>
            <surname>Klimas</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Ambrosi</surname>
            <given-names>CM</given-names>
          </name>
          <name>
            <surname>Tomek</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Corbett</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Entcheva</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Bub</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Optical control of excitation waves in cardiac tissue</article-title>
        <source>Nat. Photonics</source>
        <year>2015</year>
        <volume>9</volume>
        <fpage>813</fpage>
        <lpage>816</lpage>
        <pub-id pub-id-type="doi">10.1038/nphoton.2015.196</pub-id>
        <?supplied-pmid 27057206?>
        <pub-id pub-id-type="pmid">27057206</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Campos</surname>
            <given-names>FO</given-names>
          </name>
          <name>
            <surname>Whitaker</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Neji</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Roujol</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>O’Neill</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Plank</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Bishop</surname>
            <given-names>MJ</given-names>
          </name>
        </person-group>
        <article-title>Factors promoting conduction slowing as substrates for block and reentry in infarcted hearts</article-title>
        <source>Biophys. J.</source>
        <year>2019</year>
        <pub-id pub-id-type="doi">10.1016/j.bpj.2019.08.008</pub-id>
        <?supplied-pmid 31521328?>
        <pub-id pub-id-type="pmid">31521328</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Weiss</surname>
            <given-names>JN</given-names>
          </name>
          <name>
            <surname>Karma</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Shiferaw</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>PS</given-names>
          </name>
          <name>
            <surname>Garfinkel</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Qu</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>From pulsus to pulseless: The saga of cardiac alternans</article-title>
        <source>Circ. Res.</source>
        <year>2006</year>
        <volume>98</volume>
        <fpage>1244</fpage>
        <lpage>1253</lpage>
        <pub-id pub-id-type="doi">10.1161/01.RES.0000224540.97431.f0</pub-id>
        <?supplied-pmid 16728670?>
        <pub-id pub-id-type="pmid">16728670</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tomek</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Burton</surname>
            <given-names>RAB</given-names>
          </name>
          <name>
            <surname>Bub</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Ccoffinn: Automated wave tracking in cultured cardiac monolayers</article-title>
        <source>Biophys. J.</source>
        <year>2016</year>
        <pub-id pub-id-type="doi">10.1016/j.bpj.2016.08.049</pub-id>
        <?supplied-pmid 27760347?>
        <pub-id pub-id-type="pmid">27760347</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Klimas</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Ambrosi</surname>
            <given-names>CM</given-names>
          </name>
          <name>
            <surname>Yu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>JC</given-names>
          </name>
          <name>
            <surname>Bien</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Entcheva</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>OptoDyCE as an automated system for high-throughput all-optical dynamic cardiac electrophysiology</article-title>
        <source>Nat. Commun.</source>
        <year>2016</year>
        <volume>7</volume>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1038/ncomms11542</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hortigon-Vinagre</surname>
            <given-names>MP</given-names>
          </name>
          <name>
            <surname>Zamora</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Burton</surname>
            <given-names>FL</given-names>
          </name>
          <name>
            <surname>Butler</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smith</surname>
            <given-names>GL</given-names>
          </name>
        </person-group>
        <article-title>Measurements of voltage, intracellular Ca2+ and contraction from spontaneous iPSC-derived cardiomyocytes using CellOPTIQ® platform reveals complex effects from drugs that parallel in vivo cardiac effects</article-title>
        <source>J. Pharmacol. Toxicol. Methods</source>
        <year>2018</year>
        <pub-id pub-id-type="doi">10.1016/j.vascn.2018.01.407</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
