<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8120905</article-id>
    <article-id pub-id-type="publisher-id">4165</article-id>
    <article-id pub-id-type="doi">10.1186/s12859-021-04165-w</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methodology Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SSBER: removing batch effect for single-cell RNA sequencing data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Zhang</surname>
          <given-names>Yin</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5890-0448</contrib-id>
        <name>
          <surname>Wang</surname>
          <given-names>Fei</given-names>
        </name>
        <address>
          <email>wangfei@fudan.edu.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <aff id="Aff1"><label>1</label>Shanghai Key Lab of Intelligent Information Processing, Shanghai, China </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.8547.e</institution-id><institution-id institution-id-type="ISNI">0000 0001 0125 2443</institution-id><institution>School of Computer Science and Technology, </institution><institution>Fudan University, </institution></institution-wrap>Shanghai, China </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>14</day>
      <month>5</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>14</day>
      <month>5</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2021</year>
    </pub-date>
    <volume>22</volume>
    <elocation-id>249</elocation-id>
    <history>
      <date date-type="received">
        <day>10</day>
        <month>1</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>4</day>
        <month>5</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2021</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">With the continuous maturity of sequencing technology, different laboratories or different sequencing platforms have generated a large amount of single-cell transcriptome sequencing data for the same or different tissues. Due to batch effects and high dimensions of scRNA data, downstream analysis often faces challenges. Although a number of algorithms and tools have been proposed for removing batch effects, the current mainstream algorithms have faced the problem of data overcorrection when the cell type composition varies greatly between batches.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">In this paper, we propose a novel method named SSBER by utilizing biological prior knowledge to guide the correction, aiming to solve the problem of poor batch-effect correction when the cell type composition differs greatly between batches.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3">SSBER effectively solves the above problems and outperforms other algorithms when the cell type structure among batches or distribution of cell population varies considerably, or some similar cell types exist across batches.
</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Data integration</kwd>
      <kwd>Batch effect</kwd>
      <kwd>The shared cell type</kwd>
      <kwd>Supervised cell type assignment</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001809</institution-id>
            <institution>National Natural Science Foundation of China</institution>
          </institution-wrap>
        </funding-source>
        <award-id>61472086</award-id>
        <principal-award-recipient>
          <name>
            <surname>Wang</surname>
            <given-names>Fei</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2021</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par15">In 2009, Tang et al. developed the first sequencing technology for single-cell RNA sequencing (scRNA-seq). Unlike traditional "bulk" RNA sequencing in the past, scRNA-seq measures the expression of each gene from the perspective of a single cell [<xref ref-type="bibr" rid="CR1">1</xref>]. With the rapid development of biotechnology, single-cell RNA sequencing (scRNA-seq) has become one of the most prioritized sequencing research directions in recent years [<xref ref-type="bibr" rid="CR2">2</xref>, <xref ref-type="bibr" rid="CR3">3</xref>]. It is meaningful to analysis scRNA-seq data, facilitating to understand the biological heterogeneity and to discover new cell types. In the process of data analysis, integrating multiple batches can contain more biological information, which will help us to obtain more reliable downstream analysis results. However, biological data can be easily affected by systematic variations especially due to experimental technology deviations or artificial errors [<xref ref-type="bibr" rid="CR4">4</xref>]. Effectively removing batch effects can reduce the influence of technical or artificial errors in the process of analyzing scRNA-seq data [<xref ref-type="bibr" rid="CR5">5</xref>].</p>
    <p id="Par16">Traditional methods to remove batch effect for bulk RNA-seq data are not a good option for scRNA-seq data since data characteristics are distinct, for example, scRNA-seq data is very sparse with a complex distribution. Some approaches especial for scRNA-seq data have been developed, including anchor-based methods, clustering-based methods and deep learning methods. Anchor-based methods identify anchors between batches, which are two cells from different batch and these two cells are mutual nearest neighbors. The batch effect is represented by the difference vectors of anchor pairs. Representative algorithms of this category include MNN [<xref ref-type="bibr" rid="CR6">6</xref>], Seurat [<xref ref-type="bibr" rid="CR7">7</xref>, <xref ref-type="bibr" rid="CR8">8</xref>], Scanorama [<xref ref-type="bibr" rid="CR9">9</xref>], BBKNN [<xref ref-type="bibr" rid="CR10">10</xref>], etc., among which MNN is the first method to adopt this idea. It computes the difference vectors between the anchor pairs identified by K nearest neighbors (KNN) algorithm and uses the Gaussian mixture model to calculate the final corrected vector. Seurat introduces the canonical correlation analysis (CCA) algorithm [<xref ref-type="bibr" rid="CR11">11</xref>] on the basis of MNN to reduce the raw data to the low-dimensional most relevant subspace, identifies anchor pairs in the subspace and applies the graph weighting algorithm to calculate the final corrected vector. BBKNN presents a random projection tree algorithm that replaces the KNN algorithm to make speed-up. Scanorama uses singular value decomposition (SVD) for dimensionality reduction, identifies anchor pairs in the low dimensionality space, mixes all batches together without the restriction that there is at least one shared cell type in all batches. Harmony [<xref ref-type="bibr" rid="CR12">12</xref>] and LIGER [<xref ref-type="bibr" rid="CR13">13</xref>] are clustering-based method. Harmony uses an iterative clustering method and ensures that cells in each cluster come from as many batches as possible during each iteration. LIGER uses a non-negative matrix factorization to maximize shared information between batches and then employs a clustering algorithm to group the shared parts. Most deep learning methods [<xref ref-type="bibr" rid="CR14">14</xref>, <xref ref-type="bibr" rid="CR15">15</xref>] are based on autoencoder or variational autoencoder. They are representative learning which removes noise by data compression and reconstruction.</p>
    <p id="Par17">The methods mentioned above perform well when the batch effect is much smaller than biological variation, since in anchor-based methods, anchors actually can be considered as the  same cell type between batches. If the batches are highly heterogeneous, these methods cannot achieve a satisfactory integration result, since wrong anchors could be popped out based on mutual nearest neighbors and consequently mislead batch correction. And Harmony maximizes batch diversity while some cell types may not be included in a batch. It has been verified in a recent comprehensive analysis and comparison [<xref ref-type="bibr" rid="CR16">16</xref>, <xref ref-type="bibr" rid="CR17">17</xref>] in which the above methods are evaluated through 10 datasets.</p>
    <p id="Par18">With the emergence of single cell atlas, tsunamic data with cell type label definitely could provide prior information for new data integration and bring biological interpretability. In this paper, a new algorithm named SSBER, that introduces biological priori information, for single cell RNA-seq dataset integration is proposed, aiming to improve batch-effect correction when high heterogeneity exist among batches (The overall process of SSBER is shown in Fig. <xref rid="Fig1" ref-type="fig">1</xref>). Experiments on various datasets in different scenarios show that: (1) when the cell type composition differs greatly among batches, SSBER performs better than other algorithms, such as Harmony, Seurat and LIGER. (2) When similar cell types exist among batches or quantity distributions of cells from various cell types are seriously unbalanced, SSBER also outperforms other algorithms.<fig id="Fig1"><label>Fig. 1</label><caption><p>Overview of SSBER<bold>.</bold>
<bold>a</bold> Input of the raw data, <bold>b</bold> projecting cell type information via SciBet, <bold>c</bold> detecting anchor pairs—based on the distance of cells from shared cell type, <bold>d</bold> integrating data guided by correction vectors from anchor pairs, <bold>e</bold> plots of integrated data</p></caption><graphic xlink:href="12859_2021_4165_Fig1_HTML" id="MO1"/></fig></p>
  </sec>
  <sec id="Sec2">
    <title>Results</title>
    <p id="Par19">To give a comprehension evaluation of SSBER, we implement some experiments on real data under three scenarios, cell-type structure across batches is not identical, similar cell types across batches exists, and quantity distribution of cells from various cell types is seriously unbalanced. And we apply SSBER to time-series datasets for comparing the variation of development trajectory, in particular compared to Harmony.</p>
    <sec id="Sec3">
      <title>Evaluation metrics</title>
      <p id="Par20">Evaluation metrics are composed of two categories, removal of batch effects and conversation of biological variance [<xref ref-type="bibr" rid="CR18">18</xref>]. The first category includes the k-nearest neighbor batch-effect test (KBET) [<xref ref-type="bibr" rid="CR16">16</xref>, <xref ref-type="bibr" rid="CR19">19</xref>], local inverse Simpson’s index (LISI) [<xref ref-type="bibr" rid="CR12">12</xref>, <xref ref-type="bibr" rid="CR16">16</xref>], average silhouette width (ASW) [<xref ref-type="bibr" rid="CR20">20</xref>]. The second category includes adjusted rand index (ARI) [<xref ref-type="bibr" rid="CR21">21</xref>], isolated label scores, cell cycle variance conservation, and overlaps of highly variable genes (HVGs) per batch before and after integration [<xref ref-type="bibr" rid="CR18">18</xref>]. Besides t-Distributed Stochastic Neighbor Embedding (t-SNE) [<xref ref-type="bibr" rid="CR22">22</xref>] as well as Uniform Manifold Approximation and Projection (UMAP) [<xref ref-type="bibr" rid="CR23">23</xref>] are employed to give visualizations.<list list-type="order"><list-item><p id="Par21"><italic>K-nearest-neighbor batch estimation (KBET)</italic> KBET measures whether batch mixing is uniform through comparison of local batch label distribution against global batch label distribution. The lower fraction of null hypothesis rejections (range from 0 to 1) represents that the local distribution is more similar to the global distribution, which means better batch mixing around a cell. Following the KBET paper [<xref ref-type="bibr" rid="CR19">19</xref>], we respectively choose 5%, 10%, 15%, 20%, and 25% of the sample size and get the median of all KBET rejection rates to produce the final KBET result for each method.</p></list-item><list-item><p id="Par22"><italic>Local inverse Simpon’s index (LISI)</italic> LISI can be used to assess goodness of batch integration(iLISI) and cell type integration (cLISI) [<xref ref-type="bibr" rid="CR12">12</xref>, <xref ref-type="bibr" rid="CR16">16</xref>]. In the case of iLISI to measure batch mixing, the index is computed for batch labels, and a score closer to the expected number of batches denotes better batch mixing. For cell type LISI (cLISI), the index is computed for all cell type labels, and a score closer to 1 denotes that the clusters contain purer cell types. Code to compute LISI is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/immunogenomics/LISI">https://github.com/immunogenomics/LISI</ext-link>. We computed the iLISI and cLISI scores for each cell in the dataset, and then determined the median values.</p></list-item><list-item><p id="Par23"><italic>Average silhouette width (ASW)</italic> The ASW indicator is similar to the LISI indicator, which can be used to assess goodness of both batch integration (ASW_batch) and cell type integration (ASW_celltype). The difference between the ASW and LISI indicators is that ASW uses the distance difference between cells within a same cluster and different clusters to measure the distribution of cells. The resulting score ranges from − 1 to 1, where a high score denotes that the cell fits well in the current cluster, while a low score denotes a poor fit. The average score of all data points is used to measure overall cell type purity (ASW_celltype) or batch mixing (ASW_batch) through the choice of labels. In terms of ASW_celltype, the higher score represents the higher purity of the cell type, as for ASW_batch, the lower score denotes a better batch-mixing performance.</p></list-item><list-item><p id="Par24"><italic>Adjusted rand index (ARI)</italic> The ARI is used to evaluate batch correction methods in terms of cell type purity. The score is calculated by using the true cell type label and the predicted cell type label. The higher ARI value denotes higher purity of the cell type.</p></list-item><list-item><p id="Par25"><italic>Isolated label scores</italic> To estimate rare cell identity annotation, isolated label scores evaluate how well the data integration methods dealt with cell identity labels shared by few batches. Specifically, we identified isolated cell labels as the labels present in the least number of batches in the integration task. The score evaluates how well these isolated labels separate from other cell identities. We implemented two versions of the isolated label metric: the isolated label F1 and isolated label ASW, the mean score of two isolated labels is returned as the final score. For specific calculation details, please see the paper [<xref ref-type="bibr" rid="CR18">18</xref>].</p></list-item><list-item><p id="Par26"><italic>HVG conservation</italic> The highly variable gene (HVG) conservation score is a proxy for the preservation of the biological signal. As in paper [<xref ref-type="bibr" rid="CR18">18</xref>], we computed the number of HVGs before and after correction for each batch via Scanpy’s highly_variable_genes function (using flavor = “cell ranger”). If available, we identified 500 HVGs per batch. If fewer than 500 genes were present in the integrated object for a batch, the number of HVGs was set to half the total genes in that batch. The overlap coefficient is defined as:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\text{overlap}}\left( {{\text{X}},{\text{Y}}} \right) = {{\left| {X \cap Y} \right|} \mathord{\left/ {\vphantom {{\left| {X \cap Y} \right|} {{\text{min}}\left( {\left| X \right|,\left| Y \right|} \right)}}} \right. \kern-\nulldelimiterspace} {{\text{min}}\left( {\left| X \right|,\left| Y \right|} \right)}}$$\end{document}</tex-math><mml:math id="M2" display="block"><mml:mrow><mml:mtext>overlap</mml:mtext><mml:mfenced close=")" open="("><mml:mrow><mml:mtext>X</mml:mtext><mml:mo>,</mml:mo><mml:mtext>Y</mml:mtext></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mrow><mml:mfenced close="|" open="|"><mml:mrow><mml:mi>X</mml:mi><mml:mo>∩</mml:mo><mml:mi>Y</mml:mi></mml:mrow></mml:mfenced><mml:mrow><mml:mo stretchy="true">/</mml:mo></mml:mrow><mml:mrow><mml:mtext>min</mml:mtext><mml:mfenced close=")" open="("><mml:mrow><mml:mfenced close="|" open="|"><mml:mi>X</mml:mi></mml:mfenced><mml:mo>,</mml:mo><mml:mfenced close="|" open="|"><mml:mi>Y</mml:mi></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mrow></mml:math><graphic xlink:href="12859_2021_4165_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where X and Y denote the HVGs before and after correction. The overall HVG score is the mean of the per-batch HVG overlap coefficients. Since Harmony and LIGER return data after dimension reduction, it is almost impossible to compute HVG score for them, these scores are omitted in Tables <xref rid="Tab1" ref-type="table">1</xref>, <xref rid="Tab2" ref-type="table">2</xref>, <xref rid="Tab3" ref-type="table">3</xref>, <xref rid="Tab4" ref-type="table">4</xref>, <xref rid="Tab5" ref-type="table">5</xref> and <xref rid="Tab6" ref-type="table">6</xref>.<table-wrap id="Tab1"><label>Table 1</label><caption><p>Metrics on the human blood dendritic cell dataset</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"><italic>Seurat</italic></th><th align="left"><italic>Harmony</italic></th><th align="left"><italic>SSBER</italic></th><th align="left"><italic>LIGER</italic></th></tr></thead><tbody><tr><td align="left">iLISI</td><td char="." align="char"><bold>1.5804</bold></td><td char="." align="char">1.4912</td><td char="." align="char">1.4125</td><td char="." align="char">1.342</td></tr><tr><td align="left">cLISI</td><td char="." align="char">1.3951</td><td char="." align="char">1.1733</td><td char="." align="char"><bold>1.1652</bold></td><td char="." align="char">1.4322</td></tr><tr><td align="left">ARI</td><td char="." align="char">0.707</td><td char="." align="char">0.7806</td><td char="." align="char"><bold>0.8496</bold></td><td char="." align="char">0.6824</td></tr><tr><td align="left">ASW_batch</td><td char="." align="char">0.064</td><td char="." align="char">0.037</td><td char="." align="char"><bold>0.031</bold></td><td char="." align="char">0.059</td></tr><tr><td align="left">ASW_celltype</td><td char="." align="char">0.186</td><td char="." align="char">0.336</td><td char="." align="char"><bold>0.395</bold></td><td char="." align="char">0.168</td></tr><tr><td align="left">Isolated label</td><td char="." align="char">0.387</td><td char="." align="char">0.416</td><td char="." align="char"><bold>0.623</bold></td><td char="." align="char">0.327</td></tr><tr><td align="left">Cell cycle</td><td char="." align="char">0.473</td><td char="." align="char"><bold>0.636</bold></td><td char="." align="char">0.583</td><td char="." align="char">0.450</td></tr><tr><td align="left">HVG</td><td char="." align="char">0.613</td><td char="." align="char"/><td char="." align="char"><bold>0.624</bold></td><td char="." align="char"/></tr></tbody></table><table-wrap-foot><p>Bold represents the best indicator among four algorithms</p></table-wrap-foot></table-wrap></p></list-item><list-item><p id="Par27"><italic>Cell cycle conservation</italic> The cell cycle conservation score evaluates how well the cell cycle effect can be scored before and after integration. We computed cell cycle conservation scores using the same calculation process as in paper [<xref ref-type="bibr" rid="CR18">18</xref>]. Score closes to 0 indicating lower conservation and 1 indicating complete conservation of the variance explained by cell cycle.</p></list-item></list></p>
    </sec>
    <sec id="Sec4">
      <title>Scenario 1: cell type structure across batches is not identical</title>
      <p id="Par28">We collected two published datasets, human blood cell dendritic data [<xref ref-type="bibr" rid="CR24">24</xref>] and human pancreas data [<xref ref-type="bibr" rid="CR25">25</xref>, <xref ref-type="bibr" rid="CR26">26</xref>]. In human blood cell dendritic data, pDC and DoubleNeg are shared cell types in both batches. We delete CD1C cells in the first batch and CD141 cells in the second batch, so they respectively appear in two different batches. As shown in Fig. <xref rid="Fig2" ref-type="fig">2</xref>a, the visualization of the raw data, DoubleNeg and pDC are completely separated due to the batch effects. As shown in Fig. <xref rid="Fig2" ref-type="fig">2</xref>b, SSBER achieves the best data integration performance. Batch effects are removed, cells of same subpopulation are mixed well and different subpopulations even similar subpopulations are separated. As shown in Fig. <xref rid="Fig2" ref-type="fig">2</xref>c, Seurat mixes CD141 and CD1C together after data integration. The main reason is that Seurat mismatches anchors which in return mislead batch correction. As shown in Fig. <xref rid="Fig2" ref-type="fig">2</xref>d, although Harmony separates all cell types well while mixing them in batches, some cells of DoubleNeg and pDC are also separated from the main cluster and could be grouped into a new cluster. The reason lies on maximization of batch diversity within a cluster. LIGER mixes CD141 and pDC, CD1C and DoubleNeg together after data integration (Fig. <xref rid="Fig2" ref-type="fig">2</xref>e) since it also tries to maximize the shared space across batches.<fig id="Fig2"><label>Fig. 2</label><caption><p>Comparison on the human blood cell dendritic data. <bold>a</bold> Visualization for raw data, <bold>b</bold> UMAP analysis on the integrated data after SSBER, <bold>c</bold> UMAP analysis on the integrated data after Seurat, <bold>d</bold> UMAP analysis on the integrated data after Harmony. <bold>e</bold> UMAP analysis on the integrated data after LIGER</p></caption><graphic xlink:href="12859_2021_4165_Fig2_HTML" id="MO2"/></fig></p>
      <p id="Par29">As shown in Table <xref rid="Tab1" ref-type="table">1</xref>, SSBER achieves the best performance on the cell type purity, cLISI, ASW_celltype and ARI reaching 1.165224, 0.395 and 0.8489714 respectively. Seurat, Harmony, and LIGER mix CD141 and CD1C cells in the integrated data and split pDC cells into two clusters, so the indicators for measuring cell purity are not as good as SSBER. On the metrics indicating batch mixing, SSBER is best on ASW_batch and Seurat is best on iLISI. As for metrics on conversation of biological variance, SSBER achieves the best performance on isolated label score and HVG conservation score, Harmony is the best on cell type conservation score. As for KBET score, shown in Fig. <xref rid="Fig3" ref-type="fig">3</xref>, SSBER is basically comparable with Harmony and better than Seurat and LIGER.<fig id="Fig3"><label>Fig. 3</label><caption><p>KBET score on the human blood dendritic cell dataset</p></caption><graphic xlink:href="12859_2021_4165_Fig3_HTML" id="MO3"/></fig></p>
      <p id="Par30">In order to further explore the effect of SSBER on the fusion of multiple batches, we reformed human pancreas dataset. Instances of some cell types were removed for each batch, for example, we removed all alpha cells from the celseq dataset, all beta cells from the smartseq2 dataset. After perturbation, acinar is a shared cell type among all batches, delta, beta and ductal cells only appear in two batches, and acitivated_stellate, alpha, endothelial, and gamma belong to only one batch. The detail dataset description is shown in Table <xref rid="Tab2" ref-type="table">2</xref>.<table-wrap id="Tab2"><label>Table 2</label><caption><p>Detail description on the human pancreas dataset</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"><italic>celseq</italic></th><th align="left"><italic>celseq2</italic></th><th align="left"><italic>smartseq2</italic></th></tr></thead><tbody><tr><td align="left">Acinar</td><td align="left">✓</td><td align="left">×</td><td align="left">✓</td></tr><tr><td align="left">Beta</td><td align="left">✓</td><td align="left">×</td><td align="left">✓</td></tr><tr><td align="left">Delta</td><td align="left">✓</td><td align="left">✓</td><td align="left">✓</td></tr><tr><td align="left">Activated</td><td align="left">✓</td><td align="left">✓</td><td align="left">×</td></tr><tr><td align="left">Alpha</td><td align="left">✓</td><td align="left">×</td><td align="left">×</td></tr><tr><td align="left">Ductal</td><td align="left">×</td><td align="left">✓</td><td align="left">✓</td></tr><tr><td align="left">Gamma</td><td align="left">×</td><td align="left">✓</td><td align="left">×</td></tr><tr><td align="left">Endothelial</td><td align="left">×</td><td align="left">✓</td><td align="left">×</td></tr></tbody></table></table-wrap></p>
      <p id="Par31">SSBER, Seurat, Harmony and LIGER were also used to integrate this perturbed dataset. SSBER effectively separates the above cell types with a good batch mixing, shown in Fig. <xref rid="Fig4" ref-type="fig">4</xref>b. As shown in Fig. <xref rid="Fig4" ref-type="fig">4</xref>c, Seurat mixes alpha with gamma, beta with delta cells. The reason lies on that KNN algorithm pops out some anchor pairs in which two cells are not a same cell type. These wrong anchors lead to the cells from different subpopulations being mixed together. As shown in Fig. <xref rid="Fig4" ref-type="fig">4</xref>d, e, Harmony and LIGER totally integrates delta, beta, gamma, and alpha cells into a large cluster. Harmony is a clustering-based algorithm, the objective function of it includes as many batches as possible in a cluster, so when the cell type structure differs greatly among batches, cells from different subpopulations will be mixed incorrectly.<fig id="Fig4"><label>Fig. 4</label><caption><p>Comparison on the reformed human pancreas dataset. <bold>a</bold> Visualization for raw data, <bold>b</bold> UMAP analysis on the integrated data after SSBER, <bold>c</bold> UAMP analysis on the integrated data after Seurat, <bold>d</bold> UAMP analysis on the integrated data after Harmony. <bold>e</bold> UAMP analysis on the integrated data after LIGER</p></caption><graphic xlink:href="12859_2021_4165_Fig4_HTML" id="MO4"/></fig></p>
      <p id="Par32">SSBER is the best one in terms of isolated label, cell type conservation score and HVG conservation score that measure on the conservation of biological variance, shown in Table <xref rid="Tab3" ref-type="table">3</xref>. SSBER is also best in terms of ARI, ASW_celltype and cLISI that measure on the cell type purity. On the metrics indicating the degree of batch mixing, such as ASW_batch and iLISI, superficially SSBER is slightly inferior to Seurat, Harmony and LIGER. The main reason is that when there are many subpopulations that are not shared between batches, SSBER will not mix these cells like other algorithms, but integrate data strictly according to the cell type, while ASW_batch and iLISI only evaluate the uniformity of batch mixing without same cell type constraint, at this time, mixing more cells across batches even wrong mixing that means different subpopulations could reach better score. As for KBET score, shown in Fig. <xref rid="Fig5" ref-type="fig">5</xref>, SSBER is basically comparable with Harmony, Seurat and LIGER.<table-wrap id="Tab3"><label>Table 3</label><caption><p>Metrics on the human pancreas dataset</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"><italic>Seurat</italic></th><th align="left"><italic>Harmony</italic></th><th align="left"><italic>SSBER</italic></th><th align="left"><italic>LIGER</italic></th></tr></thead><tbody><tr><td align="left">iLISI</td><td char="." align="char"><bold>1.878475</bold></td><td char="." align="char">1.864391</td><td char="." align="char">1.46051</td><td char="." align="char">1.8448</td></tr><tr><td align="left">cLISI</td><td char="." align="char">1.2320</td><td char="." align="char">1.3623</td><td char="." align="char"><bold>1.0169</bold></td><td char="." align="char">1.2632</td></tr><tr><td align="left">ARI</td><td char="." align="char">0.6649</td><td char="." align="char">0.5393</td><td char="." align="char"><bold>0.8599</bold></td><td char="." align="char">0.5839</td></tr><tr><td align="left">ASW_batch</td><td char="." align="char">0.026</td><td char="." align="char"><bold>0.015</bold></td><td char="." align="char">0.032</td><td char="." align="char">0.018</td></tr><tr><td align="left">ASW_celltype</td><td char="." align="char">0.523</td><td char="." align="char">0.404</td><td char="." align="char"><bold>0.786</bold></td><td char="." align="char">0.518</td></tr><tr><td align="left">Isolated label</td><td char="." align="char">0.738</td><td char="." align="char">0.702</td><td char="." align="char"><bold>0.921</bold></td><td char="." align="char">0.673</td></tr><tr><td align="left">Cell cycle</td><td char="." align="char">0.606</td><td char="." align="char">0.681</td><td char="." align="char"><bold>0.703</bold></td><td char="." align="char">0.583</td></tr><tr><td align="left">HVG</td><td char="." align="char">0.702</td><td char="." align="char"/><td char="." align="char"><bold>0.747</bold></td><td char="." align="char"/></tr></tbody></table><table-wrap-foot><p>Bold represents the best indicator among four algorithms</p></table-wrap-foot></table-wrap><fig id="Fig5"><label>Fig. 5</label><caption><p>KBET score on the human pancreatic dataset</p></caption><graphic xlink:href="12859_2021_4165_Fig5_HTML" id="MO5"/></fig></p>
      <p id="Par33">It is easy to conclude that, when the cell type structure is heterogeneous among batches, SSBER performs better than Seurat, Harmony and LIGER. If there are unshared subpopulations among batches, iLISI, KBET and ASW_batch scores are not good metrics since they measure the uniformity of batch mixing.</p>
    </sec>
    <sec id="Sec5">
      <title>Scenario 2: similar cell types exist across batches</title>
      <p id="Par34">We collected the human peripheral blood mononuclear dataset [<xref ref-type="bibr" rid="CR27">27</xref>], in which the cell type structure between batches is basically similar and there are two pairs of similar cell types, CD4 T and CD8 T, Monocyte_CD14 and Monocyte_FCGR3A.</p>
      <p id="Par35">As shown in Fig. <xref rid="Fig6" ref-type="fig">6</xref>, none of SSBER, Seurat, Harmony and LIGER could generate distinct clusters of Monocyte_CD14 and Monocyte_FCGR3A, or CD4 T and CD8 T in the visualization plots.<fig id="Fig6"><label>Fig. 6</label><caption><p>Comparison on the human peripheral blood mononuclear dataset. <bold>a</bold> Visualization for raw data, <bold>b</bold> UMAP analysis on the integrated data after SSBER, <bold>c</bold> UMAP analysis on the integrated data after Seurat, <bold>d</bold> UMAP analysis on the integrated data after Harmony. <bold>e</bold> UMAP analysis on the integrated data after LIGER</p></caption><graphic xlink:href="12859_2021_4165_Fig6_HTML" id="MO6"/></fig></p>
      <p id="Par36">As shown in Table <xref rid="Tab4" ref-type="table">4</xref>, SSBER is best, except on iLISI and cell type conservation score. Since CD4 T cells and CD8 T cells are hard to be distinguished, we specially calculated the cLISI score for CD4 T cells and CD8 T cells, Seurat, Harmony, LIGER and SSBER reach 1.1323, 1.2836, 1.224 and 1.377 respectively, SSBER is the best. The KBET score is shown in Fig. <xref rid="Fig7" ref-type="fig">7</xref> and we can see that SSBER is the top method regardless of the sampling ratio, and Seurat ranks the second.<table-wrap id="Tab4"><label>Table 4</label><caption><p>Metrics on the human peripheral blood mononuclear dataset</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"><italic>Seurat</italic></th><th align="left"><italic>Harmony</italic></th><th align="left"><italic>SSBER</italic></th><th align="left"><italic>LIGER</italic></th></tr></thead><tbody><tr><td align="left">iLISI</td><td char="." align="char">1.458856</td><td char="." align="char">1.562768</td><td char="." align="char">1.578711</td><td char="." align="char"><bold>1.58021</bold></td></tr><tr><td align="left">cLISI</td><td char="." align="char">1.074385</td><td char="." align="char">1.065975</td><td char="." align="char"><bold>1.048792</bold></td><td char="." align="char">1.0723</td></tr><tr><td align="left">ARI</td><td char="." align="char">0.5720612</td><td char="." align="char">0.6247241</td><td char="." align="char"><bold>0.696191</bold></td><td char="." align="char">0.61782</td></tr><tr><td align="left">ASW_batch</td><td char="." align="char">0.064</td><td char="." align="char">0.096</td><td char="." align="char"><bold>0.056</bold></td><td char="." align="char">0.089</td></tr><tr><td align="left">ASW_celltype</td><td char="." align="char">0.348</td><td char="." align="char">0.329</td><td char="." align="char"><bold>0.387</bold></td><td char="." align="char">0.319</td></tr><tr><td align="left">Isolated label</td><td char="." align="char">0.501</td><td char="." align="char">0.583</td><td char="." align="char"><bold>0.606</bold></td><td char="." align="char">0.469</td></tr><tr><td align="left">Cell cycle</td><td char="." align="char">0.674</td><td char="." align="char"><bold>0.761</bold></td><td char="." align="char">0.733</td><td char="." align="char">0.612</td></tr><tr><td align="left">HVG</td><td char="." align="char">0.729</td><td char="." align="char"/><td char="." align="char"><bold>0.815</bold></td><td char="." align="char"/></tr></tbody></table><table-wrap-foot><p>Bold represents the best indicator among four algorithms</p></table-wrap-foot></table-wrap><fig id="Fig7"><label>Fig. 7</label><caption><p>KBET scores on the human peripheral blood mononuclear dataset</p></caption><graphic xlink:href="12859_2021_4165_Fig7_HTML" id="MO7"/></fig></p>
    </sec>
    <sec id="Sec6">
      <title>Scenario 3: distribution of cells from various cell types is seriously unbalanced</title>
      <p id="Par37">To compare the data-correction performance of four algorithms when the quantity distribution of cells from various cell types is seriously unbalanced, we collected the mouse retinal cell dataset [<xref ref-type="bibr" rid="CR16">16</xref>] and the 293t_jurkat cell line dataset [<xref ref-type="bibr" rid="CR27">27</xref>] as experimental datasets.</p>
      <p id="Par38">As shown in Fig. <xref rid="Fig8" ref-type="fig">8</xref>, in the mouse retina dataset, bipolar cells monopolizes batch 1 while rod cells monopolizes batch 2, and ganglion, vascular endothelium as well as horizontal cells do not exist in batch 1. Due to the large number of cell types, it is hard to visually distinguish the results after data integration from four algorithms. We count on evaluation metrics. It is shown in Table <xref rid="Tab5" ref-type="table">5</xref>, SSBER outperforms other alorithms on the metrics of cLISI, ARI and ASW_celltype, which reflect the cell type purity. Especially on ARI, SSBER is much better than the other three algorithms. Since some cell types are not shared in both batches, the credibility of iLISI and ASW_batch should be compromised. As for label-free conservation metrics, SSBER achieves the best performance on isolated label score and HVG conservation score, Harmony is the best on cell type conservation score. In the term of KBET, SSBER and Harmony are similar and better than Seurat and LIGER (Fig. <xref rid="Fig9" ref-type="fig">9</xref>).<table-wrap id="Tab5"><label>Table 5</label><caption><p>Metrics on the mouse retina dataset</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"><italic>Seurat</italic></th><th align="left"><italic>Harmony</italic></th><th align="left"><italic>SSBER</italic></th><th align="left"><italic>LIGER</italic></th></tr></thead><tbody><tr><td align="left">iLISI</td><td char="." align="char">1.166076</td><td char="." align="char"><bold>1.200744</bold></td><td char="." align="char">1.146624</td><td char="." align="char">1.17424</td></tr><tr><td align="left">cLISI</td><td char="." align="char">1.054624</td><td char="." align="char">1.36209</td><td char="." align="char"><bold>1.044166</bold></td><td char="." align="char">1.2365</td></tr><tr><td align="left">ARI</td><td char="." align="char">0.6525991</td><td char="." align="char">0.53935</td><td char="." align="char"><bold>0.850938</bold></td><td char="." align="char">0.54793</td></tr><tr><td align="left">ASW_batch</td><td char="." align="char"><bold>0.142</bold></td><td char="." align="char">0.145</td><td char="." align="char">0.148</td><td char="." align="char">0.184</td></tr><tr><td align="left">ASW_celltype</td><td char="." align="char">0.673</td><td char="." align="char">0.684</td><td char="." align="char"><bold>0.765</bold></td><td char="." align="char">0.703</td></tr><tr><td align="left">Isolated label</td><td char="." align="char">0.592</td><td char="." align="char">0.647</td><td char="." align="char"><bold>0.783</bold></td><td char="." align="char">0.618</td></tr><tr><td align="left">Cell cycle</td><td char="." align="char">0.521</td><td char="." align="char"><bold>0.587</bold></td><td char="." align="char">0.556</td><td char="." align="char">0.538</td></tr><tr><td align="left">HVG</td><td char="." align="char">0.529</td><td char="." align="char"/><td char="." align="char"><bold>0.582</bold></td><td char="." align="char"/></tr></tbody></table><table-wrap-foot><p>Bold represents the best indicator among four algorithms</p></table-wrap-foot></table-wrap><fig id="Fig8"><label>Fig. 8</label><caption><p>Comparison on the mouse retinal cell dataset. <bold>a</bold> Visualization for raw data, <bold>b</bold> UMAP analysis on the integrated data after SSBER, <bold>c</bold> UMAP analysis on the integrated data after Seurat, <bold>d</bold> UMAP analysis on the integrated data after Harmony. <bold>e</bold> UMAP analysis on the integrated data after LIGER</p></caption><graphic xlink:href="12859_2021_4165_Fig8_HTML" id="MO8"/></fig><fig id="Fig9"><label>Fig. 9</label><caption><p>KBET scores on the mouse retina dataset</p></caption><graphic xlink:href="12859_2021_4165_Fig9_HTML" id="MO9"/></fig></p>
      <p id="Par39">In the 293t_jurkat cell line data, the cell type structure between batches is basically similar and only two cell types 293t and jurkat are contained. The ratio of the number of 293t cells to jurkat cells in batch 1 is 1:9, while this ratio in batch 2 is 5:5.</p>
      <p id="Par40">It can be seen there are obvious batch effects from the visualization of the raw data (Fig. <xref rid="Fig10" ref-type="fig">10</xref>a). Seurat, Harmony and LIGER are more likely to divide jurkat cells into two clusters (Fig. <xref rid="Fig10" ref-type="fig">10</xref>c–e), and SSBER gives a much closer group of jurkat cells. It is also shown in Table <xref rid="Tab6" ref-type="table">6</xref>, SSBER gets 0.994 on ARI score, much better than 0.864 of LIGER and 0.885 of Harmony. Besides, on all other metrics, including iLISI, cLISI, ASW_batch, ASW_celltype (Table <xref rid="Tab6" ref-type="table">6</xref>) and KBET (Fig. <xref rid="Fig11" ref-type="fig">11</xref>), SSBER is also the best one.<table-wrap id="Tab6"><label>Table 6</label><caption><p>Metrics on the cell line dataset</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"><italic>Seurat</italic></th><th align="left"><italic>Harmony</italic></th><th align="left"><italic>SSBER</italic></th><th align="left"><italic>LIGER</italic></th></tr></thead><tbody><tr><td align="left">iLISI</td><td char="." align="char">1.369536</td><td char="." align="char">1.48654</td><td char="." align="char"><bold>1.56786</bold></td><td char="." align="char">1.46342</td></tr><tr><td align="left">cLISI</td><td char="." align="char">1.005186</td><td char="." align="char">1.0045738</td><td char="." align="char"><bold>1.000456</bold></td><td char="." align="char">1.00428</td></tr><tr><td align="left">ARI</td><td char="." align="char">0.7753852</td><td char="." align="char">0.885436</td><td char="." align="char"><bold>0.993591</bold></td><td char="." align="char">0.86463</td></tr><tr><td align="left">ASW_batch</td><td char="." align="char">0.167</td><td char="." align="char">0.146</td><td char="." align="char"><bold>0.086</bold></td><td char="." align="char">0.186</td></tr><tr><td align="left">ASW_celltype</td><td char="." align="char">0.447</td><td char="." align="char">0.668</td><td char="." align="char"><bold>0.783</bold></td><td char="." align="char">0.658</td></tr><tr><td align="left">Isolated label</td><td char="." align="char">0.729</td><td char="." align="char">0.858</td><td char="." align="char"><bold>0.925</bold></td><td char="." align="char">0.837</td></tr><tr><td align="left">Cell cycle</td><td char="." align="char">0.618</td><td char="." align="char"><bold>0.707</bold></td><td char="." align="char">0.662</td><td char="." align="char">0.609</td></tr><tr><td align="left">HVG</td><td char="." align="char">0.726</td><td char="." align="char"/><td char="." align="char"><bold>0.784</bold></td><td char="." align="char"/></tr></tbody></table><table-wrap-foot><p>Bold represents the best indicator among four algorithms</p></table-wrap-foot></table-wrap><fig id="Fig10"><label>Fig. 10</label><caption><p>Comparison on the 293t_jurkat cell line data. <bold>a</bold> Visualization for raw data, <bold>b</bold> UMAP analysis on the integrated data after SSBER, <bold>c</bold> UMAP analysis on the integrated data after Seurat, <bold>d</bold> UMAP analysis on the integrated data after Harmony. <bold>e</bold> UMAP analysis on the integrated data after LIGER</p></caption><graphic xlink:href="12859_2021_4165_Fig10_HTML" id="MO10"/></fig><fig id="Fig11"><label>Fig. 11</label><caption><p>KBET scores on the cell line dataset</p></caption><graphic xlink:href="12859_2021_4165_Fig11_HTML" id="MO11"/></fig></p>
    </sec>
    <sec id="Sec7">
      <title>Time course developmental trajectories analysis</title>
      <p id="Par41">To explore the integrating performance of SSBER in analysis of time course developmental trajectories, we implemented the same experiment as Harmony [<xref ref-type="bibr" rid="CR12">12</xref>]. The datasets include eight times points of mouse hematopoiesis, from E6.75 to E8.5 and mixed gastrulation. After data integration, we used the DDRTree method in the monocle package [<xref ref-type="bibr" rid="CR28">28</xref>] to perform trajectory analysis, shown in Fig. <xref rid="Fig12" ref-type="fig">12</xref>. Both SSBER and Harmony recovered a branching trajectory structure that correctly captures the progression from common mesoderm and hematoendothelial progenitor populations to differentiated endothelial and erythroid populations. And SSBER also preserved the separation between the two blood progenitor populations and among the three erythroid populations. LIGER failed to present a clear branching trajectory structure and separate some distinct populations. MultiCCA failed to converge to an answer, as some of the samples contained too few cells, causing the Seurat optimization step to fail to converge.<fig id="Fig12"><label>Fig. 12</label><caption><p>Time course developmental trajectories analysis. <bold>a</bold> Visualization for the trajectory analysis after Harmony, <bold>b</bold> visualization for the trajectory analysis after SSBER, <bold>c</bold> visualization for the trajectory analysis after LIGER</p></caption><graphic xlink:href="12859_2021_4165_Fig12_HTML" id="MO12"/></fig></p>
    </sec>
    <sec id="Sec8">
      <title>Robustness analysis</title>
      <p id="Par42">Determining some genes for scRNA-seq data analysis is to avoid curse of dimensionality. Usually, genes are selected based on the variance of expression abundance. In this section, we checked the robustness of SSBER for the number of selected genes. The results are shown in Fig. <xref rid="Fig13" ref-type="fig">13</xref> in terms of ARI on the above five datasets. The number of genes with most variances are set as 500, 1000, 2000, 3000, 4000 and 5000 respectively. It can be seen that SSBER has good robustness since the ARI scores basically keep stable. The suggestion of the number of genes seems to be 3000 to 5000.<fig id="Fig13"><label>Fig. 13</label><caption><p>ARI scores under different numbers of genes</p></caption><graphic xlink:href="12859_2021_4165_Fig13_HTML" id="MO13"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec9">
    <title>Discussion</title>
    <p id="Par43">SSBER depends on a supervised classifier to label cell types with high precision. By now, SciBet is one of the best classifiers. It is easy for SSBER to transfer to other classifiers. At present, classifiers of more than 100 common cell type of humans and mice have been provided [<xref ref-type="bibr" rid="CR29">29</xref>]. If some new tissues or new cell types are not covered in them, researchers could try to find the relevant labeled datasets to train corresponding classifiers. Although the current public datasets cannot support the needs of all human and mouse cell types, the human cell atlas and other animal cell atlases become more and more complete, the labeled datasets and corresponding classifiers will become more abundant. In the worst case, valid cell population labels cannot be provided, anchors could be identified without constraint of common cell type, SSBER degenerates to Seurat.</p>
  </sec>
  <sec id="Sec10">
    <title>Conclusions</title>
    <p id="Par44">In this paper, a method named SSBER to remove batch effect of scRNA-seq data is presented. SSBER considers the partial shared cell types predicted by a cell annotation algorithm and detects mutual neighbor cell pairs among the shared cell types, which improves the accuracy of anchors. Besides, batch effects are calculated for each cell type, unlike Seurat, Scanorama and BBKNN with global treatment. Therefore, when batches are highly heterogeneous, especially when the cell type structure among batches or distribution of cell population varies considerably, or some similar cell types exist across batches, SSBER outperforms other algorithms about integrating scRNA-seq data.</p>
  </sec>
  <sec id="Sec11">
    <title>Methods</title>
    <p id="Par45">To remove batch effect, it is ideal that some cells are sequenced in each batch which work as control to calibrate batch effects. Those same cells across batches act as anchors. Actually, cells of a same cell type are the realistic alternative of anchors. Usually, anchors are identified from pairs of cells, in which (1) two cells (<inline-formula id="IEq1"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j_{1}$$\end{document}</tex-math><mml:math id="M4"><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2021_4165_Article_IEq1.gif"/></alternatives></inline-formula>,<inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j_{2}$$\end{document}</tex-math><mml:math id="M6"><mml:msub><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2021_4165_Article_IEq2.gif"/></alternatives></inline-formula>) come from two batches (B<sub>1</sub>, B<sub>2</sub>) and (2) <inline-formula id="IEq3"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j_{1}$$\end{document}</tex-math><mml:math id="M8"><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2021_4165_Article_IEq3.gif"/></alternatives></inline-formula> is one of the k cells in batch B<sub>1</sub> with the smallest distances to <inline-formula id="IEq4"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j_{2}$$\end{document}</tex-math><mml:math id="M10"><mml:msub><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2021_4165_Article_IEq4.gif"/></alternatives></inline-formula>, and vice versa <inline-formula id="IEq5"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j_{2}$$\end{document}</tex-math><mml:math id="M12"><mml:msub><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2021_4165_Article_IEq5.gif"/></alternatives></inline-formula> is one of the k cells in batch B<sub>2</sub> with the smallest distances to <inline-formula id="IEq6"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j_{1}$$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2021_4165_Article_IEq6.gif"/></alternatives></inline-formula>. The differences between gene abundance of (<inline-formula id="IEq7"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j_{1}$$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2021_4165_Article_IEq7.gif"/></alternatives></inline-formula>,<inline-formula id="IEq8"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j_{2}$$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2021_4165_Article_IEq8.gif"/></alternatives></inline-formula>) represent batch effects.</p>
    <p id="Par46">Traditional data integration methods based on the anchor idea, such as MNN, Seurat, and BBKNN, must follow three assumptions [<xref ref-type="bibr" rid="CR7">7</xref>]:<list list-type="order"><list-item><p id="Par47">There is at least one cell population that is present in both batches (i.e., in the reference and the new batch to be merged with it).</p></list-item><list-item><p id="Par48">The batch effects are almost orthogonal to the biological subspace.</p></list-item><list-item><p id="Par49">Variation in the batch effects across cells is much smaller than the variation in the biological effects between different cell types.</p></list-item></list></p>
    <p id="Par50">In fact, the assumptions might not hold up in real data, particularly given that different batches may easily differ in many aspects, including samples used, single cell capture method, or library preparation approach. If true biological variations are not orthogonal to batch effects, or differences from batch effect are not smaller than its from biological variations, traditional methods will meet a big challenge. Anchor pairs detected by KNN method may be cells from different cell types, misleading the batch-effect correction. For example, under the scenario depicted in Fig. <xref rid="Fig14" ref-type="fig">14</xref>, MNN leads to cluster 1 (C1) and cluster 2 (C2) mis-corrected due to mismatching single cells in the two clusters/cell-types across batches [<xref ref-type="bibr" rid="CR6">6</xref>].<fig id="Fig14"><label>Fig. 14</label><caption><p>Detecting mutual nearest neighbors between two batches in non-orthogonal scenario</p></caption><graphic xlink:href="12859_2021_4165_Fig14_HTML" id="MO14"/></fig></p>
    <p id="Par51">What’s more, we collected the cell line dataset [<xref ref-type="bibr" rid="CR16">16</xref>] as an example to illustrate the impact of anchor pairs. The overall data visualization is shown in Fig. <xref rid="Fig15" ref-type="fig">15</xref>a. The datasets contain only two cell types, with two out of the three batches containing only one cell type that is also only shared with the third batch. Cell types, jurkat and 293t, appear separately in batch 1 and batch 2. After integration, Seurat or MNN produces four batch-mixed clusters, but with two cell types mixing (Fig. <xref rid="Fig15" ref-type="fig">15</xref>b, c), and the ARI (Adjusted rand index, one indication of clustering accuracy) only reaches 0.63, which seriously damages structure of the raw data. Through further analysis of the anchor pairs identified in Seurat, we find that about 63.13% of 8012 anchor pairs are not from the same cell type, that is, a large number of wrong anchor pairs seriously affect the final data integration performance.<fig id="Fig15"><label>Fig. 15</label><caption><p>An example to illustrate the impact of anchor pairs. <bold>a</bold> Visualization for the cell line datasets, <bold>b</bold> UMAP analysis on the integrated data after Seurat, <bold>c</bold> clustering on the integrated data after Seurat</p></caption><graphic xlink:href="12859_2021_4165_Fig15_HTML" id="MO15"/></fig></p>
    <p id="Par52">To address those issues, here we present SSBER, a supervised method utilizing biological prior knowledge combined with anchor-based approach. The key idea of SSBER is to improve accuracy of detected anchors, two cells of which should come from a same cell type, consequently to improve performance of integration. SSBER first employs a supervised classifier to group cells with high confidence, then identifies anchors in shared cell type, which breaks the constraints that batch effects are orthogonal to the biological subspace and differences from batch effects are much smaller than its from biological variations.</p>
    <p id="Par53">The framework of SSBER is shown in Fig. <xref rid="Fig1" ref-type="fig">1</xref>, that includes four parts: (1) data preprocessing, Single-cell gene expression data from different batches are considered as input data and preprocessed according to the standardized process in Seurat software package (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a). (2) Identification of shared cell types, SSBER utilizes SciBet (a single cell annotation tool) to annotate cell types (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b), then identifies shared cell types. (3) Anchor detection, anchor pairs are detected in shared cell types (Fig. <xref rid="Fig1" ref-type="fig">1</xref>c). (4) Data integration, correction vectors for each cell are computed from anchor pairs (Fig. <xref rid="Fig1" ref-type="fig">1</xref>d, e).</p>
    <sec id="Sec12">
      <title>Data preprocessing</title>
      <p id="Par54">SSBER normalizes each cell using natural logarithmic transformation method with a factor of 10,000. Next, it uses z-score transformation to standardize the expression value of each gene. In order to avoid curse of dimension, top genes in variance are selected.</p>
    </sec>
    <sec id="Sec13">
      <title>Identification of shared cell types</title>
      <p id="Par55">After making a comparison of SciBet [<xref ref-type="bibr" rid="CR29">29</xref>] with ScMap [<xref ref-type="bibr" rid="CR30">30</xref>], Garnett [<xref ref-type="bibr" rid="CR31">31</xref>], CellAsign [<xref ref-type="bibr" rid="CR32">32</xref>] and so on, SSBER uses SciBet [<xref ref-type="bibr" rid="CR29">29</xref>] to annotate cell type in each batch, consequently some shared cell types could be identified within labelled cells with high confidence. SciBet is a supervised model that predicts cell type for query data [<xref ref-type="bibr" rid="CR29">29</xref>]. In order to ensure the annotation accuracy, the probability threshold of a cell type given by SciBet is set to 0.8, otherwise, cell type is assigned as unknown.</p>
    </sec>
    <sec id="Sec14">
      <title>Anchor identification</title>
      <p id="Par56">First, the raw data is mapped to a shared low-dimensional space through CCA (canonical correlation analysis). The typical correlation vector calculated by CCA can capture the shared signals between batches. Then KNN algorithm is employed to detect mutual nearest neighbors within a shared cell type in both original data space and low dimensional space. Those mutual nearest pairs in both spaces are identified as anchors [<xref ref-type="bibr" rid="CR9">9</xref>].</p>
    </sec>
    <sec id="Sec15">
      <title>Data integration</title>
      <p id="Par57">SSBER calculates correction vector for each cell in combination with Gaussian kernel weights. More importantly, correction vector for a cell with a shared cell type is computed only from anchors within the same cell type, it could ensure distinguishing local batch effect on each cell type. If cell type is unknown, near anchors without cell type constraint are used to compute correction vector for a cell.
</p>
      <p id="Par58">Since SSBER detects anchors only in shared cell types, it not only improve the accuracy of anchors which actually in biological motivation should come from a same cell type, but also in the case of multi-batch data integration, the final integration result will not be affected by the order of batch integration.
</p>
    </sec>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>ASW</term>
        <def>
          <p id="Par4">Average silhouette width</p>
        </def>
      </def-item>
      <def-item>
        <term>ARI</term>
        <def>
          <p id="Par5">Adjusted rand index</p>
        </def>
      </def-item>
      <def-item>
        <term>CCA</term>
        <def>
          <p id="Par6">Canonical correlation analysis</p>
        </def>
      </def-item>
      <def-item>
        <term>HVG</term>
        <def>
          <p id="Par7">Highly variable gene</p>
        </def>
      </def-item>
      <def-item>
        <term>KBET</term>
        <def>
          <p id="Par8">K-nearest-neighbor batch estimation</p>
        </def>
      </def-item>
      <def-item>
        <term>KNN</term>
        <def>
          <p id="Par9">K-nearest neighbor</p>
        </def>
      </def-item>
      <def-item>
        <term>LISI</term>
        <def>
          <p id="Par10">Local inverse Simpon’s index</p>
        </def>
      </def-item>
      <def-item>
        <term>scRNA-seq</term>
        <def>
          <p id="Par11">Single-cell RNA sequencing</p>
        </def>
      </def-item>
      <def-item>
        <term>SVD</term>
        <def>
          <p id="Par12">Singular value decomposition</p>
        </def>
      </def-item>
      <def-item>
        <term>t-SNE</term>
        <def>
          <p id="Par13">T-distributed stochastic neighbor embedding</p>
        </def>
      </def-item>
      <def-item>
        <term>UMAP</term>
        <def>
          <p id="Par14">Uniform manifold approximation and projection</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher's Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank Meiqin Ye for helpful discussion.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors' contributions</title>
    <p>FW conceived the study, wrote and revised the manuscript. YZ designed the algorithm, performed the computational experiments and wrote the manuscript. Both the authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>This work was supported by a grant from the National Natural Science Foundation of China (61472086). The funding source played no role in the design of the study and collection, analysis, and interpretation of data and in writing the manuscript.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>SSBER is available and open source at (<ext-link ext-link-type="uri" xlink:href="https://github.com/zy456/SSBER">https://github.com/zy456/SSBER</ext-link>), the datasets we used are listed in the references and are available.</p>
  </notes>
  <notes>
    <title>Declarations</title>
    <notes id="FPar1">
      <title>Ethics approval and consent to participate</title>
      <p id="Par59">Not applicable.</p>
    </notes>
    <notes id="FPar2">
      <title>Consent for publication</title>
      <p id="Par60">Not applicable.</p>
    </notes>
    <notes id="FPar3" notes-type="COI-statement">
      <title>Competing interests</title>
      <p id="Par61">The authors declare that they have no competing interests.</p>
    </notes>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jaitin</surname>
            <given-names>DA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel single-cell RNA-seq for marker-free decomposition of tissues into cell types</article-title>
        <source>Science</source>
        <year>2014</year>
        <volume>343</volume>
        <fpage>776</fpage>
        <lpage>779</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1247651</pub-id>
        <pub-id pub-id-type="pmid">24531970</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gierahn</surname>
            <given-names>TM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Seq-Well: portable, low-cost RNA sequencing of single cells at high throughput</article-title>
        <source>Nat Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>395</fpage>
        <lpage>398</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4179</pub-id>
        <pub-id pub-id-type="pmid">28192419</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Macosko</surname>
            <given-names>EZ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly parallel genome-wide expression profiling of individual cells using nanoliter droplets</article-title>
        <source>Cell</source>
        <year>2015</year>
        <volume>161</volume>
        <fpage>1202</fpage>
        <lpage>1214</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2015.05.002</pub-id>
        <pub-id pub-id-type="pmid">26000488</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tung</surname>
            <given-names>PY</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Batch effects and the effective design of single-cell gene expression studies</article-title>
        <source>Sci Rep</source>
        <year>2017</year>
        <volume>7</volume>
        <fpage>39921</fpage>
        <pub-id pub-id-type="doi">10.1038/srep39921</pub-id>
        <pub-id pub-id-type="pmid">28045081</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hicks</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Townes</surname>
            <given-names>FW</given-names>
          </name>
          <name>
            <surname>Teng</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Irizarry</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <article-title>Missing data and technical variability in single-cell RNA-sequencing experiments</article-title>
        <source>Biostatistics</source>
        <year>2017</year>
        <volume>19</volume>
        <fpage>562</fpage>
        <lpage>578</lpage>
        <pub-id pub-id-type="doi">10.1093/biostatistics/kxx053</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Haghverdi</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>Morgan</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Batch effects in single-cell RNA-sequencing data are corrected by matching mutual nearest neighbors</article-title>
        <source>Nat Biotechnol</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>421</fpage>
        <lpage>427</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4091</pub-id>
        <pub-id pub-id-type="pmid">29608177</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Hafemeister</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Mauck</surname>
            <given-names>WM</given-names>
            <suffix>3rd</suffix>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive integration of single-cell data</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902.e21</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat Biotechnol</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hie</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Bryson</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Berger</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Efficient integration of heterogeneous single-cell transcriptomes using Scanorama</article-title>
        <source>Nat Biotechnol</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>685</fpage>
        <lpage>691</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0113-3</pub-id>
        <pub-id pub-id-type="pmid">31061482</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Polański</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Young</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Miao</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Meyer</surname>
            <given-names>KB</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Park</surname>
            <given-names>J-E</given-names>
          </name>
        </person-group>
        <article-title>BBKNN: fast batch alignment of single cell transcriptomes</article-title>
        <source>Bioinformatics</source>
        <year>2019</year>
        <volume>36</volume>
        <fpage>964</fpage>
        <lpage>965</lpage>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hardoon</surname>
            <given-names>DR</given-names>
          </name>
          <name>
            <surname>Szedmak</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Shawe-Taylor</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Canonical correlation analysis: an overview with application to learning methods</article-title>
        <source>Neural Comput</source>
        <year>2004</year>
        <volume>16</volume>
        <fpage>2639</fpage>
        <lpage>2664</lpage>
        <pub-id pub-id-type="doi">10.1162/0899766042321814</pub-id>
        <pub-id pub-id-type="pmid">15516276</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Millard</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Fan</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Slowikowski</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Wei</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Baglaenko</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Brenner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Loh</surname>
            <given-names>P-R</given-names>
          </name>
          <name>
            <surname>Raychaudhuri</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nat Methods</source>
        <year>2019</year>
        <volume>3</volume>
        <fpage>346</fpage>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <mixed-citation publication-type="other">Welch J, Kozareva V, Ferreira A, Vanderburg C, Martin C, Macosko E. Integrative inference of brain cell similarities and differences from single-cell genomics. bioRxiv. 2018:459891. Accessed 4 Mar 2019.</mixed-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Lotfollahi M, Wolf FA, Theis FJ. Generative modeling and latent space arithmetics predict single-cell perturbation response across cell types, studies and species. bioRxiv. 2018:478503. abstract. Accessed 7 Mar 2019.</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Ghazanfar</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>KYX</given-names>
          </name>
          <name>
            <surname>Gagnon-Bartsch</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Lo</surname>
            <given-names>KK</given-names>
          </name>
          <name>
            <surname>Su</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>scMerge leverages factor analysis, stable expression, and pseudoreplication to merge multiple single-cell RNA-seq datasets</article-title>
        <source>Proc Natl Acad Sci USA</source>
        <year>2019</year>
        <volume>116</volume>
        <fpage>9775</fpage>
        <lpage>9784</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1820006116</pub-id>
        <pub-id pub-id-type="pmid">31028141</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tran</surname>
            <given-names>HTN</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A benchmark of batch-effect correction methods for single-cell RNA sequencing data</article-title>
        <source>Genome Biol</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1850-9</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <mixed-citation publication-type="other">Mandric I, Hill BL. BATMAN: fast and accurate integration of single-cell RNA-Seq datasets via minimum-weight matching. bioRxiv. 2020: 01.22.915629.</mixed-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <mixed-citation publication-type="other">Luecken M, Büttner M, Chaichoompu K, Danese A, Interlandi M, Mueller M, et al. Benchmarking atlas-level data integration in single-cell genomics. 10.1101/2020.05.22.111161.</mixed-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Buttner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Miao</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>A test metric for assessing single-cell RNA-seq batch correction</article-title>
        <source>Nat Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>43</fpage>
        <lpage>49</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0254-1</pub-id>
        <pub-id pub-id-type="pmid">30573817</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rousseeuw</surname>
            <given-names>PJ</given-names>
          </name>
        </person-group>
        <article-title>Silhouettes: a graphical aid to the interpretation and validation of cluster analysis</article-title>
        <source>J Comput Appl Math</source>
        <year>1987</year>
        <volume>20</volume>
        <fpage>53</fpage>
        <lpage>65</lpage>
        <pub-id pub-id-type="doi">10.1016/0377-0427(87)90125-7</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hubert</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Arabie</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Comparing partitions</article-title>
        <source>J Classif</source>
        <year>1985</year>
        <volume>2</volume>
        <fpage>193</fpage>
        <lpage>218</lpage>
        <pub-id pub-id-type="doi">10.1007/BF01908075</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">van der Maaten L, Hinton G. Visualizing data using t-SNE. 2008.</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <mixed-citation publication-type="other">McInnes L, Healy J, Melville J. UMAP: uniform manifold approximation and projection for dimension reduction. arXiv. 2018.</mixed-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Villani</surname>
            <given-names>A-C</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Reynolds</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Sarkizova</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Shekhar</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Fletcher</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA-seq reveals new types of human blood dendritic cells, monocytes, and progenitors</article-title>
        <source>Science</source>
        <year>2017</year>
        <volume>356</volume>
        <issue>6335</issue>
        <fpage>eaah4573</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aah4573</pub-id>
        <pub-id pub-id-type="pmid">28428369</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baron</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Veres</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wolock</surname>
            <given-names>SL</given-names>
          </name>
          <name>
            <surname>Faust</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Gaujoux</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Vetere</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A singlecell transcriptomic map of the human and mouse pancreas reveals interand intra-cell population structure</article-title>
        <source>Cell Syst</source>
        <year>2016</year>
        <volume>3</volume>
        <fpage>346</fpage>
        <lpage>360.e4</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2016.08.011</pub-id>
        <pub-id pub-id-type="pmid">27667365</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Muraro</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Dharmadhikari</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Grun</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Groen</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Dielen</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Jansen</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell transcriptome atlas of the human pancreas</article-title>
        <source>Cell Syst</source>
        <year>2016</year>
        <volume>3</volume>
        <fpage>385</fpage>
        <lpage>394.e3</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2016.09.002</pub-id>
        <pub-id pub-id-type="pmid">27693023</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>GXY</given-names>
          </name>
          <name>
            <surname>Terry</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Belgrader</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Ryvkin</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Bent</surname>
            <given-names>ZW</given-names>
          </name>
          <name>
            <surname>Wilson</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>
        <source>Nat Commun</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>14049</fpage>
        <pub-id pub-id-type="doi">10.1038/ncomms14049</pub-id>
        <pub-id pub-id-type="pmid">28091601</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qiu</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Reversed graph embedding resolves complex single-cell trajectories</article-title>
        <source>Nat Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>979</fpage>
        <lpage>982</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4402</pub-id>
        <pub-id pub-id-type="pmid">28825705</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SciBet as a portable and fast single cell type identifier</article-title>
        <source>Nat Commun</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>1818</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-020-15523-2</pub-id>
        <pub-id pub-id-type="pmid">32286268</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kiselev</surname>
            <given-names>VY</given-names>
          </name>
          <name>
            <surname>Yiu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hemberg</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>scmap: projection of single-cell RNAseq data across data sets</article-title>
        <source>Nat Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>359</fpage>
        <lpage>362</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4644</pub-id>
        <pub-id pub-id-type="pmid">29608555</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>AW</given-names>
          </name>
          <name>
            <surname>O'Flanagan</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Chavez</surname>
            <given-names>EA</given-names>
          </name>
          <name>
            <surname>Lim</surname>
            <given-names>JLP</given-names>
          </name>
          <name>
            <surname>Ceglia</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>McPherson</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wiens</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Probabilistic cell-type assignment of single-cell RNA-seq for tumor microenvironment profiling</article-title>
        <source>Nat Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1007</fpage>
        <lpage>1015</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0529-1</pub-id>
        <pub-id pub-id-type="pmid">31501550</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pliner</surname>
            <given-names>HA</given-names>
          </name>
          <name>
            <surname>Shendure</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Supervised classification enables rapid annotation of cell atlases</article-title>
        <source>Nat Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>983</fpage>
        <lpage>986</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0535-3</pub-id>
        <pub-id pub-id-type="pmid">31501545</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
