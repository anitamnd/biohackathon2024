<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Mol Biol Evol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Mol. Biol. Evol</journal-id>
    <journal-id journal-id-type="publisher-id">molbev</journal-id>
    <journal-id journal-id-type="hwp">molbiolevol</journal-id>
    <journal-title-group>
      <journal-title>Molecular Biology and Evolution</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0737-4038</issn>
    <issn pub-type="epub">1537-1719</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4166924</article-id>
    <article-id pub-id-type="doi">10.1093/molbev/msu211</article-id>
    <article-id pub-id-type="publisher-id">msu211</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Resources</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><monospace>selscan</monospace>: An Efficient Multithreaded Program to Perform EHH-Based Scans for Positive Selection</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Szpiech</surname>
          <given-names>Zachary A.</given-names>
        </name>
        <xref ref-type="corresp" rid="msu211-COR1">*</xref>
        <xref ref-type="aff" rid="msu211-AFF1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hernandez</surname>
          <given-names>Ryan D.</given-names>
        </name>
        <xref ref-type="aff" rid="msu211-AFF1">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="msu211-AFF2">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="msu211-AFF3">
          <sup>3</sup>
        </xref>
      </contrib>
      <aff id="msu211-AFF1"><sup>1</sup>Department of Bioengineering and Therapeutic Sciences, University of California, San Francisco</aff>
      <aff id="msu211-AFF2"><sup>2</sup>Institute for Human Genetics, University of California, San Francisco</aff>
      <aff id="msu211-AFF3"><sup>3</sup>Institute for Quantitative Biosciences (QB3), University of California, San Francisco</aff>
    </contrib-group>
    <author-notes>
      <corresp id="msu211-COR1"><bold>*Corresponding author:</bold> E-mail: <email>zachary.szpiech@ucsf.edu</email>.</corresp>
      <fn id="FN1">
        <p><bold>Associate editor:</bold> Sohini Ramachandran</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <month>10</month>
      <year>2014</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>10</day>
      <month>7</month>
      <year>2014</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>10</day>
      <month>7</month>
      <year>2014</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>31</volume>
    <issue>10</issue>
    <fpage>2824</fpage>
    <lpage>2827</lpage>
    <permissions>
      <copyright-statement>© The Author 2014. Published by Oxford University Press on behalf of the Society for Molecular Biology and Evolution.</copyright-statement>
      <copyright-year>2014</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by-nc/3.0/" license-type="creative-commons">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/3.0/">http://creativecommons.org/licenses/by-nc/3.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <abstract>
      <p>Haplotype-based scans to detect natural selection are useful to identify recent or ongoing positive selection in genomes. As both real and simulated genomic data sets grow larger, spanning thousands of samples and millions of markers, there is a need for a fast and efficient implementation of these scans for general use. Here, we present <monospace>selscan</monospace>, an efficient multithreaded application that implements Extended Haplotype Homozygosity (EHH), Integrated Haplotype Score (iHS), and Cross-population EHH (XPEHH). <monospace>selscan</monospace> accepts phased genotypes in multiple formats, including TPED, and performs extremely well on both simulated and real data and over an order of magnitude faster than existing available implementations. It calculates iHS on chromosome 22 (22,147 loci) across 204 CEU haplotypes in 353 s on one thread (33 s on 16 threads) and calculates XPEHH for the same data relative to 210 YRI haplotypes in 578 s on one thread (52 s on 16 threads). Source code and binaries (Windows, OSX, and Linux) are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/szpiech/selscan">https://github.com/szpiech/selscan</ext-link>.</p>
    </abstract>
    <counts>
      <page-count count="4"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>Extended Haplotype Homozygosity (EHH) (<xref rid="msu211-B5" ref-type="bibr">Sabeti et al. 2002</xref>), Integrated Haplotype Score (iHS) (<xref rid="msu211-B7" ref-type="bibr">Voight et al. 2006</xref>), and Cross-population Extended Haplotype Homozygosity (XPEHH) (<xref rid="msu211-B6" ref-type="bibr">Sabeti et al<italic>.</italic> 2007</xref>) are statistics designed to use phased genotypes to identify putative regions of recent or ongoing positive selection in genomes. They are all based on the model of a hard selective sweep, where a de novo adaptive mutation arises on a haplotype that quickly sweeps toward fixation, reducing diversity around the locus. If selection is strong enough, this occurs faster than recombination or mutation can act to break up the haplotype, and thus a signal of high haplotype homozygosity can be observed extending from an adaptive locus.</p>
    <p>As genetics data sets grow larger both in number of individuals and number of loci, there is a need for a fast and efficient publicly available implementation of these statistics. Below, we introduce these statistics and provide concise definitions for their calculations. We then evaluate the performance of our implementation, <monospace>selscan</monospace>.</p>
    <sec>
      <title>Extended Haplotype Homozygosity</title>
      <p>In a sample of <italic>n</italic> chromosomes, let <inline-formula><mml:math id="I1"><mml:mi mathvariant="script" class="calligraphy">C</mml:mi></mml:math></inline-formula> denote the set of all possible distinct haplotypes at a locus of interest (named <italic>x</italic><sub>0</sub>), and let <inline-formula><mml:math id="I2"><mml:mrow><mml:mi mathvariant="script" class="calligraphy">C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> denote the set of all possible distinct haplotypes extending from the locus <italic>x</italic><sub>0</sub> to the <italic>i</italic>-th marker either upstream or downstream from <italic>x</italic><sub>0</sub>. For example, if the locus of interest <italic>x</italic><sub>0</sub> is a biallelic single nucleotide polymorphism (SNP) where 0 represents the ancestral allele and 1 represents the derived allele, then <inline-formula><mml:math id="I3"><mml:mrow><mml:mi mathvariant="script" class="calligraphy">C</mml:mi><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>. If <italic>x</italic><sub>1</sub> is an immediately adjacent marker, then the set of all possible haplotypes is <inline-formula><mml:math id="I4"><mml:mrow><mml:mi mathvariant="script" class="calligraphy">C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mn>11</mml:mn><mml:mo>,</mml:mo><mml:mn>10</mml:mn><mml:mo>,</mml:mo><mml:mn>00</mml:mn><mml:mo>,</mml:mo><mml:mn>01</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>EHH of the entire sample, extending from the locus <italic>x</italic><sub>0</sub> out to marker <italic>x<sub>i</sub></italic>, is calculated as
<disp-formula id="msu211-M1"><label>(1)</label><graphic xlink:href="msu211m1.jpg" position="float"/></disp-formula>
where <italic>n<sub>h</sub></italic> is the number of observed haplotypes of type <inline-formula><mml:math id="I5"><mml:mrow><mml:mi>h</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script" class="calligraphy">C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>In some cases, we may want to calculate the haplotype homozygosity of a subsample of chromosomes all carrying a “core” haplotype at locus <italic>x</italic><sub>0</sub>. Let <inline-formula><mml:math id="I6"><mml:mrow><mml:msub><mml:mi mathvariant="script" class="calligraphy">H</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> be a partition of <inline-formula><mml:math id="I7"><mml:mrow><mml:mi mathvariant="script" class="calligraphy">C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> containing all distinct haplotypes carrying the core haplotype, <inline-formula><mml:math id="I8"><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script" class="calligraphy">C</mml:mi></mml:mrow></mml:math></inline-formula>, at <italic>x</italic><sub>0</sub> and extending to marker <italic>x<sub>i</sub></italic>. Note that
<disp-formula id="msu211-M2"><label>(2)</label><mml:math id="MM2"><mml:mrow><mml:mi mathvariant="script" class="calligraphy">C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>⋃</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script" class="calligraphy">C</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mi mathvariant="script" class="calligraphy">H</mml:mi><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
</p>
      <p>Following the example above, if the derived allele (1) is chosen as the core haplotype, then <inline-formula><mml:math id="I9"><mml:mrow><mml:msub><mml:mi mathvariant="script" class="calligraphy">H</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mn>11</mml:mn><mml:mo>,</mml:mo><mml:mn>10</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>. Similarly, if the ancestral allele is the core haplotype, then <inline-formula><mml:math id="I10"><mml:mrow><mml:msub><mml:mi mathvariant="script" class="calligraphy">H</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mn>00</mml:mn><mml:mo>,</mml:mo><mml:mn>01</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>We calculate the EHH of the chromosomes carrying the core haplotype <italic>c</italic> to marker <italic>x<sub>i</sub></italic> as
<disp-formula id="msu211-M3"><label>(3)</label><graphic xlink:href="msu211m3.jpg" position="float"/></disp-formula>
where <italic>n<sub>h</sub></italic> is the number of observed haplotypes of type <inline-formula><mml:math id="I11"><mml:mrow><mml:mi>h</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi mathvariant="script" class="calligraphy">H</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and <italic>n<sub>c</sub></italic> is the number of observed haplotypes carrying the core haplotype (<inline-formula><mml:math id="I12"><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script" class="calligraphy">C</mml:mi></mml:mrow></mml:math></inline-formula>).</p>
    </sec>
    <sec>
      <title>Integrated Haplotype Score</title>
      <p>iHS is calculated by using <xref ref-type="disp-formula" rid="msu211-M3">equation (3)</xref> to track the decay of haplotype homozygosity for both the ancestral and derived haplotypes extending from a query site. To calculate iHS at a site, we first calculate the integrated haplotype homozygosity (iHH) for the ancestral (0) and derived (1) haplotypes (<inline-formula><mml:math id="I13"><mml:mrow><mml:mi mathvariant="script" class="calligraphy">C</mml:mi><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>) via trapezoidal quadrature.
<disp-formula id="msu211-M4"><label>(4)</label><mml:math id="MM4"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msub><mml:mtext>iHH</mml:mtext><mml:mi>c</mml:mi></mml:msub><mml:mo>=</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script" class="calligraphy">D</mml:mi><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:munderover><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mtext>EHH</mml:mtext></mml:mrow><mml:mi>c</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mtext>EHH</mml:mtext></mml:mrow><mml:mi>c</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>
</mml:mo><mml:mo>+</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script" class="calligraphy">U</mml:mi><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:munderover><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mtext>EHH</mml:mtext></mml:mrow><mml:mtext>c</mml:mtext></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mtext>EHH</mml:mtext></mml:mrow><mml:mtext>c</mml:mtext></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
where <inline-formula><mml:math id="I14"><mml:mi mathvariant="script" class="calligraphy">D</mml:mi></mml:math></inline-formula> is the set of markers downstream from the current locus such that <inline-formula><mml:math id="I15"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="script" class="calligraphy">D</mml:mi></mml:mrow></mml:math></inline-formula> denotes the <italic>i</italic>-th closest downstream marker from the locus of interest (<italic>x</italic><sub>0</sub>). <inline-formula><mml:math id="I16"><mml:mi mathvariant="script" class="calligraphy">U</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="I17"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="script" class="calligraphy">U</mml:mi></mml:mrow></mml:math></inline-formula> are defined similarly for upstream markers. <inline-formula><mml:math id="I18"><mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> gives the genetic distance between two markers. The (unstandardized) iHS is then calculated as
<disp-formula id="msu211-M5"><label>(5)</label><mml:math id="MM5"><mml:mrow><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
</p>
      <p>Note that this definition differs slightly from that in <xref rid="msu211-B7" ref-type="bibr">Voight et al<italic>.</italic> (2006)</xref>, where unstandardized iHS is defined with iHH<sub>1</sub> and iHH<sub>0</sub> swapped.</p>
      <p>Finally, the unstandardized scores are normalized in frequency bins across the entire genome.
<disp-formula id="msu211-M6"><label>(6)</label><mml:math id="MM6"><mml:mrow><mml:mtext>iHS</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mtext>0</mml:mtext></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo stretchy="true">[</mml:mo><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mtext>1</mml:mtext></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mtext>0</mml:mtext></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow><mml:mrow><mml:mi>S</mml:mi><mml:msub><mml:mi>D</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo stretchy="true">[</mml:mo><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mtext>1</mml:mtext></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mtext>0</mml:mtext></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
where <inline-formula><mml:math id="I19"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo stretchy="true">[</mml:mo><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mtext>1</mml:mtext></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mtext>0</mml:mtext></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="I20"><mml:mrow><mml:msub><mml:mrow><mml:mtext>SD</mml:mtext></mml:mrow><mml:mi>p</mml:mi></mml:msub><mml:mo stretchy="true">[</mml:mo><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mtext>1</mml:mtext></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mtext>0</mml:mtext></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:math></inline-formula> are the expectation and standard deviation in frequency bin <italic>p</italic>.</p>
      <p>In practice, the summations in <xref ref-type="disp-formula" rid="msu211-M4">equation (4)</xref> are truncated once <inline-formula><mml:math id="I21"><mml:mrow><mml:msub><mml:mrow><mml:mtext>EHH</mml:mtext></mml:mrow><mml:mi>c</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula>. Additionally with low density SNP data, if the physical distance <italic>b</italic> (in kbp) between two markers is &gt;20, then <inline-formula><mml:math id="I22"><mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is scaled by a factor of 20/<italic>b</italic> in order to reduce possible spurious signals induced by lengthy gaps. During computation if the start/end of a chromosome arm is reached before <inline-formula><mml:math id="I23"><mml:mrow><mml:msub><mml:mrow><mml:mtext>EHH</mml:mtext></mml:mrow><mml:mi>c</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula> or if a gap of <italic>b</italic> &gt; 200 is encountered, the iHS calculation is aborted for that locus. iHS is not reported at core sites with minor allele frequency (MAF) &lt; 0.05. In <monospace>selscan</monospace>, the EHH truncation value, gap scaling factor, and core site MAF cutoff value are all flexible parameters definable on the command line.</p>
    </sec>
    <sec>
      <title>Cross-population Extended Haplotype Homozygosity</title>
      <p>To calculate XPEHH between populations <italic>A</italic> and <italic>B</italic> at a marker <italic>x</italic><sub>0</sub>, we first calculate iHH for each population separately, integrating the EHH of the entire sample in the population (<xref ref-type="disp-formula" rid="msu211-M1">eq. 1</xref>).
<disp-formula id="msu211-M7"><label>(7)</label><mml:math id="MM7"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mtext>i</mml:mtext><mml:mtext>HH</mml:mtext><mml:mo>=</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script" class="calligraphy">D</mml:mi><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:munderover><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mtext>EHH</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mtext>EHH</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>
</mml:mo><mml:mo>+</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script" class="calligraphy">U</mml:mi><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:munderover><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mtext>EHH</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mtext>EHH</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
</p>
      <p>If iHH<italic><sub>A</sub></italic> and iHH<italic><sub>B</sub></italic> are the iHHs for populations <italic>A</italic> and <italic>B</italic>, then the (unstandardized) XPEHH is
<disp-formula id="msu211-M8"><label>(8)</label><mml:math id="MM8"><mml:mrow><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mi>A</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
and after genome-wide normalization we have
<disp-formula id="msu211-M9"><label>(9)</label><mml:math id="MM9"><mml:mrow><mml:mtext>XPEHH</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>i</mml:mtext><mml:msub><mml:mrow><mml:mtext>HH</mml:mtext></mml:mrow><mml:mi>A</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="true">[</mml:mo><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>i</mml:mtext><mml:msub><mml:mrow><mml:mtext>HH</mml:mtext></mml:mrow><mml:mi>A</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow><mml:mrow><mml:mtext>SD</mml:mtext><mml:mo stretchy="true">[</mml:mo><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mtext>iHH</mml:mtext></mml:mrow><mml:mi>A</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mtext>i</mml:mtext><mml:msub><mml:mrow><mml:mtext>HH</mml:mtext></mml:mrow><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
</p>
      <p>In practice, the sums in each of iHH<italic><sub>A</sub></italic> and iHH<italic><sub>B</sub></italic> (<xref ref-type="disp-formula" rid="msu211-M7">eq. 7</xref>) are truncated at <italic>x<sub>i</sub></italic>—the marker at which the EHH of the haplotypes <italic>pooled across populations</italic> is <inline-formula><mml:math id="I24"><mml:mrow><mml:mtext>EHH</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula>. Scaling of <inline-formula><mml:math id="I25"><mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and handling of gaps is done as for iHS, and these parameters are definable on the <monospace>selscan</monospace> command line.</p>
    </sec>
  </sec>
  <sec>
    <title>Performance</title>
    <p>Here, we evaluate the performance of <monospace>selscan</monospace> (<ext-link ext-link-type="uri" xlink:href="https://github.com/szpiech/selscan">https://github.com/szpiech/selscan</ext-link>, last accessed July 16, 2014) for computing the iHS and XPEHH statistics. In addition, we compare performance on these statistics with the programs <monospace>rehh</monospace> (<xref rid="msu211-B2" ref-type="bibr">Gautier and Vitalis 2012</xref>, <ext-link ext-link-type="uri" xlink:href="http://cran.r-project.org/package=rehh">http://cran.r-project.org/package=rehh</ext-link>, last accessed July 16, 2014), <monospace>ihs</monospace> (<xref rid="msu211-B7" ref-type="bibr">Voight et al<italic>.</italic> 2006</xref>), and <monospace>xpehh</monospace> (<xref rid="msu211-B4" ref-type="bibr">Pickrell et al<italic>.</italic> 2009</xref>). Both <monospace>ihs</monospace> and <monospace>xpehh</monospace> are available for download at <ext-link ext-link-type="uri" xlink:href="http://hgdp.uchicago.edu/Software/">http://hgdp.uchicago.edu/Software/</ext-link> (last accessed July 16, 2014). All computations were run on a MacPro running OSX 10.8.5 with two 2.4 GHz 6–core Intel Xeon processors with hyperthreading enabled.</p>
    <sec>
      <title>Integrated Haplotype Score</title>
      <p>For runtime evaluation of iHS calculations, we simulated a 4 Mbp region of DNA with the program <monospace>ms</monospace> (<xref rid="msu211-B3" ref-type="bibr">Hudson 2002</xref>) and generated four independent data sets with varying numbers of sampled haplotypes (<inline-formula><mml:math id="I26"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mn>1600</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="I27"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>=</mml:mo><mml:mn>1600</mml:mn></mml:mrow></mml:math></inline-formula>). We sampled 250 haplotypes (9,625 SNP loci), 500 haplotypes (10,646 SNP loci), 1,000 haplotypes (11,655 SNP loci), and 2,000 haplotypes (12,724 SNP loci). We name these data sets IHS250, IHS500, IHS1000, and IHS2000, respectively. These data sets represent a densely typed region similar to next-generation sequencing data. Although these data sets are generated via strictly neutral processes, they serve the purpose of runtime evaulation perfectly well. We also use data from The 1000 Genomes Project (<xref rid="msu211-B1" ref-type="bibr">1000 Genomes Project Consortium 2012</xref>) Omni genotypes, calculating iHS scores at 22,147 SNP loci on chromosome 22 across 102 CEU individuals (204 haplotypes). We name this data set CEU22.</p>
      <p><xref ref-type="table" rid="msu211-T1">Table 1</xref> summarizes the runtimes of <monospace>ihs</monospace>, <monospace>rehh</monospace>, and <monospace>selscan</monospace>. We note that <monospace>rehh</monospace> integrates haplotype homozygosity over a physical map, whereas <monospace>ihs</monospace> and <monospace>selscan</monospace> integrate over a genetic map by default. This does not affect runtimes (data not shown), which are measured using genetic maps for <monospace>ihs</monospace> and <monospace>selscan</monospace>. Even operating on a single thread, <monospace>selscan</monospace> calculates iHS scores at least an order of magnitude faster than <monospace>ihs</monospace> and up to 1.8 × faster than <monospace>rehh</monospace> for large data sets.
<table-wrap id="msu211-T1" position="float"><label>Table 1.</label><caption><p>Runtime Performance (in seconds) of <monospace>ihs</monospace>, <monospace>rehh</monospace>, and <monospace>s</monospace><monospace>elscan</monospace> for Calculating Unstandardized iHS for Various Data Sets.</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Data Set</th><th rowspan="1" colspan="1"><monospace>ihs</monospace></th><th rowspan="1" colspan="1"><monospace>rehh</monospace><xref ref-type="table-fn" rid="msu211-TF2"><sup>a</sup></xref></th><th colspan="5" align="center" rowspan="1"><monospace>selscan</monospace><hr/></th></tr><tr><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1">Threads <inline-formula><mml:math id="I28"><mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula></th><th rowspan="1" colspan="1">2</th><th rowspan="1" colspan="1">4</th><th rowspan="1" colspan="1">8</th><th rowspan="1" colspan="1">16</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">IHS250</td><td rowspan="1" colspan="1">19,275</td><td rowspan="1" colspan="1">563</td><td rowspan="1" colspan="1">618</td><td rowspan="1" colspan="1">306</td><td rowspan="1" colspan="1">162</td><td rowspan="1" colspan="1">84</td><td rowspan="1" colspan="1">58</td></tr><tr><td rowspan="1" colspan="1">IHS500</td><td rowspan="1" colspan="1">45,547</td><td rowspan="1" colspan="1">1,652</td><td rowspan="1" colspan="1">1,554</td><td rowspan="1" colspan="1">782</td><td rowspan="1" colspan="1">399</td><td rowspan="1" colspan="1">220</td><td rowspan="1" colspan="1">150</td></tr><tr><td rowspan="1" colspan="1">IHS1000</td><td rowspan="1" colspan="1"><inline-formula><mml:math id="I29"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mspace width="-.4em"/><mml:mn>100</mml:mn><mml:mtext>,</mml:mtext><mml:mn>000</mml:mn></mml:mrow></mml:math></inline-formula></td><td rowspan="1" colspan="1">4,834</td><td rowspan="1" colspan="1">4,018</td><td rowspan="1" colspan="1">2,019</td><td rowspan="1" colspan="1">1,040</td><td rowspan="1" colspan="1">566</td><td rowspan="1" colspan="1">380</td></tr><tr><td rowspan="1" colspan="1">IHS2000</td><td rowspan="1" colspan="1"><inline-formula><mml:math id="I30"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mspace width="-.4em"/><mml:mn>100</mml:mn><mml:mtext>,</mml:mtext><mml:mn>000</mml:mn></mml:mrow></mml:math></inline-formula></td><td rowspan="1" colspan="1">12,652</td><td rowspan="1" colspan="1">7,054</td><td rowspan="1" colspan="1">3,633</td><td rowspan="1" colspan="1">1,869</td><td rowspan="1" colspan="1">1,046</td><td rowspan="1" colspan="1">752</td></tr><tr><td rowspan="1" colspan="1">CEU22</td><td rowspan="1" colspan="1">19,434</td><td rowspan="1" colspan="1">588</td><td rowspan="1" colspan="1">353</td><td rowspan="1" colspan="1">182</td><td rowspan="1" colspan="1">93</td><td rowspan="1" colspan="1">50</td><td rowspan="1" colspan="1">33</td></tr></tbody></table><table-wrap-foot><fn id="msu211-TF1"><p>N<sc>ote</sc>.—Calculations running over 100,000 s were aborted.</p></fn><fn id="msu211-TF2"><p><sup>a</sup><monospace>rehh</monospace> integrates over a physical map instead of a genetic map. Using a physical map does not affect <monospace>selscan</monospace>’s runtime (data not shown).</p></fn></table-wrap-foot></table-wrap></p>
      <p>We compare unstandardized iHS scores for the CEU22 data set using <monospace>ihs</monospace> and <monospace>selscan</monospace> and find excellent agreement (<xref ref-type="fig" rid="msu211-F1">fig. 1</xref><italic>A</italic>, Pearson’s <italic>r</italic> = 0.9946). The slight variance in scores between the two programs is likely due to an undocumented difference in the way <monospace>ihs</monospace> calculates its scores (supplementary material of <xref rid="msu211-B6" ref-type="bibr">Sabeti et al<italic>.</italic> 2007</xref>), but the effect is negligible. We also calculate unstandardized iHS scores for the CEU22 data set using <monospace>rehh</monospace> and <monospace>selscan</monospace> (using a physical map) and again find excellent agreement (Pearson’s <italic>r</italic> = 0.9953).
<fig id="msu211-F1" position="float"><label>F<sc>ig</sc>. 1.</label><caption><p>(<italic>A</italic>) Unstandardized iHS scores calculated on the CEU22 data set for <monospace>selscan</monospace> and <monospace>ihs</monospace> (Pearson’s <italic>r</italic> = 0.9946) and (<italic>B</italic>) Unstandardized XPEHH scores calculated on the CEUYRI22 data set for <monospace>selscan</monospace> and <monospace>xpehh</monospace> (Pearson’s <italic>r</italic> = 0.9999).</p></caption><graphic xlink:href="msu211f1p"/></fig></p>
    </sec>
    <sec>
      <title>Cross-Population Extended Haplotype Homozygosity</title>
      <p>For runtime evaluation of XPEHH calculations, we simulated a 4-Mbp region of DNA with the program <monospace>ms</monospace> (<xref rid="msu211-B3" ref-type="bibr">Hudson 2002</xref>) with a simple two population divergence model (time to divergence <italic>t</italic> = 0.05, <inline-formula><mml:math id="I31"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mn>1600</mml:mn></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="I32"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>=</mml:mo><mml:mn>1600</mml:mn></mml:mrow></mml:math></inline-formula>) and generated four independent data sets with varying numbers of sampled haplotypes. We sampled 250 haplotypes (125 from each population, 12,920 SNP loci), 500 haplotypes (250 from each population, 14,989 SNP loci), 1,000 haplotypes (500 from each population, 17,142 SNP loci), and 2,000 haplotypes (1,000 from each population, 19,567 SNP loci). We name these data sets XP250, XP500, XP1000, and XP2000, respectively. These data sets represent a densely typed region similar to next-generation sequencing data. Although these data sets are generated via strictly neutral processes, they serve the purpose of runtime evaulation perfectly well. We also use data from The 1000 Genomes Project (<xref rid="msu211-B1" ref-type="bibr">1000 Genomes Project Consortium 2012</xref>) Omni genotypes, calculating XPEHH scores at 22, 147 SNP loci on chromosome 22 across 102 CEU individuals (204 haplotypes) and 105 YRI individuals (210 haplotypes). We name this data set CEUYRI22.</p>
      <p><xref ref-type="table" rid="msu211-T2">Table 2</xref> summarizes the runtimes of <monospace>xpehh</monospace> and <monospace>selscan</monospace>. Even operating on a single thread, <monospace>selscan</monospace> tends to calculate XPEHH scores at least an order of magnitude faster than <monospace>xpehh</monospace>. <xref ref-type="fig" rid="msu211-F1">Figure 1</xref><italic>B</italic> shows the correlation (Pearson’s <italic>r</italic> = 0.9999) of CEUYRI22 unstandardized XPEHH scores between the two programs.
<table-wrap id="msu211-T2" position="float"><label>Table 2.</label><caption><p>Runtime Performance (in seconds) of <monospace>xpehh</monospace> and <monospace>selscan</monospace> for Calculating Unstandardized XPEHH for Various Data Sets.</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Data Set</th><th rowspan="1" colspan="1"><monospace>xpehh</monospace></th><th colspan="5" align="center" rowspan="1"><monospace>s</monospace><monospace>elscan</monospace><hr/></th></tr><tr><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1">Threads <inline-formula><mml:math id="I33"><mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula></th><th rowspan="1" colspan="1">2</th><th rowspan="1" colspan="1">4</th><th rowspan="1" colspan="1">8</th><th rowspan="1" colspan="1">16</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">XP250</td><td rowspan="1" colspan="1">11,113</td><td rowspan="1" colspan="1">287</td><td rowspan="1" colspan="1">141</td><td rowspan="1" colspan="1">71</td><td rowspan="1" colspan="1">38</td><td rowspan="1" colspan="1">25</td></tr><tr><td rowspan="1" colspan="1">XP500</td><td rowspan="1" colspan="1">57,006</td><td rowspan="1" colspan="1">766</td><td rowspan="1" colspan="1">403</td><td rowspan="1" colspan="1">194</td><td rowspan="1" colspan="1">104</td><td rowspan="1" colspan="1">67</td></tr><tr><td rowspan="1" colspan="1">XP1000</td><td rowspan="1" colspan="1"><inline-formula><mml:math id="I34"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mspace width="-.3em"/><mml:mn>100</mml:mn><mml:mtext>,</mml:mtext><mml:mn>000</mml:mn></mml:mrow></mml:math></inline-formula></td><td rowspan="1" colspan="1">2,037</td><td rowspan="1" colspan="1">1,018</td><td rowspan="1" colspan="1">515</td><td rowspan="1" colspan="1">274</td><td rowspan="1" colspan="1">180</td></tr><tr><td rowspan="1" colspan="1">XP2000</td><td rowspan="1" colspan="1"><inline-formula><mml:math id="I35"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mspace width="-.3em"/><mml:mn>100</mml:mn><mml:mtext>,</mml:mtext><mml:mn>000</mml:mn></mml:mrow></mml:math></inline-formula></td><td rowspan="1" colspan="1">5,683</td><td rowspan="1" colspan="1">2,798</td><td rowspan="1" colspan="1">1,471</td><td rowspan="1" colspan="1">763</td><td rowspan="1" colspan="1">493</td></tr><tr><td rowspan="1" colspan="1">CEUYRI22</td><td rowspan="1" colspan="1">37,271</td><td rowspan="1" colspan="1">578</td><td rowspan="1" colspan="1">291</td><td rowspan="1" colspan="1">150</td><td rowspan="1" colspan="1">78</td><td rowspan="1" colspan="1">52</td></tr></tbody></table><table-wrap-foot><fn id="msu211-TF3"><p>N<sc>ote</sc>.—Calculations running over 100,000 s were aborted.</p></fn></table-wrap-foot></table-wrap></p>
    </sec>
  </sec>
  <sec sec-type="conclusions">
    <title>Conclusions</title>
    <p><monospace>selscan</monospace> achieves a speed up of at least an order or magnitude over both <monospace>ihs</monospace> and <monospace>xpehh</monospace> and a speed up of nearly 2x over <monospace>rehh</monospace> for large data sets through general optimizations of the calculations. We also implement shared memory parallelism with multithreading to further speed up calculations on computers with multiple cores. Because iHS and XPEHH attempt to calculate a score for each site in the data and each score can be calculated indpendently of the others, <monospace>selscan</monospace> partitions the workload (sites at which to calculate a score) across threads, while maintaining each thread’s access to the entire data set required to make the calculation.</p>
    <p>Additional empirical testing (data not shown) suggests that <monospace>rehh</monospace>, <monospace>ihs</monospace>, and <monospace>selscan</monospace> (for both iHS and XPEHH calculations) are <inline-formula><mml:math id="I36"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:msup><mml:mi>D</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and <monospace>xpehh</monospace> is <inline-formula><mml:math id="I37"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>N</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:msup><mml:mi>D</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <italic>N</italic> is the number of haploid samples and <italic>D</italic> is the SNP locus density.</p>
    <p>Each of these statistics require phased haplotypes and a genetic or physical map as input data (TPED format) and missing genotypes must either be dropped or imputed. Because of the speed improvements we have implented, we expect that <monospace>selscan</monospace> will be a valuable tool for calculating EHH-based genome-wide scans for positive selection in very large genetic data sets, including whole-genome sequencing and genome-wide association study data, currently being generated for humans and other organisms. <monospace>selscan</monospace> will also allow for in-depth examination of the performance of these statistics under a wide range of parameters in large-scale simulation studies.</p>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>The authors would like to thank Trevor Pemberton and Paul Verdu for assistance in testing the Windows binaries. This work was partially supported by <funding-source>NIH</funding-source> (grants <award-id>P60MD006902</award-id>, <award-id>UL1RR024131</award-id>, <award-id>1R21HG007233</award-id>, <award-id>1R21CA178706</award-id>, <award-id>1R01HL117004-01</award-id>, and <award-id>1R01HG007644</award-id>) and a <funding-source>Sloan Foundation Research Fellowship</funding-source> (to R.D.H.).</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="msu211-B1">
      <element-citation publication-type="journal">
        <collab>1000 Genomes Project Consortium</collab>
        <article-title>An integrated map of genetic variation from 1,092 human genomes</article-title>
        <source>Nature</source>
        <year>2012</year>
        <volume>491</volume>
        <issue>7422</issue>
        <fpage>56</fpage>
        <lpage>65</lpage>
        <pub-id pub-id-type="pmid">23128226</pub-id>
      </element-citation>
    </ref>
    <ref id="msu211-B2">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gautier</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Vitalis</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>rehh: an R package to detect footprints of selection in genome-wide SNP data from haplotype structure</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <issue>8</issue>
        <fpage>1176</fpage>
        <lpage>1177</lpage>
        <pub-id pub-id-type="pmid">22402612</pub-id>
      </element-citation>
    </ref>
    <ref id="msu211-B3">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hudson</surname>
            <given-names>RR</given-names>
          </name>
        </person-group>
        <article-title>Generating samples under a wrightfisher neutral model of genetic variation</article-title>
        <source>Bioinformatics</source>
        <year>2002</year>
        <volume>18</volume>
        <issue>2</issue>
        <fpage>337</fpage>
        <lpage>338</lpage>
        <pub-id pub-id-type="pmid">11847089</pub-id>
      </element-citation>
    </ref>
    <ref id="msu211-B4">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pickrell</surname>
            <given-names>JK</given-names>
          </name>
          <name>
            <surname>Coop</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Novembre</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Kudaravalli</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>JZ</given-names>
          </name>
          <name>
            <surname>Absher</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Srinivasan</surname>
            <given-names>BS</given-names>
          </name>
          <name>
            <surname>Barsh</surname>
            <given-names>GS</given-names>
          </name>
          <name>
            <surname>Myers</surname>
            <given-names>RM</given-names>
          </name>
          <name>
            <surname>Feldman</surname>
            <given-names>MW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Signals of recent positive selection in a worldwide sample of human populations</article-title>
        <source>Genome Res.</source>
        <year>2009</year>
        <volume>19</volume>
        <issue>5</issue>
        <fpage>826</fpage>
        <lpage>837</lpage>
        <pub-id pub-id-type="pmid">19307593</pub-id>
      </element-citation>
    </ref>
    <ref id="msu211-B5">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sabeti</surname>
            <given-names>PC</given-names>
          </name>
          <name>
            <surname>Reich</surname>
            <given-names>DE</given-names>
          </name>
          <name>
            <surname>Higgins</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Levine</surname>
            <given-names>HZP</given-names>
          </name>
          <name>
            <surname>Richter</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Schaffner</surname>
            <given-names>SF</given-names>
          </name>
          <name>
            <surname>Gabriel</surname>
            <given-names>SB</given-names>
          </name>
          <name>
            <surname>Platko</surname>
            <given-names>JV</given-names>
          </name>
          <name>
            <surname>Patterson</surname>
            <given-names>NJ</given-names>
          </name>
          <name>
            <surname>McDonald</surname>
            <given-names>GJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Detecting recent positive selection in the human genome from haplotype structure</article-title>
        <source>Nature</source>
        <year>2002</year>
        <volume>419</volume>
        <issue>6909</issue>
        <fpage>832</fpage>
        <lpage>837</lpage>
        <pub-id pub-id-type="pmid">12397357</pub-id>
      </element-citation>
    </ref>
    <ref id="msu211-B6">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sabeti</surname>
            <given-names>PC</given-names>
          </name>
          <name>
            <surname>Varilly</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Fry</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Lohmueller</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Hostetter</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Cotsapas</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Byrne</surname>
            <given-names>EH</given-names>
          </name>
          <name>
            <surname>McCarroll</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Gaudet</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genome-wide detection and characterization of positive selection in human populations</article-title>
        <source>Nature</source>
        <year>2007</year>
        <volume>449</volume>
        <issue>7164</issue>
        <fpage>913</fpage>
        <lpage>918</lpage>
        <pub-id pub-id-type="pmid">17943131</pub-id>
      </element-citation>
    </ref>
    <ref id="msu211-B7">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Voight</surname>
            <given-names>BF</given-names>
          </name>
          <name>
            <surname>Kudaravalli</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wen</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Pritchard</surname>
            <given-names>JK</given-names>
          </name>
        </person-group>
        <article-title>A map of recent positive selection in the human genome</article-title>
        <source>PLoS Biol.</source>
        <year>2006</year>
        <volume>4</volume>
        <issue>3</issue>
        <fpage>e72</fpage>
        <pub-id pub-id-type="pmid">16494531</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
