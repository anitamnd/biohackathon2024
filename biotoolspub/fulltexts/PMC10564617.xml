<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10564617</article-id>
    <article-id pub-id-type="pmid">37756699</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btad594</article-id>
    <article-id pub-id-type="publisher-id">btad594</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ScribbleDom: using scribble-annotated histology images to identify domains in spatial transcriptomics data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-9219-5217</contrib-id>
        <name>
          <surname>Rahman</surname>
          <given-names>Mohammad Nuwaisir</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Bangladesh University of Engineering and Technology</institution>, Dhaka 1000, <country country="BD">Bangladesh</country></aff>
        <xref rid="btad594-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-3738-264X</contrib-id>
        <name>
          <surname>Noman</surname>
          <given-names>Abdullah Al</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Bangladesh University of Engineering and Technology</institution>, Dhaka 1000, <country country="BD">Bangladesh</country></aff>
        <xref rid="btad594-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-9332-2727</contrib-id>
        <name>
          <surname>Turza</surname>
          <given-names>Abir Mohammad</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Bangladesh University of Engineering and Technology</institution>, Dhaka 1000, <country country="BD">Bangladesh</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-5837-0504</contrib-id>
        <name>
          <surname>Abrar</surname>
          <given-names>Mohammed Abid</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Brac University</institution>, Dhaka 1212, <country country="BD">Bangladesh</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7472-1156</contrib-id>
        <name>
          <surname>Samee</surname>
          <given-names>Md Abul Hassan</given-names>
        </name>
        <aff><institution>Department of Integrative Physiology, Baylor College of Medicine</institution>, Houston, TX 77030, <country country="US">United States</country></aff>
        <xref rid="btad594-cor1" ref-type="corresp"/>
        <!--samee@bcm.edu-->
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-9887-4456</contrib-id>
        <name>
          <surname>Rahman</surname>
          <given-names>M Saifur</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Bangladesh University of Engineering and Technology</institution>, Dhaka 1000, <country country="BD">Bangladesh</country></aff>
        <xref rid="btad594-cor1" ref-type="corresp"/>
        <!--mrahman@cse.buet.ac.bd-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Mathelier</surname>
          <given-names>Anthony</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btad594-cor1">Corresponding authors. Department of Integrative Physiology, Baylor College of Medicine, Houston, TX 77030, United States. E-mail: <email>samee@bcm.edu</email> (M.A.H.S.); Department of Computer Science and Engineering, ECE Building, West Palashi Campus, Bangladesh University of Engineering and Technology, Palashi, Dhaka 1000, Bangladesh. E-mail: <email>mrahman@cse.buet.ac.bd</email> (M.S.R.)</corresp>
      <fn id="btad594-FM1">
        <p>Mohammad Nuwaisir Rahman and Abdullah Al Noman contributed equally to this work.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <month>10</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-09-26">
      <day>26</day>
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>26</day>
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <volume>39</volume>
    <issue>10</issue>
    <elocation-id>btad594</elocation-id>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>03</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>07</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>22</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>10</day>
        <month>10</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btad594.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Spatial domain identification is a very important problem in the field of spatial transcriptomics. The state-of-the-art solutions to this problem focus on unsupervised methods, as there is lack of data for a supervised learning formulation. The results obtained from these methods highlight significant opportunities for improvement.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>In this article, we propose a potential avenue for enhancement through the development of a semi-supervised convolutional neural network based approach. Named “ScribbleDom”, our method leverages human expert’s input as a form of semi-supervision, thereby seamlessly combines the cognitive abilities of human experts with the computational power of machines. ScribbleDom incorporates a loss function that integrates two crucial components: similarity in gene expression profiles and adherence to the valuable input of a human annotator through scribbles on histology images, providing prior knowledge about spot labels. The spatial continuity of the tissue domains is taken into account by extracting information on the spot microenvironment through convolution filters of varying sizes, in the form of “Inception” blocks. By leveraging this semi-supervised approach, ScribbleDom significantly improves the quality of spatial domains, yielding superior results both quantitatively and qualitatively. Our experiments on several benchmark datasets demonstrate the clear edge of ScribbleDom over state-of-the-art methods—between 1.82% to 169.38% improvements in adjusted Rand index for 9 of the 12 human dorsolateral prefrontal cortex samples, and 15.54% improvement in the melanoma cancer dataset. Notably, when the expert input is absent, ScribbleDom can still operate, in a fully unsupervised manner like the state-of-the-art methods, and produces results that remain competitive.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>Source code is available at Github (<ext-link xlink:href="https://github.com/1alnoman/ScribbleDom" ext-link-type="uri">https://github.com/1alnoman/ScribbleDom</ext-link>) and Zenodo (<ext-link xlink:href="https://zenodo.org/badge/latestdoi/681572669" ext-link-type="uri">https://zenodo.org/badge/latestdoi/681572669</ext-link>).</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>RISE Student Research</institution>
          </institution-wrap>
        </funding-source>
        <award-id>s2022-02-008</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="10"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Spatial transcriptomics (ST), an emerging technology to profile gene expression at the spatial resolution, can reveal new insights into molecular aspects of tissue architecture (<xref rid="btad594-B10" ref-type="bibr">Longo <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btad594-B16" ref-type="bibr">Rao <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btad594-B12" ref-type="bibr">Moses and Pachter 2022</xref>, <xref rid="btad594-B14" ref-type="bibr">Palla <italic toggle="yes">et al.</italic> 2022</xref>). One such aspect is transcriptional homogeneity in tissue regions. Since ST data captures gene expression at spatially resolved spots, clustering the spots based on their transcriptomic profiles can demarcate transcriptionally homogeneous tissue regions (<xref rid="btad594-B11" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic> 2021</xref>). The goal here is to identify spatial domains in the ST data, similar to how image segmentation algorithms demarcate objects in images. Notably, most image segmentation algorithms are “supervised”, i.e., they require training examples with segments demarcated <italic toggle="yes">a priori</italic>. However, such training examples are scarce in the realm of ST, requiring the spatial domain identification algorithms to be unsupervised. Some of the methods that try to solve this problem are Giotto (<xref rid="btad594-B3" ref-type="bibr">Dries <italic toggle="yes">et al.</italic> 2021</xref>), stLearn (<xref rid="btad594-B15" ref-type="bibr">Pham <italic toggle="yes">et al.</italic> 2020</xref>), SpaGCN (<xref rid="btad594-B4" ref-type="bibr">Hu <italic toggle="yes">et al.</italic> 2021</xref>), BayesSpace (<xref rid="btad594-B26" ref-type="bibr">Zhao <italic toggle="yes">et al.</italic> 2021</xref>), SC-MEB (<xref rid="btad594-B25" ref-type="bibr">Yang <italic toggle="yes">et al.</italic> 2022</xref>), etc., of which, SC-MEB, BayesSpace, and SpaGCN are state-of-the-art methods that demonstrated quantitatively better performance than others (<xref rid="btad594-T1" ref-type="table">Table 1</xref>). BayesSpace implements a fully Bayesian statistical method that uses the information from spatial neighborhoods for resolution enhancement of spatial transcriptomic data. SC-MEB, on the other hand, implements an empirical Bayes approach for spatial clustering analysis using a hidden Markov random field. SpaGCN applies a graph convolutional network approach to integrate gene expression profile data, spatial location as well as histology. These approaches for clustering analysis have demonstrated concordance with the available handful of “gold-standard” datasets.</p>
    <table-wrap position="float" id="btad594-T1">
      <label>Table 1.</label>
      <caption>
        <p>Comparison of ScribbleDom and AutoScribbleDom with state-of-the-art spatial and non-spatial clustering methods based on ARI.<sup>a</sup></p>
      </caption>
      <table frame="hsides" rules="groups">
        <colgroup span="1">
          <col valign="top" align="left" span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
        </colgroup>
        <thead>
          <tr>
            <th rowspan="1" colspan="1">Sample</th>
            <th rowspan="1" colspan="1">ScribbleDom</th>
            <th rowspan="1" colspan="1">AutoScribbleDom</th>
            <th rowspan="1" colspan="1">SC-MEB</th>
            <th rowspan="1" colspan="1">BayesSpace</th>
            <th rowspan="1" colspan="1">SpaGCN</th>
            <th rowspan="1" colspan="1">Giotto</th>
            <th rowspan="1" colspan="1">GMM</th>
            <th rowspan="1" colspan="1">Louvain</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td rowspan="1" colspan="1">151507</td>
            <td rowspan="1" colspan="1">
              <bold>0.53</bold>
            </td>
            <td rowspan="1" colspan="1">0.34</td>
            <td rowspan="1" colspan="1">0.42</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.49</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.40</td>
            <td rowspan="1" colspan="1">0.32</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151508</td>
            <td rowspan="1" colspan="1">0.37</td>
            <td rowspan="1" colspan="1">
              <bold>0.44</bold>
            </td>
            <td rowspan="1" colspan="1">
              <bold>0.44</bold>
            </td>
            <td rowspan="1" colspan="1">0.36</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.34</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.25</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151509</td>
            <td rowspan="1" colspan="1">
              <bold>0.65</bold>
            </td>
            <td rowspan="1" colspan="1">0.42</td>
            <td rowspan="1" colspan="1">0.52</td>
            <td rowspan="1" colspan="1">0.44</td>
            <td rowspan="1" colspan="1">0.44</td>
            <td rowspan="1" colspan="1">0.35</td>
            <td rowspan="1" colspan="1">0.29</td>
            <td rowspan="1" colspan="1">0.30</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151510</td>
            <td rowspan="1" colspan="1">0.46</td>
            <td rowspan="1" colspan="1">
              <bold>0.55</bold>
            </td>
            <td rowspan="1" colspan="1">0.39</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.45</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.31</td>
            <td rowspan="1" colspan="1">0.28</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151669</td>
            <td rowspan="1" colspan="1">
              <bold>0.66</bold>
            </td>
            <td rowspan="1" colspan="1">0.32</td>
            <td rowspan="1" colspan="1">0.32</td>
            <td rowspan="1" colspan="1">0.41</td>
            <td rowspan="1" colspan="1">0.26</td>
            <td rowspan="1" colspan="1">0.25</td>
            <td rowspan="1" colspan="1">0.22</td>
            <td rowspan="1" colspan="1">0.20</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151670</td>
            <td rowspan="1" colspan="1">
              <bold>0.70</bold>
            </td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.37</td>
            <td rowspan="1" colspan="1">0.21</td>
            <td rowspan="1" colspan="1">0.19</td>
            <td rowspan="1" colspan="1">0.26</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151671</td>
            <td rowspan="1" colspan="1">
              <bold>0.71</bold>
            </td>
            <td rowspan="1" colspan="1">0.60</td>
            <td rowspan="1" colspan="1">0.42</td>
            <td rowspan="1" colspan="1">0.38</td>
            <td rowspan="1" colspan="1">0.52</td>
            <td rowspan="1" colspan="1">0.40</td>
            <td rowspan="1" colspan="1">0.23</td>
            <td rowspan="1" colspan="1">0.36</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151672</td>
            <td rowspan="1" colspan="1">0.74</td>
            <td rowspan="1" colspan="1">0.63</td>
            <td rowspan="1" colspan="1">0.44</td>
            <td rowspan="1" colspan="1">
              <bold>0.77</bold>
            </td>
            <td rowspan="1" colspan="1">0.57</td>
            <td rowspan="1" colspan="1">0.38</td>
            <td rowspan="1" colspan="1">0.14</td>
            <td rowspan="1" colspan="1">0.27</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151673</td>
            <td rowspan="1" colspan="1">0.50</td>
            <td rowspan="1" colspan="1">0.52</td>
            <td rowspan="1" colspan="1">0.49</td>
            <td rowspan="1" colspan="1">
              <bold>0.55</bold>
            </td>
            <td rowspan="1" colspan="1">0.53</td>
            <td rowspan="1" colspan="1">0.37</td>
            <td rowspan="1" colspan="1">0.29</td>
            <td rowspan="1" colspan="1">0.29</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151674</td>
            <td rowspan="1" colspan="1">
              <bold>0.54</bold>
            </td>
            <td rowspan="1" colspan="1">0.25</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.39</td>
            <td rowspan="1" colspan="1">0.29</td>
            <td rowspan="1" colspan="1">0.29</td>
            <td rowspan="1" colspan="1">0.33</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151675</td>
            <td rowspan="1" colspan="1">
              <bold>0.52</bold>
            </td>
            <td rowspan="1" colspan="1">0.39</td>
            <td rowspan="1" colspan="1">0.31</td>
            <td rowspan="1" colspan="1">0.41</td>
            <td rowspan="1" colspan="1">0.46</td>
            <td rowspan="1" colspan="1">0.32</td>
            <td rowspan="1" colspan="1">0.24</td>
            <td rowspan="1" colspan="1">0.24</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151676</td>
            <td rowspan="1" colspan="1">
              <bold>0.51</bold>
            </td>
            <td rowspan="1" colspan="1">0.38</td>
            <td rowspan="1" colspan="1">0.39</td>
            <td rowspan="1" colspan="1">0.32</td>
            <td rowspan="1" colspan="1">0.35</td>
            <td rowspan="1" colspan="1">0.26</td>
            <td rowspan="1" colspan="1">0.26</td>
            <td rowspan="1" colspan="1">0.25</td>
          </tr>
        </tbody>
      </table>
      <table-wrap-foot>
        <fn id="tblfn1">
          <label>a</label>
          <p>The ARI values of SpaGCN have been collected from the respective paper (<xref rid="btad594-B4" ref-type="bibr">Hu <italic toggle="yes">et al.</italic> 2021</xref>). The ARI values of the remaining state-of-the-art methods were collected from SC-MEB (<xref rid="btad594-B25" ref-type="bibr">Yang <italic toggle="yes">et al.</italic> 2022</xref>) paper. The best ARI value for each sample has been marked in bold-face.</p>
        </fn>
      </table-wrap-foot>
    </table-wrap>
    <p>To enhance the biological relevance of the spatial domains in ST data, we propose a “scribble-supervised” spatial domain identification method, “ScribbleDom”. This semi-supervised approach shares similarities with semi-supervised image segmentation methods and is unattainable by repurposing the existing state-of-the-art methods. An investigation of convolutional neural networks (CNNs) for unsupervised image segmentation was done by <xref rid="btad594-B6" ref-type="bibr">Kim <italic toggle="yes">et al.</italic> (2020)</xref>. They proposed a novel unsupervised image segmentation end-to-end network that includes normalization and an argmax function for differentiable clustering. They also have the option to include prior knowledge about a subset of pixels, obtained through the drawing of scribbles over the input image, which is widely utilized in academic research and commercial applications and is widely regarded as one of the most user-friendly methods of interaction. Using scribbles as annotations, ScribbleSup (<xref rid="btad594-B9" ref-type="bibr">Lin <italic toggle="yes">et al.</italic> 2016</xref>) demonstrated competitive object semantic segmentation results on the PASCAL VOC dataset. To provide pixel-wise labeling, <xref rid="btad594-B24" ref-type="bibr">Xu <italic toggle="yes">et al.</italic> (2015)</xref> presented a unified strategy that integrates several forms of weak supervision—image-level tags, bounding boxes, and partial labels. CNNs are widely used for image classification, segmentation, and object detection. <xref rid="btad594-B23" ref-type="bibr">Xie <italic toggle="yes">et al.</italic> (2015)</xref> proposed deep embedded clustering (DEC), a method that uses deep neural networks to simultaneously learn feature representations and cluster allocations. The use of a CNN-based approach with three-dimensional filters on hand and brain MRI is presented by <xref rid="btad594-B5" ref-type="bibr">Kayalibay <italic toggle="yes">et al.</italic> (2017)</xref>. <xref rid="btad594-B20" ref-type="bibr">Wang <italic toggle="yes">et al.</italic> (2018)</xref> proposed image-specific fine-tuning to adapt a CNN model to a given test image, which can be either unsupervised (with no extra user interactions) or supervised (with additional scribbles).</p>
    <p>ScribbleDom takes inspiration from <xref rid="btad594-B6" ref-type="bibr">Kim <italic toggle="yes">et al.</italic>’s (2020)</xref> semi-supervised formulation of the image segmentation problem. Subsequently, we have significantly customized the model architecture as well as the loss function to cater to the problem of identifying spatial domains in ST data. ST data contains tissue domains with a diverse range of narrowness. To effectively handle the variability in the narrowness of spatial domains in ST data, ScribbleDom has incorporated Inception blocks (<xref rid="btad594-B18" ref-type="bibr">Szegedy <italic toggle="yes">et al.</italic> 2015</xref>) instead of vanilla convolutions. Inception blocks allow the model to process ST data at various viewpoints by employing convolution filters of different sizes. Thus the model is able to capture fine-grained details in narrow spatial domains while also considering broader spatial contexts. By combining the output from the different-sized filters, ScribbleDom effectively integrates information from various levels of granularity, allowing for a comprehensive understanding of the spatial organization within the ST data. ScribbleDom is broadly applicable to technologies that do not generate matching pairs of histology image and RNA data (see Section 4).</p>
    <p>ScribbleDom makes use of the scribble information provided by a human expert. However, in the absence of scribbles from a human annotator, ScribbleDom can still work to produce competitive results by obtaining initial labeling from another clustering algorithm to run in a completely unsupervised fashion. An overview of the workflow in both modes is shown in <xref rid="btad594-F1" ref-type="fig">Fig. 1</xref>. Many of the state-of-the-art methods (e.g. BayesSpace, SC-MEB, SpaGCN, etc.) also incorporate this approach of initializing cluster labels by another clustering algorithm. BayesSpace and SC-MEB use mclust (<xref rid="btad594-B17" ref-type="bibr">Scrucca <italic toggle="yes">et al.</italic> 2016</xref>) and SpaGCN uses Louvain’s method (<xref rid="btad594-B2" ref-type="bibr">De Meo <italic toggle="yes">et al.</italic> 2011</xref>) for initialization. Using the samples from the dataset of the human brain’s dorsolateral prefrontal cortex (DLPFC) region (Visium), melanoma (ST), and human breast cancer (Visium), we have demonstrated that ScribbleDom outperforms state-of-the-art models like BayesSpace, SpaGCN, and SC-MEB in the presence of expert’s scribble annotations. In case the scribble annotations are unavailable, ScribbleDom can still operate in fully unsupervised manner and its performance remains competitive with the state-of-the-art methods.</p>
    <fig position="float" id="btad594-F1">
      <label>Figure 1.</label>
      <caption>
        <p>ScribbleDom overview. ScribbleDom can work through two different pipelines, when the human annotator scribbles over the histology image (upper part) and when the output of a non-spatial clustering algorithm (e.g. mclust) is used as prior knowledge (lower part). ScribbleDom receives the prior knowledge about the spots, the preprocessed transcriptomics data, and the spatial information about each spot as its input. Data are preprocessed by taking highly variable genes (HVG) and then performing principal component analysis (PCA) on these HVGs. ScribbleDom identifies domains in the ST data using Inception by minimizing a loss function having two components—feature similarity loss and scribble loss. The results produced by ScribbleDom show significant improvement compared to state-of-the-art models.</p>
      </caption>
      <graphic xlink:href="btad594f1" position="float"/>
    </fig>
    <p>The key contributions of the paper can be summarized as follows.</p>
    <list list-type="bullet">
      <list-item>
        <p>We have proposed ScribbleDom, a semi-supervised deep-learning-based approach to identify spatial domains in ST data. ScribbleDom allows for seamless combination of human cognitive ability with machines’ computational power for spatial domain identification in ST data using scribble-annotated histology images. This approach makes it possible to change the course of the spatial domain identification procedure through different types of scribbles.</p>
      </list-item>
      <list-item>
        <p>We have devised a scoring function (goodness score) to rank the clustering outcomes from different algorithms, or the same algorithm for different hyperparameter settings. The scoring function takes into consideration gene expression similarity and spatial continuity, and does not require manual annotation for its calculation, unlike metrics such as adjusted Rand index (ARI), Dice score, etc. We have applied this goodness measure in ScribbleDom to choose the optimal hyperparameter settings in a sample-specific manner.</p>
      </list-item>
      <list-item>
        <p>We have analyzed several samples using ScribbleDom and have successfully identified the spatial domains therein. These samples span from tissues that mostly have layers as their spatial domains (DLPFC samples) to tissues with diversity of different spatial structures, such as tumorous cell clusters embedded in healthy tissues (melanoma and human breast cancer datasets). The output of ScribbleDom is generally superior to that of state-of-the-art methods, both qualitatively and quantitatively</p>
      </list-item>
    </list>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <sec>
      <title>2.1 Dataset</title>
      <p>In this study, we analyzed three different datasets. Firstly, we utilized a dataset consisting of 12 human brain samples extracted from the DLPFC region. These samples were measured using the 10x Genomics (<ext-link xlink:href="https://www.10xgenomics.com/" ext-link-type="uri">https://www.10xgenomics.com/</ext-link>) Visium platform. Each sample, when observed in a perpendicular tissue segment, encompasses all six layers of the cortex as well as the adjacent white matter. <xref rid="btad594-B11" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic> (2021)</xref> annotated the DLPFC layers by considering cytoarchitecture and selected gene markers. The full dataset is publicly available through the spatialLIBD (<xref rid="btad594-B11" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic> 2021</xref>) Bioconductor package. This is a gold-standard dataset in the literature as it contains manual annotation for each of the samples. Each of the samples has approximately 4000 spots on average and spots that were manually annotated belong to one of six DLPFC layers or white matter. As the samples were obtained via Visium technology, each of the spots has six neighboring spots, and these six spots correspond to six vertices of a hexagon. Gene expression profile was also available. Each of the spots approximately has 33 000 gene expression values. The spatial information is available in the form of coordinates of each of the spots. One of the challenges of this dataset is to recapitulate the number of layers and the narrowness of each of the layers. While we have analyzed all the samples, we have described our results only for sample 151673 in the main text of the paper. This is because state-of-the-art methods like BayesSpace and SpaGCN showcase their result using this sample. Also, the output for this sample provides better visual quality than the other ones with respect to the narrowness of layers.</p>
      <p>In the second dataset, we focus on analyzing the melanoma cancer samples that were processed using the ST platform (<xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> 2018</xref>). Specifically, we analyzed the second replicate from biopsy 1, because it contains manual annotation where the tissue regions are dispersed across spatially diverse areas. Biopsy 1 consisted of a total of 293 spots covered by tissue.</p>
      <p>For the third dataset, we utilized publicly available data from the 10x Genomics (<xref rid="btad594-B27" ref-type="bibr">Zheng <italic toggle="yes">et al.</italic> 2017</xref>) website. This dataset included spatial transcriptomics data of human breast cancer obtained using the Visium platform. This is ductal carcinoma tissue where the tumors are spread over various regions. It comprises a total of 2518 spots. We obtained the manual annotation from <xref rid="btad594-B13" ref-type="bibr">Ni <italic toggle="yes">et al.</italic> (2022)</xref> where they classify each spot as tumor or non-tumor.</p>
    </sec>
    <sec>
      <title>2.2 Data preprocessing</title>
      <p>In spatial transcriptomics, a transcript count matrix (<inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">N</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>) and spatial coordinates (<inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mi>Z</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>) are generated for <italic toggle="yes">n</italic> different locations (spots) on a tissue slice, where <italic toggle="yes">g</italic> represents the number of genes. To preprocess the count matrix, we utilized the <italic toggle="yes">spatialPreprocess</italic> method from the BayesSpace R package. The data underwent log normalization, and the function was able to select <italic toggle="yes">h</italic> highly variable genes and extract <italic toggle="yes">p</italic> principal components (PCs). The processed count matrix (<inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>′</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mi>x</mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>) is used for the spatial domain identification.</p>
      <p>In our experiment, we chose 2000 highly variable genes for all datasets. The number of principal components was determined based on the BayesSpace approach, with the top 15 and 7 principal components selected for the human DLPFC and melanoma datasets, respectively. For the human breast cancer dataset, we analyzed the scree plot of the top 50 principal components and chose 15 principal components for analysis (see Supplementay data for the scree plot).</p>
      <p>We analyzed datasets that were generated using different spatial transcriptomic technologies, namely ST and Visium. While these technologies have distinct spot distribution patterns, we need to map each spot to a cell of a data matrix so that conventional convolution filters can be applied. This mapping is trivial for ST data, as the spots are organized in square lattice. However, the Visium spots are arranged in a hexagonal lattice structure, with each spot having six neighboring spots. Therefore, we preprocessed the Visium data such that the six neighbors of a spot located at grid location (<italic toggle="yes">i</italic>, <italic toggle="yes">j</italic>) are spots positioned at <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec>
      <title>2.3 Scribble generation</title>
      <p>To facilitate the semi-supervised approach in ScribbleDom, scribbles were generated for the Visium and ST data. For Visium data, this process utilized the CLOUPE file provided by 10x Genomics, which contains essential information regarding histology and spot mapping for the tissue samples. Using Loupe browser 6.3.0, a tool developed by 10x Genomics, we annotated various Visium spots within the tissue. In the case of ST data, specifically for melanoma sample, we scribbled over the pixels of the corresponding histology image. The pixels that were scribbled were then mapped to the corresponding ST spot array. This process allowed us to associate the scribbles with specific spots in the ST data.</p>
      <p>When human annotations (scribbles) are not available, scribbles are generated automatically based on an initial clustering generated by mclust, a non-spatial clustering algorithm. We call this pipeline <italic toggle="yes">AutoScribbleDom</italic>. As mclust is a non-spatial clustering algorithm, the initial clustering thus produced is expected to have inaccuracies in the spatial domains identified. Therefore, only the spots with labels identical to those of all its neighboring spots (six neighbors for Visium, four neighbors for ST) are considered as scribbles, while the labels from the remaining spots are cleared out. The rest of the pipeline is identical to ScribbleDom.</p>
    </sec>
    <sec>
      <title>2.4 Model architecture</title>
      <p>A high-level model architecture of ScribbleDom is shown in <xref rid="btad594-F2" ref-type="fig">Fig. 2</xref>. First, the input tensor containing the principal components of each spot is fed into a 1 × 1 convolution layer with <italic toggle="yes">p</italic> channels. Then there are two inception blocks, which enable the model to extract features at multiple resolutions. After each of these layers, ReLU is used for non-linear activation, which is followed by batch normalization. Subsequently, the features undergo another 1 × 1 convolution layer and batch normalization, resulting in an <italic toggle="yes">s</italic>-dimensional normalized response map for each spot, where <italic toggle="yes">s</italic> is the number of spatial domains to be identified. Finally, each spot’s spatial domain label is obtained by taking the argmax on the response map. The loss function is calculated based on the response map, spot labels, and scribble labels (more details follow).</p>
      <fig position="float" id="btad594-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Schematic diagram of the model architecture of ScribbleDom, which consists of two 1 × 1 convolutions and two inception blocks. The inception blocks facilitate capturing features at different resolutions. Loss is calculated using cross entropy between the predicted cluster label and the scribble (for the scribbled spots) or the response map (for the spots without scribbles).</p>
        </caption>
        <graphic xlink:href="btad594f2" position="float"/>
      </fig>
      <p>An inception block consists of parallel information paths consisting of 1 × 1, 3 × 3, 5 × 5 convolution filters, and a 3 × 3 pooling layer. Features extracted alongside these paths are finally concatenated (<xref rid="btad594-F2" ref-type="fig">Fig. 2</xref>, blowout). The first inception block in our model extracts 256 features where, 160, 64, 16, and 16 features are extracted from the aforementioned paths, respectively. The next inception block extracts 96, 16, 8, and 8 features, respectively, resulting in a concatenation of 128 features. The filters of varied sizes enable the extraction of features at multiple resolutions, aligning with the notion that information should be processed and aggregated across scales. The smaller filters contribute to capturing fine-grained features, while the larger filters facilitate the inclusion of features from the neighboring spots. This amalgamation of features has proven to be advantageous in our experimental evaluations.</p>
    </sec>
    <sec>
      <title>2.5 Loss function</title>
      <p>As inputs to our model, we utilized the low-dimensional representation of the transcript count matrix (<inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>′</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>), the spatial location of the tissue slice spots (<inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mi>Z</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>), and the number of spatial domains to be identified (<italic toggle="yes">s</italic>). If an expert provided scribbles, then <italic toggle="yes">s</italic> was equal to the number of differently colored scribbles. In the case of AutoScribbleDom, we provided the value of <italic toggle="yes">s</italic> as an input to the non-spatial clustering algorithm, mclust. For each spot, we determine the optimal label from <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> by minimizing the following two-component loss function:</p>
      <disp-formula id="E1">
        <mml:math id="M1" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>α</mml:mo>
            <mml:mo>·</mml:mo>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>L</mml:mi>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi>sim</mml:mi>
                </mml:mrow>
              </mml:msub>
            </mml:mrow>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>{</mml:mo>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>r</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>c</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>u</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mo>}</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>+</mml:mo>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mn>1</mml:mn>
            <mml:mo>−</mml:mo>
            <mml:mo>α</mml:mo>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>·</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>j</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>s</mml:mi>
              </mml:munderover>
            </mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:msub>
                  <mml:mrow>
                    <mml:mi>L</mml:mi>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mi mathvariant="italic">scr</mml:mi>
                  </mml:mrow>
                </mml:msub>
              </mml:mrow>
            </mml:mrow>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>{</mml:mo>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>r</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>w</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>u</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mo>}</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <italic toggle="yes">α</italic> is a hyperparameter. Here <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> is the output of a deep neural network that maps the gene expression data of the <italic toggle="yes">i</italic>-th spot to an <italic toggle="yes">s</italic>-dimensional vector. The loss function’s first component is:</p>
      <disp-formula id="E2">
        <mml:math id="M2" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>L</mml:mi>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi mathvariant="italic">sim</mml:mi>
                </mml:mrow>
              </mml:msub>
            </mml:mrow>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>{</mml:mo>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>r</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>c</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>u</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mo>}</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>n</mml:mi>
              </mml:munderover>
            </mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:munderover>
                  <mml:mo>∑</mml:mo>
                  <mml:mrow>
                    <mml:mi>j</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                  </mml:mrow>
                  <mml:mi>s</mml:mi>
                </mml:munderover>
              </mml:mrow>
              <mml:mo>−</mml:mo>
            </mml:mrow>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mn>1</mml:mn>
            <mml:mo>−</mml:mo>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>u</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>δ</mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mi>j</mml:mi>
                <mml:mo>,</mml:mo>
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>c</mml:mi>
                    </mml:mrow>
                    <mml:mi>i</mml:mi>
                  </mml:msub>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mi>ln</mml:mi>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>r</mml:mi>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <italic toggle="yes">δ</italic> is the Kronecker delta function and <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mrow><mml:mi>arg</mml:mi><mml:mi>max</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> is the predicted label for this spot. <italic toggle="yes">u<sub>i</sub></italic> = 1 if the <italic toggle="yes">i</italic>-th spot overlaps a scribble, <italic toggle="yes">u<sub>i</sub></italic> = 0 otherwise. Intuitively, minimizing <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">sim</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> minimizes variance in the predicted values of <italic toggle="yes">c<sub>i</sub></italic>. The second component is:</p>
      <disp-formula id="E3">
        <mml:math id="M3" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>L</mml:mi>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi mathvariant="italic">scr</mml:mi>
                </mml:mrow>
              </mml:msub>
            </mml:mrow>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>{</mml:mo>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>r</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>w</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>u</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mo>}</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>n</mml:mi>
              </mml:munderover>
            </mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:munderover>
                  <mml:mo>∑</mml:mo>
                  <mml:mrow>
                    <mml:mi>j</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                  </mml:mrow>
                  <mml:mi>s</mml:mi>
                </mml:munderover>
              </mml:mrow>
              <mml:mo>−</mml:mo>
            </mml:mrow>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>u</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
            </mml:mrow>
            <mml:mo>δ</mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mi>j</mml:mi>
                <mml:mo>,</mml:mo>
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>w</mml:mi>
                    </mml:mrow>
                    <mml:mi>i</mml:mi>
                  </mml:msub>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mi>ln</mml:mi>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>r</mml:mi>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is the scribble label of spot <italic toggle="yes">i</italic>. Thus, minimizing <italic toggle="yes">L<sub>scr</sub></italic> imposes the constraint that <italic toggle="yes">c<sub>i</sub></italic> matches scribble label of spot <italic toggle="yes">i</italic>.</p>
    </sec>
    <sec>
      <title>2.6 Scribble dropout</title>
      <p>In case of AutoScribbleDom, the initial spot labels from mclust that conforms with neighboring spot labels are considered as scribbles. Nevertheless there can still be some noise in the scribbles. To address this issue, during training, we randomly remove scribble annotations from some spots in each iteration, much like the concept of dropout in deep learning networks. This approach allows the model to learn similarity with other spots, even if some of the spots are incorrectly labeled by the automated scribbles. The dropout rate is controlled by a second hyperparameter called <italic toggle="yes">β</italic>.</p>
    </sec>
    <sec>
      <title>2.7 Hyperparameter selection</title>
      <p>ScribbleDom has only one hyperparameter, <italic toggle="yes">α</italic>, which can tune the relative contribution of similarity loss and the scribble loss to the overall loss function. AutoScribbleDom has a second hyperparameter, <italic toggle="yes">β</italic>, that controls the rate of scribble dropout. We performed a grid search in the hyperparameter space to find the optimal values. We searched <italic toggle="yes">α</italic> over 0.05 to 0.95 and <italic toggle="yes">β</italic> over 0.25 to 0.4, each with an interval of 0.05. The best values were determined by comparing the clustering outputs based on a goodness measure that is described below.</p>
      <p>Let the cluster assignment for <italic toggle="yes">n</italic> spots generated by our model for a particular value of <italic toggle="yes">α</italic> be <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mn>2</mml:mn><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>n</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>. Here, <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is the cluster label for the <italic toggle="yes">i</italic>-th spot and <italic toggle="yes">s</italic> is the number of clusters. For different values <italic toggle="yes">α</italic>, this clustering output would naturally be different. To select the optimal <italic toggle="yes">α</italic>, we developed a scoring function to measure the goodness of each clustering output. This goodness measure consists of three components. The first component is the likelihood of the gene expression PCs of the spots given their cluster assignments, <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Here <italic toggle="yes">y<sub>i</sub></italic> is the gene expression PC vector at spot <italic toggle="yes">i</italic>. We assume that the PCs are Gaussian distributed within each cluster <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> with mean <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="italic">Average</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>i</mml:mi><mml:mo>≤</mml:mo><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and covariance matrix <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>Σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="italic">Covariance</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>i</mml:mi><mml:mo>≤</mml:mo><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. The intuition for this component is that if a spot is assigned to its correct cluster, it will have a higher likelihood compared to had it been assigned to a wrong cluster.</p>
      <p>The second component is the likelihood of the cluster assignment itself, <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup></mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is given by the Potts model (<xref rid="btad594-B22" ref-type="bibr">Wu 1982</xref>).</p>
      <disp-formula id="E4">
        <mml:math id="M4" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mrow>
              <mml:msubsup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
                <mml:mo>α</mml:mo>
              </mml:msubsup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:mfrac>
                <mml:mn>1</mml:mn>
                <mml:mrow>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mrow>
                        <mml:mi>Z</mml:mi>
                      </mml:mrow>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                  </mml:mrow>
                </mml:mrow>
              </mml:mfrac>
            </mml:mrow>
            <mml:mtext>exp</mml:mtext>
            <mml:mo> </mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:mfrac>
                    <mml:mrow>
                      <mml:mn>2</mml:mn>
                      <mml:mo>γ</mml:mo>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mo>|</mml:mo>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mo>〈</mml:mo>
                            <mml:mrow>
                              <mml:mi>i</mml:mi>
                              <mml:mi>j</mml:mi>
                            </mml:mrow>
                            <mml:mo>〉</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mo>|</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mfrac>
                </mml:mrow>
                <mml:mrow>
                  <mml:munderover>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mo>〈</mml:mo>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mi>j</mml:mi>
                        </mml:mrow>
                        <mml:mo>〉</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow/>
                  </mml:munderover>
                </mml:mrow>
                <mml:mo>δ</mml:mo>
                <mml:mo stretchy="false">(</mml:mo>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mi>C</mml:mi>
                    </mml:mrow>
                    <mml:mi>i</mml:mi>
                    <mml:mo>α</mml:mo>
                  </mml:msubsup>
                </mml:mrow>
                <mml:mo>,</mml:mo>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mi>C</mml:mi>
                    </mml:mrow>
                    <mml:mi>j</mml:mi>
                    <mml:mo>α</mml:mo>
                  </mml:msubsup>
                </mml:mrow>
                <mml:mo stretchy="false">)</mml:mo>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>.</mml:mo>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>Here, <italic toggle="yes">γ</italic> is a smoothing parameter, <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>〈</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>〉</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the set of all the spots <italic toggle="yes">j</italic> that are neighbors of <italic toggle="yes">i</italic>, and <italic toggle="yes">Z<sub>i</sub></italic> is the normalization factor. As suggested by (<xref rid="btad594-B26" ref-type="bibr">Zhao <italic toggle="yes">et al.</italic> (2021)</xref>, we used <italic toggle="yes">γ</italic> = 2 for ST data, and <italic toggle="yes">γ</italic> = 3 for Visium data. The normalization factor <italic toggle="yes">Z<sub>i</sub></italic> is calculated by aggregating the values of <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for all possible cluster labels of the <italic toggle="yes">i</italic>-th spot. The Potts model encourages nearby spots to belong to the same cluster, thus assigning a higher likelihood to cluster assignments with better spatial continuity.</p>
      <p>Lastly, we expect the spots belonging to the same cluster to have similar gene expressions (and thus similar PCs). Therefore, the correct cluster assignment should have a lower sum of variances of PCs within each cluster. Hence, we define the third quasi-likelihood component <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:mi>q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> as:</p>
      <disp-formula id="E5">
        <mml:math id="M5" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi>q</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>,</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>=</mml:mo>
            <mml:mtext>exp</mml:mtext>
            <mml:mo> </mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mo>−</mml:mo>
                <mml:mo>λ</mml:mo>
                <mml:mrow>
                  <mml:munderover>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>j</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>s</mml:mi>
                  </mml:munderover>
                </mml:mrow>
                <mml:mi>t</mml:mi>
                <mml:mi>r</mml:mi>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mo>Σ</mml:mo>
                        </mml:mrow>
                        <mml:mi>j</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>,</mml:mo>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> denotes the trace of a matrix, and <italic toggle="yes">λ</italic> is a scaling factor that is set to 100 in this study. Therefore, the final goodness measure of the clustering output <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:mi>v</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the product of the three components,</p>
      <disp-formula id="E6">
        <mml:math id="M6" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi>v</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>,</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>=</mml:mo>
            <mml:mi>q</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>,</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>|</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>=</mml:mo>
            <mml:mi>q</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>,</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∏</mml:mo>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>n</mml:mi>
              </mml:munderover>
            </mml:mrow>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>y</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
            </mml:mrow>
            <mml:mo>|</mml:mo>
            <mml:mrow>
              <mml:msubsup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
                <mml:mo>α</mml:mo>
              </mml:msubsup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mrow>
              <mml:msubsup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
                <mml:mo>α</mml:mo>
              </mml:msubsup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>For AutoScribbleDom, we follow the exact same process, but in this case, we search the (<italic toggle="yes">α</italic>, <italic toggle="yes">β</italic>) hyperparameter space instead of just <italic toggle="yes">α</italic>.</p>
    </sec>
    <sec>
      <title>2.8 Ground truth annotation procedure</title>
      <p>In the case of the human DLPFC data, the ground truth annotations are done by <xref rid="btad594-B11" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic> (2021)</xref> based on cytoarchitecture and selected gene markers. For the melanoma sample, the contour annotations over the histology image were done by <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref>; spot-level annotations did not exist. To generate spot-level annotations, we utilized the ST Spot Detector tool. Due to printing artifacts, the array used to create ST datasets may have positional variations. To address this issue, the tool provides corrected spot coordinates in both adjusted array coordinates and pixel coordinates on a high-resolution image. We then generated a mapping of array annotation based on the annotations made by <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref> over the histology image.</p>
      <p>In the process of manually annotating melanoma spots, we encountered two types of unannotated spots (<xref rid="btad594-F4" ref-type="fig">Fig. 4c</xref>). Firstly, there were spots in the region that were not originally annotated by <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref>, the publishers of the dataset. Secondly, there were spots located at the borders of two regions, making it challenging to assign them to a specific region accurately. We treated both kinds of spots as unannotated while measuring clustering performances.</p>
    </sec>
    <sec>
      <title>2.9 Performance measure</title>
      <p>To objectively assess the similarity between cluster labels and manual annotation, which is regarded as the ground truth, we employed the ARI. Given a set <italic toggle="yes">S</italic> of <italic toggle="yes">n</italic> elements, and two groupings or partitions (e.g. clusterings) of these elements, namely <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mrow><mml:mi>Y</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>, the overlap between X and Y can be summarized in a contingency table <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> where each entry <italic toggle="yes">n<sub>ij</sub></italic> denotes the number of objects in common between <italic toggle="yes">X<sub>i</sub></italic> and <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>:</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∩</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula></p>
      <disp-formula id="E7">
        <mml:math id="M7" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi mathvariant="italic">ARI</mml:mi>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:mfrac>
                <mml:mrow>
                  <mml:mrow>
                    <mml:munder>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mi>j</mml:mi>
                      </mml:mrow>
                    </mml:munder>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mtable>
                        <mml:mtr>
                          <mml:mtd>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>n</mml:mi>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mi>i</mml:mi>
                                  <mml:mi>j</mml:mi>
                                </mml:mrow>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mtd>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd>
                            <mml:mn>2</mml:mn>
                          </mml:mtd>
                        </mml:mtr>
                      </mml:mtable>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo>−</mml:mo>
                  <mml:mrow>
                    <mml:mo stretchy="true">[</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>i</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>a</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>j</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>b</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>j</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo stretchy="true">]</mml:mo>
                  </mml:mrow>
                  <mml:mo>/</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mtable>
                      <mml:mtr>
                        <mml:mtd>
                          <mml:mi>n</mml:mi>
                        </mml:mtd>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd>
                          <mml:mn>2</mml:mn>
                        </mml:mtd>
                      </mml:mtr>
                    </mml:mtable>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mfrac>
                      <mml:mrow>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mn>2</mml:mn>
                      </mml:mrow>
                    </mml:mfrac>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mo stretchy="true">[</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>i</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>a</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo>+</mml:mo>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>j</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>b</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>j</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo stretchy="true">]</mml:mo>
                  </mml:mrow>
                  <mml:mo>−</mml:mo>
                  <mml:mrow>
                    <mml:mo stretchy="true">[</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>i</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>a</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>j</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>b</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>j</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo stretchy="true">]</mml:mo>
                  </mml:mrow>
                  <mml:mo>/</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mtable>
                      <mml:mtr>
                        <mml:mtd>
                          <mml:mi>n</mml:mi>
                        </mml:mtd>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd>
                          <mml:mn>2</mml:mn>
                        </mml:mtd>
                      </mml:mtr>
                    </mml:mtable>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mfrac>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula></p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 ScribbleDom outperforms state-of-the-art methods in 9 out of the 12 samples of the human DLPFC dataset</title>
      <p><xref rid="btad594-T1" ref-type="table">Table 1</xref> shows the comparison of ScribbleDom with several state-of-the-art algorithms in terms of ARI. We chose to compare with BayesSpace, SC-MEB, SpaGCN, and Giotto as these are four very recently published spatial clustering algorithms. Additionally, SpaGCN integrates information from gene expression, spatial location, and histology for spatial domain identification. Since ScribbleDom also extracts some information from histology (through the form of expert scribbles), it made perfect sense to benchmark against SpaGCN. From the performance of the state-of-the-art spatial clustering methods, it is clear that spatial clustering algorithms perform much better than the non-spatial ones in spatial domain identification. Nevertheless, to be comprehensive, we wanted to benchmark ScribbleDom against a few non-spatial clustering algorithms. For this, we chose Gaussian mixture model (GMM) (<xref rid="btad594-B1" ref-type="bibr">Bishop 2006</xref>) and Louvain (<xref rid="btad594-B2" ref-type="bibr">De Meo <italic toggle="yes">et al.</italic> 2011</xref>). We have compared with BayesSpace, SpaGCN, and SC-MEB which are state-of-the-art methods. We have also compared with Giotto (<xref rid="btad594-B3" ref-type="bibr">Dries <italic toggle="yes">et al.</italic> 2021</xref>) and two non-spatial clustering algorithms, namely, GMM (<xref rid="btad594-B1" ref-type="bibr">Bishop 2006</xref>) and Louvain (<xref rid="btad594-B2" ref-type="bibr">De Meo <italic toggle="yes">et al.</italic> 2011</xref>). ScribbleDom equals or outperforms all the aforementioned state-of-the-art methods in 9 out of the 12 samples, improving the ARI by 51.90%, 47.40%, and 49.84% on average compared to BayesSpace, SC-MEB, and SpaGCN, respectively. Additionally, ScribbleDom equals or outperforms BayesSpace in 10, and SC-MEB in 11 samples. On the other hand, AutoScribbleDom equals or outperforms BayesSpace in 5 samples, and SC-MEB in 7 samples.</p>
      <p>These results imply significant quantitative superiority of ScribbleDom over state-of-the-art methods. Moreover, one of the main drawbacks of BayesSpace is the greater thickness of some layers compared to the manual annotation, e.g. layer 4 (colored magenta) of <xref rid="btad594-F3" ref-type="fig">Fig. 3a</xref>. BayesSpace (<xref rid="btad594-F3" ref-type="fig">Fig. 3f</xref>) predicted layer 4 to be much thicker than what the manual annotation suggests. ScribbleDom can identify layer 4 as a comparatively narrower layer (<xref rid="btad594-F3" ref-type="fig">Fig. 3d</xref>) which better resembles the manual annotation.</p>
      <fig position="float" id="btad594-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Comparison of various spatial domain detection algorithms on the DLPFC dataset, sample 151673. (a) Manual annotation (ground truth). (b) Scribbles by a human annotator. (c) Spatial domains detected by ScribbleDom. (d) Spatial domains detected by SC-MEB. (e) Spatial domains detected by BayesSpace. (f) Spatial domains detected by AutoScribbleDom.</p>
        </caption>
        <graphic xlink:href="btad594f3" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.2 ScribbleDom identifies narrow lymphoid tissue regions around the tumor in melanoma cancer sample</title>
      <p>We evaluated the performance of ScribbleDom on a melanoma sample from <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref>, and it outperforms BayesSpace by 15.54% in terms of ARI calculated on the manually annotated regions. The manual annotation (<xref rid="btad594-F4" ref-type="fig">Fig. 4c</xref>) of the tissue revealed three distinct regions: melanoma, stroma, and lymphoid tissue, with an additional unannotated area. So, we conducted experiments with ScribbleDom as well as AutoScribbleDom using four clusters.</p>
      <fig position="float" id="btad594-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Analysis on melanoma ST sample. (a) Histology image. (b) Manual annotation. (c) Scribbles by a human annotator. (d) Spatial domains detected by BayesSpace. (e) Spatial domains detected by AutoScribbleDom. (f) Spatial domains detected by ScribbleDom.</p>
        </caption>
        <graphic xlink:href="btad594f4" position="float"/>
      </fig>
      <p>ScribbleDom captured the melanoma tumor region as a whole (<xref rid="btad594-F4" ref-type="fig">Fig. 4g</xref>), in contrast to other methods such as BayesSpace (<xref rid="btad594-F4" ref-type="fig">Fig. 4e</xref>), Giotto (<xref rid="btad594-B3" ref-type="bibr">Dries <italic toggle="yes">et al.</italic> 2021</xref>), and Louvain (<xref rid="btad594-B2" ref-type="bibr">De Meo <italic toggle="yes">et al.</italic> 2011</xref>), which tended to split the tumor into peripheral and central regions. Notably, our method also successfully identified the lymphoid tissues surrounding the tumor region, a feature shared only by Giotto, SC3 (<xref rid="btad594-B7" ref-type="bibr">Kiselev <italic toggle="yes">et al.</italic> 2017</xref>), and BayesSpace in subspot resolution. BayesSpace does not capture the lymphoid tissue bordering the tumor in its original resolution (<xref rid="btad594-F4" ref-type="fig">Fig. 4e</xref>). On the other hand, AutoScribbleDom identified a periphery around the center of the tumor region, along with the surrounding lymphoid tissue (<xref rid="btad594-F4" ref-type="fig">Fig. 4f</xref>).</p>
      <p>We calculated the ARI (excluding the unannotated spots) to measure the agreement between spatial domains detected by ScribbleDom and the manual annotation. ScribbleDom achieved an ARI of 0.87 outperforming BayesSpace (0.75). On the other hand, AutoScribbleDom achieved an ARI of 0.74. Although slightly lower than the ARI achieved by BayesSpace, our method exhibited superior accuracy in capturing the presence of lymphoid tissues surrounding the tumor.</p>
      <p>These findings highlight the efficacy of ScribbleDom in identifying narrow regions, such as lymphoid cells around the melanoma tumor in cancer tissue, demonstrating its superior performance compared to BayesSpace. Also, AutoScribbleDom autonomously identified most of the annotated lymphoid regions. These results underscore the potential of ScribbleDom and AutoScribbleDom in facilitating a better understanding of the tumor microenvironment.</p>
    </sec>
    <sec>
      <title>3.3 ScribbleDom can differentiate tumor and non-tumor regions in human breast cancer tissue</title>
      <p>We applied ScribbleDom to analyze a human breast cancer Visium sample, and it performed at par with the results obtained using BayesSpace in both semi-supervised and unsupervised settings. The manual annotation of the sample consists of two distinct regions: tumor and non-tumor (<xref rid="btad594-F5" ref-type="fig">Fig. 5c</xref>). With a limited amount of scribbles (<xref rid="btad594-F5" ref-type="fig">Fig. 5d</xref>), ScribbleDom was able to successfully detect the tumors (<xref rid="btad594-F5" ref-type="fig">Fig. 5g</xref>). ScribbleDom achieved an ARI of 0.82 (<xref rid="btad594-F5" ref-type="fig">Fig. 5g</xref>). Even AutoScribbleDom obtained a competitive ARI of 0.83 (<xref rid="btad594-F5" ref-type="fig">Fig. 5f</xref>). While this ARI is slightly lower than that of BayesSpace (0.84) (<xref rid="btad594-F5" ref-type="fig">Fig. 5e</xref>), it is worth noting that ScribbleDom or AutoScribbleDom still effectively captured all the tumor regions in the human breast cancer sample.</p>
      <fig position="float" id="btad594-F5">
        <label>Figure 5.</label>
        <caption>
          <p>Analysis on human breast cancer dataset. (a) Histology image. (b) Manual annotation. (c) Scribbles by a human annotator. (d) Spatial domains detected by BayesSpace. (e) Spatial domains detected by AutoScribbleDom. (f) Spatial domains detected by ScribbleDom.</p>
        </caption>
        <graphic xlink:href="btad594f5" position="float"/>
      </fig>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>ScribbleDom detects spatial domains in ST tissue samples by leveraging gene expression, spatial neighborhood, and some prior knowledge about the sample. The prior information can either be from a human annotator for some of the spots in the form of scribbles on histology image, or generated from an unsupervised non-spatial clustering algorithm (e.g. mclust). We named the later approach AutoScribbleDom. The output generated by ScribbleDom provides valuable insights into the transcriptionally homogeneous tissue regions within the spatial transcriptomics data. In comparison to existing state-of-the-art methods, ScribbleDom demonstrates superior accuracy in detecting spatial domains whereas AutoScribbleDom too shows competitive results.</p>
    <p>Many recent methods incorporate histology information for spatial domain identification. However, not all spatial transcriptomics technology can generate RNA data and histology in a matching way. This may decrease the quality of histology to spot mapping. ScribbleDom can overcome this limitation as it does not require a one-to-one mapping from histology to spots. In the case where one-to-one histology to spot mapping is not present, the scribbled spots can potentially be derived from scribbles over the histology by an estimation method. So, scribbling over the spots of ST data is a potential future work.</p>
    <p><xref rid="btad594-T1" ref-type="table">Table 1</xref> shows the superiority of ScribbleDom quantitatively, and <xref rid="btad594-F3" ref-type="fig">Fig. 3g</xref> shows the qualitative superiority of ScribbleDom for sample 151673 of the human DLPFC dataset, where the thickness of the layers is better predicted by ScribbleDom (see for example, the thickness of layer 4, colored magenta in manual annotation). Figures for other samples can be found in the <xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref>. Moreover, in the analysis of the melanoma and human breast cancer datasets, ScribbleDom successfully detected the tumor regions. Specifically, in the case of melanoma, we were able to capture the lymphoid tissues that border the melanoma region using both the semi-supervised (<xref rid="btad594-F4" ref-type="fig">Fig. 4g</xref>) and unsupervised (<xref rid="btad594-F4" ref-type="fig">Fig. 4f</xref>) approaches. Furthermore, ScribbleDom outperformed BayesSpace in terms of ARI, demonstrating a more accurate identification of the melanoma and lymphoid tissue regions. ScribbleDom’s capability to identify different regions of the tumor neighborhood suggests its potential use in detecting narrow regions such as lymphoid tissues. The ability to segment and identify specific regions within a tumor can aid in understanding the composition and characteristics of the tumor neighborhood.</p>
    <p>Our experiments have demonstrated that ScribbleDom achieves high accuracy in detecting spatial domains within tissue regions when expert scribbles are available. This highlights ScribbleDom’s ability to leverage domain knowledge provided by expert annotators to identify different tissue domains. We have introduced a hyperparameter, <italic toggle="yes">α</italic>, to control the relative importance of scribbles and gene expression similarity across spots. Additionally, ScribbleDom incorporates inception blocks to capture multi-scale features within the tissue region, enabling accurate detection of various tissue domains, such as smooth layers in human DLPFC samples, narrow bordering regions of lymphoid tissues around tumor regions in melanoma, and scattered tumors across different regions in human breast cancer dataset. AutoScribbleDom also shows competitive results compared to state-of-the-art methods. It utilizes a non-spatial clustering algorithm (mclust) to generate automated scribbles and uses them for the identification of spatial domains. However, the automated scribbles generated by mclust may not accurately represent the spatial domain, due to its (mclust) inability to incorporate spatial information. To mitigate potential inaccuracies, we randomly drop some scribbled spots in each iteration, controlling the dropout rate with another parameter <italic toggle="yes">β</italic>. This approach helps AutoScribbleDom generalize the information from similar spots and reduces the impact of inaccurate automated scribbles.</p>
    <p>Additionally, instead of fixing the hyperparameters at specific values, we performed a grid search across a range of hyperparameter values. We selected the hyperparameter values that maximize an ARI independent goodness score. The goodness is determined from the clustering likelihood, the conditional likelihood of the gene expression of spots given the clustering and a penalty term that tends to reduce variance of the PCs within the same cluster. Our proposed goodness score can potentially be used to compare clustering output of various algorithms and can help practitioners pick the best one.</p>
    <p>Although there has not been a thorough benchmarking on the existing ST domain detection methods, the publications suggest that no method is an indisputable winner in every dataset. This leaves practitioners like clinicians and experimental biologists a bit helpless—on one hand, it is difficult to fine-tune the model parameters to obtain the domains that conform to known biology; on the other hand, the existing methods cannot directly incorporate any form of human supervision. Thus, ScribbleDom fills in a unique niche: (i) it is a versatile method that works satisfactorily both with and without human supervision and (ii) it can work with minimal human supervision, in the form of scribbles. ScribbleDom thus broadens the options for practitioners, especially for domain detection in complex tissues, e.g. from advanced disease states. Another important application of ScribbleDom can be in helping practitioners and method developers efficiently create ground truth annotations without inducing bias, e.g. in demarcating the precise domain boundaries.</p>
    <p>ScribbleDom is generalizable to other sequencing-based technologies as well [e.g. Stereo-seq (<xref rid="btad594-B21" ref-type="bibr">Wei <italic toggle="yes">et al.</italic> 2022</xref>)]. These technologies capture cells in spots (beads) arranged in grids, and ScribbleDom’s convolutions (its basic blocks) work seamlessly on any grid-structured data. With minor preprocessing, ScribbleDom is also applicable to fluorescent in situ hybridization (FISH) based techniques. In these cases, ScribbleDom will need a preprocessed input where one has overlaid a grid structure on the spatial transcriptomic measurements. Alternately, graph convolutions can be implemented for FISH-based data, which is left as a future work.</p>
    <p>ScribbleDom is extensible and can be pretrained if more datasets are available in the future. It enables the human-in-the-loop paradigm in the process of machine learning for the identification of spatial domains in the realm of spatial transcriptomics by incorporating prior annotations obtained from human experts. This means that a clinician is not limited to a fixed output provided by an unsupervised method. Instead, by inputting different scribbles, they can obtain diverse outputs, making the spatial domain identification process more robust and adaptable.</p>
  </sec>
  <sec>
    <title>5 Conclusion</title>
    <p>One of the “eleven grand challenges in single-cell data science” (<xref rid="btad594-B8" ref-type="bibr">Lahnemann <italic toggle="yes">et al.</italic> 2020</xref>) is to find patterns in spatially resolved measurements. We have incorporated a semi-supervised deep learning pipeline in this work to address that challenge. Inspired by similarities in the problem in hand to the image segmentation problem in the computer vision community, we started our endeavors from a state-of-the-art pipeline to solve the later problem. We then made considerable changes to the model to adapt it to spatial transcriptomics data. Furthermore, we made important changes in the model architecture to capture spatial domain features at different resolutions. Our method, ScribbleDom, allows for the incorporation of expert knowledge in the form of scribbles. The method can also function in a fully unsupervised manner when input from an expert is not available. Through a benchmark study with state-of-the-art methods on the human DLPFC, melanoma, and human breast cancer datasets, we have demonstrated the superiority of our semi-supervised approach. In the future, we can pretrain our model as more manually annotated data become available. The ScribbleDom package is well documented and easy to use. We hope that biologists will use ScribbleDom to identify spatial domains in ST samples that would benefit them for downstream analyses which will lead to potential discoveries in the field of bioinformatics.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btad594_Supplementary_Data</label>
      <media xlink:href="btad594_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We thank the anonymous reviewers for their valuable suggestions. We acknowledge <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref> for providing us with the high-resolution H&amp;E stained image of the melanoma ST sample.</p>
  </ack>
  <sec>
    <title>Author contributions</title>
    <p>M.A.H.S. and M.S.R. conceived the study. M.N.R., A.A.N., and A.M.T. ran all the experiments. M.A.A. implemented the goodness measure to compare among models with different hyperparameter settings. A.A.N. finalized the s/w package. All authors contributed to analyzing the results and writing the manuscript. M.A.H.S. and M.S.R. did the final editorial. All the authors reviewed the manuscript.</p>
  </sec>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>M.N.R. is supported by the ICT Fellowship at the Masters level in the fiscal year 2022–2023 for research in ICT sector, administered by ICT Division, Government of People’s Republic of Bangladesh. A.A.N. is supported by RISE Student Research Grant [No. s2022-02-008], administered by RISE, BUET.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>Human Dorsolateral prefrontal cortex (DLPFC) raw spatial data for all the 12 samples is publicly available in spatialLIBD website (<ext-link xlink:href="https://research.libd.org/spatialLIBD/" ext-link-type="uri">https://research.libd.org/spatialLIBD/</ext-link>) under the “raw data” header. Human breast cancer: ductal carcinoma in situ, invasive carcinoma raw count matrix and tissue spatial positions are publicly available in 10xgenomics website (<ext-link xlink:href="https://www.10xgenomics.com/resources/datasets/human-breast-cancer-ductal-carcinoma-in-situ-invasive-carcinoma-ffpe-1-standard-1-3-0" ext-link-type="uri">https://www.10xgenomics.com/resources/datasets/human-breast-cancer-ductal-carcinoma-in-situ-invasive-carcinoma-ffpe-1-standard-1-3-0</ext-link>) under the “Output Files” header. Melanoma raw count matrix can be downloaded from Spatial Research website (<ext-link xlink:href="https://www.spatialresearch.org/wp-content/uploads/2019/03/ST-MelanomaDatasets_1.zip" ext-link-type="uri">https://www.spatialresearch.org/wp-content/uploads/2019/03/ST-MelanomaDatasets_1.zip</ext-link>); row/column coordinates are obtained from column labels of the raw count matrix.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btad594-B1">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Bishop</surname><given-names>CM.</given-names></string-name></person-group>  <year>2006</year>. <source>Pattern Recognition and Machine Learning (Information Science and Statistics)</source>. <publisher-loc>Berlin</publisher-loc>: <publisher-name>Springer-Verlag</publisher-name>.</mixed-citation>
    </ref>
    <ref id="btad594-B2">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>De Meo</surname><given-names>P</given-names></string-name>, <string-name><surname>Ferrara</surname><given-names>E</given-names></string-name>, <string-name><surname>Fiumara</surname><given-names>G</given-names></string-name></person-group>  <etal>et al</etal> Generalized Louvain method for community detection in large networks. In: <italic toggle="yes">International Conference on Intelligent Systems Design and Applications, ISDA, Córdoba, Spain</italic>, <year>2011.</year></mixed-citation>
    </ref>
    <ref id="btad594-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dries</surname><given-names>R</given-names></string-name>, <string-name><surname>Zhu</surname><given-names>Q</given-names></string-name>, <string-name><surname>Dong</surname><given-names>R</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Giotto: a toolbox for integrative analysis and visualization of spatial expression data</article-title>. <source>Genome Biol</source>  <year>2021</year>;<volume>22</volume>:<fpage>78</fpage>.<pub-id pub-id-type="pmid">33685491</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hu</surname><given-names>J</given-names></string-name>, <string-name><surname>Li</surname><given-names>X</given-names></string-name>, <string-name><surname>Coleman</surname><given-names>K</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>SpaGCN: integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>. <source>Nat Methods</source>  <year>2021</year>;<volume>18</volume>:<fpage>1342</fpage>–<lpage>51</lpage>.<pub-id pub-id-type="pmid">34711970</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B5">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Kayalibay</surname><given-names>B</given-names></string-name>, <string-name><surname>Jensen</surname><given-names>G</given-names></string-name>, <string-name><surname>van der Smagt</surname><given-names>P.</given-names></string-name></person-group> CNN-based segmentation of medical imaging data. arXiv, arXiv:1701.03056, <year>2017</year>, preprint: not peer reviewed.</mixed-citation>
    </ref>
    <ref id="btad594-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kim</surname><given-names>W</given-names></string-name>, <string-name><surname>Kanezaki</surname><given-names>A</given-names></string-name>, <string-name><surname>Tanaka</surname><given-names>M.</given-names></string-name></person-group>  <article-title>Unsupervised learning of image segmentation based on differentiable feature clustering</article-title>. <source>IEEE Trans Image Process</source>  <year>2020</year>;<volume>29</volume>:<fpage>8055</fpage>–<lpage>68</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kiselev</surname><given-names>VY</given-names></string-name>, <string-name><surname>Kirschner</surname><given-names>K</given-names></string-name>, <string-name><surname>Schaub</surname><given-names>MT</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Sc3: consensus clustering of single-cell RNA-seq data</article-title>. <source>Nat Methods</source>  <year>2017</year>;<volume>14</volume>:<fpage>483</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">28346451</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lahnemann</surname><given-names>D</given-names></string-name>, <string-name><surname>Koster</surname><given-names>J</given-names></string-name>, <string-name><surname>Szczurek</surname><given-names>E</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Eleven grand challenges in single-cell data science</article-title>. <source>Genome Biol</source>  <year>2020</year>;<volume>21</volume>:<fpage>31</fpage>.<pub-id pub-id-type="pmid">32033589</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B9">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Lin</surname><given-names>D</given-names></string-name>, <string-name><surname>Dai</surname><given-names>J</given-names></string-name>, <string-name><surname>Jia</surname><given-names>J</given-names></string-name></person-group>  <etal>et al</etal> Scribblesup: Scribble-supervised convolutional networks for semantic segmentation. In: <italic toggle="yes">2016 IEEE Conference on Computer Vision and Pattern Recognition (CVPR), Las Vegas, USA</italic>, <year>2016</year>, <fpage>3159</fpage>–<lpage>67</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Longo</surname><given-names>SK</given-names></string-name>, <string-name><surname>Guo</surname><given-names>MG</given-names></string-name>, <string-name><surname>Ji</surname><given-names>AL</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Integrating single-cell and spatial transcriptomics to elucidate intercellular tissue dynamics</article-title>. <source>Nat Rev Genet</source>  <year>2021</year>;<volume>22</volume>:<fpage>627</fpage>–<lpage>44</lpage>.<pub-id pub-id-type="pmid">34145435</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maynard</surname><given-names>KR</given-names></string-name>, <string-name><surname>Collado-Torres</surname><given-names>L</given-names></string-name>, <string-name><surname>Weber</surname><given-names>LM</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Transcriptome-scale spatial gene expression in the human dorsolateral prefrontal cortex</article-title>. <source>Nat Neurosci</source>  <year>2021</year>;<volume>24</volume>:<fpage>425</fpage>–<lpage>36</lpage>.<pub-id pub-id-type="pmid">33558695</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moses</surname><given-names>L</given-names></string-name>, <string-name><surname>Pachter</surname><given-names>L.</given-names></string-name></person-group>  <article-title>Museum of spatial transcriptomics</article-title>. <source>Nat Methods</source>  <year>2022</year>;<volume>19</volume>:<fpage>534</fpage>–<lpage>46</lpage>.<pub-id pub-id-type="pmid">35273392</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ni</surname><given-names>Z</given-names></string-name>, <string-name><surname>Prasad</surname><given-names>A</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Spotclean adjusts for spot swapping in spatial transcriptomics data</article-title>. <source>Nat Commun</source>  <year>2022</year>;<volume>13</volume>:<fpage>2971</fpage>.<pub-id pub-id-type="pmid">35624112</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Palla</surname><given-names>G</given-names></string-name>, <string-name><surname>Fischer</surname><given-names>DS</given-names></string-name>, <string-name><surname>Regev</surname><given-names>A</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Spatial components of molecular tissue biology</article-title>. <source>Nat Biotechnol</source>  <year>2022</year>;<volume>40</volume>:<fpage>308</fpage>–<lpage>18</lpage>.<pub-id pub-id-type="pmid">35132261</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B15">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Pham</surname><given-names>D</given-names></string-name>, <string-name><surname>Tan</surname><given-names>X</given-names></string-name>, <string-name><surname>Xu</surname><given-names>J</given-names></string-name></person-group>  <etal>et al</etal> stLearn: integrating spatial location, tissue morphology and gene expression to find cell types, cell-cell interactions and spatial trajectories within undissociated tissues. bioRxiv, <pub-id pub-id-type="doi">10.1101/2020.05.31.125658</pub-id>, <year>2020</year>, preprint: not peer reviewed.</mixed-citation>
    </ref>
    <ref id="btad594-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rao</surname><given-names>A</given-names></string-name>, <string-name><surname>Barkley</surname><given-names>D</given-names></string-name>, <string-name><surname>França</surname><given-names>GS</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Exploring tissue architecture using spatial transcriptomics</article-title>. <source>Nature</source>  <year>2021</year>;<volume>596</volume>:<fpage>211</fpage>–<lpage>20</lpage>.<pub-id pub-id-type="pmid">34381231</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Scrucca</surname><given-names>L</given-names></string-name>, <string-name><surname>Fop</surname><given-names>M</given-names></string-name>, <string-name><surname>Murphy</surname><given-names>TB</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Mclust 5: clustering, classification and density estimation using Gaussian finite mixture models</article-title>. <source>R J</source>  <year>2016</year>;<volume>8</volume>:<fpage>289</fpage>–<lpage>317</lpage>.<pub-id pub-id-type="pmid">27818791</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B18">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Szegedy</surname><given-names>C</given-names></string-name>, <string-name><surname>Liu</surname><given-names>W</given-names></string-name>, <string-name><surname>Jia</surname><given-names>Y</given-names></string-name></person-group>  <etal>et al</etal> Going deeper with convolutions. In: <italic toggle="yes">Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition, Boston, USA</italic>, <year>2015</year>, <fpage>1</fpage>–<lpage>9</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Thrane</surname><given-names>K</given-names></string-name>, <string-name><surname>Eriksson</surname><given-names>H</given-names></string-name>, <string-name><surname>Maaskola</surname><given-names>J</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Spatially resolved transcriptomics enables dissection of genetic heterogeneity in stage III cutaneous malignant melanoma</article-title>. <source>Cancer Res</source>  <year>2018</year>;<volume>78</volume>:<fpage>5970</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">30154148</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>G</given-names></string-name>, <string-name><surname>Li</surname><given-names>W</given-names></string-name>, <string-name><surname>Zuluaga</surname><given-names>MA</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Interactive medical image segmentation using deep learning with image-specific fine tuning</article-title>. <source>IEEE Trans Med Imaging</source>  <year>2018</year>;<volume>37</volume>:<fpage>1562</fpage>–<lpage>73</lpage>.<pub-id pub-id-type="pmid">29969407</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wei</surname><given-names>X</given-names></string-name>, <string-name><surname>Fu</surname><given-names>S</given-names></string-name>, <string-name><surname>Li</surname><given-names>H</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Single-cell stereo-seq reveals induced progenitor cells involved in axolotl brain regeneration</article-title>. <source>Science</source>  <year>2022</year>;<volume>377</volume>:<fpage>eabp9444</fpage>.<pub-id pub-id-type="pmid">36048929</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wu</surname><given-names>F-Y.</given-names></string-name></person-group>  <article-title>The Potts model</article-title>. <source>Rev Mod Phys</source>  <year>1982</year>;<volume>54</volume>:<fpage>235</fpage>–<lpage>68</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B23">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Xie</surname><given-names>J</given-names></string-name>, <string-name><surname>Girshick</surname><given-names>R</given-names></string-name>, <string-name><surname>Farhadi</surname><given-names>A.</given-names></string-name></person-group> Unsupervised deep embedding for clustering analysis. In: <italic toggle="yes">Proceedings of the 33rd International Conference on Machine Learning</italic>, pp. 478–487. PMLR, New York, NY, USA, 2016.</mixed-citation>
    </ref>
    <ref id="btad594-B24">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Xu</surname><given-names>J</given-names></string-name>, <string-name><surname>Schwing</surname><given-names>AG</given-names></string-name>, <string-name><surname>Urtasun</surname><given-names>R.</given-names></string-name></person-group> Learning to segment under various forms of weak supervision. In: <italic toggle="yes">2015 IEEE Conference on Computer Vision and Pattern Recognition (CVPR), Boston, USA</italic>, <year>2015</year>, <fpage>3781</fpage>–<lpage>90</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Shi</surname><given-names>X</given-names></string-name>, <string-name><surname>Liu</surname><given-names>W</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>SC-MEB: spatial clustering with hidden Markov random field using empirical Bayes</article-title>. <source>Brief Bioinform</source>  <year>2022</year>;<volume>23</volume>:<fpage>bbab466</fpage>.<pub-id pub-id-type="pmid">34849574</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhao</surname><given-names>E</given-names></string-name>, <string-name><surname>Stone</surname><given-names>MR</given-names></string-name>, <string-name><surname>Ren</surname><given-names>X</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>. <source>Nat Biotechnol</source>  <year>2021</year>;<volume>39</volume>:<fpage>1375</fpage>–<lpage>84</lpage>.<pub-id pub-id-type="pmid">34083791</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zheng</surname><given-names>GX</given-names></string-name>, <string-name><surname>Terry</surname><given-names>JM</given-names></string-name>, <string-name><surname>Belgrader</surname><given-names>P</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>. <source>Nat Commun</source>  <year>2017</year>;<volume>8</volume>:<fpage>14049</fpage>.<pub-id pub-id-type="pmid">28091601</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10564617</article-id>
    <article-id pub-id-type="pmid">37756699</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btad594</article-id>
    <article-id pub-id-type="publisher-id">btad594</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ScribbleDom: using scribble-annotated histology images to identify domains in spatial transcriptomics data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-9219-5217</contrib-id>
        <name>
          <surname>Rahman</surname>
          <given-names>Mohammad Nuwaisir</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Bangladesh University of Engineering and Technology</institution>, Dhaka 1000, <country country="BD">Bangladesh</country></aff>
        <xref rid="btad594-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-3738-264X</contrib-id>
        <name>
          <surname>Noman</surname>
          <given-names>Abdullah Al</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Bangladesh University of Engineering and Technology</institution>, Dhaka 1000, <country country="BD">Bangladesh</country></aff>
        <xref rid="btad594-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-9332-2727</contrib-id>
        <name>
          <surname>Turza</surname>
          <given-names>Abir Mohammad</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Bangladesh University of Engineering and Technology</institution>, Dhaka 1000, <country country="BD">Bangladesh</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-5837-0504</contrib-id>
        <name>
          <surname>Abrar</surname>
          <given-names>Mohammed Abid</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Brac University</institution>, Dhaka 1212, <country country="BD">Bangladesh</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7472-1156</contrib-id>
        <name>
          <surname>Samee</surname>
          <given-names>Md Abul Hassan</given-names>
        </name>
        <aff><institution>Department of Integrative Physiology, Baylor College of Medicine</institution>, Houston, TX 77030, <country country="US">United States</country></aff>
        <xref rid="btad594-cor1" ref-type="corresp"/>
        <!--samee@bcm.edu-->
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-9887-4456</contrib-id>
        <name>
          <surname>Rahman</surname>
          <given-names>M Saifur</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Bangladesh University of Engineering and Technology</institution>, Dhaka 1000, <country country="BD">Bangladesh</country></aff>
        <xref rid="btad594-cor1" ref-type="corresp"/>
        <!--mrahman@cse.buet.ac.bd-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Mathelier</surname>
          <given-names>Anthony</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btad594-cor1">Corresponding authors. Department of Integrative Physiology, Baylor College of Medicine, Houston, TX 77030, United States. E-mail: <email>samee@bcm.edu</email> (M.A.H.S.); Department of Computer Science and Engineering, ECE Building, West Palashi Campus, Bangladesh University of Engineering and Technology, Palashi, Dhaka 1000, Bangladesh. E-mail: <email>mrahman@cse.buet.ac.bd</email> (M.S.R.)</corresp>
      <fn id="btad594-FM1">
        <p>Mohammad Nuwaisir Rahman and Abdullah Al Noman contributed equally to this work.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <month>10</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-09-26">
      <day>26</day>
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>26</day>
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <volume>39</volume>
    <issue>10</issue>
    <elocation-id>btad594</elocation-id>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>03</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>07</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>22</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>10</day>
        <month>10</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btad594.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Spatial domain identification is a very important problem in the field of spatial transcriptomics. The state-of-the-art solutions to this problem focus on unsupervised methods, as there is lack of data for a supervised learning formulation. The results obtained from these methods highlight significant opportunities for improvement.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>In this article, we propose a potential avenue for enhancement through the development of a semi-supervised convolutional neural network based approach. Named “ScribbleDom”, our method leverages human expert’s input as a form of semi-supervision, thereby seamlessly combines the cognitive abilities of human experts with the computational power of machines. ScribbleDom incorporates a loss function that integrates two crucial components: similarity in gene expression profiles and adherence to the valuable input of a human annotator through scribbles on histology images, providing prior knowledge about spot labels. The spatial continuity of the tissue domains is taken into account by extracting information on the spot microenvironment through convolution filters of varying sizes, in the form of “Inception” blocks. By leveraging this semi-supervised approach, ScribbleDom significantly improves the quality of spatial domains, yielding superior results both quantitatively and qualitatively. Our experiments on several benchmark datasets demonstrate the clear edge of ScribbleDom over state-of-the-art methods—between 1.82% to 169.38% improvements in adjusted Rand index for 9 of the 12 human dorsolateral prefrontal cortex samples, and 15.54% improvement in the melanoma cancer dataset. Notably, when the expert input is absent, ScribbleDom can still operate, in a fully unsupervised manner like the state-of-the-art methods, and produces results that remain competitive.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>Source code is available at Github (<ext-link xlink:href="https://github.com/1alnoman/ScribbleDom" ext-link-type="uri">https://github.com/1alnoman/ScribbleDom</ext-link>) and Zenodo (<ext-link xlink:href="https://zenodo.org/badge/latestdoi/681572669" ext-link-type="uri">https://zenodo.org/badge/latestdoi/681572669</ext-link>).</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>RISE Student Research</institution>
          </institution-wrap>
        </funding-source>
        <award-id>s2022-02-008</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="10"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Spatial transcriptomics (ST), an emerging technology to profile gene expression at the spatial resolution, can reveal new insights into molecular aspects of tissue architecture (<xref rid="btad594-B10" ref-type="bibr">Longo <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btad594-B16" ref-type="bibr">Rao <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btad594-B12" ref-type="bibr">Moses and Pachter 2022</xref>, <xref rid="btad594-B14" ref-type="bibr">Palla <italic toggle="yes">et al.</italic> 2022</xref>). One such aspect is transcriptional homogeneity in tissue regions. Since ST data captures gene expression at spatially resolved spots, clustering the spots based on their transcriptomic profiles can demarcate transcriptionally homogeneous tissue regions (<xref rid="btad594-B11" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic> 2021</xref>). The goal here is to identify spatial domains in the ST data, similar to how image segmentation algorithms demarcate objects in images. Notably, most image segmentation algorithms are “supervised”, i.e., they require training examples with segments demarcated <italic toggle="yes">a priori</italic>. However, such training examples are scarce in the realm of ST, requiring the spatial domain identification algorithms to be unsupervised. Some of the methods that try to solve this problem are Giotto (<xref rid="btad594-B3" ref-type="bibr">Dries <italic toggle="yes">et al.</italic> 2021</xref>), stLearn (<xref rid="btad594-B15" ref-type="bibr">Pham <italic toggle="yes">et al.</italic> 2020</xref>), SpaGCN (<xref rid="btad594-B4" ref-type="bibr">Hu <italic toggle="yes">et al.</italic> 2021</xref>), BayesSpace (<xref rid="btad594-B26" ref-type="bibr">Zhao <italic toggle="yes">et al.</italic> 2021</xref>), SC-MEB (<xref rid="btad594-B25" ref-type="bibr">Yang <italic toggle="yes">et al.</italic> 2022</xref>), etc., of which, SC-MEB, BayesSpace, and SpaGCN are state-of-the-art methods that demonstrated quantitatively better performance than others (<xref rid="btad594-T1" ref-type="table">Table 1</xref>). BayesSpace implements a fully Bayesian statistical method that uses the information from spatial neighborhoods for resolution enhancement of spatial transcriptomic data. SC-MEB, on the other hand, implements an empirical Bayes approach for spatial clustering analysis using a hidden Markov random field. SpaGCN applies a graph convolutional network approach to integrate gene expression profile data, spatial location as well as histology. These approaches for clustering analysis have demonstrated concordance with the available handful of “gold-standard” datasets.</p>
    <table-wrap position="float" id="btad594-T1">
      <label>Table 1.</label>
      <caption>
        <p>Comparison of ScribbleDom and AutoScribbleDom with state-of-the-art spatial and non-spatial clustering methods based on ARI.<sup>a</sup></p>
      </caption>
      <table frame="hsides" rules="groups">
        <colgroup span="1">
          <col valign="top" align="left" span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
        </colgroup>
        <thead>
          <tr>
            <th rowspan="1" colspan="1">Sample</th>
            <th rowspan="1" colspan="1">ScribbleDom</th>
            <th rowspan="1" colspan="1">AutoScribbleDom</th>
            <th rowspan="1" colspan="1">SC-MEB</th>
            <th rowspan="1" colspan="1">BayesSpace</th>
            <th rowspan="1" colspan="1">SpaGCN</th>
            <th rowspan="1" colspan="1">Giotto</th>
            <th rowspan="1" colspan="1">GMM</th>
            <th rowspan="1" colspan="1">Louvain</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td rowspan="1" colspan="1">151507</td>
            <td rowspan="1" colspan="1">
              <bold>0.53</bold>
            </td>
            <td rowspan="1" colspan="1">0.34</td>
            <td rowspan="1" colspan="1">0.42</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.49</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.40</td>
            <td rowspan="1" colspan="1">0.32</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151508</td>
            <td rowspan="1" colspan="1">0.37</td>
            <td rowspan="1" colspan="1">
              <bold>0.44</bold>
            </td>
            <td rowspan="1" colspan="1">
              <bold>0.44</bold>
            </td>
            <td rowspan="1" colspan="1">0.36</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.34</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.25</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151509</td>
            <td rowspan="1" colspan="1">
              <bold>0.65</bold>
            </td>
            <td rowspan="1" colspan="1">0.42</td>
            <td rowspan="1" colspan="1">0.52</td>
            <td rowspan="1" colspan="1">0.44</td>
            <td rowspan="1" colspan="1">0.44</td>
            <td rowspan="1" colspan="1">0.35</td>
            <td rowspan="1" colspan="1">0.29</td>
            <td rowspan="1" colspan="1">0.30</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151510</td>
            <td rowspan="1" colspan="1">0.46</td>
            <td rowspan="1" colspan="1">
              <bold>0.55</bold>
            </td>
            <td rowspan="1" colspan="1">0.39</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.45</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.31</td>
            <td rowspan="1" colspan="1">0.28</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151669</td>
            <td rowspan="1" colspan="1">
              <bold>0.66</bold>
            </td>
            <td rowspan="1" colspan="1">0.32</td>
            <td rowspan="1" colspan="1">0.32</td>
            <td rowspan="1" colspan="1">0.41</td>
            <td rowspan="1" colspan="1">0.26</td>
            <td rowspan="1" colspan="1">0.25</td>
            <td rowspan="1" colspan="1">0.22</td>
            <td rowspan="1" colspan="1">0.20</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151670</td>
            <td rowspan="1" colspan="1">
              <bold>0.70</bold>
            </td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.37</td>
            <td rowspan="1" colspan="1">0.21</td>
            <td rowspan="1" colspan="1">0.19</td>
            <td rowspan="1" colspan="1">0.26</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151671</td>
            <td rowspan="1" colspan="1">
              <bold>0.71</bold>
            </td>
            <td rowspan="1" colspan="1">0.60</td>
            <td rowspan="1" colspan="1">0.42</td>
            <td rowspan="1" colspan="1">0.38</td>
            <td rowspan="1" colspan="1">0.52</td>
            <td rowspan="1" colspan="1">0.40</td>
            <td rowspan="1" colspan="1">0.23</td>
            <td rowspan="1" colspan="1">0.36</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151672</td>
            <td rowspan="1" colspan="1">0.74</td>
            <td rowspan="1" colspan="1">0.63</td>
            <td rowspan="1" colspan="1">0.44</td>
            <td rowspan="1" colspan="1">
              <bold>0.77</bold>
            </td>
            <td rowspan="1" colspan="1">0.57</td>
            <td rowspan="1" colspan="1">0.38</td>
            <td rowspan="1" colspan="1">0.14</td>
            <td rowspan="1" colspan="1">0.27</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151673</td>
            <td rowspan="1" colspan="1">0.50</td>
            <td rowspan="1" colspan="1">0.52</td>
            <td rowspan="1" colspan="1">0.49</td>
            <td rowspan="1" colspan="1">
              <bold>0.55</bold>
            </td>
            <td rowspan="1" colspan="1">0.53</td>
            <td rowspan="1" colspan="1">0.37</td>
            <td rowspan="1" colspan="1">0.29</td>
            <td rowspan="1" colspan="1">0.29</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151674</td>
            <td rowspan="1" colspan="1">
              <bold>0.54</bold>
            </td>
            <td rowspan="1" colspan="1">0.25</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.39</td>
            <td rowspan="1" colspan="1">0.29</td>
            <td rowspan="1" colspan="1">0.29</td>
            <td rowspan="1" colspan="1">0.33</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151675</td>
            <td rowspan="1" colspan="1">
              <bold>0.52</bold>
            </td>
            <td rowspan="1" colspan="1">0.39</td>
            <td rowspan="1" colspan="1">0.31</td>
            <td rowspan="1" colspan="1">0.41</td>
            <td rowspan="1" colspan="1">0.46</td>
            <td rowspan="1" colspan="1">0.32</td>
            <td rowspan="1" colspan="1">0.24</td>
            <td rowspan="1" colspan="1">0.24</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151676</td>
            <td rowspan="1" colspan="1">
              <bold>0.51</bold>
            </td>
            <td rowspan="1" colspan="1">0.38</td>
            <td rowspan="1" colspan="1">0.39</td>
            <td rowspan="1" colspan="1">0.32</td>
            <td rowspan="1" colspan="1">0.35</td>
            <td rowspan="1" colspan="1">0.26</td>
            <td rowspan="1" colspan="1">0.26</td>
            <td rowspan="1" colspan="1">0.25</td>
          </tr>
        </tbody>
      </table>
      <table-wrap-foot>
        <fn id="tblfn1">
          <label>a</label>
          <p>The ARI values of SpaGCN have been collected from the respective paper (<xref rid="btad594-B4" ref-type="bibr">Hu <italic toggle="yes">et al.</italic> 2021</xref>). The ARI values of the remaining state-of-the-art methods were collected from SC-MEB (<xref rid="btad594-B25" ref-type="bibr">Yang <italic toggle="yes">et al.</italic> 2022</xref>) paper. The best ARI value for each sample has been marked in bold-face.</p>
        </fn>
      </table-wrap-foot>
    </table-wrap>
    <p>To enhance the biological relevance of the spatial domains in ST data, we propose a “scribble-supervised” spatial domain identification method, “ScribbleDom”. This semi-supervised approach shares similarities with semi-supervised image segmentation methods and is unattainable by repurposing the existing state-of-the-art methods. An investigation of convolutional neural networks (CNNs) for unsupervised image segmentation was done by <xref rid="btad594-B6" ref-type="bibr">Kim <italic toggle="yes">et al.</italic> (2020)</xref>. They proposed a novel unsupervised image segmentation end-to-end network that includes normalization and an argmax function for differentiable clustering. They also have the option to include prior knowledge about a subset of pixels, obtained through the drawing of scribbles over the input image, which is widely utilized in academic research and commercial applications and is widely regarded as one of the most user-friendly methods of interaction. Using scribbles as annotations, ScribbleSup (<xref rid="btad594-B9" ref-type="bibr">Lin <italic toggle="yes">et al.</italic> 2016</xref>) demonstrated competitive object semantic segmentation results on the PASCAL VOC dataset. To provide pixel-wise labeling, <xref rid="btad594-B24" ref-type="bibr">Xu <italic toggle="yes">et al.</italic> (2015)</xref> presented a unified strategy that integrates several forms of weak supervision—image-level tags, bounding boxes, and partial labels. CNNs are widely used for image classification, segmentation, and object detection. <xref rid="btad594-B23" ref-type="bibr">Xie <italic toggle="yes">et al.</italic> (2015)</xref> proposed deep embedded clustering (DEC), a method that uses deep neural networks to simultaneously learn feature representations and cluster allocations. The use of a CNN-based approach with three-dimensional filters on hand and brain MRI is presented by <xref rid="btad594-B5" ref-type="bibr">Kayalibay <italic toggle="yes">et al.</italic> (2017)</xref>. <xref rid="btad594-B20" ref-type="bibr">Wang <italic toggle="yes">et al.</italic> (2018)</xref> proposed image-specific fine-tuning to adapt a CNN model to a given test image, which can be either unsupervised (with no extra user interactions) or supervised (with additional scribbles).</p>
    <p>ScribbleDom takes inspiration from <xref rid="btad594-B6" ref-type="bibr">Kim <italic toggle="yes">et al.</italic>’s (2020)</xref> semi-supervised formulation of the image segmentation problem. Subsequently, we have significantly customized the model architecture as well as the loss function to cater to the problem of identifying spatial domains in ST data. ST data contains tissue domains with a diverse range of narrowness. To effectively handle the variability in the narrowness of spatial domains in ST data, ScribbleDom has incorporated Inception blocks (<xref rid="btad594-B18" ref-type="bibr">Szegedy <italic toggle="yes">et al.</italic> 2015</xref>) instead of vanilla convolutions. Inception blocks allow the model to process ST data at various viewpoints by employing convolution filters of different sizes. Thus the model is able to capture fine-grained details in narrow spatial domains while also considering broader spatial contexts. By combining the output from the different-sized filters, ScribbleDom effectively integrates information from various levels of granularity, allowing for a comprehensive understanding of the spatial organization within the ST data. ScribbleDom is broadly applicable to technologies that do not generate matching pairs of histology image and RNA data (see Section 4).</p>
    <p>ScribbleDom makes use of the scribble information provided by a human expert. However, in the absence of scribbles from a human annotator, ScribbleDom can still work to produce competitive results by obtaining initial labeling from another clustering algorithm to run in a completely unsupervised fashion. An overview of the workflow in both modes is shown in <xref rid="btad594-F1" ref-type="fig">Fig. 1</xref>. Many of the state-of-the-art methods (e.g. BayesSpace, SC-MEB, SpaGCN, etc.) also incorporate this approach of initializing cluster labels by another clustering algorithm. BayesSpace and SC-MEB use mclust (<xref rid="btad594-B17" ref-type="bibr">Scrucca <italic toggle="yes">et al.</italic> 2016</xref>) and SpaGCN uses Louvain’s method (<xref rid="btad594-B2" ref-type="bibr">De Meo <italic toggle="yes">et al.</italic> 2011</xref>) for initialization. Using the samples from the dataset of the human brain’s dorsolateral prefrontal cortex (DLPFC) region (Visium), melanoma (ST), and human breast cancer (Visium), we have demonstrated that ScribbleDom outperforms state-of-the-art models like BayesSpace, SpaGCN, and SC-MEB in the presence of expert’s scribble annotations. In case the scribble annotations are unavailable, ScribbleDom can still operate in fully unsupervised manner and its performance remains competitive with the state-of-the-art methods.</p>
    <fig position="float" id="btad594-F1">
      <label>Figure 1.</label>
      <caption>
        <p>ScribbleDom overview. ScribbleDom can work through two different pipelines, when the human annotator scribbles over the histology image (upper part) and when the output of a non-spatial clustering algorithm (e.g. mclust) is used as prior knowledge (lower part). ScribbleDom receives the prior knowledge about the spots, the preprocessed transcriptomics data, and the spatial information about each spot as its input. Data are preprocessed by taking highly variable genes (HVG) and then performing principal component analysis (PCA) on these HVGs. ScribbleDom identifies domains in the ST data using Inception by minimizing a loss function having two components—feature similarity loss and scribble loss. The results produced by ScribbleDom show significant improvement compared to state-of-the-art models.</p>
      </caption>
      <graphic xlink:href="btad594f1" position="float"/>
    </fig>
    <p>The key contributions of the paper can be summarized as follows.</p>
    <list list-type="bullet">
      <list-item>
        <p>We have proposed ScribbleDom, a semi-supervised deep-learning-based approach to identify spatial domains in ST data. ScribbleDom allows for seamless combination of human cognitive ability with machines’ computational power for spatial domain identification in ST data using scribble-annotated histology images. This approach makes it possible to change the course of the spatial domain identification procedure through different types of scribbles.</p>
      </list-item>
      <list-item>
        <p>We have devised a scoring function (goodness score) to rank the clustering outcomes from different algorithms, or the same algorithm for different hyperparameter settings. The scoring function takes into consideration gene expression similarity and spatial continuity, and does not require manual annotation for its calculation, unlike metrics such as adjusted Rand index (ARI), Dice score, etc. We have applied this goodness measure in ScribbleDom to choose the optimal hyperparameter settings in a sample-specific manner.</p>
      </list-item>
      <list-item>
        <p>We have analyzed several samples using ScribbleDom and have successfully identified the spatial domains therein. These samples span from tissues that mostly have layers as their spatial domains (DLPFC samples) to tissues with diversity of different spatial structures, such as tumorous cell clusters embedded in healthy tissues (melanoma and human breast cancer datasets). The output of ScribbleDom is generally superior to that of state-of-the-art methods, both qualitatively and quantitatively</p>
      </list-item>
    </list>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <sec>
      <title>2.1 Dataset</title>
      <p>In this study, we analyzed three different datasets. Firstly, we utilized a dataset consisting of 12 human brain samples extracted from the DLPFC region. These samples were measured using the 10x Genomics (<ext-link xlink:href="https://www.10xgenomics.com/" ext-link-type="uri">https://www.10xgenomics.com/</ext-link>) Visium platform. Each sample, when observed in a perpendicular tissue segment, encompasses all six layers of the cortex as well as the adjacent white matter. <xref rid="btad594-B11" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic> (2021)</xref> annotated the DLPFC layers by considering cytoarchitecture and selected gene markers. The full dataset is publicly available through the spatialLIBD (<xref rid="btad594-B11" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic> 2021</xref>) Bioconductor package. This is a gold-standard dataset in the literature as it contains manual annotation for each of the samples. Each of the samples has approximately 4000 spots on average and spots that were manually annotated belong to one of six DLPFC layers or white matter. As the samples were obtained via Visium technology, each of the spots has six neighboring spots, and these six spots correspond to six vertices of a hexagon. Gene expression profile was also available. Each of the spots approximately has 33 000 gene expression values. The spatial information is available in the form of coordinates of each of the spots. One of the challenges of this dataset is to recapitulate the number of layers and the narrowness of each of the layers. While we have analyzed all the samples, we have described our results only for sample 151673 in the main text of the paper. This is because state-of-the-art methods like BayesSpace and SpaGCN showcase their result using this sample. Also, the output for this sample provides better visual quality than the other ones with respect to the narrowness of layers.</p>
      <p>In the second dataset, we focus on analyzing the melanoma cancer samples that were processed using the ST platform (<xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> 2018</xref>). Specifically, we analyzed the second replicate from biopsy 1, because it contains manual annotation where the tissue regions are dispersed across spatially diverse areas. Biopsy 1 consisted of a total of 293 spots covered by tissue.</p>
      <p>For the third dataset, we utilized publicly available data from the 10x Genomics (<xref rid="btad594-B27" ref-type="bibr">Zheng <italic toggle="yes">et al.</italic> 2017</xref>) website. This dataset included spatial transcriptomics data of human breast cancer obtained using the Visium platform. This is ductal carcinoma tissue where the tumors are spread over various regions. It comprises a total of 2518 spots. We obtained the manual annotation from <xref rid="btad594-B13" ref-type="bibr">Ni <italic toggle="yes">et al.</italic> (2022)</xref> where they classify each spot as tumor or non-tumor.</p>
    </sec>
    <sec>
      <title>2.2 Data preprocessing</title>
      <p>In spatial transcriptomics, a transcript count matrix (<inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">N</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>) and spatial coordinates (<inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mi>Z</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>) are generated for <italic toggle="yes">n</italic> different locations (spots) on a tissue slice, where <italic toggle="yes">g</italic> represents the number of genes. To preprocess the count matrix, we utilized the <italic toggle="yes">spatialPreprocess</italic> method from the BayesSpace R package. The data underwent log normalization, and the function was able to select <italic toggle="yes">h</italic> highly variable genes and extract <italic toggle="yes">p</italic> principal components (PCs). The processed count matrix (<inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>′</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mi>x</mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>) is used for the spatial domain identification.</p>
      <p>In our experiment, we chose 2000 highly variable genes for all datasets. The number of principal components was determined based on the BayesSpace approach, with the top 15 and 7 principal components selected for the human DLPFC and melanoma datasets, respectively. For the human breast cancer dataset, we analyzed the scree plot of the top 50 principal components and chose 15 principal components for analysis (see Supplementay data for the scree plot).</p>
      <p>We analyzed datasets that were generated using different spatial transcriptomic technologies, namely ST and Visium. While these technologies have distinct spot distribution patterns, we need to map each spot to a cell of a data matrix so that conventional convolution filters can be applied. This mapping is trivial for ST data, as the spots are organized in square lattice. However, the Visium spots are arranged in a hexagonal lattice structure, with each spot having six neighboring spots. Therefore, we preprocessed the Visium data such that the six neighbors of a spot located at grid location (<italic toggle="yes">i</italic>, <italic toggle="yes">j</italic>) are spots positioned at <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec>
      <title>2.3 Scribble generation</title>
      <p>To facilitate the semi-supervised approach in ScribbleDom, scribbles were generated for the Visium and ST data. For Visium data, this process utilized the CLOUPE file provided by 10x Genomics, which contains essential information regarding histology and spot mapping for the tissue samples. Using Loupe browser 6.3.0, a tool developed by 10x Genomics, we annotated various Visium spots within the tissue. In the case of ST data, specifically for melanoma sample, we scribbled over the pixels of the corresponding histology image. The pixels that were scribbled were then mapped to the corresponding ST spot array. This process allowed us to associate the scribbles with specific spots in the ST data.</p>
      <p>When human annotations (scribbles) are not available, scribbles are generated automatically based on an initial clustering generated by mclust, a non-spatial clustering algorithm. We call this pipeline <italic toggle="yes">AutoScribbleDom</italic>. As mclust is a non-spatial clustering algorithm, the initial clustering thus produced is expected to have inaccuracies in the spatial domains identified. Therefore, only the spots with labels identical to those of all its neighboring spots (six neighbors for Visium, four neighbors for ST) are considered as scribbles, while the labels from the remaining spots are cleared out. The rest of the pipeline is identical to ScribbleDom.</p>
    </sec>
    <sec>
      <title>2.4 Model architecture</title>
      <p>A high-level model architecture of ScribbleDom is shown in <xref rid="btad594-F2" ref-type="fig">Fig. 2</xref>. First, the input tensor containing the principal components of each spot is fed into a 1 × 1 convolution layer with <italic toggle="yes">p</italic> channels. Then there are two inception blocks, which enable the model to extract features at multiple resolutions. After each of these layers, ReLU is used for non-linear activation, which is followed by batch normalization. Subsequently, the features undergo another 1 × 1 convolution layer and batch normalization, resulting in an <italic toggle="yes">s</italic>-dimensional normalized response map for each spot, where <italic toggle="yes">s</italic> is the number of spatial domains to be identified. Finally, each spot’s spatial domain label is obtained by taking the argmax on the response map. The loss function is calculated based on the response map, spot labels, and scribble labels (more details follow).</p>
      <fig position="float" id="btad594-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Schematic diagram of the model architecture of ScribbleDom, which consists of two 1 × 1 convolutions and two inception blocks. The inception blocks facilitate capturing features at different resolutions. Loss is calculated using cross entropy between the predicted cluster label and the scribble (for the scribbled spots) or the response map (for the spots without scribbles).</p>
        </caption>
        <graphic xlink:href="btad594f2" position="float"/>
      </fig>
      <p>An inception block consists of parallel information paths consisting of 1 × 1, 3 × 3, 5 × 5 convolution filters, and a 3 × 3 pooling layer. Features extracted alongside these paths are finally concatenated (<xref rid="btad594-F2" ref-type="fig">Fig. 2</xref>, blowout). The first inception block in our model extracts 256 features where, 160, 64, 16, and 16 features are extracted from the aforementioned paths, respectively. The next inception block extracts 96, 16, 8, and 8 features, respectively, resulting in a concatenation of 128 features. The filters of varied sizes enable the extraction of features at multiple resolutions, aligning with the notion that information should be processed and aggregated across scales. The smaller filters contribute to capturing fine-grained features, while the larger filters facilitate the inclusion of features from the neighboring spots. This amalgamation of features has proven to be advantageous in our experimental evaluations.</p>
    </sec>
    <sec>
      <title>2.5 Loss function</title>
      <p>As inputs to our model, we utilized the low-dimensional representation of the transcript count matrix (<inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>′</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>), the spatial location of the tissue slice spots (<inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mi>Z</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>), and the number of spatial domains to be identified (<italic toggle="yes">s</italic>). If an expert provided scribbles, then <italic toggle="yes">s</italic> was equal to the number of differently colored scribbles. In the case of AutoScribbleDom, we provided the value of <italic toggle="yes">s</italic> as an input to the non-spatial clustering algorithm, mclust. For each spot, we determine the optimal label from <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> by minimizing the following two-component loss function:</p>
      <disp-formula id="E1">
        <mml:math id="M1" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>α</mml:mo>
            <mml:mo>·</mml:mo>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>L</mml:mi>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi>sim</mml:mi>
                </mml:mrow>
              </mml:msub>
            </mml:mrow>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>{</mml:mo>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>r</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>c</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>u</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mo>}</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>+</mml:mo>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mn>1</mml:mn>
            <mml:mo>−</mml:mo>
            <mml:mo>α</mml:mo>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>·</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>j</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>s</mml:mi>
              </mml:munderover>
            </mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:msub>
                  <mml:mrow>
                    <mml:mi>L</mml:mi>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mi mathvariant="italic">scr</mml:mi>
                  </mml:mrow>
                </mml:msub>
              </mml:mrow>
            </mml:mrow>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>{</mml:mo>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>r</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>w</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>u</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mo>}</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <italic toggle="yes">α</italic> is a hyperparameter. Here <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> is the output of a deep neural network that maps the gene expression data of the <italic toggle="yes">i</italic>-th spot to an <italic toggle="yes">s</italic>-dimensional vector. The loss function’s first component is:</p>
      <disp-formula id="E2">
        <mml:math id="M2" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>L</mml:mi>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi mathvariant="italic">sim</mml:mi>
                </mml:mrow>
              </mml:msub>
            </mml:mrow>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>{</mml:mo>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>r</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>c</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>u</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mo>}</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>n</mml:mi>
              </mml:munderover>
            </mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:munderover>
                  <mml:mo>∑</mml:mo>
                  <mml:mrow>
                    <mml:mi>j</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                  </mml:mrow>
                  <mml:mi>s</mml:mi>
                </mml:munderover>
              </mml:mrow>
              <mml:mo>−</mml:mo>
            </mml:mrow>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mn>1</mml:mn>
            <mml:mo>−</mml:mo>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>u</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>δ</mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mi>j</mml:mi>
                <mml:mo>,</mml:mo>
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>c</mml:mi>
                    </mml:mrow>
                    <mml:mi>i</mml:mi>
                  </mml:msub>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mi>ln</mml:mi>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>r</mml:mi>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <italic toggle="yes">δ</italic> is the Kronecker delta function and <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mrow><mml:mi>arg</mml:mi><mml:mi>max</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> is the predicted label for this spot. <italic toggle="yes">u<sub>i</sub></italic> = 1 if the <italic toggle="yes">i</italic>-th spot overlaps a scribble, <italic toggle="yes">u<sub>i</sub></italic> = 0 otherwise. Intuitively, minimizing <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">sim</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> minimizes variance in the predicted values of <italic toggle="yes">c<sub>i</sub></italic>. The second component is:</p>
      <disp-formula id="E3">
        <mml:math id="M3" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>L</mml:mi>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi mathvariant="italic">scr</mml:mi>
                </mml:mrow>
              </mml:msub>
            </mml:mrow>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>{</mml:mo>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>r</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>w</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>u</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mo>}</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>n</mml:mi>
              </mml:munderover>
            </mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:munderover>
                  <mml:mo>∑</mml:mo>
                  <mml:mrow>
                    <mml:mi>j</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                  </mml:mrow>
                  <mml:mi>s</mml:mi>
                </mml:munderover>
              </mml:mrow>
              <mml:mo>−</mml:mo>
            </mml:mrow>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>u</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
            </mml:mrow>
            <mml:mo>δ</mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mi>j</mml:mi>
                <mml:mo>,</mml:mo>
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>w</mml:mi>
                    </mml:mrow>
                    <mml:mi>i</mml:mi>
                  </mml:msub>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mi>ln</mml:mi>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>r</mml:mi>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is the scribble label of spot <italic toggle="yes">i</italic>. Thus, minimizing <italic toggle="yes">L<sub>scr</sub></italic> imposes the constraint that <italic toggle="yes">c<sub>i</sub></italic> matches scribble label of spot <italic toggle="yes">i</italic>.</p>
    </sec>
    <sec>
      <title>2.6 Scribble dropout</title>
      <p>In case of AutoScribbleDom, the initial spot labels from mclust that conforms with neighboring spot labels are considered as scribbles. Nevertheless there can still be some noise in the scribbles. To address this issue, during training, we randomly remove scribble annotations from some spots in each iteration, much like the concept of dropout in deep learning networks. This approach allows the model to learn similarity with other spots, even if some of the spots are incorrectly labeled by the automated scribbles. The dropout rate is controlled by a second hyperparameter called <italic toggle="yes">β</italic>.</p>
    </sec>
    <sec>
      <title>2.7 Hyperparameter selection</title>
      <p>ScribbleDom has only one hyperparameter, <italic toggle="yes">α</italic>, which can tune the relative contribution of similarity loss and the scribble loss to the overall loss function. AutoScribbleDom has a second hyperparameter, <italic toggle="yes">β</italic>, that controls the rate of scribble dropout. We performed a grid search in the hyperparameter space to find the optimal values. We searched <italic toggle="yes">α</italic> over 0.05 to 0.95 and <italic toggle="yes">β</italic> over 0.25 to 0.4, each with an interval of 0.05. The best values were determined by comparing the clustering outputs based on a goodness measure that is described below.</p>
      <p>Let the cluster assignment for <italic toggle="yes">n</italic> spots generated by our model for a particular value of <italic toggle="yes">α</italic> be <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mn>2</mml:mn><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>n</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>. Here, <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is the cluster label for the <italic toggle="yes">i</italic>-th spot and <italic toggle="yes">s</italic> is the number of clusters. For different values <italic toggle="yes">α</italic>, this clustering output would naturally be different. To select the optimal <italic toggle="yes">α</italic>, we developed a scoring function to measure the goodness of each clustering output. This goodness measure consists of three components. The first component is the likelihood of the gene expression PCs of the spots given their cluster assignments, <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Here <italic toggle="yes">y<sub>i</sub></italic> is the gene expression PC vector at spot <italic toggle="yes">i</italic>. We assume that the PCs are Gaussian distributed within each cluster <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> with mean <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="italic">Average</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>i</mml:mi><mml:mo>≤</mml:mo><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and covariance matrix <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>Σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="italic">Covariance</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>i</mml:mi><mml:mo>≤</mml:mo><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. The intuition for this component is that if a spot is assigned to its correct cluster, it will have a higher likelihood compared to had it been assigned to a wrong cluster.</p>
      <p>The second component is the likelihood of the cluster assignment itself, <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup></mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is given by the Potts model (<xref rid="btad594-B22" ref-type="bibr">Wu 1982</xref>).</p>
      <disp-formula id="E4">
        <mml:math id="M4" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mrow>
              <mml:msubsup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
                <mml:mo>α</mml:mo>
              </mml:msubsup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:mfrac>
                <mml:mn>1</mml:mn>
                <mml:mrow>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mrow>
                        <mml:mi>Z</mml:mi>
                      </mml:mrow>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                  </mml:mrow>
                </mml:mrow>
              </mml:mfrac>
            </mml:mrow>
            <mml:mtext>exp</mml:mtext>
            <mml:mo> </mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:mfrac>
                    <mml:mrow>
                      <mml:mn>2</mml:mn>
                      <mml:mo>γ</mml:mo>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mo>|</mml:mo>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mo>〈</mml:mo>
                            <mml:mrow>
                              <mml:mi>i</mml:mi>
                              <mml:mi>j</mml:mi>
                            </mml:mrow>
                            <mml:mo>〉</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mo>|</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mfrac>
                </mml:mrow>
                <mml:mrow>
                  <mml:munderover>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mo>〈</mml:mo>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mi>j</mml:mi>
                        </mml:mrow>
                        <mml:mo>〉</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow/>
                  </mml:munderover>
                </mml:mrow>
                <mml:mo>δ</mml:mo>
                <mml:mo stretchy="false">(</mml:mo>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mi>C</mml:mi>
                    </mml:mrow>
                    <mml:mi>i</mml:mi>
                    <mml:mo>α</mml:mo>
                  </mml:msubsup>
                </mml:mrow>
                <mml:mo>,</mml:mo>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mi>C</mml:mi>
                    </mml:mrow>
                    <mml:mi>j</mml:mi>
                    <mml:mo>α</mml:mo>
                  </mml:msubsup>
                </mml:mrow>
                <mml:mo stretchy="false">)</mml:mo>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>.</mml:mo>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>Here, <italic toggle="yes">γ</italic> is a smoothing parameter, <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>〈</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>〉</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the set of all the spots <italic toggle="yes">j</italic> that are neighbors of <italic toggle="yes">i</italic>, and <italic toggle="yes">Z<sub>i</sub></italic> is the normalization factor. As suggested by (<xref rid="btad594-B26" ref-type="bibr">Zhao <italic toggle="yes">et al.</italic> (2021)</xref>, we used <italic toggle="yes">γ</italic> = 2 for ST data, and <italic toggle="yes">γ</italic> = 3 for Visium data. The normalization factor <italic toggle="yes">Z<sub>i</sub></italic> is calculated by aggregating the values of <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for all possible cluster labels of the <italic toggle="yes">i</italic>-th spot. The Potts model encourages nearby spots to belong to the same cluster, thus assigning a higher likelihood to cluster assignments with better spatial continuity.</p>
      <p>Lastly, we expect the spots belonging to the same cluster to have similar gene expressions (and thus similar PCs). Therefore, the correct cluster assignment should have a lower sum of variances of PCs within each cluster. Hence, we define the third quasi-likelihood component <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:mi>q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> as:</p>
      <disp-formula id="E5">
        <mml:math id="M5" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi>q</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>,</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>=</mml:mo>
            <mml:mtext>exp</mml:mtext>
            <mml:mo> </mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mo>−</mml:mo>
                <mml:mo>λ</mml:mo>
                <mml:mrow>
                  <mml:munderover>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>j</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>s</mml:mi>
                  </mml:munderover>
                </mml:mrow>
                <mml:mi>t</mml:mi>
                <mml:mi>r</mml:mi>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mo>Σ</mml:mo>
                        </mml:mrow>
                        <mml:mi>j</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>,</mml:mo>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> denotes the trace of a matrix, and <italic toggle="yes">λ</italic> is a scaling factor that is set to 100 in this study. Therefore, the final goodness measure of the clustering output <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:mi>v</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the product of the three components,</p>
      <disp-formula id="E6">
        <mml:math id="M6" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi>v</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>,</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>=</mml:mo>
            <mml:mi>q</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>,</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>|</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>=</mml:mo>
            <mml:mi>q</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>,</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∏</mml:mo>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>n</mml:mi>
              </mml:munderover>
            </mml:mrow>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>y</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
            </mml:mrow>
            <mml:mo>|</mml:mo>
            <mml:mrow>
              <mml:msubsup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
                <mml:mo>α</mml:mo>
              </mml:msubsup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mrow>
              <mml:msubsup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
                <mml:mo>α</mml:mo>
              </mml:msubsup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>For AutoScribbleDom, we follow the exact same process, but in this case, we search the (<italic toggle="yes">α</italic>, <italic toggle="yes">β</italic>) hyperparameter space instead of just <italic toggle="yes">α</italic>.</p>
    </sec>
    <sec>
      <title>2.8 Ground truth annotation procedure</title>
      <p>In the case of the human DLPFC data, the ground truth annotations are done by <xref rid="btad594-B11" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic> (2021)</xref> based on cytoarchitecture and selected gene markers. For the melanoma sample, the contour annotations over the histology image were done by <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref>; spot-level annotations did not exist. To generate spot-level annotations, we utilized the ST Spot Detector tool. Due to printing artifacts, the array used to create ST datasets may have positional variations. To address this issue, the tool provides corrected spot coordinates in both adjusted array coordinates and pixel coordinates on a high-resolution image. We then generated a mapping of array annotation based on the annotations made by <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref> over the histology image.</p>
      <p>In the process of manually annotating melanoma spots, we encountered two types of unannotated spots (<xref rid="btad594-F4" ref-type="fig">Fig. 4c</xref>). Firstly, there were spots in the region that were not originally annotated by <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref>, the publishers of the dataset. Secondly, there were spots located at the borders of two regions, making it challenging to assign them to a specific region accurately. We treated both kinds of spots as unannotated while measuring clustering performances.</p>
    </sec>
    <sec>
      <title>2.9 Performance measure</title>
      <p>To objectively assess the similarity between cluster labels and manual annotation, which is regarded as the ground truth, we employed the ARI. Given a set <italic toggle="yes">S</italic> of <italic toggle="yes">n</italic> elements, and two groupings or partitions (e.g. clusterings) of these elements, namely <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mrow><mml:mi>Y</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>, the overlap between X and Y can be summarized in a contingency table <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> where each entry <italic toggle="yes">n<sub>ij</sub></italic> denotes the number of objects in common between <italic toggle="yes">X<sub>i</sub></italic> and <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>:</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∩</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula></p>
      <disp-formula id="E7">
        <mml:math id="M7" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi mathvariant="italic">ARI</mml:mi>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:mfrac>
                <mml:mrow>
                  <mml:mrow>
                    <mml:munder>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mi>j</mml:mi>
                      </mml:mrow>
                    </mml:munder>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mtable>
                        <mml:mtr>
                          <mml:mtd>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>n</mml:mi>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mi>i</mml:mi>
                                  <mml:mi>j</mml:mi>
                                </mml:mrow>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mtd>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd>
                            <mml:mn>2</mml:mn>
                          </mml:mtd>
                        </mml:mtr>
                      </mml:mtable>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo>−</mml:mo>
                  <mml:mrow>
                    <mml:mo stretchy="true">[</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>i</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>a</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>j</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>b</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>j</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo stretchy="true">]</mml:mo>
                  </mml:mrow>
                  <mml:mo>/</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mtable>
                      <mml:mtr>
                        <mml:mtd>
                          <mml:mi>n</mml:mi>
                        </mml:mtd>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd>
                          <mml:mn>2</mml:mn>
                        </mml:mtd>
                      </mml:mtr>
                    </mml:mtable>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mfrac>
                      <mml:mrow>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mn>2</mml:mn>
                      </mml:mrow>
                    </mml:mfrac>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mo stretchy="true">[</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>i</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>a</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo>+</mml:mo>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>j</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>b</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>j</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo stretchy="true">]</mml:mo>
                  </mml:mrow>
                  <mml:mo>−</mml:mo>
                  <mml:mrow>
                    <mml:mo stretchy="true">[</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>i</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>a</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>j</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>b</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>j</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo stretchy="true">]</mml:mo>
                  </mml:mrow>
                  <mml:mo>/</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mtable>
                      <mml:mtr>
                        <mml:mtd>
                          <mml:mi>n</mml:mi>
                        </mml:mtd>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd>
                          <mml:mn>2</mml:mn>
                        </mml:mtd>
                      </mml:mtr>
                    </mml:mtable>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mfrac>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula></p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 ScribbleDom outperforms state-of-the-art methods in 9 out of the 12 samples of the human DLPFC dataset</title>
      <p><xref rid="btad594-T1" ref-type="table">Table 1</xref> shows the comparison of ScribbleDom with several state-of-the-art algorithms in terms of ARI. We chose to compare with BayesSpace, SC-MEB, SpaGCN, and Giotto as these are four very recently published spatial clustering algorithms. Additionally, SpaGCN integrates information from gene expression, spatial location, and histology for spatial domain identification. Since ScribbleDom also extracts some information from histology (through the form of expert scribbles), it made perfect sense to benchmark against SpaGCN. From the performance of the state-of-the-art spatial clustering methods, it is clear that spatial clustering algorithms perform much better than the non-spatial ones in spatial domain identification. Nevertheless, to be comprehensive, we wanted to benchmark ScribbleDom against a few non-spatial clustering algorithms. For this, we chose Gaussian mixture model (GMM) (<xref rid="btad594-B1" ref-type="bibr">Bishop 2006</xref>) and Louvain (<xref rid="btad594-B2" ref-type="bibr">De Meo <italic toggle="yes">et al.</italic> 2011</xref>). We have compared with BayesSpace, SpaGCN, and SC-MEB which are state-of-the-art methods. We have also compared with Giotto (<xref rid="btad594-B3" ref-type="bibr">Dries <italic toggle="yes">et al.</italic> 2021</xref>) and two non-spatial clustering algorithms, namely, GMM (<xref rid="btad594-B1" ref-type="bibr">Bishop 2006</xref>) and Louvain (<xref rid="btad594-B2" ref-type="bibr">De Meo <italic toggle="yes">et al.</italic> 2011</xref>). ScribbleDom equals or outperforms all the aforementioned state-of-the-art methods in 9 out of the 12 samples, improving the ARI by 51.90%, 47.40%, and 49.84% on average compared to BayesSpace, SC-MEB, and SpaGCN, respectively. Additionally, ScribbleDom equals or outperforms BayesSpace in 10, and SC-MEB in 11 samples. On the other hand, AutoScribbleDom equals or outperforms BayesSpace in 5 samples, and SC-MEB in 7 samples.</p>
      <p>These results imply significant quantitative superiority of ScribbleDom over state-of-the-art methods. Moreover, one of the main drawbacks of BayesSpace is the greater thickness of some layers compared to the manual annotation, e.g. layer 4 (colored magenta) of <xref rid="btad594-F3" ref-type="fig">Fig. 3a</xref>. BayesSpace (<xref rid="btad594-F3" ref-type="fig">Fig. 3f</xref>) predicted layer 4 to be much thicker than what the manual annotation suggests. ScribbleDom can identify layer 4 as a comparatively narrower layer (<xref rid="btad594-F3" ref-type="fig">Fig. 3d</xref>) which better resembles the manual annotation.</p>
      <fig position="float" id="btad594-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Comparison of various spatial domain detection algorithms on the DLPFC dataset, sample 151673. (a) Manual annotation (ground truth). (b) Scribbles by a human annotator. (c) Spatial domains detected by ScribbleDom. (d) Spatial domains detected by SC-MEB. (e) Spatial domains detected by BayesSpace. (f) Spatial domains detected by AutoScribbleDom.</p>
        </caption>
        <graphic xlink:href="btad594f3" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.2 ScribbleDom identifies narrow lymphoid tissue regions around the tumor in melanoma cancer sample</title>
      <p>We evaluated the performance of ScribbleDom on a melanoma sample from <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref>, and it outperforms BayesSpace by 15.54% in terms of ARI calculated on the manually annotated regions. The manual annotation (<xref rid="btad594-F4" ref-type="fig">Fig. 4c</xref>) of the tissue revealed three distinct regions: melanoma, stroma, and lymphoid tissue, with an additional unannotated area. So, we conducted experiments with ScribbleDom as well as AutoScribbleDom using four clusters.</p>
      <fig position="float" id="btad594-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Analysis on melanoma ST sample. (a) Histology image. (b) Manual annotation. (c) Scribbles by a human annotator. (d) Spatial domains detected by BayesSpace. (e) Spatial domains detected by AutoScribbleDom. (f) Spatial domains detected by ScribbleDom.</p>
        </caption>
        <graphic xlink:href="btad594f4" position="float"/>
      </fig>
      <p>ScribbleDom captured the melanoma tumor region as a whole (<xref rid="btad594-F4" ref-type="fig">Fig. 4g</xref>), in contrast to other methods such as BayesSpace (<xref rid="btad594-F4" ref-type="fig">Fig. 4e</xref>), Giotto (<xref rid="btad594-B3" ref-type="bibr">Dries <italic toggle="yes">et al.</italic> 2021</xref>), and Louvain (<xref rid="btad594-B2" ref-type="bibr">De Meo <italic toggle="yes">et al.</italic> 2011</xref>), which tended to split the tumor into peripheral and central regions. Notably, our method also successfully identified the lymphoid tissues surrounding the tumor region, a feature shared only by Giotto, SC3 (<xref rid="btad594-B7" ref-type="bibr">Kiselev <italic toggle="yes">et al.</italic> 2017</xref>), and BayesSpace in subspot resolution. BayesSpace does not capture the lymphoid tissue bordering the tumor in its original resolution (<xref rid="btad594-F4" ref-type="fig">Fig. 4e</xref>). On the other hand, AutoScribbleDom identified a periphery around the center of the tumor region, along with the surrounding lymphoid tissue (<xref rid="btad594-F4" ref-type="fig">Fig. 4f</xref>).</p>
      <p>We calculated the ARI (excluding the unannotated spots) to measure the agreement between spatial domains detected by ScribbleDom and the manual annotation. ScribbleDom achieved an ARI of 0.87 outperforming BayesSpace (0.75). On the other hand, AutoScribbleDom achieved an ARI of 0.74. Although slightly lower than the ARI achieved by BayesSpace, our method exhibited superior accuracy in capturing the presence of lymphoid tissues surrounding the tumor.</p>
      <p>These findings highlight the efficacy of ScribbleDom in identifying narrow regions, such as lymphoid cells around the melanoma tumor in cancer tissue, demonstrating its superior performance compared to BayesSpace. Also, AutoScribbleDom autonomously identified most of the annotated lymphoid regions. These results underscore the potential of ScribbleDom and AutoScribbleDom in facilitating a better understanding of the tumor microenvironment.</p>
    </sec>
    <sec>
      <title>3.3 ScribbleDom can differentiate tumor and non-tumor regions in human breast cancer tissue</title>
      <p>We applied ScribbleDom to analyze a human breast cancer Visium sample, and it performed at par with the results obtained using BayesSpace in both semi-supervised and unsupervised settings. The manual annotation of the sample consists of two distinct regions: tumor and non-tumor (<xref rid="btad594-F5" ref-type="fig">Fig. 5c</xref>). With a limited amount of scribbles (<xref rid="btad594-F5" ref-type="fig">Fig. 5d</xref>), ScribbleDom was able to successfully detect the tumors (<xref rid="btad594-F5" ref-type="fig">Fig. 5g</xref>). ScribbleDom achieved an ARI of 0.82 (<xref rid="btad594-F5" ref-type="fig">Fig. 5g</xref>). Even AutoScribbleDom obtained a competitive ARI of 0.83 (<xref rid="btad594-F5" ref-type="fig">Fig. 5f</xref>). While this ARI is slightly lower than that of BayesSpace (0.84) (<xref rid="btad594-F5" ref-type="fig">Fig. 5e</xref>), it is worth noting that ScribbleDom or AutoScribbleDom still effectively captured all the tumor regions in the human breast cancer sample.</p>
      <fig position="float" id="btad594-F5">
        <label>Figure 5.</label>
        <caption>
          <p>Analysis on human breast cancer dataset. (a) Histology image. (b) Manual annotation. (c) Scribbles by a human annotator. (d) Spatial domains detected by BayesSpace. (e) Spatial domains detected by AutoScribbleDom. (f) Spatial domains detected by ScribbleDom.</p>
        </caption>
        <graphic xlink:href="btad594f5" position="float"/>
      </fig>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>ScribbleDom detects spatial domains in ST tissue samples by leveraging gene expression, spatial neighborhood, and some prior knowledge about the sample. The prior information can either be from a human annotator for some of the spots in the form of scribbles on histology image, or generated from an unsupervised non-spatial clustering algorithm (e.g. mclust). We named the later approach AutoScribbleDom. The output generated by ScribbleDom provides valuable insights into the transcriptionally homogeneous tissue regions within the spatial transcriptomics data. In comparison to existing state-of-the-art methods, ScribbleDom demonstrates superior accuracy in detecting spatial domains whereas AutoScribbleDom too shows competitive results.</p>
    <p>Many recent methods incorporate histology information for spatial domain identification. However, not all spatial transcriptomics technology can generate RNA data and histology in a matching way. This may decrease the quality of histology to spot mapping. ScribbleDom can overcome this limitation as it does not require a one-to-one mapping from histology to spots. In the case where one-to-one histology to spot mapping is not present, the scribbled spots can potentially be derived from scribbles over the histology by an estimation method. So, scribbling over the spots of ST data is a potential future work.</p>
    <p><xref rid="btad594-T1" ref-type="table">Table 1</xref> shows the superiority of ScribbleDom quantitatively, and <xref rid="btad594-F3" ref-type="fig">Fig. 3g</xref> shows the qualitative superiority of ScribbleDom for sample 151673 of the human DLPFC dataset, where the thickness of the layers is better predicted by ScribbleDom (see for example, the thickness of layer 4, colored magenta in manual annotation). Figures for other samples can be found in the <xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref>. Moreover, in the analysis of the melanoma and human breast cancer datasets, ScribbleDom successfully detected the tumor regions. Specifically, in the case of melanoma, we were able to capture the lymphoid tissues that border the melanoma region using both the semi-supervised (<xref rid="btad594-F4" ref-type="fig">Fig. 4g</xref>) and unsupervised (<xref rid="btad594-F4" ref-type="fig">Fig. 4f</xref>) approaches. Furthermore, ScribbleDom outperformed BayesSpace in terms of ARI, demonstrating a more accurate identification of the melanoma and lymphoid tissue regions. ScribbleDom’s capability to identify different regions of the tumor neighborhood suggests its potential use in detecting narrow regions such as lymphoid tissues. The ability to segment and identify specific regions within a tumor can aid in understanding the composition and characteristics of the tumor neighborhood.</p>
    <p>Our experiments have demonstrated that ScribbleDom achieves high accuracy in detecting spatial domains within tissue regions when expert scribbles are available. This highlights ScribbleDom’s ability to leverage domain knowledge provided by expert annotators to identify different tissue domains. We have introduced a hyperparameter, <italic toggle="yes">α</italic>, to control the relative importance of scribbles and gene expression similarity across spots. Additionally, ScribbleDom incorporates inception blocks to capture multi-scale features within the tissue region, enabling accurate detection of various tissue domains, such as smooth layers in human DLPFC samples, narrow bordering regions of lymphoid tissues around tumor regions in melanoma, and scattered tumors across different regions in human breast cancer dataset. AutoScribbleDom also shows competitive results compared to state-of-the-art methods. It utilizes a non-spatial clustering algorithm (mclust) to generate automated scribbles and uses them for the identification of spatial domains. However, the automated scribbles generated by mclust may not accurately represent the spatial domain, due to its (mclust) inability to incorporate spatial information. To mitigate potential inaccuracies, we randomly drop some scribbled spots in each iteration, controlling the dropout rate with another parameter <italic toggle="yes">β</italic>. This approach helps AutoScribbleDom generalize the information from similar spots and reduces the impact of inaccurate automated scribbles.</p>
    <p>Additionally, instead of fixing the hyperparameters at specific values, we performed a grid search across a range of hyperparameter values. We selected the hyperparameter values that maximize an ARI independent goodness score. The goodness is determined from the clustering likelihood, the conditional likelihood of the gene expression of spots given the clustering and a penalty term that tends to reduce variance of the PCs within the same cluster. Our proposed goodness score can potentially be used to compare clustering output of various algorithms and can help practitioners pick the best one.</p>
    <p>Although there has not been a thorough benchmarking on the existing ST domain detection methods, the publications suggest that no method is an indisputable winner in every dataset. This leaves practitioners like clinicians and experimental biologists a bit helpless—on one hand, it is difficult to fine-tune the model parameters to obtain the domains that conform to known biology; on the other hand, the existing methods cannot directly incorporate any form of human supervision. Thus, ScribbleDom fills in a unique niche: (i) it is a versatile method that works satisfactorily both with and without human supervision and (ii) it can work with minimal human supervision, in the form of scribbles. ScribbleDom thus broadens the options for practitioners, especially for domain detection in complex tissues, e.g. from advanced disease states. Another important application of ScribbleDom can be in helping practitioners and method developers efficiently create ground truth annotations without inducing bias, e.g. in demarcating the precise domain boundaries.</p>
    <p>ScribbleDom is generalizable to other sequencing-based technologies as well [e.g. Stereo-seq (<xref rid="btad594-B21" ref-type="bibr">Wei <italic toggle="yes">et al.</italic> 2022</xref>)]. These technologies capture cells in spots (beads) arranged in grids, and ScribbleDom’s convolutions (its basic blocks) work seamlessly on any grid-structured data. With minor preprocessing, ScribbleDom is also applicable to fluorescent in situ hybridization (FISH) based techniques. In these cases, ScribbleDom will need a preprocessed input where one has overlaid a grid structure on the spatial transcriptomic measurements. Alternately, graph convolutions can be implemented for FISH-based data, which is left as a future work.</p>
    <p>ScribbleDom is extensible and can be pretrained if more datasets are available in the future. It enables the human-in-the-loop paradigm in the process of machine learning for the identification of spatial domains in the realm of spatial transcriptomics by incorporating prior annotations obtained from human experts. This means that a clinician is not limited to a fixed output provided by an unsupervised method. Instead, by inputting different scribbles, they can obtain diverse outputs, making the spatial domain identification process more robust and adaptable.</p>
  </sec>
  <sec>
    <title>5 Conclusion</title>
    <p>One of the “eleven grand challenges in single-cell data science” (<xref rid="btad594-B8" ref-type="bibr">Lahnemann <italic toggle="yes">et al.</italic> 2020</xref>) is to find patterns in spatially resolved measurements. We have incorporated a semi-supervised deep learning pipeline in this work to address that challenge. Inspired by similarities in the problem in hand to the image segmentation problem in the computer vision community, we started our endeavors from a state-of-the-art pipeline to solve the later problem. We then made considerable changes to the model to adapt it to spatial transcriptomics data. Furthermore, we made important changes in the model architecture to capture spatial domain features at different resolutions. Our method, ScribbleDom, allows for the incorporation of expert knowledge in the form of scribbles. The method can also function in a fully unsupervised manner when input from an expert is not available. Through a benchmark study with state-of-the-art methods on the human DLPFC, melanoma, and human breast cancer datasets, we have demonstrated the superiority of our semi-supervised approach. In the future, we can pretrain our model as more manually annotated data become available. The ScribbleDom package is well documented and easy to use. We hope that biologists will use ScribbleDom to identify spatial domains in ST samples that would benefit them for downstream analyses which will lead to potential discoveries in the field of bioinformatics.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btad594_Supplementary_Data</label>
      <media xlink:href="btad594_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We thank the anonymous reviewers for their valuable suggestions. We acknowledge <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref> for providing us with the high-resolution H&amp;E stained image of the melanoma ST sample.</p>
  </ack>
  <sec>
    <title>Author contributions</title>
    <p>M.A.H.S. and M.S.R. conceived the study. M.N.R., A.A.N., and A.M.T. ran all the experiments. M.A.A. implemented the goodness measure to compare among models with different hyperparameter settings. A.A.N. finalized the s/w package. All authors contributed to analyzing the results and writing the manuscript. M.A.H.S. and M.S.R. did the final editorial. All the authors reviewed the manuscript.</p>
  </sec>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>M.N.R. is supported by the ICT Fellowship at the Masters level in the fiscal year 2022–2023 for research in ICT sector, administered by ICT Division, Government of People’s Republic of Bangladesh. A.A.N. is supported by RISE Student Research Grant [No. s2022-02-008], administered by RISE, BUET.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>Human Dorsolateral prefrontal cortex (DLPFC) raw spatial data for all the 12 samples is publicly available in spatialLIBD website (<ext-link xlink:href="https://research.libd.org/spatialLIBD/" ext-link-type="uri">https://research.libd.org/spatialLIBD/</ext-link>) under the “raw data” header. Human breast cancer: ductal carcinoma in situ, invasive carcinoma raw count matrix and tissue spatial positions are publicly available in 10xgenomics website (<ext-link xlink:href="https://www.10xgenomics.com/resources/datasets/human-breast-cancer-ductal-carcinoma-in-situ-invasive-carcinoma-ffpe-1-standard-1-3-0" ext-link-type="uri">https://www.10xgenomics.com/resources/datasets/human-breast-cancer-ductal-carcinoma-in-situ-invasive-carcinoma-ffpe-1-standard-1-3-0</ext-link>) under the “Output Files” header. Melanoma raw count matrix can be downloaded from Spatial Research website (<ext-link xlink:href="https://www.spatialresearch.org/wp-content/uploads/2019/03/ST-MelanomaDatasets_1.zip" ext-link-type="uri">https://www.spatialresearch.org/wp-content/uploads/2019/03/ST-MelanomaDatasets_1.zip</ext-link>); row/column coordinates are obtained from column labels of the raw count matrix.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btad594-B1">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Bishop</surname><given-names>CM.</given-names></string-name></person-group>  <year>2006</year>. <source>Pattern Recognition and Machine Learning (Information Science and Statistics)</source>. <publisher-loc>Berlin</publisher-loc>: <publisher-name>Springer-Verlag</publisher-name>.</mixed-citation>
    </ref>
    <ref id="btad594-B2">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>De Meo</surname><given-names>P</given-names></string-name>, <string-name><surname>Ferrara</surname><given-names>E</given-names></string-name>, <string-name><surname>Fiumara</surname><given-names>G</given-names></string-name></person-group>  <etal>et al</etal> Generalized Louvain method for community detection in large networks. In: <italic toggle="yes">International Conference on Intelligent Systems Design and Applications, ISDA, Córdoba, Spain</italic>, <year>2011.</year></mixed-citation>
    </ref>
    <ref id="btad594-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dries</surname><given-names>R</given-names></string-name>, <string-name><surname>Zhu</surname><given-names>Q</given-names></string-name>, <string-name><surname>Dong</surname><given-names>R</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Giotto: a toolbox for integrative analysis and visualization of spatial expression data</article-title>. <source>Genome Biol</source>  <year>2021</year>;<volume>22</volume>:<fpage>78</fpage>.<pub-id pub-id-type="pmid">33685491</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hu</surname><given-names>J</given-names></string-name>, <string-name><surname>Li</surname><given-names>X</given-names></string-name>, <string-name><surname>Coleman</surname><given-names>K</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>SpaGCN: integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>. <source>Nat Methods</source>  <year>2021</year>;<volume>18</volume>:<fpage>1342</fpage>–<lpage>51</lpage>.<pub-id pub-id-type="pmid">34711970</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B5">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Kayalibay</surname><given-names>B</given-names></string-name>, <string-name><surname>Jensen</surname><given-names>G</given-names></string-name>, <string-name><surname>van der Smagt</surname><given-names>P.</given-names></string-name></person-group> CNN-based segmentation of medical imaging data. arXiv, arXiv:1701.03056, <year>2017</year>, preprint: not peer reviewed.</mixed-citation>
    </ref>
    <ref id="btad594-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kim</surname><given-names>W</given-names></string-name>, <string-name><surname>Kanezaki</surname><given-names>A</given-names></string-name>, <string-name><surname>Tanaka</surname><given-names>M.</given-names></string-name></person-group>  <article-title>Unsupervised learning of image segmentation based on differentiable feature clustering</article-title>. <source>IEEE Trans Image Process</source>  <year>2020</year>;<volume>29</volume>:<fpage>8055</fpage>–<lpage>68</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kiselev</surname><given-names>VY</given-names></string-name>, <string-name><surname>Kirschner</surname><given-names>K</given-names></string-name>, <string-name><surname>Schaub</surname><given-names>MT</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Sc3: consensus clustering of single-cell RNA-seq data</article-title>. <source>Nat Methods</source>  <year>2017</year>;<volume>14</volume>:<fpage>483</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">28346451</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lahnemann</surname><given-names>D</given-names></string-name>, <string-name><surname>Koster</surname><given-names>J</given-names></string-name>, <string-name><surname>Szczurek</surname><given-names>E</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Eleven grand challenges in single-cell data science</article-title>. <source>Genome Biol</source>  <year>2020</year>;<volume>21</volume>:<fpage>31</fpage>.<pub-id pub-id-type="pmid">32033589</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B9">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Lin</surname><given-names>D</given-names></string-name>, <string-name><surname>Dai</surname><given-names>J</given-names></string-name>, <string-name><surname>Jia</surname><given-names>J</given-names></string-name></person-group>  <etal>et al</etal> Scribblesup: Scribble-supervised convolutional networks for semantic segmentation. In: <italic toggle="yes">2016 IEEE Conference on Computer Vision and Pattern Recognition (CVPR), Las Vegas, USA</italic>, <year>2016</year>, <fpage>3159</fpage>–<lpage>67</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Longo</surname><given-names>SK</given-names></string-name>, <string-name><surname>Guo</surname><given-names>MG</given-names></string-name>, <string-name><surname>Ji</surname><given-names>AL</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Integrating single-cell and spatial transcriptomics to elucidate intercellular tissue dynamics</article-title>. <source>Nat Rev Genet</source>  <year>2021</year>;<volume>22</volume>:<fpage>627</fpage>–<lpage>44</lpage>.<pub-id pub-id-type="pmid">34145435</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maynard</surname><given-names>KR</given-names></string-name>, <string-name><surname>Collado-Torres</surname><given-names>L</given-names></string-name>, <string-name><surname>Weber</surname><given-names>LM</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Transcriptome-scale spatial gene expression in the human dorsolateral prefrontal cortex</article-title>. <source>Nat Neurosci</source>  <year>2021</year>;<volume>24</volume>:<fpage>425</fpage>–<lpage>36</lpage>.<pub-id pub-id-type="pmid">33558695</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moses</surname><given-names>L</given-names></string-name>, <string-name><surname>Pachter</surname><given-names>L.</given-names></string-name></person-group>  <article-title>Museum of spatial transcriptomics</article-title>. <source>Nat Methods</source>  <year>2022</year>;<volume>19</volume>:<fpage>534</fpage>–<lpage>46</lpage>.<pub-id pub-id-type="pmid">35273392</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ni</surname><given-names>Z</given-names></string-name>, <string-name><surname>Prasad</surname><given-names>A</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Spotclean adjusts for spot swapping in spatial transcriptomics data</article-title>. <source>Nat Commun</source>  <year>2022</year>;<volume>13</volume>:<fpage>2971</fpage>.<pub-id pub-id-type="pmid">35624112</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Palla</surname><given-names>G</given-names></string-name>, <string-name><surname>Fischer</surname><given-names>DS</given-names></string-name>, <string-name><surname>Regev</surname><given-names>A</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Spatial components of molecular tissue biology</article-title>. <source>Nat Biotechnol</source>  <year>2022</year>;<volume>40</volume>:<fpage>308</fpage>–<lpage>18</lpage>.<pub-id pub-id-type="pmid">35132261</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B15">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Pham</surname><given-names>D</given-names></string-name>, <string-name><surname>Tan</surname><given-names>X</given-names></string-name>, <string-name><surname>Xu</surname><given-names>J</given-names></string-name></person-group>  <etal>et al</etal> stLearn: integrating spatial location, tissue morphology and gene expression to find cell types, cell-cell interactions and spatial trajectories within undissociated tissues. bioRxiv, <pub-id pub-id-type="doi">10.1101/2020.05.31.125658</pub-id>, <year>2020</year>, preprint: not peer reviewed.</mixed-citation>
    </ref>
    <ref id="btad594-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rao</surname><given-names>A</given-names></string-name>, <string-name><surname>Barkley</surname><given-names>D</given-names></string-name>, <string-name><surname>França</surname><given-names>GS</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Exploring tissue architecture using spatial transcriptomics</article-title>. <source>Nature</source>  <year>2021</year>;<volume>596</volume>:<fpage>211</fpage>–<lpage>20</lpage>.<pub-id pub-id-type="pmid">34381231</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Scrucca</surname><given-names>L</given-names></string-name>, <string-name><surname>Fop</surname><given-names>M</given-names></string-name>, <string-name><surname>Murphy</surname><given-names>TB</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Mclust 5: clustering, classification and density estimation using Gaussian finite mixture models</article-title>. <source>R J</source>  <year>2016</year>;<volume>8</volume>:<fpage>289</fpage>–<lpage>317</lpage>.<pub-id pub-id-type="pmid">27818791</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B18">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Szegedy</surname><given-names>C</given-names></string-name>, <string-name><surname>Liu</surname><given-names>W</given-names></string-name>, <string-name><surname>Jia</surname><given-names>Y</given-names></string-name></person-group>  <etal>et al</etal> Going deeper with convolutions. In: <italic toggle="yes">Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition, Boston, USA</italic>, <year>2015</year>, <fpage>1</fpage>–<lpage>9</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Thrane</surname><given-names>K</given-names></string-name>, <string-name><surname>Eriksson</surname><given-names>H</given-names></string-name>, <string-name><surname>Maaskola</surname><given-names>J</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Spatially resolved transcriptomics enables dissection of genetic heterogeneity in stage III cutaneous malignant melanoma</article-title>. <source>Cancer Res</source>  <year>2018</year>;<volume>78</volume>:<fpage>5970</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">30154148</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>G</given-names></string-name>, <string-name><surname>Li</surname><given-names>W</given-names></string-name>, <string-name><surname>Zuluaga</surname><given-names>MA</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Interactive medical image segmentation using deep learning with image-specific fine tuning</article-title>. <source>IEEE Trans Med Imaging</source>  <year>2018</year>;<volume>37</volume>:<fpage>1562</fpage>–<lpage>73</lpage>.<pub-id pub-id-type="pmid">29969407</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wei</surname><given-names>X</given-names></string-name>, <string-name><surname>Fu</surname><given-names>S</given-names></string-name>, <string-name><surname>Li</surname><given-names>H</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Single-cell stereo-seq reveals induced progenitor cells involved in axolotl brain regeneration</article-title>. <source>Science</source>  <year>2022</year>;<volume>377</volume>:<fpage>eabp9444</fpage>.<pub-id pub-id-type="pmid">36048929</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wu</surname><given-names>F-Y.</given-names></string-name></person-group>  <article-title>The Potts model</article-title>. <source>Rev Mod Phys</source>  <year>1982</year>;<volume>54</volume>:<fpage>235</fpage>–<lpage>68</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B23">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Xie</surname><given-names>J</given-names></string-name>, <string-name><surname>Girshick</surname><given-names>R</given-names></string-name>, <string-name><surname>Farhadi</surname><given-names>A.</given-names></string-name></person-group> Unsupervised deep embedding for clustering analysis. In: <italic toggle="yes">Proceedings of the 33rd International Conference on Machine Learning</italic>, pp. 478–487. PMLR, New York, NY, USA, 2016.</mixed-citation>
    </ref>
    <ref id="btad594-B24">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Xu</surname><given-names>J</given-names></string-name>, <string-name><surname>Schwing</surname><given-names>AG</given-names></string-name>, <string-name><surname>Urtasun</surname><given-names>R.</given-names></string-name></person-group> Learning to segment under various forms of weak supervision. In: <italic toggle="yes">2015 IEEE Conference on Computer Vision and Pattern Recognition (CVPR), Boston, USA</italic>, <year>2015</year>, <fpage>3781</fpage>–<lpage>90</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Shi</surname><given-names>X</given-names></string-name>, <string-name><surname>Liu</surname><given-names>W</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>SC-MEB: spatial clustering with hidden Markov random field using empirical Bayes</article-title>. <source>Brief Bioinform</source>  <year>2022</year>;<volume>23</volume>:<fpage>bbab466</fpage>.<pub-id pub-id-type="pmid">34849574</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhao</surname><given-names>E</given-names></string-name>, <string-name><surname>Stone</surname><given-names>MR</given-names></string-name>, <string-name><surname>Ren</surname><given-names>X</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>. <source>Nat Biotechnol</source>  <year>2021</year>;<volume>39</volume>:<fpage>1375</fpage>–<lpage>84</lpage>.<pub-id pub-id-type="pmid">34083791</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zheng</surname><given-names>GX</given-names></string-name>, <string-name><surname>Terry</surname><given-names>JM</given-names></string-name>, <string-name><surname>Belgrader</surname><given-names>P</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>. <source>Nat Commun</source>  <year>2017</year>;<volume>8</volume>:<fpage>14049</fpage>.<pub-id pub-id-type="pmid">28091601</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10564617</article-id>
    <article-id pub-id-type="pmid">37756699</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btad594</article-id>
    <article-id pub-id-type="publisher-id">btad594</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ScribbleDom: using scribble-annotated histology images to identify domains in spatial transcriptomics data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-9219-5217</contrib-id>
        <name>
          <surname>Rahman</surname>
          <given-names>Mohammad Nuwaisir</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Bangladesh University of Engineering and Technology</institution>, Dhaka 1000, <country country="BD">Bangladesh</country></aff>
        <xref rid="btad594-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-3738-264X</contrib-id>
        <name>
          <surname>Noman</surname>
          <given-names>Abdullah Al</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Bangladesh University of Engineering and Technology</institution>, Dhaka 1000, <country country="BD">Bangladesh</country></aff>
        <xref rid="btad594-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-9332-2727</contrib-id>
        <name>
          <surname>Turza</surname>
          <given-names>Abir Mohammad</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Bangladesh University of Engineering and Technology</institution>, Dhaka 1000, <country country="BD">Bangladesh</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-5837-0504</contrib-id>
        <name>
          <surname>Abrar</surname>
          <given-names>Mohammed Abid</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Brac University</institution>, Dhaka 1212, <country country="BD">Bangladesh</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7472-1156</contrib-id>
        <name>
          <surname>Samee</surname>
          <given-names>Md Abul Hassan</given-names>
        </name>
        <aff><institution>Department of Integrative Physiology, Baylor College of Medicine</institution>, Houston, TX 77030, <country country="US">United States</country></aff>
        <xref rid="btad594-cor1" ref-type="corresp"/>
        <!--samee@bcm.edu-->
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-9887-4456</contrib-id>
        <name>
          <surname>Rahman</surname>
          <given-names>M Saifur</given-names>
        </name>
        <aff><institution>Department of Computer Science and Engineering, Bangladesh University of Engineering and Technology</institution>, Dhaka 1000, <country country="BD">Bangladesh</country></aff>
        <xref rid="btad594-cor1" ref-type="corresp"/>
        <!--mrahman@cse.buet.ac.bd-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Mathelier</surname>
          <given-names>Anthony</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btad594-cor1">Corresponding authors. Department of Integrative Physiology, Baylor College of Medicine, Houston, TX 77030, United States. E-mail: <email>samee@bcm.edu</email> (M.A.H.S.); Department of Computer Science and Engineering, ECE Building, West Palashi Campus, Bangladesh University of Engineering and Technology, Palashi, Dhaka 1000, Bangladesh. E-mail: <email>mrahman@cse.buet.ac.bd</email> (M.S.R.)</corresp>
      <fn id="btad594-FM1">
        <p>Mohammad Nuwaisir Rahman and Abdullah Al Noman contributed equally to this work.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <month>10</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-09-26">
      <day>26</day>
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>26</day>
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <volume>39</volume>
    <issue>10</issue>
    <elocation-id>btad594</elocation-id>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>03</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>07</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>22</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>10</day>
        <month>10</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btad594.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Spatial domain identification is a very important problem in the field of spatial transcriptomics. The state-of-the-art solutions to this problem focus on unsupervised methods, as there is lack of data for a supervised learning formulation. The results obtained from these methods highlight significant opportunities for improvement.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>In this article, we propose a potential avenue for enhancement through the development of a semi-supervised convolutional neural network based approach. Named “ScribbleDom”, our method leverages human expert’s input as a form of semi-supervision, thereby seamlessly combines the cognitive abilities of human experts with the computational power of machines. ScribbleDom incorporates a loss function that integrates two crucial components: similarity in gene expression profiles and adherence to the valuable input of a human annotator through scribbles on histology images, providing prior knowledge about spot labels. The spatial continuity of the tissue domains is taken into account by extracting information on the spot microenvironment through convolution filters of varying sizes, in the form of “Inception” blocks. By leveraging this semi-supervised approach, ScribbleDom significantly improves the quality of spatial domains, yielding superior results both quantitatively and qualitatively. Our experiments on several benchmark datasets demonstrate the clear edge of ScribbleDom over state-of-the-art methods—between 1.82% to 169.38% improvements in adjusted Rand index for 9 of the 12 human dorsolateral prefrontal cortex samples, and 15.54% improvement in the melanoma cancer dataset. Notably, when the expert input is absent, ScribbleDom can still operate, in a fully unsupervised manner like the state-of-the-art methods, and produces results that remain competitive.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>Source code is available at Github (<ext-link xlink:href="https://github.com/1alnoman/ScribbleDom" ext-link-type="uri">https://github.com/1alnoman/ScribbleDom</ext-link>) and Zenodo (<ext-link xlink:href="https://zenodo.org/badge/latestdoi/681572669" ext-link-type="uri">https://zenodo.org/badge/latestdoi/681572669</ext-link>).</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>RISE Student Research</institution>
          </institution-wrap>
        </funding-source>
        <award-id>s2022-02-008</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="10"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Spatial transcriptomics (ST), an emerging technology to profile gene expression at the spatial resolution, can reveal new insights into molecular aspects of tissue architecture (<xref rid="btad594-B10" ref-type="bibr">Longo <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btad594-B16" ref-type="bibr">Rao <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btad594-B12" ref-type="bibr">Moses and Pachter 2022</xref>, <xref rid="btad594-B14" ref-type="bibr">Palla <italic toggle="yes">et al.</italic> 2022</xref>). One such aspect is transcriptional homogeneity in tissue regions. Since ST data captures gene expression at spatially resolved spots, clustering the spots based on their transcriptomic profiles can demarcate transcriptionally homogeneous tissue regions (<xref rid="btad594-B11" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic> 2021</xref>). The goal here is to identify spatial domains in the ST data, similar to how image segmentation algorithms demarcate objects in images. Notably, most image segmentation algorithms are “supervised”, i.e., they require training examples with segments demarcated <italic toggle="yes">a priori</italic>. However, such training examples are scarce in the realm of ST, requiring the spatial domain identification algorithms to be unsupervised. Some of the methods that try to solve this problem are Giotto (<xref rid="btad594-B3" ref-type="bibr">Dries <italic toggle="yes">et al.</italic> 2021</xref>), stLearn (<xref rid="btad594-B15" ref-type="bibr">Pham <italic toggle="yes">et al.</italic> 2020</xref>), SpaGCN (<xref rid="btad594-B4" ref-type="bibr">Hu <italic toggle="yes">et al.</italic> 2021</xref>), BayesSpace (<xref rid="btad594-B26" ref-type="bibr">Zhao <italic toggle="yes">et al.</italic> 2021</xref>), SC-MEB (<xref rid="btad594-B25" ref-type="bibr">Yang <italic toggle="yes">et al.</italic> 2022</xref>), etc., of which, SC-MEB, BayesSpace, and SpaGCN are state-of-the-art methods that demonstrated quantitatively better performance than others (<xref rid="btad594-T1" ref-type="table">Table 1</xref>). BayesSpace implements a fully Bayesian statistical method that uses the information from spatial neighborhoods for resolution enhancement of spatial transcriptomic data. SC-MEB, on the other hand, implements an empirical Bayes approach for spatial clustering analysis using a hidden Markov random field. SpaGCN applies a graph convolutional network approach to integrate gene expression profile data, spatial location as well as histology. These approaches for clustering analysis have demonstrated concordance with the available handful of “gold-standard” datasets.</p>
    <table-wrap position="float" id="btad594-T1">
      <label>Table 1.</label>
      <caption>
        <p>Comparison of ScribbleDom and AutoScribbleDom with state-of-the-art spatial and non-spatial clustering methods based on ARI.<sup>a</sup></p>
      </caption>
      <table frame="hsides" rules="groups">
        <colgroup span="1">
          <col valign="top" align="left" span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
        </colgroup>
        <thead>
          <tr>
            <th rowspan="1" colspan="1">Sample</th>
            <th rowspan="1" colspan="1">ScribbleDom</th>
            <th rowspan="1" colspan="1">AutoScribbleDom</th>
            <th rowspan="1" colspan="1">SC-MEB</th>
            <th rowspan="1" colspan="1">BayesSpace</th>
            <th rowspan="1" colspan="1">SpaGCN</th>
            <th rowspan="1" colspan="1">Giotto</th>
            <th rowspan="1" colspan="1">GMM</th>
            <th rowspan="1" colspan="1">Louvain</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td rowspan="1" colspan="1">151507</td>
            <td rowspan="1" colspan="1">
              <bold>0.53</bold>
            </td>
            <td rowspan="1" colspan="1">0.34</td>
            <td rowspan="1" colspan="1">0.42</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.49</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.40</td>
            <td rowspan="1" colspan="1">0.32</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151508</td>
            <td rowspan="1" colspan="1">0.37</td>
            <td rowspan="1" colspan="1">
              <bold>0.44</bold>
            </td>
            <td rowspan="1" colspan="1">
              <bold>0.44</bold>
            </td>
            <td rowspan="1" colspan="1">0.36</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.34</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.25</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151509</td>
            <td rowspan="1" colspan="1">
              <bold>0.65</bold>
            </td>
            <td rowspan="1" colspan="1">0.42</td>
            <td rowspan="1" colspan="1">0.52</td>
            <td rowspan="1" colspan="1">0.44</td>
            <td rowspan="1" colspan="1">0.44</td>
            <td rowspan="1" colspan="1">0.35</td>
            <td rowspan="1" colspan="1">0.29</td>
            <td rowspan="1" colspan="1">0.30</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151510</td>
            <td rowspan="1" colspan="1">0.46</td>
            <td rowspan="1" colspan="1">
              <bold>0.55</bold>
            </td>
            <td rowspan="1" colspan="1">0.39</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.45</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.31</td>
            <td rowspan="1" colspan="1">0.28</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151669</td>
            <td rowspan="1" colspan="1">
              <bold>0.66</bold>
            </td>
            <td rowspan="1" colspan="1">0.32</td>
            <td rowspan="1" colspan="1">0.32</td>
            <td rowspan="1" colspan="1">0.41</td>
            <td rowspan="1" colspan="1">0.26</td>
            <td rowspan="1" colspan="1">0.25</td>
            <td rowspan="1" colspan="1">0.22</td>
            <td rowspan="1" colspan="1">0.20</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151670</td>
            <td rowspan="1" colspan="1">
              <bold>0.70</bold>
            </td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.37</td>
            <td rowspan="1" colspan="1">0.21</td>
            <td rowspan="1" colspan="1">0.19</td>
            <td rowspan="1" colspan="1">0.26</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151671</td>
            <td rowspan="1" colspan="1">
              <bold>0.71</bold>
            </td>
            <td rowspan="1" colspan="1">0.60</td>
            <td rowspan="1" colspan="1">0.42</td>
            <td rowspan="1" colspan="1">0.38</td>
            <td rowspan="1" colspan="1">0.52</td>
            <td rowspan="1" colspan="1">0.40</td>
            <td rowspan="1" colspan="1">0.23</td>
            <td rowspan="1" colspan="1">0.36</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151672</td>
            <td rowspan="1" colspan="1">0.74</td>
            <td rowspan="1" colspan="1">0.63</td>
            <td rowspan="1" colspan="1">0.44</td>
            <td rowspan="1" colspan="1">
              <bold>0.77</bold>
            </td>
            <td rowspan="1" colspan="1">0.57</td>
            <td rowspan="1" colspan="1">0.38</td>
            <td rowspan="1" colspan="1">0.14</td>
            <td rowspan="1" colspan="1">0.27</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151673</td>
            <td rowspan="1" colspan="1">0.50</td>
            <td rowspan="1" colspan="1">0.52</td>
            <td rowspan="1" colspan="1">0.49</td>
            <td rowspan="1" colspan="1">
              <bold>0.55</bold>
            </td>
            <td rowspan="1" colspan="1">0.53</td>
            <td rowspan="1" colspan="1">0.37</td>
            <td rowspan="1" colspan="1">0.29</td>
            <td rowspan="1" colspan="1">0.29</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151674</td>
            <td rowspan="1" colspan="1">
              <bold>0.54</bold>
            </td>
            <td rowspan="1" colspan="1">0.25</td>
            <td rowspan="1" colspan="1">0.43</td>
            <td rowspan="1" colspan="1">0.33</td>
            <td rowspan="1" colspan="1">0.39</td>
            <td rowspan="1" colspan="1">0.29</td>
            <td rowspan="1" colspan="1">0.29</td>
            <td rowspan="1" colspan="1">0.33</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151675</td>
            <td rowspan="1" colspan="1">
              <bold>0.52</bold>
            </td>
            <td rowspan="1" colspan="1">0.39</td>
            <td rowspan="1" colspan="1">0.31</td>
            <td rowspan="1" colspan="1">0.41</td>
            <td rowspan="1" colspan="1">0.46</td>
            <td rowspan="1" colspan="1">0.32</td>
            <td rowspan="1" colspan="1">0.24</td>
            <td rowspan="1" colspan="1">0.24</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">151676</td>
            <td rowspan="1" colspan="1">
              <bold>0.51</bold>
            </td>
            <td rowspan="1" colspan="1">0.38</td>
            <td rowspan="1" colspan="1">0.39</td>
            <td rowspan="1" colspan="1">0.32</td>
            <td rowspan="1" colspan="1">0.35</td>
            <td rowspan="1" colspan="1">0.26</td>
            <td rowspan="1" colspan="1">0.26</td>
            <td rowspan="1" colspan="1">0.25</td>
          </tr>
        </tbody>
      </table>
      <table-wrap-foot>
        <fn id="tblfn1">
          <label>a</label>
          <p>The ARI values of SpaGCN have been collected from the respective paper (<xref rid="btad594-B4" ref-type="bibr">Hu <italic toggle="yes">et al.</italic> 2021</xref>). The ARI values of the remaining state-of-the-art methods were collected from SC-MEB (<xref rid="btad594-B25" ref-type="bibr">Yang <italic toggle="yes">et al.</italic> 2022</xref>) paper. The best ARI value for each sample has been marked in bold-face.</p>
        </fn>
      </table-wrap-foot>
    </table-wrap>
    <p>To enhance the biological relevance of the spatial domains in ST data, we propose a “scribble-supervised” spatial domain identification method, “ScribbleDom”. This semi-supervised approach shares similarities with semi-supervised image segmentation methods and is unattainable by repurposing the existing state-of-the-art methods. An investigation of convolutional neural networks (CNNs) for unsupervised image segmentation was done by <xref rid="btad594-B6" ref-type="bibr">Kim <italic toggle="yes">et al.</italic> (2020)</xref>. They proposed a novel unsupervised image segmentation end-to-end network that includes normalization and an argmax function for differentiable clustering. They also have the option to include prior knowledge about a subset of pixels, obtained through the drawing of scribbles over the input image, which is widely utilized in academic research and commercial applications and is widely regarded as one of the most user-friendly methods of interaction. Using scribbles as annotations, ScribbleSup (<xref rid="btad594-B9" ref-type="bibr">Lin <italic toggle="yes">et al.</italic> 2016</xref>) demonstrated competitive object semantic segmentation results on the PASCAL VOC dataset. To provide pixel-wise labeling, <xref rid="btad594-B24" ref-type="bibr">Xu <italic toggle="yes">et al.</italic> (2015)</xref> presented a unified strategy that integrates several forms of weak supervision—image-level tags, bounding boxes, and partial labels. CNNs are widely used for image classification, segmentation, and object detection. <xref rid="btad594-B23" ref-type="bibr">Xie <italic toggle="yes">et al.</italic> (2015)</xref> proposed deep embedded clustering (DEC), a method that uses deep neural networks to simultaneously learn feature representations and cluster allocations. The use of a CNN-based approach with three-dimensional filters on hand and brain MRI is presented by <xref rid="btad594-B5" ref-type="bibr">Kayalibay <italic toggle="yes">et al.</italic> (2017)</xref>. <xref rid="btad594-B20" ref-type="bibr">Wang <italic toggle="yes">et al.</italic> (2018)</xref> proposed image-specific fine-tuning to adapt a CNN model to a given test image, which can be either unsupervised (with no extra user interactions) or supervised (with additional scribbles).</p>
    <p>ScribbleDom takes inspiration from <xref rid="btad594-B6" ref-type="bibr">Kim <italic toggle="yes">et al.</italic>’s (2020)</xref> semi-supervised formulation of the image segmentation problem. Subsequently, we have significantly customized the model architecture as well as the loss function to cater to the problem of identifying spatial domains in ST data. ST data contains tissue domains with a diverse range of narrowness. To effectively handle the variability in the narrowness of spatial domains in ST data, ScribbleDom has incorporated Inception blocks (<xref rid="btad594-B18" ref-type="bibr">Szegedy <italic toggle="yes">et al.</italic> 2015</xref>) instead of vanilla convolutions. Inception blocks allow the model to process ST data at various viewpoints by employing convolution filters of different sizes. Thus the model is able to capture fine-grained details in narrow spatial domains while also considering broader spatial contexts. By combining the output from the different-sized filters, ScribbleDom effectively integrates information from various levels of granularity, allowing for a comprehensive understanding of the spatial organization within the ST data. ScribbleDom is broadly applicable to technologies that do not generate matching pairs of histology image and RNA data (see Section 4).</p>
    <p>ScribbleDom makes use of the scribble information provided by a human expert. However, in the absence of scribbles from a human annotator, ScribbleDom can still work to produce competitive results by obtaining initial labeling from another clustering algorithm to run in a completely unsupervised fashion. An overview of the workflow in both modes is shown in <xref rid="btad594-F1" ref-type="fig">Fig. 1</xref>. Many of the state-of-the-art methods (e.g. BayesSpace, SC-MEB, SpaGCN, etc.) also incorporate this approach of initializing cluster labels by another clustering algorithm. BayesSpace and SC-MEB use mclust (<xref rid="btad594-B17" ref-type="bibr">Scrucca <italic toggle="yes">et al.</italic> 2016</xref>) and SpaGCN uses Louvain’s method (<xref rid="btad594-B2" ref-type="bibr">De Meo <italic toggle="yes">et al.</italic> 2011</xref>) for initialization. Using the samples from the dataset of the human brain’s dorsolateral prefrontal cortex (DLPFC) region (Visium), melanoma (ST), and human breast cancer (Visium), we have demonstrated that ScribbleDom outperforms state-of-the-art models like BayesSpace, SpaGCN, and SC-MEB in the presence of expert’s scribble annotations. In case the scribble annotations are unavailable, ScribbleDom can still operate in fully unsupervised manner and its performance remains competitive with the state-of-the-art methods.</p>
    <fig position="float" id="btad594-F1">
      <label>Figure 1.</label>
      <caption>
        <p>ScribbleDom overview. ScribbleDom can work through two different pipelines, when the human annotator scribbles over the histology image (upper part) and when the output of a non-spatial clustering algorithm (e.g. mclust) is used as prior knowledge (lower part). ScribbleDom receives the prior knowledge about the spots, the preprocessed transcriptomics data, and the spatial information about each spot as its input. Data are preprocessed by taking highly variable genes (HVG) and then performing principal component analysis (PCA) on these HVGs. ScribbleDom identifies domains in the ST data using Inception by minimizing a loss function having two components—feature similarity loss and scribble loss. The results produced by ScribbleDom show significant improvement compared to state-of-the-art models.</p>
      </caption>
      <graphic xlink:href="btad594f1" position="float"/>
    </fig>
    <p>The key contributions of the paper can be summarized as follows.</p>
    <list list-type="bullet">
      <list-item>
        <p>We have proposed ScribbleDom, a semi-supervised deep-learning-based approach to identify spatial domains in ST data. ScribbleDom allows for seamless combination of human cognitive ability with machines’ computational power for spatial domain identification in ST data using scribble-annotated histology images. This approach makes it possible to change the course of the spatial domain identification procedure through different types of scribbles.</p>
      </list-item>
      <list-item>
        <p>We have devised a scoring function (goodness score) to rank the clustering outcomes from different algorithms, or the same algorithm for different hyperparameter settings. The scoring function takes into consideration gene expression similarity and spatial continuity, and does not require manual annotation for its calculation, unlike metrics such as adjusted Rand index (ARI), Dice score, etc. We have applied this goodness measure in ScribbleDom to choose the optimal hyperparameter settings in a sample-specific manner.</p>
      </list-item>
      <list-item>
        <p>We have analyzed several samples using ScribbleDom and have successfully identified the spatial domains therein. These samples span from tissues that mostly have layers as their spatial domains (DLPFC samples) to tissues with diversity of different spatial structures, such as tumorous cell clusters embedded in healthy tissues (melanoma and human breast cancer datasets). The output of ScribbleDom is generally superior to that of state-of-the-art methods, both qualitatively and quantitatively</p>
      </list-item>
    </list>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <sec>
      <title>2.1 Dataset</title>
      <p>In this study, we analyzed three different datasets. Firstly, we utilized a dataset consisting of 12 human brain samples extracted from the DLPFC region. These samples were measured using the 10x Genomics (<ext-link xlink:href="https://www.10xgenomics.com/" ext-link-type="uri">https://www.10xgenomics.com/</ext-link>) Visium platform. Each sample, when observed in a perpendicular tissue segment, encompasses all six layers of the cortex as well as the adjacent white matter. <xref rid="btad594-B11" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic> (2021)</xref> annotated the DLPFC layers by considering cytoarchitecture and selected gene markers. The full dataset is publicly available through the spatialLIBD (<xref rid="btad594-B11" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic> 2021</xref>) Bioconductor package. This is a gold-standard dataset in the literature as it contains manual annotation for each of the samples. Each of the samples has approximately 4000 spots on average and spots that were manually annotated belong to one of six DLPFC layers or white matter. As the samples were obtained via Visium technology, each of the spots has six neighboring spots, and these six spots correspond to six vertices of a hexagon. Gene expression profile was also available. Each of the spots approximately has 33 000 gene expression values. The spatial information is available in the form of coordinates of each of the spots. One of the challenges of this dataset is to recapitulate the number of layers and the narrowness of each of the layers. While we have analyzed all the samples, we have described our results only for sample 151673 in the main text of the paper. This is because state-of-the-art methods like BayesSpace and SpaGCN showcase their result using this sample. Also, the output for this sample provides better visual quality than the other ones with respect to the narrowness of layers.</p>
      <p>In the second dataset, we focus on analyzing the melanoma cancer samples that were processed using the ST platform (<xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> 2018</xref>). Specifically, we analyzed the second replicate from biopsy 1, because it contains manual annotation where the tissue regions are dispersed across spatially diverse areas. Biopsy 1 consisted of a total of 293 spots covered by tissue.</p>
      <p>For the third dataset, we utilized publicly available data from the 10x Genomics (<xref rid="btad594-B27" ref-type="bibr">Zheng <italic toggle="yes">et al.</italic> 2017</xref>) website. This dataset included spatial transcriptomics data of human breast cancer obtained using the Visium platform. This is ductal carcinoma tissue where the tumors are spread over various regions. It comprises a total of 2518 spots. We obtained the manual annotation from <xref rid="btad594-B13" ref-type="bibr">Ni <italic toggle="yes">et al.</italic> (2022)</xref> where they classify each spot as tumor or non-tumor.</p>
    </sec>
    <sec>
      <title>2.2 Data preprocessing</title>
      <p>In spatial transcriptomics, a transcript count matrix (<inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">N</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>) and spatial coordinates (<inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mi>Z</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>) are generated for <italic toggle="yes">n</italic> different locations (spots) on a tissue slice, where <italic toggle="yes">g</italic> represents the number of genes. To preprocess the count matrix, we utilized the <italic toggle="yes">spatialPreprocess</italic> method from the BayesSpace R package. The data underwent log normalization, and the function was able to select <italic toggle="yes">h</italic> highly variable genes and extract <italic toggle="yes">p</italic> principal components (PCs). The processed count matrix (<inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>′</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mi>x</mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>) is used for the spatial domain identification.</p>
      <p>In our experiment, we chose 2000 highly variable genes for all datasets. The number of principal components was determined based on the BayesSpace approach, with the top 15 and 7 principal components selected for the human DLPFC and melanoma datasets, respectively. For the human breast cancer dataset, we analyzed the scree plot of the top 50 principal components and chose 15 principal components for analysis (see Supplementay data for the scree plot).</p>
      <p>We analyzed datasets that were generated using different spatial transcriptomic technologies, namely ST and Visium. While these technologies have distinct spot distribution patterns, we need to map each spot to a cell of a data matrix so that conventional convolution filters can be applied. This mapping is trivial for ST data, as the spots are organized in square lattice. However, the Visium spots are arranged in a hexagonal lattice structure, with each spot having six neighboring spots. Therefore, we preprocessed the Visium data such that the six neighbors of a spot located at grid location (<italic toggle="yes">i</italic>, <italic toggle="yes">j</italic>) are spots positioned at <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec>
      <title>2.3 Scribble generation</title>
      <p>To facilitate the semi-supervised approach in ScribbleDom, scribbles were generated for the Visium and ST data. For Visium data, this process utilized the CLOUPE file provided by 10x Genomics, which contains essential information regarding histology and spot mapping for the tissue samples. Using Loupe browser 6.3.0, a tool developed by 10x Genomics, we annotated various Visium spots within the tissue. In the case of ST data, specifically for melanoma sample, we scribbled over the pixels of the corresponding histology image. The pixels that were scribbled were then mapped to the corresponding ST spot array. This process allowed us to associate the scribbles with specific spots in the ST data.</p>
      <p>When human annotations (scribbles) are not available, scribbles are generated automatically based on an initial clustering generated by mclust, a non-spatial clustering algorithm. We call this pipeline <italic toggle="yes">AutoScribbleDom</italic>. As mclust is a non-spatial clustering algorithm, the initial clustering thus produced is expected to have inaccuracies in the spatial domains identified. Therefore, only the spots with labels identical to those of all its neighboring spots (six neighbors for Visium, four neighbors for ST) are considered as scribbles, while the labels from the remaining spots are cleared out. The rest of the pipeline is identical to ScribbleDom.</p>
    </sec>
    <sec>
      <title>2.4 Model architecture</title>
      <p>A high-level model architecture of ScribbleDom is shown in <xref rid="btad594-F2" ref-type="fig">Fig. 2</xref>. First, the input tensor containing the principal components of each spot is fed into a 1 × 1 convolution layer with <italic toggle="yes">p</italic> channels. Then there are two inception blocks, which enable the model to extract features at multiple resolutions. After each of these layers, ReLU is used for non-linear activation, which is followed by batch normalization. Subsequently, the features undergo another 1 × 1 convolution layer and batch normalization, resulting in an <italic toggle="yes">s</italic>-dimensional normalized response map for each spot, where <italic toggle="yes">s</italic> is the number of spatial domains to be identified. Finally, each spot’s spatial domain label is obtained by taking the argmax on the response map. The loss function is calculated based on the response map, spot labels, and scribble labels (more details follow).</p>
      <fig position="float" id="btad594-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Schematic diagram of the model architecture of ScribbleDom, which consists of two 1 × 1 convolutions and two inception blocks. The inception blocks facilitate capturing features at different resolutions. Loss is calculated using cross entropy between the predicted cluster label and the scribble (for the scribbled spots) or the response map (for the spots without scribbles).</p>
        </caption>
        <graphic xlink:href="btad594f2" position="float"/>
      </fig>
      <p>An inception block consists of parallel information paths consisting of 1 × 1, 3 × 3, 5 × 5 convolution filters, and a 3 × 3 pooling layer. Features extracted alongside these paths are finally concatenated (<xref rid="btad594-F2" ref-type="fig">Fig. 2</xref>, blowout). The first inception block in our model extracts 256 features where, 160, 64, 16, and 16 features are extracted from the aforementioned paths, respectively. The next inception block extracts 96, 16, 8, and 8 features, respectively, resulting in a concatenation of 128 features. The filters of varied sizes enable the extraction of features at multiple resolutions, aligning with the notion that information should be processed and aggregated across scales. The smaller filters contribute to capturing fine-grained features, while the larger filters facilitate the inclusion of features from the neighboring spots. This amalgamation of features has proven to be advantageous in our experimental evaluations.</p>
    </sec>
    <sec>
      <title>2.5 Loss function</title>
      <p>As inputs to our model, we utilized the low-dimensional representation of the transcript count matrix (<inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>′</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>), the spatial location of the tissue slice spots (<inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mi>Z</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>), and the number of spatial domains to be identified (<italic toggle="yes">s</italic>). If an expert provided scribbles, then <italic toggle="yes">s</italic> was equal to the number of differently colored scribbles. In the case of AutoScribbleDom, we provided the value of <italic toggle="yes">s</italic> as an input to the non-spatial clustering algorithm, mclust. For each spot, we determine the optimal label from <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> by minimizing the following two-component loss function:</p>
      <disp-formula id="E1">
        <mml:math id="M1" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>α</mml:mo>
            <mml:mo>·</mml:mo>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>L</mml:mi>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi>sim</mml:mi>
                </mml:mrow>
              </mml:msub>
            </mml:mrow>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>{</mml:mo>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>r</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>c</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>u</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mo>}</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>+</mml:mo>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mn>1</mml:mn>
            <mml:mo>−</mml:mo>
            <mml:mo>α</mml:mo>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>·</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>j</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>s</mml:mi>
              </mml:munderover>
            </mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:msub>
                  <mml:mrow>
                    <mml:mi>L</mml:mi>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mi mathvariant="italic">scr</mml:mi>
                  </mml:mrow>
                </mml:msub>
              </mml:mrow>
            </mml:mrow>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>{</mml:mo>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>r</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>w</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>u</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mo>}</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <italic toggle="yes">α</italic> is a hyperparameter. Here <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> is the output of a deep neural network that maps the gene expression data of the <italic toggle="yes">i</italic>-th spot to an <italic toggle="yes">s</italic>-dimensional vector. The loss function’s first component is:</p>
      <disp-formula id="E2">
        <mml:math id="M2" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>L</mml:mi>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi mathvariant="italic">sim</mml:mi>
                </mml:mrow>
              </mml:msub>
            </mml:mrow>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>{</mml:mo>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>r</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>c</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>u</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mo>}</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>n</mml:mi>
              </mml:munderover>
            </mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:munderover>
                  <mml:mo>∑</mml:mo>
                  <mml:mrow>
                    <mml:mi>j</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                  </mml:mrow>
                  <mml:mi>s</mml:mi>
                </mml:munderover>
              </mml:mrow>
              <mml:mo>−</mml:mo>
            </mml:mrow>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mn>1</mml:mn>
            <mml:mo>−</mml:mo>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>u</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>δ</mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mi>j</mml:mi>
                <mml:mo>,</mml:mo>
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>c</mml:mi>
                    </mml:mrow>
                    <mml:mi>i</mml:mi>
                  </mml:msub>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mi>ln</mml:mi>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>r</mml:mi>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <italic toggle="yes">δ</italic> is the Kronecker delta function and <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mrow><mml:mi>arg</mml:mi><mml:mi>max</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> is the predicted label for this spot. <italic toggle="yes">u<sub>i</sub></italic> = 1 if the <italic toggle="yes">i</italic>-th spot overlaps a scribble, <italic toggle="yes">u<sub>i</sub></italic> = 0 otherwise. Intuitively, minimizing <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">sim</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> minimizes variance in the predicted values of <italic toggle="yes">c<sub>i</sub></italic>. The second component is:</p>
      <disp-formula id="E3">
        <mml:math id="M3" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>L</mml:mi>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi mathvariant="italic">scr</mml:mi>
                </mml:mrow>
              </mml:msub>
            </mml:mrow>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>{</mml:mo>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>r</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>w</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                            <mml:mo>,</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>u</mml:mi>
                                </mml:mrow>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mo>}</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>n</mml:mi>
              </mml:munderover>
            </mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:munderover>
                  <mml:mo>∑</mml:mo>
                  <mml:mrow>
                    <mml:mi>j</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                  </mml:mrow>
                  <mml:mi>s</mml:mi>
                </mml:munderover>
              </mml:mrow>
              <mml:mo>−</mml:mo>
            </mml:mrow>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>u</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
            </mml:mrow>
            <mml:mo>δ</mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mi>j</mml:mi>
                <mml:mo>,</mml:mo>
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>w</mml:mi>
                    </mml:mrow>
                    <mml:mi>i</mml:mi>
                  </mml:msub>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mi>ln</mml:mi>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>r</mml:mi>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is the scribble label of spot <italic toggle="yes">i</italic>. Thus, minimizing <italic toggle="yes">L<sub>scr</sub></italic> imposes the constraint that <italic toggle="yes">c<sub>i</sub></italic> matches scribble label of spot <italic toggle="yes">i</italic>.</p>
    </sec>
    <sec>
      <title>2.6 Scribble dropout</title>
      <p>In case of AutoScribbleDom, the initial spot labels from mclust that conforms with neighboring spot labels are considered as scribbles. Nevertheless there can still be some noise in the scribbles. To address this issue, during training, we randomly remove scribble annotations from some spots in each iteration, much like the concept of dropout in deep learning networks. This approach allows the model to learn similarity with other spots, even if some of the spots are incorrectly labeled by the automated scribbles. The dropout rate is controlled by a second hyperparameter called <italic toggle="yes">β</italic>.</p>
    </sec>
    <sec>
      <title>2.7 Hyperparameter selection</title>
      <p>ScribbleDom has only one hyperparameter, <italic toggle="yes">α</italic>, which can tune the relative contribution of similarity loss and the scribble loss to the overall loss function. AutoScribbleDom has a second hyperparameter, <italic toggle="yes">β</italic>, that controls the rate of scribble dropout. We performed a grid search in the hyperparameter space to find the optimal values. We searched <italic toggle="yes">α</italic> over 0.05 to 0.95 and <italic toggle="yes">β</italic> over 0.25 to 0.4, each with an interval of 0.05. The best values were determined by comparing the clustering outputs based on a goodness measure that is described below.</p>
      <p>Let the cluster assignment for <italic toggle="yes">n</italic> spots generated by our model for a particular value of <italic toggle="yes">α</italic> be <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mn>2</mml:mn><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>n</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>. Here, <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is the cluster label for the <italic toggle="yes">i</italic>-th spot and <italic toggle="yes">s</italic> is the number of clusters. For different values <italic toggle="yes">α</italic>, this clustering output would naturally be different. To select the optimal <italic toggle="yes">α</italic>, we developed a scoring function to measure the goodness of each clustering output. This goodness measure consists of three components. The first component is the likelihood of the gene expression PCs of the spots given their cluster assignments, <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Here <italic toggle="yes">y<sub>i</sub></italic> is the gene expression PC vector at spot <italic toggle="yes">i</italic>. We assume that the PCs are Gaussian distributed within each cluster <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> with mean <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="italic">Average</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>i</mml:mi><mml:mo>≤</mml:mo><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and covariance matrix <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>Σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="italic">Covariance</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>i</mml:mi><mml:mo>≤</mml:mo><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. The intuition for this component is that if a spot is assigned to its correct cluster, it will have a higher likelihood compared to had it been assigned to a wrong cluster.</p>
      <p>The second component is the likelihood of the cluster assignment itself, <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup></mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is given by the Potts model (<xref rid="btad594-B22" ref-type="bibr">Wu 1982</xref>).</p>
      <disp-formula id="E4">
        <mml:math id="M4" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mrow>
              <mml:msubsup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
                <mml:mo>α</mml:mo>
              </mml:msubsup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:mfrac>
                <mml:mn>1</mml:mn>
                <mml:mrow>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mrow>
                        <mml:mi>Z</mml:mi>
                      </mml:mrow>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                  </mml:mrow>
                </mml:mrow>
              </mml:mfrac>
            </mml:mrow>
            <mml:mtext>exp</mml:mtext>
            <mml:mo> </mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:mfrac>
                    <mml:mrow>
                      <mml:mn>2</mml:mn>
                      <mml:mo>γ</mml:mo>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mo>|</mml:mo>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mo>〈</mml:mo>
                            <mml:mrow>
                              <mml:mi>i</mml:mi>
                              <mml:mi>j</mml:mi>
                            </mml:mrow>
                            <mml:mo>〉</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mo>|</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mfrac>
                </mml:mrow>
                <mml:mrow>
                  <mml:munderover>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mo>〈</mml:mo>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mi>j</mml:mi>
                        </mml:mrow>
                        <mml:mo>〉</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow/>
                  </mml:munderover>
                </mml:mrow>
                <mml:mo>δ</mml:mo>
                <mml:mo stretchy="false">(</mml:mo>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mi>C</mml:mi>
                    </mml:mrow>
                    <mml:mi>i</mml:mi>
                    <mml:mo>α</mml:mo>
                  </mml:msubsup>
                </mml:mrow>
                <mml:mo>,</mml:mo>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mrow>
                      <mml:mi>C</mml:mi>
                    </mml:mrow>
                    <mml:mi>j</mml:mi>
                    <mml:mo>α</mml:mo>
                  </mml:msubsup>
                </mml:mrow>
                <mml:mo stretchy="false">)</mml:mo>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>.</mml:mo>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>Here, <italic toggle="yes">γ</italic> is a smoothing parameter, <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>〈</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>〉</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the set of all the spots <italic toggle="yes">j</italic> that are neighbors of <italic toggle="yes">i</italic>, and <italic toggle="yes">Z<sub>i</sub></italic> is the normalization factor. As suggested by (<xref rid="btad594-B26" ref-type="bibr">Zhao <italic toggle="yes">et al.</italic> (2021)</xref>, we used <italic toggle="yes">γ</italic> = 2 for ST data, and <italic toggle="yes">γ</italic> = 3 for Visium data. The normalization factor <italic toggle="yes">Z<sub>i</sub></italic> is calculated by aggregating the values of <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>α</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for all possible cluster labels of the <italic toggle="yes">i</italic>-th spot. The Potts model encourages nearby spots to belong to the same cluster, thus assigning a higher likelihood to cluster assignments with better spatial continuity.</p>
      <p>Lastly, we expect the spots belonging to the same cluster to have similar gene expressions (and thus similar PCs). Therefore, the correct cluster assignment should have a lower sum of variances of PCs within each cluster. Hence, we define the third quasi-likelihood component <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:mi>q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> as:</p>
      <disp-formula id="E5">
        <mml:math id="M5" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi>q</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>,</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>=</mml:mo>
            <mml:mtext>exp</mml:mtext>
            <mml:mo> </mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mo>−</mml:mo>
                <mml:mo>λ</mml:mo>
                <mml:mrow>
                  <mml:munderover>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>j</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>s</mml:mi>
                  </mml:munderover>
                </mml:mrow>
                <mml:mi>t</mml:mi>
                <mml:mi>r</mml:mi>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mo>Σ</mml:mo>
                        </mml:mrow>
                        <mml:mi>j</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>,</mml:mo>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> denotes the trace of a matrix, and <italic toggle="yes">λ</italic> is a scaling factor that is set to 100 in this study. Therefore, the final goodness measure of the clustering output <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:mi>v</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>α</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the product of the three components,</p>
      <disp-formula id="E6">
        <mml:math id="M6" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi>v</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>,</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>=</mml:mo>
            <mml:mi>q</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>,</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>|</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mo>=</mml:mo>
            <mml:mi>q</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mi>y</mml:mi>
            <mml:mo>,</mml:mo>
            <mml:mrow>
              <mml:msup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:msup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∏</mml:mo>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>n</mml:mi>
              </mml:munderover>
            </mml:mrow>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>y</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
            </mml:mrow>
            <mml:mo>|</mml:mo>
            <mml:mrow>
              <mml:msubsup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
                <mml:mo>α</mml:mo>
              </mml:msubsup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
            <mml:mi>p</mml:mi>
            <mml:mo stretchy="false">(</mml:mo>
            <mml:mrow>
              <mml:msubsup>
                <mml:mrow>
                  <mml:mi>C</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
                <mml:mo>α</mml:mo>
              </mml:msubsup>
            </mml:mrow>
            <mml:mo stretchy="false">)</mml:mo>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>For AutoScribbleDom, we follow the exact same process, but in this case, we search the (<italic toggle="yes">α</italic>, <italic toggle="yes">β</italic>) hyperparameter space instead of just <italic toggle="yes">α</italic>.</p>
    </sec>
    <sec>
      <title>2.8 Ground truth annotation procedure</title>
      <p>In the case of the human DLPFC data, the ground truth annotations are done by <xref rid="btad594-B11" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic> (2021)</xref> based on cytoarchitecture and selected gene markers. For the melanoma sample, the contour annotations over the histology image were done by <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref>; spot-level annotations did not exist. To generate spot-level annotations, we utilized the ST Spot Detector tool. Due to printing artifacts, the array used to create ST datasets may have positional variations. To address this issue, the tool provides corrected spot coordinates in both adjusted array coordinates and pixel coordinates on a high-resolution image. We then generated a mapping of array annotation based on the annotations made by <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref> over the histology image.</p>
      <p>In the process of manually annotating melanoma spots, we encountered two types of unannotated spots (<xref rid="btad594-F4" ref-type="fig">Fig. 4c</xref>). Firstly, there were spots in the region that were not originally annotated by <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref>, the publishers of the dataset. Secondly, there were spots located at the borders of two regions, making it challenging to assign them to a specific region accurately. We treated both kinds of spots as unannotated while measuring clustering performances.</p>
    </sec>
    <sec>
      <title>2.9 Performance measure</title>
      <p>To objectively assess the similarity between cluster labels and manual annotation, which is regarded as the ground truth, we employed the ARI. Given a set <italic toggle="yes">S</italic> of <italic toggle="yes">n</italic> elements, and two groupings or partitions (e.g. clusterings) of these elements, namely <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mrow><mml:mi>Y</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>, the overlap between X and Y can be summarized in a contingency table <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> where each entry <italic toggle="yes">n<sub>ij</sub></italic> denotes the number of objects in common between <italic toggle="yes">X<sub>i</sub></italic> and <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>:</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∩</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula></p>
      <disp-formula id="E7">
        <mml:math id="M7" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi mathvariant="italic">ARI</mml:mi>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:mfrac>
                <mml:mrow>
                  <mml:mrow>
                    <mml:munder>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mi>j</mml:mi>
                      </mml:mrow>
                    </mml:munder>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mtable>
                        <mml:mtr>
                          <mml:mtd>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>n</mml:mi>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mi>i</mml:mi>
                                  <mml:mi>j</mml:mi>
                                </mml:mrow>
                              </mml:msub>
                            </mml:mrow>
                          </mml:mtd>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd>
                            <mml:mn>2</mml:mn>
                          </mml:mtd>
                        </mml:mtr>
                      </mml:mtable>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo>−</mml:mo>
                  <mml:mrow>
                    <mml:mo stretchy="true">[</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>i</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>a</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>j</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>b</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>j</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo stretchy="true">]</mml:mo>
                  </mml:mrow>
                  <mml:mo>/</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mtable>
                      <mml:mtr>
                        <mml:mtd>
                          <mml:mi>n</mml:mi>
                        </mml:mtd>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd>
                          <mml:mn>2</mml:mn>
                        </mml:mtd>
                      </mml:mtr>
                    </mml:mtable>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mfrac>
                      <mml:mrow>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mn>2</mml:mn>
                      </mml:mrow>
                    </mml:mfrac>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mo stretchy="true">[</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>i</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>a</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo>+</mml:mo>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>j</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>b</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>j</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo stretchy="true">]</mml:mo>
                  </mml:mrow>
                  <mml:mo>−</mml:mo>
                  <mml:mrow>
                    <mml:mo stretchy="true">[</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>i</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>a</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:munder>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>j</mml:mi>
                        </mml:munder>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mtable>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mrow>
                                  <mml:msub>
                                    <mml:mrow>
                                      <mml:mi>b</mml:mi>
                                    </mml:mrow>
                                    <mml:mi>j</mml:mi>
                                  </mml:msub>
                                </mml:mrow>
                              </mml:mtd>
                            </mml:mtr>
                            <mml:mtr>
                              <mml:mtd>
                                <mml:mn>2</mml:mn>
                              </mml:mtd>
                            </mml:mtr>
                          </mml:mtable>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo stretchy="true">]</mml:mo>
                  </mml:mrow>
                  <mml:mo>/</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mtable>
                      <mml:mtr>
                        <mml:mtd>
                          <mml:mi>n</mml:mi>
                        </mml:mtd>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd>
                          <mml:mn>2</mml:mn>
                        </mml:mtd>
                      </mml:mtr>
                    </mml:mtable>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mfrac>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <p>where <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula></p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 ScribbleDom outperforms state-of-the-art methods in 9 out of the 12 samples of the human DLPFC dataset</title>
      <p><xref rid="btad594-T1" ref-type="table">Table 1</xref> shows the comparison of ScribbleDom with several state-of-the-art algorithms in terms of ARI. We chose to compare with BayesSpace, SC-MEB, SpaGCN, and Giotto as these are four very recently published spatial clustering algorithms. Additionally, SpaGCN integrates information from gene expression, spatial location, and histology for spatial domain identification. Since ScribbleDom also extracts some information from histology (through the form of expert scribbles), it made perfect sense to benchmark against SpaGCN. From the performance of the state-of-the-art spatial clustering methods, it is clear that spatial clustering algorithms perform much better than the non-spatial ones in spatial domain identification. Nevertheless, to be comprehensive, we wanted to benchmark ScribbleDom against a few non-spatial clustering algorithms. For this, we chose Gaussian mixture model (GMM) (<xref rid="btad594-B1" ref-type="bibr">Bishop 2006</xref>) and Louvain (<xref rid="btad594-B2" ref-type="bibr">De Meo <italic toggle="yes">et al.</italic> 2011</xref>). We have compared with BayesSpace, SpaGCN, and SC-MEB which are state-of-the-art methods. We have also compared with Giotto (<xref rid="btad594-B3" ref-type="bibr">Dries <italic toggle="yes">et al.</italic> 2021</xref>) and two non-spatial clustering algorithms, namely, GMM (<xref rid="btad594-B1" ref-type="bibr">Bishop 2006</xref>) and Louvain (<xref rid="btad594-B2" ref-type="bibr">De Meo <italic toggle="yes">et al.</italic> 2011</xref>). ScribbleDom equals or outperforms all the aforementioned state-of-the-art methods in 9 out of the 12 samples, improving the ARI by 51.90%, 47.40%, and 49.84% on average compared to BayesSpace, SC-MEB, and SpaGCN, respectively. Additionally, ScribbleDom equals or outperforms BayesSpace in 10, and SC-MEB in 11 samples. On the other hand, AutoScribbleDom equals or outperforms BayesSpace in 5 samples, and SC-MEB in 7 samples.</p>
      <p>These results imply significant quantitative superiority of ScribbleDom over state-of-the-art methods. Moreover, one of the main drawbacks of BayesSpace is the greater thickness of some layers compared to the manual annotation, e.g. layer 4 (colored magenta) of <xref rid="btad594-F3" ref-type="fig">Fig. 3a</xref>. BayesSpace (<xref rid="btad594-F3" ref-type="fig">Fig. 3f</xref>) predicted layer 4 to be much thicker than what the manual annotation suggests. ScribbleDom can identify layer 4 as a comparatively narrower layer (<xref rid="btad594-F3" ref-type="fig">Fig. 3d</xref>) which better resembles the manual annotation.</p>
      <fig position="float" id="btad594-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Comparison of various spatial domain detection algorithms on the DLPFC dataset, sample 151673. (a) Manual annotation (ground truth). (b) Scribbles by a human annotator. (c) Spatial domains detected by ScribbleDom. (d) Spatial domains detected by SC-MEB. (e) Spatial domains detected by BayesSpace. (f) Spatial domains detected by AutoScribbleDom.</p>
        </caption>
        <graphic xlink:href="btad594f3" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.2 ScribbleDom identifies narrow lymphoid tissue regions around the tumor in melanoma cancer sample</title>
      <p>We evaluated the performance of ScribbleDom on a melanoma sample from <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref>, and it outperforms BayesSpace by 15.54% in terms of ARI calculated on the manually annotated regions. The manual annotation (<xref rid="btad594-F4" ref-type="fig">Fig. 4c</xref>) of the tissue revealed three distinct regions: melanoma, stroma, and lymphoid tissue, with an additional unannotated area. So, we conducted experiments with ScribbleDom as well as AutoScribbleDom using four clusters.</p>
      <fig position="float" id="btad594-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Analysis on melanoma ST sample. (a) Histology image. (b) Manual annotation. (c) Scribbles by a human annotator. (d) Spatial domains detected by BayesSpace. (e) Spatial domains detected by AutoScribbleDom. (f) Spatial domains detected by ScribbleDom.</p>
        </caption>
        <graphic xlink:href="btad594f4" position="float"/>
      </fig>
      <p>ScribbleDom captured the melanoma tumor region as a whole (<xref rid="btad594-F4" ref-type="fig">Fig. 4g</xref>), in contrast to other methods such as BayesSpace (<xref rid="btad594-F4" ref-type="fig">Fig. 4e</xref>), Giotto (<xref rid="btad594-B3" ref-type="bibr">Dries <italic toggle="yes">et al.</italic> 2021</xref>), and Louvain (<xref rid="btad594-B2" ref-type="bibr">De Meo <italic toggle="yes">et al.</italic> 2011</xref>), which tended to split the tumor into peripheral and central regions. Notably, our method also successfully identified the lymphoid tissues surrounding the tumor region, a feature shared only by Giotto, SC3 (<xref rid="btad594-B7" ref-type="bibr">Kiselev <italic toggle="yes">et al.</italic> 2017</xref>), and BayesSpace in subspot resolution. BayesSpace does not capture the lymphoid tissue bordering the tumor in its original resolution (<xref rid="btad594-F4" ref-type="fig">Fig. 4e</xref>). On the other hand, AutoScribbleDom identified a periphery around the center of the tumor region, along with the surrounding lymphoid tissue (<xref rid="btad594-F4" ref-type="fig">Fig. 4f</xref>).</p>
      <p>We calculated the ARI (excluding the unannotated spots) to measure the agreement between spatial domains detected by ScribbleDom and the manual annotation. ScribbleDom achieved an ARI of 0.87 outperforming BayesSpace (0.75). On the other hand, AutoScribbleDom achieved an ARI of 0.74. Although slightly lower than the ARI achieved by BayesSpace, our method exhibited superior accuracy in capturing the presence of lymphoid tissues surrounding the tumor.</p>
      <p>These findings highlight the efficacy of ScribbleDom in identifying narrow regions, such as lymphoid cells around the melanoma tumor in cancer tissue, demonstrating its superior performance compared to BayesSpace. Also, AutoScribbleDom autonomously identified most of the annotated lymphoid regions. These results underscore the potential of ScribbleDom and AutoScribbleDom in facilitating a better understanding of the tumor microenvironment.</p>
    </sec>
    <sec>
      <title>3.3 ScribbleDom can differentiate tumor and non-tumor regions in human breast cancer tissue</title>
      <p>We applied ScribbleDom to analyze a human breast cancer Visium sample, and it performed at par with the results obtained using BayesSpace in both semi-supervised and unsupervised settings. The manual annotation of the sample consists of two distinct regions: tumor and non-tumor (<xref rid="btad594-F5" ref-type="fig">Fig. 5c</xref>). With a limited amount of scribbles (<xref rid="btad594-F5" ref-type="fig">Fig. 5d</xref>), ScribbleDom was able to successfully detect the tumors (<xref rid="btad594-F5" ref-type="fig">Fig. 5g</xref>). ScribbleDom achieved an ARI of 0.82 (<xref rid="btad594-F5" ref-type="fig">Fig. 5g</xref>). Even AutoScribbleDom obtained a competitive ARI of 0.83 (<xref rid="btad594-F5" ref-type="fig">Fig. 5f</xref>). While this ARI is slightly lower than that of BayesSpace (0.84) (<xref rid="btad594-F5" ref-type="fig">Fig. 5e</xref>), it is worth noting that ScribbleDom or AutoScribbleDom still effectively captured all the tumor regions in the human breast cancer sample.</p>
      <fig position="float" id="btad594-F5">
        <label>Figure 5.</label>
        <caption>
          <p>Analysis on human breast cancer dataset. (a) Histology image. (b) Manual annotation. (c) Scribbles by a human annotator. (d) Spatial domains detected by BayesSpace. (e) Spatial domains detected by AutoScribbleDom. (f) Spatial domains detected by ScribbleDom.</p>
        </caption>
        <graphic xlink:href="btad594f5" position="float"/>
      </fig>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>ScribbleDom detects spatial domains in ST tissue samples by leveraging gene expression, spatial neighborhood, and some prior knowledge about the sample. The prior information can either be from a human annotator for some of the spots in the form of scribbles on histology image, or generated from an unsupervised non-spatial clustering algorithm (e.g. mclust). We named the later approach AutoScribbleDom. The output generated by ScribbleDom provides valuable insights into the transcriptionally homogeneous tissue regions within the spatial transcriptomics data. In comparison to existing state-of-the-art methods, ScribbleDom demonstrates superior accuracy in detecting spatial domains whereas AutoScribbleDom too shows competitive results.</p>
    <p>Many recent methods incorporate histology information for spatial domain identification. However, not all spatial transcriptomics technology can generate RNA data and histology in a matching way. This may decrease the quality of histology to spot mapping. ScribbleDom can overcome this limitation as it does not require a one-to-one mapping from histology to spots. In the case where one-to-one histology to spot mapping is not present, the scribbled spots can potentially be derived from scribbles over the histology by an estimation method. So, scribbling over the spots of ST data is a potential future work.</p>
    <p><xref rid="btad594-T1" ref-type="table">Table 1</xref> shows the superiority of ScribbleDom quantitatively, and <xref rid="btad594-F3" ref-type="fig">Fig. 3g</xref> shows the qualitative superiority of ScribbleDom for sample 151673 of the human DLPFC dataset, where the thickness of the layers is better predicted by ScribbleDom (see for example, the thickness of layer 4, colored magenta in manual annotation). Figures for other samples can be found in the <xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref>. Moreover, in the analysis of the melanoma and human breast cancer datasets, ScribbleDom successfully detected the tumor regions. Specifically, in the case of melanoma, we were able to capture the lymphoid tissues that border the melanoma region using both the semi-supervised (<xref rid="btad594-F4" ref-type="fig">Fig. 4g</xref>) and unsupervised (<xref rid="btad594-F4" ref-type="fig">Fig. 4f</xref>) approaches. Furthermore, ScribbleDom outperformed BayesSpace in terms of ARI, demonstrating a more accurate identification of the melanoma and lymphoid tissue regions. ScribbleDom’s capability to identify different regions of the tumor neighborhood suggests its potential use in detecting narrow regions such as lymphoid tissues. The ability to segment and identify specific regions within a tumor can aid in understanding the composition and characteristics of the tumor neighborhood.</p>
    <p>Our experiments have demonstrated that ScribbleDom achieves high accuracy in detecting spatial domains within tissue regions when expert scribbles are available. This highlights ScribbleDom’s ability to leverage domain knowledge provided by expert annotators to identify different tissue domains. We have introduced a hyperparameter, <italic toggle="yes">α</italic>, to control the relative importance of scribbles and gene expression similarity across spots. Additionally, ScribbleDom incorporates inception blocks to capture multi-scale features within the tissue region, enabling accurate detection of various tissue domains, such as smooth layers in human DLPFC samples, narrow bordering regions of lymphoid tissues around tumor regions in melanoma, and scattered tumors across different regions in human breast cancer dataset. AutoScribbleDom also shows competitive results compared to state-of-the-art methods. It utilizes a non-spatial clustering algorithm (mclust) to generate automated scribbles and uses them for the identification of spatial domains. However, the automated scribbles generated by mclust may not accurately represent the spatial domain, due to its (mclust) inability to incorporate spatial information. To mitigate potential inaccuracies, we randomly drop some scribbled spots in each iteration, controlling the dropout rate with another parameter <italic toggle="yes">β</italic>. This approach helps AutoScribbleDom generalize the information from similar spots and reduces the impact of inaccurate automated scribbles.</p>
    <p>Additionally, instead of fixing the hyperparameters at specific values, we performed a grid search across a range of hyperparameter values. We selected the hyperparameter values that maximize an ARI independent goodness score. The goodness is determined from the clustering likelihood, the conditional likelihood of the gene expression of spots given the clustering and a penalty term that tends to reduce variance of the PCs within the same cluster. Our proposed goodness score can potentially be used to compare clustering output of various algorithms and can help practitioners pick the best one.</p>
    <p>Although there has not been a thorough benchmarking on the existing ST domain detection methods, the publications suggest that no method is an indisputable winner in every dataset. This leaves practitioners like clinicians and experimental biologists a bit helpless—on one hand, it is difficult to fine-tune the model parameters to obtain the domains that conform to known biology; on the other hand, the existing methods cannot directly incorporate any form of human supervision. Thus, ScribbleDom fills in a unique niche: (i) it is a versatile method that works satisfactorily both with and without human supervision and (ii) it can work with minimal human supervision, in the form of scribbles. ScribbleDom thus broadens the options for practitioners, especially for domain detection in complex tissues, e.g. from advanced disease states. Another important application of ScribbleDom can be in helping practitioners and method developers efficiently create ground truth annotations without inducing bias, e.g. in demarcating the precise domain boundaries.</p>
    <p>ScribbleDom is generalizable to other sequencing-based technologies as well [e.g. Stereo-seq (<xref rid="btad594-B21" ref-type="bibr">Wei <italic toggle="yes">et al.</italic> 2022</xref>)]. These technologies capture cells in spots (beads) arranged in grids, and ScribbleDom’s convolutions (its basic blocks) work seamlessly on any grid-structured data. With minor preprocessing, ScribbleDom is also applicable to fluorescent in situ hybridization (FISH) based techniques. In these cases, ScribbleDom will need a preprocessed input where one has overlaid a grid structure on the spatial transcriptomic measurements. Alternately, graph convolutions can be implemented for FISH-based data, which is left as a future work.</p>
    <p>ScribbleDom is extensible and can be pretrained if more datasets are available in the future. It enables the human-in-the-loop paradigm in the process of machine learning for the identification of spatial domains in the realm of spatial transcriptomics by incorporating prior annotations obtained from human experts. This means that a clinician is not limited to a fixed output provided by an unsupervised method. Instead, by inputting different scribbles, they can obtain diverse outputs, making the spatial domain identification process more robust and adaptable.</p>
  </sec>
  <sec>
    <title>5 Conclusion</title>
    <p>One of the “eleven grand challenges in single-cell data science” (<xref rid="btad594-B8" ref-type="bibr">Lahnemann <italic toggle="yes">et al.</italic> 2020</xref>) is to find patterns in spatially resolved measurements. We have incorporated a semi-supervised deep learning pipeline in this work to address that challenge. Inspired by similarities in the problem in hand to the image segmentation problem in the computer vision community, we started our endeavors from a state-of-the-art pipeline to solve the later problem. We then made considerable changes to the model to adapt it to spatial transcriptomics data. Furthermore, we made important changes in the model architecture to capture spatial domain features at different resolutions. Our method, ScribbleDom, allows for the incorporation of expert knowledge in the form of scribbles. The method can also function in a fully unsupervised manner when input from an expert is not available. Through a benchmark study with state-of-the-art methods on the human DLPFC, melanoma, and human breast cancer datasets, we have demonstrated the superiority of our semi-supervised approach. In the future, we can pretrain our model as more manually annotated data become available. The ScribbleDom package is well documented and easy to use. We hope that biologists will use ScribbleDom to identify spatial domains in ST samples that would benefit them for downstream analyses which will lead to potential discoveries in the field of bioinformatics.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btad594_Supplementary_Data</label>
      <media xlink:href="btad594_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We thank the anonymous reviewers for their valuable suggestions. We acknowledge <xref rid="btad594-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic> (2018)</xref> for providing us with the high-resolution H&amp;E stained image of the melanoma ST sample.</p>
  </ack>
  <sec>
    <title>Author contributions</title>
    <p>M.A.H.S. and M.S.R. conceived the study. M.N.R., A.A.N., and A.M.T. ran all the experiments. M.A.A. implemented the goodness measure to compare among models with different hyperparameter settings. A.A.N. finalized the s/w package. All authors contributed to analyzing the results and writing the manuscript. M.A.H.S. and M.S.R. did the final editorial. All the authors reviewed the manuscript.</p>
  </sec>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>M.N.R. is supported by the ICT Fellowship at the Masters level in the fiscal year 2022–2023 for research in ICT sector, administered by ICT Division, Government of People’s Republic of Bangladesh. A.A.N. is supported by RISE Student Research Grant [No. s2022-02-008], administered by RISE, BUET.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>Human Dorsolateral prefrontal cortex (DLPFC) raw spatial data for all the 12 samples is publicly available in spatialLIBD website (<ext-link xlink:href="https://research.libd.org/spatialLIBD/" ext-link-type="uri">https://research.libd.org/spatialLIBD/</ext-link>) under the “raw data” header. Human breast cancer: ductal carcinoma in situ, invasive carcinoma raw count matrix and tissue spatial positions are publicly available in 10xgenomics website (<ext-link xlink:href="https://www.10xgenomics.com/resources/datasets/human-breast-cancer-ductal-carcinoma-in-situ-invasive-carcinoma-ffpe-1-standard-1-3-0" ext-link-type="uri">https://www.10xgenomics.com/resources/datasets/human-breast-cancer-ductal-carcinoma-in-situ-invasive-carcinoma-ffpe-1-standard-1-3-0</ext-link>) under the “Output Files” header. Melanoma raw count matrix can be downloaded from Spatial Research website (<ext-link xlink:href="https://www.spatialresearch.org/wp-content/uploads/2019/03/ST-MelanomaDatasets_1.zip" ext-link-type="uri">https://www.spatialresearch.org/wp-content/uploads/2019/03/ST-MelanomaDatasets_1.zip</ext-link>); row/column coordinates are obtained from column labels of the raw count matrix.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btad594-B1">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Bishop</surname><given-names>CM.</given-names></string-name></person-group>  <year>2006</year>. <source>Pattern Recognition and Machine Learning (Information Science and Statistics)</source>. <publisher-loc>Berlin</publisher-loc>: <publisher-name>Springer-Verlag</publisher-name>.</mixed-citation>
    </ref>
    <ref id="btad594-B2">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>De Meo</surname><given-names>P</given-names></string-name>, <string-name><surname>Ferrara</surname><given-names>E</given-names></string-name>, <string-name><surname>Fiumara</surname><given-names>G</given-names></string-name></person-group>  <etal>et al</etal> Generalized Louvain method for community detection in large networks. In: <italic toggle="yes">International Conference on Intelligent Systems Design and Applications, ISDA, Córdoba, Spain</italic>, <year>2011.</year></mixed-citation>
    </ref>
    <ref id="btad594-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dries</surname><given-names>R</given-names></string-name>, <string-name><surname>Zhu</surname><given-names>Q</given-names></string-name>, <string-name><surname>Dong</surname><given-names>R</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Giotto: a toolbox for integrative analysis and visualization of spatial expression data</article-title>. <source>Genome Biol</source>  <year>2021</year>;<volume>22</volume>:<fpage>78</fpage>.<pub-id pub-id-type="pmid">33685491</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hu</surname><given-names>J</given-names></string-name>, <string-name><surname>Li</surname><given-names>X</given-names></string-name>, <string-name><surname>Coleman</surname><given-names>K</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>SpaGCN: integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>. <source>Nat Methods</source>  <year>2021</year>;<volume>18</volume>:<fpage>1342</fpage>–<lpage>51</lpage>.<pub-id pub-id-type="pmid">34711970</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B5">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Kayalibay</surname><given-names>B</given-names></string-name>, <string-name><surname>Jensen</surname><given-names>G</given-names></string-name>, <string-name><surname>van der Smagt</surname><given-names>P.</given-names></string-name></person-group> CNN-based segmentation of medical imaging data. arXiv, arXiv:1701.03056, <year>2017</year>, preprint: not peer reviewed.</mixed-citation>
    </ref>
    <ref id="btad594-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kim</surname><given-names>W</given-names></string-name>, <string-name><surname>Kanezaki</surname><given-names>A</given-names></string-name>, <string-name><surname>Tanaka</surname><given-names>M.</given-names></string-name></person-group>  <article-title>Unsupervised learning of image segmentation based on differentiable feature clustering</article-title>. <source>IEEE Trans Image Process</source>  <year>2020</year>;<volume>29</volume>:<fpage>8055</fpage>–<lpage>68</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kiselev</surname><given-names>VY</given-names></string-name>, <string-name><surname>Kirschner</surname><given-names>K</given-names></string-name>, <string-name><surname>Schaub</surname><given-names>MT</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Sc3: consensus clustering of single-cell RNA-seq data</article-title>. <source>Nat Methods</source>  <year>2017</year>;<volume>14</volume>:<fpage>483</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">28346451</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lahnemann</surname><given-names>D</given-names></string-name>, <string-name><surname>Koster</surname><given-names>J</given-names></string-name>, <string-name><surname>Szczurek</surname><given-names>E</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Eleven grand challenges in single-cell data science</article-title>. <source>Genome Biol</source>  <year>2020</year>;<volume>21</volume>:<fpage>31</fpage>.<pub-id pub-id-type="pmid">32033589</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B9">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Lin</surname><given-names>D</given-names></string-name>, <string-name><surname>Dai</surname><given-names>J</given-names></string-name>, <string-name><surname>Jia</surname><given-names>J</given-names></string-name></person-group>  <etal>et al</etal> Scribblesup: Scribble-supervised convolutional networks for semantic segmentation. In: <italic toggle="yes">2016 IEEE Conference on Computer Vision and Pattern Recognition (CVPR), Las Vegas, USA</italic>, <year>2016</year>, <fpage>3159</fpage>–<lpage>67</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Longo</surname><given-names>SK</given-names></string-name>, <string-name><surname>Guo</surname><given-names>MG</given-names></string-name>, <string-name><surname>Ji</surname><given-names>AL</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Integrating single-cell and spatial transcriptomics to elucidate intercellular tissue dynamics</article-title>. <source>Nat Rev Genet</source>  <year>2021</year>;<volume>22</volume>:<fpage>627</fpage>–<lpage>44</lpage>.<pub-id pub-id-type="pmid">34145435</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maynard</surname><given-names>KR</given-names></string-name>, <string-name><surname>Collado-Torres</surname><given-names>L</given-names></string-name>, <string-name><surname>Weber</surname><given-names>LM</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Transcriptome-scale spatial gene expression in the human dorsolateral prefrontal cortex</article-title>. <source>Nat Neurosci</source>  <year>2021</year>;<volume>24</volume>:<fpage>425</fpage>–<lpage>36</lpage>.<pub-id pub-id-type="pmid">33558695</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moses</surname><given-names>L</given-names></string-name>, <string-name><surname>Pachter</surname><given-names>L.</given-names></string-name></person-group>  <article-title>Museum of spatial transcriptomics</article-title>. <source>Nat Methods</source>  <year>2022</year>;<volume>19</volume>:<fpage>534</fpage>–<lpage>46</lpage>.<pub-id pub-id-type="pmid">35273392</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ni</surname><given-names>Z</given-names></string-name>, <string-name><surname>Prasad</surname><given-names>A</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Spotclean adjusts for spot swapping in spatial transcriptomics data</article-title>. <source>Nat Commun</source>  <year>2022</year>;<volume>13</volume>:<fpage>2971</fpage>.<pub-id pub-id-type="pmid">35624112</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Palla</surname><given-names>G</given-names></string-name>, <string-name><surname>Fischer</surname><given-names>DS</given-names></string-name>, <string-name><surname>Regev</surname><given-names>A</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Spatial components of molecular tissue biology</article-title>. <source>Nat Biotechnol</source>  <year>2022</year>;<volume>40</volume>:<fpage>308</fpage>–<lpage>18</lpage>.<pub-id pub-id-type="pmid">35132261</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B15">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Pham</surname><given-names>D</given-names></string-name>, <string-name><surname>Tan</surname><given-names>X</given-names></string-name>, <string-name><surname>Xu</surname><given-names>J</given-names></string-name></person-group>  <etal>et al</etal> stLearn: integrating spatial location, tissue morphology and gene expression to find cell types, cell-cell interactions and spatial trajectories within undissociated tissues. bioRxiv, <pub-id pub-id-type="doi">10.1101/2020.05.31.125658</pub-id>, <year>2020</year>, preprint: not peer reviewed.</mixed-citation>
    </ref>
    <ref id="btad594-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rao</surname><given-names>A</given-names></string-name>, <string-name><surname>Barkley</surname><given-names>D</given-names></string-name>, <string-name><surname>França</surname><given-names>GS</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Exploring tissue architecture using spatial transcriptomics</article-title>. <source>Nature</source>  <year>2021</year>;<volume>596</volume>:<fpage>211</fpage>–<lpage>20</lpage>.<pub-id pub-id-type="pmid">34381231</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Scrucca</surname><given-names>L</given-names></string-name>, <string-name><surname>Fop</surname><given-names>M</given-names></string-name>, <string-name><surname>Murphy</surname><given-names>TB</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Mclust 5: clustering, classification and density estimation using Gaussian finite mixture models</article-title>. <source>R J</source>  <year>2016</year>;<volume>8</volume>:<fpage>289</fpage>–<lpage>317</lpage>.<pub-id pub-id-type="pmid">27818791</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B18">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Szegedy</surname><given-names>C</given-names></string-name>, <string-name><surname>Liu</surname><given-names>W</given-names></string-name>, <string-name><surname>Jia</surname><given-names>Y</given-names></string-name></person-group>  <etal>et al</etal> Going deeper with convolutions. In: <italic toggle="yes">Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition, Boston, USA</italic>, <year>2015</year>, <fpage>1</fpage>–<lpage>9</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Thrane</surname><given-names>K</given-names></string-name>, <string-name><surname>Eriksson</surname><given-names>H</given-names></string-name>, <string-name><surname>Maaskola</surname><given-names>J</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Spatially resolved transcriptomics enables dissection of genetic heterogeneity in stage III cutaneous malignant melanoma</article-title>. <source>Cancer Res</source>  <year>2018</year>;<volume>78</volume>:<fpage>5970</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">30154148</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>G</given-names></string-name>, <string-name><surname>Li</surname><given-names>W</given-names></string-name>, <string-name><surname>Zuluaga</surname><given-names>MA</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Interactive medical image segmentation using deep learning with image-specific fine tuning</article-title>. <source>IEEE Trans Med Imaging</source>  <year>2018</year>;<volume>37</volume>:<fpage>1562</fpage>–<lpage>73</lpage>.<pub-id pub-id-type="pmid">29969407</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wei</surname><given-names>X</given-names></string-name>, <string-name><surname>Fu</surname><given-names>S</given-names></string-name>, <string-name><surname>Li</surname><given-names>H</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Single-cell stereo-seq reveals induced progenitor cells involved in axolotl brain regeneration</article-title>. <source>Science</source>  <year>2022</year>;<volume>377</volume>:<fpage>eabp9444</fpage>.<pub-id pub-id-type="pmid">36048929</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wu</surname><given-names>F-Y.</given-names></string-name></person-group>  <article-title>The Potts model</article-title>. <source>Rev Mod Phys</source>  <year>1982</year>;<volume>54</volume>:<fpage>235</fpage>–<lpage>68</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B23">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Xie</surname><given-names>J</given-names></string-name>, <string-name><surname>Girshick</surname><given-names>R</given-names></string-name>, <string-name><surname>Farhadi</surname><given-names>A.</given-names></string-name></person-group> Unsupervised deep embedding for clustering analysis. In: <italic toggle="yes">Proceedings of the 33rd International Conference on Machine Learning</italic>, pp. 478–487. PMLR, New York, NY, USA, 2016.</mixed-citation>
    </ref>
    <ref id="btad594-B24">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Xu</surname><given-names>J</given-names></string-name>, <string-name><surname>Schwing</surname><given-names>AG</given-names></string-name>, <string-name><surname>Urtasun</surname><given-names>R.</given-names></string-name></person-group> Learning to segment under various forms of weak supervision. In: <italic toggle="yes">2015 IEEE Conference on Computer Vision and Pattern Recognition (CVPR), Boston, USA</italic>, <year>2015</year>, <fpage>3781</fpage>–<lpage>90</lpage>.</mixed-citation>
    </ref>
    <ref id="btad594-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Shi</surname><given-names>X</given-names></string-name>, <string-name><surname>Liu</surname><given-names>W</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>SC-MEB: spatial clustering with hidden Markov random field using empirical Bayes</article-title>. <source>Brief Bioinform</source>  <year>2022</year>;<volume>23</volume>:<fpage>bbab466</fpage>.<pub-id pub-id-type="pmid">34849574</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhao</surname><given-names>E</given-names></string-name>, <string-name><surname>Stone</surname><given-names>MR</given-names></string-name>, <string-name><surname>Ren</surname><given-names>X</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>. <source>Nat Biotechnol</source>  <year>2021</year>;<volume>39</volume>:<fpage>1375</fpage>–<lpage>84</lpage>.<pub-id pub-id-type="pmid">34083791</pub-id></mixed-citation>
    </ref>
    <ref id="btad594-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zheng</surname><given-names>GX</given-names></string-name>, <string-name><surname>Terry</surname><given-names>JM</given-names></string-name>, <string-name><surname>Belgrader</surname><given-names>P</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>. <source>Nat Commun</source>  <year>2017</year>;<volume>8</volume>:<fpage>14049</fpage>.<pub-id pub-id-type="pmid">28091601</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
