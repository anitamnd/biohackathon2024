<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6129268</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/bty562</article-id>
    <article-id pub-id-type="publisher-id">bty562</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Eccb 2018: European Conference on Computational Biology Proceedings</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Data</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MDPbiome: microbiome engineering through prescriptive perturbations</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>García-Jiménez</surname>
          <given-names>Beatriz</given-names>
        </name>
        <xref ref-type="aff" rid="bty562-aff1">1</xref>
        <xref ref-type="corresp" rid="bty562-cor2"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>de la Rosa</surname>
          <given-names>Tomás</given-names>
        </name>
        <xref ref-type="aff" rid="bty562-aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wilkinson</surname>
          <given-names>Mark D</given-names>
        </name>
        <xref ref-type="aff" rid="bty562-aff1">1</xref>
        <xref ref-type="corresp" rid="bty562-cor1"/>
        <!--<email>markw@illuminae.com</email>-->
      </contrib>
    </contrib-group>
    <aff id="bty562-aff1"><label>1</label>Center for Plant Biotechnology and Genomics UPM - INIA, Universidad Politecnica de Madrid, Madrid, Spain</aff>
    <aff id="bty562-aff2"><label>2</label>Department of Computer Science, Universidad Carlos III de Madrid, Madrid, Spain</aff>
    <author-notes>
      <corresp id="bty562-cor1">To whom correspondence should be addressed. E-mail: <email>markw@illuminae.com</email></corresp>
      <corresp id="bty562-cor2"><sup>†</sup>Present address: Department of Systems Biology, Centro Nacional de Biotecnología, Consejo Superior de Investigaciones Científicas (CNB-CSIC), Madrid 28049, Spain</corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>01</day>
      <month>9</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2018-09-08">
      <day>08</day>
      <month>9</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>08</day>
      <month>9</month>
      <year>2018</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>34</volume>
    <issue>17</issue>
    <fpage>i838</fpage>
    <lpage>i847</lpage>
    <permissions>
      <copyright-statement>© The Author(s) 2018. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2018</copyright-year>
      <license license-type="cc-by" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="bty562.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Recent microbiome dynamics studies highlight the current inability to predict the effects of external perturbations on complex microbial populations. To do so would be particularly advantageous in fields such as medicine, bioremediation or industrial scenarios.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>MDPbiome statistically models longitudinal metagenomics samples undergoing perturbations as a Markov Decision Process (MDP). Given a starting microbial composition, our MDPbiome system suggests the sequence of external perturbation(s) that will engineer that microbiome to a goal state, for example, a healthier or more performant composition. It also estimates intermediate microbiome states along the path, thus making it possible to avoid particularly undesirable/unhealthy states. We demonstrate MDPbiome performance over three real and distinct datasets, proving its flexibility, and the reliability and universality of its output ‘optimal perturbation policy’. For example, an MDP created using a vaginal microbiome time series, with a goal of recovering from bacterial vaginosis, suggested avoidance of perturbations such as lubricants or sex toys; while another MDP provided a quantitative explanation for why salmonella vaccine accelerates gut microbiome maturation in chicks. This novel analytical approach has clear applications in medicine, where it could suggest low-impact clinical interventions that will lead to achievement or maintenance of a healthy microbial population, or alternately, the sequence of interventions necessary to avoid strongly negative microbiome states.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>Code (<ext-link ext-link-type="uri" xlink:href="https://github.com/beatrizgj/MDPbiome">https://github.com/beatrizgj/MDPbiome</ext-link>) and result files (<ext-link ext-link-type="uri" xlink:href="https://tomdelarosa.shinyapps.io/MDPbiome/">https://tomdelarosa.shinyapps.io/MDPbiome/</ext-link>) are available online.</p>
      </sec>
      <sec id="s4">
        <title>Supplementary information</title>
        <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Isaac Peral and/or Marie Curie co-fund Programme at UPM</named-content>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Fundacion BBVA</named-content>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="10"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>This manuscript addresses an important challenge in microbiome analysis (<xref rid="bty562-B3" ref-type="bibr">Bashan <italic>et al.</italic>, 2016</xref>; <xref rid="bty562-B6" ref-type="bibr">Bradley and Pollard, 2017</xref>; <xref rid="bty562-B27" ref-type="bibr">Gilbert <italic>et al.</italic>, 2016</xref>): precise description of longitudinal microbiome variability and dynamics. It responds to the call for a ‘microbial Global Positioning System (GPS)’, originally suggested by <xref rid="bty562-B27" ref-type="bibr">Gilbert <italic>et al.</italic> (2016)</xref>, where the start and end states of the microbiome for an individual subject could be defined and located, and the optimal route from start to end clearly mapped. High-throughput sequencing has enabled the study of metagenomics—determination of microbial compositions more precisely and rapidly than bacterial culture techniques. Metagenomics analyses of the same population over time may reveal the detailed dynamics within complex bacterial communities, interactions between microbes and the influence of external perturbations. Inferring microbial dynamics from temporal metagenomics data is, however, a very challenging task (<xref rid="bty562-B12" ref-type="bibr">Cao <italic>et al.</italic>, 2017</xref>) and there are relatively few studies and little knowledge about microbiome dynamics. Nevertheless, it should be possible to utilize such data to construct models aimed at <italic>in silico</italic> prediction of perturbation-outcomes (<xref rid="bty562-B23" ref-type="bibr">Fritz <italic>et al.</italic>, 2013</xref>).</p>
    <p>It is well-recognized that predictable microbial compositions are associated with important traits such as health (<xref rid="bty562-B27" ref-type="bibr">Gilbert <italic>et al.</italic>, 2016</xref>; <xref rid="bty562-B35" ref-type="bibr">Shankar, 2017</xref>), and recent studies have supported alteration of the microbiome as ‘therapy’ (<xref rid="bty562-B3" ref-type="bibr">Bashan <italic>et al.</italic>, 2016</xref>; <xref rid="bty562-B12" ref-type="bibr">Cao <italic>et al.</italic>, 2017</xref>). Therefore, an example of where predictive microbiome models would be useful would be a hospital critical-care ward. Patients suffering from sepsis often die before traditional bacterial cultures can be returned, and often the causative agent is never identified. With little information about the cause of the infection, a wide range of high-impact clinical interventions are applied to the patient in the hope that one might prove effective. Unfortunately, the resulting disruption—including to the normal microflora of the patient—often leads to serious complicating illnesses such as pneumonia (<xref rid="bty562-B5" ref-type="bibr">Boyd <italic>et al.</italic>, 2014</xref>). <italic>In silico</italic> models of the microbiome could, therefore, provide badly needed and rapid feedback on the efficacy of an ongoing treatment regime, or better still, guidance on a specific course of interventions—for example, a personalized and contextually sensitive sequence of drugs and/or food—that could lead the patient safely back to health. Outside of medicine, intensive agriculture has significant negative impacts on the environment through, for example, greenhouse gas emissions and the application of large amounts of pesticides and fertilizer, and the resulting contamination of groundwater (<xref rid="bty562-B11" ref-type="bibr">Canter, 2017</xref>). The plant-associated microbial populations available to be engineered are the root-associated (endophytic) microbes in the rhizosphere, with the objective of improving plant health or nutrition, improving soil fertility and/or promoting low-impact, sustainable farming.</p>
    <p>Current approaches to microbiome engineering might be considered ‘extreme’, for example, faecal microbiome transplantation (FMT). Less extreme, but nevertheless relatively direct, pre- and pro-biotics are used in the farming industry to engineer animal gut microbiomes in order to avoid the pathogen resistance resulting from antibiotic treatments. Acknowledging that microbiome engineering was still in its infancy, <xref rid="bty562-B22" ref-type="bibr">Foo <italic>et al.</italic> (2017)</xref> proposed to engineer the microbiome through perturbations to recover microbial communities from a state of dysbiosis. Achieving this, however, will require a deeper understanding of, and tooling to measure, microbiome states and responses.</p>
    <p>It is known that elements such as natural variations and stress factors modify microbiota composition (<xref rid="bty562-B40" ref-type="bibr">Weiss and Hennet, 2017</xref>), however it is an open problem to discover which factor(s) lead to which specific composition change, and how and why that happens. The review of <xref rid="bty562-B21" ref-type="bibr">Faust <italic>et al.</italic> (2015)</xref> lists a series of observations regarding temporal changes in the microbiome that are particularly relevant to the work we report here. First, microbial diversity tends to be stable over time in the same environment. Second, microbial communities evolve through stable states that change due to (i) external perturbations (e.g. diet), (ii) direct modifications (e.g. antibiotics, probiotics) or (iii) transient perturbations (e.g. microbial interactions). Third, subsequent to a perturbation, the community may return to its original state, or may remain in the new (or another) state. Finally, those communities exhibit a priority effect, where the existence of certain strains will prevent specific other taxa from establishing themselves in a community. These observations are encouraging, in that they suggest that it should be possible to build predictive state-change models. Moreover, they reveal that not all state-changes are possible, thus indicating that a desired state-change might require sequential, planned interventions.</p>
    <p>There are few large, publicly available longitudinal metagenomics datasets that could be used to design such models. Most datasets span short periods of time (weeks), though some span several years. Most studies are focused on the human gut, but unfortunately, they seldom include longitudinal metadata (i.e. possible perturbations) associated with each sample. <xref rid="bty562-B26" ref-type="bibr">Gibbons <italic>et al.</italic> (2017)</xref> suggested that current time series metagenomics datasets are not rich enough to be used to explain population dynamics. <xref rid="bty562-B27" ref-type="bibr">Gilbert <italic>et al.</italic> (2016)</xref> analysed which sampling frequency would be required in a microbiome time series to capture the microbiota dynamics with sufficient detail to be applied in medicine, concluding that it is an open problem. Nevertheless, there have been attempts at modelling microbiome dynamics. Lotka–Volterra (LV) models were the first to predict changes in community composition only based on pairwise microbial interactions (<xref rid="bty562-B37" ref-type="bibr">Stein <italic>et al.</italic>, 2013</xref>), with some posterior improvements based on generalized LV (<xref rid="bty562-B12" ref-type="bibr">Cao <italic>et al.</italic>, 2017</xref>). State transition diagrams have also appeared in some temporal dynamics metagenomics studies (<xref rid="bty562-B18" ref-type="bibr">Ding and Schloss, 2014</xref>; <xref rid="bty562-B24" ref-type="bibr">Gajer <italic>et al.</italic>, 2012</xref>). These, however, do not specify the role of distinct perturbations.</p>
    <p>Tools that could be applied to investigating microbiomes are usually not suited to longitudinal datasets; other tools are specialized for generic time series, not taking biological peculiarities into account thus limiting their applicability to metagenomics data; and finally others are focused on microarray analyses, which is a distinct problem from that of metagenomics [see descriptions in (<xref rid="bty562-B1" ref-type="bibr">Baksi <italic>et al.</italic>, 2018</xref>)]. MDSINE (<xref rid="bty562-B9" ref-type="bibr">Bucci <italic>et al.</italic>, 2016</xref>) is the tool most-adapted for time-series microbiome data. MDSINE includes time-series based algorithms, predicting microbe concentrations, interaction networks and stable states in perturbed and unperturbed populations. MDSINE is complementary to the work described here for several reasons: (i) MDSINE does not present a transition model between states; (ii) MDSINE results are not perturbation-focused, only considering a yes/no perturbation over time and (iii) MDSINE utilizes Maximum-Likelihood and Bayesian algorithms, compared to the Markovian algorithms employed in this work. Additional discussion regarding MDSINE is available in <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref>. <xref rid="bty562-B31" ref-type="bibr">Martí <italic>et al.</italic> (2017)</xref> analysed variability in the microbiome, and also predicted microbiome transitions. Our work differs, however, in that: (i) we utilize a data-driven approach, versus their parametrized mathematical model; (ii) their work was focused exclusively on human gut, whereas our approach has a wider application range and (iii) the objectives of their work were to differentiate healthy and disease states, whereas the work presented here is focused on the effects of perturbations, and estimating the resulting state transitions. Finally, TIME (<xref rid="bty562-B1" ref-type="bibr">Baksi <italic>et al.</italic>, 2018</xref>) is a microbiome time series visualization tool that interactively allows biologists to show variations in terms of different metrics (such as diversity, abundance or stability). This, again, is distinct from the work presented here in that we aim to suggest consequential interventions, rather than simply observe temporal changes.</p>
    <p>Markov Decision Processes (MDPs) have a history of use in medicine, for example, suggesting course-of-treatment within clinical decision support systems (<xref rid="bty562-B13" ref-type="bibr">Capan <italic>et al.</italic>, 2017</xref>; <xref rid="bty562-B36" ref-type="bibr">Sonnenberg and Beck, 1993</xref>). Here, we apply MDPs in a novel approach to the analysis of microbiome dynamics, and decision-support regarding directed interventions aimed at microbiome engineering.</p>
  </sec>
  <sec>
    <title>2 System and methods</title>
    <sec>
      <title>2.1 MDPbiome</title>
      <p><xref ref-type="fig" rid="bty562-F1">Figure 1</xref> outlines our proposed solution, the MDPbiome system. We represent microbiome time series as a state transition diagram with actions, and solve the MDP to determine the optimal strategy of sequential interventions that will lead the microbiome to a goal state.</p>
      <fig id="bty562-F1" orientation="portrait" position="float">
        <label>Fig. 1.</label>
        <caption>
          <p>MDPbiome general schema for identifying a temporal sequence of microbiome states, influenced by perturbations, and how this may be employed to suggest a temporal sequence of actions aimed at achieving a defined goal</p>
        </caption>
        <graphic xlink:href="bty562f1"/>
      </fig>
      <p>The input to MDPbiome are time series of microbiome data (see <xref ref-type="fig" rid="bty562-F1">Fig. 1</xref>, top), where each series corresponds to a different subject (e.g. an individual patient). Each time point in the series is a microbiome sample, represented by an Operational Taxonomic Unit (OTU) vector. The number of time points and frequency of sampling may differ between subjects. Each transition between two time points is labelled with an external perturbation that occurred in that interval, such as some specific dietary intake, drug, probiotic treatment, etc. MDPbiome then presumes that this perturbation is causative of any composition change between those time points.</p>
      <p>To create an MDP, we convert the time series of OTU vectors to a time series of microbiome states, preserving the transitions labelled with actions, and where each state is a group of microbiome samples. Next, from the time series of microbiome states, we obtain a transition probability table for each perturbation (<xref ref-type="fig" rid="bty562-F1">Fig. 1</xref>, bottom left), and represent this as a transition diagram, labelling each transition with an action and its frequency. Finally, we apply an MDP solver to identify the optimal policy, i.e. a path to the goal state through the transition diagram (<xref ref-type="fig" rid="bty562-F1">Fig. 1</xref>, bottom right).</p>
      <p>We have implemented this workflow in a system called MDPbiome. In addition to the optimal policy, the system provides a set of quality control and visualization outputs, including evaluation of the policy reliability, and set of diagrams and graphs for visual analysis and interpretation of MDP elements and their related microbial data.</p>
    </sec>
    <sec>
      <title>2.2 Markov decision process (MDP)</title>
      <p>Markov Processes describe systems with stochastic transitions between discrete-time states. MDP extends Markov processes, including at each time step a decision point where an ‘agent’ can choose from a set of actions. Even though these actions might have stochastic effects, the model considers that these decisions affect the dynamics for transiting between states (<xref rid="bty562-B4" ref-type="bibr">Bellman, 1957</xref>; <xref rid="bty562-B29" ref-type="bibr">Howard, 1960</xref>; <xref rid="bty562-B34" ref-type="bibr">Puterman, 1994</xref>). In a basic Markov Process, the probability of the transitions between states are defined in a bi-dimensional square state-matrix. In an MDP, actions are an added dimension to the matrix. An MDP is formally defined as a tuple <inline-formula><mml:math id="IM1"><mml:mrow><mml:mo>〈</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">A</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">R</mml:mi><mml:mo>〉</mml:mo></mml:mrow></mml:math></inline-formula>, where:
<list list-type="bullet"><list-item><p><inline-formula><mml:math id="IM2"><mml:mi mathvariant="script">S</mml:mi></mml:math></inline-formula> is a set of finite states</p></list-item><list-item><p><inline-formula><mml:math id="IM3"><mml:mi mathvariant="script">A</mml:mi></mml:math></inline-formula> is a set of finite actions</p></list-item><list-item><p><inline-formula><mml:math id="IM4"><mml:mrow><mml:mi mathvariant="script">T</mml:mi><mml:mo>:</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo>×</mml:mo><mml:mi mathvariant="script">A</mml:mi><mml:mo>→</mml:mo><mml:mi mathvariant="script">P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="script">P</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mo>∀</mml:mo><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo>,</mml:mo><mml:mo>∀</mml:mo><mml:mi>a</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="IM5"><mml:mrow><mml:mi mathvariant="script">R</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>→</mml:mo><mml:mi>ℜ</mml:mi></mml:mrow></mml:math></inline-formula></p></list-item></list></p>
      <p><inline-formula><mml:math id="IM6"><mml:mrow><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></inline-formula> corresponds to the transition table that accounts for the probability of going from <italic>s<sub>t</sub></italic> to <italic>s<sub>t</sub></italic><sub>+1</sub> in the next time slot, given action <italic>a</italic> has been applied. <inline-formula><mml:math id="IM7"><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow></mml:math></inline-formula> is the reward function, which represents how ‘good’ a state <italic>s</italic> is. <inline-formula><mml:math id="IM8"><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:math></inline-formula> solution to an MDP is a policy (<inline-formula><mml:math id="IM9"><mml:mrow><mml:mi>π</mml:mi><mml:mo>:</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo>→</mml:mo><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:math></inline-formula>), i.e. a mapping from states into actions that is used as the basis for decision making. The optimal policy <inline-formula><mml:math id="IM10"><mml:mrow><mml:msup><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> for an MDP is the policy that maximizes the expected sum of rewards. The optimal policy is usually computed with a dynamic programming algorithm such as value iteration or policy iteration (<xref rid="bty562-B4" ref-type="bibr">Bellman, 1957</xref>; <xref rid="bty562-B29" ref-type="bibr">Howard, 1960</xref>).</p>
    </sec>
    <sec>
      <title>2.3 MDP for longitudinal metagenomics</title>
      <p>In our approach we represent longitudinal metagenomics with perturbations as a generic <inline-formula><mml:math id="IM11"><mml:mrow><mml:mi mathvariant="script">MDP</mml:mi><mml:mo>=</mml:mo><mml:mo>〈</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">A</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">R</mml:mi><mml:mo>〉</mml:mo></mml:mrow></mml:math></inline-formula>. This involves adequately defining the four elements of the MDP, then solving it to obtain the optimal policy.</p>
      <sec>
        <title><italic>2.3.1</italic> Step 1: Pre-processing microbiome data</title>
        <p>Metagenomics pre-processing steps are necessary, but not standardized, and differ between laboratories. In this work, pre-processing is applied to the OTU table following the methodology described in <xref rid="bty562-B17" ref-type="bibr">David <italic>et al.</italic> (2014)</xref>, for longitudinal microbiomes. It involves removing OTUs not present in any samples (i.e. whose sum is 0), from other body sites, other donors, etc.; removing samples due to suspicion of experimental noise or contamination (as defined per experimental procedure); removing samples with low read-counts (&lt;10 000); and normalizing the OTUs. For more details about pre-processing and normalization, see <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> or <xref rid="bty562-B17" ref-type="bibr">David <italic>et al.</italic> (2014)</xref>.</p>
      </sec>
      <sec>
        <title><italic>2.3.2</italic> Step 2: Defining MDP states</title>
        <p>The states considered by MDPbiome could be defined using any existing pre-definition of states (e.g. stages of treatment) or in the absence of an external definition, we utilize our own algorithm for robust clustering of OTU vectors based on the similarity of their microbial abundance composition (<xref rid="bty562-B25" ref-type="bibr">García-Jiménez and Wilkinson, 2018</xref>).</p>
        <p>Though, clearly, microbial populations would evolve in a continuous manner, a discretization approach is a plausible simplification that makes modelling analysis viable. Many non-discrete processes (including biological ones) are studied with discrete computational and mathematical models (<xref rid="bty562-B20" ref-type="bibr">Faust and Raes, 2012</xref>; <xref rid="bty562-B21" ref-type="bibr">Faust <italic>et al.</italic>, 2015</xref>), and we do so here when defining states. It is important to note, however, that our defined MDP microbiome states are not synonymous with the concept of ‘enterotypes’, where the latter concept is limited to the gut microbiome, is highly controversial, and ill-defined (<xref rid="bty562-B16" ref-type="bibr">Costea <italic>et al.</italic>, 2018</xref>). Rather the states we describe here could appear within a single enterotype, and/or within any microbiome in any cavity or niche/environment. <xref rid="bty562-B28" ref-type="bibr">Gonze <italic>et al.</italic> (2017)</xref> proposed multi-stability as a reason for the existence of different states. <xref rid="bty562-B16" ref-type="bibr">Costea <italic>et al.</italic> (2018)</xref> concludes that ‘clustering can provide useful insights into some microbiome datasets, even when not strongly supported statistically’. Further supporting our definition of states in MDPbiome, <xref rid="bty562-B7" ref-type="bibr">Brooks <italic>et al.</italic> (2017)</xref> demonstrated there are no significant differences among distinct clustering schemas in terms of preserving the patterns of transitions in community state types in the vaginal microbiome; and <xref rid="bty562-B39" ref-type="bibr">Turroni <italic>et al.</italic> (2017)</xref> determined the existence of ‘shifting between different steady states’ in human gut microbiota dynamics of astronauts. See <xref rid="bty562-B25" ref-type="bibr">García-Jiménez and Wilkinson (2018)</xref> for additional discussion of discrete states in microbiomes.</p>
      </sec>
      <sec>
        <title><italic>2.3.3</italic> Step 3: Defining MDP actions</title>
        <p>Having controllable perturbations as part of the model enables decision-making points to guide microbiome towards a desired goal state. The definition of what constitutes an ‘action’ (i.e. different values of a perturbation) depends on the particular experimental question. Briefly, actions can be binary, for instance, sexual practices (see Section 2.5.2); nominal, for example, salmonella vaccine and probiotic combined treatments in chicks (see Section 3.4); or numerical after discretizing, such as breast milk intake in infant gut (see Section 2.5.3). Since the set of actions in an MDP must be finite, we must discretize any continuous values in perturbations. We represent and solve a different MDP for each perturbation. Even though concurrent perturbations might not be independent in reality, this is a practical approximation, given that usually there is insufficient data to build an MDP that models combined actions. For few perturbations, we build set <inline-formula><mml:math id="IM12"><mml:mtext>A</mml:mtext></mml:math></inline-formula> as the cartesian product of the actions in the single perturbations. This alternative makes sense when there are a reasonable number of transitions for each combined action as discussed in Section 3.4.</p>
      </sec>
      <sec>
        <title><italic>2.3.4</italic> Step 4: Defining MDP transitions</title>
        <p>We model the transition table <inline-formula><mml:math id="IM13"><mml:mtext>T</mml:mtext></mml:math></inline-formula> as a set of multinomial distributions that are estimated from the transitions observed in the available data. For each perturbation and subject, we split the metagenomics time series into triples <inline-formula><mml:math id="IM14"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> that corresponds to an observation where the microbiome was in <italic>s<sub>i</sub></italic> and reached state <inline-formula><mml:math id="IM15"><mml:mrow><mml:mi>s</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> under the effects of action <italic>a<sub>j</sub>.</italic> Thus, probabilities of reaching a particular state is estimated as
<disp-formula><mml:math id="M1"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mtext>S</mml:mtext><mml:mo>|</mml:mo></mml:mrow></mml:msubsup><mml:mi>c</mml:mi></mml:mstyle><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>
where the counts correspond to number of times the triples occur in the whole set of samples.</p>
      </sec>
      <sec>
        <title><italic>2.3.5</italic> Step 5: Defining MDP goal states</title>
        <p>Our reward modelling only depends on states. MDPbiome defines two reward schemas to construct reward functions focused on either pursuing a desirable ‘goal’ state(s) or avoiding an undesirable ‘bad’ state(s). As input, the system needs a utility vector <inline-formula><mml:math id="IM16"><mml:mrow><mml:mi mathvariant="script">U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>S</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> that establishes a numerical state preference. The schemas are defined as follows
<disp-formula><mml:math id="M2"><mml:mtable><mml:mtr><mml:mtd><mml:maligngroup/><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>B</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:malignmark/><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>U</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mtext>S</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:maligngroup/><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>¬</mml:mo><mml:mi>W</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:malignmark/><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mo>∀</mml:mo><mml:mi>s</mml:mi><mml:mo>|</mml:mo><mml:mi>s</mml:mi><mml:mo>≠</mml:mo><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>U</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mtext>S</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
having <inline-formula><mml:math id="IM17"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> for any other case not holding the condition. <inline-formula><mml:math id="IM18"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>B</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> will guide the policy towards the best state, and <inline-formula><mml:math id="IM19"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>¬</mml:mo><mml:mi>W</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> will guide decisions to avoid the worst state. Given that deciding the goal standard is not trivial for many domains, MDPbiome offers a default behaviour in which <inline-formula><mml:math id="IM20"><mml:mrow><mml:mi mathvariant="script">U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>S</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is set to alpha diversity (<italic>α<sub>div</sub></italic>) average of the microbiome samples belonging to each state. In this case, for instance, <inline-formula><mml:math id="IM21"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>B</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> will lead to policies that pursue the highest diversity microbiome state.</p>
      </sec>
      <sec>
        <title><italic>2.3.6</italic> Step 6: Solving the microbiome MDP</title>
        <p>Solving an MDP consists of finding an optimal policy <inline-formula><mml:math id="IM22"><mml:mrow><mml:msup><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> that maximizes the cumulative expected reward for any given state. Here we apply the algorithm value iteration, a dynamic programming algorithm used to find policies for MDP with indefinite horizon. Our implementation uses the <italic>MDPtoolbox</italic> (<xref rid="bty562-B14" ref-type="bibr">Chadès <italic>et al.</italic>, 2014</xref>) R package as the base solver.</p>
      </sec>
    </sec>
    <sec>
      <title>2.4 Evaluation technique</title>
      <p>The state transition probabilities in our MDP models are estimated from the transition counts of the observed data. Thus, we consider it necessary to employ two evaluation procedures to measure how reliable the policies are. First we evaluate the stability of the resulting optimal policy given the uncertainty in the input data, specially under infrequent observed transitions. Then, in addition, we evaluate if the policies are general or particular amongst individuals.</p>
      <sec>
        <title><italic>2.4.1</italic> Sensitivity analysis on input data</title>
        <p>We apply a sensitivity analysis on the estimated transition probabilities to measure the stability of the optimal policy, similar to (<xref rid="bty562-B15" ref-type="bibr">Chen <italic>et al.</italic>, 2017</xref>) but for an indefinite horizon for MDPs. The uncertainty of multinomial estimates is frequently modelled using the Dirichlet distribution with hyper-parameters that coincide with the observed transition counts (<xref rid="bty562-B38" ref-type="bibr">Tetreault <italic>et al.</italic>, 2007</xref>). Our evaluation procedure consists of generating 1000 transition tables <inline-formula><mml:math id="IM23"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="script">T</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> by sampling from the Dirichlet distributions corresponding to the observed transition counts. Each <inline-formula><mml:math id="IM24"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="script">T</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is used to compute an optimal policy with value iteration. Finally we compute the ratio of actions that remain the same as in the original optimal policy. The higher the ratio, the more stable the optimal policy will be. We also compute the stability ratio of each individual action to identify if there are particular states in which one action should have a clear preference over the others to induce a microbiome state change.</p>
      </sec>
      <sec>
        <title><italic>2.4.2</italic> Policy generality amongst subjects</title>
        <p>To make the most of the available data we perform a leave-<italic>one</italic>-out cross-validation (LOOCV). Given a dataset of <italic>n</italic> subjects, the procedure iterates <italic>n</italic> times, considering at each iteration <italic>i</italic>, all samples except those of subject <italic>i.</italic> Thus, each subject can be associated to an optimal policy <inline-formula><mml:math id="IM25"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> computed with data not related to this subject. To measure the performance, we get from each subject time series, the set of transitions (<inline-formula><mml:math id="IM26"><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula>) and then compute the number of transitions that lead to the same or better state (i.e. <inline-formula><mml:math id="IM27"><mml:mrow><mml:mi mathvariant="script">U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>≥</mml:mo><mml:mi mathvariant="script">U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo>′</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>) when the policy is applied in <italic>s</italic> and when is not. If the frequency of ‘good’ transitions following the policy is higher than when not following the policy we can infer that the policies are changing the <italic>a priori</italic> probability of these transitions and therefore they are general enough to be applied to out-of-sample individuals. As in the reward function, the <italic>α<sub>div</sub></italic> of clusters is used as the utility function when an alternative sorting criteria is not provided.</p>
      </sec>
    </sec>
    <sec>
      <title>2.5 Datasets</title>
      <p>Few public longitudinal microbiome datasets include sufficiently frequent sampling and associated meta-data to allow perturbation studies. <xref rid="bty562-T1" ref-type="table">Table 1</xref> summarizes the characteristics of each dataset for which our MDPbiome system could be applied, as the next subsections explain.
<table-wrap id="bty562-T1" orientation="portrait" position="float"><label>Table 1.</label><caption><p>Longitudinal microbiome datasets modelled as MDP</p></caption><table frame="hsides" rules="groups"><thead align="center"><tr><th align="left" rowspan="1" colspan="1">Ecosystem</th><th rowspan="1" colspan="1">Chick gut</th><th rowspan="1" colspan="1">Vaginal</th><th rowspan="1" colspan="1">Infant gut</th></tr></thead><tbody align="center"><tr><td align="left" rowspan="1" colspan="1">References</td><td align="center" rowspan="1" colspan="1"><xref rid="bty562-B2" ref-type="bibr">Ballou (2016)</xref></td><td align="center" rowspan="1" colspan="1"><xref rid="bty562-B24" ref-type="bibr">Gajer (2012)</xref></td><td align="center" rowspan="1" colspan="1"><xref rid="bty562-B30" ref-type="bibr">LaRosa (2014)</xref></td></tr><tr><td align="left" rowspan="1" colspan="1">No. samples</td><td rowspan="1" colspan="1">119</td><td rowspan="1" colspan="1">937</td><td rowspan="1" colspan="1">922</td></tr><tr><td align="left" rowspan="1" colspan="1">No. taxa</td><td rowspan="1" colspan="1">1583</td><td rowspan="1" colspan="1">298</td><td rowspan="1" colspan="1">29</td></tr><tr><td align="left" rowspan="1" colspan="1">No. subjects</td><td rowspan="1" colspan="1">24</td><td rowspan="1" colspan="1">32</td><td rowspan="1" colspan="1">58</td></tr><tr><td align="left" rowspan="1" colspan="1">Time points</td><td rowspan="1" colspan="1">6 in 4 weeks</td><td rowspan="1" colspan="1">2 × 16 weeks</td><td rowspan="1" colspan="1">Different</td></tr><tr><td align="left" rowspan="1" colspan="1">MDP.<inline-formula><mml:math id="IM28"><mml:mi mathvariant="script">S</mml:mi></mml:math></inline-formula></td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">4</td></tr><tr><td align="left" rowspan="1" colspan="1">MDP.<inline-formula><mml:math id="IM29"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula></td><td rowspan="1" colspan="1">{salmonella, probiotics}</td><td rowspan="1" colspan="1">sexual practices {oral, toy,<inline-formula><mml:math id="IM30"><mml:mo>…</mml:mo></mml:math></inline-formula>}</td><td rowspan="1" colspan="1">{breast-milk, antibiotics}</td></tr><tr><td align="left" rowspan="1" colspan="1">MDP.<inline-formula><mml:math id="IM31"><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula></td><td rowspan="1" colspan="1">94</td><td rowspan="1" colspan="1">905</td><td rowspan="1" colspan="1">893</td></tr><tr><td align="left" rowspan="1" colspan="1"><inline-formula><mml:math id="IM32"><mml:mi mathvariant="script">U</mml:mi></mml:math></inline-formula>, MDP.<inline-formula><mml:math id="IM33"><mml:mi mathvariant="script">R</mml:mi></mml:math></inline-formula></td><td rowspan="1" colspan="1">Mature chick</td><td rowspan="1" colspan="1">Not bacterial vaginosis</td><td rowspan="1" colspan="1">Highest <italic>α<sub>div</sub></italic></td></tr></tbody></table></table-wrap></p>
      <sec>
        <title><italic>2.5.1</italic> Chick gut microbiome</title>
        <p><xref rid="bty562-B2" ref-type="bibr">Ballou <italic>et al.</italic> (2016)</xref> studied the response of different treatments (Salmonella vaccine and/or probiotics) in the chick gut, during their first month of life. The data was downloaded from the Qiita repository (<ext-link ext-link-type="uri" xlink:href="http://qiita.ucsd.edu"><italic>http://qiita.ucsd.edu</italic></ext-link> study no.10291). The actions <inline-formula><mml:math id="IM34"><mml:mtext>A</mml:mtext></mml:math></inline-formula> are Salmonella vaccine (s) versus control (c); and probiotic supplement (0.1% Primalac) (p) versus (c). The control (c) is the lack of vaccine or probiotics, respectively. Salmonella vaccine was given at the outset of the study, prior to the day 0 sampling, and we consider the effect of the vaccine to remain throughout the time series. Probiotic was mixed with food on every day of the experiment. Thus, the action is the same for the same subject in its time series.</p>
      </sec>
      <sec>
        <title><italic>2.5.2</italic> Vaginal microbiome</title>
        <p><xref rid="bty562-B24" ref-type="bibr">Gajer <italic>et al.</italic> (2012)</xref> analyzed the dynamics of the vaginal microbiome taking samples from 32 women over several weeks. The OTU table and the clusters come from their supplementary Table S2 (<xref rid="bty562-B24" ref-type="bibr">Gajer <italic>et al.</italic>, 2012</xref>). The data counts were pre-processed, and normalized to a sum of 100 per sample, thus representing relative abundances. As such, we did not apply our pre-processing step to this dataset.</p>
        <p>The actions set <inline-formula><mml:math id="IM35"><mml:mtext>A</mml:mtext></mml:math></inline-formula> was composed by the available meta-data related to the hygienic and sex activities that could perturb the vaginal microbiome (<inline-formula><mml:math id="IM36"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula><italic> = {Yes, No}</italic> x {anal sex, digital penetration, douching, lubricant, oral sex, sex toy, tampon, vaginal intercourse}). As MDP states, we take community state types defined by the original study authors (<inline-formula><mml:math id="IM37"><mml:mi mathvariant="script">S</mml:mi></mml:math></inline-formula><italic> = {I, II, III, IV-A, IV-B}</italic>). The IV-B group concentrates most of the high and intermediate Nugent categories indicating the greatest risk for the Bacterial Vaginosis disease (<xref rid="bty562-B32" ref-type="bibr">Nugent <italic>et al.</italic>, 1991</xref>). The preferred reward schema in this scenario is <inline-formula><mml:math id="IM38"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>¬</mml:mo><mml:mi>W</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, focused on avoiding a non-desired state related to bacterial vaginosis. Therefore, we take the inverse of the average Nugent score per state as utility function <inline-formula><mml:math id="IM39"><mml:mrow><mml:mi mathvariant="script">U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      </sec>
      <sec>
        <title><italic>2.5.3</italic> Infant gut microbiome</title>
        <p>The <xref rid="bty562-B30" ref-type="bibr">La Rosa <italic>et al.</italic> (2014)</xref> dataset includes 58 pre-term babies who were stool-sampled at variable time points until a month and a half. The meta-data provides us with two different perturbations: amount of breast milk volume and antibiotic use. The first one is provided as 4 discretized values (<italic>0%, low: &lt;10%, med: 10<italic>–</italic>50%, high: &gt;50%</italic> of enteral volume). The samples for 0% of volume represent &lt;2% of the total samples, thus we merged this category with <italic>low: &lt;10%.</italic> The second perturbation corresponds to antibiotics administration in the last 3 days (yes, no). We used <italic>α<sub>div</sub></italic> as the utility function and evaluate both reward schemas.</p>
      </sec>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>The following sections describe the most informative results of the application of our MDPbiome system to the three datasets. The complete set of MDPbiome outputs (text and figures) for all datasets and all configurations are available at <ext-link ext-link-type="uri" xlink:href="https://tomdelarosa.shinyapps.io/mdpbiome/"><italic>https://tomdelarosa.shinyapps.io/mdpbiome/</italic></ext-link>.</p>
    <sec>
      <title>3.1 General results</title>
      <sec>
        <title><italic>3.1.1</italic> Chick gut microbiome</title>
        <p><xref rid="bty562-B2" ref-type="bibr">Ballou <italic>et al.</italic> (2016)</xref> indicated there were no differences in the health of the chicks at the end of the study. Therefore, lacking additional domain knowledge, we defined the MDP states following our robust clustering procedure (<xref rid="bty562-B25" ref-type="bibr">García-Jiménez and Wilkinson, 2018</xref>). From this, we observed that the states primarily mirror the chicks’ age (i.e. sampling day): there is one state (called <italic>birth</italic>) with samples from chicks in their first days of life (mainly, day 0–3), and another state (<italic>mature</italic>) with microbiomes of all the chicks aged 2 or more weeks (mainly day 14 and 28). This split according to age is in agreement with the Ballou <italic>et al.</italic> analysis, where samples do not differ by any other criteria, including the experimental conditions (vaccine/probiotics). Both states contains samples from all treatments. The mature state is much more diverse than the birth state with respect to microbial composition (mean <italic>α<sub>div</sub></italic>: 3.29 ≫ 1.40). Moreover, setting the highest diversity as the goal brings our chick MDPbiome model into agreement with child microbiome evolution studies (<xref rid="bty562-B19" ref-type="bibr">Dominguez-Bello <italic>et al.</italic>, 2011</xref>; <xref rid="bty562-B33" ref-type="bibr">Oakley <italic>et al.</italic>, 2014</xref>), which begin with an empty or very low-diversity microbiome (such as our <italic>birth</italic> state), while achieving maximum diversity in adulthood (our <italic>mature</italic> state).</p>
        <p><xref ref-type="fig" rid="bty562-F2">Figure 2</xref> shows how to engineer the chick gut microbiome with salmonella vaccine (left) and probiotics (right) as perturbations. In the case of salmonella, the recommendation is to administer the vaccine to reach the mature state, with a very high stability (see dark blue bar in <xref ref-type="fig" rid="bty562-F2">Fig. 2</xref>, left). When the perturbation is probiotics, the highest probability to reach the goal state is ‘c’ (no probiotics) (see 0.41 &gt; 0.38 in diagram) also with a stability higher than the alternative action of ‘p’ (red bar larger than the blue one). In the mature state, with both perturbations, all actions have the same probability (1) to maintain that state, because chick microbiomes do not return to a less diverse state post-maturation.</p>
        <fig id="bty562-F2" orientation="portrait" position="float">
          <label>Fig. 2.</label>
          <caption>
            <p>MDP diagrams with optimal policy and barplots with stability ratio per state and perturbation to chick gut microbiomes. In the diagram, red arrows represent the MDP solution; and the goal state is that highlighted in red. In the barplots, strong colors represent the optimal policy and faint colors the non-optimal ones. The <italic>s(p)/c</italic> actions mean salmonella vaccine(probiotics) yes/no (c, control), respectively</p>
          </caption>
          <graphic xlink:href="bty562f2"/>
        </fig>
        <p>In conclusion, the preferred policy is to administer salmonella vaccine to accelerate maturation; and not to feed with probiotics (although the policy regarding probiotics is less conclusive).</p>
      </sec>
      <sec>
        <title><italic>3.1.2</italic> Vaginal microbiome</title>
        <p>This scenario differs from the other datasets in that most states are considered ‘healthy’, thus the preferred goal is avoidance of a disease state. As Section 2.5 describes, state IV-B was identified as the non-desired state, and the MDP was designed to provide a policy in which the path is the (series of) action(s) that minimize the risk of reaching it.</p>
        <p>As a general overview, all states except IV-A have &gt;85% likelihood of remaining in the same state, regardless of action. Therefore, the most common model-behaviour is to maintain the same state, regardless of perturbation and state-to-state transitions are less frequent. MDPbiome transition diagrams (see <italic>shinyapp</italic> online) show a high degree of maintenance of the disease state IV-B, suggesting that is clearly difficult to escape from it without specific medical intervention.</p>
        <p><xref ref-type="fig" rid="bty562-F3">Figure 3</xref>A shows the optimal policy and its stability per state (each of the five columns represents a state) and perturbation (eight graphs, one for each perturbation) of the vaginal microbiome. Here, we focus our analysis on the last column of each plot, corresponding to the state to avoid with <inline-formula><mml:math id="IM40"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>¬</mml:mo><mml:mi>W</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. The top row collects the perturbations where the optimal policy is ‘perturbation-no’, in decreasing order, so lubricant and sex toy are not recommended to recover from bacterial vaginosis, with high stability. However, anal sex-no does not evince enough stability to be considered a strong policy to follow. These results are in agreement with <xref rid="bty562-B8" ref-type="bibr">Brotman <italic>et al.</italic> (2010)</xref>, who identified several ‘risk factors’ for bacterial vaginosis, including the use of a lubricant and rectal sex.</p>
        <fig id="bty562-F3" orientation="portrait" position="float">
          <label>Fig. 3.</label>
          <caption>
            <p>MDPbiome recommendations to reach the defined goal, in terms of stability ratio of the optimal policy of single perturbations given each particular state. (<bold>A</bold>) Goal = avoid bacterial vaginosis. (<bold>B</bold>) Goal = highest <italic>α<sub>div</sub>.</italic> (A and B) Each independent graph represents an external perturbation that could influence the vaginal or infant gut microbiome, respectively. Columns represent the microbiome states. Stronger colors represent the optimal policy and faint colors the non-optimal ones. Red bars correspond to ‘no’ and blue ones to ‘yes’, with the exception of breast milk which is discretized into three categories</p>
          </caption>
          <graphic xlink:href="bty562f3"/>
        </fig>
      </sec>
      <sec>
        <title><italic>3.1.3</italic> Infant gut microbiome</title>
        <p>In the absence of domain knowledge, we again defined the MDP states applying our robust clustering procedure. Characterizing the four identified states, all have a very low <italic>α<sub>div</sub></italic> (&lt;1), which is consistent with the newborn origin, where the gut microbiome is beginning to be populated. This diversity measure is the only available information to define the goal state as being the highest <italic>α<sub>div</sub></italic> state in <inline-formula><mml:math id="IM41"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>B</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> rewards (state no.1, <italic>α</italic> = 0.85) and the lowest one in <inline-formula><mml:math id="IM42"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>¬</mml:mo><mml:mi>W</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (state no.4, <italic>α</italic> = 0.35).</p>
        <p>State 1 is mainly composed by Clostridia, state 2 by Gammaproteobacteria, 3 by Bacilli and 4 by Bacteroidia. According to <xref rid="bty562-B30" ref-type="bibr">La Rosa <italic>et al.</italic> (2014)</xref>, each subject should follow the sequence Bacilli (3) → Gammaproteobacteria (2) → Clostridia (1). State 4 could correspond to outliers, because it only includes samples from two infants taking &gt;50<italic>%</italic> of breast milk.</p>
        <p>The most relevant conclusions in the infant gut microbiome are that, to preserve the most diverse state and the final one in the maturation sequence (state 1), <italic>no</italic> antibiotics should be administered, with the stability of this recommendation higher than 90% (see large red bar in <xref ref-type="fig" rid="bty562-F3">Fig. 3</xref>B, top). However, regarding milk intake the stabilities are less conclusive. These observations are in-agreement with studies indicating that antibiotics cause much more disturbance in microbiomes than dietary interventions (<xref rid="bty562-B16" ref-type="bibr">Costea <italic>et al.</italic>, 2018</xref>).</p>
      </sec>
    </sec>
    <sec>
      <title>3.2 Evaluating policy stability</title>
      <p><xref rid="bty562-T2" ref-type="table">Table 2</xref> shows the stability ratio (see Section 2.4.1) for the optimal policies per different dataset, perturbation and reward schema. This ratio computes, in terms of actions, the similarity that the policies obtained with transition tables from the Dirichlet sampling would have with the optimal policy computed with the original probability estimates. This aggregated value can be seen as a measure of the reliability of the MDPbiome policy. In terms of microbiome engineering, it means how invariant the recommendation for applying a particular perturbation would be. Although there are differences between datasets, perturbations and rewards, most values are in a 60–85% range, showing MDPbiome suggestions achieve high stability along multiple distinct cases. The minimum threshold of stability depends on the number of values of each perturbation (<inline-formula><mml:math id="IM43"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mtext>A</mml:mtext><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>), with 50% for yes/no perturbations and lower for perturbations with &gt;2 values, such as the combined treatments in infant gut microbiome, where even 26% stability is greater than choosing a random policy (<inline-formula><mml:math id="IM44"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>6</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>). In the chick gut dataset, <inline-formula><mml:math id="IM45"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is equivalent to <inline-formula><mml:math id="IM46"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>¬</mml:mo><mml:mi>W</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> because there are only two states. The differences in this case are due to sampling and therefore negligible.
<table-wrap id="bty562-T2" orientation="portrait" position="float"><label>Table 2.</label><caption><p>Aggregated optimal policy stability ratio for perturbations</p></caption><table frame="hsides" rules="groups"><tbody align="left"><tr><td colspan="2" rowspan="1"><bold>Chick gut</bold></td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><inline-formula><mml:math id="IM47"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula></td><td rowspan="1" colspan="1"><inline-formula><mml:math id="IM48"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>¬</mml:mo><mml:mi>W</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula></td></tr><tr><td rowspan="1" colspan="1">Salmonella</td><td rowspan="1" colspan="1">0.68</td><td rowspan="1" colspan="1">0.78</td></tr><tr><td rowspan="1" colspan="1">Probiotic</td><td rowspan="1" colspan="1">0.59</td><td rowspan="1" colspan="1">0.60</td></tr><tr><td rowspan="1" colspan="1"><hr/>Combined</td><td rowspan="1" colspan="1"><hr/>0.48</td><td rowspan="1" colspan="1"><hr/>0.43</td></tr><tr><td colspan="2" rowspan="1"><bold>Infant gut</bold></td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><inline-formula><mml:math id="IM49"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula></td><td rowspan="1" colspan="1"><inline-formula><mml:math id="IM50"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>¬</mml:mo><mml:mi>W</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula></td></tr><tr><td rowspan="1" colspan="1">Breast milk</td><td rowspan="1" colspan="1">0.56</td><td rowspan="1" colspan="1">0.59</td></tr><tr><td rowspan="1" colspan="1">Antibiotics</td><td rowspan="1" colspan="1">0.84</td><td rowspan="1" colspan="1">0.87</td></tr><tr><td rowspan="1" colspan="1"><hr/>Combined</td><td rowspan="1" colspan="1"><hr/>0.54</td><td rowspan="1" colspan="1"><hr/>0.26</td></tr><tr><td colspan="2" rowspan="1"><bold>Vaginal</bold></td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><inline-formula><mml:math id="IM51"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula></td><td rowspan="1" colspan="1"><inline-formula><mml:math id="IM52"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>¬</mml:mo><mml:mi>W</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula></td></tr><tr><td rowspan="1" colspan="1">Anal sex</td><td rowspan="1" colspan="1">0.58</td><td rowspan="1" colspan="1">0.70</td></tr><tr><td rowspan="1" colspan="1">Digital penet.</td><td rowspan="1" colspan="1">0.77</td><td rowspan="1" colspan="1">0.79</td></tr><tr><td rowspan="1" colspan="1">Douching</td><td rowspan="1" colspan="1">0.65</td><td rowspan="1" colspan="1">0.75</td></tr><tr><td rowspan="1" colspan="1">Lubricant</td><td rowspan="1" colspan="1">0.76</td><td rowspan="1" colspan="1">0.76</td></tr><tr><td rowspan="1" colspan="1">Oral sex</td><td rowspan="1" colspan="1">0.75</td><td rowspan="1" colspan="1">0.64</td></tr><tr><td rowspan="1" colspan="1">Sex toy</td><td rowspan="1" colspan="1">0.85</td><td rowspan="1" colspan="1">0.66</td></tr><tr><td rowspan="1" colspan="1">Tampon</td><td rowspan="1" colspan="1">0.87</td><td rowspan="1" colspan="1">0.77</td></tr><tr><td rowspan="1" colspan="1">V. intercourse</td><td rowspan="1" colspan="1">0.70</td><td rowspan="1" colspan="1">0.76</td></tr></tbody></table></table-wrap></p>
      <p>A lower stability ratio often means there are too few samples for the number of distinct actions of a perturbation, and therefore the transition probability table is not reliable because of the uncertainty from the input data. In other cases, the stability ratio is affected when transitions resulting from different actions have a similar probability and associated reward. Here, small changes in the input time series could produce a change in the recommended strategy. For this reason, we consider the interpretation of the per-state stability of actions relevant, as indicated by the stability barplots (such as <xref ref-type="fig" rid="bty562-F2">Figs 2</xref> and <xref ref-type="fig" rid="bty562-F3">3</xref>).</p>
    </sec>
    <sec>
      <title>3.3 Evaluating policy universality</title>
      <p>The datasets used in our study were not originally designed for guided perturbation analyses, and had terminated prior to the initiation of our study. Therefore, there is no direct way to test policy accuracy by imposing the guidance indicated in the optimal policy on a test subject. Thus, our approximation of this ideal test procedure is, with existing data, to relate the compliance the subject has in following the policy, with the number of times the subject moves to a better, equal or worse state, compared to when the subject does not follow the policy.</p>
      <p><xref ref-type="fig" rid="bty562-F4">Figure 4</xref> shows the results for chick and infant gut datasets, and <xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S1</xref> for vaginal microbiome. The LOOCV results provides confirmation that the infant gut microbiome is quite stable regardless of perturbations (75.5%). Nevertheless, there is some evidence to support that the policies are generalizable across individuals (see <xref ref-type="fig" rid="bty562-F4">Fig. 4</xref>, right): 91.9% of the transitions for breast milk intake result in the same or in a better state (blue + green of central columns) when following the policy (F), versus 85.5% when the policy was not followed (nF).</p>
      <fig id="bty562-F4" orientation="portrait" position="float">
        <label>Fig. 4.</label>
        <caption>
          <p>Frequency of categorized transitions when following, or not, the optimal policy. F: following the MDPbiome policy, nF: not following it. Better, equal and worse state-transition is defined considering <italic>α<sub>div</sub></italic> for sorting states</p>
        </caption>
        <graphic xlink:href="bty562f4"/>
      </fig>
      <p>In the chick guts, there is no case where the microbiome gets worse (no red bar), because there are only two states and all chicks move from birth to a mature state (goal) eventually. When the perturbation is salmonella vaccine or combined, following the policy reported better results than not following it (see larger green bars in F than nF in 1st and 3rd pair of columns in <xref ref-type="fig" rid="bty562-F4">Fig. 4</xref>, left); however, when the probiotic is the single perturbation, our generality evaluation indicates that not following the policy is better.</p>
    </sec>
    <sec>
      <title>3.4 Combining actions</title>
      <p>In the chick dataset, we could merge simultaneous perturbations because the data corresponds to an exhaustive collection of all possible combinations of states and perturbations. Thus, actions go from salmonella {yes, no} and probiotics {yes, no} to one combined perturbation equivalent to the treatment with four different values {cc, cp, sc, sp}.</p>
      <p>When we combine perturbations to define the MDP actions, the aggregated stability ratio is lower than considering the perturbations independently (see <xref rid="bty562-T2" ref-type="table">Table 2</xref>); due to the reduction in the completeness of the transition table; the same transitions must fulfill a table with higher dimensions. This demonstrates that combining simultaneous perturbations in an unique MDP could be viable if there are sufficient data about all combinations of perturbations, however it could entail lower stability in the optimal policy. The MDP diagram in <xref ref-type="fig" rid="bty562-F5">Figure 5</xref> points out that ‘sc’ is the action with the highest probability to reach the mature state. The barplot in <xref ref-type="fig" rid="bty562-F5">Figure 5</xref> shows that the optimal policy in state <italic>mature</italic>, i.e. ‘cc’, is not the one with the highest stability, because regardless of the action, there is the same probability to preserve the mature state. While in the birth state, the optimal policy, and the most stable, are clearly the same: to administer salmonella vaccine, without probiotics. Therefore, we could conclude that an adult microbiome, with more diversity, is reached earlier with the salmonella vaccine treatment without probiotics.</p>
      <fig id="bty562-F5" orientation="portrait" position="float">
        <label>Fig. 5.</label>
        <caption>
          <p>MDP diagram with optimal policy and barplot with stability ratio per state and combined perturbation to chick gut microbiomes. Same legend than in <xref ref-type="fig" rid="bty562-F2">Figure 2</xref></p>
        </caption>
        <graphic xlink:href="bty562f5"/>
      </fig>
      <p>In the infant gut dataset, the two perturbations (milk and antibiotics) could also be represented as a combined perturbation with six actions to study the effect of simultaneous perturbations. In this scenario, there are many actions that split the available transitions, resulting in very few data points per action, leading to a decrease in the stability and generality of the optimal policy when a combined perturbation is considered versus the individual ones (see last column <xref rid="bty562-T2" ref-type="table">Table 2</xref> and <xref ref-type="fig" rid="bty562-F4">Fig. 4</xref>).</p>
      <p>In the vaginal microbiome it was not feasible to combine perturbations because the number of combinations (2<sup>8</sup>) is too high, resulting in many state transitions not being observed in the dataset.</p>
    </sec>
    <sec>
      <title>3.5 Re-defining states</title>
      <p>We examined the consequences of changing the MDP state definition for the same dataset. We filtered the subset of taxa (dominant, non-dominant) used by our robust clustering algorithm. We defined dominant taxa as a percentage (1% or 0.5%) of the most frequent taxa; and the complementary taxa are the non-dominant subset.</p>
      <p>In the <xref rid="bty562-B2" ref-type="bibr">Ballou <italic>et al.</italic> (2016)</xref> dataset, when all taxa are clustered, the result was two states (young and mature chicks). However, considering only non-dominant taxa at 1%, six clusters are robustly identified, grouping the chicks based on similar age. In fact, the <italic>α<sub>div</sub></italic> of these states change in parallel, increasing with the average age of the chicks in each cluster. In both clusterings (all and non-dominant 1%), a consistent MDPbiome optimal policy is preserved—to administer salmonella vaccine to reach maturation as quickly as possible—despite the total number of states being tripled. Analyzing transition probabilities in the non-dominant taxa at 1% clusters, with salmonella-yes (<xref ref-type="fig" rid="bty562-F6">Fig. 6</xref>, left), we observe transitions between non-consecutive states (see more crossing lines in the middle of left than right circle plot, such as from avg1 to avg8, avg3 to avg8 and avg8 to avg26) while with no vaccine (‘c’) the transitions are mainly sequential, meaning a slower maturation. Thus, this provides a biological explanation for how salmonella vaccine accelerate maturation that was not (and could not be) detected in the original study. In chick microbiome, it seems that the use of non-dominant species for clustering presents a higher-resolution separation of microbiome states, that nonetheless behaved in the same manner as the more coarse analysis using all taxa.</p>
      <fig id="bty562-F6" orientation="portrait" position="float">
        <label>Fig. 6.</label>
        <caption>
          <p>Chick gut microbiome state transitions when clustering non-dominant taxa at 1%, with the Salmonella vaccine perturbation. The ribbon-arrow points out the directionality of the transitions, and ribbon width represents the frequency of transition. Left circle shows the transition probabilities when the perturbation is applied, and right one when it is not. The colors represent each state, labelled with the average chick age of the samples within</p>
        </caption>
        <graphic xlink:href="bty562f6"/>
      </fig>
      <p>Nevertheless, besides useful information such as that just described, no conclusive determination could be made regarding the MPDbiome policy stability and generality when filtering data along the lines of dominant/non-dominant taxa. Comprehensive analysis of additional, larger, purpose-designed datasets will be required to derive more general conclusions.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>The MDPbiome approach has a variety of positive features. First, it can be applied to a wide diversity of datasets and external perturbations. Second, MDPbiome can evaluate multiple (&gt;2) microbiome states. As such, the more common ‘healthy’ vs ‘unhealthy’ categories in typical microbiome variability studies (<xref rid="bty562-B31" ref-type="bibr">Martí <italic>et al.</italic>, 2017</xref>) could be examined with greater granularity, with the ability to identify, for example, healthy sub-states that are nevertheless more at-risk of transitioning into an unhealthy one (e.g. state IV-A in the vaginal microbiome analysis). Third, MDPbiome allows a variety of different questions to be asked of the same dataset. For example, the MDP may be optimized to reward microbial diversity (i.e. the default behaviour), or may alternatively be set to optimize for recovery from a disease.</p>
    <p>Stability evaluation of the MDPbiome policies indicates the degree of confidence that can be attributed to these policies. Thus, we can recognize whether the number of subjects and/or variability of transitions is sufficient to cover all possible paths in the MDP diagram, and therefore derive stronger conclusions. Similarly, generality evaluation measures the predicted performance of the policies when prescribed to subjects not included in the original study.</p>
    <p>MDPbiome results may also be used for hypothesis-generation, for example, predicting interaction between the specific microbes present in two states. For example, if a transition between state <italic>Q1</italic> and <italic>Q2</italic> is defined with high probability and stability for a given perturbation <italic>x</italic>, it could mean that <italic>x</italic> might facilitate the increase of the predominant bacteria in state <italic>Q2</italic> or be a detriment to the predominant bacteria in state <italic>Q1.</italic> Moreover, state-transitions in the absence of perturbation (action-negative) may reveal patterns of competition or cooperation between the species in each state.</p>
    <p>Selection of an appropriate MDP representation of a microbiome entails careful consideration, in particular because the Markov property requires that the next state depends only on the current state and action, regardless of previous states or actions. In our temporal microbiome scenario, this might not be completely true since interventions, such as food or drug intake, may have prolonged effects that last over many observational cycles. Nevertheless, for this study we consider this simplification to be acceptable, and that in general the predictive power gained by the MDP principles is worth this potential limit or noise in its sensitivity.</p>
    <p>As with most population-based studies, the quality of the transition diagrams are highly dependent on the quality and quantity of the available data. With even a few <inline-formula><mml:math id="IM53"><mml:mo>〈</mml:mo></mml:math></inline-formula>transition, action<inline-formula><mml:math id="IM54"><mml:mo>〉</mml:mo></mml:math></inline-formula> pairs we can generate a meaningful estimation of the transition probability. However, in some cases these <inline-formula><mml:math id="IM55"><mml:mo>〈</mml:mo></mml:math></inline-formula>transition, action<inline-formula><mml:math id="IM56"><mml:mo>〉</mml:mo></mml:math></inline-formula> observations are insufficient. This prevents us from deriving even a basic MDP model, for instance in the dataset from <xref rid="bty562-B17" ref-type="bibr">David <italic>et al.</italic> (2014)</xref>, where there is a lack of annotated transitions between different states.</p>
    <p>MDPbiome obtains a policy independently for each perturbation, and for combined perturbations only when there are (i) few individual perturbations and (ii) sufficient transitions to estimate the probabilities. MDPbiome is, therefore, similar to other population-based studies, being limited by the trade-off of potential information gain from non-independent perturbations and the decrease in reliability due to sparse transitions for those combinations. Because we are not able to examine combinatorial perturbations in many cases, we are unable to assert that the application of a single external perturbation is sufficient to achieve a given state-transition; effectively, we cannot guarantee that perturbations are independent, neither in their effect, nor even in their application (i.e. two measured perturbations may usually or always occur simultaneously). Similarly, we cannot be sure that the different external perturbations that compose a combined-policy need to be applied together to achieve (or prevent) the state-transition.</p>
    <p>Despite those drawbacks, there is a clear and pressing need to predict the effects of interventions on microbiomes, both within medicine and for industrial and environmental scenarios. This paper provides, to our knowledge, the first example of a MDP being used to explain how a microbial community will respond to any given intervention. We believe this provides the basis for a wide range of directed research, in particular with respect to microbiome-engineering for health in the medical domain.</p>
    <p>Adding further flexibility in modelling will make MDPbiome a tool of interest for a wider scope of metagenomic studies. Alternative definitions of the MDP will better enable specific scenarios within future microbiome-engineering initiatives. For example, the reward function could be defined as <inline-formula><mml:math id="IM57"><mml:mrow><mml:mi mathvariant="script">R</mml:mi><mml:mo>:</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo>×</mml:mo><mml:mi mathvariant="script">A</mml:mi><mml:mo>→</mml:mo><mml:mi>ℜ</mml:mi></mml:mrow></mml:math></inline-formula> (<xref rid="bty562-B34" ref-type="bibr">Puterman, 1994</xref>), to indicate that there is a preference on reaching a state using a particular action. MDPs could be also modelled in terms of cost rather than rewards, or with cost and rewards at the same time. A cost function <inline-formula><mml:math id="IM58"><mml:mrow><mml:mi mathvariant="script">C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">A</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, could be used to represent the economic cost of a treatment that tries to recover a healthy microbial state. Further, a finite horizon MDP is a practical approach for finding a n-steps policy in which a net monetary benefit can be computed, where each applied perturbation entails a high cost (e.g. expensive drugs).</p>
  </sec>
  <sec>
    <title>5 Conclusions and further work</title>
    <p><xref rid="bty562-B16" ref-type="bibr">Costea <italic>et al.</italic> (2018)</xref> imagined a computational tool for suggesting perturbations to modulate the microbiome to move from a disease to healthy state, but noted that no such tool existed. MDPbiome builds a model that suggests a ‘prescription’ of external perturbations that should be applied to a given microbiome that will result in its navigation through a subset of healthy or acceptable states, avoiding disease or other undesirable states, finally reaching a goal state. This manuscript confirms that, given sufficient data, MDPbiome can be applied to a diversity of temporal metagenomics datasets, such as the three distinct domains whose solution in terms of microbiome dynamics was found using the proposed MDP strategy, and to a wide range of perturbations types.</p>
    <p>The main knowledge contributions of this manuscript are: (i) the inclusion of actions in microbiome state transition diagrams; (ii) prediction of the sequence of external perturbations required to preserve or to reach a desired microbiome state or to avoid an undesirable one; (iii) techniques to evaluate the stability and generality of the recommendation policies given a new dataset; (iv) demonstration of our algorithms flexibility in definition/selection of the goal, for example, being desirable or undesirable, or even dependent on a continuous utility function defining the reward; (v) demonstration that, given sufficient data, combinatorial perturbations can be evaluated. The primary technical contributions of this manuscript are: (i) R software that can be easily configured to apply to a new dataset, (ii) a set of visualizations to facilitate further third-party analysis of the multiple outputs of MDPbiome applied to these three datasets.</p>
    <p>The power of MDPbiome will improve as increasingly rich microbiome samples become available in the next years. Nevertheless, MDPbiome may already be used to generate novel hypotheses for research into temporal microbiome dynamics under perturbations. Future work will enable MDPbiome to include weights in the MDP, allowing it to represent, for example, the cost of a specific policy/perturbation, thus providing not only optimal but also cost-efficient policies. Other improvements will involve substituting OTUs by a higher resolution measures (sub-OTU) recently defined by amplicon sequence variant (ASV) (<xref rid="bty562-B10" ref-type="bibr">Callahan <italic>et al.</italic>, 2017</xref>). State-definitions could be extended from phenotypic to molecular, using transcriptomics, metabolomics, or other high-throughput biomarkers, and the range of applicability will be expanded into the industrial and agricultural domains. Finally, we will explore the utility of MDPbiome in the examination of multi-population studies, for example, to explore the influence of the gut microbiome on the microbiomes in other body cavities.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>Supplementary Data</label>
      <media xlink:href="bty562_supplementary_material.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgements</title>
    <p>Thanks to the authors of <xref rid="bty562-B17" ref-type="bibr">David <italic>et al.</italic> (2014)</xref> and <xref rid="bty562-B2" ref-type="bibr">Ballou <italic>et al.</italic> (2016)</xref> for kindly answering our requests about their datasets. We also thank Dr. Keith Walley for his stimulating explanations of the clinical need for these kinds of algorithms.</p>
  </ack>
  <sec>
    <title>Funding</title>
    <p>M.D.W. and B.G.J. have been funded by the Isaac Peral and/or Marie Curie co-fund Programme at UPM and the Fundacion BBVA.</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="bty562-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Baksi</surname><given-names>K.D.</given-names></name><etal>et al</etal></person-group> (<year>2018</year>) 
<article-title>A web application for obtaining insights into microbial ecology using longitudinal microbiome data</article-title>. <source>Front. Microbiol.</source>, <volume>9</volume>, <fpage>36</fpage>.<pub-id pub-id-type="pmid">29416530</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Ballou</surname><given-names>A.L.</given-names></name><etal>et al</etal></person-group> (<year>2016</year>) 
<article-title>Development of the chick microbiome: how early exposure influences future microbial diversity</article-title>. <source>Front. Vet. Sci.</source>, <volume>3</volume>, <fpage>2</fpage>.<pub-id pub-id-type="pmid">26835461</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bashan</surname><given-names>A.</given-names></name><etal>et al</etal></person-group> (<year>2016</year>) 
<article-title>Universality of human microbial dynamics</article-title>. <source>Nature</source>, <volume>534</volume>, <fpage>259</fpage>–<lpage>262</lpage>.<pub-id pub-id-type="pmid">27279224</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bellman</surname><given-names>R.</given-names></name></person-group> (<year>1957</year>) 
<article-title>A markovian decision process</article-title>. <source>Indiana Univ. Math. J.</source>, <volume>6</volume>, <fpage>679</fpage>–<lpage>684</lpage>.</mixed-citation>
    </ref>
    <ref id="bty562-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Boyd</surname><given-names>J.H.</given-names></name><etal>et al</etal></person-group> (<year>2014</year>) 
<article-title>The meta-genome of sepsis: host genetics, pathogens and the acute immune response</article-title>. <source>J. Innate Immunity</source>, <volume>6</volume>, <fpage>272</fpage>–<lpage>283</lpage>.<pub-id pub-id-type="pmid">24525633</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bradley</surname><given-names>P.H.</given-names></name>, <name name-style="western"><surname>Pollard</surname><given-names>K.S.</given-names></name></person-group> (<year>2017</year>) 
<article-title>Proteobacteria explain significant functional variability in the human gut microbiome</article-title>. <source>Microbiome</source>, <volume>5</volume>, <fpage>36</fpage>.<pub-id pub-id-type="pmid">28330508</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Brooks</surname><given-names>J.P.</given-names></name><etal>et al</etal></person-group> (<year>2017</year>) 
<article-title>Changes in vaginal community state types reflect major shifts in the microbiome</article-title>. <source>Microb. Ecol. Health Dis.</source>, <volume>28</volume>, <fpage>1303265</fpage>.<pub-id pub-id-type="pmid">28572753</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Brotman</surname><given-names>R.M.</given-names></name><etal>et al</etal></person-group> (<year>2010</year>) 
<article-title>Rapid fluctuation of the vaginal microbiota measured by Gram stain analysis</article-title>. <source>Sex. Transm. Infect.</source>, <volume>86</volume>, <fpage>297</fpage>–<lpage>302</lpage>.<pub-id pub-id-type="pmid">20660593</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bucci</surname><given-names>V.</given-names></name><etal>et al</etal></person-group> (<year>2016</year>) 
<article-title>MDSINE: Microbial Dynamical Systems INference Engine for microbiome time-series analyses</article-title>. <source>Genome Biol.</source>, <volume>17</volume>, <fpage>121</fpage>.<pub-id pub-id-type="pmid">27259475</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Callahan</surname><given-names>B.J.</given-names></name><etal>et al</etal></person-group> (<year>2017</year>) 
<article-title>Exact sequence variants should replace operational taxonomic units in marker-gene data analysis</article-title>. <source>ISME J.</source>, <volume>11</volume>, <fpage>2639</fpage>–<lpage>2643</lpage>.<pub-id pub-id-type="pmid">28731476</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B11">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Canter</surname><given-names>L.</given-names></name></person-group> (<year>2017</year>) <source>Environmental Impact of Agricultural Production Activities</source>. 
<publisher-name>CRC Press</publisher-name>, 
<publisher-loc>Boca Raton, London, New York</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="bty562-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Cao</surname><given-names>H.-T.</given-names></name><etal>et al</etal></person-group> (<year>2017</year>) 
<article-title>Inferring human microbial dynamics from temporal metagenomics data: pitfalls and lessons</article-title>. <source>BioEssays</source>, <volume>39</volume>, <fpage>1600188</fpage>.</mixed-citation>
    </ref>
    <ref id="bty562-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Capan</surname><given-names>M.</given-names></name><etal>et al</etal></person-group> (<year>2017</year>) 
<article-title>A stochastic model of acute-care decisions based on patient and provider heterogeneity</article-title>. <source>Health Care Manag. Sci.</source>, <volume>20</volume>, <fpage>187</fpage>.<pub-id pub-id-type="pmid">26490831</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Chadès</surname><given-names>I.</given-names></name><etal>et al</etal></person-group> (<year>2014</year>) 
<article-title>MDPtoolbox: a multi-platform toolbox to solve stochastic dynamic programming problems</article-title>. <source>Ecography</source>, <volume>37</volume>, <fpage>916</fpage>–<lpage>920</lpage>.</mixed-citation>
    </ref>
    <ref id="bty562-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Chen</surname><given-names>Q.</given-names></name><etal>et al</etal></person-group> (<year>2017</year>) 
<article-title>Sensitivity analysis in sequential decision models: a probabilistic approach</article-title>. <source>Med. Decis. Making</source>, <volume>37</volume>, <fpage>243</fpage>–<lpage>252</lpage>.<pub-id pub-id-type="pmid">27681992</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Costea</surname><given-names>P.I.</given-names></name><etal>et al</etal></person-group> (<year>2018</year>) 
<article-title>Enterotypes in the landscape of gut microbial community composition</article-title>. <source>Nat. Microbiol.</source>, <volume>3</volume>, <fpage>8</fpage>–<lpage>16</lpage>.<pub-id pub-id-type="pmid">29255284</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>David</surname><given-names>L.A.</given-names></name><etal>et al</etal></person-group> (<year>2014</year>) 
<article-title>Host lifestyle affects human microbiota on daily timescales</article-title>. <source>Genome Biol.</source>, <volume>15</volume>, <fpage>R89</fpage>.<pub-id pub-id-type="pmid">25146375</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Ding</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Schloss</surname><given-names>P.D.</given-names></name></person-group> (<year>2014</year>) 
<article-title>Dynamics and associations of microbial community types across the human body</article-title>. <source>Nature</source>, <volume>509</volume>, <fpage>357</fpage>–<lpage>360</lpage>.<pub-id pub-id-type="pmid">24739969</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Dominguez-Bello</surname><given-names>M.G.</given-names></name><etal>et al</etal></person-group> (<year>2011</year>) 
<article-title>Development of the human gastrointestinal microbiota and insights from high-throughput sequencing</article-title>. <source>Gastroenterology</source>, <volume>140</volume>, <fpage>1713</fpage>–<lpage>1719</lpage>.<pub-id pub-id-type="pmid">21530737</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Faust</surname><given-names>K.</given-names></name>, <name name-style="western"><surname>Raes</surname><given-names>J.</given-names></name></person-group> (<year>2012</year>) 
<article-title>Microbial interactions: from networks to models</article-title>. <source>Nat. Rev. Microbiol.</source>, <volume>10</volume>, <fpage>538</fpage>–<lpage>550</lpage>.<pub-id pub-id-type="pmid">22796884</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Faust</surname><given-names>K.</given-names></name><etal>et al</etal></person-group> (<year>2015</year>) 
<article-title>Metagenomics meets time series analysis: unraveling microbial community dynamics</article-title>. <source>Curr. Opin. Microbiol.</source>, <volume>25</volume>, <fpage>56</fpage>–<lpage>66</lpage>.<pub-id pub-id-type="pmid">26005845</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Foo</surname><given-names>J.L.</given-names></name><etal>et al</etal></person-group> (<year>2017</year>) 
<article-title>Microbiome engineering: current applications and its future</article-title>. <source>Biotechnol. J.</source>, <volume>12</volume>, <fpage>1600099</fpage>.</mixed-citation>
    </ref>
    <ref id="bty562-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Fritz</surname><given-names>J.V.</given-names></name><etal>et al</etal></person-group> (<year>2013</year>) 
<article-title>From meta-omics to causality: experimental models for human microbiome research</article-title>. <source>Microbiome</source>, <volume>1</volume>, <fpage>14</fpage>.<pub-id pub-id-type="pmid">24450613</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gajer</surname><given-names>P.</given-names></name><etal>et al</etal></person-group> (<year>2012</year>) 
<article-title>Temporal dynamics of the human vaginal microbiota</article-title>. <source>Sci. Transl. Med.</source>, <volume>4</volume>, <fpage>132ra52</fpage>.</mixed-citation>
    </ref>
    <ref id="bty562-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>García-Jiménez</surname><given-names>B.</given-names></name>, <name name-style="western"><surname>Wilkinson</surname><given-names>M.D.</given-names></name></person-group> (<year>2018</year>) 
<article-title>Automatic Definition of Robust Microbiome Sub-States in Longitudinal Data</article-title>. <source>PeerJ pre-print</source>, <ext-link ext-link-type="uri" xlink:href="https://peerj.com/preprints/26657">https://peerj.com/preprints/26657</ext-link>.</mixed-citation>
    </ref>
    <ref id="bty562-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gibbons</surname><given-names>S.M.</given-names></name><etal>et al</etal></person-group> (<year>2017</year>) 
<article-title>Two dynamic regimes in the human gut microbiome</article-title>. <source>PLoS Comput. Biol.</source>, <volume>13</volume>, <fpage>e1005364</fpage>.<pub-id pub-id-type="pmid">28222117</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gilbert</surname><given-names>J.A.</given-names></name><etal>et al</etal></person-group> (<year>2016</year>) 
<article-title>Microbiome-wide association studies link dynamic microbial consortia to disease</article-title>. <source>Nature</source>, <volume>535</volume>, <fpage>94</fpage>–<lpage>103</lpage>.<pub-id pub-id-type="pmid">27383984</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gonze</surname><given-names>D.</given-names></name><etal>et al</etal></person-group> (<year>2017</year>) 
<article-title>Multi-stability and the origin of microbial community types</article-title>. <source>ISME J.</source>, <volume>11</volume>, <fpage>2159</fpage>–<lpage>2166</lpage>.<pub-id pub-id-type="pmid">28475180</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B29">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Howard</surname><given-names>R.A.</given-names></name></person-group> (<year>1960</year>) <source>Dynamic Programming and Markov Processes</source>. 
<publisher-name>MIT Press</publisher-name>, 
<publisher-loc>Cambridge</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="bty562-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>La Rosa</surname><given-names>P.S.</given-names></name><etal>et al</etal></person-group> (<year>2014</year>) 
<article-title>Patterned progression of bacterial populations in the premature infant gut</article-title>. <source>Proc. Natl. Acad. Sci. USA</source>, <volume>111</volume>, <fpage>12522</fpage>–<lpage>12527</lpage>.<pub-id pub-id-type="pmid">25114261</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Martí</surname><given-names>J.M.</given-names></name><etal>et al</etal></person-group> (<year>2017</year>) 
<article-title>Health and disease imprinted in the time variability of the human microbiome</article-title>. <source>mSystems</source>, <volume>2</volume>, <fpage>e00144</fpage>–<lpage>16</lpage>.<pub-id pub-id-type="pmid">28345059</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Nugent</surname><given-names>R.P.</given-names></name><etal>et al</etal></person-group> (<year>1991</year>) 
<article-title>Reliability of diagnosing bacterial vaginosis is improved by a standardized method of gram stain interpretation</article-title>. <source>J. Clin. Microbiol.</source>, <volume>29</volume>, <fpage>297</fpage>–<lpage>301</lpage>.<pub-id pub-id-type="pmid">1706728</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Oakley</surname><given-names>B.B.</given-names></name><etal>et al</etal></person-group> (<year>2014</year>) 
<article-title>Successional changes in the chicken cecal microbiome during 42 days of growth are independent of organic acid feed additives</article-title>. <source>BMC Vet. Res.</source>, <volume>10</volume>, <fpage>8</fpage>.<pub-id pub-id-type="pmid">24401205</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B34">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Puterman</surname><given-names>M.L.</given-names></name></person-group> (<year>1994</year>) <source>Markov Decision Processes: Discrete Stochastic Dynamic Programming</source><italic>.</italic><publisher-name>John Wiley and Sons, Inc.</publisher-name>, 
<publisher-loc>New York</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="bty562-B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Shankar</surname><given-names>J.</given-names></name></person-group> (<year>2017</year>) 
<article-title>Insights into study design and statistical analyses in translational microbiome studies</article-title>. <source>Ann. Transl. Med.</source>, <volume>5</volume>, <fpage>249</fpage>–<lpage>249</lpage>.<pub-id pub-id-type="pmid">28706917</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Sonnenberg</surname><given-names>F.A.</given-names></name>, <name name-style="western"><surname>Beck</surname><given-names>J.R.</given-names></name></person-group> (<year>1993</year>) 
<article-title>Markov models in medical decision making: a practical guide</article-title>. <source>Med. Decis. Making</source>, <volume>13</volume>, <fpage>322</fpage>–<lpage>338</lpage>.<pub-id pub-id-type="pmid">8246705</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Stein</surname><given-names>R.R.</given-names></name><etal>et al</etal></person-group> (<year>2013</year>) 
<article-title>Ecological modeling from time-series inference: insight into dynamics and stability of intestinal microbiota</article-title>. <source>PLoS Comput. Biol.</source>, <volume>9</volume>, <fpage>e1003388</fpage>.<pub-id pub-id-type="pmid">24348232</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B38">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Tetreault</surname><given-names>J.R.</given-names></name><etal>et al</etal></person-group> (<year>2007</year>) 
<article-title>Estimating the reliability of mdp policies: a confidence interval approach</article-title>. In: <source>Proceedings of Conference of the North American Chapter of the Association for Computational Linguistics</source>. pp. <fpage>276</fpage>–<lpage>283</lpage>. 
<publisher-name>Rochester</publisher-name>, 
<publisher-loc>New York</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="bty562-B39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Turroni</surname><given-names>S.</given-names></name><etal>et al</etal></person-group> (<year>2017</year>) 
<article-title>Temporal dynamics of the gut microbiota in people sharing a confined environment, a 520-day ground-based space simulation, MARS500</article-title>. <source>Microbiome</source>, <volume>5</volume>, <fpage>39</fpage>.<pub-id pub-id-type="pmid">28340597</pub-id></mixed-citation>
    </ref>
    <ref id="bty562-B40">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Weiss</surname><given-names>G.A.</given-names></name>, <name name-style="western"><surname>Hennet</surname><given-names>T.</given-names></name></person-group> (<year>2017</year>) 
<article-title>Mechanisms and consequences of intestinal dysbiosis</article-title>. <source>Cell. Mol. Life Sci.</source>, <volume>74</volume>, <fpage>2959</fpage>–<lpage>2977</lpage>.<pub-id pub-id-type="pmid">28352996</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
