<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS One</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS ONE</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-id journal-id-type="pmc">plosone</journal-id>
    <journal-title-group>
      <journal-title>PLoS ONE</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1932-6203</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, CA USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6860425</article-id>
    <article-id pub-id-type="publisher-id">PONE-D-19-09624</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pone.0223440</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Anatomy</subject>
          <subj-group>
            <subject>Nervous System</subject>
            <subj-group>
              <subject>Central Nervous System</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Anatomy</subject>
          <subj-group>
            <subject>Nervous System</subject>
            <subj-group>
              <subject>Central Nervous System</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Neuroscience</subject>
          <subj-group>
            <subject>Brain Mapping</subject>
            <subj-group>
              <subject>Functional Magnetic Resonance Imaging</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Diagnostic Medicine</subject>
          <subj-group>
            <subject>Diagnostic Radiology</subject>
            <subj-group>
              <subject>Magnetic Resonance Imaging</subject>
              <subj-group>
                <subject>Functional Magnetic Resonance Imaging</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Imaging Techniques</subject>
          <subj-group>
            <subject>Diagnostic Radiology</subject>
            <subj-group>
              <subject>Magnetic Resonance Imaging</subject>
              <subj-group>
                <subject>Functional Magnetic Resonance Imaging</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Radiology and Imaging</subject>
          <subj-group>
            <subject>Diagnostic Radiology</subject>
            <subj-group>
              <subject>Magnetic Resonance Imaging</subject>
              <subj-group>
                <subject>Functional Magnetic Resonance Imaging</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Imaging Techniques</subject>
          <subj-group>
            <subject>Neuroimaging</subject>
            <subj-group>
              <subject>Functional Magnetic Resonance Imaging</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Neuroscience</subject>
          <subj-group>
            <subject>Neuroimaging</subject>
            <subj-group>
              <subject>Functional Magnetic Resonance Imaging</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical Sciences</subject>
        <subj-group>
          <subject>Mathematics</subject>
          <subj-group>
            <subject>Applied Mathematics</subject>
            <subj-group>
              <subject>Algorithms</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Simulation and Modeling</subject>
          <subj-group>
            <subject>Algorithms</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical Sciences</subject>
        <subj-group>
          <subject>Physics</subject>
          <subj-group>
            <subject>Classical Mechanics</subject>
            <subj-group>
              <subject>Deformation</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical Sciences</subject>
        <subj-group>
          <subject>Physics</subject>
          <subj-group>
            <subject>Classical Mechanics</subject>
            <subj-group>
              <subject>Damage Mechanics</subject>
              <subj-group>
                <subject>Deformation</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Imaging Techniques</subject>
          <subj-group>
            <subject>Neuroimaging</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Neuroscience</subject>
          <subj-group>
            <subject>Neuroimaging</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical Sciences</subject>
        <subj-group>
          <subject>Mathematics</subject>
          <subj-group>
            <subject>Optimization</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Diagnostic Medicine</subject>
          <subj-group>
            <subject>Diagnostic Radiology</subject>
            <subj-group>
              <subject>Magnetic Resonance Imaging</subject>
              <subj-group>
                <subject>Echo Planar Imaging</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Imaging Techniques</subject>
          <subj-group>
            <subject>Diagnostic Radiology</subject>
            <subj-group>
              <subject>Magnetic Resonance Imaging</subject>
              <subj-group>
                <subject>Echo Planar Imaging</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Radiology and Imaging</subject>
          <subj-group>
            <subject>Diagnostic Radiology</subject>
            <subj-group>
              <subject>Magnetic Resonance Imaging</subject>
              <subj-group>
                <subject>Echo Planar Imaging</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Computer and Information Sciences</subject>
        <subj-group>
          <subject>Data Acquisition</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Improved cortical boundary registration for locally distorted fMRI scans</article-title>
      <alt-title alt-title-type="running-head">Improved cortical boundary registration for locally distorted fMRI scans</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-8155-8641</contrib-id>
        <name>
          <surname>van Mourik</surname>
          <given-names>Tim</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Data curation</role>
        <role content-type="http://credit.casrai.org/">Formal analysis</role>
        <role content-type="http://credit.casrai.org/">Investigation</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Project administration</role>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Software</role>
        <role content-type="http://credit.casrai.org/">Validation</role>
        <role content-type="http://credit.casrai.org/">Visualization</role>
        <role content-type="http://credit.casrai.org/">Writing – original draft</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="cor001">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Koopmans</surname>
          <given-names>Peter J.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Supervision</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Norris</surname>
          <given-names>David G.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Writing – original draft</role>
        <role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="aff001">
      <label>1</label>
      <addr-line>Radboud University Nijmegen, Donders Institute for Brain, Cognition and Behaviour, Nijmegen, The Netherlands</addr-line>
    </aff>
    <aff id="aff002">
      <label>2</label>
      <addr-line>Erwin L. Hahn Institute for Magnetic Resonance Imaging, Essen, Germany</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Pham</surname>
          <given-names>Dzung</given-names>
        </name>
        <role>Editor</role>
        <xref ref-type="aff" rid="edit1"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>Center for Neuroscience and Regenerative Medicine, UNITED STATES</addr-line>
    </aff>
    <author-notes>
      <fn fn-type="COI-statement" id="coi001">
        <p><bold>Competing Interests: </bold>The authors have declared that no competing interests exist.</p>
      </fn>
      <corresp id="cor001">* E-mail: <email>t.vanmourik@donders.ru.nl</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>11</month>
      <year>2019</year>
    </pub-date>
    <volume>14</volume>
    <issue>11</issue>
    <elocation-id>e0223440</elocation-id>
    <history>
      <date date-type="received">
        <day>24</day>
        <month>4</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>20</day>
        <month>9</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2019 van Mourik et al</copyright-statement>
      <copyright-year>2019</copyright-year>
      <copyright-holder>van Mourik et al</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="pone.0223440.pdf"/>
    <abstract>
      <p>With continuing advances in MRI techniques and the emergence of higher static field strengths, submillimetre spatial resolution is now possible in human functional imaging experiments. This has opened up the way for more specific types of analysis, for example investigation of the cortical layers of the brain. With this increased specificity, it is important to correct for the geometrical distortions that are inherent to echo planar imaging (EPI). Inconveniently, higher field strength also increases these distortions. The resulting displacements can easily amount to several millimetres and as such pose a serious problem for laminar analysis. We here present a method, Recursive Boundary Registration (RBR), that corrects distortions between an anatomical and an EPI volume. By recursively applying Boundary Based Registration (BBR) on progressively smaller subregions of the brain we generate an accurate whole-brain registration, based on the grey-white matter contrast. Explicit care is taken that the deformation does not break the topology of the cortical surface, which is an important requirement for several of the most common subsequent steps in laminar analysis. We show that RBR obtains submillimetre accuracy with respect to a manually distorted gold standard, and apply it to a set of human in vivo scans to show a clear increase in spacial specificity. RBR further automates the process of non-linear distortion correction. This is an important step towards routine human laminar fMRI for large field of view acquisitions. We provide the code for the RBR algorithm, as well as a variety of functions to better investigate registration performance in a public GitHub repository, <ext-link ext-link-type="uri" xlink:href="https://github.com/TimVanMourik/OpenFmriAnalysis">https://github.com/TimVanMourik/OpenFmriAnalysis</ext-link>, under the GPL 3.0 license.</p>
    </abstract>
    <funding-group>
      <funding-statement>This study was supported by the KNAW Academy Professor Prize 2012.</funding-statement>
    </funding-group>
    <counts>
      <fig-count count="5"/>
      <table-count count="0"/>
      <page-count count="15"/>
    </counts>
    <custom-meta-group>
      <custom-meta id="data-availability">
        <meta-name>Data Availability</meta-name>
        <meta-value>Data is publicly available from The Donders Institute for Brain, Cognition and Behaviour: <ext-link ext-link-type="uri" xlink:href="http://hdl.handle.net/11633/di.dccn.DSC_3015016.05_558">http://hdl.handle.net/11633/di.dccn.DSC_3015016.05_558</ext-link>.</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
  <notes>
    <title>Data Availability</title>
    <p>Data is publicly available from The Donders Institute for Brain, Cognition and Behaviour: <ext-link ext-link-type="uri" xlink:href="http://hdl.handle.net/11633/di.dccn.DSC_3015016.05_558">http://hdl.handle.net/11633/di.dccn.DSC_3015016.05_558</ext-link>.</p>
  </notes>
</front>
<body>
  <sec sec-type="intro" id="sec001">
    <title>Introduction</title>
    <p>Investigation of the BOLD response with functional MRI at the level of the cortical layers has become increasingly popular over the the last decade [<xref rid="pone.0223440.ref001" ref-type="bibr">1</xref>, <xref rid="pone.0223440.ref002" ref-type="bibr">2</xref>]. Activation levels differ at the laminar scale [<xref rid="pone.0223440.ref003" ref-type="bibr">3</xref>] and they can vary depending on the performed task [<xref rid="pone.0223440.ref004" ref-type="bibr">4</xref>, <xref rid="pone.0223440.ref005" ref-type="bibr">5</xref>]. Laminar signals have the potential to reveal information about the underlying neuronal processes within a cortical region, as the signal from different layers may be associated with feed forward or feedback signals [<xref rid="pone.0223440.ref006" ref-type="bibr">6</xref>, <xref rid="pone.0223440.ref007" ref-type="bibr">7</xref>]. However, layer specific analysis comes with great methodological challenges.</p>
    <p>The thickness of the cerebral cortex varies between 1 and 4.5 millimetres [<xref rid="pone.0223440.ref008" ref-type="bibr">8</xref>, <xref rid="pone.0223440.ref009" ref-type="bibr">9</xref>]. Identifying individual layers therefore ideally requires sub-millimetre resolution, at the cost of signal to noise ratio (SNR) per voxel. On top of this, a functional experiment ideally requires a Repetition Time (TR) on the order of several seconds. Layer specific investigations are hence best conducted at higher field (≥7 Tesla) for improved SNR, but high field strength also have some disadvantages [<xref rid="pone.0223440.ref010" ref-type="bibr">10</xref>]. The inhomogeneities of the static magnetic field <italic>B</italic><sub>0</sub> can cause non-linear distortions when a fast acquisition scheme like Echo Planar Imaging (EPI) is used [<xref rid="pone.0223440.ref011" ref-type="bibr">11</xref>]. Distortions primarily present themselves in the phase-encoding direction as a function of the bandwidth per pixel and static field strength [<xref rid="pone.0223440.ref012" ref-type="bibr">12</xref>]. As layer specific analysis requires high spatial precision, non-linear distortions are particularly problematic. <inline-formula id="pone.0223440.e001"><alternatives><graphic xlink:href="pone.0223440.e001.jpg" id="pone.0223440.e001g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M1"><mml:msubsup><mml:mi>T</mml:mi><mml:mn>2</mml:mn><mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula>-weighted images usually have insufficient contrast to segment the cortical grey matter, so instead one needs to identify the cortical boundaries from a different scan. This is typically a high-contrast <italic>T</italic><sub>1</sub>-weighted anatomical scan that can be segmented with tools such as FreeSurfer [<xref rid="pone.0223440.ref013" ref-type="bibr">13</xref>], CBS Tools [<xref rid="pone.0223440.ref014" ref-type="bibr">14</xref>], or BrainVoyager [<xref rid="pone.0223440.ref015" ref-type="bibr">15</xref>]. However, as the anatomical scan is undistorted, it may not sufficiently overlap with the functional scan.</p>
    <p>Several potential solutions have been proposed for providing accurate alignment of functional images with an anatomical image. Early papers circumvent the problem by segmenting only a small piece of straight cortex [<xref rid="pone.0223440.ref016" ref-type="bibr">16</xref>, <xref rid="pone.0223440.ref017" ref-type="bibr">17</xref>]. It is also possible to resort to different acquisition schemes like FLASH, which do not suffer significant distortions, but at a heavy cost in temporal resolution. Koopmans et al. combine this with a vertex based realignment procedure based on the Stripe of Gennari [<xref rid="pone.0223440.ref003" ref-type="bibr">3</xref>]. This approach, however, is highly specific to parts of the primary visual cortex that show a myelinated band in the middle of the cortex (Stripe of Gennari), and does not generalise to the rest of the brain. Additionally, when the acquisition only covers a small part of the brain, cortical reconstruction algorithms may easily fail, as they are often based on whole-brain templates. Yet another alternative is to acquire an anatomical image with the same EPI readout and field of view as the functional image, such that the two volumes are similarly distorted [<xref rid="pone.0223440.ref018" ref-type="bibr">18</xref>]. However, this assumes that field inhomogeneities, and with it the distortions, do not change between acquisitions. Solutions in which T1-contrast is computed from the functional acquisition directly do not have this problem, for example the VASO sequence [<xref rid="pone.0223440.ref019" ref-type="bibr">19</xref>], or 3D-EPI with a variable TR [<xref rid="pone.0223440.ref020" ref-type="bibr">20</xref>]. Classically, <italic>B</italic><sub>0</sub> maps have been used for correcting distortions [<xref rid="pone.0223440.ref021" ref-type="bibr">21</xref>], yet this is typically used on low resolution images [<xref rid="pone.0223440.ref022" ref-type="bibr">22</xref>] and commonly accepted thereby not to be precise enough for sub-millimetre precision. Promising advances have also been made for high-resolution dynamic correction [<xref rid="pone.0223440.ref023" ref-type="bibr">23</xref>], but to date these have not been tested at sub-millimetre resolution. Additionally, for diffusion MRI a combined registration-segmentation method (<monospace>regseg</monospace>) has been developed that may be portable to high resolution laminar fMRI. [<xref rid="pone.0223440.ref024" ref-type="bibr">24</xref>].</p>
    <p>Ideally, there would be an accurate cross-contrast (<italic>T</italic><sub>1</sub> to <inline-formula id="pone.0223440.e002"><alternatives><graphic xlink:href="pone.0223440.e002.jpg" id="pone.0223440.e002g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M2"><mml:msubsup><mml:mi>T</mml:mi><mml:mn>2</mml:mn><mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula>) registration algorithm, but this is a notoriously hard problem. The combination of the warping of images and the unknown relation between contrasts creates a vast parameter space that is difficult to solve in a coregistration procedure. While algorithms like AFNI’s <monospace>3dQWarp</monospace> [<xref rid="pone.0223440.ref025" ref-type="bibr">25</xref>] technically support cross-modal cost functions, the documentation acknowledges that such usage is rather experimental and in our experience indeed does not reach submillimetre accuracy. In general, no algorithm currently exists that verifiably corrects non-linear distortions in high resolution low-contrast images up to the laminar specific level, and works either on partial or whole-brain images.</p>
    <p>One way to search through relevant information in the image domain is to try and detect the grey-white matter boundary and match this between volumes. This is using <italic>geometric</italic> information on top of <italic>volumetric</italic> information and forms the basis of Boundary Based Registration (BBR) [<xref rid="pone.0223440.ref026" ref-type="bibr">26</xref>]. A three-dimensional cortical reconstruction of the grey-white matter boundary is created on a high contrast anatomical image and serves as a basis for the coregistration. While a functional image is too low in contrast for generating a cortical reconstruction, it can be used in the registration procedure. The contrast is sufficient to optimise the average contrast across the boundary in order to achieve a better realignment. This was proposed for linear registrations and proven to be an exceedingly robust method. We here extend BBR to work recursively and effectively produce a cross-contrast non-linear registration. Our aim is to provide accurate within-subject submillimetre registration for whole-brain or partial brain images for standard high-resolution EPI sequences to make laminar fMRI analysis more accessible to a wider audience. The algorithms can be performed on the the functional data, without additional acquisition of additional scans, and without reinterpolation as a result of a non-linear warping. Importantly, the procedure produces a smooth deformation field that does not alter the topological properties of the mesh, such that the resulting surfaces can naturally be used in subsequent automatic layering and further layer specific analyses [<xref rid="pone.0223440.ref027" ref-type="bibr">27</xref>, <xref rid="pone.0223440.ref028" ref-type="bibr">28</xref>].</p>
  </sec>
  <sec sec-type="materials|methods" id="sec002">
    <title>Methods</title>
    <p>Boundary Based Registration (BBR) is based on a cortical construction of the boundary between the white matter and grey matter, and the grey matter and the CSF (pial surface) [<xref rid="pone.0223440.ref026" ref-type="bibr">26</xref>]. This surface is generated on an anatomical scan, as the contrast of the functional scan may not be good enough for segmentation. In order to register the two volumes, the constructed surface is moved to the functional image. The average contrast across the grey-white matter boundary is computed and used as a cost function to optimise the transformation parameters of the registration. Versions of BBR are implemented in FreeSurfer (<monospace>bbregister</monospace>) [<xref rid="pone.0223440.ref013" ref-type="bibr">13</xref>] and FSL (<monospace>flirt -cost bbr</monospace>) [<xref rid="pone.0223440.ref029" ref-type="bibr">29</xref>]. This method is powerful enough to be able to register the volumes, based on only a small part of the brain [<xref rid="pone.0223440.ref026" ref-type="bibr">26</xref>], suggesting that local application can also be successfully employed. Especially for high resolution (laminar) fMRI, the anatomical and functional volumes contain detailed information about the gyrification that can be used for registration. We hence propose to extend BBR with a hierarchical strategy [<xref rid="pone.0223440.ref030" ref-type="bibr">30</xref>]. By recursively applying BBR at diminishing scales as a series of linear transformation, the volumes are effectively non-linearly registered.</p>
    <p>The way in which the mesh is divided is based on a three-dimensional cuboid lattice consisting of the set of neigbourhoods <inline-formula id="pone.0223440.e003"><alternatives><graphic xlink:href="pone.0223440.e003.jpg" id="pone.0223440.e003g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M3"><mml:msup><mml:mi mathvariant="script">N</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:math></alternatives></inline-formula> at various depths <italic>d</italic>, decreasing in size. At each depth, <inline-formula id="pone.0223440.e004"><alternatives><graphic xlink:href="pone.0223440.e004.jpg" id="pone.0223440.e004g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M4"><mml:msup><mml:mi mathvariant="script">N</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:math></alternatives></inline-formula> is divided into eight equally sized cuboids (two in each dimension) <inline-formula id="pone.0223440.e005"><alternatives><graphic xlink:href="pone.0223440.e005.jpg" id="pone.0223440.e005g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M5"><mml:msup><mml:mi mathvariant="script">N</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math></alternatives></inline-formula> until a user specified threshold size is reached. All vertices that make up the brain mesh are divided over the elements of <inline-formula id="pone.0223440.e006"><alternatives><graphic xlink:href="pone.0223440.e006.jpg" id="pone.0223440.e006g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M6"><mml:msup><mml:mi mathvariant="script">V</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:math></alternatives></inline-formula>, the set of vertices within <inline-formula id="pone.0223440.e007"><alternatives><graphic xlink:href="pone.0223440.e007.jpg" id="pone.0223440.e007g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M7"><mml:msup><mml:mi mathvariant="script">N</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:math></alternatives></inline-formula>. The number of vertices in each neighbourhood may well vary between regions.</p>
    <p>Registration is performed iteratively, from the largest scale (<italic>d</italic> = 0) to the smallest (<italic>d</italic> = <italic>d</italic><sub><italic>max</italic></sub>). For each element <inline-formula id="pone.0223440.e008"><alternatives><graphic xlink:href="pone.0223440.e008.jpg" id="pone.0223440.e008g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M8"><mml:msubsup><mml:mi mathvariant="script">N</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>, a registration is computed by means of a boundary based registration algorithm [<xref rid="pone.0223440.ref026" ref-type="bibr">26</xref>] applied to <inline-formula id="pone.0223440.e009"><alternatives><graphic xlink:href="pone.0223440.e009.jpg" id="pone.0223440.e009g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M9"><mml:msubsup><mml:mi mathvariant="script">V</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>. In short, this is an edge detection algorithm that maximises the average contrast across the white matter surface. Contrast is defined as the (optionally weighted) gradient of samples on either side of vertices within the mesh. For the optimisation procedure we use MATLAB’s gradient descent method <monospace>fminsearch</monospace> (default parameters) to optimise registration parameters as a function of contrast. The same sampling method and cost function were used as proposed by Greve &amp; Fischl [<xref rid="pone.0223440.ref026" ref-type="bibr">26</xref>].</p>
    <p>Applying the computed transformations directly to <inline-formula id="pone.0223440.e010"><alternatives><graphic xlink:href="pone.0223440.e010.jpg" id="pone.0223440.e010g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M10"><mml:msup><mml:mi mathvariant="script">V</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:math></alternatives></inline-formula> could easily ‘break the mesh’ at the edges of neighbouring regions as their continuity is not guaranteed. This is a serious problem, as subsequent steps in laminar analysis (like the level set methods [<xref rid="pone.0223440.ref031" ref-type="bibr">31</xref>]) require the mesh to be a topological sphere: a non-intersection closed surface without holes. In order to ensure continuity we use a control point based strategy [<xref rid="pone.0223440.ref030" ref-type="bibr">30</xref>]: let the edges and corners of the neighbourhoods <inline-formula id="pone.0223440.e011"><alternatives><graphic xlink:href="pone.0223440.e011.jpg" id="pone.0223440.e011g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M11"><mml:msup><mml:mi mathvariant="script">N</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:math></alternatives></inline-formula> define a deformable lattice. For each computed transformation in a neighbourhood, a resulting displacement vector is assigned to all of its corner points. After all transformations at a depth level are computed, the median is taken of all displacement vectors for each control point, thus representing a resultant vector based on adjacent neighbourhoods. In order to further increase robustness (but at the cost of specificity), the displacement vectors may subsequently be adjusted based on their direct neighbours:
<disp-formula id="pone.0223440.e012"><alternatives><graphic xlink:href="pone.0223440.e012.jpg" id="pone.0223440.e012g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M12"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mover accent="true"><mml:mi>d</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>α</mml:mi><mml:mover accent="true"><mml:mi>d</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>α</mml:mi><mml:mo>)</mml:mo><mml:mi mathvariant="bold">M</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(1)</label></disp-formula>
where <inline-formula id="pone.0223440.e013"><alternatives><graphic xlink:href="pone.0223440.e013.jpg" id="pone.0223440.e013g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M13"><mml:mrow><mml:mi mathvariant="bold">M</mml:mi><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> denotes the mean displacement of the neighbourhood. The balance between local matching and global smoothness is given by the <italic>α</italic> parameter and Collins et al. [<xref rid="pone.0223440.ref030" ref-type="bibr">30</xref>] experimentally found <italic>α</italic> = 0.5 yields an acceptable balance. We recommend higher values for <italic>α</italic>, as our primary goal in laminar analysis is the local matching. We suggest additional ways of increasing robustness in the next section.</p>
    <p>As all control points within <inline-formula id="pone.0223440.e014"><alternatives><graphic xlink:href="pone.0223440.e014.jpg" id="pone.0223440.e014g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M14"><mml:msup><mml:mi mathvariant="script">N</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:math></alternatives></inline-formula> now have displacement vectors associated with them, <inline-formula id="pone.0223440.e015"><alternatives><graphic xlink:href="pone.0223440.e015.jpg" id="pone.0223440.e015g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M15"><mml:msup><mml:mi mathvariant="script">V</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:math></alternatives></inline-formula> can be displaced proportionally to the distance to their closest control points. A way of describing this is by defining transformation matrix <bold>T</bold>, such that it satisfies:
<disp-formula id="pone.0223440.e016"><alternatives><graphic xlink:href="pone.0223440.e016.jpg" id="pone.0223440.e016g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M16"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi mathvariant="bold">D</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mi mathvariant="bold">T</mml:mi><mml:msubsup><mml:mi mathvariant="script">V</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(2)</label></disp-formula>
where the set of displacement vectors is denoted by <bold>D</bold><sup><italic>d</italic></sup>, for which each <italic>i</italic>’th element contains 8 vectors, one for each corner of the cube. This is a typical linear regression equation and could hence trivially be solved for <bold>T</bold>. However, a least squares solution is required as the system is overdetermined with eight corner points and only a [4<italic>X</italic>4] transformation matrix. This necessarily requires an approximation of the deformation vectors that may result in discontinuities with respect to adjacent neighbourhoods. A preferred method is to divide the cube into six tetrahedra by means of Delaunay triangulation [<xref rid="pone.0223440.ref032" ref-type="bibr">32</xref>] and compute a separate matrix for each of them. For each tetrahedron, <xref ref-type="disp-formula" rid="pone.0223440.e016">Eq 2</xref> represents a determined system, for which the solution for adjacent tetrahedra is guaranteed to be continuous. Effectively, this division increases the degrees of freedom of the deformation field to satisfy our requirement of continuity. Having found the transformations, they can readily be applied to adjust the position of <inline-formula id="pone.0223440.e017"><alternatives><graphic xlink:href="pone.0223440.e017.jpg" id="pone.0223440.e017g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M17"><mml:msup><mml:mi mathvariant="script">V</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:math></alternatives></inline-formula>.</p>
    <p>This procedure is repeated for all depths levels <italic>d</italic>. Whenever the number of vertices in <inline-formula id="pone.0223440.e018"><alternatives><graphic xlink:href="pone.0223440.e018.jpg" id="pone.0223440.e018g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M18"><mml:msup><mml:mi mathvariant="script">N</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:math></alternatives></inline-formula> is smaller than a user specified minimum, the transformation for that region is set to the identity matrix.</p>
    <sec id="sec003">
      <title>Robustness</title>
      <p>With the exponential increase in number of neighbourhoods as a function of depth level, the number of registrations easily reaches into the hundreds. The high number of Degrees of Freedom (DoF) of the algorithm therefore inescapably increases the probability of misregistrations. The algorithm ensures robustness and continuity in several ways, by computing displacement vectors as a weighted average of all surrounding neighbourhoods, and by an (optional) additional smoothing of displacement vectors based on adjacent control points, as mentioned above. Additionally, we compute a transformation within a neighbourhood not only for the entire neighbourhood, but also for six subregions. By splitting <inline-formula id="pone.0223440.e019"><alternatives><graphic xlink:href="pone.0223440.e019.jpg" id="pone.0223440.e019g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M19"><mml:msup><mml:mi mathvariant="script">V</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:math></alternatives></inline-formula> separately into two in the <italic>x</italic>, <italic>y</italic>, and <italic>z</italic> dimensions, six cuboids are created for which the registration is repeated. This procedure is illustrated in <xref ref-type="fig" rid="pone.0223440.g001">Fig 1</xref>. The resulting displacement vectors are added to the respective list for each control point.</p>
      <fig id="pone.0223440.g001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0223440.g001</object-id>
        <label>Fig 1</label>
        <caption>
          <title>A schematic of the workflow.</title>
          <p>First, the volume is recursively broken up into parts, for which registrations are computed by means of the edge detecting boundary based registration method. Based on the transformations found in this step, the second step is the updating of a cuboid lattice. The control points within the lattice are updated and applied to the boundaries. Specifically, this was performed based on a tetrahedral division of the cube. For each tetrahedron, a displacement field was computed and applied to the vertices within the tetrahedron.</p>
        </caption>
        <graphic xlink:href="pone.0223440.g001"/>
      </fig>
    </sec>
    <sec id="sec004">
      <title>Parameters</title>
      <p>The algorithm can look for any combination of translation, rotation and scaling in the <italic>x</italic>, <italic>y</italic>, and <italic>z</italic> dimensions. It will divide the volume until it reaches a user defined minimum size or number of vertices, and a transformation will be computed. We here focus on registration in the phase encoding direction only, i.e. translation and scaling in the <italic>y</italic>-direction, as this is the most common type of distortion when an Echo Planar Imaging sequence is used [<xref rid="pone.0223440.ref011" ref-type="bibr">11</xref>]. We set the minimum size of a neighbourhood to 4 voxels and the minimum number of vertices to 100. The smoothing factor with respect to adjacent vertices in the lattice from <xref ref-type="disp-formula" rid="pone.0223440.e012">Eq 1</xref> was set to <italic>α</italic> = 0.9. Experimentally, we have found that this still yields robust results while still being highly weighted towards specificity. In contrast, Collins et al. [<xref rid="pone.0223440.ref030" ref-type="bibr">30</xref>] describe an <italic>α</italic>-level of <italic>α</italic> = 0.5, which is likely to do with the fact that their purpose of template matching and segmentation prioritises robustness over specificity. While the original implementation of BBR recommends using subsets of vertices for parts of the algorithm [<xref rid="pone.0223440.ref026" ref-type="bibr">26</xref>], we here use all vertices at all stages. This may be redundant for registrations at the large scale, but as it is a small addition in computation time, and because errors in early iterations may propagate further downwards, we chose to incorporate all vertices. Finding the best selection of parameters may still require some iterations for a given data set. It is, however, a substantial improvement with respect to the arduous job of manually matching small patches of cortex within a very limited field of view.</p>
    </sec>
    <sec id="sec005">
      <title>Validation</title>
      <p>Assessing the quality of the registration performance proved challenging. While there is a clear theoretical relationship between the distortion size and the parameters of the acquisition [<xref rid="pone.0223440.ref021" ref-type="bibr">21</xref>], in practice it is difficult to find a gold standard for the submillimetre accuracy that we are aspiring to. Tools to convert field maps to estimates of voxel displacement are usually heavily smoothed and cannot account for subject movement in the scanner or field changes between acquisitions. We hence created our own gold standard by acquiring an undistorted FLASH image and manually distorting it based on a field map. This way, the exact distortions were known in order to test if we could find them back with RBR.</p>
      <p>A high resolution whole brain multi-echo FLASH image [<xref rid="pone.0223440.ref033" ref-type="bibr">33</xref>] was acquired at a 3T Siemens Scanner, TR = 95 ms, <italic>α</italic> = 20°, bandwidth = 170 Hz/px, [0.75 mm]<sup>3</sup>. GRAPPA was used for three-fold in-plane acceleration. The echo times ranged from 5.88 ms to 78.96 ms with an echo spacing of 8.12 ms. The average of the last seven echoes was used, as the first three contained little contrast. This was accompanied by a whole brain MPRAGE acquisition that was used for the FreeSurfer cortical reconstruction v5.1, default parameters, TR/TE/TI/<italic>α</italic> = 2300 ms/3.15 ms/1100 ms/8°, [0.8 mm]<sup>3</sup>. A field map was acquired to realistically distort the FLASH image. The resolution was [3.5 mm X 3.5 mm X 2.0 mm], TR/TE1/TE2/<italic>α</italic> = 1020 ms/10 ms/12.46 ms/90°, bandwidth = 260 Hz/Px.</p>
      <p>The cortical reconstruction from FreeSurfer’s <monospace>recon-all</monospace> [<xref rid="pone.0223440.ref013" ref-type="bibr">13</xref>] was coregistered to the FLASH image using a 6 DoF linear registration with a custom MATLAB implementation of BBR. In order to distort the cortical surface, a voxel displacement map (VDM) was computed using SPM field map tools [<xref rid="pone.0223440.ref034" ref-type="bibr">34</xref>]. In order to taper unrealistically large displacements, and to move non-displaced vertices away from zero, the VDM was first transformed by a cubic root, after which it was applied in the anterior-posterior direction to the boundaries. Vertices were on average displaced by 2.56 mm (3.4 voxels), which is considerably more than could be tolerated for a laminar specific experiment. The distribution of displacement values was bimodally distributed away from zero with the specific goal to let RBR find the displacement and yield a sharp unimodal distribution around zero, as close to a delta distribution as possible.</p>
      <p>Additionally, 12 brain scans were obtained from a 7T scanner to test RBR. One was excluded at an early stage of the analysis because of poor quality of the cortical reconstruction, despite manual efforts. We used 3D EPI [<xref rid="pone.0223440.ref035" ref-type="bibr">35</xref>], [0.93 mm]<sup>3</sup>, TR/TE/<italic>α</italic> = 2768 ms/20 ms/14°, bandwidth = 1167 Hz/pixel, phase encoding direction: A -&gt; P, matrix size = 204<sup>2</sup>, effective echo spacing = 0.25 ms. The boundaries were created by FreeSurfer on a whole-brain MP2RAGE (1.03 mm<sup>3</sup>, TR/TE/TI1/TI2 = 5000 ms/1.89 ms/900 ms/3200 ms) [<xref rid="pone.0223440.ref036" ref-type="bibr">36</xref>]. BBR was performed by <monospace>bbregister</monospace> with a full affine transformation (12 DoFs) on the mean of the functional images and subsequently, the boundaries were imported to MATLAB. Overlaying the registered boundaries on top of the EPI image showed clear local geometrical distortions in the phase encoding direction, related to field inhomogeneity [<xref rid="pone.0223440.ref021" ref-type="bibr">21</xref>]. These distortions were of the order of several millimetres within a single volume. We corrected this with RBR and investigated its performance.</p>
      <p>It must be noted that it is challenging to find an objective metric by which the quality of the registration could be quantified. The true distorted position is unknown and methods to approximate do not have the desired submillimetre specificity that is required. Moreover, if such metric existed, it could itself be used in the optimisation procedure. An alternative, however, is an investigation of RBR’s performance on the true volume compared to the performance on the volume with different levels of added noise. Assuming that the algorithm has the best performance on the original data, the displacement with respect to the no-noise condition is expected to increase when more noise is added. Note that this does not make a statement about the correctness of the result. To investigate the RBR’s performance in the presence of noise, we added twelve different levels of white noise to the data, applied RBR and compared the displacement to the unsalted version. For this, we used the Average Absolute Distance (AAD) [<xref rid="pone.0223440.ref026" ref-type="bibr">26</xref>], defined to be the average distance that the cortical surface moves between the two sets of registrations.</p>
      <sec id="sec006">
        <title>Ethics statements</title>
        <p>This study was approved by the DCCN CMO 2014/288 (Donders Centre for Cognitive Neuroimaging, Commissie Mensgebonden Onderzoek). CMO Arnhem-Nijmegen is an accredited IRB in the Netherlands. All participants provided written informed consent in accordance with its guidelines.</p>
      </sec>
      <sec id="sec007">
        <title>Participants</title>
        <p>In total, twelve participants were recruited from the Donders Institute participant pool (7 male, mean age 23, range 18-26). One was excluded at an early stage of the analysis because of poor quality of the cortical reconstruction, despite manual efforts.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="results" id="sec008">
    <title>Results</title>
    <p>We employed RBR on a constructed gold standard where the exact displacement was known. By taking an undistorted FLASH image and realistically distorting the cortical surface by means of a field map, we could test if we could retrieve the initial position of the boundaries. In <xref ref-type="fig" rid="pone.0223440.g002">Fig 2</xref>, we present a histogram of the displaced boundaries and the registered boundaries, both with respect to the true position. The registered boundaries clearly show a sharp distribution centred around the origin (<italic>μ</italic> = 0.027 mm). The FWHM of the distribution is 0.49 mm, showing that RBR provides accurate submillimetre registration. Additionally, <xref ref-type="fig" rid="pone.0223440.g003">Fig 3</xref> shows a cross section (middle slice of the volume) of the registration. <xref ref-type="supplementary-material" rid="pone.0223440.s002">S2 Fig</xref> shows a colour coded figure with the difference in millimetres of the registrered boundaries with respect to the gold standard.</p>
    <fig id="pone.0223440.g002" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pone.0223440.g002</object-id>
      <label>Fig 2</label>
      <caption>
        <title>Histogram of the displacement of all 228,208 vertices within a single brain mesh.</title>
        <p>The red histogram shows the displacement after fieldmap based distortion with respect to a gold standard. The green shows the displacement after applying RBR with respect to the same standard. After registration, the histogram clearly shows a sharp zero-centered (no bias) distribution.</p>
      </caption>
      <graphic xlink:href="pone.0223440.g002"/>
    </fig>
    <fig id="pone.0223440.g003" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pone.0223440.g003</object-id>
      <label>Fig 3</label>
      <caption>
        <title>The middle slice of the registration performed on a manually distorted FLASH image (red boundaries).</title>
        <p>The registered surface (green) overlaps for the larger part of the brain almost perfectly with the gold standard (yellow). If the specificity is set to high values, there is a risk that errors start to appear in some low contrast regions. This largely depends on the balance between false positives and false negatives in terms of corrected regions.</p>
      </caption>
      <graphic xlink:href="pone.0223440.g003"/>
    </fig>
    <p>In most of the slice (and the volume), the registration accuracy is well within the submillimetre regime. However, especially in low contrast areas the algorithm may show some small inaccuracies. This mainly proliferates when there is also another gradient in the image (e.g. the pial surface) on which the algorithm starts to fix the boundaries. This is largely related to the fine line between obtaining sufficient specificity and overfitting the data.</p>
    <p>We performed RBR on a (resting state) dataset intended for laminar analysis consisting of 11 subjects. The boundaries after a 12 DoF <monospace>bbregister</monospace> were recursively registered to the mean EPI images (0.93 mm isotropic resolution) and this yielded an updated cortical surface. The new surface followed the grey matter boundary in the volume visibly better than the unregistered one. In <xref ref-type="fig" rid="pone.0223440.g004">Fig 4</xref> we present a single slice with both sets of boundaries overlaid on top of them, illustrating the improvement. We here present the data for a representative subject, and identical images for all other subjects are presented in <xref ref-type="supplementary-material" rid="pone.0223440.s001">S1 Fig</xref>.</p>
    <fig id="pone.0223440.g004" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pone.0223440.g004</object-id>
      <label>Fig 4</label>
      <caption>
        <title>Distortion correction of 7T 3D EPI data, obtained with 0.93 mm isotropic resolution.</title>
        <p>In red, the original brain surfaces are shown after a 12 DoF registration performed by <monospace>bbregister</monospace>. The mesh in green is the updated mesh by means of the first stage RBR, 2 DoF (scale and translation in the PE direction). The green boundaries follow the white matter boundary much better. The voxel displacement map (lower right) shows displacements on the order of several millimetres. The control point lattice that was used to displace the boundaries are overlaid onto the displacement map. Similar images for all subjects can be found in the supplementary materials. For even better inspection, movie files for all subjects are included in the online supplemental materials.</p>
      </caption>
      <graphic xlink:href="pone.0223440.g004"/>
    </fig>
    <p>By the nature of the algorithm the displacements are weighted averages of several iterations of correction. As a result, in regions of drop-out or low contrast and thereby high computational uncertainty, the algorithm will default to ‘no change’, especially in the finer iterations. However, in the earlier coarser iterations, low-signal regions may be drawn towards higher contrast regions in order to optimise spurious boundaries. As a result, highly distorted regions and drop-out regions may not be corrected accurately, of which the frontal region of <xref ref-type="fig" rid="pone.0223440.g004">Fig 4</xref> is an example. It should be noted, however, that these regions are unlikely to be suitable for high-precision analysis and thereby outside the scope of the intended use cases of RBR.</p>
    <p>Additionally, <xref ref-type="fig" rid="pone.0223440.g005">Fig 5</xref> shows the AAD of the registration on salted images with respect to the registration on the no-noise volume. Even for highly noisy images, the registration improves somewhat with respect to the uncorrected boundaries. In the absence of a gold standard model of the distortions, the monotonic decrease of the AAD indicates that RBR converges to an optimum as a function of data quality.</p>
    <fig id="pone.0223440.g005" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pone.0223440.g005</object-id>
      <label>Fig 5</label>
      <caption>
        <title>The effect of adding noise on the computed average absolute displacement with respect to a no-noise registration.</title>
        <p>In the absence of knowledge about the true distortions, the monotonic decrease of the AAD indicates that RBR converges to an optimum as a function of data quality.</p>
      </caption>
      <graphic xlink:href="pone.0223440.g005"/>
    </fig>
    <sec sec-type="data-availability" id="sec009">
      <title>Data availability</title>
      <p>All source code for the registration algorithm is freely available under the GPL 3.0 license at <ext-link ext-link-type="uri" xlink:href="https://github.com/TimVanMourik/OpenFmriAnalysis">https://github.com/TimVanMourik/OpenFmriAnalysis</ext-link>.</p>
      <p>The respective modules are also available in Porcupine and GiraffeTools, visual pipeline tools that automatically creates custom analysis scripts [<xref rid="pone.0223440.ref037" ref-type="bibr">37</xref>]. An example pipeline with all modules in the context of laminar analysis is set up in <ext-link ext-link-type="uri" xlink:href="https://giraffe.tools/workflow/TimVanMourik/OpenFmriAnalysis">https://giraffe.tools/workflow/TimVanMourik/OpenFmriAnalysis</ext-link>.</p>
      <p>All code to generate the images in this paper are available at the Donders Repository <ext-link ext-link-type="uri" xlink:href="http://hdl.handle.net/11633/di.dccn.DSC_3015016.05_558">http://hdl.handle.net/11633/di.dccn.DSC_3015016.05_558</ext-link>. Specifically, the repository contains 1 subject for the FLASH acquisition and 11 experimental data sets for the MPRAGE-to-EPI distortion correction procedure (sequence parameters are described in the method section).</p>
      <p>The data set associated with our distortion simulation on a FLASH image contains a single high-resolution high-SNR multi-echo FLASH volume and an anatomical scan with a FreeSurfer surface reconstruction. It provides all code to perform the field map based distortion simulations, the RBR non-linear distortion corrections of the simulated volumes, and the code to produce Figs <xref ref-type="fig" rid="pone.0223440.g002">2</xref> and <xref ref-type="fig" rid="pone.0223440.g003">3</xref>.</p>
      <p>The data set associated with the EPI distortion correction includes for each subject a structural scan with a FreeSurfer reconstruction and the mean of the functional acquisition. The raw time series are available upon request, but are not included as we do not perform any temporal analysis. We further include all derived files as produced by the <monospace>MasterScript.m</monospace> MATLAB script. This script first performs a linear boundary based registration and subsequently our proposed non-linear recursive boundary based registration. It further saves the registered cortical surfaces to a MATLAB readable format and outputs movie files that scroll through the brain with corrected and uncorrected surfaces as animated plots. The code proceeds with adding noise to the images (for the previously described AAD analysis), recomputes the non-linear registrations, and produces the base of Figs <xref ref-type="fig" rid="pone.0223440.g004">4</xref> and <xref ref-type="fig" rid="pone.0223440.g005">5</xref>.</p>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec010">
    <title>Discussion and conclusions</title>
    <p>In recent years, laminar specific fMRI analysis has come in reach for human in vivo experiments. Where standard fMRI analyses are done on a routine basis, this is hardly the case for layer specific analysis, not least because of the large amount of manual work that is involved. Aligning volumes to adjust for subject motion and non-linear distortion is one of the most challenging parts of the pipeline. With Recursive Boundary Registration (RBR) we here propose a solution to this problem by means of a recursive application of Boundary Based Registration. By using a control point lattice that forms the basis of deforming the mesh, the topology of the surface is preserved. This way, the mesh can easily be fed into next steps in making a cortical layering (Level Set Method) where it is an absolute necessity that the mesh is not broken as a result of the transformations. Due to the large number of degrees of freedom that are required to non-linearly deform a volume, we built in several methods to increase robustness. Nonetheless, as a mathematical certainty, increasing the sensitivity will increase the false positive rate, i.e. the risk of overfitting. It is up to the user to find the desired balance between them in the settings that we provide to control this balance. We hence provide the full code and data of all our experiments online, in order to aid users in adopting this method and fine-tuning the parameters for their use case. Guidance with respect to parameters, their defaults, and possible alternatives are documented in the code. Although RBR supports translation, rotation and scaling in any direction, it must be noted that our test cases were one-dimensional corrections. The dominant distortion in the phase encoding direction is typically an order of magnitude larger than in other directions and it is therefore logical to adjust the settings accordingly.</p>
    <p>To ensure the functionality of this method, several conditions have to be met. A good reconstruction of the cortical surface is essential, as any inaccuracies will directly affect the contrast estimation and hence the registration optimisation. As the algorithm is based on edge detection, the volume to which it is registered needs to have sufficient contrast between white and grey matter. Furthermore, RBR is recommended to be initialised by a linear BBR registration. While RBR excels at subtle non-linear deformations, large displacement at any level may not be found in a rough multidimensional landscape through which the gradient descent method has to find its way to a minimum. In general, a gradient descent method may be difficult to monitor as it is susceptible to local minima trapping. A more robust algorithm may be a good improvement to RBR (e.g. using bounded gradient descents, or Monte Carlo sampling). Additional points of improvement could be the way in which the control point lattice is applied. While the subdivision into tetrahedra guarantees continuity across segments, it has a non-symmetrical orientation. The resulting displacement hence may show a residual bias as a result of the division. A smoother curve fitting technique to replace the current tetrehedral solution may be a valuable improvement, for example a diffeomorphic version as implemented in ANTS [<xref rid="pone.0223440.ref038" ref-type="bibr">38</xref>].</p>
    <p>This algorithm in its current implementation focuses only on the <italic>gradient</italic> around the gray and the white matter, without looking at the intensity value. One could imagine this to be problematic when RBR is applied to a volume where a similar gradient of the same direction is present, for example the grey matter to CSF gradient. The algorithm may easily get ‘confused’ about which boundary it needs to converge on. In <inline-formula id="pone.0223440.e020"><alternatives><graphic xlink:href="pone.0223440.e020.jpg" id="pone.0223440.e020g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M20"><mml:msubsup><mml:mi>T</mml:mi><mml:mn>2</mml:mn><mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula>-weighted images in functional studies, this is not usually a problem as the grey matter has a higher intensity value than both CSF and white matter. However, in standard anatomical scans with <italic>T</italic><sub>1</sub> contrast, this is not the case. As a result, RBR may fail due to the great similarity of contrast along both sides of the grey matter. An extension of RBR could focus on using more prior knowledge about the intensity (as opposed to merely the gradient), in order to inform the algorithm which boundary it should use. This may approach solutions like <monospace>regseg</monospace> [<xref rid="pone.0223440.ref024" ref-type="bibr">24</xref>] that was developed in the context of distortion correction for diffusion MRI and presents a combined registration-segmentation method that deals with excessively smooth gradients.</p>
    <p>A common use of non-linear registration is template matching, for example in an anatomical-to-MNI normalisation. RBR has little potential for this type of usage as it is based on finding fine within-subject similarities in a volume, rather than the coarser type of between-subject similarities. More probable potential use cases may be could in the matching of subcortical brain structures that are described with a three-dimensional mesh. Similarly, there is a wide range of more deformable parts of the body (e.g. liver, heart, stomach, etc.) that might benefit from solutions like RBR. Additionally, RBR could find its use in developmental investigations of the brain. Pediatric longitudinal studies may cross-register surfaces obtained from older participants to earlier time points, as FreeSurfer cortical reconstructions get progressively less accurate for younger children.</p>
    <p>We have shown that RBR automates the process of non-linear distortion correction in order to accommodate an extremely high specificity. This is a next step in automated processing of laminar analysis and more routine layer research. We have shown this yields submillimetre accuracy of registration. With the open source and modular way the code is written, the cost function, optimisation algorithm or deformation algorithm could easily be replaced with improved versions, to accommodate ongoing development. Finally, we concur with Saad [<xref rid="pone.0223440.ref039" ref-type="bibr">39</xref>] and Greve [<xref rid="pone.0223440.ref026" ref-type="bibr">26</xref>] in their conclusion to encourage visual inspection of the registration before reliance is placed on its accuracy.</p>
  </sec>
  <sec sec-type="supplementary-material" id="sec011">
    <title>Supporting information</title>
    <supplementary-material content-type="local-data" id="pone.0223440.s001">
      <label>S1 Fig</label>
      <caption>
        <title>Distortion correction of 7T 3D EPI data, obtained with 0.93 mm isotropic resolution.</title>
        <p>In red, the original brain surfaces are shown after a 12 DoF registration performed by <monospace>bbregister</monospace>. The mesh in green is the updated mesh by means of the first stage RBR, 2 DoF (scale and translation in the PE direction). The green boundaries follow the white matter boundary much better. For better inspection, the online supplemental materials include movie files that scroll through the volume. The voxel displacement map (lower right) shows displacements on the order of several millimetres. The control point lattice that was used to displace the boundaries are overlaid onto the displacement map. These are single slice images of the registration performance for all other 10 subjects. More detailed information can be found in the online data sharing collection.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pone.0223440.s001.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0223440.s002">
      <label>S2 Fig</label>
      <caption>
        <title>Registration performance of the FLASH data compared to a gold standard, as described in the <xref ref-type="sec" rid="sec008">Results</xref> section.</title>
        <p>The difference of the registered boundaries and the gold standard is colour coded in the figure. A detailed movie that displays the 3D information of the registration quality of the entire volume can be found in the online supplementary materials. The mid slice of the registration performed on a manually distorted FLASH image is shown. The image on the left shows the boundaries after applying a manual distortion. The image on the right shows the remaining distortion after RBR correction. The surfaces are colour coded with the displacement in millimetres with respect to the gold standard.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pone.0223440.s002.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>The authors would like to thank Irati Markuerkiaga for helping with collecting (and recollecting) the FLASH data set.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="pone.0223440.ref001">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Dumoulin</surname><given-names>SO</given-names></name>, <name><surname>Fracasso</surname><given-names>A</given-names></name>, <name><surname>van der Zwaag</surname><given-names>W</given-names></name>, <name><surname>Siero</surname><given-names>JCW</given-names></name>, <name><surname>Petridou</surname><given-names>N</given-names></name>. <article-title>Ultra-high field MRI: Advancing systems neuroscience towards mesoscopic human brain function</article-title>. <source>NeuroImage</source>. <year>2017</year>;<pub-id pub-id-type="doi">10.1016/j.neuroimage.2017.01.028</pub-id>.</mixed-citation>
    </ref>
    <ref id="pone.0223440.ref002">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>Trampel</surname><given-names>R</given-names></name>, <name><surname>Bazin</surname><given-names>PL</given-names></name>, <name><surname>Pine</surname><given-names>K</given-names></name>, <name><surname>Weiskopf</surname><given-names>N</given-names></name>. <article-title>In-vivo magnetic resonance imaging (MRI) of laminae in the human cortex</article-title>. <source>NeuroImage</source>. <year>2017</year>;<pub-id pub-id-type="doi">10.1016/j.neuroimage.2017.09.037</pub-id>.</mixed-citation>
    </ref>
    <ref id="pone.0223440.ref003">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Koopmans</surname><given-names>PJ</given-names></name>, <name><surname>Barth</surname><given-names>M</given-names></name>, <name><surname>Orzada</surname><given-names>S</given-names></name>, <name><surname>Norris</surname><given-names>DG</given-names></name>. <article-title>Multi-echo fMRI of the cortical laminae in humans at 7 T</article-title>. <source>Neuroimage</source>. <year>2011</year>;<volume>56</volume>(<issue>3</issue>):<fpage>1276</fpage>–<lpage>1285</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuroimage.2011.02.042</pub-id><?supplied-pmid 21338697?><pub-id pub-id-type="pmid">21338697</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref004">
      <label>4</label>
      <mixed-citation publication-type="journal"><name><surname>Muckli</surname><given-names>L</given-names></name>, <name><surname>De Martino</surname><given-names>F</given-names></name>, <name><surname>Vizioli</surname><given-names>L</given-names></name>, <name><surname>Petro</surname><given-names>L</given-names></name>, <name><surname>Smith</surname><given-names>F</given-names></name>, <name><surname>Ugurbil</surname><given-names>K</given-names></name>, <etal>et al</etal><article-title>Contextual Feedback to Superficial Layers of V1</article-title>. <source>Current Biology</source>. <year>2015</year>;<volume>25</volume>(<issue>20</issue>):<fpage>2690</fpage>–<lpage>2695</lpage>. <pub-id pub-id-type="doi">10.1016/j.cub.2015.08.057</pub-id><?supplied-pmid 26441356?><pub-id pub-id-type="pmid">26441356</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref005">
      <label>5</label>
      <mixed-citation publication-type="journal"><name><surname>Kok</surname><given-names>P</given-names></name>, <name><surname>Bains</surname><given-names>L</given-names></name>, <name><surname>van Mourik</surname><given-names>T</given-names></name>, <name><surname>Norris</surname><given-names>D</given-names></name>, <name><surname>de Lange</surname><given-names>F</given-names></name>. <article-title>Selective Activation of the Deep Layers of the Human Primary Visual Cortex by Top-Down Feedback</article-title>. <source>Current Biology</source>. <year>2016</year>;<volume>26</volume>(<issue>3</issue>):<fpage>371</fpage>–<lpage>376</lpage>. <pub-id pub-id-type="doi">10.1016/j.cub.2015.12.038</pub-id><?supplied-pmid 26832438?><pub-id pub-id-type="pmid">26832438</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref006">
      <label>6</label>
      <mixed-citation publication-type="journal"><name><surname>Felleman</surname><given-names>DJ</given-names></name>, <name><surname>Van Essen</surname><given-names>DC</given-names></name>. <article-title>Distributed hierarchical processing in the primate cerebral cortex</article-title>. <source>Cerebral cortex</source>. <year>1991</year>;<volume>1</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>47</lpage>.<?supplied-pmid 1822724?><pub-id pub-id-type="pmid">1822724</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref007">
      <label>7</label>
      <mixed-citation publication-type="journal"><name><surname>Self</surname><given-names>MW</given-names></name>, <name><surname>van Kerkoerle</surname><given-names>T</given-names></name>, <name><surname>Goebel</surname><given-names>R</given-names></name>, <name><surname>Roelfsema</surname><given-names>PR</given-names></name>. <article-title>Benchmarking laminar fMRI: Neuronal spiking and synaptic activity during top-down and bottom-up processing in the different layers of cortex</article-title>. <source>NeuroImage</source>. <year>2017</year>;<pub-id pub-id-type="doi">10.1016/j.neuroimage.2017.06.045</pub-id>.<?supplied-pmid 28648888?><pub-id pub-id-type="pmid">28648888</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref008">
      <label>8</label>
      <mixed-citation publication-type="other">Zilles K. Cortex. The human nervous system; 1990.</mixed-citation>
    </ref>
    <ref id="pone.0223440.ref009">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>Fischl</surname><given-names>B</given-names></name>, <name><surname>Dale</surname><given-names>AM</given-names></name>. <article-title>Measuring the thickness of the human cerebral cortex from magnetic resonance images</article-title>. <source>Proceedings of the National Academy of Sciences of the United States of Americal</source>. <year>2000</year>;<volume>97</volume>(<issue>20</issue>):<fpage>11050</fpage>–<lpage>11055</lpage>. <pub-id pub-id-type="doi">10.1073/pnas.200033797</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref010">
      <label>10</label>
      <mixed-citation publication-type="journal"><name><surname>Poser</surname><given-names>BA</given-names></name>, <name><surname>Setsompop</surname><given-names>K</given-names></name>. <article-title>Pulse sequences and parallel imaging for high spatiotemporal resolution MRI at ultra-high field</article-title>. <source>NeuroImage</source>. <year>2017</year>;<pub-id pub-id-type="doi">10.1016/j.neuroimage.2017.04.006</pub-id>.</mixed-citation>
    </ref>
    <ref id="pone.0223440.ref011">
      <label>11</label>
      <mixed-citation publication-type="journal"><name><surname>Mansfield</surname><given-names>P</given-names></name>. <article-title>Multi-planar image formation using NMR spin echoes</article-title>. <source>Journal of Physics C: Solid State Physics</source>. <year>1977</year>;<volume>10</volume>(<issue>3</issue>):<fpage>L55</fpage><pub-id pub-id-type="doi">10.1088/0022-3719/10/3/004</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref012">
      <label>12</label>
      <mixed-citation publication-type="book"><name><surname>Schmitt</surname><given-names>F</given-names></name>, <name><surname>Stehling</surname><given-names>MK</given-names></name>, <name><surname>Turner</surname><given-names>R</given-names></name>. <source>Echo-Planar Imaging, Theory, Technique and Application</source>. <publisher-name>Springer</publisher-name>; <year>1998</year>.</mixed-citation>
    </ref>
    <ref id="pone.0223440.ref013">
      <label>13</label>
      <mixed-citation publication-type="journal"><name><surname>Dale</surname><given-names>AM</given-names></name>, <name><surname>Fischl</surname><given-names>B</given-names></name>, <name><surname>Sereno</surname><given-names>MI</given-names></name>. <article-title>Cortical Surface-Based Analysis: I. Segmentation and Surface Reconstruction</article-title>. <source>NeuroImage</source>. <year>1999</year>;<volume>9</volume>(<issue>2</issue>):<fpage>179</fpage>—<lpage>194</lpage>. <pub-id pub-id-type="doi">10.1006/nimg.1998.0395</pub-id>.<pub-id pub-id-type="pmid">9931268</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref014">
      <label>14</label>
      <mixed-citation publication-type="journal"><name><surname>Bazin</surname><given-names>PL</given-names></name>, <name><surname>Weiss</surname><given-names>M</given-names></name>, <name><surname>Dinse</surname><given-names>J</given-names></name>, <name><surname>Schäfer</surname><given-names>A</given-names></name>, <name><surname>Trampel</surname><given-names>R</given-names></name>, <name><surname>Turner</surname><given-names>R</given-names></name>. <article-title>A computational framework for ultra-high resolution cortical segmentation at 7Tesla</article-title>. <source>Neuroimage</source>. <year>2014</year>;<volume>93</volume>:<fpage>201</fpage>–<lpage>209</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuroimage.2013.03.077</pub-id><?supplied-pmid 23623972?><pub-id pub-id-type="pmid">23623972</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref015">
      <label>15</label>
      <mixed-citation publication-type="journal"><name><surname>Goebel</surname><given-names>R</given-names></name>. <article-title>BrainVoyager—Past, present, future</article-title>. <source>NeuroImage</source>. <year>2012</year>;<volume>62</volume>(<issue>2</issue>):<fpage>748</fpage>—<lpage>756</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuroimage.2012.01.083</pub-id>.<pub-id pub-id-type="pmid">22289803</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref016">
      <label>16</label>
      <mixed-citation publication-type="journal"><name><surname>Ress</surname><given-names>D</given-names></name>, <name><surname>Glover</surname><given-names>GH</given-names></name>, <name><surname>Liu</surname><given-names>J</given-names></name>, <name><surname>Wandell</surname><given-names>B</given-names></name>. <article-title>Laminar profiles of functional activity in the human brain</article-title>. <source>NeuroImage</source>. <year>2007</year>;<volume>34</volume>(<issue>1</issue>):<fpage>74</fpage>—<lpage>84</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuroimage.2006.08.020</pub-id>.<?supplied-pmid 17011213?><pub-id pub-id-type="pmid">17011213</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref017">
      <label>17</label>
      <mixed-citation publication-type="journal"><name><surname>Koopmans</surname><given-names>PJ</given-names></name>, <name><surname>Barth</surname><given-names>M</given-names></name>, <name><surname>Norris</surname><given-names>DG</given-names></name>. <article-title>Layer-specific BOLD activation in human V1</article-title>. <source>Human Brain Mapping</source>. <year>2010</year>;<volume>31</volume>(<issue>9</issue>):<fpage>1297</fpage>–<lpage>1304</lpage>. <pub-id pub-id-type="doi">10.1002/hbm.20936</pub-id><?supplied-pmid 20082333?><pub-id pub-id-type="pmid">20082333</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref018">
      <label>18</label>
      <mixed-citation publication-type="journal"><name><surname>Kashyap</surname><given-names>S</given-names></name>, <name><surname>Ivanov</surname><given-names>D</given-names></name>, <name><surname>Havlicek</surname><given-names>M</given-names></name>, <name><surname>Poser</surname><given-names>BA</given-names></name>, <name><surname>Uludag</surname><given-names>K</given-names></name>. <article-title>Impact of acquisition and analysis strategies on cortical depth-dependent fMRI</article-title>. <source>NeuroImage</source>. <year>2017</year>;<pub-id pub-id-type="doi">10.1016/j.neuroimage.2017.05.022</pub-id>.</mixed-citation>
    </ref>
    <ref id="pone.0223440.ref019">
      <label>19</label>
      <mixed-citation publication-type="journal"><name><surname>Huber</surname><given-names>L</given-names></name>, <name><surname>Handwerker</surname><given-names>DA</given-names></name>, <name><surname>Jangraw</surname><given-names>DC</given-names></name>, <name><surname>Chen</surname><given-names>G</given-names></name>, <name><surname>Hall</surname><given-names>A</given-names></name>, <name><surname>Stüber</surname><given-names>C</given-names></name>, <etal>et al</etal><article-title>High-Resolution CBV-fMRI Allows Mapping of Laminar Activity and Connectivity of Cortical Input and Output in Human M1</article-title>. <source>Neuron</source>. <year>2017</year>;<volume>96</volume>(<issue>6</issue>):<fpage>1253</fpage>–<lpage>1263.e7</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuron.2017.11.005</pub-id><?supplied-pmid 29224727?><pub-id pub-id-type="pmid">29224727</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref020">
      <label>20</label>
      <mixed-citation publication-type="journal"><name><surname>Scheeringa</surname></name>, <name><surname>Koopmans</surname></name>, <name><surname>van Mourik</surname></name>, <name><surname>Norris</surname></name>, <name><surname>Jensen</surname></name>. <article-title>The relationship between oscillatory EEG activity and the laminar-specific BOLD signal</article-title>. <source>PNAS</source>. <year>2016</year><pub-id pub-id-type="doi">10.1073/pnas.1522577113</pub-id><?supplied-pmid 27247416?><pub-id pub-id-type="pmid">27247416</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref021">
      <label>21</label>
      <mixed-citation publication-type="journal"><name><surname>Jezzard</surname><given-names>P</given-names></name>, <name><surname>Balaban</surname><given-names>RS</given-names></name>. <article-title>Correction for geometric distortion in echo planar images from B0 field variations</article-title>. <source>Magnetic Resonance in Medicine</source>. <year>1995</year>;<volume>34</volume>(<issue>1</issue>):<fpage>65</fpage>–<lpage>73</lpage>. <pub-id pub-id-type="doi">10.1002/mrm.1910340111</pub-id><?supplied-pmid 7674900?><pub-id pub-id-type="pmid">7674900</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref022">
      <label>22</label>
      <mixed-citation publication-type="journal"><name><surname>Togo</surname><given-names>H</given-names></name>, <name><surname>Rokicki</surname><given-names>J</given-names></name>, <name><surname>Yoshinaga</surname><given-names>K</given-names></name>, <name><surname>Hisatsune</surname><given-names>T</given-names></name>, <name><surname>Matsuda</surname><given-names>H</given-names></name>, <name><surname>Haga</surname><given-names>N</given-names></name>, <etal>et al</etal><article-title>Effects of Field-Map Distortion Correction on Resting State Functional Connectivity MRI</article-title>. <source>Frontiers in Neuroscience</source>. <year>2017</year>;<volume>11</volume>:<fpage>656</fpage><pub-id pub-id-type="doi">10.3389/fnins.2017.00656</pub-id><?supplied-pmid 29249930?><pub-id pub-id-type="pmid">29249930</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref023">
      <label>23</label>
      <mixed-citation publication-type="journal"><name><surname>Dymerska</surname><given-names>B</given-names></name>, <name><surname>Poser</surname><given-names>BA</given-names></name>, <name><surname>Barth</surname><given-names>M</given-names></name>, <name><surname>Trattnig</surname><given-names>S</given-names></name>, <name><surname>Robinson</surname><given-names>SD</given-names></name>. <article-title>A method for the dynamic correction of B0-related distortions in single-echo EPI at 7T</article-title>. <source>NeuroImage</source>. <year>2018</year>;<volume>168</volume>:<fpage>321</fpage>–<lpage>331</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuroimage.2016.07.009</pub-id><?supplied-pmid 27397624?><pub-id pub-id-type="pmid">27397624</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref024">
      <label>24</label>
      <mixed-citation publication-type="journal"><name><surname>Esteban</surname><given-names>O</given-names></name>, <name><surname>Zosso</surname><given-names>D</given-names></name>, <name><surname>Daducci</surname><given-names>A</given-names></name>, <name><surname>Bach-Cuadra</surname><given-names>M</given-names></name>, <name><surname>Ledesma-Carbayo</surname><given-names>MJ</given-names></name>, <name><surname>Thiran</surname><given-names>J-P</given-names></name>, <name><surname>Santos</surname><given-names>A</given-names></name>. <article-title>Surface-driven registration method for the structure-informed segmentation of diffusion MR images</article-title>. <source>NeuroImage</source>. <year>2016</year>;<volume>139</volume>:<fpage>450</fpage>–<lpage>461</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuroimage.2016.05.011</pub-id><pub-id pub-id-type="pmid">27165759</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref025">
      <label>25</label>
      <mixed-citation publication-type="journal"><name><surname>Cox</surname><given-names>RW</given-names></name>. <article-title>AFNI: Software for Analysis and Visualization of Functional Magnetic Resonance Neuroimages</article-title>. <source>Computers and Biomedical Research</source>. <year>1996</year>;<volume>29</volume>(<issue>3</issue>):<fpage>162</fpage>—<lpage>173</lpage>. <pub-id pub-id-type="doi">10.1006/cbmr.1996.0014</pub-id>.<?supplied-pmid 8812068?><pub-id pub-id-type="pmid">8812068</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref026">
      <label>26</label>
      <mixed-citation publication-type="journal"><name><surname>Greve</surname><given-names>DN</given-names></name>, <name><surname>Fischl</surname><given-names>B</given-names></name>. <article-title>Accurate and robust brain image alignment using boundary-based registration</article-title>. <source>NeuroImage</source>. <year>2009</year>;<volume>48</volume>(<issue>1</issue>):<fpage>63</fpage>—<lpage>72</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuroimage.2009.06.060</pub-id>.<?supplied-pmid 19573611?><pub-id pub-id-type="pmid">19573611</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref027">
      <label>27</label>
      <mixed-citation publication-type="journal"><name><surname>Waehnert</surname><given-names>MD</given-names></name>, <name><surname>Dinse</surname><given-names>J</given-names></name>, <name><surname>Weiss</surname><given-names>M</given-names></name>, <name><surname>Streicher</surname><given-names>MN</given-names></name>, <name><surname>Waehnert</surname><given-names>P</given-names></name>, <name><surname>Geyer</surname><given-names>S</given-names></name>, <etal>et al</etal><article-title>Anatomically motivated modeling of cortical laminae</article-title>. <source>Neuroimage</source>. <year>2014</year>;<volume>93</volume><issue>Pt 2</issue>:<fpage>210</fpage>–<lpage>220</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuroimage.2013.03.078</pub-id><?supplied-pmid 23603284?><pub-id pub-id-type="pmid">23603284</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref028">
      <label>28</label>
      <mixed-citation publication-type="other">Leprince Y, Poupon F, Delzescaux T, Hasboun D, Poupon C, Rivière D. Combined Laplacian-equivolumic model for studying cortical lamination with ultra high field MRI (7 T). In: Biomedical Imaging (ISBI), 2015 IEEE 12th International Symposium on; 2015. p. 580–583.</mixed-citation>
    </ref>
    <ref id="pone.0223440.ref029">
      <label>29</label>
      <mixed-citation publication-type="journal"><name><surname>Jenkinson</surname><given-names>M</given-names></name>, <name><surname>Smith</surname><given-names>S</given-names></name>. <article-title>A global optimisation method for robust affine registration of brain images</article-title>. <source>Medical Image Analysis</source>. <year>2001</year>;<volume>5</volume>(<issue>2</issue>):<fpage>143</fpage>—<lpage>156</lpage>. <pub-id pub-id-type="doi">10.1016/S1361-8415(01)00036-6</pub-id>.<?supplied-pmid 11516708?><pub-id pub-id-type="pmid">11516708</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref030">
      <label>30</label>
      <mixed-citation publication-type="journal"><name><surname>Collins</surname><given-names>DL</given-names></name>, <name><surname>Holmes</surname><given-names>CJ</given-names></name>, <name><surname>Peters</surname><given-names>TM</given-names></name>, <name><surname>Evans</surname><given-names>AC</given-names></name>. <article-title>Automatic 3-D model-based neuroanatomical segmentation</article-title>. <source>Human Brain Mapping</source>. <year>1995</year>;<volume>3</volume>(<issue>3</issue>):<fpage>190</fpage>–<lpage>208</lpage>. <pub-id pub-id-type="doi">10.1002/hbm.460030304</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref031">
      <label>31</label>
      <mixed-citation publication-type="book"><name><surname>Sethian</surname><given-names>JA</given-names></name>. <source>Level Set Methods and Fast Marching Methods</source>. <publisher-name>Cambridge University Press</publisher-name>; <year>1999</year>.</mixed-citation>
    </ref>
    <ref id="pone.0223440.ref032">
      <label>32</label>
      <mixed-citation publication-type="journal"><name><surname>Delaunay</surname><given-names>B</given-names></name>. <article-title>Sur la sphere vide</article-title>. <source>Izv Akad Nauk SSSR, Otdelenie Matematicheskii i Estestvennyka Nauk</source>. <year>1934</year>;<volume>7</volume><issue>(793-800)</issue>:<fpage>1</fpage>–<lpage>2</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0223440.ref033">
      <label>33</label>
      <mixed-citation publication-type="journal"><name><surname>Haase</surname><given-names>A</given-names></name>, <name><surname>Frahm</surname><given-names>J</given-names></name>, <name><surname>Matthaei</surname><given-names>D</given-names></name>, <name><surname>Hanicke</surname><given-names>W</given-names></name>, <name><surname>Merboldt</surname><given-names>KD</given-names></name>. <article-title>FLASH imaging. Rapid NMR imaging using low flip-angle pulses</article-title>. <source>Journal of Magnetic Resonance (1969)</source>. <year>1986</year>;<volume>67</volume>(<issue>2</issue>):<fpage>258</fpage>—<lpage>266</lpage>. <pub-id pub-id-type="doi">10.1016/0022-2364(86)90433-6</pub-id>.</mixed-citation>
    </ref>
    <ref id="pone.0223440.ref034">
      <label>34</label>
      <mixed-citation publication-type="journal"><name><surname>Andersson</surname><given-names>JLR</given-names></name>, <name><surname>Hutton</surname><given-names>C</given-names></name>, <name><surname>Ashburner</surname><given-names>J</given-names></name>, <name><surname>Turner</surname><given-names>R</given-names></name>, <name><surname>Friston</surname><given-names>K</given-names></name>. <article-title>Modeling Geometric Deformations in {EPI} Time Series</article-title>. <source>NeuroImage</source>. <year>2001</year>;<volume>13</volume>(<issue>5</issue>):<fpage>903</fpage>—<lpage>919</lpage>. <pub-id pub-id-type="doi">10.1006/nimg.2001.0746</pub-id>.<pub-id pub-id-type="pmid">11304086</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref035">
      <label>35</label>
      <mixed-citation publication-type="journal"><name><surname>Poser</surname><given-names>BA</given-names></name>, <name><surname>Koopmans</surname><given-names>PJ</given-names></name>, <name><surname>Witzel</surname><given-names>T</given-names></name>, <name><surname>Wald</surname><given-names>LL</given-names></name>, <name><surname>Barth</surname><given-names>M</given-names></name>. <article-title>Three dimensional echo-planar imaging at 7 Tesla</article-title>. <source>Neuroimage</source>. <year>2010</year>;<volume>51</volume>(<issue>1</issue>):<fpage>261</fpage>–<lpage>266</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuroimage.2010.01.108</pub-id><?supplied-pmid 20139009?><pub-id pub-id-type="pmid">20139009</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref036">
      <label>36</label>
      <mixed-citation publication-type="journal"><name><surname>Marques</surname><given-names>JP</given-names></name>, <name><surname>Kober</surname><given-names>T</given-names></name>, <name><surname>Krueger</surname><given-names>G</given-names></name>, <name><surname>van der Zwaag</surname><given-names>W</given-names></name>, <name><surname>Van de Moortele</surname><given-names>PF</given-names></name>, <name><surname>Gruetter</surname><given-names>R</given-names></name>. <article-title>MP2RAGE, a self bias-field corrected sequence for improved segmentation and T1-mapping at high field</article-title>. <source>Neuroimage</source>. <year>2010</year>;<volume>49</volume>(<issue>2</issue>):<fpage>1271</fpage>–<lpage>1281</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuroimage.2009.10.002</pub-id><?supplied-pmid 19819338?><pub-id pub-id-type="pmid">19819338</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0223440.ref037">
      <label>37</label>
      <mixed-citation publication-type="journal"><name><surname>van Mourik</surname><given-names>T</given-names></name>, <name><surname>Snoek</surname><given-names>L</given-names></name>, <name><surname>Knapen</surname><given-names>T</given-names></name>, <name><surname>Norris</surname><given-names>D</given-names></name>. <article-title>Porcupine: a visual pipeline tool for neuroimaging analysis</article-title>. <source>bioRxiv</source>. <year>2017</year>.</mixed-citation>
    </ref>
    <ref id="pone.0223440.ref038">
      <label>38</label>
      <mixed-citation publication-type="other">Avants B, Tustison N, Song G. Advanced Normalization Tools (ANTS); 2011.</mixed-citation>
    </ref>
    <ref id="pone.0223440.ref039">
      <label>39</label>
      <mixed-citation publication-type="journal"><name><surname>Saad</surname><given-names>ZS</given-names></name>, <name><surname>Glen</surname><given-names>DR</given-names></name>, <name><surname>Chen</surname><given-names>G</given-names></name>, <name><surname>Beauchamp</surname><given-names>MS</given-names></name>, <name><surname>Desai</surname><given-names>R</given-names></name>, <name><surname>Cox</surname><given-names>RW</given-names></name>. <article-title>A new method for improving functional-to-structural {MRI} alignment using local Pearson correlation</article-title>. <source>NeuroImage</source>. <year>2009</year>;<volume>44</volume>(<issue>3</issue>):<fpage>839</fpage>—<lpage>848</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuroimage.2008.09.037</pub-id>.<pub-id pub-id-type="pmid">18976717</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
