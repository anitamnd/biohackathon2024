<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6662285</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/bty1030</article-id>
    <article-id pub-id-type="publisher-id">bty1030</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Data and Text Mining</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>DNABarcodeCompatibility: an R-package for optimizing DNA-barcode combinations in multiplex sequencing experiments</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Trébeau</surname>
          <given-names>Céline</given-names>
        </name>
        <xref ref-type="aff" rid="bty1030-aff1">bty1030-aff1</xref>
        <xref ref-type="aff" rid="bty1030-aff2">bty1030-aff2</xref>
        <xref ref-type="aff" rid="bty1030-aff3">bty1030-aff3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Boutet de Monvel</surname>
          <given-names>Jacques</given-names>
        </name>
        <xref ref-type="aff" rid="bty1030-aff1">bty1030-aff1</xref>
        <xref ref-type="aff" rid="bty1030-aff2">bty1030-aff2</xref>
        <xref ref-type="aff" rid="bty1030-aff3">bty1030-aff3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wong Jun Tai</surname>
          <given-names>Fabienne</given-names>
        </name>
        <xref ref-type="aff" rid="bty1030-aff1">bty1030-aff1</xref>
        <xref ref-type="aff" rid="bty1030-aff2">bty1030-aff2</xref>
        <xref ref-type="aff" rid="bty1030-aff3">bty1030-aff3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Petit</surname>
          <given-names>Christine</given-names>
        </name>
        <xref ref-type="aff" rid="bty1030-aff1">bty1030-aff1</xref>
        <xref ref-type="aff" rid="bty1030-aff2">bty1030-aff2</xref>
        <xref ref-type="aff" rid="bty1030-aff3">bty1030-aff3</xref>
        <xref ref-type="aff" rid="bty1030-aff4">bty1030-aff4</xref>
        <xref ref-type="aff" rid="bty1030-aff5">bty1030-aff5</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0002-2441-9274</contrib-id>
        <name>
          <surname>Etournay</surname>
          <given-names>Raphaël</given-names>
        </name>
        <xref ref-type="aff" rid="bty1030-aff1">bty1030-aff1</xref>
        <xref ref-type="aff" rid="bty1030-aff2">bty1030-aff2</xref>
        <xref ref-type="aff" rid="bty1030-aff3">bty1030-aff3</xref>
        <xref ref-type="corresp" rid="bty1030-cor1"/>
        <!--<email>raphael.etournay@pasteur.fr</email>-->
      </contrib>
    </contrib-group>
    <aff id="bty1030-aff1"><label>bty1030-aff1</label>Unité de Génétique et Physiologie de l’Audition, Département Neuroscience, Institut Pasteur, Paris, France</aff>
    <aff id="bty1030-aff2"><label>bty1030-aff2</label>UMRS 1120, Institut National de la Santé et de la Recherche Médicale, Paris, France</aff>
    <aff id="bty1030-aff3"><label>bty1030-aff3</label>Sorbonne Université, Paris, France</aff>
    <aff id="bty1030-aff4"><label>bty1030-aff4</label>Collège de France, Paris, France. 5Institut de la Vision, Paris, France</aff>
    <aff id="bty1030-aff5"><label>bty1030-aff5</label>Institut de la Vision, Paris, France</aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Valencia</surname>
          <given-names>Alfonso</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="bty1030-cor1">To whom correspondence should be addressed. E-mail: <email>raphael.etournay@pasteur.fr</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>01</day>
      <month>8</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2018-12-21">
      <day>21</day>
      <month>12</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>21</day>
      <month>12</month>
      <year>2018</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>35</volume>
    <issue>15</issue>
    <fpage>2690</fpage>
    <lpage>2691</lpage>
    <history>
      <date date-type="received">
        <day>09</day>
        <month>7</month>
        <year>2018</year>
      </date>
      <date date-type="rev-recd">
        <day>19</day>
        <month>11</month>
        <year>2018</year>
      </date>
      <date date-type="accepted">
        <day>17</day>
        <month>12</month>
        <year>2018</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2018. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2018</copyright-year>
      <license license-type="cc-by-nc" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="bty1030.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>Using adequate DNA barcodes is essential to unambiguously identify each DNA library within a multiplexed set of libraries sequenced using next-generation sequencers. We introduce DNABarcodeCompatibility, an R-package that allows one to design single or dual-barcoding multiplex experiments by imposing desired constraints on the barcodes (including sequencer chemistry, barcode pairwise minimal distance and nucleotide content), while optimizing barcode frequency usage, thereby allowing one to both facilitate the demultiplexing step and spare expensive library-preparation kits. The package comes with a user-friendly interface and a web app developed in Java and Shiny (<ext-link ext-link-type="uri" xlink:href="https://dnabarcodecompatibility.pasteur.fr">https://dnabarcodecompatibility.pasteur.fr</ext-link>), respectively, with the aim to help bridge the expertise of core facilities with the experimental needs of non-experienced users.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p>DNABarcodeCompatibility can be easily extended to fulfil specific project needs. The source codes of the R-package and its user interfaces are publicly available along with documentation at [<ext-link ext-link-type="uri" xlink:href="https://github.com/comoto-pasteur-fr">https://github.com/comoto-pasteur-fr</ext-link>] under the GPL-2 licence.</p>
      </sec>
      <sec id="s3">
        <title>Supplementary information</title>
        <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">European Research Council</named-content>
          <named-content content-type="funder-identifier">10.13039/100010663</named-content>
        </funding-source>
        <award-id>ERC-2011-ADG_294570</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">LabEx LIFESENSES</named-content>
        </funding-source>
        <award-id>ANR-10-LABX-65</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">BNP Paribas Foundation</named-content>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">LHW-Stiftung</named-content>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="2"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Inherent to next-generation sequencing (NGS) techniques is the requirement to provide high enough sequence complexity of barcodes for the design of multiplex experiments, in order to allow for proper demultiplexing, i.e. identifying back each individual sample from a pooled library. In general, finding optimal combinations of compatible barcodes under given experimental constraints (single or dual barcoding, sequencer chemistry, DNA composition, barcode pairwise distance and error correction properties, availability in the laboratory) can become challenging for users. Existing software such as DNABarcodes, checkMyIndex, Illumina Experiment Manager, Barcosel (<xref rid="bty1030-B1" ref-type="bibr">Buschmann, 2017</xref>; <xref rid="bty1030-B3" ref-type="bibr">Somervuo <italic>et al.</italic>, 2018</xref>; <xref rid="bty1030-B4" ref-type="bibr">Varet and Coppée, 2018</xref>) do not provide any integrated tool to automatically refine sets of compatible barcodes given all the above-mentioned constraints. Yet, a rational and general approach allowing to optimize the design of multiplexed NGS experiments under various constraints is highly desirable. To this end, we developed DNABarcodeCompatibility, a generic R-package allowing one to generate potentially large libraries of barcode combinations compatible with most sets of multiplexing constraints and optimized to achieve least-heterogeneity in terms of barcode usage. It is accompanied by a user-friendly interface designed with Illumina barcode-combination rules in mind, while allowing the user to apply constraints specific to other NGS platforms on the distance between barcodes and on the nucleotide composition.</p>
  </sec>
  <sec>
    <title>2 Results</title>
    <sec>
      <title>2.1 Algorithm (DNABarcodeCompatibility R-package)</title>
      <p>We describe here only the main steps and ideas. For details see the <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref>. The inputs of the algorithm are a list of <italic>n</italic> distinct barcodes {<italic>i</italic><sub>1</sub>, … , <italic>i</italic><sub>n</sub>}, the number <italic>N</italic> of required libraries, and the multiplex level <italic>k</italic> to be used for the experiment (so that <italic>N </italic>=<italic>ak</italic>, where <italic>a</italic> is the number of lanes of the flow cells).</p>
      <p><italic>Step 1.</italic> This step consists of identifying a set of barcode combinations that are compatible with the constraints set for the experiment (including pairwise barcode distance, nucleotide content, and sequencer chemistry). Given the number <italic>n</italic> of barcodes and the multiplex level <italic>k</italic>, the total number of barcode combinations (compatible or not) reads<inline-formula id="IE1"><mml:math id="IM1"><mml:mfenced separators="|"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:maligngroup/><mml:mi>n</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:maligngroup/><mml:mi>k</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math></inline-formula>. If this number is not too large (<xref ref-type="supplementary-material" rid="sup1">Supplementary File S1</xref>), the algorithm will perform an exhaustive search and return all compatible combinations of <italic>k</italic> barcodes. Otherwise, it will proceed sequentially by picking up barcode combinations at random, and stopping when a set of <italic>N</italic><sub>comp</sub> distinct compatible combinations has been generated, that is large enough for the next step, entropy maximization, to be effective.</p>
      <p><italic>Step 2</italic>. We then use a Shannon entropy maximization approach to select the <italic>N</italic>/<italic>k</italic> compatible combinations to be used in the experiment out of the <italic>N</italic><sub>comp</sub> combinations found in Step 1. Namely, these combinations are chosen in such a way that the resulting distribution of barcodes has maximum entropy <italic>S</italic>=−∑<sub>i</sub><italic>f<sub>i</sub></italic> log <italic>f<sub>i,</sub></italic>where <italic>f</italic><sub>1</sub>,…, <italic>f</italic><sub>n</sub> denote the frequencies of the various barcodes occurring in the selection. This ensures that this distribution is as uniform as possible given the constraints imposed by the particular set of compatible combinations at hand, thereby optimally balancing the consumable usage to spare library-preparation kits.</p>
      <p>It can be shown (<xref ref-type="supplementary-material" rid="sup1">Supplementary File S2</xref>) that the maximum value of the entropy that can be attained for a selection of a library of <italic>N</italic> barcodes among <italic>n</italic>, with possible repetitions, is given by equation 1:
<disp-formula id="E1"><label>(1)</label><mml:math id="M1"><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>-</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:mfenced><mml:mfrac><mml:mrow><mml:mo>⌊</mml:mo><mml:mfrac><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo>⌋</mml:mo></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:mfrac><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:mo>⌊</mml:mo><mml:mfrac><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo>⌋</mml:mo></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>-</mml:mo><mml:mi>r</mml:mi><mml:mfrac><mml:mrow><mml:mo>⌈</mml:mo><mml:mfrac><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo>⌉</mml:mo></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:mfrac><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:mo>⌈</mml:mo><mml:mfrac><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo>⌉</mml:mo></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math></disp-formula>
in which <italic>r</italic> denotes the rest of the division of <italic>N</italic> by <italic>n</italic>, and<inline-formula id="IE2"><mml:math id="IM2"><mml:mo>⌈</mml:mo><mml:mi>N</mml:mi><mml:mo>/</mml:mo><mml:mi>n</mml:mi><mml:mo>⌉</mml:mo></mml:math></inline-formula> (⌊<italic>N</italic>/<italic>n</italic>⌋) stands for the upper (lower) integer part of <inline-formula id="IE4"><mml:math id="IM3"><mml:mi>N</mml:mi><mml:mo>/</mml:mo><mml:mi>n</mml:mi></mml:math></inline-formula>. This expression reduces to <italic>log</italic> (min (<italic>N</italic>,)), that is the entropy of the uniform distribution, if either <italic>N </italic>&lt;<italic> n</italic> or n divides <italic>N</italic> (<italic>r </italic>=<italic> </italic>0). In our algorithm, we use the <inline-formula id="IE6"><mml:math id="IM4"><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> value as a stopping criterion to perform a randomized greedy search for a selection whose index distribution has maximum entropy. Simulations suggest that this algorithm is near optimal, in the sense that with high probability it finds a solution whose entropy is maximum or very close to maximum. In most cases, the solution found is much improved in terms of reducing the heterogeneity of barcode frequencies, compared to a randomly chosen (non-optimized) selection (see <xref ref-type="supplementary-material" rid="sup1">Supplementary File S1</xref>).</p>
    </sec>
    <sec>
      <title>2.2 Graphical user interface</title>
      <p>The DNABarcodeCompatibility user interface harbours two panels for input and output, respectively (<xref ref-type="fig" rid="bty1030-F1">Fig. 1</xref>) Once barcodes are loaded into the interface, the user can easily manipulate the list of barcodes by clicking on them. The interface provides tools to visualize and filter barcodes according to their chemical properties (GC content, i.e. the number of G or C nucleotides divided by the barcode length, and homopolymer length at most 2) and pairwise separation properties according to either the Hamming, SeqLev or phaseshift distance (<xref rid="bty1030-B2" ref-type="bibr">Bystrykh, 2012</xref>; <xref rid="bty1030-B1" ref-type="bibr">Buschmann, 2017</xref>). Next, the application seeks an optimized set of compatible barcodes given the number of libraries and multiplex level. Finally, the interface also allows one to visualize how barcoded libraries are distributed among lanes of flow cells.
</p>
      <fig id="bty1030-F1" orientation="portrait" position="float">
        <label>Fig. 1.</label>
        <caption>
          <p>Graphical user interface: dual-barcoding example. Left panel: input (1–6). Right panel: graphical output of the results (7–8). The user selects the platform (1), loads the barcode datasets (2), selects the number of libraries (3) and the multiplex level (4). Barcodes can be filtered according to their chemical properties and desired pairwise distance (5). They can also be manually unchecked (6). Results are shown in text mode (7), and graphically (8)</p>
        </caption>
        <graphic xlink:href="bty1030f1"/>
      </fig>
    </sec>
  </sec>
  <sec>
    <title>3 Conclusion</title>
    <p>DNABarcodeCompatibility provides a rational optimized design of multiplex sequencing experiments integrating barcode constraints from various NGS platforms including (i) barcode chemical properties, (ii) barcode pairwise distance, (iii) Illumina barcode-combination rules and (iv) barcode frequency usage. Controlling these barcode constraints is not only critical to ensure proper demultiplexing, but also to optimize consumable usage and reduce costs. The major strength of the package lies on its generic features that are applicable to wide range of multiplex pooling design on most NGS platforms. This should be useful notably for spatially and temporally resolved transcriptomics (see <xref ref-type="supplementary-material" rid="sup1">Supplementary File S3</xref> for a comparison of DNABarcodeCompatibility with other existing software).</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>bty1030_Supplementary_File</label>
      <media xlink:href="bty1030_supplementary_file.zip">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We thank Boris Gourévitch, Hugo Varet for useful discussions, Gilles Trébeau for the Java frontend deployment and Jean-Pierre Hardelin for critical reading of the manuscript.</p>
    <sec>
      <title>Funding </title>
      <p>This work was supported by the European Research Council [ERC-2011-ADG_294570]; LabEx LIFESENSES [ANR-10-LABX-65]; BNP Paribas Foundation; and LHW-Stiftung.</p>
      <p><italic>Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="bty1030-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Buschmann</surname><given-names>T.</given-names></name></person-group> (<year>2017</year>) 
<article-title>DNABarcodes: an R package for the systematic construction of DNA sample tags</article-title>. <source>Bioinformatics</source>, <volume>33</volume>, <fpage>920</fpage>–<lpage>922</lpage>.<pub-id pub-id-type="pmid">28052927</pub-id></mixed-citation>
    </ref>
    <ref id="bty1030-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bystrykh</surname><given-names>L.V.</given-names></name></person-group> (<year>2012</year>) 
<article-title>Generalized DNA barcode design based on Hamming codes</article-title>. <source>PLoS One</source>, <volume>7</volume>, <fpage>e36852.</fpage><pub-id pub-id-type="pmid">22615825</pub-id></mixed-citation>
    </ref>
    <ref id="bty1030-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Somervuo</surname><given-names>P.</given-names></name></person-group><etal>et al</etal> (<year>2018</year>) 
<article-title>BARCOSEL: a tool for selecting an optimal barcode set for high-throughput sequencing</article-title>. <source>BMC Bioinformatics</source>, <volume>19</volume>, <fpage>257.</fpage><pub-id pub-id-type="pmid">29976145</pub-id></mixed-citation>
    </ref>
    <ref id="bty1030-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Varet</surname><given-names>H.</given-names></name>, <name name-style="western"><surname>Coppée</surname><given-names>J.-Y.</given-names></name></person-group> (<year>2018</year>) 
<article-title>checkMyIndex: a web-based R/Shiny interface for choosing compatible sequencing indexes</article-title>. <source>Bioinformatics</source>.</mixed-citation>
    </ref>
  </ref-list>
</back>
