<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10262301</article-id>
    <article-id pub-id-type="pmid">33693546</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btab159</article-id>
    <article-id pub-id-type="publisher-id">btab159</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Omixer: multivariate and reproducible sample randomization to proactively counter batch effects in omics studies</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-9209-1266</contrib-id>
        <name>
          <surname>Sinke</surname>
          <given-names>Lucy</given-names>
        </name>
        <xref rid="btab159-cor1" ref-type="corresp"/>
        <aff><institution>Molecular Epidemiology, Department of Biomedical Data Science, Leiden University Medical Centre</institution>, Leiden 2333 ZC, <country country="NL">The Netherlands</country></aff>
        <!--l.j.sinke@lumc.nl-->
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-9684-220X</contrib-id>
        <name>
          <surname>Cats</surname>
          <given-names>Davy</given-names>
        </name>
        <aff><institution>Molecular Epidemiology, Department of Biomedical Data Science, Leiden University Medical Centre</institution>, Leiden 2333 ZC, <country country="NL">The Netherlands</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Heijmans</surname>
          <given-names>Bastiaan T</given-names>
        </name>
        <aff><institution>Molecular Epidemiology, Department of Biomedical Data Science, Leiden University Medical Centre</institution>, Leiden 2333 ZC, <country country="NL">The Netherlands</country></aff>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Martelli</surname>
          <given-names>Pier Luigi</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btab159-cor1">To whom correspondence should be addressed. <email>l.j.sinke@lumc.nl</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>15</day>
      <month>9</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2021-03-08">
      <day>08</day>
      <month>3</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>08</day>
      <month>3</month>
      <year>2021</year>
    </pub-date>
    <volume>37</volume>
    <issue>18</issue>
    <fpage>3051</fpage>
    <lpage>3052</lpage>
    <history>
      <date date-type="received">
        <day>29</day>
        <month>9</month>
        <year>2020</year>
      </date>
      <date date-type="rev-recd">
        <day>02</day>
        <month>2</month>
        <year>2021</year>
      </date>
      <date date-type="editorial-decision">
        <day>27</day>
        <month>2</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>04</day>
        <month>3</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2021. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btab159.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Batch effects heavily impact results in omics studies, causing bias and false positive results, but software to control them preemptively is lacking. Sample randomization prior to measurement is vital for minimizing these effects, but current approaches are often ad hoc, poorly documented and ill-equipped to handle multiple batches and outcomes.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We developed Omixer—a Bioconductor package implementing multivariate and reproducible sample randomization for omics studies. It proactively counters correlations between technical factors and biological variables of interest by optimizing sample distribution across batches.</p>
      </sec>
      <sec id="s3">
        <title>Availabilityand implementation</title>
        <p>Omixer is available from Bioconductor at <ext-link xlink:href="http://bioconductor.org/packages/release/bioc/html/Omixer.html" ext-link-type="uri">http://bioconductor.org/packages/release/bioc/html/Omixer.html</ext-link>. Scripts and data used to generate figures available upon request.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>DIMENSION project</institution>
          </institution-wrap>
        </funding-source>
        <award-id>529051021</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="2"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Batch effects can overshadow biological differences in size (<xref rid="btab159-B1" ref-type="bibr">Baggerly <italic toggle="yes">et al.</italic>, 2008</xref>) and critically influence the results of omics studies (<xref rid="btab159-B5" ref-type="bibr">Harper <italic toggle="yes">et al.</italic>, 2013</xref>; <xref rid="btab159-B7" ref-type="bibr">Lambert and Black, 2012</xref>). Even in benign cases, they decrease power to detect a true biological effect or contaminate results with false positives (<xref rid="btab159-B8" ref-type="bibr">Leek <italic toggle="yes">et al.</italic>, 2010</xref>). Despite the numerous statistical methods developed to adjust for batch effects (<xref rid="btab159-B3" ref-type="bibr">Espin-Perez <italic toggle="yes">et al.</italic>, 2018</xref>; <xref rid="btab159-B6" ref-type="bibr">Johnson <italic toggle="yes">et al.</italic>, 2007</xref>; <xref rid="btab159-B9" ref-type="bibr">van Iterson <italic toggle="yes">et al.</italic>, 2017</xref>), a reactive approach is often insufficient. In fact, when technical variables are confounded with experimental factors of interest, batch effect correction will mask the underlying biological signal (<xref rid="btab159-B4" ref-type="bibr">Goh <italic toggle="yes">et al.</italic>, 2017</xref>).</p>
    <p>Sample randomization is a proactive, and arguably more impactful, method for obtaining reproducible results in high-throughput experiments (<xref rid="btab159-B10" ref-type="bibr">Yang <italic toggle="yes">et al.</italic>, 2008</xref>). However, its implementation suffers from several key issues. Particularly where there are numerous or nested batches each composed of a limited number of samples, such as separate microarrays or sequencing lanes, single random draws can inadvertently result in high correlations between technical covariates and biological factors. This is further complicated by an often poorly documented randomization process that is not necessarily reproducible. Although stratified randomization has been shown to effectively remove chip effects in microarray experiments (<xref rid="btab159-B2" ref-type="bibr">Buhule <italic toggle="yes">et al.</italic>, 2014</xref>), it does not address all relevant biological variables. Therefore, to adequately combat bias in results, employing methods capable of handling a wider array of research setups is imperative.</p>
    <p>We developed Omixer—an R package for multivariate and reproducible randomization in omics studies. From a diverse range of randomized sample layouts, it selects the one that optimally balances biological variables across batches. Omixer offers the flexibility required to perform randomization effectively in a variety of study designs and experimental setups.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>To optimize distribution of biological variables across batches, sample randomization is performed multiple times (default: 1000; see Supplementary Fig. S1 for more information). After combining resulting lists with the user-specified plate layout, statistically robust tests of correlation determine the optimal setup, where the absolute sum of correlations between biological and technical factors is minimized. As a precautionary step, layouts with evidence for any tested batch associations are excluded (<italic toggle="yes">P</italic> &lt; 0.05 for any batch-outcome correlation), although in practice this will not change the resulting layout given suitably large iteration numbers (see <xref rid="btab159-F1" ref-type="fig">Fig. 1A</xref>).</p>
    <fig position="float" id="btab159-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>Overview of Omixer functionality and graphical output with (<bold>A</bold>) distribution of the sum of absolute correlations from 10 000 randomized layouts, coloured by filtering step outcome (<bold>B</bold>) resulting correlation matrices from the (i) optimal Omixer layout, (ii) median result and (iii) worst case scenario after simple randomization and (<bold>C</bold>) lab-friendly sample sheets created by Omixer as a PDF, showing the first plate colour coded by box number</p>
      </caption>
      <graphic xlink:href="btab159f1" position="float"/>
    </fig>
    <p>To reserve wells for control samples or other studies, a mask can be specified in the options, and paired samples such as those from twin studies can be blocked so they remain together in the same batch. Non-standard plate layouts can be specified, but Omixer will automatically generate the most commonly used plate and chip combinations. Previously generated layouts can quickly be reproduced, and lab-friendly sample sheets reduce the risk of mixups when manually pipetting samples.</p>
    <sec>
      <title>2.1 Multivariate and reproducible randomization</title>
      <p>The main function, omixerRand, takes a sample list and plate layout as input and optimizes distribution of specified biological variables across batches. Resulting correlations are visually displayed and the optimal seed is saved locally. By loading this seed, previously generated layouts can be reproduced quickly and efficiently with the omixerSpecific function.</p>
    </sec>
    <sec>
      <title>2.2 Lab-friendly sample sheets</title>
      <p>The omixerSheet function converts the output of previous Omixer functions into lab-friendly sample sheets, saving these in the working directory as a printable PDF. Wells can be coloured by other variables, such as box number (see <xref rid="btab159-F1" ref-type="fig">Fig. 1C</xref>) or tissue, to further smooth transition into the wet lab.</p>
    </sec>
    <sec>
      <title>2.3 Omixer outperforms simple randomization</title>
      <p>Particularly when multiple batch types and outcomes are present, a single randomization is likely to result in significant correlations. As an example, we randomized 672 samples across 2 levels of batches, as described in the Omixer vignette. Following 10 000 simple randomizations, 85% of the resulting layouts have at least one <italic toggle="yes">P</italic>-value under 0.05. The distribution of the sum of absolute correlations for the resulting 10 000 layouts (<xref rid="btab159-F1" ref-type="fig">Fig. 1A</xref>) suggests that the expected sum of correlations between batches and outcomes following a single randomization is 0.5. The correlations present in an average selection (<xref rid="btab159-F1" ref-type="fig">Fig. 1B</xref>.ii) are small on the whole (0.004 to 0.065), but significant associations (<italic toggle="yes">P</italic> &lt; 0.05) still exist.</p>
      <p>Looking at the worst case scenario following simple randomization (<xref rid="btab159-F1" ref-type="fig">Fig. 1B</xref>.iii), we see that simple randomization has the potential to choose layouts with multiple significant associations (<italic toggle="yes">P</italic> &lt; 0.05 for 5 comparisons), resulting in large batch effects that will bias results. By contrast, Omixer would reject all layouts with significant correlations, and instead return an optimal layout from the 15% remaining (blue in <xref rid="btab159-F1" ref-type="fig">Fig. 1A</xref>). In this example, the optimal layout’s correlations (<xref rid="btab159-F1" ref-type="fig">Fig. 1B</xref>.i) are all under 0.037 and none are significant.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Conclusions</title>
    <p>In conclusion, Omixer offers an intuitive, reproducible alternative to current randomization practices in omics research. Its implementation is a key step in combatting batch effects preemptively and reducing the risks of sample mixups in the wet lab.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the Joint Programming Initiative ‘a Healthy Diet for a Healthy Life’ (JPI-HDHL) DIMENSION project [ZonMW project number: 529051021].</p>
    <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>Scripts and data used to generate the images is available upon request. Otherwise, Omixer is a software tool that uses user input data.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btab159_Supplementary_Data</label>
      <media xlink:href="btab159_supplementary_data.zip">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btab159-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Baggerly</surname><given-names>K.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2008</year>) 
<article-title>Run batch effects potentially compromise the usefulness of genomic signatures for ovarian cancer</article-title>. <source>J. Clin. Oncol</source>., <volume>26</volume>, <fpage>1186</fpage>–<lpage>1187</lpage>.<pub-id pub-id-type="pmid">18309960</pub-id></mixed-citation>
    </ref>
    <ref id="btab159-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Buhule</surname><given-names>O.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) 
<article-title>Stratified randomization controls better for batch effects in 450K methylation analysis: a cautionary tale</article-title>. <source>Front. Genet</source>., <volume>5</volume>, <fpage>354</fpage>.<pub-id pub-id-type="pmid">25352862</pub-id></mixed-citation>
    </ref>
    <ref id="btab159-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Espin-Perez</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) 
<article-title>Comparison of statistical methods and the use of quality control samples for batch effect correction in human transcriptomic data</article-title>. <source>PLoS One</source>, <volume>13</volume>, <fpage>e0202947</fpage>.<pub-id pub-id-type="pmid">30161168</pub-id></mixed-citation>
    </ref>
    <ref id="btab159-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Goh</surname><given-names>W.W.B.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) 
<article-title>Why batch effects matter in omics data, and how to avoid them</article-title>. <source>Trends Biotechnol</source>., <volume>35</volume>, <fpage>498</fpage>–<lpage>507</lpage>.<pub-id pub-id-type="pmid">28351613</pub-id></mixed-citation>
    </ref>
    <ref id="btab159-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Harper</surname><given-names>K.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) 
<article-title>Batch effects and pathway analysis: two potential perils in cancer studies involving DNA methylation array analysis</article-title>. <source>Cancer Epidemiol. Biomarkers Prev</source>., <volume>22</volume>, <fpage>1052</fpage>–<lpage>1060</lpage>.<pub-id pub-id-type="pmid">23629520</pub-id></mixed-citation>
    </ref>
    <ref id="btab159-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Johnson</surname><given-names>W.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2007</year>) 
<article-title>Adjusting batch effects in microarray expression data using empirical Bayes methods</article-title>. <source>Biostatistics</source>, <volume>8</volume>, <fpage>118</fpage>–<lpage>127</lpage>.<pub-id pub-id-type="pmid">16632515</pub-id></mixed-citation>
    </ref>
    <ref id="btab159-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lambert</surname><given-names>C.</given-names></string-name>, <string-name><surname>Black</surname><given-names>L.</given-names></string-name></person-group> (<year>2012</year>) 
<article-title>Learning from our GWAS mistakes: from experimental design to scientific method</article-title>. <source>Biostatistics</source>, <volume>13</volume>, <fpage>195</fpage>–<lpage>203</lpage>.<pub-id pub-id-type="pmid">22285994</pub-id></mixed-citation>
    </ref>
    <ref id="btab159-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Leek</surname><given-names>J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2010</year>) 
<article-title>Tackling the widespread and critical impact of batch effects in high-throughput data</article-title>. <source>Nat. Rev. Genet</source>., <volume>11</volume>, <fpage>733</fpage>–<lpage>739</lpage>.<pub-id pub-id-type="pmid">20838408</pub-id></mixed-citation>
    </ref>
    <ref id="btab159-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>van Iterson</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal>; BIOS Consortium. (<year>2017</year>) 
<article-title>Controlling bias and inflation in epigenome- and transcriptome-wide association studies using the empirical null distribution</article-title>. <source>Genome Biol</source>., <volume>18</volume>, <fpage>19</fpage>.<pub-id pub-id-type="pmid">28129774</pub-id></mixed-citation>
    </ref>
    <ref id="btab159-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yang</surname><given-names>H.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2008</year>) 
<article-title>Randomization in laboratory procedure is key to obtaining reproducible microarray results</article-title>. <source>PLoS One</source>, <volume>3</volume>, <fpage>e3724</fpage>.<pub-id pub-id-type="pmid">19009020</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
