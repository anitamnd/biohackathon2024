<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS One</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS One</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-title-group>
      <journal-title>PLoS ONE</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1932-6203</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, CA USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8555789</article-id>
    <article-id pub-id-type="publisher-id">PONE-D-21-03432</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pone.0259349</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Database and Informatics Methods</subject>
          <subj-group>
            <subject>Database Searching</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Database and Informatics Methods</subject>
          <subj-group>
            <subject>Biological Databases</subject>
            <subj-group>
              <subject>Proteomic Databases</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Biochemistry</subject>
          <subj-group>
            <subject>Proteomics</subject>
            <subj-group>
              <subject>Proteomic Databases</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Biochemistry</subject>
          <subj-group>
            <subject>Proteins</subject>
            <subj-group>
              <subject>Post-Translational Modification</subject>
              <subj-group>
                <subject>Phosphorylation</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Biochemistry</subject>
          <subj-group>
            <subject>Proteomics</subject>
            <subj-group>
              <subject>Peptide Libraries</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Computer and Information Sciences</subject>
        <subj-group>
          <subject>Artificial Intelligence</subject>
          <subj-group>
            <subject>Machine Learning</subject>
            <subj-group>
              <subject>Deep Learning</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical Sciences</subject>
        <subj-group>
          <subject>Chemistry</subject>
          <subj-group>
            <subject>Chemical Reactions</subject>
            <subj-group>
              <subject>Oxidation</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Database and Informatics Methods</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Computer and Information Sciences</subject>
        <subj-group>
          <subject>Software Engineering</subject>
          <subj-group>
            <subject>Preprocessing</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Engineering and Technology</subject>
        <subj-group>
          <subject>Software Engineering</subject>
          <subj-group>
            <subject>Preprocessing</subject>
          </subj-group>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SpeCollate: Deep cross-modal similarity network for mass spectrometry data based peptide deductions</article-title>
      <alt-title alt-title-type="running-head">SpeCollate: Deep cross-modal similarity network for mass spectrometry data based peptide deductions</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-4643-3875</contrib-id>
        <name>
          <surname>Tariq</surname>
          <given-names>Muhammad Usman</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/conceptualization/">Conceptualization</role>
        <role content-type="http://credit.niso.org/contributor-roles/investigation/">Investigation</role>
        <role content-type="http://credit.niso.org/contributor-roles/methodology/">Methodology</role>
        <role content-type="http://credit.niso.org/contributor-roles/software/">Software</role>
        <role content-type="http://credit.niso.org/contributor-roles/validation/">Validation</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-original-draft/">Writing – original draft</role>
        <xref rid="aff001" ref-type="aff"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-3410-9552</contrib-id>
        <name>
          <surname>Saeed</surname>
          <given-names>Fahad</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/conceptualization/">Conceptualization</role>
        <role content-type="http://credit.niso.org/contributor-roles/funding-acquisition/">Funding acquisition</role>
        <role content-type="http://credit.niso.org/contributor-roles/methodology/">Methodology</role>
        <role content-type="http://credit.niso.org/contributor-roles/project-administration/">Project administration</role>
        <role content-type="http://credit.niso.org/contributor-roles/resources/">Resources</role>
        <role content-type="http://credit.niso.org/contributor-roles/supervision/">Supervision</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-original-draft/">Writing – original draft</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff001" ref-type="aff"/>
        <xref rid="cor001" ref-type="corresp">*</xref>
      </contrib>
    </contrib-group>
    <aff id="aff001">
      <addr-line>School of Computing &amp; Information Sciences, Florida International University, Miami, FL, United States of America</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Lisacek</surname>
          <given-names>Frederique</given-names>
        </name>
        <role>Editor</role>
        <xref rid="edit1" ref-type="aff"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>Swiss Institute of Bioinformatics, SWITZERLAND</addr-line>
    </aff>
    <author-notes>
      <fn fn-type="COI-statement" id="coi001">
        <p><bold>Competing Interests: </bold>The authors have declared that no competing interests exist.</p>
      </fn>
      <corresp id="cor001">* E-mail: <email>fsaeed@fiu.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>29</day>
      <month>10</month>
      <year>2021</year>
    </pub-date>
    <volume>16</volume>
    <issue>10</issue>
    <elocation-id>e0259349</elocation-id>
    <history>
      <date date-type="received">
        <day>10</day>
        <month>2</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>18</day>
        <month>10</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2021 Tariq, Saeed</copyright-statement>
      <copyright-year>2021</copyright-year>
      <copyright-holder>Tariq, Saeed</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="pone.0259349.pdf"/>
    <abstract>
      <p>Historically, the database search algorithms have been the de facto standard for inferring peptides from mass spectrometry (MS) data. Database search algorithms deduce peptides by transforming theoretical peptides into theoretical spectra and matching them to the experimental spectra. Heuristic similarity-scoring functions are used to match an experimental spectrum to a theoretical spectrum. However, the heuristic nature of the scoring functions and the <italic toggle="yes">simple</italic> transformation of the peptides into theoretical spectra, along with noisy mass spectra for the less abundant peptides, can introduce a cascade of inaccuracies. In this paper, we design and implement a Deep <italic toggle="yes">Cross-Modal</italic> Similarity Network called <italic toggle="yes">SpeCollate</italic>, which overcomes these inaccuracies by learning the similarity function between experimental spectra and peptides directly from the labeled MS data. SpeCollate transforms spectra and peptides into a shared Euclidean subspace by learning fixed size embeddings for both. Our proposed deep-learning network trains on sextuplets of positive and negative examples coupled with our custom-designed <italic toggle="yes">SNAP-loss</italic> function. Online hardest negative mining is used to select the appropriate negative examples for optimal training performance. We use 4.8 million sextuplets obtained from the NIST and MassIVE peptide libraries to train the network and demonstrate that for closed search, SpeCollate is able to perform better than Crux and MSFragger in terms of the number of peptide-spectrum matches (PSMs) and unique peptides identified under 1% FDR for real-world data. SpeCollate also identifies a large number of peptides not reported by either Crux or MSFragger. To the best of our knowledge, our proposed SpeCollate is the first deep-learning network that can determine the cross-modal similarity between peptides and mass-spectra for MS-based proteomics. We believe <italic toggle="yes">SpeCollate</italic> is significant progress towards developing machine-learning solutions for MS-based omics data analysis. SpeCollate is available at <ext-link xlink:href="https://deepspecs.github.io/" ext-link-type="uri">https://deepspecs.github.io/</ext-link>.</p>
    </abstract>
    <funding-group>
      <award-group id="award001">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100007523</institution-id>
            <institution>Division of Advanced Cyberinfrastructure</institution>
          </institution-wrap>
        </funding-source>
        <award-id>OAC 1925960</award-id>
        <principal-award-recipient>
          <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-3410-9552</contrib-id>
          <name>
            <surname>Saeed</surname>
            <given-names>Fahad</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <award-group id="award002">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000057</institution-id>
            <institution>National Institute of General Medical Sciences</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01GM134384</award-id>
        <principal-award-recipient>
          <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-3410-9552</contrib-id>
          <name>
            <surname>Saeed</surname>
            <given-names>Fahad</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <funding-statement>FS: NSF 1925960: National Science Foundation: <ext-link xlink:href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=1925960&amp;HistoricalAwards=false" ext-link-type="uri">https://www.nsf.gov/awardsearch/showAward?AWD_ID=1925960&amp;HistoricalAwards=false</ext-link> FS: NIH 1R01GM134384: National Institutes of Health (NIH): <ext-link xlink:href="https://projectreporter.nih.gov/project_info_details.cfm?aid=9973317&amp;icde=53452532&amp;ddparam=&amp;ddvalue=&amp;ddsub=&amp;cr=2&amp;csb=default&amp;cs=ASC&amp;pball=" ext-link-type="uri">https://projectreporter.nih.gov/project_info_details.cfm?aid=9973317&amp;icde=53452532&amp;ddparam=&amp;ddvalue=&amp;ddsub=&amp;cr=2&amp;csb=default&amp;cs=ASC&amp;pball=</ext-link> The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
    </funding-group>
    <counts>
      <fig-count count="11"/>
      <table-count count="3"/>
      <page-count count="21"/>
    </counts>
    <custom-meta-group>
      <custom-meta id="data-availability">
        <meta-name>Data Availability</meta-name>
        <meta-value>All relevant data are available from: <ext-link xlink:href="https://deepspecs.github.io/" ext-link-type="uri">https://deepspecs.github.io/</ext-link>.</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
  <notes>
    <title>Data Availability</title>
    <p>All relevant data are available from: <ext-link xlink:href="https://deepspecs.github.io/" ext-link-type="uri">https://deepspecs.github.io/</ext-link>.</p>
  </notes>
</front>
<body>
  <sec sec-type="intro" id="sec001">
    <title>1 Introduction</title>
    <p>To date, mass spectrometry (MS) proteomics data is identified using database search algorithms purely based on numerical techniques (<xref rid="pone.0259349.g001" ref-type="fig">Fig 1</xref>). These numerical techniques operate by comparing the experimental spectra to the simulated spectra generated from theoretical peptides using a simple simulator [<xref rid="pone.0259349.ref001" ref-type="bibr">1</xref>–<xref rid="pone.0259349.ref004" ref-type="bibr">4</xref>]. The experimental spectra are matched against the theoretical ones using one of many available heuristic scoring-functions including <italic toggle="yes">dot product</italic> [<xref rid="pone.0259349.ref005" ref-type="bibr">5</xref>], <italic toggle="yes">shared peak count</italic> [<xref rid="pone.0259349.ref006" ref-type="bibr">6</xref>, <xref rid="pone.0259349.ref007" ref-type="bibr">7</xref>], and <italic toggle="yes">ion matches</italic> [<xref rid="pone.0259349.ref008" ref-type="bibr">8</xref>]. Other peptide identification techniques such de novo algorithms [<xref rid="pone.0259349.ref009" ref-type="bibr">9</xref>–<xref rid="pone.0259349.ref021" ref-type="bibr">21</xref>] also deduce peptides directly from experimental spectra with varying degree of success.</p>
    <fig position="float" id="pone.0259349.g001">
      <object-id pub-id-type="doi">10.1371/journal.pone.0259349.g001</object-id>
      <label>Fig 1</label>
      <caption>
        <title>Process of generating MS/MS spectra from a protein mixture using mass-spectrometry analysis.</title>
        <p>Protein in the mixture are broken into peptides using the enzyme called trypsin which breaks the protein strings at K and R bases generating peptides of varying sizes. This peptide mixture is then refined and peptides are moved through mass-spectrometer which generates an MS/MS spectrum for each different peptide.</p>
      </caption>
      <graphic xlink:href="pone.0259349.g001" position="float"/>
    </fig>
    <p>Currently, there is no single scoring function from database search techniques that can claim as the most accurate strategy. Substantial work has been carried out towards developing computational techniques for identification of peptides using database search [<xref rid="pone.0259349.ref005" ref-type="bibr">5</xref>–<xref rid="pone.0259349.ref008" ref-type="bibr">8</xref>] (See <xref rid="pone.0259349.g002" ref-type="fig">Fig 2</xref> for a generic proteomics database search workflow), as well as de novo algorithms [<xref rid="pone.0259349.ref009" ref-type="bibr">9</xref>–<xref rid="pone.0259349.ref021" ref-type="bibr">21</xref>]. However, peptide identification problems are well-known and prevalent including but not limited to misidentifications or no identifications for peptides, statistical accuracy (FDR), and inconsistencies between different search engines [<xref rid="pone.0259349.ref022" ref-type="bibr">22</xref>]. Comparison across literature indicates decreased average accuracy of de novo algorithms (&lt; 35%) [<xref rid="pone.0259349.ref012" ref-type="bibr">12</xref>] relative to database search algorithms (30–80%) [<xref rid="pone.0259349.ref023" ref-type="bibr">23</xref>]. Lack of quality assessment benchmarks makes the accuracy exhibited from these database search tools highly dependent on the data, indicating that further formal investigation and evaluation is warranted. Two major sources of heuristic errors that are introduced in the numerical database search algorithms are (1) how the peptide deduction takes place, i.e., simulation of the spectra (from peptides), and (2) the peptide spectrum match scoring-function.</p>
    <fig position="float" id="pone.0259349.g002">
      <object-id pub-id-type="doi">10.1371/journal.pone.0259349.g002</object-id>
      <label>Fig 2</label>
      <caption>
        <title>A generic proteomics flow.</title>
        <p>In-silico digestion of the protein database is performed to generate peptides. These peptides are then converted to the theoretical spectra and compared against the experimental spectra.</p>
      </caption>
      <graphic xlink:href="pone.0259349.g002" position="float"/>
    </fig>
    <p>Previous work suggests that numerical algorithms and the use of traditional ML algorithms may not be able to capture and integrate the multidimensional features of MS data [<xref rid="pone.0259349.ref024" ref-type="bibr">24</xref>]. However, deep learning methods [<xref rid="pone.0259349.ref012" ref-type="bibr">12</xref>, <xref rid="pone.0259349.ref013" ref-type="bibr">13</xref>] may offer an improved approach for identifying peptides in noisy high-dimensional MS data and peptides that are very similar to each other [<xref rid="pone.0259349.ref003" ref-type="bibr">3</xref>]. Preliminary progress assessing deep learning methods in peptide deduction applied to MS data has yielded an average accuracy of 82–95% on selected data sets, but with limited precision (amino-acid level 72%) and recall (peptide level 39.24%) [<xref rid="pone.0259349.ref013" ref-type="bibr">13</xref>]. Prosit [<xref rid="pone.0259349.ref002" ref-type="bibr">2</xref>] incorporates theoretical spectral simulation in the database search pipeline by encoding the peptide sequences into a latent space and then decoding the embeddings to predict fragment ion intensities while Slider [<xref rid="pone.0259349.ref025" ref-type="bibr">25</xref>] uses deep convolutional neural networks to score experimental spectra against theoretical spectra. In [<xref rid="pone.0259349.ref026" ref-type="bibr">26</xref>], spectra for modified peptides are embedded close to the non-modified version in vectors of length 32, which enables them for fast lookup of the non-modified version for a given spectrum. These studies have shown that deep-learning models can be helpful in modeling MS proteomics data and improved accuracy from these peptide algorithms warrants further investigation into the applicability of sophisticated machine-learning strategies.</p>
    <p>In this paper, we make two fundamental contributions in MS-based proteomics search: 1) We present the design and implementation of Deep Similarity Network, called <italic toggle="yes">SpeCollate</italic>, for peptide-spectrum similarity measure. The goal is to learn a fixed-sized embedding of variable length <italic toggle="yes">experimental spectra</italic>, and peptide strings so that spectrum and its corresponding peptide are projected close to each other in the shared embedding space. Our proposed network consists of two sub-networks, i.e., spectrum sub-network (SSN) consisting of two fully connected layers and peptide sub-network (PSN) consisting of one bi-directional LSTM followed by two fully connected layers. 2) We then formulate and implement a custom loss function, called <italic toggle="yes">SNAP-loss</italic> for training the proposed deep-similarity network SpeCollate. This training process takes sextuplets as input, consisting of a combination of positive, negative, and anchor spectra and peptides. We train or network for 200 epochs on a dataset of size ∼ 4.8 million sextuplets containing ∼ 1.8 million unique peptides. As SpeCollate generates charge-independent peptide embeddings, we demonstrate that it performs better than Crux and MSFragger in terms of the number of PSMs and peptides identified under 1% FDR. SpeCollate encodes <italic toggle="yes">both</italic> peptides, and spectra into a latent space which are then used for <italic toggle="yes">direct</italic> comparison and peptide deduction. To the best of our knowledge, the proposed SpeCollate is the first deep-learning network that can determine <italic toggle="yes">cross-modal</italic> similarity between peptides and mass-spectra for MS-based omics.</p>
    <p>The rest of the paper is organized as follows: In section 2, we discuss different motivations for our work. In section 3, we discuss the major contributions of this work and discuss the design and implementation of SpeCollate, SNAP-loss, and GPU-based inference. In section 4, we describe experimental setup and present results. In section 5, we discuss the results, limitations of SpeCollate, and future prospects. Section 6 concludes this paper.</p>
  </sec>
  <sec sec-type="intro" id="sec002">
    <title>2 Background</title>
    <p>In this section, we will discuss the background of proteomics database search, emphasizing the shortcomings of the existing methods and potential solutions for them that inspired the development of the current framework. The shortcomings, including limitations and oversights of the existing numerical techniques, bounded performance of spectral simulators, unoptimized scoring heuristics, and the opportunities made available by huge data repositories with labeled spectra, are discussed.</p>
    <sec id="sec003">
      <title>2.1 Space transition</title>
      <p>Peptides and their corresponding MS/MS spectra lie in vastly distinct spaces. Peptides consist of a string of (typically) twenty alphabets (each representing an amino acid). In contrast, spectra are a series of floating-point numbers generated by a complex and stochastic fragmentation process. Transitioning in-between spaces can only approximate the counterpart projection as manifested by the existing techniques. De novo projects spectra onto a sub-peptide-space but with underwhelming accuracy as the spectra are mostly noisy and necessary information is missing. Similarly, in peptide-spectrum scoring methods, peptides are projected onto sub-spectral-space, and the similarity is measured by projecting the experimental spectra onto the same subspace (dot-product) for comparison as shown in <xref rid="pone.0259349.g003" ref-type="fig">Fig 3</xref>. Although the database search process is relatively more accurate, the output quality is contingent on the quality of the experimental and projected theoretical spectra. Therefore, we argue that a more flexible technique that can learn intermediate embeddings for both spectra and peptides could improve database search quality.</p>
      <fig position="float" id="pone.0259349.g003">
        <object-id pub-id-type="doi">10.1371/journal.pone.0259349.g003</object-id>
        <label>Fig 3</label>
        <caption>
          <title>Space transition methods.</title>
          <p>De novo and database search, that try to transform one space to another. This is prone to error and uncertainty as a lot of information can be missed. On the contrary, SpeCollate learns same sized embeddings for both peptides and spectra by projecting them to a shared euclidean space.</p>
        </caption>
        <graphic xlink:href="pone.0259349.g003" position="float"/>
      </fig>
    </sec>
    <sec id="sec004">
      <title>2.2 Spectral simulation</title>
      <p>Most state-of-the-art database search tools provide a simulator to generate spectra containing b and y peaks (sometimes a, c, x, and z) from the theoretical peptides. Other simulators also provide options to generate peaks with different neutral losses (NH<sub>3</sub>, H<sub>2</sub>O), Immonium ions, and isotope ions [<xref rid="pone.0259349.ref027" ref-type="bibr">27</xref>]. These simulators incur numerous deficiencies due to the inherent complexities of the mass-spectrometry process, causing misidentification of multiple features. These include unaccounted peaks, missing peaks, falsely identified true and noisy peaks, peak intensities, neutral losses, isotopic peaks, and noise characteristics. As a result, the simulated spectra only manage to span a sub-space of experimental spectra (<xref rid="pone.0259349.g003" ref-type="fig">Fig 3</xref>). Recently, various deep learning-based simulators have mitigated the problems with the traditional simulation approaches to a certain extent. One of the main contributions of this paper is to directly match the experimental spectra and their corresponding theoretical peptide string by learning the embeddings in a shared subspace from huge sets of labeled data available, e.g., NIST and MassIVE.</p>
    </sec>
    <sec id="sec005">
      <title>2.3 Scoring heuristics</title>
      <p>Although the simulators somewhat help improve the database search process, they only address half of the challenge, i.e., spectra simulation, while the scoring function is still the limiting factor. Presence or absence of specific peaks/ions can significantly impact peptide spectrum matching. In addition, the comparison of complex fragmentation spectra is not straightforward, and the outcome can vary among different scoring functions. SpeCollate can overcome this shortcoming by training on a wide variety of data to learn embeddings optimized for distance-based similarity. By processing data from different modalities using different types of networks, i.e., spectra using SSN and peptides using PSN, it can extract the valuable features needed for proper matching.</p>
    </sec>
    <sec id="sec006">
      <title>2.4 Learning from data</title>
      <p>When learning a similarity (or scoring) function, ideally, we would like to retain all the features that improve the similarity measure and abolish the useless ones. SpeCollate approaches this solution by projecting both peptides and spectra onto a shared euclidean space. This is accomplished by learning embeddings of equal size for both spectra and peptides so that their similarity is directly proportional to L2 distance in the resultant euclidean space. Hence, addressing both above-mentioned fundamental problems by finding a middle ground between two extremes (De novo and database search) and simplifying the comparison. Using separate branches for spectra and peptides, SpeCollate can learn valuable features to assign spectra to their corresponding peptides confidently using the L2 distance-based similarity measure.</p>
    </sec>
  </sec>
  <sec id="sec007">
    <title>3 SpeCollate: Deep learning model for spectra-peptide similarity</title>
    <p>This paper designs and implements a similarity network (SpeCollate) and the custom loss function (SNAP-loss) to learn a similarity function for peptide-spectrum matches. Similarity networks have been used for cross-modal retrieval of images and captions [<xref rid="pone.0259349.ref028" ref-type="bibr">28</xref>], face re/identification [<xref rid="pone.0259349.ref029" ref-type="bibr">29</xref>], and other problems [<xref rid="pone.0259349.ref030" ref-type="bibr">30</xref>, <xref rid="pone.0259349.ref031" ref-type="bibr">31</xref>]. In proteomics, the use of similarity networks has been limited to spectral library search [<xref rid="pone.0259349.ref026" ref-type="bibr">26</xref>] and spectral clustering [<xref rid="pone.0259349.ref032" ref-type="bibr">32</xref>]. Our goal is to learn a fixed-sized embedding of variable length experimental spectra and peptide strings so that a given spectrum and its corresponding peptide are projected close to each other (in terms of L2 distance) in the shared subspace. We use L2 distance as the similarity matrix since it has been shown in the literature to work well for similarity ranking loss functions, e.g., triplet loss, and perform better than other similarity metrics, e.g., cosine similarity. We took inspiration from FaceNet [<xref rid="pone.0259349.ref029" ref-type="bibr">29</xref>] to select L2 distance as the similarity metric. The network consists of two sub-networks, i.e., SSN consisting of two fully connected layers and PSN consisting of one bi-directional LSTM followed by two fully connected layers. The training process takes two sets of data points as inputs, i.e., the sparse spectrum vectors and encoded peptide strings. The loss value is calculated by generating sextuplets, after each forward pass, consisting of a positive pair (<italic toggle="yes">Q</italic>, <italic toggle="yes">P</italic>), a negative pair (<italic toggle="yes">Q</italic><sub><italic toggle="yes">N</italic></sub>, <italic toggle="yes">P</italic><sub><italic toggle="yes">N</italic></sub>)<sub><italic toggle="yes">Q</italic></sub> for <italic toggle="yes">Q</italic>, and a negative pair (<italic toggle="yes">Q</italic><sub><italic toggle="yes">N</italic></sub>, <italic toggle="yes">P</italic><sub><italic toggle="yes">N</italic></sub>)<sub><italic toggle="yes">P</italic></sub> for <italic toggle="yes">P</italic> where <italic toggle="yes">Q</italic> is the anchor spectrum and <italic toggle="yes">P</italic> is the positive peptide. The negative pairs are selected via online hardest negative mining to make the training process more efficient and faster. In this process, the negative spectra and peptides closest to <italic toggle="yes">Q</italic> and <italic toggle="yes">P</italic> are selected for a given batch after each forward pass.</p>
    <p>In this regard, this paper’s contributions are two folds: 1) Design and implementation of Deep Similarity Network, SpeCollate, for Proteomics Database Search and 2) Formulation and deployment of custom loss function SNAP-loss for training SpeCollate.</p>
    <sec id="sec008">
      <title>3.1 SpeCollate architecture</title>
      <p>SpeCollate consists of two sub-networks called spectral sub-network (SSN) and peptide sub-network (PSN), which process spectra and peptides respectively to generate embeddings of size 256. We empirically selected the embedding size of 256 as the smallest value without incurring any performance degradation. The complete SpeCollate network is shown in <xref rid="pone.0259349.g004" ref-type="fig">Fig 4</xref>.</p>
      <fig position="float" id="pone.0259349.g004">
        <object-id pub-id-type="doi">10.1371/journal.pone.0259349.g004</object-id>
        <label>Fig 4</label>
        <caption>
          <title>SpeCollate: Deep Similarity Network for proteomics.</title>
          <p>The spectra Q are passed to SSN in the form of sparse one-hot normalized representation. The positive and negative peptides (P, N) are passed to PSN one by one in both forward and backward direction.</p>
        </caption>
        <graphic xlink:href="pone.0259349.g004" position="float"/>
      </fig>
      <sec id="sec009">
        <title>3.1.1 Spectral Sub-Network (SSN)</title>
        <p>The SSN branch of the network processes spectra and embeds them onto the surface of a unit hyper-sphere in a euclidean subspace <inline-formula id="pone.0259349.e001"><alternatives><graphic xlink:href="pone.0259349.e001.jpg" id="pone.0259349.e001g" position="anchor"/><mml:math id="M1" display="inline" overflow="scroll"><mml:msup><mml:mrow><mml:mi mathvariant="normal">I</mml:mi><mml:mspace width="-0.166667em"/><mml:mi mathvariant="normal">R</mml:mi></mml:mrow><mml:mn>256</mml:mn></mml:msup></mml:math></alternatives></inline-formula>. SSN consists of two fully connected hidden layers of size 80, 000 × 1024 and 1024 × 256 respectively and a <italic toggle="yes">L</italic>2 normalization output layer. The input layer is of size 80, 000, which takes spectra as input in the form of sparse vectors with intensity values normalized to zero mean and unit variance and mass binning of 0.1 Da. Both hidden layers use rectified linear unit or ReLU as the activation function. A dropout mechanism with the probability value of 0.3 is used after the first hidden layer to avoid over-fitting.</p>
      </sec>
      <sec id="sec010">
        <title>3.1.2 Peptide Sub-Network (PSN)</title>
        <p>The PSN branch of SpeCollate processes the peptides and embeds them onto the surface of the same hyper-sphere in <inline-formula id="pone.0259349.e002"><alternatives><graphic xlink:href="pone.0259349.e002.jpg" id="pone.0259349.e002g" position="anchor"/><mml:math id="M2" display="inline" overflow="scroll"><mml:msup><mml:mrow><mml:mi mathvariant="normal">I</mml:mi><mml:mspace width="-0.166667em"/><mml:mi mathvariant="normal">R</mml:mi></mml:mrow><mml:mn>256</mml:mn></mml:msup></mml:math></alternatives></inline-formula> enabling the direct comparison between spectra and peptides. The PSN consists of one bi-directional long short-term memory (Bi-LSTM) layer followed by two fully connected layers. An embedding layer is added before the Bi-LSTM layer to embed each amino acid character into a floating-point vector of size 256. We use a vocabulary of size 30 including 20 amino acids, 9 modifications, and a blank space. Bi-LSTM has the hidden dimension of 1024, and the outputs from both forward and backward passes are concatenated to get an output of a total length of 2048. This output is further fed to two fully connected layers of size 2048 × 1024 and 1024 × 256. ReLU activation function is used for the fully connected layers, and dropout with the probability of 0.3 is used after the Bi-LSTM and the first fully connected layer.</p>
      </sec>
    </sec>
    <sec id="sec011">
      <title>3.2 Train, test, and validation datasets</title>
      <p>The training/testing dataset is generated from spectral libraries obtained from online repositories, NIST and MassIVE. The spectral libraries are preprocessed to generate two sets of data, i.e., spectra and their corresponding peptides. We obtained ∼ 4.8 million spectra with known peptide sources containing ∼ .5 million spectra from modified peptides. Train/Test split of 0.8/0.2 is applied such that no peptides are overlapping among the two splits. A separate spectral library is held out for validating the trained network, which is never used for training or testing purposes. Details of libraries used for train, test, and validation are provided in <xref rid="pone.0259349.s001" ref-type="supplementary-material">S1 File</xref>. Nine different types of modifications found in the training dataset are used for training the network. These modifications and their corresponding character values are given in <xref rid="pone.0259349.t001" ref-type="table">Table 1</xref>. Details of the training dataset are given in <xref rid="pone.0259349.t002" ref-type="table">Table 2</xref>.</p>
      <table-wrap position="float" id="pone.0259349.t001">
        <object-id pub-id-type="doi">10.1371/journal.pone.0259349.t001</object-id>
        <label>Table 1</label>
        <caption>
          <title>Modifications and the character values used in the training data.</title>
          <p>Nine modifications are used for training the network which are encoded with their corresponding character values to construct and modified peptide string.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="pone.0259349.t001" id="pone.0259349.t001g" position="float"/>
          <table frame="box" rules="all" border="0">
            <colgroup span="1">
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th align="center" rowspan="1" colspan="1">Modifications</th>
                <th align="center" rowspan="1" colspan="1">Values</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="center" rowspan="1" colspan="1">Phospho</td>
                <td align="center" rowspan="1" colspan="1">p</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Oxidation</td>
                <td align="center" rowspan="1" colspan="1">o</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Deamidation</td>
                <td align="center" rowspan="1" colspan="1">h</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Carbamidomethyl</td>
                <td align="center" rowspan="1" colspan="1">c</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Acetyl</td>
                <td align="center" rowspan="1" colspan="1">a</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Ammonia-loss</td>
                <td align="center" rowspan="1" colspan="1">r</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Carbamyl</td>
                <td align="center" rowspan="1" colspan="1">y</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Dehydrated</td>
                <td align="center" rowspan="1" colspan="1">d</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Delta:H(2)C(2)</td>
                <td align="center" rowspan="1" colspan="1">t</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <table-wrap position="float" id="pone.0259349.t002">
        <object-id pub-id-type="doi">10.1371/journal.pone.0259349.t002</object-id>
        <label>Table 2</label>
        <caption>
          <title>Characteristics of training dataset used.</title>
          <p>Data was acquired from online repositories including NIST peptide library, MassIVE. The post translation modification in the dataset are CAM, Phosphorylation, Oxidation, and N-terminal Acetylation.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="pone.0259349.t002" id="pone.0259349.t002g" position="float"/>
          <table frame="box" rules="all" border="0">
            <colgroup span="1">
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th align="center" rowspan="1" colspan="1">Parameters</th>
                <th align="center" rowspan="1" colspan="1">Values</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="center" rowspan="1" colspan="1">Training Samples</td>
                <td align="center" rowspan="1" colspan="1">4.8M</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Charge 2</td>
                <td align="center" rowspan="1" colspan="1">2.6M</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Charge 3</td>
                <td align="center" rowspan="1" colspan="1">1.6M</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Charge 4</td>
                <td align="center" rowspan="1" colspan="1">0.4M</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Other Charges</td>
                <td align="center" rowspan="1" colspan="1">1.2M</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Unmodified Samples</td>
                <td align="center" rowspan="1" colspan="1">4.3M</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Modified Samples</td>
                <td align="center" rowspan="1" colspan="1">0.5M</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Max Charge</td>
                <td align="center" rowspan="1" colspan="1">8</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Number of Species</td>
                <td align="center" rowspan="1" colspan="1">7</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p>Spectra are preprocessed into dense vectors (of length 80, 000) containing intensity values normalized to zero mean and unit variance. Each index of spectra vector represents an m/z bin of width 0.1 Da while the values at each index are the corresponding normalized intensities, hence each vector can hold a spectrum of up to 8, 000Da mass. Note that, due to the preprocessing step, the fragment tolerance is fixed to 0.1 Da for SpeCollate when performing database search. Peptide strings are padded with zero characters to the length of 64 before feeding to the PSN. The training/testing set is further split into batches of 1024 samples each. The training is performed using the PyTorch framework 1.6 running on python 3.7.4. For fast training, we perform the training process on NVIDIA V100s (32 GB SMX2) GPUs with 32GB of memory provided by Expanse SDSC supercomputer.</p>
    </sec>
    <sec id="sec012">
      <title>3.3 Training</title>
      <p>The training process begins by a forward pass of a batch (a subset of 1024 data points) containing experimental spectra and their corresponding (positive) peptides through SSN and PSN, respectively. At this point, the dataset does not consist of sextuplets as the negatives examples have not been selected yet. Once a batch is forward passed through the network, the four negative examples for each positive pair (<italic toggle="yes">q</italic><sub><italic toggle="yes">i</italic></sub> ∈ <italic toggle="yes">Q</italic>, <italic toggle="yes">p</italic><sub><italic toggle="yes">i</italic></sub> ∈ <italic toggle="yes">P</italic>) are mined where <italic toggle="yes">Q</italic> is the set of embedded spectra, and <italic toggle="yes">P</italic> is the set of embedded peptides. A negative tuple (<italic toggle="yes">q</italic><sub><italic toggle="yes">j</italic></sub>, <italic toggle="yes">p</italic><sub><italic toggle="yes">k</italic></sub>) for <italic toggle="yes">q</italic><sub><italic toggle="yes">i</italic></sub> is mined such that <italic toggle="yes">q</italic><sub><italic toggle="yes">j</italic></sub> is the closest negative spectrum to <italic toggle="yes">q</italic><sub><italic toggle="yes">i</italic></sub> and <italic toggle="yes">p</italic><sub><italic toggle="yes">k</italic></sub> is the closest negative peptide to <italic toggle="yes">q</italic><sub><italic toggle="yes">i</italic></sub>. Similarly, a negative tuple (<italic toggle="yes">q</italic><sub><italic toggle="yes">l</italic></sub>, <italic toggle="yes">p</italic><sub><italic toggle="yes">m</italic></sub>) for <italic toggle="yes">p</italic><sub><italic toggle="yes">i</italic></sub> is mined such that <italic toggle="yes">q</italic><sub><italic toggle="yes">l</italic></sub> is the closest negative spectrum to <italic toggle="yes">p</italic><sub><italic toggle="yes">i</italic></sub> and <italic toggle="yes">p</italic><sub><italic toggle="yes">m</italic></sub> is the closest negative peptide to <italic toggle="yes">p</italic><sub><italic toggle="yes">i</italic></sub>. Hence, a sextuplet <inline-formula id="pone.0259349.e003"><alternatives><graphic xlink:href="pone.0259349.e003.jpg" id="pone.0259349.e003g" position="anchor"/><mml:math id="M3" display="inline" overflow="scroll"><mml:mrow><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:msub><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> containing a query (or anchor) spectrum, positive peptide, two negative spectra and two negative peptides is constructed via online sextuplet mining for each positive example in the training dataset. The learning parameters are given in <xref rid="pone.0259349.t003" ref-type="table">Table 3</xref>.</p>
      <table-wrap position="float" id="pone.0259349.t003">
        <object-id pub-id-type="doi">10.1371/journal.pone.0259349.t003</object-id>
        <label>Table 3</label>
        <caption>
          <title>Training parameters for SpeCollate.</title>
        </caption>
        <alternatives>
          <graphic xlink:href="pone.0259349.t003" id="pone.0259349.t003g" position="float"/>
          <table frame="box" rules="all" border="0">
            <colgroup span="1">
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th align="center" rowspan="1" colspan="1">Parameters</th>
                <th align="center" rowspan="1" colspan="1">Values</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="center" rowspan="1" colspan="1">Train/Test</td>
                <td align="center" rowspan="1" colspan="1">0.8</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Learning Rate</td>
                <td align="center" rowspan="1" colspan="1">0.0001</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Optimizer</td>
                <td align="center" rowspan="1" colspan="1">Adam</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Weight Decay</td>
                <td align="center" rowspan="1" colspan="1">0.0001</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Num. Layers</td>
                <td align="center" rowspan="1" colspan="1">1 LSTM, 2 FC</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">Margin</td>
                <td align="center" rowspan="1" colspan="1">0.2</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <sec id="sec013">
        <title>3.3.1 Online hardest sextuplet mining</title>
        <p>Here we will derive the mathematical formulation of online negative mining to generate sextuplets. Given a batch <italic toggle="yes">B</italic> containing <italic toggle="yes">b</italic> training samples i.e. two sets <inline-formula id="pone.0259349.e004"><alternatives><graphic xlink:href="pone.0259349.e004.jpg" id="pone.0259349.e004g" position="anchor"/><mml:math id="M4" display="inline" overflow="scroll"><mml:mover><mml:mi>Q</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0259349.e005"><alternatives><graphic xlink:href="pone.0259349.e005.jpg" id="pone.0259349.e005g" position="anchor"/><mml:math id="M5" display="inline" overflow="scroll"><mml:mover><mml:mi>P</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:math></alternatives></inline-formula>. After forwarding <inline-formula id="pone.0259349.e006"><alternatives><graphic xlink:href="pone.0259349.e006.jpg" id="pone.0259349.e006g" position="anchor"/><mml:math id="M6" display="inline" overflow="scroll"><mml:mover><mml:mi>Q</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:math></alternatives></inline-formula> through SSN and <inline-formula id="pone.0259349.e007"><alternatives><graphic xlink:href="pone.0259349.e007.jpg" id="pone.0259349.e007g" position="anchor"/><mml:math id="M7" display="inline" overflow="scroll"><mml:mover><mml:mi>P</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:math></alternatives></inline-formula> through PSN we get embedded spectra <inline-formula id="pone.0259349.e008"><alternatives><graphic xlink:href="pone.0259349.e008.jpg" id="pone.0259349.e008g" position="anchor"/><mml:math id="M8" display="inline" overflow="scroll"><mml:mrow><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>S</mml:mi><mml:mi>N</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover><mml:mi>Q</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and peptides <inline-formula id="pone.0259349.e009"><alternatives><graphic xlink:href="pone.0259349.e009.jpg" id="pone.0259349.e009g" position="anchor"/><mml:math id="M9" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>P</mml:mi><mml:mi>S</mml:mi><mml:mi>N</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover><mml:mi>P</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> where <inline-formula id="pone.0259349.e010"><alternatives><graphic xlink:href="pone.0259349.e010.jpg" id="pone.0259349.e010g" position="anchor"/><mml:math id="M10" display="inline" overflow="scroll"><mml:mrow><mml:mi>Q</mml:mi><mml:mo>,</mml:mo><mml:mi>P</mml:mi><mml:mo>⊂</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="normal">I</mml:mi><mml:mspace width="-0.166667em"/><mml:mi mathvariant="normal">R</mml:mi></mml:mrow><mml:mn>256</mml:mn></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>. To efficiently compute negative examples for each positive pair (<italic toggle="yes">q</italic><sub><italic toggle="yes">i</italic></sub> ∈ <italic toggle="yes">Q</italic>, <italic toggle="yes">p</italic><sub><italic toggle="yes">i</italic></sub> ∈ <italic toggle="yes">P</italic>), three distance matrices, <italic toggle="yes">D</italic><sub><italic toggle="yes">Q</italic>×<italic toggle="yes">Q</italic></sub>, <italic toggle="yes">D</italic><sub><italic toggle="yes">Q</italic>×<italic toggle="yes">P</italic></sub>, and <italic toggle="yes">D</italic><sub><italic toggle="yes">P</italic>×<italic toggle="yes">P</italic></sub>, containing pairwise squared L2 distances (SED) of spectra and peptides are calculated. <italic toggle="yes">D</italic><sub><italic toggle="yes">Q</italic>×<italic toggle="yes">Q</italic></sub> contains the SED values between all spectra ‖<italic toggle="yes">q</italic><sub><italic toggle="yes">i</italic></sub>−<italic toggle="yes">q</italic><sub><italic toggle="yes">j</italic></sub>‖<sup>2</sup>, <italic toggle="yes">D</italic><sub><italic toggle="yes">Q</italic>×<italic toggle="yes">P</italic></sub> contains the SED values between spectra and peptides ‖<italic toggle="yes">q</italic><sub><italic toggle="yes">i</italic></sub> − <italic toggle="yes">p</italic><sub><italic toggle="yes">j</italic></sub>‖<sup>2</sup>, and <italic toggle="yes">D</italic><sub><italic toggle="yes">P</italic>×<italic toggle="yes">P</italic></sub> contains SED values between all peptides ‖<italic toggle="yes">p</italic><sub><italic toggle="yes">i</italic></sub>−<italic toggle="yes">p</italic><sub><italic toggle="yes">j</italic></sub>‖<sup>2</sup> where <italic toggle="yes">i</italic>, <italic toggle="yes">j</italic> ∈ {1, 2, …, <italic toggle="yes">b</italic>}. Note that these are symmetric matrices of size <italic toggle="yes">b</italic>×<italic toggle="yes">b</italic> with diagonal containing the positive pair SEDs for <italic toggle="yes">D</italic><sub><italic toggle="yes">Q</italic>×<italic toggle="yes">P</italic></sub> and zero for <italic toggle="yes">D</italic><sub><italic toggle="yes">Q</italic>×<italic toggle="yes">Q</italic></sub> and <italic toggle="yes">D</italic><sub><italic toggle="yes">P</italic>×<italic toggle="yes">P</italic></sub>. For <italic toggle="yes">D</italic><sub><italic toggle="yes">Q</italic>×<italic toggle="yes">Q</italic></sub> and <italic toggle="yes">D</italic><sub><italic toggle="yes">P</italic>×<italic toggle="yes">P</italic></sub>, we can calculate the distance matrix as follows (We will only show the calculation for <italic toggle="yes">D</italic><sub><italic toggle="yes">Q</italic>×<italic toggle="yes">Q</italic></sub> as <italic toggle="yes">D</italic><sub><italic toggle="yes">P</italic>×<italic toggle="yes">P</italic></sub> can be derived in exactly the same way:</p>
        <p>Consider the Gramian matrix of <italic toggle="yes">Q</italic> is <italic toggle="yes">G</italic><sub><italic toggle="yes">Q</italic></sub>:
<disp-formula id="pone.0259349.e011"><alternatives><graphic xlink:href="pone.0259349.e011.jpg" id="pone.0259349.e011g" position="anchor"/><mml:math id="M11" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>G</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>Q</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>⟨</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>⟩</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
and the diagonal of <italic toggle="yes">G</italic><sub><italic toggle="yes">Q</italic></sub> as:
<disp-formula id="pone.0259349.e012"><alternatives><graphic xlink:href="pone.0259349.e012.jpg" id="pone.0259349.e012g" position="anchor"/><mml:math id="M12" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>a</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
Then <italic toggle="yes">D</italic><sub><italic toggle="yes">Q</italic>×<italic toggle="yes">Q</italic></sub> is given by:
<disp-formula id="pone.0259349.e013"><alternatives><graphic xlink:href="pone.0259349.e013.jpg" id="pone.0259349.e013g" position="anchor"/><mml:math id="M13" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>Q</mml:mi><mml:mo>×</mml:mo><mml:mi>Q</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:msup><mml:mn mathvariant="bold">1</mml:mn><mml:mi>T</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mi>G</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mn mathvariant="bold">1</mml:mn><mml:msubsup><mml:mi>g</mml:mi><mml:mi>Q</mml:mi><mml:mi>T</mml:mi></mml:msubsup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
where <bold>1</bold> is a vector containing all ones and is the same length as <italic toggle="yes">g</italic><sub><italic toggle="yes">Q</italic></sub> i.e. <italic toggle="yes">b</italic>. <italic toggle="yes">D</italic><sub><italic toggle="yes">Q</italic>×<italic toggle="yes">P</italic></sub> can be derived in a similar fashion as follows:</p>
        <p>Let
<disp-formula id="pone.0259349.e014"><alternatives><graphic xlink:href="pone.0259349.e014.jpg" id="pone.0259349.e014g" position="anchor"/><mml:math id="M14" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mi>P</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>G</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>P</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>⟨</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>⟩</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
and
<disp-formula id="pone.0259349.e015"><alternatives><graphic xlink:href="pone.0259349.e015.jpg" id="pone.0259349.e015g" position="anchor"/><mml:math id="M15" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi>P</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>a</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mi>P</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
Then
<disp-formula id="pone.0259349.e016"><alternatives><graphic xlink:href="pone.0259349.e016.jpg" id="pone.0259349.e016g" position="anchor"/><mml:math id="M16" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>Q</mml:mi><mml:mo>×</mml:mo><mml:mi>P</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:msup><mml:mn mathvariant="bold">1</mml:mn><mml:mi>T</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msup><mml:mi>Q</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>P</mml:mi><mml:mo>+</mml:mo><mml:mn mathvariant="bold">1</mml:mn><mml:msubsup><mml:mi>g</mml:mi><mml:mi>P</mml:mi><mml:mi>T</mml:mi></mml:msubsup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
Once these matrices are calculated, the four negatives can be obtained using the min function over matrices. Let the elements of matrices <italic toggle="yes">D</italic><sub><italic toggle="yes">Q</italic>×<italic toggle="yes">Q</italic></sub>, <italic toggle="yes">D</italic><sub><italic toggle="yes">Q</italic>×<italic toggle="yes">P</italic></sub>, and <italic toggle="yes">D</italic><sub><italic toggle="yes">P</italic>×<italic toggle="yes">P</italic></sub> be represented by <italic toggle="yes">qq</italic><sub><italic toggle="yes">ir</italic></sub>, <italic toggle="yes">pp</italic><sub><italic toggle="yes">ir</italic></sub>, and <italic toggle="yes">qp</italic><sub><italic toggle="yes">ir</italic></sub> respectively where <italic toggle="yes">i</italic>, <italic toggle="yes">r</italic> represent the row and the column indexes. Then the subscripts <italic toggle="yes">j</italic><sub><italic toggle="yes">i</italic></sub>, <italic toggle="yes">k</italic><sub><italic toggle="yes">i</italic></sub>, <italic toggle="yes">l</italic><sub><italic toggle="yes">i</italic></sub>, and <italic toggle="yes">m</italic><sub><italic toggle="yes">i</italic></sub> for the negative examples in the sextuplet <italic toggle="yes">S</italic> can be determined using the following four equations:
<disp-formula id="pone.0259349.e017"><alternatives><graphic xlink:href="pone.0259349.e017.jpg" id="pone.0259349.e017g" position="anchor"/><mml:math id="M17" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mtext>arg</mml:mtext><mml:mspace width="4pt"/><mml:mtext>min</mml:mtext></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>r</mml:mi><mml:mo>≠</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:mspace width="2pt"/><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="4pt"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
<disp-formula id="pone.0259349.e018"><alternatives><graphic xlink:href="pone.0259349.e018.jpg" id="pone.0259349.e018g" position="anchor"/><mml:math id="M18" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mtext>arg</mml:mtext><mml:mspace width="4pt"/><mml:mtext>min</mml:mtext></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>r</mml:mi><mml:mo>≠</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:mspace width="2pt"/><mml:mi>q</mml:mi><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="4pt"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
<disp-formula id="pone.0259349.e019"><alternatives><graphic xlink:href="pone.0259349.e019.jpg" id="pone.0259349.e019g" position="anchor"/><mml:math id="M19" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mtext>arg</mml:mtext><mml:mspace width="4pt"/><mml:mtext>min</mml:mtext></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>r</mml:mi><mml:mo>≠</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:mspace width="2pt"/><mml:mi>q</mml:mi><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="4pt"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
<disp-formula id="pone.0259349.e020"><alternatives><graphic xlink:href="pone.0259349.e020.jpg" id="pone.0259349.e020g" position="anchor"/><mml:math id="M20" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mtext>arg</mml:mtext><mml:mspace width="4pt"/><mml:mtext>min</mml:mtext></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>r</mml:mi><mml:mo>≠</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:mspace width="2pt"/><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="4pt"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula></p>
        <p>These subscripts indicate the corresponding indices of the negative spectra and peptides in sets <italic toggle="yes">Q</italic> and <italic toggle="yes">P</italic>; they can be directly accessed for loss calculation. Once all the sextuplets are constructed in a given batch, the loss value is computed using the custom-designed SNAP-loss function. The gradient update is back-propagated through both SSN and PSN. The online sextuplet mining is visualized in <xref rid="pone.0259349.g005" ref-type="fig">Fig 5</xref>.</p>
        <fig position="float" id="pone.0259349.g005">
          <object-id pub-id-type="doi">10.1371/journal.pone.0259349.g005</object-id>
          <label>Fig 5</label>
          <caption>
            <title>Online sextuplet mining for SNAP-loss.</title>
            <p>At each batch iteration, four negatives are selected that are closest to either q or p. The gradient update moves the negatives far away, and a new set of negatives is selected during the next iteration and so on. This process makes sure the network learns on the hardest examples for optimum training.</p>
          </caption>
          <graphic xlink:href="pone.0259349.g005" position="float"/>
        </fig>
      </sec>
    </sec>
    <sec id="sec014">
      <title>3.4 SNAP-loss</title>
      <p>The training objective is to minimize the SED between a given spectrum and its corresponding positive peptide while maximizing it for negative examples. To achieve this, we adopt a similar approach to the Triplet-Loss function [<xref rid="pone.0259349.ref033" ref-type="bibr">33</xref>] which works on triplets (A, P, N) with A as the anchor, P as the positive example and N as the negative example. In this case, the differences between SEDs among A and P ‖<italic toggle="yes">A</italic> − <italic toggle="yes">P</italic>‖<sup>2</sup>, and A and N ‖<italic toggle="yes">A</italic> − <italic toggle="yes">N</italic>‖<sup>2</sup> is minimized with a constant margin value, added to the positive distance as shown below.
<disp-formula id="pone.0259349.e021"><alternatives><graphic xlink:href="pone.0259349.e021.jpg" id="pone.0259349.e021g" position="anchor"/><mml:math id="M21" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>b</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mi>b</mml:mi></mml:munderover><mml:mtext>max</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mo>‖</mml:mo><mml:mi>A</mml:mi><mml:mo>−</mml:mo><mml:mi>P</mml:mi><mml:mo>‖</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mo>‖</mml:mo><mml:mi>A</mml:mi><mml:mo>−</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo><mml:mo>‖</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
This approach works well where data with a single modality is dealt with, e.g., image verification in the case of FaceNet [<xref rid="pone.0259349.ref029" ref-type="bibr">29</xref>].</p>
      <p>We design SNAP-loss which extends Triplet-Loss to multi-modal data, in our case numerical spectra and sequence peptides. For this purpose, we consider all possible negatives (<italic toggle="yes">q</italic><sub><italic toggle="yes">j</italic></sub>, <italic toggle="yes">p</italic><sub><italic toggle="yes">k</italic></sub>, <italic toggle="yes">q</italic><sub><italic toggle="yes">l</italic></sub>, <italic toggle="yes">p</italic><sub><italic toggle="yes">m</italic></sub>) for a given positive pair (<italic toggle="yes">q</italic><sub><italic toggle="yes">i</italic></sub>, <italic toggle="yes">p</italic><sub><italic toggle="yes">i</italic></sub>) and average the total loss. The four possible negatives are explained below:
<list list-type="bullet"><list-item><p><italic toggle="yes">q</italic><sub><italic toggle="yes">j</italic></sub>: The negative spectrum for <italic toggle="yes">q</italic><sub><italic toggle="yes">i</italic></sub>.</p></list-item><list-item><p><italic toggle="yes">p</italic><sub><italic toggle="yes">k</italic></sub>: The negative peptide for <italic toggle="yes">q</italic><sub><italic toggle="yes">i</italic></sub>.</p></list-item><list-item><p><italic toggle="yes">q</italic><sub><italic toggle="yes">l</italic></sub>: The negative spectrum for <italic toggle="yes">p</italic><sub><italic toggle="yes">i</italic></sub>.</p></list-item><list-item><p><italic toggle="yes">p</italic><sub><italic toggle="yes">m</italic></sub>: The negative peptide for <italic toggle="yes">p</italic><sub><italic toggle="yes">i</italic></sub>.</p></list-item></list></p>
      <p>To calculate the loss value, we first define a few variables that are precomputed in distances matrices above as follows:</p>
      <p>Let
<disp-formula id="pone.0259349.e022"><alternatives><graphic xlink:href="pone.0259349.e022.jpg" id="pone.0259349.e022g" position="anchor"/><mml:math id="M22" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>‖</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‖</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
<disp-formula id="pone.0259349.e023"><alternatives><graphic xlink:href="pone.0259349.e023.jpg" id="pone.0259349.e023g" position="anchor"/><mml:math id="M23" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>‖</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‖</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
<disp-formula id="pone.0259349.e024"><alternatives><graphic xlink:href="pone.0259349.e024.jpg" id="pone.0259349.e024g" position="anchor"/><mml:math id="M24" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>‖</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>‖</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
<disp-formula id="pone.0259349.e025"><alternatives><graphic xlink:href="pone.0259349.e025.jpg" id="pone.0259349.e025g" position="anchor"/><mml:math id="M25" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mn>3</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>‖</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>‖</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
<disp-formula id="pone.0259349.e026"><alternatives><graphic xlink:href="pone.0259349.e026.jpg" id="pone.0259349.e026g" position="anchor"/><mml:math id="M26" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mn>4</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>‖</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>‖</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
Then the SNAP-loss is calculated for a batch of size <italic toggle="yes">b</italic> as follows:
<disp-formula id="pone.0259349.e027"><alternatives><graphic xlink:href="pone.0259349.e027.jpg" id="pone.0259349.e027g" position="anchor"/><mml:math id="M27" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>4</mml:mn><mml:mi>b</mml:mi></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>b</mml:mi></mml:munderover><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>4</mml:mn></mml:munderover><mml:mtext>max</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
The training process is visualized in <xref rid="pone.0259349.g005" ref-type="fig">Fig 5</xref>.</p>
    </sec>
    <sec id="sec015">
      <title>3.5 Similarity inference</title>
      <p>Once the training is complete, we perform the similarity inference on the test dataset by simply transforming the peptides and spectra into the embedded subspace and applying the nearest neighbor search. <xref rid="pone.0259349.g003" ref-type="fig">Fig 3</xref> shows the resultant euclidean space is <inline-formula id="pone.0259349.e028"><alternatives><graphic xlink:href="pone.0259349.e028.jpg" id="pone.0259349.e028g" position="anchor"/><mml:math id="M28" display="inline" overflow="scroll"><mml:msup><mml:mi mathvariant="double-struck">R</mml:mi><mml:mn>256</mml:mn></mml:msup></mml:math></alternatives></inline-formula>, where all the peptides and spectra are projected onto.</p>
      <sec id="sec016">
        <title>3.5.1 Indexing</title>
        <p>Since a large number of spectra might need to be searched against peptides, we can index the peptides by precomputing the embedded feature vectors and store them for later use. Similar pre-computation can be performed for the experimental spectra before performing the search to avoid repeated encoding, as each experimental spectrum needs to be searched against multiple peptides.</p>
        <p>The L2 distance measure can be efficiently calculated on the GPU by computing the masked distance matrix for the peptides that fall within the precursor m/z range. Furthermore, this process can easily scale to multiple GPUs, making it feasible for large datasets. The inverse of the L2 distance (1/<italic toggle="yes">L</italic>2) is reported as the match score.</p>
      </sec>
      <sec id="sec017">
        <title>3.5.2 L2 distance measure</title>
        <p>To measure the L2 distance between the embedded set of spectra <italic toggle="yes">Q</italic> and peptides <italic toggle="yes">P</italic>, we split <italic toggle="yes">Q</italic> into batches of size 1024. On the other hand, peptides are selected for each batch of spectra based on the precursor tolerance, and their number can vary. We limit the maximum number of peptides in a batch to 16384 due to the memory limit (32 GBs) of the GPU. If more than 16384 peptides fall within the precursor window, they are further split into sub-batches, and the search process is repeated for each sub-batch. As a result, we have two matrices <italic toggle="yes">A</italic><sub>1024×256</sub> and <italic toggle="yes">B</italic><sub>&lt;16384×256</sub> containing a batch of spectra and a sub-batch of peptides, respectively. Parallel distance matrix <italic toggle="yes">D</italic><sub><italic toggle="yes">A</italic>×<italic toggle="yes">B</italic></sub> calculation is performed using the following equation:
<disp-formula id="pone.0259349.e029"><alternatives><graphic xlink:href="pone.0259349.e029.jpg" id="pone.0259349.e029g" position="anchor"/><mml:math id="M29" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>A</mml:mi><mml:mo>×</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:msup><mml:mn mathvariant="bold">1</mml:mn><mml:mi>T</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msup><mml:mi>A</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>B</mml:mi><mml:mo>+</mml:mo><mml:mn mathvariant="bold">1</mml:mn><mml:msubsup><mml:mi>g</mml:mi><mml:mi>B</mml:mi><mml:mi>T</mml:mi></mml:msubsup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
where <italic toggle="yes">g</italic><sub><italic toggle="yes">A</italic></sub> is the diagonal vector of the Gramian matrix <italic toggle="yes">G</italic><sub><italic toggle="yes">A</italic></sub> of <italic toggle="yes">A</italic> and <italic toggle="yes">g</italic><sub><italic toggle="yes">B</italic></sub> is the diagonal vector of the Gramian matrix <italic toggle="yes">G</italic><sub><italic toggle="yes">B</italic></sub> of <italic toggle="yes">B</italic>. <italic toggle="yes">D</italic><sub><italic toggle="yes">A</italic>×<italic toggle="yes">B</italic></sub> is a 1024× ≤ 16384 distance matrix and contains the distances of each spectrum in <italic toggle="yes">A</italic> to each peptide in <italic toggle="yes">B</italic>, i.e., each row in <italic toggle="yes">D</italic><sub><italic toggle="yes">A</italic>×<italic toggle="yes">B</italic></sub> represents an experimental spectrum while each column represents a peptide. Since not all peptides lie within the precursor window of every spectrum, we compute a mask matrix <italic toggle="yes">M</italic> of the same size as <italic toggle="yes">D</italic><sub><italic toggle="yes">A</italic>×<italic toggle="yes">B</italic></sub> which contains 1 for peptides that fall within the precursor window of each spectrum and 0 for the rest. Matrix <italic toggle="yes">M</italic> is calculated dynamically based on the user-provided precursor tolerance (Da or ppm). Hadamard product of <italic toggle="yes">D</italic><sub><italic toggle="yes">A</italic>×<italic toggle="yes">B</italic></sub> and <italic toggle="yes">M</italic> gives the distance measure of only relevant peptide-spectrum pairs. For each spectrum, 5 top-scoring peptide (minimum distance) are kept, and the rest are discarded, giving a resultant score matrix of size 1024×5, which is stored for posterior analysis later.</p>
      </sec>
    </sec>
  </sec>
  <sec id="sec018">
    <title>4 Experiments &amp; results</title>
    <p>In this section, we will discuss the experimental setup, present results, and provide a discussion.</p>
    <sec id="sec019">
      <title>4.1 Experimental setup</title>
      <p>We train our network for 200 epochs on a dataset of size ∼ 4.8 million sextuplets. The training is performed on an NVIDIA V100s (32 GB SMX2) GPUs with 32GB of memory provided by Expanse SDSC supercomputer installed in nodes with up to 4 GPU nodes, 40 CPU cores, and 384 GBs of memory (10 CPU cores and 96 GBs per GPU node). We use PyTorch 1.6 to design our network using python 3.7.4 on Linux 16.04. We also perform the database search on the test dataset to measure the quality of results just by comparing the embeddings.</p>
    </sec>
    <sec id="sec020">
      <title>4.2 Training and model evaluation</title>
      <p>We train the network for 200 epochs to achieve validation accuracy of 95.5%. The accuracy is measured by the ratio of the number of times the correct peptide is the closest one to the anchor spectrum to the total number of spectra in a batch. Let us define the true peptide <italic toggle="yes">tp</italic> as a Boolean function which outputs 1 if the closest peptide <italic toggle="yes">p</italic> to the anchor <italic toggle="yes">q</italic> in the current batch <italic toggle="yes">B</italic> is the true peptide <italic toggle="yes">p</italic><sub><italic toggle="yes">q</italic></sub> and zero otherwise.
<disp-formula id="pone.0259349.e030"><alternatives><graphic xlink:href="pone.0259349.e030.jpg" id="pone.0259349.e030g" position="anchor"/><mml:math id="M30" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>t</mml:mi><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mrow><mml:mtext>arg</mml:mtext><mml:mspace width="4pt"/><mml:mtext>min</mml:mtext></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mo>∈</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:msub><mml:mspace width="2pt"/><mml:msup><mml:mrow><mml:mo>‖</mml:mo><mml:mi>q</mml:mi><mml:mo>−</mml:mo><mml:mi>p</mml:mi><mml:mo>‖</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>q</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mn>0</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
<disp-formula id="pone.0259349.e031"><alternatives><graphic xlink:href="pone.0259349.e031.jpg" id="pone.0259349.e031g" position="anchor"/><mml:math id="M31" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>A</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mi>u</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>q</mml:mi><mml:mo>∈</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:msub><mml:mi>t</mml:mi><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>B</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
where <italic toggle="yes">p</italic><sub><italic toggle="yes">q</italic></sub> is the true peptide for <italic toggle="yes">q</italic>, <italic toggle="yes">B</italic> is the current batch, and <italic toggle="yes">P</italic><sub><italic toggle="yes">B</italic></sub> and <italic toggle="yes">Q</italic><sub><italic toggle="yes">B</italic></sub> represent the peptides and spectra in <italic toggle="yes">B</italic> respectively. <xref rid="pone.0259349.g006" ref-type="fig">Fig 6</xref> shows the training process in terms of accuracy of training and validation data as well the loss value.</p>
      <fig position="float" id="pone.0259349.g006">
        <object-id pub-id-type="doi">10.1371/journal.pone.0259349.g006</object-id>
        <label>Fig 6</label>
        <caption>
          <p>Training progress for train/test data (left) and the loss value over time (right).</p>
        </caption>
        <graphic xlink:href="pone.0259349.g006" position="float"/>
      </fig>
      <p>We plot the ROC curves as well as Precision-Recall curves for comparing the performance of the three scoring functions. As shown in <xref rid="pone.0259349.g007" ref-type="fig">Fig 7</xref>, SpeCollate performs significantly better than XCorr and Hyperscore in closed search. Note that ROC curves tend to overestimate the model’s skill when the classes are not balanced, and there are far more true negatives than false positives. Therefore, for a scenario where positive examples are far more valuable than the negative ones (such as when searching for a peptide-spectrum match), Precision-Recall curves better represent the performance as the true-negatives are not considered for either precision or recall calculation.</p>
      <fig position="float" id="pone.0259349.g007">
        <object-id pub-id-type="doi">10.1371/journal.pone.0259349.g007</object-id>
        <label>Fig 7</label>
        <caption>
          <p>ROC (left) and Precision-Recall (right) curves for closed search. Both ROC curves and Precision-Recall curves for SpeCollate, XCorr, and Hyperscore show that SpeCollate performs best for all cutoff values for closed search (±0.5 Da precursor mass tolerance).</p>
        </caption>
        <graphic xlink:href="pone.0259349.g007" position="float"/>
      </fig>
      <p><xref rid="pone.0259349.g008" ref-type="fig">Fig 8</xref>, provides the UMAP [<xref rid="pone.0259349.ref034" ref-type="bibr">34</xref>] visualization of spectra and peptide embeddings. Embeddings are generated for library spectra provided by Proteome Tools by first sorting the spectra according to their precursor mass and then selecting spectra for 40 unique peptides, sequentially, for precursor mass value of ≥ 2000 Da., such that the number of spectra for each peptide is ≥ 15 to understand how SpeCollate maps spectra of different charges (2–5) close to the corresponding peptide embeddings. Selecting spectra that are next to each other in precursor mass helps us visualize the separation of different clusters within a precursor mass window when performing the database search. Similar visualizations for different precursor mass values (1500–3000) are provided in <xref rid="pone.0259349.s003" ref-type="supplementary-material">S3 File</xref>.</p>
      <fig position="float" id="pone.0259349.g008">
        <object-id pub-id-type="doi">10.1371/journal.pone.0259349.g008</object-id>
        <label>Fig 8</label>
        <caption>
          <title>2D UMAP visualization of embedded spectra and peptide vectors generated by SpeCollate.</title>
          <p>a) Clustering of spectra with different precursor charges around their corresponding peptides as well as the separation of clusters within a mass-range is shown for 40 unique peptides. The red point represents the peptide within a cluster, while the blue points represent spectra (with different charge values) corresponding to the peptide. Sub-figures b) and c) show the close-up of two clusters with charge labeling of spectra. As can be seen, spectra with all charges are mapped close to the peptide. However, spectra with higher precursor charge values are mapped relatively farther than those with smaller values.</p>
        </caption>
        <graphic xlink:href="pone.0259349.g008" position="float"/>
      </fig>
    </sec>
    <sec id="sec021">
      <title>4.3 Database search</title>
      <p>The model is also tested in a complete proteomics pipeline using the dataset from NIST as well as three real-world datasets (PXD000612 [<xref rid="pone.0259349.ref035" ref-type="bibr">35</xref>], PXD009861 [<xref rid="pone.0259349.ref036" ref-type="bibr">36</xref>], PXD001468 [<xref rid="pone.0259349.ref037" ref-type="bibr">37</xref>]), obtained from PRIDE, by performing database search against the human proteome and obtaining PSMs and peptides reported under 1% FDR. The performance is compared against Crux [<xref rid="pone.0259349.ref038" ref-type="bibr">38</xref>] and MSFragger [<xref rid="pone.0259349.ref007" ref-type="bibr">7</xref>] by performing separate target decoy database searches and FDR estimation using Percolator [<xref rid="pone.0259349.ref039" ref-type="bibr">39</xref>]. Closed search is performed with precursor mass tolerance of ±5ppm. Note that fragment tolerance is fixed to 0.1 as MS/MS spectra are preprocessed into arrays with each index representing a bin width of 0.1 Da. The protein database is in-silico digested using tryptic digestion, allowing up to two missed cleavages and 7–50 amino acids per peptide. Different peptide databases with zero and up to one and two phosphorylation and oxidation sites per peptide are generated and searched against different datasets. The decoy entries are generated by reversing the target peptides (except the first and the last amino acid) and removing any overlapping peptides from the decoy database. The resulting peptide databases contain ∼ 2.7M, ∼ 11.7M, and ∼ 32.3M peptides for zero, one and two phosphorylation sites respectively while for oxidation, the peptide databases contain ∼ 2.7M, ∼ 3.9M, and ∼ 4.2M peptides. The search is performed by generating theoretical spectra of fixed intensity values and reporting 5 top-scoring peptide spectrum matches per spectrum for each target and decoy database. Percolator/PeptideProphet then reorders these PSMs to estimate false-discovery rate, and a subset of PSMs and peptides estimated to have FDR &lt; 1% is reported. As SpeCollate can only generate charge-independent peptide embeddings, we limit the fragment charge of theoretical spectra generated by Crux and MSFragger to +1 for a fair comparison.</p>
      <sec id="sec022">
        <title>4.3.1 Search results and comparisons</title>
        <p><xref rid="pone.0259349.g009" ref-type="fig">Fig 9</xref> provides a comparison of SpeCollate’s performance against Crux and MSFragger for NIST “Human HCD Phospho” library spectra. For the left subplot, the peptides are generated with up to one phosphorylation modification per peptide, while in the right subplot, up to two phosphorylation modifications per peptide are allowed. SpeCollate outperforms both Crux and MSFragger in terms of the number of identified PSMs and peptides under 1% FDR. We do not perform a search with no modifications as the NIST dataset being searched contains only phosphorylated spectra.</p>
        <fig position="float" id="pone.0259349.g009">
          <object-id pub-id-type="doi">10.1371/journal.pone.0259349.g009</object-id>
          <label>Fig 9</label>
          <caption>
            <p>Closed search (±5ppm) comparison against Crux and MSFragger using NIST Dataset with one phosphorylation modification per peptide (left) and two phosphorylation modifications (right). SpeCollate significantly outperforms Crux and MSFragger in both PSMs and number of peptides.</p>
          </caption>
          <graphic xlink:href="pone.0259349.g009" position="float"/>
        </fig>
        <p>Next we perform the comparison using real-world datasets PXD000612 [<xref rid="pone.0259349.ref035" ref-type="bibr">35</xref>], PXD009861 [<xref rid="pone.0259349.ref036" ref-type="bibr">36</xref>], and PXD001468 [<xref rid="pone.0259349.ref037" ref-type="bibr">37</xref>] in <xref rid="pone.0259349.g010" ref-type="fig">Fig 10</xref> (See <xref rid="pone.0259349.s002" ref-type="supplementary-material">S2 File</xref> for details about these datasets). For the PXD000612 dataset, the search is performed against different number of phosphorylation sites (up to two) added to the peptide database. In contrast, for dataset PXD009861, the search is performed against databases with different number of oxidized M-residues (up to two per peptide) while for dataset PXD001468, the search is performed against database with one n-term acetylation and up to two oxidation sites (max 2 modifications per peptide). SpeCollate is able to outperform Crux and MSFragger in all experiments except for PXD000612 searched against the single phosphorylated database where the number of peptides identified by SpeCollate is slightly less than Crux. Comparison using default XCorr and MSFragger settings (i.e., allowing theoretical fragments with &gt; +1 charge) is provided in <xref rid="pone.0259349.s005" ref-type="supplementary-material">S5 File</xref>.</p>
        <fig position="float" id="pone.0259349.g010">
          <object-id pub-id-type="doi">10.1371/journal.pone.0259349.g010</object-id>
          <label>Fig 10</label>
          <caption>
            <title>Closed search (±5ppm) comparison against Crux and MSFragger using real-world data from PRIDE repository PXD000612 (top), PXD009861 (middle), and PXD001468 (bottom).</title>
            <p>For PXD000612, the search is performed against a peptide database generated from the human proteome with zero and up to one and two phosphorylation (amino acids S, T, and Y) modifications for subplots left, middle, and right, respectively. For dataset PXD009861, the search is performed against databases with a different number of oxidized M-residues (up to two per peptide), while for dataset PXD001468, the search is performed against a database with one n-term acetylation and up to two oxidation sites (max two modifications per peptide). SpeCollate can outperform Crux and MSFragger in terms of PSMs while giving a comparable performance in terms of the number of peptides.</p>
          </caption>
          <graphic xlink:href="pone.0259349.g010" position="float"/>
        </fig>
        <p>We also investigate the overlap of identified peptides by SpeCollate, Crux, and MSFragger using Venn diagrams as shown in <xref rid="pone.0259349.g011" ref-type="fig">Fig 11</xref> for each experiment performed in <xref rid="pone.0259349.g010" ref-type="fig">Fig 10</xref>. As can be seen, most of the peptides for each experiment are common among the three search tools. However, SpeCollate does identify more unique peptides than Crux and MSFragger. Generally, we discovered that compared to Crux and MSFragger, unique peptides identified by SpeCollate were mostly of smaller length 10. On the other hand, peptides identified by Crux and MSFragger (and missed by SpeCollate) followed similar length distribution to the overall set of identified peptides. On the other hand, the precursor charge distribution of unique peptides for each tool remains similar as the identified peptides are mostly of lower charge. As expected, both XCorr and MSFragger identify greater number of unique peptides with higher precursor charge when their default settings are used (i.e. theoretical fragments with &gt; +1 charge are allowed).</p>
        <fig position="float" id="pone.0259349.g011">
          <object-id pub-id-type="doi">10.1371/journal.pone.0259349.g011</object-id>
          <label>Fig 11</label>
          <caption>
            <title>Venn diagrams showing the overlap of peptides among SpeCollate, Crux, and MSFragger.</title>
            <p>As can be seen, most of the peptides are common among the three tools while SpeCollate does identify most unique peptides compared to Crux and MSFragger. See <xref rid="pone.0259349.s004" ref-type="supplementary-material">S4 File</xref> for list of peptides identified in each experiment.</p>
          </caption>
          <graphic xlink:href="pone.0259349.g011" position="float"/>
        </fig>
      </sec>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec023">
    <title>5 Discussion</title>
    <p>SpeCollate provides a stepping stone towards mass-spectrometry-based proteomics database search using deep learning. In contrast to previous approaches, SpeCollate maps both the spectra and peptide into an embedding which can then directly be compared with each other and eliminates the need for scoring functions and spectrum simulators. Our proposed cross-model method is then shown to work with deep learning methods that can outperform the state-the-of-art techniques. Through extensive experimentation using spectral libraries and real-world MS/MS data, we demonstrate the efficiency of our cross-modal learning technique, presenting further opportunities to the research community for exploring simulator-less peptide database search implementations.</p>
    <sec id="sec024">
      <title>5.1 Limitations and future directions</title>
      <p>Currently, SpeCollate is trained to match spectra to their exact peptide sequence, i.e., modified spectra are not embedded close to the non-modified peptide. Moreover, peptide embeddings are charge-independent, and the model only generates one embedding per peptide. Although spectra with a higher precursor charge &gt; 2 are mapped close to the peptide, they tend to be relatively farther than precursor charge 2. One of the future goals of our work is to enable open-search using deep learning, which in addition to identifying modified spectra, can also be used as a pre-search filter to extract a subset of relevant peptides. Furthermore, our next step is to enable charge-specific peptide embeddings to map spectra with different charges to their corresponding peptides efficiently. To this end, several research problems remain open, including curating improved training datasets, improving the network architecture to better capture the input domain, employing adversarial learning for bridging the modality gap between peptides and spectra and improving the training process by redesigning the loss-function from the ground up.</p>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec025">
    <title>6 Conclusion</title>
    <p>This paper designs and implements SpeCollate, a deep similarity network for proteomics, to learn a cross-modal similarity function between peptides and spectra to identify peptide-spectrum matches. Proteomics has entered the realm of Big-Data, and the number of available labeled and annotated spectra is increasing rapidly, enabling sophisticated models to be trained. SpeCollate provides a data-oriented algorithm design for peptide database search, eliminating the inherent problems associated with numerical strategies. This is achieved by learning a cross-modal similarity function that embeds spectra and peptides in a shared euclidean subspace for direct comparison. SpeCollate learns the similarity function by optimizing a custom-designed loss function, SNAP-loss, which trains on sextuplets of data points to project positive examples closer to each other while pushing negative examples far from each other. By training on 4.8 million sextuplets, SpeCollate is able to achieve a remarkable test accuracy of 95.5%. Although the test accuracy is relatively high, there is still room for real-world database search accuracy improvement. This can be improved by fine-tuning BiLSTM and generating better training data to enable the network to learn more features in future work.</p>
  </sec>
  <sec id="sec026" sec-type="supplementary-material">
    <title>Supporting information</title>
    <supplementary-material id="pone.0259349.s001" position="float" content-type="local-data">
      <label>S1 File</label>
      <caption>
        <title>Train test validation libraries.</title>
        <p>Details of libraries used in training, testing, and validating SpeCollate.</p>
        <p>(XLSX)</p>
      </caption>
      <media xlink:href="pone.0259349.s001.xlsx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pone.0259349.s002" position="float" content-type="local-data">
      <label>S2 File</label>
      <caption>
        <title>Datasets.</title>
        <p>Datasets used to compare SpeCollate’s performance against Crux and MSFragger.</p>
        <p>(XLSX)</p>
      </caption>
      <media xlink:href="pone.0259349.s002.xlsx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pone.0259349.s003" position="float" content-type="local-data">
      <label>S3 File</label>
      <caption>
        <title>UMAP.</title>
        <p>UMAP projections of embedded peptides and their corresponding spectra at different mass ranges.</p>
        <p>(PPTX)</p>
      </caption>
      <media xlink:href="pone.0259349.s003.pptx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pone.0259349.s004" position="float" content-type="local-data">
      <label>S4 File</label>
      <caption>
        <title>Peptides.</title>
        <p>List of peptides identified for different experiments.</p>
        <p>(XLSX)</p>
      </caption>
      <media xlink:href="pone.0259349.s004.xlsx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pone.0259349.s005" position="float" content-type="local-data">
      <label>S5 File</label>
      <caption>
        <title>Comparison.</title>
        <p>Comparison of SpeCollate with Default XCorr and MSFragger Settings.</p>
        <p>(DOCX)</p>
      </caption>
      <media xlink:href="pone.0259349.s005.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list>
    <title>References</title>
    <ref id="pone.0259349.ref001">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Tiwary</surname><given-names>S</given-names></name>, <name><surname>Levy</surname><given-names>R</given-names></name>, <name><surname>Gutenbrunner</surname><given-names>P</given-names></name>, <name><surname>Soto</surname><given-names>FS</given-names></name>, <name><surname>Palaniappan</surname><given-names>KK</given-names></name>, <name><surname>Deming</surname><given-names>L</given-names></name>, <etal>et al</etal>. <article-title>High-quality MS/MS spectrum prediction for data-dependent and data-independent acquisition data analysis</article-title>. <source>Nature methods</source>. <year>2019</year>; p. <fpage>1</fpage>. <?supplied-pmid 31133761?><pub-id pub-id-type="pmid">30573832</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref002">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>Gessulat</surname><given-names>S</given-names></name>, <name><surname>Schmidt</surname><given-names>T</given-names></name>, <name><surname>Zolg</surname><given-names>DP</given-names></name>, <name><surname>Samaras</surname><given-names>P</given-names></name>, <name><surname>Schnatbaum</surname><given-names>K</given-names></name>, <name><surname>Zerweck</surname><given-names>J</given-names></name>, <etal>et al</etal>. <article-title>Prosit: proteome-wide prediction of peptide tandem mass spectra by deep learning</article-title>. <source>Nature methods</source>. <year>2019</year>; p. <fpage>1</fpage>. <?supplied-pmid 31133760?><pub-id pub-id-type="pmid">30573832</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref003">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Zhou</surname><given-names>XX</given-names></name>, <name><surname>Zeng</surname><given-names>WF</given-names></name>, <name><surname>Chi</surname><given-names>H</given-names></name>, <name><surname>Luo</surname><given-names>C</given-names></name>, <name><surname>Liu</surname><given-names>C</given-names></name>, <name><surname>Zhan</surname><given-names>J</given-names></name>, <etal>et al</etal>. <article-title>pdeep: Predicting MS/MS spectra of peptides with deep learning</article-title>. <source>Analytical chemistry</source>. <year>2017</year>;<volume>89</volume>(<issue>23</issue>):<fpage>12690</fpage>–<lpage>12697</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/acs.analchem.7b02566</pub-id><?supplied-pmid 29125736?><pub-id pub-id-type="pmid">29125736</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref004">
      <label>4</label>
      <mixed-citation publication-type="journal"><name><surname>Gabriels</surname><given-names>R</given-names></name>, <name><surname>Martens</surname><given-names>L</given-names></name>, <name><surname>Degroeve</surname><given-names>S</given-names></name>. <article-title>Updated MS2PIP web server delivers fast and accurate MS2 peak intensity prediction for multiple fragmentation methods, instruments and labeling techniques</article-title>. <source>bioRxiv</source>. <year>2019</year>; p. <fpage>544965</fpage>.</mixed-citation>
    </ref>
    <ref id="pone.0259349.ref005">
      <label>5</label>
      <mixed-citation publication-type="journal"><name><surname>Diament</surname><given-names>BJ</given-names></name>, <name><surname>Noble</surname><given-names>WS</given-names></name>. <article-title>Faster SEQUEST searching for peptide identification from tandem mass spectra</article-title>. <source>Journal of proteome research</source>. <year>2011</year>;<volume>10</volume>(<issue>9</issue>):<fpage>3871</fpage>–<lpage>3879</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/pr101196n</pub-id><?supplied-pmid 21761931?><pub-id pub-id-type="pmid">21761931</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref006">
      <label>6</label>
      <mixed-citation publication-type="journal"><name><surname>Craig</surname><given-names>R</given-names></name>, <name><surname>Beavis</surname><given-names>RC</given-names></name>. <article-title>TANDEM: matching proteins with tandem mass spectra</article-title>. <source>Bioinformatics</source>. <year>2004</year>;<volume>20</volume>(<issue>9</issue>):<fpage>1466</fpage>–<lpage>1467</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/bioinformatics/bth092</pub-id><?supplied-pmid 14976030?><pub-id pub-id-type="pmid">14976030</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref007">
      <label>7</label>
      <mixed-citation publication-type="journal"><name><surname>Kong</surname><given-names>AT</given-names></name>, <name><surname>Leprevost</surname><given-names>FV</given-names></name>, <name><surname>Avtonomov</surname><given-names>DM</given-names></name>, <name><surname>Mellacheruvu</surname><given-names>D</given-names></name>, <name><surname>Nesvizhskii</surname><given-names>AI</given-names></name>. <article-title>MSFragger: ultrafast and comprehensive peptide identification in mass spectrometry–based proteomics</article-title>. <source>Nature methods</source>. <year>2017</year>;<volume>14</volume>(<issue>5</issue>):<fpage>513</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1038/nmeth.4256</pub-id><?supplied-pmid 28394336?><pub-id pub-id-type="pmid">28394336</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref008">
      <label>8</label>
      <mixed-citation publication-type="journal"><name><surname>Zhang</surname><given-names>J</given-names></name>, <name><surname>Xin</surname><given-names>L</given-names></name>, <name><surname>Shan</surname><given-names>B</given-names></name>, <name><surname>Chen</surname><given-names>W</given-names></name>, <name><surname>Xie</surname><given-names>M</given-names></name>, <name><surname>Yuen</surname><given-names>D</given-names></name>, <etal>et al</etal>. <article-title>PEAKS DB: de novo sequencing assisted database search for sensitive and accurate peptide identification</article-title>. <source>Molecular &amp; Cellular Proteomics</source>. <year>2012</year>;<volume>11</volume>(<issue>4</issue>):<fpage>M111</fpage>–<lpage>010587</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1074/mcp.M111.010587</pub-id><?supplied-pmid 22186715?><pub-id pub-id-type="pmid">22186715</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref009">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>Frank</surname><given-names>A</given-names></name>, <name><surname>Pevzner</surname><given-names>P</given-names></name>. <article-title>PepNovo: de novo peptide sequencing via probabilistic network modeling</article-title>. <source>Analytical chemistry</source>. <year>2005</year>;<volume>77</volume>(<issue>4</issue>):<fpage>964</fpage>–<lpage>973</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/ac048788h</pub-id><?supplied-pmid 15858974?><pub-id pub-id-type="pmid">15858974</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref010">
      <label>10</label>
      <mixed-citation publication-type="journal"><name><surname>Chi</surname><given-names>H</given-names></name>, <name><surname>Sun</surname><given-names>RX</given-names></name>, <name><surname>Yang</surname><given-names>B</given-names></name>, <name><surname>Song</surname><given-names>CQ</given-names></name>, <name><surname>Wang</surname><given-names>LH</given-names></name>, <name><surname>Liu</surname><given-names>C</given-names></name>, <etal>et al</etal>. <article-title>pNovo: de novo peptide sequencing and identification using HCD spectra</article-title>. <source>Journal of proteome research</source>. <year>2010</year>;<volume>9</volume>(<issue>5</issue>):<fpage>2713</fpage>–<lpage>2724</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/pr100182k</pub-id><?supplied-pmid 20329752?><pub-id pub-id-type="pmid">20329752</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref011">
      <label>11</label>
      <mixed-citation publication-type="journal"><name><surname>Yang</surname><given-names>H</given-names></name>, <name><surname>Chi</surname><given-names>H</given-names></name>, <name><surname>Zhou</surname><given-names>WJ</given-names></name>, <name><surname>Zeng</surname><given-names>WF</given-names></name>, <name><surname>He</surname><given-names>K</given-names></name>, <name><surname>Liu</surname><given-names>C</given-names></name>, <etal>et al</etal>. <article-title>Open-pNovo: de novo peptide sequencing with thousands of protein modifications</article-title>. <source>Journal of proteome research</source>. <year>2017</year>;<volume>16</volume>(<issue>2</issue>):<fpage>645</fpage>–<lpage>654</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/acs.jproteome.6b00716</pub-id><?supplied-pmid 28019094?><pub-id pub-id-type="pmid">28019094</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref012">
      <label>12</label>
      <mixed-citation publication-type="journal"><name><surname>Tran</surname><given-names>NH</given-names></name>, <name><surname>Zhang</surname><given-names>X</given-names></name>, <name><surname>Xin</surname><given-names>L</given-names></name>, <name><surname>Shan</surname><given-names>B</given-names></name>, <name><surname>Li</surname><given-names>M</given-names></name>. <article-title>De novo peptide sequencing by deep learning</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>2017</year>;<volume>114</volume>(<issue>31</issue>):<fpage>8247</fpage>–<lpage>8252</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1073/pnas.1705691114</pub-id><?supplied-pmid 28720701?><pub-id pub-id-type="pmid">28720701</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref013">
      <label>13</label>
      <mixed-citation publication-type="other">Qiao R, Tran NH, Xin L, Shan B, Li M, Ghodsi A. Deepnovov2: Better de novo peptide sequencing with deep learning. arXiv preprint arXiv:190408514. 2019.</mixed-citation>
    </ref>
    <ref id="pone.0259349.ref014">
      <label>14</label>
      <mixed-citation publication-type="journal"><name><surname>Ma</surname><given-names>B</given-names></name>, <name><surname>Zhang</surname><given-names>K</given-names></name>, <name><surname>Hendrie</surname><given-names>C</given-names></name>, <name><surname>Liang</surname><given-names>C</given-names></name>, <name><surname>Li</surname><given-names>M</given-names></name>, <name><surname>Doherty-Kirby</surname><given-names>A</given-names></name>, <etal>et al</etal>. <article-title>PEAKS: powerful software for peptide de novo sequencing by tandem mass spectrometry</article-title>. <source>Rapid communications in mass spectrometry</source>. <year>2003</year>;<volume>17</volume>(<issue>20</issue>):<fpage>2337</fpage>–<lpage>2342</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1002/rcm.1196</pub-id><?supplied-pmid 14558135?><pub-id pub-id-type="pmid">14558135</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref015">
      <label>15</label>
      <mixed-citation publication-type="journal"><name><surname>Taylor</surname><given-names>JA</given-names></name>, <name><surname>Johnson</surname><given-names>RS</given-names></name>. <article-title>Implementation and uses of automated de novo peptide sequencing by tandem mass spectrometry</article-title>. <source>Analytical chemistry</source>. <year>2001</year>;<volume>73</volume>(<issue>11</issue>):<fpage>2594</fpage>–<lpage>2604</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/ac001196o</pub-id><?supplied-pmid 11403305?><pub-id pub-id-type="pmid">11403305</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref016">
      <label>16</label>
      <mixed-citation publication-type="journal"><name><surname>Bandeira</surname><given-names>N</given-names></name>. <article-title>Spectral networks: a new approach to de novo discovery of protein sequences and posttranslational modifications</article-title>. <source>BioTechniques</source>. <year>2007</year>;<volume>42</volume>(<issue>6</issue>):<fpage>687</fpage>–<lpage>695</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.2144/000112487</pub-id><?supplied-pmid 17612289?><pub-id pub-id-type="pmid">17612289</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref017">
      <label>17</label>
      <mixed-citation publication-type="journal"><name><surname>Grossmann</surname><given-names>J</given-names></name>, <name><surname>Roos</surname><given-names>FF</given-names></name>, <name><surname>Cieliebak</surname><given-names>M</given-names></name>, <name><surname>Lipták</surname><given-names>Z</given-names></name>, <name><surname>Mathis</surname><given-names>LK</given-names></name>, <name><surname>Müller</surname><given-names>M</given-names></name>, <etal>et al</etal>. <article-title>AUDENS: a tool for automated peptide de novo sequencing</article-title>. <source>Journal of proteome research</source>. <year>2005</year>;<volume>4</volume>(<issue>5</issue>):<fpage>1768</fpage>–<lpage>1774</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/pr050070a</pub-id><?supplied-pmid 16212431?><pub-id pub-id-type="pmid">16212431</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref018">
      <label>18</label>
      <mixed-citation publication-type="journal"><name><surname>Mo</surname><given-names>L</given-names></name>, <name><surname>Dutta</surname><given-names>D</given-names></name>, <name><surname>Wan</surname><given-names>Y</given-names></name>, <name><surname>Chen</surname><given-names>T</given-names></name>. <article-title>MSNovo: a dynamic programming algorithm for de novo peptide sequencing via tandem mass spectrometry</article-title>. <source>Analytical chemistry</source>. <year>2007</year>;<volume>79</volume>(<issue>13</issue>):<fpage>4870</fpage>–<lpage>4878</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/ac070039n</pub-id><?supplied-pmid 17550227?><pub-id pub-id-type="pmid">17550227</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref019">
      <label>19</label>
      <mixed-citation publication-type="journal"><name><surname>Fernandez-de Cossio</surname><given-names>J</given-names></name>, <name><surname>Gonzalez</surname><given-names>J</given-names></name>, <name><surname>Satomi</surname><given-names>Y</given-names></name>, <name><surname>Shima</surname><given-names>T</given-names></name>, <name><surname>Okumura</surname><given-names>N</given-names></name>, <name><surname>Besada</surname><given-names>V</given-names></name>, <etal>et al</etal>. <article-title>Automated interpretation of low-energy collision-induced dissociation spectra by SeqMS, a software aid for de novo sequencing by tandem mass spectrometry</article-title>. <source>ELECTROPHORESIS: An International Journal</source>. <year>2000</year>;<volume>21</volume>(<issue>9</issue>):<fpage>1694</fpage>–<lpage>1699</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1002/(SICI)1522-2683(20000501)21:9&lt;1694::AID-ELPS1694&gt;3.0.CO;2-W</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref020">
      <label>20</label>
      <mixed-citation publication-type="journal"><name><surname>Jagannath</surname><given-names>S</given-names></name>, <name><surname>Sabareesh</surname><given-names>V</given-names></name>. <article-title>Peptide Fragment Ion Analyser (PFIA): a simple and versatile tool for the interpretation of tandem mass spectrometric data and de novo sequencing of peptides</article-title>. <source>Rapid Communications in Mass Spectrometry: An International Journal Devoted to the Rapid Dissemination of Up-to-the-Minute Research in Mass Spectrometry</source>. <year>2007</year>;<volume>21</volume>(<issue>18</issue>):<fpage>3033</fpage>–<lpage>3038</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1002/rcm.3179</pub-id><?supplied-pmid 17705347?><pub-id pub-id-type="pmid">17705347</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref021">
      <label>21</label>
      <mixed-citation publication-type="journal"><name><surname>Fischer</surname><given-names>B</given-names></name>, <name><surname>Roth</surname><given-names>V</given-names></name>, <name><surname>Roos</surname><given-names>F</given-names></name>, <name><surname>Grossmann</surname><given-names>J</given-names></name>, <name><surname>Baginsky</surname><given-names>S</given-names></name>, <name><surname>Widmayer</surname><given-names>P</given-names></name>, <etal>et al</etal>. <article-title>NovoHMM: a hidden Markov model for de novo peptide sequencing</article-title>. <source>Analytical chemistry</source>. <year>2005</year>;<volume>77</volume>(<issue>22</issue>):<fpage>7265</fpage>–<lpage>7273</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/ac0508853</pub-id><?supplied-pmid 16285674?><pub-id pub-id-type="pmid">16285674</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref022">
      <label>22</label>
      <mixed-citation publication-type="journal"><name><surname>Gupta</surname><given-names>N</given-names></name>, <name><surname>Bandeira</surname><given-names>N</given-names></name>, <name><surname>Keich</surname><given-names>U</given-names></name>, <name><surname>Pevzner</surname><given-names>PA</given-names></name>. <article-title>Target-decoy approach and false discovery rate: when things may go wrong</article-title>. <source>Journal of the American Society for Mass Spectrometry</source>. <year>2011</year>;<volume>22</volume>(<issue>7</issue>):<fpage>1111</fpage>–<lpage>1120</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1007/s13361-011-0139-3</pub-id><?supplied-pmid 21953092?><pub-id pub-id-type="pmid">21953092</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref023">
      <label>23</label>
      <mixed-citation publication-type="journal"><name><surname>Chick</surname><given-names>JM</given-names></name>, <name><surname>Kolippakkam</surname><given-names>D</given-names></name>, <name><surname>Nusinow</surname><given-names>DP</given-names></name>, <name><surname>Zhai</surname><given-names>B</given-names></name>, <name><surname>Rad</surname><given-names>R</given-names></name>, <name><surname>Huttlin</surname><given-names>EL</given-names></name>, <etal>et al</etal>. <article-title>A mass-tolerant database search identifies a large proportion of unassigned spectra in shotgun proteomics as modified peptides</article-title>. <source>Nature biotechnology</source>. <year>2015</year>;<volume>33</volume>(<issue>7</issue>):<fpage>743</fpage>–<lpage>749</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1038/nbt.3267</pub-id><?supplied-pmid 26076430?><pub-id pub-id-type="pmid">26076430</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref024">
      <label>24</label>
      <mixed-citation publication-type="journal"><name><surname>Tran</surname><given-names>NH</given-names></name>, <name><surname>Qiao</surname><given-names>R</given-names></name>, <name><surname>Xin</surname><given-names>L</given-names></name>, <name><surname>Chen</surname><given-names>X</given-names></name>, <name><surname>Liu</surname><given-names>C</given-names></name>, <name><surname>Zhang</surname><given-names>X</given-names></name>, <etal>et al</etal>. <article-title>Deep learning enables de novo peptide sequencing from data-independent-acquisition mass spectrometry</article-title>. <source>Nature methods</source>. <year>2019</year>;<volume>16</volume>(<issue>1</issue>):<fpage>63</fpage>–<lpage>66</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1038/s41592-018-0260-3</pub-id><?supplied-pmid 30573815?><pub-id pub-id-type="pmid">30573815</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref025">
      <label>25</label>
      <mixed-citation publication-type="journal"><name><surname>Kudriavtseva</surname><given-names>P</given-names></name>, <name><surname>Kashkinov</surname><given-names>M</given-names></name>, <name><surname>Kertész-Farkas</surname><given-names>A</given-names></name>. <article-title>Deep Convolutional Neural Networks Help Scoring Tandem Mass Spectrometry Data in Database-Searching Approaches</article-title>. <source>Journal of Proteome Research</source>. <year>2021</year>;. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/acs.jproteome.1c00315</pub-id><?supplied-pmid 34449232?><pub-id pub-id-type="pmid">34449232</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref026">
      <label>26</label>
      <mixed-citation publication-type="journal"><name><surname>Qin</surname><given-names>C</given-names></name>, <name><surname>Luo</surname><given-names>X</given-names></name>, <name><surname>Deng</surname><given-names>C</given-names></name>, <name><surname>Shu</surname><given-names>K</given-names></name>, <name><surname>Zhu</surname><given-names>W</given-names></name>, <name><surname>Griss</surname><given-names>J</given-names></name>, <etal>et al</etal>. <article-title>Deep learning embedder method and tool for mass spectra similarity search</article-title>. <source>Journal of Proteomics</source>. <year>2021</year>;<volume>232</volume>:<fpage>104070</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.jprot.2020.104070</pub-id><?supplied-pmid 33307250?><pub-id pub-id-type="pmid">33307250</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref027">
      <label>27</label>
      <mixed-citation publication-type="journal"><name><surname>Awan</surname><given-names>MG</given-names></name>, <name><surname>Saeed</surname><given-names>F</given-names></name>. <article-title>MaSS-Simulator: A Highly Configurable Simulator for Generating MS/MS Datasets for Benchmarking of Proteomics Algorithms</article-title>. <source>Proteomics</source>. <year>2018</year>;<volume>18</volume>(<issue>20</issue>):<fpage>1800206</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1002/pmic.201800206</pub-id><?supplied-pmid 30216669?><pub-id pub-id-type="pmid">30216669</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref028">
      <label>28</label>
      <mixed-citation publication-type="other">Faghri F, Fleet DJ, Kiros JR, Fidler S. Vse++: Improving visual-semantic embeddings with hard negatives. arXiv preprint arXiv:170705612. 2017.</mixed-citation>
    </ref>
    <ref id="pone.0259349.ref029">
      <label>29</label>
      <mixed-citation publication-type="other">Schroff F, Kalenichenko D, Philbin J. Facenet: A unified embedding for face recognition and clustering. In: Proceedings of the IEEE conference on computer vision and pattern recognition; 2015. p. 815–823.</mixed-citation>
    </ref>
    <ref id="pone.0259349.ref030">
      <label>30</label>
      <mixed-citation publication-type="journal"><name><surname>Wang</surname><given-names>L</given-names></name>, <name><surname>Li</surname><given-names>Y</given-names></name>, <name><surname>Huang</surname><given-names>J</given-names></name>, <name><surname>Lazebnik</surname><given-names>S</given-names></name>. <article-title>Learning two-branch neural networks for image-text matching tasks</article-title>. <source>IEEE Transactions on Pattern Analysis and Machine Intelligence</source>. <year>2018</year>;<volume>41</volume>(<issue>2</issue>):<fpage>394</fpage>–<lpage>407</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1109/TPAMI.2018.2797921</pub-id><?supplied-pmid 29994350?><pub-id pub-id-type="pmid">29994350</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref031">
      <label>31</label>
      <mixed-citation publication-type="other">Nam H, Ha JW, Kim J. Dual attention networks for multimodal reasoning and matching. In: Proceedings of the IEEE conference on computer vision and pattern recognition; 2017. p. 299–307.</mixed-citation>
    </ref>
    <ref id="pone.0259349.ref032">
      <label>32</label>
      <mixed-citation publication-type="journal"><name><surname>May</surname><given-names>DH</given-names></name>, <name><surname>Bilmes</surname><given-names>J</given-names></name>, <name><surname>Noble</surname><given-names>WS</given-names></name>. <article-title>A learned embedding for efficient joint analysis of millions of mass spectra</article-title>. <source>BioRxiv</source>. <year>2018</year>; p. <fpage>483263</fpage>.</mixed-citation>
    </ref>
    <ref id="pone.0259349.ref033">
      <label>33</label>
      <mixed-citation publication-type="journal"><name><surname>Schultz</surname><given-names>M</given-names></name>, <name><surname>Joachims</surname><given-names>T</given-names></name>. <article-title>Learning a distance metric from relative comparisons</article-title>. In: <source>Advances in neural information processing systems</source>; <year>2004</year>. p. <fpage>41</fpage>–<lpage>48</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0259349.ref034">
      <label>34</label>
      <mixed-citation publication-type="other">McInnes L, Healy J, Melville J. Umap: Uniform manifold approximation and projection for dimension reduction. arXiv preprint arXiv:180203426. 2018.</mixed-citation>
    </ref>
    <ref id="pone.0259349.ref035">
      <label>35</label>
      <mixed-citation publication-type="journal"><name><surname>Sharma</surname><given-names>K</given-names></name>, <name><surname>D’Souza</surname><given-names>RC</given-names></name>, <name><surname>Tyanova</surname><given-names>S</given-names></name>, <name><surname>Schaab</surname><given-names>C</given-names></name>, <name><surname>Wiśniewski</surname><given-names>JR</given-names></name>, <name><surname>Cox</surname><given-names>J</given-names></name>, <etal>et al</etal>. <article-title>Ultradeep human phosphoproteome reveals a distinct regulatory nature of Tyr and Ser/Thr-based signaling</article-title>. <source>Cell reports</source>. <year>2014</year>;<volume>8</volume>(<issue>5</issue>):<fpage>1583</fpage>–<lpage>1594</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.celrep.2014.07.036</pub-id><?supplied-pmid 25159151?><pub-id pub-id-type="pmid">25159151</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref036">
      <label>36</label>
      <mixed-citation publication-type="journal"><name><surname>Bittremieux</surname><given-names>W</given-names></name>, <name><surname>Meysman</surname><given-names>P</given-names></name>, <name><surname>Noble</surname><given-names>WS</given-names></name>, <name><surname>Laukens</surname><given-names>K</given-names></name>. <article-title>Fast open modification spectral library searching through approximate nearest neighbor indexing</article-title>. <source>Journal of proteome research</source>. <year>2018</year>;<volume>17</volume>(<issue>10</issue>):<fpage>3463</fpage>–<lpage>3474</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/acs.jproteome.8b00359</pub-id><?supplied-pmid 30184435?><pub-id pub-id-type="pmid">30184435</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref037">
      <label>37</label>
      <mixed-citation publication-type="journal"><name><surname>Chick</surname><given-names>JM</given-names></name>, <name><surname>Kolippakkam</surname><given-names>D</given-names></name>, <name><surname>Nusinow</surname><given-names>DP</given-names></name>, <name><surname>Zhai</surname><given-names>B</given-names></name>, <name><surname>Rad</surname><given-names>R</given-names></name>, <name><surname>Huttlin</surname><given-names>EL</given-names></name>, <etal>et al</etal>. <article-title>A mass-tolerant database search identifies a large proportion of unassigned spectra in shotgun proteomics as modified peptides</article-title>. <source>Nature biotechnology</source>. <year>2015</year>;<volume>33</volume>(<issue>7</issue>):<fpage>743</fpage>–<lpage>749</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1038/nbt.3267</pub-id><?supplied-pmid 26076430?><pub-id pub-id-type="pmid">26076430</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref038">
      <label>38</label>
      <mixed-citation publication-type="journal"><name><surname>Park</surname><given-names>CY</given-names></name>, <name><surname>Klammer</surname><given-names>AA</given-names></name>, <name><surname>Kall</surname><given-names>L</given-names></name>, <name><surname>MacCoss</surname><given-names>MJ</given-names></name>, <name><surname>Noble</surname><given-names>WS</given-names></name>. <article-title>Rapid and accurate peptide identification from tandem mass spectra</article-title>. <source>Journal of proteome research</source>. <year>2008</year>;<volume>7</volume>(<issue>7</issue>):<fpage>3022</fpage>–<lpage>3027</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/pr800127y</pub-id><?supplied-pmid 18505281?><pub-id pub-id-type="pmid">18505281</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0259349.ref039">
      <label>39</label>
      <mixed-citation publication-type="journal"><name><surname>Käll</surname><given-names>L</given-names></name>, <name><surname>Canterbury</surname><given-names>JD</given-names></name>, <name><surname>Weston</surname><given-names>J</given-names></name>, <name><surname>Noble</surname><given-names>WS</given-names></name>, <name><surname>MacCoss</surname><given-names>MJ</given-names></name>. <article-title>Semi-supervised learning for peptide identification from shotgun proteomics datasets</article-title>. <source>Nature methods</source>. <year>2007</year>;<volume>4</volume>(<issue>11</issue>):<fpage>923</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1038/nmeth1113</pub-id><?supplied-pmid 17952086?><pub-id pub-id-type="pmid">17952086</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
