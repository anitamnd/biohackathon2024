<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature Methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
    <publisher>
      <publisher-name>Nature Publishing Group US</publisher-name>
      <publisher-loc>New York</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9636021</article-id>
    <article-id pub-id-type="pmid">36253643</article-id>
    <article-id pub-id-type="publisher-id">1639</article-id>
    <article-id pub-id-type="doi">10.1038/s41592-022-01639-4</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Omnipose: a high-precision morphology-independent solution for bacterial cell segmentation</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7624-5923</contrib-id>
        <name>
          <surname>Cutler</surname>
          <given-names>Kevin J.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9229-4100</contrib-id>
        <name>
          <surname>Stringer</surname>
          <given-names>Carsen</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lo</surname>
          <given-names>Teresa W.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1707-8088</contrib-id>
        <name>
          <surname>Rappez</surname>
          <given-names>Luca</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9530-7301</contrib-id>
        <name>
          <surname>Stroustrup</surname>
          <given-names>Nicholas</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Brook Peterson</surname>
          <given-names>S.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Wiggins</surname>
          <given-names>Paul A.</given-names>
        </name>
        <address>
          <email>pwiggins@uw.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-5417-4861</contrib-id>
        <name>
          <surname>Mougous</surname>
          <given-names>Joseph D.</given-names>
        </name>
        <address>
          <email>mougous@uw.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff5">5</xref>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.34477.33</institution-id><institution-id institution-id-type="ISNI">0000000122986657</institution-id><institution>Department of Physics, </institution><institution>University of Washington, </institution></institution-wrap>Seattle, WA USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.443970.d</institution-id><institution>HHMI Janelia Research Campus, </institution></institution-wrap>Ashburn, VA USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.473715.3</institution-id><institution-id institution-id-type="ISNI">0000 0004 6475 7299</institution-id><institution>Centre for Genomic Regulation (CRG), </institution><institution>The Barcelona Institute of Science and Technology, </institution></institution-wrap>Barcelona, Spain </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.5612.0</institution-id><institution-id institution-id-type="ISNI">0000 0001 2172 2676</institution-id><institution>Universitat Pompeu Fabra (UPF), </institution></institution-wrap>Barcelona, Spain </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="GRID">grid.34477.33</institution-id><institution-id institution-id-type="ISNI">0000000122986657</institution-id><institution>Department of Microbiology, </institution><institution>University of Washington, </institution></institution-wrap>Seattle, WA USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="GRID">grid.34477.33</institution-id><institution-id institution-id-type="ISNI">0000000122986657</institution-id><institution>Department of Bioengineering, </institution><institution>University of Washington, </institution></institution-wrap>Seattle, WA USA </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="GRID">grid.34477.33</institution-id><institution-id institution-id-type="ISNI">0000000122986657</institution-id><institution>Howard Hughes Medical Institute, </institution><institution>University of Washington, </institution></institution-wrap>Seattle, WA USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>17</day>
      <month>10</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>17</day>
      <month>10</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <year>2022</year>
    </pub-date>
    <volume>19</volume>
    <issue>11</issue>
    <fpage>1438</fpage>
    <lpage>1448</lpage>
    <history>
      <date date-type="received">
        <day>2</day>
        <month>12</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>6</day>
        <month>9</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Advances in microscopy hold great promise for allowing quantitative and precise measurement of morphological and molecular phenomena at the single-cell level in bacteria; however, the potential of this approach is ultimately limited by the availability of methods to faithfully segment cells independent of their morphological or optical characteristics. Here, we present Omnipose, a deep neural network image-segmentation algorithm. Unique network outputs such as the gradient of the distance field allow Omnipose to accurately segment cells on which current algorithms, including its predecessor, Cellpose, produce errors. We show that Omnipose achieves unprecedented segmentation performance on mixed bacterial cultures, antibiotic-treated cells and cells of elongated or branched morphology. Furthermore, the benefits of Omnipose extend to non-bacterial subjects, varied imaging modalities and three-dimensional objects. Finally, we demonstrate the utility of Omnipose in the characterization of extreme morphological phenotypes that arise during interbacterial antagonism. Our results distinguish Omnipose as a powerful tool for characterizing diverse and arbitrarily shaped cell types from imaging data.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Omnipose is a deep neural network algorithm for image segmentation that improves upon existing approaches by solving the challenging problem of accurately segmenting morphologically diverse cells from images acquired with any modality.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Bacteria</kwd>
      <kwd>Imaging</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000060</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Institute of Allergy and Infectious Diseases (NIAID)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>AI080609</award-id>
        <principal-award-recipient>
          <name>
            <surname>Mougous</surname>
            <given-names>Joseph D.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000011</institution-id>
            <institution>Howard Hughes Medical Institute (HHMI)</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000057</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Institute of General Medical Sciences (NIGMS)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>T32-GM008268</award-id>
        <award-id>GM128191</award-id>
        <principal-award-recipient>
          <name>
            <surname>Cutler</surname>
            <given-names>Kevin J.</given-names>
          </name>
          <name>
            <surname>Wiggins</surname>
            <given-names>Paul A.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000002</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01-GM128191</award-id>
        <principal-award-recipient>
          <name>
            <surname>Lo</surname>
            <given-names>Teresa W.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100010663</institution-id>
            <institution>EC | EU Framework Programme for Research and Innovation H2020 | H2020 Priority Excellent Science | H2020 European Research Council (H2020 Excellent Science - European Research Council)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>852201</award-id>
        <award-id>852201</award-id>
        <principal-award-recipient>
          <name>
            <surname>Rappez</surname>
            <given-names>Luca</given-names>
          </name>
          <name>
            <surname>Stroustrup</surname>
            <given-names>Nicholas</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100011092</institution-id>
            <institution>University of Chile | Faculty of Physical and Mathematical Sciences | Centro de Excelencia en Geotermia de Los Andes (Andean Geothermal Center of Excellence)</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s), under exclusive licence to Springer Nature America, Inc. 2022</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Main</title>
    <p id="Par3">Although light microscopy is a valuable tool for characterizing cellular and subcellular structures and dynamics, quantitative analysis of microscopy images remains a persistent challenge<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. This is especially pertinent to the study of bacteria, many of which have dimensions in the range of visible wavelengths. Thus, their cell body is composed of a small number of pixels (for example, ~100–300 px<sup>2</sup> for <italic>Escherichia</italic> <italic>coli</italic> in typical experiments). At this scale, accurate subcellular localization requires defining the cell boundary with single-pixel precision. The process of defining boundaries within images is termed segmentation, and this is a critical first step in image analysis pipelines<sup><xref ref-type="bibr" rid="CR2">2</xref>,<xref ref-type="bibr" rid="CR3">3</xref></sup>.</p>
    <p id="Par4">In addition to their small size, bacteria adopt a wide range of morphologies. Although many commonly studied bacteria are well approximated by rods or spheres, there is growing interest in bacteria with more elaborate shapes<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>. Some examples include Streptomycetales, which form long filamentous and branched structures<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>, and Caulobacterales, which possess extended appendages distinct from their cytoplasm<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>. Furthermore, microfluidic devices are allowing researchers to capture the responses of bacteria to assorted treatments such as antibiotics, which often result in highly irregular morphologies<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>. Whether native or induced, atypical cell morphologies present a distinct problem at the cell-segmentation phase of image analysis<sup><xref ref-type="bibr" rid="CR8">8</xref>,<xref ref-type="bibr" rid="CR9">9</xref></sup>. This is compounded when such cells are present alongside those adopting other morphologies, as is the case in many natural samples of interest<sup><xref ref-type="bibr" rid="CR10">10</xref></sup>. Although some algorithms can be trained to segment objects imaged using assorted modalities, to date there is no generalizable solution for segmenting bacterial cells of assorted size and shape<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>.</p>
    <p id="Par5">Cell segmentation is a complex problem that extends beyond microbiological research; thus, many solutions are currently available in image-analysis programs<sup><xref ref-type="bibr" rid="CR8">8</xref>,<xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR11">11</xref>–<xref ref-type="bibr" rid="CR27">27</xref></sup>. Most of these solutions use traditional image-processing techniques such as intensity thresholding to segment isolated cells; however, this approach performs poorly on cells in close contact and it requires image-by-image tuning to optimize parameters. SuperSegger was developed to address thresholding issues specifically in bacterial phase-contrast images<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. This program utilizes both traditional image filtering techniques and a shallow neural network to correct for errors that thresholding and watershed segmentation tend to produce.</p>
    <p id="Par6">Deep neural networks (DNNs) are now widely recognized as superior tools for cell segmentation<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>. Unlike traditional image processing, machine-learning approaches such as DNNs require training on a ground-truth dataset of cells and corresponding labels. Trained DNNs are thus limited in applicability to images that are representative of those in the training dataset. Early DNN approaches were based on the Mask R-CNN architecture<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>, whereas more recent algorithms such as StarDist, Cellpose and MiSiC are based on the U-net architecture<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR26">26</xref></sup>. Pachitariu and colleagues showed that Cellpose outperforms Mask R-CNN and StarDist on a variety of cell types and cell-like objects, distinguishing it as a general solution for cell segmentation<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>. Notably, the representation of bacteria in their study was limited. MiSiC was developed as a general DNN-based solution for bacterial segmentation; however, the authors of MiSiC did not provide comparisons to other DNN algorithms<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. Here, we evaluated the performance of state-of-the-art cell segmentation algorithms on a diverse collection of bacterial cells. Our findings motivated the design of a new algorithm, Omnipose, which substantially outperforms all segmentation algorithms tested across a wide range of bacterial cell sizes, morphologies, and optical characteristics. We have made Omnipose and all associated data available to researchers and we anticipate that our model, without retraining, can be applied to diverse bacteriological systems. Furthermore, following the incorporation of additional ground-truth data, Omnipose could serve as a platform for segmenting various eukaryotic cells and extended, anisotropic objects more broadly.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Evaluation of bacterial cell segmentation algorithms</title>
      <p id="Par7">Numerous image segmentation algorithms have been developed and the performance of many of these on bacterial cells is documented<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. These broadly fall into three categories: (1) traditional image-processing approaches (for example, thresholding and watershed); (2) traditional/machine-learning hybrid approaches; and (3) DNN approaches. Given the goal of developing software with the capacity to recognize bacteria universally, we sought to identify strongly performing algorithms for further development. An unbiased, quantitative comparison of cell segmentation algorithms on bacterial cells has not been performed; thus, we selected one or more representatives from each category for our analysis: Morphometrics<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> (1); SuperSegger<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> (2); and Mask R-CNN<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>, StarDist<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>, MiSiC<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>, and Cellpose<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> (3). A detailed review of these choices is in the <xref rid="Sec10" ref-type="sec">Methods</xref>.</p>
      <p id="Par8">For training and benchmarking of these algorithms, we acquired micrographs of assorted bacterial species representing diverse morphologies and optical characteristics. Many studies of bacteria involve mutations or treatments that cause extreme morphologies. To capture this additional diversity, we included wild-type and mutant bacteria grown in the presence of two β-lactam antibiotics, cephalexin and aztreonam, and A22, which targets MreB<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>. Finally, based on our interest in microbial communities, we acquired images of mixtures of bacterial species which display distinct morphologies and optical characteristics. In total, we collected 4,833 images constituting approximately 700,900 individual cells deriving from 14 species (Supplementary Table <xref rid="MOESM3" ref-type="media">1</xref>). Next, we developed a streamlined approach for manual cell annotation and applied it to these images (<xref rid="Sec10" ref-type="sec">Methods</xref>), yielding 47,000 representative annotated cells that serve as our ground-truth dataset (bact_phase). We divided this data into a 27,500-cell training set and a 19,500-cell benchmarking set. Relevant cellular metrics (area, perimeter and mean diameter) did not differ substantially between the groups, confirming that the benchmarking set faithfully represents the training set (Extended Data Fig. <xref rid="Fig7" ref-type="fig">1</xref>).</p>
      <p id="Par9">To facilitate direct comparison of the algorithms, we first optimized their performance against our data. For the DNN approaches, each algorithm was trained on our dataset using developer-recommended parameters. Morphometrics and SuperSegger cannot be automatically optimized using ground-truth data; therefore, we manually identified settings that optimized the performance of these algorithms against our dataset (<xref rid="Sec10" ref-type="sec">Methods</xref>). As a quantitative measure for algorithm performance, we compared their average Jaccard index (JI) as a function of intersection over union (IoU) threshold (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>)<sup><xref ref-type="bibr" rid="CR30">30</xref>,<xref ref-type="bibr" rid="CR31">31</xref></sup>. IoU values lie between zero and one, with values greater than 0.8 marking the point at which masks become indistinguishable from ground truth by the expert human eye (Extended Data Fig. <xref rid="Fig8" ref-type="fig">2</xref>)<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. This analysis showed that DNN-based approaches outperform other algorithms; however, substantial differences in performance within the DNN group were observed. Cellpose and StarDist outperform Mask R-CNN and MiSiC at high IoU thresholds. The performance of all algorithms varied greatly across images in the bact_phase dataset, with much of this variability delineated by cell type and morphology categories (Fig. <xref rid="Fig1" ref-type="fig">1b–g</xref>). Whereas all other algorithms exhibited visible segmentation errors in two of the three cell categories we defined, errors by Cellpose were only apparent in elongated cells (Fig. <xref rid="Fig1" ref-type="fig">1h–j</xref>).<fig id="Fig1"><label>Fig. 1</label><caption><title>Quantitative comparison of segmentation methods distinguishes Cellpose as a high-performing algorithm.</title><p><bold>a–g</bold>, Comparison of segmentation algorithm performance on our bact_phase test dataset (<italic>n</italic> = 19,538 cells). Overall performance measured by JI (<bold>a</bold>). MM, Morphometrics; MR, Mask R-CNN; CP, Cellpose; SS, SuperSegger; MS, MiSiC; SD, StarDist. The JI was calculated at the image level and values averaged across the dataset are displayed. Algorithm performance was partitioned by cell type (simple, <italic>n</italic> = 12,869; Abx/mutant, <italic>n</italic> = 6,138; elongated, <italic>n</italic> = 531) (<bold>b–g</bold>). Images were sorted into types as defined in Supplementary Table <xref rid="MOESM3" ref-type="media">1</xref>. Abx, antibiotic. Boxes are centered on medians from Q1 to Q3, whiskers from Q1 − 1.5 IQR to Q3 + 1.5 IQR. IQR, interquartile range Q3–Q1. <bold>h–j</bold>, Representative micrographs of cell type partitions analyzed in <bold>b</bold>–<bold>g</bold>, indicated by vertical bars on right. Ground-truth masks and predicted mask outlines generated by the indicated algorithm are displayed. Mean matched IoU values for cells shown are displayed within each micrograph. Bacteria displayed are <italic>Vibrio</italic> <italic>cholerae</italic>, <italic>Pseudomonas</italic> <italic>aeruginosa</italic>, <italic>Bacillus</italic> <italic>subtilis</italic>, and <italic>Staphylococcus</italic> <italic>aureus</italic> (<bold>h</bold>), aztreonam-treated <italic>E.</italic> <italic>coli</italic> CS703-1 (<bold>i</bold>), and <italic>Streptomyces</italic> <italic>pristinaespiralis</italic> (<bold>j</bold>). All images are scaled equivalently. Scale bar, 1 μm.</p></caption><graphic xlink:href="41592_2022_1639_Fig1_HTML" id="d32e674"/></fig></p>
    </sec>
    <sec id="Sec4">
      <title>Motivation for a new DNN-based segmentation algorithm</title>
      <p id="Par10">Our comparison revealed that Cellpose offers superior performance relative to the other segmentation algorithms we analyzed, and for this reason we selected this algorithm for further development. Notably, even at the high performance levels of Cellpose, only 81% of predictions on our benchmarking dataset are above 0.8 IoU. This limits the feasibility of highly quantitative studies such as those involving subcellular protein localization or cell–cell interactions.</p>
      <p id="Par11">Cellpose utilizes a two-step process. Its neural network first transforms an input image into several intermediate outputs, including a scalar probability field for identifying cell pixels in the next step (Extended Data Fig. <xref rid="Fig9" ref-type="fig">3a(i)–(iii)</xref>)<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>. Cellpose is unique among DNN algorithms by the addition of a vector field output (the flow field), which is defined by the normalized gradient of a heat distribution from the median cell pixel coordinate (Extended Data Fig. <xref rid="Fig9" ref-type="fig">3a(iv),(v)</xref>). In the second step, this vector field directs pixels toward a global cell center via Euler integration, thereby segmenting cells based on the points at which pixels coalesce (Extended Data Fig. <xref rid="Fig9" ref-type="fig">3b</xref>). In contrast to other algorithms, this approach for reconstructing cell masks is size- and morphology-independent, insofar as the cell center can be correctly defined.</p>
      <p id="Par12">To understand the mechanisms behind Cellpose segmentation errors, we evaluated its performance as a function of cell size on our bact_phase dataset. We compared cell area against the number of segmentation errors, calculated as the number of redundant or missing masks corresponding to each ground-truth cell mask. This revealed a strong correlation between cell size and segmentation errors, with the top quartile of cells accounting for 83% of all errors (Extended Data Fig. <xref rid="Fig10" ref-type="fig">4a</xref>). To understand the source of these errors, we inspected the flow field output of many poorly segmented cells across a variety of species and growth conditions. This showed that elongated cells, an important morphology often seen in both wild-type and mutant bacterial populations, are particularly susceptible to over-segmentation (Extended Data Fig. <xref rid="Fig10" ref-type="fig">4b</xref>). We attribute this to the multiple sinks apparent in the corresponding flow fields. In the Cellpose mask reconstruction algorithm, pixels belonging to these cells are guided into multiple centers per cell, fragmenting the cell into many separate masks.</p>
      <p id="Par13">We hypothesized that the defect in Cellpose flow field output is a consequence of two distinct flow field types arising from our training dataset: those where the median pixel coordinate, or ‘center’, lies within the cell (97.8%) and those where it lies outside the cell (2.2%). In the latter, Cellpose projects the center point to the nearest boundary pixel, ultimately leading to points of negative divergence on cell peripheries that are chaotically distributed (Extended Data Fig. <xref rid="Fig10" ref-type="fig">4c–e</xref>). On the contrary, non-projected centers maintain a uniform field magnitude along the entire boundary and adhere to the global symmetries of the cell (Extended Data Fig. <xref rid="Fig11" ref-type="fig">5a,d</xref>). A similar issue is also encountered in cells with centers that fall close to but not outside of the boundary (Extended Data Fig. <xref rid="Fig11" ref-type="fig">5b–d</xref>). Cells with a center point closer than 0.3 times the mean cell diameter (a factor of 0.2 off-center) to the boundary account for an additional 9.6% of our training dataset. Neural networks can be exquisitely sensitive to the outliers in their training data<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>; therefore, we suspect that this small fraction of corrupt flow fields has a disproportionate impact on the performance of Cellpose.</p>
    </sec>
    <sec id="Sec5">
      <title>Development of a high-precision U-net segmentation algorithm</title>
      <p id="Par14">We sought to develop a segmentation algorithm that operates independently of cell center identification. The algorithm we developed is based on the framework of Cellpose, which can be divided into five key components: file handling, neural network architecture, training objective functions, network predictions, and mask reconstruction. We made improvements to each of these components; however, the major innovations in our algorithm, which we named Omnipose, pertain to network predictions and mask reconstruction.</p>
      <p id="Par15">Unlike the cell probability and center-seeking flow field upon which Cellpose is constructed, we built Omnipose on three distinct network outputs: a cell boundary probability map, the distance field, and a flow field defined by the gradient of the distance field. The distance field (or distance transform) describes the distance at any point <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\vec x$$\end{document}</tex-math><mml:math id="M2"><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41592_2022_1639_Article_IEq1.gif"/></alternatives></inline-formula> in a bounded region Ω to the closest point on the boundary ∂Ω. Notably, this widely utilized construct is one of the intermediate outputs of StarDist<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. Whereas StarDist uses a distance field prediction to seed and assemble star-convex polygons, Omnipose implements the distance field as a replacement to the cell probability output of Cellpose. The use of a distance field has several advantages. First, the distance field is more structured than a binary probability map and offers higher fidelity thresholding to seed cell masks. Second, the distance field is defined by the eikonal equation <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$| {\vec \nabla {{\Phi }}\left( {\vec x} \right)} | = 1$$\end{document}</tex-math><mml:math id="M4"><mml:mrow><mml:mo>∣</mml:mo><mml:mover accent="true"><mml:mrow><mml:mo>∇</mml:mo></mml:mrow><mml:mo>→</mml:mo></mml:mover><mml:mi mathvariant="normal">Φ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow></mml:mfenced><mml:mo>∣</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="41592_2022_1639_Article_IEq2.gif"/></alternatives></inline-formula> and so its gradient (the flow field of Omnipose) has unit magnitude throughout the bounded region for which it is calculated. This leads to faster convergence and better numerical stability when compared to alternative solutions producing similar fields (for example, screened Poisson) (<xref rid="Sec10" ref-type="sec">Methods</xref> and Extended Data Fig. <xref rid="Fig12" ref-type="fig">6a</xref>). Third, the distance field is independent of morphology and topology, meaning that it is applicable to all cell shapes and sizes. Last, the resulting flow field points uniformly from cell boundaries toward the local cell center, coinciding with the medial axis (skeleton) that is defined by the stationary points of the distance field (Extended Data Fig. <xref rid="Fig12" ref-type="fig">6b</xref>). This critical feature allows pixels to remain spatially clustered after Euler integration, solving the problem of over-segmentation seen in Cellpose.</p>
      <p id="Par16">One challenge to implementing a distance-field-based approach is that traditional distance field algorithms such as fast marching method (FMM) are sensitive to boundary pixelation<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>, causing artifacts in the flow field that extend deep into the cell. These artifacts are sensitive to pixel-scale changes at the cell perimeter, which we reasoned would interfere with the training process. To solve this problem, we developed an alternative approach based on fast iterative method (FIM) that produces smooth distance fields for arbitrary cell shapes and sizes (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>, Extended Data Fig. <xref rid="Fig12" ref-type="fig">6</xref> and <xref rid="Sec10" ref-type="sec">Methods</xref>)<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>. The corresponding flow field is relatively insensitive to boundary features at points removed from the cell boundary, a critical property for robust and generalized prediction by the Cellpose network.<fig id="Fig2"><label>Fig. 2</label><caption><title>Core innovations of Omnipose.</title><p><bold>a</bold>, Comparison of distance field algorithms and corresponding flow fields on ground-truth masks. FMM produces ridges in the distance field resulting from pixelation on the cell mask boundary. Our smooth FIM algorithm minimizes these features. The difference image (FIM − FMM) highlights artifacts in the FMM method. Flow fields are calculated as the normalized gradient of the distance field. Boundary pixelation affects the FMM flow field deep into the cell, regardless of cell size. <bold>b</bold>,<bold>c</bold>, Comparison of mask reconstruction algorithms on a smooth flow field. Boundary pixel trajectories and resulting mask outlines from standard Euler integration (<bold>b</bold>). Trajectories and mask outlines under suppressed Euler integration (<bold>c</bold>). Red dots indicate the final positions of all cell pixels, not only the boundary pixels for which trajectories are displayed. Bacteria displayed are <italic>E.</italic> <italic>coli</italic> CS703-1 (<bold>a</bold>) and <italic>H.</italic> <italic>pylori</italic> (<bold>b</bold>,<bold>c</bold>) both treated with aztreonam. Scale bars, 1 μm. Images are representative of 1,299 <italic>E.</italic> <italic>coli</italic> and 701 <italic>H.</italic> <italic>pylori</italic> cells in the total ground-truth dataset, respectively.</p></caption><graphic xlink:href="41592_2022_1639_Fig2_HTML" id="d32e865"/></fig></p>
      <p id="Par17">The use of the distance field additionally required a unique solution for mask reconstruction. Whereas the pixels in a center-seeking field converge on a point, standard Euler integration under our distance-derived field tends to cluster pixels into multiple thin fragments along the skeleton, causing over-segmentation (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>). We solved this with a suppression factor of (<italic>t</italic> + 1)<sup>−1</sup> in each time step of the Euler integration (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). This reduces the movement of each pixel after the first step <italic>t</italic> = 0, facilitating initial cell separation while preventing pixels from clustering into a fragmented skeleton formation. The wider point distribution resulting from our suppression factor allows pixels to remain connected, thereby generating a single mask for each cell in conjunction with a standard automated point clustering algorithm (for example, DBSCAN)<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>.</p>
    </sec>
    <sec id="Sec6">
      <title>Omnipose demonstrates unprecedented segmentation accuracy</title>
      <p id="Par18">To benchmark the performance of Omnipose, we trained a model (bact_phase_omni) on our bact_phase dataset. Remarkably, across the IoU threshold range 0.5–1.0, the accuracy of Omnipose substantially exceeds that of Cellpose using a corresponding model (bact_phase_cp) (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>). This difference in performance between the algorithms is particularly pronounced within the high IoU range 0.8–1.0. Bacteria are 0.5–5 μm in scale and are typically imaged with a calibrated pixel size of about 0.1 μm, resulting in cells and cell labels that are 5–50 pixels across<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>. Quantitative measurements at this scale require pixel-level accuracy, corresponding to IoU values above 0.8 (Extended Data Fig. <xref rid="Fig8" ref-type="fig">2</xref>). Thus, Omnipose is uniquely suited for the microscopic analysis of bacterial cells.<fig id="Fig3"><label>Fig. 3</label><caption><title>Omnipose substantially outperforms Cellpose on elongated cells.</title><p><bold>a</bold>, Overall performance of Omnipose (OP) (bact_phase_omni) and Cellpose (CP) (bact_phase_cp) measured by JI. The hybrid method (gray) uses the original center-seeking flow output of bact_phase_cp and the mask reconstruction of Omnipose. Gray box represents IoU ≥ 0.8. <italic>n</italic> = 19,570 cells in the test set. <bold>b</bold>, Quantification of segmentation performance by cell size. The percent of cells with at least one segmentation error is computed for cells in each area percentile group from 1 to 100. Gray box represents the top quartile. <bold>c</bold>, Omnipose IoU distribution on the bact_phase dataset compared to the next highest performing algorithm in each of three cell categories (simple, <italic>n</italic> = 12,869; Abx/mutant, <italic>n</italic> = 6,138; and elongated, <italic>n</italic> = 531). Boxes centered on medians from Q1 to Q3, whiskers from Q1 − 1.5 IQR to Q3 + 1.5 IQR. <bold>d</bold>, Example micrographs and Omnipose segmentation. Mean matched IoU values shown. Bacteria displayed are <italic>Streptomyces</italic> <italic>pristinaespiralis</italic> (i), <italic>Caulobacter</italic> <italic>crescentus</italic> grown in HIGG medium (ii), <italic>Shigella</italic> <italic>flexneri</italic> treated with A22 (iii) and a mix <italic>of Pseudomonas</italic> <italic>aeruginosa, Staphylococcus</italic> <italic>aureus, V.</italic> <italic>cholerae</italic>, and <italic>Bacillus</italic> <italic>subtilis</italic> (iv). HIGG, Hutner base–imidazole-buffered glucose–glutamate. Scale bars, 1 μm.</p></caption><graphic xlink:href="41592_2022_1639_Fig3_HTML" id="d32e975"/></fig></p>
      <p id="Par19">To dissect the contributions of the individual Omnipose innovations to the overall performance of the algorithm, we isolated the mask reconstruction component of Omnipose and applied it to the Cellpose network output. This augmentation of Cellpose modestly improved its performance across all IoU thresholds (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>). Based on this, we attribute the remaining gains in performance by Omnipose to its unique network outputs (boundary, distance, and flow) and to our improvements to the Cellpose training framework. The latter includes numerous custom loss functions, the use of an alternative optimizer (RAdam), and image augmentations (<xref rid="Sec10" ref-type="sec">Methods</xref>).</p>
      <p id="Par20">Our analyses illuminated critical flaws in previous DNN-based approaches for the segmentation of elongated cells, effectively preventing these algorithms from generalizable application to bacteria (Fig. <xref rid="Fig1" ref-type="fig">1</xref>). To determine whether Omnipose overcomes this limitation, we evaluated its performance as a function of cell area. Cell area serves as a convenient proxy for cell length in our dataset, which is composed of both branched and unbranched elongated cells. While the Cellpose cell error rate remains above 15% across all cells, the Omnipose error rate does not exceed 5% before the 90th percentile of cell area is reached (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>). Thus, Omnipose performance is independent of cell size and shape, including those cells with complex, extended morphologies (Fig. <xref rid="Fig3" ref-type="fig">3c,d</xref> and Extended Data Fig. <xref rid="Fig13" ref-type="fig">7a</xref>).</p>
    </sec>
    <sec id="Sec7">
      <title>Omnipose is a multifunctional segmentation tool</title>
      <p id="Par21">We have shown that the features of Omnipose improve bacterial phase-contrast segmentation performance beyond that of Cellpose. Like other DNN-based algorithms, Omnipose can also segment images acquired using different modalities and composed of alternative subjects when trained on a representative dataset. To evaluate Omnipose on images acquired using a modality distinct from phase contrast, we curated a dataset containing cytosol and membrane fluorescence in 33,200 bacterial cells (bact_fluor). In brief, this was achieved by applying the labels of cells with fluorescence signal in our phase-contrast ground-truth images to their corresponding fluorescence channels (<xref rid="Sec10" ref-type="sec">Methods</xref>). As expected, we found that the enhanced performance of Omnipose (bact_fluor_omni) relative to Cellpose (bact_fluor_cp) on morphologically diverse cells translates to fluorescence images (Fig. <xref rid="Fig4" ref-type="fig">4a–d</xref> and Extended Data Fig. <xref rid="Fig13" ref-type="fig">7b</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>Omnipose models trained and evaluated on assorted imaging modalities and subjects.</title><p>Relevant Omnipose model names are provided (also Supplementary Table <xref rid="MOESM4" ref-type="media">2</xref>). <bold>a</bold>, Performance of bacterial fluorescence Omnipose (bact_fluor_omni) and Cellpose (bact_fluor_cp) models. Test set consists of <italic>n</italic> = 14,587 cells. <bold>b</bold>, Fluorescence micrograph (top) and corresponding bact_fluor_omni segmentation results of <italic>B.</italic> <italic>thailandensis</italic> expressing cytoplasmic green fluorescent protein (GFP) (segmentation, middle) or outer-membrane localized mCherry (segmentation, bottom). <bold>c</bold>,<bold>d</bold>, <italic>Francisella</italic> <italic>tularensis</italic> subsp <italic>novicida</italic> segmentation using bact_phase_omni (<bold>c</bold>) or bact_fluor_omni (<bold>d</bold>) Omnipose models. Two notable bact_phase_omni segmentation errors are highlighted in red. Scale bars, 1 μm. <bold>e</bold>, Performance of Omnipose models trained on cyto2 (cyto2_omni, <italic>n</italic> = 10,232) and <italic>C.</italic> <italic>elegans</italic> (worm_omni) datasets versus corresponding Cellpose models. Results for Omnipose and Cellpose trained on either <italic>C.</italic> <italic>elegans</italic> alone (gray, red) or Omnipose on <italic>C.</italic> <italic>elegans</italic> and bacterial data (yellow) are shown. Cyto2 test dataset, <italic>n</italic> = 10,232 cells. <italic>C.</italic> <italic>elegans</italic> test dataset, <italic>n</italic> = 1,264 worms. <bold>f</bold>, IoU distribution for the masks predicted by each method on our <italic>C.</italic> <italic>elegans</italic> test dataset (<italic>n</italic> = 1,264). Boxes centered on medians from Q1 to Q3, whiskers from Q1 − 1.5 IQR to Q3 + 1.5 IQR. <bold>g</bold>, Example segmentation of <italic>C.</italic> <italic>elegans</italic> in the BBBC010 dataset used in <bold>e</bold>,<bold>f</bold>. IoU score shown. Scale bar, unavailable. <bold>h</bold>, Example segmentation of high-resolution <italic>C.</italic> <italic>elegans</italic> (minimum projection brightfield). Scale bar, 50 μm. <bold>i</bold>, Example multi-channel Omnipose segmentation in the cyto2 dataset. Scale bar, 3 μm.</p></caption><graphic xlink:href="41592_2022_1639_Fig4_HTML" id="d32e1142"/></fig></p>
      <p id="Par22">We next sought to investigate the potential utility of Omnipose in the segmentation of non-bacterial subjects. The nematode <italic>Caenorhabditis</italic> <italic>elegans</italic> is a widely studied model organism with an overall morphology similar to elongated bacteria<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>. At just 1 mm in length, <italic>C.</italic> <italic>elegans</italic> phenotypes are often analyzed by timelapse microscopy; therefore, there is a need for segmentation methods that enable accurate tracking<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>. We obtained, annotated, and trained Omnipose on two publicly available, low-resolution microscopy datasets composed of <italic>C.</italic> <italic>elegans</italic> images: timelapse frames from the Open Worm Movement database<sup><xref ref-type="bibr" rid="CR39">39</xref></sup> and frames containing fields of assorted live or dead <italic>C.</italic> <italic>elegans</italic> from the BBBC010 dataset<sup><xref ref-type="bibr" rid="CR40">40</xref></sup>. Many images in this combined worm dataset contain debris and are of heterogenous quality, yet 83% of masks predicted by Omnipose match or exceed the 0.8 IoU threshold (Fig. <xref rid="Fig4" ref-type="fig">4f</xref>). At the low resolution of our combined <italic>C.</italic> <italic>elegans</italic> dataset, the worms approximate bacteria in shape and diameter (in pixels). Indeed, we found that a generalist model trained on both our extensive bact_phase dataset and our worm dataset (worm_bact_omni) exhibited equivalent or higher performance relative to the specialist worm model (worm_omni). We also trained an Omnipose model using a custom collection of high-resolution <italic>C.</italic> <italic>elegans</italic> images (worm_high_res) and found that the algorithm can successfully segment these images despite the complex internal structure (Fig. <xref rid="Fig4" ref-type="fig">4h</xref>). Cyto2 is a large collection of images and corresponding ground-truth annotations submitted by Cellpose users that expands upon the original cyto dataset developed to evaluate Cellpose<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR30">30</xref></sup>. This dataset includes many non-cell images (for example, rocks, onions) as well as multi-channel fluorescence images (for example, cytosol and nuclear stains in mammalian cells) (Fig. <xref rid="Fig4" ref-type="fig">4i</xref> and Extended Data Fig. <xref rid="Fig14" ref-type="fig">8</xref>). We found that Omnipose offers a modest improvement in performance relative to Cellpose on the cyto2 dataset (Fig. <xref rid="Fig4" ref-type="fig">4e</xref>) and this was achieved without compromising the segmentation rate (~1 image per second).</p>
      <p id="Par23">Two-dimensional (2D) imaging allows the characterization of cells within constrained environments, yet many phenomena of interest can only be studied in natural, three-dimensional (3D) contexts. We modified each explicitly 2D component of the network architecture, outputs and mask reconstruction elements of Omnipose to enable direct segmentation of 3D (or higher order) data. This contrasts with the solution adopted for Cellpose (Cellpose3D), which approximates a 3D field by combining the 2D flow components predicted on orthogonal 2D volume slices<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>. We compared Cellpose3D to Omnipose on a publicly available <italic>Arabidopsis</italic> <italic>thaliana</italic> lateral root primordia dataset acquired using confocal microscopy<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. An Omnipose model was trained on six volumes representing 931 cells in total (plant_omni), whereas Cellpose was trained on 3,070 slices of these volumes (plant_cp) (<xref rid="Sec10" ref-type="sec">Methods</xref>). Consistent with our results in 2D, Omnipose provided more accurate segmentation results than Cellpose, particularly among elongated cells in the dataset (Fig. <xref rid="Fig5" ref-type="fig">5</xref>). We note that the absolute scores for both algorithms are low and attribute this in part to inaccurate ground-truth masks (Extended Data Fig. <xref rid="Fig15" ref-type="fig">9a,b</xref>). Indeed, in certain instances, Omnipose-predicted masks seem to be more accurate than the ground truth (Fig. <xref rid="Fig5" ref-type="fig">5b</xref> and Extended Data Fig. <xref rid="Fig15" ref-type="fig">9b</xref>). Notably, the 3D field reconstruction made in Cellpose from 2D plant_cp slice predictions recapitulates much of the direct 3D field predictions of plant_omni (Extended Data Fig. <xref rid="Fig15" ref-type="fig">9c</xref>). We reason that this is because the local 2D cell slice ‘centers’ of the Cellpose flow field can be coincident with the global 3D cell ‘skeletons’ of the Omnipose flow field. Taken together with our results on diverse cell types and fluorescence images, we conclude that Omnipose maintains the multi-modal segmentation capabilities of Cellpose while adding the ability to perform accurate segmentation of a substantially broader range of cellular morphologies present within 2D and 3D data.<fig id="Fig5"><label>Fig. 5</label><caption><title>Omnipose can be applied to 3D datasets.</title><p><bold>a</bold>, Volume slice in the <italic>A.</italic> <italic>thaliana</italic> 3D training set. Black arrows denote over-segmentation in the ground truth labels. Red corresponds to the cell in <bold>b</bold>–<bold>d</bold>. <bold>b</bold>, Selected cell in context of ground-truth data. <bold>c</bold>, Ground-truth distance field for selected cell in <bold>b</bold>. <bold>d</bold>, Steps of the suppressed Euler integration for selected cell in <bold>b</bold>. Boundary pixels shown, colored by overall displacement (dark to light red). <bold>e</bold>, Performance of Omnipose (OP, plant_omni) and Cellpose (CP, plant_cp) on the full test dataset (<italic>n</italic> = 604) and on a subset without excluded regions (<xref rid="Sec10" ref-type="sec">Methods</xref>) depicted in <bold>f</bold>–<bold>h</bold> (<italic>n</italic> = 73). <bold>f–h</bold>, Ground-truth masks (<bold>f</bold>) and segmentation results of <italic>A.</italic> <italic>thaliana</italic> using Omnipose (<bold>g</bold>) and Cellpose (<bold>h</bold>). Scale bars, 20 μM.</p></caption><graphic xlink:href="41592_2022_1639_Fig5_HTML" id="d32e1335"/></fig></p>
    </sec>
    <sec id="Sec8">
      <title>Omnipose permits sensitive detection of cell intoxication</title>
      <p id="Par24">Our laboratory recently described an interbacterial type VI secretion system-delivered toxin produced by <italic>Serratia</italic> <italic>proteamaculans</italic>, Tre1 (ref. <sup><xref ref-type="bibr" rid="CR41">41</xref></sup>). We showed that this toxin acts by ADP-ribosylating the essential cell division factor FtsZ; however, we were unable to robustly evaluate the consequences of Tre1 intoxication on target cell morphology due to segmentation challenges. Here we asked whether Omnipose is able to detect cellular intoxication by Tre1. To this end, we incubated <italic>S.</italic> <italic>proteamaculans</italic> wild-type or a control strain expressing inactive Tre1 (<italic>tre1</italic><sup><italic>E415Q</italic></sup><italic>)</italic> with target <italic>E.</italic> <italic>coli</italic> cells and imaged these mixtures after 20 h. Owing to the improved segmentation accuracy of the Omnipose bact_phase model, we were able to include dense fields of view and incorporate ~300,000 cells in our analysis.</p>
      <p id="Par25">Among the cells identified by Omnipose, we found that a small proportion were elongated and much larger than typical bacteria (Fig. <xref rid="Fig6" ref-type="fig">6a,b</xref> and Extended Data Fig. <xref rid="Fig16" ref-type="fig">10a</xref>). These cells were only detected in mixtures containing active Tre1 and the apparent failure of the cells to septate is consistent with the known FtsZ-inhibitory activity of the toxin. The <italic>S.</italic> <italic>proteamaculans</italic> strain background we employed in this work expresses the green fluorescent protein. Corresponding fluorescence images allowed us to unambiguously assign the enlarged cell population to <italic>E.</italic> <italic>coli</italic> (Fig. <xref rid="Fig6" ref-type="fig">6c</xref>). Next, we subjected the same images to cell segmentation with StarDist, Cellpose and MiSiC, the three top-performing algorithms in our initial survey. Each of these algorithms fail to identify this population of cells to high precision (Fig. <xref rid="Fig6" ref-type="fig">6d,e</xref>). Close inspection reveals three distinct modes of failure (Fig. <xref rid="Fig6" ref-type="fig">6e</xref> and Extended Data Fig. <xref rid="Fig16" ref-type="fig">10a,b</xref>). In the case of StarDist, elongated (non-star-convex) cells are split into multiple star-convex subsets that do not span the entire cell. Cellpose detects entire elongated cells but fragments them into a multitude of smaller masks. Conversely, MiSiC detects all cells but fails to properly separate them, thereby exaggerating the area measurement in many cases, including <italic>E</italic>. <italic>coli</italic> cells in the control experiment. These data illustrate how the enhanced cell segmentation performance of Omnipose can facilitate unique insights into microbiological systems.<fig id="Fig6"><label>Fig. 6</label><caption><title>Omnipose facilitates the accurate identification of intoxicated <italic>E.</italic> <italic>coli</italic> cells.</title><p><bold>a</bold>, Fluorescence/area population profile according to Omnipose segmentation (bact_phase_omni) in control and experimental conditions. <italic>K</italic>-means clustering on GFP fluorescence distinguishes <italic>S.</italic> <italic>proteamaculans tre1/tre1</italic><sup><italic>E415Q</italic></sup> (light/dark green markers) from <italic>E.</italic> <italic>coli</italic> (gray markers). <italic>n</italic> = 209,000 cells in experimental population (<italic>S.</italic> <italic>proteamaculans tre1</italic>) and <italic>n</italic> = 85,260 cells in control group (<italic>S.</italic> <italic>proteamaculans tre1</italic><sup><italic>E415Q</italic></sup><italic>)</italic>. <bold>b</bold>, Example of extreme filamentation of <italic>E.</italic> <italic>coli</italic> in response to active Tre1. <bold>c</bold>, Omnipose accurately segments all cells in the image. Largest cell indicated with black arrow. <bold>d</bold>, MiSiC predicts large cell masks over both species. Cellpose (bact_phase_cp) and StarDist fail to predict any cells above 15 μm<sup>2</sup>. <bold>e</bold>, Example segmentation results highlighting typical errors encountered with MiSiC (under-segmentation), Cellpose (over-segmentation) and StarDist (incomplete masks). Mask mergers cause some <italic>E.</italic> <italic>coli</italic> to be misclassified as <italic>S.</italic> <italic>proteamaculans</italic>. Scale bar, 1 μm.</p></caption><graphic xlink:href="41592_2022_1639_Fig6_HTML" id="d32e1508"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec9" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par26">We have designed Omnipose for use by typical research laboratories and we have made its source code, training data, and models publicly available (Supplementary Table <xref rid="MOESM4" ref-type="media">2</xref>). Thorough documentation demonstrating how to install and use Omnipose is also available (visit <ext-link ext-link-type="uri" xlink:href="https://omnipose.readthedocs.io">https://omnipose.readthedocs.io</ext-link> and see ‘Code availability’ section). For images similar to those represented in these models, we expect that researchers will not need to train models with new ground-truth data; however, users wishing to segment images not represented in our models (for example, cell type, imaging modality) should curate custom training data to obtain accurate results with Omnipose. Instructions for training and evaluating Omnipose are also provided within our documentation.</p>
    <p id="Par27">Confronted with the importance of segmentation accuracy to the success of work within our own laboratory, we were motivated to characterize the performance of several existing cell segmentation algorithms. Recent developments in deep learning have greatly improved these algorithms; however, important challenges remain<sup><xref ref-type="bibr" rid="CR1">1</xref>,<xref ref-type="bibr" rid="CR30">30</xref></sup>. Although isolated cells without cell-to-cell contact can be segmented with high precision by any of the packages that we tested, segmentation becomes vastly more challenging when cells form microcolonies, adopt irregular morphologies, or when images are composed of cells with assorted shapes and sizes. Such difficulties are compounded in timelapse studies, where the significance of segmentation errors often grows exponentially with time. Experimental design can help mitigate certain segmentation challenges; however, the recent emphasis on non-model organisms and microbial communities renders this an increasingly undesirable solution<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>.</p>
    <p id="Par28">This work provides a comprehensive side-by-side quantitative comparison of cell segmentation algorithm performance. As expected, machine-learning-based approaches outperform traditional image processing, yet insights into general image segmentation strategies can be gained from each of the methods we examined. Two of the six algorithms we tested utilize traditional image thresholding and watershed segmentation: Morphometrics and SuperSegger<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR23">23</xref></sup>. Each program tends to under-segment adjacent cells and over-segment large cells, behaviors previously linked to thresholding and watershed processes, respectively<sup><xref ref-type="bibr" rid="CR1">1</xref>,<xref ref-type="bibr" rid="CR43">43</xref></sup>. Given that SuperSegger was developed at least in part to mitigate these issues, we postulate that traditional image-segmentation approaches are ultimately limited to specialized imaging scenarios. Although we classify MiSiC as a DNN-based approach, this algorithm also relies on thresholding and watershed segmentation to generate cell masks from its network output<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. The network output of MiSiC is more uniform than unfiltered phase-contrast images, yet this pre-processing does not fully abrogate the typical errors of thresholding and watershed segmentation.</p>
    <p id="Par29">A successful DNN-based algorithm is composed of a robust, consistent neural network output and an appropriate mask reconstruction process designed for this output. In the case of Mask R-CNN, bounding boxes for each cell are predicted along with a probability field that localizes a cell within its bounding box<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. Masks are generated by iterating over each box and thresholding the probability field. Despite the widespread adoption of Mask R-CNN, we found this algorithm did not perform well in our study. Our results suggest that this is due to dense cell fields with overlapping bounding boxes, a feature known to corrupt the training process and produce poor network outputs for Mask R-CNN<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. By contrast, the StarDist network makes robust predictions of its distance field, but it fails to assemble accurate cell masks because the cells in our dataset are not well approximated by star-convex polygons<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>. Likewise, the cell body and cell boundary outputs of MiSiC seem robust, but its watershed-based mask reconstruction is sensitive to defects in these outputs and can yield unreliable cell masks. The errors we encountered with Cellpose can be attributed to both neural network output and mask reconstruction. In Omnipose, we specifically addressed these two issues via the distance field and suppressed Euler integration, respectively, yielding a remarkably precise and generalizable image segmentation tool. Omnipose effectively leverages the strongest features of several of the DNN approaches we tested, namely the distance field of StarDist, the boundary field of MiSiC, and the mask reconstruction framework of Cellpose.</p>
    <p id="Par30">In this study, we emphasized morphological diversity, but we further accounted for differences in optical features between bacterial strains, slide preparation techniques, and microscope configurations. For example, bacterial strains exhibit a wide range of intrinsic contrast and internal structure, often exacerbated by antibiotic treatment or dense cell packing. Internal structure can cause over-segmentation, so we included many cells with this characteristic in our dataset. Additionally, the images in our ground-truth dataset originate from four different researchers using distinct microscopes, objectives, sensors, illumination sources, and acquisition settings. We further introduced extensive image augmentations that simulate variations in image intensity, noise, gamma, clipping, magnification, and bit depth (<xref rid="Sec10" ref-type="sec">Methods</xref>).</p>
    <p id="Par31">Although Omnipose is designed to be trainable for any cell morphology or imaging modality, like all segmentation algorithms operating in 2D, Omnipose is limited in its ability to handle object overlap and self-contact (boundary intersection). Additionally, there are theoretical and practical limitations to the size of cells that it can accurately segment. Cells must be at least three pixels wide for the flow field to be well-defined at boundary pixels. A reasonable lower bound for cell size is therefore a 9-px square in 2D and a 27-voxel cube in 3D. Furthermore, we reason that the finite kernel size in our convolutional layers and number of downsampling steps in our U-net must present an upper limit to cell size that we have yet to quantify. In practice, we found that images with a mean cell diameter of 60 px or smaller are handled well during training by Omnipose. For images with cells larger than this, users may specify an average diameter to which the cells in all images are automatically rescaled before training. This solution may not be suitable for some applications and therefore more work is needed to modify our U-net implementation to achieve native segmentation at arbitrarily high resolutions. When segmenting new images, users are able to manually define a rescaling factor to bring cells into an acceptable size range or estimate this rescaling factor using a SizeModel, a feature inherited from Cellpose and improved by our mean diameter metric (<xref rid="Sec10" ref-type="sec">Methods</xref>). Omnipose in 3D avoids issues of cell overlap, but the problem of self-intersecting boundaries remains. It is conceivable that the use of a flow field could be leveraged to define such boundaries, making Omnipose a promising candidate for overcoming this widespread limitation of segmentation algorithms. A dearth of 3D ground-truth data hampers the training and evaluation of all DNN-based algorithms. Manual annotation of 3D volumes is considerably more difficult than 2D images, leading to errors that corrupt training.</p>
    <p id="Par32">We anticipate that the high performance of Omnipose across varied cellular morphologies and modalities may unlock information from microscopy images that was previously inaccessible. All bacteria appear dark under phase contrast, so images deriving from natural microbial communities could be segmented by phase contrast and accurately characterized with regard to internal structure, autofluorescence, and morphology at the single-cell level. These data could be used to estimate diversity, a methodology that would complement existing sequencing-based metrics<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>. It is worth noting that phenotypic diversity often exceeds genetic diversity<sup><xref ref-type="bibr" rid="CR47">47</xref></sup>; therefore, even in a relatively homogeneous collection of organisms, precise segmentation could allow classes representing distinct states to be identified. A microscopy-based approach also offers the opportunity to characterize spatial relationships between cells, information that is exceptionally difficult to recover in most biomolecular assays.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Phase-contrast and fluorescence microscopy</title>
      <p id="Par33">In-house imaging was performed on a Nikon Eclipse Ti-E wide-field epi-fluorescence microscope, equipped with a sCMOS camera (Hamamatsu) and X-cite LED for fluorescence imaging. We imaged through ×60 and ×100 1.4 NA oil-immersion PH3 objectives. The microscope was controlled by NIS-Elements v.3.30.02. Cell samples were spotted on a 3% (w/v) agarose pad placed on a microscope slide. The microscope chamber was heated to 30 °C or 37 °C when needed for timelapse experiments.</p>
      <p id="Par34">Several images in our dataset were taken by two other laboratories using three distinct microscope/camera configurations. The Brun laboratory provided images of <italic>C.</italic> <italic>crescentus</italic> acquired on a Nikon Ti-E microscope equipped with a Photometrics Prime 95B sCMOS camera. Images were captured through a ×60 Plan Apo λ ×100 1.45 NA oil Ph3 DM objective. The Wiggins laboratory provided <italic>E.</italic> <italic>coli</italic> and <italic>A.</italic> <italic>baylyi</italic> timelapses from both a Nikon Ti-E microscope using NIS-Elements v.4.10.01 as well as a custom-built tabletop microscope using Micro-Manager v.1.4, both of which are described in previous studies<sup><xref ref-type="bibr" rid="CR48">48</xref>,<xref ref-type="bibr" rid="CR49">49</xref></sup>.</p>
    </sec>
    <sec id="Sec12">
      <title><italic>C.</italic><italic>elegans</italic> data preparation</title>
      <p id="Par35">We obtained a 1,000-frame timelapse of <italic>C.</italic> <italic>elegans</italic> from the Wormpose<sup><xref ref-type="bibr" rid="CR38">38</xref></sup> GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/iteal/wormpose_data">https://github.com/iteal/wormpose_data</ext-link>) adapted from the Open Worm Movement database<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>, which is inaccessible at the time of writing. We also utilized BBBC010 (ref. <sup><xref ref-type="bibr" rid="CR40">40</xref></sup>) (<ext-link ext-link-type="uri" xlink:href="https://bbbc.broadinstitute.org/c-elegans-livedead-assay-0">https://bbbc.broadinstitute.org/c-elegans-livedead-assay-0</ext-link>), a set of 100 images containing live and dead <italic>C.</italic> <italic>elegans</italic>. These images were manually cropped to select regions of each image without <italic>C.</italic> <italic>elegans</italic> overlaps. For both of these datasets, images were initially segmented with Omnipose to select foreground, automatically cropped to select individual <italic>C.</italic> <italic>elegans</italic> or clusters of <italic>C. elegans</italic> and then packed into ensemble images for efficient annotation, training and testing following the same procedures described below for our bacterial datasets.</p>
      <p id="Par36">For high-resolution <italic>C.</italic> <italic>elegans</italic> images, one gravid non-starved nematode growth medium plate of wild-type <italic>C.</italic> <italic>elegans</italic> (QZ0) was resuspended in 1 ml M9 defined buffer. The worm suspension was pelted by quick spinning and resuspended in 100 μl fresh M9 buffer. Then, 20 μl of the pellet was placed on agar pads (0.3% agar, SeaKem) and mounted on regular microscope slides (25 mm × 75 mm). The 20-μl drops were left to dry by approximately 50% of their volume at room temperature, allowing worms to arrange longitudinally, before a glass coverslip (22 mm × 22 mm) was placed on top. The sample was imaged using a Andor Dragonfly Spinning disk confocal mounted on a Nikon TiE2 microscope at ×15 magnification (×10/0.25 NA Nikon objective and ×1.5 camera magnification) in the brightfield channel. For each field of view, a Z stack of seven frames centered on the worm focal plane and spanning over approximately 85 μm (12.14-μm spacing between frames) was acquired.</p>
    </sec>
    <sec id="Sec13">
      <title><italic>A.</italic><italic>thaliana</italic> data preparation</title>
      <p id="Par37">This specific subset of the PlantSeg dataset<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> was chosen because it represented diverse morphologies and because other subsets of their published ground truth were not in accessible formats. Three folders were provided: test, train and val. We first combined the test and val volumes into a single test dataset. The PlantSeg algorithm seems to exclude regions labeled by 0 as during training, whereas 1 denotes background. This is incompatible with Omnipose and most other algorithm training pipelines. We therefore discarded images with the label 0 from our training set and subtracted 1 so that the remaining images conformed to the convention of 0 for background. The final training set consists of Video 1 timepoints 3, 9, 35, 40, 45 and 49. The published test dataset consists of Video 2 frames 10 and 20 and Video 1 frames 4, 6, 30 and 45. Frame 45 is mistakenly duplicated from the training set, so we discarded it from our test metrics. Only frame 30 of Video 1 contained no exclusion zones (label 0), so we present both the performance on this subset alone as well as the performance on the full test dataset (Video 1 frames 4, 6 and 30 and Video 2 frames 10 and 20) (Fig. <xref rid="Fig6" ref-type="fig">6e</xref>). For the purposes of computing performance, exclusion zones are treated as background and therefore all predicted labels in these regions significantly decrease the JI for all algorithms at all IoU thresholds regardless of segmentation accuracy elsewhere. The images and ground truth were downsampled by a factor of three to allow full cell cross-sections to be loaded onto the GPU during training (see below section, Omnipose in higher dimensions), with linear interpolation on images and nearest-neighbor interpolation on the ground-truth masks.</p>
    </sec>
    <sec id="Sec14">
      <title>Bacterial sample preparation</title>
      <p id="Par38">To image antibiotic-induced phenotypes, cells were grown without antibiotics overnight in LB, back-diluted and spotted on agarose pads with 50 µg ml<sup>−1</sup> A22 or 10 µg ml<sup>−1</sup> cephalexin. Timelapses were captured of <italic>E.</italic> <italic>coli</italic> DH5α and <italic>S.</italic> <italic>flexneri</italic> M90T growing on these pads. <italic>E.</italic> <italic>coli</italic> CS703-1 was back-diluted into LB containing 1 µg ml<sup>−1</sup> aztreonam and spotted onto a pad without antibiotics<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>. Cells constitutively expressed GFP to visualize cell boundaries.</p>
      <p id="Par39"><italic>H.</italic> <italic>pylori</italic> LSH100 grown with and without aztreonam was provided by the Salama laboratory<sup><xref ref-type="bibr" rid="CR51">51</xref>,<xref ref-type="bibr" rid="CR52">52</xref></sup>. Samples were fixed and stained with Alexa Fluor 488 to visualize the cell membrane. Images were taken on LB pads. The typical technique of allowing the spot to dry on the pad caused cells to curl up on themselves, therefore our images were taken by placing the coverslip on the pad immediately after spotting and applying pressure to force out excess medium.</p>
      <p id="Par40"><italic>C.</italic> <italic>crescentus</italic> was cultivated and imaged by the Brun laboratory<sup><xref ref-type="bibr" rid="CR53">53</xref>,<xref ref-type="bibr" rid="CR54">54</xref></sup>. Cells were grown in PYE, washed twice in water before 1:20 dilution in HIGG medium and grown at 26 °C for 72 h. Cells were spotted on a 1% agarose PYE pads before imaging.</p>
      <p id="Par41"><italic>S.</italic> <italic>pristinaespiralis</italic> NRRL 2958 was grown using the following medium recipe: yeast extract 4 g l<sup>−1</sup>, malt extract 10 g l<sup>−1</sup>, dextrose 4 g l<sup>−1</sup> and agar 20 g l<sup>−1</sup>. This medium was used to first culture the bacteria in liquid overnight and then on a pad under the microscope. This strain forms aggregates in liquid medium, so these aggregates were allowed to grow for several hours on a slide in a heated microscope chamber until we could see individual filaments extending from the aggregates. Fields of view were selected and cropped to exclude cell overlaps. Autofluorescence was captured to aid in manual segmentation.</p>
      <p id="Par42">Mixtures of <italic>S.</italic> <italic>proteamaculans</italic> attTn7::Km-gfp <italic>tre1</italic> or <italic>tre1</italic><sup><italic>E415Q</italic></sup> and <italic>E.</italic> <italic>coli</italic> were spotted on a PBS pad to prevent further growth. Phase-contrast images of the cells were acquired before and after a 20-h competition on a high-salt LB plate. Fluorescence images in the GFP channel were also acquired to distinguish <italic>S.</italic> <italic>proteamaculans</italic> from unlabeled <italic>E.</italic> <italic>coli</italic>.</p>
      <p id="Par43">All other individual strains in Supplementary Table <xref rid="MOESM3" ref-type="media">1</xref> were grown overnight, diluted 1:100 into fresh LB medium and grown for 1–3 h before imaging. Mixtures were made by combining back-diluted cells roughly 1:1 by OD<sub>600</sub>.</p>
    </sec>
    <sec id="Sec15">
      <title>Manual image annotation</title>
      <p id="Par44">Manual annotation began with loading images into MATLAB, normalizing the channels, registering the fluorescence channel(s) to brightfield (when applicable) and producing boundary-enhanced versions of brightfield and fluorescence. Where possible, fluorescence data were primarily used to define cell boundaries (not available in the <italic>C.</italic> <italic>elegans</italic> dataset acquired online). In addition to a blank channel to store manual labels, all processed phase and fluorescence images were then automatically loaded as layers into an Adobe Photoshop document. We used four to six unique colors and the Pencil tool (for pixel-level accuracy and no blending) to manually define object masks. Due to the four-color theorem<sup><xref ref-type="bibr" rid="CR55">55</xref></sup>, this limited palette was sufficient to clearly distinguish individual object instances from each other during annotation. This color simplification enabled faster manual annotation by reducing the need to select new colors. It also eliminated the confusion caused by the use of similar but distinct colors in adjacent regions, which we suspect is the cause for the misplaced mask pixels that we observed in other datasets (for example, cyto2). Consistency was ensured by enlisting a single individual to perform all manual annotations.</p>
      <p id="Par45">The cell label layer was then exported as a PNG from Photoshop, read back into MATLAB and converted from the repeating <italic>n</italic>-color labels to a standard 16-bit integer label matrix, where each object is assigned a unique integer from 1 to the number of cells (background is 0). Because integer labels cannot be interpolated, we then performed a non-rigid image registration of the brightfield channel to the binary label mask to achieve better brightfield correlation to ground-truth masks. All images in our ground-truth dataset have been registered in this manner.</p>
    </sec>
    <sec id="Sec16">
      <title>Choosing segmentation algorithms</title>
      <p id="Par46">Three main factors contributed to the choice of algorithms highlighted in this study: (1) specificity to bacterial phase-contrast images; (2) success and community adoption, especially for bioimage segmentation; and (3) feasibility of installation, training and use. It is noteworthy that criterion (1) only influenced the choice of non-DNN algorithms because they are generally modality-, scale- and subject-specific in their design. DNN approaches can generally be trained on arbitrary sets of images. With the exception of MiSiC, none of the DNN-based approaches we chose were specifically designed for (or substantively trained on) bacterial phase-contrast images.</p>
      <p id="Par47">SuperSegger, Morphometrics and MiSiC were selected because they specifically targeted the problem of bacterial phase-contrast segmentation<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR23">23</xref></sup>. Other bacteria-focused packages do exist, such as BactMAP, BacStalk, Cellprofiler, CellShape, ColiCoords, Cytokit, MicroAnalyzer, MicrobeJ, Oufti and Schnitzcells; however, these incorporate limited new segmentation solutions and instead aim to provide tools for single-cell analysis such as lineage tracing and protein tracking<sup><xref ref-type="bibr" rid="CR8">8</xref>,<xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR18">18</xref>–<xref ref-type="bibr" rid="CR20">20</xref>,<xref ref-type="bibr" rid="CR25">25</xref>,<xref ref-type="bibr" rid="CR56">56</xref>–<xref ref-type="bibr" rid="CR58">58</xref></sup>. Furthermore, the segmentation that these programs perform depends broadly on thresholding and watershed techniques; therefore, Morphometrics is a reasonable proxy for their segmentation capabilities. We were unable to locate code or training data for BASCA at the time of writing<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>. Ilastik is a popular interactive machine-learning tool for bioimage segmentation, but training it using a manual interface was not feasible on a large and diverse dataset such as our own<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>.</p>
      <p id="Par48">Among DNN approaches, Mask R-CNN was selected because it is a popular architecture for handling typical image segmentation tasks. It was also used in the segmentation and tracking package Usiigaci<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. U-Net architectures have been implemented in a number of algorithms, including DeLTA, PlantSeg, MiSiC, StarDist and Cellpose<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR17">17</xref>,<xref ref-type="bibr" rid="CR22">22</xref>,<xref ref-type="bibr" rid="CR26">26</xref></sup>. DeLTA was not included in this study because it operates similarly to MiSiC and was designed specifically for mother machine microfluidics analysis. DeLTA 2.0 was recently released to additionally segment confluent cell growth on agarose pads, but it remains quite similar to MiSiC in implementation<sup><xref ref-type="bibr" rid="CR59">59</xref></sup>. PlantSeg could, in principle, be trained on bacterial micrographs, but we determined that its edge-focused design meant to segment bright plant cell wall features would not offer any advancements over the remaining U-net methods that we tested.</p>
    </sec>
    <sec id="Sec17">
      <title>Training and tuning segmentation algorithms</title>
      <p id="Par49">All segmentation algorithms have tunable parameters to optimize performance on a given dataset. These include pre-processing such as image rescaling (often to put cells into a particular pixel diameter range), contrast adjustment, smoothing and noise addition. Morphometrics and SuperSegger were manually tuned to give the best results on our benchmarking dataset. The neural network component of SuperSegger was not retrained on our data, as this is a heavily manual process involving toggling watershed lines on numerous segmentation examples. DNN-based algorithms are automatically trained using our dataset and the scripts we used to do so are available in our GitHub repository. We adapted our data for MiSiC by transforming our instance labels into interior and boundary masks. Training documentation for MiSiC is not published. Training and evaluation parameters for MiSiC were tuned according to correspondence with the MiSiC authors. Cellpose and StarDist were trained with the default parameters provided in their documentation. StarDist has an additional tool to optimize image pre-processing parameters on our dataset, which we utilized.</p>
    </sec>
    <sec id="Sec18">
      <title>Evaluating segmentation algorithms</title>
      <p id="Par50">All algorithms were evaluated on our benchmarking dataset with manually or automatically optimized parameters. We provide both the raw segmentation results for all test images by each tested algorithm as well as the models and model-training scripts required to reproduce our results. Before evaluating IoU or JI, small masks at image boundaries were removed for both the ground-truth and predicted masks. IoU and JI are calculated on a per-image basis and, where shown, are averaged with equal weighting over the image set or field of view.</p>
      <p id="Par51">Our new metric, the number of segmentation errors per cell, was calculated by first measuring the fraction of each predicted cell that overlaps with each ground-truth cell. A predicted cell is assigned to a ground-truth cell if the overlap ratio is ≥0.75, meaning that at least three quarters of the predicted cell lies within the ground-truth cell. If several predicted cells are matched to a ground-truth cell, the number of surplus matches is taken to be the number of segmentation errors. If no cells are matched to a ground-truth cell, then the error is taken to be 1.</p>
    </sec>
    <sec id="Sec19">
      <title>Statistics and reproducibility</title>
      <p id="Par52">The neural network models in this study are trained using seeded pseudo-random shuffling of labeled data into batches. This means that all models converge to precisely the same weights and biases given the same dataset and hyperparameters. Neural network evaluation is also entirely deterministic. For these reasons, no segmentation results in this study are associated with repetition or statistics.</p>
      <p id="Par53">All segmentation results and figures in this study can be programmatically reproduced using the figure scripts in our GitHub repository (see ‘Code availability’ section). Figure micrographs are exported programmatically by manually selected labels within our scripts and automatic cropping around selected labels. Although some pre-filtering by rough statistical metrics may have been used to help select example cells, specific examples were ultimately selected for illustrative purposes and are intended only to be qualitatively representative of aspects such as cell phenotype or algorithm failure modes.</p>
    </sec>
    <sec id="Sec20">
      <title>Leveraging Omnipose to accelerate manual annotation</title>
      <p id="Par54">Omnipose was periodically trained on our growing dataset to make initial cell labels. These were converted into an <italic>n</italic>-color representation and loaded into Photoshop for manual correction. A subset of our cytosol GFP channels were sufficient for training Omnipose to segment based on fluorescence and the resulting trained model enabled higher-quality initial cell labels for GFP-expressing samples than could be achieved from intermediate phase-contrast models (for example, <italic>V.</italic> <italic>cholerae</italic>).</p>
    </sec>
    <sec id="Sec21">
      <title>Defining the Omnipose prediction classes</title>
      <p id="Par55">Omnipose predicts four classes: two flow components, the distance field and a boundary field. Our distance field is found by solving the eikonal equation<disp-formula id="Equa"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left| {\vec \nabla \phi \left( {\vec x} \right)} \right| = \frac{1}{{f\left( {\vec x} \right)}}$$\end{document}</tex-math><mml:math id="M6"><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mo>∇</mml:mo></mml:mrow><mml:mo>→</mml:mo></mml:mover><mml:mi>ϕ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="41592_2022_1639_Article_Equa.gif" position="anchor"/></alternatives></disp-formula>where <italic>f</italic> represents the speed at a point <inline-formula id="IEq3"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\vec x$$\end{document}</tex-math><mml:math id="M8"><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41592_2022_1639_Article_IEq3.gif"/></alternatives></inline-formula>. The Godunov upwind discretization of the eikonal equation is<disp-formula id="Equb"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{l}\left( {\frac{{\max \left( {\phi _{i,j} - \min \left( {\phi _{i - 1,j},\phi _{i + 1,j}} \right),0} \right)}}{{{{\Delta }}x}}} \right)^2 + \left( {\frac{{\max \left( {\phi _{i,j} - \min \left( {\phi _{1,j - 1},\phi _{i,j + 1}} \right),0} \right)}}{{{{\Delta }}y}}} \right)^2 = \frac{1}{{f_{i,j}}}\end{array}$$\end{document}</tex-math><mml:math id="M10"><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>max</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>min</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>max</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>min</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41592_2022_1639_Article_Equb.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par56">Our solution to this equation is based on the Improved FIM Algorithm 1.1 (ref. <sup><xref ref-type="bibr" rid="CR34">34</xref></sup>), as follows. Our key contribution to this algorithm is the addition of ordinal sampling to boost both convergence and smoothness of the final distance field.</p>
      <sec id="Sec22">
        <title>2D update function for <italic>ϕ</italic><sub><italic>i,j</italic></sub> on a Cartesian grid</title>
        <p id="Par57">
          <list list-type="order">
            <list-item>
              <p id="Par58">Find neighboring points for cardinal axes (Δ<italic>x</italic> = Δ<italic>y</italic> = <italic>δ</italic>):<disp-formula id="Equc"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi ^{{{{\mathrm{minx}}}}} = \min \left( {\phi _{i - 1,j},\phi _{i + 1,j}} \right),\quad \phi ^{{{{\mathrm{miny}}}}} = \min \left( {\phi _{i,j - 1},\phi _{i,j + 1}} \right)$$\end{document}</tex-math><mml:math id="M12"><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">minx</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>min</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mspace width="1.0em"/><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">miny</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>min</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41592_2022_1639_Article_Equc.gif" position="anchor"/></alternatives></disp-formula></p>
            </list-item>
            <list-item>
              <p id="Par59">Find neighboring points for ordinal axes (<inline-formula id="IEq4"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat x \cdot \hat a = \hat y \cdot \hat b = \frac{{\sqrt 2 }}{2},\frac{{{{\Delta }}a}}{{{{\Delta }}x}} = \frac{{{{\Delta }}b}}{{{{\Delta }}y}} = \sqrt 2 \delta$$\end{document}</tex-math><mml:math id="M14"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover><mml:mo>⋅</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover><mml:mo>⋅</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msqrt><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msqrt></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msqrt><mml:mi>δ</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="41592_2022_1639_Article_IEq4.gif"/></alternatives></inline-formula>):<disp-formula id="Equd"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi ^{{{{\mathrm{mina}}}}} = \min \left( {\phi _{i - 1,j - 1},\phi _{i + 1,j + 1}} \right),\quad \phi ^{{{{\mathrm{minb}}}}} = \min \left( {\phi _{i + 1,j - 1},\phi _{i - 1,j + 1}} \right)$$\end{document}</tex-math><mml:math id="M16"><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">mina</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>min</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mspace width="1.0em"/><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">minb</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>min</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41592_2022_1639_Article_Equd.gif" position="anchor"/></alternatives></disp-formula></p>
            </list-item>
            <list-item>
              <p id="Par60">Calculate update along cardinal axes:<disp-formula id="Eque"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\mathbf{if}}}\,\left| {\phi ^{{{{\mathrm{minx}}}}} - \phi ^{{{{\mathrm{miny}}}}}} \right| &gt; \frac{{\sqrt 2 \delta }}{{f_{i,j}}}:$$\end{document}</tex-math><mml:math id="M18"><mml:mrow><mml:mi mathvariant="bold">if</mml:mi><mml:mspace width="0.25em"/><mml:mfenced close="∣" open="∣"><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">minx</mml:mi></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">miny</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>&gt;</mml:mo><mml:mfrac><mml:mrow><mml:msqrt><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msqrt><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>:</mml:mo></mml:mrow></mml:math><graphic xlink:href="41592_2022_1639_Article_Eque.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equf"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$U^{xy} = \min \left( {\phi ^{{{{\mathrm{minx}}}}},\phi ^{{{{\mathrm{miny}}}}}} \right) + \frac{\delta }{{f_{i,j}}}$$\end{document}</tex-math><mml:math id="M20"><mml:mrow><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>min</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">minx</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">miny</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="41592_2022_1639_Article_Equf.gif" position="anchor"/></alternatives></disp-formula></p>
              <p id="Par61"><bold>else</bold>:<disp-formula id="Equg"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$U^{xy} = \frac{1}{2}\left( {\phi ^{{{{\mathrm{minx}}}}} + \phi ^{{{{\mathrm{miny}}}}} + \sqrt {2\left( {\frac{\delta }{{f_{i,j}}}} \right)^2 - \left( {\phi ^{{{{\mathrm{minx}}}}} - \phi ^{{{{\mathrm{miny}}}}}} \right)^2} } \right)$$\end{document}</tex-math><mml:math id="M22"><mml:mrow><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">minx</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">miny</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msqrt><mml:mrow><mml:mn>2</mml:mn><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">minx</mml:mi></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">miny</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41592_2022_1639_Article_Equg.gif" position="anchor"/></alternatives></disp-formula></p>
            </list-item>
            <list-item>
              <p id="Par62">Calculate updat e along ordinal axes:<disp-formula id="Equh"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\mathbf{if}}}\,\left| {\phi ^{{{{\mathrm{mina}}}}} - \phi ^{{{{\mathrm{minb}}}}}} \right| &gt; \frac{{2\delta }}{{f_{i,j}}}:$$\end{document}</tex-math><mml:math id="M24"><mml:mrow><mml:mi mathvariant="bold">if</mml:mi><mml:mspace width="0.25em"/><mml:mfenced close="∣" open="∣"><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">mina</mml:mi></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">minb</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>&gt;</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>:</mml:mo></mml:mrow></mml:math><graphic xlink:href="41592_2022_1639_Article_Equh.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equi"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$U^{ab} = \min \left( {\phi ^{{{{\mathrm{mina}}}}},\phi ^{{{{\mathrm{minb}}}}}} \right) + \frac{{\sqrt 2 \delta }}{{f_{i,j}}}$$\end{document}</tex-math><mml:math id="M26"><mml:mrow><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>min</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">mina</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">minb</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msqrt><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msqrt><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="41592_2022_1639_Article_Equi.gif" position="anchor"/></alternatives></disp-formula></p>
              <p id="Par63"><bold>else</bold>:<disp-formula id="Equj"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$U^{ab} = \frac{1}{2}\left( {\phi ^{{{{\mathrm{mina}}}}} + \phi ^{{{{\mathrm{minb}}}}} + \sqrt {4\left( {\frac{\delta }{{f_{i,j}}}} \right)^2 - \left( {\phi ^{{{{\mathrm{mina}}}}} - \phi ^{{{{\mathrm{minb}}}}}} \right)^2} } \right)$$\end{document}</tex-math><mml:math id="M28"><mml:mrow><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">mina</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">minb</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msqrt><mml:mrow><mml:mn>4</mml:mn><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">mina</mml:mi></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">minb</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41592_2022_1639_Article_Equj.gif" position="anchor"/></alternatives></disp-formula></p>
            </list-item>
            <list-item>
              <p id="Par64">Update with geometric mean:</p>
            </list-item>
          </list>
          <disp-formula id="Equk">
            <alternatives>
              <tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi _{i,j} = \sqrt {U^{xy}U^{ab}}$$\end{document}</tex-math>
              <mml:math id="M30">
                <mml:mrow>
                  <mml:msub>
                    <mml:mrow>
                      <mml:mi>ϕ</mml:mi>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mo>=</mml:mo>
                  <mml:msqrt>
                    <mml:mrow>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mi>U</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>x</mml:mi>
                          <mml:mi>y</mml:mi>
                        </mml:mrow>
                      </mml:msup>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mi>U</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>a</mml:mi>
                          <mml:mi>b</mml:mi>
                        </mml:mrow>
                      </mml:msup>
                    </mml:mrow>
                  </mml:msqrt>
                </mml:mrow>
              </mml:math>
              <graphic xlink:href="41592_2022_1639_Article_Equk.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p id="Par65">This update rule is repeated until convergence (Extended Data Fig. <xref rid="Fig11" ref-type="fig">5</xref>). We take <italic>δ</italic> = <italic>f</italic><sub><italic>i,j</italic></sub> to obtain the signed distance field used in Omnipose. The flow field components are defined by the normalized gradient of this distance field <italic>ϕ</italic>. The boundary field is defined by points satisfying 0 &lt; <italic>ϕ</italic> &lt; 1. For network prediction, the boundary map is converted to the logits (inverse sigmoid) representation, such that points in the range [0,1] are mapped to [−5,5]. For consistent value ranges across prediction classes, the flow components are multiplied by 5 and all background values of the distance field (<italic>ϕ</italic>=0) are set to −5.</p>
      </sec>
    </sec>
    <sec id="Sec23">
      <title>Omnipose network architecture</title>
      <p id="Par66">The DNN used for Omnipose is a minor modification of that used in Cellpose: a U-net architecture with two residual blocks per scale, each with two convolutional layers<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>. Omnipose introduces a dropout layer before the densely connected layer<sup><xref ref-type="bibr" rid="CR60">60</xref></sup>, which we incorporated into the shared Cellpose and Omnipose architecture moving forward (see resnet_torch.py); however, Cellpose models utilized in this study are trained without dropout.</p>
    </sec>
    <sec id="Sec24">
      <title>Omnipose in higher dimensions</title>
      <p id="Par67">The network architecture described above is implemented in PyTorch and is generalized to 3D by taking a ‘dimension’ argument that chooses, for example, Conv3D instead of Conv2D. This is a key component of Omnipose that is not fully generalized to arbitrary dimension (ND) segmentation because it depends on these explicit 2D and 3D PyTorch classes. Custom implementations of these classes (for example, ConvND) will be needed for 4D segmentation, which we envision being highly useful for processing 3D timelapses. The Omnipose methods for generating boundary, distance, and flow are completely dimension-agnostic, as is the mask reconstruction algorithm; however, a dependency, the edt package, needs to be generalized to ND. It is used both to compute boundaries (exact distance of 1) and to estimate the number of iterations required for our smooth distance function to converge (linear scaling of the maximum of the exact distance). Workarounds for each of these uses can be found if edt is not updated. Boundaries can be found by appropriately generalized binary hit–miss operators or ND mask-erosion difference maps. The smooth distance could simply be set to terminate after it has reached convergence.</p>
      <p id="Par68">The large memory footprint of 3D volumes also motivated us to use DataParallel (models.py) to allow for multi-GPU training. We note that DistributedDataParallel is a more efficient (but far less convenient) implementation that might be needed to train on batches of larger volumes. The default 3D volumes after argumentations are currently 84 × 84 × 84 and take up about 12 GB of VRAM each. The size of volumes should be at least the diameter of an average cell (ideally much larger), so this can be tuned according to the dataset. We implemented a –tyx flag for specifying the size of volumes crops to be used in training (for example, ‘50,50,50’).</p>
    </sec>
    <sec id="Sec25">
      <title>Rescaling flow field by divergence</title>
      <p id="Par69">During training, the ground-truth data are augmented by a random affine transformation. The original implementation, and the one which yields the best results, linearly interpolates the transformed field. This reduces the magnitude of the otherwise normalized field in regions of divergence (at boundaries and skeletons). A renormalized field (obtained either from the transformed field or as the normalized gradient of the transformed heat distribution) often has artifacts at cell boundaries and skeletons, so the interpolated field effectively reduces the influence of these artifacts on training. We reason that this feature explains the superior performance of interpolated field training over renormalized fields, despite the latter being the nominal goal of the algorithm.</p>
      <p id="Par70">Pixels at cell boundaries, however, consequently do not move far (&lt;1 px) under Euler integration due to the low magnitude of the predicted field at cell boundaries. Our solution in Omnipose is to rescale the flow field by the magnitude of the divergence. The divergence is most positive at the cell boundaries (where pixels need to move) and most negative at cell skeletons (where pixels need to stop). We therefore rescale the divergence from 0 to 1 and multiply the normalized flow field by this new magnitude map. This forces boundary pixels of neighboring cells to quickly diverge and allow for accurate pixel clustering to obtain the final segmentation.</p>
    </sec>
    <sec id="Sec26">
      <title>New diameter metric</title>
      <p id="Par71">The size models of Cellpose are trained to estimate the average cell ‘diameter’, taken to be the diameter of the circle of equivalent area:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d=2{\mathrm{R}}=2 \sqrt{\frac{A}{\pi}}$$\end{document}</tex-math><mml:math id="M32"><mml:mrow><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi mathvariant="normal">R</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:msqrt></mml:mrow></mml:math><graphic xlink:href="41592_2022_1639_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par72">This metric as a basis for rescaling is problematic when cells are growing in length but not width (Extended Data Fig. <xref rid="Fig7" ref-type="fig">1</xref>). Log-phase bacterial cell area grows exponentially with time and so too does the scale factor, eventually resulting in a rescaled image that is too small for Cellpose to segment.</p>
      <p id="Par73">The average of the distance field, however, does not change for filamentous bacteria, as the width and therefore the distance to the closest boundary, remains constant. To define a formula consistent with the previous definition in the case of a circular cell, we consider mean of the distance field over the cell:<disp-formula id="Equl"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar \phi = \frac{1}{{\pi R^2}}{\int}_0^{2\pi } {{\int}_0^R {\left( {R - r} \right)rdrd\theta = \frac{1}{{\pi R^2}}\left( {\frac{\pi }{3}R^3} \right) = \frac{R}{3}} }$$\end{document}</tex-math><mml:math id="M34"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>π</mml:mi><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:msubsup><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow></mml:msubsup><mml:msubsup><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msubsup><mml:mfenced close=")" open="("><mml:mrow><mml:mi>R</mml:mi><mml:mo>−</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:mfenced><mml:mi>r</mml:mi><mml:mi>d</mml:mi><mml:mi>r</mml:mi><mml:mi>d</mml:mi><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>π</mml:mi><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="41592_2022_1639_Article_Equl.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par74">This allows us to define a new ‘effective diameter’ as<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d = 2R = 6\bar \phi$$\end{document}</tex-math><mml:math id="M36"><mml:mrow><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>R</mml:mi><mml:mo>=</mml:mo><mml:mn>6</mml:mn><mml:mover accent="true"><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:math><graphic xlink:href="41592_2022_1639_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par75">Aside from agreeing with the previous scaling method (<xref rid="Equ1" ref-type="">*</xref>) for round morphologies, this definition exhibits excellent consistency across time (Extended Data Fig. <xref rid="Fig7" ref-type="fig">1</xref>). This consistency is also critical for training on datasets with wide distributions in cell areas that require rescaling, such as the Cellpose datasets. A SizeModel can be trained using the Omnipose metric for automatic size estimation and image rescaling. Finally, the raw distance field output of Omnipose can directly be used directly in (<xref rid="Equ2" ref-type="">**</xref>) to estimate average cell diameter, which is used in our code to automatically toggle on features that improve mask reconstruction performance for small cells.</p>
    </sec>
    <sec id="Sec27">
      <title>Gamma augmentation</title>
      <p id="Par76">To make the network robust against changes in exposure/contrast, the training images are now raised to a random power (γ) between 0.5 and 1.25, simulating the varying levels of contrast that are observed experimentally with different light sources, objectives, and exposure times.</p>
    </sec>
    <sec id="Sec28">
      <title>Alleviating class imbalance</title>
      <p id="Par77">Class imbalance remains a challenge in many machine-learning applications<sup><xref ref-type="bibr" rid="CR61">61</xref></sup>. In our dataset, foreground pixels (cells) take up anywhere from 1% to 75% of a given training image, with the rest being background pixels that the network must only learn to ignore (assign a constant output of −5 for distance and boundary logits). We implemented several changes to the loss function to emphasize foreground objects, including weighting by the distance field and averaging some loss terms only over foreground pixels. Our training augmentation function also attempts many random crop and resizing passes until a field of view with foreground pixels is selected (this may take several attempts for sparse images but adds very little time to training).</p>
    </sec>
    <sec id="Sec29">
      <title>Image normalization</title>
      <p id="Par78">To manage different image exposure levels, Cellpose automatically rescales images such that pixels in the first percentile of intensity are set to 0 and those in the 99th percentile are sent to 1. This percentile rescaling is preferred over blind min–max rescaling because bubbles or glass can cause small bright spots in the image; however, we found that images containing single cells (low intensity) in a wide field of media (high intensity) would become badly clipped due to the foreground-background class imbalance. To solve this, we changed the percentile range to be from 0.01 to 99.99.</p>
    </sec>
    <sec id="Sec30">
      <title>Reporting summary</title>
      <p id="Par79">Further information on research design is available in the <xref rid="MOESM2" ref-type="media">Nature Research Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec id="Sec31" sec-type="materials|methods">
    <title>Online content</title>
    <p id="Par80">Any methods, additional references, Nature Research reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests; and statements of data and code availability are available at 10.1038/s41592-022-01639-4.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <p>
      <supplementary-material content-type="local-data" id="MOESM1">
        <media xlink:href="41592_2022_1639_MOESM1_ESM.pdf">
          <label>Supplementary Information</label>
          <caption>
            <p>Supplementary Table references.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM2">
        <media xlink:href="41592_2022_1639_MOESM2_ESM.pdf">
          <caption>
            <p>Reporting Summary</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM3">
        <media xlink:href="41592_2022_1639_MOESM3_ESM.xlsx">
          <label>Supplementary Table 1</label>
          <caption>
            <p>Bacterial strains and ground truth annotation.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM4">
        <media xlink:href="41592_2022_1639_MOESM4_ESM.xlsx">
          <label>Supplementary Table 2</label>
          <caption>
            <p>Trained Omnipose and Cellpose models.</p>
          </caption>
        </media>
      </supplementary-material>
    </p>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec32">
        <title>Extended data</title>
        <p id="Par85">
          <fig id="Fig7">
            <label>Extended Data Fig. 1</label>
            <caption>
              <title>Size and morphology metrics are indistinguishable between cell populations included in training and test datasets.</title>
              <p>(<bold>a</bold>) Mean cell diameter, (<bold>b</bold>) cell area, and (<bold>c</bold>) cell perimeter calculated for our bacterial phase-contrast ground-truth dataset. P-values are displayed for the two-sided KS test. n = 47,000 (27,500 for training, 19,500 for testing). <bold>(d</bold>). Comparison of diameter metrics of a timelapse of elongated cell growth. The Cellpose diameter metric is the diameter of a circle with equivalent area. Omnipose diameter metric is proportional to the mean of the distance transform (see <xref rid="Sec10" ref-type="sec">Methods</xref>). (<bold>e</bold>) Bacteria displayed are a single population analyzed of <italic>A. baylyi</italic> transformed with a Δ<italic>ftsN::kan</italic> PCR fragment. Yellow lines indicate cell label boundaries. Scale bar is 1 μm.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2022_1639_Fig7_ESM" id="d32e3565"/>
          </fig>
        </p>
        <p id="Par86">
          <fig id="Fig8">
            <label>Extended Data Fig. 2</label>
            <caption>
              <title>The relationship between IoU and segmentation accuracy.</title>
              <p>(<bold>a</bold>) Illustration of 0–12 pixel displacement of cell mask (red outline) and corresponding IoU values using a synthetic cell of typical bacterial size and resolution (solid black). (<bold>b</bold>) Quantification of the impact of mask shift on IoU values, determined using the synthetic cell shown in (a).</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2022_1639_Fig8_ESM" id="d32e3585"/>
          </fig>
        </p>
        <p id="Par87">
          <fig id="Fig9">
            <label>Extended Data Fig. 3</label>
            <caption>
              <title>Details of the Cellpose algorithm.</title>
              <p>(<bold>a</bold>) Stages of the Cellpose training pipeline. Ground truth masks (<italic>i</italic>) are converted to cell probability (<italic>ii</italic>) by binary thresholding and a heat distribution (<italic>iii</italic>) by simulated diffusion from the median pixel coordinate. The flow field (<italic>iv</italic>) is defined by the normalized gradient of (<italic>iii</italic>). Color-magnitude representations of this vector field follow the flow legend diagram. The phase, cell probability and flow fields are used to train the network. (<bold>b</bold>) Stages of the cellpose prediction pipeline. Phase images are processed by the trained cellpose network into the intermediate flow field and cell probability outputs (<italic>i-ii</italic>). A binary threshold is applied to the probability to identify cell pixels (<italic>iii</italic>). Pixels are Euler-integrated under the flow field until they converge at common points. Boundary pixel trajectories are depicted in <italic>iv</italic>. Each pixel is assigned a unique label corresponding to the center to which it converged (<italic>v</italic>). This segmentation result is commonly depicted in an outline view (<italic>vi</italic>). Bacteria shown are <italic>Escherichia coli</italic>. Scale bar is 1 μm.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2022_1639_Fig9_ESM" id="d32e3640"/>
          </fig>
        </p>
        <p id="Par88">
          <fig id="Fig10">
            <label>Extended Data Fig. 4</label>
            <caption>
              <title>Cellpose over-segments extended, anisotropic cells.</title>
              <p>(<bold>a</bold>) Single-cell analysis of Cellpose segmentation error as a function of cell area. Color represents density on a log scale. Gray box represents the top quartile of cell areas (n = 19,570). (<bold>b</bold>) Example images representative of 1,128 cells with segmentation errors in the top area quartile (n = 4,887). Corresponding boundary pixel trajectories are shown in black and final pixel locations in red. Predicted mask overlays are shown with mean matched IoU values. Cellpose model bact_phase_cp used in (a,b). (<bold>c</bold>) Analysis of stochastic center-to-boundary distances in our ground-truth dataset. Distance from the center (median pixel coordinate) to each boundary pixel is normalized to a maximum of 1. Position along the boundary is normalized from −1 to 1 and centered on the point closest to the median pixel. Center-to-boundary for the cell in (d) is highlighted in black. (<bold>d</bold>) Representative cell with median coordinate outside the cell body (black X). Cellpose projects this point to the global minima of this function (green dot), but several other local minima exist (blue dots). (<bold>e</bold>) The heat distribution resulting from a projected cell center (black arrow). The normalized gradient corresponds to the divergence shown. (d-e) represent n = 617 cells with projected centers in the training dataset. Bacteria displayed are (a,e) <italic>Helicobacter pylori</italic>, (b) <italic>Escherichia coli</italic> CS703-1, both treated with aztreonam and (d) <italic>Caulobacter crescentus</italic> grown in HIGG media. Scale bars, 1 μm.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2022_1639_Fig10_ESM" id="d32e3679"/>
          </fig>
        </p>
        <p id="Par89">
          <fig id="Fig11">
            <label>Extended Data Fig. 5</label>
            <caption>
              <title>Median coordinates used to generate Cellpose ground-truth flow fields are asymmetrically localized for some bacterial cell morphologies.</title>
              <p>(<bold>a</bold>) Rod-shaped <italic>E. coli</italic> with symmetric median coordinate. Symmetry of the center is reflected in A by equal high and low points corresponding to the extremal points along the long and short axes of the cell. (<bold>b</bold>) Curved <italic>B. subtilis</italic> with median coordinate asymmetrically close to the cell boundary. This asymmetry is reflected in A by a secondary minimum above the global minimum corresponding to the diametrically opposing point along the short axis of the cell. (<bold>c</bold>) Center-to-boundary distance highlighted for cells A (black) and B (yellow) with non-projected median coordinates. Dashed lines indicate the larger of the two minima along the medial axis. (<bold>d</bold>) Flow fields generated by Cellpose for cells A and B. Scale bar is 1 μm. Images scaled equivalently.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2022_1639_Fig11_ESM" id="d32e3712"/>
          </fig>
        </p>
        <p id="Par90">
          <fig id="Fig12">
            <label>Extended Data Fig. 6</label>
            <caption>
              <title>The Eikonal equation provides a fast and accurate flow field calculation for diverse cell morphologies and sizes.</title>
              <p>(<bold>a</bold>) Partial differential equation solutions (top rows) and corresponding flow fields (bottoms rows) calculated for two examples cells (i, ii) using a relaxation algorithm for the heat, Poisson and Eikonal equations. Cell (i) is drawn from our dataset (mean diameter 37px) and cell (ii) is a synthetic rod-shaped cell (mean diameter 192px). (<bold>b</bold>) Convergence measured by the average difference at each iteration (maximum normalized to 1) for cells (<italic>i,ii</italic>).</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2022_1639_Fig12_ESM" id="d32e3735"/>
          </fig>
        </p>
        <p id="Par91">
          <fig id="Fig13">
            <label>Extended Data Fig. 7</label>
            <caption>
              <title>Omnipose output on diverse morphologies.</title>
              <p><bold>(a)</bold> Omnipose flow and segmentation corresponding to the cells of Extended Data Fig. <xref rid="Fig10" ref-type="fig">4b</xref>. <bold>(b)</bold> (<italic>i-iii</italic>) Boundary, distance and flow output using bact_fluor_omni model on <italic>S. flexneri</italic> treated with cephalexin. (<italic>iv</italic>) Overlaid mask outlines. The cell in bold yellow is missing the self-contact boundary in red.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2022_1639_Fig13_ESM" id="d32e3766"/>
          </fig>
        </p>
        <p id="Par92">
          <fig id="Fig14">
            <label>Extended Data Fig. 8</label>
            <caption>
              <title>Omnipose accurately segments diverse images from the cyto2 test dataset.</title>
              <p><bold>(a-i)</bold> Selection of images from the cyto2 test dataset with superimposed outlines representing Omnipose cyto2_omni model segmentation. Subjects are not defined, as the cyto2 dataset lacks metadata and is comprised of anonymized contributions.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2022_1639_Fig14_ESM" id="d32e3782"/>
          </fig>
        </p>
        <p id="Par93">
          <fig id="Fig15">
            <label>Extended Data Fig. 9</label>
            <caption>
              <title>Errors in the three-dimensional <italic>A. thaliana</italic> ground-truth dataset impact training and performance metrics of Ominpose and Cellpose.</title>
              <p><bold>(a)</bold> Slices of ground truth training set volumes. Images show errant pixels and apparent flaws in ground truth masks. Black arrow indicates one instance of a joined mask. <bold>(b)</bold> Ground truth masks for the test volume in Fig. <xref rid="Fig5" ref-type="fig">5e-h</xref>. Two cells are joined under one label (black arrow). <bold>(c)</bold> Slices of the predicted Omnipose and Cellpose flow fields through the middle of the volume in (b).</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2022_1639_Fig15_ESM" id="d32e3810"/>
          </fig>
        </p>
        <p id="Par94">
          <fig id="Fig16">
            <label>Extended Data Fig. 10</label>
            <caption>
              <title>Example segmentation errors by StarDist, Cellpose and MiSiC of <italic>E. coli</italic> cells undergoing intoxication by <italic>S. proteamaculans</italic> Tre1.</title>
              <p><bold>(a)</bold> Examples of segmentation failures demonstrated by each method. Cells 2 and 3 indicated with orange and gray arrows are the reference cells highlighted in Fig. <xref rid="Fig6" ref-type="fig">6a, d</xref>. Scale bars are 1 μm. (<bold>b</bold>) Control populations segmented by StarDist, Cellpose and MiSiC. Notably, Cellpose and MiSiC exhibit an enrichment of larger cells even in the control, a consequence of both under-segmented (merged) cells as well as fragments of over-segmented large cells.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2022_1639_Fig16_ESM" id="d32e3838"/>
          </fig>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <sec id="FPar1">
      <title>Extended data</title>
      <p id="Par81">is available for this paper at 10.1038/s41592-022-01639-4.</p>
    </sec>
    <sec id="FPar2" sec-type="supplementary-material">
      <title>Supplementary information</title>
      <p id="Par82">The online version contains supplementary material available at 10.1038/s41592-022-01639-4.</p>
    </sec>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>The authors thank members of the Mougous and Wiggins laboratories for helpful suggestions, S. Ting for assistance with experiments, J. Carey and M. Parsek for assistance with confocal microscopy, S. Sichel and N. Salama laboratory for growing, fixing and staining <italic>H.</italic> <italic>pylori</italic> samples for in-house imaging and D. Kysela, M. Jacq and Y. Brun for providing <italic>C.</italic> <italic>crescentus</italic> images. All images of <italic>C. crescentus</italic> used in the figures were acquired in the laboratory of Y. Brun by M. Jacq. This work was supported by the National Institutes of Health (AI080609 to J.D.M., GM128191 to P.A.W., R01-GM128191 to T.W.L. and T32-GM008268 to K.J.C.). L.R. and N.S. were funded by the European Research Council under the European Union’s Horizon 2020 Research and Innovation Programme (grant agreement no. 852201), the Spanish Ministry of Economy, Industry and Competitiveness to the EMBL partnership, the Centro de Excelencia Severo Ochoa (CEX2020-001049-S, MCIN/AEI /10.13039/501100011033), the CERCA Programme/Generalitat de Catalunya and the Spanish Ministry of Economy, Industry and Competitiveness Excelencia award PID2020-115189GB-I00. C.S. was funded by the Howard Hughes Medical Institute at the Janelia Research Campus. J.D.M. is an HHMI Investigator.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>K.J.C., P.A.W. and J.D.M. conceived the study. K.J.C. performed experiments, collected and labeled images, and wrote the code. T.W.L. collected <italic>E.</italic> <italic>coli</italic> phase-contrast and fluorescence images and assisted in testing and debugging software. L.R. collected and labeled high-resolution <italic>C.</italic> <italic>elegans</italic> images under advisement of N.S. K.J.C., S.B.P., P.A.W. and J.D.M. wrote the manuscript. C.S. edited the manuscript and assisted in code development.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar3">
      <title>Peer review information</title>
      <p id="Par83"><italic>Nature Methods</italic> thanks Zach Hensel and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. Primary Handling editor: Rita Strack, in collaboration with the <italic>Nature Methods</italic> team.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>Bacterial phase-contrast and fluorescence image sets generated in this study, unpublished bacterial phase-contrast images provided by Y. Brun, and unpublished minimum projection brightfield images of <italic>C.</italic> <italic>elegans</italic> provided by L. Rappez are available in our OSF repository <ext-link ext-link-type="uri" xlink:href="https://osf.io/xmury/">https://osf.io/xmury/</ext-link> under the CC BY-NC 3.0 license. Additional <italic>C.</italic> <italic>elegans</italic> images were sourced from a selection of the Open Worm Movement dataset by the Wormpose project at <ext-link ext-link-type="uri" xlink:href="https://github.com/iteal/wormpose_data">https://github.com/iteal/wormpose_data</ext-link> and from the Broad Bioimage Benchmark Collection set BBBC010 at <ext-link ext-link-type="uri" xlink:href="https://bbbc.broadinstitute.org/c-elegans-livedead-assay-0">https://bbbc.broadinstitute.org/c-elegans-livedead-assay-0</ext-link>, both of which are available under the CC-4.0 license. Files deriving from our processing and labeling of these data are available in our OSF repository <ext-link ext-link-type="uri" xlink:href="https://osf.io/xmury/">https://osf.io/xmury/</ext-link> under the CC BY-NC 3.0 license. <italic>A.</italic> <italic>thaliana</italic> image volumes were sourced from the PlantSeg OSF database at <ext-link ext-link-type="uri" xlink:href="https://osf.io/uzq3w/">https://osf.io/uzq3w/</ext-link>. The cyto2 dataset was sourced from <ext-link ext-link-type="uri" xlink:href="http://www.cellpose.org/dataset">http://www.cellpose.org/dataset</ext-link>.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>For installation instructions and source code, see our documentation at <ext-link ext-link-type="uri" xlink:href="https://omnipose.readthedocs.io">https://omnipose.readthedocs.io</ext-link> and our GitHub repository at <ext-link ext-link-type="uri" xlink:href="https://github.com/kevinjohncutler/omnipose">https://github.com/kevinjohncutler/omnipose</ext-link>. Standalone apps for Windows, macOS and Linux are available in our OSF repository <ext-link ext-link-type="uri" xlink:href="https://osf.io/xmury/">https://osf.io/xmury/</ext-link>. Data processing and analysis scripts for this study were written in MATLAB 2021a and Python ≥3.8.5. All scripts are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/kevinjohncutler/omnipose/tree/main/figures">https://github.com/kevinjohncutler/omnipose/tree/main/figures</ext-link>. Figure panels were assembled in Adobe Illustrator v.26.2.1. The algorithms used in comparison to Omnipose are sourced as follows: SuperSegger v.1.1, <ext-link ext-link-type="uri" xlink:href="https://github.com/wiggins-lab/SuperSegger">https://github.com/wiggins-lab/SuperSegger</ext-link>; Cellpose v.1.0.2, <ext-link ext-link-type="uri" xlink:href="https://github.com/MouseLand/cellpose">https://github.com/MouseLand/cellpose</ext-link>; StarDist v.0.7.2, <ext-link ext-link-type="uri" xlink:href="https://github.com/stardist/stardist">https://github.com/stardist/stardist</ext-link>; MiSiC v.1.0.3, <ext-link ext-link-type="uri" xlink:href="https://github.com/pswapnesh/misic">https://github.com/pswapnesh/misic</ext-link>; Mask R-CNN from Torchvision v.0.12.0, <ext-link ext-link-type="uri" xlink:href="https://github.com/pytorch/vision">https://github.com/pytorch/vision</ext-link>; and Morphometrics v.1.102, <ext-link ext-link-type="uri" xlink:href="https://simtk.org/projects/morphometrics">https://simtk.org/projects/morphometrics</ext-link>.</p>
  </notes>
  <notes id="FPar4" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par84">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <mixed-citation publication-type="other">Jeckel, H. &amp; Drescher, K. Advances and opportunities in image analysis of bacterial cells and communities. <italic>FEMS Microbiol Rev</italic>10.1093/femsre/fuaa062 (2021).</mixed-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <mixed-citation publication-type="other">Bali, A. &amp; Singh, S. N. A review on the strategies and techniques of image segmentation. In <italic>2015 Fifth International Conference on Advanced Computing &amp; Communication Technologies</italic> 113–120 (2015).</mixed-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lucas</surname>
            <given-names>AM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Open-source deep-learning software for bioimage segmentation</article-title>
        <source>Mol. Biol. Cell</source>
        <year>2021</year>
        <volume>32</volume>
        <fpage>823</fpage>
        <lpage>829</lpage>
        <?supplied-pmid 33872058?>
        <pub-id pub-id-type="pmid">33872058</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kysela</surname>
            <given-names>DT</given-names>
          </name>
          <name>
            <surname>Randich</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Caccamo</surname>
            <given-names>PD</given-names>
          </name>
          <name>
            <surname>Brun</surname>
            <given-names>YV</given-names>
          </name>
        </person-group>
        <article-title>Diversity takes shape: understanding the mechanistic and adaptive basis of bacterial morphology</article-title>
        <source>PLoS Biol.</source>
        <year>2016</year>
        <volume>14</volume>
        <fpage>e1002565</fpage>
        <?supplied-pmid 27695035?>
        <pub-id pub-id-type="pmid">27695035</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jones</surname>
            <given-names>SE</given-names>
          </name>
          <name>
            <surname>Elliot</surname>
            <given-names>MA</given-names>
          </name>
        </person-group>
        <article-title>‘Exploring’ the regulation of <italic>Streptomyces</italic> growth and development</article-title>
        <source>Curr. Opin. Microbiol.</source>
        <year>2018</year>
        <volume>42</volume>
        <fpage>25</fpage>
        <lpage>30</lpage>
        <?supplied-pmid 29024914?>
        <pub-id pub-id-type="pmid">29024914</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Caccamo</surname>
            <given-names>PD</given-names>
          </name>
          <name>
            <surname>Brun</surname>
            <given-names>YV</given-names>
          </name>
        </person-group>
        <article-title>The molecular basis of noncanonical bacterial morphology</article-title>
        <source>Trends Microbiol.</source>
        <year>2018</year>
        <volume>26</volume>
        <fpage>191</fpage>
        <lpage>208</lpage>
        <?supplied-pmid 29056293?>
        <pub-id pub-id-type="pmid">29056293</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Behera</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Emerging technologies for antibiotic susceptibility testing</article-title>
        <source>Biosens. Bioelectron.</source>
        <year>2019</year>
        <volume>142</volume>
        <fpage>111552</fpage>
        <?supplied-pmid 31421358?>
        <pub-id pub-id-type="pmid">31421358</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Paintdakhi</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Oufti: an integrated software package for high-accuracy, high-throughput quantitative microscopy analysis</article-title>
        <source>Mol. Microbiol.</source>
        <year>2016</year>
        <volume>99</volume>
        <fpage>767</fpage>
        <lpage>777</lpage>
        <?supplied-pmid 26538279?>
        <pub-id pub-id-type="pmid">26538279</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ducret</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Quardokus</surname>
            <given-names>EM</given-names>
          </name>
          <name>
            <surname>Brun</surname>
            <given-names>YV</given-names>
          </name>
        </person-group>
        <article-title>MicrobeJ, a tool for high throughput bacterial cell detection and quantitative analysis</article-title>
        <source>Nat. Microbiol</source>
        <year>2016</year>
        <volume>1</volume>
        <fpage>16077</fpage>
        <?supplied-pmid 27572972?>
        <pub-id pub-id-type="pmid">27572972</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tropini</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Earle</surname>
            <given-names>KA</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>KC</given-names>
          </name>
          <name>
            <surname>Sonnenburg</surname>
            <given-names>JL</given-names>
          </name>
        </person-group>
        <article-title>The gut microbiome: connecting spatial organization to function</article-title>
        <source>Cell Host Microbe</source>
        <year>2017</year>
        <volume>21</volume>
        <fpage>433</fpage>
        <lpage>442</lpage>
        <?supplied-pmid 28407481?>
        <pub-id pub-id-type="pmid">28407481</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Balomenos</surname>
            <given-names>AD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Image analysis driven single-cell analytics for systems microbiology</article-title>
        <source>BMC Syst. Biol.</source>
        <year>2017</year>
        <volume>11</volume>
        <fpage>43</fpage>
        <?supplied-pmid 28376782?>
        <pub-id pub-id-type="pmid">28376782</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stringer</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Michaelos</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pachitariu</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Cellpose: a generalist algorithm for cellular segmentation</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>100</fpage>
        <lpage>106</lpage>
        <?supplied-pmid 33318659?>
        <pub-id pub-id-type="pmid">33318659</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stylianidou</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Brennan</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Nissen</surname>
            <given-names>SB</given-names>
          </name>
          <name>
            <surname>Kuwada</surname>
            <given-names>NJ</given-names>
          </name>
          <name>
            <surname>Wiggins</surname>
            <given-names>PA</given-names>
          </name>
        </person-group>
        <article-title>SuperSegger: robust image segmentation, analysis and lineage tracking of bacterial cells</article-title>
        <source>Mol. Microbiol.</source>
        <year>2016</year>
        <volume>102</volume>
        <fpage>690</fpage>
        <lpage>700</lpage>
        <?supplied-pmid 27569113?>
        <pub-id pub-id-type="pmid">27569113</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van Raaphorst</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Kjos</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Veening</surname>
            <given-names>JW</given-names>
          </name>
        </person-group>
        <article-title>BactMAP: An R package for integrating, analyzing and visualizing bacterial microscopy data</article-title>
        <source>Mol. Microbiol.</source>
        <year>2020</year>
        <volume>113</volume>
        <fpage>297</fpage>
        <lpage>308</lpage>
        <?supplied-pmid 31693257?>
        <pub-id pub-id-type="pmid">31693257</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <mixed-citation publication-type="other">Panigrahi, S. et al. Misic, a general deep learning-based method for the high-throughput cell segmentation of complex bacterial communities. <italic>eLife</italic>10.7554/eLife.65151 (2021).</mixed-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bannon</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>DeepCell Kiosk: scaling deep learning-enabled cellular image analysis with Kubernetes</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>43</fpage>
        <lpage>45</lpage>
        <?supplied-pmid 33398191?>
        <pub-id pub-id-type="pmid">33398191</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lugagne</surname>
            <given-names>JB</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Dunlop</surname>
            <given-names>MJ</given-names>
          </name>
        </person-group>
        <article-title>DeLTA: Automated cell segmentation, tracking, and lineage reconstruction using deep learning</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2020</year>
        <volume>16</volume>
        <fpage>e1007673</fpage>
        <?supplied-pmid 32282792?>
        <pub-id pub-id-type="pmid">32282792</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Smit</surname>
            <given-names>JH</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Warszawik</surname>
            <given-names>EM</given-names>
          </name>
          <name>
            <surname>Herrmann</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Cordes</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>ColiCoords: a Python package for the analysis of bacterial fluorescence microscopy data</article-title>
        <source>PLoS ONE</source>
        <year>2019</year>
        <volume>14</volume>
        <fpage>e0217524</fpage>
        <?supplied-pmid 31216308?>
        <pub-id pub-id-type="pmid">31216308</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Czech</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Aksoy</surname>
            <given-names>BA</given-names>
          </name>
          <name>
            <surname>Aksoy</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Hammerbacher</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Cytokit: a single-cell analysis toolkit for high dimensional fluorescent microscopy imaging</article-title>
        <source>BMC Bioinf.</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>448</fpage>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McQuin</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CellProfiler 3.0: Next-generation image processing for biology</article-title>
        <source>PLoS Biol.</source>
        <year>2018</year>
        <volume>16</volume>
        <fpage>e2005970</fpage>
        <?supplied-pmid 29969450?>
        <pub-id pub-id-type="pmid">29969450</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Berg</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ilastik: interactive machine learning for (bio)image analysis</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1226</fpage>
        <lpage>1232</lpage>
        <?supplied-pmid 31570887?>
        <pub-id pub-id-type="pmid">31570887</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Wolny, A. et al. Accurate and versatile 3D segmentation of plant tissues at cellular resolution. <italic>eLife</italic>10.7554/eLife.57613 (2020).</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ursell</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Rapid, precise quantification of bacterial cellular dimensions across a genomic-scale knockout library</article-title>
        <source>BMC Biol.</source>
        <year>2017</year>
        <volume>15</volume>
        <fpage>17</fpage>
        <?supplied-pmid 28222723?>
        <pub-id pub-id-type="pmid">28222723</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tsai</surname>
            <given-names>HF</given-names>
          </name>
          <name>
            <surname>Gajda</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Sloan</surname>
            <given-names>TFW</given-names>
          </name>
          <name>
            <surname>Rares</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Shen</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Usiigaci: Instance-aware cell tracking in stain-free phase contrast microscopy enabled by machine learning</article-title>
        <source>SoftwareX</source>
        <year>2019</year>
        <volume>9</volume>
        <fpage>230</fpage>
        <lpage>237</lpage>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <mixed-citation publication-type="other">Reiner, J., Azran, G. &amp; Hyams, G. MicroAnalyzer: a Python tool for automated bacterial analysis with fluorescence microscopy. Preprint at <italic>arXiv</italic><ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/2009.12684">https://arxiv.org/abs/2009.12684</ext-link> (2020).</mixed-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <mixed-citation publication-type="other">Schmidt, U. et al. in <italic>Medical Image Computing and Computer Assisted Intervention</italic> (Springer, 2018).</mixed-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">He, K., Gkioxari, G., Dollar, P. &amp; Girshick, R. Mask R-CNN. Preprint at <italic>arXiv</italic><ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1703.06870">https://arxiv.org/abs/1703.06870</ext-link> (2018).</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shal</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Choudhry</surname>
            <given-names>MS</given-names>
          </name>
        </person-group>
        <article-title>Evolution of deep learning algorithms for MRI-based brain tumor image segmentation</article-title>
        <source>Crit. Rev. Biomed. Eng.</source>
        <year>2021</year>
        <volume>49</volume>
        <fpage>77</fpage>
        <lpage>94</lpage>
        <?supplied-pmid 34347989?>
        <pub-id pub-id-type="pmid">34347989</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bean</surname>
            <given-names>GJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A22 disrupts the bacterial actin cytoskeleton by directly binding and inducing a low-affinity state in MreB</article-title>
        <source>Biochemistry</source>
        <year>2009</year>
        <volume>48</volume>
        <fpage>4852</fpage>
        <lpage>4857</lpage>
        <?supplied-pmid 19382805?>
        <pub-id pub-id-type="pmid">19382805</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Laine</surname>
            <given-names>RF</given-names>
          </name>
          <name>
            <surname>Arganda-Carreras</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Henriques</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Jacquemet</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Avoiding a replication crisis in deep-learning-based bioimage analysis</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1136</fpage>
        <lpage>1144</lpage>
        <?supplied-pmid 34608322?>
        <pub-id pub-id-type="pmid">34608322</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Taha</surname>
            <given-names>AA</given-names>
          </name>
          <name>
            <surname>Hanbury</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Metrics for evaluating 3D medical image segmentation: analysis, selection, and tool</article-title>
        <source>BMC Med. Imaging</source>
        <year>2015</year>
        <volume>15</volume>
        <fpage>29</fpage>
        <?supplied-pmid 26263899?>
        <pub-id pub-id-type="pmid">26263899</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lu</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Unsupervised sequential outlier detection with deep architectures</article-title>
        <source>IEEE Trans. Image Process.</source>
        <year>2017</year>
        <volume>26</volume>
        <fpage>4321</fpage>
        <lpage>4330</lpage>
        <?supplied-pmid 28600248?>
        <pub-id pub-id-type="pmid">28600248</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sethian</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Vladimirsky</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Ordered upwind methods for static Hamilton-Jacobi equations</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2001</year>
        <volume>98</volume>
        <fpage>11069</fpage>
        <lpage>11074</lpage>
        <?supplied-pmid 11572970?>
        <pub-id pub-id-type="pmid">11572970</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <mixed-citation publication-type="other">Huang, Y. Improved fast iterative algorithm for eikonal equation for GPU computing. Preprint at <italic>arXiv</italic> https://arXiv:2106.15869v3 (2021).</mixed-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <mixed-citation publication-type="other">Ester, M., Kreigel, H. P., Sander, J. &amp; Xu, X. A density-based algorithm for discovering clusters in large spatial databases with noise. In <italic>Proc. 2nd Int. Conf. Knowl. Discov. Data Min.</italic> 226–231 (1996).</mixed-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gitai</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>New fluorescence microscopy methods for microbiology: sharper, faster, and quantitative</article-title>
        <source>Curr. Opin. Microbiol.</source>
        <year>2009</year>
        <volume>12</volume>
        <fpage>341</fpage>
        <lpage>346</lpage>
        <?supplied-pmid 19356974?>
        <pub-id pub-id-type="pmid">19356974</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Girard</surname>
            <given-names>LR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>WormBook: the online review of <italic>Caenorhabditis elegans</italic> biology</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2007</year>
        <volume>35</volume>
        <fpage>D472</fpage>
        <lpage>D475</lpage>
        <?supplied-pmid 17099225?>
        <pub-id pub-id-type="pmid">17099225</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hebert</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Ahamed</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Costa</surname>
            <given-names>AC</given-names>
          </name>
          <name>
            <surname>O’Shaughnessy</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Stephens</surname>
            <given-names>GJ</given-names>
          </name>
        </person-group>
        <article-title>WormPose: image synthesis and convolutional networks for pose estimation in <italic>C.</italic> <italic>elegans</italic></article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2021</year>
        <volume>17</volume>
        <fpage>e1008914</fpage>
        <?supplied-pmid 33905413?>
        <pub-id pub-id-type="pmid">33905413</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Javer</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>An open-source platform for analyzing and sharing worm-behavior data</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>645</fpage>
        <lpage>646</lpage>
        <?supplied-pmid 30171234?>
        <pub-id pub-id-type="pmid">30171234</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ljosa</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Sokolnicki</surname>
            <given-names>KL</given-names>
          </name>
          <name>
            <surname>Carpenter</surname>
            <given-names>AE</given-names>
          </name>
        </person-group>
        <article-title>Annotated high-throughput microscopy image sets for validation</article-title>
        <source>Nat. Methods</source>
        <year>2012</year>
        <volume>9</volume>
        <fpage>637</fpage>
        <?supplied-pmid 22743765?>
        <pub-id pub-id-type="pmid">22743765</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ting</surname>
            <given-names>SY</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Bifunctional immunity proteins protect bacteria against FtsZ-targeting ADP-ribosylating toxins</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>175</volume>
        <fpage>1380</fpage>
        <lpage>1392</lpage>
        <?supplied-pmid 30343895?>
        <pub-id pub-id-type="pmid">30343895</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <mixed-citation publication-type="other">Cusick, J. A., Wellman, C. L. &amp; Demas, G. E. The call of the wild: using non-model systems to investigate microbiome-behaviour relationships. <italic>J. Exp. Biol</italic>. 10.1242/jeb.224485 (2021).</mixed-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Cell segmentation for image cytometry: advances, insufficiencies, and challenges</article-title>
        <source>Cytom. A</source>
        <year>2019</year>
        <volume>95</volume>
        <fpage>708</fpage>
        <lpage>711</lpage>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>He</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genome-resolved metagenomics reveals site-specific diversity of episymbiotic CPR bacteria and DPANN archaea in groundwater ecosystems</article-title>
        <source>Nat. Microbiol</source>
        <year>2021</year>
        <volume>6</volume>
        <fpage>354</fpage>
        <lpage>365</lpage>
        <?supplied-pmid 33495623?>
        <pub-id pub-id-type="pmid">33495623</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <mixed-citation publication-type="other">Looi, S. rotated_maskrcnn. <italic>GitHub</italic><ext-link ext-link-type="uri" xlink:href="https://github.com/mrlooi/rotated_maskrcnn">https://github.com/mrlooi/rotated_maskrcnn</ext-link> (2019).</mixed-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bharti</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Grimm</surname>
            <given-names>DG</given-names>
          </name>
        </person-group>
        <article-title>Current challenges and best-practice protocols for microbiome analysis</article-title>
        <source>Brief. Bioinform.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>178</fpage>
        <lpage>193</lpage>
        <?supplied-pmid 31848574?>
        <pub-id pub-id-type="pmid">31848574</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Smits</surname>
            <given-names>WK</given-names>
          </name>
          <name>
            <surname>Kuipers</surname>
            <given-names>OP</given-names>
          </name>
          <name>
            <surname>Veening</surname>
            <given-names>JW</given-names>
          </name>
        </person-group>
        <article-title>Phenotypic variation in bacteria: the role of feedback regulation</article-title>
        <source>Nat. Rev. Microbiol.</source>
        <year>2006</year>
        <volume>4</volume>
        <fpage>259</fpage>
        <lpage>271</lpage>
        <?supplied-pmid 16541134?>
        <pub-id pub-id-type="pmid">16541134</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bailey</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Essential gene deletions producing gigantic bacteria</article-title>
        <source>PLoS Genet.</source>
        <year>2019</year>
        <volume>15</volume>
        <fpage>e1008195</fpage>
        <?supplied-pmid 31181062?>
        <pub-id pub-id-type="pmid">31181062</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cass</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Stylianidou</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kuwada</surname>
            <given-names>NJ</given-names>
          </name>
          <name>
            <surname>Traxler</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Wiggins</surname>
            <given-names>PA</given-names>
          </name>
        </person-group>
        <article-title>Probing bacterial cell biology using image cytometry</article-title>
        <source>Mol. Microbiol.</source>
        <year>2017</year>
        <volume>103</volume>
        <fpage>818</fpage>
        <lpage>828</lpage>
        <?supplied-pmid 27935200?>
        <pub-id pub-id-type="pmid">27935200</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Meberg</surname>
            <given-names>BM</given-names>
          </name>
          <name>
            <surname>Sailer</surname>
            <given-names>FC</given-names>
          </name>
          <name>
            <surname>Nelson</surname>
            <given-names>DE</given-names>
          </name>
          <name>
            <surname>Young</surname>
            <given-names>KD</given-names>
          </name>
        </person-group>
        <article-title>Reconstruction of <italic>Escherichia coli</italic> mrcA (PBP 1a) mutants lacking multiple combinations of penicillin binding proteins</article-title>
        <source>J. Bacteriol.</source>
        <year>2001</year>
        <volume>183</volume>
        <fpage>6148</fpage>
        <lpage>6149</lpage>
        <?supplied-pmid 11567017?>
        <pub-id pub-id-type="pmid">11567017</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lowenthal</surname>
            <given-names>AC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Functional analysis of the <italic>Helicobacter pylori</italic> flagellar switch proteins</article-title>
        <source>J. Bacteriol.</source>
        <year>2009</year>
        <volume>191</volume>
        <fpage>7147</fpage>
        <lpage>7156</lpage>
        <?supplied-pmid 19767432?>
        <pub-id pub-id-type="pmid">19767432</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <mixed-citation publication-type="other">Taylor, J. A. et al. Distinct cytoskeletal proteins define zones of enhanced cell wall synthesis in <italic>H. pylori</italic>. <italic>eLife</italic>10.7554/eLife.52482 (2020).</mixed-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Evinger</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Agabian</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Envelope-associated nucleoid from <italic>Caulobacter crescentus</italic> stalked and swarmer cells</article-title>
        <source>J. Bacteriol.</source>
        <year>1977</year>
        <volume>132</volume>
        <fpage>294</fpage>
        <lpage>301</lpage>
        <?supplied-pmid 334726?>
        <pub-id pub-id-type="pmid">334726</pub-id>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Caccamo</surname>
            <given-names>PD</given-names>
          </name>
          <name>
            <surname>Jacq</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>VanNieuwenhze</surname>
            <given-names>MS</given-names>
          </name>
          <name>
            <surname>Brun</surname>
            <given-names>YV</given-names>
          </name>
        </person-group>
        <article-title>A division of labor in the recruitment and topological organization of a bacterial morphogenic complex</article-title>
        <source>Curr. Biol.</source>
        <year>2020</year>
        <volume>30</volume>
        <fpage>3908</fpage>
        <lpage>3922</lpage>
        <?supplied-pmid 32795444?>
        <pub-id pub-id-type="pmid">32795444</pub-id>
      </element-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <mixed-citation publication-type="other">Robertson, N., Sanders, D. P., Seymour, P. &amp; Thomas, R. A new proof of the four-colour theorem. <italic>Electron. Res. Announc. Amer. Math. Soc</italic>. 10.1090/S1079-6762-96-00003-0 (1996).</mixed-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hartmann</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>van Teeseling</surname>
            <given-names>MCF</given-names>
          </name>
          <name>
            <surname>Thanbichler</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Drescher</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>BacStalk: a comprehensive and interactive image analysis software tool for bacterial cell biology</article-title>
        <source>Mol. Microbiol.</source>
        <year>2020</year>
        <volume>114</volume>
        <fpage>140</fpage>
        <lpage>150</lpage>
        <?supplied-pmid 32190923?>
        <pub-id pub-id-type="pmid">32190923</pub-id>
      </element-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <mixed-citation publication-type="other">Goni-Moreno, A., Kim, J. &amp; de Lorenzo, V. CellShape: a user-friendly image analysis tool for quantitative visualization of bacterial cell factories inside. <italic>Biotechnol. J.</italic>10.1002/biot.201600323 (2017).</mixed-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Young</surname>
            <given-names>JW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Measuring single-cell gene expression dynamics in bacteria using fluorescence time-lapse microscopy</article-title>
        <source>Nat. Protoc.</source>
        <year>2011</year>
        <volume>7</volume>
        <fpage>80</fpage>
        <lpage>88</lpage>
        <?supplied-pmid 22179594?>
        <pub-id pub-id-type="pmid">22179594</pub-id>
      </element-citation>
    </ref>
    <ref id="CR59">
      <label>59.</label>
      <mixed-citation publication-type="other">O’Connor, O. M. et al. DeLTA 2.0: a deep learning pipeline for quantifying single-cell spatial and temporal dynamics. <italic>PLoS Comput. Biol.</italic><bold>18</bold>, 10.1101/2021.08.10.455795 (2021).</mixed-citation>
    </ref>
    <ref id="CR60">
      <label>60.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Srivastava</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Hinton</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Krizhevsky</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Sutskever</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Salakhutdinov</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Dropout: a simple way to prevent neural networks from overfitting</article-title>
        <source>J. Mach. Learn. Res.</source>
        <year>2014</year>
        <volume>15</volume>
        <fpage>1929</fpage>
        <lpage>1958</lpage>
      </element-citation>
    </ref>
    <ref id="CR61">
      <label>61.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kaur</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Pannu</surname>
            <given-names>HS</given-names>
          </name>
          <name>
            <surname>Malhi</surname>
            <given-names>AK</given-names>
          </name>
        </person-group>
        <article-title>A systematic review on imbalanced data challenges in machine learning: applications and solutions</article-title>
        <source>ACM Comput. Surv.</source>
        <year>2019</year>
        <volume>52</volume>
        <fpage>1</fpage>
        <lpage>36</lpage>
      </element-citation>
    </ref>
  </ref-list>
</back>
