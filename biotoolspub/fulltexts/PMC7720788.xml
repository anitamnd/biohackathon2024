<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<?covid-19-tdm?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Pediatr Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">Pediatr Res</journal-id>
    <journal-title-group>
      <journal-title>Pediatric Research</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0031-3998</issn>
    <issn pub-type="epub">1530-0447</issn>
    <publisher>
      <publisher-name>Nature Publishing Group US</publisher-name>
      <publisher-loc>New York</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7720788</article-id>
    <article-id pub-id-type="pmid">33288876</article-id>
    <article-id pub-id-type="publisher-id">1301</article-id>
    <article-id pub-id-type="doi">10.1038/s41390-020-01301-9</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Clinical Research Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Computational analysis of neonatal ventilator waveforms and loops</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Chong</surname>
          <given-names>David</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Morley</surname>
          <given-names>Colin J.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Belteki</surname>
          <given-names>Gusztav</given-names>
        </name>
        <address>
          <email>gbelteki@aol.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.24029.3d</institution-id><institution-id institution-id-type="ISNI">0000 0004 0383 8386</institution-id><institution>Neonatal Intensive Care Unit, The Rosie Hospital, </institution><institution>Cambridge University Hospitals NHS Foundation Trust, </institution></institution-wrap>Cambridge, UK </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.5335.0</institution-id><institution-id institution-id-type="ISNI">0000000121885934</institution-id><institution>University of Cambridge, St. Edmund’s College, </institution></institution-wrap>Cambridge, UK </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>7</day>
      <month>12</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <year>2021</year>
    </pub-date>
    <volume>89</volume>
    <issue>6</issue>
    <fpage>1432</fpage>
    <lpage>1441</lpage>
    <history>
      <date date-type="received">
        <day>21</day>
        <month>7</month>
        <year>2020</year>
      </date>
      <date date-type="rev-recd">
        <day>28</day>
        <month>9</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>5</day>
        <month>11</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© International Pediatric Research Foundation, Inc 2020</copyright-statement>
      <license>
        <license-p>This article is made available via the PMC Open Access Subset for unrestricted research re-use and secondary analysis in any form or by any means with acknowledgement of the original source. These permissions are granted for the duration of the World Health Organization (WHO) declaration of COVID-19 as a global pandemic.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">Modern neonatal ventilators allow the downloading of their data with a high sampling rate. We wanted to develop an algorithm that automatically recognises and characterises ventilator inflations from ventilator pressure and flow data.</p>
      </sec>
      <sec>
        <title>Methods</title>
        <p id="Par2">We downloaded airway pressure and flow data with 100 Hz sampling rate from Dräger Babylog VN500 ventilators ventilating critically ill infants. We developed an open source Python package, <italic>Ventiliser</italic>, that includes a rule-based algorithm to automatically discretise ventilator data into a sequence of flow and pressure states and to recognise ventilator inflations and an information gain approach to identify inflation phases (inspiration, expiration) and sub-phases (pressure rise, pressure plateau, inspiratory hold etc.).</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par3"><italic>Ventiliser</italic> runs on a personal computer and analyses 24 h of ventilation in 2 min. With longer recordings, the processing time increases linearly. It generates a table reporting indices of each breath and its sub-phases. <italic>Ventiliser</italic> also allows visualisation of individual inflations as waveforms or loops. <italic>Ventiliser</italic> identified &gt;97% of ventilator inflations and their sub-phases in an out-of-sample validation of manually annotated data. We also present detailed quantitative analysis and comparison of two 1-hour-long ventilation periods.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par4"><italic>Ventiliser</italic> can analyse ventilation patterns and ventilator–patient interactions over long periods of mechanical ventilation.</p>
      </sec>
      <sec>
        <title>Impact</title>
        <p id="Par5">
          <list list-type="bullet">
            <list-item>
              <p id="Par6">We have developed a computational method to recognize and analyse ventilator inflations from raw data downloaded from ventilators of preterm and critically ill infants.</p>
            </list-item>
            <list-item>
              <p id="Par7">There have been no previous reports on the computational analysis of neonatal ventilator data.</p>
            </list-item>
            <list-item>
              <p id="Par8">We have made our program, <italic>Ventiliser</italic>, freely available.</p>
            </list-item>
            <list-item>
              <p id="Par9">Clinicians and researchers can use <italic>Ventiliser</italic> to analyse ventilator inflations, waveforms and loops over long periods.</p>
            </list-item>
            <list-item>
              <p id="Par10"><italic>Ventiliser</italic> can also be used to study ventilator–patient interactions.</p>
            </list-item>
          </list>
        </p>
      </sec>
    </abstract>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© International Pediatric Research Foundation, Inc 2021</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par11">Despite advances in non-invasive respiratory support, mechanical ventilation remains an important therapy in Neonatology: about 1.2% of all newborn infants receive mechanical ventilation due to prematurity or a critical illness in the neonatal period.<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> Large tertiary neonatal intensive care units (NICUs) frequently have over 1500 ventilator days annually. Modern ventilators are equipped with powerful computers and in addition to calculating and showing several ventilator parameters, their graphical user interfaces also display real-time ventilator waveforms and loops.<sup><xref ref-type="bibr" rid="CR2">2</xref>,<xref ref-type="bibr" rid="CR3">3</xref></sup> These data are invaluable for analysing effectiveness of ventilation, to determine whether ventilator parameters are appropriate and to detect adverse ventilator–patient interactions.<sup><xref ref-type="bibr" rid="CR4">4</xref></sup> However, busy clinicians frequently ignore ventilator waveforms or only review them for very short periods.<sup><xref ref-type="bibr" rid="CR5">5</xref></sup> As these data are not routinely downloaded or stored, they cannot be reviewed later.</p>
    <p id="Par12">An alternative to inspecting ventilator screens over long periods would be to develop computational methods to study the effectiveness of mechanical ventilation and individual patient–ventilator interactions. This approach requires access to raw ventilator data (airway pressure and flow) at a sampling rate high enough to computationally re-generate and analyse waveforms and loops. Indeed, new ventilator models enable such data to be downloaded.<sup><xref ref-type="bibr" rid="CR6">6</xref>–<xref ref-type="bibr" rid="CR9">9</xref></sup> In order to interpret these raw data, as a first step, they need to be split into individual ventilator inflations, which can then be further segmented into sub-phases (i.e. lung inflation, inspiratory hold, lung deflation etc.). Identification and separation of these segments enables statistical analysis of their characteristics over longer periods and automatic detection, characterisation and quantitative analysis of patient–ventilator interactions during different phases of the respiratory cycle. Recently, several different approaches have been reported to computationally analyse adult ventilator data and characterise patient–ventilator interactions.<sup><xref ref-type="bibr" rid="CR10">10</xref>–<xref ref-type="bibr" rid="CR17">17</xref></sup> However, neonatal mechanical ventilation uses different ventilator modes and has different characteristics from adult ventilation and the tools developed for adults cannot be directly used with neonatal data.</p>
    <p id="Par13">In this paper, we describe and validate a novel computational approach to segment high-throughput raw data downloaded from the ventilators of critically ill babies into individual ventilator inflations and to further split the inflations into different sub-phases.</p>
  </sec>
  <sec id="Sec2">
    <title>Methods</title>
    <sec id="Sec3">
      <title>Data collection</title>
      <p id="Par14">Ventilator data were collected from infants ventilated on the Neonatal Intensive Care Unit, Rosie Hospital, Cambridge. The study was approved by the Bromley (London) Research Ethics Committee of the Health Research Authority of the United Kingdom (reference: 18/LO/2182). Informed consent was obtained from parents. All procedures were performed in accordance with the ethical standards of the Research Ethics Committee and the amended Helsinki Declaration (1983).</p>
      <p id="Par15">Ventilator data were downloaded to a laptop computer via a cable attached to one of the serial communication ports of the Dräger Babylog VN500 neonatal ventilator (Dräger Medical, Lübeck, Germany) using the recording software developed by the “Technology and Intellectual Property” Department of Dräger Medical. This is for experimental and scientific purposes only and it is not commercially available. All data downloaded by the software carry a timestamp with millisecond precision. Data are exported into comma-separated value (.csv) text files.</p>
      <p id="Par16">The software retrieves airway pressure, flow and volume data with 100 Hz frequency (100 per second). Airway pressure is measured and calculated by the ventilator’s sensors. Flow is measured by the proximal flow sensor connected at the patient’s wye piece. Volume data are generated by the ventilator using time integration of the flow data. The 100 Hz sampling rate is sufficient for waveforms of individual breaths and inflations to be reconstructed,<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> also see Fig. <xref rid="Fig1" ref-type="fig">1a</xref> and Supplemental Figs. <xref rid="MOESM1" ref-type="media">S5</xref> and <xref rid="MOESM1" ref-type="media">S6</xref> (online). As the recording software was designed to be compatible with paediatric and adult ventilators using larger tidal volumes, due to bandwidth limitations the smallest difference in tidal volume that can be retrieved is 1.35 mL, which is too large for neonatal studies. Therefore, our software (<italic>Ventiliser</italic>) reconstructs the volumes from the obtained flow data.<fig id="Fig1"><label>Fig. 1</label><caption><title>Ventilator waveforms reconstructed from pressure and flow data obtained at 100 Hz sampling rate.</title><p><bold>a</bold> Phases and sub-phases of a ventilator cycle. This was a backup ventilator inflation without any patient contribution. Ventilator mode was AC-VG (assist-control with volume guarantee). Sub-phases of the inflation are demarcated by dotted line and numbered as follows: (1A) Lung inflation; (1B) Inspiratory hold; (2A) Lung deflation; (2B) Expiratory hold. See Table <xref rid="Tab1" ref-type="table">1</xref> for more details. Tidal volume has been calculated by integrating flow. The failure of the tidal volume wave form to return to zero at the end of expiration indicates the presence of some leak around the endotracheal tube. <bold>b</bold>, <bold>c</bold> Synchronised and backup ventilator inflations. Time point zero on the horizontal axis corresponds to the start of the ventilator cycle as detected by the algorithm. The vertical dotted lines represent the start of pressure rise as detected by the algorithm. During a synchronised inflation, <bold>b</bold> the positive (inspiratory) flow is initiated by the patient and therefore it precedes the rise of airway pressure above the PEEP level. There is a slight transient drop in PEEP as the patient starts breathing in from the circuit (arrow). During a backup inflation, <bold>c</bold> the positive (inspiratory) flow is initiated by the ventilator and therefore it quickly follows the rise in airway pressure.</p></caption><graphic xlink:href="41390_2020_1301_Fig1_HTML" id="d32e388"/></fig></p>
      <p id="Par17">In addition to 100 Hz waveform data, the recording software also downloads calculated ventilator parameters at 1 Hz frequency, including mandatory, spontaneous, inspiratory, expiratory tidal and minute volumes, peak inflation pressure, mean airway pressure, positive end expiratory pressure, inspiratory and expiratory times, and fraction of inspired oxygen. The parameters obtained are those of the last full inflation that has been applied to the patient or made spontaneously by the patient before the timestamp. Minute volumes are directly calculated from the ventilator flow data over 20-second windows with appropriate filters. The recording tool also retrieves alarm data with a timestamp when an alarm was triggered and again when the issue triggering the alarm has been resolved. Changes in the ventilator and alarm settings are recorded with a timestamp showing the time the changes were made.</p>
    </sec>
    <sec id="Sec4">
      <title>Data processing and analysis</title>
      <p id="Par18">Data were processed and analysed using Python (version 3.8, <ext-link ext-link-type="uri" xlink:href="https://www.python.org">https://www.python.org</ext-link>) and its add-on packages. In addition to modules that are part of the Python standard library, we used NumPy (version 1.18.3, <ext-link ext-link-type="uri" xlink:href="http://www.numpy.org">http://www.numpy.org</ext-link>), pandas (version 1.0.3, <ext-link ext-link-type="uri" xlink:href="http://pandas.pydata.org">http://pandas.pydata.org</ext-link>) and SciPy (version 1.4.1, <ext-link ext-link-type="uri" xlink:href="http://www.scipy.org">www.scipy.org</ext-link>). We created a Python package named <italic>Ventiliser</italic> to organise the ventilator data segmentation pipeline code. Data were analysed done using Jupyter Notebooks (version: 1.0.0) and Spyder (version: 3.3.1) installed as part of freely available Anaconda distribution (Continuum Analytics, <ext-link ext-link-type="uri" xlink:href="http://docs.continuum.io/anaconda/pkg-docs">http://docs.continuum.io/anaconda/pkg-docs</ext-link>). Visualisation was done with matplotlib (version 3.2.1, <ext-link ext-link-type="uri" xlink:href="http://matplotlib.org">http://matplotlib.org</ext-link>). The graphical user interface was built using the PyQt5 (version 5.9.2 <ext-link ext-link-type="uri" xlink:href="https://www.riverbankcomputing.com/software/pyqt/">https://www.riverbankcomputing.com/software/pyqt/</ext-link>) and pyqtgraph (version 0.10.0 <ext-link ext-link-type="uri" xlink:href="http://www.pyqtgraph.org/">http://www.pyqtgraph.org/</ext-link>). All software is open source and freely available. <italic>Ventiliser</italic> package can be found at <ext-link ext-link-type="uri" xlink:href="https://github.com/barrinalo/Ventiliser">https://github.com/barrinalo/Ventiliser</ext-link> and the data analysis notebooks can be downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/gbelteki/ventilator_data_segmentation">https://github.com/gbelteki/ventilator_data_segmentation</ext-link>.</p>
    </sec>
    <sec id="Sec5">
      <title>Definition of a ventilator cycle its phases and sub-phases</title>
      <p id="Par19">Before implementing the algorithm, we defined the concept of a ventilator cycle and its phases and sub-phases (Table <xref rid="Tab1" ref-type="table">1</xref> and Fig. <xref rid="Fig1" ref-type="fig">1a</xref>). The start of a ventilator cycle was defined as the time from the start of the positive (inward) flow, which is accompanied by a ventilator-assisted and ventilator-cycled positive pressure inflation. The ventilator cycle can be triggered by the baby and synchronised when the increase in flow precedes the start in pressure rise (trigger delay) or it can be a ventilator-initiated backup cycle when the airway pressure increases first rapidly followed by the positive flow (Fig. <xref rid="Fig1" ref-type="fig">1b, c</xref>). A ventilator cycle lasts until the start of the next ventilator cycle (commencement of next positive flow). In some modes (e.g. synchronised intermittent mandatory ventilation (SIMV)), there can be unassisted or pressure-supported spontaneous breaths between ventilator inflations. The inspiratory phase of the cycle includes the period when the lungs are being inflated and the inspiratory hold, which, if present, corresponds to inflated lungs with the airway pressure being maintained at the peak inspiratory pressure (PIP) level and with no air flow. The expiratory phase is the period when the lungs are deflating to the level of the functional residual capacity (FRC) and the time with the lungs at FRC and the airway pressure at the positive end expiratory pressure (PEEP).<table-wrap id="Tab1"><label>Table 1</label><caption><p>Phases and sub-phases of a ventilator cycle defined by direction and change in airway flow.</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Phase</th><th>Sub-phase</th><th>Start</th><th>End</th></tr></thead><tbody><tr><td>Inspiration</td><td>Lung inflation</td><td>Start of ventilator cycle<sup>a</sup></td><td>Inspiratory flow ends</td></tr><tr><td/><td>Inspiratory hold</td><td>Inspiratory flow ends</td><td>Expiratory flow starts</td></tr><tr><td>Expiration</td><td>Lung deflation</td><td>Expiratory flow starts</td><td>Expiratory flow ends</td></tr><tr><td/><td>Expiratory hold</td><td>Expiratory flow ends</td><td>Start of next ventilator cycle</td></tr></tbody></table><table-wrap-foot><p>Inspiratory hold may be absent depending on the ventilator modes and settings used.</p><p><sup>a</sup>Start of a ventilator cycle was defined by the beginning of the positive (inward) flow both in case of triggered and backup ventilator inflations. See “Methods” for more details about the detection algorithm and implementation.</p></table-wrap-foot></table-wrap></p>
    </sec>
    <sec id="Sec6">
      <title>The StateMapper algorithm</title>
      <p id="Par20">After defining ventilator sub-phases, we also defined flow and pressure states associated with them (Table <xref rid="Tab2" ref-type="table">2</xref>). To reduce noise and processing time, the raw time series was then discretised by associating flow and pressure states with these sub-phases. Mapping states to raw time series was achieved by piecewise aggregate approximation using mean and standard deviation with a window size of 3 data points (30 ms). The mean (Wmean<sub>i</sub>) and standard deviation (Wstd<sub>i</sub>) of each segment (<italic>W</italic><sub>i</sub>) was then compared to the next one (<italic>W</italic><sub>i+1</sub>). Stationary states were determined by comparing the difference in mean between windows (ΔWmean = Wmean<sub>i+1</sub> − Wmean<sub>i</sub>) against Wstd<sub>i</sub>. If ΔWmean &lt; 2 Wstd<sub>i</sub> or ΔWmean &lt; a threshold (<italic>T</italic>), then the state is stationary, and if not, it is non-stationary (moving). <italic>T</italic> is defined as 0.1 L/min for flow and 10% of set PEEP for pressure. The type of the non-stationary states is determined by the sign of ΔWmean with positive flow and pressure states being “Inspiration initiation”, “Expiration termination” and “Pressure rise”, respectively, and negative flow and pressure states being “Inspiration termination”, “Expiration initiation” and “Pressure drop”, respectively. For stationary flow states, the “Peak inspiratory flow” state has positive Wmean<sub>i</sub>, the “Peak expiratory flow” state has negative Wmean<sub>i</sub> and the “No flow” state has Wmean<sub>i</sub> within ±0.1 L/min of 0 L/min. For stationary pressure states, the average between the previous peak inflating pressure (PIP) and the set PEEP was used, such that if Wmean<sub>i</sub> &lt; the average, it was state PEEP, and if not, it was state PIP. Details can be seen in Supplemental Figs. <xref rid="MOESM1" ref-type="media">S1</xref> and <xref rid="MOESM1" ref-type="media">S2</xref> (online).<table-wrap id="Tab2"><label>Table 2</label><caption><p>Flow and pressure states.</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Label</th><th>Flow state</th><th>Flow direction<sup>a</sup></th><th>Flow change</th><th>Sub-phase(s) when occur<sup>b</sup></th></tr></thead><tbody><tr><td>0</td><td>No flow</td><td>No flow</td><td>N/A</td><td><p>Inspiratory hold</p><p>Expiratory hold</p></td></tr><tr><td>1</td><td>Inspiration initiation</td><td>Positive</td><td>Increasing</td><td>Lung inflation</td></tr><tr><td>2</td><td>Peak inspiratory flow</td><td>Positive</td><td>No change</td><td>Lung inflation</td></tr><tr><td>3</td><td>Inspiration termination</td><td>Positive</td><td>Decreasing</td><td>Lung inflation</td></tr><tr><td>4</td><td>Expiration initiation</td><td>Negative</td><td>Increasing</td><td>Lung deflation</td></tr><tr><td>5</td><td>Peak expiratory flow</td><td>Negative</td><td>No change</td><td>Lung deflation</td></tr><tr><td>6</td><td>Expiration termination</td><td>Negative</td><td>Decreasing</td><td>Lung deflation</td></tr></tbody></table><table frame="hsides" rules="groups"><thead><tr><th>Label</th><th>Pressure state</th><th>Pressure level</th><th>Pressure change</th><th>Sub-phase(s) when can occur<sup>b</sup></th></tr></thead><tbody><tr><td>0</td><td>PEEP</td><td>PEEP</td><td>No change</td><td><p>Lung deflation<sup>c</sup></p><p>Expiratory hold</p></td></tr><tr><td>1</td><td>Pressure rise</td><td>Between PEEP and PIP</td><td>Increasing</td><td>Lung inflation</td></tr><tr><td>2</td><td>PIP</td><td>PIP</td><td>No change</td><td><p>Lung inflation<sup>c</sup></p><p>Inspiratory hold</p></td></tr><tr><td>3</td><td>Pressure drop</td><td>Between PIP and PEEP</td><td>Decreasing</td><td>Lung deflation</td></tr></tbody></table><table-wrap-foot><p><italic>PIP</italic> peak inspiratory pressure, <italic>PEEP</italic> positive end expiratory pressure, <italic>N/A</italic> not applicable.</p><p><sup>a</sup>Positive flow corresponds to inward flow normally present during inspiration. Negative flow corresponds to outward flow normally present during expiration.</p><p><sup>b</sup>See Table <xref rid="Tab1" ref-type="table">1</xref> for definition of sub-phases of a ventilator cycle.</p><p><sup>c</sup>Due to airway resistance, during inspiration airway pressure rises to PIP level some time before inspiratory flow ends and during expiration pressure drops down to PEEP level some time before expiratory flow ends.</p></table-wrap-foot></table-wrap></p>
    </sec>
    <sec id="Sec7">
      <title>Segmentation algorithm</title>
      <p id="Par21">After discretisation, breaths were demarcated into inspiration–inspiration intervals, determined by encountering an “Inspiration initiation” or “Peak inspiratory flow” state and also fulfilling the following two criteria: (1) having already encountered an expiratory state (“Expiration initiation”, “Peak expiratory flow” or “Expiration termination”); or (2) having encountered an “Inspiratory hold” or “Expiratory hold” state of &gt;50 time units (=500 ms). This allows <italic>Ventiliser</italic> to recognise the start of a new ventilator inflation even after positive flow was previously encountered without any negative flow, which may be due to a very large (&gt;90%) leak around the endotracheal tube or a ventilator artefact. Inflations with &lt;500 ms expiratory time will still be missed but the user can set this value differently. There is also an optional post-processing step which merges adjacent breaths if they are discovered to have significantly different inspiratory and expiratory volumes, which further reduces artefacts, but also combines breaths with large leaks around the endotracheal tube into one (default value is 66%).</p>
      <p id="Par22">Identifying inflation sub-phases is further complicated by the fact that in many cases the pressure and flow waveforms of ventilated infants do not show the regular shapes presented in Fig. <xref rid="Fig1" ref-type="fig">1</xref> due to spontaneous breathing effort, splinting, coughing or movement of the baby and artefacts due to kinking of the endotracheal tube or condensed water in the ventilator circuit. Therefore, an actual sub-phase is frequently not a contiguous series of consecutive single flow and pressure states as shown in Table <xref rid="Tab2" ref-type="table">2</xref>. Instead, it may be a region dominated by one particular state and interspersed with others. For example, an inflation may start with an “Inspiration initiation” flow state but if the patient is splinting the chest or is trying to breathe out briefly, inspiratory flow will decrease or even stop, resulting in “Peak inspiratory flow” or “Inspiration termination” flow states, respectively, before increasing again to reach the true peak inspiratory flow. To address this, <italic>Ventiliser</italic> iterates over the set of ordered states (flow or pressure) and finds the split along the time axis that maximises the information gain of the current state with respect to all other states. Each subsequent split is performed on the data after the previous split to ensure order.</p>
    </sec>
  </sec>
  <sec id="Sec8" sec-type="results">
    <title>Results</title>
    <sec id="Sec9">
      <title>Output and running time of the segmentation algorithm</title>
      <p id="Par23">We developed <italic>Ventiliser</italic>, a computational pipeline segmenting neonatal ventilator data into individual inflations, their phases and sub-phases. Spontaneous breaths between ventilator inflations are also recognised, if present. <italic>Ventiliser</italic> uses a rule-based algorithm as described in the “Methods” section. <italic>Ventiliser</italic> generates a report in table format exported as a .csv file (Supplemental Table <xref rid="MOESM2" ref-type="media">S1</xref> (online)). The report lists all identified ventilator inflations and spontaneous breaths with start time and duration of the various flow and pressure states and sub-phases. Moreover, additional parameters such as inspiratory and expiratory time, lung inflation and deflation time, peak inspiratory and expiratory flow, inspiratory and expiratory tidal volumes are also reported. The timing of sub-phases allows the user to distinguish between synchronised and backup inflation (see Fig. <xref rid="Fig1" ref-type="fig">1b, c</xref>). The correlation coefficient between pressure and flow is also reported; spontaneous breaths between ventilator inflations (if present) are characterised by absent or negative correlation as in their case the positive inspiratory flow is associated with no increase or even some decrease of the pressure from PEEP level, unless they are pressure-supported.</p>
      <p id="Par24">In addition to the report in table format, <italic>Ventiliser</italic> also has an evaluation module that a user with appropriate programming skills can use for quality control of <italic>Ventiliser</italic>’s output (Supplemental Fig. <xref rid="MOESM1" ref-type="media">S3</xref> (online)). Documentation of the module is available in the same repository as <italic>Ventiliser</italic>.</p>
      <p id="Par25"><italic>Ventiliser</italic> runs on a mid-range personal computer with an approximate speed of 2 min per ventilation day (corresponding to 8.64 million data points) and the running time scales linearly with duration of the recording. Speed and performance of the program is shown for some actual recordings in Supplemental Fig. <xref rid="MOESM1" ref-type="media">S4</xref> (online).</p>
    </sec>
    <sec id="Sec10">
      <title>Algorithm validation</title>
      <p id="Par26">To validate the segmentation algorithm, we have built a graphical user interphase (GUI) capable of importing raw ventilator data. The GUI shows pressure and flow waveforms in a time window set by the user (Fig. <xref rid="Fig2" ref-type="fig">2</xref>). The user can manually identify and label transition points between the flow and pressure states described in Table <xref rid="Tab2" ref-type="table">2</xref>. The manual annotation can be exported and stored as a .csv file and compared with computational annotation provided by the pipeline.<fig id="Fig2"><label>Fig. 2</label><caption><title>Graphical user interface to display and manually annotate ventilator waveform data.</title><p>Airway pressure (top panel) and flow (bottom panel) waveforms can be manually annotated with numbers corresponding to the start of pressure and flow states, respectively, as described in Table <xref rid="Tab2" ref-type="table">2</xref>. The annotation can be exported and stored as a comma-separated value (.csv) file and compared with computational annotation provided by the pipeline.</p></caption><graphic xlink:href="41390_2020_1301_Fig2_HTML" id="d32e975"/></fig></p>
      <p id="Par27">To evaluate the performance of the algorithm, three random 5-min samples were extracted from longer recordings of three infants: two were ventilated using SIMV with volume guarantee, one using assist-control with volume guarantee (AC-VG). In all three, the infant had spontaneous breathing effort and therefore interacted with the ventilator in a complex way. These recordings were not used during the development of <italic>Ventiliser</italic> (out-of-sample validation). The samples were manually annotated by a medical student after receiving formal training about ventilator waveforms from G.B. The algorithm successfully identified &gt;97% of the manually labelled flow and pressure states with a mean error between 10 and 40 ms (representing 1–4 data points) for all except the expiratory hold start key point, which had a mean error of 49.4 ms (Table <xref rid="Tab3" ref-type="table">3</xref>). Performance on the individual samples is shown in Supplemental Tables <xref rid="MOESM1" ref-type="media">S2</xref>–<xref rid="MOESM1" ref-type="media">S4</xref> (online)). The length of sub-phases identified by <italic>Ventiliser</italic> showed some deviation from the manual annotation (Table <xref rid="Tab4" ref-type="table">4</xref>). Overall, the difference between the mean duration of sub-phases identified by the two methods was &lt;50 ms in 83.33% (25/30) of the tests.<table-wrap id="Tab3"><label>Table 3</label><caption><p>Overall performance of algorithm against manual annotations.</p></caption><table frame="hsides" rules="groups"><thead><tr><th/><th>Number identified by algorithm</th><th>Number of manually annotated</th><th>% identified</th><th>Mean error (ms)</th></tr></thead><tbody><tr><td>inspiration_initiation_start</td><td>924</td><td>934</td><td>98.93</td><td>14.4</td></tr><tr><td>peak_inspiratory_flow_start</td><td>926</td><td>938</td><td>98.72</td><td>12.1</td></tr><tr><td>inspiratory_hold_start</td><td>925</td><td>936</td><td>98.82</td><td>20.5</td></tr><tr><td>expiration_initiation_start</td><td>920</td><td>936</td><td>98.29</td><td>16.1</td></tr><tr><td>peak_expiratory_flow_start</td><td>920</td><td>932</td><td>98.71</td><td>22.1</td></tr><tr><td>expiratory_hold_start</td><td>905</td><td>916</td><td>98.8</td><td>49.4</td></tr><tr><td>pressure_rise_start</td><td>808</td><td>825</td><td>97.94</td><td>36.8</td></tr><tr><td>pip_start</td><td>804</td><td>824</td><td>97.57</td><td>17.8</td></tr><tr><td>pressure_drop_start</td><td>805</td><td>824</td><td>97.69</td><td>30.4</td></tr><tr><td>peep_start</td><td>793</td><td>814</td><td>97.42</td><td>23.8</td></tr></tbody></table><table-wrap-foot><p>This table has been compiled from annotation data of three different recordings from three patients. Individual data are shown in Supplemental Tables <xref rid="MOESM1" ref-type="media">S2</xref>–<xref rid="MOESM1" ref-type="media">S4</xref>.</p></table-wrap-foot></table-wrap><table-wrap id="Tab4"><label>Table 4</label><caption><p>Comparison of the duration of sub-phases identified by <italic>Ventiliser</italic> by those identified by manual inspection and annotation.</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Ventilator mode</th><th colspan="3">Sample 1</th><th colspan="3">Sample 2</th><th colspan="3">Sample 3</th></tr><tr><th/><th colspan="3">SIMV-VG</th><th colspan="3">SIMV-VG</th><th colspan="3">AC-VG</th></tr><tr><th/><th>Manual annotation</th><th>Ventiliser</th><th/><th>Manual annotation</th><th>Ventiliser</th><th/><th>Manual annotation</th><th>Ventiliser</th><th/></tr><tr><th/><th>Mean (SD)</th><th>Mean (SD)</th><th>Difference</th><th>Mean (SD)</th><th>Mean (SD)</th><th>Difference</th><th>Mean (SD)</th><th>Mean (SD)</th><th>Difference</th></tr></thead><tbody><tr><td><italic>Flow sub-phases</italic><sup>a</sup></td><td/><td/><td/><td/><td/><td/><td/><td/><td/></tr><tr><td>Inspiration initiation length (ms)</td><td>128.5 (31)</td><td>120.8 (44)</td><td>−7.7</td><td>148.7 (74.4)</td><td>143.1 (46.4)</td><td>−5.6</td><td>138.9 (35.4)</td><td>123 (37.9)</td><td>−15.9</td></tr><tr><td>Inspiration termination length (ms)</td><td>131.6 (29)</td><td>158.7 (115.7)</td><td>27.1</td><td>181.2 (55.1)</td><td>195.1 (69.6)</td><td>13.9</td><td>155.9 (19.9)</td><td>167.3 (26.4)</td><td>11.4</td></tr><tr><td>Inspiratory hold length (ms)</td><td>54.3 (27.7)</td><td>49.3 (40)</td><td>−5</td><td>25.3 (36.8)</td><td>1.2 (0.78)</td><td>−24.1</td><td>42.6 (23.2)</td><td>31.8 (31)</td><td>−10.8</td></tr><tr><td>Expiration initiation length (ms)</td><td>90.02 (43.8)</td><td>86.2 (59.1)</td><td>−3.82</td><td>128.3 (48.8)</td><td>134.2 (76.3)</td><td>5.9</td><td>95.8 (48.6)</td><td>96.9 (43.5)</td><td>1.1</td></tr><tr><td>Expiration termination length (ms)</td><td>336.7 (133.3)</td><td>271.4 (120)</td><td>−65.3</td><td>398.7 (131.8)</td><td>413.7 (118.5)</td><td>15</td><td>321.9 (93.4)</td><td>264.1 (164.5)</td><td>−57.8</td></tr><tr><td>Expiratory hold length (ms)</td><td>295.1 (318.3)</td><td>348.5 (314.7)</td><td>53.4</td><td>21.9 (57.3)</td><td>17.9 (84.7)</td><td>−4</td><td>219.9 (106)</td><td>293.9 (127.3)</td><td>74</td></tr><tr><td><italic>Pressure sub-phases</italic><sup>b</sup></td><td/><td/><td/><td/><td/><td/><td/><td/><td/></tr><tr><td>Pressure rise length (ms)</td><td>128.1 (68.8)</td><td>174.1 (138.6)</td><td>46</td><td>178.4 (32.2)</td><td>143 (87.2)</td><td>−35.4</td><td>142.6 (80.5)</td><td>149.3 (19.8)</td><td>6.7</td></tr><tr><td>Peak inspiratory pressure length (ms)</td><td>119 (33.5)</td><td>133.5 (83.8)</td><td>14.5</td><td>121.6 (39.7)</td><td>167.5 (51.9)</td><td>45.9</td><td>109.8 (20.1)</td><td>142.6 (36.8)</td><td>32.8</td></tr><tr><td>Pressure drop length (ms)</td><td>184.4 (61.4)</td><td>174.9 (32.2)</td><td>−9.5</td><td>169.1 (90.8)</td><td>104.2 (46.9)</td><td>−64.9</td><td>159.7 (19)</td><td>128.5 (20.4)</td><td>−31.2</td></tr><tr><td>Positive end expiratory pressure length (ms)</td><td>508.9 (200.6)</td><td>520.2 (260.4)</td><td>11.3</td><td>416.5 (186.3)</td><td>433.1 (178.7)</td><td>16.6</td><td>471.2 (79.7)</td><td>510.2 (143.6)</td><td>39</td></tr></tbody></table><table-wrap-foot><p><italic>SIMV-VG</italic> synchronised intermittent mandatory ventilation with volume guarantee, <italic>AC-VG</italic> assist-control ventilation with volume guarantee, <italic>SD</italic> standard deviation.</p><p><sup>a</sup>Both ventilator inflations and spontaneous breaths from the manual and <italic>Ventiliser</italic> annotations were used for the calculations. Spontaneous breaths were defined as a pressure flow correlation ≤0 and ventilator inflations as pressure flow correlations &gt;0.</p><p><sup>b</sup>Only ventilator inflations from the manual and <italic>Ventiliser</italic> annotations were used for the calculations. Spontaneous breaths were defined as a pressure flow correlation ≤0 and ventilator inflations as pressure flow correlations &gt;0.</p></table-wrap-foot></table-wrap></p>
    </sec>
    <sec id="Sec11">
      <title>Reconstruction and in-depth analysis of ventilator waveforms and loops</title>
      <p id="Par28">To demonstrate the utility of <italic>Ventiliser</italic>, we present analysis of a 39-hour-long ventilator recording obtained from a term infant ventilated using AC-VG mode. The respiratory parameters calculated and displayed by the ventilator (i.e. respiratory rate, tidal volume, peak inspiratory pressure) are shown in data-rich time series plots (Fig. <xref rid="Fig3" ref-type="fig">3a–c</xref>). From the 14,044,274 pressure and flow data points, <italic>Ventiliser</italic> identified 143,260 respiratory cycles: 128,663 ventilator inflations (mean: 55/min) and 14,597 unsupported spontaneous breaths. As the actual ventilator rate was between 60 and 65/min over the whole recording (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>), <italic>Ventiliser</italic> detected ~85–90% of ventilator inflations overall. We further analysed two 1-h periods of the recording in more detail (Table <xref rid="Tab5" ref-type="table">5</xref>). During period 1, the baby had some breathing effort, but the majority of inflations were initiated by the ventilator as the high backup rate allowed only a short time window for the baby to trigger inflations by generating inspiratory (positive) flow. During period 2, stronger breathing effort appeared, there were more synchronised inflations and some unsupported spontaneous breaths also appeared. Moreover, during period 2 ventilator waveforms and loops became more variable and irregular (Fig. <xref rid="Fig4" ref-type="fig">4</xref>). Identification of individual inflations by <italic>Ventiliser</italic> makes it possible to visualise any single inflation (Supplemental Figs. <xref rid="MOESM1" ref-type="media">S5</xref> and <xref rid="MOESM1" ref-type="media">S6</xref> (online)). Segmentation of inflations into sub-phases allows for quantitative analysis of these sub-phases over the period (Table <xref rid="Tab5" ref-type="table">5</xref>). For example, we have found that the actual pressure rise time (PRT) was on average longer than the set value (80 ms). During period 2, the median time spent with the pressure at the PIP level was significantly shorter and the pressure drop to PEEP level and lung deflation time were also significantly shorter. In accordance with this, during period 1 a larger number of inflations had an inspiratory hold (pressure at the PIP level with no air flow). Also, during period 1 more inflations had no expiratory hold, that is, the next inflation started immediately after deflation of the lung.<fig id="Fig3"><label>Fig. 3</label><caption><title>Reconstruction of ventilator trends from ventilator parameter data downloaded with 1 Hz sampling rate.</title><p>Data were downloaded from a term infant ventilated for respiratory distress. The infant was ventilated with assist-control ventilation using volume guarantee (AC-VG). <bold>a</bold>–<bold>c</bold> Time series plots of ventilator rate (<bold>a</bold>), pressures (<bold>b</bold>) and tidal volume (<bold>c</bold>). After the first 4 h, the baby triggered more ventilator inflations (RRmand) than the ventilator backup rate (RRset). A few spontaneous breaths (RRspon) also appeared. These were ones that did not reach the trigger threshold (0.2 L/min) or fell to the refractory period of 0.12 s after a previous inflation (<bold>a</bold>). As this was VG ventilation, the peak inflating pressure (PIP) shows large short-term variability, particularly when spontaneous breathing effort appeared (<bold>b</bold>). The leak-compensated expired tidal volume (VTmand) also shows significant short-term variability and deviations from its target (VTset) when the infant was breathing, with tidal volumes &lt;2 and &gt;10 mL/kg occurring frequently (<bold>c</bold>). Dashed lines and numbers show the two time periods studied in more detail.</p></caption><graphic xlink:href="41390_2020_1301_Fig3_HTML" id="d32e1738"/></fig><table-wrap id="Tab5"><label>Table 5</label><caption><p>Characterisation of ventilation inflations in a 39-h-long recording and in two 1-h periods.</p></caption><table frame="hsides" rules="groups"><thead><tr><th/><th>Whole recording</th><th>Period 1 22:00–23:00</th><th>Period 2 17:00–18:00</th></tr></thead><tbody><tr><td><italic>Duration (h)</italic></td><td>39.2</td><td>1</td><td>1</td></tr><tr><td>Ventilator settings</td><td/><td/><td/></tr><tr><td>Ventilator mode</td><td>AC-VG</td><td>AC-VG</td><td>AC-VG</td></tr><tr><td>Set respiratory rate (1/min)</td><td>60</td><td>60</td><td>60</td></tr><tr><td>Inspiratory time (ms)</td><td>400</td><td>400</td><td>400</td></tr><tr><td>Pressure rise time (ms)</td><td>80</td><td>80</td><td>80</td></tr><tr><td><italic>Statistics returned by Ventiliser</italic></td><td/><td/><td/></tr><tr><td><italic>Number of respiratory cycles</italic></td><td/><td/><td/></tr><tr><td>All cycles (<italic>n</italic>)</td><td>143,260</td><td>3622</td><td>3902</td></tr><tr><td>Synchronised inflations (<italic>n</italic>, %)</td><td>55,696 (39%)</td><td>1496 (41%)</td><td>1709 (44%)</td></tr><tr><td>Backup inflations (<italic>n</italic>, %)</td><td>72,967 (51%)</td><td>2126 (59%)</td><td>1590 (41%)</td></tr><tr><td>Spontaneous breaths (<italic>n</italic>, %)</td><td>14,597 (10%)</td><td>0 (0%)</td><td>603 (15%)</td></tr></tbody></table><table frame="hsides" rules="groups"><thead><tr><th>Duration of inflation sub-phases<sup>a</sup></th><th>Median (5th–95th centile)</th><th>Median (5th–95th centile)</th><th>Median (5th–95th centile)</th></tr></thead><tbody><tr><td>Pressure rise time (ms)</td><td>210 (150–240)</td><td>210 (180–210)</td><td>210 (120–270)</td></tr><tr><td>PIP time* (ms)</td><td>150 (30–210)</td><td>180 (150–210)</td><td>150 (30–240)</td></tr><tr><td>Pressure drop time* (ms)</td><td>210 (120–240)</td><td>210 (210–240)</td><td>180 (30–210)</td></tr><tr><td>PEEP time (ms)</td><td>390 (150–480)</td><td>390 (360–420)</td><td>390 (90–480)</td></tr><tr><td>Lung inflation time (ms)</td><td>360 (270–420)</td><td>330 (300–390)</td><td>360 (210–450)</td></tr><tr><td>Total inspiratory time (ms)</td><td>360 (270–420)</td><td>360 (300–390)</td><td>360 (210–450)</td></tr><tr><td>Lung deflation time* (ms)</td><td>600 (360–690)</td><td>630 (540–690)</td><td>510 (300–660)</td></tr><tr><td>Total expiratory time (ms)</td><td>630 (360–720)</td><td>630 (600–690)</td><td>600 (300–720)</td></tr><tr><td><italic>Occurrence and duration of inspiratory hold and expiratory hold</italic></td><td/><td/><td/></tr><tr><td>Number of inflations with inspiratory hold** (<italic>n</italic>, %)</td><td>19,117 (15%)</td><td>1783 (49%)</td><td>613 (19%)</td></tr><tr><td>Inspiratory hold duration (ms)</td><td>30 (30–120)</td><td>30 (30–90)</td><td>60 (30–150)</td></tr><tr><td>Number of inflations with expiratory hold** (<italic>n</italic>, %)</td><td>49,435 (38%)</td><td>1014 (28%)</td><td>1634 (50%)</td></tr><tr><td>Expiratory hold duration (ms)</td><td>60 (30–210)</td><td>60 (30–120)</td><td>90 (30–220)</td></tr></tbody></table><table-wrap-foot><p>Periods are the same as on the graph of Fig. <xref rid="Fig2" ref-type="fig">2</xref>. The respiratory rate increased, and more synchronised inflations appeared during period 2 when stronger spontaneous breathing effort was present.</p><p>AC-VG assist-control ventilation with volume guarantee, also known as synchronised intermittent positive pressure ventilation with volume guarantee (SIPPV-VG).</p><p><sup>a</sup>Only ventilator inflations (synchronised and backup) are included. Spontaneous breaths have been excluded as their timing is not controlled by the ventilator. Inflation sub-phases are defined in Tables <xref rid="Tab1" ref-type="table">1</xref> and <xref rid="Tab2" ref-type="table">2</xref>.</p><p>*<italic>p</italic> &lt; 0.0001 using Mann–Whitney <italic>U</italic> test, when comparing periods 1 and 2; **<italic>p</italic> &lt; 0.0001 using Chi-squared test, when comparing periods 1 and 2.</p></table-wrap-foot></table-wrap><fig id="Fig4"><label>Fig. 4</label><caption><title>Reconstruction of ventilator loops and waveforms from downloaded ventilator flow and pressure data sampled at 100 Hz.</title><p>Composite pressure–volume loops over two 1-h periods. Each data point represents a single pressure–volume data pair. <bold>a</bold>, <bold>b</bold>. During period 1, regular pressure–volume loops are produced with little variability both for synchronised and for backup inflations. <bold>c</bold>, <bold>d</bold> With stronger breathing effort of the baby (period 2), the waveforms become more irregular, and there are more synchronised inflations requiring lower inflating pressures.</p></caption><graphic xlink:href="41390_2020_1301_Fig4_HTML" id="d32e2162"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec12" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par29">In this paper, we describe a computer program (<italic>Ventiliser</italic>) that identifies and characterises individual inflations from airway pressure and flow data downloaded from neonatal ventilators. We developed and tested the software with raw data obtained from the Dräger Babylog VN500 ventilator; however, as the input to our programs is platform agnostic, requiring only flow and pressure data in a tabular data format and obtained at a high sampling rate, <italic>Ventiliser</italic> can be used with any neonatal ventilator from which flow and pressure data can be downloaded at high sampling rate. We have also successfully used <italic>Ventiliser</italic> on data obtained with a 125-Hz sampling rate from the fabian +ncpap (Vyaire) neonatal ventilator (Belteki et al. unpublished observations). GUI can also be used with flow and pressure data downloaded from any ventilator.</p>
    <p id="Par30"><italic>Ventiliser</italic> uses Python, a popular computer language and its freely available data science libraries, allowing us to make it freely available to clinicians and researchers. The use of Python also enables the possibility for interfacing with existing open source platforms such as ventMap<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and installation on devices such as the RaspberryPi to enable real-time distributed processing and data collection at the bedside.</p>
    <p id="Par31">We used a rule-based rather than a machine learning algorithm. Machine learning models frequently perform better when tested on new data not seen during algorithm development.<sup><xref ref-type="bibr" rid="CR19">19</xref></sup> However, supervised machine learning methods require a training data set that can only be produced via manual annotation by domain experts. As ventilator data are complex and noisy due to ventilator–patient interactions, thousands of inflations would need to be manually annotated by clinicians having significant expertise in neonatal ventilation. Moreover, our program correctly identified &gt;97% of inflations and their sub-phases in three short samples, which were not used during algorithm development. In any case, <italic>Ventiliser</italic> can be used for benchmarking segmentation algorithms developed in the future and the GUI can be used for producing a manually annotated training data set.</p>
    <p id="Par32">Existing software solutions for ventilation waveform analysis have used adult ventilator data and primarily focused on detection of specific adverse ventilator–patient interactions (such as double triggering or ineffective respiratory efforts) via a rule-based algorithm,<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> Hidden Markov model<sup><xref ref-type="bibr" rid="CR11">11</xref></sup> or machine learning.<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> Furthermore, most of them are not freely available<sup><xref ref-type="bibr" rid="CR11">11</xref>,<xref ref-type="bibr" rid="CR12">12</xref></sup> or may be tied to specific ventilator platforms.<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> None of these methods has been validated in neonates. The physiology of adult and neonatal ventilation is significantly different: neonates are usually intubated with un-cuffed endotracheal tubes and have some leak around the tube, can breathe during ventilation, the ventilator modes and settings used are different from those used in adults and ventilator–patient interactions are also different.</p>
    <p id="Par33">Recently, BreathMetrics,<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> a program written in Matlab programming language, sought to address the issue of providing a flexible but standard way to perform basic processing and analysis of respiratory waveforms. However, it was developed for the purpose of analysing spontaneous breathing in mice and adult humans from nasal respiration data. Moreover, the program does not use airway pressure, only air flow, and the Matlab software is not freely available.</p>
    <p id="Par34">Our out-of-sample validation on manually annotated samples shows that <italic>Ventiliser</italic> is able to identify the inflation key points (boundaries between sub-phases) with good accuracy. The length of each sub-phase is determined by the interval between key points, and hence the error from the prediction of key points is summed when identifying sub-phase lengths as seen in Table <xref rid="Tab4" ref-type="table">4</xref>. The expiration termination and expiratory hold sub-phases had considerable deviation from manual annotation (&gt;50 ms in some cases). This probably reflects the more variable nature of the expiratory phase in infants with spontaneous breathing effort, which means trying to fit them to an ideal expiration is more challenging.</p>
    <p id="Par35">The PRT (also known as slope time) calculated by <italic>Ventiliser</italic> was significantly longer than the one set by the clinician. We cannot tell if our algorithm overestimates the PRT or if the actual PRT is longer than the set value due to patient–ventilator interactions or other factors. In the manually annotated samples, the PRTs returned by <italic>Ventiliser</italic> were close to the manually identified values, which were also longer than the set slope time (80 ms); however, these were only short samples. The clinical significance of different PRTs in neonatal ventilation is uncertain.<sup><xref ref-type="bibr" rid="CR20">20</xref></sup></p>
    <p id="Par36">We have also found that a significant proportion of ventilator inflations during AC-VG ventilation contain periods of inspiratory hold or contains no expiratory hold, the occurrence and significance of which in neonates are not known as there are few studies analysing short periods.<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>
<italic>Ventiliser</italic> allows for quantitative analysis of inflations over long periods and will facilitate such studies in future.</p>
    <p id="Par37">In summary, we have developed a program to automatically identify and analyse ventilation inflations from neonatal ventilator data. Our software can be used in future studies to analyse ventilation patterns and ventilator–patient interaction over longer periods (hours or days) of mechanical ventilation.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec13">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41390_2020_1301_MOESM1_ESM.docx">
            <caption>
              <p>Supplemental Tables Figures</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41390_2020_1301_MOESM2_ESM.xlsx">
            <caption>
              <p>Supplemental Table S1</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version of this article (10.1038/s41390-020-01301-9) contains supplementary material, which is available to authorized users.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>We would like to thank Thomas Krüger, Kreske Brunckhorst and the engineers of Dräger Medical for their advice and the program exporting data from the ventilator; Dr. Amanda Ogilvy-Stuart for her advice and comments on the manuscript and Lee Choon Kiat for advice on algorithm implementation.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>D.C. designed the algorithms and developed the <italic>Ventiliser</italic> package, created the manual annotation for validation and contributed to the writing of the manuscript. C.J.M. helped with interpretation of results and contributed to the writing of the manuscript. G.B. conceptualised the study, collected ventilator data and analysed it using <italic>Ventiliser</italic> and contributed to the writing of the manuscript. All authors reviewed and approved the final manuscript.</p>
  </notes>
  <notes id="FPar1" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par38">The authors declare no competing interests.</p>
  </notes>
  <notes id="FPar2">
    <title>Consent</title>
    <p id="Par39">Informed consent was obtained from parents in writing.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <mixed-citation publication-type="other">Chow, S. S. W. et al. Report of the Australian and New Zealand Neonatal Network: Australian and New Zealand Neonatal Network, 2013. <ext-link ext-link-type="uri" xlink:href="https://npesu.unsw.edu.au/data-collection/australian-new-zealand-neonatal-network-anznn">https://npesu.unsw.edu.au/data-collection/australian-new-zealand-neonatal-network-anznn</ext-link> (2013).</mixed-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sinha</surname>
            <given-names>SK</given-names>
          </name>
          <name>
            <surname>Nicks</surname>
            <given-names>JJ</given-names>
          </name>
          <name>
            <surname>Donn</surname>
            <given-names>SM</given-names>
          </name>
        </person-group>
        <article-title>Graphic analysis of pulmonary mechanics in neonates receiving assisted ventilation</article-title>
        <source>Arch. Dis. Child. Fetal Neonatal Ed.</source>
        <year>1996</year>
        <volume>75</volume>
        <fpage>F213</fpage>
        <lpage>F218</lpage>
        <pub-id pub-id-type="doi">10.1136/fn.75.3.F213</pub-id>
        <pub-id pub-id-type="pmid">8976690</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mammel</surname>
            <given-names>MC</given-names>
          </name>
          <name>
            <surname>Donn</surname>
            <given-names>SM</given-names>
          </name>
        </person-group>
        <article-title>Real-time pulmonary graphics</article-title>
        <source>Semin. Fetal Neonatal Med.</source>
        <year>2015</year>
        <volume>20</volume>
        <fpage>181</fpage>
        <lpage>191</lpage>
        <pub-id pub-id-type="doi">10.1016/j.siny.2015.01.004</pub-id>
        <pub-id pub-id-type="pmid">25669725</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Epstein</surname>
            <given-names>SK</given-names>
          </name>
        </person-group>
        <article-title>How often does patient-ventilator asynchrony occur and what are the consequences?</article-title>
        <source>Respir. Care</source>
        <year>2011</year>
        <volume>56</volume>
        <fpage>25</fpage>
        <lpage>38</lpage>
        <pub-id pub-id-type="doi">10.4187/respcare.01009</pub-id>
        <pub-id pub-id-type="pmid">21235836</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Belteki</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Morley</surname>
            <given-names>CJ</given-names>
          </name>
        </person-group>
        <article-title>Frequency, duration and cause of ventilator alarms on a neonatal intensive care unit</article-title>
        <source>Arch. Dis. Child Fetal Neonatal Ed.</source>
        <year>2018</year>
        <volume>103</volume>
        <fpage>F307</fpage>
        <lpage>F311</lpage>
        <pub-id pub-id-type="doi">10.1136/archdischild-2017-313493</pub-id>
        <pub-id pub-id-type="pmid">29079651</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Szakmar</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Morley</surname>
            <given-names>CJ</given-names>
          </name>
          <name>
            <surname>Belteki</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Leak compensation during volume guarantee with the Dräger Babylog VN500 neonatal ventilator</article-title>
        <source>Pediatr. Crit. Care Med.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>861</fpage>
        <lpage>868</lpage>
        <pub-id pub-id-type="doi">10.1097/PCC.0000000000001638</pub-id>
        <pub-id pub-id-type="pmid">29933287</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Belteki</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Volume-targeted ventilation with a Fabian ventilator: maintenance of tidal volumes and blood CO<sub>2</sub></article-title>
        <source>Arch. Dis. Child. Fetal Neonatal Ed.</source>
        <year>2020</year>
        <volume>105</volume>
        <fpage>253</fpage>
        <lpage>258</lpage>
        <pub-id pub-id-type="doi">10.1136/archdischild-2019-317152</pub-id>
        <pub-id pub-id-type="pmid">31285225</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Farrell</surname>
            <given-names>O</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Volume guaranteed? Accuracy of a volume-targeted ventilation mode in infants</article-title>
        <source>Arch. Dis. Child. Fetal Neonatal Ed.</source>
        <year>2018</year>
        <volume>103</volume>
        <fpage>F120</fpage>
        <lpage>F125</lpage>
        <pub-id pub-id-type="doi">10.1136/archdischild-2017-312640</pub-id>
        <pub-id pub-id-type="pmid">28659362</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wong</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Tepper</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Sokol</surname>
            <given-names>GM</given-names>
          </name>
          <name>
            <surname>Rose</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Expired tidal volume variation in extremely low birth weight and very low birth weight infants on volume-targeted ventilation</article-title>
        <source>J. Pediatr.</source>
        <year>2019</year>
        <volume>207</volume>
        <fpage>248.e1</fpage>
        <lpage>251.e1</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jpeds.2018.12.053</pub-id>
        <pub-id pub-id-type="pmid">30770195</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Adams</surname>
            <given-names>JY</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Development and validation of a multi-algorithm analytic platform to detect off-target mechanical ventilation</article-title>
        <source>Sci. Rep.</source>
        <year>2017</year>
        <volume>7</volume>
        <fpage>14980</fpage>
        <pub-id pub-id-type="doi">10.1038/s41598-017-15052-x</pub-id>
        <pub-id pub-id-type="pmid">29101346</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Marchuk</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Predicting patient-ventilator asynchronies with hidden Markov models</article-title>
        <source>Sci. Rep.</source>
        <year>2018</year>
        <volume>8</volume>
        <fpage>17614</fpage>
        <pub-id pub-id-type="doi">10.1038/s41598-018-36011-0</pub-id>
        <pub-id pub-id-type="pmid">30514876</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gholami</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Replicating human expertise of mechanical ventilation waveform analysis in detecting patient-ventilator cycling asynchrony using machine learning</article-title>
        <source>Comput. Biol. Med.</source>
        <year>2018</year>
        <volume>97</volume>
        <fpage>137</fpage>
        <lpage>144</lpage>
        <pub-id pub-id-type="doi">10.1016/j.compbiomed.2018.04.016</pub-id>
        <pub-id pub-id-type="pmid">29729488</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Noto</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Schuele</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Templer</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zelano</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Automated analysis of breathing waveforms using BreathMetrics: a respiratory signal processing toolbox</article-title>
        <source>Chem. Senses</source>
        <year>2018</year>
        <volume>43</volume>
        <fpage>583</fpage>
        <lpage>597</lpage>
        <pub-id pub-id-type="doi">10.1093/chemse/bjy045</pub-id>
        <pub-id pub-id-type="pmid">29985980</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mulqueeny</surname>
            <given-names>Q</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Automatic detection of ineffective triggering and double triggering during mechanical ventilation</article-title>
        <source>Intensive Care Med.</source>
        <year>2007</year>
        <volume>33</volume>
        <fpage>2014</fpage>
        <lpage>2018</lpage>
        <pub-id pub-id-type="doi">10.1007/s00134-007-0767-z</pub-id>
        <pub-id pub-id-type="pmid">17611736</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Younes</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A method for monitoring and improving patient: ventilator interaction</article-title>
        <source>Intensive Care Med.</source>
        <year>2007</year>
        <volume>33</volume>
        <fpage>1337</fpage>
        <lpage>1346</lpage>
        <pub-id pub-id-type="doi">10.1007/s00134-007-0681-4</pub-id>
        <pub-id pub-id-type="pmid">17541554</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sinderby</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>An automated and standardized neural index to quantify patient-ventilator interaction</article-title>
        <source>Crit. Care</source>
        <year>2013</year>
        <volume>17</volume>
        <fpage>R239</fpage>
        <pub-id pub-id-type="doi">10.1186/cc13063</pub-id>
        <pub-id pub-id-type="pmid">24131701</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gutierrez</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Automatic detection of patient-ventilator asynchrony by spectral analysis of airway flow</article-title>
        <source>Crit. Care</source>
        <year>2011</year>
        <volume>15</volume>
        <fpage>R167</fpage>
        <pub-id pub-id-type="doi">10.1186/cc10309</pub-id>
        <pub-id pub-id-type="pmid">21749683</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <mixed-citation publication-type="other">Stocks, J., Sly, P., Tepper, S. &amp; Morgan, W. <italic>Infant Respiratory Function Testing</italic> (Wiley, New York, 1996).</mixed-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Prosperi</surname>
            <given-names>MC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Investigation of expert rule bases, logistic regression, and non-linear machine learning techniques for predicting response to antiretroviral treatment</article-title>
        <source>Antivir. Ther.</source>
        <year>2009</year>
        <volume>14</volume>
        <fpage>433</fpage>
        <lpage>442</lpage>
        <?supplied-pmid 19474477?>
        <pub-id pub-id-type="pmid">19474477</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chong</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Kayser</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Szakmar</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Morley</surname>
            <given-names>CJ</given-names>
          </name>
          <name>
            <surname>Belteki</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Effect of pressure rise time on ventilator parameters and gas exchange during neonatal ventilation</article-title>
        <source>Pediatr. Pulmonol.</source>
        <year>2020</year>
        <volume>55</volume>
        <fpage>1131</fpage>
        <lpage>1138</lpage>
        <pub-id pub-id-type="doi">10.1002/ppul.24724</pub-id>
        <pub-id pub-id-type="pmid">32150670</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Napolitano</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identifying and treating intrinsic PEEP in infants with severe bronchopulmonary dysplasia</article-title>
        <source>Pediatr. Pulmonol.</source>
        <year>2019</year>
        <volume>54</volume>
        <fpage>1045</fpage>
        <lpage>1051</lpage>
        <pub-id pub-id-type="doi">10.1002/ppul.24328</pub-id>
        <pub-id pub-id-type="pmid">30950245</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
