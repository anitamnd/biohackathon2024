<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinform Adv</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinform Adv</journal-id>
    <journal-id journal-id-type="publisher-id">bioadv</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics Advances</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2635-0041</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9853317</article-id>
    <article-id pub-id-type="doi">10.1093/bioadv/vbad003</article-id>
    <article-id pub-id-type="publisher-id">vbad003</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Application Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scMEGA: single-cell multi-omic enhancer-based gene regulatory network inference</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Zhijian</given-names>
        </name>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Conceptualization" vocab-term-identifier="http://credit.niso.org/contributor-roles/conceptualization/" degree-contribution="lead">Conceptualization</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Data curation" vocab-term-identifier="http://credit.niso.org/contributor-roles/data-curation/" degree-contribution="equal">Data curation</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Formal analysis" vocab-term-identifier="http://credit.niso.org/contributor-roles/formal-analysis/" degree-contribution="equal">Formal analysis</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Methodology" vocab-term-identifier="http://credit.niso.org/contributor-roles/methodology/" degree-contribution="equal">Methodology</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Resources" vocab-term-identifier="http://credit.niso.org/contributor-roles/resources/" degree-contribution="lead">Resources</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Software" vocab-term-identifier="http://credit.niso.org/contributor-roles/software/" degree-contribution="lead">Software</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – original draft" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-original-draft/" degree-contribution="equal">Writing – original draft</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – review &amp; editing" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-review-editing/" degree-contribution="equal">Writing – review &amp; editing</role>
        <aff><institution>Institute for Computational Genomics, Joint Research Center for Computational Biomedicine, RWTH Aachen University Medical School</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7655-7206</contrib-id>
        <name>
          <surname>Nagai</surname>
          <given-names>James S</given-names>
        </name>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Conceptualization" vocab-term-identifier="http://credit.niso.org/contributor-roles/conceptualization/" degree-contribution="supporting">Conceptualization</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Formal analysis" vocab-term-identifier="http://credit.niso.org/contributor-roles/formal-analysis/" degree-contribution="supporting">Formal analysis</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Software" vocab-term-identifier="http://credit.niso.org/contributor-roles/software/" degree-contribution="supporting">Software</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Visualization" vocab-term-identifier="http://credit.niso.org/contributor-roles/visualization/" degree-contribution="supporting">Visualization</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – original draft" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-original-draft/" degree-contribution="supporting">Writing – original draft</role>
        <aff><institution>Institute for Computational Genomics, Joint Research Center for Computational Biomedicine, RWTH Aachen University Medical School</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-4597-9833</contrib-id>
        <name>
          <surname>Kuppe</surname>
          <given-names>Christoph</given-names>
        </name>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Conceptualization" vocab-term-identifier="http://credit.niso.org/contributor-roles/conceptualization/" degree-contribution="supporting">Conceptualization</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Data curation" vocab-term-identifier="http://credit.niso.org/contributor-roles/data-curation/" degree-contribution="supporting">Data curation</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – original draft" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-original-draft/" degree-contribution="supporting">Writing – original draft</role>
        <aff><institution>Institute of Experimental Medicine and Systems Biology, RWTH Aachen University</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
        <aff><institution>Division of Nephrology and Clinical Immunology, RWTH Aachen University</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-4048-6351</contrib-id>
        <name>
          <surname>Kramann</surname>
          <given-names>Rafael</given-names>
        </name>
        <aff><institution>Institute of Experimental Medicine and Systems Biology, RWTH Aachen University</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
        <aff><institution>Division of Nephrology and Clinical Immunology, RWTH Aachen University</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
        <aff><institution>Department of Internal Medicine, Nephrology and Transplantation, Erasmus Medical Center</institution>, Rotterdam 3042, <country country="NL">The Netherlands</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-2890-8697</contrib-id>
        <name>
          <surname>Costa</surname>
          <given-names>Ivan G</given-names>
        </name>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Conceptualization" vocab-term-identifier="http://credit.niso.org/contributor-roles/conceptualization/" degree-contribution="equal">Conceptualization</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Funding acquisition" vocab-term-identifier="http://credit.niso.org/contributor-roles/funding-acquisition/" degree-contribution="lead">Funding acquisition</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Investigation" vocab-term-identifier="http://credit.niso.org/contributor-roles/investigation/" degree-contribution="lead">Investigation</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Methodology" vocab-term-identifier="http://credit.niso.org/contributor-roles/methodology/" degree-contribution="lead">Methodology</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Project administration" vocab-term-identifier="http://credit.niso.org/contributor-roles/project-administration/" degree-contribution="lead">Project administration</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Supervision" vocab-term-identifier="http://credit.niso.org/contributor-roles/supervision/" degree-contribution="lead">Supervision</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – original draft" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-original-draft/" degree-contribution="lead">Writing – original draft</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – review &amp; editing" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-review-editing/" degree-contribution="lead">Writing – review &amp; editing</role>
        <aff><institution>Institute for Computational Genomics, Joint Research Center for Computational Biomedicine, RWTH Aachen University Medical School</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
        <xref rid="vbad003-cor1" ref-type="corresp"/>
        <!--ivan.costa@rwth-aachen.de-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Kuijjer</surname>
          <given-names>Marieke Lydia</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="vbad003-cor1">To whom correspondence should be addressed. <email>ivan.costa@rwth-aachen.de</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-01-12">
      <day>12</day>
      <month>1</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>12</day>
      <month>1</month>
      <year>2023</year>
    </pub-date>
    <volume>3</volume>
    <issue>1</issue>
    <elocation-id>vbad003</elocation-id>
    <history>
      <date date-type="received">
        <day>18</day>
        <month>10</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>08</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>05</day>
        <month>1</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>11</day>
        <month>1</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>20</day>
        <month>1</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="vbad003.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>The increasing availability of single-cell multi-omics data allows to quantitatively characterize gene regulation. We here describe scMEGA (Single-cell Multiomic Enhancer-based Gene Regulatory Network Inference) that enables an end-to-end analysis of multi-omics data for gene regulatory network inference including modalities integration, trajectory analysis, enhancer-to-promoter association, network analysis and visualization. This enables to study the complex gene regulation mechanisms for dynamic biological processes, such as cellular differentiation and disease-driven cellular remodeling. We provide a case study on gene regulatory networks controlling myofibroblast activation in human myocardial infarction.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p>scMEGA is implemented in R, released under the MIT license and available from <ext-link xlink:href="https://github.com/CostaLab/scMEGA" ext-link-type="uri">https://github.com/CostaLab/scMEGA</ext-link>. Tutorials are available from <ext-link xlink:href="https://costalab.github.io/scMEGA" ext-link-type="uri">https://costalab.github.io/scMEGA</ext-link>.</p>
      </sec>
      <sec id="s4">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics Advances</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>German Research Foundation</institution>
            <institution-id institution-id-type="DOI">10.13039/501100001659</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>German Ministry of Education and Science</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="4"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Single-cell RNA sequencing (scRNA-seq) and ATAC-seq (scATAC-seq) techniques provide an unprecedented opportunity to understand gene regulation at the single-cell level by capturing orthogonal molecular information (<xref rid="vbad003-B15" ref-type="bibr">Li <italic toggle="yes">et al.</italic>, 2021</xref>; <xref rid="vbad003-B22" ref-type="bibr">Zhu <italic toggle="yes">et al.</italic>, 2020</xref>). Applying both assays on the same biological samples generates single-cell multi-omics data, which allow to computationally infer gene regulatory networks (GRNs) for different cellular systems, such as fly brain development (<xref rid="vbad003-B7" ref-type="bibr">Janssens <italic toggle="yes">et al.</italic>, 2022</xref>) and human myocardial infarction (<xref rid="vbad003-B13" ref-type="bibr">Kuppe <italic toggle="yes">et al.</italic>, 2022</xref>).</p>
    <p>However, such analysis is usually based on complex bioinformatic pipelines that require different tools for each of the steps, such as Seurat for scRNA-seq analysis and data integration (<xref rid="vbad003-B20" ref-type="bibr">Stuart <italic toggle="yes">et al.</italic>, 2019</xref>), ArchR for scATAC-seq analysis and trajectory inference (<xref rid="vbad003-B6" ref-type="bibr">Granja <italic toggle="yes">et al.</italic>, 2021</xref>), chromVAR for TF activity estimation (<xref rid="vbad003-B19" ref-type="bibr">Schep <italic toggle="yes">et al.</italic>, 2017</xref>) and igraph (<xref rid="vbad003-B2" ref-type="bibr">Csardi and Nepusz, 2006</xref>) for network analysis. Currently, three computational tools (Pando, <xref rid="vbad003-B3" ref-type="bibr">Fleck <italic toggle="yes">et al.</italic>, 2022</xref>; CellOracle <xref rid="vbad003-B8" ref-type="bibr">Kamimoto <italic toggle="yes">et al.</italic>, 2020</xref>; FigR <xref rid="vbad003-B9" ref-type="bibr">Kartha <italic toggle="yes">et al.</italic>, 2022</xref>) are available for GRN inference based on single-cell multi-omics profiles. Pando focuses on the identification of regulatory networks limited to TF-TF interaction and does not provide methods for modality integration or trajectory analysis. CellOracle performs analysis of ATAC-seq and RNA-seq data independently. It cannot, therefore, explore gene expression for the delineation of gene-to-peak enhancer links and does not consider TF activity scores at a single-cell level to select relevant transcription factors. FigR, which includes modules for multimodal data integration, peak-to-gene link prediction and trajectory inference, is one of the most comprehensive methods so far. However, it does not support direct operation on Seurat objects and offers few functionalities to explore information from the GRNs.</p>
    <p>We here developed scMEGA as a general framework to quantitatively infer enhancer-based GRN by taking single-cell multi-omics profiles as input. scMEGA, which builds upon expertise on the analysis of multimodal single-cell data of myocardial infarction (<xref rid="vbad003-B13" ref-type="bibr">Kuppe <italic toggle="yes">et al.</italic>, 2022</xref>), enables an end-to-end analysis of multi-omics data for GRN inference including modalities integration, trajectory analysis, enhancer-to-promoter association, network analysis and visualization (<xref rid="vbad003-F1" ref-type="fig">Fig. 1</xref>). For this, it provides new functionalities and combines some existing methods from Seurat, ArchR, chromVAR and igraph. It is implemented as an R package and is compatible with the Seurat ecosystem.</p>
    <fig position="float" id="vbad003-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>Overview of scMEGA. (<bold>a</bold>) First, scMEGA integrates the single-cell multi-omics profiles to obtain a paired dataset through modality integration built on the R package Seurat and cell pairing built on the approach OptMatch. (<bold>b</bold>) Next, scMEGA infers a pseudotime trajectory to characterize the underlying dynamic process of a given cell type using ArchR. (<bold>c</bold>) It then filters TFs, which are selected based on correlation analysis between binding activity (chromVAR) and expression along the trajectory, and genes, which are selected based on correlation analysis between peak accessibility and gene expression along the trajectory. (<bold>d</bold>) Based on the selected TFs and genes, scMEGA generates a quantitative GRN by estimating the correlation of selected TF and gene expression. (<bold>e</bold>) scMEGA uses enhancer-to-gene links and motif matching to find enhancer-based TF-to-gene interactions. These are used to filter the previously defined quantitative GRN as shown in (d)</p>
      </caption>
      <graphic xlink:href="vbad003f1" position="float"/>
    </fig>
  </sec>
  <sec>
    <title>2 Methods</title>
    <p>There are three major steps in scMEGA namely, (i) multimodal data integration, (ii) identification and filtering of candidate TFs and genes and (iii) GRN assembly and analysis.</p>
    <sec>
      <title>2.1 Single-cell multimodal data integration</title>
      <p>To build the GRNs, it is crucial to have a mapping between cells at distinct modalities (RNA and ATAC), so that one can find associations between the expression of TF/genes and the activity and accessibility of genes/TFs at the single-cell level. For this, scMEGA first projects the cells into a shared co-embedding space by using the canonical correlation analysis (CCA) implemented by Seurat (<xref rid="vbad003-B20" ref-type="bibr">Stuart <italic toggle="yes">et al.</italic>, 2019</xref>). Here, features are gene expression from scRNA-seq and gene activity scores from scATAC-seq data. In case of batch effects are present, the method Harmony (<xref rid="vbad003-B10" ref-type="bibr">Korsunsky <italic toggle="yes">et al.</italic>, 2019</xref>) can be applied for batch correction. Next, scMEGA performs cell pairing to obtain one-to-one matching between scRNA-seq and scATAC-seq using OptMatch pairing (<xref rid="vbad003-B9" ref-type="bibr">Kartha <italic toggle="yes">et al.</italic>, 2022</xref>). Altogether, these steps build a pseudo-multimodal dataset and a low dimensional representation of the data (<xref rid="vbad003-F1" ref-type="fig">Fig. 1a</xref>). In the case of single-cell multimodal data with paired cells [e.g. SHARE-seq (<xref rid="vbad003-B17" ref-type="bibr">Ma <italic toggle="yes">et al.</italic>, 2020</xref>) and 10× Multiome], this integration step can be skipped. Here, users only need to create a joint embedding of cells by using for example the CCA integration from MOJITOO (<xref rid="vbad003-B1" ref-type="bibr">Cheng <italic toggle="yes">et al.</italic>, 2022</xref>).</p>
    </sec>
    <sec>
      <title>2.2 Identification of candidate TFs and genes</title>
      <p>scMEGA next identifies candidate TFs and genes based on both multimodal or pseudo-multimodal data from the previous step. First, for the given cells of interest, a pseudotime trajectory characterizing the underlying dynamic process is inferred by using the supervised approach as implemented by the R package ArchR (<xref rid="vbad003-B6" ref-type="bibr">Granja <italic toggle="yes">et al.</italic>, 2021</xref>) (<xref rid="vbad003-F1" ref-type="fig">Fig. 1b</xref>). Here, the user needs to indicate root and terminal cells, i.e. by their characterization via marker genes.</p>
      <p>Then, scMEGA estimates binding activity for each TF in each cell based on chromatin accessibility profiles (<xref rid="vbad003-F1" ref-type="fig">Fig. 1c</xref>). To identify active TFs, scMEGA calculates the correlation between TF binding activity (estimated with chromVAR; <xref rid="vbad003-B19" ref-type="bibr">Schep <italic toggle="yes">et al.</italic>, 2017</xref>) and TF expression. A high correlation indicates that the TF is both highly expressed and the motif is more accessible than the average profiles (<xref rid="vbad003-B7" ref-type="bibr">Janssens <italic toggle="yes">et al.</italic>, 2022</xref>). This step is crucial, as TF-binding activity alone cannot differentiate between TFs of the same family sharing similar motifs. Next, scMEGA computes the expression variation of each gene along the pseudotime trajectory and picks up the top 10% (this cutoff can be adjusted by the user) most variable genes as trajectory-relevant genes. scMEGA next associates the selected genes to peaks based on the correlation of gene expression and peak accessibility at the single-cell level using functions from ArchR (<xref rid="vbad003-B6" ref-type="bibr">Granja <italic toggle="yes">et al.</italic>, 2021</xref>). Among other features, scMEGA provides functions to allow to directly operate Seurat objects.</p>
    </sec>
    <sec>
      <title>2.3 GRN construction and visualization</title>
      <p>Next, scMEGA builds a quantitative GRN by estimating the correlation of binding activity of all the selected TFs and expression of all the selected genes as described above (<xref rid="vbad003-F1" ref-type="fig">Fig. 1d</xref>). To link a TF to its target gene, scMEGA first subsets the predicted peak-to-gene links to obtain enhancer-to-gene links where the enhancers are defined as peaks that are at least 2k base pairs (bp) from the transcription start site of a gene (<xref rid="vbad003-F1" ref-type="fig">Fig. 1e</xref>). It then considers the TF-binding sites as predicted by chromVAR. A gene is only considered the target of a TF if this gene is associated with at least one enhancer and this TF is bound to one of the associated enhancers, which creates an enhancer-based GRN. By combining the quantitative GRN and the enhancer-based GRN, i.e. we only consider TF–gene regulations in both networks, scMEGA produces a final enhancer-based GRN (eGRN). TF–gene interactions are weighted by their correlation.</p>
      <p>The directed (from TF to gene) and weighted (as measured by the correlation) GRNs are modeled as a graph by the R package igraph (<xref rid="vbad003-B2" ref-type="bibr">Csardi and Nepusz, 2006</xref>). scMEGA provides eGRN visualization by exploring layout algorithms, such as Fruchterman–Reingold. This layout allows finding major regulatory modules by plotting TFs sharing similar target genes together. Alternatively, users can use the focus layout, which allows for the centralization of the network regarding certain relevant genes/TF. scMEGA also explores network statistics to depict important TFs by computing the page-rank index (<xref rid="vbad003-B18" ref-type="bibr">Page <italic toggle="yes">et al.</italic>, 1999</xref>) or betweenness score (<xref rid="vbad003-B4" ref-type="bibr">Freeman, 1978</xref>) for all TFs or targets. Betweenness scores find regulators (TFs), which bridge distinct modules of the GRN (<xref rid="vbad003-B21" ref-type="bibr">Zaoli <italic toggle="yes">et al.</italic>, 2021</xref>). The page rank detects important TFs, TFs regulating directly or indirectly other genes (<xref rid="vbad003-B5" ref-type="bibr">Ghoshal and Barabási, 2011</xref>). scMEGA allows for visualization of the gene expression of targets of TFs to understand the regulation activity in spatial coordinates.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 Benchmarking the robustness of scMEGA</title>
      <p>The integration of multimodal single-cell data is an important step of scMEGA for unpaired single-cell data. To test the impact of this step, we obtained single-cell multimodal data generated by using 10× Multiome protocol from human healthy peripheral blood mononuclear cells. We recovered 10 504 cells and identified fourteen cell types (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 1a</xref>). Next, we integrated the data and performed cell pairing. We observed that only a few true pairs were correctly recovered (<italic toggle="yes">n</italic> = 41), indicating that cell matching is indeed a difficult task at the single-cell level. However, most of the cells were matched with the correct cell types (71.8%) and mismatching generally represented similar sub-populations, such as non-classical and intermediate monocytes (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 1b</xref>). These numbers are competitive with a recent benchmarking study (<xref rid="vbad003-B14" ref-type="bibr">Lance <italic toggle="yes">et al.</italic>, 2022</xref>). We next predicted eGRN for CD4 T cells using the true or predicted pairs between scRNA-seq and scATAC-seq data (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 1c</xref>). Indeed, more than 75% TFs, 83% genes and 60% TF–gene regulations inferred from OptMatch predicted pairs were also supported by the true pairs, indicating that most interactions could be recovered by scMEGA (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 1d–f</xref>).</p>
    </sec>
    <sec>
      <title>3.2 Case study on myocardial infarction</title>
      <p>We here provide a case study using scMEGA to infer a GRN to study fibrogenesis in human hearts after myocardial infarction (<xref rid="vbad003-B13" ref-type="bibr">Kuppe <italic toggle="yes">et al.</italic>, 2022</xref>). We integrated the snRNA-seq and snATAC-seq data and identified four sub-populations of fibroblasts (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 2a</xref>). Detection of marker genes indicated that cluster 2 highly expressed <italic toggle="yes">SCARA5</italic> which was recently reported as a marker for myofibroblast progenitors in the human kidney (<xref rid="vbad003-B12" ref-type="bibr">Kuppe <italic toggle="yes">et al.</italic>, 2021</xref>) (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 2b</xref>). Cluster 1 was marked by <italic toggle="yes">POSTN</italic>, <italic toggle="yes">COL1A1</italic> and <italic toggle="yes">COL3A1</italic>, suggesting that these cells are differentiated myofibroblasts. Based on these, we built a pseudotime trajectory from cluster 2 to cluster 1 to study the myofibroblasts differentiation process (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 2c</xref>).</p>
      <p>Next, we selected 79 candidate TFs and 2207 genes as input for inferring GRN (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 2d and e</xref>). Correlation between the binding activity of the TFs and expression of the genes revealed two major regulation modules with each one corresponding to a distinct fibroblast sub-cluster (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 2f</xref>). For example, we identified NR3C2 as a regulator of the <italic toggle="yes">SCARA5</italic>+ fibroblasts (module 1—fibroblast progenitors) with a decreased binding activity, TF expression and target gene expression along the trajectory (<xref rid="vbad003-F2" ref-type="fig">Fig. 2b</xref>). Regarding the myofibroblasts, we detected several fibrosis-relevant TFs as TEAD (<xref rid="vbad003-B16" ref-type="bibr">Liu <italic toggle="yes">et al.</italic>, 2017</xref>) and RUNX family genes. Of note, we have recently characterized the role of RUNX1 as playing an essential role in kidney (<xref rid="vbad003-B15" ref-type="bibr">Li <italic toggle="yes">et al.</italic>, 2021</xref>) and heart (<xref rid="vbad003-B13" ref-type="bibr">Kuppe <italic toggle="yes">et al.</italic></xref>, <xref rid="vbad003-B13" ref-type="bibr">2022</xref>) fibrogenesis.</p>
      <fig position="float" id="vbad003-F2">
        <label>Fig. 2.</label>
        <caption>
          <p>Inferred GRN for myofibroblast differentiation. (<bold>a</bold>) Visualization of the inferred GRN for myofibroblasts differentiation. Each node represents a TF (regulator) or gene (target). TFs are colored by the pseudotime point at which the TF has the highest activity score as estimated by chromVAR. (<bold>b</bold>) Line plots showing the TF binding activity, TF expression and target expression along the myofibroblasts differential trajectory for NR3C2 and RUNX1. The <italic toggle="yes">x</italic>-axis represents the pseudotime points and the y-axis represents the z-score transformed values. (<bold>c</bold>) Visualization of the spatial distribution of fibroblast proportion estimated by cell2location in the ischemic zone of the human heart after myocardial infarction. (<bold>d</bold>) Left: spatial distributed gene expression of NR3C2 and RUNX1. Right: spatially distributed gene expression of all targets of NR3C2 and RUNX1</p>
        </caption>
        <graphic xlink:href="vbad003f2" position="float"/>
      </fig>
      <p>Visualization of the inferred network and regulator properties (between and page-rank scores) pinpointed RUNX1 as the factor with higher importance during myofibroblast differentiation (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 3a</xref>). A visualization of the eGRN centered around RUNX1 highlights the fact that RUNX1 is predicted to regulate many other genes including other fibrosis-related transcription factors as TEAD2 and TEAD3 (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 3b</xref>). As another example of downstream analysis allowed by eGRNs, we inspected the expression of target genes of NR3C2 and RUNX1 in space. We could not detect clear expression patterns of the TFs in space due to sparsity and low expression values of these TFs in spatial transcriptomics (<xref rid="vbad003-F2" ref-type="fig">Fig. 2c and d</xref>). By exploring the regulomes (target genes) of NR3C2 and RUNX1, we observed gradients and mutually exclusive spatial expression in defined cardiac regions of fibrotic responses, highlighting the power of scMEGA in delineating TF regulome expression in sparse spatial transcriptomics data.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Conclusion</title>
    <p>We present scMEGA to infer enhancer-based GRN using single-cell multiomics/multimodal profiles. scMEGA is built upon several R packages for single-cell data analysis. It enables users to perform end-to-end GRN inferences and to prioritize important TFs and genes for experimental validation and the use of regulomes to analyze spatial transcriptomics. We exemplify the use of scMEGA to study gene regulation of myofibroblasts activation in human hearts after myocardial infarction (<xref rid="vbad003-B13" ref-type="bibr">Kuppe <italic toggle="yes">et al.</italic>, 2022</xref>). The data set analyzed here has at least 63 000 and 20 000 cells of snRNA-seq and snATAC-seq, respectively, which demonstrates the scalability of scMEGA. In addition, the data can be generated from different platforms or protocols as batch effects will be corrected computationally using Harmony (<xref rid="vbad003-B10" ref-type="bibr">Korsunsky <italic toggle="yes">et al.</italic>, 2019</xref>). However, the trajectory analysis assumes that cells are part of a differentiation or activation process. Moreover, benchmarking of the single-cell matching problem presented here and by others (<xref rid="vbad003-B14" ref-type="bibr">Lance <italic toggle="yes">et al.</italic>, 2022</xref>) indicates that this is an extremely difficult problem. Future work includes the implementation of additional cell matching algorithms, as top-performing methods reported in (<xref rid="vbad003-B14" ref-type="bibr">Lance <italic toggle="yes">et al.</italic>, 2022</xref>). Altogether, we believe that scMEGA is an important framework for understanding complex gene regulation mechanisms of various biological processes from single-cell multi-omics data.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>vbad003_Supplementary_Data</label>
      <media xlink:href="vbad003_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Author contributions</title>
    <p>Zhijian Li (Conceptualization [lead], Data curation [equal], Formal analysis [equal], Methodology [equal], Resources [lead], Software [lead], Writing—original draft [equal], Writing—review &amp; editing [equal]), James Shiniti Nagai (Conceptualization [supporting], Formal analysis [supporting], Software [supporting], Visualization [supporting], Writing—original draft [supporting]), Christoph Kuppe (Conceptualization [supporting], Data curation [supporting], Writing—original draft [supporting]) and Ivan G. Costa (Conceptualization [equal], Funding acquisition [lead], Investigation [lead], Methodology [lead], Project administration [lead], Supervision [lead], Writing—original draft [lead], Writing—review &amp; editing [lead])</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Software and data availability</title>
    <p>The data used in this article are available in: <ext-link xlink:href="https://zenodo.org/record/6623588" ext-link-type="uri">https://zenodo.org/record/6623588</ext-link>. Notebooks for the analysis presented in this work are found <ext-link xlink:href="https://costalab.github.io/scMEGA/articles/myofibroblast-GRN.html" ext-link-type="uri">https://costalab.github.io/scMEGA/articles/myofibroblast-GRN.html</ext-link>.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This project was funded by the German Research Foundation (DFG) and the E: MED Consortia Fibromap funded by the German Ministry of Education and Science (BMBF).</p>
    <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="vbad003-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cheng</surname><given-names>M.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>MOJITOO: a fast and universal method for integration of multimodal single-cell data</article-title>. <source>Bioinformatics</source>, <volume>38</volume>, <fpage>i282</fpage>–<lpage>i289</lpage>.<pub-id pub-id-type="pmid">35758807</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Csardi</surname><given-names>G.</given-names></string-name>, <string-name><surname>Nepusz</surname><given-names>T.</given-names></string-name></person-group> (<year>2006</year>) <article-title>The igraph software package for complex network research</article-title>. <source>InterJournal Complex Syst</source>., <volume>1695</volume>, <fpage>1</fpage>–<lpage>9</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad003-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Fleck</surname><given-names>J.S.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Inferring and perturbing cell fate regulomes in human cerebral organoids</article-title>. <source>Nature</source>. <pub-id pub-id-type="doi">10.1038/s41586-022-05279-8</pub-id>.</mixed-citation>
    </ref>
    <ref id="vbad003-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Freeman</surname><given-names>L.C.</given-names></string-name></person-group> (<year>1978</year>) <article-title>Centrality in social networks conceptual clarification</article-title>. <source>Soc. Networks</source>, <volume>1</volume>, <fpage>215</fpage>–<lpage>239</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad003-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ghoshal</surname><given-names>G.</given-names></string-name>, <string-name><surname>Barabási</surname><given-names>A.-L.</given-names></string-name></person-group> (<year>2011</year>) <article-title>Ranking stability and super-stable nodes in complex networks</article-title>. <source>Nat. Commun</source>., <volume>2</volume>, <fpage>1</fpage>–<lpage>7</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad003-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Granja</surname><given-names>J.M.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Archr is a scalable software package for integrative single-cell chromatin accessibility analysis</article-title>. <source>Nat. Genet</source>., <volume>53</volume>, <fpage>403</fpage>–<lpage>411</lpage>.<pub-id pub-id-type="pmid">33633365</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Janssens</surname><given-names>J.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Decoding gene regulation in the fly brain</article-title>. <source>Nature</source>, <volume>601</volume>, <fpage>630</fpage>–<lpage>636</lpage>.<pub-id pub-id-type="pmid">34987221</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kamimoto</surname><given-names>K.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Celloracle: dissecting cell identity via network inference and in silico gene perturbation</article-title>. <source>bioRxiv</source>. <pub-id pub-id-type="doi">10.1101/2020.02.17.947416</pub-id>.</mixed-citation>
    </ref>
    <ref id="vbad003-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kartha</surname><given-names>V.K.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Functional inference of gene regulation using single-cell multi-omics</article-title>. <source>Cell Genomics</source>, <volume>2</volume>, <fpage>100166</fpage>.<pub-id pub-id-type="pmid">36204155</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Korsunsky</surname><given-names>I.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Fast, sensitive and accurate integration of single-cell data with harmony</article-title>. <source>Nat. Methods</source>, <volume>16</volume>, <fpage>1289</fpage>–<lpage>1296</lpage>.<pub-id pub-id-type="pmid">31740819</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kuppe</surname><given-names>C.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Decoding myofibroblast origins in human kidney fibrosis</article-title>. <source>Nature</source>, <volume>589</volume>, <fpage>281</fpage>–<lpage>286</lpage>.<pub-id pub-id-type="pmid">33176333</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kuppe</surname><given-names>C.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Spatial multi-omic map of human myocardial infarction</article-title>. <source>Nature</source>, <volume>608</volume>, <fpage>766</fpage>–<lpage>777</lpage>.<pub-id pub-id-type="pmid">35948637</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lance</surname><given-names>C.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Multimodal single cell data integration challenge: results and lessons learned</article-title>. <source>PMLR</source>,<volume>176</volume>, <fpage>162</fpage>–<lpage>176</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad003-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>Z.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Chromatin-accessibility estimation from single-cell ATAC-seq data with scOpen</article-title>. <source>Nat. Commun</source>., <volume>12</volume>, <fpage>1</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">33397941</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Liu</surname><given-names>R.</given-names></string-name></person-group><etal>et al</etal> (<year>2017</year>) <article-title>Tead1 is required for maintaining adult cardiomyocyte function, and its loss results in lethal dilated cardiomyopathy</article-title>. <source>JCI Insight</source>, <volume>2</volume>, <fpage>1</fpage>–<lpage>15</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad003-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ma</surname><given-names>S.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Chromatin potential identified by shared single-cell profiling of RNA and chromatin</article-title>. <source>Cell</source>, <volume>183</volume>, <fpage>1103</fpage>–<lpage>1116</lpage>.<pub-id pub-id-type="pmid">33098772</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B18">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Page</surname><given-names>L.</given-names></string-name></person-group><etal>et al</etal> (<year>1999</year>). The PageRank citation ranking: Bringing order to the web. <italic toggle="yes">Technical report</italic>. Stanford InfoLab.</mixed-citation>
    </ref>
    <ref id="vbad003-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schep</surname><given-names>A.N.</given-names></string-name></person-group><etal>et al</etal> (<year>2017</year>) <article-title>Chromvar: inferring transcription-factor-associated accessibility from single-cell epigenomic data</article-title>. <source>Nat. Methods</source>, <volume>14</volume>, <fpage>975</fpage>–<lpage>978</lpage>.<pub-id pub-id-type="pmid">28825706</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stuart</surname><given-names>T.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Comprehensive integration of single-cell data</article-title>. <source>Cell</source>, <volume>177</volume>, <fpage>1888</fpage>–<lpage>1902</lpage>.<pub-id pub-id-type="pmid">31178118</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zaoli</surname><given-names>S.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Betweenness centrality for temporal multiplexes</article-title>. <source>Sci. Rep</source>., <volume>11</volume>, <fpage>1</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">33414495</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhu</surname><given-names>C.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Single-cell multimodal omics: the power of many</article-title>. <source>Nat. Methods</source>, <volume>17</volume>, <fpage>11</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">31907462</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinform Adv</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinform Adv</journal-id>
    <journal-id journal-id-type="publisher-id">bioadv</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics Advances</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2635-0041</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9853317</article-id>
    <article-id pub-id-type="doi">10.1093/bioadv/vbad003</article-id>
    <article-id pub-id-type="publisher-id">vbad003</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Application Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scMEGA: single-cell multi-omic enhancer-based gene regulatory network inference</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Zhijian</given-names>
        </name>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Conceptualization" vocab-term-identifier="http://credit.niso.org/contributor-roles/conceptualization/" degree-contribution="lead">Conceptualization</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Data curation" vocab-term-identifier="http://credit.niso.org/contributor-roles/data-curation/" degree-contribution="equal">Data curation</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Formal analysis" vocab-term-identifier="http://credit.niso.org/contributor-roles/formal-analysis/" degree-contribution="equal">Formal analysis</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Methodology" vocab-term-identifier="http://credit.niso.org/contributor-roles/methodology/" degree-contribution="equal">Methodology</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Resources" vocab-term-identifier="http://credit.niso.org/contributor-roles/resources/" degree-contribution="lead">Resources</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Software" vocab-term-identifier="http://credit.niso.org/contributor-roles/software/" degree-contribution="lead">Software</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – original draft" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-original-draft/" degree-contribution="equal">Writing – original draft</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – review &amp; editing" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-review-editing/" degree-contribution="equal">Writing – review &amp; editing</role>
        <aff><institution>Institute for Computational Genomics, Joint Research Center for Computational Biomedicine, RWTH Aachen University Medical School</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7655-7206</contrib-id>
        <name>
          <surname>Nagai</surname>
          <given-names>James S</given-names>
        </name>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Conceptualization" vocab-term-identifier="http://credit.niso.org/contributor-roles/conceptualization/" degree-contribution="supporting">Conceptualization</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Formal analysis" vocab-term-identifier="http://credit.niso.org/contributor-roles/formal-analysis/" degree-contribution="supporting">Formal analysis</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Software" vocab-term-identifier="http://credit.niso.org/contributor-roles/software/" degree-contribution="supporting">Software</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Visualization" vocab-term-identifier="http://credit.niso.org/contributor-roles/visualization/" degree-contribution="supporting">Visualization</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – original draft" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-original-draft/" degree-contribution="supporting">Writing – original draft</role>
        <aff><institution>Institute for Computational Genomics, Joint Research Center for Computational Biomedicine, RWTH Aachen University Medical School</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-4597-9833</contrib-id>
        <name>
          <surname>Kuppe</surname>
          <given-names>Christoph</given-names>
        </name>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Conceptualization" vocab-term-identifier="http://credit.niso.org/contributor-roles/conceptualization/" degree-contribution="supporting">Conceptualization</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Data curation" vocab-term-identifier="http://credit.niso.org/contributor-roles/data-curation/" degree-contribution="supporting">Data curation</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – original draft" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-original-draft/" degree-contribution="supporting">Writing – original draft</role>
        <aff><institution>Institute of Experimental Medicine and Systems Biology, RWTH Aachen University</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
        <aff><institution>Division of Nephrology and Clinical Immunology, RWTH Aachen University</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-4048-6351</contrib-id>
        <name>
          <surname>Kramann</surname>
          <given-names>Rafael</given-names>
        </name>
        <aff><institution>Institute of Experimental Medicine and Systems Biology, RWTH Aachen University</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
        <aff><institution>Division of Nephrology and Clinical Immunology, RWTH Aachen University</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
        <aff><institution>Department of Internal Medicine, Nephrology and Transplantation, Erasmus Medical Center</institution>, Rotterdam 3042, <country country="NL">The Netherlands</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-2890-8697</contrib-id>
        <name>
          <surname>Costa</surname>
          <given-names>Ivan G</given-names>
        </name>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Conceptualization" vocab-term-identifier="http://credit.niso.org/contributor-roles/conceptualization/" degree-contribution="equal">Conceptualization</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Funding acquisition" vocab-term-identifier="http://credit.niso.org/contributor-roles/funding-acquisition/" degree-contribution="lead">Funding acquisition</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Investigation" vocab-term-identifier="http://credit.niso.org/contributor-roles/investigation/" degree-contribution="lead">Investigation</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Methodology" vocab-term-identifier="http://credit.niso.org/contributor-roles/methodology/" degree-contribution="lead">Methodology</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Project administration" vocab-term-identifier="http://credit.niso.org/contributor-roles/project-administration/" degree-contribution="lead">Project administration</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Supervision" vocab-term-identifier="http://credit.niso.org/contributor-roles/supervision/" degree-contribution="lead">Supervision</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – original draft" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-original-draft/" degree-contribution="lead">Writing – original draft</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – review &amp; editing" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-review-editing/" degree-contribution="lead">Writing – review &amp; editing</role>
        <aff><institution>Institute for Computational Genomics, Joint Research Center for Computational Biomedicine, RWTH Aachen University Medical School</institution>, Aachen 52062, <country country="DE">Germany</country></aff>
        <xref rid="vbad003-cor1" ref-type="corresp"/>
        <!--ivan.costa@rwth-aachen.de-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Kuijjer</surname>
          <given-names>Marieke Lydia</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="vbad003-cor1">To whom correspondence should be addressed. <email>ivan.costa@rwth-aachen.de</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-01-12">
      <day>12</day>
      <month>1</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>12</day>
      <month>1</month>
      <year>2023</year>
    </pub-date>
    <volume>3</volume>
    <issue>1</issue>
    <elocation-id>vbad003</elocation-id>
    <history>
      <date date-type="received">
        <day>18</day>
        <month>10</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>08</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>05</day>
        <month>1</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>11</day>
        <month>1</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>20</day>
        <month>1</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="vbad003.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>The increasing availability of single-cell multi-omics data allows to quantitatively characterize gene regulation. We here describe scMEGA (Single-cell Multiomic Enhancer-based Gene Regulatory Network Inference) that enables an end-to-end analysis of multi-omics data for gene regulatory network inference including modalities integration, trajectory analysis, enhancer-to-promoter association, network analysis and visualization. This enables to study the complex gene regulation mechanisms for dynamic biological processes, such as cellular differentiation and disease-driven cellular remodeling. We provide a case study on gene regulatory networks controlling myofibroblast activation in human myocardial infarction.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p>scMEGA is implemented in R, released under the MIT license and available from <ext-link xlink:href="https://github.com/CostaLab/scMEGA" ext-link-type="uri">https://github.com/CostaLab/scMEGA</ext-link>. Tutorials are available from <ext-link xlink:href="https://costalab.github.io/scMEGA" ext-link-type="uri">https://costalab.github.io/scMEGA</ext-link>.</p>
      </sec>
      <sec id="s4">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics Advances</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>German Research Foundation</institution>
            <institution-id institution-id-type="DOI">10.13039/501100001659</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>German Ministry of Education and Science</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="4"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Single-cell RNA sequencing (scRNA-seq) and ATAC-seq (scATAC-seq) techniques provide an unprecedented opportunity to understand gene regulation at the single-cell level by capturing orthogonal molecular information (<xref rid="vbad003-B15" ref-type="bibr">Li <italic toggle="yes">et al.</italic>, 2021</xref>; <xref rid="vbad003-B22" ref-type="bibr">Zhu <italic toggle="yes">et al.</italic>, 2020</xref>). Applying both assays on the same biological samples generates single-cell multi-omics data, which allow to computationally infer gene regulatory networks (GRNs) for different cellular systems, such as fly brain development (<xref rid="vbad003-B7" ref-type="bibr">Janssens <italic toggle="yes">et al.</italic>, 2022</xref>) and human myocardial infarction (<xref rid="vbad003-B13" ref-type="bibr">Kuppe <italic toggle="yes">et al.</italic>, 2022</xref>).</p>
    <p>However, such analysis is usually based on complex bioinformatic pipelines that require different tools for each of the steps, such as Seurat for scRNA-seq analysis and data integration (<xref rid="vbad003-B20" ref-type="bibr">Stuart <italic toggle="yes">et al.</italic>, 2019</xref>), ArchR for scATAC-seq analysis and trajectory inference (<xref rid="vbad003-B6" ref-type="bibr">Granja <italic toggle="yes">et al.</italic>, 2021</xref>), chromVAR for TF activity estimation (<xref rid="vbad003-B19" ref-type="bibr">Schep <italic toggle="yes">et al.</italic>, 2017</xref>) and igraph (<xref rid="vbad003-B2" ref-type="bibr">Csardi and Nepusz, 2006</xref>) for network analysis. Currently, three computational tools (Pando, <xref rid="vbad003-B3" ref-type="bibr">Fleck <italic toggle="yes">et al.</italic>, 2022</xref>; CellOracle <xref rid="vbad003-B8" ref-type="bibr">Kamimoto <italic toggle="yes">et al.</italic>, 2020</xref>; FigR <xref rid="vbad003-B9" ref-type="bibr">Kartha <italic toggle="yes">et al.</italic>, 2022</xref>) are available for GRN inference based on single-cell multi-omics profiles. Pando focuses on the identification of regulatory networks limited to TF-TF interaction and does not provide methods for modality integration or trajectory analysis. CellOracle performs analysis of ATAC-seq and RNA-seq data independently. It cannot, therefore, explore gene expression for the delineation of gene-to-peak enhancer links and does not consider TF activity scores at a single-cell level to select relevant transcription factors. FigR, which includes modules for multimodal data integration, peak-to-gene link prediction and trajectory inference, is one of the most comprehensive methods so far. However, it does not support direct operation on Seurat objects and offers few functionalities to explore information from the GRNs.</p>
    <p>We here developed scMEGA as a general framework to quantitatively infer enhancer-based GRN by taking single-cell multi-omics profiles as input. scMEGA, which builds upon expertise on the analysis of multimodal single-cell data of myocardial infarction (<xref rid="vbad003-B13" ref-type="bibr">Kuppe <italic toggle="yes">et al.</italic>, 2022</xref>), enables an end-to-end analysis of multi-omics data for GRN inference including modalities integration, trajectory analysis, enhancer-to-promoter association, network analysis and visualization (<xref rid="vbad003-F1" ref-type="fig">Fig. 1</xref>). For this, it provides new functionalities and combines some existing methods from Seurat, ArchR, chromVAR and igraph. It is implemented as an R package and is compatible with the Seurat ecosystem.</p>
    <fig position="float" id="vbad003-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>Overview of scMEGA. (<bold>a</bold>) First, scMEGA integrates the single-cell multi-omics profiles to obtain a paired dataset through modality integration built on the R package Seurat and cell pairing built on the approach OptMatch. (<bold>b</bold>) Next, scMEGA infers a pseudotime trajectory to characterize the underlying dynamic process of a given cell type using ArchR. (<bold>c</bold>) It then filters TFs, which are selected based on correlation analysis between binding activity (chromVAR) and expression along the trajectory, and genes, which are selected based on correlation analysis between peak accessibility and gene expression along the trajectory. (<bold>d</bold>) Based on the selected TFs and genes, scMEGA generates a quantitative GRN by estimating the correlation of selected TF and gene expression. (<bold>e</bold>) scMEGA uses enhancer-to-gene links and motif matching to find enhancer-based TF-to-gene interactions. These are used to filter the previously defined quantitative GRN as shown in (d)</p>
      </caption>
      <graphic xlink:href="vbad003f1" position="float"/>
    </fig>
  </sec>
  <sec>
    <title>2 Methods</title>
    <p>There are three major steps in scMEGA namely, (i) multimodal data integration, (ii) identification and filtering of candidate TFs and genes and (iii) GRN assembly and analysis.</p>
    <sec>
      <title>2.1 Single-cell multimodal data integration</title>
      <p>To build the GRNs, it is crucial to have a mapping between cells at distinct modalities (RNA and ATAC), so that one can find associations between the expression of TF/genes and the activity and accessibility of genes/TFs at the single-cell level. For this, scMEGA first projects the cells into a shared co-embedding space by using the canonical correlation analysis (CCA) implemented by Seurat (<xref rid="vbad003-B20" ref-type="bibr">Stuart <italic toggle="yes">et al.</italic>, 2019</xref>). Here, features are gene expression from scRNA-seq and gene activity scores from scATAC-seq data. In case of batch effects are present, the method Harmony (<xref rid="vbad003-B10" ref-type="bibr">Korsunsky <italic toggle="yes">et al.</italic>, 2019</xref>) can be applied for batch correction. Next, scMEGA performs cell pairing to obtain one-to-one matching between scRNA-seq and scATAC-seq using OptMatch pairing (<xref rid="vbad003-B9" ref-type="bibr">Kartha <italic toggle="yes">et al.</italic>, 2022</xref>). Altogether, these steps build a pseudo-multimodal dataset and a low dimensional representation of the data (<xref rid="vbad003-F1" ref-type="fig">Fig. 1a</xref>). In the case of single-cell multimodal data with paired cells [e.g. SHARE-seq (<xref rid="vbad003-B17" ref-type="bibr">Ma <italic toggle="yes">et al.</italic>, 2020</xref>) and 10× Multiome], this integration step can be skipped. Here, users only need to create a joint embedding of cells by using for example the CCA integration from MOJITOO (<xref rid="vbad003-B1" ref-type="bibr">Cheng <italic toggle="yes">et al.</italic>, 2022</xref>).</p>
    </sec>
    <sec>
      <title>2.2 Identification of candidate TFs and genes</title>
      <p>scMEGA next identifies candidate TFs and genes based on both multimodal or pseudo-multimodal data from the previous step. First, for the given cells of interest, a pseudotime trajectory characterizing the underlying dynamic process is inferred by using the supervised approach as implemented by the R package ArchR (<xref rid="vbad003-B6" ref-type="bibr">Granja <italic toggle="yes">et al.</italic>, 2021</xref>) (<xref rid="vbad003-F1" ref-type="fig">Fig. 1b</xref>). Here, the user needs to indicate root and terminal cells, i.e. by their characterization via marker genes.</p>
      <p>Then, scMEGA estimates binding activity for each TF in each cell based on chromatin accessibility profiles (<xref rid="vbad003-F1" ref-type="fig">Fig. 1c</xref>). To identify active TFs, scMEGA calculates the correlation between TF binding activity (estimated with chromVAR; <xref rid="vbad003-B19" ref-type="bibr">Schep <italic toggle="yes">et al.</italic>, 2017</xref>) and TF expression. A high correlation indicates that the TF is both highly expressed and the motif is more accessible than the average profiles (<xref rid="vbad003-B7" ref-type="bibr">Janssens <italic toggle="yes">et al.</italic>, 2022</xref>). This step is crucial, as TF-binding activity alone cannot differentiate between TFs of the same family sharing similar motifs. Next, scMEGA computes the expression variation of each gene along the pseudotime trajectory and picks up the top 10% (this cutoff can be adjusted by the user) most variable genes as trajectory-relevant genes. scMEGA next associates the selected genes to peaks based on the correlation of gene expression and peak accessibility at the single-cell level using functions from ArchR (<xref rid="vbad003-B6" ref-type="bibr">Granja <italic toggle="yes">et al.</italic>, 2021</xref>). Among other features, scMEGA provides functions to allow to directly operate Seurat objects.</p>
    </sec>
    <sec>
      <title>2.3 GRN construction and visualization</title>
      <p>Next, scMEGA builds a quantitative GRN by estimating the correlation of binding activity of all the selected TFs and expression of all the selected genes as described above (<xref rid="vbad003-F1" ref-type="fig">Fig. 1d</xref>). To link a TF to its target gene, scMEGA first subsets the predicted peak-to-gene links to obtain enhancer-to-gene links where the enhancers are defined as peaks that are at least 2k base pairs (bp) from the transcription start site of a gene (<xref rid="vbad003-F1" ref-type="fig">Fig. 1e</xref>). It then considers the TF-binding sites as predicted by chromVAR. A gene is only considered the target of a TF if this gene is associated with at least one enhancer and this TF is bound to one of the associated enhancers, which creates an enhancer-based GRN. By combining the quantitative GRN and the enhancer-based GRN, i.e. we only consider TF–gene regulations in both networks, scMEGA produces a final enhancer-based GRN (eGRN). TF–gene interactions are weighted by their correlation.</p>
      <p>The directed (from TF to gene) and weighted (as measured by the correlation) GRNs are modeled as a graph by the R package igraph (<xref rid="vbad003-B2" ref-type="bibr">Csardi and Nepusz, 2006</xref>). scMEGA provides eGRN visualization by exploring layout algorithms, such as Fruchterman–Reingold. This layout allows finding major regulatory modules by plotting TFs sharing similar target genes together. Alternatively, users can use the focus layout, which allows for the centralization of the network regarding certain relevant genes/TF. scMEGA also explores network statistics to depict important TFs by computing the page-rank index (<xref rid="vbad003-B18" ref-type="bibr">Page <italic toggle="yes">et al.</italic>, 1999</xref>) or betweenness score (<xref rid="vbad003-B4" ref-type="bibr">Freeman, 1978</xref>) for all TFs or targets. Betweenness scores find regulators (TFs), which bridge distinct modules of the GRN (<xref rid="vbad003-B21" ref-type="bibr">Zaoli <italic toggle="yes">et al.</italic>, 2021</xref>). The page rank detects important TFs, TFs regulating directly or indirectly other genes (<xref rid="vbad003-B5" ref-type="bibr">Ghoshal and Barabási, 2011</xref>). scMEGA allows for visualization of the gene expression of targets of TFs to understand the regulation activity in spatial coordinates.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 Benchmarking the robustness of scMEGA</title>
      <p>The integration of multimodal single-cell data is an important step of scMEGA for unpaired single-cell data. To test the impact of this step, we obtained single-cell multimodal data generated by using 10× Multiome protocol from human healthy peripheral blood mononuclear cells. We recovered 10 504 cells and identified fourteen cell types (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 1a</xref>). Next, we integrated the data and performed cell pairing. We observed that only a few true pairs were correctly recovered (<italic toggle="yes">n</italic> = 41), indicating that cell matching is indeed a difficult task at the single-cell level. However, most of the cells were matched with the correct cell types (71.8%) and mismatching generally represented similar sub-populations, such as non-classical and intermediate monocytes (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 1b</xref>). These numbers are competitive with a recent benchmarking study (<xref rid="vbad003-B14" ref-type="bibr">Lance <italic toggle="yes">et al.</italic>, 2022</xref>). We next predicted eGRN for CD4 T cells using the true or predicted pairs between scRNA-seq and scATAC-seq data (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 1c</xref>). Indeed, more than 75% TFs, 83% genes and 60% TF–gene regulations inferred from OptMatch predicted pairs were also supported by the true pairs, indicating that most interactions could be recovered by scMEGA (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 1d–f</xref>).</p>
    </sec>
    <sec>
      <title>3.2 Case study on myocardial infarction</title>
      <p>We here provide a case study using scMEGA to infer a GRN to study fibrogenesis in human hearts after myocardial infarction (<xref rid="vbad003-B13" ref-type="bibr">Kuppe <italic toggle="yes">et al.</italic>, 2022</xref>). We integrated the snRNA-seq and snATAC-seq data and identified four sub-populations of fibroblasts (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 2a</xref>). Detection of marker genes indicated that cluster 2 highly expressed <italic toggle="yes">SCARA5</italic> which was recently reported as a marker for myofibroblast progenitors in the human kidney (<xref rid="vbad003-B12" ref-type="bibr">Kuppe <italic toggle="yes">et al.</italic>, 2021</xref>) (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 2b</xref>). Cluster 1 was marked by <italic toggle="yes">POSTN</italic>, <italic toggle="yes">COL1A1</italic> and <italic toggle="yes">COL3A1</italic>, suggesting that these cells are differentiated myofibroblasts. Based on these, we built a pseudotime trajectory from cluster 2 to cluster 1 to study the myofibroblasts differentiation process (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 2c</xref>).</p>
      <p>Next, we selected 79 candidate TFs and 2207 genes as input for inferring GRN (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 2d and e</xref>). Correlation between the binding activity of the TFs and expression of the genes revealed two major regulation modules with each one corresponding to a distinct fibroblast sub-cluster (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 2f</xref>). For example, we identified NR3C2 as a regulator of the <italic toggle="yes">SCARA5</italic>+ fibroblasts (module 1—fibroblast progenitors) with a decreased binding activity, TF expression and target gene expression along the trajectory (<xref rid="vbad003-F2" ref-type="fig">Fig. 2b</xref>). Regarding the myofibroblasts, we detected several fibrosis-relevant TFs as TEAD (<xref rid="vbad003-B16" ref-type="bibr">Liu <italic toggle="yes">et al.</italic>, 2017</xref>) and RUNX family genes. Of note, we have recently characterized the role of RUNX1 as playing an essential role in kidney (<xref rid="vbad003-B15" ref-type="bibr">Li <italic toggle="yes">et al.</italic>, 2021</xref>) and heart (<xref rid="vbad003-B13" ref-type="bibr">Kuppe <italic toggle="yes">et al.</italic></xref>, <xref rid="vbad003-B13" ref-type="bibr">2022</xref>) fibrogenesis.</p>
      <fig position="float" id="vbad003-F2">
        <label>Fig. 2.</label>
        <caption>
          <p>Inferred GRN for myofibroblast differentiation. (<bold>a</bold>) Visualization of the inferred GRN for myofibroblasts differentiation. Each node represents a TF (regulator) or gene (target). TFs are colored by the pseudotime point at which the TF has the highest activity score as estimated by chromVAR. (<bold>b</bold>) Line plots showing the TF binding activity, TF expression and target expression along the myofibroblasts differential trajectory for NR3C2 and RUNX1. The <italic toggle="yes">x</italic>-axis represents the pseudotime points and the y-axis represents the z-score transformed values. (<bold>c</bold>) Visualization of the spatial distribution of fibroblast proportion estimated by cell2location in the ischemic zone of the human heart after myocardial infarction. (<bold>d</bold>) Left: spatial distributed gene expression of NR3C2 and RUNX1. Right: spatially distributed gene expression of all targets of NR3C2 and RUNX1</p>
        </caption>
        <graphic xlink:href="vbad003f2" position="float"/>
      </fig>
      <p>Visualization of the inferred network and regulator properties (between and page-rank scores) pinpointed RUNX1 as the factor with higher importance during myofibroblast differentiation (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 3a</xref>). A visualization of the eGRN centered around RUNX1 highlights the fact that RUNX1 is predicted to regulate many other genes including other fibrosis-related transcription factors as TEAD2 and TEAD3 (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. 3b</xref>). As another example of downstream analysis allowed by eGRNs, we inspected the expression of target genes of NR3C2 and RUNX1 in space. We could not detect clear expression patterns of the TFs in space due to sparsity and low expression values of these TFs in spatial transcriptomics (<xref rid="vbad003-F2" ref-type="fig">Fig. 2c and d</xref>). By exploring the regulomes (target genes) of NR3C2 and RUNX1, we observed gradients and mutually exclusive spatial expression in defined cardiac regions of fibrotic responses, highlighting the power of scMEGA in delineating TF regulome expression in sparse spatial transcriptomics data.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Conclusion</title>
    <p>We present scMEGA to infer enhancer-based GRN using single-cell multiomics/multimodal profiles. scMEGA is built upon several R packages for single-cell data analysis. It enables users to perform end-to-end GRN inferences and to prioritize important TFs and genes for experimental validation and the use of regulomes to analyze spatial transcriptomics. We exemplify the use of scMEGA to study gene regulation of myofibroblasts activation in human hearts after myocardial infarction (<xref rid="vbad003-B13" ref-type="bibr">Kuppe <italic toggle="yes">et al.</italic>, 2022</xref>). The data set analyzed here has at least 63 000 and 20 000 cells of snRNA-seq and snATAC-seq, respectively, which demonstrates the scalability of scMEGA. In addition, the data can be generated from different platforms or protocols as batch effects will be corrected computationally using Harmony (<xref rid="vbad003-B10" ref-type="bibr">Korsunsky <italic toggle="yes">et al.</italic>, 2019</xref>). However, the trajectory analysis assumes that cells are part of a differentiation or activation process. Moreover, benchmarking of the single-cell matching problem presented here and by others (<xref rid="vbad003-B14" ref-type="bibr">Lance <italic toggle="yes">et al.</italic>, 2022</xref>) indicates that this is an extremely difficult problem. Future work includes the implementation of additional cell matching algorithms, as top-performing methods reported in (<xref rid="vbad003-B14" ref-type="bibr">Lance <italic toggle="yes">et al.</italic>, 2022</xref>). Altogether, we believe that scMEGA is an important framework for understanding complex gene regulation mechanisms of various biological processes from single-cell multi-omics data.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>vbad003_Supplementary_Data</label>
      <media xlink:href="vbad003_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Author contributions</title>
    <p>Zhijian Li (Conceptualization [lead], Data curation [equal], Formal analysis [equal], Methodology [equal], Resources [lead], Software [lead], Writing—original draft [equal], Writing—review &amp; editing [equal]), James Shiniti Nagai (Conceptualization [supporting], Formal analysis [supporting], Software [supporting], Visualization [supporting], Writing—original draft [supporting]), Christoph Kuppe (Conceptualization [supporting], Data curation [supporting], Writing—original draft [supporting]) and Ivan G. Costa (Conceptualization [equal], Funding acquisition [lead], Investigation [lead], Methodology [lead], Project administration [lead], Supervision [lead], Writing—original draft [lead], Writing—review &amp; editing [lead])</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Software and data availability</title>
    <p>The data used in this article are available in: <ext-link xlink:href="https://zenodo.org/record/6623588" ext-link-type="uri">https://zenodo.org/record/6623588</ext-link>. Notebooks for the analysis presented in this work are found <ext-link xlink:href="https://costalab.github.io/scMEGA/articles/myofibroblast-GRN.html" ext-link-type="uri">https://costalab.github.io/scMEGA/articles/myofibroblast-GRN.html</ext-link>.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This project was funded by the German Research Foundation (DFG) and the E: MED Consortia Fibromap funded by the German Ministry of Education and Science (BMBF).</p>
    <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="vbad003-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cheng</surname><given-names>M.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>MOJITOO: a fast and universal method for integration of multimodal single-cell data</article-title>. <source>Bioinformatics</source>, <volume>38</volume>, <fpage>i282</fpage>–<lpage>i289</lpage>.<pub-id pub-id-type="pmid">35758807</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Csardi</surname><given-names>G.</given-names></string-name>, <string-name><surname>Nepusz</surname><given-names>T.</given-names></string-name></person-group> (<year>2006</year>) <article-title>The igraph software package for complex network research</article-title>. <source>InterJournal Complex Syst</source>., <volume>1695</volume>, <fpage>1</fpage>–<lpage>9</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad003-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Fleck</surname><given-names>J.S.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Inferring and perturbing cell fate regulomes in human cerebral organoids</article-title>. <source>Nature</source>. <pub-id pub-id-type="doi">10.1038/s41586-022-05279-8</pub-id>.</mixed-citation>
    </ref>
    <ref id="vbad003-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Freeman</surname><given-names>L.C.</given-names></string-name></person-group> (<year>1978</year>) <article-title>Centrality in social networks conceptual clarification</article-title>. <source>Soc. Networks</source>, <volume>1</volume>, <fpage>215</fpage>–<lpage>239</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad003-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ghoshal</surname><given-names>G.</given-names></string-name>, <string-name><surname>Barabási</surname><given-names>A.-L.</given-names></string-name></person-group> (<year>2011</year>) <article-title>Ranking stability and super-stable nodes in complex networks</article-title>. <source>Nat. Commun</source>., <volume>2</volume>, <fpage>1</fpage>–<lpage>7</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad003-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Granja</surname><given-names>J.M.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Archr is a scalable software package for integrative single-cell chromatin accessibility analysis</article-title>. <source>Nat. Genet</source>., <volume>53</volume>, <fpage>403</fpage>–<lpage>411</lpage>.<pub-id pub-id-type="pmid">33633365</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Janssens</surname><given-names>J.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Decoding gene regulation in the fly brain</article-title>. <source>Nature</source>, <volume>601</volume>, <fpage>630</fpage>–<lpage>636</lpage>.<pub-id pub-id-type="pmid">34987221</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kamimoto</surname><given-names>K.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Celloracle: dissecting cell identity via network inference and in silico gene perturbation</article-title>. <source>bioRxiv</source>. <pub-id pub-id-type="doi">10.1101/2020.02.17.947416</pub-id>.</mixed-citation>
    </ref>
    <ref id="vbad003-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kartha</surname><given-names>V.K.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Functional inference of gene regulation using single-cell multi-omics</article-title>. <source>Cell Genomics</source>, <volume>2</volume>, <fpage>100166</fpage>.<pub-id pub-id-type="pmid">36204155</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Korsunsky</surname><given-names>I.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Fast, sensitive and accurate integration of single-cell data with harmony</article-title>. <source>Nat. Methods</source>, <volume>16</volume>, <fpage>1289</fpage>–<lpage>1296</lpage>.<pub-id pub-id-type="pmid">31740819</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kuppe</surname><given-names>C.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Decoding myofibroblast origins in human kidney fibrosis</article-title>. <source>Nature</source>, <volume>589</volume>, <fpage>281</fpage>–<lpage>286</lpage>.<pub-id pub-id-type="pmid">33176333</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kuppe</surname><given-names>C.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Spatial multi-omic map of human myocardial infarction</article-title>. <source>Nature</source>, <volume>608</volume>, <fpage>766</fpage>–<lpage>777</lpage>.<pub-id pub-id-type="pmid">35948637</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lance</surname><given-names>C.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Multimodal single cell data integration challenge: results and lessons learned</article-title>. <source>PMLR</source>,<volume>176</volume>, <fpage>162</fpage>–<lpage>176</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad003-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>Z.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Chromatin-accessibility estimation from single-cell ATAC-seq data with scOpen</article-title>. <source>Nat. Commun</source>., <volume>12</volume>, <fpage>1</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">33397941</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Liu</surname><given-names>R.</given-names></string-name></person-group><etal>et al</etal> (<year>2017</year>) <article-title>Tead1 is required for maintaining adult cardiomyocyte function, and its loss results in lethal dilated cardiomyopathy</article-title>. <source>JCI Insight</source>, <volume>2</volume>, <fpage>1</fpage>–<lpage>15</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad003-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ma</surname><given-names>S.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Chromatin potential identified by shared single-cell profiling of RNA and chromatin</article-title>. <source>Cell</source>, <volume>183</volume>, <fpage>1103</fpage>–<lpage>1116</lpage>.<pub-id pub-id-type="pmid">33098772</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B18">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Page</surname><given-names>L.</given-names></string-name></person-group><etal>et al</etal> (<year>1999</year>). The PageRank citation ranking: Bringing order to the web. <italic toggle="yes">Technical report</italic>. Stanford InfoLab.</mixed-citation>
    </ref>
    <ref id="vbad003-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schep</surname><given-names>A.N.</given-names></string-name></person-group><etal>et al</etal> (<year>2017</year>) <article-title>Chromvar: inferring transcription-factor-associated accessibility from single-cell epigenomic data</article-title>. <source>Nat. Methods</source>, <volume>14</volume>, <fpage>975</fpage>–<lpage>978</lpage>.<pub-id pub-id-type="pmid">28825706</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stuart</surname><given-names>T.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Comprehensive integration of single-cell data</article-title>. <source>Cell</source>, <volume>177</volume>, <fpage>1888</fpage>–<lpage>1902</lpage>.<pub-id pub-id-type="pmid">31178118</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zaoli</surname><given-names>S.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Betweenness centrality for temporal multiplexes</article-title>. <source>Sci. Rep</source>., <volume>11</volume>, <fpage>1</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">33414495</pub-id></mixed-citation>
    </ref>
    <ref id="vbad003-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhu</surname><given-names>C.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Single-cell multimodal omics: the power of many</article-title>. <source>Nat. Methods</source>, <volume>17</volume>, <fpage>11</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">31907462</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
