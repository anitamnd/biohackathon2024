<?all-math-mml yes?>
<?use-mml?>
<?properties open_access?>
<?properties manuscript?>
<?ManuscriptPrefix new?>
<?iso-abbr Nat. Methods?>
<?submitter-system ukmss?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 1005?>
<?submitter-authority publisher?>
<?submitter-login NPG?>
<?submitter-name Nature Publishing Group?>
<?domain wtpa?>
<?origin ukpmcpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6152898</article-id>
    <article-id pub-id-type="pmid">29529017</article-id>
    <article-id pub-id-type="doi">10.1038/nmeth.4631</article-id>
    <article-id pub-id-type="manuscript">ems76223</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Improved Ribo-seq enables identification of cryptic translation events</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Erhard</surname>
          <given-names>Florian</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="corresp" rid="CR1">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Halenius</surname>
          <given-names>Anne</given-names>
        </name>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref ref-type="aff" rid="A4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zimmermann</surname>
          <given-names>Cosima</given-names>
        </name>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref ref-type="aff" rid="A4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>L’Hernault</surname>
          <given-names>Anne</given-names>
        </name>
        <xref ref-type="aff" rid="A5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kowalewski</surname>
          <given-names>Daniel J.</given-names>
        </name>
        <xref ref-type="aff" rid="A6">6</xref>
        <xref ref-type="aff" rid="A7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Weekes</surname>
          <given-names>Michael P.</given-names>
        </name>
        <xref ref-type="aff" rid="A8">8</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Stevanovic</surname>
          <given-names>Stefan</given-names>
        </name>
        <xref ref-type="aff" rid="A6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zimmer</surname>
          <given-names>Ralf</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Dölken</surname>
          <given-names>Lars</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="corresp" rid="CR1">*</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Institute for Informatics, Ludwig-Maximilians-Universität München, Amalienstraße 17, 80333 München, Germany</aff>
    <aff id="A2"><label>2</label>Institute for Virology and Immunobiology, Julius-Maximilians-Universität Würzburg, Versbacher Straße 7, 97078 Würzburg, Germany</aff>
    <aff id="A3"><label>3</label>Institute of Virology, Medical Center, University of Freiburg, Hermann-Herder-Straße 11, 79104 Freiburg, Germany</aff>
    <aff id="A4"><label>4</label>Faculty of Medicine, University of Freiburg, Hermann-Herder-Straße 11, 79104 Freiburg, Germany</aff>
    <aff id="A5"><label>5</label>AstraZeneca UK Ltd, Innovative Medicines &amp; Early Development, Cambridge Science Park, Milton Road, Cambridge, CB4 0WG, UK</aff>
    <aff id="A6"><label>6</label>Interfaculty Institute for Cell Biology, Department of Immunology, University of Tübingen Auf der Morgenstelle 15, 72076 Tübingen, Germany</aff>
    <aff id="A7"><label>7</label>Immatics Biotechnologies GmbH, Tübingen, Germany</aff>
    <aff id="A8"><label>8</label>Cambridge Institute for Medical Research, University of Cambridge, Hills Road, CB20XY Cambridge, United Kingdom</aff>
    <author-notes>
      <corresp id="CR1"><label>*</label><bold>please send correspondence to:</bold> Florian Erhard: <email>Florian.Erhard@uni-wuerzburg.de</email>; Ralf Zimmer: <email>Ralf.Zimmer@ifi.lmu.de</email>; Lars Dölken: <email>Lars.Doelken@uni-wuerzburg.de</email></corresp>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>7</day>
      <month>8</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>12</day>
      <month>3</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>5</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>25</day>
      <month>9</month>
      <year>2018</year>
    </pub-date>
    <volume>15</volume>
    <issue>5</issue>
    <fpage>363</fpage>
    <lpage>366</lpage>
    <!--elocation-id from pubmed: 10.1038/nmeth.4631-->
    <permissions>
      <license>
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:<ext-link ext-link-type="uri" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</ext-link></license-p>
      </license>
    </permissions>
    <abstract>
      <p id="P1">Ribosome profiling has predicted thousands of short open reading frames (sORFs) in eukaryotic cells, but still suffers from substantial levels of noise. PRICE (<ext-link ext-link-type="uri" xlink:href="https://github.com/erhard-lab/price">https://github.com/erhard-lab/price</ext-link>) is a computational method modeling the experimental noise to accurately resolve overlapping sORFs and non-canonical translation initiation. We experimentally validated translation using MHC-I peptidomics and saw that sORF-derived peptides efficiently enter the MHC-I presentation pathway and thus constitute a substantial fraction of the antigen repertoire.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P2">Ribosome profiling (Ribo-seq) is a powerful approach to measure translational activity in a genome-wide and quantitative manner with base-pair resolution<xref rid="R1" ref-type="bibr">1</xref>. It visualizes the triplet shifts of actively translating ribosomes and thereby allows the identification of codons and their corresponding ORFs translated at the time of cell lysis. This has resulted in the prediction of thousands of short open reading frames (sORFs) including upstream and upstream-overlapping ORFs (uORFs/uoORFs) revealing an important new layer of translational control in eukaryotic cells<xref rid="R2" ref-type="bibr">2</xref>. However, accurate and reliable identification of sORFs has remained difficult for overlapping ORFs and for initiation at non-canonical (non-AUG) start codons. In addition, the vast majority of these novel cryptic gene products have remained virtually undetectable in whole cellular proteomes and thus appear to be highly unstable. Here, we present a computational approach that enables accurate identification of sORFs in Ribo-seq data. It is based on computational modeling and subsequent removal of experimental noise from Ribo-seq data, allowing for improved statistical testing for active translation. Based on the accurate identification of thousands of sORFs, we show that, albeit being dramatically underrepresented in the cellular proteome, sORF-derived peptides efficiently enter the MHC-I presentation pathway and can be quantitatively recovered by MHC-I peptidome analysis. MHC-I peptidome analysis thus represents a potent method for large-scale validation of sORF translation.</p>
  <p id="P3">Ribosome footprints do not exhibit a singular specific size. Instead, reads are the result of two stochastic RNase cleavage events. Thus, deterministic rules (e.g. use an offset of 12) to recover the codon located in the P site of the actively translating ribosome (signal) lead to reads mapped to off-frame codons (noise). Depending on the combination of read lengths used for charting ribosome occupancy, signal is traded off for the signal to noise ratio. Moreover, untemplated nucleotide additions frequently observed in Ribo-seq experiments further increase noise levels (see <xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 1</xref>).</p>
  <p id="P4">We developed <italic>Probabilistic inference of codon activities by an EM algorithm</italic> (PRICE) to model the stochastic processes involved in Ribo-seq (<xref ref-type="fig" rid="F1">Fig. 1a</xref>). For each individual experiment all parameters are directly inferred from annotated, well-translated ORFs. Any codon located in the P site of a ribosome is able to produce several kinds of footprints and their proportions depend on these parameters. Our method determines the set of codons that generates the observed reads with maximum likelihood (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 2</xref>).</p>
  <p id="P5">After assembling identified codons to ORF candidates, potential start codons are predicted with high accuracy using a machine-learning model (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 3</xref>). If available, this can also integrate samples treated with Lactimidomycin or Harringtonine for translation start site enrichment<xref rid="R3" ref-type="bibr">3</xref>,<xref rid="R4" ref-type="bibr">4</xref>. In principle, experimental noise in an ORF candidate can arise due to (i) reads from overlapping ORFs, (ii) ribosome scanning or abortive translation events in the leader sequence, or (iii) due to non-ribosome-mediated mRNA protection from RNase treatment. To exclude candidate ORFs that reflect experimental noise, we use a hypothesis test based on the generalized binomial distribution that is specifically designed to also identify overlapping ORFs (<xref ref-type="fig" rid="F1">Fig. 1a</xref>).</p>
  <p id="P6">We first compared the signal and noise levels obtained by PRICE to the deterministic codon mapping approaches utilized by prior methods<xref rid="R5" ref-type="bibr">5</xref>–<xref rid="R11" ref-type="bibr">11</xref> (While this manuscript was under review, a further method for Ribo-seq data has been published<xref rid="R12" ref-type="bibr">12</xref>; however, it also utilizes the deterministic mapping strategy and does not address potentially overlapping ORFs). For Ribo-seq data obtained from herpes simplex virus 1 (HSV-1) infected primary human fibroblasts<xref rid="R13" ref-type="bibr">13</xref>, about 18 million of the 37 million reads mapping to CDS (49.1%) could be used for further analyses with the optimal deterministic mapping method (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 4</xref>). In contrast, applying PRICE allowed us to utilize more than 94% of the CDS mapped reads as signal and increased the signal-to-noise ratio from 6.3 to more than 18 (<xref ref-type="fig" rid="F1">Fig. 1b</xref>). Similar improvements were achieved when reanalyzing various published Ribo-seq data from other labs (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 5</xref>). This included data from different organisms and experimental systems (<xref ref-type="supplementary-material" rid="SD3">Supplementary Table 1</xref>), which all strongly benefitted in signal-to-noise ratios and the total amount of usable reads.</p>
  <p id="P7">We next assessed the reproducibility of different kinds of sORFs in two Ribo-seq experiments<xref rid="R13" ref-type="bibr">13</xref>,<xref rid="R14" ref-type="bibr">14</xref>. The performance of PRICE was compared with 6 previously published Ribo-seq analysis methods<xref rid="R6" ref-type="bibr">6</xref>–<xref rid="R11" ref-type="bibr">11</xref>. Only PRICE was able to reproducibly identify uORFs/uoORFs with the expected distribution of start codons. In addition, it was the only method able to reliably identify many uORFs/uoORFs with both canonical AUG initiation and non-canonical start codons (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 6 and 7</xref>). Of note, PRICE was &gt;30-50 fold faster than the other method in analyzing both data sets (<xref ref-type="supplementary-material" rid="SD3">Supplementary Table 2</xref>), enabling Ribo-seq data analysis without special hardware.</p>
  <p id="P8">To experimentally assess the sensitivity and specificity of our new approach, we prepared a database containing all ORFs identified by PRICE, ORF-RATER and Rp-Bp in primary human fibroblasts for validation by mass spectrometry. The number of peptides, which originated from the sORFs in our database still remained substantially underrepresented in a large published set of whole cell proteome data from primary human fibroblasts<xref rid="R15" ref-type="bibr">15</xref> (<xref ref-type="fig" rid="F1">Fig. 1c</xref>; <xref ref-type="supplementary-material" rid="SD4">Supplementary Table 3</xref>). Their detection did not exceed the false-discovery rate (FDR) of 1% used for peptide identification, which effectively renders this kind of whole proteome mass-spec data useless for the validation of sORF expression (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 8</xref>).</p>
  <p id="P9">Peptide presentation by MHC-I is thought to mainly depend on translation rates rather than overall protein abundance<xref rid="R16" ref-type="bibr">16</xref>. We thus screened a published (called data set 1) and a newly obtained MHC-I peptidome data set (called data set 2) from primary human fibroblasts<xref rid="R17" ref-type="bibr">17</xref> with our database. While peptides identified based on the sORFs predicted by ORF-RATER and Rp-Bp again did not significantly exceed the FDR, the sensitivity of PRICE was substantially higher (2x and 4x compared to ORF-RATER and Rp-Bp, respectively; <xref ref-type="fig" rid="F1">Fig. 1c</xref>) and significantly exceeded the FDR. Of note, almost all of the validated ORFs identified by ORF-RATER and Rp-Bp were also identified by PRICE confirming its high sensitivity.</p>
  <p id="P10">To assess the specificity of sORFs identification, we compared the percentage of validated peptides among all possible peptides from identified ORFs with their respective translation rates obtained by Ribo-seq. For large annotated ORFs, the number of validated peptides in both the whole proteome (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 8b</xref>) and the MHC-I peptidome (<xref ref-type="fig" rid="F1">Fig. 1d</xref>) increased with stronger translation. In the MHC-I peptidome, validation rates for sORFs identified by PRICE (but not any of the other algorithms) accounted for up to one third of the validation rate of large proteins (<xref ref-type="fig" rid="F1">Fig. 1d</xref>) in two independent experiments (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 9</xref>). Therefore, sORFs-derived peptides are efficiently presented by MHC-I in a translation rate- but not abundance-dependent manner. Of note, similar to the MHC-I-associated peptides originating from the annotated cellular proteins, sORF-derived peptides showed high predicted binding affinities<xref rid="R18" ref-type="bibr">18</xref> to the HLA allotypes (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 10</xref>). Incorporation of sORF-derived peptides into MHC-I thus appears to follow the same rules as observed for large ORFs and provides compelling evidence that the bulk of these cryptic gene products do not represent artifacts of Ribo-seq experiments. Interestingly, MHC-I presentation is thought to predominantly arise from so-called ‘defective ribosomal products’ (DRiPs), which are rapidly degraded upon translation by the proteasome<xref rid="R16" ref-type="bibr">16</xref>. Our findings highlight striking similarities of DRiPs and sORFs suggesting that efficient targeting of sORF-derived proteins/peptides into the DRiPs pathway may contribute to their low abundance within the cellular proteome.</p>
  <p id="P11">We used our validated approach to refine the annotation of the HCMV translatome<xref rid="R14" ref-type="bibr">14</xref>. In contrast to the original analysis of the Ribo-seq data (157 of 168 ORFs), PRICE recovered all 168 ORFs of the reference annotation. Furthermore, we confirmed more than half (248/480) of the novel ORFs identified in Ref. <xref rid="R14" ref-type="bibr">14</xref> and identified an additional 528 putative ORFs that were previously not detected (<xref ref-type="fig" rid="F2">Fig. 2a</xref>). Of the 232 novel ORFs not recovered by PRICE, 141 were identified as noise, the remaining 91 did not show a clear signature of active translation (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 11a</xref>). The start codon distributions of the different sets of putative ORFs clearly show that majority of PRICE identified ORFs but not the ORFs discarded by PRICE indeed result from actively translating ribosomes (<xref ref-type="fig" rid="F2">Fig. 2b-c</xref>).</p>
  <p id="P12">It is important to note that, albeit showing a clear signature of active translation, about two-thirds of the 528 novel ORFs were expressed at low levels (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 11b</xref>). The functional role of many of these novel ORFs is therefore questionable. We also identified numerous novel large ORFs (&gt;100aa) with low translation rates (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 11b</xref>). This is indicative of negative selection against the introduction of stop codons in the HCMV genome and strongly suggests that these indeed are, or once have been functional in the evolution of the virus.</p>
  <sec sec-type="methods" id="S1" specific-use="web-only">
    <title>Online Methods</title>
    <sec id="S2">
      <title>Read mapping</title>
      <p id="P13">All annotations used in this study are based on Ensembl 75. Reads were mapped using Bowtie 1.0<xref rid="R19" ref-type="bibr">19</xref> to rRNA, genomic and transcriptomic sequences. rRNA reads and reads mapping to the mitochondrial genome were discarded, transcriptomic alignments preferred over genomic alignments. All alignments were mapped to genomic coordinates. Ambiguous alignments (w.r.t. genomic coordinates) were resolved using an adapted RESCUE procedure<xref rid="R20" ref-type="bibr">20</xref>. Briefly, for each multimapping read, we assess the number of reads mapping uniquely and close to each potential mapping site. For clear-cut cases, reads are mapped to one of the potential sites (e.g. no other reads at the other potential sites), in all other cases, reads are mapped to all sites and fractional counts are used (see <xref ref-type="supplementary-material" rid="SD3">Supplementary Note 1</xref>).</p>
    </sec>
    <sec id="S3">
      <title>Inference of model parameters</title>
      <p id="P14">Reads uniquely mapping within coding sequences and not overlapping a start or stop codon were collected. We define the frame of a read as the position of the first annotated codon within the read. If a read mapped to more than one isoform in different frames, it was discarded. We counted the three frames for each read class characterized by read length and 5’ mismatch state, which are the sufficient statistics for our EM algorithm that determines the maximum likelihood parameters <italic>θ</italic> = (<italic>a</italic>, <italic>u</italic><sub>1</sub>, …, <italic>u<sub>M</sub></italic>, <italic>d</italic><sub>1</sub>, …, <italic>d<sub>M</sub></italic>) of the following model (see <xref ref-type="supplementary-material" rid="SD3">Supplementary Note 2</xref> for details): <disp-formula id="FD1"><mml:math display="block" id="M1" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi><mml:mo>;</mml:mo><mml:mi>R</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∏</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>∈</mml:mo><mml:mi>R</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>F</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mi>p</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mi>p</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula>
<italic>a</italic> is the probability of an untemplated 5’ nucleotide addition, <italic>u<sub>p</sub></italic> and <italic>d<sub>p</sub></italic> are the cleavage probabilities at distance <italic>p</italic> from the P site codon. <italic>R</italic> is the set of all reads, and <italic>F<sub>r</sub></italic> are the potential codon positions in a read <italic>r</italic> according to the annotation.</p>
    </sec>
    <sec id="S4">
      <title>Codon inference</title>
      <p id="P15">Based on the inferred model parameters <italic>θ</italic>, activity values of all contained codons <italic>C</italic> are estimated for observed reads <italic>R</italic> within a chunk of the genome by maximizing the likelihood of the following model: <disp-formula id="FD2"><mml:math display="block" id="M2" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>C</mml:mi><mml:mo>;</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>R</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∏</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>∈</mml:mo><mml:mi>R</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula> Here, <italic>a<sub>c</sub></italic> is the activity of codon <italic>c</italic>, and <italic>p<sub>r,c</sub></italic> is the probability that a ribosome at codon <italic>c</italic> has generated read <italic>r</italic>, which can be directly computed from <italic>θ</italic> (see <xref ref-type="supplementary-material" rid="SD3">Supplementary Note 3</xref> for details).</p>
    </sec>
    <sec id="S5">
      <title>Regularization</title>
      <p id="P16">We use a greedy strategy to seek a sparse solution of codons: First, the maximum likelihood solution is identified by the EM algorithm (see <xref ref-type="supplementary-material" rid="SD3">Supplementary Note 3</xref>). Then, we check for each codon, starting from the weakest to the most active, whether the decrease in the log likelihood without this codon is smaller than a parameter δ, in which case the codon is removed. δ can be specified by the user or determined automatically by simulating reads from the model with a specific amount of off-frame reads and choosing δ such that the off-frame reads are still recognized as such (in this study we used 10% off-frame reads).</p>
    </sec>
    <sec id="S6">
      <title>Start codon prediction</title>
      <p id="P17">First, annotated ORFs were sorted according to their mean activity (geometric mean after removing zero-activity codons). Then, in bins of 1000 ORFs, a logistic regression model was trained based on the annotated start codons (positive set) and five random positions within the ORF (negative set). For each ORF, activity values from each sample were transformed using the arcsine function for variance stabilization and divided by the maximal value, providing the features for regression. To incorporate the massive difference between the start codon and the codons upstream, we used the <italic>range-score</italic> (sum of activities of the 10 codons downstream of the start codon including the start codon, divided by the sum of activities of codons +/- 10 codons around the start codon) as an additional feature for regression. To predict start codons, the probability from the logistic regression was computed for each codon in an ORF candidate and divided by the maximal probability. This was multiplied by a factor penalizing start codon candidates for which less than 60% of the total activity was downstream of the start codon (see <xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 12</xref>), providing the final score for start codon prediction. All codons admissible by their sequence (here, AUG and all codons with one mismatch to AUG), that exceeded a minimal score (here: 0.1), were considered as start codon candidates.</p>
    </sec>
    <sec id="S7">
      <title>Generating ORF candidates</title>
      <p id="P18">First, a set of transcripts from the annotation was determined that is sufficient to explain most of the active codons. In a greedy fashion, the transcript explaining most of the remaining (still unexplained) reads is added to this set and this procedure is stopped if there is no transcript having at least 5 unexplained reads. Based on the sequence, ORF candidates are generated from each transcript and filtered based on minimal criteria indicative for active translation (ending at a stop codon, not having an in-frame stop-codon, at least 5 reads, at least 25% of the codons active).</p>
    </sec>
    <sec id="S8">
      <title>Candidate filtering</title>
      <p id="P19">All generated ORF candidates are first filtered according to two criteria: First, the number of active codons must exceed a minimal number as inferred from annotated ORFs with similar translation strength. Specifically, a threshold for activity was computed as 10% of the geometric mean <italic>g</italic> of all codon activities (after removing zero activity codons) for all annotated ORFs. One smoothing spline was fit to the graph of <italic>g</italic> against the fraction of codons over this threshold for each annotated ORF (see <xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 13a-b</xref>), and one to <italic>g</italic> against the squared residuals from the first smoothing spline. For a specific ORF candidate with geometric mean <italic>g</italic> the minimal number of active codons was computed as the 5% quantile of the beta distribution with mean and variance obtained from the two splines. Second, ORFs where the total activity of the first five codons was much higher than the total activity of subsequent codons were filtered as abortive translation events. Specifically, we computed the empirical distribution of log<sub>2</sub> fold changes between the average activity of the first five codons and the average of subsequent codons for annotated ORFs. ORF candidates were filtered if their corresponding log<sub>2</sub> fold change was less than the 1% quantile of the empirical distribution.</p>
    </sec>
    <sec id="S9">
      <title>Generalized binomial test</title>
      <p id="P20">To test for ORF candidates being due to noise, we again computed the number of codons exceeding 10% of the geometric mean of codon activities. With no overlapping ORF the probability of a codon to be due to noise was estimated from the upstream, downstream and off-frame region and a p value was computed using the binomial distribution. Specifically, for a specific set of codons <italic>S</italic>, |<italic>S</italic>| = <italic>n</italic>, we computed the number <italic>k</italic> of codons exceeding the 10% cut-off and estimate the noise probability as <inline-formula><mml:math display="inline" id="M3" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula> The pseudocounts used here correspond to a beta prior distribution similar to the estimation of fold-changes in RNA-seq experiments<xref rid="R21" ref-type="bibr">21</xref>. This provides a function <italic>p</italic>(<italic>S</italic>), that maps any set of codons to a noise probability. The noise probability used for the binomial test is max {<italic>p</italic>(<italic>U</italic><sub>1</sub>), …, <italic>p</italic>(<italic>U<sub>k</sub></italic>), <italic>p</italic>(<italic>D</italic><sub>1</sub>), …, <italic>p</italic>(<italic>D</italic><sub>l</sub>), <italic>p</italic>(<italic>O</italic>)}. For an ORF candidate o of length <italic>n</italic> amino acids, the <italic>U<sub>i</sub></italic> contains the 3<italic>n</italic> codons from all three frames upstream of o with respect to transcript i (1 ≤ <italic>i</italic> ≤ <italic>k</italic>). <italic>D<sub>i</sub></italic> contains the 3<italic>n</italic> codons from all three frames downstream of o, and <italic>O</italic> contains the 2<italic>n</italic> off-frame codons of o. With overlapping ORFs, the situation is a bit more complex for both the hypothesis test and the estimate of noise probabilities. First, if an ORF q overlaps with o, then the test also has to respect that a codon exceeding the chosen cut-off in o may be due to q. Thus, the binomial probability is 1 − (1 − <italic>p<sub>n</sub></italic>)(1 − <italic>p<sub>q</sub></italic>), where <italic>p<sub>n</sub></italic> is the noise probability as before, and <italic>p<sub>q</sub></italic> is computed by a similar approach as for the filter for the minimal number of active codons. Specifically, for all annotated ORFs, a smoothing spline is fitted to the graph of the geometric means of all non-zero codons activities against the fraction of codons exceeding the current cut-off for o, and <italic>p<sub>q</sub></italic> is value of this spline for the geometric mean of q (see <xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 13c-f</xref>). If q and o overlap only partly, or there are several overlapping ORFs, the binomial probability is not the same for each of the <italic>n</italic> codons of o. Therefore, the p value is computed using the generalized binomial distribution that allows <italic>n</italic> distinct success probabilities using an efficient algorithm<xref rid="R22" ref-type="bibr">22</xref>. Moreover, the function <italic>p</italic>(<italic>S</italic>) does not only count codons in <italic>S</italic> exceeding or not exceeding the cut-off, but respects ORFs giving rise to active codons in <italic>S</italic> when there are overlapping ORFs. Specifically, for each <italic>s</italic> ∈ <italic>S</italic>, the probability <italic>p<sub>s</sub></italic> of being explained by an overlapping ORF is computed as <italic>p<sub>s</sub></italic> = 1 − (1 − <italic>p</italic><sub>0</sub>)(1 − <italic>p</italic><sub>1</sub>)(1 − <italic>p</italic><sub>2</sub>). <italic>p</italic><sub>0</sub>, <italic>p</italic><sub>1</sub> and <italic>p</italic><sub>2</sub> are the probabilities of the codon to be explained by an in-frame codon (<italic>p</italic><sub>0</sub> = 1, if there is an in-frame overlapping ORF), or by an off-frame codon (estimated from smoothing splines like <italic>p<sub>q</sub></italic>). The expected number of unexplained codons over the cut-off in <italic>S</italic> then is <inline-formula><mml:math display="inline" id="M4" overflow="scroll"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>o</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>S</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:msubsup><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mspace width="0.1em"/><mml:mtext>max</mml:mtext><mml:mspace width="0.1em"/><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula> where <italic>k</italic> is the total number of codons exceeding the cut-off and <italic>f</italic> is the probability mass function of the generalized binomial distribution with parameters {<italic>p<sub>s</sub></italic>|<italic>s</italic> ∈ <italic>S</italic>}. Likewise, the expected number of codons not exceeding the cut-off is <inline-formula><mml:math display="inline" id="M5" overflow="scroll"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>S</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:msubsup><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mspace width="0.1em"/><mml:mtext>max</mml:mtext><mml:mspace width="0.1em"/><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mrow><mml:mo>|</mml:mo><mml:mi>S</mml:mi><mml:mo>|</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mstyle><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula> Thus <inline-formula><mml:math display="inline" id="M6" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>o</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>o</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula></p>
    </sec>
    <sec id="S10">
      <title>Isoform deconvolution</title>
      <p id="P21">Due to alternative splicing, predicted ORFs may also overlap partly in-frame, i.e. there may be codons that are shared between two or more ORFs. This gives rise to the same problem existing in RNA-seq, where many observed reads could be generated by more than one isoform. Thus, this is a well studies problem<xref rid="R23" ref-type="bibr">23</xref>. PRICE uses a widely adopted EM algorithm to deconvolute the contributions of ORFs to such codons, which maximizes the following likelihood: <disp-formula id="FD3"><mml:math display="block" id="M7" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∏</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>o</mml:mi><mml:mo>∈</mml:mo><mml:mi>O</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>o</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>o</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>o</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:math></disp-formula>
<italic>C</italic> is the set of all codons, <italic>α<sub>c</sub></italic> is the estimated amount of reads mapped to codon <italic>c</italic>, <italic>O</italic> is the set of ORFs, <italic>A<sub>c,o</sub></italic> an indicator whether ORF<italic>o</italic> contains codon <italic>c</italic>, and <italic>l<sub>o</sub></italic> the length of ORF <italic>o</italic> in codons. The parameter that is estimated with maximum likelihood by the EM are the <italic>p<sub>o</sub></italic>, the probabilities of generating a ribosome footprint for ORF <italic>o</italic>.</p>
    </sec>
    <sec id="S11">
      <title>Comparative analysis</title>
      <p id="P22">The HSV-1 Ribo-seq data set was of better quality (according to their signal-to-noise ratio, see <xref ref-type="fig" rid="F2">Fig. 2e</xref>) than the HCMV data set. Therefore, we reasoned that the ratio of the number of ORFs, which were identified in the HCMV data set (called the test data set) and reproducibly identified in the HSV-1 data set (called the reference data set), to the number of ORFs, which were only identified in the HCMV data set, is a measure for the overall reproducibility of a Ribo-seq analysis method across laboratories. An ORF was assumed reproducible, if the ORF in the HSV-1 data set showed the same stop codon, and if both ORFs were consistent with respect to introns (i.e. no intronic base pair of one ORF was present in an exon of the other ORF). This prevented the analysis to over-emphasize the prediction of the correct start codon, which is difficult for all methods not utilizing Harringtonin or Lactimidomycin data. For the inner-laboratory comparison we used the better of the two HSV-1 replicates as the reference data set and the other biological replicate as the test data set. All methods were used with default parameters and applied on the same bam files as PRICE, with the exception of Rp-Bp, which uses its own pipeline including read mapping. For Rp-Bp, we extracted all mapped reads from the respective bam files and re-appended the sequencing adapter. The Rp-Bp pipeline was then run on the corresponding fastq files. We allowed for “NTG” start codons and used the default cutoff for Bonferroni corrected p values (1%) to call ORFs. We ran ORF-RATER according to the manual, allowing for all start codons with at most one mismatch to ATG and, by default, used an 80% cutoff on the posterior probability. RibORF is not able to infer ORFs by itself, but only to score a given set of ORFs. We therefore identified all potential uORFs and uoORFs starting from start codons with at most one mismatch to ATG according to Ensembl v75, and supplied a Genpred file containing all protein coding Ensembl ORFs and the potential uORFs and uoORFs. The same is true for SPECtre, that included the computation of FLOSS and ORFScore, where we had to supply custom annotation in GTF format. For RibORF, SPECtre, FLOSS and ORFScore, score cutoffs were chosen such that the number of uORFs+uoORFs was 1000 in the test data set. We used the same cutoff for the reference data set, respectively. The offset parameters that had to be supplied to RibORF and SPECtre were taken from the study describing the HCMV data<xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R14" ref-type="bibr">14</xref> and determined according to the optimal deterministic strategy described above for the HSV-1 data. Furthermore, except for Fig. 4a, before determining the cutoff, we removed all ORFs with an in-frame ratio (number of reads mapped to in-frame codons divided by number of reads mapped out-of-frame but within the ORF) below 50%, as previously suggested<xref rid="R5" ref-type="bibr">5</xref>.</p>
    </sec>
    <sec id="S12">
      <title>Signal and noise</title>
      <p id="P23">After mapping of reads to codons by any method, the signal is defined as the total number of reads mapping to in-frame codons of an annotated ORF (Ensembl 75). Noise is defined as the total number of reads mapping to annotated ORFs out-of-frame.</p>
    </sec>
    <sec id="S13">
      <title>Statistical tests</title>
      <p id="P24">The binomial tests for <xref ref-type="fig" rid="F2">Fig. 2b-c</xref> were computed as
follows: Let <italic>n<sub>P</sub></italic>(<italic>c</italic>) be the number of
ORFs starting with codon <italic>c</italic> identified by PRICE (or
Stern-Ginossar et al.) and <italic>n<sub>b</sub></italic>(<italic>c</italic>)
the number of ORFs identified by both PRICE and Stern-Ginossar et al. Under the
null hypothesis that there is no difference in codon distributions between ORFs
identified by PRICE (or Stern-Ginossar et al.) only and by both,
<italic>n<sub>P</sub></italic>(<italic>c</italic>) is binomially
distributed with parameters <italic>n</italic> =
<italic>n<sub>p</sub></italic>(<italic>c</italic>) +
<italic>n<sub>b</sub></italic>(<italic>c</italic>) and
<inline-formula><mml:math display="inline" id="M8" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:msup><mml:mi>c</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>c</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:msup><mml:mi>c</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>c</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mstyle><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>c</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula> The p value was computed by the pbinom function
of R (version 3.3.2). The combined p values were computed using Fisher’s
method by computing the cumulative distribution function of the
<italic>χ</italic><sup>2</sup> distribution with 20 degrees of
freedom (2 times the number of p values) for −2 ⋅
Σ<italic>i</italic> log (<italic>p<sub>i</sub></italic>) (where the
<italic>p<sub>i</sub></italic> are the p values of the binomial tests
for all relevant codons).</p>
    </sec>
    <sec id="S14">
      <title>Mass spectrometry</title>
      <p id="P25">For the MHC-I peptidome data set 2, HLA class I ligands were isolated from 1ml cell pellets of mock treated or HCMV-infected HF99-7 human foreskin fibroblasts (HF99-7, HLA-A*01:01, A*03:01, B*08:01, B*51:01, C*07:01, C*01:02) by standard immunoaffinity purification using the pan-HLA class I-specific mAb W6/32 as described previously<xref rid="R24" ref-type="bibr">24</xref>. Sample shares of 20% were analyzed in technical triplicates by LC-MS/MS. Peptides were separated by nanoflow HPLC (RSLCnano, Thermo Fisher Scientific) using a 50 μm x 25 cm Acclaim PepMap C18 column (Thermo Fisher Scientific) and a linear gradient ranging from 2.4% to 32.0% acetonitrile over the course of 90 min. Eluted peptides were analyzed in an online-coupled Orbitrap Fusion Lumos mass spectrometer (Thermo Fisher Scientific) using a data dependent “top speed” collision-induced dissociation fragmentation method. FT MS2 spectra for 2+ and 3+ precursors of 400-650 m/z were acquired at 30k resolution with AGC target values of 70,000 and maximum injection times of 150ms. Normalized collision energy was set to 35%, dynamic exclusion time was set to 7s. The published MHC-I peptidome data set was obtained from the PRIDE repository (PXD000394). The whole proteome data was the same as used in Ref. <xref rid="R15" ref-type="bibr">15</xref>. All mass spectrometry data were analyzed using MaxQuant<xref rid="R25" ref-type="bibr">25</xref> 1.5.8.3 by using the same set of parameters as in Ref. <xref rid="R17" ref-type="bibr">17</xref> with the exception that we used a sequence database composed of the human proteome from Ensembl v75, the HCMV proteome (NC_006273) and translated ORFs identified by PRICE, Rp-Bp or ORF-RATER in any of the HSV-1 or HCMV data set. We considered only cellular ORFs and used a FDR of 1% using the target-decoy approach based on “reverted” proteins implemented in MaxQuant.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="SM">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>Reporting Summary</label>
      <media xlink:href="NIHMS76223-supplement-1.pdf" mimetype="application" mime-subtype="pdf" orientation="portrait" xlink:type="simple" id="d36e1491" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>Supplementary Figures 1-13</label>
      <media xlink:href="NIHMS76223-supplement-Supplementary_Figures_1-13.doc" mimetype="application" mime-subtype="msword" orientation="portrait" xlink:type="simple" id="d36e1495" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD3">
      <label>Supplementary Notes 1-3 and Tables 1-2</label>
      <media xlink:href="NIHMS76223-supplement-Supplementary_Notes_1-3_and_Tables_1-2.pdf" mimetype="application" mime-subtype="pdf" orientation="portrait" xlink:type="simple" id="d36e1499" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD4">
      <label>Supplementary Table 3</label>
      <media xlink:href="NIHMS76223-supplement-Supplementary_Table_3.xlsx" mimetype="application" mime-subtype="octet-stream" orientation="portrait" xlink:type="simple" id="d36e1503" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S15">
    <title>Acknowledgments</title>
    <p>This work was funded by MRC Clinical Fellowship grant G1002523, NHSBT grant WP11-05 and the European Research Council (grant ERC-2016-CoG 721016 – HERPES) to LD and a Wellcome Trust Senior Clinical Research Fellowship 108070/Z/15/Z to MPW. RZ acknowledges partial funding from the DFG (SFB 1123) and from Bavaria (BioSysNet). We would like to thank Stan Gorsky for critically reading the manuscript.</p>
  </ack>
  <fn-group>
    <fn id="FN1">
      <p id="P26">
        <bold>Data availability statement.</bold>
      </p>
      <p id="P27">The MHC-I peptidome data have been deposited to the ProteomeXchange Consortium via the PRIDE partner repository with the dataset identifier PXD007203.</p>
    </fn>
    <fn id="FN2">
      <p id="P28">
        <bold>Life Sciences Reporting Summary.</bold>
      </p>
      <p id="P29">Further information on experimental design is available in the <xref ref-type="supplementary-material" rid="SD1">Life Sciences Reporting Summary</xref>.</p>
    </fn>
    <fn id="FN3">
      <p id="P30">
        <bold>Code availability statement.</bold>
      </p>
      <p id="P31">Our software implementation is available under open source license (Apache 2.0) on github and available via <ext-link ext-link-type="uri" xlink:href="http://software.erhard-lab.de">http://software.erhard-lab.de</ext-link>. Release version “Price 1.0.1” was used in this report.</p>
    </fn>
    <fn fn-type="con" id="FN4">
      <p id="P32">
        <bold>Author contributions</bold>
      </p>
      <p id="P33">F.E. designed and implemented the computational approach. R.Z. supervised the development of the computational methods. A.H., C.Z., D.J.K. and S.S. provided the MHC-I peptidome analysis. M.P.W. provided whole proteome mass-spec data. A.L. provided Ribo-seq data utilized for the validation of this approach. F.E. and L.D. designed the experiments and wrote the paper.</p>
    </fn>
    <fn fn-type="COI-statement" id="FN5">
      <p id="P34">
        <bold>Competing financial interests</bold>
      </p>
      <p id="P35">D.J.K. is an employee of Immatics Biotechnologies GmbH.</p>
    </fn>
  </fn-group>
  <ref-list>
    <ref id="R1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ingolia</surname>
            <given-names>NT</given-names>
          </name>
          <name>
            <surname>Ghaemmaghami</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Newman</surname>
            <given-names>JRS</given-names>
          </name>
          <name>
            <surname>Weissman</surname>
            <given-names>JS</given-names>
          </name>
        </person-group>
        <source>Science</source>
        <year>2009</year>
        <volume>324</volume>
        <fpage>218</fpage>
        <lpage>223</lpage>
        <pub-id pub-id-type="pmid">19213877</pub-id>
      </element-citation>
    </ref>
    <ref id="R2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ingolia</surname>
            <given-names>NT</given-names>
          </name>
        </person-group>
        <source>Cell</source>
        <year>2016</year>
        <volume>165</volume>
        <fpage>22</fpage>
        <lpage>33</lpage>
        <pub-id pub-id-type="pmid">27015305</pub-id>
      </element-citation>
    </ref>
    <ref id="R3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gao</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Nat Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <fpage>147</fpage>
        <lpage>153</lpage>
        <pub-id pub-id-type="pmid">25486063</pub-id>
      </element-citation>
    </ref>
    <ref id="R4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ingolia</surname>
            <given-names>NT</given-names>
          </name>
          <name>
            <surname>Lareau</surname>
            <given-names>LF</given-names>
          </name>
          <name>
            <surname>Weissman</surname>
            <given-names>JS</given-names>
          </name>
        </person-group>
        <source>Cell</source>
        <year>2011</year>
        <volume>147</volume>
        <fpage>789</fpage>
        <lpage>802</lpage>
        <pub-id pub-id-type="pmid">22056041</pub-id>
      </element-citation>
    </ref>
    <ref id="R5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Calviello</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Nat Methods</source>
        <year>2016</year>
        <volume>13</volume>
        <fpage>165</fpage>
        <lpage>170</lpage>
        <pub-id pub-id-type="pmid">26657557</pub-id>
      </element-citation>
    </ref>
    <ref id="R6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chun</surname>
            <given-names>SY</given-names>
          </name>
          <name>
            <surname>Rodriguez</surname>
            <given-names>CM</given-names>
          </name>
          <name>
            <surname>Todd</surname>
            <given-names>PK</given-names>
          </name>
          <name>
            <surname>Mills</surname>
            <given-names>RE</given-names>
          </name>
        </person-group>
        <source>BMC Bioinformatics</source>
        <year>2016</year>
        <volume>17</volume>
        <fpage>482</fpage>
        <pub-id pub-id-type="pmid">27884106</pub-id>
      </element-citation>
    </ref>
    <ref id="R7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ingolia</surname>
            <given-names>NT</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Cell Rep</source>
        <year>2014</year>
        <volume>8</volume>
        <fpage>1365</fpage>
        <lpage>1379</lpage>
        <pub-id pub-id-type="pmid">25159147</pub-id>
      </element-citation>
    </ref>
    <ref id="R8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bazzini</surname>
            <given-names>AA</given-names>
          </name>
          <etal/>
        </person-group>
        <source>EMBO J</source>
        <year>2014</year>
        <volume>33</volume>
        <fpage>981</fpage>
        <lpage>993</lpage>
        <pub-id pub-id-type="pmid">24705786</pub-id>
      </element-citation>
    </ref>
    <ref id="R9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ji</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Song</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Struhl</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <source>eLife</source>
        <year>2015</year>
        <volume>4</volume>
      </element-citation>
    </ref>
    <ref id="R10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Malone</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Nucleic Acids Res</source>
        <year>2017</year>
        <pub-id pub-id-type="doi">10.1093/nar/gkw1350</pub-id>
      </element-citation>
    </ref>
    <ref id="R11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fields</surname>
            <given-names>AP</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Mol Cell</source>
        <year>2015</year>
        <volume>60</volume>
        <fpage>816</fpage>
        <lpage>827</lpage>
        <pub-id pub-id-type="pmid">26638175</pub-id>
      </element-citation>
    </ref>
    <ref id="R12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Nat Commun</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>1749</fpage>
        <pub-id pub-id-type="pmid">29170441</pub-id>
      </element-citation>
    </ref>
    <ref id="R13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rutkowski</surname>
            <given-names>AJ</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Nat Commun</source>
        <year>2015</year>
        <volume>6</volume>
        <fpage>7126</fpage>
        <pub-id pub-id-type="pmid">25989971</pub-id>
      </element-citation>
    </ref>
    <ref id="R14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stern-Ginossar</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Science</source>
        <year>2012</year>
        <volume>338</volume>
        <fpage>1088</fpage>
        <lpage>1093</lpage>
        <pub-id pub-id-type="pmid">23180859</pub-id>
      </element-citation>
    </ref>
    <ref id="R15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Weekes</surname>
            <given-names>MP</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Cell</source>
        <year>2014</year>
        <volume>157</volume>
        <fpage>1460</fpage>
        <lpage>1472</lpage>
        <pub-id pub-id-type="pmid">24906157</pub-id>
      </element-citation>
    </ref>
    <ref id="R16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yewdell</surname>
            <given-names>JW</given-names>
          </name>
        </person-group>
        <source>Trends Immunol</source>
        <year>2011</year>
        <volume>32</volume>
        <fpage>548</fpage>
        <lpage>558</lpage>
        <pub-id pub-id-type="pmid">21962745</pub-id>
      </element-citation>
    </ref>
    <ref id="R17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bassani-Sternberg</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pletscher-Frankild</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Jensen</surname>
            <given-names>LJ</given-names>
          </name>
          <name>
            <surname>Mann</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <source>Mol Cell Proteomics</source>
        <year>2015</year>
        <volume>14</volume>
        <fpage>658</fpage>
        <lpage>673</lpage>
        <pub-id pub-id-type="pmid">25576301</pub-id>
      </element-citation>
    </ref>
    <ref id="R18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Karosiene</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Lundegaard</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Lund</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Nielsen</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <source>Immunogenetics</source>
        <year>2012</year>
        <volume>64</volume>
        <fpage>177</fpage>
        <lpage>186</lpage>
        <pub-id pub-id-type="pmid">22009319</pub-id>
      </element-citation>
    </ref>
    <ref id="R19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Langmead</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Pop</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <source>Genome Biol</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>R25</fpage>
        <pub-id pub-id-type="pmid">19261174</pub-id>
      </element-citation>
    </ref>
    <ref id="R20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mortazavi</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>BA</given-names>
          </name>
          <name>
            <surname>McCue</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Schaeffer</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Wold</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <source>Nat Methods</source>
        <year>2008</year>
        <volume>5</volume>
        <fpage>621</fpage>
        <lpage>628</lpage>
        <pub-id pub-id-type="pmid">18516045</pub-id>
      </element-citation>
    </ref>
    <ref id="R21">
      <label>21</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Erhard</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Zimmer</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <source>Nucleic Acids Res</source>
        <year>2015</year>
        <volume>43</volume>
        <fpage>e136</fpage>
        <lpage>e136</lpage>
        <pub-id pub-id-type="pmid">26160885</pub-id>
      </element-citation>
    </ref>
    <ref id="R22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hong</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <source>Comput Stat Data Anal</source>
        <year>2013</year>
        <volume>59</volume>
        <fpage>41</fpage>
        <lpage>51</lpage>
      </element-citation>
    </ref>
    <ref id="R23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <source>ArXiv11043889 Q-Bio Stat</source>
        <year>2011</year>
        <comment>at &lt;<ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1104.3889">http://arxiv.org/abs/1104.3889</ext-link>&gt;</comment>
      </element-citation>
    </ref>
    <ref id="R24">
      <label>24</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kowalewski</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Stevanović</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <source>Methods Mol Biol Clifton NJ</source>
        <year>2013</year>
        <volume>960</volume>
        <fpage>145</fpage>
        <lpage>157</lpage>
      </element-citation>
    </ref>
    <ref id="R25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cox</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Mann</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <source>Nat Biotech</source>
        <year>2008</year>
        <volume>26</volume>
        <fpage>1367</fpage>
        <lpage>1372</lpage>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <title>The PRICE approach.</title>
      <p>(a) Schematic of the approach. Left: Bars represent parameters of the probabilistic model. Center: Translated codons are identified by solving the inverse problem of the model. Right: calling actively translated ORFs based on the generalized binomial distribution (for details see <xref ref-type="sec" rid="S1">Online Methods</xref>).</p>
      <p>(b) Approaches to map reads to codons are compared with respect to signal (total number of reads mapped in-frame) and the signal to noise ratio (noise: reads mapped out-of-frame to annotated ORFs). Colors represent deterministic mapping of read classes defined by length and 5’ mismatch state (red, grey), of combinations of read classes (blue; Basic: ignoring 5’ mismatches; Extended: considering 5’ mismatches; Top 4: combining the best read classes; see also <xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 4</xref>) and probabilistic mapping by PRICE (green).</p>
      <p>(c) Total amount of peptides detected in proteome and MHC-I peptidome mass spectrometry experiments (MHC-I peptidome data set 1; see <xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 9a</xref> for the other experiment). The 1% peptide identification FDR is indicated. Grey bars show the peptides from ORFs also identified by ORF-RATER or Rp-Bp (for PRICE) or ORFs also identified by PRICE (for ORF-RATER and Rp-Bp).</p>
      <p>d) Validation rates of peptides from predicted ORFs with a minimal number of reads per codon (MHC-I peptidome data set 2; see <xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 9b</xref> for the other experiment). Rates for all ORFs (solid lines) identified by the indicated methods and for ORFs predicted de-novo (dashed lines) are shown.</p>
    </caption>
    <graphic xlink:href="emss-76223-f001"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <title>Re-decoding human cytomegalovirus</title>
      <p>(a) Venn diagram comparing the indicated datasets. We merged N-terminal variants of ORFs ending at the same stop codon.</p>
      <p>(b) Comparison of the start codon distribution of 528 novel ORFs detected only by PRICE (light green) to the distribution of the 248 confirmed ORFs (turquois) (<italic>p</italic> ≈ 0.42, Fisher's combined probability test based on indicated one-sided binomial tests). Note that an ORF may have more than one start codon.</p>
      <p>(c) The start codon distribution of the 232 not confirmed ORFs (blue) and confirmed ORFs (turquoise) (<italic>p</italic> ≈ 3.2 × 10<sup>−5</sup>, Fisher's combined probability test based on indicated one-sided binomial tests).</p>
    </caption>
    <graphic xlink:href="emss-76223-f002"/>
  </fig>
</floats-group>
