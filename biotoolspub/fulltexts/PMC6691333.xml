<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6691333</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/bty1057</article-id>
    <article-id pub-id-type="publisher-id">bty1057</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MMseqs2 desktop and local web server app for fast, interactive sequence searches</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Mirdita</surname>
          <given-names>Milot</given-names>
        </name>
        <xref ref-type="aff" rid="bty1057-aff1">bty1057-aff1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Steinegger</surname>
          <given-names>Martin</given-names>
        </name>
        <xref ref-type="aff" rid="bty1057-aff1">bty1057-aff1</xref>
        <xref ref-type="aff" rid="bty1057-aff2">bty1057-aff2</xref>
        <xref ref-type="corresp" rid="bty1057-cor1"/>
        <!--<email>martin.steinegger@mpibpc.mpg.de</email>-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Söding</surname>
          <given-names>Johannes</given-names>
        </name>
        <xref ref-type="aff" rid="bty1057-aff1">bty1057-aff1</xref>
        <xref ref-type="corresp" rid="bty1057-cor1"/>
        <!--<email>soeding@mpibpc.mpg.de</email>-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Hancock</surname>
          <given-names>John</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <aff id="bty1057-aff1"><label>bty1057-aff1</label>Quantitative and Computational Biology, Max Planck Institute for Biophysical Chemistry, Göttingen, Germany</aff>
    <aff id="bty1057-aff2"><label>bty1057-aff2</label>Department of Chemistry, Seoul National University, Seoul, Korea</aff>
    <author-notes>
      <corresp id="bty1057-cor1">To whom correspondence should be addressed. Email: <email>martin.steinegger@mpibpc.mpg.de</email> or <email>soeding@mpibpc.mpg.de</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>8</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2019-01-07">
      <day>07</day>
      <month>1</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>07</day>
      <month>1</month>
      <year>2019</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>35</volume>
    <issue>16</issue>
    <fpage>2856</fpage>
    <lpage>2858</lpage>
    <history>
      <date date-type="received">
        <day>03</day>
        <month>9</month>
        <year>2018</year>
      </date>
      <date date-type="rev-recd">
        <day>17</day>
        <month>11</month>
        <year>2018</year>
      </date>
      <date date-type="accepted">
        <day>4</day>
        <month>1</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2019. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2019</copyright-year>
      <license license-type="cc-by" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="bty1057.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>The MMseqs2 desktop and web server app facilitates interactive sequence searches through custom protein sequence and profile databases on personal workstations. By eliminating MMseqs2’s runtime overhead, we reduced response times to a few seconds at sensitivities close to BLAST.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p>The app is easy to install for non-experts. GPLv3-licensed code, pre-built desktop app packages for Windows, MacOS and Linux, Docker images for the web server application and a demo web server are available at <ext-link ext-link-type="uri" xlink:href="https://search.mmseqs.com">https://search.mmseqs.com</ext-link>.</p>
      </sec>
      <sec id="s3">
        <title>Supplementary information</title>
        <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">European Research Council</named-content>
          <named-content content-type="funder-identifier">10.13039/100010663</named-content>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Horizon 2020 Framework Programme</named-content>
          <named-content content-type="funder-identifier">10.13039/100010661</named-content>
        </funding-source>
        <award-id>Virus-X</award-id>
        <award-id>685778</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>The most popular sequence similarity search tool, BLAST (<xref rid="bty1057-B1" ref-type="bibr">Altschul <italic>et al.</italic>, 1990</xref>, <xref rid="bty1057-B2" ref-type="bibr">1997</xref>), has garnered ∼7000 citations per year during the last 5 years, attesting to the unremitting importance of sequence searches for biology. This popularity may be largely owed to the excellent web services with short response times despite fast-growing databases provided by the NCBI/NIH, which requires a huge compute infrastructure. The distributed approach of running searches <italic>locally</italic> on personal computers or IT platforms of companies and research groups allows for custom databases, high availability and protects sensitive data. But web server applications for local homology searches are slow as they mostly rely on BLAST (e.g. <xref rid="bty1057-B4" ref-type="bibr">Deng <italic>et al.</italic>, 2007</xref>; <xref rid="bty1057-B8" ref-type="bibr">Priyam <italic>et al.</italic>, 2015</xref>). Here, we present an application software to search with protein and nucleotide sequences through custom protein sequence and profile databases using MMseqs2 (<xref rid="bty1057-B9" ref-type="bibr">Steinegger and Söding, 2017</xref>), achieving response times of seconds instead of minutes at a similar sensitivity as BLAST.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <sec>
      <title>2.1 Reduced runtime overhead</title>
      <p>MMseqs2 owes its sensitivity and speed mainly to its pre-filtering stage, which rejects ∼99.99% of sequences. The pre-filter uses a reverse <italic>k</italic>-mer index table for the target database and also requires matrices with similarity scores between 2-mers and between 3-mers to generate the lists of similar 7-mers (<xref rid="bty1057-B9" ref-type="bibr">Steinegger and Söding, 2017</xref>). Reading in the index table and computing these matrices on-the-fly takes ∼0.5 min of runtime overhead for each search. We reduced this to 0.05 s by (1) writing the index table, the matrices and other pre-computable data into a file if it does not yet exist, memory mapping the file to take advantage of the system page cache (for detailed memory requirements see <xref ref-type="supplementary-material" rid="sup1">Supplementary Materials</xref>) and (3) optimizing I/O operations.</p>
    </sec>
    <sec>
      <title>2.2 Optimized sequence-to-profile search mode</title>
      <p>The index table for profile databases stores, for each position in a profile, all <italic>k</italic>-mers with a profile similarity score above a threshold set by –<monospace>s</monospace>. The number of similar <italic>k</italic>-mers grows exponentially with <italic>k</italic>. To save memory, we chose a short <italic>k </italic>=<italic> </italic>5 as default for this mode. We also added to Mmseqs2 utilities for creating profiles from multiple sequence alignments (MSAs) and converting between profile formats.</p>
    </sec>
    <sec>
      <title>2.3 Desktop and web server app</title>
      <p>Based on the same code base, the application can be either deployed through Docker containers to be accessed through web browsers or packaged as a desktop GUI application with the Electron framework (electronjs.org). In either case, the backend part of the application provides a RESTful API and worker scheduling. The server supports protein, translated nucleotide and nucleotide sequence searches and iterative and reverse profile searches.</p>
      <p>The application takes a list of either protein or nucleotide sequences in FASTA/FASTQ format as query input. To generate a target search database, the application takes a FASTA/FASTQ file for protein sequence searches or a STOCKHOLM MSA file for protein profile searches. Search results are shown with a customized feature-viewer (github.com/calipho-sib/feature-viewer) (<xref ref-type="fig" rid="bty1057-F1">Fig. 1A</xref>) and can be downloaded in tabular BLAST format.
</p>
      <fig id="bty1057-F1" orientation="portrait" position="float">
        <label>Fig. 1.</label>
        <caption>
          <p>(<bold>A</bold>) Screenshots of the search interface and result visualization. (<bold>B</bold>) Runtime of searches with the baseline MMseqs2 (square) and the new server mode (circle) at four sensitivity settings (<monospace>-s</monospace>). (<bold>C</bold>) Domain annotation: Speedup versus sensitivity at 95% precision for MMseqs2 (triangle: sequence-profile search, upside-down triangle: sequence–sequence search; sensitivity settings: <monospace>-s 1, 3, 5, 7</monospace>), DIAMOND (square; <italic>default</italic>, <monospace>–sensitive</monospace>, <monospace>–more-sensitive</monospace>) and BLAST (circle). HMMER3 matches to Pfam domains are used as ground truth. The speed-ups exclude the times to format the databases </p>
        </caption>
        <graphic xlink:href="bty1057f1"/>
      </fig>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p><xref ref-type="fig" rid="bty1057-F1">Figure 1B</xref> demonstrates the reduction of runtime overhead by comparing the runtimes of the Mmseqs2 version without (‘baseline’) to the new version with pre-computations and memory mapping (‘server mode’). Runtimes refer to searches with amino acid query sets of 1, 10, 100, 1000 and 10 000 sequences of average length 350 (sampled from the Uniclust30 database) through the Uniclust30 2017_10 database (<xref rid="bty1057-B7" ref-type="bibr">Mirdita <italic>et al.</italic>, 2017</xref>) with 13.5 million sequences, measured on a server with 2 Intel Xeon E5-2680 v4 CPUs with 14 cores each. The index table and matrix pre-computation (∼3 min 40 s) is not included in the runtimes.</p>
    <p>To test the quality and speed of annotating Pfam domains on genes assembled from metagenomics data, we built a test set by sampling 100 000 full-length sequences longer than 150 residues from our Marine Eukaryotic Reference Catalogue (<xref rid="bty1057-B10" ref-type="bibr">Steinegger <italic>et al.</italic>, 2018</xref>), clustering this set to 30% maximum pairwise sequence identity with MMseqs2 and sampling 10 000 sequences from the redundancy-reduced set. We annotated these sequences with PfamA 31.0 domains (<xref rid="bty1057-B6" ref-type="bibr">Finn <italic>et al.</italic>, 2014</xref>) using HMMER3 (<xref rid="bty1057-B5" ref-type="bibr">Finn <italic>et al.</italic>, 2011</xref>).</p>
    <p>We then compared how well the sequence-sequence searches of MMseqs2, BLAST and DIAMOND (<xref rid="bty1057-B3" ref-type="bibr">Buchfink <italic>et al.</italic>, 2015</xref>) and the sequence-to-profile searches of MMseqs2 could find the correct domain annotations. For the sequence-sequence search methods, we built a database from all sequences in <monospace>PfamA.full</monospace> MSAs and reported as E-value of a Pfam domain the E-value for the best-matching sequence from its MSA. We defined a search as true positive (TP) if the top match was annotated by HMMER3 with an E-value better than 10<sup>−3</sup> and as false positive (FP) if the top match was not annotated with an HMMER3 E-value below 1. All other searches were considered ambiguous and ignored. For each method, we determined the E-value at which the precision TP/(TP+FP) is 95% and measured the sensitivity at that E-value.</p>
    <p>As <xref ref-type="fig" rid="bty1057-F1">Figure 1C</xref> shows, MMseqs2 sequence-to-profile searches are ∼30 times faster than sequence-sequence searches with DIAMOND, MMseqs2 and BLAST and ∼300 times faster than HMMER3. MMseqs2 sequence-to-profile searches reach 87% relative sensitivity at 95% precision, making them an attractive alternative to HMMER3 when speed is critical.</p>
  </sec>
  <sec>
    <title>4 Conclusion</title>
    <p>The desktop and web server app for MMseqs2 performs fast sequence searches at unprecedented speed-to-sensitivity trade-off on local computers. Thousand queries take only a minute to search through fifteen million sequences of the Uniclust30 database, much faster than NCBI’s BLAST website. We hope the MMseqs2 app will also empower users unfamiliar with command line interfaces to perform fast and sensitive searches with their own sequence and profile databases.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>bty1057_Supplementary_Data</label>
      <media xlink:href="bty1057_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ACK1">
    <title>Acknowledgements</title>
    <p>The authors thank Yuna Kwon for crafting the ‘little Marv’ mascot.</p>
    <sec>
      <title>Funding</title>
      <p>This work was supported by the European Research Council in the framework of its Horizon 2020 Framework Programme for Research and Innovation (grant ‘Virus-X’, project no. 685778).</p>
      <p><italic>Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <ref-list id="REF1">
    <title>References</title>
    <ref id="bty1057-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Altschul</surname><given-names>S.F.</given-names></name></person-group><etal>et al</etal> (<year>1990</year>) 
<article-title>Basic local alignment search tool</article-title>. <source>J. Mol. Biol</source>., <volume>215</volume>, <fpage>403</fpage>–<lpage>410</lpage>.<pub-id pub-id-type="pmid">2231712</pub-id></mixed-citation>
    </ref>
    <ref id="bty1057-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Altschul</surname><given-names>S.F.</given-names></name></person-group><etal>et al</etal> (<year>1997</year>) 
<article-title>Gapped BLAST and PSI-BLAST: a new generation of protein database search programs</article-title>. <source>Nucleic Acids Res</source>., <volume>25</volume>, <fpage>3389</fpage>–<lpage>3402</lpage>.<pub-id pub-id-type="pmid">9254694</pub-id></mixed-citation>
    </ref>
    <ref id="bty1057-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Buchfink</surname><given-names>B.</given-names></name></person-group><etal>et al</etal> (<year>2015</year>) 
<article-title>Fast and sensitive protein alignment using DIAMOND</article-title>. <source>Nat. Methods</source>, <volume>12</volume>, <fpage>59</fpage>–<lpage>60</lpage>.<pub-id pub-id-type="pmid">25402007</pub-id></mixed-citation>
    </ref>
    <ref id="bty1057-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Deng</surname><given-names>W.</given-names></name></person-group><etal>et al</etal> (<year>2007</year>) 
<article-title>Viroblast: a stand-alone blast web server for flexible queries of multiple databases and user’s datasets</article-title>. <source>Bioinformatics</source>, <volume>23</volume>, <fpage>2334</fpage>–<lpage>2336</lpage>.<pub-id pub-id-type="pmid">17586542</pub-id></mixed-citation>
    </ref>
    <ref id="bty1057-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Finn</surname><given-names>R.D.</given-names></name></person-group><etal>et al</etal> (<year>2011</year>) 
<article-title>HMMER web server: interactive sequence similarity searching</article-title>. <source>Nucleic Acids Res</source>., <volume>39</volume>, <fpage>W29</fpage>–<lpage>W37</lpage>.<pub-id pub-id-type="pmid">21593126</pub-id></mixed-citation>
    </ref>
    <ref id="bty1057-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Finn</surname><given-names>R.D.</given-names></name></person-group><etal>et al</etal> (<year>2014</year>) 
<article-title>Pfam: the protein families database</article-title>. <source>Nucleic Acids Res</source>., <volume>42</volume>, <fpage>D222</fpage>–<lpage>D230</lpage>.<pub-id pub-id-type="pmid">24288371</pub-id></mixed-citation>
    </ref>
    <ref id="bty1057-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Mirdita</surname><given-names>M.</given-names></name></person-group><etal>et al</etal> (<year>2017</year>) 
<article-title>Uniclust databases of clustered and deeply annotated protein sequences and alignments</article-title>. <source>Nucleic Acids Res</source>., <volume>45</volume>, <fpage>D170</fpage>–<lpage>D176</lpage>.<pub-id pub-id-type="pmid">27899574</pub-id></mixed-citation>
    </ref>
    <ref id="bty1057-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Priyam</surname><given-names>A.</given-names></name></person-group><etal>et al</etal> (<year>2015</year>) 
<article-title>Sequenceserver: a modern graphical user interface for custom BLAST databases</article-title>. <source>bioRxiv, 033142</source>.</mixed-citation>
    </ref>
    <ref id="bty1057-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Steinegger</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Söding</surname><given-names>J.</given-names></name></person-group> (<year>2017</year>) 
<article-title>MMseqs2 enables sensitive protein sequence searching for the analysis of massive data sets</article-title>. <source>Nat. Biotechnol</source>., <volume>35</volume>, <fpage>1026</fpage>–<lpage>1028</lpage>.<pub-id pub-id-type="pmid">29035372</pub-id></mixed-citation>
    </ref>
    <ref id="bty1057-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Steinegger</surname><given-names>M.</given-names></name></person-group><etal>et al</etal> (<year>2018</year>) 
<article-title>Protein-level assembly increases protein sequence recovery from metagenomic samples manyfold</article-title>. <source>bioRxiv, 386110</source>.</mixed-citation>
    </ref>
  </ref-list>
</back>
