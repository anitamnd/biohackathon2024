<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10918635</article-id>
    <article-id pub-id-type="pmid">38377397</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btae086</article-id>
    <article-id pub-id-type="publisher-id">btae086</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ARGprofiler—a pipeline for large-scale analysis of antimicrobial resistance genes and their flanking regions in metagenomic datasets</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-6733-7888</contrib-id>
        <name>
          <surname>Martiny</surname>
          <given-names>Hannah-Marie</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
        <xref rid="btae086-cor1" ref-type="corresp"/>
        <!--hanmar@food.dtu.dk-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pyrounakis</surname>
          <given-names>Nikiforos</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Petersen</surname>
          <given-names>Thomas N</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lukjančenko</surname>
          <given-names>Oksana</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Aarestrup</surname>
          <given-names>Frank M</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Clausen</surname>
          <given-names>Philip T L C</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Munk</surname>
          <given-names>Patrick</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Alkan</surname>
          <given-names>Can</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btae086-cor1">Corresponding author. Research Group for Genomic Epidemiology, Technical University of Denmark, Henrik Danms Alle, Bygning 204, Kongens Lyngby 2800, Denmark. E-mail: <email>hanmar@food.dtu.dk</email> (H.-M.M.)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>3</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-02-20">
      <day>20</day>
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>20</day>
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <volume>40</volume>
    <issue>3</issue>
    <elocation-id>btae086</elocation-id>
    <history>
      <date date-type="received">
        <day>10</day>
        <month>7</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>11</day>
        <month>12</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>01</day>
        <month>2</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>06</day>
        <month>3</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btae086.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Analyzing metagenomic data can be highly valuable for understanding the function and distribution of antimicrobial resistance genes (ARGs). However, there is a need for standardized and reproducible workflows to ensure the comparability of studies, as the current options involve various tools and reference databases, each designed with a specific purpose in mind.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>In this work, we have created the workflow ARGprofiler to process large amounts of raw sequencing reads for studying the composition, distribution, and function of ARGs. ARGprofiler tackles the challenge of deciding which reference database to use by providing the PanRes database of 14 078 unique ARGs that combines several existing collections into one. Our pipeline is designed to not only produce abundance tables of genes and microbes but also to reconstruct the flanking regions of ARGs with ARGextender. ARGextender is a bioinformatic approach combining KMA and SPAdes to recruit reads for a targeted <italic toggle="yes">de novo</italic> assembly. While our aim is on ARGs, the pipeline also creates Mash sketches for fast searching and comparisons of sequencing runs.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>The ARGprofiler pipeline is a Snakemake workflow that supports the reuse of metagenomic sequencing data and is easily installable and maintained at <ext-link xlink:href="https://github.com/genomicepidemiology/ARGprofiler" ext-link-type="uri">https://github.com/genomicepidemiology/ARGprofiler</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Novo Nordisk Foundation</institution>
            <institution-id institution-id-type="DOI">10.13039/501100009708</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>NNF16OC0021856</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Global Surveillance of Antimicrobial Resistance</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Union’s Horizon 2020</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="8"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>Investigating the resistome of metagenomic datasets, including the abundances of the different antimicrobial resistance genes (ARGs) and the gene synteny (gene flanking regions), has become a major research area in recent years (<xref rid="btae086-B20" ref-type="bibr">Holmes <italic toggle="yes">et al.</italic> 2016</xref>, <xref rid="btae086-B5" ref-type="bibr">Bengtsson-Palme <italic toggle="yes">et al.</italic> 2018</xref>, <xref rid="btae086-B19" ref-type="bibr">Hendriksen <italic toggle="yes">et al.</italic> 2019</xref>, <xref rid="btae086-B3" ref-type="bibr">Anthony <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btae086-B41" ref-type="bibr">Zhang <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btae086-B26" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022b</xref>, <xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>). In many cases, research investigation, especially on a large scale, has been limited to research groups that are technologically and financially able to combine large-scale data generation with advanced bioinformatic and modeling expertise. However, because of the good data-sharing practices of next-generation sequencing efforts, there are today a large number of sequencing datasets available in public repositories. We have recently provided a curated dataset of acquired ARG abundance estimates in more than 214 000 publicly available metagenomic datasets (<xref rid="btae086-B25" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022a</xref>).</p>
    <p>Processing these datasets in a uniform approach calls for optimized, standardized methods to support the broader scientific community in utilizing these datasets. The practice of sharing bioinformatic workflows, or pipelines, has not historically been part of the academic publishing process. However, with the growing volumes of biological sequencing data available, researchers have begun to publish their workflows. Recent examples include pangolin for tracing SARS-CoV2 lineages (<xref rid="btae086-B35" ref-type="bibr">O’Toole <italic toggle="yes">et al.</italic> 2021</xref>), RASflow for RNA sequencing data (<xref rid="btae086-B42" ref-type="bibr">Zhang and Jonassen 2020</xref>), and ATLAS for metagenomic sequencing data (<xref rid="btae086-B22" ref-type="bibr">Kieser <italic toggle="yes">et al.</italic> 2020</xref>).</p>
    <p>Here, we present ARGprofiler, a newly developed pipeline designed to analyze read dissimilarities, abundances, and genomic flanking regions of ARGs in metagenomic sequencing data (<xref rid="btae086-F1" ref-type="fig">Fig. 1</xref>). ARGprofiler has been adapted to work for short-read sequencing reads, where we have carefully evaluated each step in our metagenomic workflow. ARGprofiler includes the PanRes database, a combined collection of current ARG databases, and ARGextender, an assembly tool for producing targeted <italic toggle="yes">de novo</italic> assemblies. The pipeline is an easily usable and scalable workflow implemented in Snakemake (<xref rid="btae086-B23" ref-type="bibr">Köster and Rahmann 2012</xref>, <xref rid="btae086-B29" ref-type="bibr">Mölder <italic toggle="yes">et al.</italic> 2021</xref>), which allows any user to process sequencing data to perform epidemiological analyses of ARGs globally. ARGprofiler is another step toward enabling the reuse of metagenomic sequences, and while we have targeted antimicrobial resistance (AMR), the pipeline can be repurposed for other tasks.</p>
    <fig position="float" id="btae086-F1">
      <label>Figure 1.</label>
      <caption>
        <p>The ARGprofiler pipeline. This schematic illustrates the components of the pipeline: (a) Download of sequencing reads from ENA, (b) preprocessing of retrieved reads with fastp, (c) procedure of aligning reads against chosen reference sequence database(s) with KMA, (d) assembly of targeted flanking regions of antimicrobial resistance genes with ARGextender that passes requirements in a filtering step, and (e) sketching sequencing reads with Mash.</p>
      </caption>
      <graphic xlink:href="btae086f1" position="float"/>
    </fig>
  </sec>
  <sec sec-type="methods">
    <title>Methods</title>
    <sec>
      <title>Implementation of ARGprofiler</title>
      <p>ARGprofiler is a Snakemake workflow (<xref rid="btae086-B23" ref-type="bibr">Köster and Rahmann 2012</xref>) that is organized into five different parts: (i) download of metagenomic datasets, (b) trimming and quality check of sequencing reads, (iii) mapping and alignment of reads against reference sequences, including ARGs and bacteria, (iv) building of flanking regions around genes of interest, and (v) creation of Mash sketches (<xref rid="btae086-F1" ref-type="fig">Fig. 1</xref>). Mapping to bacteria is done to compare the ARG content to the bacterial composition, and Mash sketches to allow for searching for samples with similar or different compositions.</p>
      <p>ARGprofiler can handle both short single- and paired-end reads and combines existing and newly established tools and reference databases to produce a single comprehensive analysis pipeline.</p>
    </sec>
    <sec>
      <title>Retrieval of metagenomic datasets</title>
      <p>To manage the download of sequencing read data from ENA, ARGprofiler utilizes fastq-dl 2.0.4 (<ext-link xlink:href="https://github.com/rpetit3/fastq-dl" ext-link-type="uri">https://github.com/rpetit3/fastq-dl</ext-link>) to retrieve and download the reads by matching the given run_accessions in a JSON input file provided by the user. ARGprofiler is also capable of handling reads stored in a local folder as an alternative to downloading ENA read sets.</p>
    </sec>
    <sec>
      <title>Preprocessing of sequencing reads</title>
      <p>The first step in a sequencing workflow is the quality checking and trimming of the raw sequencing reads. Historically, FASTQC (<xref rid="btae086-B2" ref-type="bibr">Andrews 2010</xref>) has been used for quality checking and BBduk (<xref rid="btae086-B10" ref-type="bibr">Bushnell 2014</xref>) to remove adaptors and low-quality sequences (<xref rid="btae086-B25" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022a</xref>, <xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>). However, new and faster tools have appeared, such as the widely adopted tool fastp (<xref rid="btae086-B11" ref-type="bibr">Chen 2023</xref>). Therefore, we decided to compare the performance of fastp 0.23.2 with the combination of FASTQC and BBduk to ensure an efficient preprocessing of the raw reads.</p>
    </sec>
    <sec>
      <title>Mapping and alignment of reads against reference databases</title>
      <p>To quantify ARGs and microorganisms, KMA 1.4.12a (<xref rid="btae086-B13" ref-type="bibr">Clausen <italic toggle="yes">et al.</italic> 2018</xref>) was used to map and align the trimmed reads to different databases. KMA uses <italic toggle="yes">k</italic>-mer seeding to increase mapping speed and is specifically made for mapping reads against redundant databases. We designed the alignment procedure to use two reference sequence databases: the PanRes collection of ARGs and the mOTUs3 database (<xref rid="btae086-B39" ref-type="bibr">Ruscheweyh <italic toggle="yes">et al.</italic> 2022</xref>) for microbiome profiling. Details on the choice and design of reference databases are described in later sections.</p>
    </sec>
    <sec>
      <title>Metagenome representation using Mash sketches</title>
      <p>We used Mash 2.3 (<xref rid="btae086-B33" ref-type="bibr">Ondov <italic toggle="yes">et al.</italic> 2016</xref>) to enable comparison between large sets of metagenomes for subsequent selection and analysis by creating MinHash sketches as representatives for individual metagenomes. This allows an unbiased comparison of samples with a low constant memory footprint and a short turnaround time, which can be used for subsequent clustering and identification of closely related metagenomes (<xref rid="btae086-B33" ref-type="bibr">Ondov <italic toggle="yes">et al.</italic> 2016</xref>). We identified appropriate sketch and <italic toggle="yes">k</italic>-mer sizes using a selection of 72 sewage metagenomes: 36 from Copenhagen sewage (<xref rid="btae086-B9" ref-type="bibr">Brinch <italic toggle="yes">et al.</italic> 2020</xref>), 18 from various sites in the world (<xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>), and the remaining 18 were technical replicates of a single sewage sample taken in Copenhagen, Denmark (PRJEB63576). Sketches were created for all samples using sketch sizes of <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>5</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>, and <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>6</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>, with <italic toggle="yes">k</italic>-mer sizes of 16, 21, 27, and 31. Mash distances were calculated to find the parameters resulting in lower within-sample distances than between-sample distances. Distances were also clustered using Dynamic Neighbor-Joining with CCPhylo 0.8.3 (<xref rid="btae086-B12" ref-type="bibr">Clausen 2023</xref>) to verify the appropriate sub-clustering of samples.</p>
    </sec>
    <sec>
      <title>Building flanking regions around genes of interest with ARGextender</title>
      <p>To examine the genomic content surrounding ARGs, we created ARGextender to build genomic flanking regions around identified ARGs. ARGextender recruits reads using a recursive approach with KMA and SPAdes (<xref rid="btae086-B37" ref-type="bibr">Prjibelski <italic toggle="yes">et al.</italic> 2020</xref>), which produce comparable results and are faster than full metagenome <italic toggle="yes">de novo</italic> assembly with SPAdes. A more detailed description of ARGextender can be found in a later section. Because KMA will also assign reads to low abundant sequences that are unlikely to form contigs, we created a filtering step using the KMA mapstat files so that only samples fulfilling the following criteria would be assembled: <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>90</mml:mn></mml:mrow></mml:math></inline-formula>% query identity, <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>90</mml:mn></mml:mrow></mml:math></inline-formula>% global consensus identity, and a mean read depth <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec>
      <title>The PanRes database</title>
      <p>Bacterial genes that encode resistance to antibiotic drugs, heavy metals, and biocides have been previously identified and compiled into several databases (<xref rid="btae086-B1" ref-type="bibr">Alcock <italic toggle="yes">et al.</italic> 2023</xref>, <xref rid="btae086-B7" ref-type="bibr">Bonin <italic toggle="yes">et al.</italic> 2023</xref>, <xref rid="btae086-B8" ref-type="bibr">Bortolaia <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btae086-B16" ref-type="bibr">Feldgarden <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btae086-B18" ref-type="bibr">Gupta <italic toggle="yes">et al.</italic> 2014</xref>, <xref rid="btae086-B17" ref-type="bibr">Gschwind <italic toggle="yes">et al.</italic> 2023</xref>) . We sought to collect these genes of interest into a single unique collection that we named PanRes; short for the pan resistance, as having a single, although highly redundant collection is computationally more efficient to search through.</p>
      <p>The following gene databases were identified and used as seeds for the selection of genes for the PanRes collection: ResFinder (downloaded 20 January 2023, <xref rid="btae086-B8" ref-type="bibr">Bortolaia <italic toggle="yes">et al.</italic> 2020</xref>), ResFinderFG (version 2.0, <xref rid="btae086-B17" ref-type="bibr">Gschwind <italic toggle="yes">et al.</italic> 2023</xref>), CARD (version 3.2.5, <xref rid="btae086-B1" ref-type="bibr">Alcock <italic toggle="yes">et al.</italic> 2023</xref>), MegaRes (version 3.0.0, <xref rid="btae086-B7" ref-type="bibr">Bonin <italic toggle="yes">et al.</italic> 2023</xref>), AMRFinderPlus (version 3.11/2022-12-19.1, <xref rid="btae086-B16" ref-type="bibr">Feldgarden <italic toggle="yes">et al.</italic> 2021</xref>), and ARGANNOT (V6_July2019, <xref rid="btae086-B18" ref-type="bibr">Gupta <italic toggle="yes">et al.</italic> 2014</xref>). In addition to these collections, we used a set of cloned, functionally determined ARGs from environmental and clinical samples tested for resistance to antibiotics not yet on the market (<xref rid="btae086-B14" ref-type="bibr">Daruka <italic toggle="yes">et al.</italic> 2023</xref>). We received these sequences in November 2022 [Csaba Pál and Zoltán Farkas (Personal communication, July 2022)], and tagged them with “CsabaPal” in the collection.</p>
      <p>From the CARD database, the genes based on the protein homolog model were included as they are acquired and do not rely on mutations for resistance. In the MegaRes gene collection, sequences with the “RequiresSNPConfirmation” tag were excluded from consideration, as these represent mutated versions of housekeeping genes, regulators, repressors, and promoter sequences. From the AMRFinderPlus sequences of the “AMR” type, only those satisfying the “AMR” subtype were used. For the genes of the “STRESS” type, just the “BIOCIDE” and “METAL” subtypes were retained.</p>
      <p>As heavy metals often co-select for antibiotic resistance (<xref rid="btae086-B4" ref-type="bibr">Baker-Austin <italic toggle="yes">et al.</italic> 2006</xref>), we did a screening for metal resistance genes. The BacMet v1.1 collection of experimentally verified resistance proteins was used as a starting point (<xref rid="btae086-B36" ref-type="bibr">Pal <italic toggle="yes">et al.</italic> 2014</xref>), where the BacMet GenBank accessions were used to extract the coding sequences (<xref rid="btae086-B31" ref-type="bibr">NCBI Resource Coordinators 2018</xref>). We then manually curated the collection of metal resistance genes with sequences identified in the published literature, with a special focus on acquired cobalt, zinc, cobalt, copper, arsenite, mercury, cadmium, lead, or silver-resistance genes retrieved using the NCBI nucleotide database (<xref rid="btae086-B31" ref-type="bibr">NCBI Resource Coordinators 2018</xref>). The final collection of metal resistance genes we refer to as the MetalResistance database is deposited at: <ext-link xlink:href="https://doi.org/10.5281/zenodo.8108201" ext-link-type="uri">https://doi.org/10.5281/zenodo.8108201</ext-link>.</p>
      <p>All retrieved sequences were clustered using Usearch 11.0.667 (<xref rid="btae086-B15" ref-type="bibr">Edgar 2010</xref>) with the fastx_uniques algorithm to identify unique sequences to include in PanRes. These unique ARGs were clustered based on 90% identity and 90% coverage with the cluster_fast algorithm. GeneAssimiliator (<ext-link xlink:href="https://github.com/genomicepidemiology/gene\_assimilator" ext-link-type="uri">https://github.com/genomicepidemiology/gene\_assimilator</ext-link>) was used to perform this iterative approach of recruiting, clustering, and refining gene collections of various sources into one.</p>
    </sec>
    <sec>
      <title>ARGextender</title>
      <p>Despite the value provided through metagenomic <italic toggle="yes">de novo</italic> assemblies, the computational demands are often too high to be considered for routine use (<xref rid="btae086-B26" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022b</xref>). To enable a shorter turnaround time of metagenomic assemblies with lower computational demands, we developed ARGextender to perform <italic toggle="yes">de novo</italic> assemblies around target sequences of interest.</p>
      <p>ARGextender recursively applies KMA 1.4.12a (<xref rid="btae086-B13" ref-type="bibr">Clausen <italic toggle="yes">et al.</italic> 2018</xref>) and SPAdes 3.15.5 (<xref rid="btae086-B32" ref-type="bibr">Nurk <italic toggle="yes">et al.</italic> 2017</xref>, <xref rid="btae086-B37" ref-type="bibr">Prjibelski <italic toggle="yes">et al.</italic> 2020</xref>), where KMA is used to identify the target sequences in the sample, followed by a <italic toggle="yes">de novo</italic> assembly of the reads matching the target(s) using SPAdes. After each <italic toggle="yes">de novo</italic> assembly, scaffolds containing target sequences are extracted using KMA and set as the new target. This recursion is repeated until no more reads are included in the <italic toggle="yes">de novo</italic> assembly or the user-defined maximum number of recursions has been met (unlimited by default). When the targeted <italic toggle="yes">de novo</italic> assembly has saturated, the scaffolds and assembly graph are saved, along with a table containing the information about which target sequences are found within each scaffold. These include target sequences with an alignment score within 70% of the best-scoring target sequences.</p>
      <p>We evaluated the ARGextender tool by comparing the output of ARGextender to full <italic toggle="yes">de novo</italic> metagenomic assemblies of 951 urban sewage samples published by (<xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>). We compared the resulting scaffolds by matching the sequences of the ResFinder database to the scaffolds using KMA 1.4.12a with the “-ont” parameter. The surrounding flanks were then extracted and compared.</p>
    </sec>
    <sec>
      <title>Evaluating tools for profiling microbiomes</title>
      <p>We compared the performance of KMA (<xref rid="btae086-B13" ref-type="bibr">Clausen <italic toggle="yes">et al.</italic> 2018</xref>) with several microbial reference databases and profiling tools. Using the <italic toggle="yes">in silico</italic> data generated for the profiling test in the Critical Assessment of Metagenome Interpretation (CAMI) challenge (<xref rid="btae086-B28" ref-type="bibr">Meyer <italic toggle="yes">et al.</italic> 2022</xref>), we tested mOTUs 3.0.3 (<xref rid="btae086-B39" ref-type="bibr">Ruscheweyh <italic toggle="yes">et al.</italic> 2022</xref>), MetaPhlAn 4.0.3 (<xref rid="btae086-B6" ref-type="bibr">Blanco-Míguez <italic toggle="yes">et al.</italic> 2023</xref>), Bracken 2.8 (<xref rid="btae086-B24" ref-type="bibr">Lu <italic toggle="yes">et al.</italic> 2017</xref>) on Kraken2 (<xref rid="btae086-B40" ref-type="bibr">Wood <italic toggle="yes">et al.</italic> 2019</xref>) output, and KMA 1.4.7 with the following reference databases: the mOTUs database (<xref rid="btae086-B39" ref-type="bibr">Ruscheweyh <italic toggle="yes">et al.</italic> 2022</xref>) of 521 780 sequences (version 3.0.1, downloaded 5 December 2022), the Silva database (<xref rid="btae086-B38" ref-type="bibr">Quast <italic toggle="yes">et al.</italic> 2012</xref>) of 2 225 272 sequences (version 138, downloaded 16 January 2020), and a custom database of the genomic database of 16 732 113 genomic sequences (downloaded 24 May 2022, compiled using a previously described procedure (<xref rid="btae086-B34" ref-type="bibr">Osakunor <italic toggle="yes">et al.</italic> 2020</xref>).</p>
      <p>The performance of each tool and reference database was evaluated similarly to the CAMI challenge using the OPAL tool (<xref rid="btae086-B27" ref-type="bibr">Meyer <italic toggle="yes">et al.</italic> 2019</xref>). Results with low abundances were filtered away (“-f 1”). We used three binary classification metrics on each taxonomic level, from superkingdom to species, to determine performance and the sum of abundances, specifically purity, completeness, and F1 scores. Purity and completeness consider the performance of correctly identifying taxons without considering relative abundances, where TP is the number of true positives, FP is the number of false positives, and FN is the false negatives: <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mtext>Purity</mml:mtext><mml:mo>=</mml:mo><mml:mtext>TP</mml:mtext><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mtext>TP</mml:mtext><mml:mo>+</mml:mo><mml:mtext>FP</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:mtext>Completeness</mml:mtext><mml:mo>=</mml:mo><mml:mtext>TP</mml:mtext><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mtext>TP</mml:mtext><mml:mo>+</mml:mo><mml:mtext>FN</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. The F1 score measures the overall performance of taxon identification and is defined as:
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mi mathvariant="normal">F</mml:mi><mml:mn>1</mml:mn><mml:mo> </mml:mo><mml:mtext>score</mml:mtext><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>purity</mml:mtext><mml:mo>⋅</mml:mo><mml:mtext>completeness</mml:mtext></mml:mrow><mml:mrow><mml:mtext>purity</mml:mtext><mml:mo>+</mml:mo><mml:mtext>completeness</mml:mtext></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
    </sec>
  </sec>
  <sec sec-type="data-availability">
    <title>Code and data availability</title>
    <p>The ARGprofiler pipeline is available on GitHub, at <ext-link xlink:href="https://github.com/genomicepidemiology/ARGprofiler" ext-link-type="uri">https://github.com/genomicepidemiology/ARGprofiler</ext-link> under the APACHE-2.0 license. ARGextender is included as part of the ARGprofiler repository. GeneAssimilator is available at <ext-link xlink:href="https://github.com/genomicepidemiology/gene_assimilator" ext-link-type="uri">https://github.com/genomicepidemiology/gene_assimilator</ext-link>. The code for the comparison of microbial profilers is available at <ext-link xlink:href="https://github.com/genomicepidemiology/argprofiler-tax-benchmark" ext-link-type="uri">https://github.com/genomicepidemiology/argprofiler-tax-benchmark</ext-link>. Jupyter Notebooks supporting the various figures and tables have been shared at <ext-link xlink:href="https://github.com/genomicepidemiology/argprofiler-paper-notebooks" ext-link-type="uri">https://github.com/genomicepidemiology/argprofiler-paper-notebooks</ext-link>.</p>
    <p>The MetalResistance gene database is available on Zenodo, at <ext-link xlink:href="https://doi.org/10.5281/zenodo.8108201" ext-link-type="uri">https://doi.org/10.5281/zenodo.8108201</ext-link>, and the first version of the PanRes collection is available at <ext-link xlink:href="https://doi.org/10.5281/zenodo.8055115" ext-link-type="uri">https://doi.org/10.5281/zenodo.8055115</ext-link>. Output files of benchmarking microbial profilers are available at <ext-link xlink:href="https://doi.org/10.5281/zenodo.7923774" ext-link-type="uri">https://doi.org/10.5281/zenodo.7923774</ext-link>. The full de novo assemblies of urban sewage samples are available on ENA under project accessions PRJEB40798, PRJEB40816, PRJEB40815, PRJEB27621, and ERP015409. The Copenhagen sewage collection is under PRJEB34633, and the repeated resequencing of a single Copenhagen sewage sample is under PRJEB63576.</p>
    <sec>
      <title>Results</title>
      <p>With ARGprofiler, we wanted to focus on creating a pipeline that produces three main outputs suitable for analyzing metagenomic datasets: the abundance of reads aligned to different genes of two suitable reference databases (mOTUs and PanRes), targeted <italic toggle="yes">de novo</italic> assemblies with ARGextender, and MinHash sketches with Mash (<xref rid="btae086-F1" ref-type="fig">Fig. 1</xref>). Our pipeline has been designed to be suitable for large volumes of sequencing reads by using the workflow manage Snakemake and by carefully selecting appropriate tools.</p>
    </sec>
    <sec>
      <title>The PanRes collection</title>
      <p>PanRes was created to compile several existing ARG reference databases into one, as there are both overlaps and discrepancies between the different ones (<xref rid="btae086-F2" ref-type="fig">Fig. 2a</xref>). Out of 30 400 genes, we identified a set of 14 078 unique sequences that were included in PanRes. Grouping these genes based on 90% identity and 90% coverage produced 5280 centroids, which ranged in lengths between 93 and 5972 bp, with a median of 762 bp (<xref rid="btae086-F2" ref-type="fig">Fig. 2b</xref>).</p>
      <fig position="float" id="btae086-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Overview of the sequences included in PanRes. (a) A comparison of overlaps between the different databases in the PanRes collection. (b) Distribution of antimicrobial resistance gene lengths.</p>
        </caption>
        <graphic xlink:href="btae086f2" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>Assembling flanks around genes with ARGextender</title>
      <p>To validate the output of ARGextender, we compared the scaffolds with those produced by SPAdes on a set of 951 urban sewage samples (<xref rid="btae086-F3" ref-type="fig">Fig. 3</xref>). On average, ARGextender built 101 scaffolds (range: 1–350), whereas SPAdes reported 95 ARG-scaffolds on average (range: 1–348). The number of distinct ARGs detected in the scaffolds was on average 57 for ARGextender (range 1–141) and 58 for SPAdes (range: 1–153) (<xref rid="btae086-F3" ref-type="fig">Fig. 3a</xref>). Most of the flanks extracted around ARGs were between 100 and 5000 bp, although many had no flanking regions (<xref rid="btae086-F3" ref-type="fig">Fig. 3b</xref>). Excluding scaffolds with zero flanks, we can see that ARGextender and SPAdes can assemble flanks around a similar number of ARGs (<xref rid="btae086-F3" ref-type="fig">Fig. 3c</xref>). Overall, ARGextender was capable of assembling the same amount of flanks as SPAdes with lower computational requirements (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Appendix B</xref>), although SPAdes produced longer flanks for some samples.</p>
      <fig position="float" id="btae086-F3">
        <label>Figure 3.</label>
        <caption>
          <p>A comparison between the flanks extracted around ARGs found in scaffolds produced with either SPAdes or ARGextender. (a) Number of scaffolds containing at least one ARG compared with the number of ARGs detected across all scaffolds in a sample. (b) Distribution of flanking content (bp: basepairs) in sewage samples, including the number of scaffolds without a flanking region in the top right corner. (c) Overlap between the tool regarding which ARGs had flanks, excluding the scaffolds with zero flank regions. Only ARGs with a minimum of 95% breadth of coverage were included in this figure. ARG: antimicrobial resistance genes.</p>
        </caption>
        <graphic xlink:href="btae086f3" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>Choosing a microbial profiler and reference database</title>
      <p>Since there are multiple different tools and reference databases available to profile the microbial content of a sample, we compared the performances of each method with various databases (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Appendix A</xref>, <xref rid="btae086-F4" ref-type="fig">Fig. 4</xref>). KMA reported more matched reference sequences, regardless of the database used, where most were false positives (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. A1</xref>). After removing hits with low abundances, KMA were comparable with MetaPhlAn and mOTUs, sometimes identifying more taxons than the other tools (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. A2</xref>). We observed a decrease in completeness and purity in taxon identification for the non-human environments for all tools and databases (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Figs A3 and A4</xref>). Despite this decrease, KMA had higher completeness than MetaPhlAn, mOTUs, and Bracken on the plant-associated samples (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. A4a</xref>). KMA with the mOTUs sequences (KMA-mOTUs) outperformed KMA with genomic and Silva databases across all six sampling groups regarding binary metrics (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Appendix A</xref>). While KMA-mOTUs abundance results were generally lower, the F1 scores were on par with the MetaPhlAn and mOTUs profilers (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Figs A5 and A6</xref>), which we believe is due to a difference in how abundance is calculated in the other tools.</p>
      <fig position="float" id="btae086-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Performance of microbial profilers on the <italic toggle="yes">in silico</italic> CAMI data as measured by the F1 score at genus rank. The harmonic mean is reported as the circle, and the error bars are the standard deviation. CAMI: critical assessment of metagenome interpretation.</p>
        </caption>
        <graphic xlink:href="btae086f4" position="float"/>
      </fig>
      <p>We decided on combining KMA with the mOTUs sequences for two reasons. First, we plan to apply our pipeline as an environment-agnostic passive surveillance tool encompassing many One Health settings important for ARG ecology. Therefore, we deemed performance outside just human microbiomes important, where KMA-mOTUs outperformed all other tools on the plant-associated samples and were on par with marine samples (<xref rid="btae086-F4" ref-type="fig">Fig. 4</xref>). Second, since we also use KMA for the ARG quantification, this choice limited the overall pipeline complexity.</p>
    </sec>
    <sec>
      <title>Clustering and representing metagenomes using Mash sketches</title>
      <p>Most of the output of ARGprofiler relies on known reference sequences. To enable unbiased metagenome-wise comparison and clustering of sequence runs, we include the creation of sketches using Mash. We tested the discriminatory power of different sketch and <italic toggle="yes">k</italic>-mer sizes on sewage samples, some of which were technical sequence replicates of the same sample. Both the very small sketch sizes and short <italic toggle="yes">k</italic>-mers failed to clearly distinguish between technical replicates of the same sample and sequence runs of other sewage samples (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. B5</xref> in appendix). Technical replicates were efficiently separated from the remaining samples with a <italic toggle="yes">k</italic>-mer size of 31 and sketch size of <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mo>≥</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. B6</xref> in appendix). As smaller sketch sizes require less computational resources, a sketch size of 104 was included as default in ARGprofiler.</p>
    </sec>
    <sec>
      <title>Reducing computational time and memory usage</title>
      <p>Analyzing the large quantities of metagenomic data currently available at ENA and future data is not computationally trivial, and choosing efficient workflows will seriously impact the associated time, costs, and energy expenditure. We did a benchmark of each rule using a set of metagenomic datasets from a variety of sampling origins (details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Material Appendix B</xref>), where we observed that with our final parameter settings, the ARGprofiler pipeline processed 1.21 gigabasepairs/h (Gbps/h) with a median processing performance of 0.36 Gbps/h. Most steps had a sample-average peak memory footprint below 1 GB and required less than a CPU hour, except for KMA-mOTUs and ARGextender (<xref rid="btae086-T1" ref-type="table">Table 1</xref>).</p>
      <table-wrap position="float" id="btae086-T1">
        <label>Table 1.</label>
        <caption>
          <p>Measured times and memory usage for each step of the ARGprofiler pipeline.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="center" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="2" colspan="1">Rule</th>
              <th rowspan="2" align="center" colspan="1">Tool</th>
              <th colspan="2" align="center" rowspan="1">CPU time (h)<hr/></th>
              <th colspan="2" align="center" rowspan="1">Memory (MB)<hr/></th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">
                <inline-formula id="IE11">
                  <mml:math id="IM11" display="inline" overflow="scroll">
                    <mml:mo>μ</mml:mo>
                  </mml:math>
                </inline-formula>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <inline-formula id="IE12">
                  <mml:math id="IM12" display="inline" overflow="scroll">
                    <mml:mo>σ</mml:mo>
                  </mml:math>
                </inline-formula>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <inline-formula id="IE13">
                  <mml:math id="IM13" display="inline" overflow="scroll">
                    <mml:mo>μ</mml:mo>
                  </mml:math>
                </inline-formula>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <inline-formula id="IE14">
                  <mml:math id="IM14" display="inline" overflow="scroll">
                    <mml:mo>σ</mml:mo>
                  </mml:math>
                </inline-formula>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">Read download</td>
              <td rowspan="1" colspan="1">fastq-dl</td>
              <td rowspan="1" colspan="1">0.58</td>
              <td rowspan="1" colspan="1">1.33</td>
              <td rowspan="1" colspan="1">1389.83</td>
              <td rowspan="1" colspan="1">1052</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Read preprocessing</td>
              <td rowspan="1" colspan="1">fastp</td>
              <td rowspan="1" colspan="1">0.51</td>
              <td rowspan="1" colspan="1">1.23</td>
              <td rowspan="1" colspan="1">2375.95</td>
              <td rowspan="1" colspan="1">1748.43</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Microbiome read alignment</td>
              <td rowspan="1" colspan="1">KMA-mOTUs</td>
              <td rowspan="1" colspan="1">2.66</td>
              <td rowspan="1" colspan="1">6.04</td>
              <td rowspan="1" colspan="1">6817.09</td>
              <td rowspan="1" colspan="1">3.44</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">ARG read alignment</td>
              <td rowspan="1" colspan="1">KMA-PanRes</td>
              <td rowspan="1" colspan="1">0.43</td>
              <td rowspan="1" colspan="1">0.99</td>
              <td rowspan="1" colspan="1">308.75</td>
              <td rowspan="1" colspan="1">137.05</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Building flanking regions</td>
              <td rowspan="1" colspan="1">ARGextender</td>
              <td rowspan="1" colspan="1">2.06</td>
              <td rowspan="1" colspan="1">5.20</td>
              <td rowspan="1" colspan="1">539.61</td>
              <td rowspan="1" colspan="1">804.92</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Creating MinHash sketches</td>
              <td rowspan="1" colspan="1">Mash sketch</td>
              <td rowspan="1" colspan="1">0.24</td>
              <td rowspan="1" colspan="1">0.59</td>
              <td rowspan="1" colspan="1">2.03</td>
              <td rowspan="1" colspan="1">0.10</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn1">
            <p>The average (<inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>) CPU time in hours (h) and the peak memory in megabytes (MB) are reported together with standard deviations (<inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mo>σ</mml:mo></mml:math></inline-formula>). Note that the CPU hours and peak memory for ARGextender did not include the two samples that were not completed within our limit of 48 h.</p>
          </fn>
          <fn id="tblfn2">
            <p>ARG: antimicrobial resistance genes.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
  </sec>
  <sec sec-type="discussion">
    <title>Discussion</title>
    <p>There are currently terabytes of metagenomic sequencing data available in public databases, and producing standardized and consistent results is necessary for downstream analyses. Therefore, we have designed ARGprofiler to allow efficient ARG-monitoring and quantification in vast amounts of sequencing data, determine flanking regions around ARGs for downstream epidemiological investigation, and <italic toggle="yes">k</italic>-mer-based comparison of sequence runs. Each output aligns with our overall goal of reanalyzing public sequencing datasets for the characteristics of ARGs in a global microbial and environmental context.</p>
    <p>One of the unique features of ARGprofiler is the addition of the PanRes database. The motivation behind PanRes was to eliminate the inefficiency associated with searching for the same gene in multiple collections and the additional overhead of spawning extra compute jobs for each collection. We, therefore, sought to collect the unique sequences of ARGs from a wide spectrum of existing databases. It is our hope that this will help facilitate fewer but larger and more efficient monitoring runs of public metagenomes, followed by data sharing and the individual AMR researchers then filtering results to their specific focus.</p>
    <p>An important feature of ARGprofiler is the creation of targeted assemblies around genes with ARGextender. ARGextender uses KMA and SPAdes to create targeted <italic toggle="yes">de novo</italic> assemblies by identifying if the targeted ARGs are present in a sample and then recruiting reads to the surrounding regions. The pairwise comparison of ARG-carrying scaffolds produced with ARGextender and SPAdes in sewage samples showed that ARGextender could extract comparable flanking regions to SPAdes but in a much shorter time frame. This approach also avoids running the more expensive algorithm if none of the target genes is identified.</p>
    <p>However, there are still a few points we need to address in the way that ARGprofiler currently works. First, ARGprofiler is designed to only work with short-read sequencing data, thus not utilizing the advantages of long-read sequencing technologies. We are planning to extend the input options to include long-read datasets. Second, a significant aspect of ARGprofiler is the choice of reference databases. PanRes is a one-size-fits-all approach for ARGs. However, as it combines different sources and scopes, it will be up to the individual research questions, which subsets are appropriate for consideration. ARGprofiler also profiles the microbiome of each sequencing dataset by mapping the reads against the microbial reference sequence database mOTUs. This step is included to compare the abundance of ARGs to the microbial content (<xref rid="btae086-B26" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022b</xref>, <xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>, <xref rid="btae086-B21" ref-type="bibr">Johansson <italic toggle="yes">et al.</italic> 2023</xref>). We chose mOTUs as this collection performed best across different environments with KMA. Our choice was based on the <italic toggle="yes">in silico</italic> datasets, and while real data might contain many more unknowns, it appeared to be the best choice for our pipeline. We chose to incorporate a sub-workflow of creating Mash sketches with optimized parameters to allow the user to compare and cluster to determine similar sequencing datasets and those of poor quality. The sketches also make it possible to query the read sets against pre-sketched genomes, thus allowing the user to re-use the data without rerunning the whole pipeline.</p>
    <p>In conclusion, we have implemented and evaluated ARGprofiler to be a robust bioinformatic pipeline that provides other researchers the opportunity to analyze large collections of metagenomic sequencing runs against a collection of ARGs or other genes of interest. The ARGprofiler code is publicly available under the Apache-2.0 license at <ext-link xlink:href="https://github.com/genomicepidemiology/ARGprofiler" ext-link-type="uri">https://github.com/genomicepidemiology/ARGprofiler</ext-link>.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btae086_Supplementary_Data</label>
      <media xlink:href="btae086_supplementary_data.zip"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by funding from the Novo Nordisk Foundation (grant number: NNF16OC0021856: Global Surveillance of Antimicrobial Resistance); the European Union’s Horizon 2020 research and innovation program under VEO grant agreement (grant number: 874735); and BY-COVID grant agreement (grant number: 101046203).</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btae086-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Alcock</surname><given-names>BP</given-names></string-name>, <string-name><surname>Huynh</surname><given-names>W</given-names></string-name>, <string-name><surname>Chalil</surname><given-names>R</given-names></string-name></person-group><etal>et al</etal><article-title>Card 2023: expanded curation, support for machine learning, and resistome prediction at the comprehensive antibiotic resistance database</article-title>. <source>Nucleic Acids Res</source><year>2023</year>;<volume>51</volume>:<fpage>D690</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">36263822</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B2">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Andrews</surname><given-names>S.</given-names></string-name></person-group> FastQC: a quality control tool for high throughput sequence data, <year>2010</year>. <ext-link xlink:href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/" ext-link-type="uri">https://www.bioinformatics.babraham.ac.uk/projects/fastqc/</ext-link> (accessed July 10, 2023).</mixed-citation>
    </ref>
    <ref id="btae086-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Anthony</surname><given-names>WE</given-names></string-name>, <string-name><surname>Burnham</surname><given-names>C-AD</given-names></string-name>, <string-name><surname>Dantas</surname><given-names>G</given-names></string-name></person-group><etal>et al</etal><article-title>The gut microbiome as a reservoir for antimicrobial resistance</article-title>. <source>J Infect Dis</source><year>2021</year>;<volume>223</volume>:<fpage>S209</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">33326581</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Baker-Austin</surname><given-names>C</given-names></string-name>, <string-name><surname>Wright</surname><given-names>MS</given-names></string-name>, <string-name><surname>Stepanauskas</surname><given-names>R</given-names></string-name></person-group><etal>et al</etal><article-title>Co-selection of antibiotic and metal resistance</article-title>. <source>Trends Microbiol</source><year>2006</year>;<volume>14</volume>:<fpage>176</fpage>–<lpage>82</lpage>.<pub-id pub-id-type="pmid">16537105</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bengtsson-Palme</surname><given-names>J</given-names></string-name>, <string-name><surname>Kristiansson</surname><given-names>E</given-names></string-name>, <string-name><surname>Larsson</surname><given-names>DJ.</given-names></string-name></person-group><article-title>Environmental factors influencing the development and spread of antibiotic resistance</article-title>. <source>FEMS Microbiol Rev</source><year>2018</year>;<volume>42</volume>:<fpage>fux053</fpage>.<pub-id pub-id-type="pmid">29069382</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Blanco-Míguez</surname><given-names>A</given-names></string-name>, <string-name><surname>Beghini</surname><given-names>F</given-names></string-name>, <string-name><surname>Cumbo</surname><given-names>F</given-names></string-name></person-group><etal>et al</etal><article-title>Extending and improving metagenomic taxonomic profiling with uncharacterized species using metaphlan 4</article-title>. <source>Nat Biotechnol</source><year>2023</year>;<volume>41</volume>:<fpage>1633</fpage>–<lpage>1644</lpage>.<pub-id pub-id-type="pmid">36823356</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bonin</surname><given-names>N</given-names></string-name>, <string-name><surname>Doster</surname><given-names>E</given-names></string-name>, <string-name><surname>Worley</surname><given-names>H</given-names></string-name></person-group><etal>et al</etal><article-title>Megares and amr++, v3. 0: an updated comprehensive database of antimicrobial resistance determinants and an improved software pipeline for classification using high-throughput sequencing</article-title>. <source>Nucleic Acids Res</source><year>2023</year>;<volume>51</volume>:<fpage>D744</fpage>–<lpage>52</lpage>.<pub-id pub-id-type="pmid">36382407</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bortolaia</surname><given-names>V</given-names></string-name>, <string-name><surname>Kaas</surname><given-names>RS</given-names></string-name>, <string-name><surname>Ruppe</surname><given-names>E</given-names></string-name></person-group><etal>et al</etal><article-title>Resfinder 4.0 for predictions of phenotypes from genotypes</article-title>. <source>J Antimicrob Chemother</source><year>2020</year>;<volume>75</volume>:<fpage>3491</fpage>–<lpage>500</lpage>.<pub-id pub-id-type="pmid">32780112</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Brinch</surname><given-names>C</given-names></string-name>, <string-name><surname>Leekitcharoenphon</surname><given-names>P</given-names></string-name>, <string-name><surname>Duarte</surname><given-names>AS</given-names></string-name></person-group><etal>et al</etal><article-title>Long-term temporal stability of the resistome in sewage from copenhagen</article-title>. <source>Msystems</source><year>2020</year>;<volume>5</volume>:<fpage>e00841-20</fpage>.<pub-id pub-id-type="pmid">33082278</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B10">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Bushnell</surname><given-names>B.</given-names></string-name></person-group><italic toggle="yes">Bbmap: A Fast, Accurate, Splice-Aware Aligner</italic>. Technical report. Berkeley, CA: Lawrence Berkeley National Lab (LBNL); <year>2014</year>.</mixed-citation>
    </ref>
    <ref id="btae086-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chen</surname><given-names>S.</given-names></string-name></person-group><article-title>Ultrafast one-pass fastq data preprocessing, quality control, and deduplication using fastp</article-title>. <source>iMeta</source><year>2023</year>;<volume>2</volume>:<fpage>e107</fpage>.</mixed-citation>
    </ref>
    <ref id="btae086-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Clausen</surname><given-names>PT.</given-names></string-name></person-group><article-title>Scaling neighbor joining to one million taxa with dynamic and heuristic neighbor joining</article-title>. <source>Bioinformatics</source><year>2023</year>;<volume>39</volume>:<fpage>btac774</fpage>.<pub-id pub-id-type="pmid">36453849</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Clausen</surname><given-names>PT</given-names></string-name>, <string-name><surname>Aarestrup</surname><given-names>FM</given-names></string-name>, <string-name><surname>Lund</surname><given-names>O.</given-names></string-name></person-group><article-title>Rapid and precise alignment of raw reads against redundant databases with KMA</article-title>. <source>BMC Bioinformatics</source><year>2018</year>;<volume>19</volume>:<fpage>307</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">30157759</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B14">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Daruka</surname><given-names>L</given-names></string-name>, <string-name><surname>Czikkely</surname><given-names>MS</given-names></string-name>, <string-name><surname>Szili</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal> Antibiotics of the future are prone to resistance in gram-negative pathogens. <italic toggle="yes">bioRxiv 2023-07</italic>. 2023.</mixed-citation>
    </ref>
    <ref id="btae086-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Edgar</surname><given-names>RC.</given-names></string-name></person-group><article-title>Search and clustering orders of magnitude faster than blast</article-title>. <source>Bioinformatics</source><year>2010</year>;<volume>26</volume>:<fpage>2460</fpage>–<lpage>1</lpage>.<pub-id pub-id-type="pmid">20709691</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Feldgarden</surname><given-names>M</given-names></string-name>, <string-name><surname>Brover</surname><given-names>V</given-names></string-name>, <string-name><surname>Gonzalez-Escalona</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>Amrfinderplus and the reference gene catalog facilitate examination of the genomic links among antimicrobial resistance, stress response, and virulence</article-title>. <source>Sci Rep</source><year>2021</year>;<volume>11</volume>:<fpage>12728</fpage>.<pub-id pub-id-type="pmid">34135355</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gschwind</surname><given-names>R</given-names></string-name>, <string-name><surname>Ugarcina Perovic</surname><given-names>S</given-names></string-name>, <string-name><surname>Weiss</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>Resfinderfg v2. 0: a database of antibiotic resistance genes obtained by functional metagenomics</article-title>. <source>Nucleic Acids Res</source><year>2023</year>;<volume>51</volume>:<fpage>W493</fpage>–<lpage>500</lpage>.<pub-id pub-id-type="pmid">37207327</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gupta</surname><given-names>SK</given-names></string-name>, <string-name><surname>Padmanabhan</surname><given-names>BR</given-names></string-name>, <string-name><surname>Diene</surname><given-names>SM</given-names></string-name></person-group><etal>et al</etal><article-title>Arg-annot, a new bioinformatic tool to discover antibiotic resistance genes in bacterial genomes</article-title>. <source>Antimicrob Agents Chemother</source><year>2014</year>;<volume>58</volume>:<fpage>212</fpage>–<lpage>20</lpage>.<pub-id pub-id-type="pmid">24145532</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hendriksen</surname><given-names>RS</given-names></string-name>, <string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Njage</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal>; <collab>Global Sewage Surveillance Project Consortium</collab>. <article-title>Global monitoring of antimicrobial resistance based on metagenomics analyses of urban sewage</article-title>. <source>Nature Commun</source><year>2019</year>;<volume>10</volume>:<fpage>1124</fpage>.<pub-id pub-id-type="pmid">30850636</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Holmes</surname><given-names>AH</given-names></string-name>, <string-name><surname>Moore</surname><given-names>LS</given-names></string-name>, <string-name><surname>Sundsfjord</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>Understanding the mechanisms and drivers of antimicrobial resistance</article-title>. <source>Lancet</source><year>2016</year>;<volume>387</volume>:<fpage>176</fpage>–<lpage>87</lpage>.<pub-id pub-id-type="pmid">26603922</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Johansson</surname><given-names>MH</given-names></string-name>, <string-name><surname>Aarestrup</surname><given-names>FM</given-names></string-name>, <string-name><surname>Petersen</surname><given-names>TN.</given-names></string-name></person-group><article-title>Importance of mobile genetic elements for dissemination of antimicrobial resistance in metagenomic sewage samples across the world</article-title>. <source>PLoS One</source><year>2023</year>;<volume>18</volume>:<fpage>e0293169</fpage>.<pub-id pub-id-type="pmid">37856515</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kieser</surname><given-names>S</given-names></string-name>, <string-name><surname>Brown</surname><given-names>J</given-names></string-name>, <string-name><surname>Zdobnov</surname><given-names>EM</given-names></string-name></person-group><etal>et al</etal><article-title>Atlas: a snakemake workflow for assembly, annotation, and genomic binning of metagenome sequence data</article-title>. <source>BMC Bioinformatics</source><year>2020</year>;<volume>21</volume>:<fpage>257</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">32571209</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Köster</surname><given-names>J</given-names></string-name>, <string-name><surname>Rahmann</surname><given-names>S.</given-names></string-name></person-group><article-title>Snakemake—a scalable bioinformatics workflow engine</article-title>. <source>Bioinformatics</source><year>2012</year>;<volume>28</volume>:<fpage>2520</fpage>–<lpage>2</lpage>.<pub-id pub-id-type="pmid">22908215</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lu</surname><given-names>J</given-names></string-name>, <string-name><surname>Breitwieser</surname><given-names>FP</given-names></string-name>, <string-name><surname>Thielen</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Bracken: estimating species abundance in metagenomics data</article-title>. <source>PeerJ Computer Science</source><year>2017</year>;<volume>3</volume>:<fpage>e104</fpage>.</mixed-citation>
    </ref>
    <ref id="btae086-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Martiny</surname><given-names>H-M</given-names></string-name>, <string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Brinch</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>A curated data resource of 214k metagenomes for characterization of the global antimicrobial resistome</article-title>. <source>PLoS Biol</source><year>2022a</year>;<volume>20</volume>:<fpage>e3001792</fpage>.<pub-id pub-id-type="pmid">36067158</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Martiny</surname><given-names>H-M</given-names></string-name>, <string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Brinch</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>Global distribution of mcr gene variants in 214k metagenomic samples</article-title>. <source>Msystems</source><year>2022b</year>;<volume>7</volume>:<fpage>e00105</fpage>.<pub-id pub-id-type="pmid">35343801</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Meyer</surname><given-names>F</given-names></string-name>, <string-name><surname>Bremges</surname><given-names>A</given-names></string-name>, <string-name><surname>Belmann</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Assessing taxonomic metagenome profilers with opal</article-title>. <source>Genome Biol</source><year>2019</year>;<volume>20</volume>:<fpage>1</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">30606230</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Meyer</surname><given-names>F</given-names></string-name>, <string-name><surname>Fritz</surname><given-names>A</given-names></string-name>, <string-name><surname>Deng</surname><given-names>Z-L</given-names></string-name></person-group><etal>et al</etal><article-title>Critical assessment of metagenome interpretation: the second round of challenges</article-title>. <source>Nat Methods</source><year>2022</year>;<volume>19</volume>:<fpage>429</fpage>–<lpage>40</lpage>.<pub-id pub-id-type="pmid">35396482</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mölder</surname><given-names>F</given-names></string-name>, <string-name><surname>Jablonski</surname><given-names>KP</given-names></string-name>, <string-name><surname>Letcher</surname><given-names>B</given-names></string-name></person-group><etal>et al</etal><article-title>Sustainable data analysis with snakemake</article-title>. <source>F1000Res</source><year>2021</year>;<volume>10</volume>:<fpage>33</fpage>.<pub-id pub-id-type="pmid">34035898</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Brinch</surname><given-names>C</given-names></string-name>, <string-name><surname>Møller</surname><given-names>FD</given-names></string-name></person-group><etal>et al</etal>; <collab>Global Sewage Surveillance Consortium</collab>. <article-title>Genomic analysis of sewage from 101 countries reveals global landscape of antimicrobial resistance</article-title>. <source>Nat Commun</source><year>2022</year>;<volume>13</volume>:<fpage>7251</fpage>.<pub-id pub-id-type="pmid">36456547</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B31">
      <mixed-citation publication-type="journal"><collab>NCBI Resource Coordinators</collab>. <article-title>Database resources of the national center for biotechnology information</article-title>. <source>Nucleic Acid Res</source><year>2018</year>;<volume>46</volume>:D1,D8–D13.</mixed-citation>
    </ref>
    <ref id="btae086-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nurk</surname><given-names>S</given-names></string-name>, <string-name><surname>Meleshko</surname><given-names>D</given-names></string-name>, <string-name><surname>Korobeynikov</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>Metaspades: a new versatile metagenomic assembler</article-title>. <source>Genome Res</source><year>2017</year>;<volume>27</volume>:<fpage>824</fpage>–<lpage>34</lpage>.<pub-id pub-id-type="pmid">28298430</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ondov</surname><given-names>BD</given-names></string-name>, <string-name><surname>Treangen</surname><given-names>TJ</given-names></string-name>, <string-name><surname>Melsted</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Mash: fast genome and metagenome distance estimation using minhash</article-title>. <source>Genome Biol</source><year>2016</year>;<volume>17</volume>:<fpage>132</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">27323842</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Osakunor</surname><given-names>DN</given-names></string-name>, <string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Mduluza</surname><given-names>T</given-names></string-name></person-group><etal>et al</etal><article-title>The gut microbiome but not the resistome is associated with urogenital schistosomiasis in preschool-aged children</article-title>. <source>Commun Biol</source><year>2020</year>;<volume>3</volume>:<fpage>155</fpage>.<pub-id pub-id-type="pmid">32242065</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>O’Toole</surname><given-names>Á</given-names></string-name>, <string-name><surname>Scher</surname><given-names>E</given-names></string-name>, <string-name><surname>Underwood</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>Assignment of epidemiological lineages in an emerging pandemic using the pangolin tool</article-title>. <source>Virus Evol</source><year>2021</year>;<volume>7</volume>:<fpage>veab064</fpage>.<pub-id pub-id-type="pmid">34527285</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pal</surname><given-names>C</given-names></string-name>, <string-name><surname>Bengtsson-Palme</surname><given-names>J</given-names></string-name>, <string-name><surname>Rensing</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>Bacmet: antibacterial biocide and metal resistance genes database</article-title>. <source>Nucleic Acids Res</source><year>2014</year>;<volume>42</volume>:<fpage>D737</fpage>–<lpage>43</lpage>.<pub-id pub-id-type="pmid">24304895</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Prjibelski</surname><given-names>A</given-names></string-name>, <string-name><surname>Antipov</surname><given-names>D</given-names></string-name>, <string-name><surname>Meleshko</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>Using spades de novo assembler</article-title>. <source>Curr Protoc Bioinformatics</source><year>2020</year>;<volume>70</volume>:<fpage>e102</fpage>.<pub-id pub-id-type="pmid">32559359</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B38">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Quast</surname><given-names>C</given-names></string-name>, <string-name><surname>Pruesse</surname><given-names>E</given-names></string-name>, <string-name><surname>Yilmaz</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>The silva ribosomal rna gene database project: improved data processing and web-based tools</article-title>. <source>Nucleic Acids Res</source><year>2012</year>;<volume>41</volume>:<fpage>D590</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">23193283</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ruscheweyh</surname><given-names>H-J</given-names></string-name>, <string-name><surname>Milanese</surname><given-names>A</given-names></string-name>, <string-name><surname>Paoli</surname><given-names>L</given-names></string-name></person-group><etal>et al</etal><article-title>Cultivation-independent genomes greatly expand taxonomic-profiling capabilities of mOTUs across various environments</article-title>. <source>Microbiome</source><year>2022</year>;<volume>10</volume>:<fpage>212</fpage>.<pub-id pub-id-type="pmid">36464731</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B40">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wood</surname><given-names>DE</given-names></string-name>, <string-name><surname>Lu</surname><given-names>J</given-names></string-name>, <string-name><surname>Langmead</surname><given-names>B.</given-names></string-name></person-group><article-title>Improved metagenomic analysis with kraken 2</article-title>. <source>Genome Biol</source><year>2019</year>;<volume>20</volume>:<fpage>257</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">31779668</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B41">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname><given-names>A-N</given-names></string-name>, <string-name><surname>Gaston</surname><given-names>JM</given-names></string-name>, <string-name><surname>Dai</surname><given-names>CL</given-names></string-name></person-group><etal>et al</etal><article-title>An omics-based framework for assessing the health risk of antimicrobial resistance genes</article-title>. <source>Nat Commun</source><year>2021</year>;<volume>12</volume>:<fpage>4765</fpage>.<pub-id pub-id-type="pmid">34362925</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B42">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname><given-names>X</given-names></string-name>, <string-name><surname>Jonassen</surname><given-names>I.</given-names></string-name></person-group><article-title>RASflow: an RNA-Seq analysis workflow with Snakemake</article-title>. <source>BMC Bioinformatics</source><year>2020</year>;<volume>21</volume>:<fpage>1</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">31898485</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10918635</article-id>
    <article-id pub-id-type="pmid">38377397</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btae086</article-id>
    <article-id pub-id-type="publisher-id">btae086</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ARGprofiler—a pipeline for large-scale analysis of antimicrobial resistance genes and their flanking regions in metagenomic datasets</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-6733-7888</contrib-id>
        <name>
          <surname>Martiny</surname>
          <given-names>Hannah-Marie</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
        <xref rid="btae086-cor1" ref-type="corresp"/>
        <!--hanmar@food.dtu.dk-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pyrounakis</surname>
          <given-names>Nikiforos</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Petersen</surname>
          <given-names>Thomas N</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lukjančenko</surname>
          <given-names>Oksana</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Aarestrup</surname>
          <given-names>Frank M</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Clausen</surname>
          <given-names>Philip T L C</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Munk</surname>
          <given-names>Patrick</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Alkan</surname>
          <given-names>Can</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btae086-cor1">Corresponding author. Research Group for Genomic Epidemiology, Technical University of Denmark, Henrik Danms Alle, Bygning 204, Kongens Lyngby 2800, Denmark. E-mail: <email>hanmar@food.dtu.dk</email> (H.-M.M.)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>3</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-02-20">
      <day>20</day>
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>20</day>
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <volume>40</volume>
    <issue>3</issue>
    <elocation-id>btae086</elocation-id>
    <history>
      <date date-type="received">
        <day>10</day>
        <month>7</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>11</day>
        <month>12</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>01</day>
        <month>2</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>06</day>
        <month>3</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btae086.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Analyzing metagenomic data can be highly valuable for understanding the function and distribution of antimicrobial resistance genes (ARGs). However, there is a need for standardized and reproducible workflows to ensure the comparability of studies, as the current options involve various tools and reference databases, each designed with a specific purpose in mind.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>In this work, we have created the workflow ARGprofiler to process large amounts of raw sequencing reads for studying the composition, distribution, and function of ARGs. ARGprofiler tackles the challenge of deciding which reference database to use by providing the PanRes database of 14 078 unique ARGs that combines several existing collections into one. Our pipeline is designed to not only produce abundance tables of genes and microbes but also to reconstruct the flanking regions of ARGs with ARGextender. ARGextender is a bioinformatic approach combining KMA and SPAdes to recruit reads for a targeted <italic toggle="yes">de novo</italic> assembly. While our aim is on ARGs, the pipeline also creates Mash sketches for fast searching and comparisons of sequencing runs.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>The ARGprofiler pipeline is a Snakemake workflow that supports the reuse of metagenomic sequencing data and is easily installable and maintained at <ext-link xlink:href="https://github.com/genomicepidemiology/ARGprofiler" ext-link-type="uri">https://github.com/genomicepidemiology/ARGprofiler</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Novo Nordisk Foundation</institution>
            <institution-id institution-id-type="DOI">10.13039/501100009708</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>NNF16OC0021856</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Global Surveillance of Antimicrobial Resistance</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Union’s Horizon 2020</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="8"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>Investigating the resistome of metagenomic datasets, including the abundances of the different antimicrobial resistance genes (ARGs) and the gene synteny (gene flanking regions), has become a major research area in recent years (<xref rid="btae086-B20" ref-type="bibr">Holmes <italic toggle="yes">et al.</italic> 2016</xref>, <xref rid="btae086-B5" ref-type="bibr">Bengtsson-Palme <italic toggle="yes">et al.</italic> 2018</xref>, <xref rid="btae086-B19" ref-type="bibr">Hendriksen <italic toggle="yes">et al.</italic> 2019</xref>, <xref rid="btae086-B3" ref-type="bibr">Anthony <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btae086-B41" ref-type="bibr">Zhang <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btae086-B26" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022b</xref>, <xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>). In many cases, research investigation, especially on a large scale, has been limited to research groups that are technologically and financially able to combine large-scale data generation with advanced bioinformatic and modeling expertise. However, because of the good data-sharing practices of next-generation sequencing efforts, there are today a large number of sequencing datasets available in public repositories. We have recently provided a curated dataset of acquired ARG abundance estimates in more than 214 000 publicly available metagenomic datasets (<xref rid="btae086-B25" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022a</xref>).</p>
    <p>Processing these datasets in a uniform approach calls for optimized, standardized methods to support the broader scientific community in utilizing these datasets. The practice of sharing bioinformatic workflows, or pipelines, has not historically been part of the academic publishing process. However, with the growing volumes of biological sequencing data available, researchers have begun to publish their workflows. Recent examples include pangolin for tracing SARS-CoV2 lineages (<xref rid="btae086-B35" ref-type="bibr">O’Toole <italic toggle="yes">et al.</italic> 2021</xref>), RASflow for RNA sequencing data (<xref rid="btae086-B42" ref-type="bibr">Zhang and Jonassen 2020</xref>), and ATLAS for metagenomic sequencing data (<xref rid="btae086-B22" ref-type="bibr">Kieser <italic toggle="yes">et al.</italic> 2020</xref>).</p>
    <p>Here, we present ARGprofiler, a newly developed pipeline designed to analyze read dissimilarities, abundances, and genomic flanking regions of ARGs in metagenomic sequencing data (<xref rid="btae086-F1" ref-type="fig">Fig. 1</xref>). ARGprofiler has been adapted to work for short-read sequencing reads, where we have carefully evaluated each step in our metagenomic workflow. ARGprofiler includes the PanRes database, a combined collection of current ARG databases, and ARGextender, an assembly tool for producing targeted <italic toggle="yes">de novo</italic> assemblies. The pipeline is an easily usable and scalable workflow implemented in Snakemake (<xref rid="btae086-B23" ref-type="bibr">Köster and Rahmann 2012</xref>, <xref rid="btae086-B29" ref-type="bibr">Mölder <italic toggle="yes">et al.</italic> 2021</xref>), which allows any user to process sequencing data to perform epidemiological analyses of ARGs globally. ARGprofiler is another step toward enabling the reuse of metagenomic sequences, and while we have targeted antimicrobial resistance (AMR), the pipeline can be repurposed for other tasks.</p>
    <fig position="float" id="btae086-F1">
      <label>Figure 1.</label>
      <caption>
        <p>The ARGprofiler pipeline. This schematic illustrates the components of the pipeline: (a) Download of sequencing reads from ENA, (b) preprocessing of retrieved reads with fastp, (c) procedure of aligning reads against chosen reference sequence database(s) with KMA, (d) assembly of targeted flanking regions of antimicrobial resistance genes with ARGextender that passes requirements in a filtering step, and (e) sketching sequencing reads with Mash.</p>
      </caption>
      <graphic xlink:href="btae086f1" position="float"/>
    </fig>
  </sec>
  <sec sec-type="methods">
    <title>Methods</title>
    <sec>
      <title>Implementation of ARGprofiler</title>
      <p>ARGprofiler is a Snakemake workflow (<xref rid="btae086-B23" ref-type="bibr">Köster and Rahmann 2012</xref>) that is organized into five different parts: (i) download of metagenomic datasets, (b) trimming and quality check of sequencing reads, (iii) mapping and alignment of reads against reference sequences, including ARGs and bacteria, (iv) building of flanking regions around genes of interest, and (v) creation of Mash sketches (<xref rid="btae086-F1" ref-type="fig">Fig. 1</xref>). Mapping to bacteria is done to compare the ARG content to the bacterial composition, and Mash sketches to allow for searching for samples with similar or different compositions.</p>
      <p>ARGprofiler can handle both short single- and paired-end reads and combines existing and newly established tools and reference databases to produce a single comprehensive analysis pipeline.</p>
    </sec>
    <sec>
      <title>Retrieval of metagenomic datasets</title>
      <p>To manage the download of sequencing read data from ENA, ARGprofiler utilizes fastq-dl 2.0.4 (<ext-link xlink:href="https://github.com/rpetit3/fastq-dl" ext-link-type="uri">https://github.com/rpetit3/fastq-dl</ext-link>) to retrieve and download the reads by matching the given run_accessions in a JSON input file provided by the user. ARGprofiler is also capable of handling reads stored in a local folder as an alternative to downloading ENA read sets.</p>
    </sec>
    <sec>
      <title>Preprocessing of sequencing reads</title>
      <p>The first step in a sequencing workflow is the quality checking and trimming of the raw sequencing reads. Historically, FASTQC (<xref rid="btae086-B2" ref-type="bibr">Andrews 2010</xref>) has been used for quality checking and BBduk (<xref rid="btae086-B10" ref-type="bibr">Bushnell 2014</xref>) to remove adaptors and low-quality sequences (<xref rid="btae086-B25" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022a</xref>, <xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>). However, new and faster tools have appeared, such as the widely adopted tool fastp (<xref rid="btae086-B11" ref-type="bibr">Chen 2023</xref>). Therefore, we decided to compare the performance of fastp 0.23.2 with the combination of FASTQC and BBduk to ensure an efficient preprocessing of the raw reads.</p>
    </sec>
    <sec>
      <title>Mapping and alignment of reads against reference databases</title>
      <p>To quantify ARGs and microorganisms, KMA 1.4.12a (<xref rid="btae086-B13" ref-type="bibr">Clausen <italic toggle="yes">et al.</italic> 2018</xref>) was used to map and align the trimmed reads to different databases. KMA uses <italic toggle="yes">k</italic>-mer seeding to increase mapping speed and is specifically made for mapping reads against redundant databases. We designed the alignment procedure to use two reference sequence databases: the PanRes collection of ARGs and the mOTUs3 database (<xref rid="btae086-B39" ref-type="bibr">Ruscheweyh <italic toggle="yes">et al.</italic> 2022</xref>) for microbiome profiling. Details on the choice and design of reference databases are described in later sections.</p>
    </sec>
    <sec>
      <title>Metagenome representation using Mash sketches</title>
      <p>We used Mash 2.3 (<xref rid="btae086-B33" ref-type="bibr">Ondov <italic toggle="yes">et al.</italic> 2016</xref>) to enable comparison between large sets of metagenomes for subsequent selection and analysis by creating MinHash sketches as representatives for individual metagenomes. This allows an unbiased comparison of samples with a low constant memory footprint and a short turnaround time, which can be used for subsequent clustering and identification of closely related metagenomes (<xref rid="btae086-B33" ref-type="bibr">Ondov <italic toggle="yes">et al.</italic> 2016</xref>). We identified appropriate sketch and <italic toggle="yes">k</italic>-mer sizes using a selection of 72 sewage metagenomes: 36 from Copenhagen sewage (<xref rid="btae086-B9" ref-type="bibr">Brinch <italic toggle="yes">et al.</italic> 2020</xref>), 18 from various sites in the world (<xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>), and the remaining 18 were technical replicates of a single sewage sample taken in Copenhagen, Denmark (PRJEB63576). Sketches were created for all samples using sketch sizes of <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>5</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>, and <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>6</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>, with <italic toggle="yes">k</italic>-mer sizes of 16, 21, 27, and 31. Mash distances were calculated to find the parameters resulting in lower within-sample distances than between-sample distances. Distances were also clustered using Dynamic Neighbor-Joining with CCPhylo 0.8.3 (<xref rid="btae086-B12" ref-type="bibr">Clausen 2023</xref>) to verify the appropriate sub-clustering of samples.</p>
    </sec>
    <sec>
      <title>Building flanking regions around genes of interest with ARGextender</title>
      <p>To examine the genomic content surrounding ARGs, we created ARGextender to build genomic flanking regions around identified ARGs. ARGextender recruits reads using a recursive approach with KMA and SPAdes (<xref rid="btae086-B37" ref-type="bibr">Prjibelski <italic toggle="yes">et al.</italic> 2020</xref>), which produce comparable results and are faster than full metagenome <italic toggle="yes">de novo</italic> assembly with SPAdes. A more detailed description of ARGextender can be found in a later section. Because KMA will also assign reads to low abundant sequences that are unlikely to form contigs, we created a filtering step using the KMA mapstat files so that only samples fulfilling the following criteria would be assembled: <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>90</mml:mn></mml:mrow></mml:math></inline-formula>% query identity, <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>90</mml:mn></mml:mrow></mml:math></inline-formula>% global consensus identity, and a mean read depth <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec>
      <title>The PanRes database</title>
      <p>Bacterial genes that encode resistance to antibiotic drugs, heavy metals, and biocides have been previously identified and compiled into several databases (<xref rid="btae086-B1" ref-type="bibr">Alcock <italic toggle="yes">et al.</italic> 2023</xref>, <xref rid="btae086-B7" ref-type="bibr">Bonin <italic toggle="yes">et al.</italic> 2023</xref>, <xref rid="btae086-B8" ref-type="bibr">Bortolaia <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btae086-B16" ref-type="bibr">Feldgarden <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btae086-B18" ref-type="bibr">Gupta <italic toggle="yes">et al.</italic> 2014</xref>, <xref rid="btae086-B17" ref-type="bibr">Gschwind <italic toggle="yes">et al.</italic> 2023</xref>) . We sought to collect these genes of interest into a single unique collection that we named PanRes; short for the pan resistance, as having a single, although highly redundant collection is computationally more efficient to search through.</p>
      <p>The following gene databases were identified and used as seeds for the selection of genes for the PanRes collection: ResFinder (downloaded 20 January 2023, <xref rid="btae086-B8" ref-type="bibr">Bortolaia <italic toggle="yes">et al.</italic> 2020</xref>), ResFinderFG (version 2.0, <xref rid="btae086-B17" ref-type="bibr">Gschwind <italic toggle="yes">et al.</italic> 2023</xref>), CARD (version 3.2.5, <xref rid="btae086-B1" ref-type="bibr">Alcock <italic toggle="yes">et al.</italic> 2023</xref>), MegaRes (version 3.0.0, <xref rid="btae086-B7" ref-type="bibr">Bonin <italic toggle="yes">et al.</italic> 2023</xref>), AMRFinderPlus (version 3.11/2022-12-19.1, <xref rid="btae086-B16" ref-type="bibr">Feldgarden <italic toggle="yes">et al.</italic> 2021</xref>), and ARGANNOT (V6_July2019, <xref rid="btae086-B18" ref-type="bibr">Gupta <italic toggle="yes">et al.</italic> 2014</xref>). In addition to these collections, we used a set of cloned, functionally determined ARGs from environmental and clinical samples tested for resistance to antibiotics not yet on the market (<xref rid="btae086-B14" ref-type="bibr">Daruka <italic toggle="yes">et al.</italic> 2023</xref>). We received these sequences in November 2022 [Csaba Pál and Zoltán Farkas (Personal communication, July 2022)], and tagged them with “CsabaPal” in the collection.</p>
      <p>From the CARD database, the genes based on the protein homolog model were included as they are acquired and do not rely on mutations for resistance. In the MegaRes gene collection, sequences with the “RequiresSNPConfirmation” tag were excluded from consideration, as these represent mutated versions of housekeeping genes, regulators, repressors, and promoter sequences. From the AMRFinderPlus sequences of the “AMR” type, only those satisfying the “AMR” subtype were used. For the genes of the “STRESS” type, just the “BIOCIDE” and “METAL” subtypes were retained.</p>
      <p>As heavy metals often co-select for antibiotic resistance (<xref rid="btae086-B4" ref-type="bibr">Baker-Austin <italic toggle="yes">et al.</italic> 2006</xref>), we did a screening for metal resistance genes. The BacMet v1.1 collection of experimentally verified resistance proteins was used as a starting point (<xref rid="btae086-B36" ref-type="bibr">Pal <italic toggle="yes">et al.</italic> 2014</xref>), where the BacMet GenBank accessions were used to extract the coding sequences (<xref rid="btae086-B31" ref-type="bibr">NCBI Resource Coordinators 2018</xref>). We then manually curated the collection of metal resistance genes with sequences identified in the published literature, with a special focus on acquired cobalt, zinc, cobalt, copper, arsenite, mercury, cadmium, lead, or silver-resistance genes retrieved using the NCBI nucleotide database (<xref rid="btae086-B31" ref-type="bibr">NCBI Resource Coordinators 2018</xref>). The final collection of metal resistance genes we refer to as the MetalResistance database is deposited at: <ext-link xlink:href="https://doi.org/10.5281/zenodo.8108201" ext-link-type="uri">https://doi.org/10.5281/zenodo.8108201</ext-link>.</p>
      <p>All retrieved sequences were clustered using Usearch 11.0.667 (<xref rid="btae086-B15" ref-type="bibr">Edgar 2010</xref>) with the fastx_uniques algorithm to identify unique sequences to include in PanRes. These unique ARGs were clustered based on 90% identity and 90% coverage with the cluster_fast algorithm. GeneAssimiliator (<ext-link xlink:href="https://github.com/genomicepidemiology/gene\_assimilator" ext-link-type="uri">https://github.com/genomicepidemiology/gene\_assimilator</ext-link>) was used to perform this iterative approach of recruiting, clustering, and refining gene collections of various sources into one.</p>
    </sec>
    <sec>
      <title>ARGextender</title>
      <p>Despite the value provided through metagenomic <italic toggle="yes">de novo</italic> assemblies, the computational demands are often too high to be considered for routine use (<xref rid="btae086-B26" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022b</xref>). To enable a shorter turnaround time of metagenomic assemblies with lower computational demands, we developed ARGextender to perform <italic toggle="yes">de novo</italic> assemblies around target sequences of interest.</p>
      <p>ARGextender recursively applies KMA 1.4.12a (<xref rid="btae086-B13" ref-type="bibr">Clausen <italic toggle="yes">et al.</italic> 2018</xref>) and SPAdes 3.15.5 (<xref rid="btae086-B32" ref-type="bibr">Nurk <italic toggle="yes">et al.</italic> 2017</xref>, <xref rid="btae086-B37" ref-type="bibr">Prjibelski <italic toggle="yes">et al.</italic> 2020</xref>), where KMA is used to identify the target sequences in the sample, followed by a <italic toggle="yes">de novo</italic> assembly of the reads matching the target(s) using SPAdes. After each <italic toggle="yes">de novo</italic> assembly, scaffolds containing target sequences are extracted using KMA and set as the new target. This recursion is repeated until no more reads are included in the <italic toggle="yes">de novo</italic> assembly or the user-defined maximum number of recursions has been met (unlimited by default). When the targeted <italic toggle="yes">de novo</italic> assembly has saturated, the scaffolds and assembly graph are saved, along with a table containing the information about which target sequences are found within each scaffold. These include target sequences with an alignment score within 70% of the best-scoring target sequences.</p>
      <p>We evaluated the ARGextender tool by comparing the output of ARGextender to full <italic toggle="yes">de novo</italic> metagenomic assemblies of 951 urban sewage samples published by (<xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>). We compared the resulting scaffolds by matching the sequences of the ResFinder database to the scaffolds using KMA 1.4.12a with the “-ont” parameter. The surrounding flanks were then extracted and compared.</p>
    </sec>
    <sec>
      <title>Evaluating tools for profiling microbiomes</title>
      <p>We compared the performance of KMA (<xref rid="btae086-B13" ref-type="bibr">Clausen <italic toggle="yes">et al.</italic> 2018</xref>) with several microbial reference databases and profiling tools. Using the <italic toggle="yes">in silico</italic> data generated for the profiling test in the Critical Assessment of Metagenome Interpretation (CAMI) challenge (<xref rid="btae086-B28" ref-type="bibr">Meyer <italic toggle="yes">et al.</italic> 2022</xref>), we tested mOTUs 3.0.3 (<xref rid="btae086-B39" ref-type="bibr">Ruscheweyh <italic toggle="yes">et al.</italic> 2022</xref>), MetaPhlAn 4.0.3 (<xref rid="btae086-B6" ref-type="bibr">Blanco-Míguez <italic toggle="yes">et al.</italic> 2023</xref>), Bracken 2.8 (<xref rid="btae086-B24" ref-type="bibr">Lu <italic toggle="yes">et al.</italic> 2017</xref>) on Kraken2 (<xref rid="btae086-B40" ref-type="bibr">Wood <italic toggle="yes">et al.</italic> 2019</xref>) output, and KMA 1.4.7 with the following reference databases: the mOTUs database (<xref rid="btae086-B39" ref-type="bibr">Ruscheweyh <italic toggle="yes">et al.</italic> 2022</xref>) of 521 780 sequences (version 3.0.1, downloaded 5 December 2022), the Silva database (<xref rid="btae086-B38" ref-type="bibr">Quast <italic toggle="yes">et al.</italic> 2012</xref>) of 2 225 272 sequences (version 138, downloaded 16 January 2020), and a custom database of the genomic database of 16 732 113 genomic sequences (downloaded 24 May 2022, compiled using a previously described procedure (<xref rid="btae086-B34" ref-type="bibr">Osakunor <italic toggle="yes">et al.</italic> 2020</xref>).</p>
      <p>The performance of each tool and reference database was evaluated similarly to the CAMI challenge using the OPAL tool (<xref rid="btae086-B27" ref-type="bibr">Meyer <italic toggle="yes">et al.</italic> 2019</xref>). Results with low abundances were filtered away (“-f 1”). We used three binary classification metrics on each taxonomic level, from superkingdom to species, to determine performance and the sum of abundances, specifically purity, completeness, and F1 scores. Purity and completeness consider the performance of correctly identifying taxons without considering relative abundances, where TP is the number of true positives, FP is the number of false positives, and FN is the false negatives: <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mtext>Purity</mml:mtext><mml:mo>=</mml:mo><mml:mtext>TP</mml:mtext><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mtext>TP</mml:mtext><mml:mo>+</mml:mo><mml:mtext>FP</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:mtext>Completeness</mml:mtext><mml:mo>=</mml:mo><mml:mtext>TP</mml:mtext><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mtext>TP</mml:mtext><mml:mo>+</mml:mo><mml:mtext>FN</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. The F1 score measures the overall performance of taxon identification and is defined as:
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mi mathvariant="normal">F</mml:mi><mml:mn>1</mml:mn><mml:mo> </mml:mo><mml:mtext>score</mml:mtext><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>purity</mml:mtext><mml:mo>⋅</mml:mo><mml:mtext>completeness</mml:mtext></mml:mrow><mml:mrow><mml:mtext>purity</mml:mtext><mml:mo>+</mml:mo><mml:mtext>completeness</mml:mtext></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
    </sec>
  </sec>
  <sec sec-type="data-availability">
    <title>Code and data availability</title>
    <p>The ARGprofiler pipeline is available on GitHub, at <ext-link xlink:href="https://github.com/genomicepidemiology/ARGprofiler" ext-link-type="uri">https://github.com/genomicepidemiology/ARGprofiler</ext-link> under the APACHE-2.0 license. ARGextender is included as part of the ARGprofiler repository. GeneAssimilator is available at <ext-link xlink:href="https://github.com/genomicepidemiology/gene_assimilator" ext-link-type="uri">https://github.com/genomicepidemiology/gene_assimilator</ext-link>. The code for the comparison of microbial profilers is available at <ext-link xlink:href="https://github.com/genomicepidemiology/argprofiler-tax-benchmark" ext-link-type="uri">https://github.com/genomicepidemiology/argprofiler-tax-benchmark</ext-link>. Jupyter Notebooks supporting the various figures and tables have been shared at <ext-link xlink:href="https://github.com/genomicepidemiology/argprofiler-paper-notebooks" ext-link-type="uri">https://github.com/genomicepidemiology/argprofiler-paper-notebooks</ext-link>.</p>
    <p>The MetalResistance gene database is available on Zenodo, at <ext-link xlink:href="https://doi.org/10.5281/zenodo.8108201" ext-link-type="uri">https://doi.org/10.5281/zenodo.8108201</ext-link>, and the first version of the PanRes collection is available at <ext-link xlink:href="https://doi.org/10.5281/zenodo.8055115" ext-link-type="uri">https://doi.org/10.5281/zenodo.8055115</ext-link>. Output files of benchmarking microbial profilers are available at <ext-link xlink:href="https://doi.org/10.5281/zenodo.7923774" ext-link-type="uri">https://doi.org/10.5281/zenodo.7923774</ext-link>. The full de novo assemblies of urban sewage samples are available on ENA under project accessions PRJEB40798, PRJEB40816, PRJEB40815, PRJEB27621, and ERP015409. The Copenhagen sewage collection is under PRJEB34633, and the repeated resequencing of a single Copenhagen sewage sample is under PRJEB63576.</p>
    <sec>
      <title>Results</title>
      <p>With ARGprofiler, we wanted to focus on creating a pipeline that produces three main outputs suitable for analyzing metagenomic datasets: the abundance of reads aligned to different genes of two suitable reference databases (mOTUs and PanRes), targeted <italic toggle="yes">de novo</italic> assemblies with ARGextender, and MinHash sketches with Mash (<xref rid="btae086-F1" ref-type="fig">Fig. 1</xref>). Our pipeline has been designed to be suitable for large volumes of sequencing reads by using the workflow manage Snakemake and by carefully selecting appropriate tools.</p>
    </sec>
    <sec>
      <title>The PanRes collection</title>
      <p>PanRes was created to compile several existing ARG reference databases into one, as there are both overlaps and discrepancies between the different ones (<xref rid="btae086-F2" ref-type="fig">Fig. 2a</xref>). Out of 30 400 genes, we identified a set of 14 078 unique sequences that were included in PanRes. Grouping these genes based on 90% identity and 90% coverage produced 5280 centroids, which ranged in lengths between 93 and 5972 bp, with a median of 762 bp (<xref rid="btae086-F2" ref-type="fig">Fig. 2b</xref>).</p>
      <fig position="float" id="btae086-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Overview of the sequences included in PanRes. (a) A comparison of overlaps between the different databases in the PanRes collection. (b) Distribution of antimicrobial resistance gene lengths.</p>
        </caption>
        <graphic xlink:href="btae086f2" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>Assembling flanks around genes with ARGextender</title>
      <p>To validate the output of ARGextender, we compared the scaffolds with those produced by SPAdes on a set of 951 urban sewage samples (<xref rid="btae086-F3" ref-type="fig">Fig. 3</xref>). On average, ARGextender built 101 scaffolds (range: 1–350), whereas SPAdes reported 95 ARG-scaffolds on average (range: 1–348). The number of distinct ARGs detected in the scaffolds was on average 57 for ARGextender (range 1–141) and 58 for SPAdes (range: 1–153) (<xref rid="btae086-F3" ref-type="fig">Fig. 3a</xref>). Most of the flanks extracted around ARGs were between 100 and 5000 bp, although many had no flanking regions (<xref rid="btae086-F3" ref-type="fig">Fig. 3b</xref>). Excluding scaffolds with zero flanks, we can see that ARGextender and SPAdes can assemble flanks around a similar number of ARGs (<xref rid="btae086-F3" ref-type="fig">Fig. 3c</xref>). Overall, ARGextender was capable of assembling the same amount of flanks as SPAdes with lower computational requirements (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Appendix B</xref>), although SPAdes produced longer flanks for some samples.</p>
      <fig position="float" id="btae086-F3">
        <label>Figure 3.</label>
        <caption>
          <p>A comparison between the flanks extracted around ARGs found in scaffolds produced with either SPAdes or ARGextender. (a) Number of scaffolds containing at least one ARG compared with the number of ARGs detected across all scaffolds in a sample. (b) Distribution of flanking content (bp: basepairs) in sewage samples, including the number of scaffolds without a flanking region in the top right corner. (c) Overlap between the tool regarding which ARGs had flanks, excluding the scaffolds with zero flank regions. Only ARGs with a minimum of 95% breadth of coverage were included in this figure. ARG: antimicrobial resistance genes.</p>
        </caption>
        <graphic xlink:href="btae086f3" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>Choosing a microbial profiler and reference database</title>
      <p>Since there are multiple different tools and reference databases available to profile the microbial content of a sample, we compared the performances of each method with various databases (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Appendix A</xref>, <xref rid="btae086-F4" ref-type="fig">Fig. 4</xref>). KMA reported more matched reference sequences, regardless of the database used, where most were false positives (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. A1</xref>). After removing hits with low abundances, KMA were comparable with MetaPhlAn and mOTUs, sometimes identifying more taxons than the other tools (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. A2</xref>). We observed a decrease in completeness and purity in taxon identification for the non-human environments for all tools and databases (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Figs A3 and A4</xref>). Despite this decrease, KMA had higher completeness than MetaPhlAn, mOTUs, and Bracken on the plant-associated samples (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. A4a</xref>). KMA with the mOTUs sequences (KMA-mOTUs) outperformed KMA with genomic and Silva databases across all six sampling groups regarding binary metrics (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Appendix A</xref>). While KMA-mOTUs abundance results were generally lower, the F1 scores were on par with the MetaPhlAn and mOTUs profilers (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Figs A5 and A6</xref>), which we believe is due to a difference in how abundance is calculated in the other tools.</p>
      <fig position="float" id="btae086-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Performance of microbial profilers on the <italic toggle="yes">in silico</italic> CAMI data as measured by the F1 score at genus rank. The harmonic mean is reported as the circle, and the error bars are the standard deviation. CAMI: critical assessment of metagenome interpretation.</p>
        </caption>
        <graphic xlink:href="btae086f4" position="float"/>
      </fig>
      <p>We decided on combining KMA with the mOTUs sequences for two reasons. First, we plan to apply our pipeline as an environment-agnostic passive surveillance tool encompassing many One Health settings important for ARG ecology. Therefore, we deemed performance outside just human microbiomes important, where KMA-mOTUs outperformed all other tools on the plant-associated samples and were on par with marine samples (<xref rid="btae086-F4" ref-type="fig">Fig. 4</xref>). Second, since we also use KMA for the ARG quantification, this choice limited the overall pipeline complexity.</p>
    </sec>
    <sec>
      <title>Clustering and representing metagenomes using Mash sketches</title>
      <p>Most of the output of ARGprofiler relies on known reference sequences. To enable unbiased metagenome-wise comparison and clustering of sequence runs, we include the creation of sketches using Mash. We tested the discriminatory power of different sketch and <italic toggle="yes">k</italic>-mer sizes on sewage samples, some of which were technical sequence replicates of the same sample. Both the very small sketch sizes and short <italic toggle="yes">k</italic>-mers failed to clearly distinguish between technical replicates of the same sample and sequence runs of other sewage samples (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. B5</xref> in appendix). Technical replicates were efficiently separated from the remaining samples with a <italic toggle="yes">k</italic>-mer size of 31 and sketch size of <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mo>≥</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. B6</xref> in appendix). As smaller sketch sizes require less computational resources, a sketch size of 104 was included as default in ARGprofiler.</p>
    </sec>
    <sec>
      <title>Reducing computational time and memory usage</title>
      <p>Analyzing the large quantities of metagenomic data currently available at ENA and future data is not computationally trivial, and choosing efficient workflows will seriously impact the associated time, costs, and energy expenditure. We did a benchmark of each rule using a set of metagenomic datasets from a variety of sampling origins (details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Material Appendix B</xref>), where we observed that with our final parameter settings, the ARGprofiler pipeline processed 1.21 gigabasepairs/h (Gbps/h) with a median processing performance of 0.36 Gbps/h. Most steps had a sample-average peak memory footprint below 1 GB and required less than a CPU hour, except for KMA-mOTUs and ARGextender (<xref rid="btae086-T1" ref-type="table">Table 1</xref>).</p>
      <table-wrap position="float" id="btae086-T1">
        <label>Table 1.</label>
        <caption>
          <p>Measured times and memory usage for each step of the ARGprofiler pipeline.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="center" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="2" colspan="1">Rule</th>
              <th rowspan="2" align="center" colspan="1">Tool</th>
              <th colspan="2" align="center" rowspan="1">CPU time (h)<hr/></th>
              <th colspan="2" align="center" rowspan="1">Memory (MB)<hr/></th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">
                <inline-formula id="IE11">
                  <mml:math id="IM11" display="inline" overflow="scroll">
                    <mml:mo>μ</mml:mo>
                  </mml:math>
                </inline-formula>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <inline-formula id="IE12">
                  <mml:math id="IM12" display="inline" overflow="scroll">
                    <mml:mo>σ</mml:mo>
                  </mml:math>
                </inline-formula>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <inline-formula id="IE13">
                  <mml:math id="IM13" display="inline" overflow="scroll">
                    <mml:mo>μ</mml:mo>
                  </mml:math>
                </inline-formula>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <inline-formula id="IE14">
                  <mml:math id="IM14" display="inline" overflow="scroll">
                    <mml:mo>σ</mml:mo>
                  </mml:math>
                </inline-formula>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">Read download</td>
              <td rowspan="1" colspan="1">fastq-dl</td>
              <td rowspan="1" colspan="1">0.58</td>
              <td rowspan="1" colspan="1">1.33</td>
              <td rowspan="1" colspan="1">1389.83</td>
              <td rowspan="1" colspan="1">1052</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Read preprocessing</td>
              <td rowspan="1" colspan="1">fastp</td>
              <td rowspan="1" colspan="1">0.51</td>
              <td rowspan="1" colspan="1">1.23</td>
              <td rowspan="1" colspan="1">2375.95</td>
              <td rowspan="1" colspan="1">1748.43</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Microbiome read alignment</td>
              <td rowspan="1" colspan="1">KMA-mOTUs</td>
              <td rowspan="1" colspan="1">2.66</td>
              <td rowspan="1" colspan="1">6.04</td>
              <td rowspan="1" colspan="1">6817.09</td>
              <td rowspan="1" colspan="1">3.44</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">ARG read alignment</td>
              <td rowspan="1" colspan="1">KMA-PanRes</td>
              <td rowspan="1" colspan="1">0.43</td>
              <td rowspan="1" colspan="1">0.99</td>
              <td rowspan="1" colspan="1">308.75</td>
              <td rowspan="1" colspan="1">137.05</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Building flanking regions</td>
              <td rowspan="1" colspan="1">ARGextender</td>
              <td rowspan="1" colspan="1">2.06</td>
              <td rowspan="1" colspan="1">5.20</td>
              <td rowspan="1" colspan="1">539.61</td>
              <td rowspan="1" colspan="1">804.92</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Creating MinHash sketches</td>
              <td rowspan="1" colspan="1">Mash sketch</td>
              <td rowspan="1" colspan="1">0.24</td>
              <td rowspan="1" colspan="1">0.59</td>
              <td rowspan="1" colspan="1">2.03</td>
              <td rowspan="1" colspan="1">0.10</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn1">
            <p>The average (<inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>) CPU time in hours (h) and the peak memory in megabytes (MB) are reported together with standard deviations (<inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mo>σ</mml:mo></mml:math></inline-formula>). Note that the CPU hours and peak memory for ARGextender did not include the two samples that were not completed within our limit of 48 h.</p>
          </fn>
          <fn id="tblfn2">
            <p>ARG: antimicrobial resistance genes.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
  </sec>
  <sec sec-type="discussion">
    <title>Discussion</title>
    <p>There are currently terabytes of metagenomic sequencing data available in public databases, and producing standardized and consistent results is necessary for downstream analyses. Therefore, we have designed ARGprofiler to allow efficient ARG-monitoring and quantification in vast amounts of sequencing data, determine flanking regions around ARGs for downstream epidemiological investigation, and <italic toggle="yes">k</italic>-mer-based comparison of sequence runs. Each output aligns with our overall goal of reanalyzing public sequencing datasets for the characteristics of ARGs in a global microbial and environmental context.</p>
    <p>One of the unique features of ARGprofiler is the addition of the PanRes database. The motivation behind PanRes was to eliminate the inefficiency associated with searching for the same gene in multiple collections and the additional overhead of spawning extra compute jobs for each collection. We, therefore, sought to collect the unique sequences of ARGs from a wide spectrum of existing databases. It is our hope that this will help facilitate fewer but larger and more efficient monitoring runs of public metagenomes, followed by data sharing and the individual AMR researchers then filtering results to their specific focus.</p>
    <p>An important feature of ARGprofiler is the creation of targeted assemblies around genes with ARGextender. ARGextender uses KMA and SPAdes to create targeted <italic toggle="yes">de novo</italic> assemblies by identifying if the targeted ARGs are present in a sample and then recruiting reads to the surrounding regions. The pairwise comparison of ARG-carrying scaffolds produced with ARGextender and SPAdes in sewage samples showed that ARGextender could extract comparable flanking regions to SPAdes but in a much shorter time frame. This approach also avoids running the more expensive algorithm if none of the target genes is identified.</p>
    <p>However, there are still a few points we need to address in the way that ARGprofiler currently works. First, ARGprofiler is designed to only work with short-read sequencing data, thus not utilizing the advantages of long-read sequencing technologies. We are planning to extend the input options to include long-read datasets. Second, a significant aspect of ARGprofiler is the choice of reference databases. PanRes is a one-size-fits-all approach for ARGs. However, as it combines different sources and scopes, it will be up to the individual research questions, which subsets are appropriate for consideration. ARGprofiler also profiles the microbiome of each sequencing dataset by mapping the reads against the microbial reference sequence database mOTUs. This step is included to compare the abundance of ARGs to the microbial content (<xref rid="btae086-B26" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022b</xref>, <xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>, <xref rid="btae086-B21" ref-type="bibr">Johansson <italic toggle="yes">et al.</italic> 2023</xref>). We chose mOTUs as this collection performed best across different environments with KMA. Our choice was based on the <italic toggle="yes">in silico</italic> datasets, and while real data might contain many more unknowns, it appeared to be the best choice for our pipeline. We chose to incorporate a sub-workflow of creating Mash sketches with optimized parameters to allow the user to compare and cluster to determine similar sequencing datasets and those of poor quality. The sketches also make it possible to query the read sets against pre-sketched genomes, thus allowing the user to re-use the data without rerunning the whole pipeline.</p>
    <p>In conclusion, we have implemented and evaluated ARGprofiler to be a robust bioinformatic pipeline that provides other researchers the opportunity to analyze large collections of metagenomic sequencing runs against a collection of ARGs or other genes of interest. The ARGprofiler code is publicly available under the Apache-2.0 license at <ext-link xlink:href="https://github.com/genomicepidemiology/ARGprofiler" ext-link-type="uri">https://github.com/genomicepidemiology/ARGprofiler</ext-link>.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btae086_Supplementary_Data</label>
      <media xlink:href="btae086_supplementary_data.zip"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by funding from the Novo Nordisk Foundation (grant number: NNF16OC0021856: Global Surveillance of Antimicrobial Resistance); the European Union’s Horizon 2020 research and innovation program under VEO grant agreement (grant number: 874735); and BY-COVID grant agreement (grant number: 101046203).</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btae086-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Alcock</surname><given-names>BP</given-names></string-name>, <string-name><surname>Huynh</surname><given-names>W</given-names></string-name>, <string-name><surname>Chalil</surname><given-names>R</given-names></string-name></person-group><etal>et al</etal><article-title>Card 2023: expanded curation, support for machine learning, and resistome prediction at the comprehensive antibiotic resistance database</article-title>. <source>Nucleic Acids Res</source><year>2023</year>;<volume>51</volume>:<fpage>D690</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">36263822</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B2">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Andrews</surname><given-names>S.</given-names></string-name></person-group> FastQC: a quality control tool for high throughput sequence data, <year>2010</year>. <ext-link xlink:href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/" ext-link-type="uri">https://www.bioinformatics.babraham.ac.uk/projects/fastqc/</ext-link> (accessed July 10, 2023).</mixed-citation>
    </ref>
    <ref id="btae086-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Anthony</surname><given-names>WE</given-names></string-name>, <string-name><surname>Burnham</surname><given-names>C-AD</given-names></string-name>, <string-name><surname>Dantas</surname><given-names>G</given-names></string-name></person-group><etal>et al</etal><article-title>The gut microbiome as a reservoir for antimicrobial resistance</article-title>. <source>J Infect Dis</source><year>2021</year>;<volume>223</volume>:<fpage>S209</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">33326581</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Baker-Austin</surname><given-names>C</given-names></string-name>, <string-name><surname>Wright</surname><given-names>MS</given-names></string-name>, <string-name><surname>Stepanauskas</surname><given-names>R</given-names></string-name></person-group><etal>et al</etal><article-title>Co-selection of antibiotic and metal resistance</article-title>. <source>Trends Microbiol</source><year>2006</year>;<volume>14</volume>:<fpage>176</fpage>–<lpage>82</lpage>.<pub-id pub-id-type="pmid">16537105</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bengtsson-Palme</surname><given-names>J</given-names></string-name>, <string-name><surname>Kristiansson</surname><given-names>E</given-names></string-name>, <string-name><surname>Larsson</surname><given-names>DJ.</given-names></string-name></person-group><article-title>Environmental factors influencing the development and spread of antibiotic resistance</article-title>. <source>FEMS Microbiol Rev</source><year>2018</year>;<volume>42</volume>:<fpage>fux053</fpage>.<pub-id pub-id-type="pmid">29069382</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Blanco-Míguez</surname><given-names>A</given-names></string-name>, <string-name><surname>Beghini</surname><given-names>F</given-names></string-name>, <string-name><surname>Cumbo</surname><given-names>F</given-names></string-name></person-group><etal>et al</etal><article-title>Extending and improving metagenomic taxonomic profiling with uncharacterized species using metaphlan 4</article-title>. <source>Nat Biotechnol</source><year>2023</year>;<volume>41</volume>:<fpage>1633</fpage>–<lpage>1644</lpage>.<pub-id pub-id-type="pmid">36823356</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bonin</surname><given-names>N</given-names></string-name>, <string-name><surname>Doster</surname><given-names>E</given-names></string-name>, <string-name><surname>Worley</surname><given-names>H</given-names></string-name></person-group><etal>et al</etal><article-title>Megares and amr++, v3. 0: an updated comprehensive database of antimicrobial resistance determinants and an improved software pipeline for classification using high-throughput sequencing</article-title>. <source>Nucleic Acids Res</source><year>2023</year>;<volume>51</volume>:<fpage>D744</fpage>–<lpage>52</lpage>.<pub-id pub-id-type="pmid">36382407</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bortolaia</surname><given-names>V</given-names></string-name>, <string-name><surname>Kaas</surname><given-names>RS</given-names></string-name>, <string-name><surname>Ruppe</surname><given-names>E</given-names></string-name></person-group><etal>et al</etal><article-title>Resfinder 4.0 for predictions of phenotypes from genotypes</article-title>. <source>J Antimicrob Chemother</source><year>2020</year>;<volume>75</volume>:<fpage>3491</fpage>–<lpage>500</lpage>.<pub-id pub-id-type="pmid">32780112</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Brinch</surname><given-names>C</given-names></string-name>, <string-name><surname>Leekitcharoenphon</surname><given-names>P</given-names></string-name>, <string-name><surname>Duarte</surname><given-names>AS</given-names></string-name></person-group><etal>et al</etal><article-title>Long-term temporal stability of the resistome in sewage from copenhagen</article-title>. <source>Msystems</source><year>2020</year>;<volume>5</volume>:<fpage>e00841-20</fpage>.<pub-id pub-id-type="pmid">33082278</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B10">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Bushnell</surname><given-names>B.</given-names></string-name></person-group><italic toggle="yes">Bbmap: A Fast, Accurate, Splice-Aware Aligner</italic>. Technical report. Berkeley, CA: Lawrence Berkeley National Lab (LBNL); <year>2014</year>.</mixed-citation>
    </ref>
    <ref id="btae086-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chen</surname><given-names>S.</given-names></string-name></person-group><article-title>Ultrafast one-pass fastq data preprocessing, quality control, and deduplication using fastp</article-title>. <source>iMeta</source><year>2023</year>;<volume>2</volume>:<fpage>e107</fpage>.</mixed-citation>
    </ref>
    <ref id="btae086-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Clausen</surname><given-names>PT.</given-names></string-name></person-group><article-title>Scaling neighbor joining to one million taxa with dynamic and heuristic neighbor joining</article-title>. <source>Bioinformatics</source><year>2023</year>;<volume>39</volume>:<fpage>btac774</fpage>.<pub-id pub-id-type="pmid">36453849</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Clausen</surname><given-names>PT</given-names></string-name>, <string-name><surname>Aarestrup</surname><given-names>FM</given-names></string-name>, <string-name><surname>Lund</surname><given-names>O.</given-names></string-name></person-group><article-title>Rapid and precise alignment of raw reads against redundant databases with KMA</article-title>. <source>BMC Bioinformatics</source><year>2018</year>;<volume>19</volume>:<fpage>307</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">30157759</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B14">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Daruka</surname><given-names>L</given-names></string-name>, <string-name><surname>Czikkely</surname><given-names>MS</given-names></string-name>, <string-name><surname>Szili</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal> Antibiotics of the future are prone to resistance in gram-negative pathogens. <italic toggle="yes">bioRxiv 2023-07</italic>. 2023.</mixed-citation>
    </ref>
    <ref id="btae086-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Edgar</surname><given-names>RC.</given-names></string-name></person-group><article-title>Search and clustering orders of magnitude faster than blast</article-title>. <source>Bioinformatics</source><year>2010</year>;<volume>26</volume>:<fpage>2460</fpage>–<lpage>1</lpage>.<pub-id pub-id-type="pmid">20709691</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Feldgarden</surname><given-names>M</given-names></string-name>, <string-name><surname>Brover</surname><given-names>V</given-names></string-name>, <string-name><surname>Gonzalez-Escalona</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>Amrfinderplus and the reference gene catalog facilitate examination of the genomic links among antimicrobial resistance, stress response, and virulence</article-title>. <source>Sci Rep</source><year>2021</year>;<volume>11</volume>:<fpage>12728</fpage>.<pub-id pub-id-type="pmid">34135355</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gschwind</surname><given-names>R</given-names></string-name>, <string-name><surname>Ugarcina Perovic</surname><given-names>S</given-names></string-name>, <string-name><surname>Weiss</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>Resfinderfg v2. 0: a database of antibiotic resistance genes obtained by functional metagenomics</article-title>. <source>Nucleic Acids Res</source><year>2023</year>;<volume>51</volume>:<fpage>W493</fpage>–<lpage>500</lpage>.<pub-id pub-id-type="pmid">37207327</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gupta</surname><given-names>SK</given-names></string-name>, <string-name><surname>Padmanabhan</surname><given-names>BR</given-names></string-name>, <string-name><surname>Diene</surname><given-names>SM</given-names></string-name></person-group><etal>et al</etal><article-title>Arg-annot, a new bioinformatic tool to discover antibiotic resistance genes in bacterial genomes</article-title>. <source>Antimicrob Agents Chemother</source><year>2014</year>;<volume>58</volume>:<fpage>212</fpage>–<lpage>20</lpage>.<pub-id pub-id-type="pmid">24145532</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hendriksen</surname><given-names>RS</given-names></string-name>, <string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Njage</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal>; <collab>Global Sewage Surveillance Project Consortium</collab>. <article-title>Global monitoring of antimicrobial resistance based on metagenomics analyses of urban sewage</article-title>. <source>Nature Commun</source><year>2019</year>;<volume>10</volume>:<fpage>1124</fpage>.<pub-id pub-id-type="pmid">30850636</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Holmes</surname><given-names>AH</given-names></string-name>, <string-name><surname>Moore</surname><given-names>LS</given-names></string-name>, <string-name><surname>Sundsfjord</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>Understanding the mechanisms and drivers of antimicrobial resistance</article-title>. <source>Lancet</source><year>2016</year>;<volume>387</volume>:<fpage>176</fpage>–<lpage>87</lpage>.<pub-id pub-id-type="pmid">26603922</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Johansson</surname><given-names>MH</given-names></string-name>, <string-name><surname>Aarestrup</surname><given-names>FM</given-names></string-name>, <string-name><surname>Petersen</surname><given-names>TN.</given-names></string-name></person-group><article-title>Importance of mobile genetic elements for dissemination of antimicrobial resistance in metagenomic sewage samples across the world</article-title>. <source>PLoS One</source><year>2023</year>;<volume>18</volume>:<fpage>e0293169</fpage>.<pub-id pub-id-type="pmid">37856515</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kieser</surname><given-names>S</given-names></string-name>, <string-name><surname>Brown</surname><given-names>J</given-names></string-name>, <string-name><surname>Zdobnov</surname><given-names>EM</given-names></string-name></person-group><etal>et al</etal><article-title>Atlas: a snakemake workflow for assembly, annotation, and genomic binning of metagenome sequence data</article-title>. <source>BMC Bioinformatics</source><year>2020</year>;<volume>21</volume>:<fpage>257</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">32571209</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Köster</surname><given-names>J</given-names></string-name>, <string-name><surname>Rahmann</surname><given-names>S.</given-names></string-name></person-group><article-title>Snakemake—a scalable bioinformatics workflow engine</article-title>. <source>Bioinformatics</source><year>2012</year>;<volume>28</volume>:<fpage>2520</fpage>–<lpage>2</lpage>.<pub-id pub-id-type="pmid">22908215</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lu</surname><given-names>J</given-names></string-name>, <string-name><surname>Breitwieser</surname><given-names>FP</given-names></string-name>, <string-name><surname>Thielen</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Bracken: estimating species abundance in metagenomics data</article-title>. <source>PeerJ Computer Science</source><year>2017</year>;<volume>3</volume>:<fpage>e104</fpage>.</mixed-citation>
    </ref>
    <ref id="btae086-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Martiny</surname><given-names>H-M</given-names></string-name>, <string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Brinch</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>A curated data resource of 214k metagenomes for characterization of the global antimicrobial resistome</article-title>. <source>PLoS Biol</source><year>2022a</year>;<volume>20</volume>:<fpage>e3001792</fpage>.<pub-id pub-id-type="pmid">36067158</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Martiny</surname><given-names>H-M</given-names></string-name>, <string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Brinch</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>Global distribution of mcr gene variants in 214k metagenomic samples</article-title>. <source>Msystems</source><year>2022b</year>;<volume>7</volume>:<fpage>e00105</fpage>.<pub-id pub-id-type="pmid">35343801</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Meyer</surname><given-names>F</given-names></string-name>, <string-name><surname>Bremges</surname><given-names>A</given-names></string-name>, <string-name><surname>Belmann</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Assessing taxonomic metagenome profilers with opal</article-title>. <source>Genome Biol</source><year>2019</year>;<volume>20</volume>:<fpage>1</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">30606230</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Meyer</surname><given-names>F</given-names></string-name>, <string-name><surname>Fritz</surname><given-names>A</given-names></string-name>, <string-name><surname>Deng</surname><given-names>Z-L</given-names></string-name></person-group><etal>et al</etal><article-title>Critical assessment of metagenome interpretation: the second round of challenges</article-title>. <source>Nat Methods</source><year>2022</year>;<volume>19</volume>:<fpage>429</fpage>–<lpage>40</lpage>.<pub-id pub-id-type="pmid">35396482</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mölder</surname><given-names>F</given-names></string-name>, <string-name><surname>Jablonski</surname><given-names>KP</given-names></string-name>, <string-name><surname>Letcher</surname><given-names>B</given-names></string-name></person-group><etal>et al</etal><article-title>Sustainable data analysis with snakemake</article-title>. <source>F1000Res</source><year>2021</year>;<volume>10</volume>:<fpage>33</fpage>.<pub-id pub-id-type="pmid">34035898</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Brinch</surname><given-names>C</given-names></string-name>, <string-name><surname>Møller</surname><given-names>FD</given-names></string-name></person-group><etal>et al</etal>; <collab>Global Sewage Surveillance Consortium</collab>. <article-title>Genomic analysis of sewage from 101 countries reveals global landscape of antimicrobial resistance</article-title>. <source>Nat Commun</source><year>2022</year>;<volume>13</volume>:<fpage>7251</fpage>.<pub-id pub-id-type="pmid">36456547</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B31">
      <mixed-citation publication-type="journal"><collab>NCBI Resource Coordinators</collab>. <article-title>Database resources of the national center for biotechnology information</article-title>. <source>Nucleic Acid Res</source><year>2018</year>;<volume>46</volume>:D1,D8–D13.</mixed-citation>
    </ref>
    <ref id="btae086-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nurk</surname><given-names>S</given-names></string-name>, <string-name><surname>Meleshko</surname><given-names>D</given-names></string-name>, <string-name><surname>Korobeynikov</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>Metaspades: a new versatile metagenomic assembler</article-title>. <source>Genome Res</source><year>2017</year>;<volume>27</volume>:<fpage>824</fpage>–<lpage>34</lpage>.<pub-id pub-id-type="pmid">28298430</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ondov</surname><given-names>BD</given-names></string-name>, <string-name><surname>Treangen</surname><given-names>TJ</given-names></string-name>, <string-name><surname>Melsted</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Mash: fast genome and metagenome distance estimation using minhash</article-title>. <source>Genome Biol</source><year>2016</year>;<volume>17</volume>:<fpage>132</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">27323842</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Osakunor</surname><given-names>DN</given-names></string-name>, <string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Mduluza</surname><given-names>T</given-names></string-name></person-group><etal>et al</etal><article-title>The gut microbiome but not the resistome is associated with urogenital schistosomiasis in preschool-aged children</article-title>. <source>Commun Biol</source><year>2020</year>;<volume>3</volume>:<fpage>155</fpage>.<pub-id pub-id-type="pmid">32242065</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>O’Toole</surname><given-names>Á</given-names></string-name>, <string-name><surname>Scher</surname><given-names>E</given-names></string-name>, <string-name><surname>Underwood</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>Assignment of epidemiological lineages in an emerging pandemic using the pangolin tool</article-title>. <source>Virus Evol</source><year>2021</year>;<volume>7</volume>:<fpage>veab064</fpage>.<pub-id pub-id-type="pmid">34527285</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pal</surname><given-names>C</given-names></string-name>, <string-name><surname>Bengtsson-Palme</surname><given-names>J</given-names></string-name>, <string-name><surname>Rensing</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>Bacmet: antibacterial biocide and metal resistance genes database</article-title>. <source>Nucleic Acids Res</source><year>2014</year>;<volume>42</volume>:<fpage>D737</fpage>–<lpage>43</lpage>.<pub-id pub-id-type="pmid">24304895</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Prjibelski</surname><given-names>A</given-names></string-name>, <string-name><surname>Antipov</surname><given-names>D</given-names></string-name>, <string-name><surname>Meleshko</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>Using spades de novo assembler</article-title>. <source>Curr Protoc Bioinformatics</source><year>2020</year>;<volume>70</volume>:<fpage>e102</fpage>.<pub-id pub-id-type="pmid">32559359</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B38">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Quast</surname><given-names>C</given-names></string-name>, <string-name><surname>Pruesse</surname><given-names>E</given-names></string-name>, <string-name><surname>Yilmaz</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>The silva ribosomal rna gene database project: improved data processing and web-based tools</article-title>. <source>Nucleic Acids Res</source><year>2012</year>;<volume>41</volume>:<fpage>D590</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">23193283</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ruscheweyh</surname><given-names>H-J</given-names></string-name>, <string-name><surname>Milanese</surname><given-names>A</given-names></string-name>, <string-name><surname>Paoli</surname><given-names>L</given-names></string-name></person-group><etal>et al</etal><article-title>Cultivation-independent genomes greatly expand taxonomic-profiling capabilities of mOTUs across various environments</article-title>. <source>Microbiome</source><year>2022</year>;<volume>10</volume>:<fpage>212</fpage>.<pub-id pub-id-type="pmid">36464731</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B40">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wood</surname><given-names>DE</given-names></string-name>, <string-name><surname>Lu</surname><given-names>J</given-names></string-name>, <string-name><surname>Langmead</surname><given-names>B.</given-names></string-name></person-group><article-title>Improved metagenomic analysis with kraken 2</article-title>. <source>Genome Biol</source><year>2019</year>;<volume>20</volume>:<fpage>257</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">31779668</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B41">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname><given-names>A-N</given-names></string-name>, <string-name><surname>Gaston</surname><given-names>JM</given-names></string-name>, <string-name><surname>Dai</surname><given-names>CL</given-names></string-name></person-group><etal>et al</etal><article-title>An omics-based framework for assessing the health risk of antimicrobial resistance genes</article-title>. <source>Nat Commun</source><year>2021</year>;<volume>12</volume>:<fpage>4765</fpage>.<pub-id pub-id-type="pmid">34362925</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B42">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname><given-names>X</given-names></string-name>, <string-name><surname>Jonassen</surname><given-names>I.</given-names></string-name></person-group><article-title>RASflow: an RNA-Seq analysis workflow with Snakemake</article-title>. <source>BMC Bioinformatics</source><year>2020</year>;<volume>21</volume>:<fpage>1</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">31898485</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10918635</article-id>
    <article-id pub-id-type="pmid">38377397</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btae086</article-id>
    <article-id pub-id-type="publisher-id">btae086</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ARGprofiler—a pipeline for large-scale analysis of antimicrobial resistance genes and their flanking regions in metagenomic datasets</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-6733-7888</contrib-id>
        <name>
          <surname>Martiny</surname>
          <given-names>Hannah-Marie</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
        <xref rid="btae086-cor1" ref-type="corresp"/>
        <!--hanmar@food.dtu.dk-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pyrounakis</surname>
          <given-names>Nikiforos</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Petersen</surname>
          <given-names>Thomas N</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lukjančenko</surname>
          <given-names>Oksana</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Aarestrup</surname>
          <given-names>Frank M</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Clausen</surname>
          <given-names>Philip T L C</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Munk</surname>
          <given-names>Patrick</given-names>
        </name>
        <aff><institution>Research Group for Genomic Epidemiology, Technical University of Denmark</institution>, <addr-line>Henrik Danms Allé, Bygning 204</addr-line>, Kongens Lyngby 2800, <country country="DK">Denmark</country></aff>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Alkan</surname>
          <given-names>Can</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btae086-cor1">Corresponding author. Research Group for Genomic Epidemiology, Technical University of Denmark, Henrik Danms Alle, Bygning 204, Kongens Lyngby 2800, Denmark. E-mail: <email>hanmar@food.dtu.dk</email> (H.-M.M.)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>3</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-02-20">
      <day>20</day>
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>20</day>
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <volume>40</volume>
    <issue>3</issue>
    <elocation-id>btae086</elocation-id>
    <history>
      <date date-type="received">
        <day>10</day>
        <month>7</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>11</day>
        <month>12</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>01</day>
        <month>2</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>06</day>
        <month>3</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btae086.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Analyzing metagenomic data can be highly valuable for understanding the function and distribution of antimicrobial resistance genes (ARGs). However, there is a need for standardized and reproducible workflows to ensure the comparability of studies, as the current options involve various tools and reference databases, each designed with a specific purpose in mind.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>In this work, we have created the workflow ARGprofiler to process large amounts of raw sequencing reads for studying the composition, distribution, and function of ARGs. ARGprofiler tackles the challenge of deciding which reference database to use by providing the PanRes database of 14 078 unique ARGs that combines several existing collections into one. Our pipeline is designed to not only produce abundance tables of genes and microbes but also to reconstruct the flanking regions of ARGs with ARGextender. ARGextender is a bioinformatic approach combining KMA and SPAdes to recruit reads for a targeted <italic toggle="yes">de novo</italic> assembly. While our aim is on ARGs, the pipeline also creates Mash sketches for fast searching and comparisons of sequencing runs.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>The ARGprofiler pipeline is a Snakemake workflow that supports the reuse of metagenomic sequencing data and is easily installable and maintained at <ext-link xlink:href="https://github.com/genomicepidemiology/ARGprofiler" ext-link-type="uri">https://github.com/genomicepidemiology/ARGprofiler</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Novo Nordisk Foundation</institution>
            <institution-id institution-id-type="DOI">10.13039/501100009708</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>NNF16OC0021856</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Global Surveillance of Antimicrobial Resistance</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Union’s Horizon 2020</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="8"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>Investigating the resistome of metagenomic datasets, including the abundances of the different antimicrobial resistance genes (ARGs) and the gene synteny (gene flanking regions), has become a major research area in recent years (<xref rid="btae086-B20" ref-type="bibr">Holmes <italic toggle="yes">et al.</italic> 2016</xref>, <xref rid="btae086-B5" ref-type="bibr">Bengtsson-Palme <italic toggle="yes">et al.</italic> 2018</xref>, <xref rid="btae086-B19" ref-type="bibr">Hendriksen <italic toggle="yes">et al.</italic> 2019</xref>, <xref rid="btae086-B3" ref-type="bibr">Anthony <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btae086-B41" ref-type="bibr">Zhang <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btae086-B26" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022b</xref>, <xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>). In many cases, research investigation, especially on a large scale, has been limited to research groups that are technologically and financially able to combine large-scale data generation with advanced bioinformatic and modeling expertise. However, because of the good data-sharing practices of next-generation sequencing efforts, there are today a large number of sequencing datasets available in public repositories. We have recently provided a curated dataset of acquired ARG abundance estimates in more than 214 000 publicly available metagenomic datasets (<xref rid="btae086-B25" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022a</xref>).</p>
    <p>Processing these datasets in a uniform approach calls for optimized, standardized methods to support the broader scientific community in utilizing these datasets. The practice of sharing bioinformatic workflows, or pipelines, has not historically been part of the academic publishing process. However, with the growing volumes of biological sequencing data available, researchers have begun to publish their workflows. Recent examples include pangolin for tracing SARS-CoV2 lineages (<xref rid="btae086-B35" ref-type="bibr">O’Toole <italic toggle="yes">et al.</italic> 2021</xref>), RASflow for RNA sequencing data (<xref rid="btae086-B42" ref-type="bibr">Zhang and Jonassen 2020</xref>), and ATLAS for metagenomic sequencing data (<xref rid="btae086-B22" ref-type="bibr">Kieser <italic toggle="yes">et al.</italic> 2020</xref>).</p>
    <p>Here, we present ARGprofiler, a newly developed pipeline designed to analyze read dissimilarities, abundances, and genomic flanking regions of ARGs in metagenomic sequencing data (<xref rid="btae086-F1" ref-type="fig">Fig. 1</xref>). ARGprofiler has been adapted to work for short-read sequencing reads, where we have carefully evaluated each step in our metagenomic workflow. ARGprofiler includes the PanRes database, a combined collection of current ARG databases, and ARGextender, an assembly tool for producing targeted <italic toggle="yes">de novo</italic> assemblies. The pipeline is an easily usable and scalable workflow implemented in Snakemake (<xref rid="btae086-B23" ref-type="bibr">Köster and Rahmann 2012</xref>, <xref rid="btae086-B29" ref-type="bibr">Mölder <italic toggle="yes">et al.</italic> 2021</xref>), which allows any user to process sequencing data to perform epidemiological analyses of ARGs globally. ARGprofiler is another step toward enabling the reuse of metagenomic sequences, and while we have targeted antimicrobial resistance (AMR), the pipeline can be repurposed for other tasks.</p>
    <fig position="float" id="btae086-F1">
      <label>Figure 1.</label>
      <caption>
        <p>The ARGprofiler pipeline. This schematic illustrates the components of the pipeline: (a) Download of sequencing reads from ENA, (b) preprocessing of retrieved reads with fastp, (c) procedure of aligning reads against chosen reference sequence database(s) with KMA, (d) assembly of targeted flanking regions of antimicrobial resistance genes with ARGextender that passes requirements in a filtering step, and (e) sketching sequencing reads with Mash.</p>
      </caption>
      <graphic xlink:href="btae086f1" position="float"/>
    </fig>
  </sec>
  <sec sec-type="methods">
    <title>Methods</title>
    <sec>
      <title>Implementation of ARGprofiler</title>
      <p>ARGprofiler is a Snakemake workflow (<xref rid="btae086-B23" ref-type="bibr">Köster and Rahmann 2012</xref>) that is organized into five different parts: (i) download of metagenomic datasets, (b) trimming and quality check of sequencing reads, (iii) mapping and alignment of reads against reference sequences, including ARGs and bacteria, (iv) building of flanking regions around genes of interest, and (v) creation of Mash sketches (<xref rid="btae086-F1" ref-type="fig">Fig. 1</xref>). Mapping to bacteria is done to compare the ARG content to the bacterial composition, and Mash sketches to allow for searching for samples with similar or different compositions.</p>
      <p>ARGprofiler can handle both short single- and paired-end reads and combines existing and newly established tools and reference databases to produce a single comprehensive analysis pipeline.</p>
    </sec>
    <sec>
      <title>Retrieval of metagenomic datasets</title>
      <p>To manage the download of sequencing read data from ENA, ARGprofiler utilizes fastq-dl 2.0.4 (<ext-link xlink:href="https://github.com/rpetit3/fastq-dl" ext-link-type="uri">https://github.com/rpetit3/fastq-dl</ext-link>) to retrieve and download the reads by matching the given run_accessions in a JSON input file provided by the user. ARGprofiler is also capable of handling reads stored in a local folder as an alternative to downloading ENA read sets.</p>
    </sec>
    <sec>
      <title>Preprocessing of sequencing reads</title>
      <p>The first step in a sequencing workflow is the quality checking and trimming of the raw sequencing reads. Historically, FASTQC (<xref rid="btae086-B2" ref-type="bibr">Andrews 2010</xref>) has been used for quality checking and BBduk (<xref rid="btae086-B10" ref-type="bibr">Bushnell 2014</xref>) to remove adaptors and low-quality sequences (<xref rid="btae086-B25" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022a</xref>, <xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>). However, new and faster tools have appeared, such as the widely adopted tool fastp (<xref rid="btae086-B11" ref-type="bibr">Chen 2023</xref>). Therefore, we decided to compare the performance of fastp 0.23.2 with the combination of FASTQC and BBduk to ensure an efficient preprocessing of the raw reads.</p>
    </sec>
    <sec>
      <title>Mapping and alignment of reads against reference databases</title>
      <p>To quantify ARGs and microorganisms, KMA 1.4.12a (<xref rid="btae086-B13" ref-type="bibr">Clausen <italic toggle="yes">et al.</italic> 2018</xref>) was used to map and align the trimmed reads to different databases. KMA uses <italic toggle="yes">k</italic>-mer seeding to increase mapping speed and is specifically made for mapping reads against redundant databases. We designed the alignment procedure to use two reference sequence databases: the PanRes collection of ARGs and the mOTUs3 database (<xref rid="btae086-B39" ref-type="bibr">Ruscheweyh <italic toggle="yes">et al.</italic> 2022</xref>) for microbiome profiling. Details on the choice and design of reference databases are described in later sections.</p>
    </sec>
    <sec>
      <title>Metagenome representation using Mash sketches</title>
      <p>We used Mash 2.3 (<xref rid="btae086-B33" ref-type="bibr">Ondov <italic toggle="yes">et al.</italic> 2016</xref>) to enable comparison between large sets of metagenomes for subsequent selection and analysis by creating MinHash sketches as representatives for individual metagenomes. This allows an unbiased comparison of samples with a low constant memory footprint and a short turnaround time, which can be used for subsequent clustering and identification of closely related metagenomes (<xref rid="btae086-B33" ref-type="bibr">Ondov <italic toggle="yes">et al.</italic> 2016</xref>). We identified appropriate sketch and <italic toggle="yes">k</italic>-mer sizes using a selection of 72 sewage metagenomes: 36 from Copenhagen sewage (<xref rid="btae086-B9" ref-type="bibr">Brinch <italic toggle="yes">et al.</italic> 2020</xref>), 18 from various sites in the world (<xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>), and the remaining 18 were technical replicates of a single sewage sample taken in Copenhagen, Denmark (PRJEB63576). Sketches were created for all samples using sketch sizes of <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>5</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>, and <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>6</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>, with <italic toggle="yes">k</italic>-mer sizes of 16, 21, 27, and 31. Mash distances were calculated to find the parameters resulting in lower within-sample distances than between-sample distances. Distances were also clustered using Dynamic Neighbor-Joining with CCPhylo 0.8.3 (<xref rid="btae086-B12" ref-type="bibr">Clausen 2023</xref>) to verify the appropriate sub-clustering of samples.</p>
    </sec>
    <sec>
      <title>Building flanking regions around genes of interest with ARGextender</title>
      <p>To examine the genomic content surrounding ARGs, we created ARGextender to build genomic flanking regions around identified ARGs. ARGextender recruits reads using a recursive approach with KMA and SPAdes (<xref rid="btae086-B37" ref-type="bibr">Prjibelski <italic toggle="yes">et al.</italic> 2020</xref>), which produce comparable results and are faster than full metagenome <italic toggle="yes">de novo</italic> assembly with SPAdes. A more detailed description of ARGextender can be found in a later section. Because KMA will also assign reads to low abundant sequences that are unlikely to form contigs, we created a filtering step using the KMA mapstat files so that only samples fulfilling the following criteria would be assembled: <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>90</mml:mn></mml:mrow></mml:math></inline-formula>% query identity, <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>90</mml:mn></mml:mrow></mml:math></inline-formula>% global consensus identity, and a mean read depth <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec>
      <title>The PanRes database</title>
      <p>Bacterial genes that encode resistance to antibiotic drugs, heavy metals, and biocides have been previously identified and compiled into several databases (<xref rid="btae086-B1" ref-type="bibr">Alcock <italic toggle="yes">et al.</italic> 2023</xref>, <xref rid="btae086-B7" ref-type="bibr">Bonin <italic toggle="yes">et al.</italic> 2023</xref>, <xref rid="btae086-B8" ref-type="bibr">Bortolaia <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btae086-B16" ref-type="bibr">Feldgarden <italic toggle="yes">et al.</italic> 2021</xref>, <xref rid="btae086-B18" ref-type="bibr">Gupta <italic toggle="yes">et al.</italic> 2014</xref>, <xref rid="btae086-B17" ref-type="bibr">Gschwind <italic toggle="yes">et al.</italic> 2023</xref>) . We sought to collect these genes of interest into a single unique collection that we named PanRes; short for the pan resistance, as having a single, although highly redundant collection is computationally more efficient to search through.</p>
      <p>The following gene databases were identified and used as seeds for the selection of genes for the PanRes collection: ResFinder (downloaded 20 January 2023, <xref rid="btae086-B8" ref-type="bibr">Bortolaia <italic toggle="yes">et al.</italic> 2020</xref>), ResFinderFG (version 2.0, <xref rid="btae086-B17" ref-type="bibr">Gschwind <italic toggle="yes">et al.</italic> 2023</xref>), CARD (version 3.2.5, <xref rid="btae086-B1" ref-type="bibr">Alcock <italic toggle="yes">et al.</italic> 2023</xref>), MegaRes (version 3.0.0, <xref rid="btae086-B7" ref-type="bibr">Bonin <italic toggle="yes">et al.</italic> 2023</xref>), AMRFinderPlus (version 3.11/2022-12-19.1, <xref rid="btae086-B16" ref-type="bibr">Feldgarden <italic toggle="yes">et al.</italic> 2021</xref>), and ARGANNOT (V6_July2019, <xref rid="btae086-B18" ref-type="bibr">Gupta <italic toggle="yes">et al.</italic> 2014</xref>). In addition to these collections, we used a set of cloned, functionally determined ARGs from environmental and clinical samples tested for resistance to antibiotics not yet on the market (<xref rid="btae086-B14" ref-type="bibr">Daruka <italic toggle="yes">et al.</italic> 2023</xref>). We received these sequences in November 2022 [Csaba Pál and Zoltán Farkas (Personal communication, July 2022)], and tagged them with “CsabaPal” in the collection.</p>
      <p>From the CARD database, the genes based on the protein homolog model were included as they are acquired and do not rely on mutations for resistance. In the MegaRes gene collection, sequences with the “RequiresSNPConfirmation” tag were excluded from consideration, as these represent mutated versions of housekeeping genes, regulators, repressors, and promoter sequences. From the AMRFinderPlus sequences of the “AMR” type, only those satisfying the “AMR” subtype were used. For the genes of the “STRESS” type, just the “BIOCIDE” and “METAL” subtypes were retained.</p>
      <p>As heavy metals often co-select for antibiotic resistance (<xref rid="btae086-B4" ref-type="bibr">Baker-Austin <italic toggle="yes">et al.</italic> 2006</xref>), we did a screening for metal resistance genes. The BacMet v1.1 collection of experimentally verified resistance proteins was used as a starting point (<xref rid="btae086-B36" ref-type="bibr">Pal <italic toggle="yes">et al.</italic> 2014</xref>), where the BacMet GenBank accessions were used to extract the coding sequences (<xref rid="btae086-B31" ref-type="bibr">NCBI Resource Coordinators 2018</xref>). We then manually curated the collection of metal resistance genes with sequences identified in the published literature, with a special focus on acquired cobalt, zinc, cobalt, copper, arsenite, mercury, cadmium, lead, or silver-resistance genes retrieved using the NCBI nucleotide database (<xref rid="btae086-B31" ref-type="bibr">NCBI Resource Coordinators 2018</xref>). The final collection of metal resistance genes we refer to as the MetalResistance database is deposited at: <ext-link xlink:href="https://doi.org/10.5281/zenodo.8108201" ext-link-type="uri">https://doi.org/10.5281/zenodo.8108201</ext-link>.</p>
      <p>All retrieved sequences were clustered using Usearch 11.0.667 (<xref rid="btae086-B15" ref-type="bibr">Edgar 2010</xref>) with the fastx_uniques algorithm to identify unique sequences to include in PanRes. These unique ARGs were clustered based on 90% identity and 90% coverage with the cluster_fast algorithm. GeneAssimiliator (<ext-link xlink:href="https://github.com/genomicepidemiology/gene\_assimilator" ext-link-type="uri">https://github.com/genomicepidemiology/gene\_assimilator</ext-link>) was used to perform this iterative approach of recruiting, clustering, and refining gene collections of various sources into one.</p>
    </sec>
    <sec>
      <title>ARGextender</title>
      <p>Despite the value provided through metagenomic <italic toggle="yes">de novo</italic> assemblies, the computational demands are often too high to be considered for routine use (<xref rid="btae086-B26" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022b</xref>). To enable a shorter turnaround time of metagenomic assemblies with lower computational demands, we developed ARGextender to perform <italic toggle="yes">de novo</italic> assemblies around target sequences of interest.</p>
      <p>ARGextender recursively applies KMA 1.4.12a (<xref rid="btae086-B13" ref-type="bibr">Clausen <italic toggle="yes">et al.</italic> 2018</xref>) and SPAdes 3.15.5 (<xref rid="btae086-B32" ref-type="bibr">Nurk <italic toggle="yes">et al.</italic> 2017</xref>, <xref rid="btae086-B37" ref-type="bibr">Prjibelski <italic toggle="yes">et al.</italic> 2020</xref>), where KMA is used to identify the target sequences in the sample, followed by a <italic toggle="yes">de novo</italic> assembly of the reads matching the target(s) using SPAdes. After each <italic toggle="yes">de novo</italic> assembly, scaffolds containing target sequences are extracted using KMA and set as the new target. This recursion is repeated until no more reads are included in the <italic toggle="yes">de novo</italic> assembly or the user-defined maximum number of recursions has been met (unlimited by default). When the targeted <italic toggle="yes">de novo</italic> assembly has saturated, the scaffolds and assembly graph are saved, along with a table containing the information about which target sequences are found within each scaffold. These include target sequences with an alignment score within 70% of the best-scoring target sequences.</p>
      <p>We evaluated the ARGextender tool by comparing the output of ARGextender to full <italic toggle="yes">de novo</italic> metagenomic assemblies of 951 urban sewage samples published by (<xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>). We compared the resulting scaffolds by matching the sequences of the ResFinder database to the scaffolds using KMA 1.4.12a with the “-ont” parameter. The surrounding flanks were then extracted and compared.</p>
    </sec>
    <sec>
      <title>Evaluating tools for profiling microbiomes</title>
      <p>We compared the performance of KMA (<xref rid="btae086-B13" ref-type="bibr">Clausen <italic toggle="yes">et al.</italic> 2018</xref>) with several microbial reference databases and profiling tools. Using the <italic toggle="yes">in silico</italic> data generated for the profiling test in the Critical Assessment of Metagenome Interpretation (CAMI) challenge (<xref rid="btae086-B28" ref-type="bibr">Meyer <italic toggle="yes">et al.</italic> 2022</xref>), we tested mOTUs 3.0.3 (<xref rid="btae086-B39" ref-type="bibr">Ruscheweyh <italic toggle="yes">et al.</italic> 2022</xref>), MetaPhlAn 4.0.3 (<xref rid="btae086-B6" ref-type="bibr">Blanco-Míguez <italic toggle="yes">et al.</italic> 2023</xref>), Bracken 2.8 (<xref rid="btae086-B24" ref-type="bibr">Lu <italic toggle="yes">et al.</italic> 2017</xref>) on Kraken2 (<xref rid="btae086-B40" ref-type="bibr">Wood <italic toggle="yes">et al.</italic> 2019</xref>) output, and KMA 1.4.7 with the following reference databases: the mOTUs database (<xref rid="btae086-B39" ref-type="bibr">Ruscheweyh <italic toggle="yes">et al.</italic> 2022</xref>) of 521 780 sequences (version 3.0.1, downloaded 5 December 2022), the Silva database (<xref rid="btae086-B38" ref-type="bibr">Quast <italic toggle="yes">et al.</italic> 2012</xref>) of 2 225 272 sequences (version 138, downloaded 16 January 2020), and a custom database of the genomic database of 16 732 113 genomic sequences (downloaded 24 May 2022, compiled using a previously described procedure (<xref rid="btae086-B34" ref-type="bibr">Osakunor <italic toggle="yes">et al.</italic> 2020</xref>).</p>
      <p>The performance of each tool and reference database was evaluated similarly to the CAMI challenge using the OPAL tool (<xref rid="btae086-B27" ref-type="bibr">Meyer <italic toggle="yes">et al.</italic> 2019</xref>). Results with low abundances were filtered away (“-f 1”). We used three binary classification metrics on each taxonomic level, from superkingdom to species, to determine performance and the sum of abundances, specifically purity, completeness, and F1 scores. Purity and completeness consider the performance of correctly identifying taxons without considering relative abundances, where TP is the number of true positives, FP is the number of false positives, and FN is the false negatives: <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mtext>Purity</mml:mtext><mml:mo>=</mml:mo><mml:mtext>TP</mml:mtext><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mtext>TP</mml:mtext><mml:mo>+</mml:mo><mml:mtext>FP</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:mtext>Completeness</mml:mtext><mml:mo>=</mml:mo><mml:mtext>TP</mml:mtext><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mtext>TP</mml:mtext><mml:mo>+</mml:mo><mml:mtext>FN</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. The F1 score measures the overall performance of taxon identification and is defined as:
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mi mathvariant="normal">F</mml:mi><mml:mn>1</mml:mn><mml:mo> </mml:mo><mml:mtext>score</mml:mtext><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>purity</mml:mtext><mml:mo>⋅</mml:mo><mml:mtext>completeness</mml:mtext></mml:mrow><mml:mrow><mml:mtext>purity</mml:mtext><mml:mo>+</mml:mo><mml:mtext>completeness</mml:mtext></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
    </sec>
  </sec>
  <sec sec-type="data-availability">
    <title>Code and data availability</title>
    <p>The ARGprofiler pipeline is available on GitHub, at <ext-link xlink:href="https://github.com/genomicepidemiology/ARGprofiler" ext-link-type="uri">https://github.com/genomicepidemiology/ARGprofiler</ext-link> under the APACHE-2.0 license. ARGextender is included as part of the ARGprofiler repository. GeneAssimilator is available at <ext-link xlink:href="https://github.com/genomicepidemiology/gene_assimilator" ext-link-type="uri">https://github.com/genomicepidemiology/gene_assimilator</ext-link>. The code for the comparison of microbial profilers is available at <ext-link xlink:href="https://github.com/genomicepidemiology/argprofiler-tax-benchmark" ext-link-type="uri">https://github.com/genomicepidemiology/argprofiler-tax-benchmark</ext-link>. Jupyter Notebooks supporting the various figures and tables have been shared at <ext-link xlink:href="https://github.com/genomicepidemiology/argprofiler-paper-notebooks" ext-link-type="uri">https://github.com/genomicepidemiology/argprofiler-paper-notebooks</ext-link>.</p>
    <p>The MetalResistance gene database is available on Zenodo, at <ext-link xlink:href="https://doi.org/10.5281/zenodo.8108201" ext-link-type="uri">https://doi.org/10.5281/zenodo.8108201</ext-link>, and the first version of the PanRes collection is available at <ext-link xlink:href="https://doi.org/10.5281/zenodo.8055115" ext-link-type="uri">https://doi.org/10.5281/zenodo.8055115</ext-link>. Output files of benchmarking microbial profilers are available at <ext-link xlink:href="https://doi.org/10.5281/zenodo.7923774" ext-link-type="uri">https://doi.org/10.5281/zenodo.7923774</ext-link>. The full de novo assemblies of urban sewage samples are available on ENA under project accessions PRJEB40798, PRJEB40816, PRJEB40815, PRJEB27621, and ERP015409. The Copenhagen sewage collection is under PRJEB34633, and the repeated resequencing of a single Copenhagen sewage sample is under PRJEB63576.</p>
    <sec>
      <title>Results</title>
      <p>With ARGprofiler, we wanted to focus on creating a pipeline that produces three main outputs suitable for analyzing metagenomic datasets: the abundance of reads aligned to different genes of two suitable reference databases (mOTUs and PanRes), targeted <italic toggle="yes">de novo</italic> assemblies with ARGextender, and MinHash sketches with Mash (<xref rid="btae086-F1" ref-type="fig">Fig. 1</xref>). Our pipeline has been designed to be suitable for large volumes of sequencing reads by using the workflow manage Snakemake and by carefully selecting appropriate tools.</p>
    </sec>
    <sec>
      <title>The PanRes collection</title>
      <p>PanRes was created to compile several existing ARG reference databases into one, as there are both overlaps and discrepancies between the different ones (<xref rid="btae086-F2" ref-type="fig">Fig. 2a</xref>). Out of 30 400 genes, we identified a set of 14 078 unique sequences that were included in PanRes. Grouping these genes based on 90% identity and 90% coverage produced 5280 centroids, which ranged in lengths between 93 and 5972 bp, with a median of 762 bp (<xref rid="btae086-F2" ref-type="fig">Fig. 2b</xref>).</p>
      <fig position="float" id="btae086-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Overview of the sequences included in PanRes. (a) A comparison of overlaps between the different databases in the PanRes collection. (b) Distribution of antimicrobial resistance gene lengths.</p>
        </caption>
        <graphic xlink:href="btae086f2" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>Assembling flanks around genes with ARGextender</title>
      <p>To validate the output of ARGextender, we compared the scaffolds with those produced by SPAdes on a set of 951 urban sewage samples (<xref rid="btae086-F3" ref-type="fig">Fig. 3</xref>). On average, ARGextender built 101 scaffolds (range: 1–350), whereas SPAdes reported 95 ARG-scaffolds on average (range: 1–348). The number of distinct ARGs detected in the scaffolds was on average 57 for ARGextender (range 1–141) and 58 for SPAdes (range: 1–153) (<xref rid="btae086-F3" ref-type="fig">Fig. 3a</xref>). Most of the flanks extracted around ARGs were between 100 and 5000 bp, although many had no flanking regions (<xref rid="btae086-F3" ref-type="fig">Fig. 3b</xref>). Excluding scaffolds with zero flanks, we can see that ARGextender and SPAdes can assemble flanks around a similar number of ARGs (<xref rid="btae086-F3" ref-type="fig">Fig. 3c</xref>). Overall, ARGextender was capable of assembling the same amount of flanks as SPAdes with lower computational requirements (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Appendix B</xref>), although SPAdes produced longer flanks for some samples.</p>
      <fig position="float" id="btae086-F3">
        <label>Figure 3.</label>
        <caption>
          <p>A comparison between the flanks extracted around ARGs found in scaffolds produced with either SPAdes or ARGextender. (a) Number of scaffolds containing at least one ARG compared with the number of ARGs detected across all scaffolds in a sample. (b) Distribution of flanking content (bp: basepairs) in sewage samples, including the number of scaffolds without a flanking region in the top right corner. (c) Overlap between the tool regarding which ARGs had flanks, excluding the scaffolds with zero flank regions. Only ARGs with a minimum of 95% breadth of coverage were included in this figure. ARG: antimicrobial resistance genes.</p>
        </caption>
        <graphic xlink:href="btae086f3" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>Choosing a microbial profiler and reference database</title>
      <p>Since there are multiple different tools and reference databases available to profile the microbial content of a sample, we compared the performances of each method with various databases (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Appendix A</xref>, <xref rid="btae086-F4" ref-type="fig">Fig. 4</xref>). KMA reported more matched reference sequences, regardless of the database used, where most were false positives (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. A1</xref>). After removing hits with low abundances, KMA were comparable with MetaPhlAn and mOTUs, sometimes identifying more taxons than the other tools (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. A2</xref>). We observed a decrease in completeness and purity in taxon identification for the non-human environments for all tools and databases (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Figs A3 and A4</xref>). Despite this decrease, KMA had higher completeness than MetaPhlAn, mOTUs, and Bracken on the plant-associated samples (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. A4a</xref>). KMA with the mOTUs sequences (KMA-mOTUs) outperformed KMA with genomic and Silva databases across all six sampling groups regarding binary metrics (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Appendix A</xref>). While KMA-mOTUs abundance results were generally lower, the F1 scores were on par with the MetaPhlAn and mOTUs profilers (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Figs A5 and A6</xref>), which we believe is due to a difference in how abundance is calculated in the other tools.</p>
      <fig position="float" id="btae086-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Performance of microbial profilers on the <italic toggle="yes">in silico</italic> CAMI data as measured by the F1 score at genus rank. The harmonic mean is reported as the circle, and the error bars are the standard deviation. CAMI: critical assessment of metagenome interpretation.</p>
        </caption>
        <graphic xlink:href="btae086f4" position="float"/>
      </fig>
      <p>We decided on combining KMA with the mOTUs sequences for two reasons. First, we plan to apply our pipeline as an environment-agnostic passive surveillance tool encompassing many One Health settings important for ARG ecology. Therefore, we deemed performance outside just human microbiomes important, where KMA-mOTUs outperformed all other tools on the plant-associated samples and were on par with marine samples (<xref rid="btae086-F4" ref-type="fig">Fig. 4</xref>). Second, since we also use KMA for the ARG quantification, this choice limited the overall pipeline complexity.</p>
    </sec>
    <sec>
      <title>Clustering and representing metagenomes using Mash sketches</title>
      <p>Most of the output of ARGprofiler relies on known reference sequences. To enable unbiased metagenome-wise comparison and clustering of sequence runs, we include the creation of sketches using Mash. We tested the discriminatory power of different sketch and <italic toggle="yes">k</italic>-mer sizes on sewage samples, some of which were technical sequence replicates of the same sample. Both the very small sketch sizes and short <italic toggle="yes">k</italic>-mers failed to clearly distinguish between technical replicates of the same sample and sequence runs of other sewage samples (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. B5</xref> in appendix). Technical replicates were efficiently separated from the remaining samples with a <italic toggle="yes">k</italic>-mer size of 31 and sketch size of <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mo>≥</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material Fig. B6</xref> in appendix). As smaller sketch sizes require less computational resources, a sketch size of 104 was included as default in ARGprofiler.</p>
    </sec>
    <sec>
      <title>Reducing computational time and memory usage</title>
      <p>Analyzing the large quantities of metagenomic data currently available at ENA and future data is not computationally trivial, and choosing efficient workflows will seriously impact the associated time, costs, and energy expenditure. We did a benchmark of each rule using a set of metagenomic datasets from a variety of sampling origins (details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Material Appendix B</xref>), where we observed that with our final parameter settings, the ARGprofiler pipeline processed 1.21 gigabasepairs/h (Gbps/h) with a median processing performance of 0.36 Gbps/h. Most steps had a sample-average peak memory footprint below 1 GB and required less than a CPU hour, except for KMA-mOTUs and ARGextender (<xref rid="btae086-T1" ref-type="table">Table 1</xref>).</p>
      <table-wrap position="float" id="btae086-T1">
        <label>Table 1.</label>
        <caption>
          <p>Measured times and memory usage for each step of the ARGprofiler pipeline.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="center" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="2" colspan="1">Rule</th>
              <th rowspan="2" align="center" colspan="1">Tool</th>
              <th colspan="2" align="center" rowspan="1">CPU time (h)<hr/></th>
              <th colspan="2" align="center" rowspan="1">Memory (MB)<hr/></th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">
                <inline-formula id="IE11">
                  <mml:math id="IM11" display="inline" overflow="scroll">
                    <mml:mo>μ</mml:mo>
                  </mml:math>
                </inline-formula>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <inline-formula id="IE12">
                  <mml:math id="IM12" display="inline" overflow="scroll">
                    <mml:mo>σ</mml:mo>
                  </mml:math>
                </inline-formula>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <inline-formula id="IE13">
                  <mml:math id="IM13" display="inline" overflow="scroll">
                    <mml:mo>μ</mml:mo>
                  </mml:math>
                </inline-formula>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <inline-formula id="IE14">
                  <mml:math id="IM14" display="inline" overflow="scroll">
                    <mml:mo>σ</mml:mo>
                  </mml:math>
                </inline-formula>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">Read download</td>
              <td rowspan="1" colspan="1">fastq-dl</td>
              <td rowspan="1" colspan="1">0.58</td>
              <td rowspan="1" colspan="1">1.33</td>
              <td rowspan="1" colspan="1">1389.83</td>
              <td rowspan="1" colspan="1">1052</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Read preprocessing</td>
              <td rowspan="1" colspan="1">fastp</td>
              <td rowspan="1" colspan="1">0.51</td>
              <td rowspan="1" colspan="1">1.23</td>
              <td rowspan="1" colspan="1">2375.95</td>
              <td rowspan="1" colspan="1">1748.43</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Microbiome read alignment</td>
              <td rowspan="1" colspan="1">KMA-mOTUs</td>
              <td rowspan="1" colspan="1">2.66</td>
              <td rowspan="1" colspan="1">6.04</td>
              <td rowspan="1" colspan="1">6817.09</td>
              <td rowspan="1" colspan="1">3.44</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">ARG read alignment</td>
              <td rowspan="1" colspan="1">KMA-PanRes</td>
              <td rowspan="1" colspan="1">0.43</td>
              <td rowspan="1" colspan="1">0.99</td>
              <td rowspan="1" colspan="1">308.75</td>
              <td rowspan="1" colspan="1">137.05</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Building flanking regions</td>
              <td rowspan="1" colspan="1">ARGextender</td>
              <td rowspan="1" colspan="1">2.06</td>
              <td rowspan="1" colspan="1">5.20</td>
              <td rowspan="1" colspan="1">539.61</td>
              <td rowspan="1" colspan="1">804.92</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Creating MinHash sketches</td>
              <td rowspan="1" colspan="1">Mash sketch</td>
              <td rowspan="1" colspan="1">0.24</td>
              <td rowspan="1" colspan="1">0.59</td>
              <td rowspan="1" colspan="1">2.03</td>
              <td rowspan="1" colspan="1">0.10</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn1">
            <p>The average (<inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>) CPU time in hours (h) and the peak memory in megabytes (MB) are reported together with standard deviations (<inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mo>σ</mml:mo></mml:math></inline-formula>). Note that the CPU hours and peak memory for ARGextender did not include the two samples that were not completed within our limit of 48 h.</p>
          </fn>
          <fn id="tblfn2">
            <p>ARG: antimicrobial resistance genes.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
  </sec>
  <sec sec-type="discussion">
    <title>Discussion</title>
    <p>There are currently terabytes of metagenomic sequencing data available in public databases, and producing standardized and consistent results is necessary for downstream analyses. Therefore, we have designed ARGprofiler to allow efficient ARG-monitoring and quantification in vast amounts of sequencing data, determine flanking regions around ARGs for downstream epidemiological investigation, and <italic toggle="yes">k</italic>-mer-based comparison of sequence runs. Each output aligns with our overall goal of reanalyzing public sequencing datasets for the characteristics of ARGs in a global microbial and environmental context.</p>
    <p>One of the unique features of ARGprofiler is the addition of the PanRes database. The motivation behind PanRes was to eliminate the inefficiency associated with searching for the same gene in multiple collections and the additional overhead of spawning extra compute jobs for each collection. We, therefore, sought to collect the unique sequences of ARGs from a wide spectrum of existing databases. It is our hope that this will help facilitate fewer but larger and more efficient monitoring runs of public metagenomes, followed by data sharing and the individual AMR researchers then filtering results to their specific focus.</p>
    <p>An important feature of ARGprofiler is the creation of targeted assemblies around genes with ARGextender. ARGextender uses KMA and SPAdes to create targeted <italic toggle="yes">de novo</italic> assemblies by identifying if the targeted ARGs are present in a sample and then recruiting reads to the surrounding regions. The pairwise comparison of ARG-carrying scaffolds produced with ARGextender and SPAdes in sewage samples showed that ARGextender could extract comparable flanking regions to SPAdes but in a much shorter time frame. This approach also avoids running the more expensive algorithm if none of the target genes is identified.</p>
    <p>However, there are still a few points we need to address in the way that ARGprofiler currently works. First, ARGprofiler is designed to only work with short-read sequencing data, thus not utilizing the advantages of long-read sequencing technologies. We are planning to extend the input options to include long-read datasets. Second, a significant aspect of ARGprofiler is the choice of reference databases. PanRes is a one-size-fits-all approach for ARGs. However, as it combines different sources and scopes, it will be up to the individual research questions, which subsets are appropriate for consideration. ARGprofiler also profiles the microbiome of each sequencing dataset by mapping the reads against the microbial reference sequence database mOTUs. This step is included to compare the abundance of ARGs to the microbial content (<xref rid="btae086-B26" ref-type="bibr">Martiny <italic toggle="yes">et al.</italic> 2022b</xref>, <xref rid="btae086-B30" ref-type="bibr">Munk <italic toggle="yes">et al.</italic> 2022</xref>, <xref rid="btae086-B21" ref-type="bibr">Johansson <italic toggle="yes">et al.</italic> 2023</xref>). We chose mOTUs as this collection performed best across different environments with KMA. Our choice was based on the <italic toggle="yes">in silico</italic> datasets, and while real data might contain many more unknowns, it appeared to be the best choice for our pipeline. We chose to incorporate a sub-workflow of creating Mash sketches with optimized parameters to allow the user to compare and cluster to determine similar sequencing datasets and those of poor quality. The sketches also make it possible to query the read sets against pre-sketched genomes, thus allowing the user to re-use the data without rerunning the whole pipeline.</p>
    <p>In conclusion, we have implemented and evaluated ARGprofiler to be a robust bioinformatic pipeline that provides other researchers the opportunity to analyze large collections of metagenomic sequencing runs against a collection of ARGs or other genes of interest. The ARGprofiler code is publicly available under the Apache-2.0 license at <ext-link xlink:href="https://github.com/genomicepidemiology/ARGprofiler" ext-link-type="uri">https://github.com/genomicepidemiology/ARGprofiler</ext-link>.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btae086_Supplementary_Data</label>
      <media xlink:href="btae086_supplementary_data.zip"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by funding from the Novo Nordisk Foundation (grant number: NNF16OC0021856: Global Surveillance of Antimicrobial Resistance); the European Union’s Horizon 2020 research and innovation program under VEO grant agreement (grant number: 874735); and BY-COVID grant agreement (grant number: 101046203).</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btae086-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Alcock</surname><given-names>BP</given-names></string-name>, <string-name><surname>Huynh</surname><given-names>W</given-names></string-name>, <string-name><surname>Chalil</surname><given-names>R</given-names></string-name></person-group><etal>et al</etal><article-title>Card 2023: expanded curation, support for machine learning, and resistome prediction at the comprehensive antibiotic resistance database</article-title>. <source>Nucleic Acids Res</source><year>2023</year>;<volume>51</volume>:<fpage>D690</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">36263822</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B2">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Andrews</surname><given-names>S.</given-names></string-name></person-group> FastQC: a quality control tool for high throughput sequence data, <year>2010</year>. <ext-link xlink:href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/" ext-link-type="uri">https://www.bioinformatics.babraham.ac.uk/projects/fastqc/</ext-link> (accessed July 10, 2023).</mixed-citation>
    </ref>
    <ref id="btae086-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Anthony</surname><given-names>WE</given-names></string-name>, <string-name><surname>Burnham</surname><given-names>C-AD</given-names></string-name>, <string-name><surname>Dantas</surname><given-names>G</given-names></string-name></person-group><etal>et al</etal><article-title>The gut microbiome as a reservoir for antimicrobial resistance</article-title>. <source>J Infect Dis</source><year>2021</year>;<volume>223</volume>:<fpage>S209</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">33326581</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Baker-Austin</surname><given-names>C</given-names></string-name>, <string-name><surname>Wright</surname><given-names>MS</given-names></string-name>, <string-name><surname>Stepanauskas</surname><given-names>R</given-names></string-name></person-group><etal>et al</etal><article-title>Co-selection of antibiotic and metal resistance</article-title>. <source>Trends Microbiol</source><year>2006</year>;<volume>14</volume>:<fpage>176</fpage>–<lpage>82</lpage>.<pub-id pub-id-type="pmid">16537105</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bengtsson-Palme</surname><given-names>J</given-names></string-name>, <string-name><surname>Kristiansson</surname><given-names>E</given-names></string-name>, <string-name><surname>Larsson</surname><given-names>DJ.</given-names></string-name></person-group><article-title>Environmental factors influencing the development and spread of antibiotic resistance</article-title>. <source>FEMS Microbiol Rev</source><year>2018</year>;<volume>42</volume>:<fpage>fux053</fpage>.<pub-id pub-id-type="pmid">29069382</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Blanco-Míguez</surname><given-names>A</given-names></string-name>, <string-name><surname>Beghini</surname><given-names>F</given-names></string-name>, <string-name><surname>Cumbo</surname><given-names>F</given-names></string-name></person-group><etal>et al</etal><article-title>Extending and improving metagenomic taxonomic profiling with uncharacterized species using metaphlan 4</article-title>. <source>Nat Biotechnol</source><year>2023</year>;<volume>41</volume>:<fpage>1633</fpage>–<lpage>1644</lpage>.<pub-id pub-id-type="pmid">36823356</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bonin</surname><given-names>N</given-names></string-name>, <string-name><surname>Doster</surname><given-names>E</given-names></string-name>, <string-name><surname>Worley</surname><given-names>H</given-names></string-name></person-group><etal>et al</etal><article-title>Megares and amr++, v3. 0: an updated comprehensive database of antimicrobial resistance determinants and an improved software pipeline for classification using high-throughput sequencing</article-title>. <source>Nucleic Acids Res</source><year>2023</year>;<volume>51</volume>:<fpage>D744</fpage>–<lpage>52</lpage>.<pub-id pub-id-type="pmid">36382407</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bortolaia</surname><given-names>V</given-names></string-name>, <string-name><surname>Kaas</surname><given-names>RS</given-names></string-name>, <string-name><surname>Ruppe</surname><given-names>E</given-names></string-name></person-group><etal>et al</etal><article-title>Resfinder 4.0 for predictions of phenotypes from genotypes</article-title>. <source>J Antimicrob Chemother</source><year>2020</year>;<volume>75</volume>:<fpage>3491</fpage>–<lpage>500</lpage>.<pub-id pub-id-type="pmid">32780112</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Brinch</surname><given-names>C</given-names></string-name>, <string-name><surname>Leekitcharoenphon</surname><given-names>P</given-names></string-name>, <string-name><surname>Duarte</surname><given-names>AS</given-names></string-name></person-group><etal>et al</etal><article-title>Long-term temporal stability of the resistome in sewage from copenhagen</article-title>. <source>Msystems</source><year>2020</year>;<volume>5</volume>:<fpage>e00841-20</fpage>.<pub-id pub-id-type="pmid">33082278</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B10">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Bushnell</surname><given-names>B.</given-names></string-name></person-group><italic toggle="yes">Bbmap: A Fast, Accurate, Splice-Aware Aligner</italic>. Technical report. Berkeley, CA: Lawrence Berkeley National Lab (LBNL); <year>2014</year>.</mixed-citation>
    </ref>
    <ref id="btae086-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chen</surname><given-names>S.</given-names></string-name></person-group><article-title>Ultrafast one-pass fastq data preprocessing, quality control, and deduplication using fastp</article-title>. <source>iMeta</source><year>2023</year>;<volume>2</volume>:<fpage>e107</fpage>.</mixed-citation>
    </ref>
    <ref id="btae086-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Clausen</surname><given-names>PT.</given-names></string-name></person-group><article-title>Scaling neighbor joining to one million taxa with dynamic and heuristic neighbor joining</article-title>. <source>Bioinformatics</source><year>2023</year>;<volume>39</volume>:<fpage>btac774</fpage>.<pub-id pub-id-type="pmid">36453849</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Clausen</surname><given-names>PT</given-names></string-name>, <string-name><surname>Aarestrup</surname><given-names>FM</given-names></string-name>, <string-name><surname>Lund</surname><given-names>O.</given-names></string-name></person-group><article-title>Rapid and precise alignment of raw reads against redundant databases with KMA</article-title>. <source>BMC Bioinformatics</source><year>2018</year>;<volume>19</volume>:<fpage>307</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">30157759</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B14">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Daruka</surname><given-names>L</given-names></string-name>, <string-name><surname>Czikkely</surname><given-names>MS</given-names></string-name>, <string-name><surname>Szili</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal> Antibiotics of the future are prone to resistance in gram-negative pathogens. <italic toggle="yes">bioRxiv 2023-07</italic>. 2023.</mixed-citation>
    </ref>
    <ref id="btae086-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Edgar</surname><given-names>RC.</given-names></string-name></person-group><article-title>Search and clustering orders of magnitude faster than blast</article-title>. <source>Bioinformatics</source><year>2010</year>;<volume>26</volume>:<fpage>2460</fpage>–<lpage>1</lpage>.<pub-id pub-id-type="pmid">20709691</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Feldgarden</surname><given-names>M</given-names></string-name>, <string-name><surname>Brover</surname><given-names>V</given-names></string-name>, <string-name><surname>Gonzalez-Escalona</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>Amrfinderplus and the reference gene catalog facilitate examination of the genomic links among antimicrobial resistance, stress response, and virulence</article-title>. <source>Sci Rep</source><year>2021</year>;<volume>11</volume>:<fpage>12728</fpage>.<pub-id pub-id-type="pmid">34135355</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gschwind</surname><given-names>R</given-names></string-name>, <string-name><surname>Ugarcina Perovic</surname><given-names>S</given-names></string-name>, <string-name><surname>Weiss</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>Resfinderfg v2. 0: a database of antibiotic resistance genes obtained by functional metagenomics</article-title>. <source>Nucleic Acids Res</source><year>2023</year>;<volume>51</volume>:<fpage>W493</fpage>–<lpage>500</lpage>.<pub-id pub-id-type="pmid">37207327</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gupta</surname><given-names>SK</given-names></string-name>, <string-name><surname>Padmanabhan</surname><given-names>BR</given-names></string-name>, <string-name><surname>Diene</surname><given-names>SM</given-names></string-name></person-group><etal>et al</etal><article-title>Arg-annot, a new bioinformatic tool to discover antibiotic resistance genes in bacterial genomes</article-title>. <source>Antimicrob Agents Chemother</source><year>2014</year>;<volume>58</volume>:<fpage>212</fpage>–<lpage>20</lpage>.<pub-id pub-id-type="pmid">24145532</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hendriksen</surname><given-names>RS</given-names></string-name>, <string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Njage</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal>; <collab>Global Sewage Surveillance Project Consortium</collab>. <article-title>Global monitoring of antimicrobial resistance based on metagenomics analyses of urban sewage</article-title>. <source>Nature Commun</source><year>2019</year>;<volume>10</volume>:<fpage>1124</fpage>.<pub-id pub-id-type="pmid">30850636</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Holmes</surname><given-names>AH</given-names></string-name>, <string-name><surname>Moore</surname><given-names>LS</given-names></string-name>, <string-name><surname>Sundsfjord</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>Understanding the mechanisms and drivers of antimicrobial resistance</article-title>. <source>Lancet</source><year>2016</year>;<volume>387</volume>:<fpage>176</fpage>–<lpage>87</lpage>.<pub-id pub-id-type="pmid">26603922</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Johansson</surname><given-names>MH</given-names></string-name>, <string-name><surname>Aarestrup</surname><given-names>FM</given-names></string-name>, <string-name><surname>Petersen</surname><given-names>TN.</given-names></string-name></person-group><article-title>Importance of mobile genetic elements for dissemination of antimicrobial resistance in metagenomic sewage samples across the world</article-title>. <source>PLoS One</source><year>2023</year>;<volume>18</volume>:<fpage>e0293169</fpage>.<pub-id pub-id-type="pmid">37856515</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kieser</surname><given-names>S</given-names></string-name>, <string-name><surname>Brown</surname><given-names>J</given-names></string-name>, <string-name><surname>Zdobnov</surname><given-names>EM</given-names></string-name></person-group><etal>et al</etal><article-title>Atlas: a snakemake workflow for assembly, annotation, and genomic binning of metagenome sequence data</article-title>. <source>BMC Bioinformatics</source><year>2020</year>;<volume>21</volume>:<fpage>257</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">32571209</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Köster</surname><given-names>J</given-names></string-name>, <string-name><surname>Rahmann</surname><given-names>S.</given-names></string-name></person-group><article-title>Snakemake—a scalable bioinformatics workflow engine</article-title>. <source>Bioinformatics</source><year>2012</year>;<volume>28</volume>:<fpage>2520</fpage>–<lpage>2</lpage>.<pub-id pub-id-type="pmid">22908215</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lu</surname><given-names>J</given-names></string-name>, <string-name><surname>Breitwieser</surname><given-names>FP</given-names></string-name>, <string-name><surname>Thielen</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Bracken: estimating species abundance in metagenomics data</article-title>. <source>PeerJ Computer Science</source><year>2017</year>;<volume>3</volume>:<fpage>e104</fpage>.</mixed-citation>
    </ref>
    <ref id="btae086-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Martiny</surname><given-names>H-M</given-names></string-name>, <string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Brinch</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>A curated data resource of 214k metagenomes for characterization of the global antimicrobial resistome</article-title>. <source>PLoS Biol</source><year>2022a</year>;<volume>20</volume>:<fpage>e3001792</fpage>.<pub-id pub-id-type="pmid">36067158</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Martiny</surname><given-names>H-M</given-names></string-name>, <string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Brinch</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>Global distribution of mcr gene variants in 214k metagenomic samples</article-title>. <source>Msystems</source><year>2022b</year>;<volume>7</volume>:<fpage>e00105</fpage>.<pub-id pub-id-type="pmid">35343801</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Meyer</surname><given-names>F</given-names></string-name>, <string-name><surname>Bremges</surname><given-names>A</given-names></string-name>, <string-name><surname>Belmann</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Assessing taxonomic metagenome profilers with opal</article-title>. <source>Genome Biol</source><year>2019</year>;<volume>20</volume>:<fpage>1</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">30606230</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Meyer</surname><given-names>F</given-names></string-name>, <string-name><surname>Fritz</surname><given-names>A</given-names></string-name>, <string-name><surname>Deng</surname><given-names>Z-L</given-names></string-name></person-group><etal>et al</etal><article-title>Critical assessment of metagenome interpretation: the second round of challenges</article-title>. <source>Nat Methods</source><year>2022</year>;<volume>19</volume>:<fpage>429</fpage>–<lpage>40</lpage>.<pub-id pub-id-type="pmid">35396482</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mölder</surname><given-names>F</given-names></string-name>, <string-name><surname>Jablonski</surname><given-names>KP</given-names></string-name>, <string-name><surname>Letcher</surname><given-names>B</given-names></string-name></person-group><etal>et al</etal><article-title>Sustainable data analysis with snakemake</article-title>. <source>F1000Res</source><year>2021</year>;<volume>10</volume>:<fpage>33</fpage>.<pub-id pub-id-type="pmid">34035898</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Brinch</surname><given-names>C</given-names></string-name>, <string-name><surname>Møller</surname><given-names>FD</given-names></string-name></person-group><etal>et al</etal>; <collab>Global Sewage Surveillance Consortium</collab>. <article-title>Genomic analysis of sewage from 101 countries reveals global landscape of antimicrobial resistance</article-title>. <source>Nat Commun</source><year>2022</year>;<volume>13</volume>:<fpage>7251</fpage>.<pub-id pub-id-type="pmid">36456547</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B31">
      <mixed-citation publication-type="journal"><collab>NCBI Resource Coordinators</collab>. <article-title>Database resources of the national center for biotechnology information</article-title>. <source>Nucleic Acid Res</source><year>2018</year>;<volume>46</volume>:D1,D8–D13.</mixed-citation>
    </ref>
    <ref id="btae086-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nurk</surname><given-names>S</given-names></string-name>, <string-name><surname>Meleshko</surname><given-names>D</given-names></string-name>, <string-name><surname>Korobeynikov</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>Metaspades: a new versatile metagenomic assembler</article-title>. <source>Genome Res</source><year>2017</year>;<volume>27</volume>:<fpage>824</fpage>–<lpage>34</lpage>.<pub-id pub-id-type="pmid">28298430</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ondov</surname><given-names>BD</given-names></string-name>, <string-name><surname>Treangen</surname><given-names>TJ</given-names></string-name>, <string-name><surname>Melsted</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Mash: fast genome and metagenome distance estimation using minhash</article-title>. <source>Genome Biol</source><year>2016</year>;<volume>17</volume>:<fpage>132</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">27323842</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Osakunor</surname><given-names>DN</given-names></string-name>, <string-name><surname>Munk</surname><given-names>P</given-names></string-name>, <string-name><surname>Mduluza</surname><given-names>T</given-names></string-name></person-group><etal>et al</etal><article-title>The gut microbiome but not the resistome is associated with urogenital schistosomiasis in preschool-aged children</article-title>. <source>Commun Biol</source><year>2020</year>;<volume>3</volume>:<fpage>155</fpage>.<pub-id pub-id-type="pmid">32242065</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>O’Toole</surname><given-names>Á</given-names></string-name>, <string-name><surname>Scher</surname><given-names>E</given-names></string-name>, <string-name><surname>Underwood</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>Assignment of epidemiological lineages in an emerging pandemic using the pangolin tool</article-title>. <source>Virus Evol</source><year>2021</year>;<volume>7</volume>:<fpage>veab064</fpage>.<pub-id pub-id-type="pmid">34527285</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pal</surname><given-names>C</given-names></string-name>, <string-name><surname>Bengtsson-Palme</surname><given-names>J</given-names></string-name>, <string-name><surname>Rensing</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>Bacmet: antibacterial biocide and metal resistance genes database</article-title>. <source>Nucleic Acids Res</source><year>2014</year>;<volume>42</volume>:<fpage>D737</fpage>–<lpage>43</lpage>.<pub-id pub-id-type="pmid">24304895</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Prjibelski</surname><given-names>A</given-names></string-name>, <string-name><surname>Antipov</surname><given-names>D</given-names></string-name>, <string-name><surname>Meleshko</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>Using spades de novo assembler</article-title>. <source>Curr Protoc Bioinformatics</source><year>2020</year>;<volume>70</volume>:<fpage>e102</fpage>.<pub-id pub-id-type="pmid">32559359</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B38">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Quast</surname><given-names>C</given-names></string-name>, <string-name><surname>Pruesse</surname><given-names>E</given-names></string-name>, <string-name><surname>Yilmaz</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>The silva ribosomal rna gene database project: improved data processing and web-based tools</article-title>. <source>Nucleic Acids Res</source><year>2012</year>;<volume>41</volume>:<fpage>D590</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">23193283</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ruscheweyh</surname><given-names>H-J</given-names></string-name>, <string-name><surname>Milanese</surname><given-names>A</given-names></string-name>, <string-name><surname>Paoli</surname><given-names>L</given-names></string-name></person-group><etal>et al</etal><article-title>Cultivation-independent genomes greatly expand taxonomic-profiling capabilities of mOTUs across various environments</article-title>. <source>Microbiome</source><year>2022</year>;<volume>10</volume>:<fpage>212</fpage>.<pub-id pub-id-type="pmid">36464731</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B40">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wood</surname><given-names>DE</given-names></string-name>, <string-name><surname>Lu</surname><given-names>J</given-names></string-name>, <string-name><surname>Langmead</surname><given-names>B.</given-names></string-name></person-group><article-title>Improved metagenomic analysis with kraken 2</article-title>. <source>Genome Biol</source><year>2019</year>;<volume>20</volume>:<fpage>257</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">31779668</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B41">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname><given-names>A-N</given-names></string-name>, <string-name><surname>Gaston</surname><given-names>JM</given-names></string-name>, <string-name><surname>Dai</surname><given-names>CL</given-names></string-name></person-group><etal>et al</etal><article-title>An omics-based framework for assessing the health risk of antimicrobial resistance genes</article-title>. <source>Nat Commun</source><year>2021</year>;<volume>12</volume>:<fpage>4765</fpage>.<pub-id pub-id-type="pmid">34362925</pub-id></mixed-citation>
    </ref>
    <ref id="btae086-B42">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname><given-names>X</given-names></string-name>, <string-name><surname>Jonassen</surname><given-names>I.</given-names></string-name></person-group><article-title>RASflow: an RNA-Seq analysis workflow with Snakemake</article-title>. <source>BMC Bioinformatics</source><year>2020</year>;<volume>21</volume>:<fpage>1</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">31898485</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
