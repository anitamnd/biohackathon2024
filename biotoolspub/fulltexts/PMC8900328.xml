<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Biol</journal-id>
    <journal-title-group>
      <journal-title>Genome Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1474-7596</issn>
    <issn pub-type="epub">1474-760X</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8900328</article-id>
    <article-id pub-id-type="publisher-id">2630</article-id>
    <article-id pub-id-type="doi">10.1186/s13059-022-02630-0</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>StrainGE: a toolkit to track and characterize low-abundance strains in complex microbial communities</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>van Dijk</surname>
          <given-names>Lucas R.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Walker</surname>
          <given-names>Bruce J.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Straub</surname>
          <given-names>Timothy J.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Worby</surname>
          <given-names>Colin J.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Grote</surname>
          <given-names>Alexandra</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Schreiber</surname>
          <given-names>Henry L.</given-names>
          <suffix>IV</suffix>
        </name>
        <xref ref-type="aff" rid="Aff5">5</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Anyansi</surname>
          <given-names>Christine</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pickering</surname>
          <given-names>Amy J.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff7">7</xref>
        <xref ref-type="aff" rid="Aff8">8</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hultgren</surname>
          <given-names>Scott J.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff5">5</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Manson</surname>
          <given-names>Abigail L.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Abeel</surname>
          <given-names>Thomas</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7857-9145</contrib-id>
        <name>
          <surname>Earl</surname>
          <given-names>Ashlee M.</given-names>
        </name>
        <address>
          <email>aearl@broadinstitute.org</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.66859.34</institution-id><institution-id institution-id-type="ISNI">0000 0004 0546 1623</institution-id><institution>Infectious Disease &amp; Microbiome Program, </institution><institution>Broad Institute, </institution></institution-wrap>415 Main Street, Cambridge, MA 02142 USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.5292.c</institution-id><institution-id institution-id-type="ISNI">0000 0001 2097 4740</institution-id><institution>Delft Bioinformatics Lab, </institution><institution>Delft University of Technology, </institution></institution-wrap>Van Mourik Broekmanweg 6, Delft, 2628 XE The Netherlands </aff>
      <aff id="Aff3"><label>3</label>Applied Invention, Cambridge, MA USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.38142.3c</institution-id><institution-id institution-id-type="ISNI">000000041936754X</institution-id><institution>Department of Immunology and Infectious Diseases, </institution><institution>Harvard T.H. Chan School of Public Health, </institution></institution-wrap>Boston, MA 02115 USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="GRID">grid.4367.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2355 7002</institution-id><institution>Department of Molecular Microbiology, </institution><institution>Washington University School of Medicine, </institution></institution-wrap>St. Louis, MO 63110 USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="GRID">grid.4367.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2355 7002</institution-id><institution>Center for Women’s Infectious Disease Research (CWIDR), </institution><institution>Washington University School of Medicine, </institution></institution-wrap>St. Louis, MO 63110 USA </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="GRID">grid.47840.3f</institution-id><institution-id institution-id-type="ISNI">0000 0001 2181 7878</institution-id><institution>Department of Civil and Environmental Engineering, </institution><institution>University of California, Berkeley, </institution></institution-wrap>Berkeley, CA 94720 USA </aff>
      <aff id="Aff8"><label>8</label><institution-wrap><institution-id institution-id-type="GRID">grid.429997.8</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 7531</institution-id><institution>Stuart B. Levy Center for Integrated Management of Antimicrobial Resistance (Levy CIMAR), </institution><institution>Tufts University, </institution></institution-wrap>Boston, MA USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>7</day>
      <month>3</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>7</day>
      <month>3</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2022</year>
    </pub-date>
    <volume>23</volume>
    <elocation-id>74</elocation-id>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>5</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>9</day>
        <month>2</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Human-associated microbial communities comprise not only complex mixtures of bacterial species, but also mixtures of conspecific strains, the implications of which are mostly unknown since strain level dynamics are underexplored due to the difficulties of studying them. We introduce the Strain Genome Explorer (StrainGE) toolkit, which deconvolves strain mixtures and characterizes component strains at the nucleotide level from short-read metagenomic sequencing with higher sensitivity and resolution than other tools. StrainGE is able to identify strains at 0.1x coverage and detect variants for multiple conspecific strains within a sample from coverages as low as 0.5x.</p>
      <sec>
        <title>Supplementary Information</title>
        <p>The online version contains supplementary material available at 10.1186/s13059-022-02630-0.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Metagenomics</kwd>
      <kwd>Microbiome</kwd>
      <kwd>Strain-tracking</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000060</institution-id>
            <institution>National Institute of Allergy and Infectious Diseases</institution>
          </institution-wrap>
        </funding-source>
        <award-id>U19AI110818</award-id>
        <award-id>U01AI095776</award-id>
        <principal-award-recipient>
          <name>
            <surname>Hultgren</surname>
            <given-names>Scott J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000062</institution-id>
            <institution>National Institute of Diabetes and Digestive and Kidney Diseases</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01DK121822</award-id>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2022</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par2">Human-associated microbial communities include complex mixtures of bacterial species. Many of these species are renowned for their genomic and phenotypic plasticity. For example, strains of <italic>Escherichia coli</italic> share a core genome representing only about half of their genes [<xref ref-type="bibr" rid="CR1">1</xref>] and cause distinct disease including diarrhea and urinary tract infections, or potentiate tumorigenesis, while other strains are able to co-exist with their host without causing overt illness [<xref ref-type="bibr" rid="CR2">2</xref>–<xref ref-type="bibr" rid="CR4">4</xref>]. Multiple distinct strains of the same species, often from genetically dissimilar phylogroups, frequently coexist within a single human gut community [<xref ref-type="bibr" rid="CR5">5</xref>, <xref ref-type="bibr" rid="CR6">6</xref>], the implications of which are mostly underexplored due to the difficulties of studying strain-level variation from complex community samples.</p>
    <p id="Par3">While culture-based approaches have been a workhorse for dissecting strain-level diversity, these approaches can be slow and unfaithful to the true representation of strains, due to culturing bottlenecks that limit observed diversity, as well as the potential for evolution during culture [<xref ref-type="bibr" rid="CR7">7</xref>]. Whole metagenome shotgun sequencing approaches offer less perturbed views of strain-level diversity, but require specialized computational tools. However, most current strain-level metagenomic data analytical tools (reviewed in Anyansi et al. [<xref ref-type="bibr" rid="CR8">8</xref>]) were not designed to work at the low coverages typically found for many clinically relevant organisms in metagenomic samples, such as <italic>E. coli</italic> in the human gut [<xref ref-type="bibr" rid="CR5">5</xref>]. Existing tools that aim to disentangle within-species strain mixtures include BIB [<xref ref-type="bibr" rid="CR9">9</xref>], StrainEst [<xref ref-type="bibr" rid="CR10">10</xref>], and DiTASiC [<xref ref-type="bibr" rid="CR11">11</xref>], as well as the broader taxonomic profiling tools like Kraken2 [<xref ref-type="bibr" rid="CR12">12</xref>] and GOTTCHA [<xref ref-type="bibr" rid="CR13">13</xref>] when given an appropriate database. These tools rely upon a precomputed database of reference genomes, from which the best matches are reported for a sample (or set of samples). Thus, output from these tools is dependent upon database granularity and does not distinguish between distinct strains matching the same reference. Another class of tools characterizes and tracks strains based on single nucleotide variant (SNV) profiles along a single reference or a set of marker genes, including MIDAS [<xref ref-type="bibr" rid="CR14">14</xref>], StrainPhlan [<xref ref-type="bibr" rid="CR15">15</xref>], and ConStrains [<xref ref-type="bibr" rid="CR16">16</xref>]. In the case of strain mixtures, MIDAS and StrainPhlan do not untangle the SNVs coming from different strains, while ConStrains attempts to link SNVs with similar allele frequencies, though linking SNVs requires high strain coverage to be accurate [<xref ref-type="bibr" rid="CR16">16</xref>, <xref ref-type="bibr" rid="CR17">17</xref>]. A third class of tools aims to recover strain-level variation after de novo metagenomic assembly, including DESMAN [<xref ref-type="bibr" rid="CR17">17</xref>], inStrain [<xref ref-type="bibr" rid="CR18">18</xref>], and STRONG [<xref ref-type="bibr" rid="CR19">19</xref>]. Assembly approaches require higher sequence coverage than typically achieved for lower abundance members of a community. To our knowledge, none of these computational approaches work robustly at low coverages (&lt; 10x), accurately disentangle mixtures of same-species strains, and distinguish similar strains at the nucleotide level.</p>
    <p id="Par4">In order to be able to disentangle mixtures of low-abundance, clinically important strains within metagenomic data, we developed the Strain Genome Explorer (StrainGE) toolkit. In an advance over related tools, StrainGE works at exceptionally low sequence coverages (from 0.1x) to identify strains in a sample, and allows the user to characterize and compare strains across samples at the nucleotide level, with high resolution. We have extensively benchmarked StrainGE on synthetic data and compared it against other state-of-the-art strain detection tools. We also applied StrainGE to multiple clinical human gut metagenomic datasets, demonstrating StrainGE’s ability to glean insights into biological systems that previous tools could not, including observing previously undetected persistence of low-abundance strains across time. Herein, we applied StrainGE to analysis of clinically important strains of <italic>E. coli</italic> and <italic>Enterococcus</italic>, but StrainGE can be broadly applied to all community assemblages where same species bacterial strain dynamics are of interest.</p>
  </sec>
  <sec id="Sec2">
    <title>Results</title>
    <sec id="Sec3">
      <title>Strain Genome Explorer (StrainGE) toolkit</title>
      <p id="Par5">StrainGE is a toolkit for strain-level characterization and tracking of species (or genera) of interest from short read metagenomic datasets, tuned specifically to capture low abundance strains where data are scant. StrainGE has two key components: Strain Genome Search Tool (StrainGST) and Strain Genome Recovery (StrainGR). StrainGST sensitively reports reference genome(s) from a database that are most similar to the strain(s) in a sample. StrainGR analyzes short read alignments to a reported reference genome(s) to identify single nucleotide variants (SNVs) and large deletions (i.e., gaps in coverage) relative to the reference. Though StrainGST can be used as a standalone tool, the StrainGE tool suite, including StrainGR, enables sensitive nucleotide-level comparison and tracking of strains across multiple samples and provides insights into potential functional variation among individual strains.</p>
      <p id="Par6">In brief, StrainGST builds a database of high-quality reference genomes (e.g., RefSeq assemblies) from a species or genus of interest (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a), filtering them to remove highly similar genomes using a k-mer based clustering approach, with a tunable threshold (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S1). StrainGST’s default database clustering threshold (0.9 Jaccard similarity) corresponds to an approximate ANI of ~ 99.8% [<xref ref-type="bibr" rid="CR20">20</xref>], which determines the minimum distance between reference genomes. To identify a similar reference(s) to the strain(s) within a sample and to estimate its relative abundance, StrainGST compares the k-mers in the sample to those of the database reference genomes (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b) and iteratively ranks each reference using three key metrics, similar to QuantTB [<xref ref-type="bibr" rid="CR21">21</xref>]: (1) the fraction of reference k-mers present in the sample, (2) the fraction of sample k-mer counts explained by a reference, and (3) the evenness of the distribution of shared k-mers along a reference. If the resulting score is above a tunable threshold, the reference strain is reported as present in the sample.<fig id="Fig1"><label>Fig. 1</label><caption><p>StrainGE is a toolkit to track, characterize and compare low-abundance strains in metagenomic samples. <bold>a</bold> Overview of StrainGE pipeline. StrainGST uses a database of high quality reference genomes to select those most similar to strains present in a metagenomic sample. StrainGR further characterizes SNVs and gaps that differ between references selected by StrainGST and the actual strain present in the sample. <bold>b</bold> At each iteration, StrainGST scores each reference strain by comparing the k-mer profile of the reference to the sample k-mers, reporting the reference closest to the highest abundant strain in the sample. The k-mers in the reported reference are removed from the sample and the process is repeated to search for lower-abundance strains, until there are insufficient k-mers. <bold>c</bold> StrainGR uses a short read alignment-based approach to characterize variation (SNVs and gaps) between the reference(s) identified by StrainGST and the metagenomic sample. Regions shared between the concatenated genomes (gray shaded areas) are detected and excluded from variant calling. Alleles are classified as “strong” or “weak.” After applying rigorous QC metrics, positions in the reference are classified as (i) “reference confirmed” (light gray; a single strong reference allele), (ii) “SNV” (red; a single strong alternative allele), or (iii) “multi-allelic” (blue; multiple strong alleles present, e.g. the blue allele together with the reference allele in gray). The position with a strong reference allele and a weak alternative allele (green; an allele with only limited support in the reads) is classified as “reference confirmed” because only the reference allele is considered strong at that position. The “callable” genome is defined as all positions within the reference with at least one strong allele call</p></caption><graphic xlink:href="13059_2022_2630_Fig1_HTML" id="MO1"/></fig></p>
      <p id="Par7">StrainGR was designed to complement StrainGST by providing a more detailed view of the nucleotide- and gene-level differences between a strain in a sample and its closest reference, which can be used to compare across samples having strains that match the same reference. StrainGR analyzes alignments of metagenomic sequencing data to each StrainGST predicted reference (Fig. <xref rid="Fig1" ref-type="fig">1</xref>c). To ensure accurate SNV calls while maintaining sensitivity at low coverage, StrainGR employs stringent quality thresholds and heuristics to filter spurious alignments and reduce the number of incorrect calls.</p>
      <p id="Par8">To separate SNVs belonging to different strains, StrainGR creates a concatenated set of reference genomes, containing all references predicted by StrainGST in a sample or set of samples. It uses this reference set to align metagenomic reads and call variants. While close reference genome(s) generally result in more accurate alignments and variant calls [<xref ref-type="bibr" rid="CR22">22</xref>], StrainGR still provides meaningful relationships when the reference is more distant, as would be the case in a smaller constructed database or with less well-studied organisms (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Supplemental Results A; Figs. S1-S4). To prevent assigning alleles incorrectly, StrainGR only calls variants in regions unique to a single reference by filtering out ambiguously aligned reads. In cases where StrainGST has identified distinct but closely related strains across samples, StrainGR can perform another, coarser round of reference clustering prior to concatenation in order to increase the amount of unique sequence for variant calling.</p>
      <p id="Par9">Variant calls can then be used to compare strains across samples. StrainGR compares positions within the “callable genome” or the set of positions with any reference or alternative allele supported by at least two good reads and &gt; 10% of the alignment pileup (Fig. <xref rid="Fig1" ref-type="fig">1</xref>c). To perform a comparison, only “common callable” positions are considered, which represent the subset of the callable genome for a given reference that is shared by two samples. Strain relationships can be assessed using two key metrics: (i) the Average Callable Nucleotide Identity (ACNI), or the percentage of common callable positions where both samples have a single identical base call, and (ii) a “gap similarity” metric, as patterns of large deletions are often conserved between closely related strains, which can provide an orthogonal metric of strain similarity [<xref ref-type="bibr" rid="CR23">23</xref>]. The ACNI and gap similarity values that define two samples as containing the same “strain” depend on the research question [<xref ref-type="bibr" rid="CR7">7</xref>]. For the purposes of this manuscript, we consider two samples to contain the same strain if ACNI is ≥ 99.95%, which was based on our benchmarking of in silico <italic>E. coli</italic> spiked metagenomes. This threshold is stricter than our initial database clustering threshold of 99.8%, as samples matching the same reference in the database can contain different strains. As different studies may necessitate different strain definitions, we have intentionally made these thresholds easily tunable. With StrainGST able to accurately report close references to strains at coverages as low as 0.1x, and StrainGR able to track and characterize strains from 0.5x coverage, StrainGE enables sensitive analysis of very low-abundance strains, such as typical <italic>E. coli</italic> relative abundances of &lt; 0.1% within a 3G metagenomic sample.</p>
    </sec>
    <sec id="Sec4">
      <title>Benchmarking StrainGE on <italic>Escherichia</italic></title>
      <p id="Par10">StrainGE was designed to be broadly applicable across different bacterial genera and species, including less well-studied species lacking numerous high quality reference genomes (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Supplemental Results A). For benchmarking, we focused on <italic>E. coli</italic>, an evolutionarily and functionally diverse species. Despite their importance to human health, <italic>E. coli</italic> are typically found at low (&lt; 1%) relative abundance in diverse strain mixtures in human guts [<xref ref-type="bibr" rid="CR5">5</xref>].</p>
      <p id="Par11">We first used StrainGST to construct an <italic>Escherichia</italic>-specific reference database by downloading all available complete <italic>Escherichia</italic> assemblies from NCBI RefSeq (929 assemblies, July 2019; <xref rid="Sec12" ref-type="sec">Materials and methods</xref>; Additional file <xref rid="MOESM2" ref-type="media">2</xref>). Because plasmids readily transfer between different genetic backgrounds of the same and/or different species (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Supplementary Results A) [<xref ref-type="bibr" rid="CR24">24</xref>], scaffolds labeled as plasmid, or those &lt; 1 Mbp were removed. After using the default clustering threshold corresponding to ~ 99.8% ANI, the resulting StrainGST database contained 361 complete <italic>Escherichia</italic> chromosomes, comprising 341 <italic>E. coli</italic> and <italic>Shigella</italic> chromosomes representing all eight phylogroups [<xref ref-type="bibr" rid="CR1">1</xref>], as well as 20 chromosomes from other <italic>Escherichia</italic> species.</p>
      <sec id="Sec5">
        <title>StrainGE can accurately characterize strains and approximate ANI at coverages as low as 0.1x</title>
        <p id="Par12">To assess StrainGE’s ability to detect and characterize strains, we first benchmarked each of StrainGE’s components, StrainGST and StrainGR, individually. To benchmark StrainGST, we first used in silico constructed metagenomes that were spiked with sequences of known <italic>Escherichia</italic> strains at varying relative abundances. We compared StrainGST’s ability to identify the correct close reference to that of two similar tools that depend on reference databases, BIB [<xref ref-type="bibr" rid="CR9">9</xref>] and StrainEst [<xref ref-type="bibr" rid="CR10">10</xref>]. While the databases used for StrainGST and StrainEst were identical, BIB’s database construction method did not scale; thus, we used a smaller database with 20 genomes. StrainGST performed as well as, or better than, the other tools across all scenarios tested, including mixes of up to 3 strains at unequal abundances or 4 strains of equal abundance and stood out strongly when strains were at very low abundance (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Supplementary Results B; Fig. S5).</p>
        <p id="Par13">To further benchmark these three tools on real sequencing data of known strain composition, we created and sequenced a mock community containing approximately 99% human DNA and 1% <italic>E. coli</italic> DNA, representing a mixture of four distinct, previously sequenced strains with fully finished genomes mixed in unequal (approximately 80:15:4.9:0.1) relative abundances (<xref rid="Sec12" ref-type="sec">Materials and methods</xref>). StrainGST resolved the composition of this in vitro mock community without error (Table <xref rid="Tab1" ref-type="table">1</xref>), while other tools reported two or more false positives (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S2).<table-wrap id="Tab1"><label>Table 1</label><caption><p>StrainGST was the only tool that correctly identified the known composition of a mock community</p></caption><table frame="hsides" rules="groups"><thead><tr><th colspan="4">Predicted strains (approximate ANI to closest true strain)<sup><bold>a</bold></sup></th></tr><tr><th>Actual strain in mock community (phylogroup)</th><th>StrainGST</th><th>StrainEst</th><th>BIB</th></tr></thead><tbody><tr><td><italic>E. coli</italic> SEC470 (A)</td><td><italic>✓</italic></td><td><italic>✓</italic></td><td><italic>E. coli</italic> K-12 GM4792, 99.24 %</td></tr><tr><td><italic>E. coli</italic> UTI89 (B2)</td><td><italic>E. coli</italic> UM146, 99.95%</td><td><italic>E. coli</italic> UM146, 99.95%</td><td><italic>E. coli</italic> H105, 98.49%</td></tr><tr><td><italic>E. coli</italic> Sakai (E)</td><td><italic>E. coli</italic> 149, 99.89%</td><td><italic>E. coli</italic> 149, 99.89%</td><td><italic>E. coli</italic> 108, 99.97%</td></tr><tr><td><italic>E. coli</italic> 24377A (B1)</td><td><italic>✓</italic></td><td><italic>✓</italic></td><td><italic>E. coli</italic> S40, 99.01%</td></tr><tr><td/><td/><td>✘ <italic>E. coli</italic> APEC IMT5155, 99.51%</td><td>✘ <italic>S. flexneri</italic> G1663, 97.97%</td></tr><tr><td/><td/><td>✘ <italic>E. coli</italic> RM14721, 99.44%</td><td>✘ <italic>E. coli</italic> LHM10-1, 98.12%</td></tr><tr><td/><td/><td/><td>✘ <italic>E. coli</italic> MSHS 133, 97.67%</td></tr><tr><td/><td/><td/><td>✘ <italic>S. dysenteriae</italic> 80-547, 97.71%</td></tr><tr><td/><td/><td/><td>✘ <italic>E. coli</italic> IMT16316, 97.39%</td></tr><tr><td/><td/><td/><td>✘ <italic>S. dysenteriae</italic> ATCC 12039, 97.08%</td></tr></tbody></table><table-wrap-foot><p><sup>a</sup>A check mark indicates that the exact strain was present in our database and correctly identified. A strain name indicates that the exact reference was not in the reference database, but the closest available reference was correctly identified (along with its approximate ANI to the actual strain). A strain name with an “X” indicates a false positive strain identified by the tool that was not present in the mock community. Percentages near strain names indicate approximate ANI to the closest true strain. Relative abundances for each strain are listed in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S2</p></table-wrap-foot></table-wrap></p>
        <p id="Par14">To benchmark StrainGR’s ability to call variants (SNVs and large deletions, or gaps), we used another set of <italic>Escherichia</italic>-spiked metagenomes, with reads simulated from <italic>in silico</italic> mutated reference genomes (99.9% ANI to reference; 5,000 SNVs). StrainGR accurately called SNVs and large deletions, for both single strain and mixture samples, providing key information to assess whether two samples shared a strain via the ACNI metric, StrainGR’s approximation of ANI, and gap similarity (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Supplementary Results C-D; Fig. S6). To assess the accuracy and robustness of ACNI, we generated spiked metagenomes similar to those described above, but we varied the number of SNVs introduced in silico (100–99.9% ANI to reference; 0–5,000 SNVs) and used different metagenomic background samples, some with other <italic>E. coli</italic> strains present (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S3). Identical strains in different samples had high ACNI and gap similarity (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a) and StrainGR’s ACNI across all strain pairs correlated strongly with true ANI, even though ACNI is based on unique regions, and ANI is based on the entire genome (Fig. <xref rid="Fig2" ref-type="fig">2</xref>b). In this benchmark, the optimal ACNI threshold to classify two samples as having the same strain was 99.98% (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S7), which is likely higher than the value we would expect from real data due to the artificially uniform distribution of SNVs in our synthetic benchmarks and that the references used in benchmarking were also present in the StrainGST database. For analysis of real data in this manuscript, we chose a slightly lower value of 99.95%.<fig id="Fig2"><label>Fig. 2</label><caption><p>StrainGR discriminates between highly similar strains and reports ACNI which strongly correlates with true ANI. <bold>a</bold> For all synthetic sample pairs with the same StrainGST reference called, the Jaccard gap similarity index and pairwise ACNI are plotted. Circle size indicates the percentage of the reference genome that was callable across both strains being compared. Red circles indicate comparisons between identical strains. <bold>b</bold> For all pairs, the true ANI between spiked isolates is plotted against the ACNI, as estimated by StrainGR. The dashed line indicates parity between these metrics. Pairs of strains could have 0–10,000 SNV differences</p></caption><graphic xlink:href="13059_2022_2630_Fig2_HTML" id="MO2"/></fig></p>
      </sec>
      <sec id="Sec6">
        <title>StrainGE was the most accurate at detecting shared strains at coverages as low as 0.5x</title>
        <p id="Par15">Having demonstrated that both StrainGST and StrainGR worked well, we aimed to assess StrainGE’s complete pipeline to track strains across samples, including in strain mixtures. We compared StrainGE’s ability to track strains to two recent, highly cited strain-tracking tools, MIDAS [<xref ref-type="bibr" rid="CR14">14</xref>] and StrainPhlan [<xref ref-type="bibr" rid="CR15">15</xref>]. Although MIDAS and StrainPhlan require high strain coverage to run to completion (5x and 10x, respectively), we were able to use manual tuning to allow these tools to accommodate our lower coverage benchmarks (<xref rid="Sec12" ref-type="sec">Materials and methods</xref>). We excluded ConStrains [<xref ref-type="bibr" rid="CR16">16</xref>] because of its high coverage requirements which could not easily be tuned [<xref ref-type="bibr" rid="CR16">16</xref>, <xref ref-type="bibr" rid="CR17">17</xref>]. To assess the sensitivity of these tools to distinguish between similar strains, we generated pairs of spiked metagenomic samples, each containing one or more <italic>Escherichia</italic> strains at 0.1x-10x coverage. Similar strain pairs were derived from the same reference genome, but with a different set of ~ 5000 random SNVs introduced in silico into each strain’s genome (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a, b). This resulted in each strain having 99.9% ANI to the reference and each strain pair having 99.8% ANI to one another. This identity level should result in strain pairs matching the same StrainGST reference but still distinguishable by StrainGR.<fig id="Fig3"><label>Fig. 3</label><caption><p>StrainGE is the only tool that can detect strain sharing at coverages as low as 0.5x. <bold>a</bold> Depiction of how synthetic <italic>Escherichia</italic> genomes were generated from randomly selected NCBI RefSeq genomes to create sets of closely related strains (e.g., A1/A2 and B1/B2) for spike in experiments. <bold>b</bold> Depiction of how spiked metagenomes were created using synthetic genomes from <bold>a</bold>. Each circle represents a spiked metagenome. The color of the circle indicates which synthetic strain was included: single color circles indicate spiked metagenomes containing a single synthetic strain, and two color circles indicate spiked metagenomes containing two synthetic strains mixed at equal proportions. <bold>c</bold>–<bold>e</bold> Precision-recall curves for each tool and coverage 0.1x–10x, when given the task to detect which sample pairs contain identical strains. The area under the curve (AUC) is depicted as a heatmap below. The “successful comparisons” bar plot indicates the percentage of sample pairs for which a comparison was possible (i.e., tools ran to completion for both samples). <bold>c</bold> Limiting to single-strain samples from distinct references. <bold>d</bold> Including samples with two strains, but limited to strains from distinct references. <bold>e</bold> Including samples with closely related strains</p></caption><graphic xlink:href="13059_2022_2630_Fig3_HTML" id="MO3"/></fig></p>
        <p id="Par16">At 10x coverage, MIDAS and StrainPhlan performed comparably using tuned (Fig. <xref rid="Fig3" ref-type="fig">3</xref>) and default (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8) settings. While StrainGE and MIDAS performed well across all scenarios at high coverage, StrainPhlan performed poorly on mixes because it only reported a single SNV profile for each sample. For lower coverage scenarios, StrainGE consistently outperformed the manually tuned versions of MIDAS and StrainPhlan (Fig. <xref rid="Fig3" ref-type="fig">3</xref>). For single strain samples, StrainGE perfectly matched strain pairs down to 0.1x coverage, with MIDAS performing comparably (Fig. <xref rid="Fig3" ref-type="fig">3</xref>c). StrainPhlan performed marginally at 1x coverage and still was unable to run to completion at coverages lower than 1x. For simple mixtures (Fig. <xref rid="Fig3" ref-type="fig">3</xref>d), only StrainGE and MIDAS correctly matched most pairs, because StrainPhlan was unable to disentangle mixes. StrainGE was the only tool that was able to generate results across the whole range of coverages, scoring almost perfectly down to the lowest tested coverage of 0.1x. When we included samples containing very closely related pairs (Fig. <xref rid="Fig3" ref-type="fig">3</xref>e), StrainGE and MIDAS performed well down to 0.5x coverage, but StrainPhlan could not distinguish between closely related strains, even at 10x coverage, likely due to its reliance on marker genes which comprise only a small fraction of the genome. Whereas StrainGE relied on a mean callable genome of 74% ± 13% (at 10x coverage), StrainPhlan relied on marker genes which only covered on average 1.4% ± 0.3% of the references.</p>
        <p id="Par17">StrainGE achieved this high sensitivity with comparable runtime to MIDAS and StrainPhlan, and its memory usage was well within the range of modern cluster systems or powerful personal computers (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S9). Another key advantage of StrainGE over the other tools is its ability to link a strain in a sample to its specific close reference genome reported by StrainGST, which places an observed strain within the known phylogenetic structure of the reference database (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S10). In contrast, the SNV profiles outputted by StrainPhlan (based on marker genes) or MIDAS (compared to a single built in <italic>E. coli</italic> reference) do not offer convenient phylogenetic placement.</p>
      </sec>
    </sec>
    <sec id="Sec70">
      <title>In real metagenomic data, StrainGE identifies low abundance strains and can track strains across samples, including in strain mixtures</title>
      <sec id="Sec7">
        <title>StrainGE can identify lower abundance instances of persistent strains previously undetectable by other tools</title>
        <p id="Par19">In order to assess StrainGE’s utility to characterize strains from real world samples, we examined its performance, using default parameters with our <italic>Escherichia</italic> reference database, on a previously published metagenomic dataset of 27 longitudinally collected stool samples from a patient with Crohn’s disease, upon which MIDAS was run to delineate <italic>E. coli</italic> strains [<xref ref-type="bibr" rid="CR25">25</xref>]. MIDAS identified seven dominant “strain types” (“ST1” – “ST7”) that varied in abundance over time. Each of these belonged to a distinct multi-locus sequence type (MLST) and represented one of five <italic>E. coli</italic> phylogroups. StrainGE showed good concordance with results from MIDAS for all high abundance strains (&gt; 10% abundance) (Table <xref rid="Tab2" ref-type="table">2</xref>). For the two calls that disagreed, our StrainGST database lacked representatives for the two MLSTs reported by MIDAS. However, StrainGE selected the next closest reference, which we confirmed by comparing the whole genome sequence from a cultured representative of ST1 [<xref ref-type="bibr" rid="CR25">25</xref>] to our reference database.<table-wrap id="Tab2"><label>Table 2</label><caption><p>The strains predicted by MIDAS match the dominant strains predicted by StrainGE</p></caption><table frame="hsides" rules="groups"><thead><tr><th rowspan="2">Strain (time points)</th><th colspan="2">MIDAS<sup><bold>a</bold></sup></th><th colspan="3">StrainGST</th></tr><tr><th>MLST</th><th><bold><italic>E. coli</italic></bold> phylogroup</th><th>MLST</th><th><bold><italic>E. coli</italic></bold> phylogroup</th><th>Most abundant strain</th></tr></thead><tbody><tr><td><bold>ST1</bold> (1)</td><td>95</td><td>B2</td><td>95</td><td>B2</td><td>PA45B<sup>b</sup></td></tr><tr><td><bold>ST2</bold> (2)</td><td>1629<sup>c</sup></td><td>E</td><td>1011</td><td>E</td><td>Santai</td></tr><tr><td><bold>ST3</bold> (3,4)</td><td>69</td><td>D</td><td>69</td><td>D</td><td>118UI</td></tr><tr><td><bold>ST4</bold> (11-18)</td><td>58</td><td>B1</td><td>58</td><td>B1</td><td>D5</td></tr><tr><td><bold>ST5</bold> (19-22, 27)</td><td>131</td><td>B2</td><td>131</td><td>B2</td><td>MVAST0167</td></tr><tr><td><bold>ST6</bold> (23,24)</td><td>409<sup>c</sup></td><td>A</td><td>1408</td><td>A</td><td>AR_0061</td></tr><tr><td><bold>ST7</bold> (25,26)</td><td>1727</td><td>B1</td><td>1727</td><td>B1</td><td>2011C-3911</td></tr></tbody></table><table-wrap-foot><p><sup>a</sup>Fang et al. [<xref ref-type="bibr" rid="CR25">25</xref>]</p><p><sup>b</sup>The actual strain corresponding to ST1 (3_2_53FAA) was whole-genome sequenced by Fang et al. PA45B and 3_2_53FAA share 99.9% average nucleotide identity based on whole-genome comparative genomics analysis</p><p><sup>c</sup>MLST profile was not represented by any reference genome in the StrainGE database. StrainGST predicted the closest reference within the StrainGE database, which was within the same phylogroup</p></table-wrap-foot></table-wrap></p>
        <p id="Par20">StrainGST also identified seven distinct strains that were missed by MIDAS (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a). While the majority of these were secondary strains found to coexist with a dominant strain predicted by MIDAS, StrainGST also predicted strains at time points where MIDAS called none (time points 6–10). In most of these cases, the strains were at ≤ 1% relative abundance and were also detected by MIDAS at higher abundance in other time points (e.g., ST3; dark green), lending credence to their existence in these samples and suggesting that some strains were more persistent over time than previously predicted (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a).<fig id="Fig4"><label>Fig. 4</label><caption><p>StrainGE identified previously undetected low-abundance strains in longitudinal samples from an individual with Crohn’s disease. <bold>a</bold> Stacked barplot showing the relative abundances of StrainGST calls for each of 27 longitudinal stool metagenomes from Fang et al [<xref ref-type="bibr" rid="CR25">25</xref>]. Circles indicate the strain detected in Fang et al., colored by its StrainGST counterpart and labeled using the ST designations (ST1-ST7) assigned by Fang et al. Small gray circles indicate samples where no strain was predicted in Fang et al.; these are labeled with “n.d.” <bold>b</bold> Single-copy core phylogeny of the 14 StrainGST reference genomes with close matches to strains across samples. Colors are based on the reference’s clade; see column “Clade”. “Collapsed” column indicates which reference was selected as a representative for subsequent StrainGR analysis, when two or more references shared more than ~ 99.2% ANI. <bold>c</bold> For all sample pairs matching the same collapsed reference, the Jaccard gap similarity index and pairwise ACNI are plotted. Circles indicate comparisons where the predicted reference was the same before collapsing, and diamonds indicate cases where the predicted reference before collapsing was different. Sizes of shapes indicate the percentage of the reference genome that was callable across both strains being compared. Filled in shapes indicate whether this strain instance was undetected by MIDAS. Dark green circles are labeled with the time points compared. <bold>d</bold> Zoomed in view of the upper right corner of <bold>c</bold>)</p></caption><graphic xlink:href="13059_2022_2630_Fig4_HTML" id="MO4"/></fig></p>
        <p id="Par21">We ran StrainGR on all datasets using a concatenated reference including 10 out of 14 total references reported by StrainGST to ensure each genome had at least 20% unique genome content (<xref rid="Sec12" ref-type="sec">Materials and methods</xref>; Fig. <xref rid="Fig4" ref-type="fig">4</xref>b). SNV and gap patterns predicted by StrainGR showed that the majority of strains matching the same reference had strikingly high pairwise ACNI (&gt; 99.96%) and gap similarity (&gt; 0.97) (Fig. <xref rid="Fig4" ref-type="fig">4</xref>c, d), which were within the range of those of same-strain sample pairs in our simulations (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a). However, StrainGR results from strains matching the <italic>E. coli</italic> 118UI (dark green) reference stood out. While 118UI-like strains from samples 3 and 4 had ACNI and gap similarity relationships that were on par with what we observed in same-strain simulations, all other comparisons fell outside of this range, suggesting that this individual carried a mixture of 118UI-like strains in their gut over time that were closely related, but not necessarily the same with respect to gene content and single nucleotide variation (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11).</p>
      </sec>
      <sec id="Sec8">
        <title>StrainGE accurately and sensitively identified a low-abundance, persistent strain of <italic>E. coli</italic> in longitudinal stool samples from a woman with recurrent urinary tract infection</title>
        <p id="Par22">Although the results of StrainGE on the Fang et al. [<xref ref-type="bibr" rid="CR25">25</xref>] dataset highlighted its ability to resolve strains present at low abundance, the overall <italic>E. coli</italic> relative abundances in these samples were significantly higher (median 7.9%; range 0.05–27%) than those typically seen in the human gut. Thus, we also tested StrainGE on 12 stool metagenomes having more typical <italic>E. coli</italic> relative abundances (median 0.55%; range 0.006–17.4%), which originated from a single individual with a history of recurrent urinary tract infection (rUTI) over the span of a year. Given that the gut is a known important reservoir for UTI-causing <italic>E. coli</italic> [<xref ref-type="bibr" rid="CR26">26</xref>], it was of interest to trace gut <italic>E. coli</italic> strain dynamics and their relationship with UTI.</p>
        <p id="Par23">StrainGST detected a total of five distinct strains of <italic>E. coli</italic> (Fig. <xref rid="Fig5" ref-type="fig">5</xref>a), including a recurrent strain detected in over half of samples. The persistent strain, an <italic>E. coli</italic> 1190-like strain from phylogroup D, had a median relative abundance of only 0.6% (range 0–1.2%) and was detected even in samples that were composed of multiple <italic>E. coli</italic> strains, including at very low (20-fold less) abundance relative to another strain (Fig. <xref rid="Fig5" ref-type="fig">5</xref>a). Despite its low abundance, we were able to confirm that all <italic>E. coli</italic> 1190-like strains had extremely high ACNI (&gt; 99.95%) and gap similarity (&gt; 0.98) (Fig. <xref rid="Fig5" ref-type="fig">5</xref>b), in line with the identities observed for same-strain benchmarking (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a), suggesting that this strain, also the causative agent of this individual’s rUTI, persisted long-term in their gut.<fig id="Fig5"><label>Fig. 5</label><caption><p>StrainGE detected a long-term, persistent strain of <italic>E. coli</italic> in a woman with rUTI. <bold>a</bold> Relative abundances predicted by StrainGE are shown for all <italic>E. coli</italic> strains detected. <bold>b</bold> For all sample pairs containing a strain matching to <italic>E. coli</italic> 1190, plot shows pairwise ACNI and gap similarity scores. Size of the circle indicates the percentage of the common callable genome. <bold>c</bold> Zoom in on a region of the chromosome of <italic>E. coli</italic> 1190. Gray shaded areas indicate “callable” regions, where StrainGR had enough read data to make a strong allele call. Predicted gaps are shaded black. The blue line represents the number of SNVs per 1,000 bp, observed in at least 3 samples. <bold>d</bold> Further zoom-in representing a region where StrainGR identified a nonsynonymous SNV that was consistently detected across all 1190-like strains</p></caption><graphic xlink:href="13059_2022_2630_Fig5_HTML" id="MO5"/></fig></p>
        <p id="Par24">Further, StrainGR output enabled us to look closely at the locations and identities of SNVs and genes within gaps relative to the reference. For example, we consistently identified a large gap across all time points encoding a prophage found in the original reference, but apparently lacking in the <italic>E. coli</italic> 1190-like strain in this individual (Fig. <xref rid="Fig5" ref-type="fig">5</xref>c). Using StrainGR output that included both strong and weak variant calls (see Fig. <xref rid="Fig1" ref-type="fig">1</xref>c for strong vs. weak calls; <xref rid="Sec12" ref-type="sec">Materials and methods</xref>), we were able to track 839 variant sites across samples, where the corresponding allele was strongly called in at least one sample, and weakly called in at least five samples (e.g., a nonsynonymous SNV in the gene <italic>cydC</italic>; Fig. <xref rid="Fig5" ref-type="fig">5</xref>d). At each of the 839 variant sites, the called allele was identical across all time points, except for three sites where another secondary weak allele was called, further supporting the persistence of a single UTI-causing strain.</p>
      </sec>
      <sec id="Sec9">
        <title>StrainGE accurately recapitulated known strain-level diversity from metagenomes and traced strains from mother to child</title>
        <p id="Par25">To demonstrate StrainGE’s applicability to other bacterial genera, we selected a previously published dataset investigating the impact of mode of delivery on the infant gut microbiome, including transmission and carriage of opportunistic pathogens from the <italic>Enterococcus</italic> genus [<xref ref-type="bibr" rid="CR27">27</xref>]. Shao et al. longitudinally followed 596 babies (and 175 mothers) by collecting stool samples that were then whole metagenome shotgun sequenced and cultured for pathogens, including 451 enterococci that were then whole genome sequenced. This dataset allowed us to evaluate StrainGE’s ability to report on (i) the relationships between enterococcal strains predicted directly from metagenomes in comparison to those calculated from the genomes of cultured isolates and (ii) mother and child strain sharing. Furthermore, this dataset allowed us to evaluate StrainGE’s ability to predict and compare strains across samples using a sparser database, as there were fewer than a third as many RefSeq complete <italic>Enterococcus</italic> genomes than for <italic>Escherichia</italic>.</p>
        <p id="Par26">We built a 163-member StrainGST database representing references from 80 <italic>E. faecium</italic>, 39 <italic>E. faecalis</italic> and 44 other enterococcal species (<xref rid="Sec12" ref-type="sec">Materials and methods</xref>; Additional file <xref rid="MOESM2" ref-type="media">2</xref>) and ran StrainGE on all 1,679 stool metagenomes. StrainGE identified strain relationships that were very similar to those Shao et al. obtained using bacterial isolate comparisons. For example, the species distributions were roughly similar (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S4) and nearly half (42%) of references predicted by StrainGST belonged to one of the five major <italic>E. faecalis</italic> lineages previously identified (Fig. <xref rid="Fig6" ref-type="fig">6</xref>a). The pairwise ACNI distributions for strains matching these references mirrored the tree topology (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S12), and across the whole data set pairwise ACNI correlated strongly with ANI between corresponding isolates (Pearson’s <italic>r</italic> = 0.96; Fig. <xref rid="Fig6" ref-type="fig">6</xref>b; <xref rid="Sec12" ref-type="sec">Materials and methods</xref>).<fig id="Fig6"><label>Fig. 6</label><caption><p>StrainGE recapitulates strain-diversity among bacterial isolates using metagenomic data only. <bold>a</bold> Single-copy core phylogenetic tree of <italic>E. faecalis</italic> isolates from the UK Baby Biome Study (UK BBS) (<italic>n</italic> = 282) in the context of isolates from other public UK hospitals (<italic>n</italic> = 168), human gut microbiota (<italic>n =</italic> 28), or other environmental sources (<italic>n =</italic> 27). Five major lineages were identified, represented by ST16, ST179, ST30, ST191, and ST40. Tree republished with permission from Shao et al. [<xref ref-type="bibr" rid="CR27">27</xref>]. <bold>b</bold> Scatterplot relating ANI between isolates (x-axis) to StrainGE’s computed ACNI between metagenomes from which the isolates were derived (<italic>y</italic>-axis). <bold>c</bold> Barplot showing StrainGST predicted references and their relative abundances (<italic>y</italic>-axis) for strains present in metagenomic samples from a mother and her child taken over several days (<italic>x</italic>-axis). Strains matching the same reference are shown in the same color. Lines connecting bars are labeled with StrainGR computed ACNI. <bold>d</bold> For all pairs of samples with a strain close to either <italic>E. faecium</italic> DMEA02 (yellow) or <italic>E. faecalis</italic> SF28073 (blue), ACNI (<italic>y</italic>-axis) and gap similarity are plotted (<italic>x</italic>-axis). Circles with a black border represent pairs of samples from the same subject (or its mother). Size of the circle represents the percentage of common callable genome</p></caption><graphic xlink:href="13059_2022_2630_Fig6_HTML" id="MO6"/></fig></p>
        <p id="Par27">Shao et al. used StrainPhlan [<xref ref-type="bibr" rid="CR15">15</xref>] to predict instances of mother-to-child strain sharing, including 7 <italic>E. faecalis</italic> and 2 <italic>E. faecium</italic> transmission events. Though no direct comparison of transmission predictions could be made (sample names were not reported), we hypothesize that StrainGE’s predictions would be more accurate since StrainPhlan’s marker genes covered only 3.6% ± 1.7% of reported <italic>Enterococcus</italic> genomes, while StrainGE’s callable genome was on average 39% ± 33%. Using StrainGE, we identified 17 mother-baby pairs for which StrainGST reported the same reference, of which six had sufficient common callable genome to calculate ACNI. Three pairs had ACNI &lt; 99.7% and three had ACNI near 100%, including an example at 99.999% (Fig. <xref rid="Fig6" ref-type="fig">6</xref>c) suggesting that there were at least three instances of mother-baby strain sharing that we could confidently call based on our “same strain” ACNI threshold of 99.95%. Comparisons of strains matching the same reference from other mothers or babies revealed that they generally had considerably lower ACNI and gap similarity (Fig. <xref rid="Fig6" ref-type="fig">6</xref>d).</p>
      </sec>
    </sec>
  </sec>
  <sec id="Sec10">
    <title>Discussion</title>
    <p id="Par28">The ability to discern strain-level variation from primary specimens—where the species of interest may be at low abundance—can transform our understanding of species populations, ecologies, and transmission patterns. We have shown that our novel tool suite, StrainGE, is easy to use for ultra-sensitive detection of strains in primary specimen metagenomes. StrainGE uses both k-mer and alignment analysis to characterize sample strain genomes, including their (i) closest matching reference, which places them phylogenetically, (ii) relative abundance, and (iii) estimated ANI (ACNI) to other strains, which can be achieved even at very low coverage levels, with more detailed information about specific variants and cross-sample comparisons becoming available as coverage increases. StrainGE can provide nucleotide level resolution for individual bacterial strains or strain mixes that are present at 0.1% relative abundance, e.g., 0.5x coverage for a 5 Mb genome within 3Gb of sequencing reads. StrainGE provides a substantial advance over previously published tools, which (i) were not designed to work at these low coverages [<xref ref-type="bibr" rid="CR16">16</xref>], (ii) report only overall consensus SNV profiles for a mixture [<xref ref-type="bibr" rid="CR14">14</xref>, <xref ref-type="bibr" rid="CR15">15</xref>], or (iii) do not offer nucleotide-level resolution [<xref ref-type="bibr" rid="CR9">9</xref>–<xref ref-type="bibr" rid="CR11">11</xref>].</p>
    <p id="Par29">In addition to demonstrating good performance on an extensive array of benchmarking samples, we showed that StrainGE provided insights into the strain-level dynamics of bacteria in three real-world sample sets. For a patient with Crohn’s disease, StrainGE identified co-existing strains and strains at time points missed by another popular strain-tracking tool. StrainGE similarly was used to identify the long-time gut carriage of a low abundant UTI-causing <italic>E. coli</italic> strain, which we could track via stereotypical gene absence and SNP patterns, reported by StrainGE, that could be discerned even when other strains were present. Finally, using metagenomic data from primary stool specimens, StrainGE was able to recapitulate relationships among <italic>E. faecalis</italic> previously observed using whole genome sequencing of isolates and phylogenetic reconstruction, as well as provide strong evidence for transmission of <italic>E. faecium</italic> strains from mothers to their children. For this vignette, we used an ACNI threshold that we empirically determined to represent the same strain from in silico experiments. However, the measures that define “same” versus “different” strains will depend upon the research question and the species being evaluated [<xref ref-type="bibr" rid="CR7">7</xref>]. StrainGE provides a compendium of outputs for assessing relationships between strains in detail, which can be used to evaluate appropriate thresholds for any system.</p>
    <p id="Par30">While we demonstrated StrainGE on a narrow set of bacterial species, StrainGE is designed to be broadly applicable to any genus or species, with a wide range of database sizes. While a dense database is generally preferred because the accuracy of variant calls improves with genetically closer references [<xref ref-type="bibr" rid="CR22">22</xref>], our benchmarking showcased that StrainGST and StrainGR combined can return accurate information about strain relationships, even when few reference genomes are available. Furthermore, the default database clustering threshold of 99.8% is tunable to adjust for the number of references StrainGST considers since, for example, a very dense database could cause StrainGST to report different, but closely related references for two samples containing the same strain. To balance these two factors, we included a tool “prepare-ref” in the StrainGE suite, which performs an additional coarser round of clustering of StrainGST-determined references for a set of samples in order to select a smaller set of representatives prior to running StrainGR. This step increases the total amount of unique content across references to be considered in ACNI calculations and enables direct comparisons of more strains with respect to their nucleotide and gap similarities.</p>
    <p id="Par31">While StrainGST and StrainGR were designed to work together, both tools can work in isolation and provide useful standalone output. StrainGST with a dense database can provide fast phylogenetic placement of strains. Though not shown here, this also works on whole genome sequence data from bacterial isolates, providing a quick snapshot of phylogenetic relationships without needing to perform reference alignments or other more time-consuming phylogenomic pipelines. StrainGR could be used without StrainGST when good quality assemblies are available for strains present within a mixed community dataset. For example, long read sequencing and assembly of isolates or even whole metagenomes from a select number of time points could provide high quality substrates for StrainGR evaluations of strains in short read time series data.</p>
    <p id="Par32">Though competitive and filling a niche left behind by other strain-tracking tools, StrainGE has several limitations. It evaluates the relationships between strains using only unique regions of reference genomes, is unable to detect new genes that occur in strain genomes that are not present in its closest matching reference, and currently only works with Illumina data. Furthermore, StrainGE is currently not designed to phase SNVs from multiple strains matching the same reference in the same sample. In this case, StrainGR will output evidence for multiple alleles, but the frequencies of which cannot be robustly compared to link alleles together at the coverages under which StrainGE was designed to operate.</p>
  </sec>
  <sec id="Sec11">
    <title>Conclusions</title>
    <p id="Par33">Here, we present StrainGE, a novel suite of tools to characterize conspecific strains in complex microbial communities. We have demonstrated its accuracy using benchmarks and have shown that it represents a major advance over other published tools. Using three clinical metagenomic time series, we demonstrated its ability to yield insights into biological systems that previous tools could not, including the persistence of low-abundance strains across time. StrainGE’s sensitivity at very low coverages (0.1x and higher) will help to accelerate our understanding of the role of strain-level variation in shaping ecological and disease processes.</p>
    <p id="Par34">StrainGE is installable through bioconda and available at <ext-link ext-link-type="uri" xlink:href="https://github.com/broadinstitute/strainge">https://github.com/broadinstitute/strainge</ext-link>.</p>
  </sec>
  <sec id="Sec12">
    <title>Materials and methods</title>
    <sec id="Sec13">
      <title>Strain Genome Explorer toolkit algorithms</title>
      <sec id="Sec14">
        <title>StrainGST: Strain Genome Search Tool</title>
        <p id="Par35">StrainGST is a k-mer based tool used to identify specific strain(s) of a species in a metagenomic sample. StrainGST computes a reference database of previously sequenced strains from this species and uses it to report close reference genomes to strains present in a metagenomic sample along with their relative abundances. The references reported by StrainGST can be used as input to StrainGR to further characterize genetic variation found within the metagenomic sample.</p>
        <sec id="FPar1">
          <title>Creating a StrainGST database</title>
          <p id="Par36">A StrainGST database is constructed from a set of high quality sequenced reference genomes for a single species or genus, such as all complete reference genomes in NCBI RefSeq. From this set of genomes, StrainGST generates a database of k-mer profiles, using a sliding window (window size k) to traverse each genome and count the frequency of each k-mer. To reduce memory usage and computation time, a minhash technique (similarly to Mash [<xref ref-type="bibr" rid="CR20">20</xref>]) is applied to keep 1% of the k-mers with the lowest hashes.</p>
          <p id="Par37">StrainGST next performs clustering to remove highly similar genomes from the reference set. In order to track and compare genomic variation across related samples, StrainGR must be able to align reads to a common reference genome across different sample sets. Therefore, the references reported by StrainGST should not be too closely related, or each sample could end up matching distinct yet closely related references, making comparisons difficult. StrainGST computes pairwise Jaccard similarities using each reference genome’s k-mer set, performing single linkage clustering using a Jaccard similarity threshold of <italic>τ</italic>, and picking a single representative genome for each cluster to include in the reference set. StrainGST selects the genome with the highest mean similarity to all other genomes in that cluster. This process ensures that the k-mer similarities between remaining genomes in the database are all lower than <italic>τ</italic>. Additionally, to remove genomes from the database that are highly similar to another genome, but that may have lower Jaccard similarity due to the presence of large indels, StrainGST removes genomes where 99% or more k-mers overlapped with those from another genome.</p>
        </sec>
        <sec id="FPar2">
          <title>Identifying strains present in a sample</title>
          <p id="Par38">StrainGST uses this database to identify the closest reference genome(s) to the strain(s) present within a sample (Fig. <xref rid="Fig1" ref-type="fig">1</xref>). First, all reads in the sample are k-merized, resulting in the k-mer set <italic>K</italic><sub><italic>sample</italic></sub>. The algorithm then selects for k-mers from the species of interest by taking the intersection between the sample k-mer set and that of the reference database for the species of interest (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b), excluding k-mers not associated with the target species.</p>
          <p id="Par39">StrainGST then uses these k-mers to identify the reference genome(s) with the best k-mer matches to the sample using an iterative process. In each iteration, StrainGST scores each reference genome in the database against the remaining k-mers in <italic>K</italic><sub><italic>sample</italic></sub> in order to find the reference with the best score, which is reported to the user as the reference with the strongest evidence of being present. The scoring system is described in detail below. If no reference strain is identified that scores above a threshold <italic>θ</italic> (adjustable by a command line option), the algorithm is terminated. The default value for <italic>θ</italic> (0.02) was optimized to maximize sensitivity while minimizing false positives. In each iteration, k-mers corresponding to the reference selected are removed from the sample k-mer set in order to enable identification of secondary strains in the next iteration. This process continues until either no strain is reported or the maximum number of iterations is reached (default of 5).</p>
        </sec>
        <sec id="FPar3">
          <title>Scoring metric for selecting matching reference strains</title>
          <p id="Par40">To determine which reference strain to report in each iteration, we calculate a score for each reference strain using a combination of three metrics based on (1) the fraction of matching k-mers in the reference, (2) the fraction sample k-mer counts that could be explained by this reference genome, and (3) the evenness of the distribution of matching k-mers across the genome.<list list-type="order"><list-item><p id="Par41">Fraction of matching k-mers in the reference (<italic>ƒ</italic>)</p></list-item></list></p>
          <p id="Par42">This metric represents the fraction of distinct k-mers in reference <italic>j</italic> that is present in the sample and has a value between 0 and 1, where 1 would indicate all k-mers of this reference are present in this sample.<disp-formula id="Equa"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\begin{array}{c}{K}^{\prime }={K}_{sample}\cap {K}_j,\\ {}f=\frac{\mid {K}^{\prime}\mid }{\mid {K}_j\mid }.\end{array}}$$\end{document}</tex-math><mml:math id="M2" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi mathvariant="italic">sample</mml:mi></mml:mrow></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mrow/><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>∣</mml:mo><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>∣</mml:mo></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∣</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2630_Article_Equa.gif" position="anchor"/></alternatives></disp-formula></p>
          <p id="Par43"><italic>K</italic><sub><italic>sample</italic></sub> represents all k-mers in the sample, <italic>K</italic><sub><italic>j</italic></sub> represents all k-mers in reference <italic>j</italic>, and <italic>K</italic><sup>′</sup> represents the set of k-mers both present in the reference and in the sample.<list list-type="simple"><list-item><label>2)</label><p id="Par44">Fraction of sample k-mer counts that could be explained by this reference (<italic>ɑ</italic>)</p></list-item></list></p>
          <p id="Par45">To give more weight to reference genomes that are similar to higher abundance strains in the sample, StrainGST calculates the fraction of database k-mers remaining in the sample that could be explained by the k-mers in this reference:<disp-formula id="Equb"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$a=\frac{\sum_{i\in K\prime }{c}_i}{\sum_{i\in {K}_{sample}}{c}_i}.$$\end{document}</tex-math><mml:math id="M4" display="block"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mi>K</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi mathvariant="italic">sample</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math><graphic xlink:href="13059_2022_2630_Article_Equb.gif" position="anchor"/></alternatives></disp-formula></p>
          <p id="Par46"><italic>c</italic><sub><italic>i</italic></sub> represents the count of k-mer <italic>i</italic> in the sample. Note that we include k-mer counts, rather than using the fraction of <italic>distinct</italic> k-mers, which gives more weight to reference strains with high average depth of coverage. This metric has a value between 0 and 1.<list list-type="simple"><list-item><label>3)</label><p id="Par47">Evenness (<italic>e</italic>)</p></list-item></list></p>
          <p id="Par48">To quantify whether the matching k-mers are evenly distributed across the reference genome, rather than being found predominantly in a small region (e.g., due to a horizontal gene transfer event, or conserved regions attracting reads from different species), we defined the <italic>evenness</italic> score. First, we assumed that the coverage across the genome follows a Poisson distribution. The rate parameter <italic>λ</italic><sub><italic>j</italic></sub> of the Poisson distribution specifies the average depth of coverage across the whole genome:<disp-formula id="Equc"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\lambda}_j=\frac{1}{\mid {K}_j\mid}\sum_{i\in {K}_j}\frac{c_i}{d_{ij}}$$\end{document}</tex-math><mml:math id="M6" display="block"><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∣</mml:mo></mml:mrow></mml:mfrac><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mfrac><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="13059_2022_2630_Article_Equc.gif" position="anchor"/></alternatives></disp-formula></p>
          <p id="Par49">Here, <italic>c</italic><sub><italic>i</italic></sub> represents the count of k-mer <italic>i</italic> in the sample, and <italic>d</italic><sub><italic>ij</italic></sub> represents the count of k-mer <italic>i</italic> in reference strain <italic>j</italic>.</p>
          <p id="Par50">If <italic>X</italic> is the random variable that indicates how many reads cover a position, then using the Poisson distribution, the probability of observing <italic>x</italic> reads at a position is:<disp-formula id="Equd"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$P\left(X=x\right)=\frac{\lambda_j^x\exp \left(-{\lambda}_j\right)}{x!}$$\end{document}</tex-math><mml:math id="M8" display="block"><mml:mrow><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mi>x</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>j</mml:mi><mml:mi>x</mml:mi></mml:msubsup><mml:mo>exp</mml:mo><mml:mfenced close=")" open="("><mml:mo>-</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mfenced></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>!</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="13059_2022_2630_Article_Equd.gif" position="anchor"/></alternatives></disp-formula></p>
          <p id="Par51">The probability of observing 0 reads at a position is then <italic>P</italic>(<italic>X</italic> = 0) = exp(−<italic>λ</italic><sub><italic>j</italic></sub>). The probability of observing at least one read at a position is [<xref ref-type="bibr" rid="CR28">28</xref>]:<disp-formula id="Eque"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$P\left(X&gt;0\right)=1-P\left(X=0\right)=1-\exp \left(-{\lambda}_j\right)$$\end{document}</tex-math><mml:math id="M10" display="block"><mml:mrow><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mi>X</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mfenced><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mfenced><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mo>exp</mml:mo><mml:mfenced close=")" open="("><mml:mo>-</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="13059_2022_2630_Article_Eque.gif" position="anchor"/></alternatives></disp-formula></p>
          <p id="Par52">This probability also represents the expected fraction of the genome covered by at least one read given a certain average depth of coverage. The evenness score describes how well the observed fraction of the genome covered by at least one read (which is estimated using the fraction of matching k-mers in the reference defined earlier) matches the expected fraction of the genome covered by at least one read when assuming a Poisson distribution for the depth of coverage:<disp-formula id="Equf"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$e=\frac{f}{1-\exp \left(-{\lambda}_j\right)}$$\end{document}</tex-math><mml:math id="M12" display="block"><mml:mrow><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mi>f</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mo>exp</mml:mo><mml:mfenced close=")" open="("><mml:mo>-</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="13059_2022_2630_Article_Equf.gif" position="anchor"/></alternatives></disp-formula></p>
          <p id="Par53">This score will be close to 1 if the observed fraction of the genome with at least one read matches the expected value for a certain average depth of coverage (assuming a Poisson distribution). It will be closer to zero if only small portions of the genome are well covered. A value higher than 1 indicates that the observed fraction of the genome with at least one read is higher than the expected fraction of the genome with at least one read. To bound this score between 0 and 1, StrainGST uses the minimum of <italic>e</italic> and its reciprocal:<disp-formula id="Equg"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${e}^{\prime }=\min \left(e,\frac{1}{e}\right)$$\end{document}</tex-math><mml:math id="M14" display="block"><mml:mrow><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mo movablelimits="true">min</mml:mo><mml:mfenced close=")" open="("><mml:mi>e</mml:mi><mml:mo>,</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>e</mml:mi></mml:mfrac></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="13059_2022_2630_Article_Equg.gif" position="anchor"/></alternatives></disp-formula></p>
          <p id="Par54">Finally, we combined these three metrics together in order to obtain the final score:<disp-formula id="Equh"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$score=f\cdot a\cdot {e}^{\prime 2}$$\end{document}</tex-math><mml:math id="M16" display="block"><mml:mrow><mml:mi>s</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mo>·</mml:mo><mml:mi>a</mml:mi><mml:mo>·</mml:mo><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math><graphic xlink:href="13059_2022_2630_Article_Equh.gif" position="anchor"/></alternatives></disp-formula></p>
          <p id="Par55">At each iteration, the reference strain with the highest score represents the best match to the highest abundant strain remaining in the sample and is reported to the user.</p>
        </sec>
      </sec>
      <sec id="Sec15">
        <title>StrainGR: Strain Genome Recovery</title>
        <p id="Par56">The StrainGR pipeline consists of (1) building a concatenated reference based on reference strains reported by StrainGST, (2) aligning reads to the concatenated reference, (3) analyzing read alignments to call SNVs and large deletions, and (4) using these variant calls to analyze gene content or track strains across multiple samples.</p>
        <sec id="FPar4">
          <title>Preparing a concatenated reference</title>
          <p id="Par57">To analyze a set of related samples together, such as a longitudinal series, StrainGR concatenates a single, unified set of representative references present across the whole dataset. This can facilitate comparisons of alignments or genomic variation across a set of samples, which may contain different strain mixes at different time points. Use of the concatenated reference allows reads with an allele unique to a particular strain to be aligned to the genome of the correct reference strain, thus helping disentangle reads from mixture samples. Genomes from the same species, however, will share conserved genomic regions (<italic>i.e.</italic>, housekeeping and other core genes), where the aligner will be unable to place reads unambiguously within the concatenated reference. StrainGR detects and excludes these conserved regions from variant calling.</p>
          <p id="Par58">In order to minimize conserved regions where StrainGR is unable to call variants, it is important to select a set of reference strains that are not too closely related, which could result in a large fraction of the concatenated reference genome being marked as shared. To construct a concatenated set of references with an optimal degree of similarity, StrainGR includes a tool called prepare-ref that analyzes StrainGST output from a set of samples (e.g., a longitudinal set from a single patient) and generates a concatenated reference ready for use with StrainGR, optionally performing another round of clustering at a stricter threshold to prevent too-closely related genomes from being included. By default, the stricter clustering threshold is set to a Jaccard similarity of 0.7 (~ 99.2% estimated ANI).</p>
        </sec>
        <sec id="FPar5">
          <title>Read alignment and filtering</title>
          <p id="Par59">The reads from a metagenomic sample are then aligned to the concatenated reference using BWA-MEM [<xref ref-type="bibr" rid="CR29">29</xref>], removing read pairs with (1) improper pairing, (2) clipped alignment, or (3) implied insert size smaller than the read length. In order to identify shared regions within the concatenated reference which should be excluded from variant calling, StrainGR tracks the number of “multi-mappable” read alignments (those which map equally well at multiple locations) at each position in the reference. When the majority of aligned reads at a position are multi-mappable, StrainGR excludes this position from variant calling. We rely on BWA’s “XA” SAM tag to obtain a read’s alternative alignment locations, so aligners other than BWA are not currently supported by StrainGR.</p>
          <p id="Par60">In addition to excluding multi-mappable regions, StrainGR also excludes regions with abnormally high coverage (greater than threshold <italic>τ</italic>), likely due to genes highly conserved across genera which attract nonspecific reads from other members of the microbial community. <italic>τ</italic> was chosen such that the probability of observing a depth of coverage higher than <italic>τ</italic> is 1 × 10<sup>−7</sup> assuming a Poisson distribution. This value results in a threshold of 10x coverage when the mean coverage depth across the genome is 1x, and a threshold of 20x when the mean is 5x.</p>
        </sec>
        <sec id="FPar6">
          <title>SNV calling</title>
          <p id="Par61">StrainGR analyzes read alignments to identify single-nucleotide variants (SNVs) between a specific strain within a metagenomic sample and its closest reference genome identified by StrainGST. To filter likely sequencing errors, bases with an Illumina Phred base quality score &lt; 5 are ignored by default. An allele is considered strong if the sum of base quality scores supporting that allele is (i) higher than 50 (roughly equivalent to having at least two high-quality supporting reads) and (ii) at least 10% of the total sum of base quality scores of all alleles at that genomic position. If an allele is present but doesn’t match these criteria, it is considered weak. StrainGR stores weak evidence for use when tracking a strain across multiple samples—if a particular strain is highly abundant in some samples, with many strong SNP calls, then weak calls can be useful to discern that allele in low abundance samples from the same sample set.</p>
          <p id="Par62">Based on the observed alleles, StrainGR classifies a genomic position as either “reference confirmed,” “SNV” or “multiple alleles.” If a position has a single strong allele call, and that allele is the same as the reference, the position is classified as “reference confirmed.” A position with a single strong allele call that is different from the reference is classified as a SNV. Any position with multiple strong allele calls (whether they match the reference or not) is classified as “multiple alleles.”</p>
          <p id="Par63">To estimate the overall degree of similarity between the strain in the sample and its closest reference, StrainGR computes an estimate of average nucleotide identity (ANI) using StrainGR SNV calls: the average callable nucleotide identity (ACNI) is the percentage of positions marked as “reference confirmed” out of all positions with a single strong allele call.</p>
        </sec>
        <sec id="FPar7">
          <title>Large deletion predictions</title>
          <p id="Par64">StrainGR also analyzes the read alignments to identify large deletions present in a specific strain within a sample, as compared to its closest reference identified by StrainGST. Consecutive positions in the reference genome over a specified length (by default 5000 bp; ~ 2 genes) with no aligned reads could indicate a large deletion. To account for situations with low coverage across the genome (&lt; 1x), StrainGR employs a simple heuristic that exponentially scales the threshold for the length of such regions at lower coverages; thus, only longer gaps can be detected at lower coverages. If <italic>λ</italic> is the average depth of coverage along the genome, and <italic>ϕ</italic> is the unadjusted threshold, then the adjusted minimum size of a “gap” is:<disp-formula id="Equi"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\phi}^{\prime }=\frac{\phi }{1-\exp \left(-\lambda \right)}$$\end{document}</tex-math><mml:math id="M18" display="block"><mml:mrow><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mi>ϕ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mo>exp</mml:mo><mml:mfenced close=")" open="("><mml:mo>-</mml:mo><mml:mi>λ</mml:mi></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="13059_2022_2630_Article_Equi.gif" position="anchor"/></alternatives></disp-formula></p>
          <p id="Par65">Large deletions are used to assess whether particular genes are absent from the strain in a sample. In addition, the overall pattern of deletions across the genome for the strain in a longitudinal sample set can be used as a strain “fingerprint” to track a particular strain across samples.</p>
        </sec>
        <sec id="FPar8">
          <title>Strain comparisons across samples</title>
          <p id="Par66">To assess whether the strains in two samples are the same (or very closely related), we compare both SNV calls (via pairwise ACNI) and patterns of large deletions. StrainGR calculates pairwise ACNI by dividing the number of positions where both samples have the same strong allele by the total number of positions where both samples have a single strong allele. To compare the pattern of predicted deletions between two samples, StrainGR calculates the Jaccard similarity: if <italic>G</italic><sub>1</sub> is the set of positions <italic>not</italic> marked as a large deletion in sample 1, and <italic>G</italic><sub>2</sub> is the set of positions <italic>not</italic> marked as a large deletion in sample 2, then the gap similarity <italic>l</italic> is defined as<disp-formula id="Equj"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l=\frac{\mid {G}_1\cap {G}_2\mid }{\mid {G}_1\cup {G}_2\mid }$$\end{document}</tex-math><mml:math id="M20" display="block"><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>∣</mml:mo></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>∪</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>∣</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="13059_2022_2630_Article_Equj.gif" position="anchor"/></alternatives></disp-formula></p>
          <p id="Par67">Benchmarking StrainGE using simulated data and mock communities</p>
        </sec>
      </sec>
      <sec id="Sec16">
        <title>Spiked metagenome generation</title>
        <p id="Par68">Unless otherwise noted, all synthetic metagenomes used for benchmarking were generated as follows: reads were simulated from the relevant genomes using ART [<xref ref-type="bibr" rid="CR30">30</xref>] and merged with reads subsampled from a genuine metagenomic data set without detectable <italic>E. coli</italic> (accession SRS014613) as per MetaPhlan2 [<xref ref-type="bibr" rid="CR31">31</xref>] and StrainGST<italic>,</italic> up to a fixed depth of 3 Gb. At this depth, strain coverages of 0.1x, 0.5x, 1x, and 10x corresponded to relative abundances of 0.016%, 0.083%, 0.16%, and 1.6%, respectively, assuming a 5 Mb <italic>E. coli</italic> genome.</p>
      </sec>
      <sec id="Sec17">
        <title>StrainGST database for <italic>Escherichia</italic></title>
        <p id="Par69">For construction of the <italic>Escherichia</italic> reference database, all complete <italic>Escherichia</italic> genomes available in NCBI RefSeq were downloaded in July 2019 (929 genomes total; Additional file <xref rid="MOESM2" ref-type="media">2</xref>). All tools required to construct the StrainGST database are included in the StrainGE suite (kmer counting, clustering, and database construction). The full database with 361 <italic>Escherichia</italic> genomes uses 7.3 Gb of disk space.</p>
        <p id="Par70">In order to set StrainGST’s default clustering threshold, we benchmarked its ability to correctly identify single strain and two-strain mixes using the metagenomic spike-in methods described below, using synthetic reads generated from 200 randomly selected <italic>E. coli</italic> genomes spiked into subsets of real metagenomic samples devoid of <italic>E. coli</italic>, to a total of 3 Gb. For the single-strain benchmarks, 200 samples were generated with 10x, 1x, 0.5x, and 0.1x coverage of each of the selected <italic>E. coli</italic> genomes (800 samples total). For the 2-strain mix benchmarks, 100 random 2-strain combinations from the set of 200 selected <italic>E. coli</italic> genomes were spiked in at each combination of 10x, 1x, 0.5x, and 0.1x coverage (10 coverage combinations, 1000 samples total). The 1800 benchmark cases were run using database clustering thresholds of 0.95, 0.90, 0.85, and 0.80 Jaccard k-mer similarity, corresponding to Mash distance ANIs of 99.89%, 99.77%, 99.63%, and 99.49%, respectively. For each threshold, we measured precision, recall, and F1 score for strain identification, with true positives being only those cases in which StrainGST identified the closest reference strain to the true strain as measured by Jaccard k-mer similarity. The clustering threshold of 0.90 generated the best combined results in each of the three metrics (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S5).</p>
      </sec>
      <sec id="Sec18">
        <title>Phylogenetics and MLST typing of genomes in the <italic>Escherichia</italic> reference database</title>
        <p id="Par71">A single copy core (SCC) phylogeny was generated for the entire database of reference genomes. In brief, SynerClust [<xref ref-type="bibr" rid="CR32">32</xref>] was used to generate clusters of orthologous genes (orthogroups). A concatenated alignment was generated for all single-copy, core orthogroups using MUSCLE [<xref ref-type="bibr" rid="CR33">33</xref>]. A phylogenetic tree was constructed using FastTree v2.1.8 [<xref ref-type="bibr" rid="CR34">34</xref>]. Phylogenetic trees were visualized using iTol [<xref ref-type="bibr" rid="CR35">35</xref>].</p>
        <p id="Par72">MLST designations for each reference genome were predicted with the tool mlst (<ext-link ext-link-type="uri" xlink:href="https://github.com/tseemann/mlst">https://github.com/tseemann/mlst</ext-link>). Sequence types reported were based on the Achtman scheme. <italic>E. coli</italic> clade/phylogroup designation was determined using ClermonTyping (<ext-link ext-link-type="uri" xlink:href="https://github.com/A-BN/ClermonTyping">https://github.com/A-BN/ClermonTyping</ext-link>). For cases when there were missing or conflicting results between predicted typing and MASH groups, the clade designation for a given genome was selected based on where it was located in the SCC phylogeny with respect to unambiguous genome to clade designations.</p>
      </sec>
      <sec id="Sec19">
        <title>Creation of four-strain <italic>E. coli</italic> mock community</title>
        <p id="Par73">Four phylogenetically distinct <italic>E. coli</italic> strains—H10407 (clade A), E24337A (clade B1), UTI89 (clade B2), and Sakai (clade E)—were cultured separately overnight at 37 °C in 2 mL of liquid LB media shaking at 200 rpm. The bacterial number in each culture was estimated via optical density and then combined at a ratio of 80% H10407, 15% UTI89, 4.9% Sakai, and 0.1% E24337A. Genomic DNA was then extracted from this mock community using the Qiagen MagAttract DNA Isolation Kit (Hilden, Germany), following manufacturer’s protocols. In two separate tubes, human genomic DNA was then added to the extracted <italic>E. coli</italic> DNA for final ratios of 99% human/1% <italic>E. coli</italic> (weight/weight). Sequencing data for this mock community has been submitted to NCBI’s Sequence Read Archive (SRA) under bioproject PRJNA685748 (biosample SAMN17091845).</p>
      </sec>
      <sec id="Sec20">
        <title>Comparison of tools for tracking specific strains across samples using simulated sets of related samples</title>
        <p id="Par74">We compared the ability of StrainGE, StrainPhlan [<xref ref-type="bibr" rid="CR15">15</xref>], and MIDAS [<xref ref-type="bibr" rid="CR14">14</xref>] to track strains across samples. We performed strain tracking comparisons across ten sets of twelve spiked metagenomes, where each set of twelve was structured similarly in terms of strain content (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a, b). For each set, we randomly picked two <italic>Escherichia</italic> reference genomes (A and B) from NCBI RefSeq complete and derived two different but closely related synthetic strains from each reference by introducing ~ 5000 random SNVs (99.9% ANI) uniformly across the genome. We spiked reads generated from these synthetic genomes into a real metagenome to generate samples containing these strains in different combinations (Fig. <xref rid="Fig2" ref-type="fig">2</xref>b), at 0.1x, 0.5x, 1x, and 10x coverage.</p>
        <p id="Par75">For each data set, we assessed strain similarity metrics calculated by each tool, to determine whether the tool could match (i) the identical strain found in different samples (i.e., strain A in sample 1 and 2; Fig. <xref rid="Fig2" ref-type="fig">2</xref>c), (ii) strains found either in mixtures or single-isolate samples (i.e., strain A in sample 1, 2, 5, and 6; Fig. <xref rid="Fig2" ref-type="fig">2</xref>d), or (iii) closely related strains (i.e., the ability to distinguish strain A1 from strain A2; Fig. <xref rid="Fig2" ref-type="fig">2</xref>e). In each case, we compared the tools’ predictions to the known strain content of each sample to calculate true positives (TP), false positives (FP), and false negatives (FN). For each tool, we varied the threshold (discussed in detail below) for determining shared strains in order to plot precision-recall curves.</p>
        <sec id="FPar9">
          <title>Detecting shared strains using StrainGE</title>
          <p id="Par76">For each sample, we ran the complete StrainGE pipeline: StrainGST was run to identify the closest reference genomes, and StrainGR was run on a sample-specific concatenated reference to call genetic variation. To detect shared strains, we collected all samples predicted to match to the same StrainGST reference and computed a pairwise ACNI matrix for strain comparisons with at least a 0.5% callable genome. The similarity matrix was transformed to a distance matrix by computing 1 − <italic>ACNI</italic>, and transformed to a genetic distance using the Jukes-Cantor model [<xref ref-type="bibr" rid="CR36">36</xref>]. If a pair of samples did not share any predicted close reference genomes, we set the distance between those samples to the maximum integer value. To plot the precision-recall curve, we varied the genetic distance threshold that determines when strains are considered the same.</p>
        </sec>
        <sec id="FPar10">
          <title>Detecting shared strains with StrainPhlan</title>
          <p id="Par77">We ran StrainPhlan on each sample, using the tool’s marker gene database v295 (Jan 2019). Using the marker gene SNV profiles for each sample, StrainPhlan computed the pairwise sample distance matrix using Kimura’s two parameter model [<xref ref-type="bibr" rid="CR37">37</xref>] (as suggested in their user manual). To plot the precision-recall curve, we varied the genetic distance threshold that determines when samples share a strain, as performed for StrainGE. To tune StrainPhlan for lower coverage levels, we ran it using --relaxed-parameters.</p>
        </sec>
        <sec id="FPar11">
          <title>Detecting shared strains with MIDAS</title>
          <p id="Par78">We ran MIDAS v1.3.2 (database version v1.2) with default parameters. MIDAS includes a strain tracking tool that is first “trained” by giving it a single sample from each patient in a cohort. This training step identifies unique SNV markers for each patient. For our benchmarking, we “trained” MIDAS on samples containing a single strain (sample 1 for strain A1, sample 3 for strain B1, sample 7 for strain A2, and sample 9 for strain A2). (This likely helped the tool in benchmarking since, in a real world scenario, it is likely unknown whether a training sample contains a single strain.) Next, MIDAS compares these SNV markers to alleles in other samples and assesses how much they overlap. To plot precision-recall curves, we varied the percentage of overlapping markers between two samples that serves as a threshold to determine whether two samples share a strain. To tune MIDAS for lower coverage levels we ran its merge_snvs.py script with --all_snvs --all_samples and its strain_tracking.py script with --min_reads 1.</p>
        </sec>
      </sec>
      <sec id="Sec21">
        <title>Evaluating the ability of StrainGR to quantify strain sharing in distinct metagenomic backgrounds</title>
        <p id="Par79">In order to determine how well StrainGE metrics recapitulated genetic relationships between strains, we generated another set of spiked metagenomic samples, spiked with varying quantities of <italic>E. coli</italic> reads from real, previously sequenced isolates. Ten stool metagenomes were randomly selected from the Human Microbiome Project [<xref ref-type="bibr" rid="CR5">5</xref>] (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S3). The randomly selected samples contained <italic>E. coli</italic> at relative abundances between 0.005% and 0.9%; no two samples contained the same <italic>E. coli</italic> strain based on StrainGST output. Ten complete genome sequences of <italic>E. coli</italic> isolates, distinct from those identified in the background metagenomes, were selected from NCBI RefSeq database. For each isolate, ten variants were created by generating random mutations, such that the ANI to the original reference ranged from 99.9% to 99.99% at increments of 0.01%. Each reference and variant (110 in total) were spiked into at least two randomly chosen distinct metagenomic backgrounds at coverage levels of 0.1x, 0.5x, 1x, 2x, or 5x. A total of 300 synthetic samples were generated, with 350 pairs containing an identical strain in a distinct background. All spiked samples were analyzed with StrainGE; all sample pairs with a matching StrainGST reference were compared using StrainGR. StrainGST hits corresponding to strains present in background samples were not considered further. The ACNI was calculated for every pair.</p>
      </sec>
    </sec>
    <sec id="Sec22">
      <title>Evaluation of StrainGE on longitudinal, clinical metagenomic samples</title>
      <sec id="Sec23">
        <title>Metagenomic time series from a patient with Crohn’s disease</title>
        <p id="Par80">We downloaded from the UCSD Qiita database (<ext-link ext-link-type="uri" xlink:href="https://qiita.ucsd.edu/">https://qiita.ucsd.edu/</ext-link>; Additional file <xref rid="MOESM3" ref-type="media">3</xref>) 27 metagenomic data sets representing stool longitudinally collected from a single individual with Crohn’s Disease [<xref ref-type="bibr" rid="CR25">25</xref>]. We ran the full StrainGE pipeline on each sample, using our <italic>Escherichia</italic> database and default parameters, to identify and analyze <italic>E. coli</italic> strains. For StrainGR, to ensure each genome had sufficient unique content, we constructed a concatenated reference using StrainGE’s builtin prepare-ref tool, which performed another round of clustering of the StrainGST reported references at a default threshold of 99.2% ANI. The resulting reference contained 10 out of 14 total reported references (Fig. <xref rid="Fig4" ref-type="fig">4</xref>b; phylogroup G, B2 and A). For pairwise strain comparisons, we only included samples where the common callable percentage of the genome was &gt; 0.5%.</p>
      </sec>
      <sec id="Sec24">
        <title>Metagenomic sequencing of longitudinally collected stool</title>
        <p id="Par81">Twelve longitudinally collected stool samples were extracted with Chemagen Kit CMG-1091 (Baesweiler, Germany). Libraries were generated with NexteraXT (Illumina, San Diego, CA, USA) and sequenced in paired-end mode on an Illumina HiSeq 2500 (101 bp length) and/or Illumina HiSeq X10 (151 bp length). Short-read sequencing data was submitted to the Sequence Read Archive (SRA) with Bioproject accession <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/bioproject/PRJNA400628">PRJNA400628</ext-link> (Additional file <xref rid="MOESM3" ref-type="media">3</xref>). We ran the full StrainGE pipeline on each sample, using our <italic>Escherichia</italic> database and default parameters, to identify and analyze <italic>E. coli</italic> strains. For pairwise strain comparisons, we only included samples where the common callable percentage of the genome was &gt; 0.5%.</p>
      </sec>
      <sec id="Sec25">
        <title>Characterization of <italic>Enterococcus</italic> strain diversity across a large cohort of babies</title>
        <p id="Par82">We downloaded data from by Shao et al. [<xref ref-type="bibr" rid="CR27">27</xref>] from ENA, including 1679 metagenomes (accession ERP115334) and all isolate samples tagged as <italic>Enterococcus</italic> (accession ERP024601). We ran StrainGE on each metagenomic sample, using our <italic>Enterococcus</italic> database. To compare StrainGE’s ACNI to true ANI between the corresponding isolate genomes, we ran StrainGST on the raw isolate reads to identify a close reference genome, aligned the isolate reads to this reference using BWA-MEM [<xref ref-type="bibr" rid="CR29">29</xref>], and used Pilon [<xref ref-type="bibr" rid="CR38">38</xref>] to call variants. To compute the ANI between each pair of isolates that matched the same reference, we compared reference and alternative alleles called by Pilon where both samples had a single base call. For pairwise strain comparisons using StrainGR in the corresponding metagenomic samples, we only included pairs with a common callable genome &gt; 0.5%.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Information</title>
    <sec id="Sec26">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="13059_2022_2630_MOESM1_ESM.docx">
            <caption>
              <p><bold>Additional file 1.</bold> Supplementary Tables, Figures and Text.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="13059_2022_2630_MOESM2_ESM.xlsx">
            <caption>
              <p><bold>Additional file 2.</bold> Identifiers of genomes in the Escherichia and Enterococcus StrainGST reference databases.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="13059_2022_2630_MOESM3_ESM.xlsx">
            <caption>
              <p><bold>Additional file 3.</bold> Identifiers of clinical gut microbiome datasets.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="13059_2022_2630_MOESM4_ESM.docx">
            <caption>
              <p><bold>Additional file 4.</bold> Review history.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>Lucas R. van Dijk and Bruce J. Walker are co-first authors.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>We would like to thank Christopher Desjardins, Theodore Pak, Wen-Chi Chou, Rauf Salamzade, and Ryan Bronson for helpful discussions.</p>
    <sec id="FPar12">
      <title>Peer review information</title>
      <p id="Par83">Andrew Cosgrove was the primary editor of this article and managed its editorial process and peer review in collaboration with the rest of the editorial team.</p>
    </sec>
    <sec id="FPar13">
      <title>Review history</title>
      <p id="Par84">The review history is available as Additional file <xref rid="MOESM4" ref-type="media">4</xref>.</p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>BJW, CAD, TA, and AME conceived the tool. LvD, BJW, and TJS built the StrainGE software. LvD, BJW, TJS, CJW, AG, and CA performed benchmarking analyses. LvD and TJS analyzed real-world metagenomic datasets. HLS, AJP, and SJH created and provided essential reagents. LvD, BJW, TJS, AG, ALM, TA, and AME drafted the manuscript. All authors edited and approved the manuscript.</p>
    <sec id="FPar14">
      <title>Authors’ information</title>
      <p id="Par85">Twitter handles: @lucasvandijk (Lucas R. van Dijk), @w1bw (Bruce J. Walker), @tstraub89 (Timothy J. Strau), @colinworby (Colin J. Worby), @allie_grote (Alexandra Grote), @HelixIV (Henry L. Schreiber IV), @christinanyansi (Christine Anyansi), @SeqH2O (Amy J. Pickering), @HultgrenLab (Scott J. Hultgren), @ThomasAbeel (Thomas Abeel).</p>
    </sec>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>This project has been funded in part with Federal funds from the National Institute of Allergy and Infectious Diseases, National Institutes of Health, Department of Health and Human Services, under Grant Number U19AI110818 and U01AI095776, and National Institute of Diabetes and Digestive and Kidney Disease, National Institutes of Health, Department of Health and Human Services, under Grant Number R01DK121822.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The data generated and analyzed for this publication is available in SRA, under BioProject accession PRJNA400628 (patient with recurrent UTI), and PRJNA685748 (four <italic>E. coli</italic> strains mock community). The data from an individual with Crohn’s disease was previously published by Fang et al. [<xref ref-type="bibr" rid="CR25">25</xref>] and available on QIITA (Artifact IDs 54476 and 54537). The data analyzed to investigate <italic>Enterococcus</italic> strain diversity in the gut microbiomes of babies was previously published by Shao et al. [<xref ref-type="bibr" rid="CR27">27</xref>] and available from ENA (ERP115334 and ERP024601).</p>
    <p>StrainGE is an open source tool written in Python and C++ released under the BSD 3-clause license, available at <ext-link ext-link-type="uri" xlink:href="https://github.com/broadinstitute/strainge">https://github.com/broadinstitute/strainge</ext-link> [<xref ref-type="bibr" rid="CR39">39</xref>]. StrainGE is built on top of several existing Python libraries, including NumPy [<xref ref-type="bibr" rid="CR40">40</xref>] and SciPy [<xref ref-type="bibr" rid="CR41">41</xref>]. Analysis scripts to generate the figures in this publication are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/broadinstitute/strainge-paper">https://github.com/broadinstitute/strainge-paper</ext-link> [<xref ref-type="bibr" rid="CR42">42</xref>].</p>
  </notes>
  <notes>
    <title>Declarations</title>
    <notes id="FPar15">
      <title>Ethics approval and consent to participate</title>
      <p id="Par86">An adult volunteer with a history of UTI was recruited at Washington University, St. Louis under an IRB-approved protocol (principal investigator, Hing Hung (Henry) Lai). Informed consent was obtained.</p>
    </notes>
    <notes id="FPar16">
      <title>Consent for publication</title>
      <p id="Par87">Not applicable.</p>
    </notes>
    <notes id="FPar17" notes-type="COI-statement">
      <title>Competing interests</title>
      <p id="Par88">BJW is an employee of Applied Invention (Cambridge, MA). No other authors declare competing interests.</p>
    </notes>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Touchon</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Perrin</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>de Sousa</surname>
            <given-names>JAM</given-names>
          </name>
          <name>
            <surname>Vangchhia</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Burn</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>O’Brien</surname>
            <given-names>CL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Phylogenetic background and habitat drive the genetic diversification of Escherichia coli</article-title>
        <source>PLoS Genet</source>
        <year>2020</year>
        <volume>16</volume>
        <issue>6</issue>
        <fpage>e1008866</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pgen.1008866</pub-id>
        <pub-id pub-id-type="pmid">32530914</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pleguezuelos-Manzano</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Puschhof</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Rosendahl Huber</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>van Hoeck</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wood</surname>
            <given-names>HM</given-names>
          </name>
          <name>
            <surname>Nomburg</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mutational signature in colorectal cancer caused by genotoxic pks + E. coli</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>580</volume>
        <issue>7802</issue>
        <fpage>269</fpage>
        <lpage>273</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2080-8</pub-id>
        <pub-id pub-id-type="pmid">32106218</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Leimbach</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hacker</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Dobrindt</surname>
            <given-names>U</given-names>
          </name>
        </person-group>
        <person-group person-group-type="editor">
          <name>
            <surname>Dobrindt</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Hacker</surname>
            <given-names>JH</given-names>
          </name>
          <name>
            <surname>Svanborg</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>E. coli as an All-Rounder: the thin line between commensalism and pathogenicity</article-title>
        <source>Between pathogenicity and commensalism</source>
        <year>2013</year>
        <publisher-loc>Berlin, Heidelberg</publisher-loc>
        <publisher-name>Springer</publisher-name>
        <fpage>3</fpage>
        <lpage>32</lpage>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schreiber</surname>
            <given-names>HL</given-names>
          </name>
          <name>
            <surname>Conover</surname>
            <given-names>MS</given-names>
          </name>
          <name>
            <surname>Chou</surname>
            <given-names>W-C</given-names>
          </name>
          <name>
            <surname>Hibbing</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>Manson</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Dodson</surname>
            <given-names>KW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Bacterial virulence phenotypes of Escherichia coli and host susceptibility determine risk for urinary tract infections</article-title>
        <source>Sci Transl Med</source>
        <year>2017</year>
        <volume>9</volume>
        <issue>382</issue>
        <fpage>eaaf1283</fpage>
        <pub-id pub-id-type="doi">10.1126/scitranslmed.aaf1283</pub-id>
        <pub-id pub-id-type="pmid">28330863</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <collab>Human Microbiome Project Consortium</collab>
        </person-group>
        <article-title>Structure, function and diversity of the healthy human microbiome</article-title>
        <source>Nature</source>
        <year>2012</year>
        <volume>486</volume>
        <issue>7402</issue>
        <fpage>207</fpage>
        <lpage>214</lpage>
        <pub-id pub-id-type="doi">10.1038/nature11234</pub-id>
        <pub-id pub-id-type="pmid">22699609</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tenaillon</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Skurnik</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Picard</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Denamur</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>The population genetics of commensal Escherichia coli</article-title>
        <source>Nat Rev Microbiol</source>
        <year>2010</year>
        <volume>8</volume>
        <issue>3</issue>
        <fpage>207</fpage>
        <lpage>217</lpage>
        <pub-id pub-id-type="doi">10.1038/nrmicro2298</pub-id>
        <pub-id pub-id-type="pmid">20157339</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <mixed-citation publication-type="other">Van Rossum T, Ferretti P, Maistrenko OM, Bork P. Diversity within species: interpreting strains in microbiomes. Nat Rev Microbiol. 2020. 10.1038/s41579-020-0368-1.</mixed-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <mixed-citation publication-type="other">Anyansi C, Straub TJ, Manson AL, Earl AM, Abeel T. Computational methods for strain-level microbial detection in colony and metagenome sequencing data. Front Microbiol. 2020;11 Available from: <ext-link ext-link-type="uri" xlink:href="https://www.frontiersin.org/articles/10.3389/fmicb.2020.01925/full">https://www.frontiersin.org/articles/10.3389/fmicb.2020.01925/full</ext-link>. Cited 2020 Sep 24.</mixed-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sankar</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Malone</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Bayliss</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Pascoe</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Méric</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Hitchings</surname>
            <given-names>MD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Bayesian identification of bacterial strains from sequencing data</article-title>
        <source>Microb Genom</source>
        <year>2016</year>
        <volume>2</volume>
        <issue>8</issue>
        <fpage>e000075</fpage>
        <?supplied-pmid 28348870?>
        <pub-id pub-id-type="pmid">28348870</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Albanese</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Donati</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Strain profiling and epidemiology of bacterial species from metagenomic sequencing</article-title>
        <source>Nat Commun</source>
        <year>2017</year>
        <volume>8</volume>
        <issue>1</issue>
        <fpage>2260</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-017-02209-5</pub-id>
        <pub-id pub-id-type="pmid">29273717</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fischer</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Strauch</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Renard</surname>
            <given-names>BY</given-names>
          </name>
        </person-group>
        <article-title>Abundance estimation and differential testing on strain level in metagenomics data</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <issue>14</issue>
        <fpage>i124</fpage>
        <lpage>i132</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btx237</pub-id>
        <pub-id pub-id-type="pmid">28881972</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wood</surname>
            <given-names>DE</given-names>
          </name>
          <name>
            <surname>Lu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Langmead</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Improved metagenomic analysis with Kraken 2</article-title>
        <source>Genome Biol</source>
        <year>2019</year>
        <volume>20</volume>
        <issue>1</issue>
        <fpage>257</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1891-0</pub-id>
        <pub-id pub-id-type="pmid">31779668</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Freitas</surname>
            <given-names>TAK</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>P-E</given-names>
          </name>
          <name>
            <surname>Scholz</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Chain</surname>
            <given-names>PSG</given-names>
          </name>
        </person-group>
        <article-title>Accurate read-based metagenome characterization using a hierarchical suite of unique signatures</article-title>
        <source>Nucleic Acids Res</source>
        <year>2015</year>
        <volume>43</volume>
        <issue>10</issue>
        <fpage>e69</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkv180</pub-id>
        <pub-id pub-id-type="pmid">25765641</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nayfach</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Rodriguez-Mueller</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Garud</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Pollard</surname>
            <given-names>KS</given-names>
          </name>
        </person-group>
        <article-title>An integrated metagenomics pipeline for strain profiling reveals novel patterns of bacterial transmission and biogeography</article-title>
        <source>Genome Res</source>
        <year>2016</year>
        <volume>26</volume>
        <issue>11</issue>
        <fpage>1612</fpage>
        <lpage>1625</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.201863.115</pub-id>
        <pub-id pub-id-type="pmid">27803195</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Truong</surname>
            <given-names>DT</given-names>
          </name>
          <name>
            <surname>Tett</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Pasolli</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Huttenhower</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Segata</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Microbial strain-level population structure and genetic diversity from metagenomes</article-title>
        <source>Genome Res</source>
        <year>2017</year>
        <volume>27</volume>
        <issue>4</issue>
        <fpage>626</fpage>
        <lpage>638</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.216242.116</pub-id>
        <pub-id pub-id-type="pmid">28167665</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luo</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Knight</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Siljander</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Knip</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Xavier</surname>
            <given-names>RJ</given-names>
          </name>
          <name>
            <surname>Gevers</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>ConStrains identifies microbial strains in metagenomic datasets</article-title>
        <source>Nat Biotechnol</source>
        <year>2015</year>
        <volume>33</volume>
        <issue>10</issue>
        <fpage>1045</fpage>
        <lpage>1052</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3319</pub-id>
        <pub-id pub-id-type="pmid">26344404</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Quince</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Delmont</surname>
            <given-names>TO</given-names>
          </name>
          <name>
            <surname>Raguideau</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Alneberg</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Darling</surname>
            <given-names>AE</given-names>
          </name>
          <name>
            <surname>Collins</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>DESMAN: a new tool for de novo extraction of strains from metagenomes</article-title>
        <source>Genome Biol</source>
        <year>2017</year>
        <volume>18</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>22</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1309-9</pub-id>
        <pub-id pub-id-type="pmid">28077169</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <mixed-citation publication-type="other">Olm MR, Crits-Christoph A, Bouma-Gregson K, et al. inStrain profiles population microdiversity from metagenomic data and sensitively detects shared microbial strains. Nat Biotechnol. 2021;39:727–36. 10.1038/s41587-020-00797-0.</mixed-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Quince</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Nurk</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Raguideau</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>James</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Soyer</surname>
            <given-names>OS</given-names>
          </name>
          <name>
            <surname>Summers</surname>
            <given-names>JK</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>STRONG: metagenomics strain resolution on assembly graphs</article-title>
        <source>Genome Biol</source>
        <year>2021</year>
        <volume>22</volume>
        <issue>1</issue>
        <fpage>214</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-021-02419-7</pub-id>
        <pub-id pub-id-type="pmid">34311761</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ondov</surname>
            <given-names>BD</given-names>
          </name>
          <name>
            <surname>Treangen</surname>
            <given-names>TJ</given-names>
          </name>
          <name>
            <surname>Melsted</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Mallonee</surname>
            <given-names>AB</given-names>
          </name>
          <name>
            <surname>Bergman</surname>
            <given-names>NH</given-names>
          </name>
          <name>
            <surname>Koren</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mash: fast genome and metagenome distance estimation using MinHash</article-title>
        <source>Genome Biol</source>
        <year>2016</year>
        <volume>17</volume>
        <issue>1</issue>
        <fpage>132</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-016-0997-x</pub-id>
        <pub-id pub-id-type="pmid">27323842</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Anyansi</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Keo</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Walker</surname>
            <given-names>BJ</given-names>
          </name>
          <name>
            <surname>Straub</surname>
            <given-names>TJ</given-names>
          </name>
          <name>
            <surname>Manson</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Earl</surname>
            <given-names>AM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>QuantTB – a method to classify mixed Mycobacterium tuberculosis infections within whole genome sequencing data</article-title>
        <source>BMC Genomics</source>
        <year>2020</year>
        <volume>21</volume>
        <issue>1</issue>
        <fpage>80</fpage>
        <pub-id pub-id-type="doi">10.1186/s12864-020-6486-3</pub-id>
        <pub-id pub-id-type="pmid">31992201</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Bush SJ, Foster D, Eyre DW, Clark EL, De Maio N, Shaw LP, et al. Genomic diversity affects the accuracy of bacterial single-nucleotide polymorphism–calling pipelines. GigaScience. 2020;9(2) Available from: <ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/gigascience/article/9/2/giaa007/5728470">https://academic.oup.com/gigascience/article/9/2/giaa007/5728470</ext-link>. Cited 2020 Jul 6.</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Darmon</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Leach</surname>
            <given-names>DRF</given-names>
          </name>
        </person-group>
        <article-title>Bacterial genome instability</article-title>
        <source>Microbiol Mol Biol Rev</source>
        <year>2014</year>
        <volume>78</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>39</lpage>
        <pub-id pub-id-type="doi">10.1128/MMBR.00035-13</pub-id>
        <pub-id pub-id-type="pmid">24600039</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Acman</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>van Dorp</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Santini</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Balloux</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Large-scale network analysis captures biological features of bacterial plasmids</article-title>
        <source>Nat Commun</source>
        <year>2020</year>
        <volume>11</volume>
        <issue>1</issue>
        <fpage>2452</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-020-16282-w</pub-id>
        <pub-id pub-id-type="pmid">32415210</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fang</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Monk</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Nurk</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Akseshina</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Gemmell</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metagenomics-based, strain-level analysis of Escherichia coli from a time-series of microbiome samples from a Crohn’s disease patient</article-title>
        <source>Front Microbiol</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>2559</fpage>
        <pub-id pub-id-type="doi">10.3389/fmicb.2018.02559</pub-id>
        <pub-id pub-id-type="pmid">30425690</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <mixed-citation publication-type="other">Jones-Freeman B, Chonwerawong M, Marcelino VR, Deshpande AV, Forster SC, Starkey MR. The microbiome and host mucosal interactions in urinary tract diseases. Mucosal Immunology. 2021;14:779–92.</mixed-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shao</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Forster</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Tsaliki</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Vervier</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Strang</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Simpson</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Stunted microbiota and opportunistic pathogen colonization in caesarean-section birth</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>574</volume>
        <issue>7776</issue>
        <fpage>117</fpage>
        <lpage>121</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1560-1</pub-id>
        <pub-id pub-id-type="pmid">31534227</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lander</surname>
            <given-names>ES</given-names>
          </name>
          <name>
            <surname>Waterman</surname>
            <given-names>MS</given-names>
          </name>
        </person-group>
        <article-title>Genomic mapping by fingerprinting random clones: a mathematical analysis</article-title>
        <source>Genomics</source>
        <year>1988</year>
        <volume>2</volume>
        <issue>3</issue>
        <fpage>231</fpage>
        <lpage>239</lpage>
        <pub-id pub-id-type="doi">10.1016/0888-7543(88)90007-9</pub-id>
        <pub-id pub-id-type="pmid">3294162</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Durbin</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Fast and accurate short read alignment with Burrows-Wheeler transform</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <issue>14</issue>
        <fpage>1754</fpage>
        <lpage>1760</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp324</pub-id>
        <pub-id pub-id-type="pmid">19451168</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huang</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Myers</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>Marth</surname>
            <given-names>GT</given-names>
          </name>
        </person-group>
        <article-title>ART: a next-generation sequencing read simulator</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <issue>4</issue>
        <fpage>593</fpage>
        <lpage>594</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr708</pub-id>
        <pub-id pub-id-type="pmid">22199392</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Truong</surname>
            <given-names>DT</given-names>
          </name>
          <name>
            <surname>Franzosa</surname>
            <given-names>EA</given-names>
          </name>
          <name>
            <surname>Tickle</surname>
            <given-names>TL</given-names>
          </name>
          <name>
            <surname>Scholz</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Weingart</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Pasolli</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MetaPhlAn2 for enhanced metagenomic taxonomic profiling</article-title>
        <source>Nat Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <issue>10</issue>
        <fpage>902</fpage>
        <lpage>903</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3589</pub-id>
        <pub-id pub-id-type="pmid">26418763</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <mixed-citation publication-type="other">Georgescu CH, Manson AL, Griggs AD, Desjardins CA, Pironti A, Wapinski I, et al. SynerClust: a highly scalable, synteny-aware orthologue clustering tool. Microbial Genomics. 2018;4(11).</mixed-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Edgar</surname>
            <given-names>RC</given-names>
          </name>
        </person-group>
        <article-title>MUSCLE: multiple sequence alignment with high accuracy and high throughput</article-title>
        <source>Nucleic Acids Res</source>
        <year>2004</year>
        <volume>32</volume>
        <issue>5</issue>
        <fpage>1792</fpage>
        <lpage>1797</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkh340</pub-id>
        <pub-id pub-id-type="pmid">15034147</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Price</surname>
            <given-names>MN</given-names>
          </name>
          <name>
            <surname>Dehal</surname>
            <given-names>PS</given-names>
          </name>
          <name>
            <surname>Arkin</surname>
            <given-names>AP</given-names>
          </name>
        </person-group>
        <article-title>FastTree 2 – approximately maximum-likelihood trees for large alignments</article-title>
        <source>PLoS One</source>
        <year>2010</year>
        <volume>5</volume>
        <issue>3</issue>
        <fpage>e9490</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0009490</pub-id>
        <pub-id pub-id-type="pmid">20224823</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Letunic</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Bork</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Interactive Tree Of Life (iTOL) v5: an online tool for phylogenetic tree display and annotation</article-title>
        <source>Nucleic Acids Res</source>
        <year>2021</year>
        <volume>49</volume>
        <issue>W1</issue>
        <fpage>W293</fpage>
        <lpage>W296</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkab301</pub-id>
        <pub-id pub-id-type="pmid">33885785</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Jukes</surname>
            <given-names>TH</given-names>
          </name>
          <name>
            <surname>Cantor</surname>
            <given-names>CR</given-names>
          </name>
        </person-group>
        <article-title>Evolution of protein models</article-title>
        <source>Mammalian protein metabolism</source>
        <year>1969</year>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kimura</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>A simple method for estimating evolutionary rates of base substitutions through comparative studies of nucleotide sequences</article-title>
        <source>J Mol Evol</source>
        <year>1980</year>
        <volume>16</volume>
        <issue>2</issue>
        <fpage>111</fpage>
        <lpage>120</lpage>
        <pub-id pub-id-type="doi">10.1007/BF01731581</pub-id>
        <pub-id pub-id-type="pmid">7463489</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Walker BJ, Abeel T, Shea T, Priest M, Abouelliel A, Sakthikumar S, et al. Pilon: an integrated tool for comprehensive microbial variant detection and genome assembly improvement. PLoS One. 2014;9(11). 10.1371/journal.pone.0112963.</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <mixed-citation publication-type="other">Straub T, Walker B, van Dijk L, Canyansi, Desjardins C. broadinstitute/StrainGE: v1.2: Zenodo; 2021. Available from: <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/5750855">https://zenodo.org/record/5750855</ext-link>. Cited 2022 Jan 20</mixed-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Harris</surname>
            <given-names>CR</given-names>
          </name>
          <name>
            <surname>Millman</surname>
            <given-names>KJ</given-names>
          </name>
          <name>
            <surname>van der Walt</surname>
            <given-names>SJ</given-names>
          </name>
          <name>
            <surname>Gommers</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Virtanen</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Cournapeau</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Array programming with NumPy</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>585</volume>
        <issue>7825</issue>
        <fpage>357</fpage>
        <lpage>362</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2649-2</pub-id>
        <pub-id pub-id-type="pmid">32939066</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Virtanen</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Gommers</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Oliphant</surname>
            <given-names>TE</given-names>
          </name>
          <name>
            <surname>Haberland</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Reddy</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Cournapeau</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SciPy 1.0: fundamental algorithms for scientific computing in Python</article-title>
        <source>Nat Methods</source>
        <year>2020</year>
        <volume>17</volume>
        <issue>3</issue>
        <fpage>261</fpage>
        <lpage>272</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0686-2</pub-id>
        <pub-id pub-id-type="pmid">32015543</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <mixed-citation publication-type="other">van Dijk L. broadinstitute/strainge-paper: paper resubmission: Zenodo; 2021. Available from: <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/4850376">https://zenodo.org/record/4850376</ext-link>. Cited 2022 Jan 20</mixed-citation>
    </ref>
  </ref-list>
</back>
