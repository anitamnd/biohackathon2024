<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Brief Bioinform</journal-id>
    <journal-id journal-id-type="iso-abbrev">Brief Bioinform</journal-id>
    <journal-id journal-id-type="publisher-id">bib</journal-id>
    <journal-title-group>
      <journal-title>Briefings in Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1467-5463</issn>
    <issn pub-type="epub">1477-4054</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10025448</article-id>
    <article-id pub-id-type="pmid">36653900</article-id>
    <article-id pub-id-type="doi">10.1093/bib/bbac622</article-id>
    <article-id pub-id-type="publisher-id">bbac622</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Problem Solving Protocol</subject>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>PLSDA-batch: a multivariate framework to correct for batch effects in microbiome data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7067-9093</contrib-id>
        <name>
          <surname>Wang</surname>
          <given-names>Yiwen</given-names>
        </name>
        <aff><institution>Shenzhen Branch</institution>, Guangdong Laboratory of Lingnan Modern Agriculture, Genome Analysis Laboratory of the Ministry of Agriculture and Rural Affairs, Agricultural Genomics Institute at Shenzhen, <institution>Chinese Academy of Agricultural Sciences</institution>, <addr-line>97 Buxin Rd, Shenzhen, 518000, Guangdong</addr-line>, <country country="CN">China</country></aff>
        <aff><institution>Melbourne Integrative Genomics, School of Mathematics and Statistics, The University of Melbourne</institution>, <addr-line>30 Royal Parade, Melbourne, 3052, VIC</addr-line>, <country country="AU">Australia</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-3923-1116</contrib-id>
        <name>
          <surname>Lê Cao</surname>
          <given-names>Kim-Anh</given-names>
        </name>
        <!--kimanh.lecao@unimelb.edu.au-->
        <aff><institution>Melbourne Integrative Genomics, School of Mathematics and Statistics, The University of Melbourne</institution>, <addr-line>30 Royal Parade, Melbourne, 3052, VIC</addr-line>, <country country="AU">Australia</country></aff>
        <xref rid="cor1" ref-type="corresp"/>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="cor1">Corresponding author. Kim-Anh Lê Cao, Tel: +61 (0)3834 43971. E-mail: <email>kimanh.lecao@unimelb.edu.au</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>3</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-01-18">
      <day>18</day>
      <month>1</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>18</day>
      <month>1</month>
      <year>2023</year>
    </pub-date>
    <volume>24</volume>
    <issue>2</issue>
    <elocation-id>bbac622</elocation-id>
    <history>
      <date date-type="received">
        <day>19</day>
        <month>10</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>14</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>17</day>
        <month>12</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">https://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="bbac622.pdf"/>
    <abstract>
      <title>Abstract</title>
      <p>Microbial communities are highly dynamic and sensitive to changes in the environment. Thus, microbiome data are highly susceptible to batch effects, defined as sources of unwanted variation that are not related to and obscure any factors of interest. Existing batch effect correction methods have been primarily developed for gene expression data. As such, they do not consider the inherent characteristics of microbiome data, including zero inflation, overdispersion and correlation between variables. We introduce new multivariate and non-parametric batch effect correction methods based on Partial Least Squares Discriminant Analysis (PLSDA). PLSDA-batch first estimates treatment and batch variation with latent components, then subtracts batch-associated components from the data. The resulting batch-effect-corrected data can then be input in any downstream statistical analysis. Two variants are proposed to handle unbalanced batch x treatment designs and to avoid overfitting when estimating the components via variable selection. We compare our approaches with popular methods managing batch effects, namely, removeBatchEffect, ComBat and Surrogate Variable Analysis, in simulated and three case studies using various visual and numerical assessments. We show that our three methods lead to competitive performance in removing batch variation while preserving treatment variation, especially for unbalanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation1">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment designs. Our downstream analyses show selections of biologically relevant taxa. This work demonstrates that batch effect correction methods can improve microbiome research outputs. Reproducible code and vignettes are available on GitHub.</p>
    </abstract>
    <kwd-group>
      <kwd>microbiome data</kwd>
      <kwd>multivariate</kwd>
      <kwd>non-parametric</kwd>
      <kwd>dimension reduction</kwd>
      <kwd>batch effect correction</kwd>
    </kwd-group>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>China Scholarship Council - University of Melbourne</institution>
          </institution-wrap>
        </funding-source>
        <award-id>201707510003</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>China Postdoctoral Science Foundation</institution>
            <institution-id institution-id-type="DOI">10.13039/501100002858</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>2022TQ0370</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Young Scientists Fund of the National Natural Science Foundation of China</institution>
            <institution-id institution-id-type="DOI">10.13039/501100020771</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>32200077</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="17"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec id="sec1">
    <title>Introduction</title>
    <p>Investigating the link between microbial composition and phenotypes, including human diseases, is the main goal of microbiome research. The disruption of gut microbial communities has been linked to varieties of diseases and sub-health status, ranging from inflammatory bowel disease [<xref rid="ref1" ref-type="bibr">1</xref>], diabetes [<xref rid="ref2" ref-type="bibr">2</xref>] to obesity [<xref rid="ref3" ref-type="bibr">3</xref>] and malnutrition [<xref rid="ref4" ref-type="bibr">4</xref>].</p>
    <p>However, microbiome research faces the challenges of data reproducibility and replicability that invalidate statistical results. Because microbial communities are highly dynamic [<xref rid="ref5" ref-type="bibr">5</xref>], microbiome data are highly susceptible to batch effects, that is, any unwanted sources of variation that are unrelated to and obscure the biological factors of interest [<xref rid="ref6" ref-type="bibr">6</xref>]. Microbiome studies affected by batch affects are increasingly abundant in the literature: unwanted variation can be introduced by changes in technical procedures including sample collection, shipping and processing [<xref rid="ref7" ref-type="bibr">7–9</xref>] or from independent studies [<xref rid="ref10" ref-type="bibr">10</xref>]. Other confounding factors including geography, age, sex, stress and diet also introduce batch effects to the composition of the host microbiota [<xref rid="ref11" ref-type="bibr">11–14</xref>]. These batch effects often mask the biological effects of interest. Batch effect management is therefore critical to improve the validity of microbiome studies’ results.</p>
    <p>Two types of approaches exist to handle batch effects [<xref rid="ref6" ref-type="bibr">6</xref>]: methods that <italic toggle="yes">correct</italic> for batch effects consist in removing batch variation from the data; methods that <italic toggle="yes">account</italic> for batch effects include batch effects as covariates in the statistical model. Evaluating the effectiveness of the former is easier than the latter through numerical and graphical analyses [<xref rid="ref6" ref-type="bibr">6</xref>].</p>
    <p>Methods that account for batch effects are often restricted to differential abundance analysis with models that hold strong assumptions about data distribution. They include zero-inflated Gaussian model [<xref rid="ref15" ref-type="bibr">15</xref>] and Bayesian Dirichlet multinomial regression [<xref rid="ref16" ref-type="bibr">16</xref>].</p>
    <p>Methods that correct for batch effects are the most flexible and any type of downstream analysis can be applied to the resulting batch-effect-corrected data, including dimension reduction, visualization and clustering. However, for microbiome studies, these methods are challenged by small sample sizes, which increase the uncertainty of batch effect estimation [<xref rid="ref17" ref-type="bibr">17</xref>]. In addition, batch effect correction methods assume that batch and treatment effects are independent, requiring a balanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation2">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment design [<xref rid="ref6" ref-type="bibr">6</xref>]. However, microbiome experiments often result in unbalanced designs where batch and treatment effects are partly confounded, leading to the loss of treatment variation during the batch effect correction process.</p>
    <p>The multivariate method Remove Unwanted Variation (RUV) has been recently adapted for microbiome data [<xref rid="ref18" ref-type="bibr">18</xref>, <xref rid="ref19" ref-type="bibr">19</xref>], but requires negative control variables and technical sample replicates that capture batch variation, which are not often available in microbiome studies. Two methods percentile-normalization [<xref rid="ref20" ref-type="bibr">20</xref>] and NetMoss [<xref rid="ref21" ref-type="bibr">21</xref>] were developed to remove batch effects for microbial studies, but are only valid for case-control studies, which narrow the scope of their application.</p>
    <p>Several batch effect correction methods have been developed for gene expression data [<xref rid="ref22" ref-type="bibr">22</xref>, <xref rid="ref23" ref-type="bibr">23</xref>]. However, they are challenged by the inherent characteristics of microbiome data including zero inflation, uneven library sizes and compositional structure (even if data are transformed beforehand, for example, with centred log ratio transformation). Univariate methods disregard the inter-dependent relationships between microrganisms [<xref rid="ref24" ref-type="bibr">24</xref>]. They also assume that batch effects are systematic and thus have a homogeneous influence on all microbial variables, which was found to be unlikely [<xref rid="ref6" ref-type="bibr">6</xref>]. When non-systematic batch effects are mistakenly treated as systematic, biological variation of interest might be removed from the data, or the batch variation may remain during the batch effect correction process.</p>
    <p>Promising methods have been proposed in other fields of application, such as single-cell RNA-sequencing. Seurat V3 [<xref rid="ref25" ref-type="bibr">25</xref>], mnnCorrect [<xref rid="ref26" ref-type="bibr">26</xref>], scmerge [<xref rid="ref27" ref-type="bibr">27</xref>], zinbwave [<xref rid="ref28" ref-type="bibr">28</xref>] assume a zero-inflated distribution but are only effective for very large sample size.</p>
    <p>We propose novel approaches to correct for batch effects in microbiome data based on Partial Least Squares Discriminant Analysis (PLSDA [<xref rid="ref29" ref-type="bibr">29</xref>]). PLSDA-batch is highly suitable for microbiome data as it is non-parametric, multivariate and allows for ordination and data visualization. Latent components related to treatment and batch effects are estimated to remove batch variation in the data while preserving biological variation of interest. Two other variants are proposed for unbalanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation3">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment designs and to select discriminative microbial variables among treatment groups. We assess the performance of PLSDA-batch in extensive simulation studies and three case studies that investigate microbial communities in sponge tissues, anaerobic digestion conditions and diet types in mice. We compare the efficiency of our approaches in removing batch effects and uncovering treatment effects with popular linear methods that have been previously applied in microbial studies [<xref rid="ref30" ref-type="bibr">30–32</xref>], such as ComBat and removeBatchEffect. As our approach shares some similarities with Surrogate Variable Analysis (SVA), besides the fact that it accounts, rather than corrects for batch effects, we include some comparisons in the simulation studies.</p>
  </sec>
  <sec id="sec2">
    <title>Methods</title>
    <p>Our three approaches are derived from PLSDA [<xref rid="ref29" ref-type="bibr">29</xref>] to correct batch effects. We first give a brief description of the core method Partial Least Squares (PLS [<xref rid="ref33" ref-type="bibr">33</xref>]), and its PLSDA extension for classification problems. We will use the following notations: <inline-formula><tex-math notation="LaTeX" id="ImEquation4">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> denotes an <inline-formula><tex-math notation="LaTeX" id="ImEquation5">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$(n \times p)$\end{document}</tex-math></inline-formula> explanatory data matrix with <inline-formula><tex-math notation="LaTeX" id="ImEquation6">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$p$\end{document}</tex-math></inline-formula> microbial variables and <inline-formula><tex-math notation="LaTeX" id="ImEquation7">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula> an <inline-formula><tex-math notation="LaTeX" id="ImEquation8">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$(n \times q)$\end{document}</tex-math></inline-formula> data matrix with <inline-formula><tex-math notation="LaTeX" id="ImEquation9">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$q$\end{document}</tex-math></inline-formula> response variables. Both datasets match on the same <inline-formula><tex-math notation="LaTeX" id="ImEquation10">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$n$\end{document}</tex-math></inline-formula> samples. We denote the matrix transpose by <inline-formula><tex-math notation="LaTeX" id="ImEquation11">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$^\top $\end{document}</tex-math></inline-formula>. The <inline-formula><tex-math notation="LaTeX" id="ImEquation12">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\ell _1$\end{document}</tex-math></inline-formula> norm of a random vector <inline-formula><tex-math notation="LaTeX" id="ImEquation13">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{v}$\end{document}</tex-math></inline-formula> (<inline-formula><tex-math notation="LaTeX" id="ImEquation14">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{v} \in \mathbb{R}^{p \times 1}$\end{document}</tex-math></inline-formula>) is defined as <inline-formula><tex-math notation="LaTeX" id="ImEquation15">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$||\boldsymbol{v}||_1 = \sum _{i = 1}^{p} v_i$\end{document}</tex-math></inline-formula> and the <inline-formula><tex-math notation="LaTeX" id="ImEquation16">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\ell _2$\end{document}</tex-math></inline-formula> norm is <inline-formula><tex-math notation="LaTeX" id="ImEquation17">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$||\boldsymbol{v}||_2 = \sqrt{\sum _{i = 1}^{p} v_i^2}$\end{document}</tex-math></inline-formula>.</p>
    <sec id="sec2a">
      <title>PLS and sparse PLSDA</title>
      <p>PLS, a.k.a Projection to Latent Structures is an orthogonal component-based regression method commonly used to model the covariance structure between explanatory (<inline-formula><tex-math notation="LaTeX" id="ImEquation18">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula>) and response (<inline-formula><tex-math notation="LaTeX" id="ImEquation19">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula>) matrices in large datasets. The optimization problem to solve is <disp-formula id="deqn01"><label>(1)</label><tex-math notation="LaTeX" id="DmEquation1">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{align*}&amp; {\underset{||\boldsymbol{\alpha}||_{2} = 1||\boldsymbol{\beta}||_{2} = 1}{\mbox{arg max}}}cov(\boldsymbol{X \alpha}, \boldsymbol{Y \beta}), \end{align*}\end{document}</tex-math></disp-formula>where <inline-formula><tex-math notation="LaTeX" id="ImEquation20">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\alpha } \in \mathbb{R}^{p \times 1}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation21">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\beta }\in \mathbb{R}^{q \times 1}$\end{document}</tex-math></inline-formula> represent the loading vectors of <inline-formula><tex-math notation="LaTeX" id="ImEquation22">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation23">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula>, respectively. The aim of PLS is to find the linear transformations (<inline-formula><tex-math notation="LaTeX" id="ImEquation24">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\alpha }$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation25">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\beta }$\end{document}</tex-math></inline-formula>) of <inline-formula><tex-math notation="LaTeX" id="ImEquation26">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation27">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula> that maximize the covariance between their latent components denoted as <inline-formula><tex-math notation="LaTeX" id="ImEquation28">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation29">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{u}$\end{document}</tex-math></inline-formula>, respectively, with <inline-formula><tex-math notation="LaTeX" id="ImEquation30">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t} = \boldsymbol{X \alpha }$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation31">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{u} = \boldsymbol{Y \beta }$\end{document}</tex-math></inline-formula>, <inline-formula><tex-math notation="LaTeX" id="ImEquation32">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}, \boldsymbol{u} \in \mathbb{R}^{n \times 1}$\end{document}</tex-math></inline-formula>. After the first pair of latent components (<inline-formula><tex-math notation="LaTeX" id="ImEquation33">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}, \boldsymbol{u}$\end{document}</tex-math></inline-formula>) is obtained, the residual matrix is calculated via <italic toggle="yes">matrix deflation</italic> as <disp-formula id="deqn02"><label>(2)</label><tex-math notation="LaTeX" id="DmEquation2">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{align*}&amp; \boldsymbol{X}_{residuals} = \boldsymbol{X} - \boldsymbol{t} \boldsymbol{\gamma}, \end{align*}\end{document}</tex-math></disp-formula>where <inline-formula><tex-math notation="LaTeX" id="ImEquation34">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\gamma } = (\boldsymbol{t}^{\top }\boldsymbol{t})^{-1}\boldsymbol{t}^{\top }\boldsymbol{X}$\end{document}</tex-math></inline-formula>. <inline-formula><tex-math notation="LaTeX" id="ImEquation35">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\gamma }$\end{document}</tex-math></inline-formula> represents the regression coefficient vector for each variable in <inline-formula><tex-math notation="LaTeX" id="ImEquation36">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> on <inline-formula><tex-math notation="LaTeX" id="ImEquation37">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}, \boldsymbol{\gamma } \in \mathbb{R}^{1 \times p}$\end{document}</tex-math></inline-formula>. Similarly, we can calculate the residual matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation38">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}_{residuals}$\end{document}</tex-math></inline-formula> by deflating the matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation39">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula> with <inline-formula><tex-math notation="LaTeX" id="ImEquation40">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{u}$\end{document}</tex-math></inline-formula>. The deflated matrices are then used as updated <inline-formula><tex-math notation="LaTeX" id="ImEquation41">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation42">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula> for the next PLS dimension. The deflation steps ensure that the latent components associated with each PLS dimension are orthogonal.</p>
      <p>PLSDA is an adaption of PLS for classification and discrimination, where the response matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation43">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula> is a dummy matrix transformed from a categorical outcome variable. Each column in <inline-formula><tex-math notation="LaTeX" id="ImEquation44">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula> indicates the group membership of each sample: If sample <inline-formula><tex-math notation="LaTeX" id="ImEquation45">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$i$\end{document}</tex-math></inline-formula> belongs to group <inline-formula><tex-math notation="LaTeX" id="ImEquation46">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$j$\end{document}</tex-math></inline-formula>, then <inline-formula><tex-math notation="LaTeX" id="ImEquation47">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$Y_{ij}$\end{document}</tex-math></inline-formula> equals 1, otherwise 0. For each dimension <inline-formula><tex-math notation="LaTeX" id="ImEquation48">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$h = 1,...,H$\end{document}</tex-math></inline-formula>, the latent components <inline-formula><tex-math notation="LaTeX" id="ImEquation49">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}_h$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation50">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{u}_h$\end{document}</tex-math></inline-formula> are calculated as shown earlier in Eq.(<xref rid="deqn01" ref-type="disp-formula">1</xref>). <inline-formula><tex-math notation="LaTeX" id="ImEquation51">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}_h$\end{document}</tex-math></inline-formula> summarizes the variation from <inline-formula><tex-math notation="LaTeX" id="ImEquation52">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> that is associated with <inline-formula><tex-math notation="LaTeX" id="ImEquation53">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{u}_h$\end{document}</tex-math></inline-formula>, whereas <inline-formula><tex-math notation="LaTeX" id="ImEquation54">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{u}_h$\end{document}</tex-math></inline-formula> is a linear combination of the dummy outcomes in <inline-formula><tex-math notation="LaTeX" id="ImEquation55">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula>. Thus, the <inline-formula><tex-math notation="LaTeX" id="ImEquation56">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}_h$\end{document}</tex-math></inline-formula> component is mostly relevant to explain the discrimination between sample groups.</p>
      <p>In PLSDA, we need to specify the optimal number of components <inline-formula><tex-math notation="LaTeX" id="ImEquation57">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$H$\end{document}</tex-math></inline-formula>. It can be chosen using repeated cross-validation to estimate the classification error rate on each component <inline-formula><tex-math notation="LaTeX" id="ImEquation58">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}_h$\end{document}</tex-math></inline-formula>. As PLSDA is an iterative process based on deflated matrices, the <inline-formula><tex-math notation="LaTeX" id="ImEquation59">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$H$\end{document}</tex-math></inline-formula> components that yield the lowest error rate correspond to the overall performance of the PLSDA model [<xref rid="ref34" ref-type="bibr">34</xref>]. </p>
      <p>sparse PLSDA (sPLSDA) uses <inline-formula><tex-math notation="LaTeX" id="ImEquation60">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\ell _1$\end{document}</tex-math></inline-formula> penalization on the loading vectors <inline-formula><tex-math notation="LaTeX" id="ImEquation61">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\left [\boldsymbol{\alpha }_{1},..., \boldsymbol{\alpha }_{H} \right ]$\end{document}</tex-math></inline-formula> in PLSDA to select variables [<xref rid="ref35" ref-type="bibr">35</xref>]. During the regression step, for each component <inline-formula><tex-math notation="LaTeX" id="ImEquation62">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$h = 1,...,H$\end{document}</tex-math></inline-formula>, the penalty is solved with soft-thresholding in Eq.(<xref rid="deqn01" ref-type="disp-formula">1</xref>): <disp-formula id="deqn03"><label>(3)</label><tex-math notation="LaTeX" id="DmEquation3">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{align*}&amp; {\underset{||\boldsymbol{\alpha}_h||_{2} = 1||\boldsymbol{\beta}_h||_{2} = 1}{\mbox{arg max}}} cov(\boldsymbol{X}_h \boldsymbol{\alpha}_h, \boldsymbol{Y}_h \boldsymbol{\beta}_h) + \lambda_h||\boldsymbol{\alpha}_h||_1, \end{align*}\end{document}</tex-math></disp-formula>where <inline-formula><tex-math notation="LaTeX" id="ImEquation63">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\lambda _h$\end{document}</tex-math></inline-formula> is a non-negative parameter that controls the amount of shrinkage on the loading vector <inline-formula><tex-math notation="LaTeX" id="ImEquation64">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\alpha }_h$\end{document}</tex-math></inline-formula> and thus the number of non-zero loadings. The latent component <inline-formula><tex-math notation="LaTeX" id="ImEquation65">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}_h$\end{document}</tex-math></inline-formula> is therefore calculated based on a subset of variables that are deemed most discriminative to classify the sample groups.</p>
      <p>Two types of parameters need to be specified in sPLSDA: the number of components <inline-formula><tex-math notation="LaTeX" id="ImEquation66">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$H$\end{document}</tex-math></inline-formula> and the number of variables to select on each component, which corresponds to the shrinkage coefficient <inline-formula><tex-math notation="LaTeX" id="ImEquation67">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\lambda _h$\end{document}</tex-math></inline-formula>. Both parameters can be chosen simultaneously using repeated cross-validation by evaluating the classification error rate on a grid of number of variables to select on each component [<xref rid="ref34" ref-type="bibr">34</xref>].</p>
    </sec>
    <sec id="sec2b">
      <title>PLSDA-batch</title>
      <p>PLSDA-batch aims to estimate and remove batch variation while preserving treatment variation. We use additional notations as we include in the model two different types of sample information, treatment and batch, denoted <inline-formula><tex-math notation="LaTeX" id="ImEquation68">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}^{(trt)}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation69">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}^{(batch)}$\end{document}</tex-math></inline-formula>, respectively. The matrices <inline-formula><tex-math notation="LaTeX" id="ImEquation70">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{A}^{(trt)} = \left [ \boldsymbol{\alpha }^{(trt)}_{1},..., \boldsymbol{\alpha }^{(trt)}_{H^{(t)}} \right ]$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation71">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{B}^{(trt)}= \left [ \boldsymbol{\beta }^{(trt)}_{1},..., \boldsymbol{\beta }^{(trt)}_{H^{(t)}} \right ]$\end{document}</tex-math></inline-formula> include the loading vectors associated with <inline-formula><tex-math notation="LaTeX" id="ImEquation72">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation73">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}^{(trt)}$\end{document}</tex-math></inline-formula>, respectively, where <inline-formula><tex-math notation="LaTeX" id="ImEquation74">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$H^{(t)}$\end{document}</tex-math></inline-formula> is the number of components associated with the treatment variation. The corresponding latent components are denoted <inline-formula><tex-math notation="LaTeX" id="ImEquation75">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{T}^{(trt)} = \left [\boldsymbol{t}^{(trt)}_{1},...,\boldsymbol{t}^{(trt)}_{H^{(t)}} \right ]$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation76">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{U}^{(trt)} = \left [\boldsymbol{u}^{(trt)}_{1},...,\boldsymbol{u}^{(trt)}_{H^{(t)}} \right ]$\end{document}</tex-math></inline-formula>. Similar notations are used for the loading vectors and latent components associated with the batch effect across <inline-formula><tex-math notation="LaTeX" id="ImEquation77">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$H^{(b)}$\end{document}</tex-math></inline-formula> components. We will use simplified notations without superscript, such as <inline-formula><tex-math notation="LaTeX" id="ImEquation78">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula>, <inline-formula><tex-math notation="LaTeX" id="ImEquation79">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{A}$\end{document}</tex-math></inline-formula>, <inline-formula><tex-math notation="LaTeX" id="ImEquation80">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$H$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation81">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{T}$\end{document}</tex-math></inline-formula> that are related to either treatment or batch variation when there is not ambiguity. <inline-formula><tex-math notation="LaTeX" id="ImEquation82">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}^{(nobatch)}$\end{document}</tex-math></inline-formula> is the matrix from which the batch effect is removed, and similarly <inline-formula><tex-math notation="LaTeX" id="ImEquation83">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}^{(notrt)}$\end{document}</tex-math></inline-formula> for the treatment effect.</p>
      <sec id="sec2b1">
        <title>Overview</title>
        <p>The general concept of PLSDA-batch is shown in the first column of Figure <xref rid="f1" ref-type="fig">1</xref>. Assuming <inline-formula><tex-math notation="LaTeX" id="ImEquation84">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> includes both treatment and batch effects, the samples projected onto a Principal Component Analysis (PCA) plot would be segregated according to both treatment and batch information. In a first step, PLSDA-batch estimates the treatment variation with the components <inline-formula><tex-math notation="LaTeX" id="ImEquation85">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{T}^{(trt)}$\end{document}</tex-math></inline-formula>, which are extracted from <inline-formula><tex-math notation="LaTeX" id="ImEquation86">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> to obtain <inline-formula><tex-math notation="LaTeX" id="ImEquation87">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}^{(notrt)}$\end{document}</tex-math></inline-formula>, so that only batch variation remains. The second step estimates the batch associated components <inline-formula><tex-math notation="LaTeX" id="ImEquation88">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{T}^{(batch)}$\end{document}</tex-math></inline-formula> from <inline-formula><tex-math notation="LaTeX" id="ImEquation89">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}^{(notrt)}$\end{document}</tex-math></inline-formula>. The original dataset <inline-formula><tex-math notation="LaTeX" id="ImEquation90">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> is then deflated with <inline-formula><tex-math notation="LaTeX" id="ImEquation91">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{T}^{(batch)}$\end{document}</tex-math></inline-formula> to obtain the final matrix corrected for batch effects while preserving the treatment variation <inline-formula><tex-math notation="LaTeX" id="ImEquation92">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}^{(nobatch)}$\end{document}</tex-math></inline-formula>.</p>
        <fig position="float" id="f1">
          <label>Figure 1</label>
          <caption>
            <p>PLSDA-batch framework. From left to right columns: Visualization with Principal Component Analysis sample plots; Workflow describing each step of Algorithm 1 and Geometrical representation of the approach via projections and deflation. For illustrative purpose, we only represent one component associated with either treatment or batch effects.</p>
          </caption>
          <graphic xlink:href="bbac622f1" position="float"/>
        </fig>
      </sec>
      <sec id="sec20b1">
        <title>Algorithmic and geometrical point of views</title>
        <p>The remaining columns in Figure <xref rid="f1" ref-type="fig">1</xref> further describe the approach. For illustrative purposes, we only depict the case where only one component is associated with either treatment or batch effects rather than several components. The data matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation93">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> with both treatment and batch effects can be decomposed into three major sources of variation: treatment, batch and residuals. All these sources are assumed to be independent but in practice, treatment and batch sources are likely to be correlated to some extent. This motivated our approach to first estimate the treatment variation to avoid over-estimating the batch variation and losing substantial treatment variation.</p>
        <p>In the first step, we apply PLSDA to <inline-formula><tex-math notation="LaTeX" id="ImEquation94">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation95">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}^{(trt)}$\end{document}</tex-math></inline-formula> to identify the dimension of treatment effects <inline-formula><tex-math notation="LaTeX" id="ImEquation96">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\alpha }^{(trt)}$\end{document}</tex-math></inline-formula> from <inline-formula><tex-math notation="LaTeX" id="ImEquation97">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> (see Algorithm 1 ‘Estimation of latent dimensions’). <inline-formula><tex-math notation="LaTeX" id="ImEquation98">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}^{(trt)}$\end{document}</tex-math></inline-formula> is then calculated using a scalar projection of <inline-formula><tex-math notation="LaTeX" id="ImEquation99">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> onto <inline-formula><tex-math notation="LaTeX" id="ImEquation100">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\alpha }^{(trt)}$\end{document}</tex-math></inline-formula>. Therefore, the treatment variation of all variables in <inline-formula><tex-math notation="LaTeX" id="ImEquation101">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> is summarized in the component <inline-formula><tex-math notation="LaTeX" id="ImEquation102">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}^{(trt)}$\end{document}</tex-math></inline-formula>. We then calculate the matrix without treatment effects <inline-formula><tex-math notation="LaTeX" id="ImEquation103">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}^{(notrt)}$\end{document}</tex-math></inline-formula> by deflating <inline-formula><tex-math notation="LaTeX" id="ImEquation104">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> with <inline-formula><tex-math notation="LaTeX" id="ImEquation105">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}^{(trt)}$\end{document}</tex-math></inline-formula>. In the second step, we identify the batch-associated dimension <inline-formula><tex-math notation="LaTeX" id="ImEquation106">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\alpha }^{(batch)}$\end{document}</tex-math></inline-formula> from <inline-formula><tex-math notation="LaTeX" id="ImEquation107">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}^{(notrt)}$\end{document}</tex-math></inline-formula>, then calculate <inline-formula><tex-math notation="LaTeX" id="ImEquation108">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}^{(batch)}$\end{document}</tex-math></inline-formula> by projecting <inline-formula><tex-math notation="LaTeX" id="ImEquation109">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> onto <inline-formula><tex-math notation="LaTeX" id="ImEquation110">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\alpha }^{(batch)}$\end{document}</tex-math></inline-formula>. The batch variation <inline-formula><tex-math notation="LaTeX" id="ImEquation111">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}^{(batch)}$\end{document}</tex-math></inline-formula> is then removed from <inline-formula><tex-math notation="LaTeX" id="ImEquation112">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> via <italic toggle="yes">matrix deflation</italic> while ensuring the treatment effects are fully preserved. Since the components <inline-formula><tex-math notation="LaTeX" id="ImEquation113">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}^{(trt)}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation114">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}^{(batch)}$\end{document}</tex-math></inline-formula> are orthogonal, we could also deflate <inline-formula><tex-math notation="LaTeX" id="ImEquation115">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}^{(notrt)}$\end{document}</tex-math></inline-formula> with respect to <inline-formula><tex-math notation="LaTeX" id="ImEquation116">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}^{(batch)}$\end{document}</tex-math></inline-formula> but such alternative would require adding the treatment variation back.</p>
        <p>
          <inline-graphic xlink:href="bbac622fx1.jpg" id="bbac622fx1"/>
        </p>
      </sec>
      <sec id="sec2b2">
        <title>Weighted PLSDA-batch</title>
        <p>A balanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation117">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment design is an experimental design where samples within each treatment group are evenly distributed across batches [<xref rid="ref6" ref-type="bibr">6</xref>]. Because of experimental constraints, a batch <inline-formula><tex-math notation="LaTeX" id="ImEquation118">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment design may be unbalanced, resulting in treatment and batch effects that are correlated and not separable. In PLSDA-batch, latent components associated with either treatment or batch effects are assumed to be orthogonal, thus ignoring the correlation between these two effects. The consequences might be over-estimation of the treatment variation as well as insufficient removal of the batch variation. Weighted PLSDA-batch (wPLSDA-batch) is inspired from weighted PCA to account for unbalanced designs [<xref rid="ref36" ref-type="bibr">36</xref>], but in the case of PLSDA-batch the weight is defined accordingly. Further details on defining the weights are described in the <xref rid="sup1" ref-type="supplementary-material">Supplemental Section S2</xref>. Each sample <inline-formula><tex-math notation="LaTeX" id="ImEquation119">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$i$\end{document}</tex-math></inline-formula> is assigned a weight <inline-formula><tex-math notation="LaTeX" id="ImEquation120">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$w_{i}$\end{document}</tex-math></inline-formula> to take into account the number of samples within each batch and treatment: <disp-formula id="deqn04"><label>(4)</label><tex-math notation="LaTeX" id="DmEquation5">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{align*}&amp; w_{i} = \sum_{b = 1}^{B} \sum_{c = 1}^{C}Y_{i,b}^{(batch)}Y_{i,c}^{(trt)} \frac{1}{\sqrt{n_{b,c}}}, \end{align*}\end{document}</tex-math></disp-formula>where <inline-formula><tex-math notation="LaTeX" id="ImEquation121">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$Y_{i,b}^{(batch)}$\end{document}</tex-math></inline-formula> represents the indicator value (0 or 1) of sample <inline-formula><tex-math notation="LaTeX" id="ImEquation122">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$i$\end{document}</tex-math></inline-formula> and batch <inline-formula><tex-math notation="LaTeX" id="ImEquation123">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$b$\end{document}</tex-math></inline-formula> in the dummy matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation124">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}^{(batch)}$\end{document}</tex-math></inline-formula>, and similarly for <inline-formula><tex-math notation="LaTeX" id="ImEquation125">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$Y_{i,c}^{(trt)}$\end{document}</tex-math></inline-formula>. <inline-formula><tex-math notation="LaTeX" id="ImEquation126">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$n_{b,c}$\end{document}</tex-math></inline-formula> represents the sample size in batch <inline-formula><tex-math notation="LaTeX" id="ImEquation127">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$b$\end{document}</tex-math></inline-formula> and treatment group <inline-formula><tex-math notation="LaTeX" id="ImEquation128">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$c$\end{document}</tex-math></inline-formula>. <inline-formula><tex-math notation="LaTeX" id="ImEquation129">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{W}$\end{document}</tex-math></inline-formula> is a diagonal matrix that includes <inline-formula><tex-math notation="LaTeX" id="ImEquation130">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$w_{i}$\end{document}</tex-math></inline-formula>, <inline-formula><tex-math notation="LaTeX" id="ImEquation131">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$i = 1, \dots , n$\end{document}</tex-math></inline-formula>. We obtain the weighted explanatory and response matrices <inline-formula><tex-math notation="LaTeX" id="ImEquation132">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}^{(weighted)}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation133">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}^{(weighted)}$\end{document}</tex-math></inline-formula> by multiplying <inline-formula><tex-math notation="LaTeX" id="ImEquation134">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation135">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula> with <inline-formula><tex-math notation="LaTeX" id="ImEquation136">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{W}$\end{document}</tex-math></inline-formula>, respectively. The batch-effect-corrected data <inline-formula><tex-math notation="LaTeX" id="ImEquation137">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}^{(nobatch \ \&amp; \ weighted)}$\end{document}</tex-math></inline-formula> resulting from the calculation on the weighted matrices using PLSDA-batch are then multiplied by <inline-formula><tex-math notation="LaTeX" id="ImEquation138">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{W}^{-1}$\end{document}</tex-math></inline-formula> to remove the influence of weights.</p>
      </sec>
      <sec id="sec2b3">
        <title>Sparse PLSDA-batch</title>
        <p>In PLSDA-batch, the latent components are calculated based on all variables, thus assuming that all microorganisms are affected by the treatment (e.g. antibiotics). In most microbial studies, we can instead make the assumption that only a small number of microorganisms are affected by the treatment [<xref rid="ref37" ref-type="bibr">37</xref>]. In that case, the batch-effect-corrected matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation139">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X}^{(nobatch)}$\end{document}</tex-math></inline-formula> may not be accurate as it depends on the calculation of the treatment components <inline-formula><tex-math notation="LaTeX" id="ImEquation140">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{T}^{(trt)}$\end{document}</tex-math></inline-formula>. These components are most likely to be affected by batch-related variables, especially when batch effect variability is high among samples.</p>
        <p>To avoid overfitting when we estimate the treatment components, we apply <inline-formula><tex-math notation="LaTeX" id="ImEquation141">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\ell _{1}$\end{document}</tex-math></inline-formula>-penalty to each treatment associated loading vector (see Eq. (<xref rid="deqn03" ref-type="disp-formula">3</xref>)) to select variables. Thus, variables with no treatment effect are assigned a zero loading value and are not included in the calculation of a component. Batch effects are assumed to be less microorganism specific than treatment effects. Thus, to ensure that the batch variation is fully captured, no variable selection is performed on the batch components.</p>
      </sec>
      <sec id="sec2b4">
        <title>Parameter tuning</title>
        <p>In PLSDA-batch, we need to specify the optimal number of components associated with either treatment or batch effects (<inline-formula><tex-math notation="LaTeX" id="ImEquation142">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$H^{(t)}$\end{document}</tex-math></inline-formula> or <inline-formula><tex-math notation="LaTeX" id="ImEquation143">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$H^{(b)}$\end{document}</tex-math></inline-formula>). To choose this parameter, we estimate the variance explained in the outcome matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation144">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}^{(trt)}$\end{document}</tex-math></inline-formula> on each treatment component <inline-formula><tex-math notation="LaTeX" id="ImEquation145">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{t}^{(trt)}_{h^{(t)}}$\end{document}</tex-math></inline-formula>, <inline-formula><tex-math notation="LaTeX" id="ImEquation146">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$h^{(t)} = 1,...,H^{(t)}$\end{document}</tex-math></inline-formula> and similarly for the batch-associated outcome matrix and components. We choose the optimal number of components that explain 100% variance in either <inline-formula><tex-math notation="LaTeX" id="ImEquation147">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}^{(trt)}$\end{document}</tex-math></inline-formula> or <inline-formula><tex-math notation="LaTeX" id="ImEquation148">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}^{(batch)}$\end{document}</tex-math></inline-formula>. The remainder components should only explain some (unknown) noise.</p>
        <p>In sPLSDA-batch, in addition to the parameter above, we also need to specify the optimal number of variables to select on each treatment component. For this purpose, we calculate the balanced classification error rate BER = <inline-formula><tex-math notation="LaTeX" id="ImEquation149">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\frac{\sum _{c=1}^{C}\frac{F_c}{T_c + F_c}}{C}$\end{document}</tex-math></inline-formula>), where <inline-formula><tex-math notation="LaTeX" id="ImEquation150">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$F_c$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation151">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$T_c$\end{document}</tex-math></inline-formula> represent the number of false and truly classified samples in the treatment group <inline-formula><tex-math notation="LaTeX" id="ImEquation152">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$c, c = 1, \dots , C$\end{document}</tex-math></inline-formula>, where <inline-formula><tex-math notation="LaTeX" id="ImEquation153">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$C$\end{document}</tex-math></inline-formula> represents the total number of treatment groups [<xref rid="ref38" ref-type="bibr">38</xref>]. The BER is evaluated through repeated cross-validation using the ‘maximum’ prediction distance as described in [<xref rid="ref34" ref-type="bibr">34</xref>] on a proposed grid of number of variables to select on each treatment component. The number of variables yielding the lowest BER is the optimal parameter.</p>
      </sec>
    </sec>
    <sec id="sec2g">
      <title>Simulation and case studies</title>
      <sec id="sec2g1">
        <title>Simulation study</title>
        <p>Microbiome data are multivariate with inherent correlation structure between microbial variables. The data are over-dispersed with a distribution close to a negative binomial distribution [<xref rid="ref39" ref-type="bibr">39</xref>, <xref rid="ref40" ref-type="bibr">40</xref>]. Inspired by [<xref rid="ref41" ref-type="bibr">41</xref>], we simulated data from multivariate negative binomial distribution achieved with quantile–quantile transformation between multivariate normal and negative binomial distributions. To add treatment and batch effects, we used matrix factorization to simulate the mean for modelling negative binomial distribution as a matrix <disp-formula><tex-math notation="LaTeX" id="DmEquation6">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$ \begin{align*} &amp;\boldsymbol{\Theta} = \begin{bmatrix} \theta_{11} &amp;... &amp; \theta_{1M}\\ ...&amp;... &amp;... \\ \theta_{1N} &amp;... &amp; \theta_{NM} \end{bmatrix} \end{align*} $$\end{document}</tex-math></disp-formula>for <inline-formula><tex-math notation="LaTeX" id="ImEquation154">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$N$\end{document}</tex-math></inline-formula> samples and <inline-formula><tex-math notation="LaTeX" id="ImEquation155">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$M$\end{document}</tex-math></inline-formula> microbial variables as follows: <disp-formula id="deqn05"><label>(5)</label><tex-math notation="LaTeX" id="DmEquation7">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{align*}&amp; \boldsymbol{\Theta} = exp(\boldsymbol{x}_{(trt)}^{\top}\boldsymbol{\beta}^{(trt)} + \boldsymbol{x}_{(batch)}^{\top}\boldsymbol{\beta}^{(batch)} + \boldsymbol{\epsilon}), \end{align*}\end{document}</tex-math></disp-formula>where <inline-formula><tex-math notation="LaTeX" id="ImEquation156">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{x}_{(trt)}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation157">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{x}_{(batch)}$\end{document}</tex-math></inline-formula> represent the design vectors of treatment and batch effects, respectively, for each sample. <inline-formula><tex-math notation="LaTeX" id="ImEquation158">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\beta }^{(trt)}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation159">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\beta }^{(batch)}$\end{document}</tex-math></inline-formula> represent the regression coefficients of treatment and batch effects for each microbial variable, and <inline-formula><tex-math notation="LaTeX" id="ImEquation160">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\beta ^{(trt)}_{j} \in N(\mu _{(trt)},\sigma _{(trt)}^{2})$\end{document}</tex-math></inline-formula>, <inline-formula><tex-math notation="LaTeX" id="ImEquation161">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\beta ^{(batch)}_{j} \in N(\mu _{(batch)},\sigma _{(batch)}^{2})$\end{document}</tex-math></inline-formula>. <inline-formula><tex-math notation="LaTeX" id="ImEquation162">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\epsilon }$\end{document}</tex-math></inline-formula> contains the random noise that is independent and identically distributed (i.i.d) and <inline-formula><tex-math notation="LaTeX" id="ImEquation163">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\epsilon _{ij} \in N(0,\delta ^{2})$\end{document}</tex-math></inline-formula>, in which <inline-formula><tex-math notation="LaTeX" id="ImEquation164">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$i = 1,2,...,N$\end{document}</tex-math></inline-formula> samples, <inline-formula><tex-math notation="LaTeX" id="ImEquation165">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$j = 1,2,..,M$\end{document}</tex-math></inline-formula> variables.</p>
        <p>The probability matrix <disp-formula><tex-math notation="LaTeX" id="DmEquation8">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$ \begin{align*} &amp;\boldsymbol{P} = \begin{bmatrix} p_{11} &amp;... &amp; p_{1M}\\ ...&amp;... &amp;... \\ p_{1N} &amp;... &amp; p_{NM} \end{bmatrix} \end{align*} $$\end{document}</tex-math></disp-formula>for modelling negative binomial distribution is calculated as <disp-formula id="deqn06"><label>(6)</label><tex-math notation="LaTeX" id="DmEquation9">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{align*}&amp; p_{ij} = \frac{r}{r + \theta_{ij}}, \end{align*}\end{document}</tex-math></disp-formula>where <inline-formula><tex-math notation="LaTeX" id="ImEquation166">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$p_{ij}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation167">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\theta _{ij}$\end{document}</tex-math></inline-formula> represent the probability of success in each trial and the mean for negative binomial distribution of sample <inline-formula><tex-math notation="LaTeX" id="ImEquation168">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$i$\end{document}</tex-math></inline-formula> and microbial variable <inline-formula><tex-math notation="LaTeX" id="ImEquation169">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$j$\end{document}</tex-math></inline-formula>, and <inline-formula><tex-math notation="LaTeX" id="ImEquation170">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$r$\end{document}</tex-math></inline-formula> is the dispersion parameter representing the number of successes.</p>
        <p>We then simulated a data matrix based on multivariate normal distribution with mean <inline-formula><tex-math notation="LaTeX" id="ImEquation171">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$0$\end{document}</tex-math></inline-formula> and correlation matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation172">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\Sigma }$\end{document}</tex-math></inline-formula>: <disp-formula id="deqn07"><label>(7)</label><tex-math notation="LaTeX" id="DmEquation10">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{align*}&amp; \boldsymbol{X^{normal}} = N(0, \boldsymbol{\Sigma}), \end{align*}\end{document}</tex-math></disp-formula>where the correlation matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation173">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\Sigma }$\end{document}</tex-math></inline-formula> was simulated with the strategy adapted from [<xref rid="ref42" ref-type="bibr">42</xref>] as follows: We first generated a lower triangular matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation174">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{L}$\end{document}</tex-math></inline-formula>, in which the diagonal elements follow <inline-formula><tex-math notation="LaTeX" id="ImEquation175">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$Unif(1.5, 2.5)$\end{document}</tex-math></inline-formula>, and the other elements <inline-formula><tex-math notation="LaTeX" id="ImEquation176">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$Unif(-1.5, 1.5)$\end{document}</tex-math></inline-formula>. We randomly set the elements outside the diagonal of <inline-formula><tex-math notation="LaTeX" id="ImEquation177">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{L}$\end{document}</tex-math></inline-formula> to zero with probability <inline-formula><tex-math notation="LaTeX" id="ImEquation178">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$0.7$\end{document}</tex-math></inline-formula>. A precision matrix, which is the inverse of covariance matrix, was created as <inline-formula><tex-math notation="LaTeX" id="ImEquation179">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{R}^{-1} = \boldsymbol{L}\boldsymbol{L}^{\top }$\end{document}</tex-math></inline-formula>. The corresponding correlation matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation180">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\Sigma }$\end{document}</tex-math></inline-formula> to <inline-formula><tex-math notation="LaTeX" id="ImEquation181">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{R}$\end{document}</tex-math></inline-formula> was then obtained. These parameters were set according to [<xref rid="ref42" ref-type="bibr">42</xref>].</p>
        <p>Thereafter we used Cumulative Distribution Function (CDF) to achieve quantile–quantile transformation as <disp-formula id="deqn08"><label>(8)</label><tex-math notation="LaTeX" id="DmEquation11">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{align*}&amp; CDF\left(x^{normal}_{ij}\right) = CDF\left(x^{nb}_{ij}\right), \end{align*}\end{document}</tex-math></disp-formula>where <inline-formula><tex-math notation="LaTeX" id="ImEquation182">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$CDF(x^{normal}_{ij})$\end{document}</tex-math></inline-formula> represents the cumulative probability of <inline-formula><tex-math notation="LaTeX" id="ImEquation183">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$x^{normal}_{ij}$\end{document}</tex-math></inline-formula> for sample <inline-formula><tex-math notation="LaTeX" id="ImEquation184">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$i$\end{document}</tex-math></inline-formula> and variable <inline-formula><tex-math notation="LaTeX" id="ImEquation185">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$j$\end{document}</tex-math></inline-formula> that belongs to matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation186">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X^{normal}}$\end{document}</tex-math></inline-formula> from multivariate normal distribution as Eq.(<xref rid="deqn07" ref-type="disp-formula">7</xref>). <inline-formula><tex-math notation="LaTeX" id="ImEquation187">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$CDF(x^{nb}_{ij})$\end{document}</tex-math></inline-formula> represents the cumulative probability of each <inline-formula><tex-math notation="LaTeX" id="ImEquation188">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$x^{nb}_{ij}$\end{document}</tex-math></inline-formula> in matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation189">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X^{nb}}$\end{document}</tex-math></inline-formula> from negative binomial distribution as Eq.(<xref rid="deqn09" ref-type="disp-formula">9</xref>).</p>
        <table-wrap position="float" id="TB1">
          <label>Table 1</label>
          <caption>
            <p><bold>Summary of simulation scenarios (two batch groups).</bold> For a given choice of parameters reported in this table, each simulation was repeated 50 times. <inline-formula><tex-math notation="LaTeX" id="ImEquation206">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$M^{(trt)}, M^{(batch)}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation207">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$M^{(trt \ \&amp; \ batch)}$\end{document}</tex-math></inline-formula> represent the number of variables with treatment, batch or both effects, respectively. Simulation 6 includes parameters likely to represent real data according to our experience in analysing microbiome datasets.</p>
          </caption>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1" align="left"/>
              <col span="2" align="left"/>
              <col span="3" align="left"/>
              <col span="4" align="left"/>
              <col span="5" align="left"/>
              <col span="6" align="left"/>
              <col span="7" align="left"/>
              <col span="8" align="left"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1">Parameters</th>
                <th rowspan="1" colspan="1">
                  <inline-formula>
                    <tex-math notation="LaTeX" id="ImEquation208">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mu _{(trt)}$\end{document}</tex-math>
                  </inline-formula>
                </th>
                <th rowspan="1" colspan="1">
                  <inline-formula>
                    <tex-math notation="LaTeX" id="ImEquation209">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\sigma _{(trt)}$\end{document}</tex-math>
                  </inline-formula>
                </th>
                <th rowspan="1" colspan="1">
                  <inline-formula>
                    <tex-math notation="LaTeX" id="ImEquation210">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mu _{(batch)}$\end{document}</tex-math>
                  </inline-formula>
                </th>
                <th rowspan="1" colspan="1">
                  <inline-formula>
                    <tex-math notation="LaTeX" id="ImEquation211">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\sigma _{(batch)}$\end{document}</tex-math>
                  </inline-formula>
                </th>
                <th rowspan="1" colspan="1">
                  <inline-formula>
                    <tex-math notation="LaTeX" id="ImEquation212">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$M^{(trt)}$\end{document}</tex-math>
                  </inline-formula>
                </th>
                <th rowspan="1" colspan="1">
                  <inline-formula>
                    <tex-math notation="LaTeX" id="ImEquation213">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$M^{(batch)}$\end{document}</tex-math>
                  </inline-formula>
                </th>
                <th rowspan="1" colspan="1">
                  <inline-formula>
                    <tex-math notation="LaTeX" id="ImEquation214">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$M^{(trt \ \&amp; \ batch)}$\end{document}</tex-math>
                  </inline-formula>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Simulation 1</td>
                <td rowspan="1" colspan="1">3</td>
                <td rowspan="1" colspan="1">1</td>
                <td rowspan="1" colspan="1">7</td>
                <td rowspan="1" colspan="1">{1,4,8}</td>
                <td rowspan="1" colspan="1">60</td>
                <td rowspan="1" colspan="1">150</td>
                <td rowspan="1" colspan="1">0</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Simulation 2</td>
                <td rowspan="1" colspan="1">{3,5,7}</td>
                <td rowspan="1" colspan="1">1</td>
                <td rowspan="1" colspan="1">7</td>
                <td rowspan="1" colspan="1">8</td>
                <td rowspan="1" colspan="1">60</td>
                <td rowspan="1" colspan="1">150</td>
                <td rowspan="1" colspan="1">0</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Simulation 3</td>
                <td rowspan="1" colspan="1">3</td>
                <td rowspan="1" colspan="1">{1,2,4}</td>
                <td rowspan="1" colspan="1">7</td>
                <td rowspan="1" colspan="1">8</td>
                <td rowspan="1" colspan="1">60</td>
                <td rowspan="1" colspan="1">150</td>
                <td rowspan="1" colspan="1">0</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Simulation 4</td>
                <td rowspan="1" colspan="1">3</td>
                <td rowspan="1" colspan="1">2</td>
                <td rowspan="1" colspan="1">7</td>
                <td rowspan="1" colspan="1">8</td>
                <td rowspan="1" colspan="1">{30,60,100,150}</td>
                <td rowspan="1" colspan="1">150</td>
                <td rowspan="1" colspan="1">0</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Simulation 5</td>
                <td rowspan="1" colspan="1">3</td>
                <td rowspan="1" colspan="1">2</td>
                <td rowspan="1" colspan="1">7</td>
                <td rowspan="1" colspan="1">8</td>
                <td rowspan="1" colspan="1">60</td>
                <td rowspan="1" colspan="1">{30,60,100,150}</td>
                <td rowspan="1" colspan="1">0</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Simulation 6</td>
                <td rowspan="1" colspan="1">3</td>
                <td rowspan="1" colspan="1">2</td>
                <td rowspan="1" colspan="1">7</td>
                <td rowspan="1" colspan="1">8</td>
                <td rowspan="1" colspan="1">60</td>
                <td rowspan="1" colspan="1">150</td>
                <td rowspan="1" colspan="1">{0,18,30,42,60}</td>
              </tr>
            </tbody>
          </table>
        </table-wrap>
        <table-wrap position="float" id="TB2">
          <label>Table 2</label>
          <caption>
            <p><bold>Unbalanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation216">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment design</bold> in the simulation study for two batch groups</p>
          </caption>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1" align="left"/>
              <col span="2" align="left"/>
              <col span="3" align="left"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1"/>
                <th rowspan="1" colspan="1">Trt1</th>
                <th rowspan="1" colspan="1">Trt2</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Batch1</td>
                <td rowspan="1" colspan="1">4</td>
                <td rowspan="1" colspan="1">16</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Batch2</td>
                <td rowspan="1" colspan="1">16</td>
                <td rowspan="1" colspan="1">4</td>
              </tr>
            </tbody>
          </table>
        </table-wrap>
        <p>Based on the cumulative probability from Eq.(<xref rid="deqn08" ref-type="disp-formula">8</xref>), we can simulate a data matrix <inline-formula><tex-math notation="LaTeX" id="ImEquation190">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{X^{nb}}$\end{document}</tex-math></inline-formula> with multivariate negative binomial distribution: <disp-formula id="deqn09"><label>(9)</label><tex-math notation="LaTeX" id="DmEquation12">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{align*}&amp; \boldsymbol{X^{nb}} = NB(r, \boldsymbol{P}, \boldsymbol{\Sigma}), \end{align*}\end{document}</tex-math></disp-formula>where <inline-formula><tex-math notation="LaTeX" id="ImEquation191">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$r$\end{document}</tex-math></inline-formula> represents the dispersion parameter, <inline-formula><tex-math notation="LaTeX" id="ImEquation192">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{P}$\end{document}</tex-math></inline-formula> represents the probability matrix and <inline-formula><tex-math notation="LaTeX" id="ImEquation193">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{\Sigma }$\end{document}</tex-math></inline-formula> the correlation matrix explaining the dependence structure between microbial variables.</p>
        <p>We simulated datasets with different parameters including amount of batch and treatment effects (<inline-formula><tex-math notation="LaTeX" id="ImEquation194">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mu _{(batch)}$\end{document}</tex-math></inline-formula>, <inline-formula><tex-math notation="LaTeX" id="ImEquation195">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mu _{(trt)}$\end{document}</tex-math></inline-formula>) and variability among variables (<inline-formula><tex-math notation="LaTeX" id="ImEquation196">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\sigma _{(batch)}$\end{document}</tex-math></inline-formula>, <inline-formula><tex-math notation="LaTeX" id="ImEquation197">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\sigma _{(trt)}$\end{document}</tex-math></inline-formula>), number of variables with batch and/or treatment effects (<inline-formula><tex-math notation="LaTeX" id="ImEquation198">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$M^{(batch)}$\end{document}</tex-math></inline-formula>, <inline-formula><tex-math notation="LaTeX" id="ImEquation199">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$M^{(trt)}$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation200">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$M^{(trt \ \&amp; \ batch)}$\end{document}</tex-math></inline-formula>), balanced and unbalanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation201">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment designs, as summarized in Table <xref rid="TB1" ref-type="table">1</xref>. The microbial variables with treatment or batch effects were randomly indexed in the data with non-zero <inline-formula><tex-math notation="LaTeX" id="ImEquation202">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\beta ^{(trt)}$\end{document}</tex-math></inline-formula> or <inline-formula><tex-math notation="LaTeX" id="ImEquation203">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\beta ^{(batch)}$\end{document}</tex-math></inline-formula>. The background noise <inline-formula><tex-math notation="LaTeX" id="ImEquation204">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\epsilon _{ij}$\end{document}</tex-math></inline-formula> was randomly sampled from <inline-formula><tex-math notation="LaTeX" id="ImEquation205">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$N(0,0.2^{2})$\end{document}</tex-math></inline-formula>, reflecting real microbiome datasets.</p>
        <p>We also simulated datasets with different number of batch groups:</p>
        <list list-type="simple">
          <list-item>
            <p>(1) Two batch groups: Each dataset included 300 variables and 40 samples grouped according to two treatments (trt1 and trt2) and two batches (batch1 and batch2). The balanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation215">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment experimental design included 10 samples from two batches, respectively, in each treatment group. The unbalanced design included 4 and 16 samples from batch1 and batch2, respectively, in trt1, 16 and 4 samples from batch1 and batch2 in trt2 (see Table <xref rid="TB2" ref-type="table">2</xref>).</p>
          </list-item>
          <list-item>
            <p>(2) Three batch groups: Each dataset included 300 variables and 36 samples grouped according to two treatments (trt1 and trt2) and three batches (batch1, batch2 and batch3). The balanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation217">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment experimental design included six samples from three batches, respectively, in each treatment group. The unbalanced design included 2, 10 and 2 samples from batch1, batch2 and batch3, respectively, in trt1, 10, 2 and 10 samples from batch1, batch2 and batch3 in trt2 (see Table <xref rid="TB3" ref-type="table">3</xref>).</p>
          </list-item>
        </list>
        <table-wrap position="float" id="TB3">
          <label>Table 3</label>
          <caption>
            <p><bold>Unbalanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation218">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment design</bold> in the simulation study for three batch groups</p>
          </caption>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1" align="left"/>
              <col span="2" align="left"/>
              <col span="3" align="left"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1"/>
                <th rowspan="1" colspan="1">Trt1</th>
                <th rowspan="1" colspan="1">Trt2</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Batch1</td>
                <td rowspan="1" colspan="1">2</td>
                <td rowspan="1" colspan="1">10</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Batch2</td>
                <td rowspan="1" colspan="1">10</td>
                <td rowspan="1" colspan="1">2</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Batch3</td>
                <td rowspan="1" colspan="1">2</td>
                <td rowspan="1" colspan="1">10</td>
              </tr>
            </tbody>
          </table>
        </table-wrap>
        <p>In addition, we simulated a ground-truth dataset that only included treatment effects and background noise without batch effects to evaluate batch effect correction methods.</p>
        <p>Our simulations generate over-dispersed count data with batch and treatment effects as well as correlation structure among variables, but without any compositional structure. We therefore only applied natural log transformation to the simulated data prior to analysis.</p>
        <p>In these simulation scenarios, for PLSDA-batch we set <inline-formula><tex-math notation="LaTeX" id="ImEquation219">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$C-1$\end{document}</tex-math></inline-formula> (or <inline-formula><tex-math notation="LaTeX" id="ImEquation220">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$B-1$\end{document}</tex-math></inline-formula>) components associated with treatment (or batch) effects (where <inline-formula><tex-math notation="LaTeX" id="ImEquation221">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$C$\end{document}</tex-math></inline-formula> and <inline-formula><tex-math notation="LaTeX" id="ImEquation222">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$B$\end{document}</tex-math></inline-formula> represent the total number of treatment and batch groups respectively) as <inline-formula><tex-math notation="LaTeX" id="ImEquation223">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$C-1$\end{document}</tex-math></inline-formula> (<inline-formula><tex-math notation="LaTeX" id="ImEquation224">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$B-1$\end{document}</tex-math></inline-formula>) components are likely to explain 100% variance in <inline-formula><tex-math notation="LaTeX" id="ImEquation225">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula>. The number of variables with a true treatment effect (<inline-formula><tex-math notation="LaTeX" id="ImEquation226">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$M^{(trt)}$\end{document}</tex-math></inline-formula>) is set as the optimal number to select on each treatment component in sPLSDA-batch.</p>
      </sec>
      <sec id="sec2g2">
        <title>Case studies</title>
        <p>We analysed three 16S rRNA amplicon datasets at the operational taxonomic unit (OTU). The count data were filtered to alleviate sparsity and transformed with Centered Log Ratio (CLR) transformation [<xref rid="ref43" ref-type="bibr">43</xref>]. CLR is a pragmatic way to handle both uneven library sizes and compositional structure in real data [<xref rid="ref37" ref-type="bibr">37</xref>]. It also helps reducing skewness in the data.</p>
        <p><bold>Sponge A. aerophoba.</bold> This study investigated the relationship between metabolite concentration and microbial abundance on specific sponge tissues [<xref rid="ref44" ref-type="bibr">44</xref>]. The dataset includes the relative abundance of 24 OTUs and 32 samples collected from two tissue types (Ectosome versus Choanosome) and processed on two separate denaturing gradient gels in electrophoresis. The tissue variation is the effect of interest, while the gel variation is the batch effect. This study includes a batch effect with similar variation to the treatment effect, and a completely balanced batch x treatment design. The sponge study enables us to assess the efficacy of batch effect correction methods in such circumstance.</p>
        <p><bold>Anaerobic digestion.</bold> This study explored the microbial indicators that could improve the efficacy of anaerobic digestion (AD) bioprocess and prevent its failure [<xref rid="ref45" ref-type="bibr">45</xref>]. The dataset includes 231 OTUs and 75 samples treated with two different ranges of phenol concentration (effects of interest). These samples were processed at five different dates corresponding to batch effects. This study includes a strong batch effect compared with the treatment effect, with an approximately balanced batch x treatment design. The AD dataset enables us to assess whether batch effect correction methods are able to remove sufficient batch variation in this case.</p>
        <p><bold>High fat high sugar diet.</bold> This study aimed to investigate the effect of high fat high sugar (HFHS) diet on the mouse microbiome [<xref rid="ref37" ref-type="bibr">37</xref>]. This dataset includes 515 OTUs and 149 samples collected at day 1, 4 and 7 from the mice treated with two types of diets (HFHS versus normal). The diet variation is the treatment effect, while the day variation constitutes a potential batch effect, which is actually weak. The HFHS study enables us to assess whether batch effect correction methods are able to preserve treatment variation when batch effects are small. </p>
        <p>For the PLSDA-batch analyses, we chose the number of components that explained 100% variance in <inline-formula><tex-math notation="LaTeX" id="ImEquation227">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{Y}$\end{document}</tex-math></inline-formula> associated with either treatment or batch effects (Sponge data: one treatment component, one batch component; AD data: one treatment component, four batch components and HFHS data: one treatment component, two batch components). For sPLSDA-batch, we chose the number of variables to select on each treatment component that yielded the lowest BER from repeated cross-validation with four folds and 50 repeats (Sponge data: one variable; AD data: 100 variables and HFHS data: two variables).</p>
      </sec>
    </sec>
    <sec id="sec2j">
      <title>Benchmarking and assessment of batch effect removal</title>
      <p>We compared our approaches with removeBatchEffect, ComBat and SVA. These methods are univariate and were originally developed for gene expression data from microarray or RNA-sequencing. They have been used extensively in microbiome studies [<xref rid="ref30" ref-type="bibr">30–32</xref>, <xref rid="ref46" ref-type="bibr">46</xref>, <xref rid="ref47" ref-type="bibr">47</xref>] even though they would require further developments to be adapted to the inherent characteristics of microbiome data. These methods’ limitations include the inability to deal with non-Gaussian distribution, small sample sizes and dependence between microbial variables. Similar to the aim of our proposed methods, RemoveBatchEffect and ComBat correct for batch effects to generate batch effect-free data for downstream analysis, while SVA accounts for batch effects. Both our approaches and SVA attempt to preserve treatment variation prior to batch effect management to avoid information loss, but the algorithms used to achieve this purpose differ. However, SVA estimates and accounts for unknown batch effects, which may result in overfitting the data, compared with our approaches. Further details on these methods are described in the <xref rid="sup1" ref-type="supplementary-material">Supplemental Section S1</xref>. We used a wide range of performance measures to evaluate whether these methods are effective in managing batch effects while preserving treatment effects. These include classical accuracy measures used in simulation studies where we know the ground-truth, that is, we know which variables include batch and/or treatment effects [<xref rid="ref16" ref-type="bibr">16</xref>], as well as multivariate and univariate approaches to measure the proportion of variance explained by batch and treatment effects after batch effect removal.</p>
      <sec id="sec2j1">
        <title>Accuracy measures (simulation study only)</title>
        <p>We identified variables with a true treatment effect after correcting or accounting for batch effects using two approaches:</p>
        <list list-type="simple">
          <list-item>
            <p>(1) Univariate one-way analysis of variance ANOVA) [<xref rid="ref48" ref-type="bibr">48</xref>] to identify differentially abundant taxa between treatment groups (Benjamini–Hochberg adjusted <italic toggle="yes">P</italic>-value <inline-formula><tex-math notation="LaTeX" id="ImEquation228">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$&lt; 0.05$\end{document}</tex-math></inline-formula>) followed by accuracy measures described below,</p>
          </list-item>
          <list-item>
            <p>(2) Multivariate sparse PLSDA to identify taxa that discriminate treatment groups followed by Area Under the Curve of Receiver Operating Characteristics (AUC-ROC).</p>
          </list-item>
        </list>
        <p>We measured the accuracy of the selected variables from one-way ANOVA using Precision (<inline-formula><tex-math notation="LaTeX" id="ImEquation229">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\frac{TP}{TP+FP}$\end{document}</tex-math></inline-formula>), Recall (<inline-formula><tex-math notation="LaTeX" id="ImEquation230">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\frac{TP}{TP+FN}$\end{document}</tex-math></inline-formula>) and <inline-formula><tex-math notation="LaTeX" id="ImEquation231">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$F_{1}$\end{document}</tex-math></inline-formula> score (<inline-formula><tex-math notation="LaTeX" id="ImEquation232">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$2^*\frac{Precision*Recall}{Precision+Recall}$\end{document}</tex-math></inline-formula>), where <inline-formula><tex-math notation="LaTeX" id="ImEquation233">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$TP$\end{document}</tex-math></inline-formula> is the number of true positives—the variables assigned with treatment effects in the simulation and correctly identified; <inline-formula><tex-math notation="LaTeX" id="ImEquation234">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$FP$\end{document}</tex-math></inline-formula> the number of false positives—the variables without treatment effects but wrongly identified; <inline-formula><tex-math notation="LaTeX" id="ImEquation235">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$FN$\end{document}</tex-math></inline-formula> the number of false negatives—the variables with treatment effects that were not identified. A high precision indicates an accurate model with a low number of false positives, while a high recall indicates a sensitive model with a low number of false negatives. The <inline-formula><tex-math notation="LaTeX" id="ImEquation236">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$F_{1}$\end{document}</tex-math></inline-formula> score balances both precision and recall, with a high score indicating a model with good accuracy and sensitivity.</p>
        <p>We measured the accuracy of the selected variables from sPLSDA using AUC-ROC. As SVA does not generate batch-effect-corrected data, we only considered the Precision, Recall and <inline-formula><tex-math notation="LaTeX" id="ImEquation237">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$F_{1}$\end{document}</tex-math></inline-formula> score for this approach.</p>
      </sec>
      <sec id="sec2j2">
        <title>Proportion of explained variance across all variables</title>
        <p>We used the multivariate method partial redundancy analysis (pRDA) in the batch-effect-corrected data to calculate the proportion of variance explained by treatment, batch effects and, most importantly, their intersection [<xref rid="ref6" ref-type="bibr">6</xref>, <xref rid="ref49" ref-type="bibr">49</xref>]. The intersectional variance quantifies the unbalance in the batch <inline-formula><tex-math notation="LaTeX" id="ImEquation238">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment design. A null value indicates a completely balanced design.</p>
      </sec>
      <sec id="sec2j3">
        <title>Proportion of explained variance for each variable</title>
        <p>We used the <inline-formula><tex-math notation="LaTeX" id="ImEquation239">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$R^2$\end{document}</tex-math></inline-formula> value estimated with one-way ANOVA to calculate the proportion of variance explained by treatment or batch effects for each variable. The <inline-formula><tex-math notation="LaTeX" id="ImEquation240">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$R^2$\end{document}</tex-math></inline-formula> values with either treatment or batch effects were then visualized with boxplots. We also considered the sum of all the <inline-formula><tex-math notation="LaTeX" id="ImEquation241">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$R^2$\end{document}</tex-math></inline-formula> values to compare the methods globally.</p>
      </sec>
      <sec id="sec2j4">
        <title>Principal Component Analysis (case studies only)</title>
        <p>We investigated the variance structure of the data before and after batch effect correction using PCA. If batch effects account for the largest proportion of variance in the data, we expect a separation of the samples from different batches on the first component [<xref rid="ref6" ref-type="bibr">6</xref>].</p>
      </sec>
      <sec id="sec2j5">
        <title>Alignment scores (case studies only)</title>
        <p>We used the alignment score proposed for single-cell RNA-seq datasets integration [<xref rid="ref50" ref-type="bibr">50</xref>]. We extended the approach that was originally developed based on canonical correlation analysis for PCA. This score complements the qualitative results from PCA to evaluate the degree of mixing samples from different batches in the batch-effect-corrected data. The alignment score ranges from 0 to 1 (poor to excellent mixing samples among the different batches). We first perform a PCA on a given batch-effect-corrected matrix to calculate a sample dissimilarity matrix based on the principal components that explained at least 95% of the total variance. Based on this dissimilarity matrix, the alignment score is defined as <disp-formula id="deqn10"><label>(10)</label><tex-math notation="LaTeX" id="DmEquation13">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{align*}&amp; \mbox{Alignment Score} = 1-\frac{\bar{x}-\frac{k}{n}}{k-\frac{k}{n}}, \end{align*}\end{document}</tex-math></disp-formula>where <inline-formula><tex-math notation="LaTeX" id="ImEquation242">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$k$\end{document}</tex-math></inline-formula> represents the number of nearest neighbours and <inline-formula><tex-math notation="LaTeX" id="ImEquation243">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$n$\end{document}</tex-math></inline-formula> represents the sample size. <inline-formula><tex-math notation="LaTeX" id="ImEquation244">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$x$\end{document}</tex-math></inline-formula> is the number of each sample’s <inline-formula><tex-math notation="LaTeX" id="ImEquation245">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$k$\end{document}</tex-math></inline-formula> nearest neighbours that belong to the same batch and <inline-formula><tex-math notation="LaTeX" id="ImEquation246">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\bar{x}$\end{document}</tex-math></inline-formula> represents the average of all <inline-formula><tex-math notation="LaTeX" id="ImEquation247">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$x$\end{document}</tex-math></inline-formula>. In our case studies, we chose <inline-formula><tex-math notation="LaTeX" id="ImEquation248">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$k = 0.1*n$\end{document}</tex-math></inline-formula>, a value deemed reasonable for the sample size of our data.</p>
        <p>Note that this score relies on PCA projection to calculate the nearest neighbours. It is only relevant to compare several PCA dissimilarity matrices (resulting from the batch-effect-corrected matrices with different methods) where the samples have similar sample distribution in their PCA projection.</p>
      </sec>
    </sec>
  </sec>
  <sec id="sec3">
    <title>Results</title>
    <p>We benchmarked our three PLSDA-batch methods with removeBatchEffect, ComBat and SVA on the simulated datasets, then against the former two on the three case studies.</p>
    <sec id="sec3a">
      <title>Simulation studies</title>
      <p>We first describe the results from a single simulation scenario with two batch groups where parameters were representative of real data, namely, <inline-formula><tex-math notation="LaTeX" id="ImEquation249">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mu _{(trt)} = 3, \sigma _{(trt)} = 2, \mu _{(batch)} = 7, \sigma _{(batch)} = 8, M^{(trt)} = 100, M^{(batch)} = 200, M^{(trt \ \&amp; \ batch)} = 50$\end{document}</tex-math></inline-formula>. The results for the other scenarios are summarized in <xref rid="sup1" ref-type="supplementary-material">Supplemental Figures S1</xref>–<xref rid="sup1" ref-type="supplementary-material">S6</xref>.</p>
      <sec id="sec3a1">
        <title>pRDA assessment</title>
        <p>Efficient batch effect correction methods should generate data with a null proportion of variance explained by batch effects, and a proportion of variance explained by treatment that is larger compared with the original data, as shown in Figure <xref rid="f2" ref-type="fig">2</xref><bold>A</bold> original data and ground-truth data.</p>
        <fig position="float" id="f2">
          <label>Figure 2</label>
          <caption>
            <p>Simulation studies (two batch groups): comparison of explained variance before and after batch effect correction for <bold>(A)</bold> balanced and <bold>(B)</bold> unbalanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation250">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment designs. The method pRDA estimated the proportion of variance explained by (from top to bottom) residuals, batch effects, intersection of batch and treatment effects and treatment effects. All methods performed equally well in removing batch variance for a balanced design except ComBat, while in an unbalanced design, our weighted variants wPLSDA-batch and swPLSDA-batch performed better than their unweighted counterparts.</p>
          </caption>
          <graphic xlink:href="bbac622f2" position="float"/>
        </fig>
        <p>For a balanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation251">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment design, we observed no intersection shared between treatment and batch variance, as expected. All methods successfully removed batch variance and preserved (or slightly increased) treatment variance (sPLSDA-batch), with the exception of ComBat where a very small amount of batch variance remained.</p>
        <p>For a strong unbalanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation252">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment design (Figure <xref rid="f2" ref-type="fig">2</xref><bold>B</bold>), we observed the presence of intersectional variance explained by both batch and treatment effects, as expected. This source of variance is also present in the ground-truth data but should be smaller compared with the uncorrected data. Both unweighted PLSDA-batch and sPLSDA-batch performed poorly for such design—for PLSDA-batch the intersectional variance increased, while for sPLSDA-batch the batch variance was not entirely removed. The other methods were successful in removing batch variance. removeBatchEffect and ComBat explained a proportion of variance by treatment similar to the ground-truth data, while wPLSDA-batch and swPLSDA-batch explained slightly less treatment variance.</p>
      </sec>
      <sec id="sec3a2">
        <title><inline-formula><tex-math notation="LaTeX" id="ImEquation253">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$R^2$\end{document}</tex-math></inline-formula> assessment</title>
        <p>We estimated the proportion of variance explained by treatment and batch effects for each variable using the <inline-formula><tex-math notation="LaTeX" id="ImEquation254">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$R^2$\end{document}</tex-math></inline-formula> value.</p>
        <p>In the balanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation255">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment design (Figure <xref rid="f3" ref-type="fig">3</xref><bold>A</bold>), removeBatchEffect and PLSDA-batch had the best performance, with results very similar to the ground-truth data. ComBat retained more batch variance of variables with batch effects only, and with both batch and treatment effects, indicating an incomplete removal of batch effects. This result is in agreement with the overall pRDA evaluation described earlier. For sPLSDA-batch, variables with no treatment effect (batch effects only) included a slight amount of (spurious) treatment variance. This was also observed in pRDA evaluation. However, sPLSDA-batch performed as well as PLSDA-batch when the simulated data did not include variables with both batch and treatment effects.</p>
        <fig position="float" id="f3">
          <label>Figure 3</label>
          <caption>
            <p>Simulation studies (two batch groups): <inline-formula><tex-math notation="LaTeX" id="ImEquation256">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{R^2}$\end{document}</tex-math></inline-formula> values for each microbial variable before and after batch effect correction for <bold>(A)</bold> balanced and <bold>(B)</bold> unbalanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation257">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment designs. Each box represents a summary of <inline-formula><tex-math notation="LaTeX" id="ImEquation258">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$R^2$\end{document}</tex-math></inline-formula> values for variables simulated with the associated effects (batch or/and treatment effects). Each <inline-formula><tex-math notation="LaTeX" id="ImEquation259">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$R^2$\end{document}</tex-math></inline-formula> value was fitted for each variable from a one-way ANOVA with a treatment effect or batch effect as covariate (x-axis). The colours indicate the effects assigned to each variable. In both designs, ComBat did not remove enough batch variation. For the balanced design, sPLSDA-batch generated slightly spurious treatment variation for the variables with batch effects only. For the unbalanced design, wPLSDA-batch and swPLSDA-batch generated data with less treatment variation for the variables with both treatment and batch effects compared with the ground-truth data.</p>
          </caption>
          <graphic xlink:href="bbac622f3" position="float"/>
        </fig>
        <p>We observed similar performance for removeBatchEffect and ComBat for the unbalanced design (Figure <xref rid="f3" ref-type="fig">3</xref><bold>B</bold>). With wPLSDA-batch and swPLSDA-batch, variables with both treatment and batch effects explained less treatment variance after correction, compared with the ground-truth data. However, for the other variables, wPLSDA-batch and its sparse version performed as similar as the ground-truth data.</p>
        <p>The sum of all the <inline-formula><tex-math notation="LaTeX" id="ImEquation260">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$R^2$\end{document}</tex-math></inline-formula> values showed similar results (<xref rid="sup1" ref-type="supplementary-material">Supplemental Figure S7</xref>).</p>
      </sec>
      <sec id="sec3a3">
        <title>Accuracy measures</title>
        <p>The results from the accuracy measures combined with variable selection highlight the importance of removing batch effects as both F1 score and AUC largely improved compared with the original data (Table <xref rid="TB4" ref-type="table">4</xref>).</p>
        <table-wrap position="float" id="TB4">
          <label>Table 4</label>
          <caption>
            <p><bold>Simulation studies (two batch groups): summary of accuracy measurements before and after batch effect correction.</bold> The proportion of correctly identified microbial variables with a true treatment effect was assessed with Precision, Recall, F1 score (using one-way ANOVA as variable selection procedure) and AUC (using sPLSDA as variable selection procedure). Each value is the mean (or standard deviation) over 50 repeats.</p>
          </caption>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1" align="left"/>
              <col span="2" align="left"/>
              <col span="3" align="left"/>
              <col span="4" align="left"/>
              <col span="5" align="left"/>
              <col span="6" align="left"/>
              <col span="7" align="left"/>
              <col span="8" align="left"/>
              <col span="9" align="left"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1"/>
                <th rowspan="1" colspan="1"/>
                <th rowspan="1" colspan="1">Before correction</th>
                <th rowspan="1" colspan="1">ground-truth data</th>
                <th rowspan="1" colspan="1">SVA</th>
                <th rowspan="1" colspan="1">removeBatchEffect</th>
                <th rowspan="1" colspan="1">ComBat</th>
                <th rowspan="1" colspan="1">PLSDA-batch</th>
                <th rowspan="1" colspan="1">sPLSDA-batch</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Balanced</td>
                <td rowspan="1" colspan="1">Precision</td>
                <td rowspan="1" colspan="1"><bold>0.984</bold> (0.04)</td>
                <td rowspan="1" colspan="1">0.952 (0.08)</td>
                <td rowspan="1" colspan="1">0.957 (0.06)</td>
                <td rowspan="1" colspan="1">0.950 (0.09)</td>
                <td rowspan="1" colspan="1">0.952 (0.08)</td>
                <td rowspan="1" colspan="1">0.952 (0.08)</td>
                <td rowspan="1" colspan="1">0.807 (0.11)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1"/>
                <td rowspan="1" colspan="1">Recall</td>
                <td rowspan="1" colspan="1">0.674 (0.03)</td>
                <td rowspan="1" colspan="1">0.900 (0.03)</td>
                <td rowspan="1" colspan="1"><bold>0.934</bold> (0.03)</td>
                <td rowspan="1" colspan="1">0.910 (0.03)</td>
                <td rowspan="1" colspan="1">0.911 (0.03)</td>
                <td rowspan="1" colspan="1">0.910 (0.03)</td>
                <td rowspan="1" colspan="1">0.910 (0.03)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1"/>
                <td rowspan="1" colspan="1">F1</td>
                <td rowspan="1" colspan="1">0.799 (0.02)</td>
                <td rowspan="1" colspan="1">0.923 (0.05)</td>
                <td rowspan="1" colspan="1"><bold>0.944</bold> (0.04)</td>
                <td rowspan="1" colspan="1">0.927 (0.05)</td>
                <td rowspan="1" colspan="1">0.929 (0.05)</td>
                <td rowspan="1" colspan="1">0.929 (0.05)</td>
                <td rowspan="1" colspan="1">0.851 (0.06)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1"/>
                <td rowspan="1" colspan="1">AUC</td>
                <td rowspan="1" colspan="1">0.944 (0.02)</td>
                <td rowspan="1" colspan="1">0.964 (0.02)</td>
                <td rowspan="1" colspan="1">/</td>
                <td rowspan="1" colspan="1">0.968 (0.02)</td>
                <td rowspan="1" colspan="1">0.968 (0.02)</td>
                <td rowspan="1" colspan="1"><bold>0.969</bold> (0.01)</td>
                <td rowspan="1" colspan="1">0.954 (0.02)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1"/>
                <td rowspan="1" colspan="1"/>
                <td rowspan="1" colspan="1">Before correction</td>
                <td rowspan="1" colspan="1">ground-truth data</td>
                <td rowspan="1" colspan="1">SVA</td>
                <td rowspan="1" colspan="1">removeBatchEffect</td>
                <td rowspan="1" colspan="1">ComBat</td>
                <td rowspan="1" colspan="1">wPLSDA-batch</td>
                <td rowspan="1" colspan="1">swPLSDA-batch</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Unbalanced</td>
                <td rowspan="1" colspan="1">Precision</td>
                <td rowspan="1" colspan="1">0.385 (0.01)</td>
                <td rowspan="1" colspan="1"><bold>0.973</bold> (0.05)</td>
                <td rowspan="1" colspan="1">0.401 (0.02)</td>
                <td rowspan="1" colspan="1">0.901 (0.09)</td>
                <td rowspan="1" colspan="1">0.834 (0.08)</td>
                <td rowspan="1" colspan="1">0.943 (0.05)</td>
                <td rowspan="1" colspan="1">0.943 (0.05)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1"/>
                <td rowspan="1" colspan="1">Recall</td>
                <td rowspan="1" colspan="1">0.825 (0.03)</td>
                <td rowspan="1" colspan="1">0.895 (0.03)</td>
                <td rowspan="1" colspan="1">0.918 (0.03)</td>
                <td rowspan="1" colspan="1">0.910 (0.03)</td>
                <td rowspan="1" colspan="1"><bold>0.919</bold> (0.03)</td>
                <td rowspan="1" colspan="1">0.888 (0.03)</td>
                <td rowspan="1" colspan="1">0.862 (0.03)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1"/>
                <td rowspan="1" colspan="1">F1</td>
                <td rowspan="1" colspan="1">0.525 (0.01)</td>
                <td rowspan="1" colspan="1"><bold>0.932</bold> (0.03)</td>
                <td rowspan="1" colspan="1">0.558 (0.02)</td>
                <td rowspan="1" colspan="1">0.903 (0.05)</td>
                <td rowspan="1" colspan="1">0.873 (0.05)</td>
                <td rowspan="1" colspan="1">0.914 (0.03)</td>
                <td rowspan="1" colspan="1">0.900 (0.03)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1"/>
                <td rowspan="1" colspan="1">AUC</td>
                <td rowspan="1" colspan="1">0.704 (0.06)</td>
                <td rowspan="1" colspan="1"><bold>0.967</bold> (0.02)</td>
                <td rowspan="1" colspan="1">/</td>
                <td rowspan="1" colspan="1">0.963 (0.02)</td>
                <td rowspan="1" colspan="1">0.962 (0.01)</td>
                <td rowspan="1" colspan="1">0.965 (0.01)</td>
                <td rowspan="1" colspan="1">0.954 (0.02)</td>
              </tr>
            </tbody>
          </table>
        </table-wrap>
        <p>In the balanced design, starting from the original data compared with the ground-truth data, selected variables had a higher precision, lower recall and lower AUC, indicating a smaller number of variables selected with an actual treatment effect. Combined with univariate one-way ANOVA, SVA performed best with the highest, and sometimes greater, accuracy measurements than the ground-truth data, as we discuss below. The other methods led to similar performance with the exception of sPLSDA-batch, which selected more false positives than the other methods. PLSDA-batch led to a slightly better AUC than the other methods.</p>
        <p>In the unbalanced design, the precision of SVA is low and very similar to the original data, indicating that the performance of SVA heavily depends on the experimental design and is likely to overfit. This may explain the somewhat inflated results of SVA in the balanced design case. wPLSDA-batch performed best with results close to those from the ground-truth data.</p>
        <p>We observed similar results but with higher resolution of these accuracy measures for the other simulation scenarios presented in <xref rid="sup1" ref-type="supplementary-material">Supplemental Figures S1</xref>–<xref rid="sup1" ref-type="supplementary-material">S6</xref> and discussed in the <xref rid="sup1" ref-type="supplementary-material">Supplemental Section S3.1</xref>. For simulations with three batch groups (parameters <inline-formula><tex-math notation="LaTeX" id="ImEquation261">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mu _{(trt)} = 3, \sigma _{(trt)} = 2, \mu _{(batch)} = 7, \sigma _{(batch)} = 8, M^{(trt)} = 100, M^{(batch)} = 200, M^{(trt \ \&amp; \ batch)} = 50$\end{document}</tex-math></inline-formula>), we also observed similar results as the two batch group cases (<xref rid="sup1" ref-type="supplementary-material">Supplemental Figures S8</xref>, <xref rid="sup1" ref-type="supplementary-material">S9</xref> and <xref rid="sup1" ref-type="supplementary-material">S10</xref> and <xref rid="sup1" ref-type="supplementary-material">Table S1</xref>).</p>
      </sec>
      <sec id="sec3a4">
        <title>Summary of the simulation results</title>
        <p>Our extensive simulation studies showed that weighted PLSDA-batch was essential for an unbalanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation262">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment design, compared with its unweighted counterpart. Our PLSDA-batch method preserved similar or slightly smaller proportion of treatment variance compared with the other batch effect correction methods, but achieved a higher F1 score and AUC especially in an unbalanced design. When there was no variables with both treatment and batch effects in the data, sPLSDA-batch- and PLSDA-batch-corrected data were close to the ground-truth data. However, when some variables included both these effects, sPLSDA-batch performed slightly worse than PLSDA-batch. Our results also suggested that SVA had a tendency to overfit the data, while ComBat was not able to completely remove batch variation. removeBatchEffect was not able to preserve enough treatment effects for accurate variable identification.</p>
      </sec>
    </sec>
    <sec id="sec3f">
      <title>Case studies</title>
      <sec id="sec3f1">
        <title>PCA</title>
        <p>In the sponge data (Figure <xref rid="f4" ref-type="fig">4</xref><bold>A</bold>), 24% of the total data variance was explained by the first principal component, which highlighted a strong difference of samples across different tissues (the effect of interest). The batch variation accounted for 21% of the total variance in the second component. Thus, in this study, batch effects are smaller than the treatment effects. After batch effect correction, the difference between batches became barely distinct (Figure <xref rid="f4" ref-type="fig">4</xref><bold>B–E</bold>), except for ComBat-corrected data where a clear separation of the samples from two batches for the Choanosome tissue could still be observed. The variance explained by the first principal component that separated the different tissue types was increased in all of the corrected data, with PLSDA-batch and sPLSDA-batch resulting in the second highest proportion of variance (27%) next to ComBat (28%).</p>
        <fig position="float" id="f4">
          <label>Figure 4</label>
          <caption>
            <p>PCA sample plots of the sponge data <bold>(A)</bold> before or after batch effect correction using <bold>(B)</bold> removeBatchEffect, <bold>(C)</bold> ComBat, <bold>(D)</bold> PLSDA-batch or <bold>(E)</bold> sPLSDA-batch. The colours represent the effect of interest (tissue types), and shapes the batch types. ComBat did not remove enough batch variation, as samples still present a batch separation within the cluster of Choanosome.</p>
          </caption>
          <graphic xlink:href="bbac622f4" position="float"/>
        </fig>
        <p>In the AD study (<xref rid="sup1" ref-type="supplementary-material">Supplemental Figure S11</xref>), batch variation was removed after correction from all methods. PLSDA-batch performed the best as the proportion of variance explained by the first component that was highly relevant to treatment variation was larger than the explained variance for any other method.</p>
        <p>In the HFHS data, the PCA plot indicated that batch variation was only observed in one treatment group and was very weak (<xref rid="sup1" ref-type="supplementary-material">Supplemental Figure S12</xref>). After batch effect correction, the batch difference was removed and the proportion of variance explained by the first component (related to treatment effects) was slightly improved, indicating that treatment variation was still preserved. This case study shows that batch effect correction methods are still relevant when batch effects are very weak. However, sPLSDA-batch performed the worst with a loss of treatment variance, indicating this method is not appropriate to correct for very weak batch effects.</p>
      </sec>
      <sec id="sec3f2">
        <title>Alignment scores</title>
        <p>The alignment scores complement the PCA results when batch effect removal is difficult to assess on PCA sample plots. In Figure <xref rid="f5" ref-type="fig">5</xref>, we observed that the samples across different batches were better mixed after batch effect correction with different methods compared with the original data.</p>
        <fig position="float" id="f5">
          <label>Figure 5</label>
          <caption>
            <p><bold>Comparison of alignment scores</bold> for <bold>(A)</bold> sponge data, <bold>(B)</bold> AD data and <bold>(C)</bold> HFHS data before and after batch effect correction using different methods. A large alignment score indicates that samples from different batches are well mixed based on the PCA dissimilarity matrix. The alignment scores between methods can only be compared when samples have similar sample distribution in their PCA projection, i.e. for sponge and HFHS data. In these two case studies, our method PLSDA-batch had a better performance than the univariate methods ComBat and removeBatchEffect.</p>
          </caption>
          <graphic xlink:href="bbac622f5" position="float"/>
        </fig>
        <p>In the sponge study, the data corrected using PLSDA-batch and sPLSDA-batch had higher alignment scores than using removeBatchEffect and ComBat, indicating a better performance in removing batch variation. The ComBat-corrected data had the lowest alignment score, which was consistent with PCA that the data still had residual batch variation remaining.</p>
        <p>In the AD data, the alignment scores of the data corrected with PLSDA-batch and sPLSDA-batch led to a poorer performance than removeBatchEffect and ComBat. This may result from the difference in the PCA sample projections of the batch-effect-corrected matrices, as we discussed in the Methods section. The data corrected with removeBatchEffect and ComBat had a large variance in their PCA projection, while PLSDA-batch- and sPLSDA-batch-corrected data had a small variance. A small variance projection results in a small alignment score, as it is easy to locate the samples from the same batch as nearest neighbours. In fact, pRDA presented below quantitatively confirmed that both PLSDA-batch and sPLSDA-batch entirely removed the batch variance.</p>
        <p>For the weak batch effect in the HFHS data, PLSDA-batch performed best with the highest alignment score compared with the other methods. We did not face the same issue as the AD data as the sample distribution in projection was similar across all datasets.</p>
      </sec>
      <sec id="sec3f3">
        <title>pRDA assessment</title>
        <p>We next focused on estimating the proportion of variance explained by treatment and batch effects globally for the batch-effect-corrected data using pRDA.</p>
        <p>In the sponge data (Figure <xref rid="f6" ref-type="fig">6</xref><bold>A</bold>), the different methods preserved similar proportion of treatment variance (removeBatcheffect: 17.5%, ComBat: 18.2%, PLSDA-batch: 18.2%, sPLSDA-batch: 18.2%) and removed all batch variance, with the exception of ComBat that still retained 0.9% of batch variance.</p>
        <fig position="float" id="f6">
          <label>Figure 6</label>
          <caption>
            <p><bold>Explained variance before or after batch effect correction</bold> for <bold>(A)</bold> sponge data, <bold>(B)</bold> AD data and <bold>(C)</bold> HFHS data. In sponge data <bold>(A)</bold>, ComBat-corrected-data still included batch associated variance. In AD data <bold>(B)</bold>, sPLSDA-batch-corrected data included a higher treatment variance and lower intersectional variance compared with the data corrected from the other methods. In HFHS data with weak batch effects <bold>(C)</bold>, PLSDA-batch-corrected data preserved the largest amount of treatment variance.</p>
          </caption>
          <graphic xlink:href="bbac622f6" position="float"/>
        </fig>
        <p>In the AD data (Figure <xref rid="f6" ref-type="fig">6</xref><bold>B</bold>), we observed a small amount of intersectional variance (1.3%) due to the unbalanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation263">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment design. As the intersection was small, unweighted PLSDA-batch and sPLSDA-batch were still applicable, and thus the weighted versions were not used. PLSDA-batch preserved the largest proportion of variance explained by treatment effects, and also the largest proportion of intersectional variance. sPLSDA-batch-corrected data led to a higher proportion of treatment variance than the two univariate methods. sPLSDA-batch is a shrinkage version of PLSDA-batch, thus the proportion of treatment variance preserved by sPLSDA-batch should be nearly the same as or slightly smaller than PLSDA-batch, as we observed for this study.</p>
        <p>In the HFHS data where batch effects are weak, we detected 3.6% of the variance explained by batch effects (Figure <xref rid="f6" ref-type="fig">6</xref><bold>C</bold>). PLSDA-batch performed the best as the corrected data preserved the highest proportion of treatment variance and a complete removal of batch variance. sPLSDA-batch performed the worst as the method did not remove sufficient batch variance and lost some treatment variance. This result is consistent with the previous results that sPLSDA-batch-corrected data had a lower alignment score (related to batch variation) and lower variance explained by the first PCA component (related to treatment variation) than the other methods.</p>
      </sec>
      <sec id="sec3f4">
        <title><inline-formula><tex-math notation="LaTeX" id="ImEquation264">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$R^2$\end{document}</tex-math></inline-formula> assessment</title>
        <p>The <inline-formula><tex-math notation="LaTeX" id="ImEquation265">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$R^2$\end{document}</tex-math></inline-formula> values representing the variance explained by batch or treatment effects for each variable estimated with one-way ANOVA are displayed in Figure <xref rid="f7" ref-type="fig">7</xref> for the AD study. The corrected data from ComBat still included a few variables with a large proportion of batch variance. The overall sum of <inline-formula><tex-math notation="LaTeX" id="ImEquation266">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$R^2$\end{document}</tex-math></inline-formula> values indicated that removeBatchEffect removed slightly more batch variance (removeBatchEffect: 1.70, PLSDA-batch: 12.40, sPLSDA-batch: 9.25) but preserved less treatment variance (removeBatchEffect: 31.75, PLSDA-batch: 40.00, sPLSDA-batch: 36.22) than our proposed approaches (<xref rid="sup1" ref-type="supplementary-material">Supplemental Figure S13</xref>). We observed similar results with the sponge data (<xref rid="sup1" ref-type="supplementary-material">Supplemental Figures S14</xref>, <xref rid="sup1" ref-type="supplementary-material">S15</xref>). In the HFHS study, we did not observe any variables with a large proportion of batch variance in the ComBat corrected data (<xref rid="sup1" ref-type="supplementary-material">Supplemental Figure S16</xref>), but the total amount of treatment variance summed from all variables was smaller than with PLSDA-batch. We reached similar conclusions for remove batch-effect-corrected data (<xref rid="sup1" ref-type="supplementary-material">Supplemental Figure S17</xref>).</p>
        <fig position="float" id="f7">
          <label>Figure 7</label>
          <caption>
            <p><bold>AD study: <inline-formula><tex-math notation="LaTeX" id="ImEquation267">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\boldsymbol{R^2}$\end{document}</tex-math></inline-formula> values for each microbial variable before and after batch effect correction</bold>. Each box represents a summary of <inline-formula><tex-math notation="LaTeX" id="ImEquation268">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$R^2$\end{document}</tex-math></inline-formula> values fitted for variables from a one-way ANOVA with a treatment effect or batch effect as covariate (x-axis). The colours indicate the fitted effects in ANOVA. The Combat-corrected data included some variables with a large proportion of batch variance (outliers). removeBatchEffect removed slightly more batch variance, but preserved less treatment variance than our proposed PLSDA-batch and sPLSDA-batch.</p>
          </caption>
          <graphic xlink:href="bbac622f7" position="float"/>
        </fig>
      </sec>
      <sec id="sec3f5">
        <title>Biological interpretation</title>
        <p>We applied sPLSDA to select 20% of the total number of OTUs in the anaerobic digestion (46) and the HFHS diet (103) studies, but we excluded the sponge study from this analysis as it includes only a small number of OTUs. We then compared the OTU selections before and after batch effect correction with different methods.</p>
        <p><bold>Anaerobic digestion.</bold> When comparing the variable selections before and after batch effect correction, five OTUs were uniquely selected in the original uncorrected data and belonged to the family <italic toggle="yes">Spirochaetaceae</italic> (order <italic toggle="yes">Spirochaetales</italic>), <italic toggle="yes">Synergistaceae</italic> (order <italic toggle="yes">Synergistales</italic>) and three different families of the order <italic toggle="yes">Clostridiales</italic>. Both of <italic toggle="yes">Spirochaetaceae</italic> and <italic toggle="yes">Synergistaceae</italic> have been reported to be associated with methanogenesis. The former can ferment glucose to acetate and ethanol which are utilized by methanogenic communities [<xref rid="ref51" ref-type="bibr">51</xref>], while the latter is associated with hydrogenotrophic methanogens in a syntrophic manner [<xref rid="ref52" ref-type="bibr">52</xref>]. Members of the order <italic toggle="yes">Clostridiales</italic> have been recognized to hydrolyse a variety of polysaccharides by different mechanisms [<xref rid="ref53" ref-type="bibr">53</xref>]. After batch effect correction, we observed an overlap of 32 out of 46 OTUs (69.6%) that were selected from the data uncorreted and corrected with different methods, showing a good agreement among all methods. We also identified 17 OTUs that were only selected from the corrected data compared with the uncorrected data. Among these OTUs, one from the family <italic toggle="yes">Christensenellaceae</italic> was only selected with removeBatchEffect, while one from the family <italic toggle="yes">Peptococcaceae</italic> and two from the family <italic toggle="yes">Synergistaceae</italic> were selected with both removeBatchEffect and ComBat. The family <italic toggle="yes">Christensenellaceae</italic> includes saccharolytic fermentative anaerobes [<xref rid="ref54" ref-type="bibr">54</xref>], while members of the family <italic toggle="yes">Peptococcaceae</italic> are acetogen/syntrophic bacteria in natural and methanogenic environments [<xref rid="ref55" ref-type="bibr">55</xref>]. Another eight OTUs among these 17 were only selected with PLSDA-batch or/and sPLSDA-batch. The families of these eight taxa included <italic toggle="yes">Ruminococcaceae</italic> (3), <italic toggle="yes">Syntrophomonadaceae</italic> (1), <italic toggle="yes">Peptococcaceae</italic> (1), <italic toggle="yes">Clostridiales vadinBB60 group</italic> (1) from the order <italic toggle="yes">Clostridiales</italic> and <italic toggle="yes">Thermoplasmatales Incertae Sedis</italic> (1) from the order <italic toggle="yes">Thermoplasmatales</italic> and <italic toggle="yes">Marinilabiaceae</italic> (1) from the order <italic toggle="yes">Bacteroidales</italic>. <italic toggle="yes">Ruminococcaceae</italic> can decompose a wide variety of recalcitrant substrates like cellulose and hemicellulose to produce small molecules of acids, such as acetic acid and butyric acid involved in the process of anaerobic digestion [<xref rid="ref56" ref-type="bibr">56</xref>, <xref rid="ref57" ref-type="bibr">57</xref>]. The family <italic toggle="yes">Syntrophomonadaceae</italic> is responsible of the acetate production from butyrate and in a syntrophic relationship with hydrogenotrophic methanogens [<xref rid="ref58" ref-type="bibr">58</xref>]. <italic toggle="yes">Clostridiales vadinBB60 group</italic> plays an important role in carbohydrate fermentation and short-chain fatty acid production [<xref rid="ref59" ref-type="bibr">59</xref>]. <italic toggle="yes">Thermoplasmatales Incertae Sedis</italic> includes methanogens [<xref rid="ref60" ref-type="bibr">60</xref>]. <italic toggle="yes">Marinilabiaceae</italic> can ferment various substrates with the production of propionate, acetate, and succinate [<xref rid="ref61" ref-type="bibr">61</xref>]. The rest five OTUs were selected with removeBatchEffect, ComBat, sPLSDA-batch and/or PLSDA-batch. Four out of the five were from the order <italic toggle="yes">Clostridiales</italic> (family <italic toggle="yes">Christensenellaceae</italic> (2), <italic toggle="yes">Ruminococcaceae</italic> (1) and <italic toggle="yes">Family XIV</italic> (1)), and only one was from the family <italic toggle="yes">Marinilabiaceae</italic> of the order <italic toggle="yes">Bacteroidales</italic>. To summarize, from the data corrected with our PLSDA-batch and sPLSDA-batch approaches, we identified more taxa within the order <italic toggle="yes">Clostridiales</italic> than with removeBatchEffect and ComBat. Our approaches selected a larger number of unique OTUs compared with the two univariate methods, and these OTUs are highly relevant to the AD process. This study also shows that our approaches were successful at preserving treatment variation for the data that included a strong batch effect.</p>
        <p><bold>(High fat high sugar diet).</bold> For this study, we did not include the selection from sPLSDA-batch-corrected data, which did not preserve enough treatment variation inferred from previous assessments. When comparing the original data with the batch-effect-corrected data, three OTUs selected were from the family <italic toggle="yes">S24-7</italic> (order <italic toggle="yes">Bacteroidales</italic>), family <italic toggle="yes">Lachnospiraceae</italic> and <italic toggle="yes">Ruminococcaceae</italic> (order <italic toggle="yes">Clostridiales</italic>), respectively, that were not selected after batch effect correction. The family <italic toggle="yes">S24-7</italic> is closely related to carbohydrate metabolism [<xref rid="ref62" ref-type="bibr">62</xref>], while the family <italic toggle="yes">Lachnospiraceae</italic> plays a key role in the metabolism of undigested carbohydrates [<xref rid="ref63" ref-type="bibr">63</xref>], and <italic toggle="yes">Ruminococcaceae</italic> can decompose a wide variety of recalcitrant substrates like cellulose and hemicellulose to short-chain fatty acids, including butyrate [<xref rid="ref56" ref-type="bibr">56</xref>, <xref rid="ref57" ref-type="bibr">57</xref>]. Among all different datasets, 91 out of 103 OTUs (88.3%) were commonly selected. We identified 12 OTUs that were uniquely selected from the data corrected with particular methods, including one OTU from the family <italic toggle="yes">Lachnospiraceae</italic> selected from the ComBat. Another six OTUs were only selected from our PLSDA-batch approach and belonged to the family <italic toggle="yes">Erysipelotrichaceae</italic> (2) (order <italic toggle="yes">Erysipelotrichales</italic>), <italic toggle="yes">Desulfovibrionaceae</italic> (2) (order <italic toggle="yes">Desulfovibrionales</italic>), <italic toggle="yes">Coriobacteriaceae</italic> (1) (order <italic toggle="yes">Coriobacteriales</italic>) and an unknown family (1) of order <italic toggle="yes">Clostridiales</italic>. The family <italic toggle="yes">Erysipelotrichaceae</italic> is highly correlated with cholesterol metabolism [<xref rid="ref64" ref-type="bibr">64</xref>], while the family <italic toggle="yes">Desulfovibrionaceae</italic> is positively correlated with glucose and lipid metabolism [<xref rid="ref65" ref-type="bibr">65</xref>] and the family <italic toggle="yes">Coriobacteriaceae</italic> increases the level of short-chain fatty acids including acetic acid, propionic acid and butyric acid and is related to impaired glucose metabolism [<xref rid="ref66" ref-type="bibr">66</xref>]. The rest five out of these 12 OTUs selected with ComBat, PLSDA-batch and/or removeBatchEffect were from the family <italic toggle="yes">S24-7</italic> (1) (order <italic toggle="yes">Bacteroidales</italic>), <italic toggle="yes">Lachnospiraceae</italic> and three unknown families from the order <italic toggle="yes">Clostridiales</italic>. To summarize, in the HFHS data that include weak batch effects, over 88% of the selected microbial variables from different batch-effect-corrected data were in common with the original uncorrected data. However, from the data after our PLSDA-batch correction, we selected additional OTUs highly relevant to the HFHS diet compared with the other datasets including removeBatchEffect, ComBat corrected data and the original data.</p>
      </sec>
    </sec>
  </sec>
  <sec id="sec4">
    <title>Discussion</title>
    <p>In this article, we introduced PLSDA-batch to correct for batch effects in a multivariate fashion while preserving treatment variation. We also proposed two additional variant methods weighted PLSDA-batch that includes group size weight to handle unbalanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation269">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment designs, and sparse PLSDA-batch that includes variable selection when estimating treatment components. In this article we referred to microbiome data as microbial metataxonomic data and analysed datasets at the OTU level. However, our methods are also suitable for the metagenomic data and datasets considered at any other level of taxonomy.</p>
    <p>We compared our proposed methods with existing removeBatchEffect, ComBat and SVA. The former two are univariate methods that correct for known batch effects, while SVA is a hybrid method that estimates unknown batch effects with a multivariate strategy and accounts for the estimated batch effects in a univariate manner. All methods assume each variable follows a Gaussian distribution and do not consider the dependent structure between variables. In addition, ComBat assumes that all variables are affected by batch effects in a systematic manner. This assumption does not hold true in practice [<xref rid="ref6" ref-type="bibr">6</xref>]. Our approach PLSDA-batch has a relaxed assumption about data distribution and thus is more suitable for microbiome data, even after CLR transformation. The multivariate nature of our approach also enables to model the correlation structure between variables and handle non-systematic batch effects.</p>
    <p>Our simulation studies showed that SVA had a tendency to overfit the data; ComBat was not able to completely remove batch variation and removeBatchEffect was not able to preserve enough treatment effects for accurate variable identification.</p>
    <p>Across most simulation scenarios, PLSDA-batch led to a high performance in terms of F1 score and AUC, especially in an unbalanced design where weighted PLSDA-batch was preferable to its unweighted version. PLSDA-batch performed better than sPLSDA-batch in the case where variables had both treatment and batch effects. Our simulations under a negative binomial distribution did not emphasize on the performance of sPLSDA-batch compared with PLSDA-batch, as sPLSDA-batch lacked the appropriate fit in component estimation and removed excessive amount of batch variation, resulting in spurious treatment variation. Further simulations (<xref rid="sup1" ref-type="supplementary-material">Supplemental Figures S18</xref>–<xref rid="sup1" ref-type="supplementary-material">S25</xref>) under a Gaussian distribution demonstrated a better performance of sPLSDA-batch. This was also reflected in the case studies, suggesting that the count data after CLR transformation may approximate a Gaussian distribution. The distribution of real microbiome data is often debatable, thus may not be strictly negative binomial. Some studies have discussed that microbiome data may follow instead a zero-inflated lognormal distribution [<xref rid="ref67" ref-type="bibr">67</xref>], which was confirmed to some extent in our results.</p>
    <p>In the case studies of sponge and anaerobic digestion, PLSDA-batch and sPLSDA-batch performed similarly. These two studies include a strong batch effect, and all performance criteria we used indicated that PLSDA-batch and sPLSDA-batch outperformed ComBat, which removed an insufficient amount of batch variation (sponge and AD data) and preserved insufficient treatment variation (AD data). The data corrected with removeBatchEffect resulted in a smaller proportion of treatment variance compared with our methods. When performing variable selection on the data corrected for batch effects with our approaches, we selected a larger number of unique OTUs relevant to anaerobic digestion than with the other batch effect correction approaches. Regarding the HFHS data that include a weak batch effect, the data corrected with sPLSDA-batch lost certain amount of treatment variance as it did not estimate the treatment associated component well, indicating sPLSDA-batch is not suitable for weak batch effects. We observed a large overlap of OTUs when performing variable selection before and after batch effect correction by the different methods, but from the data corrected by PLSDA-batch we selected additional OTUs highly relevant to HFHS diet, suggesting that batch effect correction is still beneficial when batch effects are weak. Due to the limited resolution of taxonomic information with 16S rRNA sequencing, our biological interpretation was limited to family level. Deeper resolution obtained with whole genome sequencing would give more insight into the biological meaning of the additional OTUs that were selected with our approaches.</p>
    <p>Based on our results, we propose the following guidelines to choose the best method that achieves maximum batch effect removal: (1) when the proportion of treatment variance after batch effect correction is larger than from the original data, it is best to choose the method that preserves a smaller treatment variance that is likely to be not spurious; (2) on the opposite, when the proportion of treatment variance after correction is smaller than from the original data, it is best to choose the method that preserves the larger treatment variance.</p>
    <p>We have identified several limitations in our proposed framework that will warrant further investigations. Our methods currently require pre-defined batch group information. If the batch information is unknown, we recommend assigning the samples to batches identified with PCA or any clustering methods. While wPLSDA-batch showed a good performance, the presence of an interaction effect between batch and treatment on microbial variables still remains a challenge, most likely because this interaction is non-linear. When batch and treatment effects are collinear, only methods which account for batch effects but do not correct for them would be suitable, such as linear regression [<xref rid="ref6" ref-type="bibr">6</xref>]. In addition, PLSDA methods are linear techniques, where both explanatory and response components are constructed based on a linear combination of variables, and where we model the linear relationship between components. It is highly possible that variables in microbiome data interact non-linearly. As such, non-linear approaches based on PLS kernel could also be expanded in our framework [<xref rid="ref68" ref-type="bibr">68</xref>].</p>
  </sec>
  <sec id="sec5">
    <title>Conclusions</title>
    <p>Our multivariate approach PLSDA-batch aims to estimate and remove batch variation while preserving treatment variation for microbiome data. The batch-effect-corrected data can then be used as input in any downstream analyses, such as dimension reduction, visualization, clustering or variable selection. In our study, we showed that when some variables included both treatment and batch effects or when batch effects were very weak, PLSDA-batch was more suitable than the sparse version. For unbalanced batch <inline-formula><tex-math notation="LaTeX" id="ImEquation270">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\times $\end{document}</tex-math></inline-formula> treatment designs, the weighted PLSDA-batch led to superior results to disentangle correlated batch and treatment effects. On both simulation and case studies, our methods resulted in a superior performance compared with existing methods based on both visual and quantitative assessments. The taxa selected in the downstream analysis were biologically relevant. Our work is an important step to raise awareness for managing batch effects and ensure reliable downstream statistical analyses to ultimately facilitate microbial studies.</p>
    <boxed-text id="box01" position="float">
      <sec id="sec19a">
        <title>Key Points</title>
        <list list-type="bullet">
          <list-item>
            <p>We developed a set of three multivariate and non-parametric batch effect correction methods for microbiome data to estimate and remove batch variation while preserving treatment variation.</p>
          </list-item>
          <list-item>
            <p>The methods were specifically designed to handle unbalanced batch x treatment designs (weighted PLSDA-batch) and to avoid overfitting in components estimation with variable selection (sparse PLSDA-batch).</p>
          </list-item>
          <list-item>
            <p>The application of our methods to both simulated and real case studies showed competitive performance to existing methods, especially for unbalanced batch x treatment designs.</p>
          </list-item>
          <list-item>
            <p>Various visual and numerical assessments for batch effect detection and removal are available.</p>
          </list-item>
        </list>
      </sec>
    </boxed-text>
  </sec>
  <sec sec-type="data-availability" id="sec7">
    <title>Data availability</title>
    <p>The R package ‘PLSDAbatch’ along with the case study datasets, simulations and all analyses are fully reproducible and available on GitHub: <ext-link xlink:href="https://github.com/EvaYiwenWang/PLSDAbatch" ext-link-type="uri">https://github.com/EvaYiwenWang/PLSDAbatch</ext-link>.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>Supplemental_Material_bbac622</label>
      <media xlink:href="supplemental_material_bbac622.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgments</title>
    <p>We thank A/Prof Olivier Chapleur from INRAE for his help in interpreting the variable selection results from the AD data.</p>
  </ack>
  <sec id="sec8u">
    <title>Funding</title>
    <p>This work was supported by the China Scholarship Council - University of Melbourne PhD Scholarship [201707510003], the fellowship of China Postdoctoral Science Foundation [2022TQ0370] and the Young Scientists Fund of the National Natural Science Foundation of China [32200077] to Y.W; and the National Health and Medical Research Council (NHMRC) Career Development fellowship [GNT1159458] to K-A.LC.</p>
  </sec>
  <sec id="sec10">
    <title>Authors’ contributions</title>
    <p>YW developed, implemented and benchmarked the methods, and wrote the manuscript. K-ALC supervised YW and edited the manuscript.</p>
  </sec>
  <sec id="sec9">
    <title>Abbreviations</title>
    <p><bold>RUV:</bold> Remove Unwanted Variation <bold>SVA:</bold> Surrogate Variable Analysis <bold>PLS:</bold> Partial Least Squares, a.k.a Projection to Latent Structures <bold>PLSDA:</bold> Partial Least Squares Discriminant Analysis <bold>sPLSDA:</bold> sparse Partial Least Squares Discriminant Analysis <bold>PLSDA-batch:</bold> Partial Least Squares Discriminant Analysis for batch effect correction <bold>PCA:</bold> Principal Component Analysis <bold>wPLSDA-batch:</bold> weighted PLSDA-batch <bold>sPLSDA-batch:</bold> sparse PLSDA-batch <bold>BER:</bold> Balanced classification Error Rate <bold>CLR:</bold> Centered Log Ratio <bold>OTU:</bold> Operational Taxonomic Unit <bold>AD:</bold> Anaerobic Digestion <bold>HFHS:</bold> High Fat High Sugar diet <bold>pRDA:</bold> partial Redundancy Analysis</p>
  </sec>
  <notes id="bio3">
    <title>Author Biographies</title>
    <p><bold>Yiwen Wang</bold> is currently a research fellow at the Shenzhen Branch, Guangdong Laboratory of Lingnan Modern Agriculture, Genome Analysis Laboratory of the Ministry of Agriculture and Rural Affairs, Agricultural Genomics Institute at Shenzhen, Chinese Academy of Agricultural Sciences. She graduated with a Ph.D degree from Melbourne Integrative Genomics, School of Mathematics and Statistics, University of Melbourne. Her research focuses on developing methods for microbiome data analysis.</p>
    <sec sec-type="author-bio" id="sec35a">
      <p><bold>Kim-Anh Lê Cao</bold> is a professor in statistical genomics at the University of Melbourne. Her lab focuses on the development of computational and integrative multivariate methods for feature selection in biological data, with a particular interest for microbiome and multi-omics studies.</p>
    </sec>
  </notes>
  <ref-list id="bib1">
    <title>References</title>
    <ref id="ref1">
      <label>1.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zuo</surname><given-names>T</given-names></string-name>, <string-name><surname>Ng</surname><given-names>SC</given-names></string-name></person-group>. <article-title>The gut microbiota in the pathogenesis and therapeutics of inflammatory bowel disease</article-title>. <source>Front Microbiol</source><year>2018</year>;<volume>9</volume>:2247.</mixed-citation>
    </ref>
    <ref id="ref2">
      <label>2.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sharma</surname><given-names>S</given-names></string-name>, <string-name><surname>Tripathi</surname><given-names>P</given-names></string-name></person-group>. <article-title>Gut microbiome and type 2 diabetes: where we are and where to go?</article-title><source>J Nutr Biochem</source><year>2019</year>;<volume>63</volume>:<fpage>101</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">30366260</pub-id></mixed-citation>
    </ref>
    <ref id="ref3">
      <label>3.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gérard</surname><given-names>P</given-names></string-name></person-group>. <article-title>Gut microbiota and obesity</article-title>. <source>Cell Mol Life Sci</source><year>2016</year>;<volume>73</volume>(<issue>1</issue>):<fpage>147</fpage>–<lpage>62</lpage>.<pub-id pub-id-type="pmid">26459447</pub-id></mixed-citation>
    </ref>
    <ref id="ref4">
      <label>4.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Alou</surname><given-names>MT</given-names></string-name>, <string-name><surname>Million</surname><given-names>M</given-names></string-name>, <string-name><surname>Traore</surname><given-names>SI</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Gut bacteria missing in severe acute malnutrition, can we identify potential probiotics by culturomics?</article-title><source>Front Microbiol</source><year>2017</year>;<volume>8</volume>:<fpage>899</fpage>.<pub-id pub-id-type="pmid">28588566</pub-id></mixed-citation>
    </ref>
    <ref id="ref5">
      <label>5.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schloss</surname><given-names>PD</given-names></string-name></person-group>. <article-title>Identifying and overcoming threats to reproducibility, replicability, robustness, and generalizability in microbiome research</article-title>. <source>MBio</source><year>2018</year>;<volume>9</volume>(<issue>3</issue>):<fpage>e00525</fpage>–<lpage>18</lpage>.<pub-id pub-id-type="pmid">29871915</pub-id></mixed-citation>
    </ref>
    <ref id="ref6">
      <label>6.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Lê Cao</surname><given-names>K-A</given-names></string-name></person-group>. <article-title>Managing batch effects in microbiome data</article-title>. <source>Brief Bioinform</source><year>2020</year>;<volume>21</volume>(<issue>6</issue>):<fpage>1954</fpage>–<lpage>70</lpage>.<pub-id pub-id-type="pmid">31776547</pub-id></mixed-citation>
    </ref>
    <ref id="ref7">
      <label>7.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><prefix>de</prefix><surname>Goffau</surname><given-names>MC</given-names></string-name>, <string-name><surname>Stephen Charnock-Jones</surname><given-names>D</given-names></string-name>, <string-name><surname>Smith</surname><given-names>G</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Batch effects account for the main findings of an in utero human intestinal bacterial colonization study</article-title>. <source>Microbiome</source><year>2021</year>;<volume>9</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">33388088</pub-id></mixed-citation>
    </ref>
    <ref id="ref8">
      <label>8.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Randall</surname><given-names>DW</given-names></string-name>, <string-name><surname>Kieswich</surname><given-names>J</given-names></string-name>, <string-name><surname>Swann</surname><given-names>J</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Batch effect exerts a bigger influence on the rat urinary metabolome and gut microbiota than uraemia: a cautionary tale</article-title>. <source>Microbiome</source><year>2019</year>;<volume>7</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">30606251</pub-id></mixed-citation>
    </ref>
    <ref id="ref9">
      <label>9.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Morrow</surname><given-names>JD</given-names></string-name>, <string-name><surname>Castaldi</surname><given-names>PJ</given-names></string-name>, <string-name><surname>Chase</surname><given-names>RP</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Peripheral blood microbial signatures in current and former smokers</article-title>. <source>Sci Rep</source><year>2021</year>;<volume>11</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">33414495</pub-id></mixed-citation>
    </ref>
    <ref id="ref10">
      <label>10.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>Z</given-names></string-name>, <string-name><surname>Yang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Yan</surname><given-names>Z</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Multi-omic meta-analysis identifies functional signatures of airway microbiome in chronic obstructive pulmonary disease</article-title>. <source>ISME J</source><year>2020</year>;<volume>14</volume>(<issue>11</issue>):<fpage>2748</fpage>–<lpage>65</lpage>.<pub-id pub-id-type="pmid">32719402</pub-id></mixed-citation>
    </ref>
    <ref id="ref11">
      <label>11.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Porras</surname><given-names>AM</given-names></string-name>, <string-name><surname>Shi</surname><given-names>Q</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>H</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Geographic differences in gut microbiota composition impact susceptibility to enteric infection</article-title>. <source>Cell Rep</source><year>2021</year>;<volume>36</volume>(<issue>4</issue>):<elocation-id>109457</elocation-id>.<pub-id pub-id-type="pmid">34320343</pub-id></mixed-citation>
    </ref>
    <ref id="ref12">
      <label>12.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Janiak</surname><given-names>MC</given-names></string-name>, <string-name><surname>Montague</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Villamil</surname><given-names>CI</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Age and sex-associated variation in the multi-site microbiome of an entire social group of free-ranging rhesus macaques</article-title>. <source>Microbiome</source><year>2021</year>;<volume>9</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>17</lpage>.<pub-id pub-id-type="pmid">33388088</pub-id></mixed-citation>
    </ref>
    <ref id="ref13">
      <label>13.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Almand</surname><given-names>AT</given-names></string-name>, <string-name><surname>Anderson</surname><given-names>AP</given-names></string-name>, <string-name><surname>Hitt</surname><given-names>BD</given-names></string-name>, <etal>et al.</etal></person-group><article-title>The influence of perceived stress on the human microbiome</article-title>. <source>BMC Res Notes</source><year>2022</year>;<volume>15</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">34983646</pub-id></mixed-citation>
    </ref>
    <ref id="ref14">
      <label>14.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Leeming</surname><given-names>ER</given-names></string-name>, <string-name><surname>Johnson</surname><given-names>AJ</given-names></string-name>, <string-name><surname>Spector</surname><given-names>TD</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Effect of diet on the gut microbiota: rethinking intervention duration</article-title>. <source>Nutrients</source><year>2019</year>;<volume>11</volume>(<issue>12</issue>):<fpage>2862</fpage>.<pub-id pub-id-type="pmid">31766592</pub-id></mixed-citation>
    </ref>
    <ref id="ref15">
      <label>15.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Paulson</surname><given-names>JN</given-names></string-name>, <string-name><surname>Colin Stine</surname><given-names>O</given-names></string-name>, <string-name><surname>Bravo</surname><given-names>HC</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Differential abundance analysis for microbial marker-gene surveys</article-title>. <source>Nat Methods</source><year>2013</year>;<volume>10</volume>(<issue>12</issue>):<elocation-id>1200</elocation-id>.<pub-id pub-id-type="pmid">24076764</pub-id></mixed-citation>
    </ref>
    <ref id="ref16">
      <label>16.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dai</surname><given-names>Z</given-names></string-name>, <string-name><surname>Wong</surname><given-names>SH</given-names></string-name>, <string-name><surname>Jun</surname><given-names>Y</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Batch effects correction for microbiome data with Dirichlet-multinomial regression</article-title>. <source>Bioinformatics</source><year>2019</year>;<volume>35</volume>(5):807–14.</mixed-citation>
    </ref>
    <ref id="ref17">
      <label>17.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Debelius</surname><given-names>J</given-names></string-name>, <string-name><surname>Song</surname><given-names>SJ</given-names></string-name>, <string-name><surname>Vazquez-Baeza</surname><given-names>Y</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Tiny microbes, enormous impacts: what matters in gut microbiome studies?</article-title><source>Genome Biol</source><year>2016</year>;<volume>17</volume>(<issue>1</issue>):<elocation-id>217</elocation-id>.<pub-id pub-id-type="pmid">27760558</pub-id></mixed-citation>
    </ref>
    <ref id="ref18">
      <label>18.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hardwick</surname><given-names>SA</given-names></string-name>, <string-name><surname>Chen</surname><given-names>WY</given-names></string-name>, <string-name><surname>Wong</surname><given-names>T</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Synthetic microbe communities provide internal reference standards for metagenome sequencing and analysis</article-title>. <source>Nat Commun</source><year>2018</year>;<volume>9</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">29317637</pub-id></mixed-citation>
    </ref>
    <ref id="ref19">
      <label>19.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moskovicz</surname><given-names>V</given-names></string-name>, <string-name><surname>Ben-El</surname><given-names>R</given-names></string-name>, <string-name><surname>Horev</surname><given-names>G</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Skin microbiota dynamics following b. subtilis formulation challenge: an in vivo study in mice</article-title>. <source>BMC Microbiol</source><year>2021</year>;<volume>21</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">33386072</pub-id></mixed-citation>
    </ref>
    <ref id="ref20">
      <label>20.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gibbons</surname><given-names>SM</given-names></string-name>, <string-name><surname>Duvallet</surname><given-names>C</given-names></string-name>, <string-name><surname>Alm</surname><given-names>EJ</given-names></string-name></person-group>. <article-title>Correcting for batch effects in case-control microbiome studies</article-title>. <source>PLoS Comput Biol</source><year>2018</year>;<volume>14</volume>(<issue>4</issue>):<elocation-id>e1006102</elocation-id>.<pub-id pub-id-type="pmid">29684016</pub-id></mixed-citation>
    </ref>
    <ref id="ref21">
      <label>21.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Xiao</surname><given-names>L</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>F</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>F</given-names></string-name></person-group>. <article-title>Large-scale microbiome data integration enables robust biomarker identification</article-title>. <source>Nature Computational Science</source><year>2022</year>;<volume>2</volume>(<issue>5</issue>):<fpage>307</fpage>–<lpage>16</lpage>.</mixed-citation>
    </ref>
    <ref id="ref22">
      <label>22.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Evan Johnson</surname><given-names>W</given-names></string-name>, <string-name><surname>Li</surname><given-names>C</given-names></string-name>, <string-name><surname>Rabinovic</surname><given-names>A</given-names></string-name></person-group>. <article-title>Adjusting batch effects in microarray expression data using empirical Bayes methods</article-title>. <source>Biostatistics</source><year>2007</year>;<volume>8</volume>(<issue>1</issue>):<fpage>118</fpage>–<lpage>27</lpage>.<pub-id pub-id-type="pmid">16632515</pub-id></mixed-citation>
    </ref>
    <ref id="ref23">
      <label>23.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ritchie</surname><given-names>ME</given-names></string-name>, <string-name><surname>Phipson</surname><given-names>B</given-names></string-name>, <string-name><surname>Di</surname><given-names>W</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Limma powers differential expression analyses for RNA-sequencing and microarray studies</article-title>. <source>Nucleic Acids Res</source><year>2015</year>;<volume>43</volume>(<issue>7</issue>):<fpage>e47</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">25605792</pub-id></mixed-citation>
    </ref>
    <ref id="ref24">
      <label>24.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ramette</surname><given-names>A</given-names></string-name></person-group>. <article-title>Multivariate analyses in microbial ecology</article-title>. <source>FEMS Microbiol Ecol</source><year>2007</year>;<volume>62</volume>(<issue>2</issue>):<fpage>142</fpage>–<lpage>60</lpage>.<pub-id pub-id-type="pmid">17892477</pub-id></mixed-citation>
    </ref>
    <ref id="ref25">
      <label>25.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stuart</surname><given-names>T</given-names></string-name>, <string-name><surname>Butler</surname><given-names>A</given-names></string-name>, <string-name><surname>Hoffman</surname><given-names>P</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Comprehensive integration of single-cell data</article-title>. <source>Cell</source><year>2019</year>;<volume>177</volume>(<issue>7</issue>):<fpage>1888</fpage>–<lpage>902</lpage>.<pub-id pub-id-type="pmid">31178118</pub-id></mixed-citation>
    </ref>
    <ref id="ref26">
      <label>26.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Haghverdi</surname><given-names>L</given-names></string-name>, <string-name><surname>Lun</surname><given-names>ATL</given-names></string-name>, <string-name><surname>Morgan</surname><given-names>MD</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Batch effects in single-cell rna-sequencing data are corrected by matching mutual nearest neighbors</article-title>. <source>Nat Biotechnol</source><year>2018</year>;<volume>36</volume>(<issue>5</issue>):<fpage>421</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">29608177</pub-id></mixed-citation>
    </ref>
    <ref id="ref27">
      <label>27.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lin</surname><given-names>Y</given-names></string-name>, <string-name><surname>Ghazanfar</surname><given-names>S</given-names></string-name>, <string-name><surname>Wang</surname><given-names>KYX</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Scmerge leverages factor analysis, stable expression, and pseudoreplication to merge multiple single-cell rna-seq datasets</article-title>. <source>Proc Natl Acad Sci</source><year>2019</year>;<volume>116</volume>(<issue>20</issue>):<fpage>9775</fpage>–<lpage>84</lpage>.<pub-id pub-id-type="pmid">31028141</pub-id></mixed-citation>
    </ref>
    <ref id="ref28">
      <label>28.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Risso</surname><given-names>D</given-names></string-name>, <string-name><surname>Perraudeau</surname><given-names>F</given-names></string-name>, <string-name><surname>Gribkova</surname><given-names>S</given-names></string-name>, <etal>et al.</etal></person-group><article-title>A general and flexible method for signal extraction from single-cell rna-seq data</article-title>. <source>Nat Commun</source><year>2018</year>;<volume>9</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>17</lpage>.<pub-id pub-id-type="pmid">29317637</pub-id></mixed-citation>
    </ref>
    <ref id="ref29">
      <label>29.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barker</surname><given-names>M</given-names></string-name>, <string-name><surname>Rayens</surname><given-names>W</given-names></string-name></person-group>. <article-title>Partial least squares for discrimination</article-title>. <source>Journal of Chemometrics: A Journal of the Chemometrics Society</source><year>2003</year>;<volume>17</volume>(<issue>3</issue>):<fpage>166</fpage>–<lpage>73</lpage>.</mixed-citation>
    </ref>
    <ref id="ref30">
      <label>30.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kubinski</surname><given-names>R</given-names></string-name>, <string-name><surname>Djamen-Kepaou</surname><given-names>J-Y</given-names></string-name>, <string-name><surname>Zhanabaev</surname><given-names>T</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Benchmark of data processing methods and machine learning models for gut microbiome-based diagnosis of inflammatory bowel disease</article-title>. <source>Front Genet</source><year>2022</year>;<volume>13</volume>:784397.</mixed-citation>
    </ref>
    <ref id="ref31">
      <label>31.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author">Hong BY, Paulson JN, Stine OC, <etal>et al.</etal></person-group><article-title>Meta-analysis of the lung microbiota in pulmonary tuberculosis</article-title>. <source>Tuberculosis</source><year>2018</year>;<volume>109</volume>:<fpage>102</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">29559113</pub-id></mixed-citation>
    </ref>
    <ref id="ref32">
      <label>32.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jing</surname><given-names>W</given-names></string-name>, <string-name><surname>Peters</surname><given-names>BA</given-names></string-name>, <string-name><surname>Dominianni</surname><given-names>C</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Cigarette smoking and the oral microbiome in a large study of american adults</article-title>. <source>ISME J</source><year>2016</year>;<volume>10</volume>(<issue>10</issue>):<fpage>2435</fpage>–<lpage>46</lpage>.<pub-id pub-id-type="pmid">27015003</pub-id></mixed-citation>
    </ref>
    <ref id="ref33">
      <label>33.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wold</surname><given-names>S</given-names></string-name>, <string-name><surname>Sjöström</surname><given-names>M</given-names></string-name>, <string-name><surname>Eriksson</surname><given-names>L</given-names></string-name></person-group>. <article-title>Pls-regression: a basic tool of chemometrics</article-title>. <source>Chemom Intel Lab Syst</source><year>2001</year>;<volume>58</volume>(<issue>2</issue>):<fpage>109</fpage>–<lpage>30</lpage>.</mixed-citation>
    </ref>
    <ref id="ref34">
      <label>34.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rohart</surname><given-names>F</given-names></string-name>, <string-name><surname>Gautier</surname><given-names>B</given-names></string-name>, <string-name><surname>Singh</surname><given-names>A</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Mixomics: an r package for ‘omics feature selection and multiple data integration</article-title>. <source>PLoS Comput Biol</source><year>2017</year>;<volume>13</volume>(<issue>11</issue>):<elocation-id>e1005752</elocation-id>.<pub-id pub-id-type="pmid">29099853</pub-id></mixed-citation>
    </ref>
    <ref id="ref35">
      <label>35.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lê Cao</surname><given-names>K-A</given-names></string-name>, <string-name><surname>Boitard</surname><given-names>S</given-names></string-name>, <string-name><surname>Besse</surname><given-names>P</given-names></string-name></person-group>. <article-title>Sparse pls discriminant analysis: biologically relevant feature selection and graphical displays for multiclass problems</article-title>. <source>BMC bioinformatics</source><year>2011</year>;<volume>12</volume>(<issue>1</issue>):<fpage>253</fpage>.<pub-id pub-id-type="pmid">21693065</pub-id></mixed-citation>
    </ref>
    <ref id="ref36">
      <label>36.</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Holmes</surname><given-names>S</given-names></string-name>, <string-name><surname>Huber</surname><given-names>W</given-names></string-name></person-group>. <source>Modern statistics for modern biology</source>. United Kingdom: 
<publisher-name>Cambridge University Press</publisher-name>, <year>2018</year>.</mixed-citation>
    </ref>
    <ref id="ref37">
      <label>37.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Susin</surname><given-names>A</given-names></string-name>, <string-name><surname>Wang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Lê Cao</surname><given-names>K-A</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Variable selection in microbiome compositional data analysis</article-title>. <source>NAR Genomics and Bioinformatics</source><year>2020</year>;<volume>2</volume>(<issue>2</issue>):<elocation-id>lqaa029</elocation-id>.<pub-id pub-id-type="pmid">33575585</pub-id></mixed-citation>
    </ref>
    <ref id="ref38">
      <label>38.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tharwat</surname><given-names>A</given-names></string-name></person-group>. <article-title>Classification assessment methods</article-title>. <source>Applied Computing and Informatics</source><year>2021</year>;<volume>17</volume>(1):168–92.</mixed-citation>
    </ref>
    <ref id="ref39">
      <label>39.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>McMurdie</surname><given-names>PJ</given-names></string-name>, <string-name><surname>Holmes</surname><given-names>S</given-names></string-name></person-group>. <article-title>Waste not, want not: why rarefying microbiome data is inadmissible</article-title>. <source>PLoS Comput Biol</source><year>2014</year>;<volume>10</volume>(<issue>4</issue>):<elocation-id>e1003531</elocation-id>.<pub-id pub-id-type="pmid">24699258</pub-id></mixed-citation>
    </ref>
    <ref id="ref40">
      <label>40.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Quinn</surname><given-names>TP</given-names></string-name>, <string-name><surname>Erb</surname><given-names>I</given-names></string-name>, <string-name><surname>Richardson</surname><given-names>MF</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Understanding sequencing data as compositions: an outlook and review</article-title>. <source>Bioinformatics</source><year>2018</year>;<volume>34</volume>(<issue>16</issue>):<fpage>2870</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">29608657</pub-id></mixed-citation>
    </ref>
    <ref id="ref41">
      <label>41.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hawinkel</surname><given-names>S</given-names></string-name>, <string-name><surname>Mattiello</surname><given-names>F</given-names></string-name>, <string-name><surname>Bijnens</surname><given-names>L</given-names></string-name>, <etal>et al.</etal></person-group><article-title>A broken promise: microbiome differential abundance methods do not control the false discovery rate</article-title>. <source>Brief Bioinform</source><year>2019</year>;<volume>20</volume>(<issue>1</issue>):<fpage>210</fpage>–<lpage>21</lpage>.<pub-id pub-id-type="pmid">28968702</pub-id></mixed-citation>
    </ref>
    <ref id="ref42">
      <label>42.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>McGregor</surname><given-names>K</given-names></string-name>, <string-name><surname>Labbe</surname><given-names>A</given-names></string-name>, <string-name><surname>Greenwood</surname><given-names>CMT</given-names></string-name></person-group>. <article-title>Mdine: a model to estimate differential co-occurrence networks in microbiome studies</article-title>. <source>Bioinformatics</source><year>2020</year>;<volume>36</volume>(<issue>6</issue>):<fpage>1840</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">31697315</pub-id></mixed-citation>
    </ref>
    <ref id="ref43">
      <label>43.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author">Lê Cao K-A, Costello M-E, Lakis VA, <etal>et al.</etal></person-group><article-title>Mixmc: a multivariate statistical framework to gain insight into microbial communities</article-title>. <source>PloS one</source><year>2016</year>;<volume>11</volume>(<issue>8</issue>):<elocation-id>e0160169</elocation-id>.<pub-id pub-id-type="pmid">27513472</pub-id></mixed-citation>
    </ref>
    <ref id="ref44">
      <label>44.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sacristán-Soriano</surname><given-names>O</given-names></string-name>, <string-name><surname>Banaigs</surname><given-names>B</given-names></string-name>, <string-name><surname>Casamayor</surname><given-names>EO</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Exploring the links between natural products and bacterial assemblages in the sponge aplysina aerophoba</article-title>. <source>Appl Environ Microbiol</source><year>2011</year>;<volume>77</volume>(<issue>3</issue>):<fpage>862</fpage>–<lpage>70</lpage>.<pub-id pub-id-type="pmid">21115701</pub-id></mixed-citation>
    </ref>
    <ref id="ref45">
      <label>45.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chapleur</surname><given-names>O</given-names></string-name>, <string-name><surname>Madigou</surname><given-names>C</given-names></string-name>, <string-name><surname>Civade</surname><given-names>R</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Increasing concentrations of phenol progressively affect anaerobic digestion of cellulose and associated microbial communities</article-title>. <source>Biodegradation</source><year>2016</year>;<volume>27</volume>(<issue>1</issue>):<fpage>15</fpage>–<lpage>27</lpage>.<pub-id pub-id-type="pmid">26614490</pub-id></mixed-citation>
    </ref>
    <ref id="ref46">
      <label>46.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ho</surname><given-names>EXP</given-names></string-name>, <string-name><surname>Cheung</surname><given-names>CMG</given-names></string-name>, <string-name><surname>Sim</surname><given-names>S</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Human pharyngeal microbiota in age-related macular degeneration</article-title>. <source>PloS One</source><year>2018</year>;<volume>13</volume>(<issue>8</issue>):<elocation-id>e0201768</elocation-id>.<pub-id pub-id-type="pmid">30089174</pub-id></mixed-citation>
    </ref>
    <ref id="ref47">
      <label>47.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Thompson</surname><given-names>KJ</given-names></string-name>, <string-name><surname>Ingle</surname><given-names>JN</given-names></string-name>, <string-name><surname>Tang</surname><given-names>X</given-names></string-name>, <etal>et al.</etal></person-group><article-title>A comprehensive analysis of breast cancer microbiota and host gene expression</article-title>. <source>PloS One</source><year>2017</year>;<volume>12</volume>(<issue>11</issue>):<elocation-id>e0188873</elocation-id>.<pub-id pub-id-type="pmid">29190829</pub-id></mixed-citation>
    </ref>
    <ref id="ref48">
      <label>48.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Law</surname><given-names>CW</given-names></string-name>, <string-name><surname>Chen</surname><given-names>Y</given-names></string-name>, <string-name><surname>Shi</surname><given-names>W</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Voom: precision weights unlock linear model analysis tools for rna-seq read counts</article-title>. <source>Genome Biol</source><year>2014</year>;<volume>15</volume>(<issue>2</issue>):<fpage>R29</fpage>.<pub-id pub-id-type="pmid">24485249</pub-id></mixed-citation>
    </ref>
    <ref id="ref49">
      <label>49.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Borcard</surname><given-names>D</given-names></string-name>, <string-name><surname>Legendre</surname><given-names>P</given-names></string-name>, <string-name><surname>Drapeau</surname><given-names>P</given-names></string-name></person-group>. <article-title>Partialling out the spatial component of ecological variation</article-title>. <source>Ecology</source><year>1992</year>;<volume>73</volume>(<issue>3</issue>):<fpage>1045</fpage>–<lpage>55</lpage>.</mixed-citation>
    </ref>
    <ref id="ref50">
      <label>50.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Butler</surname><given-names>A</given-names></string-name>, <string-name><surname>Hoffman</surname><given-names>P</given-names></string-name>, <string-name><surname>Smibert</surname><given-names>P</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>. <source>Nat Biotechnol</source><year>2018</year>;<volume>36</volume>(<issue>5</issue>):<fpage>411</fpage>–<lpage>20</lpage>.<pub-id pub-id-type="pmid">29608179</pub-id></mixed-citation>
    </ref>
    <ref id="ref51">
      <label>51.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dollhopf</surname><given-names>S</given-names></string-name>, <string-name><surname>Hashsham</surname><given-names>S</given-names></string-name>, <string-name><surname>Dazzo</surname><given-names>F</given-names></string-name>, <etal>et al.</etal></person-group><article-title>The impact of fermentative organisms on carbon flow in methanogenic systems under constant low-substrate conditions</article-title>. <source>Appl Microbiol Biotechnol</source><year>2001</year>;<volume>56</volume>(<issue>3</issue>):<fpage>531</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">11549033</pub-id></mixed-citation>
    </ref>
    <ref id="ref52">
      <label>52.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>H</given-names></string-name>, <string-name><surname>Li</surname><given-names>J</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>Y</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Establishing practical strategies to run high loading corn Stover anaerobic digestion: methane production performance and microbial responses</article-title>. <source>Bioresour Technol</source><year>2020</year>;<volume>310</volume>:<elocation-id>123364</elocation-id>.<pub-id pub-id-type="pmid">32334357</pub-id></mixed-citation>
    </ref>
    <ref id="ref53">
      <label>53.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Poirier</surname><given-names>S</given-names></string-name>, <string-name><surname>Déjean</surname><given-names>S</given-names></string-name>, <string-name><surname>Chapleur</surname><given-names>O</given-names></string-name></person-group>. <article-title>Support media can steer methanogenesis in the presence of phenol through biotic and abiotic effects</article-title>. <source>Water Res</source><year>2018</year>;<volume>140</volume>:<fpage>24</fpage>–<lpage>33</lpage>.<pub-id pub-id-type="pmid">29684699</pub-id></mixed-citation>
    </ref>
    <ref id="ref54">
      <label>54.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Goodrich</surname><given-names>JK</given-names></string-name>, <string-name><surname>Waters</surname><given-names>JL</given-names></string-name>, <string-name><surname>Poole</surname><given-names>AC</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Human genetics shape the gut microbiome</article-title>. <source>Cell</source><year>2014</year>;<volume>159</volume>(<issue>4</issue>):<fpage>789</fpage>–<lpage>99</lpage>.<pub-id pub-id-type="pmid">25417156</pub-id></mixed-citation>
    </ref>
    <ref id="ref55">
      <label>55.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Singh</surname><given-names>A</given-names></string-name>, <string-name><surname>Müller</surname><given-names>B</given-names></string-name>, <string-name><surname>Schnürer</surname><given-names>A</given-names></string-name></person-group>. <article-title>Profiling temporal dynamics of acetogenic communities in anaerobic digesters using next-generation sequencing and t-rflp</article-title>. <source>Sci Rep</source><year>2021</year>;<volume>11</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">33414495</pub-id></mixed-citation>
    </ref>
    <ref id="ref56">
      <label>56.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>R</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>J</given-names></string-name>, <string-name><surname>Liu</surname><given-names>J</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Effects of chlortetracycline, cu and their combination on the performance and microbial community dynamics in swine manure anaerobic digestion</article-title>. <source>J Environ Sci</source><year>2018</year>;<volume>67</volume>:<fpage>206</fpage>–<lpage>15</lpage>.</mixed-citation>
    </ref>
    <ref id="ref57">
      <label>57.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Fan</surname><given-names>Y</given-names></string-name>, <string-name><surname>Niu</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>D</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Analysis of the characteristics of phosphine production by anaerobic digestion based on microbial community dynamics, metabolic pathways, and isolation of the phosphate-reducing strain</article-title>. <source>Chemosphere</source><year>2021</year>;<volume>262</volume>:<elocation-id>128213</elocation-id>.<pub-id pub-id-type="pmid">33182078</pub-id></mixed-citation>
    </ref>
    <ref id="ref58">
      <label>58.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Liu</surname><given-names>Y</given-names></string-name>, <string-name><surname>Wachemo</surname><given-names>AC</given-names></string-name>, <string-name><surname>Yuan</surname><given-names>HR</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Anaerobic digestion performance and microbial community structure of corn Stover in three-stage continuously stirred tank reactors</article-title>. <source>Bioresour Technol</source><year>2019</year>;<volume>287</volume>:<elocation-id>121339</elocation-id>.<pub-id pub-id-type="pmid">31100566</pub-id></mixed-citation>
    </ref>
    <ref id="ref59">
      <label>59.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Oakley</surname><given-names>BB</given-names></string-name>, <string-name><surname>Lillehoj</surname><given-names>HS</given-names></string-name>, <string-name><surname>Kogut</surname><given-names>MH</given-names></string-name>, <etal>et al.</etal></person-group><article-title>The chicken gastrointestinal microbiome</article-title>. <source>FEMS Microbiol Lett</source><year>2014</year>;<volume>360</volume>(<issue>2</issue>):<fpage>100</fpage>–<lpage>12</lpage>.<pub-id pub-id-type="pmid">25263745</pub-id></mixed-citation>
    </ref>
    <ref id="ref60">
      <label>60.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wojcieszak</surname><given-names>M</given-names></string-name>, <string-name><surname>Pyzik</surname><given-names>A</given-names></string-name>, <string-name><surname>Poszytek</surname><given-names>K</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Adaptation of methanogenic inocula to anaerobic digestion of maize silage</article-title>. <source>Front Microbiol</source><year>2017</year>;<volume>8</volume>:<fpage>1881</fpage>.<pub-id pub-id-type="pmid">29033919</pub-id></mixed-citation>
    </ref>
    <ref id="ref61">
      <label>61.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Poirier</surname><given-names>S</given-names></string-name>, <string-name><surname>Madigou</surname><given-names>C</given-names></string-name>, <string-name><surname>Bouchez</surname><given-names>T</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Improving anaerobic digestion with support media: mitigation of ammonia inhibition and effect on microbial communities</article-title>. <source>Bioresour Technol</source><year>2017</year>;<volume>235</volume>:<fpage>229</fpage>–<lpage>39</lpage>.<pub-id pub-id-type="pmid">28365351</pub-id></mixed-citation>
    </ref>
    <ref id="ref62">
      <label>62.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ormerod</surname><given-names>KL</given-names></string-name>, <string-name><surname>Wood</surname><given-names>DLA</given-names></string-name>, <string-name><surname>Lachner</surname><given-names>N</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Genomic characterization of the uncultured bacteroidales family s24-7 inhabiting the guts of homeothermic animals</article-title>. <source>Microbiome</source><year>2016</year>;<volume>4</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>17</lpage>.<pub-id pub-id-type="pmid">26739322</pub-id></mixed-citation>
    </ref>
    <ref id="ref63">
      <label>63.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Vacca</surname><given-names>M</given-names></string-name>, <string-name><surname>Celano</surname><given-names>G</given-names></string-name>, <string-name><surname>Calabrese</surname><given-names>FM</given-names></string-name>, <etal>et al.</etal></person-group><article-title>The controversial role of human gut lachnospiraceae</article-title>. <source>Microorganisms</source><year>2020</year>;<volume>8</volume>(<issue>4</issue>):<fpage>573</fpage>.<pub-id pub-id-type="pmid">32326636</pub-id></mixed-citation>
    </ref>
    <ref id="ref64">
      <label>64.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Martínez</surname><given-names>I</given-names></string-name>, <string-name><surname>Perdicaro</surname><given-names>DJ</given-names></string-name>, <string-name><surname>Brown</surname><given-names>AW</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Diet-induced alterations of host cholesterol metabolism are likely to affect the gut microbiota composition in hamsters</article-title>. <source>Appl Environ Microbiol</source><year>2013</year>;<volume>79</volume>(<issue>2</issue>):<fpage>516</fpage>–<lpage>24</lpage>.<pub-id pub-id-type="pmid">23124234</pub-id></mixed-citation>
    </ref>
    <ref id="ref65">
      <label>65.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhou</surname><given-names>L</given-names></string-name>, <string-name><surname>Xiao</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>Q</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Improved glucose and lipid metabolism in the early life of female offspring by maternal dietary genistein is associated with alterations in the gut microbiota</article-title>. <source>Front Endocrinol</source><year>2018</year>;<volume>9</volume>:<fpage>516</fpage>.</mixed-citation>
    </ref>
    <ref id="ref66">
      <label>66.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Liu</surname><given-names>H</given-names></string-name>, <string-name><surname>Hou</surname><given-names>C</given-names></string-name>, <string-name><surname>Li</surname><given-names>N</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Microbial and metabolic alterations in gut microbiota of sows during pregnancy and lactation</article-title>. <source>FASEB J</source><year>2019</year>;<volume>33</volume>(<issue>3</issue>):<fpage>4490</fpage>–<lpage>501</lpage>.<pub-id pub-id-type="pmid">30653349</pub-id></mixed-citation>
    </ref>
    <ref id="ref67">
      <label>67.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Weiss</surname><given-names>S</given-names></string-name>, <string-name><surname>Zhenjiang Zech</surname><given-names>X</given-names></string-name>, <string-name><surname>Peddada</surname><given-names>S</given-names></string-name>, <etal>et al.</etal></person-group><article-title>Normalization and microbial differential abundance strategies depend upon data characteristics</article-title>. <source>Microbiome</source><year>2017</year>;<volume>5</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>18</lpage>.<pub-id pub-id-type="pmid">28086968</pub-id></mixed-citation>
    </ref>
    <ref id="ref68">
      <label>68.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nguyen</surname><given-names>TT</given-names></string-name>, <string-name><surname>Tsoy</surname><given-names>Y</given-names></string-name></person-group>. <article-title>A kernel pls based classification method with missing data handling</article-title>. <source>Statistical Papers</source><year>2017</year>;<volume>58</volume>(<issue>1</issue>):<fpage>211</fpage>–<lpage>25</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
