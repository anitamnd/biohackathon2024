<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10701097</article-id>
    <article-id pub-id-type="pmid">37975872</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btad692</article-id>
    <article-id pub-id-type="publisher-id">btad692</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Phylogenetics</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>EPIK: precise and scalable evolutionary placement with informative <italic toggle="yes">k</italic>-mers</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-2264-5219</contrib-id>
        <name>
          <surname>Romashchenko</surname>
          <given-names>Nikolai</given-names>
        </name>
        <aff><institution>LIRMM, University of Montpellier, CNRS</institution>, Montpellier, <country country="FR">France</country></aff>
        <xref rid="btad692-cor1" ref-type="corresp"/>
        <!--nromashchenko@lirmm.fr-->
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-5555-898X</contrib-id>
        <name>
          <surname>Linard</surname>
          <given-names>Benjamin</given-names>
        </name>
        <aff><institution>LIRMM, University of Montpellier, CNRS</institution>, Montpellier, <country country="FR">France</country></aff>
        <xref rid="btad692-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8084-1464</contrib-id>
        <name>
          <surname>Pardi</surname>
          <given-names>Fabio</given-names>
        </name>
        <aff><institution>LIRMM, University of Montpellier, CNRS</institution>, Montpellier, <country country="FR">France</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-3791-3973</contrib-id>
        <name>
          <surname>Rivals</surname>
          <given-names>Eric</given-names>
        </name>
        <aff><institution>LIRMM, University of Montpellier, CNRS</institution>, Montpellier, <country country="FR">France</country></aff>
        <xref rid="btad692-cor1" ref-type="corresp"/>
        <!--rivals@lirmm.fr-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Schwartz</surname>
          <given-names>Russell</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <fn id="btad692-FM1">
        <p>Present address of Benjamin Linard: INRAE, UR MIAT, University of Toulouse, F-31320 Castanet-Tolosan, France</p>
      </fn>
      <corresp id="btad692-cor1">Corresponding authors. LIRMM UMR 5506, 860 rue St Priest, 34095 Montpellier cedex 5, France. E-mails: <email>nromashchenko@lirmm.fr</email> (N.R.) and <email>rivals@lirmm.fr</email> (E.R.)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>12</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-11-17">
      <day>17</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>17</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <volume>39</volume>
    <issue>12</issue>
    <elocation-id>btad692</elocation-id>
    <history>
      <date date-type="received">
        <day>15</day>
        <month>3</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>20</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>15</day>
        <month>10</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>16</day>
        <month>11</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>06</day>
        <month>12</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btad692.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Phylogenetic placement enables phylogenetic analysis of massive collections of newly sequenced DNA, when <italic toggle="yes">de novo</italic> tree inference is too unreliable or inefficient. Assuming that a high-quality reference tree is available, the idea is to seek the correct placement of the new sequences in that tree. Recently, alignment-free approaches to phylogenetic placement have emerged, both to circumvent the need to align the new sequences and to avoid the calculations that typically follow the alignment step. A promising approach is based on the inference of <italic toggle="yes">k</italic>-mers that can be potentially related to the reference sequences, also called phylo-<italic toggle="yes">k</italic>-mers. However, its usage is limited by the time and memory-consuming stage of reference data preprocessing and the large numbers of <italic toggle="yes">k</italic>-mers to consider.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We suggest a filtering method for selecting informative phylo-<italic toggle="yes">k</italic>-mers based on mutual information, which can significantly improve the efficiency of placement, at the cost of a small loss in placement accuracy. This method is implemented in <italic toggle="yes">IPK</italic>, a new tool for computing phylo-<italic toggle="yes">k</italic>-mers that significantly outperforms the software previously available. We also present <italic toggle="yes">EPIK</italic>, a new software for phylogenetic placement, supporting filtered phylo-<italic toggle="yes">k</italic>-mer databases. Our experiments on real-world data show that <italic toggle="yes">EPIK</italic> is the fastest phylogenetic placement tool available, when placing hundreds of thousands and millions of queries while still providing accurate placements.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p><italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic> are freely available at <ext-link xlink:href="https://github.com/phylo42/IPK" ext-link-type="uri">https://github.com/phylo42/IPK</ext-link> and <ext-link xlink:href="https://github.com/phylo42/EPIK" ext-link-type="uri">https://github.com/phylo42/EPIK</ext-link>. Both are implemented in C++ and Python and supported on Linux and MacOS.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>French Ministry of Research</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Union’s Horizon 2020</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>French National Agency for Research</institution>
            <institution-id institution-id-type="DOI">10.13039/501100001665</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Phylogenetic placement is an increasingly popular task in phylogenetic analysis (<xref rid="btad692-B12" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2022</xref>). Its input is a set of reference sequences (often aligned), a phylogenetic tree representing their evolution, and a (usually large) collection of novel query sequences. The problem is to find, for each query, the likely location(s) of its evolutionary origin in the reference tree. Applications of phylogenetic placement range from taxonomic identification and microbiome analysis (<xref rid="btad692-B31" ref-type="bibr">Thompson <italic toggle="yes">et al.</italic> 2017</xref>, <xref rid="btad692-B16" ref-type="bibr">Janssen <italic toggle="yes">et al.</italic> 2018</xref>, <xref rid="btad692-B1" ref-type="bibr">Asnicar <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btad692-B8" ref-type="bibr">Bohmann <italic toggle="yes">et al.</italic> 2020</xref>), to the inference of new clades (<xref rid="btad692-B13" ref-type="bibr">Dunthorn <italic toggle="yes">et al.</italic> 2014</xref>, <xref rid="btad692-B5" ref-type="bibr">Bass <italic toggle="yes">et al.</italic> 2018</xref>), and tracking of viral variants (<xref rid="btad692-B28" ref-type="bibr">Singer <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btad692-B32" ref-type="bibr">Turakhia <italic toggle="yes">et al.</italic> 2021</xref>).</p>
    <p>The interest of phylogenetic placement is particularly evident for amplicon-based analysis of environmental samples. Because of the number and limited length of the sequences typically found in these samples, <italic toggle="yes">de novo</italic> phylogenetic inference would be too unreliable and inefficient on these data (<xref rid="btad692-B12" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2022</xref>). Moreover, phylogenetic placement software plays a key role in an ecosystem of tools for biodiversity quantification and visualization (<xref rid="btad692-B11" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btad692-B4" ref-type="bibr">Barbera <italic toggle="yes">et al.</italic> 2021</xref>), sample comparison, and identification of correlations (<xref rid="btad692-B10" ref-type="bibr">Czech and Stamatakis 2019</xref>).</p>
    <p>Early phylogenetic placement tools such as <italic toggle="yes">pplacer</italic> (<xref rid="btad692-B22" ref-type="bibr">Matsen <italic toggle="yes">et al.</italic> 2010</xref>) and <italic toggle="yes">EPA</italic> [<italic toggle="yes">Evolutionary Placement Algorithm</italic>; <xref rid="btad692-B6" ref-type="bibr">Berger <italic toggle="yes">et al.</italic> (2011)</xref>] were based on maximum likelihood (ML) inference—a successful approach that provides highly accurate placements. However, those implementations suffered from two scalability problems. First, they were limited by the size of the reference tree, making it problematic to apply them to large phylogenies, e.g. with dozens of thousands of taxa (<xref rid="btad692-B17" ref-type="bibr">Koning <italic toggle="yes">et al.</italic> 2021</xref>). Second, those methods require to <italic toggle="yes">align each query</italic> to the reference sequences, which is why such methods are called <italic toggle="yes">alignment-based</italic>. Naturally, they also require a multiple alignment of the reference sequences, which is nonetheless often is a prerequisite to estimate the tree (or at least branch lengths and model parameters). The limitation of alignment-based methods is that, even though queries are typically short, their alignment to long reference sequences is poorly scalable with the ever-increasing amounts of sequencing data delivered by current technologies.</p>
    <p>Further developments in phylogenetic placement methods focused on overcoming those challenges. <italic toggle="yes">APPLES</italic>, followed by <italic toggle="yes">APPLES-2</italic> (<xref rid="btad692-B15" ref-type="bibr">Hasan <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btad692-B2" ref-type="bibr">Balaban <italic toggle="yes">et al.</italic> 2022</xref>), was the first method enabling placement to ultra-large phylogenies. It is a distance-based method, where the distances between the query and the reference sequences can be computed on the basis of an alignment, or in an alignment-free way. It allows placing queries to trees of hundreds of thousands of taxa at the cost of lower placement accuracy compared to competing methods. Similar developments include <italic toggle="yes">pplacerDC</italic> (<xref rid="btad692-B17" ref-type="bibr">Koning <italic toggle="yes">et al.</italic> 2021</xref>) and <italic toggle="yes">SCAMPP</italic> (<xref rid="btad692-B33" ref-type="bibr">Wedell <italic toggle="yes">et al.</italic> 2023</xref>), which implement heuristics extending the applicability of ML-based placement to large phylogenies.</p>
    <p><italic toggle="yes">EPA-ng—</italic>the successor of <italic toggle="yes">EPA—</italic>significantly improved the ML-based placement speed with massive parallelization (<xref rid="btad692-B3" ref-type="bibr">Barbera <italic toggle="yes">et al.</italic> 2019</xref>). However, the challenge of aligning query sequences was only addressed by the recent emergence of <italic toggle="yes">alignment-free</italic> methods. <italic toggle="yes">RAPPAS</italic> preprocesses the references by computing <italic toggle="yes">phylo-k-mers</italic> independent of queries (<xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2019</xref>). Phylo-<italic toggle="yes">k</italic>-mers are stored for later use during placement. This allows <italic toggle="yes">RAPPAS</italic> to avoid aligning the queries, which explains the “alignment-free” term (even though the input contains aligned reference sequences), and makes it highly scalable in the number of queries to place. Moreover, <italic toggle="yes">RAPPAS</italic> proved to be highly accurate, especially for short queries (<xref rid="btad692-B7" ref-type="bibr">Blanke and Morgenstern 2021</xref>).</p>
    <p>Another recent alignment-free development is <italic toggle="yes">App-SpaM</italic>, a distance-based method that utilizes the concept of spaced words (<xref rid="btad692-B7" ref-type="bibr">Blanke and Morgenstern 2021</xref>). <italic toggle="yes">App-SpaM</italic> has a number of practical advantages: it is among the fastest phylogenetic placement tools and requires the reference sequences to be neither aligned nor assembled. When reference sequences are aligned and assembled, however, <italic toggle="yes">App-SpaM</italic> is usually not the most accurate tool available (<xref rid="btad692-B7" ref-type="bibr">Blanke and Morgenstern 2021</xref>).</p>
    <p>Here, we take further steps to overcome the challenges of phylogenetic placement and introduce two tools that together form the successor of <italic toggle="yes">RAPPAS</italic>. First, we present <italic toggle="yes">IPK</italic> (<italic toggle="yes">Inference of Phylo-K-mers</italic>), a tool for efficient computation of phylo-<italic toggle="yes">k</italic>-mers. <italic toggle="yes">IPK</italic> improves the running times of the phylo-<italic toggle="yes">k</italic>-mer construction step by up to two orders of magnitude. We also introduce <italic toggle="yes">phylo-k-mer filtering—</italic>a method to reduce large phylo-<italic toggle="yes">k</italic>-mer collections with little or no loss in placement accuracy. These developments improve the scalability of computing phylo-<italic toggle="yes">k</italic>-mers to larger phylogenies. Second, we present <italic toggle="yes">EPIK</italic> (<italic toggle="yes">Evolutionary Placement with Informative K-mers</italic>), an optimized parallel implementation of placement with filtered phylo-<italic toggle="yes">k</italic>-mers. <italic toggle="yes">EPIK</italic> substantially outperforms its predecessor. We provide experiments on placement accuracy and speed, showing that <italic toggle="yes">EPIK</italic> can place millions of short queries on a single thread in a matter of minutes or hours. When placing large collections of queries, <italic toggle="yes">EPIK</italic> outperforms the state-of-the-art in placement speed, while remaining highly accurate.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>Let <italic toggle="yes">A</italic> denote a <italic toggle="yes">reference sequence alignment</italic>, and <italic toggle="yes">T</italic> denote a <italic toggle="yes">reference phylogenetic tree</italic> whose leaves are in one-to-one correspondence with the sequences of <italic toggle="yes">A</italic>. Sequences can be either composed of nucleotides or amino acids. Besides <italic toggle="yes">A</italic> and <italic toggle="yes">T</italic>, a collection of <italic toggle="yes">query</italic> sequences is also given. Then, for any query <italic toggle="yes">q</italic>, phylogenetic placement aims to identify the branch from which <italic toggle="yes">q</italic> likely diverged from the rest of the tree. Some placement methods also estimate the precise position of the divergence along the identified branch, and the length of the pendant branch terminating in <italic toggle="yes">q</italic>. Note that the reference tree remains fixed, and the queries are not actually added to the tree; this leaves the evolutionary relationships between queries unresolved. Also, we assume that the query sequence is homologous to parts of the reference sequences. This is an essential prerequisite to most phylogenetic placement methods (<xref rid="btad692-B12" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2022</xref>).</p>
    <p>As in <italic toggle="yes">RAPPAS</italic>, our method splits phylogenetic placement into two stages (see <xref rid="btad692-F1" ref-type="fig">Fig. 1</xref> for an illustration). First, <italic toggle="yes">IPK</italic> preprocesses <italic toggle="yes">A</italic> and <italic toggle="yes">T</italic> to create a <italic toggle="yes">phylo-k-mer database</italic>. This stage does not require any knowledge of query sequences. Second, <italic toggle="yes">EPIK</italic> uses phylo-<italic toggle="yes">k</italic>-mers to place the query sequences in an alignment-free way, based on the matches between the <italic toggle="yes">k</italic>-mers in the query and the phylo-<italic toggle="yes">k</italic>-mers in the database. Note that once we have the phylo-<italic toggle="yes">k</italic>-mer database computed for a given alignment and tree, we can reuse it to place queries as many times as needed.</p>
    <fig position="float" id="btad692-F1">
      <label>Figure 1.</label>
      <caption>
        <p><italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic>. (a) <italic toggle="yes">IPK</italic> takes an alignment of reference sequences and a reference tree as input. The alignment and tree are preprocessed, most notably the tree is extended by adding ghost nodes and ghost branches. Then state probabilities are computed at every ghost node and alignment site. On the basis of this, a phylo-<italic toggle="yes">k</italic>-mer database is constructed. Finally, mutual information values are computed and stored alongside the rest of the phylo-<italic toggle="yes">k</italic>-mer database for later use. (b) <italic toggle="yes">EPIK</italic> takes the phylo-<italic toggle="yes">k</italic>-mer database (with the corresponding reference tree and mutual information values) and query sequences as input. Depending on the way <italic toggle="yes">EPIK</italic> is called, the whole or a part of the phylo-<italic toggle="yes">k</italic>-mer database is loaded in memory. The <italic toggle="yes">k</italic>-mers of every query are searched in the database to place it onto the reference phylogeny. The result is a phylogenetic placement file (.jplace-formatted), one for each input query file.</p>
      </caption>
      <graphic xlink:href="btad692f1" position="float"/>
    </fig>
    <sec>
      <title>2.1 Phylo-<italic toggle="yes">k</italic>-mer inference</title>
      <p>Phylo-<italic toggle="yes">k</italic>-mers can be thought of as <italic toggle="yes">k</italic>-mers equipped with probabilistic information about their possible branches of origin in the reference phylogeny. More precisely, we define a phylo-<italic toggle="yes">k</italic>-mer for a given <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> and fixed <italic toggle="yes">A</italic>, <italic toggle="yes">T</italic> as a tuple <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <italic toggle="yes">y</italic> is a branch of <italic toggle="yes">T</italic>, and <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is a <italic toggle="yes">phylo-k-mer score</italic>. This score is an approximation of the probability of <italic toggle="yes">w</italic> being a substring of an unobserved sequence homologous to those in <italic toggle="yes">A</italic>, that diverged from the rest of <italic toggle="yes">T</italic> somewhere along <italic toggle="yes">y</italic> (<xref rid="btad692-B24" ref-type="bibr">Romashchenko 2021</xref>).</p>
      <p>We compute phylo-<italic toggle="yes">k</italic>-mers in a way that that resembles the one of <italic toggle="yes">RAPPAS</italic> (see <xref rid="btad692-F1" ref-type="fig">Fig. 1a</xref> for an illustration). We assume a given stochastic model of sequence evolution, and that the branch lengths of <italic toggle="yes">T</italic> were estimated by maximum likelihood under this model. We also assume that <italic toggle="yes">T</italic> is rooted. First, we filter the alignment by removing the columns that contain a certain user-defined percentage of gaps. Second, we create an extended tree by adding <italic toggle="yes">ghost nodes</italic> and <italic toggle="yes">ghost branches</italic> to <italic toggle="yes">T</italic>: for every branch <italic toggle="yes">y</italic>, we add a node <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> at the midpoint of <italic toggle="yes">y</italic>, a new leaf <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, and a new branch <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Ghost nodes aim to represent hypothetical ancestral sequences, as well as related sequences that diverged in the past but are not directly represented by the references. (See <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S6</xref> for some additional arguments on the design of ghost nodes.) We set the length of the new branch to the mean length among all paths from <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> to the leaves of <italic toggle="yes">T</italic> that descend from <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>. This value represents our expectation of how evolutionary distant may be the queries that should be placed onto <italic toggle="yes">y</italic>. Notice that since we average over all descending paths from <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, it makes correct rooting an important prerequisite of our method.</p>
      <p>Then we use standard techniques for ancestral sequence reconstruction to compute the posterior probabilities of any state (nucleotide for DNA and amino acid for proteins) at any site (position) of the alignment for a given node of the phylogeny. <italic toggle="yes">IPK</italic> can execute <italic toggle="yes">PhyML</italic> or <italic toggle="yes">RAxML-ng</italic> (<xref rid="btad692-B14" ref-type="bibr">Guindon <italic toggle="yes">et al.</italic> 2010</xref>, <xref rid="btad692-B18" ref-type="bibr">Kozlov <italic toggle="yes">et al.</italic> 2019</xref>) to perform these computations. This step results in a matrix with as many columns as in <italic toggle="yes">A</italic>, describing posterior state probability distributions for every ghost node <italic toggle="yes">u</italic>. Note that assuming statistical independence of states at different sites of the alignment, this step also defines the probability of any <italic toggle="yes">k</italic>-mer at <italic toggle="yes">u</italic> and any <italic toggle="yes">k</italic> consecutive sites of <italic toggle="yes">A</italic>.</p>
      <p>The next step is to find, for any ghost node, all <italic toggle="yes">k</italic>-mers whose probability is greater than a user-defined threshold <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mo>ε</mml:mo></mml:math></inline-formula> for at least one set of <italic toggle="yes">k</italic> consecutive sites in the alignment. For this step, we apply a new divide-and-conquer algorithm instead of the branch-and-bound algorithm used in <italic toggle="yes">RAPPAS</italic>, because the new algorithm is shown to be faster in practice [see <xref rid="btad692-B25" ref-type="bibr">Romashchenko <italic toggle="yes">et al.</italic> (2023)</xref> for detail and analysis].</p>
      <p>For each <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> generated in the above step, we consider a phylo-<italic toggle="yes">k</italic>-mer <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <italic toggle="yes">y</italic> is the branch corresponding to the ghost node where <italic toggle="yes">w</italic> was generated, and <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is set to the maximum probability over all possible choices of <italic toggle="yes">k</italic> consecutive columns in <italic toggle="yes">A</italic>, and over the two ghost nodes corresponding to <italic toggle="yes">y</italic>. Such phylo-<italic toggle="yes">k</italic>-mers can later be retrieved from what we call a <italic toggle="yes">phylo-k-mer database</italic>: a set of <italic toggle="yes">k</italic>-mers mapped to lists of tuples <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> giving scores of <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> for branches <italic toggle="yes">y</italic> such that <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>&gt;</mml:mo><mml:mo>ε</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>Since such databases can reach huge sizes, and because <italic toggle="yes">k</italic>-mers do not contribute equally to placement inference, we designed <italic toggle="yes">phylo-k-mer filtering</italic>, an approach for selecting informative <italic toggle="yes">k</italic>-mers. For every <italic toggle="yes">k</italic>-mer, we compute a filter value indicating how informative for placement the <italic toggle="yes">k</italic>-mer is, and sort <italic toggle="yes">k</italic>-mers by filter value. We propose two algorithms to form the phylo-<italic toggle="yes">k</italic>-mer database: in memory for speed and on disk for low memory usage. We describe both algorithms in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref>.</p>
    </sec>
    <sec>
      <title>2.2 Phylo-<italic toggle="yes">k</italic>-mer filtering</title>
      <p>One of the main novelties of <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic> is the possibility of filtering phylo-<italic toggle="yes">k</italic>-mers. This means selecting the <italic toggle="yes">k</italic>-mers that are the most informative for phylogenetic placement according to a measure derived from information theory. We view phylo-<italic toggle="yes">k</italic>-mer-based phylogenetic placement as a classification problem, where (i) the <italic toggle="yes">observations</italic> to classify are the queries, (ii) the <italic toggle="yes">classes</italic> that they must be assigned to are the branches of the reference tree, and, finally, (iii) the <italic toggle="yes">features</italic> used for the classification of a query are all the possible <italic toggle="yes">k</italic>-mers.</p>
      <p>Similarly to feature selection in text classification (<xref rid="btad692-B23" ref-type="bibr">McCallum and Nigam 1998</xref>), we wish to retain the features (<italic toggle="yes">k</italic>-mers) that maximize the <italic toggle="yes">mutual information</italic> (MI) between the class (branch) variable <italic toggle="yes">Y</italic> and the variable <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> indicating whether the <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> is present in the query (i.e. <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> or 0, depending on whether <italic toggle="yes">w</italic> is present or absent, respectively).</p>
      <p>In information theory, the mutual information between these random variables, denoted <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>;</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, is defined as the expected gain of information about <italic toggle="yes">Y</italic> (i.e. reduction in <italic toggle="yes">Y</italic>’s entropy) resulting from observing <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref rid="btad692-B9" ref-type="bibr">Cover and Thomas 2006</xref>):
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>;</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mo> </mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula></p>
      <p>Since <italic toggle="yes">EPIK</italic> only uses the presence of <italic toggle="yes">k</italic>-mers (and not their absence) to determine the placement of a query (see Section 2.3), the filtering is based on the following modification of the above formula, which only keeps the term with <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>:
<disp-formula id="E2"><label>(1)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="E3"><label>(2)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:mo>=</mml:mo><mml:mi>c</mml:mi><mml:mo>⋅</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo><mml:mo>+</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>y</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>Here, <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> is the total score of <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> [i.e. <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>y</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>], <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the set of tree branches, and <italic toggle="yes">c</italic> is independent of <italic toggle="yes">w</italic> and thus does not play any role in the filtering of <italic toggle="yes">k</italic>-mers. In <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1</xref>, we provide more detail about this formula, including the derivation of <xref rid="E3" ref-type="disp-formula">(2)</xref> from <xref rid="E2" ref-type="disp-formula">(1)</xref> and an alternative explanation of why we only keep the term with <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> in <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>;</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Intuitively, selecting <italic toggle="yes">k</italic>-mers maximizing <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> favors the ones that both are probable and cause a greater gain of information about the placement branch when observed in the query. A thorough analysis leading to this formula is given by <xref rid="btad692-B24" ref-type="bibr">Romashchenko (2021)</xref>.</p>
      <p>We filter phylo-<italic toggle="yes">k</italic>-mers as follows. First, we compute <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for all computed <italic toggle="yes">k</italic>-mers. Second, we sort <italic toggle="yes">k</italic>-mers in descending order of <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and serialize them. We implement this procedure differently for the in-memory and on-disk algorithms; see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref> for detail. As a result, the database on disk is represented so that more informative <italic toggle="yes">k</italic>-mers are closer to the beginning of the database file. For placement, we deserialize <italic toggle="yes">k</italic>-mers in their order until we reach a certain proportion of the entire database’s size or the memory limit set by the user.</p>
    </sec>
    <sec>
      <title>2.3 Placement step</title>
      <p>On the basis of a precomputed phylo-<italic toggle="yes">k</italic>-mer database, <italic toggle="yes">EPIK</italic> places query sequences in the following fashion (<xref rid="btad692-F1" ref-type="fig">Fig. 1b</xref>): First, it loads the entirety or part of the database into memory by applying <italic toggle="yes">k</italic>-mer filtering. This consists in loading <italic toggle="yes">k</italic>-mers with their scores until the given memory limit is reached or the complete database is loaded. At the same time, <italic toggle="yes">EPIK</italic> populates a hashmap from <italic toggle="yes">k</italic>-mers to lists of associated tuples of branches and phylo-<italic toggle="yes">k</italic>-mer scores. Since <italic toggle="yes">k</italic>-mers are stored ordered by <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, loading time is linear in the size of loaded information. Then each query is placed independently by searching its constituent <italic toggle="yes">k</italic>-mers in the database. For a given query <italic toggle="yes">q</italic>, a log-likelihood score of placing <italic toggle="yes">q</italic> onto branch <italic toggle="yes">y</italic> is computed as follows:
<disp-formula id="E4"><label>(3)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>k</mml:mi></mml:mfrac></mml:mrow><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>q</mml:mi><mml:mo>|</mml:mo><mml:mo>−</mml:mo><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow><mml:mo>{</mml:mo><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mo>ε</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>}</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>q</mml:mi><mml:mo>|</mml:mo><mml:mo>−</mml:mo><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> are all the <italic toggle="yes">k</italic>-mers in <italic toggle="yes">q</italic>. This formula assumes that the branches that do not appear in any tuple associated to a <italic toggle="yes">k</italic>-mer have a phylo-<italic toggle="yes">k</italic>-mer score <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mo>ε</mml:mo></mml:math></inline-formula>. Also, note that we intend <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> to approximate the log-probability of sequence <italic toggle="yes">q</italic> diverging from branch <italic toggle="yes">y</italic>. Therefore, the term <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula> corrects for the fact that the sum above includes the log-probability of most query characters <italic toggle="yes">k</italic> times. For each query, we report a number of top-scored branches together with (approximate) likelihood weight ratios, computed as follows (where <italic toggle="yes">b</italic> is the base of the logarithm):
<disp-formula id="E5"><mml:math id="M5" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">LWR</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mi>x</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec>
      <title>2.4 Placement accuracy evaluation</title>
      <p>To evaluate placement accuracy, we used <italic toggle="yes">PEWO</italic> (<italic toggle="yes">Placement Evaluation Workflows</italic>), a framework recently developed by <xref rid="btad692-B20" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> (2021)</xref>. We evaluated the accuracy of <italic toggle="yes">EPIK</italic>’s placement with and without filtering, as well as the accuracy of the other state-of-the-art phylogenetic placement methods. We used the pruning-based accuracy procedure (<italic toggle="yes">PAC</italic>) of <italic toggle="yes">PEWO</italic> that computes the accuracy of phylogenetic placement as follows. First, given a reference alignment and a reference tree, it randomly selects a subtree to remove (“prune”) from the original tree. Second, it extracts query reads from the sequences associated with the leaves removed. Then, query reads are placed on the remaining tree. Finally, for every placed query read, it computes the <italic toggle="yes">node distance</italic> between the observed placement and the expected placement. Node distance is defined as the number of tree nodes on the path between the branch reported as the query’s top-scoring placement (the observed placement) and the branch that was created as a result of pruning the subtree (the expected placement). We used node distance as it is the most commonly used way of evaluating phylogenetic placement accuracy (<xref rid="btad692-B12" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2022</xref>). Also, <italic toggle="yes">APPLES2</italic> and <italic toggle="yes">App-SpaM</italic> do not output multiple placements along with relative confidence scores and thus do not support evaluating <italic toggle="yes">expected</italic> node distance.</p>
      <p>We compared the accuracy of <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic> against the latest versions of state-of-the-art phylogenetic placement tools: <italic toggle="yes">pplacer</italic>, <italic toggle="yes">EPA-ng</italic>, <italic toggle="yes">App-SpaM</italic>, <italic toggle="yes">APPLES2</italic>, and <italic toggle="yes">RAPPAS</italic> (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S5</xref> for details). We used <italic toggle="yes">PhyML</italic> for ancestral reconstruction required by <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">IPK</italic>. We did not include <italic toggle="yes">EPA</italic> in the evaluation since it is the predecessor of <italic toggle="yes">EPA-ng</italic> and because <italic toggle="yes">EPA-ng</italic> supports <italic toggle="yes">EPA</italic>’s placement algorithm as one of the options. We ran these tools for 50 prunings (prunings and queries are identical for all tools). For each pruning, we report the mean node distance across several 150-bp-long queries generated for that pruning. The number of generated queries per pruning is variable, as it depends on the number of sequences in the pruned subtree, and on the length of those sequences. We ran all tools with their default parameters, except <italic toggle="yes">RAPPAS</italic>, for which we used the defaults of <italic toggle="yes">EPIK</italic>: <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> for DNA and <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:math></inline-formula> for proteins instead of the <italic toggle="yes">RAPPAS</italic>’ default <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula>. Generally, using higher values of <italic toggle="yes">k</italic>, we can expect increased placement accuracy; we used these values to facilitate comparison with <italic toggle="yes">EPIK</italic>. We ran <italic toggle="yes">EPA-ng</italic>, <italic toggle="yes">pplacer</italic>, and <italic toggle="yes">APPLES2</italic> using query-reference alignments constructed with <italic toggle="yes">HMMER</italic> in the way it is implemented by default in <italic toggle="yes">PEWO</italic>.</p>
      <p>To test the placement accuracy of <italic toggle="yes">EPIK</italic>, we used seven real-world datasets of amino acid and nucleotide sequences, where the number of reference sequences ranged from 140 to 3748. All of these datasets have been previously used as benchmarks for the accuracy of phylogenetic placement methods. Three datasets consist of sequences for widely used metabarcoding markers: <italic toggle="yes">D218</italic>, <italic toggle="yes">D500</italic> (<xref rid="btad692-B6" ref-type="bibr">Berger <italic toggle="yes">et al.</italic> 2011</xref>), and <italic toggle="yes">D652</italic> (<xref rid="btad692-B29" ref-type="bibr">Srinivasan <italic toggle="yes">et al.</italic> 2012</xref>, <xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2019</xref>). Three others contain full-length viral sequences: <italic toggle="yes">D140</italic> (<xref rid="btad692-B6" ref-type="bibr">Berger <italic toggle="yes">et al.</italic> 2011</xref>), <italic toggle="yes">HCV</italic> (<xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2019</xref>), and <italic toggle="yes">HIV</italic> (<xref rid="btad692-B27" ref-type="bibr">Schultz <italic toggle="yes">et al.</italic> 2009</xref>). <xref rid="btad692-T1" ref-type="table">Table 1</xref> gives a short description of these datasets (including two other datasets, <italic toggle="yes">neotrop</italic> and <italic toggle="yes">tara</italic>, that were used to test efficiency).</p>
      <table-wrap position="float" id="btad692-T1">
        <label>Table 1.</label>
        <caption>
          <p>Datasets used to evaluate the accuracy or speed of phylogenetic placement.<xref rid="tblfn1" ref-type="table-fn"><sup>a</sup></xref></p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Dataset</th>
              <th rowspan="1" colspan="1">Type</th>
              <th rowspan="1" colspan="1">Locus</th>
              <th rowspan="1" colspan="1">No. of taxa</th>
              <th rowspan="1" colspan="1">
                <bold>Length (</bold>
                <inline-formula id="IE35">
                  <mml:math id="IM35" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>×</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:mn>10</mml:mn>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mn>3</mml:mn>
                        </mml:msup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
                <bold>)</bold>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D218</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Bacterial 16S rRNA</td>
              <td rowspan="1" colspan="1">218</td>
              <td rowspan="1" colspan="1">1.5</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D500</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Chloroplast rbcL gene</td>
              <td rowspan="1" colspan="1">500</td>
              <td rowspan="1" colspan="1">1.4</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D652</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Bacterial 16S rRNA</td>
              <td rowspan="1" colspan="1">652</td>
              <td rowspan="1" colspan="1">1.3</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">neotrop</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Eukaryote 18S rRNA</td>
              <td rowspan="1" colspan="1">512</td>
              <td rowspan="1" colspan="1">1.8</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">tara</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Bacterial 16S rRNA</td>
              <td rowspan="1" colspan="1">3748</td>
              <td rowspan="1" colspan="1">1.4</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">HCV</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Complete genome</td>
              <td rowspan="1" colspan="1">155</td>
              <td rowspan="1" colspan="1">9.4</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">HIV</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Complete genome</td>
              <td rowspan="1" colspan="1">881</td>
              <td rowspan="1" colspan="1">9.0</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D140</italic>
              </td>
              <td rowspan="1" colspan="1">AA</td>
              <td rowspan="1" colspan="1">Genome-scale</td>
              <td rowspan="1" colspan="1">140</td>
              <td rowspan="1" colspan="1">1.0</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn1">
            <label>a</label>
            <p>The “Length” column contains the average length of the sequences, measured in units corresponding to the data type (nucleotides or amino acids).</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec>
      <title>2.5 Placement accuracy with filtering</title>
      <p>When we remove phylo-<italic toggle="yes">k</italic>-mers from the database, we expect placement accuracy to decrease. We aimed to answer two questions: how quickly does the accuracy decay with increased filtering, and how much can we filter out without hurting placement accuracy significantly? To investigate this, we performed filtering using a parameter <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>∈</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> indicating the fraction of the original database to keep (if <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, no filtering was performed). That is, if <inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">D</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula> denotes the size of the entire database <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mi mathvariant="script">D</mml:mi></mml:math></inline-formula>, we selected <italic toggle="yes">k</italic>-mers until it was impossible to add the next <italic toggle="yes">k</italic>-mer and its associated tuples, without exceeding the database size of <inline-formula id="IE40"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>⋅</mml:mo><mml:mo>|</mml:mo><mml:mi mathvariant="script">D</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>We used pruning-based accuracy evaluation in the following manner. First, for a given set of input data and a range of values of <inline-formula id="IE41"><mml:math id="IM41" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>∈</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>, we computed phylo-<italic toggle="yes">k</italic>-mer databases applying the corresponding filtering ratios <inline-formula id="IE42"><mml:math id="IM42" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>. Then, we evaluated the mean node distance for 30 prunings for every produced filtered database. We carried out this procedure for both the MI filter and a random filter. The random filter selects <italic toggle="yes">k</italic>-mers in random order until a fraction <inline-formula id="IE43"><mml:math id="IM43" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula> of the original database is kept. As input data, we used the same datasets as in the placement accuracy experiments described in Section 2.4.</p>
    </sec>
    <sec>
      <title>2.6 Running time and memory consumption</title>
      <p>We compare the running time and memory consumption of <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic> against other tools using the <italic toggle="yes">RES</italic> workflow of <italic toggle="yes">PEWO</italic> (<xref rid="btad692-B20" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2021</xref>). We used datasets with different tree sizes and alignment lengths: <italic toggle="yes">D652</italic>, <italic toggle="yes">neotrop</italic> (<xref rid="btad692-B21" ref-type="bibr">Mahé <italic toggle="yes">et al.</italic> 2017</xref>), <italic toggle="yes">tara</italic> (<xref rid="btad692-B30" ref-type="bibr">Sunagawa <italic toggle="yes">et al.</italic> 2015</xref>), and <italic toggle="yes">HCV</italic>. For <italic toggle="yes">D652</italic> and <italic toggle="yes">tara</italic>, we used ten million of 100–150 bp real-world amplicon reads of bacterial 16S rRNA gene retrieved from the Earth Microbiome Project (<xref rid="btad692-B31" ref-type="bibr">Thompson <italic toggle="yes">et al.</italic> 2017</xref>, <xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2019</xref>). For <italic toggle="yes">HCV</italic>, we used ten million queries of 150 bp simulated for the study of <xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> (2019)</xref>. For <italic toggle="yes">neotrop</italic>, we used ten million real-world 18S rRNA reads of various lengths [both the reference and the queries were retrieved from the study of <xref rid="btad692-B21" ref-type="bibr">Mahé <italic toggle="yes">et al.</italic> (2017)</xref>].</p>
      <p>We carried out experiments on a computer equipped with Intel(R) Xeon(R) W-2133 CPU @ 3.60 GHz/8.25 MB Cache/62 GB RAM and an HDD with SATA 3.0 and 64 MB cache. We ran all tools in a single-thread mode (not all of them support parallel execution). For the running time, we consider the total wall clock time; for the RAM consumption, we consider the peak maximum resident set size (RSS). Measurements were averaged over three repeats for every stage of computation of every program.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Implementation</title>
    <sec>
      <title>3.1 <italic toggle="yes">IPK</italic>: a standalone tool for computing phylo-<italic toggle="yes">k</italic>-mers</title>
      <p>We introduce <italic toggle="yes">IPK</italic>, a new tool for computing phylo-<italic toggle="yes">k</italic>-mers. A few essential differences set it apart from <italic toggle="yes">RAPPAS</italic>’s phylo-<italic toggle="yes">k</italic>-mer computation stage. First, we made <italic toggle="yes">IPK</italic> a standalone tool to ease the development of new applications of phylo-<italic toggle="yes">k</italic>-mers. <italic toggle="yes">IPK</italic> computes a database of phylo-<italic toggle="yes">k</italic>-mers for any given reference <italic toggle="yes">A</italic> and <italic toggle="yes">T</italic> and provides transparent access to this database to query <italic toggle="yes">k</italic>-mers. Applications such as <italic toggle="yes">EPIK</italic> and <italic toggle="yes">SHERPAS</italic> (<xref rid="btad692-B26" ref-type="bibr">Scholz <italic toggle="yes">et al.</italic> 2020</xref>) can use <italic toggle="yes">IPK</italic> as a black box through the provided API. Second, it applies a new, faster algorithm for phylo-<italic toggle="yes">k</italic>-mer computation (<xref rid="btad692-B25" ref-type="bibr">Romashchenko <italic toggle="yes">et al.</italic> 2023</xref>). When compared to <italic toggle="yes">RAPPAS</italic> for the default value <inline-formula id="IE44"><mml:math id="IM44" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>, <italic toggle="yes">IPK</italic> improves running times by more than two orders of magnitude (see Section 4.4 for experimental results). Third, <italic toggle="yes">IPK</italic> computes mutual information values for phylo-<italic toggle="yes">k</italic>-mers that are later used by <italic toggle="yes">EPIK</italic> for phylo-<italic toggle="yes">k</italic>-mer filtering. By default, <italic toggle="yes">IPK</italic> creates the database in memory and then stores it on disk. Alternatively, it can create the database directly on disk to reduce RAM consumption at the cost of longer execution (see Section 4.4 and <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref>). This allows for creating databases of sizes that exceed the amount of RAM available, which was not possible with <italic toggle="yes">RAPPAS</italic>.</p>
    </sec>
    <sec>
      <title>3.2 <italic toggle="yes">EPIK</italic>: faster phylo-<italic toggle="yes">k</italic>-mer-based phylogenetic placement</title>
      <p>We also developed <italic toggle="yes">EPIK</italic>, a new tool for phylogenetic placement with phylo-<italic toggle="yes">k</italic>-mers. It implements phylo-<italic toggle="yes">k</italic>-mer filtering, i.e. can place using only the most informative part of the phylo-<italic toggle="yes">k</italic>-mer database (defined by a proportion of the database size or a certain fixed size in bytes). This allows for placement even if the database is larger than the amount of RAM available. Also, <italic toggle="yes">EPIK</italic> can be run in parallel in shared memory for higher speed (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4</xref> for detail and results on parallel performance).</p>
      <p>Even when running in a single thread, <italic toggle="yes">EPIK</italic> achieves up to one order of magnitude improvement in placement speed over <italic toggle="yes">RAPPAS</italic> because of more efficient implementation (see Section 4.3 for experimental results). For an example of how to run <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic>, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S7</xref>.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Results</title>
    <sec>
      <title>4.1 Experiments on placement accuracy</title>
      <p>Here, we assess the placement accuracy of <italic toggle="yes">EPIK</italic> (with unfiltered databases) compared to the state-of-the-art on real-world datasets. <xref rid="btad692-F2" ref-type="fig">Figure 2</xref> shows the distributions of the mean node distance of placements per pruning (lower values are better). For two out of four datasets based on short metabarcoding markers (<italic toggle="yes">D500</italic>, <italic toggle="yes">D652</italic>, see <xref rid="btad692-F2" ref-type="fig">Fig. 2a</xref>), <italic toggle="yes">EPIK</italic> shows better accuracy compared to other state-of-the-art tools. These results are to some extent consistent with the ones of <xref rid="btad692-B7" ref-type="bibr">Blanke and Morgenstern (2021)</xref>, where <italic toggle="yes">RAPPAS</italic> using <inline-formula id="IE45"><mml:math id="IM45" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula> showed the best accuracy on four out of six 16S datasets.</p>
      <fig position="float" id="btad692-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Results on phylogenetic placement accuracy of different tools. One point of the distribution represents placements of multiple queries placed to a particular pruned tree. The <italic toggle="yes">y</italic>-axis corresponds to the mean node distances for such groups of queries and their placements. (a) Metabarcoding markers datasets. (b) Full-genome viral datasets consisting of nucleotide sequences (<italic toggle="yes">HCV</italic>, <italic toggle="yes">HIV</italic>) and amino acid sequences (<italic toggle="yes">D140</italic>).</p>
        </caption>
        <graphic xlink:href="btad692f2" position="float"/>
      </fig>
      <p>For the viral datasets (<xref rid="btad692-F2" ref-type="fig">Fig. 2b</xref>), <italic toggle="yes">EPIK</italic> was comparable to the best performing methods (<italic toggle="yes">EPA-ng</italic> and <italic toggle="yes">pplacer</italic>) for <italic toggle="yes">HCV</italic> and <italic toggle="yes">D140</italic>, yet was inferior to <italic toggle="yes">App-SpaM</italic> for <italic toggle="yes">HIV</italic>. <italic toggle="yes">App-SpaM</italic> cannot be run for <italic toggle="yes">D140</italic> since it does not support protein sequences. Also, <italic toggle="yes">RAPPAS</italic> could not build phylo-<italic toggle="yes">k</italic>-mer databases for <italic toggle="yes">HIV</italic>, since it exceeded the 32 GB RAM limit.</p>
      <p><xref rid="btad692-F2" ref-type="fig">Figure 2</xref> also shows that, in general, the tools that are based on the same methodology tend to have very similar performance. For example, <italic toggle="yes">EPA-ng</italic> and <italic toggle="yes">pplacer</italic> tend to have very similar node distance distributions; also, the distributions for <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">EPIK</italic> are matching almost perfectly. However, there exist slight differences between <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">EPIK</italic> (not visible on <xref rid="btad692-F2" ref-type="fig">Fig. 2</xref>). This is due to floating-point rounding that <italic toggle="yes">IPK</italic>+<italic toggle="yes">EPIK</italic> handle better.</p>
      <p>Overall, <italic toggle="yes">EPIK</italic> showed similar or better accuracy in six out of seven experiments compared to the state-of-the-art software.</p>
    </sec>
    <sec>
      <title>4.2 Experiments on filtering performance</title>
      <p><xref rid="btad692-F3" ref-type="fig">Figure 3</xref> shows the placement accuracy results in the experiments with filtered databases. We compare the mean node distance (y-axis) obtained for different degrees of filtration (i.e. different values of <inline-formula id="IE46"><mml:math id="IM46" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, x-axis) against the mean node distance for <inline-formula id="IE47"><mml:math id="IM47" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (complete database) for the same dataset. We also compare the accuracy obtained for two filters—the mutual information (MI) filter and the random filter—obtained with the same value of <inline-formula id="IE48"><mml:math id="IM48" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>.</p>
      <fig position="float" id="btad692-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Results on <italic toggle="yes">k</italic>-mer filtering for the mutual information filter and random selection of <italic toggle="yes">k</italic>-mers. The <italic toggle="yes">x</italic>-axis corresponds to the ratio of filtered versus unfiltered database size. The <italic toggle="yes">y</italic>-axis corresponds to the mean node distances of placements (averaged over 30 prunings) obtained with filtered databases. Vertical bars represent standard errors of the means. (a) Results for metabarcoding markers. (b) Results for viral genomes.</p>
        </caption>
        <graphic xlink:href="btad692f3" position="float"/>
      </fig>
      <p>First, note that for all datasets and all values of <inline-formula id="IE49"><mml:math id="IM49" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, MI filtering showed better results than the baseline (always lower node distance than for random filtering). For <italic toggle="yes">D218</italic> (see <xref rid="btad692-F3" ref-type="fig">Fig. 3a</xref>), the MI filter decreased the average placement accuracy by <inline-formula id="IE50"><mml:math id="IM50" display="inline" overflow="scroll"><mml:mrow><mml:mn>4.4</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> while keeping only <inline-formula id="IE51"><mml:math id="IM51" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula> of the information compared to the complete database (from 4.65 for <inline-formula id="IE52"><mml:math id="IM52" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> to 4.85 for <inline-formula id="IE53"><mml:math id="IM53" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>). For random filtering, the accuracy loss was <inline-formula id="IE54"><mml:math id="IM54" display="inline" overflow="scroll"><mml:mrow><mml:mn>74.8</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> (from 4.65 to 8.12). For <italic toggle="yes">D500</italic> and <inline-formula id="IE55"><mml:math id="IM55" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>, MI filtering reduced the accuracy by <inline-formula id="IE56"><mml:math id="IM56" display="inline" overflow="scroll"><mml:mrow><mml:mn>5.7</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> versus <inline-formula id="IE57"><mml:math id="IM57" display="inline" overflow="scroll"><mml:mrow><mml:mn>132</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for random filtering. For <italic toggle="yes">D652</italic> and the same filtration ratio, the average accuracy worsened by <inline-formula id="IE58"><mml:math id="IM58" display="inline" overflow="scroll"><mml:mrow><mml:mn>6.7</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE59"><mml:math id="IM59" display="inline" overflow="scroll"><mml:mrow><mml:mn>66.8</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for MI filtering and the baseline, respectively.</p>
      <p>For viral datasets (<xref rid="btad692-F3" ref-type="fig">Fig. 3b</xref>), <italic toggle="yes">k</italic>-mer filtering had a larger impact on accuracy. For <italic toggle="yes">D140</italic>, keeping <inline-formula id="IE60"><mml:math id="IM60" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula> of the database decreased the accuracy by <inline-formula id="IE61"><mml:math id="IM61" display="inline" overflow="scroll"><mml:mrow><mml:mn>86</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE62"><mml:math id="IM62" display="inline" overflow="scroll"><mml:mrow><mml:mn>190</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for MI and the baseline, respectively. For <italic toggle="yes">HCV</italic> and the same <inline-formula id="IE63"><mml:math id="IM63" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>, the accuracy change was <inline-formula id="IE64"><mml:math id="IM64" display="inline" overflow="scroll"><mml:mrow><mml:mn>83</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE65"><mml:math id="IM65" display="inline" overflow="scroll"><mml:mrow><mml:mn>132</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula>; still, the drop in accuracy was just <inline-formula id="IE66"><mml:math id="IM66" display="inline" overflow="scroll"><mml:mrow><mml:mn>3.2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> while halving the database using the MI filter (<inline-formula id="IE67"><mml:math id="IM67" display="inline" overflow="scroll"><mml:mrow><mml:mn>9.6</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for the baseline). For <italic toggle="yes">HIV</italic> and <inline-formula id="IE68"><mml:math id="IM68" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>, MI filtering decreased the average accuracy by <inline-formula id="IE69"><mml:math id="IM69" display="inline" overflow="scroll"><mml:mrow><mml:mn>7.1</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> (<inline-formula id="IE70"><mml:math id="IM70" display="inline" overflow="scroll"><mml:mrow><mml:mn>37.2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for the baseline). Note that results for the <italic toggle="yes">D140</italic> dataset are difficult to compare to those for other viral datasets, because of the different sequence type and length of <italic toggle="yes">k</italic>-mers.</p>
      <p>Note that <xref rid="btad692-F3" ref-type="fig">Fig. 3</xref> gives only means and standard errors for every node distance distribution for fixed <inline-formula id="IE71"><mml:math id="IM71" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>. <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S4</xref> gives a more detailed picture of the distributions. Overall, the results suggest that <italic toggle="yes">k</italic>-mer filtering can significantly reduce the phylo-<italic toggle="yes">k</italic>-mer database size with some (often negligible) decrease in placement accuracy.</p>
    </sec>
    <sec>
      <title>4.3 Running time: placement</title>
      <p>Here, we evaluate the scalability of the state-of-the-art tools and <italic toggle="yes">EPIK</italic> in the number of query sequences to place. <xref rid="btad692-F4" ref-type="fig">Figure 4</xref> presents measurements of wall-clock time required for placement of increasing numbers of queries. Importantly, the running times do not include any preprocessing needed by these methods. For <italic toggle="yes">EPA-ng</italic> and <italic toggle="yes">APPLES2</italic> by “preprocessing” we mean the alignment of queries to the reference alignment, while for <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">EPIK</italic> we mean the construction of the phylo-<italic toggle="yes">k</italic>-mer database. <italic toggle="yes">App-SpaM</italic> does not require any preprocessing. We present some results on preprocessing times in the next section. We stopped any jobs that required more than 32 GB of RAM.</p>
      <fig position="float" id="btad692-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Running time of different phylogenetic placement tools on four reference datasets. Preprocessing time is not counted for alignment-based methods (dotted lines) nor for alignment-free ones (solid lines). Measurements are averaged over three runs.</p>
        </caption>
        <graphic xlink:href="btad692f4" position="float"/>
      </fig>
      <p><italic toggle="yes">EPIK</italic> showed better placement time than <italic toggle="yes">RAPPAS</italic> in all experiments. The running time improvement over <italic toggle="yes">RAPPAS</italic> varied among datasets and the number of queries placed. For example, while placing ten million queries to <italic toggle="yes">D652</italic>, <italic toggle="yes">EPIK</italic> was around 14 times faster (29 min versus 6 h 49 min); for <italic toggle="yes">neotrop</italic> and ten million queries, it was 18 times faster (1 h 34 min versus 28 h). The lower relative performance of <italic toggle="yes">EPIK</italic> for fewer queries is due to the overhead required by loading the phylo-<italic toggle="yes">k</italic>-mer database in memory that is constant and does not depend on the number of queries placed. We also note that the loaded database size greatly affects the memory consumption of <italic toggle="yes">EPIK</italic> (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S3</xref> for measurements); this, however, can be reduced with phylo-<italic toggle="yes">k</italic>-mer filtering.</p>
      <p>In conclusion, alignment-free approaches showed consistently better running times than alignment-based ones, even if we exclude the time to align query sequences. <italic toggle="yes">EPIK</italic> showed the best running time against all tools on all datasets tested while placing a hundred thousand or more queries.</p>
    </sec>
    <sec>
      <title>4.4 Running time: phylo-<italic toggle="yes">k</italic>-mer computation</title>
      <p><xref rid="btad692-T2" ref-type="table">Table 2</xref> gives the averaged measurements of total time spent by <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">IPK</italic> to compute databases of phylo-<italic toggle="yes">k</italic>-mers for <inline-formula id="IE72"><mml:math id="IM72" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>, both using the in-memory and on-disk algorithms. For comparison, it also provides the time needed to align a million queries used in the experiments described in Section 4.3. For all datasets, <italic toggle="yes">IPK</italic> (with the default in-memory algorithm) was more than one hundred times faster than <italic toggle="yes">RAPPAS</italic>: the speed-up was 147×, 124×, 239×, and 120× for <italic toggle="yes">D652</italic>, <italic toggle="yes">neotrop</italic>, <italic toggle="yes">HCV</italic>, and <italic toggle="yes">tara</italic>, respectively. Also, <italic toggle="yes">IPK</italic> clearly outperforms <italic toggle="yes">RAPPAS</italic> in phylo-<italic toggle="yes">k</italic>-mer computation for other <italic toggle="yes">k</italic>-mer lengths (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S5</xref>). The speed-up of <italic toggle="yes">IPK</italic> over <italic toggle="yes">RAPPAS</italic> increases with the value of <italic toggle="yes">k</italic>. Importantly, it was significantly faster to preprocess the reference data with <italic toggle="yes">IPK</italic> than to align a million query sequences for all datasets. This was not the case for <italic toggle="yes">RAPPAS</italic>.</p>
      <table-wrap position="float" id="btad692-T2">
        <label>Table 2.</label>
        <caption>
          <p>Preprocessing times on four reference datasets.<xref rid="tblfn2" ref-type="table-fn"><sup>a</sup></xref></p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Dataset</th>
              <th rowspan="1" colspan="1">HMMER(1M)</th>
              <th rowspan="1" colspan="1">RAPPAS</th>
              <th rowspan="1" colspan="1">IPK</th>
              <th rowspan="1" colspan="1">IPK (on disk)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D652</italic>
              </td>
              <td rowspan="1" colspan="1">2 h 21 min</td>
              <td rowspan="1" colspan="1">11 h 26 min</td>
              <td rowspan="1" colspan="1">4 min 40 s</td>
              <td rowspan="1" colspan="1">6 min 46 s</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">neotrop</italic>
              </td>
              <td rowspan="1" colspan="1">10 h 00 min</td>
              <td rowspan="1" colspan="1">18 h 32 min</td>
              <td rowspan="1" colspan="1">8 min 59 s</td>
              <td rowspan="1" colspan="1">11 min 23 s</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">tara</italic>
              </td>
              <td rowspan="1" colspan="1">2 h 09 min</td>
              <td rowspan="1" colspan="1">62 h 59 min</td>
              <td rowspan="1" colspan="1">30 min 56 s</td>
              <td rowspan="1" colspan="1">46 min 10 s</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">HCV</italic>
              </td>
              <td rowspan="1" colspan="1">36 h 58 min</td>
              <td rowspan="1" colspan="1">15 h 22 min</td>
              <td rowspan="1" colspan="1">3 min 38 s</td>
              <td rowspan="1" colspan="1">4 min 45 s</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn2">
            <label>a</label>
            <p>Preprocessing consists in computing phylo-<italic toggle="yes">k</italic>-mer databases for <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">IPK</italic>, or aligning query sequences within the reference alignment for alignment-based tools (<italic toggle="yes">EPA-ng</italic>, <italic toggle="yes">APPLES2</italic>) using <italic toggle="yes">HMMER</italic>. For the latter, the running time of aligning one million query reads is shown. Measurements are averaged over three runs.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>As for the on-disk algorithm, it showed longer running times than the default in-memory algorithm. Importantly, on-disk processing allowed for a significant reduction in RAM usage. For instance, on-disk <italic toggle="yes">IPK</italic> processed <italic toggle="yes">tara</italic> using 1.6 GB of RAM instead of 30 GB in the in-memory mode, resulting in a database of size 21 GB on disk (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S2</xref> for additional measurements).</p>
    </sec>
  </sec>
  <sec>
    <title>5 Discussion</title>
    <p>We propose a new two-step solution for alignment-free phylogenetic placement implemented as two modular programs: <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic>. First, <italic toggle="yes">IPK</italic> computes a phylo-<italic toggle="yes">k</italic>-mer database from input alignment and phylogeny of reference sequences, then <italic toggle="yes">EPIK</italic> reuses this database to place the query sequences on the phylogeny. The combination <italic toggle="yes">IPK</italic>+<italic toggle="yes">EPIK</italic> follows the strategy used in <italic toggle="yes">RAPPAS</italic> but outperforms it in running time, memory usage, scalability, and introduces significant novelties.</p>
    <p>The new algorithm implemented in <italic toggle="yes">IPK</italic> provides dramatic speed improvements: for instance, the <italic toggle="yes">tara</italic> dataset with 3748 species and 1.4 kb alignment, is now preprocessed in minutes instead of days (cf. <xref rid="btad692-T2" ref-type="table">Table 2</xref>). This allowed us to increase the default value of <italic toggle="yes">k</italic> (from <inline-formula id="IE73"><mml:math id="IM73" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula> for DNA in <italic toggle="yes">RAPPAS</italic> to <inline-formula id="IE74"><mml:math id="IM74" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>), which is a key parameter. Indeed, using longer <italic toggle="yes">k</italic>-mers results in nondecreasing accuracy (<xref rid="btad692-B24" ref-type="bibr">Romashchenko 2021</xref>). Second, the gain in speed permits to process instances with larger number of species, and hence larger reference trees, which were problematic for <italic toggle="yes">RAPPAS</italic>. Last, <italic toggle="yes">IPK</italic> offers a second computation mode in which the database is computed on disk, allowing users to adapt memory usage to their own resources.</p>
    <p>Even if computed on disk, a phylo-<italic toggle="yes">k</italic>-mer database can be large, and thus lead <italic toggle="yes">EPIK</italic> to exhaust memory during placement. However, our filtering experiments show that phylo-<italic toggle="yes">k</italic>-mers are not equally informative for placement. We introduce a novel approach to compute the informativeness of each <italic toggle="yes">k</italic>-mer, and <italic toggle="yes">IPK</italic> sorts the database according to this value. Then <italic toggle="yes">EPIK</italic> can filter the database and load only the most informative part that fits into memory. Accuracy experiments with filtered databases showed that, quite often, a great number of <italic toggle="yes">k</italic>-mers (and associated scores) can be safely excluded. For example, we could reduce the database sizes by a factor of 16 with a minor loss in placement accuracy for datasets of metabarcoding markers, and at least by a factor of 4 for datasets of complete viral genomes.</p>
    <p>Let us point out two limitations of <italic toggle="yes">IPK</italic>+<italic toggle="yes">EPIK</italic>. First, they are currently not suited for metagenomic applications that require large reference sequences, like large eukaryotic genomes. For these data, our approach may require using larger values of <italic toggle="yes">k</italic> and limit the possibility of filtering. Hence, extending the applicability of phylo-<italic toggle="yes">k</italic>-mer-based methods to longer genomes seems challenging. Second, the mutual information of a given <italic toggle="yes">k</italic>-mer can only be computed once all its branch-specific scores are available. A perspective for future work is to develop an algorithm to assess <italic toggle="yes">k</italic>-mer informativeness directly during phylo-<italic toggle="yes">k</italic>-mer computation.</p>
    <p>Using <italic toggle="yes">EPIK</italic> requires the precomputation of the database with <italic toggle="yes">IPK</italic>, a step that is avoided by alignment-based methods. So how large shall the set of input reads be to counterbalance the precomputation time? In all our experiments (see Section 4.4), aligning a million short reads within the reference sequences was always significantly slower than computing phylo-<italic toggle="yes">k</italic>-mers for the references with <italic toggle="yes">IPK</italic>. Thus, already with circa a million short queries, it is faster to use alignment-free placement with phylo-<italic toggle="yes">k</italic>-mers than alignment-based tools.</p>
    <p>Implementing <italic toggle="yes">IPK</italic> as a standalone tool provides flexibility and eases the application of phylo-<italic toggle="yes">k</italic>-mers to other bioinformatic problems, thanks to a carefully designed API. For example, <italic toggle="yes">SHERPAS</italic>, another software based on phylo-<italic toggle="yes">k</italic>-mers, can readily use databases built by <italic toggle="yes">IPK</italic> to infer recombination patterns in viral sequences (<xref rid="btad692-B26" ref-type="bibr">Scholz <italic toggle="yes">et al.</italic> 2020</xref>). Currently, a tool exploiting phylo-<italic toggle="yes">k</italic>-mers for protein family homology detection is under development. We hope that further phylo-<italic toggle="yes">k</italic>-mer based solutions will be developed in the future.</p>
    <p>The C++ implementation of <italic toggle="yes">EPIK</italic> already offers high computational efficiency with a single thread, as well as multi-threading. Currently, for millions of queries or more, <italic toggle="yes">EPIK</italic> is the fastest phylogenetic placement software. Since the combination <italic toggle="yes">IPK</italic>+<italic toggle="yes">EPIK</italic> achieves high accuracy—comparable to state-of-the-art tools—when placing short metabarcoding reads, we hope it will become the tool of choice for large-scale metabarcoding applications.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btad692_Supplementary_Data</label>
      <media xlink:href="btad692_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We thank Frédéric Mahé for providing query sequences for the <italic toggle="yes">neotrop</italic> dataset, Matthias Blanke and Pierre Barbera for their useful comments on PEWO-based benchmarking, and the reviewers. We also thank the French Institute of Bioinformatics (IFB) for the computational resources provided.</p>
  </ack>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the French Ministry of Research (MNERT); the European Union’s Horizon 2020 research and innovation program under the Marie Skłodowska-Curie grant agreement [ALPACA, № 956229]; the French National Agency for Research (ANR) [Fish-Predict ANR-21-AAFI-0001]; the IFB; and the ATGC bioinformatics platform.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>The data underlying this article were obtained from the studies listed in Sections 2.4 and 2.6 and are available from the corresponding sources.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btad692-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Asnicar</surname><given-names>F</given-names></string-name>, <string-name><surname>Thomas</surname><given-names>AM</given-names></string-name>, <string-name><surname>Beghini</surname><given-names>F</given-names></string-name></person-group><etal>et al</etal><article-title>Precise phylogenetic analysis of microbial isolates and genomes from metagenomes using PhyloPhlAn 3.0</article-title>. <source>Nat Commun</source><year>2020</year>;<volume>11</volume>:<fpage>2500</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">32427907</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Balaban</surname><given-names>M</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Roush</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>Fast and accurate distance-based phylogenetic placement using divide and conquer</article-title>. <source>Mol Ecol Resour</source><year>2022</year>;<volume>22</volume>:<fpage>1213</fpage>–<lpage>27</lpage>.<pub-id pub-id-type="pmid">34643995</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barbera</surname><given-names>P</given-names></string-name>, <string-name><surname>Kozlov</surname><given-names>AM</given-names></string-name>, <string-name><surname>Czech</surname><given-names>L</given-names></string-name></person-group><etal>et al</etal><article-title>EPA-ng: massively parallel evolutionary placement of genetic sequences</article-title>. <source>Syst Biol</source><year>2019</year>;<volume>68</volume>:<fpage>365</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">30165689</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barbera</surname><given-names>P</given-names></string-name>, <string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Lutteropp</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>SCRAPP: a tool to assess the diversity of microbial samples from phylogenetic placements</article-title>. <source>Mol Ecol Resour</source><year>2021</year>;<volume>21</volume>:<fpage>340</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">32996237</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bass</surname><given-names>D</given-names></string-name>, <string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Williams</surname><given-names>BA</given-names></string-name></person-group><etal>et al</etal><article-title>Clarifying the relationships between Microsporidia and Cryptomycota</article-title>. <source>J Eukaryot Microbiol</source><year>2018</year>;<volume>65</volume>:<fpage>773</fpage>–<lpage>82</lpage>.<pub-id pub-id-type="pmid">29603494</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Berger</surname><given-names>SA</given-names></string-name>, <string-name><surname>Krompass</surname><given-names>D</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><article-title>Performance, accuracy, and web server for evolutionary placement of short sequence reads under maximum likelihood</article-title>. <source>Syst Biol</source><year>2011</year>;<volume>60</volume>:<fpage>291</fpage>–<lpage>302</lpage>.<pub-id pub-id-type="pmid">21436105</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Blanke</surname><given-names>M</given-names></string-name>, <string-name><surname>Morgenstern</surname><given-names>B.</given-names></string-name></person-group><article-title>App-SpaM: phylogenetic placement of short reads without sequence alignment</article-title>. <source>Bioinform Adv</source><year>2021</year>;<volume>1</volume>:<fpage>vbab027</fpage>.<pub-id pub-id-type="pmid">36700102</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bohmann</surname><given-names>K</given-names></string-name>, <string-name><surname>Mirarab</surname><given-names>S</given-names></string-name>, <string-name><surname>Bafna</surname><given-names>V</given-names></string-name></person-group><etal>et al</etal><article-title>Beyond DNA barcoding: the unrealized potential of genome skim data in sample identification</article-title>. <source>Mol Ecol</source><year>2020</year>;<volume>29</volume>:<fpage>2521</fpage>–<lpage>34</lpage>.<pub-id pub-id-type="pmid">32542933</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B9">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Cover</surname><given-names>TM</given-names></string-name>, <string-name><surname>Thomas</surname><given-names>JA.</given-names></string-name></person-group><source>Elements of Information Theory</source>, <edition>2nd edn</edition>. <publisher-loc>Hoboken, NJ</publisher-loc>: <publisher-name>Wiley-Interscience</publisher-name>, <year>2006</year>.</mixed-citation>
    </ref>
    <ref id="btad692-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><article-title>Scalable methods for analyzing and visualizing phylogenetic placement of metagenomic samples</article-title>. <source>PLoS ONE</source><year>2019</year>;<volume>14</volume>:<fpage>e0217050</fpage>.<pub-id pub-id-type="pmid">31136592</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Barbera</surname><given-names>P</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><article-title>Genesis and Gappa: processing, analyzing and visualizing phylogenetic (placement) data</article-title>. <source>Bioinformatics</source><year>2020</year>;<volume>36</volume>:<fpage>3263</fpage>–<lpage>5</lpage>.<pub-id pub-id-type="pmid">32016344</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A</given-names></string-name>, <string-name><surname>Dunthorn</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>Metagenomic analysis using phylogenetic placement—a review of the first decade</article-title>. <source>Front Bioinform</source><year>2022</year>;<volume>2</volume>:<fpage>871393</fpage>.<pub-id pub-id-type="pmid">36304302</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dunthorn</surname><given-names>M</given-names></string-name>, <string-name><surname>Otto</surname><given-names>J</given-names></string-name>, <string-name><surname>Berger</surname><given-names>SA</given-names></string-name></person-group><etal>et al</etal>; <collab>Biomarks Consortium</collab>. <article-title>Placing environmental next-generation sequencing amplicons from microbial eukaryotes into a phylogenetic context</article-title>. <source>Mol Biol Evol</source><year>2014</year>;<volume>31</volume>:<fpage>993</fpage>–<lpage>1009</lpage>.<pub-id pub-id-type="pmid">24473288</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Guindon</surname><given-names>S</given-names></string-name>, <string-name><surname>Dufayard</surname><given-names>J-F</given-names></string-name>, <string-name><surname>Lefort</surname><given-names>V</given-names></string-name></person-group><etal>et al</etal><article-title>New algorithms and methods to estimate maximum-likelihood phylogenies: assessing the performance of PhyML 3.0</article-title>. <source>Syst Biol</source><year>2010</year>;<volume>59</volume>:<fpage>307</fpage>–<lpage>21</lpage>.<pub-id pub-id-type="pmid">20525638</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hasan</surname><given-names>NB</given-names></string-name>, <string-name><surname>Balaban</surname><given-names>M</given-names></string-name>, <string-name><surname>Biswas</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>APPLES: scalable distance-based phylogenetic placement with or without alignments</article-title>. <source>Biology (Basel)</source><year>2020</year>;<volume>11</volume>:<fpage>566</fpage>–<lpage>78</lpage>.</mixed-citation>
    </ref>
    <ref id="btad692-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Janssen</surname><given-names>S</given-names></string-name>, <string-name><surname>McDonald</surname><given-names>D</given-names></string-name>, <string-name><surname>Gonzalez</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>Phylogenetic placement of exact amplicon sequences improves associations with clinical information</article-title>. <source>mSystems</source><year>2018</year>;<volume>3</volume>:<fpage>e00021–18</fpage>.<pub-id pub-id-type="pmid">29719869</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B17">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Koning</surname><given-names>E</given-names></string-name>, <string-name><surname>Phillips</surname><given-names>M</given-names></string-name>, <string-name><surname>Warnow</surname><given-names>T.</given-names></string-name></person-group> pplacerDC: a new scalable phylogenetic placement method. In: <italic toggle="yes">Proceedings of the 12th ACM Conference on Bioinformatics, Computational Biology, and Health Informatics</italic>, p.1–9. Gainesville, FL: Association for Computing Machinery, August 2021.</mixed-citation>
    </ref>
    <ref id="btad692-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kozlov</surname><given-names>AM</given-names></string-name>, <string-name><surname>Darriba</surname><given-names>D</given-names></string-name>, <string-name><surname>Flouri</surname><given-names>T</given-names></string-name></person-group><etal>et al</etal><article-title>RAxML-NG: a fast, scalable and user-friendly tool for maximum likelihood phylogenetic inference</article-title>. <source>Bioinformatics</source><year>2019</year>;<volume>35</volume>:<fpage>4453</fpage>–<lpage>5</lpage>.<pub-id pub-id-type="pmid">31070718</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Linard</surname><given-names>B</given-names></string-name>, <string-name><surname>Swenson</surname><given-names>K</given-names></string-name>, <string-name><surname>Pardi</surname><given-names>F.</given-names></string-name></person-group><article-title>Rapid alignment-free phylogenetic identification of metagenomic sequences</article-title>. <source>Bioinformatics</source><year>2019</year>;<volume>35</volume>:<fpage>3303</fpage>–<lpage>12</lpage>.<pub-id pub-id-type="pmid">30698645</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Linard</surname><given-names>B</given-names></string-name>, <string-name><surname>Romashchenko</surname><given-names>N</given-names></string-name>, <string-name><surname>Pardi</surname><given-names>F</given-names></string-name></person-group><etal>et al</etal><article-title>PEWO: a collection of workflows to benchmark phylogenetic placement</article-title>. <source>Bioinformatics</source><year>2021</year>;<volume>36</volume>:<fpage>5264</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">32697844</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mahé</surname><given-names>F</given-names></string-name>, <string-name><surname>de Vargas</surname><given-names>C</given-names></string-name>, <string-name><surname>Bass</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>Parasites dominate hyperdiverse soil protist communities in neotropical rainforests</article-title>. <source>Nat Ecol Evol</source><year>2017</year>;<volume>1</volume>:<fpage>91</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">28812652</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Matsen</surname><given-names>FA</given-names></string-name>, <string-name><surname>Kodner</surname><given-names>RB</given-names></string-name>, <string-name><surname>Armbrust</surname><given-names>E.</given-names></string-name></person-group><article-title>Pplacer: linear time maximum-likelihood and Bayesian phylogenetic placement of sequences onto a fixed reference tree</article-title>. <source>BMC Bioinformatics</source><year>2010</year>;<volume>11</volume>:<fpage>538</fpage>.<pub-id pub-id-type="pmid">21034504</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>McCallum</surname><given-names>A</given-names></string-name>, <string-name><surname>Nigam</surname><given-names>K.</given-names></string-name></person-group> A comparison of event models for Naive Bayes text classification. In: <italic toggle="yes">AAAI-98 Workshop on Learning for Text Categorization</italic>, Vol. <volume>752</volume>, p.41–8. Madison, WI: Association for the Advancement of Artificial Intelligence, July 1998.</mixed-citation>
    </ref>
    <ref id="btad692-B24">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Romashchenko</surname><given-names>N.</given-names></string-name></person-group> Computing informative k-mers for phylogenetic placement. Ph.D. Thesis, Université Montpellier, <year>2021</year>.</mixed-citation>
    </ref>
    <ref id="btad692-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Romashchenko</surname><given-names>N</given-names></string-name>, <string-name><surname>Linard</surname><given-names>B</given-names></string-name>, <string-name><surname>Rivals</surname><given-names>E</given-names></string-name></person-group><etal>et al</etal><article-title>Computing phylo-<italic toggle="yes">k</italic>-mers</article-title>. <source>IEEE/ACM Trans Comput Biol Bioinform</source><year>2023</year>;<volume>20</volume>:<fpage>2889</fpage>–<lpage>97</lpage>.<pub-id pub-id-type="pmid">37204943</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Scholz</surname><given-names>GE</given-names></string-name>, <string-name><surname>Linard</surname><given-names>B</given-names></string-name>, <string-name><surname>Romashchenko</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>Rapid screening and detection of inter-type viral recombinants using phylo-k-mers</article-title>. <source>Bioinformatics</source><year>2020</year>;<volume>36</volume>:<fpage>5351</fpage>–<lpage>60</lpage>.</mixed-citation>
    </ref>
    <ref id="btad692-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schultz</surname><given-names>A-K</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>M</given-names></string-name>, <string-name><surname>Bulla</surname><given-names>I</given-names></string-name></person-group><etal>et al</etal><article-title>jpHMM: improving the reliability of recombination prediction in HIV-1</article-title>. <source>Nucleic Acids Res</source><year>2009</year>;<volume>37</volume>:<fpage>W647</fpage>–<lpage>W651</lpage>.<pub-id pub-id-type="pmid">19443440</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B28">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Singer</surname><given-names>J</given-names></string-name>, <string-name><surname>Gifford</surname><given-names>R</given-names></string-name>, <string-name><surname>Cotten</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal> CoV-GLUE: A Web Application for Tracking SARS-CoV-2 Genomic Variation. <pub-id pub-id-type="doi">10.20944/preprints202006.0225.v1</pub-id>. <year>2020</year>.</mixed-citation>
    </ref>
    <ref id="btad692-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Srinivasan</surname><given-names>S</given-names></string-name>, <string-name><surname>Hoffman</surname><given-names>NG</given-names></string-name>, <string-name><surname>Morgan</surname><given-names>MT</given-names></string-name></person-group><etal>et al</etal><article-title>Bacterial communities in women with bacterial vaginosis: high resolution phylogenetic analyses reveal relationships of microbiota to clinical criteria</article-title>. <source>PLoS ONE</source><year>2012</year>;<volume>7</volume>:<fpage>e37818</fpage>.<pub-id pub-id-type="pmid">22719852</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sunagawa</surname><given-names>S</given-names></string-name>, <string-name><surname>Coelho</surname><given-names>LP</given-names></string-name>, <string-name><surname>Chaffron</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal>; <collab>Tara Oceans Coordinators</collab>. <article-title>Structure and function of the global ocean microbiome</article-title>. <source>Science</source><year>2015</year>;<volume>348</volume>:<fpage>1261359</fpage>.<pub-id pub-id-type="pmid">25999513</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Thompson</surname><given-names>LR</given-names></string-name>, <string-name><surname>Sanders</surname><given-names>JG</given-names></string-name>, <string-name><surname>McDonald</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal>; <collab>Earth Microbiome Project Consortium</collab>. <article-title>A communal catalogue reveals earth’s multiscale microbial diversity</article-title>. <source>Nature</source><year>2017</year>;<volume>551</volume>:<fpage>457</fpage>–<lpage>63</lpage>.<pub-id pub-id-type="pmid">29088705</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Turakhia</surname><given-names>Y</given-names></string-name>, <string-name><surname>Thornlow</surname><given-names>B</given-names></string-name>, <string-name><surname>Hinrichs</surname><given-names>AS</given-names></string-name></person-group><etal>et al</etal><article-title>Ultrafast sample placement on existing trees (UShER) enables real-time phylogenetics for the SARS-CoV-2 pandemic</article-title>. <source>Nat Genet</source><year>2021</year>;<volume>53</volume>:<fpage>809</fpage>–<lpage>16</lpage>.<pub-id pub-id-type="pmid">33972780</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wedell</surname><given-names>E</given-names></string-name>, <string-name><surname>Cai</surname><given-names>Y</given-names></string-name>, <string-name><surname>Warnow</surname><given-names>T.</given-names></string-name></person-group><article-title>SCAMPP: scaling alignment-based phylogenetic placement to large trees</article-title>. <source>IEEE/ACM Trans Comput Biol Bioinform</source><year>2023</year>;<volume>20</volume>:<fpage>1417</fpage>–<lpage>30</lpage>.<pub-id pub-id-type="pmid">35471888</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10701097</article-id>
    <article-id pub-id-type="pmid">37975872</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btad692</article-id>
    <article-id pub-id-type="publisher-id">btad692</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Phylogenetics</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>EPIK: precise and scalable evolutionary placement with informative <italic toggle="yes">k</italic>-mers</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-2264-5219</contrib-id>
        <name>
          <surname>Romashchenko</surname>
          <given-names>Nikolai</given-names>
        </name>
        <aff><institution>LIRMM, University of Montpellier, CNRS</institution>, Montpellier, <country country="FR">France</country></aff>
        <xref rid="btad692-cor1" ref-type="corresp"/>
        <!--nromashchenko@lirmm.fr-->
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-5555-898X</contrib-id>
        <name>
          <surname>Linard</surname>
          <given-names>Benjamin</given-names>
        </name>
        <aff><institution>LIRMM, University of Montpellier, CNRS</institution>, Montpellier, <country country="FR">France</country></aff>
        <xref rid="btad692-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8084-1464</contrib-id>
        <name>
          <surname>Pardi</surname>
          <given-names>Fabio</given-names>
        </name>
        <aff><institution>LIRMM, University of Montpellier, CNRS</institution>, Montpellier, <country country="FR">France</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-3791-3973</contrib-id>
        <name>
          <surname>Rivals</surname>
          <given-names>Eric</given-names>
        </name>
        <aff><institution>LIRMM, University of Montpellier, CNRS</institution>, Montpellier, <country country="FR">France</country></aff>
        <xref rid="btad692-cor1" ref-type="corresp"/>
        <!--rivals@lirmm.fr-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Schwartz</surname>
          <given-names>Russell</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <fn id="btad692-FM1">
        <p>Present address of Benjamin Linard: INRAE, UR MIAT, University of Toulouse, F-31320 Castanet-Tolosan, France</p>
      </fn>
      <corresp id="btad692-cor1">Corresponding authors. LIRMM UMR 5506, 860 rue St Priest, 34095 Montpellier cedex 5, France. E-mails: <email>nromashchenko@lirmm.fr</email> (N.R.) and <email>rivals@lirmm.fr</email> (E.R.)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>12</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-11-17">
      <day>17</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>17</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <volume>39</volume>
    <issue>12</issue>
    <elocation-id>btad692</elocation-id>
    <history>
      <date date-type="received">
        <day>15</day>
        <month>3</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>20</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>15</day>
        <month>10</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>16</day>
        <month>11</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>06</day>
        <month>12</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btad692.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Phylogenetic placement enables phylogenetic analysis of massive collections of newly sequenced DNA, when <italic toggle="yes">de novo</italic> tree inference is too unreliable or inefficient. Assuming that a high-quality reference tree is available, the idea is to seek the correct placement of the new sequences in that tree. Recently, alignment-free approaches to phylogenetic placement have emerged, both to circumvent the need to align the new sequences and to avoid the calculations that typically follow the alignment step. A promising approach is based on the inference of <italic toggle="yes">k</italic>-mers that can be potentially related to the reference sequences, also called phylo-<italic toggle="yes">k</italic>-mers. However, its usage is limited by the time and memory-consuming stage of reference data preprocessing and the large numbers of <italic toggle="yes">k</italic>-mers to consider.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We suggest a filtering method for selecting informative phylo-<italic toggle="yes">k</italic>-mers based on mutual information, which can significantly improve the efficiency of placement, at the cost of a small loss in placement accuracy. This method is implemented in <italic toggle="yes">IPK</italic>, a new tool for computing phylo-<italic toggle="yes">k</italic>-mers that significantly outperforms the software previously available. We also present <italic toggle="yes">EPIK</italic>, a new software for phylogenetic placement, supporting filtered phylo-<italic toggle="yes">k</italic>-mer databases. Our experiments on real-world data show that <italic toggle="yes">EPIK</italic> is the fastest phylogenetic placement tool available, when placing hundreds of thousands and millions of queries while still providing accurate placements.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p><italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic> are freely available at <ext-link xlink:href="https://github.com/phylo42/IPK" ext-link-type="uri">https://github.com/phylo42/IPK</ext-link> and <ext-link xlink:href="https://github.com/phylo42/EPIK" ext-link-type="uri">https://github.com/phylo42/EPIK</ext-link>. Both are implemented in C++ and Python and supported on Linux and MacOS.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>French Ministry of Research</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Union’s Horizon 2020</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>French National Agency for Research</institution>
            <institution-id institution-id-type="DOI">10.13039/501100001665</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Phylogenetic placement is an increasingly popular task in phylogenetic analysis (<xref rid="btad692-B12" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2022</xref>). Its input is a set of reference sequences (often aligned), a phylogenetic tree representing their evolution, and a (usually large) collection of novel query sequences. The problem is to find, for each query, the likely location(s) of its evolutionary origin in the reference tree. Applications of phylogenetic placement range from taxonomic identification and microbiome analysis (<xref rid="btad692-B31" ref-type="bibr">Thompson <italic toggle="yes">et al.</italic> 2017</xref>, <xref rid="btad692-B16" ref-type="bibr">Janssen <italic toggle="yes">et al.</italic> 2018</xref>, <xref rid="btad692-B1" ref-type="bibr">Asnicar <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btad692-B8" ref-type="bibr">Bohmann <italic toggle="yes">et al.</italic> 2020</xref>), to the inference of new clades (<xref rid="btad692-B13" ref-type="bibr">Dunthorn <italic toggle="yes">et al.</italic> 2014</xref>, <xref rid="btad692-B5" ref-type="bibr">Bass <italic toggle="yes">et al.</italic> 2018</xref>), and tracking of viral variants (<xref rid="btad692-B28" ref-type="bibr">Singer <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btad692-B32" ref-type="bibr">Turakhia <italic toggle="yes">et al.</italic> 2021</xref>).</p>
    <p>The interest of phylogenetic placement is particularly evident for amplicon-based analysis of environmental samples. Because of the number and limited length of the sequences typically found in these samples, <italic toggle="yes">de novo</italic> phylogenetic inference would be too unreliable and inefficient on these data (<xref rid="btad692-B12" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2022</xref>). Moreover, phylogenetic placement software plays a key role in an ecosystem of tools for biodiversity quantification and visualization (<xref rid="btad692-B11" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btad692-B4" ref-type="bibr">Barbera <italic toggle="yes">et al.</italic> 2021</xref>), sample comparison, and identification of correlations (<xref rid="btad692-B10" ref-type="bibr">Czech and Stamatakis 2019</xref>).</p>
    <p>Early phylogenetic placement tools such as <italic toggle="yes">pplacer</italic> (<xref rid="btad692-B22" ref-type="bibr">Matsen <italic toggle="yes">et al.</italic> 2010</xref>) and <italic toggle="yes">EPA</italic> [<italic toggle="yes">Evolutionary Placement Algorithm</italic>; <xref rid="btad692-B6" ref-type="bibr">Berger <italic toggle="yes">et al.</italic> (2011)</xref>] were based on maximum likelihood (ML) inference—a successful approach that provides highly accurate placements. However, those implementations suffered from two scalability problems. First, they were limited by the size of the reference tree, making it problematic to apply them to large phylogenies, e.g. with dozens of thousands of taxa (<xref rid="btad692-B17" ref-type="bibr">Koning <italic toggle="yes">et al.</italic> 2021</xref>). Second, those methods require to <italic toggle="yes">align each query</italic> to the reference sequences, which is why such methods are called <italic toggle="yes">alignment-based</italic>. Naturally, they also require a multiple alignment of the reference sequences, which is nonetheless often is a prerequisite to estimate the tree (or at least branch lengths and model parameters). The limitation of alignment-based methods is that, even though queries are typically short, their alignment to long reference sequences is poorly scalable with the ever-increasing amounts of sequencing data delivered by current technologies.</p>
    <p>Further developments in phylogenetic placement methods focused on overcoming those challenges. <italic toggle="yes">APPLES</italic>, followed by <italic toggle="yes">APPLES-2</italic> (<xref rid="btad692-B15" ref-type="bibr">Hasan <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btad692-B2" ref-type="bibr">Balaban <italic toggle="yes">et al.</italic> 2022</xref>), was the first method enabling placement to ultra-large phylogenies. It is a distance-based method, where the distances between the query and the reference sequences can be computed on the basis of an alignment, or in an alignment-free way. It allows placing queries to trees of hundreds of thousands of taxa at the cost of lower placement accuracy compared to competing methods. Similar developments include <italic toggle="yes">pplacerDC</italic> (<xref rid="btad692-B17" ref-type="bibr">Koning <italic toggle="yes">et al.</italic> 2021</xref>) and <italic toggle="yes">SCAMPP</italic> (<xref rid="btad692-B33" ref-type="bibr">Wedell <italic toggle="yes">et al.</italic> 2023</xref>), which implement heuristics extending the applicability of ML-based placement to large phylogenies.</p>
    <p><italic toggle="yes">EPA-ng—</italic>the successor of <italic toggle="yes">EPA—</italic>significantly improved the ML-based placement speed with massive parallelization (<xref rid="btad692-B3" ref-type="bibr">Barbera <italic toggle="yes">et al.</italic> 2019</xref>). However, the challenge of aligning query sequences was only addressed by the recent emergence of <italic toggle="yes">alignment-free</italic> methods. <italic toggle="yes">RAPPAS</italic> preprocesses the references by computing <italic toggle="yes">phylo-k-mers</italic> independent of queries (<xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2019</xref>). Phylo-<italic toggle="yes">k</italic>-mers are stored for later use during placement. This allows <italic toggle="yes">RAPPAS</italic> to avoid aligning the queries, which explains the “alignment-free” term (even though the input contains aligned reference sequences), and makes it highly scalable in the number of queries to place. Moreover, <italic toggle="yes">RAPPAS</italic> proved to be highly accurate, especially for short queries (<xref rid="btad692-B7" ref-type="bibr">Blanke and Morgenstern 2021</xref>).</p>
    <p>Another recent alignment-free development is <italic toggle="yes">App-SpaM</italic>, a distance-based method that utilizes the concept of spaced words (<xref rid="btad692-B7" ref-type="bibr">Blanke and Morgenstern 2021</xref>). <italic toggle="yes">App-SpaM</italic> has a number of practical advantages: it is among the fastest phylogenetic placement tools and requires the reference sequences to be neither aligned nor assembled. When reference sequences are aligned and assembled, however, <italic toggle="yes">App-SpaM</italic> is usually not the most accurate tool available (<xref rid="btad692-B7" ref-type="bibr">Blanke and Morgenstern 2021</xref>).</p>
    <p>Here, we take further steps to overcome the challenges of phylogenetic placement and introduce two tools that together form the successor of <italic toggle="yes">RAPPAS</italic>. First, we present <italic toggle="yes">IPK</italic> (<italic toggle="yes">Inference of Phylo-K-mers</italic>), a tool for efficient computation of phylo-<italic toggle="yes">k</italic>-mers. <italic toggle="yes">IPK</italic> improves the running times of the phylo-<italic toggle="yes">k</italic>-mer construction step by up to two orders of magnitude. We also introduce <italic toggle="yes">phylo-k-mer filtering—</italic>a method to reduce large phylo-<italic toggle="yes">k</italic>-mer collections with little or no loss in placement accuracy. These developments improve the scalability of computing phylo-<italic toggle="yes">k</italic>-mers to larger phylogenies. Second, we present <italic toggle="yes">EPIK</italic> (<italic toggle="yes">Evolutionary Placement with Informative K-mers</italic>), an optimized parallel implementation of placement with filtered phylo-<italic toggle="yes">k</italic>-mers. <italic toggle="yes">EPIK</italic> substantially outperforms its predecessor. We provide experiments on placement accuracy and speed, showing that <italic toggle="yes">EPIK</italic> can place millions of short queries on a single thread in a matter of minutes or hours. When placing large collections of queries, <italic toggle="yes">EPIK</italic> outperforms the state-of-the-art in placement speed, while remaining highly accurate.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>Let <italic toggle="yes">A</italic> denote a <italic toggle="yes">reference sequence alignment</italic>, and <italic toggle="yes">T</italic> denote a <italic toggle="yes">reference phylogenetic tree</italic> whose leaves are in one-to-one correspondence with the sequences of <italic toggle="yes">A</italic>. Sequences can be either composed of nucleotides or amino acids. Besides <italic toggle="yes">A</italic> and <italic toggle="yes">T</italic>, a collection of <italic toggle="yes">query</italic> sequences is also given. Then, for any query <italic toggle="yes">q</italic>, phylogenetic placement aims to identify the branch from which <italic toggle="yes">q</italic> likely diverged from the rest of the tree. Some placement methods also estimate the precise position of the divergence along the identified branch, and the length of the pendant branch terminating in <italic toggle="yes">q</italic>. Note that the reference tree remains fixed, and the queries are not actually added to the tree; this leaves the evolutionary relationships between queries unresolved. Also, we assume that the query sequence is homologous to parts of the reference sequences. This is an essential prerequisite to most phylogenetic placement methods (<xref rid="btad692-B12" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2022</xref>).</p>
    <p>As in <italic toggle="yes">RAPPAS</italic>, our method splits phylogenetic placement into two stages (see <xref rid="btad692-F1" ref-type="fig">Fig. 1</xref> for an illustration). First, <italic toggle="yes">IPK</italic> preprocesses <italic toggle="yes">A</italic> and <italic toggle="yes">T</italic> to create a <italic toggle="yes">phylo-k-mer database</italic>. This stage does not require any knowledge of query sequences. Second, <italic toggle="yes">EPIK</italic> uses phylo-<italic toggle="yes">k</italic>-mers to place the query sequences in an alignment-free way, based on the matches between the <italic toggle="yes">k</italic>-mers in the query and the phylo-<italic toggle="yes">k</italic>-mers in the database. Note that once we have the phylo-<italic toggle="yes">k</italic>-mer database computed for a given alignment and tree, we can reuse it to place queries as many times as needed.</p>
    <fig position="float" id="btad692-F1">
      <label>Figure 1.</label>
      <caption>
        <p><italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic>. (a) <italic toggle="yes">IPK</italic> takes an alignment of reference sequences and a reference tree as input. The alignment and tree are preprocessed, most notably the tree is extended by adding ghost nodes and ghost branches. Then state probabilities are computed at every ghost node and alignment site. On the basis of this, a phylo-<italic toggle="yes">k</italic>-mer database is constructed. Finally, mutual information values are computed and stored alongside the rest of the phylo-<italic toggle="yes">k</italic>-mer database for later use. (b) <italic toggle="yes">EPIK</italic> takes the phylo-<italic toggle="yes">k</italic>-mer database (with the corresponding reference tree and mutual information values) and query sequences as input. Depending on the way <italic toggle="yes">EPIK</italic> is called, the whole or a part of the phylo-<italic toggle="yes">k</italic>-mer database is loaded in memory. The <italic toggle="yes">k</italic>-mers of every query are searched in the database to place it onto the reference phylogeny. The result is a phylogenetic placement file (.jplace-formatted), one for each input query file.</p>
      </caption>
      <graphic xlink:href="btad692f1" position="float"/>
    </fig>
    <sec>
      <title>2.1 Phylo-<italic toggle="yes">k</italic>-mer inference</title>
      <p>Phylo-<italic toggle="yes">k</italic>-mers can be thought of as <italic toggle="yes">k</italic>-mers equipped with probabilistic information about their possible branches of origin in the reference phylogeny. More precisely, we define a phylo-<italic toggle="yes">k</italic>-mer for a given <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> and fixed <italic toggle="yes">A</italic>, <italic toggle="yes">T</italic> as a tuple <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <italic toggle="yes">y</italic> is a branch of <italic toggle="yes">T</italic>, and <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is a <italic toggle="yes">phylo-k-mer score</italic>. This score is an approximation of the probability of <italic toggle="yes">w</italic> being a substring of an unobserved sequence homologous to those in <italic toggle="yes">A</italic>, that diverged from the rest of <italic toggle="yes">T</italic> somewhere along <italic toggle="yes">y</italic> (<xref rid="btad692-B24" ref-type="bibr">Romashchenko 2021</xref>).</p>
      <p>We compute phylo-<italic toggle="yes">k</italic>-mers in a way that that resembles the one of <italic toggle="yes">RAPPAS</italic> (see <xref rid="btad692-F1" ref-type="fig">Fig. 1a</xref> for an illustration). We assume a given stochastic model of sequence evolution, and that the branch lengths of <italic toggle="yes">T</italic> were estimated by maximum likelihood under this model. We also assume that <italic toggle="yes">T</italic> is rooted. First, we filter the alignment by removing the columns that contain a certain user-defined percentage of gaps. Second, we create an extended tree by adding <italic toggle="yes">ghost nodes</italic> and <italic toggle="yes">ghost branches</italic> to <italic toggle="yes">T</italic>: for every branch <italic toggle="yes">y</italic>, we add a node <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> at the midpoint of <italic toggle="yes">y</italic>, a new leaf <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, and a new branch <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Ghost nodes aim to represent hypothetical ancestral sequences, as well as related sequences that diverged in the past but are not directly represented by the references. (See <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S6</xref> for some additional arguments on the design of ghost nodes.) We set the length of the new branch to the mean length among all paths from <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> to the leaves of <italic toggle="yes">T</italic> that descend from <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>. This value represents our expectation of how evolutionary distant may be the queries that should be placed onto <italic toggle="yes">y</italic>. Notice that since we average over all descending paths from <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, it makes correct rooting an important prerequisite of our method.</p>
      <p>Then we use standard techniques for ancestral sequence reconstruction to compute the posterior probabilities of any state (nucleotide for DNA and amino acid for proteins) at any site (position) of the alignment for a given node of the phylogeny. <italic toggle="yes">IPK</italic> can execute <italic toggle="yes">PhyML</italic> or <italic toggle="yes">RAxML-ng</italic> (<xref rid="btad692-B14" ref-type="bibr">Guindon <italic toggle="yes">et al.</italic> 2010</xref>, <xref rid="btad692-B18" ref-type="bibr">Kozlov <italic toggle="yes">et al.</italic> 2019</xref>) to perform these computations. This step results in a matrix with as many columns as in <italic toggle="yes">A</italic>, describing posterior state probability distributions for every ghost node <italic toggle="yes">u</italic>. Note that assuming statistical independence of states at different sites of the alignment, this step also defines the probability of any <italic toggle="yes">k</italic>-mer at <italic toggle="yes">u</italic> and any <italic toggle="yes">k</italic> consecutive sites of <italic toggle="yes">A</italic>.</p>
      <p>The next step is to find, for any ghost node, all <italic toggle="yes">k</italic>-mers whose probability is greater than a user-defined threshold <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mo>ε</mml:mo></mml:math></inline-formula> for at least one set of <italic toggle="yes">k</italic> consecutive sites in the alignment. For this step, we apply a new divide-and-conquer algorithm instead of the branch-and-bound algorithm used in <italic toggle="yes">RAPPAS</italic>, because the new algorithm is shown to be faster in practice [see <xref rid="btad692-B25" ref-type="bibr">Romashchenko <italic toggle="yes">et al.</italic> (2023)</xref> for detail and analysis].</p>
      <p>For each <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> generated in the above step, we consider a phylo-<italic toggle="yes">k</italic>-mer <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <italic toggle="yes">y</italic> is the branch corresponding to the ghost node where <italic toggle="yes">w</italic> was generated, and <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is set to the maximum probability over all possible choices of <italic toggle="yes">k</italic> consecutive columns in <italic toggle="yes">A</italic>, and over the two ghost nodes corresponding to <italic toggle="yes">y</italic>. Such phylo-<italic toggle="yes">k</italic>-mers can later be retrieved from what we call a <italic toggle="yes">phylo-k-mer database</italic>: a set of <italic toggle="yes">k</italic>-mers mapped to lists of tuples <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> giving scores of <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> for branches <italic toggle="yes">y</italic> such that <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>&gt;</mml:mo><mml:mo>ε</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>Since such databases can reach huge sizes, and because <italic toggle="yes">k</italic>-mers do not contribute equally to placement inference, we designed <italic toggle="yes">phylo-k-mer filtering</italic>, an approach for selecting informative <italic toggle="yes">k</italic>-mers. For every <italic toggle="yes">k</italic>-mer, we compute a filter value indicating how informative for placement the <italic toggle="yes">k</italic>-mer is, and sort <italic toggle="yes">k</italic>-mers by filter value. We propose two algorithms to form the phylo-<italic toggle="yes">k</italic>-mer database: in memory for speed and on disk for low memory usage. We describe both algorithms in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref>.</p>
    </sec>
    <sec>
      <title>2.2 Phylo-<italic toggle="yes">k</italic>-mer filtering</title>
      <p>One of the main novelties of <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic> is the possibility of filtering phylo-<italic toggle="yes">k</italic>-mers. This means selecting the <italic toggle="yes">k</italic>-mers that are the most informative for phylogenetic placement according to a measure derived from information theory. We view phylo-<italic toggle="yes">k</italic>-mer-based phylogenetic placement as a classification problem, where (i) the <italic toggle="yes">observations</italic> to classify are the queries, (ii) the <italic toggle="yes">classes</italic> that they must be assigned to are the branches of the reference tree, and, finally, (iii) the <italic toggle="yes">features</italic> used for the classification of a query are all the possible <italic toggle="yes">k</italic>-mers.</p>
      <p>Similarly to feature selection in text classification (<xref rid="btad692-B23" ref-type="bibr">McCallum and Nigam 1998</xref>), we wish to retain the features (<italic toggle="yes">k</italic>-mers) that maximize the <italic toggle="yes">mutual information</italic> (MI) between the class (branch) variable <italic toggle="yes">Y</italic> and the variable <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> indicating whether the <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> is present in the query (i.e. <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> or 0, depending on whether <italic toggle="yes">w</italic> is present or absent, respectively).</p>
      <p>In information theory, the mutual information between these random variables, denoted <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>;</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, is defined as the expected gain of information about <italic toggle="yes">Y</italic> (i.e. reduction in <italic toggle="yes">Y</italic>’s entropy) resulting from observing <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref rid="btad692-B9" ref-type="bibr">Cover and Thomas 2006</xref>):
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>;</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mo> </mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula></p>
      <p>Since <italic toggle="yes">EPIK</italic> only uses the presence of <italic toggle="yes">k</italic>-mers (and not their absence) to determine the placement of a query (see Section 2.3), the filtering is based on the following modification of the above formula, which only keeps the term with <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>:
<disp-formula id="E2"><label>(1)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="E3"><label>(2)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:mo>=</mml:mo><mml:mi>c</mml:mi><mml:mo>⋅</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo><mml:mo>+</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>y</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>Here, <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> is the total score of <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> [i.e. <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>y</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>], <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the set of tree branches, and <italic toggle="yes">c</italic> is independent of <italic toggle="yes">w</italic> and thus does not play any role in the filtering of <italic toggle="yes">k</italic>-mers. In <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1</xref>, we provide more detail about this formula, including the derivation of <xref rid="E3" ref-type="disp-formula">(2)</xref> from <xref rid="E2" ref-type="disp-formula">(1)</xref> and an alternative explanation of why we only keep the term with <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> in <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>;</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Intuitively, selecting <italic toggle="yes">k</italic>-mers maximizing <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> favors the ones that both are probable and cause a greater gain of information about the placement branch when observed in the query. A thorough analysis leading to this formula is given by <xref rid="btad692-B24" ref-type="bibr">Romashchenko (2021)</xref>.</p>
      <p>We filter phylo-<italic toggle="yes">k</italic>-mers as follows. First, we compute <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for all computed <italic toggle="yes">k</italic>-mers. Second, we sort <italic toggle="yes">k</italic>-mers in descending order of <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and serialize them. We implement this procedure differently for the in-memory and on-disk algorithms; see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref> for detail. As a result, the database on disk is represented so that more informative <italic toggle="yes">k</italic>-mers are closer to the beginning of the database file. For placement, we deserialize <italic toggle="yes">k</italic>-mers in their order until we reach a certain proportion of the entire database’s size or the memory limit set by the user.</p>
    </sec>
    <sec>
      <title>2.3 Placement step</title>
      <p>On the basis of a precomputed phylo-<italic toggle="yes">k</italic>-mer database, <italic toggle="yes">EPIK</italic> places query sequences in the following fashion (<xref rid="btad692-F1" ref-type="fig">Fig. 1b</xref>): First, it loads the entirety or part of the database into memory by applying <italic toggle="yes">k</italic>-mer filtering. This consists in loading <italic toggle="yes">k</italic>-mers with their scores until the given memory limit is reached or the complete database is loaded. At the same time, <italic toggle="yes">EPIK</italic> populates a hashmap from <italic toggle="yes">k</italic>-mers to lists of associated tuples of branches and phylo-<italic toggle="yes">k</italic>-mer scores. Since <italic toggle="yes">k</italic>-mers are stored ordered by <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, loading time is linear in the size of loaded information. Then each query is placed independently by searching its constituent <italic toggle="yes">k</italic>-mers in the database. For a given query <italic toggle="yes">q</italic>, a log-likelihood score of placing <italic toggle="yes">q</italic> onto branch <italic toggle="yes">y</italic> is computed as follows:
<disp-formula id="E4"><label>(3)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>k</mml:mi></mml:mfrac></mml:mrow><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>q</mml:mi><mml:mo>|</mml:mo><mml:mo>−</mml:mo><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow><mml:mo>{</mml:mo><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mo>ε</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>}</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>q</mml:mi><mml:mo>|</mml:mo><mml:mo>−</mml:mo><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> are all the <italic toggle="yes">k</italic>-mers in <italic toggle="yes">q</italic>. This formula assumes that the branches that do not appear in any tuple associated to a <italic toggle="yes">k</italic>-mer have a phylo-<italic toggle="yes">k</italic>-mer score <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mo>ε</mml:mo></mml:math></inline-formula>. Also, note that we intend <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> to approximate the log-probability of sequence <italic toggle="yes">q</italic> diverging from branch <italic toggle="yes">y</italic>. Therefore, the term <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula> corrects for the fact that the sum above includes the log-probability of most query characters <italic toggle="yes">k</italic> times. For each query, we report a number of top-scored branches together with (approximate) likelihood weight ratios, computed as follows (where <italic toggle="yes">b</italic> is the base of the logarithm):
<disp-formula id="E5"><mml:math id="M5" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">LWR</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mi>x</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec>
      <title>2.4 Placement accuracy evaluation</title>
      <p>To evaluate placement accuracy, we used <italic toggle="yes">PEWO</italic> (<italic toggle="yes">Placement Evaluation Workflows</italic>), a framework recently developed by <xref rid="btad692-B20" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> (2021)</xref>. We evaluated the accuracy of <italic toggle="yes">EPIK</italic>’s placement with and without filtering, as well as the accuracy of the other state-of-the-art phylogenetic placement methods. We used the pruning-based accuracy procedure (<italic toggle="yes">PAC</italic>) of <italic toggle="yes">PEWO</italic> that computes the accuracy of phylogenetic placement as follows. First, given a reference alignment and a reference tree, it randomly selects a subtree to remove (“prune”) from the original tree. Second, it extracts query reads from the sequences associated with the leaves removed. Then, query reads are placed on the remaining tree. Finally, for every placed query read, it computes the <italic toggle="yes">node distance</italic> between the observed placement and the expected placement. Node distance is defined as the number of tree nodes on the path between the branch reported as the query’s top-scoring placement (the observed placement) and the branch that was created as a result of pruning the subtree (the expected placement). We used node distance as it is the most commonly used way of evaluating phylogenetic placement accuracy (<xref rid="btad692-B12" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2022</xref>). Also, <italic toggle="yes">APPLES2</italic> and <italic toggle="yes">App-SpaM</italic> do not output multiple placements along with relative confidence scores and thus do not support evaluating <italic toggle="yes">expected</italic> node distance.</p>
      <p>We compared the accuracy of <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic> against the latest versions of state-of-the-art phylogenetic placement tools: <italic toggle="yes">pplacer</italic>, <italic toggle="yes">EPA-ng</italic>, <italic toggle="yes">App-SpaM</italic>, <italic toggle="yes">APPLES2</italic>, and <italic toggle="yes">RAPPAS</italic> (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S5</xref> for details). We used <italic toggle="yes">PhyML</italic> for ancestral reconstruction required by <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">IPK</italic>. We did not include <italic toggle="yes">EPA</italic> in the evaluation since it is the predecessor of <italic toggle="yes">EPA-ng</italic> and because <italic toggle="yes">EPA-ng</italic> supports <italic toggle="yes">EPA</italic>’s placement algorithm as one of the options. We ran these tools for 50 prunings (prunings and queries are identical for all tools). For each pruning, we report the mean node distance across several 150-bp-long queries generated for that pruning. The number of generated queries per pruning is variable, as it depends on the number of sequences in the pruned subtree, and on the length of those sequences. We ran all tools with their default parameters, except <italic toggle="yes">RAPPAS</italic>, for which we used the defaults of <italic toggle="yes">EPIK</italic>: <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> for DNA and <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:math></inline-formula> for proteins instead of the <italic toggle="yes">RAPPAS</italic>’ default <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula>. Generally, using higher values of <italic toggle="yes">k</italic>, we can expect increased placement accuracy; we used these values to facilitate comparison with <italic toggle="yes">EPIK</italic>. We ran <italic toggle="yes">EPA-ng</italic>, <italic toggle="yes">pplacer</italic>, and <italic toggle="yes">APPLES2</italic> using query-reference alignments constructed with <italic toggle="yes">HMMER</italic> in the way it is implemented by default in <italic toggle="yes">PEWO</italic>.</p>
      <p>To test the placement accuracy of <italic toggle="yes">EPIK</italic>, we used seven real-world datasets of amino acid and nucleotide sequences, where the number of reference sequences ranged from 140 to 3748. All of these datasets have been previously used as benchmarks for the accuracy of phylogenetic placement methods. Three datasets consist of sequences for widely used metabarcoding markers: <italic toggle="yes">D218</italic>, <italic toggle="yes">D500</italic> (<xref rid="btad692-B6" ref-type="bibr">Berger <italic toggle="yes">et al.</italic> 2011</xref>), and <italic toggle="yes">D652</italic> (<xref rid="btad692-B29" ref-type="bibr">Srinivasan <italic toggle="yes">et al.</italic> 2012</xref>, <xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2019</xref>). Three others contain full-length viral sequences: <italic toggle="yes">D140</italic> (<xref rid="btad692-B6" ref-type="bibr">Berger <italic toggle="yes">et al.</italic> 2011</xref>), <italic toggle="yes">HCV</italic> (<xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2019</xref>), and <italic toggle="yes">HIV</italic> (<xref rid="btad692-B27" ref-type="bibr">Schultz <italic toggle="yes">et al.</italic> 2009</xref>). <xref rid="btad692-T1" ref-type="table">Table 1</xref> gives a short description of these datasets (including two other datasets, <italic toggle="yes">neotrop</italic> and <italic toggle="yes">tara</italic>, that were used to test efficiency).</p>
      <table-wrap position="float" id="btad692-T1">
        <label>Table 1.</label>
        <caption>
          <p>Datasets used to evaluate the accuracy or speed of phylogenetic placement.<xref rid="tblfn1" ref-type="table-fn"><sup>a</sup></xref></p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Dataset</th>
              <th rowspan="1" colspan="1">Type</th>
              <th rowspan="1" colspan="1">Locus</th>
              <th rowspan="1" colspan="1">No. of taxa</th>
              <th rowspan="1" colspan="1">
                <bold>Length (</bold>
                <inline-formula id="IE35">
                  <mml:math id="IM35" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>×</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:mn>10</mml:mn>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mn>3</mml:mn>
                        </mml:msup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
                <bold>)</bold>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D218</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Bacterial 16S rRNA</td>
              <td rowspan="1" colspan="1">218</td>
              <td rowspan="1" colspan="1">1.5</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D500</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Chloroplast rbcL gene</td>
              <td rowspan="1" colspan="1">500</td>
              <td rowspan="1" colspan="1">1.4</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D652</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Bacterial 16S rRNA</td>
              <td rowspan="1" colspan="1">652</td>
              <td rowspan="1" colspan="1">1.3</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">neotrop</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Eukaryote 18S rRNA</td>
              <td rowspan="1" colspan="1">512</td>
              <td rowspan="1" colspan="1">1.8</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">tara</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Bacterial 16S rRNA</td>
              <td rowspan="1" colspan="1">3748</td>
              <td rowspan="1" colspan="1">1.4</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">HCV</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Complete genome</td>
              <td rowspan="1" colspan="1">155</td>
              <td rowspan="1" colspan="1">9.4</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">HIV</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Complete genome</td>
              <td rowspan="1" colspan="1">881</td>
              <td rowspan="1" colspan="1">9.0</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D140</italic>
              </td>
              <td rowspan="1" colspan="1">AA</td>
              <td rowspan="1" colspan="1">Genome-scale</td>
              <td rowspan="1" colspan="1">140</td>
              <td rowspan="1" colspan="1">1.0</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn1">
            <label>a</label>
            <p>The “Length” column contains the average length of the sequences, measured in units corresponding to the data type (nucleotides or amino acids).</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec>
      <title>2.5 Placement accuracy with filtering</title>
      <p>When we remove phylo-<italic toggle="yes">k</italic>-mers from the database, we expect placement accuracy to decrease. We aimed to answer two questions: how quickly does the accuracy decay with increased filtering, and how much can we filter out without hurting placement accuracy significantly? To investigate this, we performed filtering using a parameter <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>∈</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> indicating the fraction of the original database to keep (if <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, no filtering was performed). That is, if <inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">D</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula> denotes the size of the entire database <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mi mathvariant="script">D</mml:mi></mml:math></inline-formula>, we selected <italic toggle="yes">k</italic>-mers until it was impossible to add the next <italic toggle="yes">k</italic>-mer and its associated tuples, without exceeding the database size of <inline-formula id="IE40"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>⋅</mml:mo><mml:mo>|</mml:mo><mml:mi mathvariant="script">D</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>We used pruning-based accuracy evaluation in the following manner. First, for a given set of input data and a range of values of <inline-formula id="IE41"><mml:math id="IM41" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>∈</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>, we computed phylo-<italic toggle="yes">k</italic>-mer databases applying the corresponding filtering ratios <inline-formula id="IE42"><mml:math id="IM42" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>. Then, we evaluated the mean node distance for 30 prunings for every produced filtered database. We carried out this procedure for both the MI filter and a random filter. The random filter selects <italic toggle="yes">k</italic>-mers in random order until a fraction <inline-formula id="IE43"><mml:math id="IM43" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula> of the original database is kept. As input data, we used the same datasets as in the placement accuracy experiments described in Section 2.4.</p>
    </sec>
    <sec>
      <title>2.6 Running time and memory consumption</title>
      <p>We compare the running time and memory consumption of <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic> against other tools using the <italic toggle="yes">RES</italic> workflow of <italic toggle="yes">PEWO</italic> (<xref rid="btad692-B20" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2021</xref>). We used datasets with different tree sizes and alignment lengths: <italic toggle="yes">D652</italic>, <italic toggle="yes">neotrop</italic> (<xref rid="btad692-B21" ref-type="bibr">Mahé <italic toggle="yes">et al.</italic> 2017</xref>), <italic toggle="yes">tara</italic> (<xref rid="btad692-B30" ref-type="bibr">Sunagawa <italic toggle="yes">et al.</italic> 2015</xref>), and <italic toggle="yes">HCV</italic>. For <italic toggle="yes">D652</italic> and <italic toggle="yes">tara</italic>, we used ten million of 100–150 bp real-world amplicon reads of bacterial 16S rRNA gene retrieved from the Earth Microbiome Project (<xref rid="btad692-B31" ref-type="bibr">Thompson <italic toggle="yes">et al.</italic> 2017</xref>, <xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2019</xref>). For <italic toggle="yes">HCV</italic>, we used ten million queries of 150 bp simulated for the study of <xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> (2019)</xref>. For <italic toggle="yes">neotrop</italic>, we used ten million real-world 18S rRNA reads of various lengths [both the reference and the queries were retrieved from the study of <xref rid="btad692-B21" ref-type="bibr">Mahé <italic toggle="yes">et al.</italic> (2017)</xref>].</p>
      <p>We carried out experiments on a computer equipped with Intel(R) Xeon(R) W-2133 CPU @ 3.60 GHz/8.25 MB Cache/62 GB RAM and an HDD with SATA 3.0 and 64 MB cache. We ran all tools in a single-thread mode (not all of them support parallel execution). For the running time, we consider the total wall clock time; for the RAM consumption, we consider the peak maximum resident set size (RSS). Measurements were averaged over three repeats for every stage of computation of every program.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Implementation</title>
    <sec>
      <title>3.1 <italic toggle="yes">IPK</italic>: a standalone tool for computing phylo-<italic toggle="yes">k</italic>-mers</title>
      <p>We introduce <italic toggle="yes">IPK</italic>, a new tool for computing phylo-<italic toggle="yes">k</italic>-mers. A few essential differences set it apart from <italic toggle="yes">RAPPAS</italic>’s phylo-<italic toggle="yes">k</italic>-mer computation stage. First, we made <italic toggle="yes">IPK</italic> a standalone tool to ease the development of new applications of phylo-<italic toggle="yes">k</italic>-mers. <italic toggle="yes">IPK</italic> computes a database of phylo-<italic toggle="yes">k</italic>-mers for any given reference <italic toggle="yes">A</italic> and <italic toggle="yes">T</italic> and provides transparent access to this database to query <italic toggle="yes">k</italic>-mers. Applications such as <italic toggle="yes">EPIK</italic> and <italic toggle="yes">SHERPAS</italic> (<xref rid="btad692-B26" ref-type="bibr">Scholz <italic toggle="yes">et al.</italic> 2020</xref>) can use <italic toggle="yes">IPK</italic> as a black box through the provided API. Second, it applies a new, faster algorithm for phylo-<italic toggle="yes">k</italic>-mer computation (<xref rid="btad692-B25" ref-type="bibr">Romashchenko <italic toggle="yes">et al.</italic> 2023</xref>). When compared to <italic toggle="yes">RAPPAS</italic> for the default value <inline-formula id="IE44"><mml:math id="IM44" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>, <italic toggle="yes">IPK</italic> improves running times by more than two orders of magnitude (see Section 4.4 for experimental results). Third, <italic toggle="yes">IPK</italic> computes mutual information values for phylo-<italic toggle="yes">k</italic>-mers that are later used by <italic toggle="yes">EPIK</italic> for phylo-<italic toggle="yes">k</italic>-mer filtering. By default, <italic toggle="yes">IPK</italic> creates the database in memory and then stores it on disk. Alternatively, it can create the database directly on disk to reduce RAM consumption at the cost of longer execution (see Section 4.4 and <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref>). This allows for creating databases of sizes that exceed the amount of RAM available, which was not possible with <italic toggle="yes">RAPPAS</italic>.</p>
    </sec>
    <sec>
      <title>3.2 <italic toggle="yes">EPIK</italic>: faster phylo-<italic toggle="yes">k</italic>-mer-based phylogenetic placement</title>
      <p>We also developed <italic toggle="yes">EPIK</italic>, a new tool for phylogenetic placement with phylo-<italic toggle="yes">k</italic>-mers. It implements phylo-<italic toggle="yes">k</italic>-mer filtering, i.e. can place using only the most informative part of the phylo-<italic toggle="yes">k</italic>-mer database (defined by a proportion of the database size or a certain fixed size in bytes). This allows for placement even if the database is larger than the amount of RAM available. Also, <italic toggle="yes">EPIK</italic> can be run in parallel in shared memory for higher speed (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4</xref> for detail and results on parallel performance).</p>
      <p>Even when running in a single thread, <italic toggle="yes">EPIK</italic> achieves up to one order of magnitude improvement in placement speed over <italic toggle="yes">RAPPAS</italic> because of more efficient implementation (see Section 4.3 for experimental results). For an example of how to run <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic>, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S7</xref>.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Results</title>
    <sec>
      <title>4.1 Experiments on placement accuracy</title>
      <p>Here, we assess the placement accuracy of <italic toggle="yes">EPIK</italic> (with unfiltered databases) compared to the state-of-the-art on real-world datasets. <xref rid="btad692-F2" ref-type="fig">Figure 2</xref> shows the distributions of the mean node distance of placements per pruning (lower values are better). For two out of four datasets based on short metabarcoding markers (<italic toggle="yes">D500</italic>, <italic toggle="yes">D652</italic>, see <xref rid="btad692-F2" ref-type="fig">Fig. 2a</xref>), <italic toggle="yes">EPIK</italic> shows better accuracy compared to other state-of-the-art tools. These results are to some extent consistent with the ones of <xref rid="btad692-B7" ref-type="bibr">Blanke and Morgenstern (2021)</xref>, where <italic toggle="yes">RAPPAS</italic> using <inline-formula id="IE45"><mml:math id="IM45" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula> showed the best accuracy on four out of six 16S datasets.</p>
      <fig position="float" id="btad692-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Results on phylogenetic placement accuracy of different tools. One point of the distribution represents placements of multiple queries placed to a particular pruned tree. The <italic toggle="yes">y</italic>-axis corresponds to the mean node distances for such groups of queries and their placements. (a) Metabarcoding markers datasets. (b) Full-genome viral datasets consisting of nucleotide sequences (<italic toggle="yes">HCV</italic>, <italic toggle="yes">HIV</italic>) and amino acid sequences (<italic toggle="yes">D140</italic>).</p>
        </caption>
        <graphic xlink:href="btad692f2" position="float"/>
      </fig>
      <p>For the viral datasets (<xref rid="btad692-F2" ref-type="fig">Fig. 2b</xref>), <italic toggle="yes">EPIK</italic> was comparable to the best performing methods (<italic toggle="yes">EPA-ng</italic> and <italic toggle="yes">pplacer</italic>) for <italic toggle="yes">HCV</italic> and <italic toggle="yes">D140</italic>, yet was inferior to <italic toggle="yes">App-SpaM</italic> for <italic toggle="yes">HIV</italic>. <italic toggle="yes">App-SpaM</italic> cannot be run for <italic toggle="yes">D140</italic> since it does not support protein sequences. Also, <italic toggle="yes">RAPPAS</italic> could not build phylo-<italic toggle="yes">k</italic>-mer databases for <italic toggle="yes">HIV</italic>, since it exceeded the 32 GB RAM limit.</p>
      <p><xref rid="btad692-F2" ref-type="fig">Figure 2</xref> also shows that, in general, the tools that are based on the same methodology tend to have very similar performance. For example, <italic toggle="yes">EPA-ng</italic> and <italic toggle="yes">pplacer</italic> tend to have very similar node distance distributions; also, the distributions for <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">EPIK</italic> are matching almost perfectly. However, there exist slight differences between <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">EPIK</italic> (not visible on <xref rid="btad692-F2" ref-type="fig">Fig. 2</xref>). This is due to floating-point rounding that <italic toggle="yes">IPK</italic>+<italic toggle="yes">EPIK</italic> handle better.</p>
      <p>Overall, <italic toggle="yes">EPIK</italic> showed similar or better accuracy in six out of seven experiments compared to the state-of-the-art software.</p>
    </sec>
    <sec>
      <title>4.2 Experiments on filtering performance</title>
      <p><xref rid="btad692-F3" ref-type="fig">Figure 3</xref> shows the placement accuracy results in the experiments with filtered databases. We compare the mean node distance (y-axis) obtained for different degrees of filtration (i.e. different values of <inline-formula id="IE46"><mml:math id="IM46" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, x-axis) against the mean node distance for <inline-formula id="IE47"><mml:math id="IM47" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (complete database) for the same dataset. We also compare the accuracy obtained for two filters—the mutual information (MI) filter and the random filter—obtained with the same value of <inline-formula id="IE48"><mml:math id="IM48" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>.</p>
      <fig position="float" id="btad692-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Results on <italic toggle="yes">k</italic>-mer filtering for the mutual information filter and random selection of <italic toggle="yes">k</italic>-mers. The <italic toggle="yes">x</italic>-axis corresponds to the ratio of filtered versus unfiltered database size. The <italic toggle="yes">y</italic>-axis corresponds to the mean node distances of placements (averaged over 30 prunings) obtained with filtered databases. Vertical bars represent standard errors of the means. (a) Results for metabarcoding markers. (b) Results for viral genomes.</p>
        </caption>
        <graphic xlink:href="btad692f3" position="float"/>
      </fig>
      <p>First, note that for all datasets and all values of <inline-formula id="IE49"><mml:math id="IM49" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, MI filtering showed better results than the baseline (always lower node distance than for random filtering). For <italic toggle="yes">D218</italic> (see <xref rid="btad692-F3" ref-type="fig">Fig. 3a</xref>), the MI filter decreased the average placement accuracy by <inline-formula id="IE50"><mml:math id="IM50" display="inline" overflow="scroll"><mml:mrow><mml:mn>4.4</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> while keeping only <inline-formula id="IE51"><mml:math id="IM51" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula> of the information compared to the complete database (from 4.65 for <inline-formula id="IE52"><mml:math id="IM52" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> to 4.85 for <inline-formula id="IE53"><mml:math id="IM53" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>). For random filtering, the accuracy loss was <inline-formula id="IE54"><mml:math id="IM54" display="inline" overflow="scroll"><mml:mrow><mml:mn>74.8</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> (from 4.65 to 8.12). For <italic toggle="yes">D500</italic> and <inline-formula id="IE55"><mml:math id="IM55" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>, MI filtering reduced the accuracy by <inline-formula id="IE56"><mml:math id="IM56" display="inline" overflow="scroll"><mml:mrow><mml:mn>5.7</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> versus <inline-formula id="IE57"><mml:math id="IM57" display="inline" overflow="scroll"><mml:mrow><mml:mn>132</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for random filtering. For <italic toggle="yes">D652</italic> and the same filtration ratio, the average accuracy worsened by <inline-formula id="IE58"><mml:math id="IM58" display="inline" overflow="scroll"><mml:mrow><mml:mn>6.7</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE59"><mml:math id="IM59" display="inline" overflow="scroll"><mml:mrow><mml:mn>66.8</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for MI filtering and the baseline, respectively.</p>
      <p>For viral datasets (<xref rid="btad692-F3" ref-type="fig">Fig. 3b</xref>), <italic toggle="yes">k</italic>-mer filtering had a larger impact on accuracy. For <italic toggle="yes">D140</italic>, keeping <inline-formula id="IE60"><mml:math id="IM60" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula> of the database decreased the accuracy by <inline-formula id="IE61"><mml:math id="IM61" display="inline" overflow="scroll"><mml:mrow><mml:mn>86</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE62"><mml:math id="IM62" display="inline" overflow="scroll"><mml:mrow><mml:mn>190</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for MI and the baseline, respectively. For <italic toggle="yes">HCV</italic> and the same <inline-formula id="IE63"><mml:math id="IM63" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>, the accuracy change was <inline-formula id="IE64"><mml:math id="IM64" display="inline" overflow="scroll"><mml:mrow><mml:mn>83</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE65"><mml:math id="IM65" display="inline" overflow="scroll"><mml:mrow><mml:mn>132</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula>; still, the drop in accuracy was just <inline-formula id="IE66"><mml:math id="IM66" display="inline" overflow="scroll"><mml:mrow><mml:mn>3.2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> while halving the database using the MI filter (<inline-formula id="IE67"><mml:math id="IM67" display="inline" overflow="scroll"><mml:mrow><mml:mn>9.6</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for the baseline). For <italic toggle="yes">HIV</italic> and <inline-formula id="IE68"><mml:math id="IM68" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>, MI filtering decreased the average accuracy by <inline-formula id="IE69"><mml:math id="IM69" display="inline" overflow="scroll"><mml:mrow><mml:mn>7.1</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> (<inline-formula id="IE70"><mml:math id="IM70" display="inline" overflow="scroll"><mml:mrow><mml:mn>37.2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for the baseline). Note that results for the <italic toggle="yes">D140</italic> dataset are difficult to compare to those for other viral datasets, because of the different sequence type and length of <italic toggle="yes">k</italic>-mers.</p>
      <p>Note that <xref rid="btad692-F3" ref-type="fig">Fig. 3</xref> gives only means and standard errors for every node distance distribution for fixed <inline-formula id="IE71"><mml:math id="IM71" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>. <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S4</xref> gives a more detailed picture of the distributions. Overall, the results suggest that <italic toggle="yes">k</italic>-mer filtering can significantly reduce the phylo-<italic toggle="yes">k</italic>-mer database size with some (often negligible) decrease in placement accuracy.</p>
    </sec>
    <sec>
      <title>4.3 Running time: placement</title>
      <p>Here, we evaluate the scalability of the state-of-the-art tools and <italic toggle="yes">EPIK</italic> in the number of query sequences to place. <xref rid="btad692-F4" ref-type="fig">Figure 4</xref> presents measurements of wall-clock time required for placement of increasing numbers of queries. Importantly, the running times do not include any preprocessing needed by these methods. For <italic toggle="yes">EPA-ng</italic> and <italic toggle="yes">APPLES2</italic> by “preprocessing” we mean the alignment of queries to the reference alignment, while for <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">EPIK</italic> we mean the construction of the phylo-<italic toggle="yes">k</italic>-mer database. <italic toggle="yes">App-SpaM</italic> does not require any preprocessing. We present some results on preprocessing times in the next section. We stopped any jobs that required more than 32 GB of RAM.</p>
      <fig position="float" id="btad692-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Running time of different phylogenetic placement tools on four reference datasets. Preprocessing time is not counted for alignment-based methods (dotted lines) nor for alignment-free ones (solid lines). Measurements are averaged over three runs.</p>
        </caption>
        <graphic xlink:href="btad692f4" position="float"/>
      </fig>
      <p><italic toggle="yes">EPIK</italic> showed better placement time than <italic toggle="yes">RAPPAS</italic> in all experiments. The running time improvement over <italic toggle="yes">RAPPAS</italic> varied among datasets and the number of queries placed. For example, while placing ten million queries to <italic toggle="yes">D652</italic>, <italic toggle="yes">EPIK</italic> was around 14 times faster (29 min versus 6 h 49 min); for <italic toggle="yes">neotrop</italic> and ten million queries, it was 18 times faster (1 h 34 min versus 28 h). The lower relative performance of <italic toggle="yes">EPIK</italic> for fewer queries is due to the overhead required by loading the phylo-<italic toggle="yes">k</italic>-mer database in memory that is constant and does not depend on the number of queries placed. We also note that the loaded database size greatly affects the memory consumption of <italic toggle="yes">EPIK</italic> (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S3</xref> for measurements); this, however, can be reduced with phylo-<italic toggle="yes">k</italic>-mer filtering.</p>
      <p>In conclusion, alignment-free approaches showed consistently better running times than alignment-based ones, even if we exclude the time to align query sequences. <italic toggle="yes">EPIK</italic> showed the best running time against all tools on all datasets tested while placing a hundred thousand or more queries.</p>
    </sec>
    <sec>
      <title>4.4 Running time: phylo-<italic toggle="yes">k</italic>-mer computation</title>
      <p><xref rid="btad692-T2" ref-type="table">Table 2</xref> gives the averaged measurements of total time spent by <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">IPK</italic> to compute databases of phylo-<italic toggle="yes">k</italic>-mers for <inline-formula id="IE72"><mml:math id="IM72" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>, both using the in-memory and on-disk algorithms. For comparison, it also provides the time needed to align a million queries used in the experiments described in Section 4.3. For all datasets, <italic toggle="yes">IPK</italic> (with the default in-memory algorithm) was more than one hundred times faster than <italic toggle="yes">RAPPAS</italic>: the speed-up was 147×, 124×, 239×, and 120× for <italic toggle="yes">D652</italic>, <italic toggle="yes">neotrop</italic>, <italic toggle="yes">HCV</italic>, and <italic toggle="yes">tara</italic>, respectively. Also, <italic toggle="yes">IPK</italic> clearly outperforms <italic toggle="yes">RAPPAS</italic> in phylo-<italic toggle="yes">k</italic>-mer computation for other <italic toggle="yes">k</italic>-mer lengths (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S5</xref>). The speed-up of <italic toggle="yes">IPK</italic> over <italic toggle="yes">RAPPAS</italic> increases with the value of <italic toggle="yes">k</italic>. Importantly, it was significantly faster to preprocess the reference data with <italic toggle="yes">IPK</italic> than to align a million query sequences for all datasets. This was not the case for <italic toggle="yes">RAPPAS</italic>.</p>
      <table-wrap position="float" id="btad692-T2">
        <label>Table 2.</label>
        <caption>
          <p>Preprocessing times on four reference datasets.<xref rid="tblfn2" ref-type="table-fn"><sup>a</sup></xref></p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Dataset</th>
              <th rowspan="1" colspan="1">HMMER(1M)</th>
              <th rowspan="1" colspan="1">RAPPAS</th>
              <th rowspan="1" colspan="1">IPK</th>
              <th rowspan="1" colspan="1">IPK (on disk)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D652</italic>
              </td>
              <td rowspan="1" colspan="1">2 h 21 min</td>
              <td rowspan="1" colspan="1">11 h 26 min</td>
              <td rowspan="1" colspan="1">4 min 40 s</td>
              <td rowspan="1" colspan="1">6 min 46 s</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">neotrop</italic>
              </td>
              <td rowspan="1" colspan="1">10 h 00 min</td>
              <td rowspan="1" colspan="1">18 h 32 min</td>
              <td rowspan="1" colspan="1">8 min 59 s</td>
              <td rowspan="1" colspan="1">11 min 23 s</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">tara</italic>
              </td>
              <td rowspan="1" colspan="1">2 h 09 min</td>
              <td rowspan="1" colspan="1">62 h 59 min</td>
              <td rowspan="1" colspan="1">30 min 56 s</td>
              <td rowspan="1" colspan="1">46 min 10 s</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">HCV</italic>
              </td>
              <td rowspan="1" colspan="1">36 h 58 min</td>
              <td rowspan="1" colspan="1">15 h 22 min</td>
              <td rowspan="1" colspan="1">3 min 38 s</td>
              <td rowspan="1" colspan="1">4 min 45 s</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn2">
            <label>a</label>
            <p>Preprocessing consists in computing phylo-<italic toggle="yes">k</italic>-mer databases for <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">IPK</italic>, or aligning query sequences within the reference alignment for alignment-based tools (<italic toggle="yes">EPA-ng</italic>, <italic toggle="yes">APPLES2</italic>) using <italic toggle="yes">HMMER</italic>. For the latter, the running time of aligning one million query reads is shown. Measurements are averaged over three runs.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>As for the on-disk algorithm, it showed longer running times than the default in-memory algorithm. Importantly, on-disk processing allowed for a significant reduction in RAM usage. For instance, on-disk <italic toggle="yes">IPK</italic> processed <italic toggle="yes">tara</italic> using 1.6 GB of RAM instead of 30 GB in the in-memory mode, resulting in a database of size 21 GB on disk (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S2</xref> for additional measurements).</p>
    </sec>
  </sec>
  <sec>
    <title>5 Discussion</title>
    <p>We propose a new two-step solution for alignment-free phylogenetic placement implemented as two modular programs: <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic>. First, <italic toggle="yes">IPK</italic> computes a phylo-<italic toggle="yes">k</italic>-mer database from input alignment and phylogeny of reference sequences, then <italic toggle="yes">EPIK</italic> reuses this database to place the query sequences on the phylogeny. The combination <italic toggle="yes">IPK</italic>+<italic toggle="yes">EPIK</italic> follows the strategy used in <italic toggle="yes">RAPPAS</italic> but outperforms it in running time, memory usage, scalability, and introduces significant novelties.</p>
    <p>The new algorithm implemented in <italic toggle="yes">IPK</italic> provides dramatic speed improvements: for instance, the <italic toggle="yes">tara</italic> dataset with 3748 species and 1.4 kb alignment, is now preprocessed in minutes instead of days (cf. <xref rid="btad692-T2" ref-type="table">Table 2</xref>). This allowed us to increase the default value of <italic toggle="yes">k</italic> (from <inline-formula id="IE73"><mml:math id="IM73" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula> for DNA in <italic toggle="yes">RAPPAS</italic> to <inline-formula id="IE74"><mml:math id="IM74" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>), which is a key parameter. Indeed, using longer <italic toggle="yes">k</italic>-mers results in nondecreasing accuracy (<xref rid="btad692-B24" ref-type="bibr">Romashchenko 2021</xref>). Second, the gain in speed permits to process instances with larger number of species, and hence larger reference trees, which were problematic for <italic toggle="yes">RAPPAS</italic>. Last, <italic toggle="yes">IPK</italic> offers a second computation mode in which the database is computed on disk, allowing users to adapt memory usage to their own resources.</p>
    <p>Even if computed on disk, a phylo-<italic toggle="yes">k</italic>-mer database can be large, and thus lead <italic toggle="yes">EPIK</italic> to exhaust memory during placement. However, our filtering experiments show that phylo-<italic toggle="yes">k</italic>-mers are not equally informative for placement. We introduce a novel approach to compute the informativeness of each <italic toggle="yes">k</italic>-mer, and <italic toggle="yes">IPK</italic> sorts the database according to this value. Then <italic toggle="yes">EPIK</italic> can filter the database and load only the most informative part that fits into memory. Accuracy experiments with filtered databases showed that, quite often, a great number of <italic toggle="yes">k</italic>-mers (and associated scores) can be safely excluded. For example, we could reduce the database sizes by a factor of 16 with a minor loss in placement accuracy for datasets of metabarcoding markers, and at least by a factor of 4 for datasets of complete viral genomes.</p>
    <p>Let us point out two limitations of <italic toggle="yes">IPK</italic>+<italic toggle="yes">EPIK</italic>. First, they are currently not suited for metagenomic applications that require large reference sequences, like large eukaryotic genomes. For these data, our approach may require using larger values of <italic toggle="yes">k</italic> and limit the possibility of filtering. Hence, extending the applicability of phylo-<italic toggle="yes">k</italic>-mer-based methods to longer genomes seems challenging. Second, the mutual information of a given <italic toggle="yes">k</italic>-mer can only be computed once all its branch-specific scores are available. A perspective for future work is to develop an algorithm to assess <italic toggle="yes">k</italic>-mer informativeness directly during phylo-<italic toggle="yes">k</italic>-mer computation.</p>
    <p>Using <italic toggle="yes">EPIK</italic> requires the precomputation of the database with <italic toggle="yes">IPK</italic>, a step that is avoided by alignment-based methods. So how large shall the set of input reads be to counterbalance the precomputation time? In all our experiments (see Section 4.4), aligning a million short reads within the reference sequences was always significantly slower than computing phylo-<italic toggle="yes">k</italic>-mers for the references with <italic toggle="yes">IPK</italic>. Thus, already with circa a million short queries, it is faster to use alignment-free placement with phylo-<italic toggle="yes">k</italic>-mers than alignment-based tools.</p>
    <p>Implementing <italic toggle="yes">IPK</italic> as a standalone tool provides flexibility and eases the application of phylo-<italic toggle="yes">k</italic>-mers to other bioinformatic problems, thanks to a carefully designed API. For example, <italic toggle="yes">SHERPAS</italic>, another software based on phylo-<italic toggle="yes">k</italic>-mers, can readily use databases built by <italic toggle="yes">IPK</italic> to infer recombination patterns in viral sequences (<xref rid="btad692-B26" ref-type="bibr">Scholz <italic toggle="yes">et al.</italic> 2020</xref>). Currently, a tool exploiting phylo-<italic toggle="yes">k</italic>-mers for protein family homology detection is under development. We hope that further phylo-<italic toggle="yes">k</italic>-mer based solutions will be developed in the future.</p>
    <p>The C++ implementation of <italic toggle="yes">EPIK</italic> already offers high computational efficiency with a single thread, as well as multi-threading. Currently, for millions of queries or more, <italic toggle="yes">EPIK</italic> is the fastest phylogenetic placement software. Since the combination <italic toggle="yes">IPK</italic>+<italic toggle="yes">EPIK</italic> achieves high accuracy—comparable to state-of-the-art tools—when placing short metabarcoding reads, we hope it will become the tool of choice for large-scale metabarcoding applications.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btad692_Supplementary_Data</label>
      <media xlink:href="btad692_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We thank Frédéric Mahé for providing query sequences for the <italic toggle="yes">neotrop</italic> dataset, Matthias Blanke and Pierre Barbera for their useful comments on PEWO-based benchmarking, and the reviewers. We also thank the French Institute of Bioinformatics (IFB) for the computational resources provided.</p>
  </ack>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the French Ministry of Research (MNERT); the European Union’s Horizon 2020 research and innovation program under the Marie Skłodowska-Curie grant agreement [ALPACA, № 956229]; the French National Agency for Research (ANR) [Fish-Predict ANR-21-AAFI-0001]; the IFB; and the ATGC bioinformatics platform.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>The data underlying this article were obtained from the studies listed in Sections 2.4 and 2.6 and are available from the corresponding sources.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btad692-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Asnicar</surname><given-names>F</given-names></string-name>, <string-name><surname>Thomas</surname><given-names>AM</given-names></string-name>, <string-name><surname>Beghini</surname><given-names>F</given-names></string-name></person-group><etal>et al</etal><article-title>Precise phylogenetic analysis of microbial isolates and genomes from metagenomes using PhyloPhlAn 3.0</article-title>. <source>Nat Commun</source><year>2020</year>;<volume>11</volume>:<fpage>2500</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">32427907</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Balaban</surname><given-names>M</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Roush</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>Fast and accurate distance-based phylogenetic placement using divide and conquer</article-title>. <source>Mol Ecol Resour</source><year>2022</year>;<volume>22</volume>:<fpage>1213</fpage>–<lpage>27</lpage>.<pub-id pub-id-type="pmid">34643995</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barbera</surname><given-names>P</given-names></string-name>, <string-name><surname>Kozlov</surname><given-names>AM</given-names></string-name>, <string-name><surname>Czech</surname><given-names>L</given-names></string-name></person-group><etal>et al</etal><article-title>EPA-ng: massively parallel evolutionary placement of genetic sequences</article-title>. <source>Syst Biol</source><year>2019</year>;<volume>68</volume>:<fpage>365</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">30165689</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barbera</surname><given-names>P</given-names></string-name>, <string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Lutteropp</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>SCRAPP: a tool to assess the diversity of microbial samples from phylogenetic placements</article-title>. <source>Mol Ecol Resour</source><year>2021</year>;<volume>21</volume>:<fpage>340</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">32996237</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bass</surname><given-names>D</given-names></string-name>, <string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Williams</surname><given-names>BA</given-names></string-name></person-group><etal>et al</etal><article-title>Clarifying the relationships between Microsporidia and Cryptomycota</article-title>. <source>J Eukaryot Microbiol</source><year>2018</year>;<volume>65</volume>:<fpage>773</fpage>–<lpage>82</lpage>.<pub-id pub-id-type="pmid">29603494</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Berger</surname><given-names>SA</given-names></string-name>, <string-name><surname>Krompass</surname><given-names>D</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><article-title>Performance, accuracy, and web server for evolutionary placement of short sequence reads under maximum likelihood</article-title>. <source>Syst Biol</source><year>2011</year>;<volume>60</volume>:<fpage>291</fpage>–<lpage>302</lpage>.<pub-id pub-id-type="pmid">21436105</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Blanke</surname><given-names>M</given-names></string-name>, <string-name><surname>Morgenstern</surname><given-names>B.</given-names></string-name></person-group><article-title>App-SpaM: phylogenetic placement of short reads without sequence alignment</article-title>. <source>Bioinform Adv</source><year>2021</year>;<volume>1</volume>:<fpage>vbab027</fpage>.<pub-id pub-id-type="pmid">36700102</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bohmann</surname><given-names>K</given-names></string-name>, <string-name><surname>Mirarab</surname><given-names>S</given-names></string-name>, <string-name><surname>Bafna</surname><given-names>V</given-names></string-name></person-group><etal>et al</etal><article-title>Beyond DNA barcoding: the unrealized potential of genome skim data in sample identification</article-title>. <source>Mol Ecol</source><year>2020</year>;<volume>29</volume>:<fpage>2521</fpage>–<lpage>34</lpage>.<pub-id pub-id-type="pmid">32542933</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B9">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Cover</surname><given-names>TM</given-names></string-name>, <string-name><surname>Thomas</surname><given-names>JA.</given-names></string-name></person-group><source>Elements of Information Theory</source>, <edition>2nd edn</edition>. <publisher-loc>Hoboken, NJ</publisher-loc>: <publisher-name>Wiley-Interscience</publisher-name>, <year>2006</year>.</mixed-citation>
    </ref>
    <ref id="btad692-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><article-title>Scalable methods for analyzing and visualizing phylogenetic placement of metagenomic samples</article-title>. <source>PLoS ONE</source><year>2019</year>;<volume>14</volume>:<fpage>e0217050</fpage>.<pub-id pub-id-type="pmid">31136592</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Barbera</surname><given-names>P</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><article-title>Genesis and Gappa: processing, analyzing and visualizing phylogenetic (placement) data</article-title>. <source>Bioinformatics</source><year>2020</year>;<volume>36</volume>:<fpage>3263</fpage>–<lpage>5</lpage>.<pub-id pub-id-type="pmid">32016344</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A</given-names></string-name>, <string-name><surname>Dunthorn</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>Metagenomic analysis using phylogenetic placement—a review of the first decade</article-title>. <source>Front Bioinform</source><year>2022</year>;<volume>2</volume>:<fpage>871393</fpage>.<pub-id pub-id-type="pmid">36304302</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dunthorn</surname><given-names>M</given-names></string-name>, <string-name><surname>Otto</surname><given-names>J</given-names></string-name>, <string-name><surname>Berger</surname><given-names>SA</given-names></string-name></person-group><etal>et al</etal>; <collab>Biomarks Consortium</collab>. <article-title>Placing environmental next-generation sequencing amplicons from microbial eukaryotes into a phylogenetic context</article-title>. <source>Mol Biol Evol</source><year>2014</year>;<volume>31</volume>:<fpage>993</fpage>–<lpage>1009</lpage>.<pub-id pub-id-type="pmid">24473288</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Guindon</surname><given-names>S</given-names></string-name>, <string-name><surname>Dufayard</surname><given-names>J-F</given-names></string-name>, <string-name><surname>Lefort</surname><given-names>V</given-names></string-name></person-group><etal>et al</etal><article-title>New algorithms and methods to estimate maximum-likelihood phylogenies: assessing the performance of PhyML 3.0</article-title>. <source>Syst Biol</source><year>2010</year>;<volume>59</volume>:<fpage>307</fpage>–<lpage>21</lpage>.<pub-id pub-id-type="pmid">20525638</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hasan</surname><given-names>NB</given-names></string-name>, <string-name><surname>Balaban</surname><given-names>M</given-names></string-name>, <string-name><surname>Biswas</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>APPLES: scalable distance-based phylogenetic placement with or without alignments</article-title>. <source>Biology (Basel)</source><year>2020</year>;<volume>11</volume>:<fpage>566</fpage>–<lpage>78</lpage>.</mixed-citation>
    </ref>
    <ref id="btad692-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Janssen</surname><given-names>S</given-names></string-name>, <string-name><surname>McDonald</surname><given-names>D</given-names></string-name>, <string-name><surname>Gonzalez</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>Phylogenetic placement of exact amplicon sequences improves associations with clinical information</article-title>. <source>mSystems</source><year>2018</year>;<volume>3</volume>:<fpage>e00021–18</fpage>.<pub-id pub-id-type="pmid">29719869</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B17">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Koning</surname><given-names>E</given-names></string-name>, <string-name><surname>Phillips</surname><given-names>M</given-names></string-name>, <string-name><surname>Warnow</surname><given-names>T.</given-names></string-name></person-group> pplacerDC: a new scalable phylogenetic placement method. In: <italic toggle="yes">Proceedings of the 12th ACM Conference on Bioinformatics, Computational Biology, and Health Informatics</italic>, p.1–9. Gainesville, FL: Association for Computing Machinery, August 2021.</mixed-citation>
    </ref>
    <ref id="btad692-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kozlov</surname><given-names>AM</given-names></string-name>, <string-name><surname>Darriba</surname><given-names>D</given-names></string-name>, <string-name><surname>Flouri</surname><given-names>T</given-names></string-name></person-group><etal>et al</etal><article-title>RAxML-NG: a fast, scalable and user-friendly tool for maximum likelihood phylogenetic inference</article-title>. <source>Bioinformatics</source><year>2019</year>;<volume>35</volume>:<fpage>4453</fpage>–<lpage>5</lpage>.<pub-id pub-id-type="pmid">31070718</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Linard</surname><given-names>B</given-names></string-name>, <string-name><surname>Swenson</surname><given-names>K</given-names></string-name>, <string-name><surname>Pardi</surname><given-names>F.</given-names></string-name></person-group><article-title>Rapid alignment-free phylogenetic identification of metagenomic sequences</article-title>. <source>Bioinformatics</source><year>2019</year>;<volume>35</volume>:<fpage>3303</fpage>–<lpage>12</lpage>.<pub-id pub-id-type="pmid">30698645</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Linard</surname><given-names>B</given-names></string-name>, <string-name><surname>Romashchenko</surname><given-names>N</given-names></string-name>, <string-name><surname>Pardi</surname><given-names>F</given-names></string-name></person-group><etal>et al</etal><article-title>PEWO: a collection of workflows to benchmark phylogenetic placement</article-title>. <source>Bioinformatics</source><year>2021</year>;<volume>36</volume>:<fpage>5264</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">32697844</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mahé</surname><given-names>F</given-names></string-name>, <string-name><surname>de Vargas</surname><given-names>C</given-names></string-name>, <string-name><surname>Bass</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>Parasites dominate hyperdiverse soil protist communities in neotropical rainforests</article-title>. <source>Nat Ecol Evol</source><year>2017</year>;<volume>1</volume>:<fpage>91</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">28812652</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Matsen</surname><given-names>FA</given-names></string-name>, <string-name><surname>Kodner</surname><given-names>RB</given-names></string-name>, <string-name><surname>Armbrust</surname><given-names>E.</given-names></string-name></person-group><article-title>Pplacer: linear time maximum-likelihood and Bayesian phylogenetic placement of sequences onto a fixed reference tree</article-title>. <source>BMC Bioinformatics</source><year>2010</year>;<volume>11</volume>:<fpage>538</fpage>.<pub-id pub-id-type="pmid">21034504</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>McCallum</surname><given-names>A</given-names></string-name>, <string-name><surname>Nigam</surname><given-names>K.</given-names></string-name></person-group> A comparison of event models for Naive Bayes text classification. In: <italic toggle="yes">AAAI-98 Workshop on Learning for Text Categorization</italic>, Vol. <volume>752</volume>, p.41–8. Madison, WI: Association for the Advancement of Artificial Intelligence, July 1998.</mixed-citation>
    </ref>
    <ref id="btad692-B24">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Romashchenko</surname><given-names>N.</given-names></string-name></person-group> Computing informative k-mers for phylogenetic placement. Ph.D. Thesis, Université Montpellier, <year>2021</year>.</mixed-citation>
    </ref>
    <ref id="btad692-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Romashchenko</surname><given-names>N</given-names></string-name>, <string-name><surname>Linard</surname><given-names>B</given-names></string-name>, <string-name><surname>Rivals</surname><given-names>E</given-names></string-name></person-group><etal>et al</etal><article-title>Computing phylo-<italic toggle="yes">k</italic>-mers</article-title>. <source>IEEE/ACM Trans Comput Biol Bioinform</source><year>2023</year>;<volume>20</volume>:<fpage>2889</fpage>–<lpage>97</lpage>.<pub-id pub-id-type="pmid">37204943</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Scholz</surname><given-names>GE</given-names></string-name>, <string-name><surname>Linard</surname><given-names>B</given-names></string-name>, <string-name><surname>Romashchenko</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>Rapid screening and detection of inter-type viral recombinants using phylo-k-mers</article-title>. <source>Bioinformatics</source><year>2020</year>;<volume>36</volume>:<fpage>5351</fpage>–<lpage>60</lpage>.</mixed-citation>
    </ref>
    <ref id="btad692-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schultz</surname><given-names>A-K</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>M</given-names></string-name>, <string-name><surname>Bulla</surname><given-names>I</given-names></string-name></person-group><etal>et al</etal><article-title>jpHMM: improving the reliability of recombination prediction in HIV-1</article-title>. <source>Nucleic Acids Res</source><year>2009</year>;<volume>37</volume>:<fpage>W647</fpage>–<lpage>W651</lpage>.<pub-id pub-id-type="pmid">19443440</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B28">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Singer</surname><given-names>J</given-names></string-name>, <string-name><surname>Gifford</surname><given-names>R</given-names></string-name>, <string-name><surname>Cotten</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal> CoV-GLUE: A Web Application for Tracking SARS-CoV-2 Genomic Variation. <pub-id pub-id-type="doi">10.20944/preprints202006.0225.v1</pub-id>. <year>2020</year>.</mixed-citation>
    </ref>
    <ref id="btad692-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Srinivasan</surname><given-names>S</given-names></string-name>, <string-name><surname>Hoffman</surname><given-names>NG</given-names></string-name>, <string-name><surname>Morgan</surname><given-names>MT</given-names></string-name></person-group><etal>et al</etal><article-title>Bacterial communities in women with bacterial vaginosis: high resolution phylogenetic analyses reveal relationships of microbiota to clinical criteria</article-title>. <source>PLoS ONE</source><year>2012</year>;<volume>7</volume>:<fpage>e37818</fpage>.<pub-id pub-id-type="pmid">22719852</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sunagawa</surname><given-names>S</given-names></string-name>, <string-name><surname>Coelho</surname><given-names>LP</given-names></string-name>, <string-name><surname>Chaffron</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal>; <collab>Tara Oceans Coordinators</collab>. <article-title>Structure and function of the global ocean microbiome</article-title>. <source>Science</source><year>2015</year>;<volume>348</volume>:<fpage>1261359</fpage>.<pub-id pub-id-type="pmid">25999513</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Thompson</surname><given-names>LR</given-names></string-name>, <string-name><surname>Sanders</surname><given-names>JG</given-names></string-name>, <string-name><surname>McDonald</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal>; <collab>Earth Microbiome Project Consortium</collab>. <article-title>A communal catalogue reveals earth’s multiscale microbial diversity</article-title>. <source>Nature</source><year>2017</year>;<volume>551</volume>:<fpage>457</fpage>–<lpage>63</lpage>.<pub-id pub-id-type="pmid">29088705</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Turakhia</surname><given-names>Y</given-names></string-name>, <string-name><surname>Thornlow</surname><given-names>B</given-names></string-name>, <string-name><surname>Hinrichs</surname><given-names>AS</given-names></string-name></person-group><etal>et al</etal><article-title>Ultrafast sample placement on existing trees (UShER) enables real-time phylogenetics for the SARS-CoV-2 pandemic</article-title>. <source>Nat Genet</source><year>2021</year>;<volume>53</volume>:<fpage>809</fpage>–<lpage>16</lpage>.<pub-id pub-id-type="pmid">33972780</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wedell</surname><given-names>E</given-names></string-name>, <string-name><surname>Cai</surname><given-names>Y</given-names></string-name>, <string-name><surname>Warnow</surname><given-names>T.</given-names></string-name></person-group><article-title>SCAMPP: scaling alignment-based phylogenetic placement to large trees</article-title>. <source>IEEE/ACM Trans Comput Biol Bioinform</source><year>2023</year>;<volume>20</volume>:<fpage>1417</fpage>–<lpage>30</lpage>.<pub-id pub-id-type="pmid">35471888</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10701097</article-id>
    <article-id pub-id-type="pmid">37975872</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btad692</article-id>
    <article-id pub-id-type="publisher-id">btad692</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Phylogenetics</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>EPIK: precise and scalable evolutionary placement with informative <italic toggle="yes">k</italic>-mers</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-2264-5219</contrib-id>
        <name>
          <surname>Romashchenko</surname>
          <given-names>Nikolai</given-names>
        </name>
        <aff><institution>LIRMM, University of Montpellier, CNRS</institution>, Montpellier, <country country="FR">France</country></aff>
        <xref rid="btad692-cor1" ref-type="corresp"/>
        <!--nromashchenko@lirmm.fr-->
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-5555-898X</contrib-id>
        <name>
          <surname>Linard</surname>
          <given-names>Benjamin</given-names>
        </name>
        <aff><institution>LIRMM, University of Montpellier, CNRS</institution>, Montpellier, <country country="FR">France</country></aff>
        <xref rid="btad692-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8084-1464</contrib-id>
        <name>
          <surname>Pardi</surname>
          <given-names>Fabio</given-names>
        </name>
        <aff><institution>LIRMM, University of Montpellier, CNRS</institution>, Montpellier, <country country="FR">France</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-3791-3973</contrib-id>
        <name>
          <surname>Rivals</surname>
          <given-names>Eric</given-names>
        </name>
        <aff><institution>LIRMM, University of Montpellier, CNRS</institution>, Montpellier, <country country="FR">France</country></aff>
        <xref rid="btad692-cor1" ref-type="corresp"/>
        <!--rivals@lirmm.fr-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Schwartz</surname>
          <given-names>Russell</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <fn id="btad692-FM1">
        <p>Present address of Benjamin Linard: INRAE, UR MIAT, University of Toulouse, F-31320 Castanet-Tolosan, France</p>
      </fn>
      <corresp id="btad692-cor1">Corresponding authors. LIRMM UMR 5506, 860 rue St Priest, 34095 Montpellier cedex 5, France. E-mails: <email>nromashchenko@lirmm.fr</email> (N.R.) and <email>rivals@lirmm.fr</email> (E.R.)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>12</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-11-17">
      <day>17</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>17</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <volume>39</volume>
    <issue>12</issue>
    <elocation-id>btad692</elocation-id>
    <history>
      <date date-type="received">
        <day>15</day>
        <month>3</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>20</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>15</day>
        <month>10</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>16</day>
        <month>11</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>06</day>
        <month>12</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btad692.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Phylogenetic placement enables phylogenetic analysis of massive collections of newly sequenced DNA, when <italic toggle="yes">de novo</italic> tree inference is too unreliable or inefficient. Assuming that a high-quality reference tree is available, the idea is to seek the correct placement of the new sequences in that tree. Recently, alignment-free approaches to phylogenetic placement have emerged, both to circumvent the need to align the new sequences and to avoid the calculations that typically follow the alignment step. A promising approach is based on the inference of <italic toggle="yes">k</italic>-mers that can be potentially related to the reference sequences, also called phylo-<italic toggle="yes">k</italic>-mers. However, its usage is limited by the time and memory-consuming stage of reference data preprocessing and the large numbers of <italic toggle="yes">k</italic>-mers to consider.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We suggest a filtering method for selecting informative phylo-<italic toggle="yes">k</italic>-mers based on mutual information, which can significantly improve the efficiency of placement, at the cost of a small loss in placement accuracy. This method is implemented in <italic toggle="yes">IPK</italic>, a new tool for computing phylo-<italic toggle="yes">k</italic>-mers that significantly outperforms the software previously available. We also present <italic toggle="yes">EPIK</italic>, a new software for phylogenetic placement, supporting filtered phylo-<italic toggle="yes">k</italic>-mer databases. Our experiments on real-world data show that <italic toggle="yes">EPIK</italic> is the fastest phylogenetic placement tool available, when placing hundreds of thousands and millions of queries while still providing accurate placements.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p><italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic> are freely available at <ext-link xlink:href="https://github.com/phylo42/IPK" ext-link-type="uri">https://github.com/phylo42/IPK</ext-link> and <ext-link xlink:href="https://github.com/phylo42/EPIK" ext-link-type="uri">https://github.com/phylo42/EPIK</ext-link>. Both are implemented in C++ and Python and supported on Linux and MacOS.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>French Ministry of Research</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Union’s Horizon 2020</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>French National Agency for Research</institution>
            <institution-id institution-id-type="DOI">10.13039/501100001665</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Phylogenetic placement is an increasingly popular task in phylogenetic analysis (<xref rid="btad692-B12" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2022</xref>). Its input is a set of reference sequences (often aligned), a phylogenetic tree representing their evolution, and a (usually large) collection of novel query sequences. The problem is to find, for each query, the likely location(s) of its evolutionary origin in the reference tree. Applications of phylogenetic placement range from taxonomic identification and microbiome analysis (<xref rid="btad692-B31" ref-type="bibr">Thompson <italic toggle="yes">et al.</italic> 2017</xref>, <xref rid="btad692-B16" ref-type="bibr">Janssen <italic toggle="yes">et al.</italic> 2018</xref>, <xref rid="btad692-B1" ref-type="bibr">Asnicar <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btad692-B8" ref-type="bibr">Bohmann <italic toggle="yes">et al.</italic> 2020</xref>), to the inference of new clades (<xref rid="btad692-B13" ref-type="bibr">Dunthorn <italic toggle="yes">et al.</italic> 2014</xref>, <xref rid="btad692-B5" ref-type="bibr">Bass <italic toggle="yes">et al.</italic> 2018</xref>), and tracking of viral variants (<xref rid="btad692-B28" ref-type="bibr">Singer <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btad692-B32" ref-type="bibr">Turakhia <italic toggle="yes">et al.</italic> 2021</xref>).</p>
    <p>The interest of phylogenetic placement is particularly evident for amplicon-based analysis of environmental samples. Because of the number and limited length of the sequences typically found in these samples, <italic toggle="yes">de novo</italic> phylogenetic inference would be too unreliable and inefficient on these data (<xref rid="btad692-B12" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2022</xref>). Moreover, phylogenetic placement software plays a key role in an ecosystem of tools for biodiversity quantification and visualization (<xref rid="btad692-B11" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btad692-B4" ref-type="bibr">Barbera <italic toggle="yes">et al.</italic> 2021</xref>), sample comparison, and identification of correlations (<xref rid="btad692-B10" ref-type="bibr">Czech and Stamatakis 2019</xref>).</p>
    <p>Early phylogenetic placement tools such as <italic toggle="yes">pplacer</italic> (<xref rid="btad692-B22" ref-type="bibr">Matsen <italic toggle="yes">et al.</italic> 2010</xref>) and <italic toggle="yes">EPA</italic> [<italic toggle="yes">Evolutionary Placement Algorithm</italic>; <xref rid="btad692-B6" ref-type="bibr">Berger <italic toggle="yes">et al.</italic> (2011)</xref>] were based on maximum likelihood (ML) inference—a successful approach that provides highly accurate placements. However, those implementations suffered from two scalability problems. First, they were limited by the size of the reference tree, making it problematic to apply them to large phylogenies, e.g. with dozens of thousands of taxa (<xref rid="btad692-B17" ref-type="bibr">Koning <italic toggle="yes">et al.</italic> 2021</xref>). Second, those methods require to <italic toggle="yes">align each query</italic> to the reference sequences, which is why such methods are called <italic toggle="yes">alignment-based</italic>. Naturally, they also require a multiple alignment of the reference sequences, which is nonetheless often is a prerequisite to estimate the tree (or at least branch lengths and model parameters). The limitation of alignment-based methods is that, even though queries are typically short, their alignment to long reference sequences is poorly scalable with the ever-increasing amounts of sequencing data delivered by current technologies.</p>
    <p>Further developments in phylogenetic placement methods focused on overcoming those challenges. <italic toggle="yes">APPLES</italic>, followed by <italic toggle="yes">APPLES-2</italic> (<xref rid="btad692-B15" ref-type="bibr">Hasan <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btad692-B2" ref-type="bibr">Balaban <italic toggle="yes">et al.</italic> 2022</xref>), was the first method enabling placement to ultra-large phylogenies. It is a distance-based method, where the distances between the query and the reference sequences can be computed on the basis of an alignment, or in an alignment-free way. It allows placing queries to trees of hundreds of thousands of taxa at the cost of lower placement accuracy compared to competing methods. Similar developments include <italic toggle="yes">pplacerDC</italic> (<xref rid="btad692-B17" ref-type="bibr">Koning <italic toggle="yes">et al.</italic> 2021</xref>) and <italic toggle="yes">SCAMPP</italic> (<xref rid="btad692-B33" ref-type="bibr">Wedell <italic toggle="yes">et al.</italic> 2023</xref>), which implement heuristics extending the applicability of ML-based placement to large phylogenies.</p>
    <p><italic toggle="yes">EPA-ng—</italic>the successor of <italic toggle="yes">EPA—</italic>significantly improved the ML-based placement speed with massive parallelization (<xref rid="btad692-B3" ref-type="bibr">Barbera <italic toggle="yes">et al.</italic> 2019</xref>). However, the challenge of aligning query sequences was only addressed by the recent emergence of <italic toggle="yes">alignment-free</italic> methods. <italic toggle="yes">RAPPAS</italic> preprocesses the references by computing <italic toggle="yes">phylo-k-mers</italic> independent of queries (<xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2019</xref>). Phylo-<italic toggle="yes">k</italic>-mers are stored for later use during placement. This allows <italic toggle="yes">RAPPAS</italic> to avoid aligning the queries, which explains the “alignment-free” term (even though the input contains aligned reference sequences), and makes it highly scalable in the number of queries to place. Moreover, <italic toggle="yes">RAPPAS</italic> proved to be highly accurate, especially for short queries (<xref rid="btad692-B7" ref-type="bibr">Blanke and Morgenstern 2021</xref>).</p>
    <p>Another recent alignment-free development is <italic toggle="yes">App-SpaM</italic>, a distance-based method that utilizes the concept of spaced words (<xref rid="btad692-B7" ref-type="bibr">Blanke and Morgenstern 2021</xref>). <italic toggle="yes">App-SpaM</italic> has a number of practical advantages: it is among the fastest phylogenetic placement tools and requires the reference sequences to be neither aligned nor assembled. When reference sequences are aligned and assembled, however, <italic toggle="yes">App-SpaM</italic> is usually not the most accurate tool available (<xref rid="btad692-B7" ref-type="bibr">Blanke and Morgenstern 2021</xref>).</p>
    <p>Here, we take further steps to overcome the challenges of phylogenetic placement and introduce two tools that together form the successor of <italic toggle="yes">RAPPAS</italic>. First, we present <italic toggle="yes">IPK</italic> (<italic toggle="yes">Inference of Phylo-K-mers</italic>), a tool for efficient computation of phylo-<italic toggle="yes">k</italic>-mers. <italic toggle="yes">IPK</italic> improves the running times of the phylo-<italic toggle="yes">k</italic>-mer construction step by up to two orders of magnitude. We also introduce <italic toggle="yes">phylo-k-mer filtering—</italic>a method to reduce large phylo-<italic toggle="yes">k</italic>-mer collections with little or no loss in placement accuracy. These developments improve the scalability of computing phylo-<italic toggle="yes">k</italic>-mers to larger phylogenies. Second, we present <italic toggle="yes">EPIK</italic> (<italic toggle="yes">Evolutionary Placement with Informative K-mers</italic>), an optimized parallel implementation of placement with filtered phylo-<italic toggle="yes">k</italic>-mers. <italic toggle="yes">EPIK</italic> substantially outperforms its predecessor. We provide experiments on placement accuracy and speed, showing that <italic toggle="yes">EPIK</italic> can place millions of short queries on a single thread in a matter of minutes or hours. When placing large collections of queries, <italic toggle="yes">EPIK</italic> outperforms the state-of-the-art in placement speed, while remaining highly accurate.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>Let <italic toggle="yes">A</italic> denote a <italic toggle="yes">reference sequence alignment</italic>, and <italic toggle="yes">T</italic> denote a <italic toggle="yes">reference phylogenetic tree</italic> whose leaves are in one-to-one correspondence with the sequences of <italic toggle="yes">A</italic>. Sequences can be either composed of nucleotides or amino acids. Besides <italic toggle="yes">A</italic> and <italic toggle="yes">T</italic>, a collection of <italic toggle="yes">query</italic> sequences is also given. Then, for any query <italic toggle="yes">q</italic>, phylogenetic placement aims to identify the branch from which <italic toggle="yes">q</italic> likely diverged from the rest of the tree. Some placement methods also estimate the precise position of the divergence along the identified branch, and the length of the pendant branch terminating in <italic toggle="yes">q</italic>. Note that the reference tree remains fixed, and the queries are not actually added to the tree; this leaves the evolutionary relationships between queries unresolved. Also, we assume that the query sequence is homologous to parts of the reference sequences. This is an essential prerequisite to most phylogenetic placement methods (<xref rid="btad692-B12" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2022</xref>).</p>
    <p>As in <italic toggle="yes">RAPPAS</italic>, our method splits phylogenetic placement into two stages (see <xref rid="btad692-F1" ref-type="fig">Fig. 1</xref> for an illustration). First, <italic toggle="yes">IPK</italic> preprocesses <italic toggle="yes">A</italic> and <italic toggle="yes">T</italic> to create a <italic toggle="yes">phylo-k-mer database</italic>. This stage does not require any knowledge of query sequences. Second, <italic toggle="yes">EPIK</italic> uses phylo-<italic toggle="yes">k</italic>-mers to place the query sequences in an alignment-free way, based on the matches between the <italic toggle="yes">k</italic>-mers in the query and the phylo-<italic toggle="yes">k</italic>-mers in the database. Note that once we have the phylo-<italic toggle="yes">k</italic>-mer database computed for a given alignment and tree, we can reuse it to place queries as many times as needed.</p>
    <fig position="float" id="btad692-F1">
      <label>Figure 1.</label>
      <caption>
        <p><italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic>. (a) <italic toggle="yes">IPK</italic> takes an alignment of reference sequences and a reference tree as input. The alignment and tree are preprocessed, most notably the tree is extended by adding ghost nodes and ghost branches. Then state probabilities are computed at every ghost node and alignment site. On the basis of this, a phylo-<italic toggle="yes">k</italic>-mer database is constructed. Finally, mutual information values are computed and stored alongside the rest of the phylo-<italic toggle="yes">k</italic>-mer database for later use. (b) <italic toggle="yes">EPIK</italic> takes the phylo-<italic toggle="yes">k</italic>-mer database (with the corresponding reference tree and mutual information values) and query sequences as input. Depending on the way <italic toggle="yes">EPIK</italic> is called, the whole or a part of the phylo-<italic toggle="yes">k</italic>-mer database is loaded in memory. The <italic toggle="yes">k</italic>-mers of every query are searched in the database to place it onto the reference phylogeny. The result is a phylogenetic placement file (.jplace-formatted), one for each input query file.</p>
      </caption>
      <graphic xlink:href="btad692f1" position="float"/>
    </fig>
    <sec>
      <title>2.1 Phylo-<italic toggle="yes">k</italic>-mer inference</title>
      <p>Phylo-<italic toggle="yes">k</italic>-mers can be thought of as <italic toggle="yes">k</italic>-mers equipped with probabilistic information about their possible branches of origin in the reference phylogeny. More precisely, we define a phylo-<italic toggle="yes">k</italic>-mer for a given <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> and fixed <italic toggle="yes">A</italic>, <italic toggle="yes">T</italic> as a tuple <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <italic toggle="yes">y</italic> is a branch of <italic toggle="yes">T</italic>, and <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is a <italic toggle="yes">phylo-k-mer score</italic>. This score is an approximation of the probability of <italic toggle="yes">w</italic> being a substring of an unobserved sequence homologous to those in <italic toggle="yes">A</italic>, that diverged from the rest of <italic toggle="yes">T</italic> somewhere along <italic toggle="yes">y</italic> (<xref rid="btad692-B24" ref-type="bibr">Romashchenko 2021</xref>).</p>
      <p>We compute phylo-<italic toggle="yes">k</italic>-mers in a way that that resembles the one of <italic toggle="yes">RAPPAS</italic> (see <xref rid="btad692-F1" ref-type="fig">Fig. 1a</xref> for an illustration). We assume a given stochastic model of sequence evolution, and that the branch lengths of <italic toggle="yes">T</italic> were estimated by maximum likelihood under this model. We also assume that <italic toggle="yes">T</italic> is rooted. First, we filter the alignment by removing the columns that contain a certain user-defined percentage of gaps. Second, we create an extended tree by adding <italic toggle="yes">ghost nodes</italic> and <italic toggle="yes">ghost branches</italic> to <italic toggle="yes">T</italic>: for every branch <italic toggle="yes">y</italic>, we add a node <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> at the midpoint of <italic toggle="yes">y</italic>, a new leaf <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, and a new branch <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Ghost nodes aim to represent hypothetical ancestral sequences, as well as related sequences that diverged in the past but are not directly represented by the references. (See <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S6</xref> for some additional arguments on the design of ghost nodes.) We set the length of the new branch to the mean length among all paths from <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> to the leaves of <italic toggle="yes">T</italic> that descend from <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>. This value represents our expectation of how evolutionary distant may be the queries that should be placed onto <italic toggle="yes">y</italic>. Notice that since we average over all descending paths from <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, it makes correct rooting an important prerequisite of our method.</p>
      <p>Then we use standard techniques for ancestral sequence reconstruction to compute the posterior probabilities of any state (nucleotide for DNA and amino acid for proteins) at any site (position) of the alignment for a given node of the phylogeny. <italic toggle="yes">IPK</italic> can execute <italic toggle="yes">PhyML</italic> or <italic toggle="yes">RAxML-ng</italic> (<xref rid="btad692-B14" ref-type="bibr">Guindon <italic toggle="yes">et al.</italic> 2010</xref>, <xref rid="btad692-B18" ref-type="bibr">Kozlov <italic toggle="yes">et al.</italic> 2019</xref>) to perform these computations. This step results in a matrix with as many columns as in <italic toggle="yes">A</italic>, describing posterior state probability distributions for every ghost node <italic toggle="yes">u</italic>. Note that assuming statistical independence of states at different sites of the alignment, this step also defines the probability of any <italic toggle="yes">k</italic>-mer at <italic toggle="yes">u</italic> and any <italic toggle="yes">k</italic> consecutive sites of <italic toggle="yes">A</italic>.</p>
      <p>The next step is to find, for any ghost node, all <italic toggle="yes">k</italic>-mers whose probability is greater than a user-defined threshold <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mo>ε</mml:mo></mml:math></inline-formula> for at least one set of <italic toggle="yes">k</italic> consecutive sites in the alignment. For this step, we apply a new divide-and-conquer algorithm instead of the branch-and-bound algorithm used in <italic toggle="yes">RAPPAS</italic>, because the new algorithm is shown to be faster in practice [see <xref rid="btad692-B25" ref-type="bibr">Romashchenko <italic toggle="yes">et al.</italic> (2023)</xref> for detail and analysis].</p>
      <p>For each <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> generated in the above step, we consider a phylo-<italic toggle="yes">k</italic>-mer <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <italic toggle="yes">y</italic> is the branch corresponding to the ghost node where <italic toggle="yes">w</italic> was generated, and <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is set to the maximum probability over all possible choices of <italic toggle="yes">k</italic> consecutive columns in <italic toggle="yes">A</italic>, and over the two ghost nodes corresponding to <italic toggle="yes">y</italic>. Such phylo-<italic toggle="yes">k</italic>-mers can later be retrieved from what we call a <italic toggle="yes">phylo-k-mer database</italic>: a set of <italic toggle="yes">k</italic>-mers mapped to lists of tuples <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> giving scores of <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> for branches <italic toggle="yes">y</italic> such that <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>&gt;</mml:mo><mml:mo>ε</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>Since such databases can reach huge sizes, and because <italic toggle="yes">k</italic>-mers do not contribute equally to placement inference, we designed <italic toggle="yes">phylo-k-mer filtering</italic>, an approach for selecting informative <italic toggle="yes">k</italic>-mers. For every <italic toggle="yes">k</italic>-mer, we compute a filter value indicating how informative for placement the <italic toggle="yes">k</italic>-mer is, and sort <italic toggle="yes">k</italic>-mers by filter value. We propose two algorithms to form the phylo-<italic toggle="yes">k</italic>-mer database: in memory for speed and on disk for low memory usage. We describe both algorithms in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref>.</p>
    </sec>
    <sec>
      <title>2.2 Phylo-<italic toggle="yes">k</italic>-mer filtering</title>
      <p>One of the main novelties of <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic> is the possibility of filtering phylo-<italic toggle="yes">k</italic>-mers. This means selecting the <italic toggle="yes">k</italic>-mers that are the most informative for phylogenetic placement according to a measure derived from information theory. We view phylo-<italic toggle="yes">k</italic>-mer-based phylogenetic placement as a classification problem, where (i) the <italic toggle="yes">observations</italic> to classify are the queries, (ii) the <italic toggle="yes">classes</italic> that they must be assigned to are the branches of the reference tree, and, finally, (iii) the <italic toggle="yes">features</italic> used for the classification of a query are all the possible <italic toggle="yes">k</italic>-mers.</p>
      <p>Similarly to feature selection in text classification (<xref rid="btad692-B23" ref-type="bibr">McCallum and Nigam 1998</xref>), we wish to retain the features (<italic toggle="yes">k</italic>-mers) that maximize the <italic toggle="yes">mutual information</italic> (MI) between the class (branch) variable <italic toggle="yes">Y</italic> and the variable <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> indicating whether the <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> is present in the query (i.e. <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> or 0, depending on whether <italic toggle="yes">w</italic> is present or absent, respectively).</p>
      <p>In information theory, the mutual information between these random variables, denoted <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>;</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, is defined as the expected gain of information about <italic toggle="yes">Y</italic> (i.e. reduction in <italic toggle="yes">Y</italic>’s entropy) resulting from observing <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref rid="btad692-B9" ref-type="bibr">Cover and Thomas 2006</xref>):
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>;</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mo> </mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula></p>
      <p>Since <italic toggle="yes">EPIK</italic> only uses the presence of <italic toggle="yes">k</italic>-mers (and not their absence) to determine the placement of a query (see Section 2.3), the filtering is based on the following modification of the above formula, which only keeps the term with <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>:
<disp-formula id="E2"><label>(1)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="E3"><label>(2)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:mo>=</mml:mo><mml:mi>c</mml:mi><mml:mo>⋅</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo><mml:mo>+</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>y</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>Here, <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> is the total score of <italic toggle="yes">k</italic>-mer <italic toggle="yes">w</italic> [i.e. <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>y</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>], <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the set of tree branches, and <italic toggle="yes">c</italic> is independent of <italic toggle="yes">w</italic> and thus does not play any role in the filtering of <italic toggle="yes">k</italic>-mers. In <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1</xref>, we provide more detail about this formula, including the derivation of <xref rid="E3" ref-type="disp-formula">(2)</xref> from <xref rid="E2" ref-type="disp-formula">(1)</xref> and an alternative explanation of why we only keep the term with <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> in <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>;</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Intuitively, selecting <italic toggle="yes">k</italic>-mers maximizing <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> favors the ones that both are probable and cause a greater gain of information about the placement branch when observed in the query. A thorough analysis leading to this formula is given by <xref rid="btad692-B24" ref-type="bibr">Romashchenko (2021)</xref>.</p>
      <p>We filter phylo-<italic toggle="yes">k</italic>-mers as follows. First, we compute <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for all computed <italic toggle="yes">k</italic>-mers. Second, we sort <italic toggle="yes">k</italic>-mers in descending order of <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and serialize them. We implement this procedure differently for the in-memory and on-disk algorithms; see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref> for detail. As a result, the database on disk is represented so that more informative <italic toggle="yes">k</italic>-mers are closer to the beginning of the database file. For placement, we deserialize <italic toggle="yes">k</italic>-mers in their order until we reach a certain proportion of the entire database’s size or the memory limit set by the user.</p>
    </sec>
    <sec>
      <title>2.3 Placement step</title>
      <p>On the basis of a precomputed phylo-<italic toggle="yes">k</italic>-mer database, <italic toggle="yes">EPIK</italic> places query sequences in the following fashion (<xref rid="btad692-F1" ref-type="fig">Fig. 1b</xref>): First, it loads the entirety or part of the database into memory by applying <italic toggle="yes">k</italic>-mer filtering. This consists in loading <italic toggle="yes">k</italic>-mers with their scores until the given memory limit is reached or the complete database is loaded. At the same time, <italic toggle="yes">EPIK</italic> populates a hashmap from <italic toggle="yes">k</italic>-mers to lists of associated tuples of branches and phylo-<italic toggle="yes">k</italic>-mer scores. Since <italic toggle="yes">k</italic>-mers are stored ordered by <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, loading time is linear in the size of loaded information. Then each query is placed independently by searching its constituent <italic toggle="yes">k</italic>-mers in the database. For a given query <italic toggle="yes">q</italic>, a log-likelihood score of placing <italic toggle="yes">q</italic> onto branch <italic toggle="yes">y</italic> is computed as follows:
<disp-formula id="E4"><label>(3)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>k</mml:mi></mml:mfrac></mml:mrow><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>q</mml:mi><mml:mo>|</mml:mo><mml:mo>−</mml:mo><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow><mml:mo>{</mml:mo><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mo>ε</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>}</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>q</mml:mi><mml:mo>|</mml:mo><mml:mo>−</mml:mo><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> are all the <italic toggle="yes">k</italic>-mers in <italic toggle="yes">q</italic>. This formula assumes that the branches that do not appear in any tuple associated to a <italic toggle="yes">k</italic>-mer have a phylo-<italic toggle="yes">k</italic>-mer score <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mo>ε</mml:mo></mml:math></inline-formula>. Also, note that we intend <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> to approximate the log-probability of sequence <italic toggle="yes">q</italic> diverging from branch <italic toggle="yes">y</italic>. Therefore, the term <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula> corrects for the fact that the sum above includes the log-probability of most query characters <italic toggle="yes">k</italic> times. For each query, we report a number of top-scored branches together with (approximate) likelihood weight ratios, computed as follows (where <italic toggle="yes">b</italic> is the base of the logarithm):
<disp-formula id="E5"><mml:math id="M5" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">LWR</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mi>x</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec>
      <title>2.4 Placement accuracy evaluation</title>
      <p>To evaluate placement accuracy, we used <italic toggle="yes">PEWO</italic> (<italic toggle="yes">Placement Evaluation Workflows</italic>), a framework recently developed by <xref rid="btad692-B20" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> (2021)</xref>. We evaluated the accuracy of <italic toggle="yes">EPIK</italic>’s placement with and without filtering, as well as the accuracy of the other state-of-the-art phylogenetic placement methods. We used the pruning-based accuracy procedure (<italic toggle="yes">PAC</italic>) of <italic toggle="yes">PEWO</italic> that computes the accuracy of phylogenetic placement as follows. First, given a reference alignment and a reference tree, it randomly selects a subtree to remove (“prune”) from the original tree. Second, it extracts query reads from the sequences associated with the leaves removed. Then, query reads are placed on the remaining tree. Finally, for every placed query read, it computes the <italic toggle="yes">node distance</italic> between the observed placement and the expected placement. Node distance is defined as the number of tree nodes on the path between the branch reported as the query’s top-scoring placement (the observed placement) and the branch that was created as a result of pruning the subtree (the expected placement). We used node distance as it is the most commonly used way of evaluating phylogenetic placement accuracy (<xref rid="btad692-B12" ref-type="bibr">Czech <italic toggle="yes">et al.</italic> 2022</xref>). Also, <italic toggle="yes">APPLES2</italic> and <italic toggle="yes">App-SpaM</italic> do not output multiple placements along with relative confidence scores and thus do not support evaluating <italic toggle="yes">expected</italic> node distance.</p>
      <p>We compared the accuracy of <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic> against the latest versions of state-of-the-art phylogenetic placement tools: <italic toggle="yes">pplacer</italic>, <italic toggle="yes">EPA-ng</italic>, <italic toggle="yes">App-SpaM</italic>, <italic toggle="yes">APPLES2</italic>, and <italic toggle="yes">RAPPAS</italic> (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S5</xref> for details). We used <italic toggle="yes">PhyML</italic> for ancestral reconstruction required by <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">IPK</italic>. We did not include <italic toggle="yes">EPA</italic> in the evaluation since it is the predecessor of <italic toggle="yes">EPA-ng</italic> and because <italic toggle="yes">EPA-ng</italic> supports <italic toggle="yes">EPA</italic>’s placement algorithm as one of the options. We ran these tools for 50 prunings (prunings and queries are identical for all tools). For each pruning, we report the mean node distance across several 150-bp-long queries generated for that pruning. The number of generated queries per pruning is variable, as it depends on the number of sequences in the pruned subtree, and on the length of those sequences. We ran all tools with their default parameters, except <italic toggle="yes">RAPPAS</italic>, for which we used the defaults of <italic toggle="yes">EPIK</italic>: <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> for DNA and <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:math></inline-formula> for proteins instead of the <italic toggle="yes">RAPPAS</italic>’ default <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula>. Generally, using higher values of <italic toggle="yes">k</italic>, we can expect increased placement accuracy; we used these values to facilitate comparison with <italic toggle="yes">EPIK</italic>. We ran <italic toggle="yes">EPA-ng</italic>, <italic toggle="yes">pplacer</italic>, and <italic toggle="yes">APPLES2</italic> using query-reference alignments constructed with <italic toggle="yes">HMMER</italic> in the way it is implemented by default in <italic toggle="yes">PEWO</italic>.</p>
      <p>To test the placement accuracy of <italic toggle="yes">EPIK</italic>, we used seven real-world datasets of amino acid and nucleotide sequences, where the number of reference sequences ranged from 140 to 3748. All of these datasets have been previously used as benchmarks for the accuracy of phylogenetic placement methods. Three datasets consist of sequences for widely used metabarcoding markers: <italic toggle="yes">D218</italic>, <italic toggle="yes">D500</italic> (<xref rid="btad692-B6" ref-type="bibr">Berger <italic toggle="yes">et al.</italic> 2011</xref>), and <italic toggle="yes">D652</italic> (<xref rid="btad692-B29" ref-type="bibr">Srinivasan <italic toggle="yes">et al.</italic> 2012</xref>, <xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2019</xref>). Three others contain full-length viral sequences: <italic toggle="yes">D140</italic> (<xref rid="btad692-B6" ref-type="bibr">Berger <italic toggle="yes">et al.</italic> 2011</xref>), <italic toggle="yes">HCV</italic> (<xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2019</xref>), and <italic toggle="yes">HIV</italic> (<xref rid="btad692-B27" ref-type="bibr">Schultz <italic toggle="yes">et al.</italic> 2009</xref>). <xref rid="btad692-T1" ref-type="table">Table 1</xref> gives a short description of these datasets (including two other datasets, <italic toggle="yes">neotrop</italic> and <italic toggle="yes">tara</italic>, that were used to test efficiency).</p>
      <table-wrap position="float" id="btad692-T1">
        <label>Table 1.</label>
        <caption>
          <p>Datasets used to evaluate the accuracy or speed of phylogenetic placement.<xref rid="tblfn1" ref-type="table-fn"><sup>a</sup></xref></p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Dataset</th>
              <th rowspan="1" colspan="1">Type</th>
              <th rowspan="1" colspan="1">Locus</th>
              <th rowspan="1" colspan="1">No. of taxa</th>
              <th rowspan="1" colspan="1">
                <bold>Length (</bold>
                <inline-formula id="IE35">
                  <mml:math id="IM35" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>×</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mrow>
                              <mml:mn>10</mml:mn>
                            </mml:mrow>
                          </mml:mrow>
                          <mml:mn>3</mml:mn>
                        </mml:msup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
                <bold>)</bold>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D218</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Bacterial 16S rRNA</td>
              <td rowspan="1" colspan="1">218</td>
              <td rowspan="1" colspan="1">1.5</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D500</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Chloroplast rbcL gene</td>
              <td rowspan="1" colspan="1">500</td>
              <td rowspan="1" colspan="1">1.4</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D652</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Bacterial 16S rRNA</td>
              <td rowspan="1" colspan="1">652</td>
              <td rowspan="1" colspan="1">1.3</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">neotrop</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Eukaryote 18S rRNA</td>
              <td rowspan="1" colspan="1">512</td>
              <td rowspan="1" colspan="1">1.8</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">tara</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Bacterial 16S rRNA</td>
              <td rowspan="1" colspan="1">3748</td>
              <td rowspan="1" colspan="1">1.4</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">HCV</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Complete genome</td>
              <td rowspan="1" colspan="1">155</td>
              <td rowspan="1" colspan="1">9.4</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">HIV</italic>
              </td>
              <td rowspan="1" colspan="1">DNA</td>
              <td rowspan="1" colspan="1">Complete genome</td>
              <td rowspan="1" colspan="1">881</td>
              <td rowspan="1" colspan="1">9.0</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D140</italic>
              </td>
              <td rowspan="1" colspan="1">AA</td>
              <td rowspan="1" colspan="1">Genome-scale</td>
              <td rowspan="1" colspan="1">140</td>
              <td rowspan="1" colspan="1">1.0</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn1">
            <label>a</label>
            <p>The “Length” column contains the average length of the sequences, measured in units corresponding to the data type (nucleotides or amino acids).</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec>
      <title>2.5 Placement accuracy with filtering</title>
      <p>When we remove phylo-<italic toggle="yes">k</italic>-mers from the database, we expect placement accuracy to decrease. We aimed to answer two questions: how quickly does the accuracy decay with increased filtering, and how much can we filter out without hurting placement accuracy significantly? To investigate this, we performed filtering using a parameter <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>∈</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> indicating the fraction of the original database to keep (if <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, no filtering was performed). That is, if <inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">D</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula> denotes the size of the entire database <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mi mathvariant="script">D</mml:mi></mml:math></inline-formula>, we selected <italic toggle="yes">k</italic>-mers until it was impossible to add the next <italic toggle="yes">k</italic>-mer and its associated tuples, without exceeding the database size of <inline-formula id="IE40"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>⋅</mml:mo><mml:mo>|</mml:mo><mml:mi mathvariant="script">D</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>We used pruning-based accuracy evaluation in the following manner. First, for a given set of input data and a range of values of <inline-formula id="IE41"><mml:math id="IM41" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>∈</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>, we computed phylo-<italic toggle="yes">k</italic>-mer databases applying the corresponding filtering ratios <inline-formula id="IE42"><mml:math id="IM42" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>. Then, we evaluated the mean node distance for 30 prunings for every produced filtered database. We carried out this procedure for both the MI filter and a random filter. The random filter selects <italic toggle="yes">k</italic>-mers in random order until a fraction <inline-formula id="IE43"><mml:math id="IM43" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula> of the original database is kept. As input data, we used the same datasets as in the placement accuracy experiments described in Section 2.4.</p>
    </sec>
    <sec>
      <title>2.6 Running time and memory consumption</title>
      <p>We compare the running time and memory consumption of <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic> against other tools using the <italic toggle="yes">RES</italic> workflow of <italic toggle="yes">PEWO</italic> (<xref rid="btad692-B20" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2021</xref>). We used datasets with different tree sizes and alignment lengths: <italic toggle="yes">D652</italic>, <italic toggle="yes">neotrop</italic> (<xref rid="btad692-B21" ref-type="bibr">Mahé <italic toggle="yes">et al.</italic> 2017</xref>), <italic toggle="yes">tara</italic> (<xref rid="btad692-B30" ref-type="bibr">Sunagawa <italic toggle="yes">et al.</italic> 2015</xref>), and <italic toggle="yes">HCV</italic>. For <italic toggle="yes">D652</italic> and <italic toggle="yes">tara</italic>, we used ten million of 100–150 bp real-world amplicon reads of bacterial 16S rRNA gene retrieved from the Earth Microbiome Project (<xref rid="btad692-B31" ref-type="bibr">Thompson <italic toggle="yes">et al.</italic> 2017</xref>, <xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> 2019</xref>). For <italic toggle="yes">HCV</italic>, we used ten million queries of 150 bp simulated for the study of <xref rid="btad692-B19" ref-type="bibr">Linard <italic toggle="yes">et al.</italic> (2019)</xref>. For <italic toggle="yes">neotrop</italic>, we used ten million real-world 18S rRNA reads of various lengths [both the reference and the queries were retrieved from the study of <xref rid="btad692-B21" ref-type="bibr">Mahé <italic toggle="yes">et al.</italic> (2017)</xref>].</p>
      <p>We carried out experiments on a computer equipped with Intel(R) Xeon(R) W-2133 CPU @ 3.60 GHz/8.25 MB Cache/62 GB RAM and an HDD with SATA 3.0 and 64 MB cache. We ran all tools in a single-thread mode (not all of them support parallel execution). For the running time, we consider the total wall clock time; for the RAM consumption, we consider the peak maximum resident set size (RSS). Measurements were averaged over three repeats for every stage of computation of every program.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Implementation</title>
    <sec>
      <title>3.1 <italic toggle="yes">IPK</italic>: a standalone tool for computing phylo-<italic toggle="yes">k</italic>-mers</title>
      <p>We introduce <italic toggle="yes">IPK</italic>, a new tool for computing phylo-<italic toggle="yes">k</italic>-mers. A few essential differences set it apart from <italic toggle="yes">RAPPAS</italic>’s phylo-<italic toggle="yes">k</italic>-mer computation stage. First, we made <italic toggle="yes">IPK</italic> a standalone tool to ease the development of new applications of phylo-<italic toggle="yes">k</italic>-mers. <italic toggle="yes">IPK</italic> computes a database of phylo-<italic toggle="yes">k</italic>-mers for any given reference <italic toggle="yes">A</italic> and <italic toggle="yes">T</italic> and provides transparent access to this database to query <italic toggle="yes">k</italic>-mers. Applications such as <italic toggle="yes">EPIK</italic> and <italic toggle="yes">SHERPAS</italic> (<xref rid="btad692-B26" ref-type="bibr">Scholz <italic toggle="yes">et al.</italic> 2020</xref>) can use <italic toggle="yes">IPK</italic> as a black box through the provided API. Second, it applies a new, faster algorithm for phylo-<italic toggle="yes">k</italic>-mer computation (<xref rid="btad692-B25" ref-type="bibr">Romashchenko <italic toggle="yes">et al.</italic> 2023</xref>). When compared to <italic toggle="yes">RAPPAS</italic> for the default value <inline-formula id="IE44"><mml:math id="IM44" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>, <italic toggle="yes">IPK</italic> improves running times by more than two orders of magnitude (see Section 4.4 for experimental results). Third, <italic toggle="yes">IPK</italic> computes mutual information values for phylo-<italic toggle="yes">k</italic>-mers that are later used by <italic toggle="yes">EPIK</italic> for phylo-<italic toggle="yes">k</italic>-mer filtering. By default, <italic toggle="yes">IPK</italic> creates the database in memory and then stores it on disk. Alternatively, it can create the database directly on disk to reduce RAM consumption at the cost of longer execution (see Section 4.4 and <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref>). This allows for creating databases of sizes that exceed the amount of RAM available, which was not possible with <italic toggle="yes">RAPPAS</italic>.</p>
    </sec>
    <sec>
      <title>3.2 <italic toggle="yes">EPIK</italic>: faster phylo-<italic toggle="yes">k</italic>-mer-based phylogenetic placement</title>
      <p>We also developed <italic toggle="yes">EPIK</italic>, a new tool for phylogenetic placement with phylo-<italic toggle="yes">k</italic>-mers. It implements phylo-<italic toggle="yes">k</italic>-mer filtering, i.e. can place using only the most informative part of the phylo-<italic toggle="yes">k</italic>-mer database (defined by a proportion of the database size or a certain fixed size in bytes). This allows for placement even if the database is larger than the amount of RAM available. Also, <italic toggle="yes">EPIK</italic> can be run in parallel in shared memory for higher speed (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4</xref> for detail and results on parallel performance).</p>
      <p>Even when running in a single thread, <italic toggle="yes">EPIK</italic> achieves up to one order of magnitude improvement in placement speed over <italic toggle="yes">RAPPAS</italic> because of more efficient implementation (see Section 4.3 for experimental results). For an example of how to run <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic>, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S7</xref>.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Results</title>
    <sec>
      <title>4.1 Experiments on placement accuracy</title>
      <p>Here, we assess the placement accuracy of <italic toggle="yes">EPIK</italic> (with unfiltered databases) compared to the state-of-the-art on real-world datasets. <xref rid="btad692-F2" ref-type="fig">Figure 2</xref> shows the distributions of the mean node distance of placements per pruning (lower values are better). For two out of four datasets based on short metabarcoding markers (<italic toggle="yes">D500</italic>, <italic toggle="yes">D652</italic>, see <xref rid="btad692-F2" ref-type="fig">Fig. 2a</xref>), <italic toggle="yes">EPIK</italic> shows better accuracy compared to other state-of-the-art tools. These results are to some extent consistent with the ones of <xref rid="btad692-B7" ref-type="bibr">Blanke and Morgenstern (2021)</xref>, where <italic toggle="yes">RAPPAS</italic> using <inline-formula id="IE45"><mml:math id="IM45" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula> showed the best accuracy on four out of six 16S datasets.</p>
      <fig position="float" id="btad692-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Results on phylogenetic placement accuracy of different tools. One point of the distribution represents placements of multiple queries placed to a particular pruned tree. The <italic toggle="yes">y</italic>-axis corresponds to the mean node distances for such groups of queries and their placements. (a) Metabarcoding markers datasets. (b) Full-genome viral datasets consisting of nucleotide sequences (<italic toggle="yes">HCV</italic>, <italic toggle="yes">HIV</italic>) and amino acid sequences (<italic toggle="yes">D140</italic>).</p>
        </caption>
        <graphic xlink:href="btad692f2" position="float"/>
      </fig>
      <p>For the viral datasets (<xref rid="btad692-F2" ref-type="fig">Fig. 2b</xref>), <italic toggle="yes">EPIK</italic> was comparable to the best performing methods (<italic toggle="yes">EPA-ng</italic> and <italic toggle="yes">pplacer</italic>) for <italic toggle="yes">HCV</italic> and <italic toggle="yes">D140</italic>, yet was inferior to <italic toggle="yes">App-SpaM</italic> for <italic toggle="yes">HIV</italic>. <italic toggle="yes">App-SpaM</italic> cannot be run for <italic toggle="yes">D140</italic> since it does not support protein sequences. Also, <italic toggle="yes">RAPPAS</italic> could not build phylo-<italic toggle="yes">k</italic>-mer databases for <italic toggle="yes">HIV</italic>, since it exceeded the 32 GB RAM limit.</p>
      <p><xref rid="btad692-F2" ref-type="fig">Figure 2</xref> also shows that, in general, the tools that are based on the same methodology tend to have very similar performance. For example, <italic toggle="yes">EPA-ng</italic> and <italic toggle="yes">pplacer</italic> tend to have very similar node distance distributions; also, the distributions for <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">EPIK</italic> are matching almost perfectly. However, there exist slight differences between <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">EPIK</italic> (not visible on <xref rid="btad692-F2" ref-type="fig">Fig. 2</xref>). This is due to floating-point rounding that <italic toggle="yes">IPK</italic>+<italic toggle="yes">EPIK</italic> handle better.</p>
      <p>Overall, <italic toggle="yes">EPIK</italic> showed similar or better accuracy in six out of seven experiments compared to the state-of-the-art software.</p>
    </sec>
    <sec>
      <title>4.2 Experiments on filtering performance</title>
      <p><xref rid="btad692-F3" ref-type="fig">Figure 3</xref> shows the placement accuracy results in the experiments with filtered databases. We compare the mean node distance (y-axis) obtained for different degrees of filtration (i.e. different values of <inline-formula id="IE46"><mml:math id="IM46" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, x-axis) against the mean node distance for <inline-formula id="IE47"><mml:math id="IM47" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (complete database) for the same dataset. We also compare the accuracy obtained for two filters—the mutual information (MI) filter and the random filter—obtained with the same value of <inline-formula id="IE48"><mml:math id="IM48" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>.</p>
      <fig position="float" id="btad692-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Results on <italic toggle="yes">k</italic>-mer filtering for the mutual information filter and random selection of <italic toggle="yes">k</italic>-mers. The <italic toggle="yes">x</italic>-axis corresponds to the ratio of filtered versus unfiltered database size. The <italic toggle="yes">y</italic>-axis corresponds to the mean node distances of placements (averaged over 30 prunings) obtained with filtered databases. Vertical bars represent standard errors of the means. (a) Results for metabarcoding markers. (b) Results for viral genomes.</p>
        </caption>
        <graphic xlink:href="btad692f3" position="float"/>
      </fig>
      <p>First, note that for all datasets and all values of <inline-formula id="IE49"><mml:math id="IM49" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, MI filtering showed better results than the baseline (always lower node distance than for random filtering). For <italic toggle="yes">D218</italic> (see <xref rid="btad692-F3" ref-type="fig">Fig. 3a</xref>), the MI filter decreased the average placement accuracy by <inline-formula id="IE50"><mml:math id="IM50" display="inline" overflow="scroll"><mml:mrow><mml:mn>4.4</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> while keeping only <inline-formula id="IE51"><mml:math id="IM51" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula> of the information compared to the complete database (from 4.65 for <inline-formula id="IE52"><mml:math id="IM52" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> to 4.85 for <inline-formula id="IE53"><mml:math id="IM53" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>). For random filtering, the accuracy loss was <inline-formula id="IE54"><mml:math id="IM54" display="inline" overflow="scroll"><mml:mrow><mml:mn>74.8</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> (from 4.65 to 8.12). For <italic toggle="yes">D500</italic> and <inline-formula id="IE55"><mml:math id="IM55" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>, MI filtering reduced the accuracy by <inline-formula id="IE56"><mml:math id="IM56" display="inline" overflow="scroll"><mml:mrow><mml:mn>5.7</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> versus <inline-formula id="IE57"><mml:math id="IM57" display="inline" overflow="scroll"><mml:mrow><mml:mn>132</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for random filtering. For <italic toggle="yes">D652</italic> and the same filtration ratio, the average accuracy worsened by <inline-formula id="IE58"><mml:math id="IM58" display="inline" overflow="scroll"><mml:mrow><mml:mn>6.7</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE59"><mml:math id="IM59" display="inline" overflow="scroll"><mml:mrow><mml:mn>66.8</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for MI filtering and the baseline, respectively.</p>
      <p>For viral datasets (<xref rid="btad692-F3" ref-type="fig">Fig. 3b</xref>), <italic toggle="yes">k</italic>-mer filtering had a larger impact on accuracy. For <italic toggle="yes">D140</italic>, keeping <inline-formula id="IE60"><mml:math id="IM60" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula> of the database decreased the accuracy by <inline-formula id="IE61"><mml:math id="IM61" display="inline" overflow="scroll"><mml:mrow><mml:mn>86</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE62"><mml:math id="IM62" display="inline" overflow="scroll"><mml:mrow><mml:mn>190</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for MI and the baseline, respectively. For <italic toggle="yes">HCV</italic> and the same <inline-formula id="IE63"><mml:math id="IM63" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>, the accuracy change was <inline-formula id="IE64"><mml:math id="IM64" display="inline" overflow="scroll"><mml:mrow><mml:mn>83</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE65"><mml:math id="IM65" display="inline" overflow="scroll"><mml:mrow><mml:mn>132</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula>; still, the drop in accuracy was just <inline-formula id="IE66"><mml:math id="IM66" display="inline" overflow="scroll"><mml:mrow><mml:mn>3.2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> while halving the database using the MI filter (<inline-formula id="IE67"><mml:math id="IM67" display="inline" overflow="scroll"><mml:mrow><mml:mn>9.6</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for the baseline). For <italic toggle="yes">HIV</italic> and <inline-formula id="IE68"><mml:math id="IM68" display="inline" overflow="scroll"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>, MI filtering decreased the average accuracy by <inline-formula id="IE69"><mml:math id="IM69" display="inline" overflow="scroll"><mml:mrow><mml:mn>7.1</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> (<inline-formula id="IE70"><mml:math id="IM70" display="inline" overflow="scroll"><mml:mrow><mml:mn>37.2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> for the baseline). Note that results for the <italic toggle="yes">D140</italic> dataset are difficult to compare to those for other viral datasets, because of the different sequence type and length of <italic toggle="yes">k</italic>-mers.</p>
      <p>Note that <xref rid="btad692-F3" ref-type="fig">Fig. 3</xref> gives only means and standard errors for every node distance distribution for fixed <inline-formula id="IE71"><mml:math id="IM71" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>. <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S4</xref> gives a more detailed picture of the distributions. Overall, the results suggest that <italic toggle="yes">k</italic>-mer filtering can significantly reduce the phylo-<italic toggle="yes">k</italic>-mer database size with some (often negligible) decrease in placement accuracy.</p>
    </sec>
    <sec>
      <title>4.3 Running time: placement</title>
      <p>Here, we evaluate the scalability of the state-of-the-art tools and <italic toggle="yes">EPIK</italic> in the number of query sequences to place. <xref rid="btad692-F4" ref-type="fig">Figure 4</xref> presents measurements of wall-clock time required for placement of increasing numbers of queries. Importantly, the running times do not include any preprocessing needed by these methods. For <italic toggle="yes">EPA-ng</italic> and <italic toggle="yes">APPLES2</italic> by “preprocessing” we mean the alignment of queries to the reference alignment, while for <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">EPIK</italic> we mean the construction of the phylo-<italic toggle="yes">k</italic>-mer database. <italic toggle="yes">App-SpaM</italic> does not require any preprocessing. We present some results on preprocessing times in the next section. We stopped any jobs that required more than 32 GB of RAM.</p>
      <fig position="float" id="btad692-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Running time of different phylogenetic placement tools on four reference datasets. Preprocessing time is not counted for alignment-based methods (dotted lines) nor for alignment-free ones (solid lines). Measurements are averaged over three runs.</p>
        </caption>
        <graphic xlink:href="btad692f4" position="float"/>
      </fig>
      <p><italic toggle="yes">EPIK</italic> showed better placement time than <italic toggle="yes">RAPPAS</italic> in all experiments. The running time improvement over <italic toggle="yes">RAPPAS</italic> varied among datasets and the number of queries placed. For example, while placing ten million queries to <italic toggle="yes">D652</italic>, <italic toggle="yes">EPIK</italic> was around 14 times faster (29 min versus 6 h 49 min); for <italic toggle="yes">neotrop</italic> and ten million queries, it was 18 times faster (1 h 34 min versus 28 h). The lower relative performance of <italic toggle="yes">EPIK</italic> for fewer queries is due to the overhead required by loading the phylo-<italic toggle="yes">k</italic>-mer database in memory that is constant and does not depend on the number of queries placed. We also note that the loaded database size greatly affects the memory consumption of <italic toggle="yes">EPIK</italic> (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S3</xref> for measurements); this, however, can be reduced with phylo-<italic toggle="yes">k</italic>-mer filtering.</p>
      <p>In conclusion, alignment-free approaches showed consistently better running times than alignment-based ones, even if we exclude the time to align query sequences. <italic toggle="yes">EPIK</italic> showed the best running time against all tools on all datasets tested while placing a hundred thousand or more queries.</p>
    </sec>
    <sec>
      <title>4.4 Running time: phylo-<italic toggle="yes">k</italic>-mer computation</title>
      <p><xref rid="btad692-T2" ref-type="table">Table 2</xref> gives the averaged measurements of total time spent by <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">IPK</italic> to compute databases of phylo-<italic toggle="yes">k</italic>-mers for <inline-formula id="IE72"><mml:math id="IM72" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>, both using the in-memory and on-disk algorithms. For comparison, it also provides the time needed to align a million queries used in the experiments described in Section 4.3. For all datasets, <italic toggle="yes">IPK</italic> (with the default in-memory algorithm) was more than one hundred times faster than <italic toggle="yes">RAPPAS</italic>: the speed-up was 147×, 124×, 239×, and 120× for <italic toggle="yes">D652</italic>, <italic toggle="yes">neotrop</italic>, <italic toggle="yes">HCV</italic>, and <italic toggle="yes">tara</italic>, respectively. Also, <italic toggle="yes">IPK</italic> clearly outperforms <italic toggle="yes">RAPPAS</italic> in phylo-<italic toggle="yes">k</italic>-mer computation for other <italic toggle="yes">k</italic>-mer lengths (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S5</xref>). The speed-up of <italic toggle="yes">IPK</italic> over <italic toggle="yes">RAPPAS</italic> increases with the value of <italic toggle="yes">k</italic>. Importantly, it was significantly faster to preprocess the reference data with <italic toggle="yes">IPK</italic> than to align a million query sequences for all datasets. This was not the case for <italic toggle="yes">RAPPAS</italic>.</p>
      <table-wrap position="float" id="btad692-T2">
        <label>Table 2.</label>
        <caption>
          <p>Preprocessing times on four reference datasets.<xref rid="tblfn2" ref-type="table-fn"><sup>a</sup></xref></p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Dataset</th>
              <th rowspan="1" colspan="1">HMMER(1M)</th>
              <th rowspan="1" colspan="1">RAPPAS</th>
              <th rowspan="1" colspan="1">IPK</th>
              <th rowspan="1" colspan="1">IPK (on disk)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">D652</italic>
              </td>
              <td rowspan="1" colspan="1">2 h 21 min</td>
              <td rowspan="1" colspan="1">11 h 26 min</td>
              <td rowspan="1" colspan="1">4 min 40 s</td>
              <td rowspan="1" colspan="1">6 min 46 s</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">neotrop</italic>
              </td>
              <td rowspan="1" colspan="1">10 h 00 min</td>
              <td rowspan="1" colspan="1">18 h 32 min</td>
              <td rowspan="1" colspan="1">8 min 59 s</td>
              <td rowspan="1" colspan="1">11 min 23 s</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">tara</italic>
              </td>
              <td rowspan="1" colspan="1">2 h 09 min</td>
              <td rowspan="1" colspan="1">62 h 59 min</td>
              <td rowspan="1" colspan="1">30 min 56 s</td>
              <td rowspan="1" colspan="1">46 min 10 s</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic toggle="yes">HCV</italic>
              </td>
              <td rowspan="1" colspan="1">36 h 58 min</td>
              <td rowspan="1" colspan="1">15 h 22 min</td>
              <td rowspan="1" colspan="1">3 min 38 s</td>
              <td rowspan="1" colspan="1">4 min 45 s</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn2">
            <label>a</label>
            <p>Preprocessing consists in computing phylo-<italic toggle="yes">k</italic>-mer databases for <italic toggle="yes">RAPPAS</italic> and <italic toggle="yes">IPK</italic>, or aligning query sequences within the reference alignment for alignment-based tools (<italic toggle="yes">EPA-ng</italic>, <italic toggle="yes">APPLES2</italic>) using <italic toggle="yes">HMMER</italic>. For the latter, the running time of aligning one million query reads is shown. Measurements are averaged over three runs.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>As for the on-disk algorithm, it showed longer running times than the default in-memory algorithm. Importantly, on-disk processing allowed for a significant reduction in RAM usage. For instance, on-disk <italic toggle="yes">IPK</italic> processed <italic toggle="yes">tara</italic> using 1.6 GB of RAM instead of 30 GB in the in-memory mode, resulting in a database of size 21 GB on disk (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S2</xref> for additional measurements).</p>
    </sec>
  </sec>
  <sec>
    <title>5 Discussion</title>
    <p>We propose a new two-step solution for alignment-free phylogenetic placement implemented as two modular programs: <italic toggle="yes">IPK</italic> and <italic toggle="yes">EPIK</italic>. First, <italic toggle="yes">IPK</italic> computes a phylo-<italic toggle="yes">k</italic>-mer database from input alignment and phylogeny of reference sequences, then <italic toggle="yes">EPIK</italic> reuses this database to place the query sequences on the phylogeny. The combination <italic toggle="yes">IPK</italic>+<italic toggle="yes">EPIK</italic> follows the strategy used in <italic toggle="yes">RAPPAS</italic> but outperforms it in running time, memory usage, scalability, and introduces significant novelties.</p>
    <p>The new algorithm implemented in <italic toggle="yes">IPK</italic> provides dramatic speed improvements: for instance, the <italic toggle="yes">tara</italic> dataset with 3748 species and 1.4 kb alignment, is now preprocessed in minutes instead of days (cf. <xref rid="btad692-T2" ref-type="table">Table 2</xref>). This allowed us to increase the default value of <italic toggle="yes">k</italic> (from <inline-formula id="IE73"><mml:math id="IM73" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula> for DNA in <italic toggle="yes">RAPPAS</italic> to <inline-formula id="IE74"><mml:math id="IM74" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>), which is a key parameter. Indeed, using longer <italic toggle="yes">k</italic>-mers results in nondecreasing accuracy (<xref rid="btad692-B24" ref-type="bibr">Romashchenko 2021</xref>). Second, the gain in speed permits to process instances with larger number of species, and hence larger reference trees, which were problematic for <italic toggle="yes">RAPPAS</italic>. Last, <italic toggle="yes">IPK</italic> offers a second computation mode in which the database is computed on disk, allowing users to adapt memory usage to their own resources.</p>
    <p>Even if computed on disk, a phylo-<italic toggle="yes">k</italic>-mer database can be large, and thus lead <italic toggle="yes">EPIK</italic> to exhaust memory during placement. However, our filtering experiments show that phylo-<italic toggle="yes">k</italic>-mers are not equally informative for placement. We introduce a novel approach to compute the informativeness of each <italic toggle="yes">k</italic>-mer, and <italic toggle="yes">IPK</italic> sorts the database according to this value. Then <italic toggle="yes">EPIK</italic> can filter the database and load only the most informative part that fits into memory. Accuracy experiments with filtered databases showed that, quite often, a great number of <italic toggle="yes">k</italic>-mers (and associated scores) can be safely excluded. For example, we could reduce the database sizes by a factor of 16 with a minor loss in placement accuracy for datasets of metabarcoding markers, and at least by a factor of 4 for datasets of complete viral genomes.</p>
    <p>Let us point out two limitations of <italic toggle="yes">IPK</italic>+<italic toggle="yes">EPIK</italic>. First, they are currently not suited for metagenomic applications that require large reference sequences, like large eukaryotic genomes. For these data, our approach may require using larger values of <italic toggle="yes">k</italic> and limit the possibility of filtering. Hence, extending the applicability of phylo-<italic toggle="yes">k</italic>-mer-based methods to longer genomes seems challenging. Second, the mutual information of a given <italic toggle="yes">k</italic>-mer can only be computed once all its branch-specific scores are available. A perspective for future work is to develop an algorithm to assess <italic toggle="yes">k</italic>-mer informativeness directly during phylo-<italic toggle="yes">k</italic>-mer computation.</p>
    <p>Using <italic toggle="yes">EPIK</italic> requires the precomputation of the database with <italic toggle="yes">IPK</italic>, a step that is avoided by alignment-based methods. So how large shall the set of input reads be to counterbalance the precomputation time? In all our experiments (see Section 4.4), aligning a million short reads within the reference sequences was always significantly slower than computing phylo-<italic toggle="yes">k</italic>-mers for the references with <italic toggle="yes">IPK</italic>. Thus, already with circa a million short queries, it is faster to use alignment-free placement with phylo-<italic toggle="yes">k</italic>-mers than alignment-based tools.</p>
    <p>Implementing <italic toggle="yes">IPK</italic> as a standalone tool provides flexibility and eases the application of phylo-<italic toggle="yes">k</italic>-mers to other bioinformatic problems, thanks to a carefully designed API. For example, <italic toggle="yes">SHERPAS</italic>, another software based on phylo-<italic toggle="yes">k</italic>-mers, can readily use databases built by <italic toggle="yes">IPK</italic> to infer recombination patterns in viral sequences (<xref rid="btad692-B26" ref-type="bibr">Scholz <italic toggle="yes">et al.</italic> 2020</xref>). Currently, a tool exploiting phylo-<italic toggle="yes">k</italic>-mers for protein family homology detection is under development. We hope that further phylo-<italic toggle="yes">k</italic>-mer based solutions will be developed in the future.</p>
    <p>The C++ implementation of <italic toggle="yes">EPIK</italic> already offers high computational efficiency with a single thread, as well as multi-threading. Currently, for millions of queries or more, <italic toggle="yes">EPIK</italic> is the fastest phylogenetic placement software. Since the combination <italic toggle="yes">IPK</italic>+<italic toggle="yes">EPIK</italic> achieves high accuracy—comparable to state-of-the-art tools—when placing short metabarcoding reads, we hope it will become the tool of choice for large-scale metabarcoding applications.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btad692_Supplementary_Data</label>
      <media xlink:href="btad692_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We thank Frédéric Mahé for providing query sequences for the <italic toggle="yes">neotrop</italic> dataset, Matthias Blanke and Pierre Barbera for their useful comments on PEWO-based benchmarking, and the reviewers. We also thank the French Institute of Bioinformatics (IFB) for the computational resources provided.</p>
  </ack>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the French Ministry of Research (MNERT); the European Union’s Horizon 2020 research and innovation program under the Marie Skłodowska-Curie grant agreement [ALPACA, № 956229]; the French National Agency for Research (ANR) [Fish-Predict ANR-21-AAFI-0001]; the IFB; and the ATGC bioinformatics platform.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>The data underlying this article were obtained from the studies listed in Sections 2.4 and 2.6 and are available from the corresponding sources.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btad692-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Asnicar</surname><given-names>F</given-names></string-name>, <string-name><surname>Thomas</surname><given-names>AM</given-names></string-name>, <string-name><surname>Beghini</surname><given-names>F</given-names></string-name></person-group><etal>et al</etal><article-title>Precise phylogenetic analysis of microbial isolates and genomes from metagenomes using PhyloPhlAn 3.0</article-title>. <source>Nat Commun</source><year>2020</year>;<volume>11</volume>:<fpage>2500</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">32427907</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Balaban</surname><given-names>M</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Roush</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>Fast and accurate distance-based phylogenetic placement using divide and conquer</article-title>. <source>Mol Ecol Resour</source><year>2022</year>;<volume>22</volume>:<fpage>1213</fpage>–<lpage>27</lpage>.<pub-id pub-id-type="pmid">34643995</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barbera</surname><given-names>P</given-names></string-name>, <string-name><surname>Kozlov</surname><given-names>AM</given-names></string-name>, <string-name><surname>Czech</surname><given-names>L</given-names></string-name></person-group><etal>et al</etal><article-title>EPA-ng: massively parallel evolutionary placement of genetic sequences</article-title>. <source>Syst Biol</source><year>2019</year>;<volume>68</volume>:<fpage>365</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">30165689</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barbera</surname><given-names>P</given-names></string-name>, <string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Lutteropp</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>SCRAPP: a tool to assess the diversity of microbial samples from phylogenetic placements</article-title>. <source>Mol Ecol Resour</source><year>2021</year>;<volume>21</volume>:<fpage>340</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">32996237</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bass</surname><given-names>D</given-names></string-name>, <string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Williams</surname><given-names>BA</given-names></string-name></person-group><etal>et al</etal><article-title>Clarifying the relationships between Microsporidia and Cryptomycota</article-title>. <source>J Eukaryot Microbiol</source><year>2018</year>;<volume>65</volume>:<fpage>773</fpage>–<lpage>82</lpage>.<pub-id pub-id-type="pmid">29603494</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Berger</surname><given-names>SA</given-names></string-name>, <string-name><surname>Krompass</surname><given-names>D</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><article-title>Performance, accuracy, and web server for evolutionary placement of short sequence reads under maximum likelihood</article-title>. <source>Syst Biol</source><year>2011</year>;<volume>60</volume>:<fpage>291</fpage>–<lpage>302</lpage>.<pub-id pub-id-type="pmid">21436105</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Blanke</surname><given-names>M</given-names></string-name>, <string-name><surname>Morgenstern</surname><given-names>B.</given-names></string-name></person-group><article-title>App-SpaM: phylogenetic placement of short reads without sequence alignment</article-title>. <source>Bioinform Adv</source><year>2021</year>;<volume>1</volume>:<fpage>vbab027</fpage>.<pub-id pub-id-type="pmid">36700102</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bohmann</surname><given-names>K</given-names></string-name>, <string-name><surname>Mirarab</surname><given-names>S</given-names></string-name>, <string-name><surname>Bafna</surname><given-names>V</given-names></string-name></person-group><etal>et al</etal><article-title>Beyond DNA barcoding: the unrealized potential of genome skim data in sample identification</article-title>. <source>Mol Ecol</source><year>2020</year>;<volume>29</volume>:<fpage>2521</fpage>–<lpage>34</lpage>.<pub-id pub-id-type="pmid">32542933</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B9">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Cover</surname><given-names>TM</given-names></string-name>, <string-name><surname>Thomas</surname><given-names>JA.</given-names></string-name></person-group><source>Elements of Information Theory</source>, <edition>2nd edn</edition>. <publisher-loc>Hoboken, NJ</publisher-loc>: <publisher-name>Wiley-Interscience</publisher-name>, <year>2006</year>.</mixed-citation>
    </ref>
    <ref id="btad692-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><article-title>Scalable methods for analyzing and visualizing phylogenetic placement of metagenomic samples</article-title>. <source>PLoS ONE</source><year>2019</year>;<volume>14</volume>:<fpage>e0217050</fpage>.<pub-id pub-id-type="pmid">31136592</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Barbera</surname><given-names>P</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><article-title>Genesis and Gappa: processing, analyzing and visualizing phylogenetic (placement) data</article-title>. <source>Bioinformatics</source><year>2020</year>;<volume>36</volume>:<fpage>3263</fpage>–<lpage>5</lpage>.<pub-id pub-id-type="pmid">32016344</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Czech</surname><given-names>L</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A</given-names></string-name>, <string-name><surname>Dunthorn</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>Metagenomic analysis using phylogenetic placement—a review of the first decade</article-title>. <source>Front Bioinform</source><year>2022</year>;<volume>2</volume>:<fpage>871393</fpage>.<pub-id pub-id-type="pmid">36304302</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dunthorn</surname><given-names>M</given-names></string-name>, <string-name><surname>Otto</surname><given-names>J</given-names></string-name>, <string-name><surname>Berger</surname><given-names>SA</given-names></string-name></person-group><etal>et al</etal>; <collab>Biomarks Consortium</collab>. <article-title>Placing environmental next-generation sequencing amplicons from microbial eukaryotes into a phylogenetic context</article-title>. <source>Mol Biol Evol</source><year>2014</year>;<volume>31</volume>:<fpage>993</fpage>–<lpage>1009</lpage>.<pub-id pub-id-type="pmid">24473288</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Guindon</surname><given-names>S</given-names></string-name>, <string-name><surname>Dufayard</surname><given-names>J-F</given-names></string-name>, <string-name><surname>Lefort</surname><given-names>V</given-names></string-name></person-group><etal>et al</etal><article-title>New algorithms and methods to estimate maximum-likelihood phylogenies: assessing the performance of PhyML 3.0</article-title>. <source>Syst Biol</source><year>2010</year>;<volume>59</volume>:<fpage>307</fpage>–<lpage>21</lpage>.<pub-id pub-id-type="pmid">20525638</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hasan</surname><given-names>NB</given-names></string-name>, <string-name><surname>Balaban</surname><given-names>M</given-names></string-name>, <string-name><surname>Biswas</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>APPLES: scalable distance-based phylogenetic placement with or without alignments</article-title>. <source>Biology (Basel)</source><year>2020</year>;<volume>11</volume>:<fpage>566</fpage>–<lpage>78</lpage>.</mixed-citation>
    </ref>
    <ref id="btad692-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Janssen</surname><given-names>S</given-names></string-name>, <string-name><surname>McDonald</surname><given-names>D</given-names></string-name>, <string-name><surname>Gonzalez</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>Phylogenetic placement of exact amplicon sequences improves associations with clinical information</article-title>. <source>mSystems</source><year>2018</year>;<volume>3</volume>:<fpage>e00021–18</fpage>.<pub-id pub-id-type="pmid">29719869</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B17">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Koning</surname><given-names>E</given-names></string-name>, <string-name><surname>Phillips</surname><given-names>M</given-names></string-name>, <string-name><surname>Warnow</surname><given-names>T.</given-names></string-name></person-group> pplacerDC: a new scalable phylogenetic placement method. In: <italic toggle="yes">Proceedings of the 12th ACM Conference on Bioinformatics, Computational Biology, and Health Informatics</italic>, p.1–9. Gainesville, FL: Association for Computing Machinery, August 2021.</mixed-citation>
    </ref>
    <ref id="btad692-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kozlov</surname><given-names>AM</given-names></string-name>, <string-name><surname>Darriba</surname><given-names>D</given-names></string-name>, <string-name><surname>Flouri</surname><given-names>T</given-names></string-name></person-group><etal>et al</etal><article-title>RAxML-NG: a fast, scalable and user-friendly tool for maximum likelihood phylogenetic inference</article-title>. <source>Bioinformatics</source><year>2019</year>;<volume>35</volume>:<fpage>4453</fpage>–<lpage>5</lpage>.<pub-id pub-id-type="pmid">31070718</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Linard</surname><given-names>B</given-names></string-name>, <string-name><surname>Swenson</surname><given-names>K</given-names></string-name>, <string-name><surname>Pardi</surname><given-names>F.</given-names></string-name></person-group><article-title>Rapid alignment-free phylogenetic identification of metagenomic sequences</article-title>. <source>Bioinformatics</source><year>2019</year>;<volume>35</volume>:<fpage>3303</fpage>–<lpage>12</lpage>.<pub-id pub-id-type="pmid">30698645</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Linard</surname><given-names>B</given-names></string-name>, <string-name><surname>Romashchenko</surname><given-names>N</given-names></string-name>, <string-name><surname>Pardi</surname><given-names>F</given-names></string-name></person-group><etal>et al</etal><article-title>PEWO: a collection of workflows to benchmark phylogenetic placement</article-title>. <source>Bioinformatics</source><year>2021</year>;<volume>36</volume>:<fpage>5264</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">32697844</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mahé</surname><given-names>F</given-names></string-name>, <string-name><surname>de Vargas</surname><given-names>C</given-names></string-name>, <string-name><surname>Bass</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>Parasites dominate hyperdiverse soil protist communities in neotropical rainforests</article-title>. <source>Nat Ecol Evol</source><year>2017</year>;<volume>1</volume>:<fpage>91</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">28812652</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Matsen</surname><given-names>FA</given-names></string-name>, <string-name><surname>Kodner</surname><given-names>RB</given-names></string-name>, <string-name><surname>Armbrust</surname><given-names>E.</given-names></string-name></person-group><article-title>Pplacer: linear time maximum-likelihood and Bayesian phylogenetic placement of sequences onto a fixed reference tree</article-title>. <source>BMC Bioinformatics</source><year>2010</year>;<volume>11</volume>:<fpage>538</fpage>.<pub-id pub-id-type="pmid">21034504</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>McCallum</surname><given-names>A</given-names></string-name>, <string-name><surname>Nigam</surname><given-names>K.</given-names></string-name></person-group> A comparison of event models for Naive Bayes text classification. In: <italic toggle="yes">AAAI-98 Workshop on Learning for Text Categorization</italic>, Vol. <volume>752</volume>, p.41–8. Madison, WI: Association for the Advancement of Artificial Intelligence, July 1998.</mixed-citation>
    </ref>
    <ref id="btad692-B24">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Romashchenko</surname><given-names>N.</given-names></string-name></person-group> Computing informative k-mers for phylogenetic placement. Ph.D. Thesis, Université Montpellier, <year>2021</year>.</mixed-citation>
    </ref>
    <ref id="btad692-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Romashchenko</surname><given-names>N</given-names></string-name>, <string-name><surname>Linard</surname><given-names>B</given-names></string-name>, <string-name><surname>Rivals</surname><given-names>E</given-names></string-name></person-group><etal>et al</etal><article-title>Computing phylo-<italic toggle="yes">k</italic>-mers</article-title>. <source>IEEE/ACM Trans Comput Biol Bioinform</source><year>2023</year>;<volume>20</volume>:<fpage>2889</fpage>–<lpage>97</lpage>.<pub-id pub-id-type="pmid">37204943</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Scholz</surname><given-names>GE</given-names></string-name>, <string-name><surname>Linard</surname><given-names>B</given-names></string-name>, <string-name><surname>Romashchenko</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>Rapid screening and detection of inter-type viral recombinants using phylo-k-mers</article-title>. <source>Bioinformatics</source><year>2020</year>;<volume>36</volume>:<fpage>5351</fpage>–<lpage>60</lpage>.</mixed-citation>
    </ref>
    <ref id="btad692-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schultz</surname><given-names>A-K</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>M</given-names></string-name>, <string-name><surname>Bulla</surname><given-names>I</given-names></string-name></person-group><etal>et al</etal><article-title>jpHMM: improving the reliability of recombination prediction in HIV-1</article-title>. <source>Nucleic Acids Res</source><year>2009</year>;<volume>37</volume>:<fpage>W647</fpage>–<lpage>W651</lpage>.<pub-id pub-id-type="pmid">19443440</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B28">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Singer</surname><given-names>J</given-names></string-name>, <string-name><surname>Gifford</surname><given-names>R</given-names></string-name>, <string-name><surname>Cotten</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal> CoV-GLUE: A Web Application for Tracking SARS-CoV-2 Genomic Variation. <pub-id pub-id-type="doi">10.20944/preprints202006.0225.v1</pub-id>. <year>2020</year>.</mixed-citation>
    </ref>
    <ref id="btad692-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Srinivasan</surname><given-names>S</given-names></string-name>, <string-name><surname>Hoffman</surname><given-names>NG</given-names></string-name>, <string-name><surname>Morgan</surname><given-names>MT</given-names></string-name></person-group><etal>et al</etal><article-title>Bacterial communities in women with bacterial vaginosis: high resolution phylogenetic analyses reveal relationships of microbiota to clinical criteria</article-title>. <source>PLoS ONE</source><year>2012</year>;<volume>7</volume>:<fpage>e37818</fpage>.<pub-id pub-id-type="pmid">22719852</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sunagawa</surname><given-names>S</given-names></string-name>, <string-name><surname>Coelho</surname><given-names>LP</given-names></string-name>, <string-name><surname>Chaffron</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal>; <collab>Tara Oceans Coordinators</collab>. <article-title>Structure and function of the global ocean microbiome</article-title>. <source>Science</source><year>2015</year>;<volume>348</volume>:<fpage>1261359</fpage>.<pub-id pub-id-type="pmid">25999513</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Thompson</surname><given-names>LR</given-names></string-name>, <string-name><surname>Sanders</surname><given-names>JG</given-names></string-name>, <string-name><surname>McDonald</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal>; <collab>Earth Microbiome Project Consortium</collab>. <article-title>A communal catalogue reveals earth’s multiscale microbial diversity</article-title>. <source>Nature</source><year>2017</year>;<volume>551</volume>:<fpage>457</fpage>–<lpage>63</lpage>.<pub-id pub-id-type="pmid">29088705</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Turakhia</surname><given-names>Y</given-names></string-name>, <string-name><surname>Thornlow</surname><given-names>B</given-names></string-name>, <string-name><surname>Hinrichs</surname><given-names>AS</given-names></string-name></person-group><etal>et al</etal><article-title>Ultrafast sample placement on existing trees (UShER) enables real-time phylogenetics for the SARS-CoV-2 pandemic</article-title>. <source>Nat Genet</source><year>2021</year>;<volume>53</volume>:<fpage>809</fpage>–<lpage>16</lpage>.<pub-id pub-id-type="pmid">33972780</pub-id></mixed-citation>
    </ref>
    <ref id="btad692-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wedell</surname><given-names>E</given-names></string-name>, <string-name><surname>Cai</surname><given-names>Y</given-names></string-name>, <string-name><surname>Warnow</surname><given-names>T.</given-names></string-name></person-group><article-title>SCAMPP: scaling alignment-based phylogenetic placement to large trees</article-title>. <source>IEEE/ACM Trans Comput Biol Bioinform</source><year>2023</year>;<volume>20</volume>:<fpage>1417</fpage>–<lpage>30</lpage>.<pub-id pub-id-type="pmid">35471888</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
