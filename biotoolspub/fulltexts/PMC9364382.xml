<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9364382</article-id>
    <article-id pub-id-type="pmid">35786716</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btac444</article-id>
    <article-id pub-id-type="publisher-id">btac444</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ChromDMM: a Dirichlet-multinomial mixture model for clustering heterogeneous epigenetic data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-0128-4896</contrib-id>
        <name>
          <surname>Osmala</surname>
          <given-names>Maria</given-names>
        </name>
        <xref rid="btac444-cor1" ref-type="corresp"/>
        <aff><institution>Department of Computer Science, Aalto University</institution>, Espoo 02150, <country country="FI">Finland</country></aff>
        <xref rid="btac444-FM1" ref-type="author-notes"/>
        <!--maria.osmala@aalto.fi-->
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-9579-2909</contrib-id>
        <name>
          <surname>Eraslan</surname>
          <given-names>Gökçen</given-names>
        </name>
        <aff><institution>Klarman Cell Observatory, Broad Institute of Harvard and MIT</institution>, Cambridge, MA 02142, <country country="US">USA</country></aff>
        <xref rid="btac444-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lähdesmäki</surname>
          <given-names>Harri</given-names>
        </name>
        <aff><institution>Department of Computer Science, Aalto University</institution>, Espoo 02150, <country country="FI">Finland</country></aff>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Borgwardt</surname>
          <given-names>Karsten</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btac444-cor1">To whom correspondence should be addressed. <email>maria.osmala@aalto.fi</email></corresp>
      <fn id="btac444-FM1">
        <label>†</label>
        <p>The authors wish it to be known that, in their opinion, Maria Osmala and Gökçen Eraslan should be regarded as Joint First Authors.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <day>15</day>
      <month>8</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2022-07-04">
      <day>04</day>
      <month>7</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>04</day>
      <month>7</month>
      <year>2022</year>
    </pub-date>
    <volume>38</volume>
    <issue>16</issue>
    <fpage>3863</fpage>
    <lpage>3870</lpage>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>3</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>20</day>
        <month>5</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>29</day>
        <month>6</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>30</day>
        <month>6</month>
        <year>2022</year>
      </date>
      <date date-type="corrected-typeset">
        <day>12</day>
        <month>7</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btac444.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Research on epigenetic modifications and other chromatin features at genomic regulatory elements elucidates essential biological mechanisms including the regulation of gene expression. Despite the growing number of epigenetic datasets, new tools are still needed to discover novel distinctive patterns of heterogeneous epigenetic signals at regulatory elements.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We introduce ChromDMM, a product Dirichlet-multinomial mixture model for clustering genomic regions that are characterized by multiple chromatin features. ChromDMM extends the mixture model framework by profile shifting and flipping that can probabilistically account for inaccuracies in the position and strand-orientation of the genomic regions. Owing to hyper-parameter optimization, ChromDMM can also regularize the smoothness of the epigenetic profiles across the consecutive genomic regions. With simulated data, we demonstrate that ChromDMM clusters, shifts and strand-orients the profiles more accurately than previous methods. With ENCODE data, we show that the clustering of enhancer regions in the human genome reveals distinct patterns in several chromatin features. We further validate the enhancer clusters by their enrichment for transcriptional regulatory factor binding sites.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>ChromDMM is implemented as an R package and is available at <ext-link xlink:href="https://github.com/MariaOsmala/ChromDMM" ext-link-type="uri">https://github.com/MariaOsmala/ChromDMM</ext-link>.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Academy of Finland</institution>
            <institution-id institution-id-type="DOI">10.13039/501100002341</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>314445</award-id>
        <award-id>311584</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Finnish Cultural Foundation</institution>
            <institution-id institution-id-type="DOI">10.13039/501100003125</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="8"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>For over a decade, next-generation sequencing technologies have produced massive data amounts to quantify chromatin features, including nucleosomal histone modification locations, transcriptional regulatory factor (TRF) binding sites and chromatin accessibility (<xref rid="btac444-B3" ref-type="bibr">Boyle <italic toggle="yes">et al.</italic>, 2008</xref>; <xref rid="btac444-B13" ref-type="bibr">Mardis, 2007</xref>; <xref rid="btac444-B18" ref-type="bibr">Park, 2009</xref>). These chromatin-feature signals are routinely formed as counts of aligned sequencing reads at consecutive non-overlapping genomic windows (or bins) along the entire genome or a short DNA stretch. These coverage signals at regulatory elements, such as enhancers, are often investigated to understand the underlying biological mechanisms in the regulation of gene expression. Moreover, the signals can be visualized as heatmaps by aligning them within a genomic window centred at the loci (see <xref rid="btac444-F4" ref-type="fig">Fig. 4</xref> as an example). The average <italic toggle="yes">aggregate patterns</italic> of the coverage signals, illustrated on top of the heatmaps, reveal the positional correlations and recurrent patterns in the signals. However, the set of analysed genomic regions can be biologically heterogeneous; in other words, it consists of multiple unknown subclasses. Therefore, the aggregate plot derived from all regions falsely displays the superposition of several different chromatin signatures. Consequently, we need a clustering method to reveal the subclasses.</p>
    <p>The clustering method must consider the following properties of the chromatin-feature data. First, the data are heterogeneous containing sparse count data as well as varying coverage intensities and patterns. Second, the anchor positions of regulatory elements are typically uncertain; genomic regions need shifting, that is, the coverage signals need alignment with respect to each other to refine the aggregate patterns. Third, chromatin features can be asymmetric concerning the anchor points due to directional biomolecular mechanisms, such as transcription. Therefore, the coverage signals need strand-orientation (flipping).</p>
    <p>Several methods have been proposed for the epigenetic data clustering, such as hierarchical clustering (<xref rid="btac444-B11" ref-type="bibr">Kundaje <italic toggle="yes">et al.</italic>, 2012</xref>; <xref rid="btac444-B16" ref-type="bibr">Nielsen <italic toggle="yes">et al.</italic>, 2012</xref>) and <italic toggle="yes">k</italic>-means (<xref rid="btac444-B5" ref-type="bibr">Groux and Bucher, 2019</xref>; <xref rid="btac444-B8" ref-type="bibr">Heintzman <italic toggle="yes">et al.</italic>, 2007</xref>; <xref rid="btac444-B24" ref-type="bibr">Ye <italic toggle="yes">et al.</italic>, 2011</xref>). The hierarchical clustering tool CAGT by <xref rid="btac444-B11" ref-type="bibr">Kundaje <italic toggle="yes">et al.</italic> (2012)</xref> groups chromatin profiles at functional genomic elements into clusters using <italic toggle="yes">k</italic>-medians algorithm. This procedure is followed by merging redundant clusters through the hierarchical agglomerative clustering utilizing either correlation or Euclidean distance. CAGT implements profile flipping but no shifting. Some clustering methods such as ChromaSig (<xref rid="btac444-B10" ref-type="bibr">Hon <italic toggle="yes">et al.</italic>, 2008</xref>), CATCHprofiles (<xref rid="btac444-B16" ref-type="bibr">Nielsen <italic toggle="yes">et al.</italic>, 2012</xref>) and ChExMix (<xref rid="btac444-B23" ref-type="bibr">Yamada <italic toggle="yes">et al.</italic>, 2019</xref>) examine the chromatin-feature enrichment in the entire genome instead of clustering predefined sets of genomic elements. ChromaSig (<xref rid="btac444-B10" ref-type="bibr">Hon <italic toggle="yes">et al.</italic>, 2008</xref>) is a clustering method that implements both shifting and flipping, and it assumes that the read counts are normally distributed. CATCHprofiles (<xref rid="btac444-B16" ref-type="bibr">Nielsen <italic toggle="yes">et al.</italic>, 2012</xref>) is another hierarchical clustering approach combined with pairwise alignment. CATCHprofiles merges, aligns and orients the most similar profile pairs to remaining profiles iteratively based on correlation or Euclidean distance. This results in a very exhaustive search. ChExMix (<xref rid="btac444-B23" ref-type="bibr">Yamada <italic toggle="yes">et al.</italic>, 2019</xref>) is designed to cluster the ChIP-seq or the higher resolution ChIP-exo (<xref rid="btac444-B19" ref-type="bibr">Rhee and Pugh, 2011</xref>) and ChIP-nexus (<xref rid="btac444-B6" ref-type="bibr">He <italic toggle="yes">et al.</italic>, 2015</xref>) read count footprints together with the DNA sequence information at the TRF binding sites. The footprints and DNA motifs are not equal at all binding sites, for example, due to the TRF of interest interacting with distinct sets of other regulatory proteins. ChExMix models read counts as being generated by a mixture of binding events and their subtypes along the entire genome. The model is formulated as a probabilistic mixture model with multinomial component distributions and assuming sparsity-inducing Dirichlet priors on the mixture weights and binding event subtypes. The multinomial parameters, that is, the binding event positions, are assumed to follow a Bernoulli distribution. The model parameters are estimated using expectation–maximization (EM) algorithm, and as a result one obtains the responsibility of each binding subtype at each binding event in generating each sequenced read. ChExMix also considers the orientation of the footprints and allows small shifting.</p>
    <p>A probabilistic mixture model designed to cluster chromatin-feature signals at regulatory elements was introduced by <xref rid="btac444-B14" ref-type="bibr">Nair <italic toggle="yes">et al.</italic> (2014)</xref>. The model is denoted as ChIP-partitioning and it considers the above-mentioned requirements for the chromatin-feature clustering method. ChIP-partitioning models the statistical variation in the coverage signals using independent Poisson distributions. <xref rid="btac444-B14" ref-type="bibr">Nair <italic toggle="yes">et al.</italic> (2014)</xref> demonstrated that ChIP-partitioning outperforms the hierarchical and <italic toggle="yes">k</italic>-means clustering methods, particularly when clustering low-coverage count data. However, next-generation sequencing data are typically overdispersed; the data variation is larger than expected by the Poisson distribution. Therefore, many overdispersed models have been proposed, for example, for RNA-seq data analysis (<xref rid="btac444-B20" ref-type="bibr">Robinson <italic toggle="yes">et al.</italic>, 2010</xref>). Moreover, previous studies on clustering chromatin features do not provide rigorous probabilistic methods for clustering multiple chromatin features simultaneously. The previous methods also lack a principled method for determining the unknown number of clusters.</p>
    <p>We propose a probabilistic clustering method ChromDMM that exploits the discrete, sparse, heterogeneous and overdispersed nature of the sequencing data. ChromDMM builds on the mixture of Dirichlet-multinomial compound distributions originally proposed for clustering microbial data (<xref rid="btac444-B9" ref-type="bibr">Holmes <italic toggle="yes">et al.</italic>, 2012</xref>). We extend the model to account for the presence of multiple epigenetic coverage signals at the same genomic locus, so that each mixture component exhibits a set of Dirichlet-multinomial compound distributions. We also extend the model with the profile shifting and flipping features that can probabilistically account for the inaccuracies in the positions and strand-orientations of the clustered genomic elements. In addition, owing to the regularization of the mixture component parameters, ChromDMM can smooth the chromatin-feature patterns at successive bins along the genomic regions. Finally, our probabilistic model can naturally utilize the well-known model selection methods to determine the optimal number of clusters. The following Section 2 presents the ChromDMM model and its inference in detail. Section 3 analyses the performance of ChromDMM on simulated and real chromatin-feature data and compares its performance against ChIP-partitioning (<xref rid="btac444-B14" ref-type="bibr">Nair <italic toggle="yes">et al.</italic>, 2014</xref>) and SPar-K (<xref rid="btac444-B5" ref-type="bibr">Groux and Bucher, 2019</xref>).</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>The data for a chromatin feature across <italic toggle="yes">N</italic> genomic loci is represented as a <italic toggle="yes">N </italic>×<italic toggle="yes"> L</italic> matrix <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="bold">X</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>N</mml:mi></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> denotes the data for the <italic toggle="yes">i</italic>th genomic window. The length of <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is defined by the size of the genomic locations <italic toggle="yes">W</italic> and resolution <italic toggle="yes">B</italic> as <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mi>W</mml:mi><mml:mo>/</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:math></inline-formula>. For example, data extracted in <italic toggle="yes">W </italic>=<italic toggle="yes"> </italic>2000 base pair (bp) windows centred at the anchor points with the resolution <italic toggle="yes">B </italic>=<italic toggle="yes"> </italic>40 bps results in coverage signals of length <italic toggle="yes">L </italic>=<italic toggle="yes"> </italic>50. The element <italic toggle="yes">x<sub>ij</sub></italic> denotes the number of sequencing reads whose starting position (5′ end) is aligned to bin <italic toggle="yes">j</italic> of locus <italic toggle="yes">i</italic>. To be exact, <italic toggle="yes">x<sub>ij</sub></italic> denotes, for example, the histone modification ChIP-seq read counts minus the sequencing-depth normalized control counts (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4.2</xref>). Collectively, the data for <italic toggle="yes">M</italic> chromatin features are represented as a <italic toggle="yes">N</italic> × <italic toggle="yes">ML</italic> matrix <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">]</mml:mo><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mo>*</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>N</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msup><mml:mrow/><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msup><mml:mrow/><mml:mi>T</mml:mi></mml:msup><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> denotes a vector of length <italic toggle="yes">ML</italic> that contains the <italic toggle="yes">M</italic> chromatin feature vectors of a single genomic locus <italic toggle="yes">i</italic>.</p>
    <sec>
      <title>2.1 Product Dirichlet-multinomial mixture model</title>
      <p>The read counts <bold>x</bold> across the <italic toggle="yes">L</italic> bins are naturally modelled by the multinomial distribution with parameters <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="bold">p</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mi>L</mml:mi></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> (<inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>L</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>). We further assume the multinomial parameters <bold>p</bold> are distributed according to a conjugate Dirichlet distribution with hyperparameters <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">α</mml:mi></mml:math></inline-formula>. Marginalizing out the multinomial parameters from the joint distribution of <bold>x</bold> and <bold>p</bold> results in an overdispersed Dirichlet-multinomial compound distribution parameterized by <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">α</mml:mi></mml:math></inline-formula>. The Dirichlet-multinomial distributions can be utilized as the component distributions in a mixture model for the probabilistic clustering.</p>
      <p>Compared with the standard Dirichlet-multinomial mixture model (<xref rid="btac444-B9" ref-type="bibr">Holmes <italic toggle="yes">et al.</italic>, 2012</xref>), we implement two extensions. First, we assume that the likelihood of <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> is a product multinomial distribution, each multinomial with the chromatin-feature-specific parameters <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. This enables modelling several chromatin features simultaneously. Second, we assume the parameters <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> to have a mixture prior with <italic toggle="yes">K</italic> mixture components; each component <italic toggle="yes">k</italic> is a product of <italic toggle="yes">M</italic> Dirichlet distributions again with the chromatin-feature-specific hyperparameters <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>. Let the parameters of the product-Dirichlet mixture for all <italic toggle="yes">K</italic> mixture components and <italic toggle="yes">M</italic> chromatin features be represented as a <italic toggle="yes">L</italic> × <italic toggle="yes">KM</italic> matrix <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mi>K</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mi>K</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. The mixture prior for <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> is
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">π</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:mtext>Dirichlet</mml:mtext></mml:mrow><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="bold-italic">π</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>K</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> denotes the mixture weights. <xref rid="btac444-B9" ref-type="bibr">Holmes <italic toggle="yes">et al.</italic> (2012)</xref> showed that compounding the multinomial distribution with the Dirichlet mixture prior results in an analytically tractable likelihood. Similarly, in the case of the product-multinomial with the product-Dirichlet mixture prior, the parameters of the product-multinomial can also be marginalized analytically to derive a closed-form expression for the likelihood of <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> as (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1.4</xref> for a detailed derivation)
<disp-formula id="E2"><label>(1)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">π</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:mo> </mml:mo><mml:mtext>Dirichlet-multinomial</mml:mtext></mml:mrow><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>Instead of seeking to obtain the maximum-likelihood estimates for the model parameters, we adopt the Bayesian approach by introducing a prior distribution for the component parameters <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula>.</p>
      <p>To account for the correlations between the (expected) read counts at consecutive bins along the chromatin signal, we define a regularized Gamma hyperprior for the mixture component parameters <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> as
<disp-formula id="E3"><label>(2)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>∝</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mo>Γ</mml:mo></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mo>η</mml:mo></mml:mrow><mml:mi>h</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>ν</mml:mo></mml:mrow><mml:mi>h</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>L</mml:mi></mml:munderover><mml:mo>Γ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>|</mml:mo><mml:mo>η</mml:mo><mml:mo>,</mml:mo><mml:mo>ν</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where all <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> have their own independent Gamma prior with fixed shape <italic toggle="yes">η</italic> and rate <italic toggle="yes">ν</italic> parameters, and the regularization terms
<disp-formula id="E4"><label>(3)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mi>L</mml:mi></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></disp-formula>also have their own independent Gamma prior with shape <italic toggle="yes">η<sub>h</sub></italic> and rate <italic toggle="yes">ν<sub>h</sub></italic> parameters. Inclusion of the regulatory terms in the prior favours smooth mixture component parameters. A more detailed expression of the proportional distribution of the prior <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is shown in Supplementary Equation (S9) and an example of the effect of the regularization is demonstrated in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1.6</xref>.</p>
      <p>Mixture models involve the latent cluster membership variables <bold>z</bold>; each observed <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> is associated with a corresponding unobserved categorical latent variable <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. The variable <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>K</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> is a <italic toggle="yes">K</italic>-dimensional indicator vector: if sample <italic toggle="yes">i</italic> originates from cluster <italic toggle="yes">k</italic>, <italic toggle="yes">z<sub>ik</sub></italic> = 1; otherwise <italic toggle="yes">z<sub>ik</sub></italic> = 0. The variables <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> are collected in a <italic toggle="yes">N </italic>×<italic toggle="yes"> K</italic> matrix <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mi>N</mml:mi></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>. The proposed model is parameterized by <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">π</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and is presented as a directed acyclic graph in <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref> together with the distributions of individual components.</p>
    </sec>
    <sec>
      <title>2.2 The EM algorithm</title>
      <p>The posterior <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mrow><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> cannot be maximized directly. Instead, the MAP estimates for <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:math></inline-formula> and the probabilistic cluster assignments are obtained by an iterative approach, the EM algorithm (<xref rid="btac444-B2" ref-type="bibr">Bishop, 2006</xref>). For the derivation of the EM algorithm assume a distribution for <bold>Z</bold>, <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mrow><mml:mi>q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Then, the Jensen’s inequality provides a lower bound for the posterior distribution
<disp-formula id="E5"><mml:math id="M5" display="block" overflow="scroll"><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>≥</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mi>q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:mo stretchy="false">[</mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mi>q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:mo stretchy="false">[</mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo>+</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mtext>constant</mml:mtext><mml:mo>,</mml:mo></mml:math></disp-formula>where <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the complete data log-likelihood and the <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mrow><mml:mtext>constant</mml:mtext></mml:mrow></mml:math></inline-formula> term is independent on <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:math></inline-formula>. Assuming some initial estimates for the parameters <inline-formula id="IE35"><mml:math id="IM35" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> and defining <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mrow><mml:mi>q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, the lower bound (without the constant term) is
<disp-formula id="E6"><mml:math id="M6" display="block" overflow="scroll"><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">π</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula>where the expectation is wrt the posterior probabilities of the cluster assignments conditional on the current parameter estimates <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, that is, <inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. The likelihood term <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the Dirichlet-multinomial compound distribution for the <italic toggle="yes">m</italic>th chromatin feature. For a detailed derivation, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1.8</xref>.<boxed-text id="btac444-BOX1" position="float"><label>Algorithm 1:</label><caption><p>EM algorithm for ChromDMM</p></caption><p> <bold>Input</bold>: Data <inline-formula id="IE401"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> for all <italic toggle="yes">M</italic> chromatin features, the number of clusters <italic toggle="yes">K</italic>, hyper-parameters <inline-formula id="IE411"><mml:math id="IM41" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>η</mml:mo><mml:mo>,</mml:mo><mml:mo>ν</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>η</mml:mo></mml:mrow><mml:mi>h</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>ν</mml:mo></mml:mrow><mml:mi>h</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula></p><p> <bold>Output</bold>: MAP estimates <inline-formula id="IE421"><mml:math id="IM42" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE431"><mml:math id="IM43" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>|</mml:mo><mml:mi mathvariant="bold">X</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula></p><p><bold>1</bold> Parameters <inline-formula id="IE441"><mml:math id="IM44" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">λ</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">λ</mml:mi></mml:mrow><mml:mi>K</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">λ</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">λ</mml:mi></mml:mrow><mml:mi>K</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">π</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>;</p><p><bold>2 <monospace>/</monospace></bold><monospace>/Initialisation to obtain</monospace>  <inline-formula id="IE451"><mml:math id="IM45" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula></p><p><bold>3</bold> Initialise <inline-formula id="IE464"><mml:math id="IM46" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> using soft <italic toggle="yes">k</italic>-means on concatenated data;</p><p><bold>4</bold> Initialise <inline-formula id="IE470"><mml:math id="IM47" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> by <inline-formula id="IE489"><mml:math id="IM48" display="inline" overflow="scroll"><mml:mrow><mml:mi>arg</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">λ</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> using BFGS;</p><p><bold>5 <monospace>/</monospace></bold><monospace>/The EM algorithm loop</monospace></p><p><bold>6 while</bold> <italic toggle="yes">the lower bound</italic> <inline-formula id="IE496"><mml:math id="IM49" display="inline" overflow="scroll"><mml:mrow><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>  <italic toggle="yes">not converged</italic> <bold>do</bold></p><p><bold>7</bold>  <bold><monospace>/</monospace></bold><monospace>/E-step</monospace>:</p><p><bold>8</bold>  Compute <inline-formula id="IE501"><mml:math id="IM50" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>|</mml:mo><mml:mi mathvariant="bold">X</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, i.e., <inline-formula id="IE511"><mml:math id="IM51" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>;</p><p><bold>9</bold>  <bold><monospace>/</monospace></bold><monospace>/M-step</monospace>:</p><p><bold>10</bold>  <inline-formula id="IE524"><mml:math id="IM52" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">λ</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>*</mml:mo><mml:mo>,</mml:mo><mml:mtext>new</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mtext>arg</mml:mtext><mml:msub><mml:mrow><mml:mrow><mml:mtext>max</mml:mtext></mml:mrow></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">λ</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> using BFGS</p><p><bold>11</bold>  Update mixing weights <inline-formula id="IE534"><mml:math id="IM53" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">π</mml:mi></mml:math></inline-formula>: <inline-formula id="IE547"><mml:math id="IM54" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mtext>new</mml:mtext></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula></p><p><bold>12</bold>  <inline-formula id="IE556"><mml:math id="IM55" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">λ</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>*</mml:mo><mml:mo> </mml:mo><mml:mo>,</mml:mo><mml:mtext>new</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">π</mml:mi></mml:mrow><mml:mrow><mml:mtext>new</mml:mtext></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula></p><p><bold>13 end</bold></p></boxed-text>In the EM algorithm, E-steps and an M-steps are repeated, until convergence of the lower bound <inline-formula id="IE50"><mml:math id="IM56" display="inline" overflow="scroll"><mml:mrow><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. In the E-step, the posterior probability that a sample <italic toggle="yes">i</italic> belongs to a cluster <italic toggle="yes">k</italic> given the current parameter estimates <inline-formula id="IE51"><mml:math id="IM57" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> is obtained using the standard Bayes rule as
<disp-formula id="E7"><mml:math id="M7" display="block" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>′</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula id="IE52"><mml:math id="IM58" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∏</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:msubsup><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the likelihood of the sample <italic toggle="yes">i</italic> conditioned with cluster <italic toggle="yes">k</italic>, that is, the product Dirichlet-multinomial distribution. The term <inline-formula id="IE53"><mml:math id="IM59" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> corresponds to the mixture weight <italic toggle="yes">π<sub>k</sub></italic>. In the M-step, as a closed-form solution of <inline-formula id="IE54"><mml:math id="IM60" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> that maximizes <inline-formula id="IE55"><mml:math id="IM61" display="inline" overflow="scroll"><mml:mrow><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is unattainable, the lower bound is maximized wrt <inline-formula id="IE56"><mml:math id="IM62" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> using Broyden–Fletcher–Goldfarb–Shanno (BFGS) method provided in R (<xref rid="btac444-B4" ref-type="bibr">Broyden, 1970</xref>). In addition, the component parameters <inline-formula id="IE57"><mml:math id="IM63" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> are constrained to be positive by a reparameterization <inline-formula id="IE58"><mml:math id="IM64" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">λ</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>m</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> and by re-defining the prior for <inline-formula id="IE59"><mml:math id="IM65" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">λ</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> accordingly using the multivariate change of variables method. For more details on deriving the equations for the model inference, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Sections S1.7–S1.15</xref>. The steps of the EM algorithm are summarized in <xref rid="btac444-BOX1" ref-type="boxed-text">Algorithm 1</xref>. In the initilization, the cluster membership probabilities <inline-formula id="IE60"><mml:math id="IM66" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> are obtained with the soft <italic toggle="yes">k</italic>-means clustering (<xref rid="btac444-B12" ref-type="bibr">MacKay, 2003</xref>) on concatenated chromatin features (see details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4.1</xref>). For a given number of clusters, the EM algorithm is run multiple times each with different random initialization. Note that it is trivial to parallelize the computation across the multiple runs as well as across varying numbers of clusters.</p>
    </sec>
    <sec>
      <title>2.3 Chromatin feature profile shifting and flipping</title>
      <p>We extend the product Dirichlet-multinomial mixture model with shifting and flipping features. For profile shifting, we first define the maximum amount of shifting, for example, 400 bp, both upstream and downstream. With a given bin size (e.g. <inline-formula id="IE61"><mml:math id="IM67" display="inline" overflow="scroll"><mml:mrow><mml:mi>B</mml:mi><mml:mo>=</mml:mo><mml:mn>40</mml:mn><mml:mtext>bp</mml:mtext></mml:mrow></mml:math></inline-formula>), this results in <inline-formula id="IE62"><mml:math id="IM68" display="inline" overflow="scroll"><mml:mrow><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mn>400</mml:mn><mml:mtext>bp</mml:mtext></mml:mrow><mml:mrow><mml:mn>40</mml:mn><mml:mtext>bp</mml:mtext></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>=</mml:mo><mml:mn>21</mml:mn></mml:mrow></mml:math></inline-formula> possible shift states, where the shift state <inline-formula id="IE63"><mml:math id="IM69" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>S</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:math></inline-formula> corresponds to no shift. In addition, the length of the Dirichlet parameters <inline-formula id="IE64"><mml:math id="IM70" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> is extended from <italic toggle="yes">L</italic> to <inline-formula id="IE65"><mml:math id="IM71" display="inline" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mo>+</mml:mo><mml:mi>S</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. When evaluating the likelihood model from <xref rid="E2" ref-type="disp-formula">Equation (1)</xref> for a shift state <italic toggle="yes">s</italic>, we use the corresponding <italic toggle="yes">L</italic>-length subset of the extended Dirichlet parameters for each mixture component <italic toggle="yes">k</italic>, denoted as <inline-formula id="IE66"><mml:math id="IM72" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>*</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>+</mml:mo><mml:mi>L</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>*</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. For profile flipping, we either compute the likelihood model definition with a shift state <italic toggle="yes">s</italic> (using again the <italic toggle="yes">L</italic>-length subset of the Dirichlet parameters) if <italic toggle="yes">f </italic>=<italic toggle="yes"> </italic>1, or reverse the order of the Dirichlet parameters if <italic toggle="yes">f </italic>=<italic toggle="yes"> </italic>2. Formally, we denote the shifting and flipping-aware likelihood model for a single genomic locus as <inline-formula id="IE67"><mml:math id="IM73" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">π</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>For each locus, we can define prior probabilities for the shift and flip states. The prior shift state probabilities for the genomic locus <italic toggle="yes">i</italic> are denoted as <inline-formula id="IE68"><mml:math id="IM74" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">ξ</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE69"><mml:math id="IM75" display="inline" overflow="scroll"><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>S</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. If the genomic loci and their anchor points are defined using ChIP-seq summits, then the prior for shift states can be defined, for example, as a pyramid-shaped prior that has the highest probability at the ChIP-seq peak summit (corresponding to no-shift state) and linearly decreasing the prior to zero beyond the maximum shift state. Similarly, we can define prior flip state probabilities <inline-formula id="IE70"><mml:math id="IM76" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">ζ</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> for each locus <italic toggle="yes">i</italic>, where <inline-formula id="IE71"><mml:math id="IM77" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>ζ</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mo>ζ</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
      <p>In ChromDMM with the shifting and flipping features, the latent cluster membership variables are re-defined as follows: <italic toggle="yes">z<sub>iksf</sub></italic> = 1 if the sample <italic toggle="yes">i</italic> originates from the cluster <italic toggle="yes">k</italic>, has shift state <italic toggle="yes">s</italic> and has strand-orientation <italic toggle="yes">f</italic>; otherwise, <italic toggle="yes">z<sub>iksf</sub></italic> = 0. These latent variables are stored in <inline-formula id="IE72"><mml:math id="IM78" display="inline" overflow="scroll"><mml:mrow><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>K</mml:mi><mml:mo>×</mml:mo><mml:mi>S</mml:mi><mml:mo>×</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> matrix (or tensor) <bold>Z</bold>. We show in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2.3</xref> that the EM algorithm can be derived similarly as in Section 2.2, resulting in the following lower bound for the posterior distribution of parameters <inline-formula id="IE73"><mml:math id="IM79" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:math></inline-formula>
 <disp-formula id="E8"><mml:math id="M8" display="block" overflow="scroll"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>S</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:munderover><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">iksf</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>+</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>S</mml:mi></mml:munderover><mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow></mml:mrow><mml:msub><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:munderover><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">iksf</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>+</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:munderover><mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow></mml:mrow><mml:msub><mml:mrow><mml:mo>ζ</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>S</mml:mi></mml:munderover><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">iksf</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>+</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>S</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:munderover><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow></mml:mrow></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">iksf</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ksf</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>+</mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>where <inline-formula id="IE74"><mml:math id="IM80" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">iksf</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">iksf</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>old</mml:mtext></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Note that the above mixture model can be applied (i) only with shifting, (ii) only with flipping or (iii) with both shifting and flipping. In the case of (i), we simply drop the index <italic toggle="yes">f</italic> and the corresponding sums and in the case of (ii), we simply drop the index <italic toggle="yes">s</italic> and the corresponding sums. For more details on the derivations of equations needed to infer the shifting and flipping-aware model, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref>.</p>
      <p>After learning the model parameters with the EM algorithm, we infer the final cluster assignment <inline-formula id="IE75"><mml:math id="IM81" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>k</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> for each sample <italic toggle="yes">i</italic> by marginalizing the shift and flip states. Similarly, we choose the final flip and shift states, <inline-formula id="IE76"><mml:math id="IM82" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>s</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, that maximize the posterior given the optimal cluster <inline-formula id="IE77"><mml:math id="IM83" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>k</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> by marginalizing the shift and flip states, respectively,
<disp-formula id="E9"><label>(4)</label><mml:math id="M9" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>k</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mtext>arg</mml:mtext><mml:mrow><mml:mtext>max</mml:mtext></mml:mrow></mml:mrow><mml:mi>k</mml:mi></mml:munder><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>S</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:munderover><mml:mi>p</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">iksf</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
 <disp-formula id="E10"><label>(5)</label><mml:math id="M10" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mtext>arg</mml:mtext><mml:mrow><mml:mtext>max</mml:mtext></mml:mrow></mml:mrow><mml:mi>f</mml:mi></mml:munder><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>S</mml:mi></mml:munderover><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>k</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mi>s</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
 <disp-formula id="E11"><label>(6)</label><mml:math id="M11" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>s</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mtext>arg</mml:mtext><mml:mrow><mml:mtext>max</mml:mtext></mml:mrow></mml:mrow><mml:mi>s</mml:mi></mml:munder><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:munderover><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>k</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mi>s</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec>
      <title>2.4 Choosing the number of clusters and identifiability aspects</title>
      <p>For probabilistic clustering methods, the Bayesian model selection is commonly used to guide the selection of an appropriate number of clusters <italic toggle="yes">K</italic>. While the exact computation of the marginal likelihood is impractical, we can directly apply the commonly used approximative methods, such as the Bayesian information criterion (BIC) (<xref rid="btac444-B21" ref-type="bibr">Schwarz, 1978</xref>) or the Akaike information criterion (AIC) (<xref rid="btac444-B1" ref-type="bibr">Akaike, 1973</xref>).</p>
      <p>There are inherent unidentifiability issues in ChromDMM results. Firstly, as in any clustering method, the inferred cluster labels can be switched between two clusters without affecting the clustering accuracy. Secondly, unless informative prior for strand-orientation is provided, the flip state indexes (1 or 2) can always be reversed. For biological interpretation, the aligned and flipped profiles need to be visualized after clustering and compared with the underlying directionality of the genomic region, such as direction of transcription 3′ → 5′ or 5′ → 3′, if known. The learned shift state is also affected by the learned flip state. While evaluating the performance of ChromDMM and other methods on simulated data, we consider these aspects.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 Clustering simulated data</title>
      <sec>
        <title>3.1.1 Data simulation and choice for hyperparameters</title>
        <p>We used simulated data to investigate the clustering accuracy of ChromDMM, ChIP-Partitioning and SPar-K when the data contain varying number of chromatin features and varying read coverages. For comparison, we repeated some experiments on the simulated data presented by <xref rid="btac444-B14" ref-type="bibr">Nair <italic toggle="yes">et al.</italic> (2014)</xref>. We simulated data containing two clusters using the R-code presented in <xref rid="btac444-B14" ref-type="bibr">Nair <italic toggle="yes">et al.</italic> (2014)</xref> (see their <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>, page 13). We generated 1000 samples per cluster using low-coverage parameter values <italic toggle="yes">f </italic>=<italic toggle="yes"> </italic>0.5 and <italic toggle="yes">f </italic>=<italic toggle="yes"> </italic>1. We found that at these low-coverage parameter values, most of the simulated profiles were zero vectors. Thus, we first generated 10 000 samples for both clusters and randomly selected 1000 non-zero vectors for both clusters. The data generation was repeated 100 times. An example of simulated dataset is presented in <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S8</xref>. The cluster-wise aggregate profiles are Gaussian-shaped with varying location of the mean and variance.</p>
        <p>To generate more realistic simulated data, we first clustered data for four chromatin features (H3K4me1, H3K27ac, RNA polymerase II and MNase-seq) at 1000 enhancers from the ENCODE project (<xref rid="btac444-B22" ref-type="bibr">The ENCODE Project Consortium, 2012</xref>) by ChromDMM requiring the inference of both the shift and flip states. For more details, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Methods S4.2</xref>. From the fitted model, we chose the Dirichlet parameters <inline-formula id="IE78"><mml:math id="IM84" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> for two clusters. These parameters were used to sample the multinomial parameters <inline-formula id="IE79"><mml:math id="IM85" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> and finally the profiles <inline-formula id="IE80"><mml:math id="IM86" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> by varying the chromatin-feature-specific coverage between 10, 20, 50 and 100. For each experiment, we simulated 100 datasets. We used the area under receiver operations characteristics (AUC) curve as the performance measure for the clustering accuracy. For more details and the visualization of a simulated dataset with a coverage of 100, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4.4</xref>.</p>
        <p>We performed hyperparameter sweeps on the simulated data to determine robust default values for the ChromDMM model. Briefly, for the Gamma prior for the Dirichlet parameters <inline-formula id="IE81"><mml:math id="IM87" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> (parameterized by hyperparameters <italic toggle="yes">η</italic> and <italic toggle="yes">ν</italic>), we observed that the results were not sensitive to hyperparameter values and conclude that the choice of <inline-formula id="IE82"><mml:math id="IM88" display="inline" overflow="scroll"><mml:mrow><mml:mo>η</mml:mo><mml:mo>=</mml:mo><mml:mn>1.1</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE83"><mml:math id="IM89" display="inline" overflow="scroll"><mml:mrow><mml:mo>ν</mml:mo><mml:mo>=</mml:mo><mml:mn>0.1</mml:mn></mml:mrow></mml:math></inline-formula> results in a good performance (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S5</xref>). We also performed the prior predictive checks using the ancestral sampling of the data from prior hyperparameters and demonstrated that the amount of variation generated from the prior is comparable to the variation in the real data (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S6</xref>). Similarly, we chose the hyperparameter values for the regularization term <inline-formula id="IE84"><mml:math id="IM90" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>m</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula>. The Gamma prior with mean 1 and variance 0.1 corresponding to hyperparameters <inline-formula id="IE85"><mml:math id="IM91" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>η</mml:mo></mml:mrow><mml:mi>h</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>ν</mml:mo></mml:mrow><mml:mi>h</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> resulted in a robust clustering performance (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S7</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4.5</xref> for more details). We set the above hyperparameter values as defaults, but a user can, for example, perform prior predictive checks for his/her data and adjust the hyperparameters, if necessary.</p>
        <p>We investigated the ability of AIC and BIC to choose the correct number of clusters (two) for the simulated data. We fitted ChromDMM with varying the number of clusters (from 1 to 3). The proportions of cluster numbers selected by AIC and BIC in 100 simulated datasets are presented in <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S16a</xref> for 1000 samples and in <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S16b</xref> for 6000 samples. We conclude that AIC and BIC detect the correct number of clusters more reliably when the coverage of the chromatin modifications and/or the number of samples increases, although BIC tends to underestimate the number of clusters. The computation times of the three methods (with default parameters) to cluster simulated data containing two clusters and two chromatin features both with coverage 100 were: half an hour (ChromDMM), ca. 10 min (ChIP-Partitioning) and seconds (SPar-K).</p>
      </sec>
      <sec>
        <title>3.1.2 ChromDMM infers accurate clusters</title>
        <p>We compared ChrommDMM against ChIP-partitioning and SPar-K (both applied with the default parameters) in clustering simulated data that were generated as in <xref rid="btac444-B14" ref-type="bibr">Nair <italic toggle="yes">et al.</italic> (2014)</xref>. The clustering performance of ChromDMM exceeded the performance of ChIP-partitioning and SPar-K (<xref rid="btac444-F1" ref-type="fig">Fig. 1</xref>). Similarly as in <xref rid="btac444-B14" ref-type="bibr">Nair <italic toggle="yes">et al.</italic> (2014)</xref>, we also report the Pearson correlation coefficients between the true cluster-wise aggregate patterns and the inferred aggregate patterns (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S9</xref>). In general, the correlations are similar to values obtained by <xref rid="btac444-B14" ref-type="bibr">Nair <italic toggle="yes">et al.</italic> (2014)</xref>. For the first cluster, the correlations obtained by ChromDMM are lower than for ChIP-partitioning, whereas for the second cluster, the correlations obtained by ChromDMM are slightly higher.</p>
        <fig position="float" id="btac444-F1">
          <label>Fig. 1.</label>
          <caption>
            <p>AUC values for clustering simulated data that were generated as in <xref rid="btac444-B14" ref-type="bibr">Nair <italic toggle="yes">et al.</italic> (2014)</xref> and contain two clusters and one chromatin feature. The chromatin feature coverage parameter <italic toggle="yes">f</italic> was varied between 0.5 and 1. Boxplots represent results for 100 datasets</p>
          </caption>
          <graphic xlink:href="btac444f1" position="float"/>
        </fig>
        <p>We compared ChrommDMM against ChIP-partitioning and SPar-K in clustering more realistic simulated data that contained two clusters and two chromatin features (H3K4me1 and RNA POL II). The clustering performance of ChromDMM exceeded the performance of ChIP-Partitioning (<xref rid="btac444-F2" ref-type="fig">Fig. 2</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S10</xref>). SPar-K performed poorly in these comparisons, particularly when the coverages were low (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S11</xref>). Similar results were obtained on data containing only a single feature (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S12</xref>). For comparison, <xref rid="btac444-F2" ref-type="fig">Figure 2</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S10</xref> present also results for an experiment where ChromDMM was fitted either on concatenated chromatin profile data or without the regularization term. The regularization improved the clustering performance especially when the coverage for the first chromatin feature (H3K4me1) was low, whereas the use of non-concatenated chromatin profile data resulted in only a marginal improvement in this simulation setting.</p>
        <fig position="float" id="btac444-F2">
          <label>Fig. 2.</label>
          <caption>
            <p>AUC values for clustering simulated datasets that contain two clusters and two chromatin features (H3K4me1 and RNA POL II). The chromatin feature coverages were varied between 10, 20, 50 and 100 for RNA POL II, and between 10 and 50 for H3K4me1 (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S10</xref> for more combinations). Boxplots represent results for 100 datasets</p>
          </caption>
          <graphic xlink:href="btac444f2" position="float"/>
        </fig>
      </sec>
      <sec>
        <title>3.1.3 Clustering accuracy improves with the number of features</title>
        <p>We experimented with the number of chromatin features; beginning from a single feature (H3K4me1), the number of features was increased to four by adding RNA Pol II, H3K27ac and MNase-seq. <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S13a</xref> shows how the clustering accuracy increases together with the number of chromatin features for a signal coverage of 10. <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S13b</xref> presents similar results for a varying coverage, where the coverage of the first set of chromatin features was 10 (H3K4m1, H3K27ac) and the coverage of the second set of chromatin features was 50 (RNA Pol II, MNase-seq). We conclude that for ChromDMM and ChIP-partitioning, the clustering performance increases as a function of the number of chromatin features, whereas for SPar-K the improvement is less consistent. Regardless of the number of chromatin features, ChromDMM obtains the best performance.</p>
      </sec>
      <sec>
        <title>3.1.4 ChromDMM infers accurate shift and flip states</title>
        <p>The simulated data were also artificially shifted and flipped as described in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4.4</xref>. Briefly, the random shifts were constrained to be multiple of the data resolution (<italic toggle="yes">B </italic>=<italic toggle="yes"> </italic>40 bp) and drawn from the Skellam distribution with mean zero and a variance that included the randomly sampled shifts between –400 and +400 bp. Similarly, the flip states were sampled randomly with equal probability for both strand-orientations. For more details, see Supplementary Algorithm S3.</p>
        <p>The clustering accuracy of ChromDMM, ChIP-partitioning and SPar-K was demonstrated on the randomly shifted and flipped simulated data. We experimented with four versions of ChromDMM: (i) ChromDMM with the regularization term and with the pyramid-shaped shift state prior, (ii) same as (i) but with concatenated chromatin features, (iii) ChromDMM without the regularization term and with the pyramid-shaped shift prior and (iv) ChromDMM with a uniform prior for the shift states and with the regularization term. The clustering accuracies of the methods are presented in <xref rid="btac444-F3" ref-type="fig">Fig. 3a</xref>. Methods considering the concatenated chromatin features, including ChIP-partitioning and SPar-K, performed poorly in these comparisons and notably they failed to improve their performance while increasing the coverage values. ChromDMM outperformed other methods and its clustering performance was further improved by both the informative shift state prior and the regularization, particularly when the coverage of either chromatin feature was low.</p>
        <fig position="float" id="btac444-F3">
          <label>Fig. 3.</label>
          <caption>
            <p>AUC values (a) and average shift errors in bps (b) for clustering simulated data that contain two clusters, two chromatin features and randomly sampled shift and flip states. The chromatin feature coverages varied between 10, 50 and 100. Results are shown for ChromDMM, ChIP-partitioning and SPar-K. For comparison, ChromDMM was applied also on concatenated chromatin features. ChromDMM was inferred also with the uniform shift state prior and without the regularization term. Boxplots represent results for 100 datasets</p>
          </caption>
          <graphic xlink:href="btac444f3" position="float"/>
        </fig>
        <p>The methods were compared with their accuracy to correctly infer the shift and the flip states of the genomic regions. ChromDMM and ChIP-partitioning infer the most probable shift and flip states for each sample <italic toggle="yes">i</italic> from the latent variable probabilities shown in <xref rid="E10" ref-type="disp-formula">Equations (5)</xref> and <xref rid="E11" ref-type="disp-formula">(6)</xref>, respectively, whereas SPar-K outputs the inferred shift and flip states separately. The flip state error was defined as the proportion of incorrectly inferred flip states in a given experiment (recall the identifiability aspects from Section 2.4). Similarly, the shift error for each sample was computed as the absolute difference between the true shift and the inferred shift in nucleotides. The average shift error over all <italic toggle="yes">N</italic> samples was reported as the final shift error for a single experiment.</p>
        <p>The flip errors for the simulated shifted and flipped data containing two chromatin features and two clusters are presented in <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S14</xref>. On average, the flip errors decreased as the coverages increased and they were lower for the ChromDMM methods compared with ChIP-partitioning and SPar-K. The flip errors were only slightly affected by whether the ChromDMM fit was inferred without the shift prior or without the regularization. The resulting shift errors for the simulated data are shown in <xref rid="btac444-F3" ref-type="fig">Fig. 3b</xref>. Again, the average shift errors decreased as the coverages increased and the shift errors were lowest for the ChromDMM methods. The shift state inference of ChromDMM was further improved by the informative shift prior and the regularization of the mixture component parameters <inline-formula id="IE86"><mml:math id="IM92" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula>. In contrast to the other methods, the shift errors for ChIP-partitioning remained high even with large coverage values. This likely results from the cluster-assigned patterns drifting from the profile centre positions, that is, ChIP-partition selects a profile whose unimodal peak or valley between the two-modal peak is shifted far from the profile centre and aligns the rest of the profiles according to this single profile (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S15d</xref>). The cluster patterns inferred by SPar-K also drift (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S15e</xref>), whereas ChromDMM centres the peaks and valleys to the profile centres (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S15c</xref>). This desirable behaviour of ChromDMM stems partly from the robustness of the probabilistic treatment and the shift state prior.</p>
        <p>Finally, we investigated the ability of AIC and BIC to choose the correct number of clusters (two) in the simulated shifted and flipped data (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S17</xref>). In contrast to the simpler model studied in Section 3.1, the more complex ChromDMM model with a high number of parameters is heavily penalized by AIC and BIC, and thus require higher coverage and larger number of samples to detect the correct number of clusters.</p>
      </sec>
    </sec>
    <sec>
      <title>3.2 Clustering enhancers in ENCODE data</title>
      <sec>
        <title>3.2.1 ChromDMM reveals distinctive enhancer clusters</title>
        <p>We applied ChromDMM, ChIP-partitioning and SPar-K with the flip and shift state inference to cluster ENCODE data containing 10 chromatin features extracted at enhancer regions. For the details of the data, preprocessing and the definition of the enhancers, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4.2</xref> and <xref rid="btac444-B17" ref-type="bibr">Osmala and Lähdesmäki (2020)</xref>. Based on the ChromDMM fit, the enhancers were assigned to the most probably clusters and their profiles were re-aligned based on the inferred shift and flip states, for example for visualization. As a result, ChromDMM separated enhancers into six clusters, each with distinctive and refined combinations of chromatin feature patterns. Three of the six clusters are visualized as heatmaps and aggregated patterns in <xref rid="btac444-F4" ref-type="fig">Fig. 4</xref> (the full set of clusters and chromatin features are presented in <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S18</xref>). In contrast, ChIP-partitioning and SPar-K failed to identify distinctive patterns and to refine the profile alignment and strand-orientation (<xref rid="sup1" ref-type="supplementary-material">Supplementary Figs. S20 and S21</xref>).</p>
        <fig position="float" id="btac444-F4">
          <label>Fig. 4.</label>
          <caption>
            <p>Enhancer clusters revealed by ChromDMM. The coverage signals of individual enhancers assigned to the clusters are visualized as heatmaps. The aggregate patterns are visualized on top of the heatmaps. Four of the 10 chromatin features for three of the six clusters are shown. The full set of clusters and chromatin features resulting from enhancer clustering by ChromDMM are presented in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S18</xref></p>
          </caption>
          <graphic xlink:href="btac444f4" position="float"/>
        </fig>
        <p>The ChromDMM enhancer clusters possess characteristic combinations of chromatin feature pattern shapes, spacings and signal strengths. The first cluster has symmetric and high enrichment of histone modification and MNase-seq signals with a steep decline of the signals in the middle of the profiles, indicating a nucleosome-free region. In addition, the nucleosome-free region is surrounded by a regular array of well-positioned nucleosomes. In contrast, in the clusters 2, 3 and 4, the nucleosome-free region and the well-positioning of the nucleosomes are obscured compared with the other clusters. Thus, the enhancers in these clusters may possess closed chromatin or mobile nucleosomes. The clusters 4–6 have asymmetricity in histone modification enrichment (clusters 4 and 5), in nucleosome positioning (clusters 5 and 6) and in RNA POL II occupancy (clusters 4 and 5). The asymmetricity in the RNA POL II ChIP-seq signal may reflect the direction of transcription. In addition, in the asymmetric clusters, the histone modifications are enriched on either of the two nucleosomes immediately flanking the anchor position (cluster 5) or spread widely (clusters 4 and 6).</p>
      </sec>
      <sec>
        <title>3.2.2 Biological validation of the inferred clusters</title>
        <p>The enhancer clusters revealed by ChromDMM, ChIP-partitioning and SPar-K were investigated for the enrichment of the binding sites of transcription factors (TFs) and other regulatory proteins, collectively referred to as TRFs. The ChIP-seq peaks for 220 TRFs were downloaded from ENCODE. For each TRF-cluster pair, a significance test for the enrichment of a given TRF at the cluster was performed by the GAT tool (<xref rid="btac444-B7" ref-type="bibr">Heger <italic toggle="yes">et al.</italic>, 2013</xref>). A large majority of the enrichments were significant according to the <italic toggle="yes">q</italic>-value threshold 0.01. To reveal differences in the TRF enrichment between clusters, the fold enrichments were visualized as a heatmap, where the enrichments corresponding to <italic toggle="yes">q</italic>-value larger than 0.01 were masked out (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S19</xref> for ChromDMM clusters). The fold enrichments for TRFs which were significantly enriched in at least one ChromDMM cluster and simultaneously not enriched in at least one another cluster are presented in <xref rid="btac444-F5" ref-type="fig">Fig. 5</xref>. For more details, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Method S4.3</xref>.</p>
        <fig position="float" id="btac444-F5">
          <label>Fig. 5.</label>
          <caption>
            <p>The fold enrichment of TRFs at the enhancer clusters identified by ChromDMM. The fold enrichments corresponding to <italic toggle="yes">q</italic>-value larger than 0.01 were masked out from the heatmap. The enrichment results for all 220 TRFs are presented in <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S19</xref></p>
          </caption>
          <graphic xlink:href="btac444f5" position="float"/>
        </fig>
        <p>The enrichment of TRFs in ChromDMM enhancer clusters reveals the potential biological significance of the distinctive chromatin feature patterns. Clusters 3 and 4 with obscured nucleosome-free regions and nucleosome positioning have less enrichment of TRFs than the four other clusters. In contrast, the first cluster with symmetric and strong signals has an enrichment for a large number of TRFs. Similarly to cluster 1, cluster 5 with strong asymmetry in the histone modification and RNA POL II signals has a high TRF enrichment. Asymmetric cluster 6 with strong average H3K27ac, H3K9ac and DNase-seq signals differs from the other clusters with unique enrichment for RNA binding and processing-related proteins (HNRNPK, FUS) and TFs SMAD2 and YBX3. In addition, clusters 1 and 6 have enrichment for the largest component and core scaffold of the TFIID basal TF complex (TAF7). Moreover, clusters 1, 5 and 6 are enriched for Scaffold attachment factor B1 (SAFB), a protein that binds DNA regions that are bound to the nuclear scaffold. Interestingly, SAFB may be involved in attaching the base of the chromatin loops to the nuclear scaffold and serving as a molecular base to assemble a transcriptosome complex in the vicinity of the actively transcribed genes (<xref rid="btac444-B15" ref-type="bibr">Nayler <italic toggle="yes">et al.</italic>, 1998</xref>). For comparison, the TRF enrichments at ChIP-partitioning and SPar-K clusters are visualized in <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S22 and S23</xref>.</p>
      </sec>
    </sec>
  </sec>
  <sec>
    <title>4 Conclusions</title>
    <p>Exploring epigenetic datasets provides crucial information on key biological mechanisms such as gene regulation. An example of such data mining is the clustering of epigenomic signals and other chromatin features at regulatory elements, such as enhancers, to reveal the combinations of chromatin features with varying signal magnitudes and profile shapes. To appropriately account for the sparse, discrete, heterogeneous and overdispersed nature of the chromatin-feature data, probabilistic clustering methods have been developed.</p>
    <p>We have proposed ChromDMM, a product Dirichlet-multinomial mixture model that provides a probabilistic method to cluster multiple chromatin-feature coverage signals extracted from the same locus. By employing simulated data, we demonstrated that the accuracy of ChromDMM increases with the increasing number of chromatin features. This indicates the need for a principled approach that considers the multiple chromatin features simultaneously when clustering regulatory elements. Moreover, we demonstrated that ChromDMM outperforms the previous methods ChIP-partitioning and SPar-K in clustering accuracy, particularly when the chromatin-feature coverages are low. In addition, ChromDMM learns the shift and flip states more accurately compared with ChIP-partitioning and SPar-K. The accuracy of ChromDMM to infer the clusters and shift states is further improved by mixture component parameter regularization and an informative shift state prior. Finally, we confirmed that BIC and AIC can detect the correct number of clusters.</p>
    <p>We illustrated that ChromDMM identifies clusters with distinct epigenetic patterns when applied to ENCODE data containing 10 chromatin features quantified at enhancers. Moreover, the identified clusters are enriched for different sets of TRFs, suggesting that the clusters may vary in their biological characteristics. ChromDMM may therefore be a valuable method to reveal potential functionally distinct subclasses of regulatory elements.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btac444_Supplementary_Data</label>
      <media xlink:href="btac444_supplementary_data.zip">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We thank Dr. Romain Groux for providing an implementation of the ChIP-Partitioning method. We acknowledge computer resources provided by the Aalto University School of Science ‘Science-IT’ project.</p>
    <sec>
      <title>Funding</title>
      <p>This work has been supported by the Academy of Finland (314445, 311584) and the Finnish Cultural Foundation.</p>
      <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
    </sec>
    <sec sec-type="data-availability">
      <title>Data availability</title>
      <p>This study was a re-analysis of existing ENCODE data, which is openly available for unrestricted use. ENCODE accession numbers of files and datasets with direct weblinks are provided in the online supplementary material. The data from the analysis presented in this study will be shared on reasonable request to the corresponding author.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btac444-B1">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Akaike</surname><given-names>H.</given-names></string-name></person-group> (<year>1973</year>) <part-title>Information theory and an extensionof the maximum likelihood principle</part-title>. In <person-group person-group-type="editor"><string-name><surname>Petrov</surname><given-names>B.</given-names></string-name>, <string-name><surname>Csaki</surname><given-names>F.</given-names></string-name></person-group> (eds) <source>Second International Symposium on Information Theory</source>. <publisher-name>Akademiai Kiado</publisher-name>, <publisher-loc>Budabest, Hungary</publisher-loc>, pp. <fpage>267</fpage>–<lpage>281</lpage>.</mixed-citation>
    </ref>
    <ref id="btac444-B2">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Bishop</surname><given-names>C.M.</given-names></string-name></person-group> (<year>2006</year>) <source>Pattern Recognition and Machine Learning (Information Science and Statistics)</source>. <publisher-name>Springer-Verlag</publisher-name>, <publisher-loc>Berlin, Heidelberg</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="btac444-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Boyle</surname><given-names>A.P.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2008</year>) <article-title>High-resolution mapping and characterization of open chromatin across the genome</article-title>. <source>Cell</source>, <volume>132</volume>, <fpage>311</fpage>–<lpage>322</lpage>.<pub-id pub-id-type="pmid">18243105</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Broyden</surname><given-names>C.G.</given-names></string-name></person-group> (<year>1970</year>) <article-title>The convergence of a class of double-rank minimization algorithms. 1. General considerations</article-title>. <source>IMA J. Appl. Math</source>., <volume>6</volume>, <fpage>76</fpage>–<lpage>90</lpage>.</mixed-citation>
    </ref>
    <ref id="btac444-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Groux</surname><given-names>R.</given-names></string-name>, <string-name><surname>Bucher</surname><given-names>P.</given-names></string-name></person-group> (<year>2019</year>) <article-title>SPar-K: a method to partition NGS signal data</article-title>. <source>Bioinformatics</source>, <volume>35</volume>, <fpage>4440</fpage>–<lpage>4441</lpage>.<pub-id pub-id-type="pmid">31116370</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>He</surname><given-names>Q.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>ChIP-nexus enables improved detection of in vivo transcription factor binding footprints</article-title>. <source>Nat. Biotechnol</source>., <volume>33</volume>, <fpage>395</fpage>–<lpage>401</lpage>.<pub-id pub-id-type="pmid">25751057</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Heger</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) <article-title>GAT: a simulation framework for testing the association of genomic intervals</article-title>. <source>Bioinformatics</source>, <volume>29</volume>, <fpage>2046</fpage>–<lpage>2048</lpage>.<pub-id pub-id-type="pmid">23782611</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Heintzman</surname><given-names>N.D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2007</year>) <article-title>Distinct and predictive chromatin signatures of transcriptional promoters and enhancers in the human genome</article-title>. <source>Nat. Genet</source>., <volume>39</volume>, <fpage>311</fpage>–<lpage>318</lpage>.<pub-id pub-id-type="pmid">17277777</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Holmes</surname><given-names>I.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>Dirichlet multinomial mixtures: generative models for microbial metagenomics</article-title>. <source>PLoS ONE</source>, <volume>7</volume>, <fpage>e30126</fpage>.<pub-id pub-id-type="pmid">22319561</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hon</surname><given-names>G.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2008</year>) <article-title>ChromaSig: a probabilistic approach to finding common chromatin signatures in the human genome</article-title>. <source>PLoS Comput. Biol</source>., <volume>4</volume>, <fpage>e1000201</fpage>.<pub-id pub-id-type="pmid">18927605</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kundaje</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>Ubiquitous heterogeneity and asymmetry of the chromatin environment at regulatory elements</article-title>. <source>Genome Res</source>., <volume>22</volume>, <fpage>1735</fpage>–<lpage>1747</lpage>.<pub-id pub-id-type="pmid">22955985</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B12">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>MacKay</surname><given-names>D.J.</given-names></string-name></person-group> (<year>2003</year>) <source>Information Theory, Inference, and Learning Algorithms</source>. <publisher-name>Cambridge University Press</publisher-name>, <publisher-loc>New York, USA</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="btac444-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mardis</surname><given-names>E.R.</given-names></string-name></person-group> (<year>2007</year>) <article-title>ChIP-seq: welcome to the new frontier</article-title>. <source>Nat. Methods</source>, <volume>4</volume>, <fpage>613</fpage>–<lpage>613</lpage>.<pub-id pub-id-type="pmid">17664943</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nair</surname><given-names>N.U.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) <article-title>Probabilistic partitioning methods to find significant patterns in ChIP-Seq data</article-title>. <source>Bioinformatics</source>, <volume>30</volume>, <fpage>2406</fpage>–<lpage>2413</lpage>.<pub-id pub-id-type="pmid">24812341</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nayler</surname><given-names>O.</given-names></string-name></person-group>  <etal>et al</etal> (<year>1998</year>) <article-title>SAF-B protein couples transcription and pre-mRNA splicing to SAR/MAR elements</article-title>. <source>Nucleic Acids Res</source>., <volume>26</volume>, <fpage>3542</fpage>–<lpage>3549</lpage>.<pub-id pub-id-type="pmid">9671816</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nielsen</surname><given-names>F.G.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>CATCHprofiles: clustering and alignment tool for ChIP profiles</article-title>. <source>PLoS ONE</source>, <volume>7</volume>, <fpage>e28272</fpage>.<pub-id pub-id-type="pmid">22238575</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Osmala</surname><given-names>M.</given-names></string-name>, <string-name><surname>Lähdesmäki</surname><given-names>H.</given-names></string-name></person-group> (<year>2020</year>) <article-title>Enhancer prediction in the human genome by probabilistic modelling of the chromatin feature patterns</article-title>. <source>BMC Bioinformatics</source>, <volume>21</volume>, <fpage>1</fpage>–<lpage>37</lpage>.<pub-id pub-id-type="pmid">31898485</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Park</surname><given-names>P.J.</given-names></string-name></person-group> (<year>2009</year>) <article-title>ChIP–seq: advantages and challenges of a maturing technology</article-title>. <source>Nat. Rev. Genet</source>., <volume>10</volume>, <fpage>669</fpage>–<lpage>680</lpage>.<pub-id pub-id-type="pmid">19736561</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rhee</surname><given-names>H.S.</given-names></string-name>, <string-name><surname>Pugh</surname><given-names>B.F.</given-names></string-name></person-group> (<year>2011</year>) <article-title>Comprehensive genome-wide protein–DNA interactions detected at single-nucleotide resolution</article-title>. <source>Cell</source>, <volume>147</volume>, <fpage>1408</fpage>–<lpage>1419</lpage>.<pub-id pub-id-type="pmid">22153082</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Robinson</surname><given-names>M.D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2010</year>) <article-title>edgeR: a bioconductor package for differential expression analysis of digital gene expression data</article-title>. <source>Bioinformatics</source>, <volume>26</volume>, <fpage>139</fpage>–<lpage>140</lpage>.<pub-id pub-id-type="pmid">19910308</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schwarz</surname><given-names>G.</given-names></string-name></person-group> (<year>1978</year>) <article-title>Estimating the dimension of a model</article-title>. <source>Ann. Statist</source>., <volume>6</volume>, <fpage>461</fpage>–<lpage>464</lpage>.</mixed-citation>
    </ref>
    <ref id="btac444-B22">
      <mixed-citation publication-type="journal">The ENCODE Project Consortium. (<year>2012</year>) <article-title>An integrated Encyclopedia of DNA elements in the human genome</article-title>. <source>Nature</source>, <volume>489</volume>, <fpage>57</fpage>–<lpage>74</lpage>.<pub-id pub-id-type="pmid">22955616</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yamada</surname><given-names>N.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) <article-title>Characterizing protein–DNA binding event subtypes in ChIP-exo data</article-title>. <source>Bioinformatics</source>, <volume>35</volume>, <fpage>903</fpage>–<lpage>913</lpage>.<pub-id pub-id-type="pmid">30165373</pub-id></mixed-citation>
    </ref>
    <ref id="btac444-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ye</surname><given-names>T.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2011</year>) <article-title>seqMINER: an integrated ChIP-seq data interpretation platform</article-title>. <source>Nucleic Acids Res</source>., <volume>39</volume>, <fpage>e35</fpage>.<pub-id pub-id-type="pmid">21177645</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
