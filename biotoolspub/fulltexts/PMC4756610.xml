<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Acta Crystallogr D Struct Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Acta Crystallogr D Struct Biol</journal-id>
    <journal-id journal-id-type="publisher-id">Acta Cryst. D</journal-id>
    <journal-title-group>
      <journal-title>Acta Crystallographica. Section D, Structural Biology</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2059-7983</issn>
    <publisher>
      <publisher-name>International Union of Crystallography</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4756610</article-id>
    <article-id pub-id-type="publisher-id">dz5393</article-id>
    <article-id pub-id-type="doi">10.1107/S2059798315024730</article-id>
    <article-id pub-id-type="coden">ACSDAD</article-id>
    <article-id pub-id-type="pii">S2059798315024730</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Papers</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><italic>Fitmunk</italic>: improving protein structures by accurate, automatic modeling of side-chain conformations</article-title>
      <alt-title>
        <italic>Fitmunk</italic>
      </alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Porebski</surname>
          <given-names>Przemyslaw Jerzy</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Cymborowski</surname>
          <given-names>Marcin</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pasenkiewicz-Gierula</surname>
          <given-names>Marta</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Minor</surname>
          <given-names>Wladek</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="corresp" rid="cor">*</xref>
      </contrib>
      <aff id="a"><label>a</label>Department of Molecular Physiology and Biological Physics, <institution>University of Virginia</institution>, Jordan Hall, 1340 Jefferson Park Avenue, Charlottesville, VA 22908, <country>USA</country></aff>
      <aff id="b"><label>b</label>Faculty of Biochemistry, Biophysics and Biotechnology, <institution>Jagiellonian University</institution>, ul. Gronostajowa 7, 30-387 Kraków, <country>Poland</country></aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor">Correspondence e-mail: <email>wladek@iwonka.med.virginia.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>01</day>
      <month>2</month>
      <year>2016</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>28</day>
      <month>1</month>
      <year>2016</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>28</day>
      <month>01</month>
      <year>2016</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and
						0 days and was based on the <pub-date
						pub-type="epub"/>. -->
    <volume>72</volume>
    <issue>Pt 2</issue>
    <issue-id pub-id-type="publisher-id">d160200</issue-id>
    <fpage>266</fpage>
    <lpage>280</lpage>
    <history>
      <date date-type="received">
        <day>29</day>
        <month>10</month>
        <year>2015</year>
      </date>
      <date date-type="accepted">
        <day>23</day>
        <month>12</month>
        <year>2015</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© Porebski et al. 2016</copyright-statement>
      <copyright-year>2016</copyright-year>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0/uk/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution Licence, which permits
unrestricted use, distribution, and reproduction in any medium, provided the original authors and source are cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:type="simple" xlink:href="http://dx.doi.org/10.1107/S2059798315024730">A full version of this article is available from Crystallography Journals Online.</self-uri>
    <abstract abstract-type="toc">
      <p>A new method for automatic modeling of side-chain conformations that takes advantage of rotamer-prediction methods in a crystallographic context can improve the accuracy and validity of crystallographic models.</p>
    </abstract>
    <abstract>
      <p>Improvements in crystallographic hardware and software have allowed automated structure-solution pipelines to approach a near-‘one-click’ experience for the initial determination of macromolecular structures. However, in many cases the resulting initial model requires a laborious, iterative process of refinement and validation. A new method has been developed for the automatic modeling of side-chain conformations that takes advantage of rotamer-prediction methods in a crystallographic context. The algorithm, which is based on deterministic dead-end elimination (DEE) theory, uses new dense conformer libraries and a hybrid energy function derived from experimental data and prior information about rotamer frequencies to find the optimal conformation of each side chain. In contrast to existing methods, which incorporate the electron-density term into protein-modeling frameworks, the proposed algorithm is designed to take advantage of the highly discriminatory nature of electron-density maps. This method has been implemented in the program <italic>Fitmunk</italic>, which uses extensive conformational sampling. This improves the accuracy of the modeling and makes it a versatile tool for crystallographic model building, refinement and validation. <italic>Fitmunk</italic> was extensively tested on over 115 new structures, as well as a subset of 1100 structures from the PDB. It is demonstrated that the ability of <italic>Fitmunk</italic> to model more than 95% of side chains accurately is beneficial for improving the quality of crystallographic protein models, especially at medium and low resolutions. <italic>Fitmunk</italic> can be used for model validation of existing structures and as a tool to assess whether side chains are modeled optimally or could be better fitted into electron density. <italic>Fitmunk</italic> is available as a web service at <ext-link ext-link-type="uri" xlink:href="http://kniahini.med.virginia.edu/fitmunk/server/">http://kniahini.med.virginia.edu/fitmunk/server/</ext-link> or at <ext-link ext-link-type="uri" xlink:href="http://fitmunk.bitbucket.org/">http://fitmunk.bitbucket.org/</ext-link>.</p>
    </abstract>
    <kwd-group>
      <kwd>side-chain fitting</kwd>
      <kwd>validation</kwd>
      <kwd>structure building</kwd>
      <kwd>refinement</kwd>
      <kwd>automation</kwd>
    </kwd-group>
  </article-meta>
</front>
<body>
  <sec id="sec1">
    <label>1.</label>
    <title>Introduction   </title>
    <p>Macromolecular crystallography (MX) is a major tool for determining the atomic structures of proteins and protein complexes (Berman <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb7"> ▸</xref>). The structures determined by MX are a central part of protein function studies (Richardson &amp; Richardson, 2014<xref ref-type="bibr" rid="bb44"> ▸</xref>). The current methodology is very robust and allows the determination of structures of macromolecules of all sizes: from small structures of enzymes (Blake <italic>et al.</italic>, 1965<xref ref-type="bibr" rid="bb9"> ▸</xref>; Matthews <italic>et al.</italic>, 1967<xref ref-type="bibr" rid="bb33"> ▸</xref>) to huge assemblies such as virus capsids (Harrison <italic>et al.</italic>, 1978<xref ref-type="bibr" rid="bb23"> ▸</xref>; Abad-Zapatero <italic>et al.</italic>, 1980<xref ref-type="bibr" rid="bb1"> ▸</xref>), ribosomes (Ban <italic>et al.</italic>, 2000<xref ref-type="bibr" rid="bb5"> ▸</xref>; Schluenzen <italic>et al.</italic>, 2000<xref ref-type="bibr" rid="bb45"> ▸</xref>; Wimberly <italic>et al.</italic>, 2000<xref ref-type="bibr" rid="bb57"> ▸</xref>) and vault particles (Tanaka <italic>et al.</italic>, 2009<xref ref-type="bibr" rid="bb52"> ▸</xref>). Information that can be derived from crystal structures also ranges from single protein–small molecule interactions (Wall <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb56"> ▸</xref>; Porebski <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb41"> ▸</xref>), through the determinants of protein complex formation (Buckle <italic>et al.</italic>, 1994<xref ref-type="bibr" rid="bb10"> ▸</xref>; Niedzial­kowska <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb37"> ▸</xref>), to the mechanistic behavior of molecular factories (Abrahams <italic>et al.</italic>, 1994<xref ref-type="bibr" rid="bb2"> ▸</xref>). The widespread application of structural data determined by MX in many different fields has made the technique instrumental to many discoveries.</p>
    <p>To facilitate the widespread use of MX, in some cases by scientists who are not experts in structural biology, an enormous effort has been put into the development of easy-to-use, nearly automated software that aids researchers during the process of data reduction (Otwinowski <italic>et al.</italic>, 2003<xref ref-type="bibr" rid="bb38"> ▸</xref>; Kabsch, 2010<xref ref-type="bibr" rid="bb27"> ▸</xref>) and crystal structure determination and refinement (Panjikar <italic>et al.</italic>, 2005<xref ref-type="bibr" rid="bb39"> ▸</xref>; Minor <italic>et al.</italic>, 2006<xref ref-type="bibr" rid="bb34"> ▸</xref>; Sheldrick, 2008<xref ref-type="bibr" rid="bb49"> ▸</xref>; Winn <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb58"> ▸</xref>; Adams <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb3"> ▸</xref>). Progress in software has made MX accessible to many noncrystallographers by providing automated and semi-automated pipelines that sometimes approach a ‘one-click’ experience for structure determination and initial model building (Wlodawer <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb59"> ▸</xref>). This has allowed MX to play an increasingly pivotal role in various biomedical and biological research areas (Berman <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb7"> ▸</xref>; Giegé, 2013<xref ref-type="bibr" rid="bb20"> ▸</xref>; Richardson &amp; Richardson, 2014<xref ref-type="bibr" rid="bb44"> ▸</xref>), and results in a constantly growing flux of new structures deposited into the Protein Data Bank (PDB; Berman <italic>et al.</italic>, 2000<xref ref-type="bibr" rid="bb8"> ▸</xref>).</p>
    <p>The accelerating expansion of the PDB has led to the development of various new tools for structural bioinformatics and data mining, which has resulted in new methods for structure validation that have recently been standardized and applied to the whole repository (Read <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb43"> ▸</xref>). Regardless, there are many structures, both old and newly deposited, of suboptimal quality in terms of model correctness and model-to-data correspondence (Cooper <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb14"> ▸</xref>; Pozharski <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb42"> ▸</xref>; Shabalin <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb46"> ▸</xref>). There are several possible approaches to reduce the number of problems with protein model quality. Examples of these approaches include automated validation, in which users are alerted about problems during refinement (Urzhumtseva <italic>et al.</italic>, 2009<xref ref-type="bibr" rid="bb55"> ▸</xref>; Cymborowski <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb15"> ▸</xref>), improvement of software in an attempt to eliminate problems prior to human involvement (Headd <italic>et al.</italic>, 2009<xref ref-type="bibr" rid="bb24"> ▸</xref>; Bell <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb6"> ▸</xref>), or re-refinement using automated, state-of-the-art tools, improving even legacy structures (Joosten <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb25"> ▸</xref>), although automatic re-refinement still has its limitations (Chruszcz <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb12"> ▸</xref>).</p>
    <p>Here, we present <italic>Fitmunk</italic>, a new program for the automatic building of amino-acid side chains in protein crystal structures. <italic>Fitmunk</italic> can be used at various stages: model building, model refinement, and the validation and re-refinement of protein models. We expect that wide use of <italic>Fitmunk</italic> will significantly improve the quality of crystallographic models and thus the reproducibility of electron-density map interpretation.</p>
    <p>The problem of building a crystallographic model is comparable to theoretical protein modeling, and many of the algorithms used in this field have been adapted to crystallography. A current and very successful example of such an adaptation is <italic>Rosetta</italic>. The development of molecular-replacement protocols using <italic>Rosetta</italic> utilizing electron density to rebuild models has been instrumental in solving otherwise unsolvable structures (DiMaio <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb16"> ▸</xref>). Because the problem of theor­etical protein modeling can be divided into several parts, <italic>e.g.</italic> protein backbone modeling and side-chain packing, algorithms and programs have been developed exclusively for these specific tasks. An example of a specialized program for side-chain conformation modeling that can be used in protein crystallography is <italic>MUMBO</italic> (Stiebritz &amp; Muller, 2006<xref ref-type="bibr" rid="bb51"> ▸</xref>), which uses a set of deterministic algorithms based on dead-end elimination (DEE) theory (Goldstein, 1994<xref ref-type="bibr" rid="bb21"> ▸</xref>) combined with stochastic sampling to solve the combinatorial problem.</p>
    <p>Both generalized (such as <italic>Rosetta</italic> or <italic>RAPPER</italic>; Furnham <italic>et al.</italic>, 2006<xref ref-type="bibr" rid="bb19"> ▸</xref>) and specialized (such as <italic>MUMBO</italic>) protein structure-prediction programs use the same conceptual framework for theoretical modeling and crystallographic model building; in the latter case, the fit to the electron density is added as an additional term in their energy functions. In both cases, the set of algorithms used to solve the combinatorial problem is the same. Our program <italic>Fitmunk</italic> uses a slightly different approach. While it is based on DEE theory, we have developed new algorithms designed specifically for building crystallographic models that rely on the highly discriminatory nature of electron-density maps. These algorithms allow <italic>Fitmunk</italic> to use extensive conformational sampling, which improves the accuracy of the modeling, and makes the software a versatile tool for crystallographic model building, refinement and validation.</p>
  </sec>
  <sec id="sec2">
    <label>2.</label>
    <title>Methods   </title>
    <p>Electron-density maps derived from experimental X-ray diffraction data can provide very descriptive information about the position of optimal amino-acid side-chain conformations. Unfortunately, for several reasons, including the inadequate quality of many crystals, a lack of high-resolution data and/or incomplete phases, protein electron-density maps are often noisy. To address this issue, the developed algorithm leverages information obtained from electron-density maps and supplements it with prior information about the distribution of amino-acid side-chain conformers. The algorithm used by <italic>Fitmunk</italic> comprises three components: an energy function, conformer libraries and a DEE-based search and collision-resolution algorithm (Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref>), which are described in detail in the following sections.</p>
    <sec id="sec2.1">
      <label>2.1.</label>
      <title>Energy function   </title>
      <p>In <italic>Fitmunk</italic>, the total energy of the system is expressed as<disp-formula id="fd1"><graphic xlink:href="d-72-00266-efd1.jpg" mimetype="image" mime-subtype="gif" position="float"/></disp-formula>where <bold>C</bold>
<sub>s</sub> specifies a tuple of single conformations for each of the <italic>N</italic> residues of the polypeptide and <italic>c</italic>
<sub><italic>i</italic>,<italic>s</italic></sub> is the <italic>s</italic>th conformation of the <italic>i</italic>th residue. <italic>E</italic>
<sub>self</sub> is the self-energy of each conformation, which is defined as<disp-formula id="fd2"><graphic xlink:href="d-72-00266-efd2.jpg" mimetype="image" mime-subtype="gif" position="float"/></disp-formula>The first term is the energy of conformation <italic>s</italic> fitted to electron density <italic>D</italic>(<italic>c</italic>
<sub><italic>i</italic>,<italic>s</italic></sub>) relative to the best-fitting conformation of the same residue [max<sub><italic>n</italic></sub>
<italic>D</italic>(<italic>c</italic>
<sub><italic>i</italic>,<italic>n</italic></sub>)]. The second term is the energy of the frequency of conformation <italic>s</italic>, <italic>p</italic>(<italic>c</italic>
<sub><italic>i</italic>,<italic>s</italic></sub>), relative to the most frequent conformation of the residue from the library [max<sub><italic>n</italic></sub>
<italic>p</italic>(<italic>c</italic>
<sub><italic>i</italic>,<italic>n</italic></sub>)] and the third term is the energy of interaction of the residue in the given conformation with the protein backbone. Similar to the approach of Krivov and coworkers, weighting coefficients <italic>w</italic>
<sub>d</sub> and <italic>w</italic>
<sub>p</sub> are used for the density-fit and frequency terms, respectively (Krivov <italic>et al.</italic>, 2009<xref ref-type="bibr" rid="bb28"> ▸</xref>). These weighting terms are allowed to be dependent on resolution (for <italic>w</italic>
<sub>d</sub>) or resolution and residue type (for <italic>w</italic>
<sub>p</sub>).</p>
      <p>The following function is used in <italic>Fitmunk</italic> to score the fit of conformation <italic>s</italic> to electron density:<disp-formula id="fd3"><graphic xlink:href="d-72-00266-efd3.jpg" mimetype="image" mime-subtype="gif" position="float"/></disp-formula>ρ′(<italic>a</italic>) is the value of the electron density for atom <italic>a</italic> sampled at point <italic>a</italic> and at six points around it positioned along each of the axes at distance <italic>r</italic>, averaged and normalized <italic>versus</italic> the r.m.s.d. of the electron-density values. The purpose of introducing a penalty threshold (<italic>k</italic>
<sub>t</sub>) and a penalty factor (<italic>k</italic>
<sub>f</sub>) is to preferentially score conformations that lie in continuous electron density with a level higher than <italic>k</italic>
<sub>t</sub>. <italic>k</italic>
<sub>t</sub>, <italic>k</italic>
<sub>f</sub> and <italic>r</italic> are allowed to be dependent on the resolution of the diffraction data. Additionally, penalties are residue type-dependent. Other forms of this function have not been extensively tested; however, the form in (3)<xref ref-type="disp-formula" rid="fd3"/> gave satisfactory results after the training of penalty parameters. Furthermore, any limitations of this function to reduce the number of potential collisions will be compensated by the collision-resolution step.</p>
      <p>The frequency of conformation <italic>s</italic>, <italic>p</italic>(<italic>c</italic>
<sub><italic>i</italic>,<italic>s</italic></sub>), is calculated on the basis of the backbone-independent (son of) Penultimate Rotamer Library (Lovell <italic>et al.</italic>, 2003<xref ref-type="bibr" rid="bb30"> ▸</xref>), which provides a probability distribution of side-chain conformations filtered similarly to the Penultimate Rotamer Library (Lovell <italic>et al.</italic>, 2000<xref ref-type="bibr" rid="bb31"> ▸</xref>). This library is used to assign a frequency of occurrence to each conformation present in the conformer library used by <italic>Fitmunk</italic>. The frequencies of conformations from <italic>Fitmunk</italic>’s library are calculated by interpolating values from frequency sampling provided by Lovell’s library using an inverse-distance weighting method. The obtained values are normalized, so the sum of frequencies for all conformations of a given side chain equals one.</p>
      <p>The final term of the self-energy function is the interaction energy between a side chain in a given conformation and the backbone [<italic>E</italic>
<sub>backbone</sub>(<italic>c</italic>
<sub><italic>i</italic>,<italic>s</italic></sub>)]. Nonbonded interactions are represented through Coulomb and Lennard–Jones terms using parameters from the OPLS united-atom force field (Jorgensen &amp; Tirado-Rives, 1988<xref ref-type="bibr" rid="bb26"> ▸</xref>). To calculate interactions for each side-chain conformation, additional conformations with polar H atoms are generated. H atoms are added using the same geometric criteria as used by <italic>REDUCE</italic> (Word <italic>et al.</italic>, 1999<xref ref-type="bibr" rid="bb60"> ▸</xref>). For rotatable H atoms, <italic>X</italic>—<italic>X</italic>—O—H torsion angles are set to −60, 60 and 180° for Ser and Thr and to 0 and 180° for Tyr. All three protonation states for His are used.</p>
      <p>The second term in the total energy function in (1)<xref ref-type="disp-formula" rid="fd1"/> [<inline-formula><inline-graphic xlink:href="d-72-00266-efi1.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>] describes the pairwise interaction energy between single conformations of residues, for which only the nonbonded term is used, as described above.</p>
    </sec>
    <sec id="sec2.2">
      <label>2.2.</label>
      <title>Conformer libraries   </title>
      <p>To generate dense conformer libraries, all depositions from the PDB that (i) contained polypeptides longer than ten amino acids, (ii) were deposited together with structure factors between 10 April 2007 and 10 April 2013 and (iii) have a resolution better than 1.8 Å were selected. <italic>R</italic> and <italic>R</italic>
<sub>free</sub> factors were recalculated and 2<italic>mF</italic>
<sub>o</sub> − <italic>DF</italic>
<sub>c</sub> and <italic>mF</italic>
<sub>o</sub> − <italic>DF</italic>
<sub>c</sub> maps were generated using <italic>REFMAC</italic>5 (v.5.7.0029) without any cycles of refinement (Murshudov <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb35"> ▸</xref>). To ensure that the maps to be used for further analysis were recalculated correctly, only those depositions where the recalculated <italic>R</italic> and <italic>R</italic>
<sub>free</sub> factors were within 10% difference from the values reported in the PDB were accepted, with one exception as listed below. For example, a deposition with a recalculated <italic>R</italic>
<sub>free</sub> of 0.22 was accepted if the reported <italic>R</italic>
<sub>free</sub> was 0.20. Depositions that had recalculated <italic>R</italic> and <italic>R</italic>
<sub>free</sub> factors that were both lower than the reported values by more than 10% were also accepted if the difference between the recalculated <italic>R</italic>
<sub>free</sub> and <italic>R</italic> factors was lower than 0.05. Redundancy was removed from the set of accepted depositions by selecting the structure of the highest resolution from each cluster of structures with pairwise identity greater than 40% as clustered by <italic>BLAST</italic> (Altschul <italic>et al.</italic>, 1990<xref ref-type="bibr" rid="bb4"> ▸</xref>) and provided by the PDB.</p>
      <p>Only one chain of a given polypeptide sequence was taken from each deposition. When multiple conformations of a single residue were present, the one with the higher occupancy, or the lower atomic displacement parameters if the occupancies were equal, was selected. 2241 nonredundant chains comprising 438 109 residues were taken for further analysis.</p>
      <p>To improve the quality of the conformer libraries, the following side-chain conformations were excluded: those that formed significant ‘clashes’ (<italic>i.e.</italic> van der Waals radii overlaps of greater than 0.4 Å), those that were modeled without significant experimental data (2<italic>mF</italic>
<sub>o</sub> − <italic>DF</italic>
<sub>c</sub> map value for side chain or main chain with <italic>EDSTATS</italic>
<italic>Z</italic>-score lower than 1) or those that model the experimental data poorly (significant peaks in the <italic>mF</italic>
<sub>o</sub> − <italic>DF</italic>
<sub>c</sub> map with <italic>Z</italic>-score &gt;3 or &lt;−3). Clashes and map significance values were calculated using <italic>MolProbity</italic> v.3.14.080821 (Chen <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb11"> ▸</xref>) and <italic>EDSTATS</italic> v.0.5 (Tickle, 2012<xref ref-type="bibr" rid="bb54"> ▸</xref>), respectively. Of 438 109 collected residues, 41 472 were excluded owing to insignificant or misinterpreted electron density. A further 60 387 residues were excluded owing to clashes and 5608 other residues were incomplete, leaving 330 642 for further analysis. The atomic nomenclature of symmetric residues (Arg, Asp, Glu, Phe and Tyr) was normalized by swapping the names of symmetric atoms if particular torsion angles (χ<sub>1</sub> for Asp, χ<sub>2</sub> for Glu, Phe and Tyr and χ<sub>5</sub> for Arg) were outside the range −90 to 90°. Pseudo-chiral residues (Leu and Val) were normalized by swapping the names of equivalent atoms if their ‘chirality’ was reversed. Thr and Ile residues with incorrect chirality were excluded from analysis. For the purpose of clustering, Asn, Gln and His residues were treated as symmetric by applying the same rules as used for symmetric residues and swapping the identities of the atoms of the amide group or imidazole ring. H atoms were removed if present. To remove redundancy at the conformational level, depositions were processed starting from the highest resolution structures, and a new conformation was added to the data set if the r.m.s.d. between the analyzed conformation and previously collected conformations was higher than 0.1 Å (calculated after superimposing the main-chain N, C<sup>α</sup> and C atoms and measuring deviations over all side-chain atoms excluding C<sup>β</sup>).</p>
      <p>Even after filtering out conformations with steric clashes or that have poor fit to electron density, conformations that significantly violated known chemical rules were observed. Therefore, these conformations, specifically those that violated the Engh and Huber target values (Engh &amp; Huber, 2001<xref ref-type="bibr" rid="bb18"> ▸</xref>) by more than 6σ, were filtered out. Conformers where the position of C<sup>β</sup> differed by more than 5σ from the mean were also excluded. Finally, we visually inspected conformers that were observed only once and removed serious outliers.</p>
      <p>We call this nonredundant filtered data set cl0.1. It contains 83 042 conformations and is a very dense conformer library, which in most cases is too complex for direct use in side-chain conformation modeling. This data set was further clustered using hierarchical agglomerative clustering using the r.m.s.d. of all side-chain atoms (excluding C<sup>β</sup>) as a distance metric, and the maximum linkage criterion as implemented in the <italic>hcluster</italic> Python package (Eads, 2008<xref ref-type="bibr" rid="bb17"> ▸</xref>). A medoid (the conformation with the smallest sum of r.m.s.d. values between itself and all other conformations in a cluster, weighted by the number of occurrences of each conformation) was selected as a representative conformation for a given cluster. A library that is referred to as cl<italic>X</italic> contains representative conformations, each of which represents a cluster of conformations with a maximum pairwise r.m.s.d. lower than or equal to <italic>X</italic> Å.</p>
      <p>Based on the hierarchical clustering process, it is possible to create conformer libraries with lower complexity (<italic>e.g.</italic> cl1.0), which can be dynamically expanded to denser ones (<italic>e.g.</italic> cl0.5). The positions of atoms from all conformations and linkage data are stored in a file in HDF5 format (The HDF Group; <ext-link ext-link-type="uri" xlink:href="http://www.hdfgroup.org/HDF5/">http://www.hdfgroup.org/HDF5/</ext-link>), which is designed for fast retrieval.</p>
    </sec>
    <sec id="sec2.3">
      <label>2.3.</label>
      <title>Dead-end elimination algorithm, collision detection and resolution   </title>
      <p>To utilize the complex conformer libraries, it was necessary to design a three-step algorithm (Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref>) with decreasing conformational complexity at each step of the search process. A simplified variant of the self-energy function in (2)<xref ref-type="disp-formula" rid="fd2"/>, where the nonbonded energy term <italic>E</italic>
<sub>backbone</sub>(<italic>c</italic>
<sub><italic>i</italic>,<italic>s</italic></sub>) is removed, is used in the first and second stages to perform faster calculations. In the third stage, however, after reducing the overall complexity in the first two steps, the full energy function in (2)<xref ref-type="disp-formula" rid="fd2"/> is used as described above. During the first two stages of the search, conformations which form close contacts (clashes) with either the protein backbone (first stage) or other modeled conformations (second stage) are removed. Incorporation of a check for steric clashes was necessary because the simplified self-energy function does not contain any repulsive terms that penalize close contacts. It is possible to represent the energy function with clash elimination as<disp-formula id="fd4"><graphic xlink:href="d-72-00266-efd4.jpg" mimetype="image" mime-subtype="gif" position="float"/></disp-formula>
</p>
      <p>A <italic>k</italic>-d tree is used to search for main-chain or C<sup>β</sup> atoms that are nearest to the given conformation. The distance cutoff <italic>r</italic> at which distance a conformation is marked as clashing with the backbone depends on the identities of the pair of evaluated atoms. These cutoff distances are calculated as the first percentiles of distances observed in the protein structures that were used for extracting conformations and may be adjusted by a user-selectable distance. By default, these distances are reduced by 0.3 Å to compensate for main-chain position errors during model building. <italic>Fitmunk</italic> also provides an option to remove conformations that clash with other modeled nonproteinaceous waters, ions or small molecules with their own distance thresholds. Not every conformation is evaluated for clashes, because for purposes of efficiency ‘lazy’ evaluation is used, <italic>i.e.</italic> a conformation is only assessed for clashes when it is selected. If the lowest energy conformation does not form clashes, no further conformations are evaluated. In the first stage, clashes between side chains are not considered; therefore, according to (4)<xref ref-type="disp-formula" rid="fd4"/>, the total energy of the conformation is equal to <italic>E</italic>
<sub>self_<italic>x</italic></sub>. This is a special case of the DEE theory. For example, the Goldstein elimination criterion becomes the simple selection of the conformation with the lowest <italic>E</italic>
<sub>self_<italic>x</italic></sub>, <disp-formula id="fd5"><graphic xlink:href="d-72-00266-efd5.jpg" mimetype="image" mime-subtype="gif" position="float"/></disp-formula>
</p>
      <p>At this point, most of the conformations of the core residues at high and medium resolutions will be properly placed, but several residues will form clashes either inside the asymmetric unit and/or with crystallographically related copies. These collisions are resolved in the second stage.</p>
      <p>At the collision-resolution step (the second stage), the simplified energy function in (4)<xref ref-type="disp-formula" rid="fd4"/> is used as well. Its advantage is that its value does not depend on pairwise interactions, except for colliding conformations. Because colliding conformations are excluded, it is therefore easy to calculate lower energy bounds that can be used as an additional eliminating criterion. For conformations without collisions the elimination criterion becomes<disp-formula id="fd6"><graphic xlink:href="d-72-00266-efd6.jpg" mimetype="image" mime-subtype="gif" position="float"/></disp-formula>
</p>
      <p>Here, the term is calculated with the remaining residues in ‘compatible’ (<italic>i.e.</italic> nonclashing) conformations and it is always equal to or higher than <italic>E</italic>
<sub>low</sub>(·), which is calculated with the remaining residues adopting a conformation with the lowest possible energy, disregarding any clashes. Therefore, it is possible to introduce an elimination criterion based on this lower bound,<disp-formula id="fd7"><graphic xlink:href="d-72-00266-efd7.jpg" mimetype="image" mime-subtype="gif" position="float"/></disp-formula>Although this criterion is weaker (permitting more conformations to pass) than (6)<xref ref-type="disp-formula" rid="fd6"/>, the advantage of (7)<xref ref-type="disp-formula" rid="fd7"/> is that it is possible to eliminate all remaining conformations in a ranked data set if one reaches a conformation that has <italic>E</italic>
<sub>low</sub>(<italic>c</italic>
<sub><italic>i</italic>,<italic>s</italic></sub>) &gt; <italic>E</italic>
<sub>self</sub>(<italic>c</italic>
<sub><italic>i</italic>,<italic>t</italic></sub>), where <italic>c</italic>
<sub><italic>i</italic>,<italic>t</italic></sub> is the conformation which gives the lowest energy so far, without actually calculating any collisions.</p>
      <p>To find and resolve collisions, a directed graph is used to describe the relationship between different conformations (nodes <italic>v</italic>, <italic>w</italic>) of one residue [horizontal edges <italic>e</italic>
<sub>h</sub>(<italic>v</italic>
<sub><italic>i</italic></sub>, <italic>v</italic>
<sub><italic>i</italic>+1</sub>)] and the dependency of the conformation of one residue on the conformation of another [vertical edges <italic>e</italic>
<sub>v</sub>(<italic>v</italic>
<sub><italic>i</italic></sub>, <italic>w</italic>|<italic>v<sub>i</sub></italic>)]. In such a graph, each node has a maximum of two outgoing edges: <italic>e</italic>
<sub>v</sub> and <italic>e</italic>
<sub>h</sub>. The A* search algorithm is used to explore this graph (Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>). Each residue is assigned the lowest energy conformation from the first stage and these conformations are then checked for collisions. To detect collisions between all symmetry-related copies it is necessary to recreate all 27 unit cells. To reduce the complexity of the problem, a bounding sphere around the current conformation of each residue is calculated, the sphere centres are transformed to recreate 27 unit cells and the <italic>k</italic>-d tree algorithm is then used to detect colliding spheres. Finally, pairwise atom distances are checked to determine whether a given pair of conformations actually clash. If no collision is found, according to (4)<xref ref-type="disp-formula" rid="fd4"/> the residue remains in the lowest energy conformation. If a collision with another residue <italic>w</italic> is found, then the conformation <italic>w</italic>|<italic>v<sub>i</sub></italic>, which is a conformation of <italic>w</italic> compatible with <italic>v<sub>i</sub></italic>, is added to the graph and connected with the vertical edge (<italic>v</italic>
<sub>i</sub>, <italic>w</italic>|<italic>v<sub>i</sub></italic>).</p>
      <p>A* searches require a heuristic function to estimate the minimal cost <italic>h</italic> of moving to the next node. We define this function as<disp-formula id="fd8"><graphic xlink:href="d-72-00266-efd8.jpg" mimetype="image" mime-subtype="gif" position="float"/></disp-formula>where <italic>v<sub>c</sub></italic> is the current best conformation. It means that the minimal cost is either an estimated increase in energy after adopting the next ranked conformation of the same residue or an estimated increase after selecting the evaluated conformation together with a noncolliding conformation of residue <italic>w</italic>. If conformation <italic>v<sub>i</sub></italic> does not clash with any residue, it is marked as a terminal node and selected as a possible candidate for solution.</p>
      <p>When a node is visited, the actual cost of moving to this node is calculated as <italic>g</italic>(<italic>v<sub>i</sub></italic>) = <italic>g</italic>(parent) + <italic>E</italic>
<sub>low</sub>(<italic>v</italic>
<sub><italic>c</italic></sub>) − <italic>E</italic>
<sub>low</sub>(<italic>v<sub>i</sub></italic>) and the estimated total cost of visiting the following nodes as <italic>f</italic>(<italic>v<sub>i</sub></italic>) = <italic>g</italic>(<italic>v<sub>i</sub></italic>) + <italic>h</italic>(<italic>v<sub>i</sub></italic>).</p>
      <p>The search is finished when all remaining discovered nodes have an estimated cost higher than the cost of moving to the node already marked as terminal. The nodes forming the path to the terminal node determine the conformations of the respective residues that form a globally optimal solution according to the criterion in (6)<xref ref-type="disp-formula" rid="fd6"/>.</p>
      <p>After the second stage of fitting, all of the side chains adopt conformations that minimize the simplified energy function, and in general fit well to the electron-density map. At this point most of the side chains may be brought to the correct positions by crystallographic refinement. The energy function used up to this point did not include nonbonding interactions between residues; therefore, the hydrogen-bond network needs to be optimized by applying flips (if needed) to the side chains of Asn, Gln and His residues.</p>
      <p>In the third stage of fitting, the full energy function in (1)<xref ref-type="disp-formula" rid="fd1"/> is applied, comprising electron-density fit, rotamer frequency and nonbonding interaction terms. The conformations that were determined in the two previous stages are placed near the optimal positions; however, the precision depends on the density of the conformer library sampled in the search process. During the third stage, additional samples from a denser and higher complexity variant of the conformer library centred on the previously established conformation are used to improve conformational sampling. Cluster K1 is defined as that from which the optimal conformation <italic>c</italic>
<sub><italic>i</italic>,<italic>s</italic></sub> was taken. To expand the conformations around <italic>c</italic>
<sub><italic>i</italic>,<italic>s</italic></sub>, cluster K2, which is a superset of K1 at lower complexity (<italic>e.g.</italic> cl1.5), is selected. The hierarchy tree is then traversed down and descendants of K2 at higher complexity (<italic>e.g.</italic> cl0.4) are selected. The conformation sets of Asn, Gln and His residues are also expanded by applying flips if needed, and conformations of residues that contain polar H atoms are further expanded by adding H atoms as described previously.</p>
      <p>The self-energies and pairwise interaction energies are calculated for all conformations and a DEE cycle is then performed by sequentially applying multiple criteria: Goldstein (Goldstein, 1994<xref ref-type="bibr" rid="bb21"> ▸</xref>), single-conformation split DEE (Pierce <italic>et al.</italic>, 2000<xref ref-type="bibr" rid="bb40"> ▸</xref>) and two-conformation ‘magic bullet’ split DEE (Gordon &amp; Mayo, 1998<xref ref-type="bibr" rid="bb22"> ▸</xref>; Pierce <italic>et al.</italic>, 2000<xref ref-type="bibr" rid="bb40"> ▸</xref>). Each DEE criterion is applied iteratively until no further conformations are eliminated before continuing on with the next criterion. The elimination stops after ‘magic bullet’ DEE converges. Residues for which DEE did not identify a unique conformation are then clustered based on the presence of pairwise interactions. Clusters that are smaller than 15 residues are resolved using another A* search. To resolve larger clusters, an additional cycle of DEE is applied. This cycle starts with a DEE based on conformation pairs (Lasters <italic>et al.</italic>, 1995<xref ref-type="bibr" rid="bb29"> ▸</xref>) and uses the Goldstein criterion. Finally, the cycle for singles is repeated and the remaining interactions are resolved by an A* search. The size of the cluster for which the A* search is applied was determined empirically, <italic>i.e.</italic> our current implementation of A* is faster than DEE for clusters of this size.</p>
    </sec>
    <sec id="sec2.4">
      <label>2.4.</label>
      <title>Preparation of training and test sets for side-chain modeling   </title>
      <p>Two sets of models of protein structures were generated: the first as a training set to optimize tunable energy-function parameters and the second as a test set to estimate the accuracy of <italic>Fitmunk</italic>. The primary data set from which these sets were drawn includes models of structures for which it was possible to recalculate <italic>R</italic> factors close to the reported values (as described in §<xref ref-type="sec" rid="sec2.2"/>2.2), that share no more than 40% identity, that were deposited between 2007 and 2013 and that have a reported resolution between 0.9 and 3.5 Å. From this primary set, 150 structures per resolution bin were randomly selected. From all models, all ligand, ion and water atoms were removed and the models were then subjected to five cycles of <italic>REFMAC</italic> refinement with local automatic NCS and without TLS. Models were divided randomly within each bin, assigning 50 structures to a training set (TR) and 100 structures to a test set (TS). The width of resolution bins was 0.2 Å, except for the highest and lowest resolution bins, for which the ranges 0.9–1.2 and 3.0–3.5 Å were used, respectively. For testing purposes, we also created derivative test sets based on each TS by introducing noise and reducing the completeness of the model. Noise was introduced by changing the χ angles of randomly selected residues by a random rotation between −40 and 40°. Model completeness was reduced by removing the side chains of randomly selected residues. The percentages of side chains that were deleted (<italic>X</italic>) or randomized (<italic>Y</italic>) are indicated by the name of the test set: TS_d<italic>X</italic>_r<italic>Y</italic>. These models were subjected to five cycles of <italic>REFMAC</italic> refinement and the resulting 2<italic>mF</italic>
<sub>o</sub> − <italic>DF</italic>
<sub>c</sub> electron-density maps were used for <italic>Fitmunk</italic> evaluation.</p>
      <p>In addition to the test sets based on PDB depositions described above, <italic>Fitmunk</italic> was also used in the determination of 115 new structures solved in the authors’ laboratory. These structures may be considered to be a measure of the real-world performance of the methodology. <italic>Fitmunk</italic> was used at various stages of model building, and included structures determined both by molecular replacement and by experimental phasing. For consistency in comparison, each of the 115 models was refined using <italic>REFMAC</italic> for five cycles without TLS and with automatic local NCS. The resulting models were subjected to <italic>Fitmunk</italic> refinement. Both the reference models and the models after <italic>Fitmunk</italic> side-chain fitting were subsequently refined using <italic>REFMAC</italic> for five cycles. The refined models were then compared in terms of <italic>R</italic>, <italic>R</italic>
<sub>free</sub>, <italic>MolProbity</italic> clashscore and <italic>MolProbity</italic> score.</p>
    </sec>
    <sec id="sec2.5">
      <label>2.5.</label>
      <title>Accuracy metrics and optimization of fitting parameters   </title>
      <p>The algorithm described above introduces several tunable parameters that have to be optimized to achieve the best side-chain fitting accuracy. As a measure of accuracy, we selected the percentage of the side chains of a given residue type where the fitted conformation deviated from the original position by an r.m.s.d. of no greater than 0.5 Å. If the optimized parameter is independent of residue type, the accuracy calculated for all residues together was used as a metric. For training purposes Asn, Gln and His residues were treated as symmetric, except in the nonbonded interaction weight-optimization step. For the purpose of checking the correct Asn, Gln and His conformations, the orientations of these residues in the reference structures were optimized using <italic>REDUCE</italic> from the <italic>MolProbity</italic> suite.</p>
      <p>To determine values of the energy-function parameters that maximize the accuracy, a grid test was performed on the TR sets. The obtained values were smoothed assuming continuous resolution dependency using multiquadratic radial basis functions (RBFs), with ∊ set to 2. The values that maximized the accuracy were chosen and then tested using the TS sets. If the improvement was insignificant (below 1% of improved conformations for a given residue type in the resolution bin), neutral values were chosen (0 for <italic>k</italic>
<sub>t</sub>, 1 for <italic>k</italic>
<sub>f</sub>, 0 for <italic>r</italic> and 10<sup>−5</sup> for <italic>w</italic>
<sub>d</sub>/<italic>w</italic>
<sub>p</sub>). The search for optimal parameter values was split into several independent steps associated with each energy term. Firstly, the values of the parameters of the electron-density-related term were optimized. These are the averaging radius (<italic>r</italic>), the penalty threshold (<italic>k</italic>
<sub>t</sub>) and the penalty factor (<italic>k</italic>
<sub>f</sub>). Optimization was performed using only the electron-density-related term from the energy function, using the cl0.7 conformer library. The cl0.7 conformer library was selected because it offered a reasonable accuracy to speed ratio. To independently evaluate all amino acids, optimization was performed without collision resolution (only the first stage of fitting was performed). The averaging radius value was optimized independently of the <italic>k</italic>
<sub>t</sub> and <italic>k</italic>
<sub>f</sub> values, which were optimized simultaneously thereafter, followed by optimization of the <italic>w</italic>
<sub>d</sub>/<italic>w</italic>
<sub>p</sub> ratio. Because RBF smoothing of the trained weights ratio produced sub­optimal results, the values that maximized the accuracy on the training set were used directly instead of the values obtained through smoothing. All of these parameter values were dependent on resolution and residue type.</p>
      <p>As the nonbonded interaction terms were not yet used at this point, it was sufficient to optimize the ratio of the <italic>w</italic>
<sub>d</sub> and <italic>w</italic>
<sub>p</sub> weights. Their values relative to the final energy term were established in the final optimization step in a residue-type-independent manner. The training of the absolute value of these weights was performed using different upper and lower thresholds for expanding the search space.</p>
      <p>Because the training of the final values of the weights and the optimization of the cluster-expansion thresholds did not improve the accuracy significantly, cluster expansion was not used for testing the accuracy of the determination of the proper Asn, Gln and His orientations. Instead, only the addition of polar H atoms and the generation of both orientations of Asn, Gln and His were performed.</p>
    </sec>
  </sec>
  <sec id="sec3">
    <label>3.</label>
    <title>Results and discussion   </title>
    <p><italic>Fitmunk</italic> was primarily designed to be used at different stages of protein model building, structure refinement and validation. The <italic>Fitmunk</italic> program has also been used for the identification of peptide sequence from even relatively poor electron-density maps (Niedzialkowska <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb36"> ▸</xref>). Here, we focus on the application of <italic>Fitmunk</italic> to protein model building and validation and show the impact of <italic>Fitmunk</italic> on the quality of the resulting models, the completeness of the models for subsequent computational studies and, in some cases, re-evaluation of the biological roles of some amino-acid residues.</p>
    <sec id="sec3.1">
      <label>3.1.</label>
      <title>Model building   </title>
      <p><italic>Fitmunk</italic> was initially developed to build amino-acid side chains during automated building of macromolecular models to electron density, and the configurable parameters of the program were optimized for structures that are in the late stages of refinement. However, during program development our group started to routinely use <italic>Fitmunk</italic> even during the initial stages of model building and refinement. To date, the program has been tested on 65 different proteins (115 total different data sets), improving the model refinement of serum albumins (Majorek <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb32"> ▸</xref>), histone code reader proteins (Niedzialkowska <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb37"> ▸</xref>), complexes of antibodies with allergens (Chruszcz <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb13"> ▸</xref>) and several enzymes (Porebski <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb41"> ▸</xref>; Shabalin <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb47"> ▸</xref>). <italic>Fitmunk</italic> has also been used for the structure determination of many other protein structures from several structural genomics centers, including CSGID, MCSG and NYSGRC, as well as for the re-refinement of previously determined structures in the PDB. However, the performance of the program was not systematically evaluated in all of these cases.</p>
      <p>Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref> shows how <italic>Fitmunk</italic> improved the model-to-data correspondence, the model quality and the model completeness as evaluated using the 115 selected structures cited above. Manual inspection of the models showed that <italic>Fitmunk</italic> significantly improved different aspects of these models (Fig. 4<xref ref-type="fig" rid="fig4"> ▸</xref>): it was able to select better conformations and better rotamers with a similar fit, to resolve cascade errors and to introduce conformational changes related to differences in crystal contacts or bound ligands in models used for molecular replacement (MR). We also investigated how refinement with <italic>Fitmunk</italic> affected <italic>R</italic> and <italic>R</italic>
<sub>free</sub>, the <italic>MolProbity</italic> percentile clashscore and the overall <italic>MolProbity</italic> percentile score. <italic>R</italic> and <italic>R</italic>
<sub>free</sub> were influenced the most when many side chains were not present in the original model [for example, after MR with a model generated by <italic>CHAINSAW</italic> (Stein, 2008<xref ref-type="bibr" rid="bb50"> ▸</xref>), which removes all side chains or some side-chain atoms on the basis of sequence alignment between the target sequence and the model used for MR] and were rebuilt by <italic>Fitmunk</italic>. In such cases we observed a drop in <italic>R</italic>
<sub>free</sub> of as high as 0.15 when only the backbone of the protein was used. It was possible to successfully use <italic>Fitmunk</italic> even with relatively incomplete structures that had an initial <italic>R</italic>
<sub>free</sub> of &lt;0.45; however, the best improvement was achieved with structures that had a well modeled backbone and an <italic>R</italic>
<sub>free</sub> of ∼0.4 or better (Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref>). For models that were near the final stages of refinement (<italic>R</italic>
<sub>free</sub> of &lt;0.2 and all side chains already modeled) the improvement in <italic>R</italic> and <italic>R</italic>
<sub>free</sub> averaged 0.003 (16 models). </p>
      <p>The main strengths of <italic>Fitmunk</italic> are observed when analyzing model quality. Even for nearly final structures, for which <italic>Fitmunk</italic> did not affect the <italic>R</italic> factors significantly, application of the side-chain-fitting algorithm considerably improved the geometry by reducing the clashscore and the number of bad rotamers. In the initial data set only 60% of the structures had a clashscore in the 90th percentile and only 20% had a <italic>MolProbity</italic> score in the 90th percentile when compared with structures of similar resolution. After refinement with <italic>Fitmunk</italic> 84% of structures had a clashscore and 46% had a <italic>MolProbity</italic> score in the respective 90th percentiles (Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref>).</p>
      <p>To systematically assess the broad applicability of <italic>Fitmunk</italic>, we tested the program on a large (1100) subset of structures deposited in the PDB with a fraction of their amino-acid side-chain conformations randomly changed or removed. These artificial test sets cover a broad range of different stages of model building and refinement, and vary significantly in the type of protein and diffraction data quality. Additionally, by systematically increasing the number of model perturbations and by decreasing the model completeness we were able to simulate how <italic>Fitmunk</italic> will behave in iterative refinement scenarios.</p>
      <p>Firstly, we observed that refinement using <italic>Fitmunk</italic> was able to match or improve the <italic>R</italic>
<sub>free</sub> of almost 50% of structures from the fully refined test set (TS). Most of the remaining structures had an <italic>R</italic>
<sub>free</sub> that was at most 0.01 higher than the unrefined value. For the same set, <italic>Fitmunk</italic> was able to improve the <italic>MolProbity</italic> percentile score (which in the case of <italic>Fitmunk</italic> refinement is mostly improved by the selection of better rotamers and changes in the number of steric clashes); more than 80% of the structures had improved <italic>MolProbity</italic> percentile scores. For the sets that were progressively less complete and accurate, <italic>Fitmunk</italic> was able to reproduce similar or better <italic>R</italic>
<sub>free</sub> values and <italic>MolProbity</italic> scores when compared with the original, refined structures, even when half of the side chains were missing (for this set, 70% of the structures refined to <italic>R</italic>
<sub>free</sub> values within 0.01 or better than the original). The only test set for which most of <italic>Fitmunk</italic>-refined structures (&gt;70%) failed to refine to similar <italic>R</italic>
<sub>free</sub> values to those of the original structures was the test set in which only the backbones of the proteins were present. Removal of all side chains significantly affects the quality of the electron-density map, and therefore such behavior was expected. Even then, 90% of structures have <italic>R</italic>
<sub>free</sub> values that are within 0.02 of the original. Similar behavior was observed for the <italic>MolProbity</italic> scores (Fig. 5<xref ref-type="fig" rid="fig5"> ▸</xref> and Supplementary Table S1).</p>
      <p>We also assessed the local accuracy of <italic>Fitmunk</italic> refinement (Fig. 6<xref ref-type="fig" rid="fig6"> ▸</xref>). The side-chain conformations of the original protein models (as deposited) were compared with the conformations present in the models rebuilt by <italic>Fitmunk</italic>. We compared the structures using two different assumptions: (i) the models present in the PDB are locally optimal and should be treated as the final target or (ii) the models present in the PDB are sometimes locally suboptimal and at some positions a conformation may be found that better explains the electron density (or the electron density may be insignificant due to the side-chain disorder, so any modeled conformation would not be justified). We therefore measured two types of accuracy. Accuracy that assumes (i) above is calculated as a percentage of all residues (excluding Ala and Gly) that have all of their χ angles within 20° of the original conformation. Accuracy that assumes (ii) above, and thus is adjusted by electron density (ED), is calculated as the percentage of residues with significant density (calculated either before or after <italic>Fitmunk</italic> refinement, with a <italic>Z</italic>-score of the density occupied by side chain as reported by <italic>EDSTATS</italic> to be &gt;1 for a 2<italic>mF</italic>
<sub>o</sub> − <italic>DF<sub>c</sub></italic> ED map) that are either the same as original conformation (within 20°) or are different from the original conformation but are occupying more significant density than the original conformation. The accuracy of <italic>Fitmunk</italic> was on average between 96.5 and 70.8% per deposition depending on resolution, while on average the ED-adjusted accuracy was between 99.5 and 95.7%. If the side chain of a residue had significant ED, <italic>Fitmunk</italic> was able to select a conformation that fitted better to the ED than the deposited conformation for between 1.7 and 16.8% of residues, depending on resolution. For some depositions the number of improved residues was greater than 30% (Fig. 6<xref ref-type="fig" rid="fig6"> ▸</xref> and Supplementary Table S2).</p>
      <p>We have also compared the accuracy of <italic>Fitmunk</italic> with the reported accuracy of <italic>MUMBO</italic>. As <italic>MUMBO</italic> is a side-chain-fitting program that utilizes DEE-based algorithms similar to those of <italic>Fitmunk</italic>, but uses a typical protein-design framework with an additional energy term corresponding to the fit to ED, this comparison demonstrates the advantage of using algorithms that were specifically developed for crystallography. The results presented in Table 1<xref ref-type="table" rid="table1"> ▸</xref> indicate that <italic>Fitmunk</italic> out­performed <italic>MUMBO</italic> in all tested cases.</p>
      <p>There was a significant fraction of structures that were improved by refinement with <italic>Fitmunk</italic> when compared with the originally deposited structure. Almost 50% of the structures from the TS sets have their <italic>R</italic>
<sub>free</sub> improved, and more than 80% of these have better geometry as measured by the <italic>MolProbity</italic> percentile score. This indicates that <italic>Fitmunk</italic> is a useful tool for the re-refinement and validation of older structures.</p>
    </sec>
    <sec id="sec3.2">
      <label>3.2.</label>
      <title>Model validation   </title>
      <p>We have tested <italic>Fitmunk</italic> using the TS set for three types of validation: (i) validation of conformer selection, (ii) validation of missing side chains and (iii) validation of main-chain positioning. By default, <italic>Fitmunk</italic> rebuilds all side chains regardless of the level of disorder. Therefore, after side-chain fitting and subsequent refinement, we assessed the fit to the electron density with <italic>EDSTATS</italic>. Similarly to the criteria for the ED-adjusted accuracy, we treat side-chain conformations as supported by ED when the significance (<italic>Z</italic>-score) of the density occupied by the side chain as reported by <italic>EDSTATS</italic> is &gt;1 for the 2<italic>mF</italic>
<sub>o</sub> − <italic>DF</italic>
<sub>c</sub> ED map and if there is no significant (<italic>Z</italic>-score &gt;3) difference density (either positive or negative). The new side-chain conformation was considered to better correspond to the electron density than that from the original deposition when it occupied significant density and when the <italic>EDSTATS</italic> significances were higher for the 2<italic>mF</italic>
<sub>o</sub> − <italic>DF</italic>
<sub>c</sub> map and lower for the <italic>mF</italic>
<sub>o</sub> − <italic>DF</italic>
<sub>c</sub> map than for the corresponding values for the original model.</p>
      <p>If <italic>Fitmunk</italic> selects a better fitting side-chain conformation than that present in the original deposition it means that the selection of the conformer may be suboptimal. This can be used for validation of conformer selection. We observe that in our test data set about 5% of the residues may have a suboptimal conformation (Fig. 7<xref ref-type="fig" rid="fig7"> ▸</xref>). Changes that are introduced to many neighboring residues may indicate more serious problems that can affect interpretation of the model. For example, one of the significant cases involved an RNA-binding protein that forms different oligomeric states in solution (Wu <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb61"> ▸</xref>). The authors of the deposition (PDB entry <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=4emh">4emh</ext-link>) wrongly modeled the conformations of side chains in different parts of the protein that were involved in forming the interfaces (Fig. 8<xref ref-type="fig" rid="fig8"> ▸</xref>). Moreover, reinterpretation of the map in the affected regions showed that the N-terminal end of the protein was placed in the wrong direction. Fortunately, the authors did not make any conclusions based on the model itself, but based them on other experimental data. However, when the original structure was analyzed with <italic>PDBePISA</italic> in order to predict the probable oligomeric state, no stable oligomers were identified. When the structure was corrected the dimers were identified and trimers were more energetically favorable, which was more consistent with other experimental data.</p>
      <p>If an original deposition does not contain a side chain at a particular position, or the side chain is incomplete, a conformation selected by <italic>Fitmunk</italic> and supported by ED may indicate that the residue was excluded from the model unnecessarily and the side chain could be rebuilt. This feature of <italic>Fitmunk</italic> may be used to validate whether a side chain should be truncated. In the test data set, about 1% of all residues (64% of incomplete residues) could be modeled into electron density meeting <italic>EDSTATS</italic> criteria.</p>
      <p>Finally, <italic>Fitmunk</italic> tries to place side-chain conformations on a fixed backbone. We observed that <italic>Fitmunk</italic> is sometimes not able to select a side-chain conformation that does not collide (even when generous distance cutoffs for clash consideration are used) with the backbone or another neighboring side chain if the backbone is incorrect or suboptimal. Such situations can also occur when the sequence is assigned incorrectly, <italic>e.g.</italic> if Lys is assigned in the place of Ser. Checking whether <italic>Fitmunk</italic> is able to place a conformation on a backbone and is able to solve the collisions with neighboring residues can therefore be used for the validation of main-chain placement, conformation and sequence assignment by ensuring that all side chains can be correctly packed. Selected cases for each type of validation that can be performed by <italic>Fitmunk</italic> are presented in Fig. 7<xref ref-type="fig" rid="fig7"> ▸</xref>.</p>
    </sec>
  </sec>
  <sec id="sec4">
    <label>4.</label>
    <title>Limitations and future developments   </title>
    <p>The application of the algorithm presented in this work focuses on rebuilding the side chains on a fixed backbone that is already modeled and has assigned sequence. It is useful as a standalone tool to finalize and validate the model, but its use during the earlier stages of model building requires integration with other tools specializing in main-chain building and structure refinement. In our experience, the iterative use of <italic>Fitmunk</italic> and reciprocal refinement leads to improved electron-density maps and results in a better model fit and faster convergence, even with initial models of poor quality. <italic>Fitmunk</italic> can also be integrated with software for <italic>de novo</italic>/comparative modeling that will aid in rebuilding fragments without significant density; such integration would allow better modeling of ‘boundary regions’, in which the observed electron density is weak but still interpretable, and can strongly benefit from knowledge-based fitting.</p>
    <p>In the present work, we have somewhat arbitrarily selected both the rotamer library that is used for deriving conformation frequencies and the force field for calculating interaction energies, and a thorough investigation of these two parameters is warranted. For example, using a backbone-dependent library such as that used in <italic>Rosetta</italic> (Shapovalov &amp; Dunbrack, 2011<xref ref-type="bibr" rid="bb48"> ▸</xref>) might be beneficial. We do not expect major differences in the final result, because the electron-density term dominates the energy function in most cases. However, the use of backbone-dependent frequencies in regions of poor electron density may increase the energy difference between different conformations and thereby reduce the time that is needed to find an optimal solution. Nevertheless, selection of the best rotamer library for frequency calculation and the best force field for <italic>Fitmunk</italic> requires additional, systematic studies.</p>
  </sec>
  <sec id="sec5">
    <label>5.</label>
    <title>Conclusions   </title>
    <p>We have developed a new algorithm for amino-acid side-chain conformation modeling based on DEE theory, which is specifically tailored for applications in MX. The resulting implementation of the algorithm, in the form of the program <italic>Fitmunk</italic>, has been tested and evaluated both on newly collected data as well as on artificial test sets based on previously deposited structures. Evaluation of the program demonstrated that the DEE-based algorithm is both robust and effective, and can improve protein structures during the early and middle stages of model building and refinement. Specifically, <italic>Fitmunk</italic> was able to improve the fit of side chains, select better rotamers, resolve various cascading errors and significantly reduce the number of steric clashes, even in models already deposited in the PDB. Our evaluation of the program led us to the conclusion that some of the structures that have already been deposited can be improved by our program, especially those at medium and low resolutions. We have therefore investigated the possibility of using <italic>Fitmunk</italic> for model validation. We have demonstrated that <italic>Fitmunk</italic> can validate the selection of side-chain conformations and rotamers and help to answer the question whether a side chain is optimally fitted or could be fitted better. In conjunction with programs calculating local model to electron-density correlations, <italic>Fitmunk</italic> can be used to evaluate whether a side chain was unnecessarily removed from a model. The ability of <italic>Fitmunk</italic> to score very dense libraries also makes it a good tool to evaluate the probity of potentially problematic main-chain traces that lack side chains owing to low resolution or poor local electron density, and ultimately to support positioning the side chains to result in a properly packed fragment.</p>
    <p><italic>Fitmunk</italic> is available as a web service (at <ext-link ext-link-type="uri" xlink:href="http://fitmunk.bitbucket.org/">http://fitmunk.bitbucket.org/</ext-link> or at <ext-link ext-link-type="uri" xlink:href="http://kniahini.med.virginia.edu/fitmunk/server/">http://kniahini.med.virginia.edu/fitmunk/server/</ext-link>) and can also be accessed in <italic>HKL</italic>-3000.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data">
      <p>Supplementary tables.. DOI: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1107/S2059798315024730/dz5393sup1.pdf">10.1107/S2059798315024730/dz5393sup1.pdf</ext-link>
</p>
      <media mimetype="application" mime-subtype="pdf" xlink:href="d-72-00266-sup1.pdf" xlink:type="simple" id="d36e132" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>We would like to thank Maksymilian Chruszcz, Matthew D. Zimmerman and David Cooper for numerous discussions and suggestions. This work was supported by National Institutes of Health Grants <award-id>GM053163</award-id> and <award-id>HG008424</award-id>.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="bb1">
      <mixed-citation publication-type="other">Abad-Zapatero, C., Abdel-Meguid, S. S., Johnson, J. E., Leslie, A. G. W., Rayment, I., Rossmann, M. G., Suck, D. &amp; Tsukihara, T. (1980). <italic>Nature (London)</italic>, <bold>286</bold>, 33–39.</mixed-citation>
    </ref>
    <ref id="bb2">
      <mixed-citation publication-type="other">Abrahams, J. P., Leslie, A. G. W., Lutter, R. &amp; Walker, J. E. (1994). <italic>Nature (London)</italic>, <bold>370</bold>, 621–628.</mixed-citation>
    </ref>
    <ref id="bb3">
      <mixed-citation publication-type="other">Adams, P. D., Baker, D., Brunger, A. T., Das, R., DiMaio, F., Read, R. J., Richardson, D. C., Richardson, J. S. &amp; Terwilliger, T. C. (2013). <italic>Annu. Rev. Biophys.</italic>
<bold>42</bold>, 265–287.</mixed-citation>
    </ref>
    <ref id="bb4">
      <mixed-citation publication-type="other">Altschul, S. F., Gish, W., Miller, W., Myers, E. W. &amp; Lipman, D. J. (1990). <italic>J. Mol. Biol.</italic>
<bold>215</bold>, 403–410.</mixed-citation>
    </ref>
    <ref id="bb5">
      <mixed-citation publication-type="other">Ban, N., Nissen, P., Hansen, J., Moore, P. B. &amp; Steitz, T. A. (2000). <italic>Science</italic>, <bold>289</bold>, 905–920.</mixed-citation>
    </ref>
    <ref id="bb6">
      <mixed-citation publication-type="other">Bell, J. A., Ho, K. L. &amp; Farid, R. (2012). <italic>Acta Cryst.</italic> D<bold>68</bold>, 935–952.</mixed-citation>
    </ref>
    <ref id="bb7">
      <mixed-citation publication-type="other">Berman, H. M., Coimbatore Narayanan, B., Costanzo, L. D., Dutta, S., Ghosh, S., Hudson, B. P., Lawson, C. L., Peisach, E., Prlić, A., Rose, P. W., Shao, C., Yang, H., Young, J. &amp; Zardecki, C. (2013). <italic>FEBS Lett.</italic>
<bold>587</bold>, 1036–1045.</mixed-citation>
    </ref>
    <ref id="bb8">
      <mixed-citation publication-type="other">Berman, H. M., Westbrook, J., Feng, Z., Gilliland, G., Bhat, T. N., Weissig, H., Shindyalov, I. N. &amp; Bourne, P. E. (2000). <italic>Nucleic Acids Res.</italic>
<bold>28</bold>, 235–242.</mixed-citation>
    </ref>
    <ref id="bb9">
      <mixed-citation publication-type="other">Blake, C. C. F., Koenig, D. F., Mair, G. A., North, A. C. T., Phillips, D. C. &amp; Sarma, V. R. (1965). <italic>Nature (London)</italic>, <bold>206</bold>, 757–761.</mixed-citation>
    </ref>
    <ref id="bb10">
      <mixed-citation publication-type="other">Buckle, A. M., Schreiber, G. &amp; Fersht, A. R. (1994). <italic>Biochemistry</italic>, <bold>33</bold>, 8878–8889.</mixed-citation>
    </ref>
    <ref id="bb11">
      <mixed-citation publication-type="other">Chen, V. B., Arendall, W. B., Headd, J. J., Keedy, D. A., Immormino, R. M., Kapral, G. J., Murray, L. W., Richardson, J. S. &amp; Richardson, D. C. (2010). <italic>Acta Cryst.</italic> D<bold>66</bold>, 12–21.</mixed-citation>
    </ref>
    <ref id="bb12">
      <mixed-citation publication-type="other">Chruszcz, M., Domagalski, M., Osinski, T., Wlodawer, A. &amp; Minor, W. (2010). <italic>Curr. Opin. Struct. Biol.</italic>
<bold>20</bold>, 587–597.</mixed-citation>
    </ref>
    <ref id="bb13">
      <mixed-citation publication-type="other">Chruszcz, M., Pomes, A., Glesner, J., Vailes, L. D., Osinski, T., Porebski, P. J., Majorek, K. A., Heymann, P. W., Platts-Mills, T. A., Minor, W. &amp; Chapman, M. D. (2012). <italic>J. Biol. Chem.</italic>
<bold>287</bold>, 7388–7398.</mixed-citation>
    </ref>
    <ref id="bb14">
      <mixed-citation publication-type="other">Cooper, D. R., Porebski, P. J., Chruszcz, M. &amp; Minor, W. (2011). <italic>Exp. Opin. Drug Discov.</italic>
<bold>6</bold>, 771–782.</mixed-citation>
    </ref>
    <ref id="bb15">
      <mixed-citation publication-type="other">Cymborowski, M., Klimecka, M., Chruszcz, M., Zimmerman, M. D., Shumilin, I. A., Borek, D., Lazarski, K., Joachimiak, A., Otwinowski, Z., Anderson, W. &amp; Minor, W. (2010). <italic>J. Struct. Funct. Genomics</italic>, <bold>11</bold>, 211–221.</mixed-citation>
    </ref>
    <ref id="bb16">
      <mixed-citation publication-type="other">DiMaio, F., Terwilliger, T. C., Read, R. J., Wlodawer, A., Oberdorfer, G., Wagner, U., Valkov, E., Alon, A., Fass, D., Axelrod, H. L., Das, D., Vorobiev, S. M., Iwaï, H., Pokkuluri, P. R. &amp; Baker, D. (2011). <italic>Nature (London)</italic>, <bold>473</bold>, 540–543.</mixed-citation>
    </ref>
    <ref id="bb17">
      <mixed-citation publication-type="other">Eads, D. (2008). <italic>hcluster: Hierarchical Clustering for SciPy</italic>. http://scipy-cluster.googlecode.com.</mixed-citation>
    </ref>
    <ref id="bb18">
      <mixed-citation publication-type="other">Engh, R. A. &amp; Huber, R. (2001). <italic>International Tables for Crystallo­graphy</italic>, Vol. <italic>F</italic>, edited by M. G. Rossmann &amp; E. Arnold, pp. 382–392. Dordrecht: Kluwer Academic Publishers.</mixed-citation>
    </ref>
    <ref id="bb19">
      <mixed-citation publication-type="other">Furnham, N., Doré, A. S., Chirgadze, D. Y., de Bakker, P. I., DePristo, M. A. &amp; Blundell, T. L. (2006). <italic>Structure</italic>, <bold>14</bold>, 1313–1320.</mixed-citation>
    </ref>
    <ref id="bb20">
      <mixed-citation publication-type="other">Giegé, R. (2013). <italic>FEBS J.</italic>
<bold>280</bold>, 6456–6497.</mixed-citation>
    </ref>
    <ref id="bb21">
      <mixed-citation publication-type="other">Goldstein, R. F. (1994). <italic>Biophys. J.</italic>
<bold>66</bold>, 1335–1340.</mixed-citation>
    </ref>
    <ref id="bb22">
      <mixed-citation publication-type="other">Gordon, D. B. &amp; Mayo, S. L. (1998). <italic>J. Comput. Chem.</italic>
<bold>19</bold>, 1505–1514.</mixed-citation>
    </ref>
    <ref id="bb23">
      <mixed-citation publication-type="other">Harrison, S. C., Olson, A. J., Schutt, C. E., Winkler, F. K. &amp; Bricogne, G. (1978). <italic>Nature (London)</italic>, <bold>276</bold>, 368–373.</mixed-citation>
    </ref>
    <ref id="bb24">
      <mixed-citation publication-type="other">Headd, J. J., Immormino, R. M., Keedy, D. A., Emsley, P., Richardson, D. C. &amp; Richardson, J. S. (2009). <italic>J. Struct. Funct. Genomics</italic>, <bold>10</bold>, 83–93.</mixed-citation>
    </ref>
    <ref id="bb25">
      <mixed-citation publication-type="other">Joosten, R. P., Joosten, K., Murshudov, G. N. &amp; Perrakis, A. (2012). <italic>Acta Cryst.</italic> D<bold>68</bold>, 484–496.</mixed-citation>
    </ref>
    <ref id="bb26">
      <mixed-citation publication-type="other">Jorgensen, W. L. &amp; Tirado-Rives, J. (1988). <italic>J. Am. Chem. Soc.</italic>
<bold>110</bold>, 1657–1666.</mixed-citation>
    </ref>
    <ref id="bb27">
      <mixed-citation publication-type="other">Kabsch, W. (2010). <italic>Acta Cryst.</italic> D<bold>66</bold>, 125–132.</mixed-citation>
    </ref>
    <ref id="bb28">
      <mixed-citation publication-type="other">Krivov, G. G., Shapovalov, M. V. &amp; Dunbrack, R. L. Jr (2009). <italic>Proteins</italic>, <bold>77</bold>, 778–795.</mixed-citation>
    </ref>
    <ref id="bb29">
      <mixed-citation publication-type="other">Lasters, I., Maeyer, M. D. &amp; Desmet, J. (1995). <italic>Protein Eng. Des. Sel.</italic>
<bold>8</bold>, 815–822.</mixed-citation>
    </ref>
    <ref id="bb30">
      <mixed-citation publication-type="other">Lovell, S. C., Davis, I. W., Arendall, W. B., de Bakker, P. I. W., Word, J. M., Prisant, M. G., Richardson, J. S. &amp; Richardson, J. S. (2003). <italic>Proteins</italic>, <bold>50</bold>, 437–450.</mixed-citation>
    </ref>
    <ref id="bb31">
      <mixed-citation publication-type="other">Lovell, S. C., Word, J. M., Richardson, J. S. &amp; Richardson, D. C. (2000). <italic>Proteins</italic>, <bold>40</bold>, 389–408.</mixed-citation>
    </ref>
    <ref id="bb32">
      <mixed-citation publication-type="other">Majorek, K. A., Porebski, P. J., Dayal, A., Zimmerman, M. D., Jablonska, K., Stewart, A. J., Chruszcz, M. &amp; Minor, W. (2012). <italic>Mol. Immunol.</italic>
<bold>52</bold>, 174–182.</mixed-citation>
    </ref>
    <ref id="bb33">
      <mixed-citation publication-type="other">Matthews, B. W., Sigler, P. B., Henderson, R. &amp; Blow, D. M. (1967). <italic>Nature (London)</italic>, <bold>214</bold>, 652–656.</mixed-citation>
    </ref>
    <ref id="bb34">
      <mixed-citation publication-type="other">Minor, W., Cymborowski, M., Otwinowski, Z. &amp; Chruszcz, M. (2006). <italic>Acta Cryst.</italic> D<bold>62</bold>, 859–866.</mixed-citation>
    </ref>
    <ref id="bb35">
      <mixed-citation publication-type="other">Murshudov, G. N., Skubák, P., Lebedev, A. A., Pannu, N. S., Steiner, R. A., Nicholls, R. A., Winn, M. D., Long, F. &amp; Vagin, A. A. (2011). <italic>Acta Cryst.</italic> D<bold>67</bold>, 355–367.</mixed-citation>
    </ref>
    <ref id="bb36">
      <mixed-citation publication-type="other">Niedzialkowska, E., Gasiorowska, O., Handing, K. B., Majorek, K. A., Porebski, P. J., Shabalin, I. G., Zasadzinska, E., Cymborowski, M. &amp; Minor, W. (2015). <italic>Protein Sci.</italic>, 10.1002/pro.2861.</mixed-citation>
    </ref>
    <ref id="bb37">
      <mixed-citation publication-type="other">Niedzialkowska, E., Wang, F., Porebski, P. J., Minor, W., Higgins, J. M. &amp; Stukenberg, P. T. (2012). <italic>Mol. Biol. Cell</italic>, <bold>23</bold>, 1457–1466.</mixed-citation>
    </ref>
    <ref id="bb38">
      <mixed-citation publication-type="other">Otwinowski, Z., Borek, D., Majewski, W. &amp; Minor, W. (2003). <italic>Acta Cryst.</italic> A<bold>59</bold>, 228–234.</mixed-citation>
    </ref>
    <ref id="bb39">
      <mixed-citation publication-type="other">Panjikar, S., Parthasarathy, V., Lamzin, V. S., Weiss, M. S. &amp; Tucker, P. A. (2005). <italic>Acta Cryst.</italic> D<bold>61</bold>, 449–457.</mixed-citation>
    </ref>
    <ref id="bb40">
      <mixed-citation publication-type="other">Pierce, N. A., Spriet, J. A., Desmet, J. &amp; Mayo, S. L. (2000). <italic>J. Comput. Chem.</italic>
<bold>21</bold>, 999–1009.</mixed-citation>
    </ref>
    <ref id="bb41">
      <mixed-citation publication-type="other">Porebski, P. J., Klimecka, M., Chruszcz, M., Nicholls, R. A., Murzyn, K., Cuff, M. E., Xu, X., Cymborowski, M., Murshudov, G. N., Savchenko, A., Edwards, A. &amp; Minor, W. (2012). <italic>FEBS J.</italic>
<bold>279</bold>, 1093–1105.</mixed-citation>
    </ref>
    <ref id="bb42">
      <mixed-citation publication-type="other">Pozharski, E., Weichenberger, C. X. &amp; Rupp, B. (2013). <italic>Acta Cryst.</italic> D<bold>69</bold>, 150–167.</mixed-citation>
    </ref>
    <ref id="bb43">
      <mixed-citation publication-type="other">Read, R. J. <italic>et al.</italic> (2011). <italic>Structure</italic>, <bold>19</bold>, 1395–1412.</mixed-citation>
    </ref>
    <ref id="bb44">
      <mixed-citation publication-type="other">Richardson, J. S. &amp; Richardson, D. C. (2014). <italic>Biophys. J.</italic>
<bold>106</bold>, 510–525.</mixed-citation>
    </ref>
    <ref id="bb45">
      <mixed-citation publication-type="other">Schluenzen, F., Tocilj, A., Zarivach, R., Harms, J., Gluehmann, M., Janell, D., Bashan, A., Bartels, H., Agmon, I., Franceschi, F. &amp; Yonath, A. (2000). <italic>Cell</italic>, <bold>102</bold>, 615–623.</mixed-citation>
    </ref>
    <ref id="bb46">
      <mixed-citation publication-type="other">Shabalin, I., Dauter, Z., Jaskolski, M., Minor, W. &amp; Wlodawer, A. (2015). <italic>Acta Cryst.</italic> D<bold>71</bold>, 1965–1979.</mixed-citation>
    </ref>
    <ref id="bb47">
      <mixed-citation publication-type="other">Shabalin, I. G., Porebski, P. J., Cooper, D. R., Grabowski, M., Onopriyenko, O., Grimshaw, S., Savchenko, A., Chruszcz, M. &amp; Minor, W. (2012). <italic>Acta Cryst.</italic> F<bold>68</bold>, 1018–1024.</mixed-citation>
    </ref>
    <ref id="bb48">
      <mixed-citation publication-type="other">Shapovalov, M. V. &amp; Dunbrack, R. Jr (2011). <italic>Structure</italic>, <bold>19</bold>, 844–858.</mixed-citation>
    </ref>
    <ref id="bb49">
      <mixed-citation publication-type="other">Sheldrick, G. M. (2008). <italic>Acta Cryst.</italic> A<bold>64</bold>, 112–122.</mixed-citation>
    </ref>
    <ref id="bb50">
      <mixed-citation publication-type="other">Stein, N. (2008). <italic>J. Appl. Cryst.</italic>
<bold>41</bold>, 641–643.</mixed-citation>
    </ref>
    <ref id="bb51">
      <mixed-citation publication-type="other">Stiebritz, M. T. &amp; Muller, Y. A. (2006). <italic>Acta Cryst.</italic> D<bold>62</bold>, 648–658.</mixed-citation>
    </ref>
    <ref id="bb52">
      <mixed-citation publication-type="other">Tanaka, H., Kato, K., Yamashita, E., Sumizawa, T., Zhou, Y., Yao, M., Iwasaki, K., Yoshimura, M. &amp; Tsukihara, T. (2009). <italic>Science</italic>, <bold>323</bold>, 384–388.</mixed-citation>
    </ref>
    <ref id="bb54">
      <mixed-citation publication-type="other">Tickle, I. J. (2012). <italic>Acta Cryst.</italic> D<bold>68</bold>, 454–467.</mixed-citation>
    </ref>
    <ref id="bb55">
      <mixed-citation publication-type="other">Urzhumtseva, L., Afonine, P. V., Adams, P. D. &amp; Urzhumtsev, A. (2009). <italic>Acta Cryst.</italic> D<bold>65</bold>, 297–300.</mixed-citation>
    </ref>
    <ref id="bb56">
      <mixed-citation publication-type="other">Wall, M. E., Clarage, J. B. &amp; Phillips, G. N. Jr (1997). <italic>Structure</italic>, <bold>5</bold>, 1599–1612.</mixed-citation>
    </ref>
    <ref id="bb57">
      <mixed-citation publication-type="other">Wimberly, B. T., Brodersen, D. E., Clemons, W. M. Jr, Morgan-Warren, R. J., Carter, A. P., Vonrhein, C., Hartsch, T. &amp; Ramakrishnan, V. (2000). <italic>Nature (London)</italic>, <bold>407</bold>, 327–339.</mixed-citation>
    </ref>
    <ref id="bb58">
      <mixed-citation publication-type="other">Winn, M. D. <italic>et al.</italic> (2011). <italic>Acta Cryst.</italic> D<bold>67</bold>, 235–242.</mixed-citation>
    </ref>
    <ref id="bb59">
      <mixed-citation publication-type="other">Wlodawer, A., Minor, W., Dauter, Z. &amp; Jaskolski, M. (2013). <italic>FEBS J.</italic>
<bold>280</bold>, 5705–5736.</mixed-citation>
    </ref>
    <ref id="bb60">
      <mixed-citation publication-type="other">Word, J. M., Lovell, S. C., LaBean, T. H., Taylor, H. C., Zalis, M. E., Presley, B. K., Richardson, J. S. &amp; Richardson, D. C. (1999). <italic>J. Mol. Biol.</italic>
<bold>285</bold>, 1711–1733.</mixed-citation>
    </ref>
    <ref id="bb61">
      <mixed-citation publication-type="other">Wu, D., Jiang, S., Bowler, M. W. &amp; Song, H. (2012). <italic>PLoS One</italic>, <bold>7</bold>, e36768.</mixed-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="fig1" position="float">
    <label>Figure 1</label>
    <caption>
      <p>Overview of <italic>Fitmunk</italic> workflow. The overview shows the major steps of the algorithm used by <italic>Fitmunk</italic>. The workflow is divided into three stages: stage I, fitting; stage II, collision resolution; stage III, refitting with pairwise interactions. The parameters that were optimized to achieve the best accuracy are shown on the left. The color of the step corresponds to the component of the algorithm that is responsible for the step.</p>
    </caption>
    <graphic xlink:href="d-72-00266-fig1"/>
  </fig>
  <fig id="fig2" position="float">
    <label>Figure 2</label>
    <caption>
      <p>Example of the graph explored by the A* search. The first node <italic>v</italic>
<sub>1</sub> is visited and checked for collisions. It represents the lowest energy conformation of residue <italic>v</italic> but clashes with conformation <italic>w</italic>
<sub>1</sub> and cannot be a terminal node. There are two options: either we choose to keep <italic>v</italic>
<sub>1</sub> and find a nonclashing conformation of <italic>w</italic> (<italic>w</italic>
<sub>4</sub>) or we move to the next conformation of <italic>v</italic>. The estimated cost of moving to <italic>v</italic>
<sub>2</sub> is 5, whereas that of remaining at <italic>v</italic>
<sub>1</sub> is 7. <italic>v</italic>
<sub>2</sub> is therefore selected. At this point the following moves are possible: go to <italic>v</italic>
<sub>3</sub> (cost 8), keep <italic>v</italic>
<sub>2</sub> (cost 13) or skip to <italic>v</italic>
<sub>1</sub> and <italic>w</italic>
<sub>4</sub> (cost 7). Because of the lowest cost the last possibility is explored with further options, <italic>w</italic>
<sub>5</sub> (9) and <italic>u</italic>
<sub>3</sub> (10), and previous ones, <italic>v</italic>
<sub>3</sub> (8) and <italic>v</italic>
<sub>2</sub> (13). <italic>v</italic>
<sub>3</sub> is selected and <italic>w</italic>
<sub>2</sub> is evaluated for clashes. Because this does not form any additional collisions it is marked as a terminal node, its estimated cost is used to set <italic>E</italic>
<sub>low</sub> = <italic>E</italic>
<sub>self_<italic>x</italic></sub>, it is possible to eliminate all other conformations based on the criterion in (7)<xref ref-type="disp-formula" rid="fd7"/> (other evaluated options have costs higher than the final cost of a terminal node) and the selected path leading to the green node is the best solution. During graph exploration, the nodes marked in yellow or green are evaluated for clashes while those in white are not.</p>
    </caption>
    <graphic xlink:href="d-72-00266-fig2"/>
  </fig>
  <fig id="fig3" position="float">
    <label>Figure 3</label>
    <caption>
      <p>Changes in global parameters after refinement of structures with <italic>Fitmunk</italic>. 115 different structures of 65 different proteins are represented. (<italic>a</italic>) Changes in <italic>R</italic> (black circles) and <italic>R</italic>
<sub>free</sub> (red squares) after <italic>Fitmunk</italic> refinement. (<italic>b</italic>) Histograms of Δ<italic>R</italic> (gray) and Δ<italic>R</italic>
<sub>free</sub> (red) between the original and the <italic>Fitmunk</italic>-refined structure. (<italic>c</italic>) Changes in <italic>MolProbity</italic> clashscore percentiles (black circles) and <italic>MolProbity</italic> score percentiles (red squares) shown as a value of the parameter calculated for the <italic>Fitmunk</italic>-refined structure <italic>versus</italic> the value of the parameter calculated for the unrefined structure. All parameters are calculated using the original structure after five cycles of <italic>REFMAC</italic> refinement and the original structure refined with <italic>Fitmunk</italic> and five cycles of <italic>REFMAC</italic>. Black lines in (<italic>a</italic>) (horizontal line) and (<italic>c</italic>) (diagonal line) represent no change in a parameter.</p>
    </caption>
    <graphic xlink:href="d-72-00266-fig3"/>
  </fig>
  <fig id="fig4" position="float">
    <label>Figure 4</label>
    <caption>
      <p>Examples of side-chain position improvement after rebuilding by <italic>Fitmunk</italic>. (<italic>a</italic>) Improving the fit by selecting a different side-chain conformation. (<italic>b</italic>) Similar fit using a better rotamer. (<italic>c</italic>) Fixing cascade errors. (<italic>d</italic>) Fixing conformations of an MR model where the previous model had different crystal contacts. In all panels, the red lines represent the model before and the green lines represent the model after rebuilding by <italic>Fitmunk</italic>. Electron-density maps are 2<italic>mF</italic>
<sub>o</sub> − <italic>DF</italic>
<sub>c</sub> maps contoured at the 1 r.m.s.d. level</p>
    </caption>
    <graphic xlink:href="d-72-00266-fig4"/>
  </fig>
  <fig id="fig5" position="float">
    <label>Figure 5</label>
    <caption>
      <p>Changes in <italic>R</italic>, <italic>R</italic>
<sub>free</sub>, <italic>MolProbity</italic> clashscore and <italic>MolProbity</italic> score <italic>versus</italic> resolution after the refinement of different test sets with <italic>Fitmunk</italic> compared with a reference test set. The values are represented as a two-dimensional histogram using hexagonal bins. The color of each bin encodes the number of models that fall within it. <italic>Fitmunk</italic> was able to reproduce <italic>R</italic> and <italic>R</italic>
<sub>free</sub> and improve the <italic>MolProbity</italic> score and clashscore (lower is better) even when noisy and incomplete test sets were used. Supplementary Table S1<xref ref-type="table" rid="table1"> ▸</xref> shows the median changes for each analyzed resolution bin for the TS test sets. Black horizontal lines represent no change in the analyzed parameter.</p>
    </caption>
    <graphic xlink:href="d-72-00266-fig5"/>
  </fig>
  <fig id="fig6" position="float">
    <label>Figure 6</label>
    <caption>
      <p>Accuracy of <italic>Fitmunk</italic> side-chain modeling on different test sets. The values are represented as two-dimensional histograms using hexagonal bins. The color of each bin represents the number of models that fall within it. The accuracy (calculated with the assumption that the original depositions are correct) of <italic>Fitmunk</italic> was on average between 96.5 and 70.8% per deposition depending on resolution, while on average the ED-adjusted accuracy (taking into account that for some residues <italic>Fitmunk</italic> was selecting a conformation that fitted better to the electron density or that the electron density was so weak that it did not mandate any conformation) was between 99.5 and 95.7%. <italic>Fitmunk</italic> was also able to achieve high accuracy for highly incomplete structures (TS_d0.2_r0.5 test set) and reasonable accuracy for backbone only (TS_d1). Depending on the resolution, <italic>Fitmunk</italic> was able to improve the fit of 1.7–16.8% of residues compared with the original depositions. Supplementary Table S2 shows the median accuracies, median percentages of residues with insignificant ED and median percentage of residues with improved fit for each analyzed resolution bin for the TS set.</p>
    </caption>
    <graphic xlink:href="d-72-00266-fig6"/>
  </fig>
  <fig id="fig7" position="float">
    <label>Figure 7</label>
    <caption>
      <p>The results of <italic>Fitmunk</italic> refinement can be used for different types of validation. In the left panel, ‘conformation change’ gives the fraction of all side chains (by residue type) that had their conformation changed by <italic>Fitmunk</italic> and had an improved fit to electron density as evaluated by <italic>EDSTATS</italic> after <italic>REFMAC</italic> refinement; ‘missing side chain’ gives the fraction of missing side chains that were rebuilt by <italic>Fitmunk</italic> and were fitted to significant electron density as evaluated by <italic>EDSTATS</italic>. Right panel, examples of corrections introduced into models and problems spotted resulting from <italic>Fitmunk</italic> refinement. Original models are represented as white sticks and <italic>Fitmunk</italic>-corrected models as blue sticks. Original 2<italic>mF</italic>
<sub>o</sub> − <italic>DF</italic>
<sub>c</sub> density at the 1 r.m.s.d. level is displayed as a gray mesh. In selected cases 2<italic>mF</italic>
<sub>o</sub> −<italic>DF</italic>
<sub>c</sub> electron density resulting from the refinement of a <italic>Fitmunk</italic>-corrected model is displayed at the 1 r.m.s.d. level as a blue mesh. Top row, conformational changes introduced by <italic>Fitmunk</italic>. A.1, correction of wrong conformation selection: several alternative conformations and a water were replaced by better fitting conformations. A.2, selection of a rotamer that forms better interactions. A.3, selection of a conformation that has a better density fit. Middle row, missing side chains that were rebuilt by <italic>Fitmunk</italic>. B.1, small residues such as Ser can be rebuilt most of the time. B.2, missing side chains were improperly compensated for by the introduction of water. B.3, rebuilding of missing residues allowed better packing and better main-chain placement after refinement. Bottom row, problems spotted after <italic>Fitmunk</italic> was unable to fit any conformation or resolve steric clashes for a given residue. C.1, possible wrong sequence or register shift; <italic>Fitmunk</italic> was unable to fit Asp in the space available. C.2, main-chain break and wrong main-chain orientation; <italic>Fitmunk</italic> was unable to fit any conformation of Ile with the given backbone orientation. C.3, wrong loop conformation; <italic>Fitmunk</italic> was unable to resolve collisions in the tight loop because of the incorrect backbone conformation.</p>
    </caption>
    <graphic xlink:href="d-72-00266-fig7"/>
  </fig>
  <fig id="fig8" position="float">
    <label>Figure 8</label>
    <caption>
      <p>Example of the incorrect interpretation of an electron-density map that can be detected on the basis of multiple side-chain conformation changes made by <italic>Fitmunk</italic>. (<italic>a</italic>) Original deposition with PDB code <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=4emh">4emh</ext-link> (yellow lines) shown with 2<italic>mF</italic>
<sub>o</sub> − <italic>DF</italic>
<sub>c</sub> (blue; at the 1 r.m.s.d. level) and <italic>mF</italic>
<sub>o</sub> − <italic>DF</italic>
<sub>c</sub> (green, positive; red, negative; both at the 3 r.m.s.d. level) electron-density maps. Multiple regions of low model–data correspondence can be seen. (<italic>b</italic>) Model refined with <italic>Fitmunk</italic>. All incorrectly fitted side chains have been corrected. (<italic>c</italic>) Fragment of a screenshot from the <italic>Fitmunk</italic> server showing differences between the original model and the model refined with <italic>Fitmunk</italic>. Analysis of regions with multiple differences led to the identification of the fragments shown in (<italic>a</italic>) and (<italic>b</italic>).</p>
    </caption>
    <graphic xlink:href="d-72-00266-fig8"/>
  </fig>
  <table-wrap id="table1" position="float">
    <label>Table 1</label>
    <caption>
      <title>Comparison of the accuracy of <italic>Fitmunk</italic> and <italic>MUMBO</italic>
</title>
    </caption>
    <table frame="hsides" rules="groups">
      <thead valign="top">
        <tr>
          <th rowspan="1" colspan="1" align="left" valign="top"> </th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="2" align="left" valign="top">PDB entry <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=2iim">2iim</ext-link>
<xref ref-type="table-fn" rid="tfn1">†</xref>
</th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="2" align="left" valign="top">PDB entry <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1thw">1thw</ext-link>
</th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="2" align="left" valign="top">PDB entry <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=2hft">2hft</ext-link>
</th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="2" align="left" valign="top">PDB entry <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1dpx">1dpx</ext-link>
</th>
        </tr>
        <tr>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="top"> </th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="top">χ<sub>1</sub> &lt; 20°</th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="top">All χ<sub><italic>i</italic></sub> &lt; 20°</th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="top">χ<sub>1</sub> &lt; 20°</th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="top">All χ<sub><italic>i</italic></sub> &lt; 20°</th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="top">χ<sub>1</sub> &lt; 20°</th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="top">All χ<sub><italic>i</italic></sub> &lt; 20°</th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="top">χ<sub>1</sub> &lt; 20°</th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="top">All χ<sub><italic>i</italic></sub> &lt; 20°</th>
        </tr>
      </thead>
      <tbody valign="top">
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">
            <italic>Fitmunk</italic>
            <xref ref-type="table-fn" rid="tfn2">‡</xref>
          </td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">98 (100)</td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">84 (94)</td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">92 (96)</td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">81 (91)</td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">95 (97)</td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">84 (92)</td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">97 (100)</td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">86 (95)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">
            <italic>MUMBO</italic>
          </td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">92 </td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">76 </td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">85 </td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">67 </td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">82 </td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">70 </td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">89 </td>
          <td rowspan="1" colspan="1" align="char" char=" " charoff="50" valign="top">72 </td>
        </tr>
      </tbody>
    </table>
    <table-wrap-foot>
      <fn id="tfn1">
        <label>†</label>
        <p>The structure reported in the <italic>MUMBO</italic> paper has not yet been published. This deposition has a matching protein and authors, but the resolutions reported in the PDB and the <italic>MUMBO</italic> paper differ (1.0 <italic>versus</italic> 1.3 Å).</p>
      </fn>
      <fn id="tfn2">
        <label>‡</label>
        <p>The values in parentheses show the percentage of correctly fitted residues classified after manual inspection. These included cases where the wrong conformation was selected in the original deposition, the orientations of Asn, Gln or His residues were corrected or a similarly fitting alternative conformation was selected.</p>
      </fn>
    </table-wrap-foot>
  </table-wrap>
</floats-group>
