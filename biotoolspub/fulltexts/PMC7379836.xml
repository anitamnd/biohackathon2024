<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7379836</article-id>
    <article-id pub-id-type="publisher-id">3661</article-id>
    <article-id pub-id-type="doi">10.1186/s12859-020-03661-9</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methodology Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>METROID: an automated method for robust quantification of subcellular fluorescence events at low SNR</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-6165-4679</contrib-id>
        <name>
          <surname>Zoccoler</surname>
          <given-names>Marcelo</given-names>
        </name>
        <address>
          <email>marzoccoler@gmail.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>de Oliveira</surname>
          <given-names>Pedro X.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.411087.b</institution-id><institution-id institution-id-type="ISNI">0000 0001 0723 2494</institution-id><institution>Department of Biomedical Engineering (DEB), </institution><institution>School of Electrical and Computer Engineering, University of Campinas, </institution></institution-wrap>400, Albert Einstein Avenue, Campinas, SP 13083-852 Brazil </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.411087.b</institution-id><institution-id institution-id-type="ISNI">0000 0001 0723 2494</institution-id><institution>Center for Biomedical Engineering (CEB), </institution><institution>University of Campinas, </institution></institution-wrap>Campinas, SP Brazil </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>24</day>
      <month>7</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>24</day>
      <month>7</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2020</year>
    </pub-date>
    <volume>21</volume>
    <elocation-id>332</elocation-id>
    <history>
      <date date-type="received">
        <day>2</day>
        <month>12</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>14</day>
        <month>7</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2020</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">In cell biology, increasing focus has been directed to fast events at subcellular space with the advent of fluorescent probes. As an example, voltage sensitive dyes (VSD) have been used to measure membrane potentials. Yet, even the most recently developed genetically encoded voltage sensors have demanded exhausting signal averaging through repeated experiments to quantify action potentials (AP). This analysis may be further hampered in subcellular signals defined by small regions of interest (ROI), where signal-to-noise ratio (SNR) may fall substantially. Signal processing techniques like blind source separation (BSS) are designed to separate a multichannel mixture of signals into uncorrelated or independent sources, whose potential to separate ROI signal from noise has been poorly explored. Our aims are to develop a method capable of retrieving subcellular events with minimal a priori information from noisy cell fluorescence images and to provide it as a computational tool to be readily employed by the scientific community.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">In this paper, we have developed METROID (Morphological Extraction of Transmembrane potential from Regions Of Interest Device), a new computational tool to filter fluorescence signals from multiple ROIs, whose code and graphical interface are freely available. In this tool, we developed a new ROI definition procedure to automatically generate similar-area ROIs that follow cell shape. In addition, simulations and real data analysis were performed to recover AP and electroporation signals contaminated by noise by means of four types of BSS: Principal Component Analysis (PCA), Independent Component Analysis (ICA), and two versions with discrete wavelet transform (DWT). All these strategies allowed for signal extraction at low SNR (− 10 dB) without apparent signal distortion.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3">We demonstrate the great capability of our method to filter subcellular signals from noisy fluorescence images in a single trial, avoiding repeated experiments. We provide this novel biomedical application with a graphical user interface at 10.6084/m9.figshare.11344046.v1, and its code and datasets are available in GitHub at <ext-link ext-link-type="uri" xlink:href="https://github.com/zoccoler/metroid">https://github.com/zoccoler/metroid</ext-link>.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Blind source separation</kwd>
      <kwd>ROI generation</kwd>
      <kwd>Fluorescence images</kwd>
      <kwd>Independent component analysis</kwd>
      <kwd>Voltage sensitive dyes</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001807</institution-id>
            <institution>Fundação de Amparo à Pesquisa do Estado de São Paulo</institution>
          </institution-wrap>
        </funding-source>
        <award-id>Proc. N 2011/51199-6</award-id>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100002322</institution-id>
            <institution>Coordenação de Aperfeiçoamento de Pessoal de Nível Superior</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2020</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par8">In biological and medical sciences, a continuous challenge to quantify fast biological events in space is the reliable signal extraction from images through which a physical quantity can be obtained. To that purpose, a great variety of fluorescent probes has been developed whose response could specifically correlate to a sought variable such as ion concentration, pH, electric field, gene expression, proteins interaction and location. In excitable cells, the major variable of interest is membrane electric potential. For decades, scientists have been using voltage sensitive dyes (VSD) to observe and quantify membrane potential because they allow simultaneous multi-site measurements and are relatively noninvasive when compared to microelectrodes. These fluorescent probes bind to cell membrane and show a shift in emission spectra correlated to the local electric field amplitude across the membrane [<xref ref-type="bibr" rid="CR1">1</xref>]. Historically though, externally applied fast-VSD have displayed low signals (ΔF/F ~ 0.01–10%/100 mV) [<xref ref-type="bibr" rid="CR2">2</xref>] and have been rarely used to extract signals from isolated cells, mostly due to low signal-to-noise ratio (SNR) and high susceptibility of isolated cells to phototoxic effects [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR3">3</xref>]. Even with the recent development of genetically encoded protein voltage sensors with improved responses [<xref ref-type="bibr" rid="CR4">4</xref>], where toxic effects are absent, signals must be reconstructed by exhaustive signal averaging from repeated experiments with different cell samples or different times [<xref ref-type="bibr" rid="CR5">5</xref>, <xref ref-type="bibr" rid="CR6">6</xref>].</p>
    <p id="Par9">Certain situations make repeated experiments unfeasible with the same sample, like in cell electroporation assays by external electrical fields. Cellular membranes abound with polar and charged molecules, which respond to an increasing electrical field pulse by spatially varying their electrical potential in a cossenoidal fashion, depolarizing towards the cathode side and hyperpolarizing towards the anode side [<xref ref-type="bibr" rid="CR7">7</xref>, <xref ref-type="bibr" rid="CR8">8</xref>]. Once this membrane potential reaches a certain threshold, usually at one or both cell edges, electroporation can be inferred by a rapid and persistent membrane potential transition from threshold values towards zero all over the membrane, which is attributed to a drastic increase in membrane permeability by means of pore formation [<xref ref-type="bibr" rid="CR9">9</xref>]. This experiment configuration is hardly repeatable for two main reasons: cells either die after successive shocks from cumulative damage or they recover after several minutes, but activate membrane repair mechanisms that make their response to a second membrane disruption different [<xref ref-type="bibr" rid="CR10">10</xref>]. Therefore, electroporation measurements usually depend on a single trial per sample, which renders high fluorescence signals essential.</p>
    <p id="Par10">Alongside with new fluorescent probes development and modern microscope designs, quantification of membrane potential benefits from improved image and signal processing methods. A common first step in fluorescence imaging measurements is to select regions of interest (ROI) comprehending local events as an attempt to highlight a desired signal. In spite of this, the simple fact that a smaller area is selected accentuates noise power due to a decreased shot noise spatial averaging. If the local event amplitude is not high enough, ROI signals may be overflown by noise and the sample may be either discarded or may demand repeated measurements for later temporal averaging. Instead of this, signals from a single sample could be filtered prior to quantification.</p>
    <p id="Par11">A classic way to remove unwanted frequencies is with digital filters. However, it is usually difficult to determine filter cutoff frequencies adequate to remove noise without distorting cellular signal, because signal frequency components may be unknown. Time-frequency analysis like wavelet analysis could help at identifying relevant frequencies because they are able to display frequency components in a time-dependent manner, facilitating signal frequency determination when signal manifestation in time is known. Indeed, such methods have proven more effective than digital filtering to extract physiological signals [<xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR12">12</xref>], but they are still sensitive to the mother wavelet, scale selection and coefficients thresholding algorithm [<xref ref-type="bibr" rid="CR13">13</xref>].</p>
    <p id="Par12">Another set of techniques that has become very popular to separate physiological signals is Blind Source Separation (BSS). These methods require almost no a priori knowledge of the underlying sources of signal besides some reasonable assumptions like noncorrelation or statistical independence [<xref ref-type="bibr" rid="CR14">14</xref>]. To accomplish this challenging task, BSS methods rely on statistical signal processing and information theory rather than decomposing signal into frequency components. Therefore, they are better suited to analyze non-stationary signals, which is often the case of cellular signals.</p>
    <p id="Par13">In this work, we have performed an extensive analysis of VSD fluorescence signal extraction, from ROI design to real data application, yielding the Morphological Extraction of Transmembrane potential from Regions of Interest Device (METROID). It includes a consistent and automatic method for ROI generation followed by ROI signal filtering by means of BSS techniques. To test its effectiveness, we have compared four BSS techniques performances by means of computer signal processing simulations and we have implemented these simulation optimal results into simulated imaging data and into experimental data composed of fluorescence images produced by exposing isolated cardiomyocytes loaded with VSD to external electric field stimulation. METROID is made available to a broad audience: for developers, its code is freely available online as jupyter notebooks, and for non-programmers, a version with a graphical interface is supplied.</p>
  </sec>
  <sec id="Sec2">
    <title>Results</title>
    <sec id="Sec3">
      <title>METROID general workflow</title>
      <p id="Par14">The method is composed of three main steps: automatic ROI generation, photobleaching correction and signal filtering (Fig. <xref rid="Fig1" ref-type="fig">1</xref>). ROI generation is automatically done over a cell mask, which can be also automatically generated or can be manually drawn and edited. The procedure uses a series of classic image processing techniques such as morphological operators [<xref ref-type="bibr" rid="CR15">15</xref>], image rotation and discrete geometry to divide the mask into quasi-isometric regions. ROIs arise in a standardized fashion, shaped to each cell particular contour, but maintaining a similar area and location, which makes ROIs easier to compare among samples of different shapes. Then, photobleaching removal from each ROI is done by non-linear curve fit. After that, signal filtering is achieved by applying a BSS method using ROI means as multiple observations of a cellular event contaminated by noise. We have compared the performance of Principal Component Analysis (PCA) [<xref ref-type="bibr" rid="CR16">16</xref>] and Independent Component Analysis (ICA) [<xref ref-type="bibr" rid="CR17">17</xref>]. Yet, from very early simulations, it was clear that some part of the noise would inevitably remain in the selected source, therefore, as an attempt to further eliminate noise, we have also evaluated a complementary version of these techniques by filtering out higher frequencies of the selected source by means of Discrete Wavelet Transform (DWT) [<xref ref-type="bibr" rid="CR18">18</xref>]. We have applied DWT onto ICA (wICA) or PCA (wPCA) selected source to eliminate residual noise.
<fig id="Fig1"><label>Fig. 1</label><caption><p>Schematic of the proposed method used by METROID to remove noise from cell fluorescence image. After recording images and creating a cell mask, regions of interest (ROIs) are automatically generated respecting cell shape. Then photobleaching is removed by non-linear curve fit. Finally, one of four blind source separation methods (PCA, ICA, wPCA or wICA) is used to separate signal and noise into different channels. Noise channels are discarded and signal is rebuilt with the remaining source for subsequent data calibration</p></caption><graphic xlink:href="12859_2020_3661_Fig1_HTML" id="MO1"/></fig></p>
      <p id="Par15">After one of the BSS methods mentioned above was applied, ROI means were rebuilt by applying the inverse transformation using only a selected source containing the signal of interest. This way, noise was removed by discarding noise channels before rebuilding observations (plus eliminating some higher frequency components from the selected source with DWT when wICA or wPCA were used). In the end, a calibration method was done to convert signals from arbitrary units (A.U.) to millivolts.</p>
    </sec>
    <sec id="Sec4">
      <title>Regions of interest results</title>
      <p id="Par16">We called our ROI design procedure as Morphological Equal-area Standardized Segmentation (MESS). MESS was designed to deal with ellipsoidal cells, like the cardiomyocyte picture shown in Fig. <xref rid="Fig2" ref-type="fig">2</xref>a, but we illustrate its application to two other cell types to test its limits. We show in Fig. <xref rid="Fig2" ref-type="fig">2</xref>b the result of dividing the cardiomyocyte shape (yellow contour in Fig. <xref rid="Fig2" ref-type="fig">2</xref>a) into 32 ROIs. We show in Fig. <xref rid="Fig2" ref-type="fig">2</xref>c and d the application to an ameboid cell DIC image and in Fig. <xref rid="Fig2" ref-type="fig">2</xref>e and f the application to a strongly asymmetric neuron cell fluorescence image, where we have applied a different number of inner and outer ROIs. In all cases, MESS fully divides the mask into inner and outer ROIs in a standardized fashion, which is image rotation independent. In the cardiomyocyte and ameboid cells, quasi-isometric division was obtained, but in the neuron, this was not possible because dendrites and axons greatly contribute to the outer mask area.
<fig id="Fig2"><label>Fig. 2</label><caption><p>Example of Morphological Equal-area Standardized Segmentation (MESS) application to some cell types and shapes. <bold>a</bold> Isolated rat cardiomyocyte image. <bold>b</bold> Cardiomyocyte standardized ROIs. <bold>c</bold> Ameboid cell (an image of “Shinya Inoue (2011) CIL:11941, Dictyostelium discoideum, amoeboid cell. CIL. Dataset.” (<ext-link ext-link-type="uri" xlink:href="http://cellimagelibrary.org/images/11941">http://cellimagelibrary.org/images/11941</ext-link>), used under CC BY-NC-SA 3.0 (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-sa/3.0/legalcode">https://creativecommons.org/licenses/by-nc-sa/3.0/legalcode</ext-link>)) overlaid by contour of cell mask. <bold>d</bold> Ameboid cell standardized ROIs. <bold>e</bold> Rat multipolar neuron (“Tonya Anderson, Deanna Benson (2010) CIL:807, Rattus, multipolar neuron. CIL. Dataset.” (<ext-link ext-link-type="uri" xlink:href="http://cellimagelibrary.org/images/807">http://cellimagelibrary.org/images/807</ext-link>), public domain) overlaid by contour of cell mask. <bold>f</bold> Neuron standardized ROIs</p></caption><graphic xlink:href="12859_2020_3661_Fig2_HTML" id="MO2"/></fig></p>
    </sec>
    <sec id="Sec5">
      <title>Signal processing simulation results</title>
      <p id="Par17">We have filtered manufactured AP or step signals contaminated by noise with each of the BSS methods and with a classical lowpass digital filter, evaluating their performances by error and correlation measures. We show in Fig. <xref rid="Fig3" ref-type="fig">3</xref>a one noisy AP observation (SNR = − 10 dB, continuous light gray), the original AP signal without the added noise (continuous black line), and the recovered signals from each method (dashed and dot-dashed color signals). Each signal was time-shifted for better visualization and a matching style arrow indicates each signal starting point. We present the filtering methods relative error for AP maximal amplitude (E<sub>r_Amp</sub>) as a function of SNR in Fig. <xref rid="Fig3" ref-type="fig">3</xref>b and Pearson correlation coefficient (<italic>r</italic>) in Fig. <xref rid="Fig3" ref-type="fig">3</xref>c. The shaded regions represent standard errors of the mean. Around − 7.5 dB, ICA and PCA E<sub>r_Amp</sub> means become closer to unfiltered data mean, but with a much smaller variability and a much higher correlation with the original signal (r &gt; 0.9 since -15 dB, Fig. <xref rid="Fig3" ref-type="fig">3</xref>c), which can also be inferred from representative traces in Fig. <xref rid="Fig3" ref-type="fig">3</xref>a. Figure <xref rid="Fig3" ref-type="fig">3</xref>d shows the same situation for the step observation and, in this case, each signal was amplitude-shifted for better visualization and a matching style arrow indicates the shifted baseline. Figure <xref rid="Fig3" ref-type="fig">3</xref>e contains E<sub>r_Amp</sub> for the step as a function of SNR. The modulus of E<sub>r_Amp</sub> amplitude mean is smaller than unfiltered data mean since -10 dB, and seems to approach zero at smaller SNR for PCA and wPCA than for ICA and wICA. For both signals, we can see that wavelet-based methods better resemble original signals, which is consistent with removal of extraneous noise that remained in the selected source channel. This is counterbalanced by an increase of the modulus of E<sub>r_Amp</sub> mean values at some SNR in AP simulations. The lowpass filter applied to AP signal also resulted in small E<sub>r_Amp</sub> means (less than 10%), but signal deformation is clear and even more evident, as expected, for step signal.
<fig id="Fig3"><label>Fig. 3</label><caption><p>Signal extraction by different filtering methods. <bold>a</bold> Representative simulated AP trace recovered by different BSS methods. Signals are time-shifted for better visualization. Black continuous line is the original noise-free AP signal, gray continuous line is a noisy observation (SNR = − 10 dB), blue dashed line is ICA output, red dashed line is PCA output, green dot-dashed line is wICA output, orange dot-dashed line is wPCA output and purple dotted line is 5th order low-pass Butterworth filter. Matching style arrows indicate AP signal onset time. <bold>b</bold> Relative error for maximal AP amplitude (E<sub>r_Amp</sub>) as function of SNR for AP signal. Gray stars represent E<sub>r_Amp</sub> means calculated directly from noisy data (<italic>N</italic> = 120 samples for each mean), blue circles represent ICA means, red squares represent PCA means, green inverted triangles represent wICA means, orange triangles represent wPCA means and purple crosses represent 5th order low-pass Butterworth filter. Shaded regions correspond to standard errors of the mean. <bold>c</bold> Correlation coefficient (<italic>r</italic>) means for AP signal calculated in AP active interval (N = 12 samples for each mean). <bold>d</bold> Representative simulated step recovered by different methods. Signals are amplitude-shifted for better visualization. Line color and styles represent the same outputs as in (<bold>a</bold>). Matching style arrows indicate step signal baseline amplitude. <bold>e</bold> E<sub>r_Amp</sub> for step function</p></caption><graphic xlink:href="12859_2020_3661_Fig3_HTML" id="MO3"/></fig></p>
      <p id="Par18">Root-mean-squared errors (RMSE) as a function of SNR were also calculated and are presented in Additional file <xref rid="MOESM1" ref-type="media">1</xref>. The results for the simulations where, instead of varying SNR, we have varied the number of components (<italic>m</italic>) and the number of observations (<italic>n</italic>) are provided as supplementary materials (Additional files <xref rid="MOESM2" ref-type="media">2</xref> and <xref rid="MOESM3" ref-type="media">3</xref>, respectively). Overall, these figures reveal that a lower <italic>m</italic> and a higher <italic>n</italic> tend to give smaller errors and bigger correlations. In particular, <italic>m</italic> = 2 and <italic>m</italic> = 3 give the smallest errors, and <italic>n</italic> &gt; 30 tends to hamper error increase.</p>
      <p id="Par19">Similar simulations with an added exponential function were run at SNR = − 10 dB, mimicking photobleaching presence. The photobleaching compensation performance was evaluated by fitting noisy data with the same exponential function, but based on three different noisy data portions: before signal onset, which we called Single Bind Photobleaching Correction (SBPC), before signal onset plus after signal end, which we called Double Bind Photobleaching Correction (DBPC) and whole data, including signal, which we called Full Data Photobleaching Correction (FDPC). SBPC and DBPC were applied to AP simulations because it is a transitory signal, and SBPC and FDPC were applied to step simulations. Examples of each photobleaching correction are provided in Additional file <xref rid="MOESM4" ref-type="media">4</xref>. Results from relative errors of fitting exponential parameters are shown in Additional file <xref rid="MOESM5" ref-type="media">5</xref> and the impact of each photobleaching correction over each BSS method applied afterwards is shown in Additional file <xref rid="MOESM6" ref-type="media">6</xref>. In almost every situation, SBPC displayed a worse performance while the other photobleaching correction methods were either similar to results without photobleaching (mainly observed in relative errors) or slightly, but significantly different (mainly observed in RMSE). When either DBPC or FDPC were used, the modulus of E<sub>r_Amp</sub> mean of every BSS method was always smaller than 8%, while using SBPC could make these means reach values as high as 26%.</p>
    </sec>
    <sec id="Sec6">
      <title>METROID interface</title>
      <p id="Par20">METROID code and experimental data are freely available in jupyter notebook format at <ext-link ext-link-type="uri" xlink:href="https://github.com/zoccoler/metroid">https://github.com/zoccoler/metroid</ext-link> and its version with a graphical interface can be downloaded at 10.6084/m9.figshare.11344046.v1. The user must provide the following mandatory inputs:
<list list-type="order"><list-item><p id="Par21">Path to directory containing the fluorescence video or cell mask. Videos should be “.tif” grayscale stack images and masks should be “.tif” binary images (optionally masks can be manually drawn over an image);</p></list-item><list-item><p id="Par22">Video frame rate;</p></list-item><list-item><p id="Par23">Whether signal should be treated as transitory or persistent. In the jupyter notebook code, this is done by the input variable called ‘transitory’, while in the graphical interface, this is done by a drop-down list. This variable is important for two reasons: first, to select the photobleaching correction method to be used (DBPC or FDPC) when bleaching compensation is desired, and second, as a guide to detect and estimate signal active interval, used to drive automatic component selection.</p></list-item></list></p>
      <p id="Par24">Many optional parameters may be provided, which may improve signal extraction quality (default values or strategy used to obtain them are shown in following parenthesis): number of inner ROIs (16), number of outer ROIs (16), time of signal onset (time of biggest modulus of derivative calculated from whole cell signal mean over time), time of signal ending (time where whole cell signal mean over time falls below estimated noise), number of BSS components (1), BSS method (ICA), wavelet (<italic>Haar</italic>, not used if method is ICA or PCA), and manual or automatic source selection (‘auto’). If source selection is set to manual, all sources are plotted, execution is halted and more than one source may be selected by the user before BSS inverse transformation.</p>
      <p id="Par25">We present the two possible interfaces supplied for METROID in Fig. <xref rid="Fig4" ref-type="fig">4</xref>. In Fig. <xref rid="Fig4" ref-type="fig">4</xref>a, we show how METROID can be executed on two AP videos with a few lines of Python code. Briefly, METROID path is appended to the interpreter’s search path, then METROID is imported, mandatory input variables are set and finally the main METROID function (also called metroid) is called with the mandatory inputs and preceded by output variables. In Fig. <xref rid="Fig4" ref-type="fig">4</xref>b, we show METROID with its graphical interface after a video has been processed. The video can be played in the left panel and each ROI filtered signal over time can be displayed as a graphic in a new window by double-clicking on the respective ROI. Right panel allows the user to provide input variables and all outputs can be saved in an output folder once execution is completed. Some other editing options are: cell mask can be drawn manually, ROIs can be imported from an external file compatible with ImageJ’s ROI Manager tool output and photobleaching correction can be disabled.
<fig id="Fig4"><label>Fig. 4</label><caption><p>METROID interfaces. <bold>a</bold> Block of code in jupyter notebook format to import and run METROID to process two AP videos. <bold>b</bold> Main window of METROID graphical user interface version after an AP video had been processed</p></caption><graphic xlink:href="12859_2020_3661_Fig4_HTML" id="MO4"/></fig></p>
    </sec>
    <sec id="Sec7">
      <title>METROID performance on simulated imaging data</title>
      <p id="Par26">We have generated simulated fluorescence videos, where we have complete knowledge about the underlying signal, to validate our method. The videos consist of the sum of a basal fluorescence profile image, a membrane potential signal (AP or electroporation) modulated for a desired SNR, a photobleaching function and simulated shot noise. We show in Fig. <xref rid="Fig5" ref-type="fig">5</xref> the performance comparison of METROID with several other methods on a simulated imaging data with the same SNR distribution per ROI and the same number of ROIs (32) as the experimental data presented in the next section. The number of ROIs was chosen as 32 because, from signal processing simulations, <italic>n</italic> &gt; 30 has proven to be enough to hamper error increase. The other methods used for comparison were either derived from flat-field correction and detrending methods, like blank subtraction (BkS) and blank subtraction with detrending (BkSD, analog to [<xref ref-type="bibr" rid="CR19">19</xref>]), or based on classical repeated signal averaging, like the time average of 10 videos (avg10) and of 400 videos (avg400, performed experimentally in [<xref ref-type="bibr" rid="CR6">6</xref>]). METROID was run with its default parameters and with two settings of optimized parameters (method selection and signal onset and end times provided). In Fig. <xref rid="Fig5" ref-type="fig">5</xref>a, we show representative traces of one of the ROIs average over time (ROI #1, closer to the anode side). Pure AP signal is displayed as black circles and unfiltered trace is shown as dark gray dotted lines. BkS is shown as continuous gray lines, BkSD is shown as dashed light gray lines, avg10 is shown as pink dot-dashed lines, avg400 is shown as purple dot-dashed lines, METROID default is shown as thick olive green dashed lines, METROID with ICA is shown as blue continuous lines and METROID with wICA is shown as green continuous lines. In Fig. <xref rid="Fig5" ref-type="fig">5</xref>b, we show E<sub>r_Amp</sub> means of each method and, in Fig. <xref rid="Fig5" ref-type="fig">5</xref>c, we show <italic>r</italic> means of each method with vertical bars representing standard errors of the means. Non-parametric Kruskal-Wallis test indicated a significant difference among E<sub>r_Amp</sub> means, with Dunn’s post-test only indicating adjusted significant <italic>p</italic>-values (<italic>P</italic> &lt; 0.05) when comparing BkSD to avg10, and BkSD to avg400.
<fig id="Fig5"><label>Fig. 5</label><caption><p>METROID comparison to other methods on simulated imaging data (SNR similar to experimental data). <bold>a</bold> Representative traces in a ROI of AP filtered signal by different methods. Black circles represent true AP signal, dark gray dotted lines are ROI mean over time, gray continuous lines are BkS, light gray dashed lines are BkSD, pink dot-dashed lines are the average of 10 videos (avg10), purple dot-dashed lines are the average of 400 videos (avg400), olive green thick dashed lines are METROID output with default parameters, blue continuous lines are METROID optimized with ICA (onset and end times supplied), and green continuous lines are METROID with wICA (onset and end times supplied). <bold>b</bold> E<sub>r_Amp</sub> means of each method (<italic>N</italic> = 32). Vertical lines represent standard error of the means. <bold>c</bold><italic>r</italic> means. <bold>d</bold> Representative traces in a ROI closer to the cathode side of electroporation filtered signal by different methods. Same color scheme as in (<bold>a</bold>), except that red continuous lines are METROID optimized with PCA (onset and end times supplied, <italic>m</italic> = 3), and orange continuous lines are METROID optimized with wPCA (onset and end times supplied, <italic>m</italic> = 3). <bold>e</bold> Peak E<sub>r_Amp</sub> means. <bold>f</bold> Stationary E<sub>r_Amp</sub> means</p></caption><graphic xlink:href="12859_2020_3661_Fig5_HTML" id="MO5"/></fig></p>
      <p id="Par27">In Fig. <xref rid="Fig5" ref-type="fig">5</xref>d, we show representative traces of the same ROI, but for simulated electroporation video. The methods, line styles and color scheme are the same as Fig. <xref rid="Fig5" ref-type="fig">5</xref>a, except that METROID optimized methods were changed from ICA to PCA, shown in red, and from wICA to wPCA, shown in orange, both with onset time provided and <italic>m</italic> = 3 to allow 2 sources to be selected and 1 noise to be discarded. These choices were done based on better performances shown by each method in previous signal processing simulations. We show, in Fig. <xref rid="Fig5" ref-type="fig">5</xref>e, the peak E<sub>r_Amp</sub>, which describes the amount of error from the true peak in each ROI, and we show, in Fig. <xref rid="Fig5" ref-type="fig">5</xref>f, the stationary E<sub>r_Amp</sub>, which describes the amount of error from the true median value after signal onset (same definition as in signal processing simulations, i.e., relative error from step amplitude). Kruskal-Wallis test on peak E<sub>r_Amp</sub> means failed to indicate statistical difference. One-way analysis of variance indicated statistical difference for stationary E<sub>r_Amp</sub> means, with Tukey’s post-test showing significant adjusted <italic>p</italic>-values when comparing BkS with all others, BkSD with all others and METROID default with all others.</p>
      <p id="Par28">RMSE means of each method can be visualized in Additional file <xref rid="MOESM7" ref-type="media">7</xref>. We have also analyzed a similar artificial video without photobleaching (Additional file <xref rid="MOESM8" ref-type="media">8</xref>), an artificial video with photobleaching, but with poorer SNR per ROI (SNR = − 10 dB in all 32 ROIs, Additional file <xref rid="MOESM9" ref-type="media">9</xref>) and one last artificial video without photobleaching with this same low SNR = − 10 dB (Additional file <xref rid="MOESM10" ref-type="media">10</xref>).</p>
    </sec>
    <sec id="Sec8">
      <title>METROID performance on VSD imaging real data</title>
      <p id="Par29">We have applied METROID onto real data generated from experiments with isolated cardiomyocytes loaded with a potentiometric dye under external electric filed stimulation. METROID took 1.67 s ± 0.07 s (mean ± SD) to complete processing a video of 130 frames after parameters definition. Figure <xref rid="Fig6" ref-type="fig">6</xref> is an example of photobleaching correction followed by BSS application in an isolated cardiomyocyte, but it is also a composite version of the window displayed once the user double-clicks a ROI. In Fig. <xref rid="Fig6" ref-type="fig">6</xref>a, cell bright-field image is overlaid by the selected ROI. In Fig. <xref rid="Fig6" ref-type="fig">6</xref>b and c, the graphics to the left were generated from experimental AP video and the graphics to the right were generated from experimental electroporation video. In Fig. <xref rid="Fig6" ref-type="fig">6</xref>b, we show ROI means over time as light gray continuous curves, data input for DBPC as dark blue dots and the DBPC output as a light blue dashed curve. In Fig. <xref rid="Fig6" ref-type="fig">6</xref>b right graphic, we also show data input for photobleaching correction as dark green dots (in this case corresponding to the entire data) and FDPC output as a light green dashed curve. The curve that actually represents photobleaching does not have a step, so we show FDPC without the step as a dot-dashed green curve and this is the curve that is subtracted from noisy data to fix photobleaching.
<fig id="Fig6"><label>Fig. 6</label><caption><p>Experimental VSD imaging real data application. <bold>a</bold> Bright-field isolated cardiomyocyte image overlaid by one ROI. <bold>b</bold> ROI means photobleaching correction for AP experiment (left graphic) and electroporation experiment (right graphic). Gray continuous lines are ROI means over time, dark blue or dark green dots are photobleaching correction input data, dashed light blue line (left graphic) is Double Bind Photobleaching Correction (DBPC), dashed light green line (right graphic) is Full Data Photobleaching Correction (FDPC), and dot-dashed green line is FDPC without step. <bold>c</bold> Blind source separation application after photobleaching correction for AP (left graphic) and electroporation (right graphic) experiments. Gray continuous line are ROI means fixed for photobleaching, thick blue continuous line (left graphic) is ICA output, light blue dashed line is wICA output, thick dark red continuous line is PCA output (right graphic), and orange dashed line is wPCA output. Estimated signal-to-noise ratios (SNR) are shown above each graphic</p></caption><graphic xlink:href="12859_2020_3661_Fig6_HTML" id="MO6"/></fig></p>
      <p id="Par30">In Fig. <xref rid="Fig6" ref-type="fig">6</xref>c left graphic, we show noisy data corrected by DBPC as gray continuous curve, ICA output as thick continuous blue curve, wICA as light blue dashed curve and the estimated SNR above the graphic. The estimated SNR for all ROIs stood between − 13.31 dB and 3.29 dB, with an average of − 1.54 dB. ICA reduced noise power by an average of 97.24%, whereas wICA reduced it by an average of 94.14%.</p>
      <p id="Par31">In Fig. <xref rid="Fig6" ref-type="fig">6</xref>c right graphic, we show noisy data corrected by FDPC as gray continuous curve, PCA as thick dark red continuous curve, wPCA as yellow dashed curve and estimated SNR above the graph. Overall, estimated SNR remained between − 4.33 dB and 8.47 dB with an average of 4.24 dB. PCA reduced noise power by an average of 96.23%, whereas wPCA reduced it by an average of 99.93%. The same figure portraying the other ROIs results can be viewed as a movie (see Additional file <xref rid="MOESM11" ref-type="media">11</xref>).</p>
      <p id="Par32">In Fig. <xref rid="Fig7" ref-type="fig">7</xref>a, we show all ROIs generated by ROI standardization filled with a color scale corresponding to membrane potential amplitude. Three time instants were chosen to show membrane potential: before AP (Fig. <xref rid="Fig7" ref-type="fig">7</xref>a left image), at AP peak (Fig. <xref rid="Fig7" ref-type="fig">7</xref>a middle image), and in plateau phase Fig. <xref rid="Fig7" ref-type="fig">7</xref>a right image). AP signal was filtered by ICA here and AP peak was 40 mV by calibration design. We have measured duration at 25 and 75% repolarization (APD<sub>25</sub> and APD<sub>75</sub>), obtaining APD<sub>25</sub> = 35.8 ms and APD<sub>75</sub> = 251 ms. Then, in Fig. <xref rid="Fig7" ref-type="fig">7</xref>b, we also show membrane potential for electroporation video filtered by wPCA before strong stimulus pulse (Fig. <xref rid="Fig7" ref-type="fig">7</xref>b left image), at electroporation peak instant (Fig. <xref rid="Fig7" ref-type="fig">7</xref>b middle image), and after electroporation (Fig. <xref rid="Fig7" ref-type="fig">7</xref>b right image). The highest membrane potential levels (V<sub>max</sub>) obtained were 166.18 mV and 168.28 mV in the ROIs that achieved red color levels.
<fig id="Fig7"><label>Fig. 7</label><caption><p>Cell membrane potential variation. <bold>a</bold> Cell standardized ROIs filled with colors representing membrane potentials before AP triggering (left), at AP peak (middle) and at AP plateau (right). <bold>b</bold> Cell ROIs with calibrated membrane potentials before electroporating pulse (left), at signal peak (middle) and after pulse (right)</p></caption><graphic xlink:href="12859_2020_3661_Fig7_HTML" id="MO7"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec9">
    <title>Discussion</title>
    <sec id="Sec10">
      <title>Regions of interest design</title>
      <p id="Par33">MESS has proven to be an easy and robust method to generate ROIs systematically, regardless of cell shape and orientation. Cytoplasm heterogeneity is represented in a mosaic-like division, but split into inner and outer ROIs. This feature has allowed membrane potential analysis around cell contour, which is often sought in experiments with externally applied electric fields [<xref ref-type="bibr" rid="CR8">8</xref>, <xref ref-type="bibr" rid="CR20">20</xref>, <xref ref-type="bibr" rid="CR21">21</xref>], without wasting information coming from inner regions.</p>
      <p id="Par34">Although not designed for strongly irregular shapes like neurons, MESS could still be applied if the sole purpose is to generate subcellular samples, as demonstrated in Fig. <xref rid="Fig2" ref-type="fig">2</xref>. Since we have the presence of dendrites and axons that greatly contribute to cell external perimeter, the number of morphological erosions necessary to achieve half area is relatively small, which compromised outer ROIs area equality, because ROIs that represent dendrites or axons (ROIs 1, 5, 8, 11, 14 and 16) retained a higher than average area while ROIs in between were left with lower than average area.</p>
      <p id="Par35">MESS has some limitations, starting with the fact that the method is sensible to motion artifacts since ROIs are static. Besides that, user has no specific control about ROIs springing place. If the user wants to change a ROI location, a possible approach is to change the number of outer ROIs (<italic>n_ROIs_out</italic>) and/or the number of inner ROIs (<italic>n_ROIs_in</italic>), which changes their area and location simultaneously. However, MESS is not designed to detect and delineate sparse subcellular events in space, like calcium sparks for instance. For that goal, we suggest users to use softwares that generate ROIs based on image content [<xref ref-type="bibr" rid="CR22">22</xref>, <xref ref-type="bibr" rid="CR23">23</xref>]. Finally, there are limits to the number of ROIs: <italic>n_ROIs_out</italic> ≥ 2, <italic>n_ROIs_in</italic> ≥ 4 and <italic>n_ROIs_in</italic> must be even. The maximum number of ROIs will depend on image resolution.</p>
    </sec>
    <sec id="Sec11">
      <title>Signal processing simulations</title>
      <p id="Par36">Our simulations have shown that we were able to retrieve a single source containing cellular information blended in a set of random shot noises. From our results, it was clear that any BSS method could outperform digital filtering at SNR ≥ − 10 dB if we consider E<sub>r_Amp</sub> and <italic>r</italic> (Fig. <xref rid="Fig3" ref-type="fig">3</xref>b, c and e). Digital filters also demand anticipated signal frequency components knowledge, while with BSS methods, the single preceding information that we have anticipated was signal onset time in order to allow automatic source selection. In cases where signal onset information is absent, source selection can be done by visual inspection as already performed in other studies [<xref ref-type="bibr" rid="CR24">24</xref>].</p>
      <p id="Par37">To compare among BSS methods, we should first consider in what conditions each of them would stand out. Briefly, PCA converts the original observations into an orthogonal linear basis. If the underlying sources are uncorrelated, this usually highlights signal from noise, especially if they have normal distributions and distinct variances. On the other hand, ICA excels at identifying independent sources with nongaussian distributions and it is expected to work properly even with one gaussian distribution source in the mixture [<xref ref-type="bibr" rid="CR17">17</xref>]. Now, in our simulations, the original signals chosen had a skewed (AP) or bimodal (step) distribution, from which ICA could benefit, but since simulated shot noises approach normal distributions, due to a relatively high λ value from Poisson distribution, it was not clear if ICA would outperform PCA. This may explain, as depicted by Fig. <xref rid="Fig3" ref-type="fig">3</xref>, why it is difficult to elicit ICA or PCA as an overall better candidate. Their results are practically the same for <italic>r</italic>, and this also happens for E<sub>r_Amp</sub> in AP simulations, but in step signal simulations (Fig. <xref rid="Fig3" ref-type="fig">3</xref>e), PCA seems better than ICA for SNR ≤ − 12.5 dB (remark that this cannot be stated at -10 dB because their absolute values are very close).</p>
      <p id="Par38">Wavelet-composed methods seemed promising since they would be able to adaptively eliminate noise higher frequencies without affecting signal components. Indeed, from Fig. <xref rid="Fig3" ref-type="fig">3</xref>, we can see that restored signals are smoother than those recovered without wavelets. Besides that, correlation seems unaffected when compared to PCA or ICA alone. Nonetheless, there is a striking different behavior when we compare E<sub>r_Amp</sub> for AP simulations against step simulations: for step simulations, wICA and wPCA errors are close to ICA and PCA, respectively, but, for AP simulations, their performance is worse and wildly variable. It seems likely that our wavelet thresholding method affected some frequencies present in signal range as signal power was increased. Changing some wavelet parameters like the mother wavelet and the thresholding parameter (<italic>K</italic>) could diminish those errors, but this is beyond the scope of this study.</p>
      <p id="Par39">In our photobleaching simulations, we have shown that, as expected, the more information we provide as input, the better success we get from curve fitting: FDPC performs better than DBPC, which performs better than SBPC (Additional file <xref rid="MOESM4" ref-type="media">4</xref>). Other solutions could be using low-rejection filters or letting photobleaching participate in BSS as another source. Unfortunately, both of these methods fail: low-rejection filters are unable to completely eliminate trend and also end up distorting the source of interest whereas letting exponential into BSS left part of it blended into the source containing the original source (data not shown).</p>
    </sec>
    <sec id="Sec12">
      <title>Simulated imaging data</title>
      <p id="Par40">METROID E<sub>r_Amp</sub> on AP artificial imaging data was not different from any other method, which is already an advantage since it is the only option without the need of extra videos. BkS displayed the lowest E<sub>r_Amp</sub> mean and requires just one extra video sample without stimuli, but it is evident from the representative traces (Fig. <xref rid="Fig5" ref-type="fig">5</xref>a) and from <italic>r</italic> results (Fig. <xref rid="Fig5" ref-type="fig">5</xref>c) that it fails at recovering the AP signal waveform. METROID also displayed lower RMSE than other methods, except avg400. This scenario persists even in an artificial video with low SNR (Additional file <xref rid="MOESM9" ref-type="media">9</xref>), but in this case METROID need the onset and end time information. Intriguingly, the difference between avg10 and avg400 is smaller than expected from signal averaging. This was due to residues from photobleaching compensation since when we analyzed the videos without photobleaching (Additional files <xref rid="MOESM8" ref-type="media">8</xref> and <xref rid="MOESM10" ref-type="media">10</xref>), the difference in their E<sub>r_Amp</sub> means escalates substantially.</p>
      <p id="Par41">For electroporation artificial videos, the signal can be decomposed into two sources: one containing the peak value due to membrane charging before pore formation and the second containing the stationary value corresponding to the situation where rest membrane potential is lost and membrane potential tends towards zero. Both component amplitudes vary spatially, but the peak component has an extra variation due to different membrane charging around the cell, displaying a different direction with respect to the baseline fluorescence. That said, the peak E<sub>r_Amp</sub> means were not statistically different (Fig. <xref rid="Fig5" ref-type="fig">5</xref>e), but once we introduce a uniform poor SNR of -10 dB situation (Additional file <xref rid="MOESM9" ref-type="media">9</xref>), we obtain statistical difference among means. This is because a very weak punctual peak failed to be disentangled from noise into a separate component. We have seen that this separation only starts to take places when ROIs SNR &gt; − 3 dB, therefore peak detection should be possible when ROI SNR is within this range. Stationary E<sub>r_Amp</sub> mean is also statistically smaller for BkS, so its median value should be more reliable to get the stationary value, but we can see from Fig. <xref rid="Fig5" ref-type="fig">5</xref>d and Additional file <xref rid="MOESM7" ref-type="media">7</xref> that it still contains a lot of noise and does not resemble the true signal. BkSD displayed in general higher errors than BkS probably because photobleaching was already well compensated in BkS (negligible drift between samples). Lastly, METROID default performs the worst for stationary E<sub>r_Amp</sub> because it selects only one signal source and, in this case, it took the peak component, leaving the stationary component out and justifying the error of about 100%. However, results from the default situation often provide the information needed to optimize METROID parameters, like signal onset timing and expected number of sources, making possible to reach its optimized results in a subsequent run.</p>
    </sec>
    <sec id="Sec13">
      <title>Experimental imaging data</title>
      <p id="Par42">In a single trial, METROID was capable of extracting and characterizing AP and electroporation signals from small ROIs whose signals would be otherwise impossible to analyze due to elevated noise power. In addition, the process can be fully automated if default parameters are used because ROIs are systematically generated and the component containing the signal is automatically selected based on cell global signal. Therefore, the user can process a video by just providing the video itself, plus the overall ‘transitory’ parameter if photobleaching correction is needed. This is a good strategy if user knows little about the data, but some rerunning with edited parameters may be required for better results, especially if signal onset time is wrong.</p>
      <p id="Par43">Photobleaching correction was very effective, which can be verified by the flat baseline outside signal active interval, and noise was extensively removed (Fig. <xref rid="Fig6" ref-type="fig">6</xref>c). Fitting photobleaching by a combination of exponential and linear functions has shown to be a better compromise between goodness of fit and convergence. To check whether filtered signals are in agreement with reports from the literature, we have compared some of their characteristics. AP was longer than reported in the literature for the same cell type (APD<sub>75</sub> = 46 ± 4.1 ms [<xref ref-type="bibr" rid="CR25">25</xref>]). This is probably due to phototoxic effects of potentiometric dyes like RH-237 [<xref ref-type="bibr" rid="CR26">26</xref>, <xref ref-type="bibr" rid="CR27">27</xref>], despite our efforts to minimally expose cells to excitation light. In addition, we could not directly assess AP amplitude during the experiments, thus AP amplitudes are relied on literature of same cell type.</p>
      <p id="Par44">In Fig. <xref rid="Fig7" ref-type="fig">7</xref>b, we can see two ROIs with strikingly higher membrane potential variation. They are located close to a cell edge facing an electrode since electric field was applied vertically. As such, they could represent electroporated regions with electroporation threshold being 248.28 mV. Other studies have found higher threshold values (300-400 mV [<xref ref-type="bibr" rid="CR28">28</xref>], 480-650 mV [<xref ref-type="bibr" rid="CR8">8</xref>]), but a review study shows that thresholds can vary from 200 mV to 1 V [<xref ref-type="bibr" rid="CR9">9</xref>]. These variations are due to several factors like the technique used (patch-clamp in [<xref ref-type="bibr" rid="CR28">28</xref>]), sensitivity of the image system, which includes our relatively low frame rates, cell type (rat cardiomyocytes in our work, frog cardiomyocytes in [<xref ref-type="bibr" rid="CR28">28</xref>] and CHO cells in [<xref ref-type="bibr" rid="CR8">8</xref>]) or pulse duration (5 ms in our work, 0.2 ms and 1.5 ms in [<xref ref-type="bibr" rid="CR8">8</xref>]). Despite that, our calculated electroporation threshold levels are well above the maximal AP amplitude and elicited a non-transitory response during the few seconds of our experiments duration, which is an indication of electroporation in cells [<xref ref-type="bibr" rid="CR29">29</xref>].</p>
      <p id="Par45">Besides displaying a peak value, we were unable to separate it into a different component, which means that either our method failed to identify it as a different component or the peak value was lost during the experiment due to a limited precision of stimulus and camera synchronization (about 10 ms variation). Based on the simulated imaging data, the second option is more likely because at that estimated SNR (mean of 4.24 dB), METROID succeeded at separating the peak from the step in the artificial video with similar SNR.</p>
      <p id="Par46">METROID excels in situations where signals are expected to occur ubiquitously in a cell, as the case of membrane potentials elicited by external electric fields. In cases where cellular signals to be detected are scattered with different waveforms and onset timings, BSS methods are still able to separate them, as reported with calcium fluorescence images and VSD images from neuron networks [<xref ref-type="bibr" rid="CR23">23</xref>, <xref ref-type="bibr" rid="CR30">30</xref>]. In fact, these works use spatial-ICA (sICA) to separate signals in time and space as a way to identify neurons individually. In principle, METROID could be applied to a sparse events scenario if the number of components is increased, similar to the case of the electroporation signal, notwithstanding it was not designed nor tested for sparse signal detection. For such goals, there are several other works whose designs are more specialized for detecting spikes in calcium [<xref ref-type="bibr" rid="CR23">23</xref>, <xref ref-type="bibr" rid="CR31">31</xref>–<xref ref-type="bibr" rid="CR33">33</xref>] and VSD [<xref ref-type="bibr" rid="CR19">19</xref>, <xref ref-type="bibr" rid="CR30">30</xref>] fluorescence images.</p>
      <p id="Par47">We have found a fairly similar work that used non-negative matrix factorization (another BSS method) to eliminate background noise arising from neuropil using ROIs around cell [<xref ref-type="bibr" rid="CR34">34</xref>]. The authors generated 4 ROIs around a central ROI comprising a somatic cell of interest and were able to eliminate out of focus fluorescence. Although aiming a similar goal, which is noise removal, their method and METROID are not alike. Their criteria for the component selection was the best match with the signal from the central ROI, while METROID has no such reference and its criteria is based solely on either identifying the component with highest power during signal active interval or visual inspection. Other differences involve the number of ROIs, which can be varied here, and the type of image being analyzed. In essence, the methods described here provide new insights on signal and image processing techniques used to face challenges in fluorescence signal extraction.</p>
    </sec>
  </sec>
  <sec id="Sec14">
    <title>Conclusions</title>
    <p id="Par48">This work presents a new method to assess subcellular membrane potential signals by taking advantage of transforming multiple ROIs inside a cell fluorescence image into distinct signal observations and using them as different channels for BSS algorithms. We have shown from our simulated data and experiments with real data that our method outperformed classic filtering at removing noise from multiple ROIs and that it was capable of recovering, in a single trial, subcellular biological signals that would otherwise need repeated experiments. Therefore, METROID introduces a new practical method to segment a cell mask automatically into ROIs as an effective way to extract cell signals from low SNR fluorescence images.</p>
  </sec>
  <sec id="Sec15">
    <title>Methods</title>
    <sec id="Sec16">
      <title>Regions of interest design</title>
      <p id="Par49">We developed a new method to standardize ROIs called MESS. It has a built-in function to automatically generate a cell binary mask based on the fluorescence image sequence, but it also allows mask manual design or editing. From the binary mask, MESS automatically performs segmentation into ROIs that have approximately the same area and that spring at similar locations, regardless of cell shape and orientation. Figure <xref rid="Fig8" ref-type="fig">8</xref> illustrates the method sequence applied to a cardiomyocyte image. First, it aligns the mask to vertical orientation through image rotation. Then, it initially splits the mask into two regions: an outer region (Fig. <xref rid="Fig8" ref-type="fig">8</xref>b, region between black contour and light gray contour) and an inner region (Fig. <xref rid="Fig8" ref-type="fig">8</xref>b, region inside light gray contour). This is done by performing sequential morphological erosions from cell mask until the inner area equals approximately (<italic>n_ROIs_in</italic>) / (<italic>n_ROIs_out + n_ROIs_in</italic>) of the total area. From this point forward, each region undergoes a different segmentation method. For the outer region, three contours are defined: the outer contour (the same as the aligned cell contour, Fig. <xref rid="Fig8" ref-type="fig">8</xref>b black contour), a mid contour generated by performing half the previous erosions (Fig. <xref rid="Fig8" ref-type="fig">8</xref>b gray contour), and an inner contour (the same as inner region contour, Fig. <xref rid="Fig8" ref-type="fig">8</xref>b light gray contour). The mid contour is divided into segments of approximately equal lengths (Fig. <xref rid="Fig8" ref-type="fig">8</xref>b black dots), and a starting point is selected (Fig. <xref rid="Fig8" ref-type="fig">8</xref>b light green dot). This point, regarding the y-axis, is always in the middle of the mask and, regarding the x-axis, is always to the right. From this starting point, coordinates belonging to the outer and inner contours (Fig. <xref rid="Fig8" ref-type="fig">8</xref>b blue crosses) closest to this starting point are selected as the beginning of the first ROI and are connected by a line (Fig. <xref rid="Fig8" ref-type="fig">8</xref>b red dashed line). This procedure is repeated counter-clockwise at the beginning of each subsequent segment in mid contour. Thus, each outer ROI is bounded by straight lines, by the outer contour, and by the inner contour.
<fig id="Fig8"><label>Fig. 8</label><caption><p>ROI standardization sequence. <bold>a</bold> Bright field rat cardiomyocyte image overlaid by contour representing cell mask. <bold>b</bold> Outer region division: aligned cell outer contour (black contour), mid contour (gray contour) and inner contour (light gray contour). Dashed red lines indicate ROI separation, black dots indicate a segment beginning and blue crosses indicate closest outer and inner contour points. Green dot is the first segment position. <bold>c</bold> Inner region division: aligned outer contour (black contour) and inner contour (light gray contour). Dashed red and blue lines indicate ROI separation. <bold>d</bold> Standardized ROIs represented by different numbers and colors with original cell mask represented by yellow contour</p></caption><graphic xlink:href="12859_2020_3661_Fig8_HTML" id="MO8"/></fig></p>
      <p id="Par50">For the inner region, ROI definition goes from top to bottom limited by ROI area, as shown in Fig. <xref rid="Fig8" ref-type="fig">8</xref>c by dashed red lines. The only remark in this division is that, except for the top and bottom ROIs, the central area is halved before ROI definition (dashed blue line). The top and bottom inner ROIs are explicitly defined before the others as a design choice to reserve these edge regions because higher signal amplitudes are expected towards cell poles in electroporation experiments. Outer ROIs numbers are shifted by the necessary amount to always leave the first ROI on top of the aligned image. In the end, all ROIs are rotated back to the original cell mask orientation. In Fig. <xref rid="Fig8" ref-type="fig">8</xref>d, we show in different colors and numbers the final ROIs. Besides isolated cardiomyocytes, we have applied MESS onto an ameboid cell image and a neuron image to test its operation.</p>
    </sec>
    <sec id="Sec17">
      <title>Signal processing simulations</title>
      <p id="Par51">We have performed simulations to test filtering methods performance to extract two types of signals associated to transmembrane potentials from noisy observations. The first signal was generated as the output from an online model of ventricular action potential (AP) [<xref ref-type="bibr" rid="CR35">35</xref>]. The parameters chosen to generate this signal were: “Mahajan et al. (2008) [<xref ref-type="bibr" rid="CR36">36</xref>] rabbit ventricular cell model”, 0.5 Hz pacing frequency, 1 min maximum pacing time and “0μM compound concentration”. The signal was subsampled to match the frame rate of the real data videos and inverted to resemble the kind of fluorescence variation captured. The second signal is a step signal intended to mimic the situation where a cell membrane was electroporated in response to a strong electric stimulus [<xref ref-type="bibr" rid="CR29">29</xref>]. Both signals had a total duration of 5 s and were time-shifted to start at 2.5 s, which means that they had a time interval where they were active (active interval: 2.5 to 2.8 s for AP and 2.5 to 5 s for step) and another where they were silent (silence interval: 0 to 2.5 s and 2.8 to 5 s for AP, and 0 to 2.5 s for step). These intervals were used as reference to calculate signal and noise powers afterwards. In Fig. <xref rid="Fig9" ref-type="fig">9</xref> we show a schematic of the simulation steps.
<fig id="Fig9"><label>Fig. 9</label><caption><p>Signal filtering simulations schematic. Each independent noise (red curves) was added to either a step or an AP-like signal (blue curves) to produce <italic>n</italic> observations, simulating a ROI mean over time. These observations served as inputs to one of the four BSS methods, which decomposed them into <italic>m</italic> components. Signals were filtered by applying the inverse transformation with <italic>m</italic> &lt; <italic>n</italic>. Three performance output variables (inset box) were chosen to evaluate each filtering method success: relative error to maximal amplitude (E<sub>r_Amp</sub>), Pearson correlation coefficient (<italic>r</italic>) and root mean square error (RMSE)</p></caption><graphic xlink:href="12859_2020_3661_Fig9_HTML" id="MO9"/></fig></p>
      <p id="Par52">Each observation was the result of the addition of the original source signal (AP or step, blue curves in Fig. <xref rid="Fig9" ref-type="fig">9</xref>) to a different independent noise (output from a random Poisson distribution, λ = 225, red curves in Fig. <xref rid="Fig9" ref-type="fig">9</xref>) to simulate shot noise. We have subtracted λ from each noise to achieve an approximately zero mean noise. Then, the <italic>n</italic> number of observations served as input to one of the BSS methods which decomposed the observations into <italic>m</italic> components, where <italic>m</italic> ≤ <italic>n</italic>. Whenever <italic>m</italic> is smaller than <italic>n</italic>, this means we are filtering the observations by eliminating some information. Then we have rebuilt the observations with the remaining components by applying the inverse transformation.</p>
      <p id="Par53">We have run three rounds of simulations to analyze the influence of a different parameter in each round. In the first round of simulations, we have varied <italic>m</italic> from 1 to 30 (from 1 to 10 in unity steps and from 10 to 30 in steps of 5) while keeping <italic>n</italic> = 30 and SNR = − 10 dB. In the second round, we have varied <italic>n</italic> from 2 to 60 (from 2 to 10 in steps of 2 and from 10 to 60 in steps of 10) with <italic>m</italic> = 1 and SNR = − 10 dB. In the third round, we have varied SNR from -15 dB to 5 dB in steps of 2.5 dB by varying signal power while keeping noise power constant, <italic>n</italic> = 30 and <italic>m</italic> = 1. In this round of simulations, we have also compared results to a 5th order low-pass Butterworth filter (f<sub>cutoff</sub> = 10 Hz for AP signal and f<sub>cutoff</sub> = 2 Hz for step signal). The classical power definition was used for SNR calculation:
<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ SNR=\frac{\frac{1}{n_{samples}}{\sum}_i^{n_{samples}}{\left|{x}_i\right|}^2}{{\sigma_{noise}}^2} $$\end{document}</tex-math><mml:math id="M2" display="block"><mml:mi mathvariant="italic">SNR</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:msub><mml:mi>n</mml:mi><mml:mtext mathvariant="italic">samples</mml:mtext></mml:msub></mml:mfrac><mml:msubsup><mml:mo>∑</mml:mo><mml:mi>i</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mtext mathvariant="italic">samples</mml:mtext></mml:msub></mml:msubsup><mml:msup><mml:mfenced close="|" open="|"><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:msup><mml:msub><mml:mi>σ</mml:mi><mml:mtext mathvariant="italic">noise</mml:mtext></mml:msub><mml:mn>2</mml:mn></mml:msup></mml:mfrac></mml:math><graphic xlink:href="12859_2020_3661_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par54">where <italic>x</italic><sub><italic>i</italic></sub> is signal value at index <italic>i</italic>, <italic>n</italic><sub><italic>samples</italic></sub> is the total number of samples in signal duration and <italic>σ</italic><sub><italic>noise</italic></sub> is noise standard deviation.</p>
      <p id="Par55">To evaluate each filtering method success, we have used three different performance outputs: relative error E<sub>r_Amp</sub>, used to measure accuracy at recovering signal amplitude; Pearson correlation coefficient <italic>r</italic>, used to measure waveform accuracy (just for AP signal during active interval); and RMSE, used to measure precision at noise removal. We have used the following equation for E<sub>r_Amp</sub>:
<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {E}_{r\_ Amp}=\frac{\left({Amp}_{measured}-{Amp}_{true}\right)}{Amp_{true}} $$\end{document}</tex-math><mml:math id="M4" display="block"><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>_</mml:mo><mml:mi mathvariant="italic">Amp</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi mathvariant="italic">Amp</mml:mi><mml:mtext mathvariant="italic">measured</mml:mtext></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi mathvariant="italic">Amp</mml:mi><mml:mtext mathvariant="italic">true</mml:mtext></mml:msub></mml:mrow></mml:mfenced><mml:msub><mml:mi mathvariant="italic">Amp</mml:mi><mml:mtext mathvariant="italic">true</mml:mtext></mml:msub></mml:mfrac></mml:math><graphic xlink:href="12859_2020_3661_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par56">where <italic>Amp</italic><sub><italic>measured</italic></sub> is signal amplitude measured after filtering and <italic>Amp</italic><sub><italic>true</italic></sub> is the true signal amplitude. This definition is useful because it allows to identify immediately whether signal was overestimated (positive E<sub>r_Amp</sub>) or underestimated (negative E<sub>r_Amp</sub>).</p>
      <p id="Par57">Whenever <italic>m</italic> = 1, component selection was automatically done taking advantage of knowing the event triggering time, which means that all extra components were considered noise and deleted. When using wavelets to filter the selected source, a modified version of fixed hard-threshold <italic>K</italic> [<xref ref-type="bibr" rid="CR13">13</xref>, <xref ref-type="bibr" rid="CR37">37</xref>] was calculated by the following equation:</p>
      <p id="Par58">
        <disp-formula id="Equ3">
          <label>3</label>
          <alternatives>
            <tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ K=\sqrt{2\ln N}\sigma $$\end{document}</tex-math>
            <mml:math id="M6" display="block">
              <mml:mi>K</mml:mi>
              <mml:mo>=</mml:mo>
              <mml:msqrt>
                <mml:mrow>
                  <mml:mn>2</mml:mn>
                  <mml:mo>ln</mml:mo>
                  <mml:mi>N</mml:mi>
                </mml:mrow>
              </mml:msqrt>
              <mml:mi>σ</mml:mi>
            </mml:math>
            <graphic xlink:href="12859_2020_3661_Article_Equ3.gif" position="anchor"/>
          </alternatives>
        </disp-formula>
      </p>
      <p id="Par59">where <italic>N</italic> and <italic>σ</italic> are the number of samples and the median absolute deviation, respectively, in the highest frequency wavelet coefficient. We have used Discrete Meyer (<italic>dmey</italic>) wavelet for AP signal and <italic>Haar</italic> wavelet for step signal because they better correlate to the respective original signals. Each filtered signal had its baseline centered towards zero by subtracting median value obtained from silence intervals.</p>
      <sec id="Sec18">
        <title>Signal processing simulations with photobleaching</title>
        <p id="Par60">We have also evaluated whether previous photobleaching removal could bias the filtering methods. Thus, we have rerun the third round of simulations, but now observations were a bit different. We have added signal (AP or step), noise, and an extra source, which is a standard exponential function:</p>
        <p id="Par61">
          <disp-formula id="Equ4">
            <label>4</label>
            <alternatives>
              <tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ f(t)=A{e}^{- Bt}+C $$\end{document}</tex-math>
              <mml:math id="M8" display="block">
                <mml:mi>f</mml:mi>
                <mml:mfenced close=")" open="(">
                  <mml:mi>t</mml:mi>
                </mml:mfenced>
                <mml:mo>=</mml:mo>
                <mml:mi>A</mml:mi>
                <mml:msup>
                  <mml:mi>e</mml:mi>
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mi mathvariant="italic">Bt</mml:mi>
                  </mml:mrow>
                </mml:msup>
                <mml:mo>+</mml:mo>
                <mml:mi>C</mml:mi>
              </mml:math>
              <graphic xlink:href="12859_2020_3661_Article_Equ4.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p id="Par62">where <italic>t</italic> is time, and <italic>A</italic>, <italic>B</italic> and <italic>C</italic> were randomly generated from a Gaussian distribution for each observation. Then, each noisy observation was first corrected with exponential curve fitting before being introduced to a BSS filtering method.</p>
        <p id="Par63">On AP signals, which are transitory, single exponential curve fitting was applied on noisy data from time periods equivalent to AP silence intervals (see Fig. <xref rid="Fig9" ref-type="fig">9</xref>), which guarantees that the AP signal will not be considered by the exponential fitting routine. We defined this approach DBPC because we are providing curve fitting input from both ends of data. We also explored estimating photobleaching compensation providing data just before signal onset, which we called SBPC. Because step signals are perdurable, we can only apply SBPC on them. However, since we know step onset time, we can include the step into curve fitting as a composite function formed by exponential and step functions and provide the whole data as input. We called this approach FDPC and the fitting equation is shown below:</p>
        <p id="Par64">
          <disp-formula id="Equ5">
            <label>5</label>
            <alternatives>
              <tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ f(t)=A{e}^{- Bt}+C- Eu\left(t-2.5\right) $$\end{document}</tex-math>
              <mml:math id="M10" display="block">
                <mml:mi>f</mml:mi>
                <mml:mfenced close=")" open="(">
                  <mml:mi>t</mml:mi>
                </mml:mfenced>
                <mml:mo>=</mml:mo>
                <mml:mi>A</mml:mi>
                <mml:msup>
                  <mml:mi>e</mml:mi>
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mi mathvariant="italic">Bt</mml:mi>
                  </mml:mrow>
                </mml:msup>
                <mml:mo>+</mml:mo>
                <mml:mi>C</mml:mi>
                <mml:mo>−</mml:mo>
                <mml:mi mathvariant="italic">Eu</mml:mi>
                <mml:mfenced close=")" open="(">
                  <mml:mrow>
                    <mml:mi>t</mml:mi>
                    <mml:mo>−</mml:mo>
                    <mml:mn>2.5</mml:mn>
                  </mml:mrow>
                </mml:mfenced>
              </mml:math>
              <graphic xlink:href="12859_2020_3661_Article_Equ5.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p id="Par65">where <italic>A</italic>, <italic>B</italic>, <italic>C</italic> and <italic>E</italic> are fitting parameters and <italic>u(t-2.5)</italic> is the step function shifted to 2.5 s.</p>
        <p id="Par66">Finally, to compare each photobleaching correction method success, we have calculated exponential parameters (<italic>A</italic>, <italic>B</italic> and <italic>C</italic>) relative errors. Then, to evaluate their impact on the performance of each BSS filtering method, we have calculated E<sub>r_Amp</sub> and RMSE for each combination.</p>
        <p id="Par67">The codes for simulations and real data application were developed in Python 3.6.4, using Numpy 1.14, SciPy 1.0, Matplotlib 2.1.2, scikit-image 0.13.1 and scikit-learn 0.19.1 libraries. Curve fitting was implemented with SciPy ‘curve_fit’ function. PCA and ICA were implemented using scikit-learn ‘PCA’ and ‘fastICA’ functions [<xref ref-type="bibr" rid="CR38">38</xref>]. DWT was implemented with PyWavelets 0.5.2 [<xref ref-type="bibr" rid="CR39">39</xref>].</p>
      </sec>
    </sec>
    <sec id="Sec19">
      <title>Simulated imaging data</title>
      <p id="Par68">We have generated simulated imaging data based on experimental VSD imaging data and on electroporation theory to validate our method and to compare it to other established techniques.</p>
      <sec id="Sec20">
        <title>Artificial video generation</title>
        <p id="Par69">The artificial video (<italic>F</italic>) was composed of the sum of a basal fluorescence image (<italic>BF</italic>), a signal (optical AP or electroporation), photobleaching and shot noise, as illustrated in the equation below:</p>
        <p id="Par70">
          <disp-formula id="Equ6">
            <label>6</label>
            <alternatives>
              <tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ F\left(x,y,t\right)= BF\left(x,y\right)+ Signal\left(x,y, BF,g,t\right)+ Photobleaching\left( BF,t\right)+ Noise\left(x,y,t\right) $$\end{document}</tex-math>
              <mml:math id="M12" display="block">
                <mml:mi>F</mml:mi>
                <mml:mfenced close=")" open="(" separators=",,">
                  <mml:mi>x</mml:mi>
                  <mml:mi>y</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:mfenced>
                <mml:mo>=</mml:mo>
                <mml:mi mathvariant="italic">BF</mml:mi>
                <mml:mfenced close=")" open="(" separators=",">
                  <mml:mi>x</mml:mi>
                  <mml:mi>y</mml:mi>
                </mml:mfenced>
                <mml:mo>+</mml:mo>
                <mml:mtext mathvariant="italic">Signal</mml:mtext>
                <mml:mfenced close=")" open="(" separators=",,,,">
                  <mml:mi>x</mml:mi>
                  <mml:mi>y</mml:mi>
                  <mml:mi mathvariant="italic">BF</mml:mi>
                  <mml:mi>g</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:mfenced>
                <mml:mo>+</mml:mo>
                <mml:mtext mathvariant="italic">Photobleaching</mml:mtext>
                <mml:mfenced close=")" open="(" separators=",">
                  <mml:mi mathvariant="italic">BF</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:mfenced>
                <mml:mo>+</mml:mo>
                <mml:mtext mathvariant="italic">Noise</mml:mtext>
                <mml:mfenced close=")" open="(" separators=",,">
                  <mml:mi>x</mml:mi>
                  <mml:mi>y</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:mfenced>
              </mml:math>
              <graphic xlink:href="12859_2020_3661_Article_Equ6.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p id="Par71">where <italic>x</italic> and <italic>y</italic> are pixel coordinates, and <italic>g</italic> is a gain applied to the signal to reach a desired ROI SNR. Basal fluorescence image was generated by estimating non-homogeneous illumination from experimental video by means of applying a Gaussian filter with a large kernel size (equal to the smallest spatial experimental video dimension) onto the first frame of the experimental video. Then this illumination image was normalized and multiplied by the video fluorescence grand mean.</p>
        <p id="Par72">The pure AP signal was the same as the one in the signal processing simulations. It should be modulated by <italic>BF</italic>, thus, it was normalized and then multiplied by <italic>BF</italic> in order to achieve a pure AP signal video. To build the pure electroporation signal, we collected some parameters from the experiments like cell major and minor axis radii, and intensity of the applied electric field. In addition, the same shape of cell contour in Fig. <xref rid="Fig8" ref-type="fig">8</xref> was used. These parameters were used to calculate membrane potential variation after electrical field pulse application following Klee and Plonsey (1976) equations for a prolate spheroid [<xref ref-type="bibr" rid="CR8">8</xref>, <xref ref-type="bibr" rid="CR40">40</xref>]. This resulted in a matrix (peak matrix) containing the expected membrane potential variation before electroporation occurred whose amplitude varied spatially depending on the angle relative to cell center and to the distance from this center. We then calculated membrane potential decay towards zero by an exponential function whose time constant was consistent with reports from the literature for similar experiments (transmembrane potential should fall to 0 mV within the first 50 ms following the shock [<xref ref-type="bibr" rid="CR29">29</xref>]). We applied this exponential after the peak matrix and extended the number of frames to achieve a 5 s video duration consistent with experimental frame rate. Then, video was shifted by 2.5 s, added by a constant value (V<sub>rest</sub> = − 80 mV) in frames before 2.5 s, normalized and multiplied by <italic>BF</italic>. This resulted in a pure electroporation video modulated by <italic>BF</italic>.</p>
        <p id="Par73">Photobleaching signal was also estimated from experimental data lacking stimuli. We tested curve fitting with several decaying functions: linear function, single exponential, a combination of an exponential and a linear function and double exponential. This last one had its initial values carefully chosen to avoid lack of convergence from the fitting algorithm. The lowest residues were obtained by the double exponential fit, consistent with the literature [<xref ref-type="bibr" rid="CR41">41</xref>], followed closely by the combination of exponential and line. We used the double exponential function to simulate photobleaching in the artificial video.</p>
        <p id="Par74">Shot noise was based on each pixel variance through time from experimental data lacking stimuli. This variance was used as the λ value in a Poisson distribution with its mean subtracted for a final zero mean pure noise video. Each pixel had its noise generated independently.</p>
        <p id="Par75">Finally, to achieve a desired ROI SNR, pure noise video and pure signal video were segmented by MESS and each ROI signal and noise power was calculated. Based on that, a gain matrix was calculated and applied to each pure signal image pixel to modulate its amplitude towards the desired ROI SNR.</p>
        <p id="Par76">We generated 8 artificial videos this way varying the combination of following parameters: type of the signal (AP or electroporation), SNR level (either same as corresponding experimental data or -10 dB) and photobleaching presence.</p>
      </sec>
      <sec id="Sec21">
        <title>Artificial video analysis</title>
        <p id="Par77">Artificial videos were analayzed by several fluorescence imaging established techniques and by METROID. BkS was performed by generating an extra video without signal, but containing a small amount of photobleaching drift (0.3% increase in global mean, same mean variation from experimental data). Both video with signal and video without signal were normalized by their first frames. Then, we subtracted video without signal from video with signal and reversed normalization. BkSD was performed by applying BkS followed by a standard detrending routine.</p>
        <p id="Par78">To simulate the situation of averaging videos, we generated 10 and 400 extra videos with the same signal and with the slow photobleaching drift between each of them. Then, we have averaged them and compensated photobleaching by curve fitting based on the following equations:</p>
        <p id="Par79"><disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ f(t)=A{e}^{- Bt}+C- Dt $$\end{document}</tex-math><mml:math id="M14" display="block"><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mi>t</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:mi>A</mml:mi><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi mathvariant="italic">Bt</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>C</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="italic">Dt</mml:mi></mml:math><graphic xlink:href="12859_2020_3661_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ f(t)=A{e}^{- Bt}+C- Dt- Eu\left(t-2.5\right) $$\end{document}</tex-math><mml:math id="M16" display="block"><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mi>t</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:mi>A</mml:mi><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi mathvariant="italic">Bt</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>C</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="italic">Dt</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="italic">Eu</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>2.5</mml:mn></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="12859_2020_3661_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula>where <italic>A</italic>, <italic>B</italic>, <italic>C</italic>, <italic>D</italic> and <italic>E</italic> are parameters to be estimated by non-linear curve fit.</p>
        <p id="Par80">AP video photobleaching was compensated with DBPC following (7) and electroporation photobleaching was compensated with FDPC following (8). These equations have an extra linear component if compared to those from signal processing simulations. That is to account for the fact that here photobleaching was modeled with double exponentials while there a single exponential was used. We did not use double exponentials to fix photobleaching due to frequent lack of convergence from curve fitting algorithm.</p>
        <p id="Par81">METROID uses these same equations to fix photobleaching. We applied METROID on artificial videos with three parameter configurations: default parameters (no information supplied), optimized with one selected BSS method (ICA for AP videos and PCA for electroporation videos; onset and end times supplied; manual component selection with <italic>m</italic> = 2 for AP videos and <italic>m</italic> = 3 for electroporation videos), and this same last configuration, but with the corresponding wavelet method (wICA for AP videos and wPCA for electroporation videos).</p>
        <p id="Par82">We measured E<sub>r_Amp</sub>, <italic>r</italic> and RMSE for every ROI in each artificial AP video. In artificial electroporation videos, we measured peak E<sub>r_Amp</sub> (relative amplitude error at peak instant), stationary E<sub>r_Amp</sub> (relative amplitude error of stationary level) and RMSE. One-way analysis of variance test with Tukey’s post-test was used when groups distribution was approximately normal, otherwise non-parametric Kruskal-Walis test with Dunn’s post-test was used. Statistical analysis was performed with GraphPad Prism 6.</p>
      </sec>
    </sec>
    <sec id="Sec22">
      <title>Experimental VSD imaging real data</title>
      <sec id="Sec23">
        <title>Experimental protocol</title>
        <p id="Par83">Isolated adult rat cardiomyocytes were obtained by ventricles enzymatic digestion as previously described [<xref ref-type="bibr" rid="CR42">42</xref>]. Cells were plated into a perfusion chamber with platinum electrodes in each side for cell stimulation. An epifluorescence microscope developed in our lab [<xref ref-type="bibr" rid="CR43">43</xref>] was used to generate cell fluorescence images. An automated optical shutter was added to the microscope optical train after the light source. It was synchronized with the camera and with an electric stimulator (biphasic pulses; 0-15 V; 0.1-10 Hz; 0.1-10 ms each phase; developed at CEB/UNICAMP) in order to allow determination of electric stimulation event in the fluorescence video. Myocytes were perfused for approximately 20 min with Tyrode solution and they were paced with square bipolar electric pulses at 0.5 Hz and 5 ms each phase. A cell was chosen based on the following criteria: presence of clear striations, responding to electric stimulation by performing contractions, closely aligned with electric field and without neighboring cells or dead cell residues. A bright-field image was taken to record this situation. Perfusion was stopped and electric field threshold (E<sub>T</sub>) was determined by decreasing stimulus amplitude until cell stopped performing contractions. Then, VSD RH-237 (Molecular Probes, ThermoFisher Scientific, Waltham, MA) was added to extracellular solution for a final concentration of 3 μM. After that, in order to avoid motion artifacts, a contraction blocker drug, blebbistatin (Cayman Chemical, Ann Arbor, MI), was added for a final concentration of 10 μM and 20 min were waited for the drug to take effect. After that, electric stimulation was resumed to visually verify that contractions were blocked.</p>
        <p id="Par84">A few videos (2 or 3) of approximately 2.5 s (except for the last one, which lasted around 4.5 s) were recorded with a 3 min interval between each of them for each cell. The first video was recorded in absence of electric stimulation as a reference lacking cellular signal. Then, one or two subsequent videos (AP videos) were recorded with a supra-threshold bipolar electric pulse (~ 1.2xE<sub>T</sub>) applied 0.5 s after video beginning. In the last video (electroporation video), a stronger square monopolar electric pulse (~15xE<sub>T</sub>; 5 ms) from another electric stimulator (monophasic pulses; 0-150 V; 0.1-10 Hz; 0.1-10 ms; developed at CEB/UNICAMP) was applied 2.5 s after video beginning. This amplitude has been shown to be capable of eliciting [Ca<sup>2+</sup>] increase and oscillations consistent with increased membrane permeability caused by pore formation [<xref ref-type="bibr" rid="CR29">29</xref>, <xref ref-type="bibr" rid="CR43">43</xref>] with low probability of lethality [<xref ref-type="bibr" rid="CR44">44</xref>]. Camera was configured for video acquisition with 2 × 2 binning, 1.4 ms exposure time, 300x EM gain and windowed cell image. This configuration yielded a frame rate of 50–100 frames per second (fps) depending on window size.</p>
      </sec>
      <sec id="Sec24">
        <title>Experimental data analysis</title>
        <p id="Par85">Cell mask was automatically generated by MESS, but sometimes manual refining was necessary to better match the bright-field image. Then, MESS divided the mask into 32 ROIs. Then METROID fixed photobleaching by either DBPC with (7) or FDPC with (8), depending on the ‘transitory’ variable.</p>
        <p id="Par86">For AP videos, METROID parameters were set as: ‘transitory’ = <italic>True</italic>, time of signal onset = 0.5 s, time of signal ending = 1 s, <italic>m</italic> = 1, <italic>n</italic> = 32 (as a result of configuring 32 ROIs), BSS method = ICA (later wICA with <italic>dmey</italic> wavelet was also tested) and automatic source selection, which makes METROID choose the component with the highest energy inside signal active interval. For electroporation videos, parameters were: ‘transitory’ = <italic>False</italic>, time of signal onset = 2.5 s, time of signal ending = <italic>None</italic>, <italic>m</italic> = 3, <italic>n</italic> = 32, BSS method = PCA (later wPCA with <italic>Haar</italic> wavelet was also tested) and manual source selection. SNR was estimated by computing each ROI filtered signal power divided by noise power acquired from silence intervals after photobleaching correction, but before filtering.</p>
        <p id="Par87">Filtered ROI signals are fluorescence averages in arbitrary units representing a proportion of photon counting. We have used AP amplitude as a reference to calibrate fluorescence signals to membrane potential. AP amplitude (<italic>AP</italic><sub><italic>amp</italic></sub>) and V<sub>rest</sub> values were set as 120 mV and -80 mV, respectively, taken as rounded values from the literature of patch-clamp experiments on adult isolated rat ventricular myocytes [<xref ref-type="bibr" rid="CR45">45</xref>]. Thus membrane potential (<italic>V(j,t)</italic>) in each ROI <italic>j</italic> in electroporation experiments was then calibrated according to the following equation:
<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \mathrm{V}\left(j,t\right)=\left(-\left( EP\left(j,t\right)/{AP}_{peak}(j)\right)\ast {AP}_{amp}\right)+{V}_{rest} $$\end{document}</tex-math><mml:math id="M18" display="block"><mml:mi mathvariant="normal">V</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mo>−</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="italic">EP</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:mfenced><mml:mo>/</mml:mo><mml:msub><mml:mi mathvariant="italic">AP</mml:mi><mml:mtext mathvariant="italic">peak</mml:mtext></mml:msub><mml:mfenced close=")" open="("><mml:mi>j</mml:mi></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>∗</mml:mo><mml:msub><mml:mi mathvariant="italic">AP</mml:mi><mml:mi mathvariant="italic">amp</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mtext mathvariant="italic">rest</mml:mtext></mml:msub></mml:math><graphic xlink:href="12859_2020_3661_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>where <italic>t</italic> is time, <italic>EP(j,t)</italic> is electroporation signal in A.U. and <italic>AP</italic><sub><italic>peak</italic></sub><italic>(j)</italic> is the modulus of maximal amplitude of AP signal in A.U. in each ROI <italic>j</italic>. This led to a calibrated membrane potential signal in each ROI, defined by electroporation signal variation normalized by AP signal variation.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec25">
      <supplementary-material content-type="local-data" id="MOESM1">
        <media xlink:href="12859_2020_3661_MOESM1_ESM.tif">
          <caption>
            <p><bold>Additional file 1. </bold>Additional figure showing root mean square error (RMSE) results for varying SNR (from -15 dB to 5 dB in steps of 2.5 dB). (a) RMSE means as function of SNR for AP signal. Gray stars represent RMSE means calculated directly from noisy data (<italic>N</italic> = 120 samples for each mean), blue circles represent ICA means, red squares represent PCA means, green inverted triangles represent wICA means and orange triangles represent wPCA means. (b) RMSE means as function of SNR for step function, same color scheme as in (a). Shaded regions correspond to standard errors of the mean.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM2">
        <media xlink:href="12859_2020_3661_MOESM2_ESM.tif">
          <caption>
            <p><bold>Additional file 2.</bold> Additional figure showing performance results for varying number of components (from 1 to 10 in unitary steps and from 10 to 30 in steps of 5). (a) Relative error for maximal AP amplitude (E<sub>r_Amp</sub>) means as function of number of components for AP signal. Gray stars represent E<sub>r_Amp</sub> means calculated directly from noisy data (N = 120 samples for each mean), blue circles represent ICA means, red squares represent PCA means, green inverted triangles represent wICA means and orange triangles represent wPCA means. (b) Root mean square error (RMSE). (c) Pearson correlation coefficient (r) means for AP signal calculated in AP active interval. (d) E<sub>r_Amp</sub> for step signal. (e) RMSE for step function. Shaded regions correspond to standard errors of the mean.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM3">
        <media xlink:href="12859_2020_3661_MOESM3_ESM.tif">
          <caption>
            <p><bold>Additional file 3.</bold> Additional figure showing performance results for varying number of observations (from 2 to 10 in steps of 2 and from 10 to 60 in steps of 10). All graphics follow the same scheme as in Additional file <xref rid="MOESM2" ref-type="media">2</xref>.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM4">
        <media xlink:href="12859_2020_3661_MOESM4_ESM.tif">
          <caption>
            <p><bold>Additional file 4.</bold> Additional figure showing photobleaching correction by different methods. (a) Gray continuous line is a noisy AP observation contaminated by noise and an exponential function representing photobleaching. Black continuous line is the exponential function, red dots are data input provided for Single Bind Photobleaching Correction (SBPC), red dot-dashed line is SBPC output, red plus blue dots are data input provided for Double Bind Photobleaching Correction (DBPC) and light blue dashed line is DBPC output. (b) Gray continuous line is a noisy step observation, black continuous line is exponential function, dark red dots are SBPC input, red dot-dashed line is SBPC output, and green dashed line is Full Data Photobleaching Correction (FDPC) output minus the step.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM5">
        <media xlink:href="12859_2020_3661_MOESM5_ESM.tif">
          <caption>
            <p><bold>Additional file 5.</bold> Figure showing relative errors of exponential function (A*exp.(−B*t) + C) parameters for each photobleaching correction method (A as white bars, B as gray bars, and C as black bars). Lines above or below bars are standard errors of the mean. # indicates one-sample t-test statistical difference from hypothetical value zero.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM6">
        <media xlink:href="12859_2020_3661_MOESM6_ESM.tif">
          <caption>
            <p><bold>Additional file 6.</bold> Figure showing photobleaching correction by different methods and their impacts on subsequent BSS methods performance. (a) Relative error for maximal AP amplitude (E<sub>r_Amp</sub>) for each BSS method after each photobleaching correction (SNR = − 10 dB). Black bars are means without exponential, grid red bars are means with exponential corrected by SBPC, and light blue vertically striped bars are means with exponential corrected by DBPC. (b) Root mean square error (RMSE) for AP after each photobleaching correction. (c) E<sub>r_Amp</sub> for step for each BSS method after each photobleaching correction. Black bars and red grid bars are the same as in (a), and green horizontally striped bars are outputs from Full Data Photobleaching Correction (FDPC). FDPC Output bar is the mean relative error obtained directly from curve fit. (d) RMSE for step for each BSS method after each photobleaching compensation method. * indicates Tukey’s post-test statistical difference from that photobleaching method to all others within the same BSS method, after two-way analysis of variance statistical difference.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM7">
        <media xlink:href="12859_2020_3661_MOESM7_ESM.tif">
          <caption>
            <p><bold>Additional file 7.</bold> Additional figure showing METROID comparison to other methods on simulated imaging data (SNR similar to corresponding experimental data, with photobleaching). (a) RMSE means for AP video (<italic>N</italic> = 32). (b) RMSE means for electroporation video. Bar represent means and vertical lines represent standard error of the means.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM8">
        <media xlink:href="12859_2020_3661_MOESM8_ESM.tif">
          <caption>
            <p><bold>Additional file 8.</bold> Figure showing METROID comparison to other methods on simulated imaging data (SNR similar to corresponding experimental data, without photobleaching). (a) Representative traces in a ROI of AP filtered signal by different methods. Black circles represent true AP signal, dark gray dotted lines are ROI mean over time, gray continuous lines are BkS, light gray dashed lines are BkSD, pink dot-dashed lines are the average of 10 videos (avg10), purple dot-dashed lines are the average of 400 videos (avg400), olive green thick dashed lines are METROID output with default parameters, blue continuous lines are METROID optimized with ICA (onset and end times supplied), and green continuous lines are METROID with wICA (onset and end times supplied). (b) E<sub>r_Amp</sub> means of each method (N = 32). Vertical lines represent standard error of the means. (c) <italic>r</italic> means. (d) RMSE means for AP video. (e) Representative traces in a ROI closer to the cathode side of electroporation filtered signal by different methods. Same color scheme as in (a), except that red continuous lines are METROID optimized with PCA (onset and end times supplied, <italic>m</italic> = 3), and orange continuous lines are METROID optimized with wPCA (onset and end times supplied, <italic>m</italic> = 3). (f) Peak E<sub>r_Amp</sub> means. (g) Stationary E<sub>r_Amp</sub> means. (h) RMSE means for electroporation video.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM9">
        <media xlink:href="12859_2020_3661_MOESM9_ESM.tif">
          <caption>
            <p><bold>Additional file 9.</bold> Figure showing METROID comparison to other methods on simulated imaging data (SNR = − 10 dB in all ROIs, with photobleaching). All graphics follow the same scheme as in Additional file <xref rid="MOESM8" ref-type="media">8</xref>.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM10">
        <media xlink:href="12859_2020_3661_MOESM10_ESM.tif">
          <caption>
            <p><bold>Additional file 10.</bold> Figure showing METROID comparison to other methods on simulated imaging data (SNR = − 10 dB in all ROIs, without photobleaching). All graphics follow the same scheme as in Additional file <xref rid="MOESM8" ref-type="media">8</xref>.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM11">
        <media xlink:href="12859_2020_3661_MOESM11_ESM.avi">
          <caption>
            <p><bold>Additional file 11.</bold> Movie showing each ROI signal extraction in sequence, similar to Fig. <xref rid="Fig6" ref-type="fig">6</xref>.</p>
          </caption>
        </media>
      </supplementary-material>
    </sec>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>MESS</term>
        <def>
          <p id="Par4">Morphological Equal-area Standardized Segmentation</p>
        </def>
      </def-item>
      <def-item>
        <term>DBPC</term>
        <def>
          <p id="Par5">Double Bind Photobleaching Correction</p>
        </def>
      </def-item>
      <def-item>
        <term>SBPC</term>
        <def>
          <p id="Par6">Single Bind Photobleaching Correction</p>
        </def>
      </def-item>
      <def-item>
        <term>FDPC</term>
        <def>
          <p id="Par7">Full Data Photobleaching Correction</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p><bold>Supplementary information</bold> accompanies this paper at 10.1186/s12859-020-03661-9.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>The authors would like to acknowledge the team of the R&amp;D staff at CEB/UNICAMP for the technical support.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>MZ conceptualized the algorithm, designed the method, wrote the software, drafted the manuscript, analyzed the data and carried out the experiments. PO coordinated the research, participated in the design of the method, contributed to the discussion and revised the manuscript. The author(s) read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>This work was supported by FAPESP (Foundation for Research of the State of São Paulo, Proc. N 2011/51199–6) and CAPES (Coordination of Improvement of Higher Education Personnel, PhD scholarship to M. Zoccoler). The funding bodies played no role in the design of the study or collection, analysis, or interpretation of data and in writing the manuscript.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>METROID is freely available at <ext-link ext-link-type="uri" xlink:href="https://github.com/zoccoler/metroid">https://github.com/zoccoler/metroid</ext-link> as jupyter notebooks and a graphical interface Windows version can be downloaded at 10.6084/m9.figshare.11344046.v1.</p>
  </notes>
  <notes id="FPar1">
    <title>Ethics approval and consent to participate</title>
    <p id="Par88">All procedures performed involving animals were in accordance with ethical standards and they were approved by the institutional Committee of Ethics in Animal Use (CEUA/IB/UNICAMP, protocol number 4429–1).</p>
  </notes>
  <notes id="FPar2">
    <title>Consent for publication</title>
    <p id="Par89">Not applicable.</p>
  </notes>
  <notes id="FPar3" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par90">The authors declare that they have no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Loew</surname>
            <given-names>LM</given-names>
          </name>
        </person-group>
        <source>Design and Use of Organic Voltage Sensitive Dyes. Vol. 859, Advances in experimental medicine and biology</source>
        <year>2015</year>
        <fpage>27</fpage>
        <lpage>53</lpage>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Popovic</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Vogt</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Holthoff</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Konnerth</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>BM</given-names>
          </name>
          <name>
            <surname>Grinvald</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Imaging Submillisecond Membrane Potential Changes from Individual Regions of Single Axons, Dendrites and Spines. Vol. 859, Advances in experimental medicine and biology</source>
        <year>2015</year>
        <fpage>57</fpage>
        <lpage>101</lpage>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schaffer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Ahammer</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Müller</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Koidl</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Windisch</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Di-4-ANEPPS causes photodynamic damage to isolated cardiomyocytes</article-title>
        <source>Pflügers Arch Eur J Physiol</source>
        <year>1994</year>
        <volume>426</volume>
        <issue>6</issue>
        <fpage>548</fpage>
        <lpage>551</lpage>
        <pub-id pub-id-type="pmid">8052525</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>St-Pierre</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Marshall</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Gong</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Schnitzer</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>MZ</given-names>
          </name>
        </person-group>
        <article-title>High-fidelity optical reporting of neuronal electrical activity with an ultrafast fluorescent voltage sensor</article-title>
        <source>Nat Neurosci</source>
        <year>2014</year>
        <volume>17</volume>
        <issue>6</issue>
        <fpage>884</fpage>
        <lpage>889</lpage>
        <?supplied-pmid 24755780?>
        <pub-id pub-id-type="pmid">24755780</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Frey</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>White</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Price</surname>
            <given-names>RO</given-names>
          </name>
          <name>
            <surname>Blackmore</surname>
            <given-names>PF</given-names>
          </name>
          <name>
            <surname>Joshi</surname>
            <given-names>RP</given-names>
          </name>
          <name>
            <surname>Nuccitelli</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Plasma membrane voltage changes during nanosecond pulsed electric field exposure</article-title>
        <source>Biophys J</source>
        <year>2006</year>
        <volume>90</volume>
        <issue>10</issue>
        <fpage>3608</fpage>
        <lpage>3615</lpage>
        <?supplied-pmid 16513782?>
        <pub-id pub-id-type="pmid">16513782</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hoppa</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Gouzer</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Armbruster</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Ryan</surname>
            <given-names>TA</given-names>
          </name>
        </person-group>
        <article-title>Control and plasticity of the presynaptic action potential waveform at small CNS nerve terminals</article-title>
        <source>Neuron.</source>
        <year>2014</year>
        <volume>84</volume>
        <issue>4</issue>
        <fpage>778</fpage>
        <lpage>789</lpage>
        <?supplied-pmid 25447742?>
        <pub-id pub-id-type="pmid">25447742</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kinosita</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Ashikawa</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Saita</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Yoshimura</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Itoh</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Nagayama</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Electroporation of cell membrane visualized under a pulsed-laser fluorescence microscope</article-title>
        <source>Biophys J</source>
        <year>1988</year>
        <volume>53</volume>
        <issue>6</issue>
        <fpage>1015</fpage>
        <lpage>1019</lpage>
        <?supplied-pmid 3395657?>
        <pub-id pub-id-type="pmid">3395657</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kotnik</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Pucihar</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Miklavčič</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Induced transmembrane voltage and its correlation with electroporation- mediated molecular transport</article-title>
        <source>J Membr Biol</source>
        <year>2010</year>
        <volume>236</volume>
        <issue>1</issue>
        <fpage>3</fpage>
        <lpage>13</lpage>
        <?supplied-pmid 20617432?>
        <pub-id pub-id-type="pmid">20617432</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <mixed-citation publication-type="other">Chen C, Smye SW, Robinson MP, Evans JA. Membrane electroporation theories: A review. Vol. 44, Medical and Biological Engineering and Computing: Springer; 2006. p. 5–14. <ext-link ext-link-type="uri" xlink:href="https://www.springer.com/journal/11517">https://www.springer.com/journal/11517</ext-link>.</mixed-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <mixed-citation publication-type="other">Togo T, Alderton JM, Bi GQ, Steinhardt RA. The mechanism of facilitated cell membrane resealing. 1999;112(Pt 5):719–J Cell Sci, 731.</mixed-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Quian Quiroga</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Sakowitz</surname>
            <given-names>OW</given-names>
          </name>
          <name>
            <surname>Basar</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Schürmann</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Wavelet transform in the analysis of the frequency composition of evoked potentials</article-title>
        <source>Brain Res Protocol</source>
        <year>2001</year>
        <volume>8</volume>
        <issue>1</issue>
        <fpage>16</fpage>
        <lpage>24</lpage>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kim</surname>
            <given-names>KH</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>SJ</given-names>
          </name>
        </person-group>
        <article-title>A wavelet-based method for action potential detection from extracellular neural signal recording with low signal-to-noise ratio</article-title>
        <source>IEEE Trans Biomed Eng</source>
        <year>2003</year>
        <volume>50</volume>
        <issue>8</issue>
        <fpage>999</fpage>
        <lpage>1011</lpage>
        <?supplied-pmid 12892327?>
        <pub-id pub-id-type="pmid">12892327</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Donoho</surname>
            <given-names>DL</given-names>
          </name>
          <name>
            <surname>Johnstone</surname>
            <given-names>IM</given-names>
          </name>
        </person-group>
        <article-title>Ideal spatial adaptation by wavelet shrinkage</article-title>
        <source>Biometrika.</source>
        <year>1994</year>
        <volume>81</volume>
        <issue>3</issue>
        <fpage>425</fpage>
        <lpage>455</lpage>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Brown</surname>
            <given-names>GD</given-names>
          </name>
          <name>
            <surname>Yamada</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Sejnowski</surname>
            <given-names>TJ</given-names>
          </name>
        </person-group>
        <article-title>Independent component analysis at the neural cocktail party</article-title>
        <source>Trends Neurosci</source>
        <year>2001</year>
        <volume>24</volume>
        <issue>1</issue>
        <fpage>54</fpage>
        <lpage>63</lpage>
        <?supplied-pmid 11163888?>
        <pub-id pub-id-type="pmid">11163888</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Soille</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Erosion and Dilation</article-title>
        <source>Morphological Image Analysis</source>
        <year>2004</year>
        <publisher-loc>Berlin</publisher-loc>
        <publisher-name>Springer Berlin Heidelberg</publisher-name>
        <fpage>63</fpage>
        <lpage>103</lpage>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Jackson</surname>
            <given-names>JE</given-names>
          </name>
        </person-group>
        <source>A user’s guide to principal components</source>
        <year>1991</year>
        <publisher-loc>Hoboken</publisher-loc>
        <publisher-name>John Wiley &amp; Sons, Inc.</publisher-name>
        <fpage>569</fpage>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Comon</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Independent component analysis, a new concept?</article-title>
        <source>Signal Process</source>
        <year>1994</year>
        <volume>36</volume>
        <issue>3</issue>
        <fpage>287</fpage>
        <lpage>314</lpage>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Merry</surname>
            <given-names>RJE</given-names>
          </name>
        </person-group>
        <source>Wavelet theory and applications: a literature study</source>
        <year>2005</year>
        <publisher-loc>Eindhoven</publisher-loc>
        <publisher-name>Technische Universiteit Eindhoven</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Reynaud</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Takerkart</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Masson</surname>
            <given-names>GS</given-names>
          </name>
          <name>
            <surname>Chavane</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Linear model decomposition for voltage-sensitive dye imaging signals: application in awake behaving monkey</article-title>
        <source>Neuroimage.</source>
        <year>2011</year>
        <volume>54</volume>
        <issue>2</issue>
        <fpage>1196</fpage>
        <lpage>1210</lpage>
        <?supplied-pmid 20800686?>
        <pub-id pub-id-type="pmid">20800686</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hibino</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Shigemori</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Itoh</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Nagayama</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Kinosita</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Membrane conductance of an electroporated cell analyzed by submicrosecond imaging of transmembrane potential</article-title>
        <source>Biophys J</source>
        <year>1991</year>
        <volume>59</volume>
        <issue>1</issue>
        <fpage>209</fpage>
        <lpage>220</lpage>
        <?supplied-pmid 2015385?>
        <pub-id pub-id-type="pmid">2015385</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Silve</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Rocke</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Frey</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Image processing for non-ratiometric measurement of membrane voltage using fluorescent reporters and pulsed laser illumination</article-title>
        <source>Bioelectrochemistry.</source>
        <year>2015</year>
        <volume>103</volume>
        <fpage>39</fpage>
        <lpage>43</lpage>
        <?supplied-pmid 25091458?>
        <pub-id pub-id-type="pmid">25091458</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kaifosh</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Zaremba</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Danielson</surname>
            <given-names>NB</given-names>
          </name>
          <name>
            <surname>Losonczy</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>SIMA: Python software for analysis of dynamic fluorescence imaging data</article-title>
        <source>Front Neuroinform</source>
        <year>2014</year>
        <volume>8</volume>
        <fpage>80</fpage>
        <?supplied-pmid 25295002?>
        <pub-id pub-id-type="pmid">25295002</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mukamel</surname>
            <given-names>EA</given-names>
          </name>
          <name>
            <surname>Nimmerjahn</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Schnitzer</surname>
            <given-names>MJ</given-names>
          </name>
        </person-group>
        <article-title>Automated analysis of cellular signals from large-scale calcium imaging data</article-title>
        <source>Neuron.</source>
        <year>2009</year>
        <volume>63</volume>
        <issue>6</issue>
        <fpage>747</fpage>
        <lpage>760</lpage>
        <?supplied-pmid 19778505?>
        <pub-id pub-id-type="pmid">19778505</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">Azzerboni B, Morabito FC, La Foresta F, Mammone N. A new approach based on Wavelet-ICA algorithms for fetal electrocardiogram extraction. In: ESANN’2005 proceedings - European Symposium on Artificial Neural Networks. Bruges: dblp Computer Science Bibliography; 2005. p. 193–8. <ext-link ext-link-type="uri" xlink:href="https://dblp.org/db/conf/esann/esann2005">https://dblp.org/db/conf/esann/esann2005</ext-link>.</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Watanabe</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Delbridge</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Bustamante</surname>
            <given-names>JO</given-names>
          </name>
          <name>
            <surname>McDonald</surname>
            <given-names>TF</given-names>
          </name>
        </person-group>
        <article-title>Heterogeneity of the action potential in isolated rat ventricular myocytes and tissue</article-title>
        <source>Circ Res</source>
        <year>1983</year>
        <volume>52</volume>
        <issue>3</issue>
        <fpage>280</fpage>
        <lpage>290</lpage>
        <?supplied-pmid 6825220?>
        <pub-id pub-id-type="pmid">6825220</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gogan</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Schmiedel-Jakob</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Chitti</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Tyc-Dumont</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Fluorescence imaging of local membrane electric fields during the excitation of single neurons in culture</article-title>
        <source>Biophys J</source>
        <year>1995</year>
        <volume>69</volume>
        <issue>2</issue>
        <fpage>299</fpage>
        <lpage>310</lpage>
        <?supplied-pmid 8527643?>
        <pub-id pub-id-type="pmid">8527643</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Warren</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Spitzer</surname>
            <given-names>KW</given-names>
          </name>
          <name>
            <surname>Steadman</surname>
            <given-names>BW</given-names>
          </name>
          <name>
            <surname>Rees</surname>
            <given-names>TD</given-names>
          </name>
          <name>
            <surname>Venable</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Taylor</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High-precision recording of the action potential in isolated cardiomyocytes using the near-infrared fluorescent dye di-4-ANBDQBS</article-title>
        <source>Am J Physiol Circ Physiol</source>
        <year>2010</year>
        <volume>299</volume>
        <issue>4</issue>
        <fpage>H1271</fpage>
        <lpage>H1281</lpage>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tovar</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Tung</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Electroporation and recovery of cardiac cell membrane with rectangular voltage pulses</article-title>
        <source>Am J Phys</source>
        <year>1992</year>
        <volume>263</volume>
        <issue>4 Pt 2</issue>
        <fpage>H1128</fpage>
        <lpage>H1136</lpage>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Krauthamer</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Jones</surname>
            <given-names>JL</given-names>
          </name>
        </person-group>
        <article-title>Calcium dynamics in cultured heart cells exposed to defibrillator-type electric shocks</article-title>
        <source>Life Sci</source>
        <year>1997</year>
        <volume>60</volume>
        <issue>22</issue>
        <fpage>1977</fpage>
        <lpage>1985</lpage>
        <?supplied-pmid 9180351?>
        <pub-id pub-id-type="pmid">9180351</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Reidl</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Starke</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Omer</surname>
            <given-names>DB</given-names>
          </name>
          <name>
            <surname>Grinvald</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Spors</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Independent component analysis of high-resolution imaging data identifies distinct functional domains</article-title>
        <source>Neuroimage.</source>
        <year>2007</year>
        <volume>34</volume>
        <issue>1</issue>
        <fpage>94</fpage>
        <lpage>108</lpage>
        <?supplied-pmid 17070071?>
        <pub-id pub-id-type="pmid">17070071</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Patel</surname>
            <given-names>TP</given-names>
          </name>
          <name>
            <surname>Man</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Firestein</surname>
            <given-names>BL</given-names>
          </name>
          <name>
            <surname>Meaney</surname>
            <given-names>DF</given-names>
          </name>
        </person-group>
        <article-title>Automated quantification of neuronal networks and single-cell calcium dynamics using calcium imaging</article-title>
        <source>J Neurosci Methods</source>
        <year>2015</year>
        <volume>243</volume>
        <fpage>26</fpage>
        <lpage>38</lpage>
        <?supplied-pmid 25629800?>
        <pub-id pub-id-type="pmid">25629800</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mancini</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>van der Bijl</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Bourgeois-Jaarsma</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Lasabuda</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Groffen</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <article-title>SICT: automated detection and supervised inspection of fast Ca2+ transients</article-title>
        <source>Sci Rep</source>
        <year>2018</year>
        <volume>8</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>13</lpage>
        <pub-id pub-id-type="pmid">29311619</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Szymanska</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Kobayashi</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Norimoto</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Ishikawa</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Ikegaya</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Nenadic</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Accurate detection of low signal-to-noise ratio neuronal calcium transient waves using a matched filter</article-title>
        <source>J Neurosci Methods</source>
        <year>2016</year>
        <volume>259</volume>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <?supplied-pmid 26561771?>
        <pub-id pub-id-type="pmid">26561771</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Keemink</surname>
            <given-names>SW</given-names>
          </name>
          <name>
            <surname>Lowe</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Pakan</surname>
            <given-names>JMP</given-names>
          </name>
          <name>
            <surname>Dylda</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>van Rossum</surname>
            <given-names>MCW</given-names>
          </name>
          <name>
            <surname>Rochefort</surname>
            <given-names>NL</given-names>
          </name>
        </person-group>
        <article-title>FISSA: a neuropil decontamination toolbox for calcium imaging signals</article-title>
        <source>Sci Rep</source>
        <year>2018</year>
        <volume>8</volume>
        <issue>1</issue>
        <fpage>3493</fpage>
        <?supplied-pmid 29472547?>
        <pub-id pub-id-type="pmid">29472547</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Williams</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Mirams</surname>
            <given-names>GR</given-names>
          </name>
        </person-group>
        <article-title>A web portal for in-silico action potential predictions</article-title>
        <source>J Pharmacol Toxicol Methods</source>
        <year>2015</year>
        <volume>75</volume>
        <fpage>10</fpage>
        <lpage>16</lpage>
        <?supplied-pmid 25963830?>
        <pub-id pub-id-type="pmid">25963830</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mahajan</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Shiferaw</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Sato</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Baher</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Olcese</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>L-H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A rabbit ventricular action potential model replicating cardiac dynamics at rapid heart rates</article-title>
        <source>Biophys J</source>
        <year>2008</year>
        <volume>94</volume>
        <issue>2</issue>
        <fpage>392</fpage>
        <lpage>410</lpage>
        <?supplied-pmid 18160660?>
        <pub-id pub-id-type="pmid">18160660</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ng</surname>
            <given-names>S-C</given-names>
          </name>
          <name>
            <surname>Raveendran</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Enhanced μ rhythm extraction using blind source separation and wavelet transform</article-title>
        <source>IEEE Trans Biomed Eng</source>
        <year>2009</year>
        <volume>56</volume>
        <issue>8</issue>
        <fpage>2024</fpage>
        <lpage>2034</lpage>
        <?supplied-pmid 19457744?>
        <pub-id pub-id-type="pmid">19457744</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pedregosa</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Varoquaux</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Gramfort</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Michel</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Thirion</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Grisel</surname>
            <given-names>O</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Scikit-learn: machine learning in Python</article-title>
        <source>J Mach Learn Res</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>2825</fpage>
        <lpage>2830</lpage>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>GR</given-names>
          </name>
          <name>
            <surname>Gommers</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wohlfahrt</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Wasilewski</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>O’Leary</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Nahrstaedt</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <source>PyWavelets - Wavelet Transforms in Python</source>
        <year>2006</year>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Klee</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Plonsey</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Stimulation of spheroidal cells--the role of cell shape</article-title>
        <source>IEEE Trans Biomed Eng</source>
        <year>1976</year>
        <volume>23</volume>
        <issue>4</issue>
        <fpage>347</fpage>
        <lpage>354</lpage>
        <?supplied-pmid 1278928?>
        <pub-id pub-id-type="pmid">1278928</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Diaspro</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Chirico</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Usai</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Ramoino</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Dobrucki</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Photobleaching</article-title>
        <source>Handbook of biological confocal microscopy</source>
        <year>2006</year>
        <publisher-loc>Boston</publisher-loc>
        <publisher-name>Springer US</publisher-name>
        <fpage>690</fpage>
        <lpage>702</lpage>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Penna</surname>
            <given-names>LB</given-names>
          </name>
          <name>
            <surname>Bassani</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <article-title>Increased spontaneous activity and reduced inotropic response to catecholamines in ventricular myocytes from footshock-stressed rats</article-title>
        <source>Stress.</source>
        <year>2010</year>
        <volume>13</volume>
        <fpage>73</fpage>
        <lpage>82</lpage>
        <?supplied-pmid 19697264?>
        <pub-id pub-id-type="pmid">19697264</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zoccoler</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Oliveira</surname>
            <given-names>PX</given-names>
          </name>
        </person-group>
        <article-title>Microfluorimetry system instrumentation for Ca2+−associated fluorescence imaging of Cardiomyocytes in response to high electric fields</article-title>
        <source>IFMBE Proc</source>
        <year>2015</year>
        <volume>51</volume>
        <fpage>1309</fpage>
        <lpage>1312</lpage>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Prado</surname>
            <given-names>LNS</given-names>
          </name>
          <name>
            <surname>Goulart</surname>
            <given-names>JT</given-names>
          </name>
          <name>
            <surname>Zoccoler</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Oliveira</surname>
            <given-names>PX</given-names>
          </name>
        </person-group>
        <article-title>Ventricular myocyte injury by high-intensity electric field: effect of pulse duration</article-title>
        <source>Gen Physiol Biophys</source>
        <year>2012</year>
        <volume>31</volume>
        <issue>4</issue>
        <fpage>375</fpage>
        <lpage>382</lpage>
        <pub-id pub-id-type="pmid">23255663</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouchard</surname>
            <given-names>RA</given-names>
          </name>
          <name>
            <surname>Clark</surname>
            <given-names>RB</given-names>
          </name>
          <name>
            <surname>Giles</surname>
            <given-names>WR</given-names>
          </name>
        </person-group>
        <article-title>Effects of action potential duration on excitation-contraction coupling in rat ventricular myocytes. Action potential voltage-clamp measurements</article-title>
        <source>Circ Res</source>
        <year>1995</year>
        <volume>76</volume>
        <issue>5</issue>
        <fpage>790</fpage>
        <lpage>801</lpage>
        <?supplied-pmid 7728996?>
        <pub-id pub-id-type="pmid">7728996</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
