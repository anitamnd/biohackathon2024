<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7385162</article-id>
    <article-id pub-id-type="publisher-id">17569</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-020-17569-8</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>VoPo leverages cellular heterogeneity for predictive modeling of single-cell data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Stanley</surname>
          <given-names>Natalie</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9974-4661</contrib-id>
        <name>
          <surname>Stelzer</surname>
          <given-names>Ina A.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-2380-6424</contrib-id>
        <name>
          <surname>Tsai</surname>
          <given-names>Amy S.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fallahzadeh</surname>
          <given-names>Ramin</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ganio</surname>
          <given-names>Edward</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-4296-3481</contrib-id>
        <name>
          <surname>Becker</surname>
          <given-names>Martin</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9245-6686</contrib-id>
        <name>
          <surname>Phongpreecha</surname>
          <given-names>Thanaphong</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Nassar</surname>
          <given-names>Huda</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ghaemi</surname>
          <given-names>Sajjad</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Maric</surname>
          <given-names>Ivana</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0083-6994</contrib-id>
        <name>
          <surname>Culos</surname>
          <given-names>Anthony</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Chang</surname>
          <given-names>Alan L.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Xenochristou</surname>
          <given-names>Maria</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6394-3055</contrib-id>
        <name>
          <surname>Han</surname>
          <given-names>Xiaoyuan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Espinosa</surname>
          <given-names>Camilo</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rumer</surname>
          <given-names>Kristen</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Peterson</surname>
          <given-names>Laura</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7061-5594</contrib-id>
        <name>
          <surname>Verdonk</surname>
          <given-names>Franck</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gaudilliere</surname>
          <given-names>Dyani</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Tsai</surname>
          <given-names>Eileen</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Feyaerts</surname>
          <given-names>Dorien</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-3450-4325</contrib-id>
        <name>
          <surname>Einhaus</surname>
          <given-names>Jakob</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ando</surname>
          <given-names>Kazuo</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1205-6936</contrib-id>
        <name>
          <surname>Wong</surname>
          <given-names>Ronald J.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Obermoser</surname>
          <given-names>Gerlinde</given-names>
        </name>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Shaw</surname>
          <given-names>Gary M.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Stevenson</surname>
          <given-names>David K.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1550-8136</contrib-id>
        <name>
          <surname>Angst</surname>
          <given-names>Martin S.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-3475-5706</contrib-id>
        <name>
          <surname>Gaudilliere</surname>
          <given-names>Brice</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-6117-8764</contrib-id>
        <name>
          <surname>Aghaeepour</surname>
          <given-names>Nima</given-names>
        </name>
        <address>
          <email>naghaeep@stanford.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000000419368956</institution-id><institution-id institution-id-type="GRID">grid.168010.e</institution-id><institution>Department of Anesthesiology, Perioperative and Pain Medicine, </institution><institution>Stanford University, </institution></institution-wrap>Stanford, USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000000419368956</institution-id><institution-id institution-id-type="GRID">grid.168010.e</institution-id><institution>Department of Biomedical Data Science, </institution><institution>Stanford University, </institution></institution-wrap>Stanford, USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">0000000419368956</institution-id><institution-id institution-id-type="GRID">grid.168010.e</institution-id><institution>Department of Pediatrics, </institution><institution>Stanford University, </institution></institution-wrap>Stanford, USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ISNI">0000000419368956</institution-id><institution-id institution-id-type="GRID">grid.168010.e</institution-id><institution>Department of Pathology, </institution><institution>Stanford University, </institution></institution-wrap>Stanford, USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0449 7958</institution-id><institution-id institution-id-type="GRID">grid.24433.32</institution-id><institution>Digital Technologies Research Centre, </institution><institution>National Research Council Canada, </institution></institution-wrap>Toronto, ON Canada </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="ISNI">0000000419368956</institution-id><institution-id institution-id-type="GRID">grid.168010.e</institution-id><institution>Department of Plastic Surgery, </institution><institution>Stanford University, </institution></institution-wrap>Stanford, USA </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="ISNI">0000000419368956</institution-id><institution-id institution-id-type="GRID">grid.168010.e</institution-id><institution>Center for Human Systems Immunology, </institution><institution>Stanford University, </institution></institution-wrap>Stanford, USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>7</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>7</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2020</year>
    </pub-date>
    <volume>11</volume>
    <elocation-id>3738</elocation-id>
    <history>
      <date date-type="received">
        <day>16</day>
        <month>12</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>3</day>
        <month>7</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2020</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">High-throughput single-cell analysis technologies produce an abundance of data that is critical for profiling the heterogeneity of cellular systems. We introduce VoPo (<ext-link ext-link-type="uri" xlink:href="https://github.com/stanleyn/VoPo">https://github.com/stanleyn/VoPo</ext-link>), a machine learning algorithm for predictive modeling and comprehensive visualization of the heterogeneity captured in large single-cell datasets. In three mass cytometry datasets, with the largest measuring hundreds of millions of cells over hundreds of samples, VoPo defines phenotypically and functionally homogeneous cell populations. VoPo further outperforms state-of-the-art machine learning algorithms in classification tasks, and identified immune-correlates of clinically-relevant parameters.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Single-cell technologies are increasingly prominent in clinical applications, but predictive modelling with such data in large cohorts has remained computationally challenging. We developed a new algorithm, ‘VoPo’, for predictive modelling and visualization of single cell data for translational applications.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Cellular signalling networks</kwd>
      <kwd>Applied immunology</kwd>
      <kwd>Computer modelling</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000861</institution-id>
            <institution>Burroughs Wellcome Fund (BWF)</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000002</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01HL13984401</award-id>
        <award-id>R01AG058417</award-id>
        <award-id>R61NS114926</award-id>
        <award-id>R21DE02772801</award-id>
        <award-id>K23GM111657</award-id>
        <award-id>T32GM089626</award-id>
        <award-id>5T32AI07290-33</award-id>
        <award-id>KL2TR003143</award-id>
        <principal-award-recipient>
          <name>
            <surname>Aghaeepour</surname>
            <given-names>Nima</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000865</institution-id>
            <institution>Bill and Melinda Gates Foundation (Bill &amp; Melinda Gates Foundation)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>OPP1112382</award-id>
        <award-id>OPP1113682</award-id>
        <principal-award-recipient>
          <name>
            <surname>Aghaeepour</surname>
            <given-names>Nima</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Bill and Melinda Gates Foundation (Bill &amp; Melinda Gates Foundation)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000038</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | U.S. Food and Drug Administration (U.S. Food &amp; Drug Administration)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>HHSF223201610018C</award-id>
        <award-id>HHSF223201610018C</award-id>
        <principal-award-recipient>
          <name>
            <surname>Aghaeepour</surname>
            <given-names>Nima</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100001659</institution-id>
            <institution>Deutsche Forschungsgemeinschaft (German Research Foundation)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>DFG, STE 2757/1-1</award-id>
        <principal-award-recipient>
          <name>
            <surname>Aghaeepour</surname>
            <given-names>Nima</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | U.S. Food and Drug Administration (U.S. Food &amp; Drug Administration)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Charles and Mary Robertson Foundation March of Dimes Prematurity Research Center at Stanford University Duke Charitable Foundation Burroughs Wellcome Fund Department of Anesthesiology, Perioperative and Pain Medicine at Stanford University Stanford Maternal and Child Health Research Institute</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2020</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">High-throughput single-cell analysis technologies offer key opportunities to investigate cellular heterogeneity at the levels of both gene and protein expression. However, uncovering a common set of phenotypically and functionally distinct cell populations from hundreds of millions of cells over hundreds of samples is a significant machine learning challenge that can be further complicated by batch effects and noisy measurements<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>.</p>
    <p id="Par4">Phenotypically-homogeneous cell populations can be identified through both unsupervised<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR6">6</xref></sup> and supervised<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR8">8</xref></sup> approaches. Single-cell data can further be linked to patient phenotypes through the use of classification-based methods<sup><xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR10">10</xref></sup> or through rigorous statistical testing approaches<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR11">11</xref></sup>. CellCNN<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> and CytoDX<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> use single cells as input, rather than features extracted from computationally identified cell populations<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. Independent from directly specifying a classification problem, though still making use of patient phenotypes, Diffcyt<sup><xref ref-type="bibr" rid="CR6">6</xref></sup> and Cydar<sup><xref ref-type="bibr" rid="CR11">11</xref></sup> belong to an additional class of algorithms that use patient labels for statistical testing to identify differentially-abundant or functionally-unique cell populations.</p>
    <p id="Par5">Unsupervised cell population discovery followed by feature extraction facilitates biological interpretation and predictive power in clinical applications<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. Specifically, features engineered from computationally-identified cell populations can capture differences in cell-frequency or functional responsiveness between phenotypic classes. Many of these clustering-based algorithms are stochastic<sup><xref ref-type="bibr" rid="CR2">2</xref>,<xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR5">5</xref></sup> and lead to variable cell-to-cluster assignments across algorithm runs. Previous work has acknowledged the implications of stochasticity in the interpretation of automated cell-population discovery results<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> and systematically analyzed the downstream effects of different sources of randomization in single-cell analyses<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. However, to the best of our knowledge, no prior work has examined how stochasticity in cell-to-cluster assignments can lead to variation in engineered features and corresponding classification accuracy.</p>
    <p id="Par6">Motivated by the objective to efficiently engineer a set of interpretable and biologically-meaningful features from single-cell data, we examined the effects of clustering algorithm stochasticity on classification accuracy. Our analysis revealed that individual clustering solutions generated corresponding features that lead to variability in classification accuracy. In this work, we focused on how to leverage the diverse information content in each individual solution obtained from a stochastic clustering algorithm for improved prediction accuracy and interpretability in clinical settings.</p>
    <p id="Par7">VoPo (The name VoPo is an abbreviation for the concept of Vox Populi published by Sir Francis Galton in Nature more than a century ago, where he demonstrated that heterogeneity in estimations can be leveraged for more accurate predictions<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>) is a machine learning algorithm focused on cell-population discovery, robust predictive modeling, and visualization of the cellular correlates of patient phenotype. VoPo’s cell-population discovery method is readily scalable and enables the integration of a large number of samples without any downsampling, ensuring that rare cell types<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> can be adequately identified. The clustering component of VoPo does not rely on an individual cell-to-population partition, but instead integrates multiple clustering solutions to predict patient phenotype. In doing so, VoPo increases classification accuracy and has less variability compared to individual solutions. VoPo further links these identified cell populations with additional clinical information to provide a comprehensive understanding of the cell types and signaling pathways associated with a particular clinical phenotype.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Algorithm overview</title>
      <p id="Par8">Following single-cell profiling of a cohort of subjects (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a), VoPo performs individual-sample clustering (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b), between-sample repeated metaclustering and feature engineering (Fig. <xref rid="Fig1" ref-type="fig">1</xref>c), unsupervised feature selection (Fig. <xref rid="Fig1" ref-type="fig">1</xref>d), classification (Fig. <xref rid="Fig1" ref-type="fig">1</xref>e), and visualization (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a–c). VoPo was tested across three diverse immunological datasets profiling immune response to surgery, normal term pregnancy<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>, and recovery from stroke<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>.<fig id="Fig1"><label>Fig. 1</label><caption><title><bold>An overview of the VoPo pipeline for robust clinical outcome prediction</bold>.</title><p>VoPo is an end-to-end bioinformatics pipeline for prediction and visualization of high-throughput single-cell data. <bold>a</bold> Patient samples are collected and the immune system is profiled at a single-cell level (image created with BioRender.com). <bold>b</bold> Cells from individual samples are first assigned to within-sample clusters. <bold>c</bold> A collection of cell populations (metaclusters) common to all samples is defined through repeated metaclustering. Each uniquely colored graph is a schematic representation of a unique metaclustering solution, with each node representing a metacluster. <bold>d</bold> Unsupervised Laplacian Score-based feature selection is applied independently to each metaclustering solution to reduce feature redundancy. This results in a collection of features acquired collectively across the independent metaclustering solutions. The color of a node (e.g., retained metacluster) schematically represents the metaclustering solution where it was produced (from <bold>c</bold>). <bold>e</bold> The features retained across independent metaclustering solutions are integrated and used to classify patients according to clinical phenotype.</p></caption><graphic xlink:href="41467_2020_17569_Fig1_HTML" id="d30e728"/></fig><fig id="Fig2"><label>Fig. 2</label><caption><title><bold>Applying VoPo to three mass cytometry datasets</bold>.</title><p>Single-cells across samples were projected into two dimensions using tSNE in the HSR (<bold>a</bold>), NTP (<bold>b</bold>), and LSR (<bold>c</bold>) datasets. Cells were colored by their computed differentiation score, which depicts the degree of association with the clinical outcome of interest. Cells that are brightly colored likely belong to cell populations that are strongly associated with a particular clinical outcome. The direction of frequency differences between case and control samples is shown in Supplementary Figs. <xref rid="MOESM1" ref-type="media">7</xref>, <xref rid="MOESM1" ref-type="media">10</xref>, and <xref rid="MOESM1" ref-type="media">15</xref>. <bold>d</bold> Integrating features extracted over the fifty metaclustering solutions with VoPo (pink boxplots) resulted in higher classification accuracy (AUC) over the baseline case where VoPo was not applied (black boxplots) across the three datasets. The boxplots show median values, interquartile range, whiskers of 1.5 times interquartile range, and all individual points.</p></caption><graphic xlink:href="41467_2020_17569_Fig2_HTML" id="d30e763"/></fig></p>
      <p id="Par9">VoPo uses a downsampling-free metaclustering strategy. The metaclustering technique allows for the efficient integration of all cells across all samples. All live cells (DNA<sup>+</sup>CD235<sup>−</sup>CD61<sup>−</sup>cPARP<sup>−</sup>) from each sample are first clustered based on both functional and phenotypical markers (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b). Cluster centers (e.g., the mean expression of the markers across all cells within a cluster) identified across samples are then re-clustered to form metaclusters (Fig. <xref rid="Fig1" ref-type="fig">1</xref>c). As stochastic clustering algorithms produce different cell-to-metacluster solutions across individual runs, the metaclustering step is run multiple times to produce multiple independent cell-to-metacluster solutions for each sample. For further downstream analysis and interpretation, identified metaclusters are curated by an expert investigator and mapped to known cell types based on median marker expression (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a–c).</p>
      <p id="Par10">For each metaclustering result, we engineer a set of frequency-based features encoding the proportion of each sample’s cells assigned to each metacluster. Since both phenotypical and functional markers were used in the metaclustering steps, these frequency-based features provide an efficient joint representation of cellular phenotypes and functions. Running VoPo with <italic>K</italic> total clusters per metaclustering iteration with <italic>I</italic> total metaclustering solutions results in <italic>K</italic> × <italic>I</italic> total engineered frequency-based features. As a result of repeated metaclustering, the engineered features are distinct yet highly correlated. To reduce redundancy, an unsupervised feature selection approach<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> is applied independently to the set of engineered frequency features produced by each metaclustering solution (Fig. <xref rid="Fig1" ref-type="fig">1</xref>d). Metaclusters passing feature selection are used to construct a sample-by-feature matrix to be input to a classification pipeline (Fig <xref rid="Fig1" ref-type="fig">1</xref>e). An ensemble leave-group-out cross validation strategy is used to make multiple predictions for each sample (see “Methods” section).</p>
    </sec>
    <sec id="Sec4">
      <title>Applying VoPo to three mass cytometry datasets</title>
      <p id="Par11">VoPo was tested in three datasets measuring whole system peripheral immune responses through mass cytometry<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. This assay allows for the detailed phenotyping of major innate and adaptive immune cell subsets and assessment of intracellular signaling activities (Supplementary Tables <xref rid="MOESM1" ref-type="media">1</xref>, <xref rid="MOESM1" ref-type="media">2</xref>, and <xref rid="MOESM1" ref-type="media">3</xref>). Mass cytometry has shown to be useful in a number of translational settings, including graft versus host disease<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>, autoimmune diseases<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, vaccine response<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, and selective T-cell differentiation<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. In this work, the tested datasets span diverse clinical applications, including, hip surgery recovery (HSR)<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>, normal term pregnancy (NTP)<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>, and longitudinal stroke recovery (LSR)<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>. For direct comparison, all three datasets were evaluated with a case–control analysis. That is, a supervised binary classification task was formulated based on the frequency-based features computed across metaclustering solutions.</p>
      <p id="Par12">We studied how integrating features generated through repeated metaclustering leads to higher classification accuracy than the average of those obtained from single metaclustering solutions. Fifty metaclustering solutions were generated with <italic>K</italic>′ = 50 metaclusters in the HSR, NTP, and LSR datasets, respectively. After applying unsupervised locality-preserving feature selection to the collective set of metaclustering-based features to retain 40 clusters per metaclustering iteration (see Supplementary Figs. <xref rid="MOESM1" ref-type="media">3</xref> and <xref rid="MOESM1" ref-type="media">17</xref>), the classification pipeline was run and area under the receiver operator curve (AUC) was used as the metric of success. The single clustering (black) and repeated-clustering (pink) distributions of AUCs are visualized for each of the three datasets in Fig <xref rid="Fig2" ref-type="fig">2</xref>d. To generate the distribution of baseline classification accuracies (black), we repeatedly selected a random individual metaclustering solution from the fifty that were generated and input its associated features to the classification pipeline. The procedure was repeated 100 times with each datapoint corresponding to a unique, randomly selected metaclustering solution from the fifty that were generated. Similarly, the VoPo classification accuracy distribution (pink) was generated by inputting the frequency features (retained after feature selection) across all 50 metaclustering solutions into the classification pipeline over 100 trials. Across the three datasets, features obtained through repeated metaclustering with VoPo lead to higher classification accuracy over the baseline, with mean AUCs of 0.75, 0.71, and 0.72 in the HSR, NTP, and LSR datasets, respectively. This compares to the mean baseline AUCs in the HSR, NTP, and LSR datasets of 0.74, 0.68, and 0.70. Notably, the variance in classification accuracy was significantly decreased by building models based on features engineered from all metaclustering solutions, as opposed to choosing any of the individual solutions. VoPo also resulted in higher classification accuracy over several baseline algorithms across datasets (Fig. <xref rid="Fig3" ref-type="fig">3</xref>, Supplementary Figs. <xref rid="MOESM1" ref-type="media">4</xref>–<xref rid="MOESM1" ref-type="media">5</xref>).<fig id="Fig3"><label>Fig. 3</label><caption><title><bold>Applying the VoPo framework across clustering algorithms</bold>.</title><p>Implementing repeated metaclustering within the VoPo framework improved accuracy and increased robustness across datasets and clustering algorithms. Regardless of whether PhenoGraph, FlowSOM, or <italic>k</italic>-means was used in the clustering and metaclustering components of VoPo, repeated metaclustering with VoPo (pink boxplots) lead to higher average classification accuracy (AUC) with less variability over the baseline case where VoPo was not applied (black boxplots). The boxplots show median values, interquartile range, whiskers of 1.5 times interquartile range, and all individual points.</p></caption><graphic xlink:href="41467_2020_17569_Fig3_HTML" id="d30e899"/></fig></p>
    </sec>
    <sec id="Sec5">
      <title>Visualizing the immune correlates of clinical outcome</title>
      <p id="Par13">To study the immunophenotypes associated with a clinical outcome, VoPo computes user-defined statistics on the identified cell populations and maps this information onto individual cells. Such an approach enables a classic single-cell visualization with additional information related to the clinical variable of interest, as opposed to cluster-level visualization<sup><xref ref-type="bibr" rid="CR3">3</xref>–<xref ref-type="bibr" rid="CR5">5</xref></sup>. In each dataset, thirty-thousand cells were extracted across samples and projected into two dimensions with t-SNE<sup><xref ref-type="bibr" rid="CR25">25</xref></sup> based on both phenotypical and functional marker expression (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a–c). Cell populations were annotated using phenotypic and functional marker expression (see Supplementary Figs. <xref rid="MOESM1" ref-type="media">6</xref>, <xref rid="MOESM1" ref-type="media">9</xref>, and <xref rid="MOESM1" ref-type="media">14</xref> for HSR, NTP, and LSR datasets, respectively). While we used t-SNE, the visualization step is compatible with a variety of dimensionality reduction algorithms (Supplementary Figs. <xref rid="MOESM1" ref-type="media">8</xref>, <xref rid="MOESM1" ref-type="media">11</xref>, and <xref rid="MOESM1" ref-type="media">16</xref>). Then, each cell is colored based on its association with the clinical phenotype of interest by computing a differentiation score. First, a similarity measure is computed between each cell and each identified cell-population (metacluster) based on both phenotypic and functional markers. Each cell-population identified through metaclustering has an associated significance score (e.g., fold change) reflecting the extent of frequency difference between case and control samples (see “Methods” section). The differentiation score for a particular cell is a linear combination of the significance scores for each cluster, where the corresponding weights are proportional to the cell-to-metacluster similarity. The resulting visualization allows for the efficient identification of the particular cell types that can differentiate patient phenotypes.</p>
      <p id="Par14">Because clustering is performed using live cells, all major innate and adaptive immune cell populations contribute to the classification task. For the purpose of interpretation, CD45<sup>+</sup>CD66<sup>+</sup> granulocytes, which are the most frequent among all cells, are excluded during the visualization steps to ensure comprehension and enhance identification of smaller populations.</p>
    </sec>
    <sec id="Sec6">
      <title>Results in the HSR, NTP, and LSR datasets</title>
      <p id="Par15">Longitudinal peripheral blood samples were collected from 58 patients undergoing hip surgery. Samples were collected before and at 1, 6, 24, 48 h, and 2 weeks after surgery. Patients were either given the glucocorticoid (GC) methylprednisolone (<italic>N</italic> = 30) or a placebo treatment (<italic>N</italic> = 28)<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. This dataset consisted of 115 million cells from 331 samples. The respective classification task was to predict whether a sample was collected from a patient (at any time point) receiving GC or placebo treatment. Visualization of individual cluster frequency differences between the two patient groups (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a) revealed broad alterations in innate and adaptive immune cell frequencies. Consistent with prior studies, the most prominent changes included decreased frequencies of monocytes (including classical, cMCs, and nonclassical, ncMCs, monocytes) and CD4<sup>+</sup> T cell subsets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>) in GC-treated patients. These cell types contain high levels of the signaling protein inhibitor of nuclear factor-kB (IkB), consistent with known mechanism of action of GCs in innate and adaptive cells<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>.</p>
      <p id="Par16">Ninety-three longitudinal peripheral blood samples from 31 women were collected during the first, second and third trimester of pregnancy. Samples were also collected six weeks post-partum<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. The analysis classified first trimester (<italic>N</italic> = 31) from the second trimester (<italic>N</italic> = 31) samples. This resulted in 18 million cells over 62 samples included in the analysis. The most prominent differences (Fig. <xref rid="Fig2" ref-type="fig">2</xref>b) included a decrease (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>) in CD56<sup>lo</sup>CD16<sup>+</sup> NK cells, and B cells, and an increase in cMC frequencies in second trimester compared to first trimester samples. These changes between the first and second trimester have previously been reported and are associated with dynamic immunological adaptations to pregnancy<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. To further connect VoPo’s performance on the pregnancy dataset back to previous work<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>, we also compared third trimester to postpartum pregnancy samples (Supplementary Figs. <xref rid="MOESM1" ref-type="media">12</xref> and <xref rid="MOESM1" ref-type="media">13</xref>) and observed similar prioritized cell populations.</p>
      <p id="Par17">Longitudinal peripheral blood samples were collected from 24 patients who suffered from an ischemic stroke<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>. Samples were collected for 1, 2, 3, 7, 14, 90 days, and 1 year after the stroke. In this dataset, the one-year time point serves as a surrogate for the state of a patient’s immune system before a stroke. Samples collected at 48 h (<italic>N</italic> = 22) were classified from one year (<italic>N</italic> = 18) samples. For this comparison, 40 samples from the cohort were included, resulting in 13 million total cells. Consistent with prior analyses of the LSR dataset, the most prominent differences between 48 h and 1 year samples included decreased frequencies (Supplementary Fig. <xref rid="MOESM1" ref-type="media">15</xref>) of NK cells and ncMC, and increased cMC and B cell frequencies 48 h after stroke (Fig. <xref rid="Fig2" ref-type="fig">2</xref>c). These differences are indicative of an acute inflammatory phase of the stroke immune response 1–5 days after the stroke, characterized by the relative decrease in abundance of regulatory subsets such as NK cells, ncMC, and expansion of proinflammatory cMCs<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>.</p>
      <p id="Par18">In addition to recapitulating findings from prior studies, VoPo revealed differences between patient groups that were overlooked with previously applied gating strategies, and clustering approaches. For example, in the HSR dataset, a subset of activated ncMCs characterized by high pNFkB and pMK2 levels had markedly decreased frequencies between GCs and placebo-treated patient groups, highlighting differential effects of GCs in functionally-distinct monocyte subsets (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a). In the NTP dataset, examination of the t-SNE plots colored by differentiation score revealed a subpopulation of cMCs expressing a combination of three functional markers (pMK2, pP38, and pERK1/2) that differed between the first and second trimester of pregnancy, which was not apparent in previous analyses of the same dataset (Fig. <xref rid="Fig2" ref-type="fig">2</xref>b). This observation is in line with previously reported increased responsiveness in myeloid cell populations, such as the progressive activation of monocytes throughout pregnancy<sup><xref ref-type="bibr" rid="CR28">28</xref>,<xref ref-type="bibr" rid="CR29">29</xref></sup>. In the LSR dataset, the VoPo analysis revealed differences in the CD56<sup>lo</sup>CD16<sup>+</sup> NK cell subpopulation that differed between the two observational time points after stroke and were not identified in a prior analysis (Fig. <xref rid="Fig2" ref-type="fig">2</xref>c). This finding is particularly clinically relevant as depletion of systemic NK cells early after stroke due to their mobilization to the ischemic brain and their local inflammatory activity has been associated with post-stroke recovery<sup><xref ref-type="bibr" rid="CR30">30</xref>,<xref ref-type="bibr" rid="CR31">31</xref></sup>.</p>
      <p id="Par19">Overall, cell populations uniquely identified with VoPo were often defined using a combination of phenotypic and functional markers (e.g. subsets of populations labeled in blue in Fig. <xref rid="Fig2" ref-type="fig">2</xref>a–c, e.g., IkB<sup>dim</sup> pNFkB<sup>dim</sup> pERK1/2<sup>−</sup> cMCs in LSR dataset). These findings highlight an advantage of using an unsupervised clustering approach that combines phenotypic and functional information obtained at the single-cell level. Such information enables the identification of immune cell populations with biologically-meaningful differences between clinical study groups. Detailed descriptions of cell populations associated with the particular clinical phenotype and prioritized by VoPo are shown in Supplementary Figs. <xref rid="MOESM1" ref-type="media">19</xref> and <xref rid="MOESM1" ref-type="media">20</xref>.</p>
    </sec>
    <sec id="Sec7">
      <title>Computational considerations</title>
      <p id="Par20">One particular advantage of VoPo is its efficient run-time and scalability to a large number of samples. As a result of the metaclustering strategy, the automated cell-population discovery task can be easily parallelized across individual samples for efficient implementation. In the analysis of the HSR, NTP, and LSR datasets with 331, 62, and 40 samples, respectively, the clustering, feature selection, and classification pipelines were parallelized and run on a computer with 35 AMD EPYC 7551 CPUs. The repeated metaclustering process resulted in run-times of 39.63, 7.55, and 5.32 min, respectively. Similarly, performing unsupervised feature selection followed by cross-validated classification resulted in run-times of 115.2, 20.01, and 12.13 s in the HSR, NTP, and LSR datasets, respectively.</p>
      <p id="Par21">Automated cell-population discovery with VoPo lead to features that facilitate superior classification accuracy over several baseline methods (Fig. <xref rid="Fig3" ref-type="fig">3</xref> and Supplementary Figs. <xref rid="MOESM1" ref-type="media">4</xref>–<xref rid="MOESM1" ref-type="media">5</xref>). Importantly, we also observed that particular unsupervised clustering algorithm used is not as important as how it is being applied. In particular, regardless of the clustering algorithm used, integrating features engineered through the VoPo pipeline (pink) lead to higher classification accuracy with less variability over the baseline, where only a single metaclustering solution was used (black). In Fig. <xref rid="Fig3" ref-type="fig">3</xref>, we repeated the analysis shown in Fig. <xref rid="Fig2" ref-type="fig">2</xref>d. In these experiments, we compared using <italic>k</italic>-means in both individual sample and metaclustering steps to the results obtained using PhenoGraph or FlowSOM clustering. The grid of distributions in Fig. <xref rid="Fig3" ref-type="fig">3</xref> shows classification trials of the baseline distribution of AUCs (black) compared to 100 classification trials from applying repeated metaclustering through VoPo (pink). Across all three datasets and clustering algorithms, implementing repeated metaclustering through the VoPo pipeline across <italic>k</italic>-means, FlowSOM, and PhenoGraph results in higher classification accuracy, on average, compared to the baseline results obtained from using individual metaclustering solutions (black).</p>
      <p id="Par22">We further investigated how applying unsupervised feature selection to the entire collection of features generated through repeated metaclustering can lead to superior classification accuracy. The unsupervised locality preserving feature selection approach<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> was applied to each metaclustering solution to prioritize a subset of features that can best preserve pairwise distances between samples. Such an approach therefore is effective at removing redundant information (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17</xref>) that does not contribute additional information to the understanding of interpatient variability (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>), prior to classification. We studied this across the three datasets by looking at the distribution of classification accuracies from the features obtained over the 50 metaclustering solutions with (purple) and without (black) feature selection. The distributions of AUCs over 100 classification trials are visualized in Fig. <xref rid="Fig4" ref-type="fig">4</xref> and show that in all the three datasets, unsupervised feature selection achieves higher classification accuracy. The orange horizontal line in each plot indicates the mean baseline AUC from the features obtained from a single metaclustering solution. Repeated metaclustering alone increases the performance from the baseline in all three datasets, but feature selection leads to additional competitive advantages. Such an analysis suggests that reducing feature redundancy through a filter-based feature selection is valuable for increasing classification accuracy across clinical datasets.<fig id="Fig4"><label>Fig. 4</label><caption><title><bold>Applying unsupervised Laplacian score features selection to VoPo features</bold>.</title><p>Unsupervised feature selection was applied independently to the frequency-based features engineered from each metaclustering solution. Here, we show distributions of classification accuracies (AUC) with (purple boxplots) and without (gray boxplots) feature selection applied to features extracted with VoPo. The dashed orange horizontal line shows the mean baseline classification accuracy using the features obtained without the use of the VoPo pipeline. In all three datasets VoPo’s robust feature extraction (gray) improved the results over baseline (orange boxplots). Additionally, VoPo’s robust feature selection followed by unsupervised feature selection further improved classification accuracy (purple boxplots). The boxplots show median values, interquartile range, whiskers of 1.5 times interquartile range, and all individual points.</p></caption><graphic xlink:href="41467_2020_17569_Fig4_HTML" id="d30e1149"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec8" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par23">In summary, VoPo exploits the variability encountered across independent metaclustering solutions to enable clinically-relevant prediction and comprehensive visualization from mass cytometry data. In particular, VoPo uses the diversity of solutions returned through repeated metaclustering to extract additional information from all samples for improved classification accuracy. Such an approach prevents a user from having to choose between one of the variable cell-to-metacluster solutions returned by a stochastic clustering algorithm. Additionally, VoPo’s novel single-cell visualization approach can effectively convey the cell types and signaling events associated with a particular clinical phenotype. Such a visualization strategy therefore facilitates unbiased hypothesis generation by mapping cluster-level statistics to individual cells in a novel way. Here, we applied VoPo to three clinical mass cytometry datasets and showed that it is amenable to any clustering algorithm.</p>
    <p id="Par24">While our examples were focused on binary classification tasks, the feature matrix produced by VoPo provides a flexible input for a range of machine learning tasks, such as, multilabel classification and regression tasks. A user can then further compute a range of statistics on the identified cell populations reflecting how they relate to an external variable of interest. In cases where the external variable is continuous, for example, a user could build a regression model based on the engineered features of the identified cell populations and use model coefficients as the statistic of interest. Further, a promising possible extension of VoPo is to create a so-called “multiview” representation of the immune system, where features are engineered separately for each major cell-type and combined using a multiview machine learning algorithm<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. Such an approach would enable an understanding of each major cell-type and their overall contribution to the prediction of the desired clinical phenotype. Finally, in its current form, VoPo metaclustering and feature engineering must be re-run if new patient samples are collected. An important area of future work is to more readily accommodate new samples by developing an adaptive clustering and feature engineering strategy, based on an existing VoPo metaclustering result.</p>
    <p id="Par25">VoPo provides a general framework for linking particular cell populations to clinical phenotype and inspires a range of future directions. In regards to the cell-population discovery aspect of VoPo, we could further consider how adding in supervision, such as through specifying “landmark cells” and prior knowledge with ACDC<sup><xref ref-type="bibr" rid="CR7">7</xref></sup> or by providing human insight into the gating process with DeepCyTOF<sup><xref ref-type="bibr" rid="CR8">8</xref></sup> or flowDensity<sup><xref ref-type="bibr" rid="CR33">33</xref></sup> can aid in the interpretability of identified cell populations.</p>
  </sec>
  <sec id="Sec9">
    <title>Methods</title>
    <sec id="Sec10">
      <title>Repeated metaclustering</title>
      <p id="Par26">Automated cell population discovery is achieved through repeated unsupervised clustering. Both functional and phenotypic markers are included in clustering to identify cell populations that are consistent across both phenotype and function. Through repeated clustering, we obtain “multiple views” of the immune system and therefore take advantage of the variability that arises across various runs of a stochastic clustering algorithm. To reduce the computational burden of clustering millions of cells across a large number of samples, we use metaclustering. First, we cluster cells from each of the <italic>S</italic> samples so that cells from sample <italic>i</italic> have been assigned to one of <italic>k</italic><sub><italic>i</italic></sub> clusters. This results in <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K=\mathop{\sum }\nolimits_{i = 1}^{S}{k}_{{{i}}}$$\end{document}</tex-math><mml:math id="M2"><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq1.gif"/></alternatives></inline-formula> total clusters (or coherent cell-populations). The centers for these <italic>K</italic> clusters are then then clustered into <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K^{\prime}$$\end{document}</tex-math><mml:math id="M4"><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq2.gif"/></alternatives></inline-formula> metaclusters, which are intended to represent the functionally and phenotypically coherent cell-populations in the data. In practice we use <italic>k</italic>-means for all clustering steps, but a user is free to use any clustering method for this task.</p>
      <p id="Par27">After having generated <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K^{\prime}$$\end{document}</tex-math><mml:math id="M6"><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq3.gif"/></alternatives></inline-formula> clusters, we repeat this metaclustering step <italic>I</italic> times. We denote <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${K}_{{{m}}}^{\prime}$$\end{document}</tex-math><mml:math id="M8"><mml:msubsup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq4.gif"/></alternatives></inline-formula> as the number of metaclusters defined in iteration in <italic>m</italic>. Moreover, repeating the metaclustering step <italic>I</italic> times results in <inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$P=\sum_{{{m}} = 1}^{I}{K}_{{{m}}}^{\prime}$$\end{document}</tex-math><mml:math id="M10"><mml:mi>P</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>I</mml:mi></mml:mrow></mml:msubsup><mml:msubsup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq5.gif"/></alternatives></inline-formula> total overlapping clusters. We subsequently build features for these <italic>P</italic> clusters, which serve as the input to our classification algorithm.</p>
      <p id="Par28">A user is free to use any stochastic clustering algorithm in the metaclustering steps. In this work, <italic>k</italic>-means clustering was used both in the within-sample clustering and metaclustering steps. Each sample was first coarsely clustered into 1000 clusters (<italic>k</italic><sub><italic>i</italic></sub> = 1000). We then defined <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${K}_{{{m}}}^{\prime}=50$$\end{document}</tex-math><mml:math id="M12"><mml:msubsup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>50</mml:mn></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq6.gif"/></alternatives></inline-formula> metaclusters for each clustering iteration in the HSR, NTP, and LSR datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">18</xref>).</p>
    </sec>
    <sec id="Sec11">
      <title>Markers used for clustering</title>
      <p id="Par29">Analogous to what is typically done in manual gating, existing clustering algorithms for flow and mass cytometry data define cell-populations based only on phenotypic markers<sup><xref ref-type="bibr" rid="CR2">2</xref>–<xref ref-type="bibr" rid="CR5">5</xref></sup>. This ensures that the computationally-identified cell-populations are capturing cell phenotype, where the expression of various functional markers can be studied further. Similar to the process of manual gating, existing algorithms define frequency and functional marker features for each identified cell population. After clustering, two complementary types of features can then be defined for each sample. A frequency feature for cluster <italic>i</italic> in sample <italic>s</italic> denotes the proportion of each sample’s <italic>s</italic> cells that were assigned to cluster <italic>i</italic>. Alternatively, a functional feature for functional marker <italic>j</italic> in cluster <italic>i</italic> in sample <italic>s</italic> is the mean or median expression functional marker expression of functional marker <italic>j</italic> in cluster <italic>i</italic> in sample <italic>s</italic>. As feature engineering in this manner implements what is done in the manual gating process, it ultimately generates a very large number of features. In particular for each sample there will be <italic>K</italic> + <italic>K</italic> × <italic>F</italic> total features, where <italic>K</italic> is the number of clusters and <italic>F</italic> is the number of functional markers.</p>
      <p id="Par30">In this work, we take a different approach where we define cell-populations with both functional and phenotypic markers to identify particular cell-populations that are both phenotypically similar but also exhibit similar patterns of functional marker expression. The motivation for doing this is that we are then able to define only frequency-based features that capture both phenotype and function. For example, if the expression of functional marker <italic>j</italic> is increased in a CD4<sup>+</sup> T-cell population in a subset of samples then those samples will also have a higher frequency of CD4<sup>+</sup> T-cells that have high expression of marker <italic>j</italic>.</p>
    </sec>
    <sec id="Sec12">
      <title>Feature engineering from metaclusters</title>
      <p id="Par31">After having defined <italic>P</italic> total metaclusters, we define frequency and functional marker mean expression features for each cluster across all samples. We let <bold>F</bold> be the <italic>S</italic> × <italic>P</italic> matrix of frequency features, where a particular entry <italic>F</italic><sub><italic>ij</italic></sub> represents the proportion of sample <italic>i</italic>’s cells that were assigned to metacluster <italic>j</italic>. Similarly, assuming that we have <italic>f</italic> functional markers, we define <italic>f</italic> functional marker matrices reflecting the mean functional marker expression across each of the clusters in each sample. Moreover, we let <bold>X</bold><sup><italic>t</italic></sup> be the <italic>S</italic> × <italic>P</italic> matrix of functional marker expressions for a particular marker, <italic>t</italic>. An individual entry <inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${X}_{{{ij}}}^{{{t}}}$$\end{document}</tex-math><mml:math id="M14"><mml:msubsup><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq7.gif"/></alternatives></inline-formula> is the mean expression of marker <italic>t</italic> in sample <italic>i</italic> in cluster <italic>j</italic>. We can horizontally concatenate each of the <italic>f</italic> matrices into the full functional <italic>S</italic> × (<italic>P</italic> × <italic>f</italic>) marker feature matrix, <bold>X</bold><sup>*</sup> = [<bold>X</bold><sup>1</sup>∣<bold>X</bold><sup>2</sup>∣. . . . ∣<bold>X</bold><sup>f</sup>].</p>
      <p id="Par32">After having constructed the frequency and functional marker matrices, <bold>F</bold> and <bold>X</bold><sup>*</sup>, we can use them individually or in combination as the input to classification tasks. One benefit of including the functional markers in the clustering step is that the frequency features also carry information about the signaling activity in each cluster. As we previously stated, the matrix <bold>X</bold><sup>*</sup> has much higher dimension than <bold>F</bold> and can therefore require more sophisticated machine learning techniques, such as, feature selection or regularization for quality classification results. In Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>, we show that using the frequency features encoded in <bold>F</bold> is sufficient for high predictive accuracy across our three example datasets.</p>
    </sec>
    <sec id="Sec13">
      <title>Unsupervised feature selection</title>
      <p id="Par33">Due to the high redundancy in the clusters obtained through repeated metaclustering, the constructed feature matrices, <bold>F</bold> and <bold>X</bold><sup>*</sup> have many collinearities, or sets of features that are highly correlated with each other. As a result, feature selection is a principled approach for reducing the high dimensionality of <bold>F</bold> and <bold>X</bold><sup>*</sup>, and for mediating the problems introduced by data colliniearity. We chose to use a locality-preserving feature selection method, developed by He et al.<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. Intuitively, locality-preserving feature selection methods seek to identify a smaller subset of features that maintain the general distribution of between-sample similarities obtained when all features are used. This objective is enforced through the construction of a <italic>k</italic>-nearest neighbor similarity network between the <italic>S</italic> samples. After having constructed the similarity network, a function of the Graph Laplacian<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> is used to score each feature for its usefulness in maintaining the patterns of between-sample similarity observed in the original data with all features included. In all three datasets, we selected the top 40 out of the 50 total features per metaclustering iteration, according to their computed Laplacian scores (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>).</p>
      <p id="Par34">This unsupervised feature selection approach is performed on the computed frequency-based data matrix prior to classification. It does not have access to any of the patient phenotypes and therefore does not introduce any bias. This feature selection step is used primarily to eliminate redundancy among features. After applying feature selection, we obtain the input for the supervised analysis, which is performed with leave-group-out cross validation.</p>
    </sec>
    <sec id="Sec14">
      <title>Cross validation</title>
      <p id="Par35">In this work, we focus on binary classification problems. That is, each dataset was analyzed as a case–control study between two clinical classes, with <italic>S</italic> total collected samples. We let <bold>y</bold> be an <italic>S</italic>-length vector, where an individual entry <italic>y</italic><sub><italic>i</italic></sub> ∈ {0, 1} gives the binary classification label for sample <italic>i</italic>. In the presented work, we use a Random Forest classifier. We note a user is free to use any classification algorithm of their choice. While there are a variety cross validation (CV) strategies, we use a ensemble-based leave-group-out approach. At a high level, this approach repeatedly chooses a unique random subset of patients and their corresponding samples to be used for training, and the remaining to be test samples. Our CV approach uses <italic>B</italic> iterations of bootstrapping to iteratively and independently partition all samples into training and test sets. In a particular CV iteration, we choose a half of all patients to be members of the training set. Using the samples corresponding to the selected training patient samples, we train the Random Forest model. We then predict the labels of the samples corresponding to the unused remaining subset of patients not included in the training set. In particular, the predicted values for these samples reflect the probability of belonging to class “1”. We then store these predicted probabilities that correspond to test set patient samples. After completing <italic>B</italic> = 500 bootstrapped cross validation iterations, we have multiple predicted probabilities of belongs to class “1” for each of the <italic>S</italic> samples, noting that a sample only has a prediction for a particular bootstrapped iteration if it corresponds to a patient that was assigned to the test set. We ultimately predict the probability that a particular sample, <italic>i</italic>, belonging to the “1” class as the median predicted probability over all iterations where <italic>i</italic> was included in the test set. Finally, we define a length-<italic>S</italic> vector, <bold>y</bold>*, where the entry <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${y}_{{\mathrm{i}}}^{* }$$\end{document}</tex-math><mml:math id="M16"><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">i</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq8.gif"/></alternatives></inline-formula> encodes the final predicted probability that sample <italic>i</italic> belongs to class “1”. Using the true response vector, <bold>y</bold>, and the vector of predicted probabilities, <bold>y</bold>*, we can construct an ROC curve and compute area under the ROC curve (AUROC) as the metric of success.</p>
    </sec>
    <sec id="Sec15">
      <title>Visualization pipeline</title>
      <p id="Par36">We developed a visualization pipeline that allows for interpretation of the cell types and signaling pathways contributing to a particular clinical phenotype of interest. Our general approach is to sample a large subset of all cells (30,000) across all <italic>S</italic> samples and to map significance scores computed for each cluster to the single cells. Because we are using tSNE for dimensionality reduction, we can only visualize a limited number of cells across all samples. We note that a user is free to use any dimensionality reduction method of their choice. Downsampling of cells is only required for the visualization aspect of VoPo but all cells are used to engineer features for predictive modeling. In practice, we compute univariate <italic>p</italic>-values for each cluster that reflect frequency or signaling differences among samples in each class.</p>
      <p id="Par37">After sampling 30,000 total cells (excluding granulocytes) across all sample FCS files, we constructed a cell × marker matrix, <bold>A</bold>, where the functional and phenotypic markers are represented across the columns. We then create a two-dimensional embedding of the cells using tSNE on <bold>A</bold>.</p>
      <p id="Par38">Each cell in the LargeVis representation can then be colored by its expression for each of the phenotypic and functional markers to produce a series of plots (one plot per marker). The major cell types were inferred according to phenotypic marker expression.</p>
      <p id="Par39">The frequency of cells in each cluster across each sample is encoded in the matrix <bold>F</bold>. Here we describe a method for specifying a “differentiation score”, which is intended to be some quantitative measurement reflecting the frequency differences in some cell-population between groups that can be used in a qualitative way to gain intuition about important cell types and signaling pathways. Here, we discuss an example using a two-sided Wilcoxon Rank Sum test to quantify the extent of frequency differences between groups, with the caveat being that associated <italic>p</italic>-values are only being used to order cell-populations and not being interpreted in a classical statistical way. Further, a user is free to compute any statistic of choice to reflect the frequency difference of a particular population between two groups. We use simple univariate <italic>p</italic>-values to improve our understanding of which cell types have significant frequency differences between classes. For each of the <italic>P</italic> clusters the univariate <italic>p</italic>-values are computed using a Wilcoxon Rank Sum test<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. We let <inline-formula id="IEq9"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{{{a}}}^{{{p}}}$$\end{document}</tex-math><mml:math id="M18"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq9.gif"/></alternatives></inline-formula> be the vector of frequencies features for cluster <italic>p</italic> corresponding to samples in the “0” class. Similarly, we let <inline-formula id="IEq10"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{{{b}}}^{{{p}}}$$\end{document}</tex-math><mml:math id="M20"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq10.gif"/></alternatives></inline-formula> be the vector of frequencies for cluster <italic>p</italic> corresponding to samples in the “1” class. After defining these two vectors, the two-sided Wilcoxon Rank Sum test is used to test the null hypothesis that the means of <inline-formula id="IEq11"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{{{a}}}^{{{p}}}$$\end{document}</tex-math><mml:math id="M22"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq11.gif"/></alternatives></inline-formula> and <inline-formula id="IEq12"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{{{b}}}^{{{p}}}$$\end{document}</tex-math><mml:math id="M24"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq12.gif"/></alternatives></inline-formula> are equal. The more significant the <italic>p</italic>-value, the larger the difference in the frequency feature, <italic>p</italic>, between the two classes (“0” and “1”).</p>
      <p id="Par40">To gain insight into the true statistical significance of all features together, we recommend using a regression model and interpreting the <italic>p</italic>-value of the model fit to samples in the test set as a measure of the collective ability of features to differentiate between distinct clinical outcome classes. A statistically significant model <italic>p</italic>-value implies that some combination of features can be used to effectively partition samples from different classes.</p>
      <p id="Par41">After having computed the univariate <italic>p</italic>-value for each of the <italic>P</italic> metaclusters (or your statistic of choice), we seek to map this information onto our single cell visualization. In other words, points should be colored based on some aggregate representation of the <italic>p</italic>-values for each metacluster and a particular point’s likelihood of belonging to a particular metacluster. We quantify the similarity of a point with each cluster based on a function of the euclidean distance between the cluster’s center and the original point in high dimensions. We let <bold>c</bold><sub><italic>j</italic></sub> be the length-<italic>m</italic> vector encoding the expression for each of the <italic>m</italic> total functional and phenotypic markers in cluster <italic>j</italic>. We similarly let <bold>x</bold><sub>i</sub> be the length-<italic>m</italic> expression profile over the <italic>m</italic> functional and phenotypic markers for cell <italic>i</italic>. Then to define <italic>s</italic><sub>ji</sub> or the similarity between cluster <italic>j</italic> and cell <italic>i</italic>, we compute, <inline-formula id="IEq13"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${s}_{{{ji}}}=\exp (-\alpha | | {{\bf{c}}}_{{{j}}}-{{\bf{x}}}_{{{i}}}| {| }_{2})$$\end{document}</tex-math><mml:math id="M26"><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi>α</mml:mi><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mo>∣</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq13.gif"/></alternatives></inline-formula>. Here, <italic>α</italic> is a user-defined constant.</p>
      <p id="Par42">In each metaclustering iteration, <italic>m</italic>, we compute <italic>s</italic><sub><italic>ji</italic></sub> for each of the <inline-formula id="IEq14"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${K}_{{{m}}}^{\prime}$$\end{document}</tex-math><mml:math id="M28"><mml:msubsup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq14.gif"/></alternatives></inline-formula> clusters, <italic>j</italic> and each cell, <italic>i</italic>. We then assign cell <italic>i</italic> a differentiation score, defined by a linear combination of univariate <italic>p</italic>-values across clusters, computed as, <inline-formula id="IEq15"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${p}_{{{i}}}^{{{m}}}=\frac{{\sum }_{{{j}}}{s}_{{{ji}}}{w}_{{{j}}}}{{\sum }_{{{j}}}{s}_{{ji}}}$$\end{document}</tex-math><mml:math id="M30"><mml:msubsup><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq15.gif"/></alternatives></inline-formula>. Here, <italic>w</italic><sub>j</sub> is the <italic>p</italic>-value computed for the rank sum test for cluster <italic>j</italic>. In general, this quantity is a weighted average over all clusters in a particular metaclustering solution, with higher weight given to the <italic>p</italic>-values corresponding to cluster centers that are more similar to the point of interest. Ultimately, we compute <inline-formula id="IEq16"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${p}_{{{i}}}^{{{m}}}$$\end{document}</tex-math><mml:math id="M32"><mml:msubsup><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq16.gif"/></alternatives></inline-formula> for each <italic>m</italic> of the <italic>I</italic> total metaclustering solutions and determine the final <italic>p</italic>-value for cluster <italic>i</italic> as the average significance score over the <italic>I</italic> metaclustering solutions. Here we describe details for how differentiation scores were mapped onto cells in each dataset, demonstrating the flexibility of the visualization approach.</p>
      <p id="Par43">While our task in the HSR dataset was to classify patients who had received MP treatment from those who had not, we specifically focused on the difference between control and MP samples 6 h after surgery in the visualization. This implies that significance score (<italic>p</italic>-value) for each metacluster was computed based on only the control and MP samples at the 6 hr timepoint. That is, for a particular metacluster, <italic>p</italic>, we let <inline-formula id="IEq17"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{a}^{p}$$\end{document}</tex-math><mml:math id="M34"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq17.gif"/></alternatives></inline-formula> be the vector of frequencies for <italic>p</italic> corresponding to control samples at the 6 hour (6 h) timepoint. Similarly, we let <inline-formula id="IEq18"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{b}^{p}$$\end{document}</tex-math><mml:math id="M36"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq18.gif"/></alternatives></inline-formula> be the vector of frequencies of metacluster <italic>p</italic> for MP samples at the 6hr timepoint. Then the significance score for cluster <italic>p</italic> is the <italic>p</italic>-value of the Wilcoxon Rank Sum test. Moreover, the visualization in Fig. 2a. can be used to understand the differences in cell population (metacluster) frequencies between control and MP samples at the 6h timepoint. This example demonstrates that the visualization method is capable of taking a subset of sample IDs to compute the significance score of clusters and therefore differentiation scores.</p>
      <p id="Par44">The classification task introduced in the NTP dataset was to classify first from second trimester samples during human pregnancy. This is also the comparison reflected in the visualization in Fig. <xref rid="Fig2" ref-type="fig">2b</xref>. That is for metacluster <italic>p</italic> we let <inline-formula id="IEq19"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{a}^{p}$$\end{document}</tex-math><mml:math id="M38"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq19.gif"/></alternatives></inline-formula> be the vector of frequencies of metacluster <italic>p</italic> in samples from the first trimester. Similarly, <inline-formula id="IEq20"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{b}^{p}$$\end{document}</tex-math><mml:math id="M40"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq20.gif"/></alternatives></inline-formula> is the vector of cell frequencies of metacluster <italic>p</italic> among second trimester samples. The significance score for metacluster <italic>p</italic> is therefore the <italic>p</italic>-value of the Wilcoxon Rank Sum Test computed between <inline-formula id="IEq21"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{a}^{p}$$\end{document}</tex-math><mml:math id="M42"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq21.gif"/></alternatives></inline-formula> and <inline-formula id="IEq22"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{b}^{p}$$\end{document}</tex-math><mml:math id="M44"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq22.gif"/></alternatives></inline-formula>. These significance scores are then mapped to single cells to define differentiation scores.</p>
      <p id="Par45">In the LSR dataset, we classified patient samples collected 48 h from those collected 1 year after stroke. This is also the comparison reflected in the visualization in Fig. <xref rid="Fig2" ref-type="fig">2c</xref>. That is for metacluster <italic>p</italic> we let <inline-formula id="IEq23"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{a}^{p}$$\end{document}</tex-math><mml:math id="M46"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq23.gif"/></alternatives></inline-formula> be the vector of frequencies of metacluster <italic>p</italic> in samples from 48 h after stroke. Similarly, <inline-formula id="IEq24"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{b}^{p}$$\end{document}</tex-math><mml:math id="M48"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq24.gif"/></alternatives></inline-formula> is the vector of cell frequencies in metacluster <italic>p</italic> among samples collected. The significance score for metacluster <italic>p</italic> is therefore the <italic>p</italic>-value of the Wilcoxon Rank Sum Test computed between <inline-formula id="IEq25"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{a}^{p}$$\end{document}</tex-math><mml:math id="M50"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq25.gif"/></alternatives></inline-formula> and <inline-formula id="IEq26"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\bf{x}}}_{b}^{p}$$\end{document}</tex-math><mml:math id="M52"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2020_17569_Article_IEq26.gif"/></alternatives></inline-formula>. These significance scores are then mapped to single cells to define differentiation scores.</p>
    </sec>
    <sec id="Sec16">
      <title>Mass cytometry methods</title>
      <p id="Par46">Mass cytometry is a high-parameter single-cell analysis platform that enables the simultaneous interrogation of multiple signaling pathways in precisely phenotyped cell subsets spanning the entire immune system<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>. This technology provides unprecedented opportunities to describe the human immune system as a network of correlated, cell type-specific attributes, and to investigate the functional relationships between cells within and across hematopoietic lineages<sup><xref ref-type="bibr" rid="CR37">37</xref>,<xref ref-type="bibr" rid="CR38">38</xref></sup>. Mass cytometry combines inductively coupled plasma and time-of-flight spectrometry with cytometry<sup><xref ref-type="bibr" rid="CR19">19</xref></sup> and allows for the examination of up to 50 analytes simultaneously at the single cell level using metal-isotope-conjugated antibodies.</p>
    </sec>
    <sec id="Sec17">
      <title>Ex vivo whole-blood immuno-assay</title>
      <p id="Par47">Whole blood was collected from study subjects and processed within 60 min after blood draw. Individual aliquots were processed using a standardized protocol for fixing with proteomic stabilizer (SMART TUBE, Inc., San Carlos, CA) and stored at  −80 °C until further processing.</p>
    </sec>
    <sec id="Sec18">
      <title>Sample barcoding and minimization of batch effects</title>
      <p id="Par48">To minimize the effect of experimental variability on mass cytometry measurements between serially collected samples, samples corresponding to the entire time series collected from one participant were processed, barcoded, pooled, stained, and run simultaneously. To minimize the effect of variability between study participants, samples sets of patients matched for control and treatment (HSR dataset), or randomized for time of sampling (NTP and LSR datasets). Further, the run was completed within consecutive days, while carefully controlling for consistent tuning parameters of the mass cytometry instrument (Helios CyTOF, Fluidigm Inc., South San Francisco, CA).</p>
    </sec>
    <sec id="Sec19">
      <title>Antibody staining and mass cytometry</title>
      <p id="Par49">The mass cytometry antibody panel included surface and intracellular antibodies that are used for phenotyping of immune cell subsets and for the functional characterization of immune cell responses. In Supplementary Tables <xref rid="MOESM1" ref-type="media">1</xref>–<xref rid="MOESM1" ref-type="media">3</xref> we provide a list of antibodies used in the HSR, NTP, and LSR datasets, respectively. Antibodies were either obtained preconjugated (Fluidigm, Inc.) or were purchased as purified, carrierfree (no BSA, gelatin) versions, which were then conjugated in-house with trivalent metal isotopes utilizing the MaxPAR antibody conjugation kit (Fluidigm, Inc.). After incubation with Fc block (Biolegend), pooled barcoded cells were stained with surface antibodies, then permeabilized with methanol and stained with intracellular antibodies. All antibodies used in the analysis were titrated and validated on samples that were processed identically to the samples used in the respective study. Barcoded and antibody-stained cells were analyzed on the mass cytometer.</p>
    </sec>
    <sec id="Sec20">
      <title>Immune cell feature derivation</title>
      <p id="Par50">The mass cytometry data was normalized using Normalizer v0.1 MATLAB Compiler Runtime (MathWorks)<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>. Files were then debarcoded with a single-cell MATLAB debarcoding tool<sup><xref ref-type="bibr" rid="CR40">40</xref></sup>. Manual gating was performed using CellEngine (<ext-link ext-link-type="uri" xlink:href="https://immuneatlas.org/">https://immuneatlas.org/</ext-link>) (Primity Bio, Fremont, CA). In Supplementary Fig. <xref rid="MOESM1" ref-type="media">21</xref>, we show the gating strategy originally used for each of the clinical datasets. The names of cell populations in blue were gated across all three datasets. Conversely, cell populations colored orange and green represent populations that were only identified in the HSR or LSR datasets, respectively (see chart). For the VoPo pipeline, the data from each sample were analyzed using manually gated singlet live leukocytes (DNA<sup>+</sup>cPARP<sup>−</sup>CD235<sup>−</sup>CD61<sup>−</sup>). FACS gating strategies have been linked, in the Supplementary Figure legend, to the corresponding data panels in the manuscript.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec21">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2020_17569_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2020_17569_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Peer review information</bold><italic>Nature Communications</italic> thanks Ahmed Mahfouz and the other, anonymous, reviewer(s) for their contribution to the peer review of this work.</p>
    </fn>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Natalie Stanley, Ina A. Stelzer.</p>
    </fn>
    <fn>
      <p>These authors jointly supervised this work: Martin S. Angst, Brice Gaudilliere, Nima Aghaeepour.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p><bold>Supplementary information</bold> is available for this paper at 10.1038/s41467-020-17569-8.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was supported by the March of Dimes Prematurity Research Center at Stanford and the Bill and Melinda Gates Foundation (OPP1112382 and OPP1113682). Additional funding was provided by the Department of Anesthesiology, Perioperative and Pain Medicine at Stanford University. N.A. was supported by Burroughs Wellcome Fund, National Institute of Health (KL2TR003143), and by U.S. FDA (contract No. HHSF223201610018C). N.S. was supported by Stanford Immunology Training Grant (5T32AI07290-33) and the Stanford Anesthesia Training Grant (T32GM089626). I.A.S. was supported by the German Research Foundation (DFG, STE 2757/1-1). B.G. was supported by the National Institute of Health (K23GM111657), and the Doris Duke Charitable Foundation. D.G. is supported by the National Institute of Health (R21DE02772801). Additional support was provided by Stanford Maternal and Child Health Research Institute to D.K.S., R.J.W., B.G., N.A., M.S.A., L.P., and X.H., the Charles and Mary Robertson Foundation to B.G., N.A., and D.K.S., the American Heart Association (19PABHI34580007) to N.A. and B.G., and by the National Institute of Health (R01AG058417 R01HL13984401, and R61NS114926) to B.G., M.S.A., and N.A.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>N.S., I.A.S., M.S.A., B.G., and N.A. conceived the study, designed all experiments, and visualized and interpreted the results. The VoPo algorithm was developed by N.S. and N.A. with input and code provided by R.F., M.B., T.P., H.N., S.G., I.M., A.C., C.E., A.L.C., and M.X. Mass cytometry data were provided by and the corresponding VoPo results were interpreted by A.S.T., E.G., X.H., K.R., L.P., F.V., D.G., E.T., D.F., K.A., J.E., R.J.W., D.K.S., G.O., and G.M.S. N.S., I.A.S., B.G., M.S.A., and N.A. wrote and revised the manuscript with input from all authors.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All datasets used are publicly available through flowrepository under experiment IDs <ext-link ext-link-type="uri" xlink:href="https://flowrepository.org/id/FR-FCM-ZY3Q">FR-FCM-ZY3Q</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://flowrepository.org/id/FR-FCM-ZY3R">FR-FCM-ZY3R</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://flowrepository.org/id/FR-FCM-Z2AT">FR-FCM-Z2AT</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://flowrepository.org/id/FR-FCM-ZYSB">FR-FCM-ZYSB</ext-link> for the NTP training, NTP validation, HSR, and LSR datasets, respectively.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>VoPo was implemented and tested with R version 3.4.4. Code to run all components of VoPo, as well as to reproduce results is provided at <ext-link ext-link-type="uri" xlink:href="https://github.com/stanleyn/VoPo">https://github.com/stanleyn/VoPo</ext-link>.</p>
  </notes>
  <notes id="FPar1" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par51">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Amodio</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Exploring single-cell data with deep multitasking neural networks</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1139</fpage>
        <lpage>1145</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0576-7</pub-id>
        <pub-id pub-id-type="pmid">31591579</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qiu</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Extracting a cellular hierarchy from high-dimensional cytometry data with spade</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2011</year>
        <volume>29</volume>
        <fpage>886</fpage>
        <pub-id pub-id-type="doi">10.1038/nbt.1991</pub-id>
        <pub-id pub-id-type="pmid">21964415</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bruggner</surname>
            <given-names>RV</given-names>
          </name>
          <name>
            <surname>Bodenmiller</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Dill</surname>
            <given-names>DL</given-names>
          </name>
          <name>
            <surname>Tibshirani</surname>
            <given-names>RJ</given-names>
          </name>
          <name>
            <surname>Nolan</surname>
            <given-names>GP</given-names>
          </name>
        </person-group>
        <article-title>Automated identification of stratifying signatures in cellular subpopulations</article-title>
        <source>Proc. Natl Acad. Sci.</source>
        <year>2014</year>
        <volume>111</volume>
        <fpage>E2770</fpage>
        <lpage>E2777</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1408792111</pub-id>
        <pub-id pub-id-type="pmid">24979804</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Van Gassen</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Flowsom: using self-organizing maps for visualization and interpretation of cytometry data</article-title>
        <source>Cytom. Part A</source>
        <year>2015</year>
        <volume>87</volume>
        <fpage>636</fpage>
        <lpage>645</lpage>
        <pub-id pub-id-type="doi">10.1002/cyto.a.22625</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Levine</surname>
            <given-names>JH</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Data-driven phenotypic dissection of aml reveals progenitor-like cells that correlate with prognosis</article-title>
        <source>Cell</source>
        <year>2015</year>
        <volume>162</volume>
        <fpage>184</fpage>
        <lpage>197</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2015.05.047</pub-id>
        <pub-id pub-id-type="pmid">26095251</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Weber</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Nowicka</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Soneson</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Robinson</surname>
            <given-names>MD</given-names>
          </name>
        </person-group>
        <article-title>diffcyt: differential discovery in high-dimensional cytometry via high-resolution clustering</article-title>
        <source>Commun. Biol.</source>
        <year>2019</year>
        <volume>2</volume>
        <fpage>183</fpage>
        <pub-id pub-id-type="doi">10.1038/s42003-019-0415-5</pub-id>
        <pub-id pub-id-type="pmid">31098416</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>H-C</given-names>
          </name>
          <name>
            <surname>Kosoy</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Becker</surname>
            <given-names>CE</given-names>
          </name>
          <name>
            <surname>Dudley</surname>
            <given-names>JT</given-names>
          </name>
          <name>
            <surname>Kidd</surname>
            <given-names>BA</given-names>
          </name>
        </person-group>
        <article-title>Automated cell type discovery and classification through knowledge transfer</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <fpage>1689</fpage>
        <lpage>1695</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btx054</pub-id>
        <pub-id pub-id-type="pmid">28158442</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gating mass cytometry data by deep learning</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <fpage>3423</fpage>
        <lpage>3430</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btx448</pub-id>
        <pub-id pub-id-type="pmid">29036374</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Arvaniti</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Claassen</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Sensitive detection of rare disease-associated cell subsets via representation learning</article-title>
        <source>Nat. Commun.</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>14825</fpage>
        <pub-id pub-id-type="doi">10.1038/ncomms14825</pub-id>
        <pub-id pub-id-type="pmid">28382969</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Glicksberg</surname>
            <given-names>BS</given-names>
          </name>
          <name>
            <surname>Butte</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <article-title>Robust prediction of clinical outcomes using cytometry data</article-title>
        <source>Bioinformatics</source>
        <year>2018</year>
        <volume>35</volume>
        <fpage>1197</fpage>
        <lpage>1203</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty768</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lun</surname>
            <given-names>AT</given-names>
          </name>
          <name>
            <surname>Richard</surname>
            <given-names>AC</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Testing for differential abundance in mass cytometry data</article-title>
        <source>Nat. Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>707</fpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4295</pub-id>
        <pub-id pub-id-type="pmid">28504682</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qiu</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Toward deterministic and semiautomated spade analysis</article-title>
        <source>Cytom. Part A</source>
        <year>2017</year>
        <volume>91</volume>
        <fpage>281</fpage>
        <lpage>289</lpage>
        <pub-id pub-id-type="doi">10.1002/cyto.a.23068</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Papoutsoglou</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Challenges in the multivariate analysis of mass cytometry data: the effect of randomization</article-title>
        <source>Cytom. Part A</source>
        <year>2019</year>
        <volume>95</volume>
        <fpage>1178</fpage>
        <lpage>1190</lpage>
        <pub-id pub-id-type="doi">10.1002/cyto.a.23908</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>GALTON</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Vox populi</article-title>
        <source>Nature</source>
        <year>1907</year>
        <volume>75</volume>
        <fpage>450</fpage>
        <lpage>451</lpage>
        <pub-id pub-id-type="doi">10.1038/075450a0</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Weber</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Robinson</surname>
            <given-names>MD</given-names>
          </name>
        </person-group>
        <article-title>Comparison of clustering methods for high-dimensional single-cell flow and mass cytometry data</article-title>
        <source>Cytom. Part A</source>
        <year>2016</year>
        <volume>89</volume>
        <fpage>1084</fpage>
        <lpage>1096</lpage>
        <pub-id pub-id-type="doi">10.1002/cyto.a.23030</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aghaeepour</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>An immune clock of human pregnancy</article-title>
        <source>Sci. Immunol.</source>
        <year>2017</year>
        <volume>2</volume>
        <fpage>eaan2946</fpage>
        <pub-id pub-id-type="doi">10.1126/sciimmunol.aan2946</pub-id>
        <pub-id pub-id-type="pmid">28864494</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tsai</surname>
            <given-names>AS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A year-long immune profile of the systemic response in acute stroke survivors</article-title>
        <source>Brain</source>
        <year>2019</year>
        <volume>142</volume>
        <fpage>978</fpage>
        <lpage>991</lpage>
        <pub-id pub-id-type="doi">10.1093/brain/awz022</pub-id>
        <pub-id pub-id-type="pmid">30860258</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <mixed-citation publication-type="other">He, X., Cai, D. &amp; Niyogi, P. Laplacian score for feature selection. in <italic>Advances in Neural Information Processing Systems</italic>, NIPS 18, Vancouver, British Columbia, Canada (2006).</mixed-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bendall</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Nolan</surname>
            <given-names>GP</given-names>
          </name>
          <name>
            <surname>Roederer</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Chattopadhyay</surname>
            <given-names>PK</given-names>
          </name>
        </person-group>
        <article-title>A deep profiler’s guide to cytometry</article-title>
        <source>Trends Immunol.</source>
        <year>2012</year>
        <volume>33</volume>
        <fpage>323</fpage>
        <lpage>332</lpage>
        <pub-id pub-id-type="doi">10.1016/j.it.2012.02.010</pub-id>
        <pub-id pub-id-type="pmid">22476049</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Polikowsky, H. G. et al. Systems immune monitoring with mass cytometry characterizes altered peripheral immune cell environments in patients with chronic graft versus host disease. <italic>Blood</italic><bold>128</bold>, 4572–4572 (2016).</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>O’Gorman</surname>
            <given-names>WE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mass cytometry identifies a distinct monocyte cytokine signature shared by clinically heterogeneous pediatric SLE patients</article-title>
        <source>J. Autoimmun.</source>
        <year>2017</year>
        <volume>81</volume>
        <fpage>74</fpage>
        <lpage>89</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jaut.2017.03.010</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Newell</surname>
            <given-names>EW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Combinatorial tetramer staining and mass cytometry analysis facilitate t-cell epitope mapping and characterization</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2013</year>
        <volume>31</volume>
        <fpage>623</fpage>
        <pub-id pub-id-type="doi">10.1038/nbt.2593</pub-id>
        <pub-id pub-id-type="pmid">23748502</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Good</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Proliferation tracing with single-cell mass cytometry optimizes generation of stem cell memory-like t cells</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>259</fpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0033-2</pub-id>
        <pub-id pub-id-type="pmid">30742126</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">Ganio, E. et al. Preferential inhibition of adaptive immune system dynamics by glucocorticoids in patients after acute surgical trauma. <italic>Nat. Commun.</italic>10.1038/s41467-020-17565-y (2020).</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Maaten</surname>
            <given-names>Lvd</given-names>
          </name>
          <name>
            <surname>Hinton</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Visualizing data using t-sne</article-title>
        <source>J. Mach. Learn. Res.</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>2579</fpage>
        <lpage>2605</lpage>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Auphan</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>DiDonato</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Rosette</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Helmberg</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Karin</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Immunosuppression by glucocorticoids: inhibition of nf-<italic>κ</italic>b activity through induction of i<italic>κ</italic>b synthesis</article-title>
        <source>Science</source>
        <year>1995</year>
        <volume>270</volume>
        <fpage>286</fpage>
        <lpage>290</lpage>
        <pub-id pub-id-type="doi">10.1126/science.270.5234.286</pub-id>
        <pub-id pub-id-type="pmid">7569976</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kraus</surname>
            <given-names>TA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Characterizing the pregnancy immune phenotype: results of the viral immunity and pregnancy (vip) study</article-title>
        <source>J. Clin. Immunol.</source>
        <year>2012</year>
        <volume>32</volume>
        <fpage>300</fpage>
        <lpage>311</lpage>
        <pub-id pub-id-type="doi">10.1007/s10875-011-9627-2</pub-id>
        <pub-id pub-id-type="pmid">22198680</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luppi</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Monocytes are progressively activated in the circulation of pregnant women</article-title>
        <source>J. Leukoc. Biol.</source>
        <year>2002</year>
        <volume>72</volume>
        <fpage>874</fpage>
        <lpage>884</lpage>
        <?supplied-pmid 12429709?>
        <pub-id pub-id-type="pmid">12429709</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Naccasha</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Phenotypic and metabolic characteristics of monocytes and granulocytes in normal pregnancy and maternal infection</article-title>
        <source>Am. J. Obstet. Gynecol.</source>
        <year>2001</year>
        <volume>185</volume>
        <fpage>1118</fpage>
        <lpage>1123</lpage>
        <pub-id pub-id-type="doi">10.1067/mob.2001.117682</pub-id>
        <pub-id pub-id-type="pmid">11717644</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <mixed-citation publication-type="other">Wang, Y., Zhang, J. H., Sheng, J. &amp; Shao, A. Immunoreactive cells after cerebral ischemia. <italic>Front. Immunol.</italic><bold>10</bold>, 2781 (2019).</mixed-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Ai</surname>
            <given-names>Q-D</given-names>
          </name>
          <name>
            <surname>Chu</surname>
            <given-names>S-F</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>N-H</given-names>
          </name>
        </person-group>
        <article-title>Nk cells in cerebral ischemia</article-title>
        <source>Biomed. Pharmacother.</source>
        <year>2019</year>
        <volume>109</volume>
        <fpage>547</fpage>
        <lpage>554</lpage>
        <pub-id pub-id-type="doi">10.1016/j.biopha.2018.10.103</pub-id>
        <pub-id pub-id-type="pmid">30399590</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ghaemi</surname>
            <given-names>MS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiomics modeling of the immunome, transcriptome, microbiome, proteome and metabolome adaptations during human pregnancy</article-title>
        <source>Bioinformatics</source>
        <year>2018</year>
        <volume>35</volume>
        <fpage>95</fpage>
        <lpage>103</lpage>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Malek</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>flowdensity: reproducing manual gating of flow cytometry data by automated density-based cell population identification</article-title>
        <source>Bioinformatics</source>
        <year>2015</year>
        <volume>31</volume>
        <fpage>606</fpage>
        <lpage>607</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btu677</pub-id>
        <pub-id pub-id-type="pmid">25378466</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mohar</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Alavi</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Chartrand</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Oellermann</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>The laplacian spectrum of graphs</article-title>
        <source>Graph Theory Comb. Appl.</source>
        <year>1991</year>
        <volume>2</volume>
        <fpage>12</fpage>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wilcoxon</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Katti</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wilcox</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <article-title>Critical values and probability levels for the wilcoxon rank sum test and the wilcoxon signed rank test</article-title>
        <source>Sel. Tables Math. Stat.</source>
        <year>1970</year>
        <volume>1</volume>
        <fpage>171</fpage>
        <lpage>259</lpage>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bendall</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Nolan</surname>
            <given-names>GP</given-names>
          </name>
        </person-group>
        <article-title>From single cells to deep phenotypes in cancer</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2012</year>
        <volume>30</volume>
        <fpage>639</fpage>
        <pub-id pub-id-type="doi">10.1038/nbt.2283</pub-id>
        <pub-id pub-id-type="pmid">22781693</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gaudillière</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Implementing mass cytometry at the bedside to study the immunological basis of human diseases: distinctive immune features in patients with a history of term or preterm birth</article-title>
        <source>Cytom. Part A</source>
        <year>2015</year>
        <volume>87</volume>
        <fpage>817</fpage>
        <lpage>829</lpage>
        <pub-id pub-id-type="doi">10.1002/cyto.a.22720</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spitzer</surname>
            <given-names>MH</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Systemic immunity is required for effective cancer immunotherapy</article-title>
        <source>Cell</source>
        <year>2017</year>
        <volume>168</volume>
        <fpage>487</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2016.12.022</pub-id>
        <pub-id pub-id-type="pmid">28111070</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Finck</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Normalization of mass cytometry data with bead standards</article-title>
        <source>Cytom. Part A</source>
        <year>2013</year>
        <volume>83</volume>
        <fpage>483</fpage>
        <lpage>494</lpage>
        <pub-id pub-id-type="doi">10.1002/cyto.a.22271</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zunder</surname>
            <given-names>ER</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Palladium-based mass tag cell barcoding with a doublet-filtering scheme and single-cell deconvolution algorithm</article-title>
        <source>Nat. Protoc.</source>
        <year>2015</year>
        <volume>10</volume>
        <fpage>316</fpage>
        <pub-id pub-id-type="doi">10.1038/nprot.2015.020</pub-id>
        <pub-id pub-id-type="pmid">25612231</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
