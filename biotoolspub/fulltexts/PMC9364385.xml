<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9364385</article-id>
    <article-id pub-id-type="pmid">35771653</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btac433</article-id>
    <article-id pub-id-type="publisher-id">btac433</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Phylogenetics</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Mirage 2.0: fast and memory-efficient reconstruction of gene-content evolution considering heterogeneous evolutionary patterns among gene families</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-4442-6049</contrib-id>
        <name>
          <surname>Fukunaga</surname>
          <given-names>Tsukasa</given-names>
        </name>
        <xref rid="btac433-cor1" ref-type="corresp"/>
        <aff><institution>Waseda Institute for Advanced Study, Waseda University</institution>, Tokyo 1690051, <country country="JP">Japan</country></aff>
        <!--fukunaga@aoni.waseda.jp-->
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-9169-9245</contrib-id>
        <name>
          <surname>Iwasaki</surname>
          <given-names>Wataru</given-names>
        </name>
        <aff><institution>Department of Integrated Biosciences, Graduate School of Frontier Sciences, The University of Tokyo</institution>, Chiba 2770882, <country country="JP">Japan</country></aff>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Schwartz</surname>
          <given-names>Russell</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btac433-cor1">To whom correspondence should be addressed. <email>fukunaga@aoni.waseda.jp</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>15</day>
      <month>8</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2022-06-30">
      <day>30</day>
      <month>6</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>30</day>
      <month>6</month>
      <year>2022</year>
    </pub-date>
    <volume>38</volume>
    <issue>16</issue>
    <fpage>4039</fpage>
    <lpage>4041</lpage>
    <history>
      <date date-type="received">
        <day>04</day>
        <month>4</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>21</day>
        <month>6</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>23</day>
        <month>6</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>28</day>
        <month>6</month>
        <year>2022</year>
      </date>
      <date date-type="corrected-typeset">
        <day>09</day>
        <month>7</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btac433.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>We present Mirage 2.0, which accurately estimates gene-content evolutionary history by considering heterogeneous evolutionary patterns among gene families. Notably, we introduce a deterministic pattern mixture model, which makes Mirage substantially faster and more memory-efficient to be applicable to large datasets with thousands of genomes.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p>The source code is freely available at <ext-link xlink:href="https://github.com/fukunagatsu/Mirage" ext-link-type="uri">https://github.com/fukunagatsu/Mirage</ext-link>.</p>
      </sec>
      <sec id="s4">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Japan Society for the Promotion of Science</institution>
            <institution-id institution-id-type="DOI">10.13039/501100001691</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>JP19K20395</award-id>
        <award-id>JP20H05582</award-id>
        <award-id>JP22H04891</award-id>
        <award-id>JP22H04925</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Japan Science and Technology Agency</institution>
            <institution-id institution-id-type="DOI">10.13039/501100002241</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>JPMJCR19S2</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Computational reconstruction of gene-content evolutionary history is a fundamental approach to elucidate the evolution of genomes and biological systems and to estimate functions of function-unknown genes (<xref rid="btac433-B4" ref-type="bibr">Fukunaga and Iwasaki, 2022</xref>). An essential factor in mathematically modeling gene-content evolution is substantial differences among evolutionary patterns of different gene families (<xref rid="btac433-B8" ref-type="bibr">Mendes <italic toggle="yes">et al.</italic>, 2021</xref>). For example, immune-related genes are much more likely to be lost from a mammal genome than housekeeping genes (<xref rid="btac433-B2" ref-type="bibr">Demuth <italic toggle="yes">et al.</italic>, 2006</xref>).</p>
    <p>We previously developed Mirage, which reconstructs gene-content evolutionary history with a pattern mixture (PM) model that considers heterogeneous evolutionary patterns among gene families (<xref rid="btac433-B3" ref-type="bibr">Fukunaga and Iwasaki, 2021</xref>). In this previous study, gene families were probabilistically classified into multiple clusters, each of which follows a specific evolutionary pattern. Although this model [a probabilistic PM (PPM) model] showed high accuracy and fitted empirical data well, it required significant computational time and memory to be readily applicable to datasets with &gt;1000 genomes. Here, we propose a deterministic PM (DPM) model, which is implemented into Mirage 2.0. The DPM model is as accurate as the PPM model, but much faster and more memory-efficient to be applicable to large datasets with ∼3000 genomes and &gt;150 000 OGs in a few days.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>Given <italic toggle="yes">N</italic> genomes, assume that <italic toggle="yes">M</italic> gene families and a phylogenetic tree <italic toggle="yes">T</italic> are calculated. In the PM model, <italic toggle="yes">M</italic> gene families are classified into <italic toggle="yes">K</italic> clusters, where <italic toggle="yes">K</italic> is a user-specified parameter. Different clusters follow different evolutionary patterns that are represented by cluster-specific transition rate matrices.</p>
    <p>Mirage first estimates model parameters using the EM algorithm. The model parameters consist of the cluster-specific transition rate matrices, mixture probabilities of every cluster and cluster-specific copy-number distributions at the root node. Then, Mirage infers gene-content evolutionary history by a Viterbi-like algorithm using the estimated parameters.</p>
    <p>The EM algorithm consists of four steps. Step 1: The model parameters are randomly initialized. Step 2: Responsibilities and sufficient statistics of the phylogenetic tree model are calculated based on the model parameters, where a responsibility is defined as a probability of assigning each gene family to each cluster. In this model, the sufficient statistics are expected duration of each copy number and expected numbers of copy number changes across the tree (<xref rid="btac433-B5" ref-type="bibr">Kiryu, 2011</xref>). Step 3: The model parameters are estimated and updated by assuming those responsibilities and sufficient statistics. Step 4: Steps 2 and 3 are repeated until the log-likelihood given by the estimated parameters converges. In Step 2, the inside algorithm, responsibility calculation, outside algorithm and sufficient statistics calculation are conducted in this order. The inside and outside algorithms calculate the inside and outside values for each combination of nodes in the phylogenetic tree, clusters and gene families. For each node and gene family, the inside value is defined as the probability of the descendant nodes given the state of the node and the estimated parameters. The outside value is defined as the joint probability of the non-descendant nodes and the state of the node given the estimated parameters. Responsibilities are calculated based on the inside values of the root node, and sufficient statistics are calculated based on both the inside and outside values.</p>
    <p>In the PPM model, the responsibilities take real numbers between 0 and 1, i.e. each gene family can be assigned to all clusters with non-zero positive probabilistic weights even if the weights are very small. This resulted in unnecessarily large computational cost in Step 2 of the EM algorithm. In the DPM model, the responsibilities take 1 for one cluster and 0 for the others. Specifically, after the calculation of the responsibilities, the responsibility of a cluster with the largest responsibility and those of the other clusters are set to 1 and 0, respectively, for each gene family. Calculation of outside values and sufficient statistics is skipped if responsibilities are 0, substantially reducing computation time and memory in the outside algorithm and sufficient statistics calculation in Step 2 of the EM algorithm. We note that the DPM model is similar to partitioning methods in molecular evolution (<xref rid="btac433-B6" ref-type="bibr">Lanfear <italic toggle="yes">et al.</italic>, 2017</xref>) and a classification EM algorithm in machine learning (<xref rid="btac433-B1" ref-type="bibr">Celeux and Govaert, 1992</xref>).</p>
    <p>Another major update in Mirage 2.0 is in the calculation method of sufficient statistics. The previous version calculated integrals of matrix exponential by an eigen decomposition method, which cannot be applied to non-diagonalizable matrices and can result in unstable learning. Mirage 2.0 uses the auxiliary matrix method, which does not have this drawback (<xref rid="btac433-B7" ref-type="bibr">Liu <italic toggle="yes">et al.</italic>, 2015</xref>).</p>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>We evaluated Mirage based on the PPM and DPM models using three previously constructed empirical datasets (<xref rid="btac433-B3" ref-type="bibr">Fukunaga and Iwasaki, 2021</xref>). The fungi, archaea and micrococcales datasets contained 123 genomes and 34 454 OGs, 151 genomes and 11 650 OGs and 111 genomes and 9523 OGs, respectively.</p>
    <p>Performance of gene-content evolutionary history estimation was evaluated for each dataset by log-likelihood values. Hold-out validation experiments were performed by splitting the OGs into training and test datasets at a 4:1 ratio. The model parameters were estimated using the training dataset 100 times and the best parameters were chosen. Log-likelihood was calculated by applying the best parameters to the test dataset. The PPM and DPM models showed comparable log-likelihood values in all datasets (<xref rid="btac433-F1" ref-type="fig">Fig. 1A</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1A</xref> and <xref rid="sup1" ref-type="supplementary-material">B</xref>).</p>
    <fig position="float" id="btac433-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>Mirage with the PPM and DPM models on 123 fungal genomes. Results by the PPM and DPM models are represented by red and blue lines, respectively. Black dashed lines represent their ratios. (<bold>A</bold>) Log-likelihood values in hold-out validation experiments. (<bold>B</bold>) Computational time. (<bold>C</bold>) Required memory size (A color version of this figure appears in the online version of this article.)</p>
      </caption>
      <graphic xlink:href="btac433f1" position="float"/>
    </fig>
    <p>Computational time and memory required for 10 EM steps were measured on Intel Xeon Gold 6130 2.1 GHz CPU with 4 GB memory, and average values of 100 measurements were compared for each dataset (<xref rid="btac433-F1" ref-type="fig">Fig. 1B and C</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1C–F</xref>). While the required time and memory almost linearly increased with <italic toggle="yes">K</italic> in the PPM model, they were almost independent of <italic toggle="yes">K</italic> in the DPM model. Therefore, in terms of speed and memory, the DPM model becomes substantially more efficient when <italic toggle="yes">K</italic> &gt; 5. It would be notable that it is quite common to classify OGs into such numbers of clusters (e.g. COGs have &gt;20 categories).</p>
    <p>Numbers of EM-step iterations were also compared by setting <italic toggle="yes">K</italic> = 5, because more iterations would result in slower convergence. For each measurement using each dataset, the PPM and DPM models were run with the same seed values for randomization. Based on 100 measurements, we confirmed that the DPM model has significantly smaller numbers of EM-step iterations than the PPM model (Wilcoxson signed-rank test, <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S2 and S3</xref>). Somewhat interestingly, we did not find correlations between the iteration numbers by the PPM and DPM models with the seed values.</p>
    <p>Finally, to demonstrate that the DPM model is now applicable to a large dataset with reasonable computational resources, we reconstructed the gene-content evolutionary history of the whole bacterial domain with <italic toggle="yes">K</italic> = 10. The computation was conducted on Intel Xeon Gold 6154 4.0 GHz CPU with 128 GB memory. Pre-processing OGs from STRING database version 11.5 (<xref rid="btac433-B10" ref-type="bibr">Szklarczyk <italic toggle="yes">et al.</italic>, 2021</xref>) and a phylogenetic tree from GTDB release 202 (<xref rid="btac433-B9" ref-type="bibr">Parks <italic toggle="yes">et al.</italic>, 2022</xref>) as previously described (<xref rid="btac433-B3" ref-type="bibr">Fukunaga and Iwasaki, 2021</xref>) produced 2 848 genomes and 169 170 OGs. With this data, while the PPM model was not able to run due to insufficient memory, the DPM model successfully reconstructed its whole gene-content evolutionary history with 42.94 h and only 37.9 GB memory (average of 100 runs).</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btac433_Supplementary_Data</label>
      <media xlink:href="btac433_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>Computations were partially performed on the NIG supercomputer at ROIS National Institute of Genetics and the SHIROKANE supercomputer at Human Genome Center, The Institute of Medical Science, The University of Tokyo.</p>
    <sec>
      <title>Funding</title>
      <p>This work was supported by the Japan Society for the Promotion of Science [JP19K20395, JP20H05582 and JP22H04891 to T.F. and JP22H04925 to W.I.] and Japan Science and Technology Agency [JPMJCR19S2 to W.I.].</p>
      <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btac433-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Celeux</surname><given-names>G.</given-names></string-name>, <string-name><surname>Govaert</surname><given-names>G.</given-names></string-name></person-group> (<year>1992</year>) <article-title>A classification EM algorithm for clustering and two stochastic versions</article-title>. <source>Comput. Stat. Data Anal</source>., <volume>14</volume>, <fpage>315</fpage>–<lpage>332</lpage>.</mixed-citation>
    </ref>
    <ref id="btac433-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Demuth</surname><given-names>J.P.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2006</year>) <article-title>The evolution of mammalian gene families</article-title>. <source>PLoS One</source>, <volume>1</volume>, <fpage>e85</fpage>.<pub-id pub-id-type="pmid">17183716</pub-id></mixed-citation>
    </ref>
    <ref id="btac433-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Fukunaga</surname><given-names>T.</given-names></string-name>, <string-name><surname>Iwasaki</surname><given-names>W.</given-names></string-name></person-group> (<year>2021</year>) <article-title>Mirage: estimation of ancestral gene-copy numbers by considering different evolutionary patterns among gene families</article-title>. <source>Bioinform. Adv</source>., <volume>1</volume>, <fpage>vbab014</fpage>.<pub-id pub-id-type="pmid">36700099</pub-id></mixed-citation>
    </ref>
    <ref id="btac433-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Fukunaga</surname><given-names>T.</given-names></string-name>, <string-name><surname>Iwasaki</surname><given-names>W.</given-names></string-name></person-group> (<year>2022</year>) <article-title>Inverse Potts model improves accuracy of phylogenetic profiling</article-title>. <source>Bioinformatics</source>, <volume>38</volume>, <fpage>1794</fpage>–<lpage>1800</lpage>.<pub-id pub-id-type="pmid">35060594</pub-id></mixed-citation>
    </ref>
    <ref id="btac433-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kiryu</surname><given-names>H.</given-names></string-name></person-group> (<year>2011</year>) <article-title>Sufficient statistics and expectation maximization algorithms in phylogenetic tree models</article-title>. <source>Bioinformatics</source>, <volume>27</volume>, <fpage>2346</fpage>–<lpage>2353</lpage>.<pub-id pub-id-type="pmid">21757463</pub-id></mixed-citation>
    </ref>
    <ref id="btac433-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lanfear</surname><given-names>R.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>PartitionFinder 2: new methods for selecting partitioned models of evolution for molecular and morphological phylogenetic analyses</article-title>. <source>Mol. Biol. Evol</source>., <volume>34</volume>, <fpage>772</fpage>–<lpage>773</lpage>.<pub-id pub-id-type="pmid">28013191</pub-id></mixed-citation>
    </ref>
    <ref id="btac433-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Liu</surname><given-names>Y.-Y.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>Efficient learning of continuous-time hidden Markov models for disease progression</article-title>. <source>Adv. Neural Inf. Process. Syst</source>., <volume>28</volume>, <fpage>3599</fpage>–<lpage>3607</lpage>.<pub-id pub-id-type="pmid">27019571</pub-id></mixed-citation>
    </ref>
    <ref id="btac433-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mendes</surname><given-names>F.K.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2021</year>) <article-title>CAFE 5 models variation in evolutionary rates among gene families</article-title>. <source>Bioinformatics</source>, <volume>36</volume>, <fpage>5516</fpage>–<lpage>5518</lpage>.<pub-id pub-id-type="pmid">33325502</pub-id></mixed-citation>
    </ref>
    <ref id="btac433-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Parks</surname><given-names>D.H.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2022</year>) <article-title>GTDB: an ongoing census of bacterial and archaeal diversity through a phylogenetically consistent, rank normalized and complete genome-based taxonomy</article-title>. <source>Nucleic Acids Res</source>., <volume>50</volume>, <fpage>D785</fpage>–<lpage>D794</lpage>.<pub-id pub-id-type="pmid">34520557</pub-id></mixed-citation>
    </ref>
    <ref id="btac433-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Szklarczyk</surname><given-names>D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2021</year>) <article-title>The STRING database in 2021: customizable protein-protein networks, and functional characterization of user-uploaded gene/measurement sets</article-title>. <source>Nucleic Acids Res</source>., <volume>49</volume>, <fpage>D605</fpage>–<lpage>D612</lpage>.<pub-id pub-id-type="pmid">33237311</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
