<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7590740</article-id>
    <article-id pub-id-type="publisher-id">3795</article-id>
    <article-id pub-id-type="doi">10.1186/s12859-020-03795-w</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methodology Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>optimalFlow: optimal transport approach to flow cytometry gating and population matching</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>del Barrio</surname>
          <given-names>Eustasio</given-names>
        </name>
        <address>
          <email>tasio@eio.uva.es</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-3662-518X</contrib-id>
        <name>
          <surname>Inouzhe</surname>
          <given-names>Hristo</given-names>
        </name>
        <address>
          <email>hristo.inouzhe@gmail.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Loubes</surname>
          <given-names>Jean-Michel</given-names>
        </name>
        <address>
          <email>loubes@math.univ-toulouse.fr</email>
        </address>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Matrán</surname>
          <given-names>Carlos</given-names>
        </name>
        <address>
          <email>carlos.matran@uva.es</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Mayo-Íscar</surname>
          <given-names>Agustín</given-names>
        </name>
        <address>
          <email>agustin@med.uva.es</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.5239.d</institution-id><institution-id institution-id-type="ISNI">0000 0001 2286 5329</institution-id><institution>Departamento de Estadística e Investigación Operativa, </institution><institution>Universidad de Valladolid, </institution></institution-wrap>Calle Paseo de Belén, Valladolid, Spain </aff>
      <aff id="Aff2"><label>2</label>IMUVA, Calle Paseo de Belén, Valladolid, Spain </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.15781.3a</institution-id><institution-id institution-id-type="ISNI">0000 0001 0723 035X</institution-id><institution>Université Paul Sabatier, </institution></institution-wrap>Route de Narbonne, Toulouse, France </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.462146.3</institution-id><institution-id institution-id-type="ISNI">0000 0004 0383 6348</institution-id><institution>IMT, </institution></institution-wrap>Route de Narbonne, Toulouse, France </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>10</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>10</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2020</year>
    </pub-date>
    <volume>21</volume>
    <elocation-id>479</elocation-id>
    <history>
      <date date-type="received">
        <day>5</day>
        <month>4</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>1</day>
        <month>10</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2020</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">Data obtained from flow cytometry present pronounced variability due to biological and technical reasons. Biological variability is a well-known phenomenon produced by measurements on different individuals, with different characteristics such as illness, age, sex, etc. The use of different settings for measurement, the variation of the conditions during experiments and the different types of flow cytometers are some of the technical causes of variability. This mixture of sources of variability makes the use of supervised machine learning for identification of cell populations difficult. The present work is conceived as a combination of strategies to facilitate the task of supervised gating.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">We propose <italic>optimalFlowTemplates</italic>, based on a <italic>similarity distance</italic> and <italic>Wasserstein barycenters</italic>, which clusters cytometries and produces prototype cytometries for the different groups. We show that supervised learning, restricted to the new groups, performs better than the same techniques applied to the whole collection. We also present <italic>optimalFlowClassification</italic>, which uses a database of gated cytometries and optimalFlowTemplates to assign cell types to a new cytometry. We show that this procedure can outperform state of the art techniques in the proposed datasets. Our code is freely available as <italic>optimalFlow</italic>, a Bioconductor R package at <ext-link ext-link-type="uri" xlink:href="https://bioconductor.org/packages/optimalFlow">https://bioconductor.org/packages/optimalFlow</ext-link>.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3">optimalFlowTemplates + optimalFlowClassification addresses the problem of using supervised learning while accounting for biological and technical variability. Our methodology provides a robust automated gating workflow that handles the intrinsic variability of flow cytometry data well. Our main innovation is the methodology itself and the optimal transport techniques that we apply to flow cytometry analysis.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Flow cytometry gating</kwd>
      <kwd>Optimal transport</kwd>
      <kwd>Wasserstein distance</kwd>
      <kwd>Clustering</kwd>
      <kwd>Supervised classification</kwd>
    </kwd-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2020</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par18">Flow cytometry (FC) works with ‘high-dimensional quantitative measurement of light scatter and fluorescence emission properties of hundreds of thousands of individual cells in each analysed sample’ (see [<xref ref-type="bibr" rid="CR1">1</xref>]). These quantitative measurements allow to analyse and classify individual cells, facilitating diverse applications. For example, as mentioned in [<xref ref-type="bibr" rid="CR2">2</xref>], ‘flow cytometry is used to identify and quantify populations of immune cells’ in order to monitor the immune state of patients or to detect relevant biomarkers by comparing flow cytometries from different patient groups.</p>
    <p id="Par19">A main component in FC is gating, the assignment of individual cells (data records) into discrete cell types. Manual gating, where an expert assigns cell types (labels) to individual cells using a set of rules on one- or two-dimensional projections, has been the prevalent option. However, this manual approach has some shortcomings. Firstly, it is subjective, since it depends on the expertise of the user, on the sequence of markers (measured variables) used to do the projections and on the locations of the gates on those projections. Secondly, it can be very time consuming because it is ‘roughly quadratic in the number of markers’ (see [<xref ref-type="bibr" rid="CR3">3</xref>]). Lastly, the recent increase in the number of markers and number of cells per cytometry makes human error a relevant factor.</p>
    <p id="Par20">To avoid some of the difficulties related to manual gating there have been different approaches to automated gating. In unsupervised methods there is no need for previously gated cytometries, and gating is done through a clustering procedure. Examples of such methods include CCST [<xref ref-type="bibr" rid="CR4">4</xref>], which uses a nonparametric mixture model clustering and a data-derived decision tree representation for gating; FLOCK [<xref ref-type="bibr" rid="CR5">5</xref>], which does grid-based density estimation (with merging) and then applies k-means; FLAME [<xref ref-type="bibr" rid="CR6">6</xref>], which performs skew <italic>t</italic> model-based clustering; and flowClust [<xref ref-type="bibr" rid="CR7">7</xref>, <xref ref-type="bibr" rid="CR8">8</xref>], which does robust-based clustering through <italic>t</italic> mixture models with Box-Cox transformation. Other related clustering procedures are: flowPeaks [<xref ref-type="bibr" rid="CR9">9</xref>], which performs Gaussian mixture model-based clustering (with modified covariances) and merging, and flowMeans [<xref ref-type="bibr" rid="CR10">10</xref>] which does k-means with initialization via mode detection through kernel density-based estimation. More information about state-of-the-art methods can be found in [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR2">2</xref>].</p>
    <p id="Par21">The accuracy of cell type assignation can be improved using supervised machine learning which takes advantage of the historical information contained in previously gated cytometries (manually or otherwise). Recently, some methods have been produced addressing this problem. DeepCyTOF [<xref ref-type="bibr" rid="CR3">3</xref>] combines de-noising, deep-learning algorithms, and domain adaptation. flowLearn [<xref ref-type="bibr" rid="CR11">11</xref>] combines density features of the data, manually selected gating thresholds, and derivative-based density alignments. We stress that other more classical approaches for supervised learning are also available. For example, random forest algorithms, support vector machines or quadratic discriminant analysis can be used when learning from some previously gated cytometry. Supervised machine learning is a well-documented topic and for more detailed explanations we refer to [<xref ref-type="bibr" rid="CR12">12</xref>].</p>
    <p id="Par22">There are two main setups for using supervised learning in the FC context which are relevant in practical studies. Firstly, the classical one, where there is an available database of historical information. This means that a collection of gated flow cytometries is available and this information can be used to gate a new cytometry. In a second scenario, we have a collection of ungated cytometries, and we want to gate manually (or otherwise) a minimal amount of them and use these gated cytometries to classify the rest. In both setups, there is a fundamental problem intrinsic to FC. That is, flow cytometry data have considerable technical and biological variability, which makes the use of supervised learning difficult. Biological variability is due to intrinsic differences between individuals such as health status, age, gender, etc. Technical variability appears due to different experimental adjustments, variation of conditions during experiments and the use of different measuring devices (flow cytometers).</p>
    <p id="Par23">In this work we provide novel methods for grouping (clustering) gated cytometries. The goal is to produce groups (clusters) of cytometries that have lower variability than the whole collection and, furthermore, that are coherent enough to be considered as a typology by themselves. This, in turn, allows to greatly improve the performance of any supervised learning procedure. We provide evidence of this below. Once we have a partition (clustering) of a collection of cytometries, we provide several methods for obtaining an artificial cytometry (prototype, template) that represents in some optimal way the cytometries in each respective group. These prototypes can be used, among other things, to match populations between different cytometries as suggested in [<xref ref-type="bibr" rid="CR13">13</xref>, <xref ref-type="bibr" rid="CR14">14</xref>] or to analyse and extract characteristics of a group of similar cytometries. In addition, a procedure capable of grouping similar cytometries could help to detect individuals with a common condition, i.e., a sickness, such as cancer. In our work we show that this indeed happens.</p>
    <p id="Par24"><italic>optimalFlowTemplates</italic> is our procedure for clustering cytometries and obtaining templates. It is based on recent developments in the field of optimal transport such as a <italic>similarity distance</italic> between clusterings, introduced in [<xref ref-type="bibr" rid="CR15">15</xref>], and a <italic>barycenter</italic> (Frechet mean, see [<xref ref-type="bibr" rid="CR16">16</xref>, <xref ref-type="bibr" rid="CR17">17</xref>]) and <italic>k-barycenters</italic> (see [<xref ref-type="bibr" rid="CR18">18</xref>–<xref ref-type="bibr" rid="CR20">20</xref>]) of probability distributions.</p>
    <p id="Par25">Additionally, we introduce a supervised classification tool, <italic>optimalFlowClassification</italic>, for the case when a database of gated cytometries is available. The procedure uses the prototypes obtained by optimalFlowTemplates on the database. These are used to initialise <italic>tclust</italic>, a robust extension of k-means that allows for non-spherical shapes, to gate a new cytometry (see [<xref ref-type="bibr" rid="CR21">21</xref>], not to be confused with TCLUST [<xref ref-type="bibr" rid="CR22">22</xref>]). By using a similarity distance between the best clustering obtained by <italic>tclust</italic> and the artificial cytometries provided by optimalFlowTemplates we can assign the new cytometry to the most similar template (and the corresponding group of cytometries). We provide several options to assign cell types to the new cytometry using the most relevant information, represented by the assigned template and the respective cluster of cytometries.</p>
    <p id="Par26">Our approach fits into the following general steps: <list list-type="simple"><list-item><label>0.</label><p id="Par27">Obtain a database of gated cytometries. This can be done by manual gating or by a suitable automatic gating procedure.</p></list-item><list-item><label>1</label><p id="Par28">Obtain a partition of the database of gated cytometries based on some similarity/dissimilarity measure between gated cytometries.</p></list-item><list-item><label>2</label><p id="Par29">Obtain an artificial prototype (template cytometry) for every cluster of gated cytometries obtained in the previous step.</p></list-item><list-item><label>3</label><p id="Par30">Assign a new ungated target cytometry to the most similar artificial prototype. Use that prototype or the corresponding group of gated cytometries to gate the target cytometry.</p></list-item></list>Previous approaches fit into this scheme but have implemented it using different methods. The crucial points in all procedures are to define an appropriate similarity/dissimilarity measure and to propose a method for producing templates. We briefly discuss some of the most relevant approaches for our work.</p>
    <p id="Par31">In [<xref ref-type="bibr" rid="CR23">23</xref>] the Earth Mover’s (Wasserstein, Kantorovich–Rubinstein) Distance was proposed as an appropriate measure of similarity between gated cytometries. This approach is very attractive since Step 1 can be done comparing directly appropriate non-parametric approximations of the distribution of gated (or ungated) cytometries. Additionally, the similarity criterion is a parameter-free distance with a nice interpretation. However, this approach is very computationally intensive and even unfeasible in the high dimension and high cell count setting that is characteristic of modern FC.</p>
    <p id="Par32">QFMatch [<xref ref-type="bibr" rid="CR24">24</xref>] introduces a similarity between cytometries based on a multidimensional extension of a Quadratic Form (QF)-based distance. This QF-based distance is calculated through a non-parametric approximation of the distributions of the whole gated cytometry and of the separate cell types. Specifically, it is based on the Euclidean distance of the centers of mass between bins of the approximate pooled distribution and on the frequency difference in the bins of the separate cytometries. However, defining a QF-based distance is not trivial and no proposal or suggestion for a method of obtaining templates is made.</p>
    <p id="Par33">The most closely related method to ours is flowMatch [<xref ref-type="bibr" rid="CR13">13</xref>]. There, similarity between gated cytometries is obtained solving a matching problem known as Generalized Edge Cover (GEC) and templates are obtained merging matched vertices.</p>
    <p id="Par34">Our proposal builds on the best properties of the previous procedures. It offers a similarity measure between gated cytometries (<xref rid="Equ2" ref-type="">2</xref>) which is a distance and is parameter free as QFMatch [<xref ref-type="bibr" rid="CR24">24</xref>]. The similarity is based on optimal transport which is well suited for FC [<xref ref-type="bibr" rid="CR23">23</xref>] and has a very intuitive meaning. Through the optimal transport soft assignment problem (<xref rid="Equ1" ref-type="">1</xref>), we have extensive freedom for choosing the cost of transporting cell types from one cytometry to another in a fairly straightforward way, as in flowMatch. This enables us to measure the difference between the distributions of cell types in different cytometries using suitable parametric or non-parametric approximations. We promote the use of the 2-Wasserstein distance and location-scale mixture models to be able to obtain meaningful templates. These are not based on pooling or keeping clusters of cell types, as for example in flowMatch, but in obtaining a prototype that is a consensus between all the cytometries that are in the same group. The template simultaneously represents a consensus for the location, shape, and proportion of the different cell types present in the group of cytometries.</p>
  </sec>
  <sec id="Sec2">
    <title>Methods</title>
    <p id="Par35">We can view a gated flow cytometry, <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^i$$\end{document}</tex-math><mml:math id="M2"><mml:msup><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq1.gif"/></alternatives></inline-formula>, as a collection of <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n_i$$\end{document}</tex-math><mml:math id="M4"><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq2.gif"/></alternatives></inline-formula> multidimensional points with their associated labels (cell types or group labels) forming a set <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L^i=\{L_k^i\}_{k=1}^{k_i}$$\end{document}</tex-math><mml:math id="M6"><mml:mrow><mml:msup><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">}</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq3.gif"/></alternatives></inline-formula> of <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k_i$$\end{document}</tex-math><mml:math id="M8"><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq4.gif"/></alternatives></inline-formula> different labels. Hence, a gated cytometry can be described as <inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^i = \{(X^i_j,Y^i_j)\}_{j = 1}^{n_i}$$\end{document}</tex-math><mml:math id="M10"><mml:mrow><mml:msup><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>Y</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq5.gif"/></alternatives></inline-formula> where <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^i_j\in {\mathbb {R}}^d$$\end{document}</tex-math><mml:math id="M12"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq6.gif"/></alternatives></inline-formula> and <inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Y^i_j\in L^i$$\end{document}</tex-math><mml:math id="M14"><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq7.gif"/></alternatives></inline-formula>. Alternatively, we could describe it as a partition (clustering) of all <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^i_j$$\end{document}</tex-math><mml:math id="M16"><mml:msubsup><mml:mi>X</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq8.gif"/></alternatives></inline-formula> into groups (clusters) formed by points sharing the same labels. That is, <inline-formula id="IEq9"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^i=\{({\mathcal {C}}^i_k, p^i_k)\}_{k=1}^{k_i}$$\end{document}</tex-math><mml:math id="M18"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq9.gif"/></alternatives></inline-formula> where <inline-formula id="IEq10"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^i_k = \{X^i_j:1\le j\le n_i,Y_j^i = L^i_k\}$$\end{document}</tex-math><mml:math id="M20"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>:</mml:mo><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>j</mml:mi><mml:mo>≤</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mi>Y</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq10.gif"/></alternatives></inline-formula> is a cluster and <inline-formula id="IEq11"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p^i_k$$\end{document}</tex-math><mml:math id="M22"><mml:msubsup><mml:mi>p</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq11.gif"/></alternatives></inline-formula> is a weight associated with label <inline-formula id="IEq12"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L_k^i$$\end{document}</tex-math><mml:math id="M24"><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq12.gif"/></alternatives></inline-formula>. A third useful description is to view a gated cytometry as a clustering but coming from a mixture of location-scatter multivariate distributions. With some abuse of notation <inline-formula id="IEq13"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^i = \{(m^i_k,S^i_k,p^i_k)\}_{k=1}^{k_i}$$\end{document}</tex-math><mml:math id="M26"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq13.gif"/></alternatives></inline-formula> where <inline-formula id="IEq14"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$m_k^i,S^i_k$$\end{document}</tex-math><mml:math id="M28"><mml:mrow><mml:msubsup><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq14.gif"/></alternatives></inline-formula> are the multivariate mean and covariance of the points in cluster <inline-formula id="IEq15"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^i_k$$\end{document}</tex-math><mml:math id="M30"><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq15.gif"/></alternatives></inline-formula>.<fig id="Fig1"><label>Fig. 1</label><caption><p>A flow cytometry with five cell types viewed in a three-dimensional projection: left as points with labels; and right as ellipsoids containing 95% probability of multivariate normal distributions. We have Basophils in black, CD4+CD8<inline-formula id="IEq16"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${-}$$\end{document}</tex-math><mml:math id="M32"><mml:mo>-</mml:mo></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq16.gif"/></alternatives></inline-formula> in red, Eosinophils in green, Monocytes in blue and Neutrophils in cyan</p></caption><graphic xlink:href="12859_2020_3795_Fig1_HTML" id="MO1"/></fig></p>
    <p id="Par36">We provide an example of the different descriptions in Fig. <xref rid="Fig1" ref-type="fig">1</xref>. We have five cell types, hence <inline-formula id="IEq17"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L^1=\{Basophils\,(black),\,CD4{+}CD8{-}\,(red),\,Eosinophils\,(green),Monocytes\,(blue),\,Neutrophils\,(Cyan)\}$$\end{document}</tex-math><mml:math id="M34"><mml:mrow><mml:msup><mml:mi>L</mml:mi><mml:mn>1</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mi>B</mml:mi><mml:mi>a</mml:mi><mml:mi>s</mml:mi><mml:mi>o</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mi>l</mml:mi><mml:mi>s</mml:mi><mml:mspace width="0.166667em"/><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mi>C</mml:mi><mml:mi>D</mml:mi><mml:mn>4</mml:mn><mml:mo>+</mml:mo><mml:mi>C</mml:mi><mml:mi>D</mml:mi><mml:mn>8</mml:mn><mml:mo>-</mml:mo><mml:mspace width="0.166667em"/><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mi>E</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mi>l</mml:mi><mml:mi>s</mml:mi><mml:mspace width="0.166667em"/><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>c</mml:mi><mml:mi>y</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mspace width="0.166667em"/><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mi>l</mml:mi><mml:mi>u</mml:mi><mml:mi>e</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mi>N</mml:mi><mml:mi>e</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mi>l</mml:mi><mml:mi>s</mml:mi><mml:mspace width="0.166667em"/><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>C</mml:mi><mml:mi>y</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq17.gif"/></alternatives></inline-formula>. We have a three-dimensional projection onto three different markers. We can interpret the image on the left as a plot of the coordinates of every cell with its label, but also as the plot of the group of cells labelled as Basophils (black group), and so on. On the other hand, the plot on the right is a representation of the ellipsoid containing 95% of the probability when we see each cluster as a multivariate normal distribution with mean and covariance corresponding to the empirical mean and covariance. As we see from the plots, all the above descriptions seem to represent the data at hand well and, therefore, all of them could be useful for different applications.</p>
    <sec id="Sec3">
      <title>Obtaining prototypic cytometries: optimalFlowTemplates</title>
      <p id="Par37">Due to the high variability in flow cytometry data we should expect that learning from different elements in the database should produce significantly different results on the classification of a new cytometry <inline-formula id="IEq18"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^T=\{X^T_1,\dots , X^T_{n_T}\}\subset {\mathbb {R}}^d$$\end{document}</tex-math><mml:math id="M36"><mml:mrow><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mi>T</mml:mi></mml:msubsup><mml:mo stretchy="false">}</mml:mo></mml:mrow><mml:mo>⊂</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq18.gif"/></alternatives></inline-formula>. Our approach is to search for clusters of existing cytometries in the database. In this way we pursue a notable reduction of variability, thus allowing a good representation of the cytometries in each of these groups through prototypic cytometries. Therefore, using a prototype of a group for learning should produce a similar result for classifying <inline-formula id="IEq19"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^T$$\end{document}</tex-math><mml:math id="M38"><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq19.gif"/></alternatives></inline-formula> to the one obtained using any other cytometry in the same group.</p>
      <sec id="Sec4">
        <title>Clustering cytometries</title>
        <p id="Par38">Since gated cytometries can be viewed as partitions and we want to cluster cytometries to reduce variability, we want to do clustering of clusterings, also known as meta-clustering. The methodology we will develop consists of using some meaningful distance between partitions and then applying hierarchical clustering methods. We use hierarchical clustering since it does not rely on a particular distance and therefore it is well suited for handling a variety of distances between objects. This is not the case in many other usual clustering procedures.</p>
        <p id="Par39">As a distance between clusterings we propose to use the <italic>similarity distance</italic> (<xref rid="Equ2" ref-type="">2</xref>), introduced in [<xref ref-type="bibr" rid="CR15">15</xref>]. It is based on two auxiliary distances. The optimal transport distance between two partitions <inline-formula id="IEq20"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^i$$\end{document}</tex-math><mml:math id="M40"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq20.gif"/></alternatives></inline-formula> and <inline-formula id="IEq21"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^j$$\end{document}</tex-math><mml:math id="M42"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq21.gif"/></alternatives></inline-formula> is defined as<disp-formula id="Equ13"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} d_{OT}({\mathcal {C}}^i,{\mathcal {C}}^{j})=\sum _{k=1}^{k=k_i}\sum _{l=1}^{l=k_{j}}w^*_{kl}d( {\mathcal {C}}^i_k,{\mathcal {C}}^{j}_{l}), \end{aligned}$$\end{document}</tex-math><mml:math id="M44" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">OT</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi mathvariant="italic">kl</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq22"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d({\mathcal {C}}^i_k,{\mathcal {C}}^{j}_{l})$$\end{document}</tex-math><mml:math id="M46"><mml:mrow><mml:mi>d</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq22.gif"/></alternatives></inline-formula> is a distance between clusters <inline-formula id="IEq23"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^i_k$$\end{document}</tex-math><mml:math id="M48"><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq23.gif"/></alternatives></inline-formula> and <inline-formula id="IEq24"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^j_l$$\end{document}</tex-math><mml:math id="M50"><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq24.gif"/></alternatives></inline-formula>. <inline-formula id="IEq25"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(w^*_{kl})$$\end{document}</tex-math><mml:math id="M52"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi mathvariant="italic">kl</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq25.gif"/></alternatives></inline-formula> are the solutions of the optimal transport linear program<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \begin{array}{ll@{}ll} \text {minimize} &amp;{} \sum \limits _{k=1}^{k=k_i}\sum \limits _{l=1}^{l=k_{j}}w_{kl}d({\mathcal {C}}^i_k, {\mathcal {C}}^{j}_{l})&amp;{}\\ \text {subject to} &amp;{} w_{kl}\ge 0, &amp;{}\quad 1\le k\le k_i,1\le l\le k_j&amp;{}\\ &amp;{} \sum \limits _{l = 1}^{l = k_j}w_{kl} = p^i_k, &amp;{}\quad 1\le k\le k_i&amp;{}\\ &amp;{} \sum \limits _{k = 1}^{k = k_i}w_{kl} = p^j_l, &amp;{}\quad 1\le l\le k_j&amp;{}\\ &amp;{} \sum \limits _{k=1}^{k=k_i}\sum _{l=1}^{l=k_{j}}w_{kl} = 1. \end{array} \end{aligned}$$\end{document}</tex-math><mml:math id="M54" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mtext>minimize</mml:mtext></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mrow/><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi mathvariant="italic">kl</mml:mi></mml:mrow></mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow/></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mrow/><mml:mtext>subject to</mml:mtext></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mrow/><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi mathvariant="italic">kl</mml:mi></mml:mrow></mml:msub><mml:mo>≥</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mrow/><mml:mspace width="1em"/><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>k</mml:mi><mml:mo>≤</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>l</mml:mi><mml:mo>≤</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow/></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow/></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mrow/><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi mathvariant="italic">kl</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mrow/><mml:mspace width="1em"/><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>k</mml:mi><mml:mo>≤</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow/></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow/></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mrow/><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi mathvariant="italic">kl</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mrow/><mml:mspace width="1em"/><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>l</mml:mi><mml:mo>≤</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow/></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow/></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mrow/><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msubsup><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi mathvariant="italic">kl</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula><inline-formula id="IEq26"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_{OT}$$\end{document}</tex-math><mml:math id="M56"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">OT</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq26.gif"/></alternatives></inline-formula> measures the cost of the optimal way of transforming one partition into the other. For more detailed explanations on optimal transport see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Notions on optimal transport.</p>
        <p id="Par40">The second auxiliary distance is the naive transport distance, which measures the cost of naively transforming one partition into the other. It is defined as<disp-formula id="Equ14"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} d_{NT}({\mathcal {C}}^i,{\mathcal {C}}^j) = \sum _{k=1}^{k_i}\sum _{l=1}^{k_j}p^i_kp^j_ld({\mathcal {C}}^i_k,{\mathcal {C}}^j_l). \end{aligned}$$\end{document}</tex-math><mml:math id="M58" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">NT</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:munderover><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:munderover><mml:msubsup><mml:mi>p</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:msubsup><mml:mi>p</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula>The <italic>similarity distance</italic> is defined as the quotient<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} d_S({\mathcal {C}}^i,{\mathcal {C}}^j) = \frac{d_{OT}({\mathcal {C}}^i,{\mathcal {C}}^j)}{d_{NT}({\mathcal {C}}^i, {\mathcal {C}}^j)}. \end{aligned}$$\end{document}</tex-math><mml:math id="M60" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">OT</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">NT</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula>We recall that <inline-formula id="IEq27"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$0\le d_S\le 1$$\end{document}</tex-math><mml:math id="M62"><mml:mrow><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq27.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq28"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_S = 0$$\end{document}</tex-math><mml:math id="M64"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq28.gif"/></alternatives></inline-formula> means that partitions <inline-formula id="IEq29"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^i,{\mathcal {C}}^j$$\end{document}</tex-math><mml:math id="M66"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq29.gif"/></alternatives></inline-formula> are represented by the same clusters with the same weights and <inline-formula id="IEq30"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_S = 1$$\end{document}</tex-math><mml:math id="M68"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq30.gif"/></alternatives></inline-formula> means that every cluster in <inline-formula id="IEq31"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^i$$\end{document}</tex-math><mml:math id="M70"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq31.gif"/></alternatives></inline-formula> is transported proportionally to every cluster in <inline-formula id="IEq32"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^j$$\end{document}</tex-math><mml:math id="M72"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq32.gif"/></alternatives></inline-formula>. Therefore, values of <inline-formula id="IEq33"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_S$$\end{document}</tex-math><mml:math id="M74"><mml:msub><mml:mi>d</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq33.gif"/></alternatives></inline-formula> close to 0 can be interpreted as high similarity between clusterings, and values of <inline-formula id="IEq34"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_S$$\end{document}</tex-math><mml:math id="M76"><mml:msub><mml:mi>d</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq34.gif"/></alternatives></inline-formula> close to 1 can be interpreted as very dissimilar clusterings.</p>
        <p id="Par41">To completely define <inline-formula id="IEq35"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_{S}$$\end{document}</tex-math><mml:math id="M78"><mml:msub><mml:mi>d</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq35.gif"/></alternatives></inline-formula>, we need to specify a distance between clusters. Our choice is to use the well-known Wasserstein distance (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Notions on optimal transport) so<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} d({\mathcal {C}}^i_k,{\mathcal {C}}^{j}_{l}) = {\mathcal {W}}_2(N(m^i_k,S^i_k), N(m^j_l,S^j_l)). \end{aligned}$$\end{document}</tex-math><mml:math id="M80" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="script">W</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula>In essence, we are treating clusters as multivariate normal distributions, <inline-formula id="IEq36"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N(m^i_k,S^i_k)$$\end{document}</tex-math><mml:math id="M82"><mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq36.gif"/></alternatives></inline-formula> and <inline-formula id="IEq37"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N(m^j_l,S^j_l)$$\end{document}</tex-math><mml:math id="M84"><mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq37.gif"/></alternatives></inline-formula>, with means and covariances calculated from the clusters. Our choice of the Wasserstein distance is based on the desire to account for the spatial shapes of the clusters and to obtain templates for the groups of cytometries. We stress that all results in this work are also valid when understanding clusters as members of a location-scatter family.</p>
        <p id="Par42">Another interesting measure for cluster difference is the (entropy) regularized Wasserstein distance, <inline-formula id="IEq38"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {W}}_\gamma ({\mathcal {C}}^i_k,{\mathcal {C}}^{j}_{l})$$\end{document}</tex-math><mml:math id="M86"><mml:mrow><mml:msub><mml:mi mathvariant="script">W</mml:mi><mml:mi>γ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq38.gif"/></alternatives></inline-formula>, where clusters are understood as empirical distributions. We have written it down in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Notions on optimal transport equation (2). We recall that the entropy-regularized Wasserstein distance is strictly convex and there are efficient solutions based on the Sinkhorn algorithm (see [<xref ref-type="bibr" rid="CR25">25</xref>]). However, any other dissimilarity measure can be used, and, indeed, several have been used in the context of cluster comparison in FC. For example, the symmetric Kullback–Leibler divergence was used in [<xref ref-type="bibr" rid="CR13">13</xref>], where<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} d_{KL}({\mathcal {C}}^i_k,{\mathcal {C}}^{j}_{l})&amp;= \frac{1}{2}\Big (KL(N(m^i_k,S^i_k)\Vert N(m^j_l,S^j_l))\nonumber \\&amp;\quad + KL(N(m^j_l,S^j_l)\Vert N(m^i_k,S^i_k))\Big ), \end{aligned}$$\end{document}</tex-math><mml:math id="M88" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">KL</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo maxsize="1.623em" minsize="1.623em" stretchy="true">(</mml:mo></mml:mrow><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">‖</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow/></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1em"/><mml:mo>+</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">‖</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo maxsize="1.623em" minsize="1.623em" stretchy="true">)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula>and the Friedman–Rafsky test statistic was used in [<xref ref-type="bibr" rid="CR14">14</xref>].</p>
        <p id="Par43">When we see clusters as collections of points, and we have different clusterings of the same data, the Adjusted Rand Index, the Jaccard distance or other similar measures can be used, at the expense of losing spatial information. <graphic position="anchor" xlink:href="12859_2020_3795_Figa_HTML" id="MO8"/></p>
        <p id="Par44">The clustering of cytometries is presented in lines 1–17 in Algorithm 1, resulting in a partition, <inline-formula id="IEq39"><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathfrak {T}}=\{{\mathfrak {T}}_1,\dots ,{\mathfrak {T}}_{|{\mathfrak {T}}|}\}$$\end{document}</tex-math><mml:math id="M90"><mml:mrow><mml:mi mathvariant="fraktur">T</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:msub><mml:mi mathvariant="fraktur">T</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="fraktur">T</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="fraktur">T</mml:mi><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:msub><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq39.gif"/></alternatives></inline-formula>, of the input cytometries. Lines 12–16 are concerned with the obtention of a distance matrix <italic>S</italic> that, in line 17, is used to perform hierarchical clustering. Classical agglomerative algorithms can be used, but also density-based algorithms as DBSCAN (see [<xref ref-type="bibr" rid="CR26">26</xref>]) and HDBSCAN (see [<xref ref-type="bibr" rid="CR27">27</xref>]).</p>
      </sec>
      <sec id="Sec5">
        <title>Template obtention through consensus clustering</title>
        <p id="Par45">At this point we have obtained a partition, <inline-formula id="IEq40"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathfrak {T}}$$\end{document}</tex-math><mml:math id="M92"><mml:mi mathvariant="fraktur">T</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq40.gif"/></alternatives></inline-formula>, of the collection of cytometries <inline-formula id="IEq41"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}^j\}_{j=1}^N$$\end{document}</tex-math><mml:math id="M94"><mml:msubsup><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq41.gif"/></alternatives></inline-formula>. Next, we want to obtain a prototype cytometry, <inline-formula id="IEq42"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {T}}^i$$\end{document}</tex-math><mml:math id="M96"><mml:msup><mml:mrow><mml:mi mathvariant="script">T</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq42.gif"/></alternatives></inline-formula>, for every group of cytometries, <italic>i</italic>, in the partition <inline-formula id="IEq43"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathfrak {T}}$$\end{document}</tex-math><mml:math id="M98"><mml:mi mathvariant="fraktur">T</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq43.gif"/></alternatives></inline-formula> (lines 18–21 in Algorithm 1). To address this goal, we resort to k-barycenters using Wasserstein distance, which provide a suitable tool for consensus on probability distributions (see [<xref ref-type="bibr" rid="CR20">20</xref>]). We propose three different methods to obtain a template cytometry from a group of cytometries, that is, to obtain a consensus (ensemble) clustering on flow cytometries. These methods are given in Algorithms 2, 3 and 4. <graphic position="anchor" xlink:href="12859_2020_3795_Figb_HTML" id="MO9"/><fig id="Fig2"><label>Fig. 2</label><caption><p>An application of Algorithm 2-Pooling. On the left we have 5 different cytometries, each with 4 different identified cell types given by <inline-formula id="IEq44"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{Monocytes\,(black),\, CD4{+}CD8{-}\,(red),\, Mature\,Sig\,Kappa\,(green),\,TCRgd{-}\,(blue)\}$$\end{document}</tex-math><mml:math id="M100"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mi>M</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>c</mml:mi><mml:mi>y</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mspace width="0.166667em"/><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mi>C</mml:mi><mml:mi>D</mml:mi><mml:mn>4</mml:mn><mml:mo>+</mml:mo><mml:mi>C</mml:mi><mml:mi>D</mml:mi><mml:mn>8</mml:mn><mml:mo>-</mml:mo><mml:mspace width="0.166667em"/><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mi>M</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>u</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mspace width="0.166667em"/><mml:mi>S</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mspace width="0.166667em"/><mml:mi>K</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mspace width="0.166667em"/><mml:mo stretchy="false">(</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mi>T</mml:mi><mml:mi>C</mml:mi><mml:mi>R</mml:mi><mml:mi>g</mml:mi><mml:mi>d</mml:mi><mml:mo>-</mml:mo><mml:mspace width="0.166667em"/><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mi>l</mml:mi><mml:mi>u</mml:mi><mml:mi>e</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq44.gif"/></alternatives></inline-formula>. On the right we have a prototype cytometry obtained taking the 1-barycenter for each cell type. Ellipsoids contain 95% of the probability of the respective multivariate gaussian distributions</p></caption><graphic xlink:href="12859_2020_3795_Fig2_HTML" id="MO10"/></fig></p>
        <graphic position="anchor" xlink:href="12859_2020_3795_Figc_HTML" id="MO11"/>
        <p id="Par46">
          <fig id="Fig3">
            <label>Fig. 3</label>
            <caption>
              <p>Application of Algorithm 3—densit-based. On the left we have the same 5 cytometries as in Fig. <xref rid="Fig2" ref-type="fig">2</xref>, but each cytometry is grouped in clusters without cell types being identified. On the right we have a prototype cytometry obtained taking the denisty based hierarchical clustering approach on the cytometries represented on the left. Ellipsoids contain 95% of the probability of the respective multivariate gaussian distributions</p>
            </caption>
            <graphic xlink:href="12859_2020_3795_Fig3_HTML" id="MO12"/>
          </fig>
        </p>
        <graphic position="anchor" xlink:href="12859_2020_3795_Figd_HTML" id="MO13"/>
        <p id="Par47">
          <fig id="Fig4">
            <label>Fig. 4</label>
            <caption>
              <p>Application of Algorithm 4—4-barycenter. On the left we have the same 5 cytometries as in Fig. <xref rid="Fig2" ref-type="fig">2</xref>, but each cytometry is grouped in clusters without cell types being identified. On the right we have a prototype cytometry obtained taking the 4-barycenter of the cytometries represented on the left. Ellipsoids contain 95% of the probability of the respective multivariate gaussian distributions</p>
            </caption>
            <graphic xlink:href="12859_2020_3795_Fig4_HTML" id="MO14"/>
          </fig>
        </p>
        <p id="Par48">The intention behind pooling (Algorithm 2), is to take advantage of having groups of similar cytometries and knowing the actual cell types in them. A prototype of a cell type is obtained through a (1-)barycenter—a consensus representation—of the multivariate distributions that represent the same cell type in the cytometries that are members of the same group in <inline-formula id="IEq45"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathfrak {T}}$$\end{document}</tex-math><mml:math id="M102"><mml:mi mathvariant="fraktur">T</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq45.gif"/></alternatives></inline-formula>. A prototype cytometry is the collection of prototypes of each cell type. This can be seen in Fig. <xref rid="Fig2" ref-type="fig">2</xref>. On the left-hand side, we have 5 different cytometries, each with 4 different cell types, hence <inline-formula id="IEq46"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L = \{Monocytes\,(black),\, CD4{+}CD8{-}\,(red),\, Mature\,Sig\,Kappa\,(green),\,TCRgd{-}\,(blue)\}$$\end{document}</tex-math><mml:math id="M104"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>M</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>c</mml:mi><mml:mi>y</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mspace width="0.166667em"/><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mi>C</mml:mi><mml:mi>D</mml:mi><mml:mn>4</mml:mn><mml:mo>+</mml:mo><mml:mi>C</mml:mi><mml:mi>D</mml:mi><mml:mn>8</mml:mn><mml:mo>-</mml:mo><mml:mspace width="0.166667em"/><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mi>M</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>u</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mspace width="0.166667em"/><mml:mi>S</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mspace width="0.166667em"/><mml:mi>K</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mspace width="0.166667em"/><mml:mo stretchy="false">(</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mi>T</mml:mi><mml:mi>C</mml:mi><mml:mi>R</mml:mi><mml:mi>g</mml:mi><mml:mi>d</mml:mi><mml:mo>-</mml:mo><mml:mspace width="0.166667em"/><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mi>l</mml:mi><mml:mi>u</mml:mi><mml:mi>e</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq46.gif"/></alternatives></inline-formula>. Since the cell types are known, we take all the black ellipsoids of the left plot, representing the different normal distributions, and obtain the black ellipsoid on the right plot, the barycenter of the group of normal distributions, as a consensus element for Monocytes. Doing this for every cell type gives us the prototype cytometry represented on the right of Fig. <xref rid="Fig2" ref-type="fig">2</xref>.</p>
        <p id="Par49">However, our templates could be obtained even when we have gated cytometries but without identified cell types. This could be the case when unsupervised gating is used to obtain a database of gated cytometries. Density-based hierarchical clustering (Algorithm 3) and k-barycenter (Algorithm 4) are based on the idea that clusters that are close in Wasserstein distance should be understood as representing the same, although we may not know which, cell type. When using k-barycenters we must specify the number of cell types, <italic>K</italic>, that we want for the artificial cytometry. However, when using density-based hierarchical clustering as HDBSCAN or DBSCAN the selection of the number of cell types for the prototype cytometry is automatic. Recall that both k-barycenters, through trimming, and density-based hierarchical clustering, are robust clustering procedures.</p>
        <p id="Par50">In Figs. <xref rid="Fig3" ref-type="fig">3</xref> and <xref rid="Fig4" ref-type="fig">4</xref> we have a representation of how Algorithms 3 and 4 work. Since we do not have cell type information for the 5 gated cytometries, we obtain the plot that can be seen on the left of Figs. <xref rid="Fig3" ref-type="fig">3</xref> and <xref rid="Fig4" ref-type="fig">4</xref>. However, the absence of this information can be mitigated using the spatial information, which clearly shows a group structure between the ellipsoids. We use density-based hierarchical clustering and k-barycenters respectively, to try to capture this spatial information. As a result, we obtain the template cytometries on the right side of Figs. <xref rid="Fig3" ref-type="fig">3</xref> and <xref rid="Fig4" ref-type="fig">4</xref>. Clearly, we see that the templates represent well the real cell types behind the cytometries (compare with Fig. <xref rid="Fig2" ref-type="fig">2</xref>), although we still do not know the cell types corresponding to each ellipsoid. This could be achieved using expert information or matching populations.</p>
      </sec>
    </sec>
    <sec id="Sec6">
      <title>Supervised classification: optimalFlowClassification</title>
      <p id="Par51">Now, our goal is to assign cell types to a new cytometry <inline-formula id="IEq47"><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^T$$\end{document}</tex-math><mml:math id="M106"><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq47.gif"/></alternatives></inline-formula>, using the information given in a database of gated cytometries <inline-formula id="IEq48"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}^i\}_{i=1}^N$$\end{document}</tex-math><mml:math id="M108"><mml:msubsup><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq48.gif"/></alternatives></inline-formula>. The different sources of variability, mainly those of a technical nature and those which are properly due to different cohorts present in the database, advise to search for different cytometric structures. Hence, we should assign <inline-formula id="IEq49"><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^T$$\end{document}</tex-math><mml:math id="M110"><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq49.gif"/></alternatives></inline-formula> to the group of cytometries that is more similar to it and then use supervised techniques. Indeed, this is the purpose of optimalFlowClassification, as shown in Algorithm 5. As an input we apply optimalFlowTemplates to the database <inline-formula id="IEq50"><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}^i\}_{i=1}^N$$\end{document}</tex-math><mml:math id="M112"><mml:msubsup><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq50.gif"/></alternatives></inline-formula> to obtain the partition <inline-formula id="IEq51"><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathfrak {T}}$$\end{document}</tex-math><mml:math id="M114"><mml:mi mathvariant="fraktur">T</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq51.gif"/></alternatives></inline-formula> and the templates <inline-formula id="IEq52"><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {T}}$$\end{document}</tex-math><mml:math id="M116"><mml:mi mathvariant="script">T</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq52.gif"/></alternatives></inline-formula>. <graphic position="anchor" xlink:href="12859_2020_3795_Fige_HTML" id="MO15"/></p>
      <p id="Par52">Lines 1–5 in Algorithm 5 are dedicated to finding an unsupervised partition of the new cytometry <inline-formula id="IEq53"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^T$$\end{document}</tex-math><mml:math id="M118"><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq53.gif"/></alternatives></inline-formula> using as initialization for <italic>tclust</italic> the prototypes of the database. Initializing with the database entries attempts to use the available information optimally. Hence, if <inline-formula id="IEq54"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^T$$\end{document}</tex-math><mml:math id="M120"><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq54.gif"/></alternatives></inline-formula> is similar to some of the cytometries in the database, appropriate initialization should be advantageous. However, some other suitable unsupervised initializations can be used, such as the ones proposed in FLOCK, flowPeaks or flowMeans. We need to cluster <inline-formula id="IEq55"><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^T$$\end{document}</tex-math><mml:math id="M122"><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq55.gif"/></alternatives></inline-formula> to compare it with the template cytometries.</p>
      <p id="Par53">Notice that <italic>tclust</italic> [<xref ref-type="bibr" rid="CR21">21</xref>], is a more sophisticated version of k-means, allowing ellipsoidal clusters with different sizes and shapes. Like k-means, this robust model-based clustering procedure needs an initialization and its behaviour improves notably if that initialization is well suited. Nonetheless, it is possible to use any other unsupervised procedure that allows an initialization with a clustering defined by probability distributions. For example, this is the case for the popular <italic>mclust</italic> [<xref ref-type="bibr" rid="CR28">28</xref>, <xref ref-type="bibr" rid="CR29">29</xref>], a finite Gaussian mixture model-based clustering based on an EM-algorithm.</p>
      <p id="Par54"><italic>tclust</italic> searches for a partition <inline-formula id="IEq56"><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}_0,\dots , {\mathcal {C}}_k\}$$\end{document}</tex-math><mml:math id="M124"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msub><mml:mi mathvariant="script">C</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="script">C</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq56.gif"/></alternatives></inline-formula> of <inline-formula id="IEq57"><alternatives><tex-math id="M125">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X = \{X_1,\dots , X_n\}$$\end{document}</tex-math><mml:math id="M126"><mml:mrow><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq57.gif"/></alternatives></inline-formula>, with <inline-formula id="IEq58"><alternatives><tex-math id="M127">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$|{\mathcal {C}}_0|=\lceil n\alpha \rceil$$\end{document}</tex-math><mml:math id="M128"><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi mathvariant="script">C</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>⌈</mml:mo><mml:mi>n</mml:mi><mml:mi>α</mml:mi><mml:mo>⌉</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq58.gif"/></alternatives></inline-formula>, vectors <inline-formula id="IEq59"><alternatives><tex-math id="M129">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$m_j$$\end{document}</tex-math><mml:math id="M130"><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq59.gif"/></alternatives></inline-formula>, positive definite matrices <inline-formula id="IEq60"><alternatives><tex-math id="M131">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_j$$\end{document}</tex-math><mml:math id="M132"><mml:msub><mml:mi>S</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq60.gif"/></alternatives></inline-formula> and weights <inline-formula id="IEq61"><alternatives><tex-math id="M133">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_j\in [0,1]$$\end{document}</tex-math><mml:math id="M134"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq61.gif"/></alternatives></inline-formula> that approximately maximize the pseudo-likelihood<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M135">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \sum _{j=1}^{k}\sum _{i\in {\mathcal {C}}_j}\log \left( p_j\varphi (X_i;m_j, S_j)\right) , \end{aligned}$$\end{document}</tex-math><mml:math id="M136" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi mathvariant="script">C</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mo>log</mml:mo><mml:mfenced close=")" open="("><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mi>φ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>;</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>under restrictions over the scatter matrices <inline-formula id="IEq62"><alternatives><tex-math id="M137">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_j$$\end{document}</tex-math><mml:math id="M138"><mml:msub><mml:mi>S</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq62.gif"/></alternatives></inline-formula>. By <inline-formula id="IEq63"><alternatives><tex-math id="M139">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varphi (\cdot ;m_j, S_j)$$\end{document}</tex-math><mml:math id="M140"><mml:mrow><mml:mi>φ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>·</mml:mo><mml:mo>;</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq63.gif"/></alternatives></inline-formula> we denote the density function of the multivariate normal <inline-formula id="IEq64"><alternatives><tex-math id="M141">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N(m_j, S_j)$$\end{document}</tex-math><mml:math id="M142"><mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq64.gif"/></alternatives></inline-formula>. <inline-formula id="IEq65"><alternatives><tex-math id="M143">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}_0$$\end{document}</tex-math><mml:math id="M144"><mml:msub><mml:mi mathvariant="script">C</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq65.gif"/></alternatives></inline-formula> is the cluster of trimmed observations, where the trimming level is <inline-formula id="IEq66"><alternatives><tex-math id="M145">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha$$\end{document}</tex-math><mml:math id="M146"><mml:mi>α</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq66.gif"/></alternatives></inline-formula>.</p>
      <p id="Par55">The details of the algorithm can be found in [<xref ref-type="bibr" rid="CR30">30</xref>]. For us it is relevant to recall only the initialization step, i.e., to provide an initial <inline-formula id="IEq67"><alternatives><tex-math id="M147">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta ^0=(p^0_1,\dots , p^0_k,m_1^0, \dots , m_k^0, S_1^0,\dots , S_k^0)$$\end{document}</tex-math><mml:math id="M148"><mml:mrow><mml:msup><mml:mi>θ</mml:mi><mml:mn>0</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mi>k</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>k</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq67.gif"/></alternatives></inline-formula>. Subsequently, we only need a set of weights with corresponding means and covariances to initialize <italic>tclust</italic>.</p>
      <p id="Par56">We favour the use of <italic>tclust</italic> over k-means since it allows for non-spherical clusters and for trimming, making partitions more robust to outliers and even bridge-points. However, our procedure is compatible with any other way of obtaining a partition of the data, which we reflect in lines 6–8. In our experiments we have used flowMeans as an alternative to <italic>tclust</italic>.</p>
      <p id="Par57">In lines 9–12 we look to assign <inline-formula id="IEq68"><alternatives><tex-math id="M149">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^T$$\end{document}</tex-math><mml:math id="M150"><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq68.gif"/></alternatives></inline-formula>, using the clustering <inline-formula id="IEq69"><alternatives><tex-math id="M151">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^u$$\end{document}</tex-math><mml:math id="M152"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>u</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq69.gif"/></alternatives></inline-formula>, produced in the previous step, to the template that is closest in similarity distance to <inline-formula id="IEq70"><alternatives><tex-math id="M153">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^u$$\end{document}</tex-math><mml:math id="M154"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>u</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq70.gif"/></alternatives></inline-formula>. With this we hope to use only the most relevant information of the database, summarized in <inline-formula id="IEq71"><alternatives><tex-math id="M155">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {T}}^*$$\end{document}</tex-math><mml:math id="M156"><mml:msup><mml:mrow><mml:mi mathvariant="script">T</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq71.gif"/></alternatives></inline-formula> and <inline-formula id="IEq72"><alternatives><tex-math id="M157">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathfrak {T}}_*$$\end{document}</tex-math><mml:math id="M158"><mml:msub><mml:mi mathvariant="fraktur">T</mml:mi><mml:mrow><mml:mrow/><mml:mo>∗</mml:mo></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq72.gif"/></alternatives></inline-formula>.</p>
      <p id="Par58">The last step in Algorithm 5, line 13, assigns cell types to <inline-formula id="IEq73"><alternatives><tex-math id="M159">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^T$$\end{document}</tex-math><mml:math id="M160"><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq73.gif"/></alternatives></inline-formula>. To do this we have several options. We can try to relabel <inline-formula id="IEq74"><alternatives><tex-math id="M161">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^u$$\end{document}</tex-math><mml:math id="M162"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>u</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq74.gif"/></alternatives></inline-formula> in an optimal way using <inline-formula id="IEq75"><alternatives><tex-math id="M163">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {T}}^*$$\end{document}</tex-math><mml:math id="M164"><mml:msup><mml:mrow><mml:mi mathvariant="script">T</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq75.gif"/></alternatives></inline-formula> or <inline-formula id="IEq76"><alternatives><tex-math id="M165">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathfrak {T}}_{*}$$\end{document}</tex-math><mml:math id="M166"><mml:msub><mml:mi mathvariant="fraktur">T</mml:mi><mml:mrow><mml:mrow/><mml:mo>∗</mml:mo></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq76.gif"/></alternatives></inline-formula>, i.e., do label transfer. Alternatively, we can use <inline-formula id="IEq77"><alternatives><tex-math id="M167">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {T}}^*$$\end{document}</tex-math><mml:math id="M168"><mml:msup><mml:mrow><mml:mi mathvariant="script">T</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq77.gif"/></alternatives></inline-formula> to do Quadratic Discriminant Analysis (QDA). Another possibility is to find the most similar partition in similarity distance (<xref rid="Equ2" ref-type="">2</xref>) from <inline-formula id="IEq78"><alternatives><tex-math id="M169">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathfrak {T}}_{*}$$\end{document}</tex-math><mml:math id="M170"><mml:msub><mml:mi mathvariant="fraktur">T</mml:mi><mml:mrow><mml:mrow/><mml:mo>∗</mml:mo></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq78.gif"/></alternatives></inline-formula> to <inline-formula id="IEq79"><alternatives><tex-math id="M171">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^u$$\end{document}</tex-math><mml:math id="M172"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>u</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq79.gif"/></alternatives></inline-formula> and use it to do QDA or random forest classification.</p>
      <p id="Par59">For supervised classification we use standard tools, random forest and QDA. However, other methods can be used in a straightforward fashion. We stress that when using QDA and <inline-formula id="IEq80"><alternatives><tex-math id="M173">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {T}}^*$$\end{document}</tex-math><mml:math id="M174"><mml:msup><mml:mrow><mml:mi mathvariant="script">T</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq80.gif"/></alternatives></inline-formula> we are using non-linear multidimensional gating regions obtained from <inline-formula id="IEq81"><alternatives><tex-math id="M175">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {T}}^*$$\end{document}</tex-math><mml:math id="M176"><mml:msup><mml:mrow><mml:mi mathvariant="script">T</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq81.gif"/></alternatives></inline-formula> to classify <inline-formula id="IEq82"><alternatives><tex-math id="M177">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X^T$$\end{document}</tex-math><mml:math id="M178"><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq82.gif"/></alternatives></inline-formula>. This can be taught as an extension of the method presented in [<xref ref-type="bibr" rid="CR11">11</xref>] where only linear one-dimensional regions are used. Another interesting fact is that the use of <inline-formula id="IEq83"><alternatives><tex-math id="M179">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_S$$\end{document}</tex-math><mml:math id="M180"><mml:msub><mml:mi>d</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq83.gif"/></alternatives></inline-formula> allows us to select the most similar real cytometry to <inline-formula id="IEq84"><alternatives><tex-math id="M181">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C^u$$\end{document}</tex-math><mml:math id="M182"><mml:msup><mml:mi>C</mml:mi><mml:mi>u</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq84.gif"/></alternatives></inline-formula>, resulting in supervised tools being more effective.</p>
      <p id="Par60">The problem of relabelling a clustering <inline-formula id="IEq85"><alternatives><tex-math id="M183">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^j$$\end{document}</tex-math><mml:math id="M184"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq85.gif"/></alternatives></inline-formula> with respect to another clustering <inline-formula id="IEq86"><alternatives><tex-math id="M185">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^i$$\end{document}</tex-math><mml:math id="M186"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq86.gif"/></alternatives></inline-formula> is usually stated as a weighted bipartite matching problem, where weights are related to the similarity between clusters in the two partitions. This problem can be solved by the Hungarian method [<xref ref-type="bibr" rid="CR31">31</xref>] or generalized edge cover (see [<xref ref-type="bibr" rid="CR13">13</xref>]), for example.</p>
      <p id="Par61">Additionally, we introduce an approach to obtain a fuzzy relabelling based on solving the optimal transport linear program associated to (<xref rid="Equ1" ref-type="">1</xref>). The solution, <inline-formula id="IEq87"><alternatives><tex-math id="M187">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(w_{kl}^*)$$\end{document}</tex-math><mml:math id="M188"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi mathvariant="italic">kl</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq87.gif"/></alternatives></inline-formula>, is the base for this fuzzy relabelling. We define the score of cluster <italic>l</italic> in <inline-formula id="IEq88"><alternatives><tex-math id="M189">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^j$$\end{document}</tex-math><mml:math id="M190"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq88.gif"/></alternatives></inline-formula> to come from cluster <italic>k</italic> in <inline-formula id="IEq89"><alternatives><tex-math id="M191">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^i$$\end{document}</tex-math><mml:math id="M192"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq89.gif"/></alternatives></inline-formula> as <inline-formula id="IEq90"><alternatives><tex-math id="M193">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s^l_k=w^*_{kl}/p^j_l$$\end{document}</tex-math><mml:math id="M194"><mml:mrow><mml:msubsup><mml:mi>s</mml:mi><mml:mi>k</mml:mi><mml:mi>l</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi mathvariant="italic">kl</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup><mml:mo stretchy="false">/</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq90.gif"/></alternatives></inline-formula>. In words, <inline-formula id="IEq91"><alternatives><tex-math id="M195">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s^l_k$$\end{document}</tex-math><mml:math id="M196"><mml:msubsup><mml:mi>s</mml:mi><mml:mi>k</mml:mi><mml:mi>l</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq91.gif"/></alternatives></inline-formula> is the proportion of probability coming from cluster <italic>k</italic>, with respect to the probability in cluster <italic>l</italic>, that arrives at cluster <italic>l</italic>. Clearly, <inline-formula id="IEq92"><alternatives><tex-math id="M197">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$0\le s^l_k\le 1$$\end{document}</tex-math><mml:math id="M198"><mml:mrow><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mi>k</mml:mi><mml:mi>l</mml:mi></mml:msubsup><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq92.gif"/></alternatives></inline-formula>, and higher scores indicate more evidence that clusters <italic>k</italic> and <italic>l</italic> represent the same cluster. A fuzzy relabelling for cluster <italic>l</italic> in <inline-formula id="IEq93"><alternatives><tex-math id="M199">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^j$$\end{document}</tex-math><mml:math id="M200"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq93.gif"/></alternatives></inline-formula> is the collection of all the scores <inline-formula id="IEq94"><alternatives><tex-math id="M201">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s^l = \{s^l_1,\dots ,s^l_{|{\mathcal {C}}^i|}\}$$\end{document}</tex-math><mml:math id="M202"><mml:mrow><mml:msup><mml:mi>s</mml:mi><mml:mi>l</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mn>1</mml:mn><mml:mi>l</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow><mml:mi>l</mml:mi></mml:msubsup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq94.gif"/></alternatives></inline-formula>. A variation of the previous score is <inline-formula id="IEq95"><alternatives><tex-math id="M203">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\tilde{s}}^l_k = s^l_k*w^*_{kl}/p^i_k$$\end{document}</tex-math><mml:math id="M204"><mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>s</mml:mi><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi><mml:mi>l</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mi>k</mml:mi><mml:mi>l</mml:mi></mml:msubsup><mml:mrow/><mml:mo>∗</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi mathvariant="italic">kl</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup><mml:mo stretchy="false">/</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq95.gif"/></alternatives></inline-formula>, where we are weighting by the proportion of cluster <italic>k</italic> that goes to cluster <italic>l</italic>, with respect to the probability contained in cluster <italic>k</italic>. In this way we down-weight the effect of a small proportion of a big cluster with respect to a big proportion of a small cluster arriving to <italic>l</italic>. From these fuzzy relabellings a hard relabelling can be obtained easily.</p>
      <p id="Par62">Again, a suitable distance between clusters can be the Wasserstein distance as in (<xref rid="Equ3" ref-type="">3</xref>), which is computationally very efficient. However, another possibility is to use<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M205">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} d({\mathcal {C}}^i_k,{\mathcal {C}}^j_l) = \frac{1}{|{\mathcal {C}}^i_k||{\mathcal {C}}^j_l|}\sum _{x\in {\mathcal {C}}^i_k}\sum _{y\in {\mathcal {C}}^j_l}\Vert x-y\Vert ^2 \end{aligned}$$\end{document}</tex-math><mml:math id="M206" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:munder><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>∈</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo stretchy="false">‖</mml:mo><mml:mi>x</mml:mi><mml:mo>-</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">‖</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula>which, unlike the Wasserstein distance, allows the labelling of small clusters in <inline-formula id="IEq96"><alternatives><tex-math id="M207">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^j$$\end{document}</tex-math><mml:math id="M208"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq96.gif"/></alternatives></inline-formula>, but does so at the price of using sub-sampling to compare bigger clusters (for example, more than 10,000 points).</p>
    </sec>
  </sec>
  <sec id="Sec7">
    <title>Results</title>
    <p id="Par63">In this section we present several experiments and comparisons of our methods with other state-of-the-art procedures on two real datasets.</p>
    <sec id="Sec8">
      <title>Data</title>
      <p id="Par64">The first dataset is formed by cytometries obtained following the Euroflow protocols using a BD FACSCanto flow cytometer in four different international centres. The size of the cytometry datasets varies from 50,000 to 300,000 cells. The samples are from adult male and female individuals, from a variety of age groups and with different conditions (see Table <xref rid="Tab1" ref-type="table">1</xref>). Thus, there is biological variability, since there are different individuals with different conditions, ages, and other different characteristics. Moreover, we have technical variability since we have different centres, different dates of measurement and different incubation times.</p>
      <p id="Par65">The dataset contains 40 gated cytometries, <inline-formula id="IEq97"><alternatives><tex-math id="M209">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}=\{{\mathcal {C}}^{1,h}, {\mathcal {C}}^{2,h}, {\mathcal {C}}^{3,h}, {\mathcal {C}}^{4,h}, {\mathcal {C}}^{5,h}, {\mathcal {C}}^{6,h}, {\mathcal {C}}^{7,h},{\mathcal {C}}^{8,h}, {\mathcal {C}}^{9,h}, {\mathcal {C}}^{10,h},$$\end{document}</tex-math><mml:math id="M210"><mml:mrow><mml:mi mathvariant="script">C</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>5</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>6</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>7</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>8</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>9</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>10</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq97.gif"/></alternatives></inline-formula>
<inline-formula id="IEq98"><alternatives><tex-math id="M211">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{11,h}, {\mathcal {C}}^{12,h}, {\mathcal {C}}^{13,h}, {\mathcal {C}}^{14,h}, {\mathcal {C}}^{15,h}, {\mathcal {C}}^{16,h},{\mathcal {C}}^{17,h}, {\mathcal {C}}^{18,h}, {\mathcal {C}}^{19,h},$$\end{document}</tex-math><mml:math id="M212"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>11</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>12</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>13</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>14</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>15</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>16</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>17</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>18</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>19</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq98.gif"/></alternatives></inline-formula>
<inline-formula id="IEq99"><alternatives><tex-math id="M213">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{20,h}, {\mathcal {C}}^{21,h},{\mathcal {C}}^{22,s}, {\mathcal {C}}^{23,s}, {\mathcal {C}}^{24,s}, {\mathcal {C}}^{25,s}, {\mathcal {C}}^{26,s}, {\mathcal {C}}^{27,s}, {\mathcal {C}}^{28,s},$$\end{document}</tex-math><mml:math id="M214"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>20</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>21</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>22</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>23</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>24</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>25</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>26</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>27</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>28</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq99.gif"/></alternatives></inline-formula>
<inline-formula id="IEq100"><alternatives><tex-math id="M215">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{29,h}, {\mathcal {C}}^{30,h}, {\mathcal {C}}^{31,h}, {\mathcal {C}}^{32,h}, {\mathcal {C}}^{33,h}, {\mathcal {C}}^{34,s},{\mathcal {C}}^{35,s}, {\mathcal {C}}^{36,h}, {\mathcal {C}}^{37,h},$$\end{document}</tex-math><mml:math id="M216"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>29</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>30</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>31</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>32</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>33</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>34</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>35</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>36</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>37</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq100.gif"/></alternatives></inline-formula>
<inline-formula id="IEq101"><alternatives><tex-math id="M217">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{38,h}, {\mathcal {C}}^{39,h}, {\mathcal {C}}^{40,h}\}$$\end{document}</tex-math><mml:math id="M218"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>38</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>39</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mn>40</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq101.gif"/></alternatives></inline-formula>, where the super index <italic>s</italic> means sick and super index <italic>h</italic> means healthy. Complementary information about the cytometries can be found in Table <xref rid="Tab1" ref-type="table">1</xref>. We split them in a learning set, <inline-formula id="IEq102"><alternatives><tex-math id="M219">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {DB}=\{{\mathcal {C}}^{1}, {\mathcal {C}}^{3},{\mathcal {C}}^{4},{\mathcal {C}}^{6},{\mathcal {C}}^{8},{\mathcal {C}}^{10},{\mathcal {C}}^{11},{\mathcal {C}}^{12},{\mathcal {C}}^{13},{\mathcal {C}}^{16},{\mathcal {C}}^{19},{\mathcal {C}}^{20},{\mathcal {C}}^{21},$$\end{document}</tex-math><mml:math id="M220"><mml:mrow><mml:mi mathvariant="script">DB</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>4</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>6</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>8</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>10</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>11</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>12</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>13</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>16</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>19</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>20</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>21</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq102.gif"/></alternatives></inline-formula>
<inline-formula id="IEq103"><alternatives><tex-math id="M221">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{22}, {\mathcal {C}}^{23},{\mathcal {C}}^{24},{\mathcal {C}}^{25},{\mathcal {C}}^{28},{\mathcal {C}}^{30},{\mathcal {C}}^{32},{\mathcal {C}}^{33},{\mathcal {C}}^{34},{\mathcal {C}}^{35},{\mathcal {C}}^{36},{\mathcal {C}}^{37},$$\end{document}</tex-math><mml:math id="M222"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>22</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>23</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>24</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>25</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>28</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>30</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>32</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>33</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>34</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>35</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>36</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>37</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq103.gif"/></alternatives></inline-formula>
<inline-formula id="IEq104"><alternatives><tex-math id="M223">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{38},{\mathcal {C}}^{39}\}$$\end{document}</tex-math><mml:math id="M224"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>38</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>39</mml:mn></mml:msup><mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq104.gif"/></alternatives></inline-formula>, and a test set <inline-formula id="IEq105"><alternatives><tex-math id="M225">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}=\{{\mathcal {C}}^{2},{\mathcal {C}}^{5},{\mathcal {C}}^{7},{\mathcal {C}}^{9},{\mathcal {C}}^{14},{\mathcal {C}}^{15},$$\end{document}</tex-math><mml:math id="M226"><mml:mrow><mml:mi mathvariant="script">TS</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>5</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>7</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>9</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>14</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>15</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq105.gif"/></alternatives></inline-formula>
<inline-formula id="IEq106"><alternatives><tex-math id="M227">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{17},{\mathcal {C}}^{18},{\mathcal {C}}^{26},{\mathcal {C}}^{27},{\mathcal {C}}^{29},{\mathcal {C}}^{31}, {\mathcal {C}}^{40}\}$$\end{document}</tex-math><mml:math id="M228"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>17</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>18</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>26</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>27</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>29</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>31</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>40</mml:mn></mml:msup><mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq106.gif"/></alternatives></inline-formula>.</p>
      <p id="Par66">Additionally, in order to explore the behaviour of our procedure in the presence of different sources of variations and make a clear comparison with flowMatch, we use the healthy donor dataset from [<xref ref-type="bibr" rid="CR32">32</xref>] to further validate our methods. This dataset includes “three sources of variations: (1) technical or instrumental variation among replicates of the same sample, (2) within-subject temporal (day-to-day) variation, and (3) between-subject natural or biological variation”. This dataset is available in the package healthyFlowData in Bioconductor. In our labelling the data correspond to the individuals as follows, A: 1–5, B: 6–10, C: 11–15 and D: 16–20.<table-wrap id="Tab1"><label>Table 1</label><caption><p>Detailed information about the participants and the measurements for the cytometries used in the experiments</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left">Center</th><th align="left">Final diagnosis</th><th align="left">Tested sample</th><th align="left">Coagulant</th><th align="left">Sex</th><th align="left">Age</th><th align="left">Incubation period</th><th align="left">Flow cytometer</th></tr></thead><tbody><tr><td align="left"><inline-formula id="IEq107"><alternatives><tex-math id="M229">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{1}$$\end{document}</tex-math><mml:math id="M230"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq107.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">M</td><td align="left">53</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq108"><alternatives><tex-math id="M231">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{2}$$\end{document}</tex-math><mml:math id="M232"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq108.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">M</td><td align="left">50</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq109"><alternatives><tex-math id="M233">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{3}$$\end{document}</tex-math><mml:math id="M234"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq109.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">M</td><td align="left">61</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq110"><alternatives><tex-math id="M235">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{4}$$\end{document}</tex-math><mml:math id="M236"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>4</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq110.gif"/></alternatives></inline-formula></td><td align="left">2</td><td align="left">HD</td><td align="left">PB</td><td align="left">Heparin</td><td align="left">M</td><td align="left">29</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq111"><alternatives><tex-math id="M237">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{5}$$\end{document}</tex-math><mml:math id="M238"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>5</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq111.gif"/></alternatives></inline-formula></td><td align="left">2</td><td align="left">HD</td><td align="left">PB</td><td align="left">Heparin</td><td align="left">M</td><td align="left">38</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq112"><alternatives><tex-math id="M239">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{6}$$\end{document}</tex-math><mml:math id="M240"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>6</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq112.gif"/></alternatives></inline-formula></td><td align="left">2</td><td align="left">HD</td><td align="left">PB</td><td align="left">Heparin</td><td align="left">F</td><td align="left">27</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq113"><alternatives><tex-math id="M241">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{7}$$\end{document}</tex-math><mml:math id="M242"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>7</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq113.gif"/></alternatives></inline-formula></td><td align="left">2</td><td align="left">HD</td><td align="left">PB</td><td align="left">Heparin</td><td align="left">F</td><td align="left">NA</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq114"><alternatives><tex-math id="M243">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{8}$$\end{document}</tex-math><mml:math id="M244"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>8</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq114.gif"/></alternatives></inline-formula></td><td align="left">2</td><td align="left">HD</td><td align="left">PB</td><td align="left">Heparin</td><td align="left">M</td><td align="left">NA</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq115"><alternatives><tex-math id="M245">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{9}$$\end{document}</tex-math><mml:math id="M246"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>9</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq115.gif"/></alternatives></inline-formula></td><td align="left">2</td><td align="left">HD</td><td align="left">PB</td><td align="left">Heparin</td><td align="left">F</td><td align="left">NA</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq116"><alternatives><tex-math id="M247">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{10}$$\end{document}</tex-math><mml:math id="M248"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>10</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq116.gif"/></alternatives></inline-formula></td><td align="left">2</td><td align="left">HD</td><td align="left">PB</td><td align="left">Heparin</td><td align="left">F</td><td align="left">NA</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq117"><alternatives><tex-math id="M249">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{11}$$\end{document}</tex-math><mml:math id="M250"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>11</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq117.gif"/></alternatives></inline-formula></td><td align="left">3</td><td align="left">HD</td><td align="left">PB</td><td align="left">NA</td><td align="left">M</td><td align="left">34</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq118"><alternatives><tex-math id="M251">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{12}$$\end{document}</tex-math><mml:math id="M252"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>12</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq118.gif"/></alternatives></inline-formula></td><td align="left">3</td><td align="left">HD</td><td align="left">PB</td><td align="left">NA</td><td align="left">F</td><td align="left">33</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq119"><alternatives><tex-math id="M253">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{13}$$\end{document}</tex-math><mml:math id="M254"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>13</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq119.gif"/></alternatives></inline-formula></td><td align="left">3</td><td align="left">HD</td><td align="left">PB</td><td align="left">NA</td><td align="left">M</td><td align="left">32</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq120"><alternatives><tex-math id="M255">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{14}$$\end{document}</tex-math><mml:math id="M256"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>14</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq120.gif"/></alternatives></inline-formula></td><td align="left">3</td><td align="left">HD</td><td align="left">PB</td><td align="left">NA</td><td align="left">M</td><td align="left">33</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq121"><alternatives><tex-math id="M257">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{15}$$\end{document}</tex-math><mml:math id="M258"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>15</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq121.gif"/></alternatives></inline-formula></td><td align="left">3</td><td align="left">HD</td><td align="left">PB</td><td align="left">NA</td><td align="left">F</td><td align="left">35</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq122"><alternatives><tex-math id="M259">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{16}$$\end{document}</tex-math><mml:math id="M260"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>16</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq122.gif"/></alternatives></inline-formula></td><td align="left">3</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">NA</td><td align="left">Adult</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq123"><alternatives><tex-math id="M261">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{17}$$\end{document}</tex-math><mml:math id="M262"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>17</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq123.gif"/></alternatives></inline-formula></td><td align="left">3</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">NA</td><td align="left">Adult</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq124"><alternatives><tex-math id="M263">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{18}$$\end{document}</tex-math><mml:math id="M264"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>18</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq124.gif"/></alternatives></inline-formula></td><td align="left">3</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">NA</td><td align="left">Adult</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq125"><alternatives><tex-math id="M265">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{19}$$\end{document}</tex-math><mml:math id="M266"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>19</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq125.gif"/></alternatives></inline-formula></td><td align="left">3</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">NA</td><td align="left">Adult</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq126"><alternatives><tex-math id="M267">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{20}$$\end{document}</tex-math><mml:math id="M268"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>20</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq126.gif"/></alternatives></inline-formula></td><td align="left">3</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">NA</td><td align="left">Adult</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq127"><alternatives><tex-math id="M269">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{21}$$\end{document}</tex-math><mml:math id="M270"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>21</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq127.gif"/></alternatives></inline-formula></td><td align="left">NA</td><td align="left">HD</td><td align="left">NA</td><td align="left">NA</td><td align="left">NA</td><td align="left">NA</td><td align="left">NA</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq128"><alternatives><tex-math id="M271">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{22}$$\end{document}</tex-math><mml:math id="M272"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>22</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq128.gif"/></alternatives></inline-formula></td><td align="left">4</td><td align="left">MCL</td><td align="left">PB</td><td align="left">NA</td><td align="left">F</td><td align="left">82</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq129"><alternatives><tex-math id="M273">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{23}$$\end{document}</tex-math><mml:math id="M274"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>23</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq129.gif"/></alternatives></inline-formula></td><td align="left">4</td><td align="left">MCL</td><td align="left">PB</td><td align="left">NA</td><td align="left">M</td><td align="left">70</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq130"><alternatives><tex-math id="M275">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{24}$$\end{document}</tex-math><mml:math id="M276"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>24</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq130.gif"/></alternatives></inline-formula></td><td align="left">4</td><td align="left">FL</td><td align="left">BM</td><td align="left">NA</td><td align="left">M</td><td align="left">52</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq131"><alternatives><tex-math id="M277">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{25}$$\end{document}</tex-math><mml:math id="M278"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>25</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq131.gif"/></alternatives></inline-formula></td><td align="left">4</td><td align="left">MCL</td><td align="left">BM</td><td align="left">NA</td><td align="left">M</td><td align="left">81</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq132"><alternatives><tex-math id="M279">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{26}$$\end{document}</tex-math><mml:math id="M280"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>26</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq132.gif"/></alternatives></inline-formula></td><td align="left">4</td><td align="left">LPL</td><td align="left">PB</td><td align="left">NA</td><td align="left">M</td><td align="left">67</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq133"><alternatives><tex-math id="M281">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{27}$$\end{document}</tex-math><mml:math id="M282"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>27</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq133.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">CLL</td><td align="left">LN</td><td align="left">Other</td><td align="left">F</td><td align="left">61</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq134"><alternatives><tex-math id="M283">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{28}$$\end{document}</tex-math><mml:math id="M284"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>28</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq134.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">CLL</td><td align="left">LN</td><td align="left">Other</td><td align="left">F</td><td align="left">61</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq135"><alternatives><tex-math id="M285">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{29}$$\end{document}</tex-math><mml:math id="M286"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>29</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq135.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">F</td><td align="left">27</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq136"><alternatives><tex-math id="M287">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{30}$$\end{document}</tex-math><mml:math id="M288"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>30</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq136.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">M</td><td align="left">54</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq137"><alternatives><tex-math id="M289">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{31}$$\end{document}</tex-math><mml:math id="M290"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>31</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq137.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">M</td><td align="left">50</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq138"><alternatives><tex-math id="M291">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{32}$$\end{document}</tex-math><mml:math id="M292"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>32</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq138.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">F</td><td align="left">36</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq139"><alternatives><tex-math id="M293">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{33}$$\end{document}</tex-math><mml:math id="M294"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>33</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq139.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">M</td><td align="left">74</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq140"><alternatives><tex-math id="M295">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{34}$$\end{document}</tex-math><mml:math id="M296"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>34</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq140.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">DLBCL</td><td align="left">Other</td><td align="left">Other</td><td align="left">M</td><td align="left">65</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq141"><alternatives><tex-math id="M297">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{35}$$\end{document}</tex-math><mml:math id="M298"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>35</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq141.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">HCL</td><td align="left">BM</td><td align="left">EDTA</td><td align="left">M</td><td align="left">40</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq142"><alternatives><tex-math id="M299">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{36}$$\end{document}</tex-math><mml:math id="M300"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>36</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq142.gif"/></alternatives></inline-formula></td><td align="left">2</td><td align="left">HD</td><td align="left">PB</td><td align="left">Heparin</td><td align="left">M</td><td align="left">38</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq143"><alternatives><tex-math id="M301">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{37}$$\end{document}</tex-math><mml:math id="M302"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>37</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq143.gif"/></alternatives></inline-formula></td><td align="left">2</td><td align="left">HD</td><td align="left">PB</td><td align="left">Heparin</td><td align="left">F</td><td align="left">27</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq144"><alternatives><tex-math id="M303">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{38}$$\end{document}</tex-math><mml:math id="M304"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>38</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq144.gif"/></alternatives></inline-formula></td><td align="left">2</td><td align="left">HD</td><td align="left">PB</td><td align="left">Heparin</td><td align="left">M</td><td align="left">NA</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq145"><alternatives><tex-math id="M305">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{39}$$\end{document}</tex-math><mml:math id="M306"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>39</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq145.gif"/></alternatives></inline-formula></td><td align="left">2</td><td align="left">HD</td><td align="left">PB</td><td align="left">Heparin</td><td align="left">F</td><td align="left">NA</td><td align="left">30</td><td align="left">BD FACSCanto</td></tr><tr><td align="left"><inline-formula id="IEq146"><alternatives><tex-math id="M307">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{40}$$\end{document}</tex-math><mml:math id="M308"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>40</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq146.gif"/></alternatives></inline-formula></td><td align="left">3</td><td align="left">HD</td><td align="left">PB</td><td align="left">EDTA</td><td align="left">NA</td><td align="left">NA</td><td align="left">15</td><td align="left">BD FACSCanto</td></tr></tbody></table><table-wrap-foot><p>Samples come from four international centers labelled as 1–4. Diagnosis abbreviations correspond to: healthy diagnosis, mantle cell lymphoma, follicular lymphoma, lymphoplasmacytic lymphoma, chronic lymphocytic leukemia, diffuse large B-cell lymphoma and hairy cell leukemia. The abbreviations for the type of tested samples correspond to: peripherial blood, bone marrow, lymph node. Coagulant refers to the type of coagulant used for preservation of the sample. The incubation period is measured in minutes</p></table-wrap-foot></table-wrap></p>
    </sec>
    <sec id="Sec9">
      <title>Measures of performance</title>
      <p id="Par67">We need appropriate methods to measure the performance of the different automated gating procedures that appear in this work. We recall that we use both unsupervised and supervised methods. In this setup an appropriate tool is the <italic>F-measure</italic> statistic which has been used in [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR3">3</xref>, <xref ref-type="bibr" rid="CR9">9</xref>, <xref ref-type="bibr" rid="CR10">10</xref>]. With our notation we have<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M309">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned}&amp;F({\mathcal {C}}^i,{\mathcal {C}}^j)=\sum _{k=1,\dots ,|{\mathcal {C}}^i|} \frac{|{\mathcal {C}}^i_k|}{M}\max _{l=1,\dots ,|{\mathcal {C}}^j|}F({\mathcal {C}}^i_k, {\mathcal {C}}^j_l), \end{aligned}$$\end{document}</tex-math><mml:math id="M310" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mi>F</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow><mml:mi>M</mml:mi></mml:mfrac><mml:munder><mml:mo movablelimits="true">max</mml:mo><mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mi>F</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M311">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned}&amp;F({\mathcal {C}}^i_k,{\mathcal {C}}^j_l) = 2\frac{R({\mathcal {C}}^i_k,{\mathcal {C}}^j_l) P({\mathcal {C}}^i_k,{\mathcal {C}}^j_l)}{R({\mathcal {C}}^i_k,{\mathcal {C}}^j_l) + P({\mathcal {C}}^i_k,{\mathcal {C}}^j_l)}, \end{aligned}$$\end{document}</tex-math><mml:math id="M312" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mi>F</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mfrac><mml:mrow><mml:mi>R</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>R</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M313">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned}&amp;R({\mathcal {C}}^i_k,{\mathcal {C}}^j_l) = \frac{|{\mathcal {C}}^i_k \cap {\mathcal {C}}^j_l|}{|{\mathcal {C}}^i_k|}\quad \text {and} \quad P({\mathcal {C}}^i_k,{\mathcal {C}}^j_l) = \frac{|{\mathcal {C}}^i_k \cap {\mathcal {C}}^j_l|}{|{\mathcal {C}}^j_l|} \end{aligned}$$\end{document}</tex-math><mml:math id="M314" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mi>R</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>∩</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mspace width="1em"/><mml:mtext>and</mml:mtext><mml:mspace width="1em"/><mml:mi>P</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>∩</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>with <inline-formula id="IEq147"><alternatives><tex-math id="M315">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$M= \sum _{k=1,\dots ,|{\mathcal {C}}^i|}|{\mathcal {C}}^i_k|=\sum _{l=1,\dots ,|{\mathcal {C}}^j|}|{\mathcal {C}}^j_l|$$\end{document}</tex-math><mml:math id="M316"><mml:mrow><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo>=</mml:mo></mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq147.gif"/></alternatives></inline-formula>. We make the convention <inline-formula id="IEq148"><alternatives><tex-math id="M317">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R(\emptyset ,{\mathcal {C}}^j_l) = P({\mathcal {C}}^i_k,\emptyset ) = 1$$\end{document}</tex-math><mml:math id="M318"><mml:mrow><mml:mi>R</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="normal">∅</mml:mi><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mi mathvariant="normal">∅</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq148.gif"/></alternatives></inline-formula> and <inline-formula id="IEq149"><alternatives><tex-math id="M319">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R({\mathcal {C}}^i_k,\emptyset ) =P(\emptyset ,{\mathcal {C}}^j_l) = 0$$\end{document}</tex-math><mml:math id="M320"><mml:mrow><mml:mi>R</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mi mathvariant="normal">∅</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="normal">∅</mml:mi><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq149.gif"/></alternatives></inline-formula>. Another appealing measure is the <italic>median F-measure</italic> used in [<xref ref-type="bibr" rid="CR11">11</xref>] specifically for supervised learning. The formal definition is<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M321">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned}&amp;{\tilde{F}}({\mathcal {C}}^i,{\mathcal {C}}^j) =\mathrm {median}\Big \{\big \{F({\mathcal {C}}^i_k,{\mathcal {C}}^j_{k*}):\nonumber \\&amp;k \text { such that } L^i_k=L^j_{k^*}\in L^i\cap L^j\big \}, \{0\}\times |L^i\triangle L^k|\Big \} \end{aligned}$$\end{document}</tex-math><mml:math id="M322" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mover accent="true"><mml:mi>F</mml:mi><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">median</mml:mi><mml:mrow><mml:mo maxsize="1.623em" minsize="1.623em" stretchy="true">{</mml:mo></mml:mrow><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em" stretchy="true">{</mml:mo></mml:mrow><mml:mi>F</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mrow/><mml:mo>∗</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>:</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow/></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mi>k</mml:mi><mml:mspace width="0.333333em"/><mml:mtext>such that</mml:mtext><mml:mspace width="0.333333em"/><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>L</mml:mi><mml:msup><mml:mi>k</mml:mi><mml:mo>∗</mml:mo></mml:msup><mml:mi>j</mml:mi></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:msup><mml:mo>∩</mml:mo><mml:msup><mml:mi>L</mml:mi><mml:mi>j</mml:mi></mml:msup><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em" stretchy="true">}</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:msup><mml:mi>▵</mml:mi><mml:msup><mml:mi>L</mml:mi><mml:mi>k</mml:mi></mml:msup><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo maxsize="1.623em" minsize="1.623em" stretchy="true">}</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq150"><alternatives><tex-math id="M323">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^i$$\end{document}</tex-math><mml:math id="M324"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq150.gif"/></alternatives></inline-formula> is the ground truth, in our case a manual gating, and <inline-formula id="IEq151"><alternatives><tex-math id="M325">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^j$$\end{document}</tex-math><mml:math id="M326"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq151.gif"/></alternatives></inline-formula> is the classification obtained for the same data.</p>
    </sec>
    <sec id="Sec10">
      <title>Clustering cytometries and template obtention</title>
      <p id="Par68">We want to compare different methods for clustering a database. For a state-of-the-art comparison, we use flowMatch [<xref ref-type="bibr" rid="CR13">13</xref>]. Notice that flowMatch is based on a GEC procedure, a generalization of bipartite matching, where the cost between partitions is given by<fig id="Fig5"><label>Fig. 5</label><caption><p>Hierarchical trees for the healthyFlowData. First column: result of optimalFlowTemplates for single linkage (top), average linkage (middle) and complete linkage (bottom). Second column: result of flowMatch with Euclidean distance (top), Mahalanobis distance (middle) and Kullback–Libler divergence (bottom)</p></caption><graphic xlink:href="12859_2020_3795_Fig5_HTML" id="MO22"/></fig><fig id="Fig6"><label>Fig. 6</label><caption><p>Hierarchical trees for <inline-formula id="IEq152"><alternatives><tex-math id="M327">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {DB}$$\end{document}</tex-math><mml:math id="M328"><mml:mi mathvariant="script">DB</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq152.gif"/></alternatives></inline-formula>. First row: result of optimalFlowTemplates for complete linkage. Second row: result of flowMatch with Mahalanobis distance (left) and Kullback–Libler divergence (right)</p></caption><graphic xlink:href="12859_2020_3795_Fig6_HTML" id="MO23"/></fig><disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M329">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} d({\mathcal {C}}^i,{\mathcal {C}}^j)=\frac{1}{k_ik_j}\sum _{k=1}^{k_i} \sum _{l=1}^{k_j}d_{KL}({\mathcal {C}}^i_k,{\mathcal {C}}^j_l), \end{aligned}$$\end{document}</tex-math><mml:math id="M330" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:munderover><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:munderover><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">KL</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq153"><alternatives><tex-math id="M331">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_{KL}$$\end{document}</tex-math><mml:math id="M332"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">KL</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq153.gif"/></alternatives></inline-formula> is as in (<xref rid="Equ4" ref-type="">4</xref>), or<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M333">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} d({\mathcal {C}}^i,{\mathcal {C}}^j)=\frac{1}{k_ik_j}\sum _{k=1}^{k_i} \sum _{l=1}^{k_j}d_{Mahalanobis}(N(m^i_k, S^i_k),N(m^j_l, S^j_l)), \end{aligned}$$\end{document}</tex-math><mml:math id="M334" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:munderover><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:munderover><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">Mahalanobis</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2020_3795_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq154"><alternatives><tex-math id="M335">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_{Mahalanobis}$$\end{document}</tex-math><mml:math id="M336"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">Mahalanobis</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq154.gif"/></alternatives></inline-formula> is the well-known Mahalanobis distance between multivariate normals.</p>
      <p id="Par69">For a comparison with different variability sources and a clear ground truth we cluster the healtyFlowData and present the results in Fig. <xref rid="Fig5" ref-type="fig">5</xref>. The left column presents the results when we use optimalFlowTemplates, or equivalently when we use similarity distance as a distance between cytometries. The right column presents the results when using flowMatch and distances between cytometries given by (<xref rid="Equ12" ref-type="">12</xref>) and (<xref rid="Equ11" ref-type="">11</xref>) and an appropriate Euclidean distance-based modification. In Fig. <xref rid="Fig6" ref-type="fig">6</xref> we present a similar procedure but for the training set <inline-formula id="IEq155"><alternatives><tex-math id="M337">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {DB}$$\end{document}</tex-math><mml:math id="M338"><mml:mi mathvariant="script">DB</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq155.gif"/></alternatives></inline-formula> of our first dataset.</p>
      <p id="Par70">In Table <xref rid="Tab2" ref-type="table">2</xref> we see two different clusterings obtained when using optimalFlowTemplates. We recall that HDBSCAN automatically selects the number of clusters. We also stress that the clustering obtained from complete linkage comes from the appropriate pruning of the tree shown top in Fig. <xref rid="Fig6" ref-type="fig">6</xref>.</p>
      <p id="Par71">We notice that <inline-formula id="IEq156"><alternatives><tex-math id="M339">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {DB}$$\end{document}</tex-math><mml:math id="M340"><mml:mi mathvariant="script">DB</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq156.gif"/></alternatives></inline-formula> is relabelled from 1 to 27 as shown in the first row in Table <xref rid="Tab2" ref-type="table">2</xref> and these are the labels used in Fig. <xref rid="Fig6" ref-type="fig">6</xref>. Let us stress that labels <inline-formula id="IEq157"><alternatives><tex-math id="M341">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{14,15,16,17,18,22,23\}$$\end{document}</tex-math><mml:math id="M342"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mn>14</mml:mn><mml:mo>,</mml:mo><mml:mn>15</mml:mn><mml:mo>,</mml:mo><mml:mn>16</mml:mn><mml:mo>,</mml:mo><mml:mn>17</mml:mn><mml:mo>,</mml:mo><mml:mn>18</mml:mn><mml:mo>,</mml:mo><mml:mn>22</mml:mn><mml:mo>,</mml:mo><mml:mn>23</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq157.gif"/></alternatives></inline-formula> correspond to the cytometries <inline-formula id="IEq158"><alternatives><tex-math id="M343">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}^{22}, {\mathcal {C}}^{23}, {\mathcal {C}}^{24},{\mathcal {C}}^{25},{\mathcal {C}}^{28}, {\mathcal {C}}^{34},{\mathcal {C}}^{35}\}$$\end{document}</tex-math><mml:math id="M344"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>22</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>23</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>24</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>25</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>28</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>34</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>35</mml:mn></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq158.gif"/></alternatives></inline-formula> that represent individuals with cancer.<table-wrap id="Tab2"><label>Table 2</label><caption><p>Clustering of the cytometries in <inline-formula id="IEq159"><alternatives><tex-math id="M345">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {DB}$$\end{document}</tex-math><mml:math id="M346"><mml:mi mathvariant="script">DB</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq159.gif"/></alternatives></inline-formula> obtained using optimalFlowTemplates with complete linkage hierarchical clustering looking for 7 clusters and using HDBSCAN</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" rowspan="2">ID</th><th align="left" rowspan="2">Cytometry</th><th align="left" colspan="2">Cluster</th></tr><tr><th align="left">Comp.-Link.</th><th align="left">HDBSCAN</th></tr></thead><tbody><tr><td align="left">1</td><td align="left"><inline-formula id="IEq160"><alternatives><tex-math id="M347">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{1}$$\end{document}</tex-math><mml:math id="M348"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq160.gif"/></alternatives></inline-formula></td><td char="." align="char">1</td><td char="." align="char">1</td></tr><tr><td align="left">2</td><td align="left"><inline-formula id="IEq161"><alternatives><tex-math id="M349">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{3}$$\end{document}</tex-math><mml:math id="M350"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq161.gif"/></alternatives></inline-formula></td><td char="." align="char">2</td><td char="." align="char">6</td></tr><tr><td align="left">3</td><td align="left"><inline-formula id="IEq162"><alternatives><tex-math id="M351">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{4}$$\end{document}</tex-math><mml:math id="M352"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>4</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq162.gif"/></alternatives></inline-formula></td><td char="." align="char">2</td><td char="." align="char">6</td></tr><tr><td align="left">4</td><td align="left"><inline-formula id="IEq163"><alternatives><tex-math id="M353">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{6}$$\end{document}</tex-math><mml:math id="M354"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>6</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq163.gif"/></alternatives></inline-formula></td><td char="." align="char">2</td><td char="." align="char">6</td></tr><tr><td align="left">5</td><td align="left"><inline-formula id="IEq164"><alternatives><tex-math id="M355">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{8}$$\end{document}</tex-math><mml:math id="M356"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>8</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq164.gif"/></alternatives></inline-formula></td><td char="." align="char">2</td><td char="." align="char">6</td></tr><tr><td align="left">6</td><td align="left"><inline-formula id="IEq165"><alternatives><tex-math id="M357">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{10}$$\end{document}</tex-math><mml:math id="M358"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>10</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq165.gif"/></alternatives></inline-formula></td><td char="." align="char">1</td><td char="." align="char">8</td></tr><tr><td align="left">7</td><td align="left"><inline-formula id="IEq166"><alternatives><tex-math id="M359">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{11}$$\end{document}</tex-math><mml:math id="M360"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>11</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq166.gif"/></alternatives></inline-formula></td><td char="." align="char">1</td><td char="." align="char">9</td></tr><tr><td align="left">8</td><td align="left"><inline-formula id="IEq167"><alternatives><tex-math id="M361">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{12}$$\end{document}</tex-math><mml:math id="M362"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>12</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq167.gif"/></alternatives></inline-formula></td><td char="." align="char">1</td><td char="." align="char">8</td></tr><tr><td align="left">9</td><td align="left"><inline-formula id="IEq168"><alternatives><tex-math id="M363">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{13}$$\end{document}</tex-math><mml:math id="M364"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>13</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq168.gif"/></alternatives></inline-formula></td><td char="." align="char">1</td><td char="." align="char">9</td></tr><tr><td align="left">10</td><td align="left"><inline-formula id="IEq169"><alternatives><tex-math id="M365">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{16}$$\end{document}</tex-math><mml:math id="M366"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>16</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq169.gif"/></alternatives></inline-formula></td><td char="." align="char">3</td><td char="." align="char">6</td></tr><tr><td align="left">11</td><td align="left"><inline-formula id="IEq170"><alternatives><tex-math id="M367">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{19}$$\end{document}</tex-math><mml:math id="M368"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>19</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq170.gif"/></alternatives></inline-formula></td><td char="." align="char">3</td><td char="." align="char">7</td></tr><tr><td align="left">12</td><td align="left"><inline-formula id="IEq171"><alternatives><tex-math id="M369">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{20}$$\end{document}</tex-math><mml:math id="M370"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>20</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq171.gif"/></alternatives></inline-formula></td><td char="." align="char">3</td><td char="." align="char">7</td></tr><tr><td align="left">13</td><td align="left"><inline-formula id="IEq172"><alternatives><tex-math id="M371">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{21}$$\end{document}</tex-math><mml:math id="M372"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>21</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq172.gif"/></alternatives></inline-formula></td><td char="." align="char">4</td><td char="." align="char">7</td></tr><tr><td align="left">14</td><td align="left"><inline-formula id="IEq173"><alternatives><tex-math id="M373">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{22}$$\end{document}</tex-math><mml:math id="M374"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>22</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq173.gif"/></alternatives></inline-formula></td><td char="." align="char">4</td><td char="." align="char">2</td></tr><tr><td align="left">15</td><td align="left"><inline-formula id="IEq174"><alternatives><tex-math id="M375">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{23}$$\end{document}</tex-math><mml:math id="M376"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>23</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq174.gif"/></alternatives></inline-formula></td><td char="." align="char">4</td><td char="." align="char">2</td></tr><tr><td align="left">16</td><td align="left"><inline-formula id="IEq175"><alternatives><tex-math id="M377">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{24}$$\end{document}</tex-math><mml:math id="M378"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>24</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq175.gif"/></alternatives></inline-formula></td><td char="." align="char">4</td><td char="." align="char">2</td></tr><tr><td align="left">17</td><td align="left"><inline-formula id="IEq176"><alternatives><tex-math id="M379">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{25}$$\end{document}</tex-math><mml:math id="M380"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>25</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq176.gif"/></alternatives></inline-formula></td><td char="." align="char">4</td><td char="." align="char">2</td></tr><tr><td align="left">18</td><td align="left"><inline-formula id="IEq177"><alternatives><tex-math id="M381">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{28}$$\end{document}</tex-math><mml:math id="M382"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>28</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq177.gif"/></alternatives></inline-formula></td><td char="." align="char">5</td><td char="." align="char">3</td></tr><tr><td align="left">19</td><td align="left"><inline-formula id="IEq178"><alternatives><tex-math id="M383">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{30}$$\end{document}</tex-math><mml:math id="M384"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>30</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq178.gif"/></alternatives></inline-formula></td><td char="." align="char">6</td><td char="." align="char">4</td></tr><tr><td align="left">20</td><td align="left"><inline-formula id="IEq179"><alternatives><tex-math id="M385">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{32}$$\end{document}</tex-math><mml:math id="M386"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>32</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq179.gif"/></alternatives></inline-formula></td><td char="." align="char">6</td><td char="." align="char">4</td></tr><tr><td align="left">21</td><td align="left"><inline-formula id="IEq180"><alternatives><tex-math id="M387">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{33}$$\end{document}</tex-math><mml:math id="M388"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>33</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq180.gif"/></alternatives></inline-formula></td><td char="." align="char">6</td><td char="." align="char">4</td></tr><tr><td align="left">22</td><td align="left"><inline-formula id="IEq181"><alternatives><tex-math id="M389">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{34}$$\end{document}</tex-math><mml:math id="M390"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>34</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq181.gif"/></alternatives></inline-formula></td><td char="." align="char">5</td><td char="." align="char">3</td></tr><tr><td align="left">23</td><td align="left"><inline-formula id="IEq182"><alternatives><tex-math id="M391">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{35}$$\end{document}</tex-math><mml:math id="M392"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>35</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq182.gif"/></alternatives></inline-formula></td><td char="." align="char">7</td><td char="." align="char">3</td></tr><tr><td align="left">24</td><td align="left"><inline-formula id="IEq183"><alternatives><tex-math id="M393">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{36}$$\end{document}</tex-math><mml:math id="M394"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>36</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq183.gif"/></alternatives></inline-formula></td><td char="." align="char">6</td><td char="." align="char">5</td></tr><tr><td align="left">25</td><td align="left"><inline-formula id="IEq184"><alternatives><tex-math id="M395">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{37}$$\end{document}</tex-math><mml:math id="M396"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>37</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq184.gif"/></alternatives></inline-formula></td><td char="." align="char">6</td><td char="." align="char">5</td></tr><tr><td align="left">26</td><td align="left"><inline-formula id="IEq185"><alternatives><tex-math id="M397">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{38}$$\end{document}</tex-math><mml:math id="M398"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>38</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq185.gif"/></alternatives></inline-formula></td><td char="." align="char">6</td><td char="." align="char">5</td></tr><tr><td align="left">27</td><td align="left"><inline-formula id="IEq186"><alternatives><tex-math id="M399">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{39}$$\end{document}</tex-math><mml:math id="M400"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>39</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq186.gif"/></alternatives></inline-formula></td><td char="." align="char">6</td><td char="." align="char">5</td></tr></tbody></table></table-wrap></p>
    </sec>
    <sec id="Sec11">
      <title>Gating and classification</title>
      <p id="Par72">We will use the results of optimalFlowTemplates applied to the database <inline-formula id="IEq187"><alternatives><tex-math id="M401">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {DB}$$\end{document}</tex-math><mml:math id="M402"><mml:mi mathvariant="script">DB</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq187.gif"/></alternatives></inline-formula>, introduced in the previous section, as entries to optimalFlowClassification to automatically perform gating in <inline-formula id="IEq188"><alternatives><tex-math id="M403">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}$$\end{document}</tex-math><mml:math id="M404"><mml:mi mathvariant="script">TS</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq188.gif"/></alternatives></inline-formula>. For the cytometries in <inline-formula id="IEq189"><alternatives><tex-math id="M405">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}$$\end{document}</tex-math><mml:math id="M406"><mml:mi mathvariant="script">TS</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq189.gif"/></alternatives></inline-formula>, we also perform an unsupervised gating given by flowMeans. Results are shown in the first and last columns of Table <xref rid="Tab3" ref-type="table">3</xref>.</p>
      <p id="Par73">We also compare our methods with a state-of-the-art supervised procedure. In this case we will use DeepCyTOF, with some bug corrections and some adaptations to our setting of the Github version, implemented in Python with <italic>tensorflow</italic> 0.12 and <italic>keras</italic> 1.2.2. To use DeepCyTOF we need cytometries with the same number and types of cells, so we use a data set <inline-formula id="IEq190"><alternatives><tex-math id="M407">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}' = \{{\mathcal {C}}^{2'},{\mathcal {C}}^{5'},{\mathcal {C}}^{7'},{\mathcal {C}}^{14'},{\mathcal {C}}^{15'},{\mathcal {C}}^{17'},{\mathcal {C}}^{18'}\}$$\end{document}</tex-math><mml:math id="M408"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>2</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>5</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>7</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>14</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>15</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>17</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>18</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq190.gif"/></alternatives></inline-formula>, where we have extracted the common groups from the original cytometries. Hence, comparisons in Table <xref rid="Tab3" ref-type="table">3</xref> are biased in favour of DeepCyTOF, since for optimalFlowClassification we use the original complete cytometries. We want to emphasize that DeepCyTOF only uses the supervised information from one of the cytometries in <inline-formula id="IEq191"><alternatives><tex-math id="M409">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'$$\end{document}</tex-math><mml:math id="M410"><mml:msup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq191.gif"/></alternatives></inline-formula> to classify all the others. This is shown in Table <xref rid="Tab3" ref-type="table">3</xref> in italic. Results of DeepCyTOF are provided, with domain adaptation and without de-noising, since all entries are classified, in column 2 of Table <xref rid="Tab3" ref-type="table">3</xref>.<table-wrap id="Tab3"><label>Table 3</label><caption><p>Table of F-measure statistics as given by (<xref rid="Equ7" ref-type="">7</xref>), where we use the manual gating as the ground truth</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left">flowMeans</th><th align="left">DeepCyTOF</th><th align="left">optimalFlowTemplates + DeepCyTOF</th><th align="left">optimalFlowTemplates + optimalFlowClassification</th></tr></thead><tbody><tr><td align="left"><inline-formula id="IEq192"><alternatives><tex-math id="M411">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^2$$\end{document}</tex-math><mml:math id="M412"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq192.gif"/></alternatives></inline-formula></td><td char="." align="char">0.8988</td><td char="." align="char">0.9546</td><td char="." align="char"><italic><underline>0.9736</underline></italic></td><td char="." align="char">0.9610</td></tr><tr><td align="left"><inline-formula id="IEq193"><alternatives><tex-math id="M413">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^5$$\end{document}</tex-math><mml:math id="M414"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>5</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq193.gif"/></alternatives></inline-formula></td><td char="." align="char">0.8977</td><td char="." align="char">0.9161</td><td char="." align="char">0.9196</td><td char="." align="char"><underline>0.9587</underline></td></tr><tr><td align="left"><inline-formula id="IEq194"><alternatives><tex-math id="M415">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^7$$\end{document}</tex-math><mml:math id="M416"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>7</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq194.gif"/></alternatives></inline-formula></td><td char="." align="char">0.9508</td><td char="." align="char">0.7514</td><td char="." align="char"><italic><underline>0.9769</underline></italic></td><td char="." align="char">0.9768</td></tr><tr><td align="left"><inline-formula id="IEq195"><alternatives><tex-math id="M417">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^9$$\end{document}</tex-math><mml:math id="M418"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>9</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq195.gif"/></alternatives></inline-formula></td><td char="." align="char">0.8936</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"><underline>0.9172</underline></td></tr><tr><td align="left"><inline-formula id="IEq196"><alternatives><tex-math id="M419">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{14}$$\end{document}</tex-math><mml:math id="M420"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>14</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq196.gif"/></alternatives></inline-formula></td><td char="." align="char">0.9004</td><td char="." align="char"><italic><underline>0.9838</underline></italic></td><td char="." align="char">0.9530</td><td char="." align="char">0.9066</td></tr><tr><td align="left"><inline-formula id="IEq197"><alternatives><tex-math id="M421">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{15}$$\end{document}</tex-math><mml:math id="M422"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>15</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq197.gif"/></alternatives></inline-formula></td><td char="." align="char">0.8974</td><td char="." align="char">0.9408</td><td char="." align="char">0.9352</td><td char="." align="char"><underline>0.9556</underline></td></tr><tr><td align="left"><inline-formula id="IEq198"><alternatives><tex-math id="M423">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{17}$$\end{document}</tex-math><mml:math id="M424"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>17</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq198.gif"/></alternatives></inline-formula></td><td char="." align="char">0.9405</td><td char="." align="char">0.7847</td><td char="." align="char"><italic>0.9810</italic></td><td char="." align="char"><underline>0.9848</underline></td></tr><tr><td align="left"><inline-formula id="IEq199"><alternatives><tex-math id="M425">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{18}$$\end{document}</tex-math><mml:math id="M426"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>18</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq199.gif"/></alternatives></inline-formula></td><td char="." align="char">0.9004</td><td char="." align="char">0.7837</td><td char="." align="char">0.9796</td><td char="." align="char"><underline>0.9849</underline></td></tr><tr><td align="left"><inline-formula id="IEq200"><alternatives><tex-math id="M427">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{26}$$\end{document}</tex-math><mml:math id="M428"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>26</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq200.gif"/></alternatives></inline-formula></td><td char="." align="char">0.9024</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"><underline>0.9313</underline></td></tr><tr><td align="left"><inline-formula id="IEq201"><alternatives><tex-math id="M429">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{27}$$\end{document}</tex-math><mml:math id="M430"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>27</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq201.gif"/></alternatives></inline-formula></td><td char="." align="char">0.8645</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"><underline>0.9306</underline></td></tr><tr><td align="left"><inline-formula id="IEq202"><alternatives><tex-math id="M431">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{29}$$\end{document}</tex-math><mml:math id="M432"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>29</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq202.gif"/></alternatives></inline-formula></td><td char="." align="char">0.9475</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"><underline>0.9744</underline></td></tr><tr><td align="left"><inline-formula id="IEq203"><alternatives><tex-math id="M433">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{31}$$\end{document}</tex-math><mml:math id="M434"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>31</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq203.gif"/></alternatives></inline-formula></td><td char="." align="char">0.9290</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"><underline>0.9656</underline></td></tr><tr><td align="left"><inline-formula id="IEq204"><alternatives><tex-math id="M435">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{40}$$\end{document}</tex-math><mml:math id="M436"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>40</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq204.gif"/></alternatives></inline-formula></td><td char="." align="char">0.9330</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"><underline>0.9538</underline></td></tr></tbody></table><table-wrap-foot><p>First column: results of the unsupervised gating procedure flowMeans on <inline-formula id="IEq205"><alternatives><tex-math id="M437">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}$$\end{document}</tex-math><mml:math id="M438"><mml:mi mathvariant="script">TS</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq205.gif"/></alternatives></inline-formula>. Second column: results of the supervised procedure DeepCyTOF on <inline-formula id="IEq206"><alternatives><tex-math id="M439">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'$$\end{document}</tex-math><mml:math id="M440"><mml:msup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq206.gif"/></alternatives></inline-formula>. Third column, results of DeepCyTOF on the clusters <inline-formula id="IEq207"><alternatives><tex-math id="M441">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'_1$$\end{document}</tex-math><mml:math id="M442"><mml:msubsup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mo>′</mml:mo></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq207.gif"/></alternatives></inline-formula>, <inline-formula id="IEq208"><alternatives><tex-math id="M443">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'_2$$\end{document}</tex-math><mml:math id="M444"><mml:msubsup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mn>2</mml:mn><mml:mo>′</mml:mo></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq208.gif"/></alternatives></inline-formula> and <inline-formula id="IEq209"><alternatives><tex-math id="M445">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'_3$$\end{document}</tex-math><mml:math id="M446"><mml:msubsup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mn>3</mml:mn><mml:mo>′</mml:mo></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq209.gif"/></alternatives></inline-formula> produced by optimalFlowTemplates. Forth column: results of our supervised procedure optimalFlowTemplates + optimalFlowClassification on <inline-formula id="IEq210"><alternatives><tex-math id="M447">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}$$\end{document}</tex-math><mml:math id="M448"><mml:mi mathvariant="script">TS</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq210.gif"/></alternatives></inline-formula>. In underline we have the best performance according to the F-measure</p></table-wrap-foot></table-wrap></p>
      <p id="Par74">We see that DeepCyTOF performs rather poorly for <inline-formula id="IEq211"><alternatives><tex-math id="M449">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}^{7'},{\mathcal {C}}^{17'},{\mathcal {C}}^{18'}\}$$\end{document}</tex-math><mml:math id="M450"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>7</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>17</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>18</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq211.gif"/></alternatives></inline-formula> due to the high variability of the cytometries in <inline-formula id="IEq212"><alternatives><tex-math id="M451">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'$$\end{document}</tex-math><mml:math id="M452"><mml:msup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq212.gif"/></alternatives></inline-formula>, which cannot be accommodated by DeepCyTOF’s domain adaptation procedure. Hence, if we were able to reduce this variability, DeepCyTOF should give better results. Indeed, if we use flowMeans to gate the cytometries in <inline-formula id="IEq213"><alternatives><tex-math id="M453">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'$$\end{document}</tex-math><mml:math id="M454"><mml:msup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq213.gif"/></alternatives></inline-formula>, and then we use optimalFlowTemplates, we obtain the hierarchical tree presented in Fig. <xref rid="Fig7" ref-type="fig">7</xref>. It suggests splitting <inline-formula id="IEq214"><alternatives><tex-math id="M455">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'$$\end{document}</tex-math><mml:math id="M456"><mml:msup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq214.gif"/></alternatives></inline-formula> into <inline-formula id="IEq215"><alternatives><tex-math id="M457">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'_1=\{{\mathcal {C}}^{2'},{\mathcal {C}}^{14'}\}$$\end{document}</tex-math><mml:math id="M458"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mo>′</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>2</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>14</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq215.gif"/></alternatives></inline-formula>, <inline-formula id="IEq216"><alternatives><tex-math id="M459">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'_2=\{{\mathcal {C}}^{5'},{\mathcal {C}}^{7'},{\mathcal {C}}^{15'}\}$$\end{document}</tex-math><mml:math id="M460"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mn>2</mml:mn><mml:mo>′</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>5</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>7</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>15</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq216.gif"/></alternatives></inline-formula> and <inline-formula id="IEq217"><alternatives><tex-math id="M461">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'_3=\{{\mathcal {C}}^{17'},{\mathcal {C}}^{18'}\}$$\end{document}</tex-math><mml:math id="M462"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mn>3</mml:mn><mml:mo>′</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>17</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>18</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq217.gif"/></alternatives></inline-formula>. We highlight that until now we have not used any supervised information. Applying DeepCyTOF to <inline-formula id="IEq218"><alternatives><tex-math id="M463">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'_1$$\end{document}</tex-math><mml:math id="M464"><mml:msubsup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mo>′</mml:mo></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq218.gif"/></alternatives></inline-formula>, <inline-formula id="IEq219"><alternatives><tex-math id="M465">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'_2$$\end{document}</tex-math><mml:math id="M466"><mml:msubsup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mn>2</mml:mn><mml:mo>′</mml:mo></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq219.gif"/></alternatives></inline-formula> and <inline-formula id="IEq220"><alternatives><tex-math id="M467">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'_3$$\end{document}</tex-math><mml:math id="M468"><mml:msubsup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mn>3</mml:mn><mml:mo>′</mml:mo></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq220.gif"/></alternatives></inline-formula> we obtain the results in column 3 of Table <xref rid="Tab3" ref-type="table">3</xref>. Again, in italic we have the cytometry which DeepCyTOF uses for learning in each group.<table-wrap id="Tab4"><label>Table 4</label><caption><p>Parameters and performance (as measured by (<xref rid="Equ10" ref-type="">10</xref>) and manual gating as ground truth) of the best results obtained by optimalFlowTemplates + optimalFlowClassification on <inline-formula id="IEq221"><alternatives><tex-math id="M469">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}$$\end{document}</tex-math><mml:math id="M470"><mml:mi mathvariant="script">TS</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq221.gif"/></alternatives></inline-formula></p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"><inline-formula id="IEq222"><alternatives><tex-math id="M471">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^2$$\end{document}</tex-math><mml:math id="M472"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq222.gif"/></alternatives></inline-formula></th><th align="left"><inline-formula id="IEq223"><alternatives><tex-math id="M473">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{5}$$\end{document}</tex-math><mml:math id="M474"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>5</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq223.gif"/></alternatives></inline-formula></th><th align="left"><inline-formula id="IEq224"><alternatives><tex-math id="M475">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{7}$$\end{document}</tex-math><mml:math id="M476"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>7</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq224.gif"/></alternatives></inline-formula></th></tr></thead><tbody><tr><td align="left"><italic>Median F-measure</italic></td><td align="left">0.9441931</td><td align="left">0.8530806</td><td align="left">0.957045</td></tr><tr><td align="left"><italic>Database Clustering</italic></td><td align="left">Complete linkage</td><td align="left">HDBSCAN</td><td align="left">Complete linkage</td></tr><tr><td align="left"><italic>Template Formation</italic></td><td align="left">Pooling</td><td align="left">Pooling</td><td align="left">HDBSCAN</td></tr><tr><td align="left"><italic>Assigned Cluster</italic></td><td align="left">1</td><td align="left">6</td><td align="left">2</td></tr><tr><td align="left"><italic>Sample Clustering</italic></td><td align="left">tclust</td><td align="left">tclust</td><td align="left">tclust</td></tr><tr><td align="left"><italic>Supervised Classification</italic></td><td align="left">QDA</td><td align="left">QDA from template</td><td align="left">Random forest</td></tr><tr><td align="left"><italic>Assigned Cytometry</italic></td><td align="left"><inline-formula id="IEq225"><alternatives><tex-math id="M477">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{1}$$\end{document}</tex-math><mml:math id="M478"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq225.gif"/></alternatives></inline-formula></td><td align="left"/><td align="left"><inline-formula id="IEq226"><alternatives><tex-math id="M479">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{8}$$\end{document}</tex-math><mml:math id="M480"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>8</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq226.gif"/></alternatives></inline-formula></td></tr></tbody></table><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"><inline-formula id="IEq227"><alternatives><tex-math id="M481">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{9}$$\end{document}</tex-math><mml:math id="M482"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>9</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq227.gif"/></alternatives></inline-formula></th><th align="left"><inline-formula id="IEq228"><alternatives><tex-math id="M483">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{14}$$\end{document}</tex-math><mml:math id="M484"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>14</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq228.gif"/></alternatives></inline-formula></th><th align="left"><inline-formula id="IEq229"><alternatives><tex-math id="M485">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{15}$$\end{document}</tex-math><mml:math id="M486"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>15</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq229.gif"/></alternatives></inline-formula></th></tr></thead><tbody><tr><td align="left"><italic>Median F-measure</italic></td><td align="left">0.9458429</td><td align="left">0.9254252</td><td align="left">0.8807339</td></tr><tr><td align="left"><italic>Database Clustering</italic></td><td align="left">HDBSCAN</td><td align="left">HDBSCAN</td><td align="left">HDBSCAN</td></tr><tr><td align="left"><italic>Template Formation</italic></td><td align="left">Pooling</td><td align="left">k-barycenter</td><td align="left">k-barycenter</td></tr><tr><td align="left"><italic>Assigned Cluster</italic></td><td align="left">9</td><td align="left">1</td><td align="left">1</td></tr><tr><td align="left"><italic>Sample Clustering</italic></td><td align="left">tclust</td><td align="left">tclust</td><td align="left">tclust</td></tr><tr><td align="left"><italic>Supervised Classification</italic></td><td align="left">QDA</td><td align="left">Label transfer with (<xref rid="Equ6" ref-type="">6</xref>)</td><td align="left">Random forest</td></tr><tr><td align="left"><italic>Assigned Cytometry</italic></td><td align="left"><inline-formula id="IEq230"><alternatives><tex-math id="M487">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{13}$$\end{document}</tex-math><mml:math id="M488"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>13</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq230.gif"/></alternatives></inline-formula></td><td align="left"/><td align="left"><inline-formula id="IEq231"><alternatives><tex-math id="M489">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{1}$$\end{document}</tex-math><mml:math id="M490"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq231.gif"/></alternatives></inline-formula></td></tr></tbody></table><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"><inline-formula id="IEq232"><alternatives><tex-math id="M491">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{17}$$\end{document}</tex-math><mml:math id="M492"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>17</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq232.gif"/></alternatives></inline-formula></th><th align="left"><inline-formula id="IEq233"><alternatives><tex-math id="M493">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{18}$$\end{document}</tex-math><mml:math id="M494"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>18</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq233.gif"/></alternatives></inline-formula></th><th align="left"><inline-formula id="IEq234"><alternatives><tex-math id="M495">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{26}$$\end{document}</tex-math><mml:math id="M496"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>26</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq234.gif"/></alternatives></inline-formula></th></tr></thead><tbody><tr><td align="left"><italic>Median F-measure</italic></td><td align="left">0.9679446</td><td align="left">0.9575489</td><td align="left">0.8316279</td></tr><tr><td align="left"><italic>Database Clustering</italic></td><td align="left">HDBSCAN</td><td align="left">HDBSCAN</td><td align="left">Complete linkage</td></tr><tr><td align="left"><italic>Template Formation</italic></td><td align="left">HDBSCAN</td><td align="left">HDBSCAN</td><td align="left">HDBSCAN</td></tr><tr><td align="left"><italic>Assigned Cluster</italic></td><td align="left">7</td><td align="left">7</td><td align="left">4</td></tr><tr><td align="left"><italic>Sample Clustering</italic></td><td align="left">tclust</td><td align="left">flowMeans</td><td align="left">tclust</td></tr><tr><td align="left"><italic>Supervised Classification</italic></td><td align="left">Random forest</td><td align="left">Random forest</td><td align="left">Random forest</td></tr><tr><td align="left"><italic>Assigned Cytometry</italic></td><td align="left"><inline-formula id="IEq235"><alternatives><tex-math id="M497">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{20}$$\end{document}</tex-math><mml:math id="M498"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>20</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq235.gif"/></alternatives></inline-formula></td><td align="left"><inline-formula id="IEq236"><alternatives><tex-math id="M499">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{20}$$\end{document}</tex-math><mml:math id="M500"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>20</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq236.gif"/></alternatives></inline-formula></td><td align="left"><inline-formula id="IEq237"><alternatives><tex-math id="M501">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{24}$$\end{document}</tex-math><mml:math id="M502"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>24</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq237.gif"/></alternatives></inline-formula></td></tr></tbody></table><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"><inline-formula id="IEq238"><alternatives><tex-math id="M503">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{27}$$\end{document}</tex-math><mml:math id="M504"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>27</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq238.gif"/></alternatives></inline-formula></th><th align="left"><inline-formula id="IEq239"><alternatives><tex-math id="M505">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{29}$$\end{document}</tex-math><mml:math id="M506"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>29</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq239.gif"/></alternatives></inline-formula></th><th align="left"><inline-formula id="IEq240"><alternatives><tex-math id="M507">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{31}$$\end{document}</tex-math><mml:math id="M508"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>31</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq240.gif"/></alternatives></inline-formula></th></tr></thead><tbody><tr><td align="left"><italic>Median F-measure</italic></td><td align="left">0.9312977</td><td align="left">0.9259644</td><td align="left">0.931515</td></tr><tr><td align="left"><italic>Database Clustering</italic></td><td align="left">Complete linkage</td><td align="left">Complete linkage</td><td align="left">HDBSCAN</td></tr><tr><td align="left"><italic>Template Formation</italic></td><td align="left">Pooling</td><td align="left">k-barycenter</td><td align="left">Pooling</td></tr><tr><td align="left"><italic>Assigned Cluster</italic></td><td align="left">5</td><td align="left">6</td><td align="left">4</td></tr><tr><td align="left"><italic>Sample Clustering</italic></td><td align="left">tclust</td><td align="left">flowMeans</td><td align="left">tclust</td></tr><tr><td align="left"><italic>Supervised Classification</italic></td><td align="left">Random forest</td><td align="left">Random forest</td><td align="left">QDA from template</td></tr><tr><td align="left"><italic>Assigned Cytometry</italic></td><td align="left"><inline-formula id="IEq241"><alternatives><tex-math id="M509">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{28}$$\end{document}</tex-math><mml:math id="M510"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>28</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq241.gif"/></alternatives></inline-formula></td><td align="left"><inline-formula id="IEq242"><alternatives><tex-math id="M511">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{33}$$\end{document}</tex-math><mml:math id="M512"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>33</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq242.gif"/></alternatives></inline-formula></td><td align="left"/></tr></tbody></table><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left" colspan="3"><inline-formula id="IEq243"><alternatives><tex-math id="M513">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{40}$$\end{document}</tex-math><mml:math id="M514"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>40</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq243.gif"/></alternatives></inline-formula></th></tr></thead><tbody><tr><td align="left"><italic>Median F-measure</italic></td><td align="left" colspan="3">0.8240522</td></tr><tr><td align="left"><italic>Database Clustering</italic></td><td align="left" colspan="3">Complete linkage</td></tr><tr><td align="left"><italic>Template Formation</italic></td><td align="left" colspan="3">Pooling</td></tr><tr><td align="left"><italic>Assigned Cluster</italic></td><td align="left" colspan="3">6</td></tr><tr><td align="left"><italic>Sample Clustering</italic></td><td align="left" colspan="3">tclust</td></tr><tr><td align="left"><italic>Supervised Classification</italic></td><td align="left" colspan="3">Random forest</td></tr><tr><td align="left"><italic>Assigned Cytometry</italic></td><td align="left" colspan="3"><inline-formula id="IEq244"><alternatives><tex-math id="M515">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{30}$$\end{document}</tex-math><mml:math id="M516"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>30</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq244.gif"/></alternatives></inline-formula></td></tr></tbody></table><table-wrap-foot><p><italic>Database Clustering</italic> refers to the clustering method used in line 17 in Algorithm 1. <italic>Template Formation</italic> refers to the method used in line 19 in Algorithm 1. <italic>Assigned Cluster</italic> refers to the label of the cluster as given in Table <xref rid="Tab2" ref-type="table">2</xref> to which the new cytometry is assigned. <italic>Sample Clustering</italic> refers to how we obtain <inline-formula id="IEq245"><alternatives><tex-math id="M517">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^u$$\end{document}</tex-math><mml:math id="M518"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>u</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq245.gif"/></alternatives></inline-formula> in Algorithm 5. <italic>Supervised Classification</italic> refers to the method used in line 13 in Algorithm 5. <italic>Assigned Cytometry</italic> refers to the optimal cytometry in the respective cluster that is used for learning (when applicable)</p></table-wrap-foot></table-wrap></p>
      <p id="Par75">In Table <xref rid="Tab4" ref-type="table">4</xref>, we present the best results, as measured by median F-measure (<xref rid="Equ10" ref-type="">10</xref>), of applying optimalFlowTemplates + optimalFlowClassification to <inline-formula id="IEq246"><alternatives><tex-math id="M519">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}$$\end{document}</tex-math><mml:math id="M520"><mml:mi mathvariant="script">TS</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq246.gif"/></alternatives></inline-formula>. For instance, for <inline-formula id="IEq247"><alternatives><tex-math id="M521">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{27}$$\end{document}</tex-math><mml:math id="M522"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>27</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq247.gif"/></alternatives></inline-formula>, a 61-year-old female with Chronic Lymphocytic Leukemia (see Table <xref rid="Tab1" ref-type="table">1</xref>), we have obtained a very satisfactory median F-measure of 0.9313. This value has been obtained using optimalFlowTemplate followed by optimalFlowClassification. What follows is an extended explanation of how to understand the entries of Table <xref rid="Tab4" ref-type="table">4</xref>.<fig id="Fig7"><label>Fig. 7</label><caption><p>Hierarchical tree obtained by using optimalFlowTemplates with complete linkage on the databse <inline-formula id="IEq248"><alternatives><tex-math id="M523">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'$$\end{document}</tex-math><mml:math id="M524"><mml:msup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq248.gif"/></alternatives></inline-formula> after gating each cytometry with the unsupervised procedure flowMeans</p></caption><graphic xlink:href="12859_2020_3795_Fig7_HTML" id="MO26"/></fig></p>
      <p id="Par76">For optimalFlowTemplates we have used complete linkage to cluster the cytometries in <inline-formula id="IEq249"><alternatives><tex-math id="M525">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {DB}$$\end{document}</tex-math><mml:math id="M526"><mml:mi mathvariant="script">DB</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq249.gif"/></alternatives></inline-formula> (third column in Table <xref rid="Tab2" ref-type="table">2</xref>) and pooling to obtain the templates. This information is provided in the entries <italic>Database Clustering</italic> and <italic>Template Formation</italic> in Table <xref rid="Tab4" ref-type="table">4</xref> corresponding to <inline-formula id="IEq250"><alternatives><tex-math id="M527">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{27}$$\end{document}</tex-math><mml:math id="M528"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>27</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq250.gif"/></alternatives></inline-formula> (in red). For optimalFlowClassification, we have clustered <inline-formula id="IEq251"><alternatives><tex-math id="M529">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{27}$$\end{document}</tex-math><mml:math id="M530"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>27</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq251.gif"/></alternatives></inline-formula> (without using the manual gating information) with <italic>tclust</italic>, as indicated in lines 1–5 in Algorithm 5, obtaining <inline-formula id="IEq252"><alternatives><tex-math id="M531">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^u$$\end{document}</tex-math><mml:math id="M532"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>u</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq252.gif"/></alternatives></inline-formula>. This is reflected in the entry <italic>Sample Clustering</italic>. Then, we assigned <inline-formula id="IEq253"><alternatives><tex-math id="M533">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{u}$$\end{document}</tex-math><mml:math id="M534"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>u</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq253.gif"/></alternatives></inline-formula> to the cluster, <inline-formula id="IEq254"><alternatives><tex-math id="M535">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}^{28},{\mathcal {C}}^{34}\}$$\end{document}</tex-math><mml:math id="M536"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>28</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>34</mml:mn></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq254.gif"/></alternatives></inline-formula>, labelled as 5, in column 3 of Table <xref rid="Tab2" ref-type="table">2</xref>. This is shown in the entry <italic>Assigned Cluster</italic>. In order to use random forests for classification, as reflected in the entry <italic>Supervised Classification</italic>, we have assigned <inline-formula id="IEq255"><alternatives><tex-math id="M537">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^u$$\end{document}</tex-math><mml:math id="M538"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mi>u</mml:mi></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq255.gif"/></alternatives></inline-formula> to the closest cytometry in similarity distance in the cluster, i.e., the assigned cytometry for learning is <inline-formula id="IEq256"><alternatives><tex-math id="M539">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{28}$$\end{document}</tex-math><mml:math id="M540"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>28</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq256.gif"/></alternatives></inline-formula> as reflected in the entry <italic>Assigned Cytometry</italic>.<table-wrap id="Tab5"><label>Table 5</label><caption><p>F-measure values (as in (<xref rid="Equ8" ref-type="">8</xref>)) for each cell type for <inline-formula id="IEq257"><alternatives><tex-math id="M541">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{17}$$\end{document}</tex-math><mml:math id="M542"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>17</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq257.gif"/></alternatives></inline-formula> and <inline-formula id="IEq258"><alternatives><tex-math id="M543">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{27}$$\end{document}</tex-math><mml:math id="M544"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>27</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq258.gif"/></alternatives></inline-formula> which are used to obtain the respective median F-measure value in Table <xref rid="Tab4" ref-type="table">4</xref></p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" rowspan="2"/><th align="left" colspan="3"><inline-formula id="IEq259"><alternatives><tex-math id="M545">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{17}$$\end{document}</tex-math><mml:math id="M546"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>17</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq259.gif"/></alternatives></inline-formula></th><th align="left" colspan="3"><inline-formula id="IEq260"><alternatives><tex-math id="M547">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{27}$$\end{document}</tex-math><mml:math id="M548"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>27</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq260.gif"/></alternatives></inline-formula></th></tr><tr><th align="left">F-measure</th><th align="left">Precision</th><th align="left">Recall</th><th align="left">F-measure</th><th align="left">Precision</th><th align="left">Recall</th></tr></thead><tbody><tr><td align="left">Abnormal Sig Kappa</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/><td char="." align="char">0.9697</td><td char="." align="char">0.9478</td><td char="." align="char">0.9925</td></tr><tr><td align="left">CD4+CD8<inline-formula id="IEq261"><alternatives><tex-math id="M549">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${-}$$\end{document}</tex-math><mml:math id="M550"><mml:mo>-</mml:mo></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq261.gif"/></alternatives></inline-formula></td><td char="." align="char">0.9973</td><td char="." align="char">0.9982</td><td char="." align="char">0.9965</td><td char="." align="char">0.9828</td><td char="." align="char">0.9796</td><td char="." align="char">0.9859</td></tr><tr><td align="left">CD8+CD4<inline-formula id="IEq262"><alternatives><tex-math id="M551">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${-}$$\end{document}</tex-math><mml:math id="M552"><mml:mo>-</mml:mo></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq262.gif"/></alternatives></inline-formula></td><td char="." align="char">0.9960</td><td char="." align="char">0.9960</td><td char="." align="char">0.9960</td><td char="." align="char">0.9769</td><td char="." align="char">0.9835</td><td char="." align="char">0.9704</td></tr><tr><td align="left">Neutrophils</td><td char="." align="char">0.9968</td><td char="." align="char">0.9959</td><td char="." align="char">0.9978</td><td char="." align="char">0.9421</td><td char="." align="char">0.9092</td><td char="." align="char">0.9775</td></tr><tr><td align="left">Debris/Doublets</td><td char="." align="char">0.9692</td><td char="." align="char">0.9818</td><td char="." align="char">0.9570</td><td char="." align="char">0.7704</td><td char="." align="char">0.9111</td><td char="." align="char">0.6673</td></tr><tr><td align="left">Monocytes</td><td char="." align="char">0.9679</td><td char="." align="char">0.9571</td><td char="." align="char">0.9791</td><td char="." align="char">0.8419</td><td char="." align="char">0.8475</td><td char="." align="char">0.8364</td></tr><tr><td align="left">Mature Sig Lambda</td><td char="." align="char">0.9897</td><td char="." align="char">0.9939</td><td char="." align="char">0.9856</td><td char="." align="char">0.9561</td><td char="." align="char">0.9864</td><td char="." align="char">0.9277</td></tr><tr><td align="left">Mature Sig Kappa</td><td char="." align="char">0.9923</td><td char="." align="char">0.9866</td><td char="." align="char">0.9981</td><td char="." align="char">0.9421</td><td char="." align="char">0.9421</td><td char="." align="char">0.9421</td></tr><tr><td align="left">TCRgd<inline-formula id="IEq263"><alternatives><tex-math id="M553">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${-}$$\end{document}</tex-math><mml:math id="M554"><mml:mo>-</mml:mo></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq263.gif"/></alternatives></inline-formula></td><td char="." align="char">0.9810</td><td char="." align="char">0.9777</td><td char="." align="char">0.9843</td><td char="." align="char">0.5549</td><td char="." align="char">0.5698</td><td char="." align="char">0.5408</td></tr><tr><td align="left">TCRgd<inline-formula id="IEq264"><alternatives><tex-math id="M555">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${-}$$\end{document}</tex-math><mml:math id="M556"><mml:mo>-</mml:mo></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq264.gif"/></alternatives></inline-formula></td><td char="." align="char">0.9403</td><td char="." align="char">0.9145</td><td char="." align="char">0.9677</td><td char="." align="char">0.8634</td><td char="." align="char">0.8195</td><td char="." align="char">0.9122</td></tr><tr><td align="left">CD4+CD8dim</td><td char="." align="char">0.9452</td><td char="." align="char">0.9504</td><td char="." align="char">0.9401</td><td char="." align="char">0.5899</td><td char="." align="char">0.7111</td><td char="." align="char">0.5039</td></tr><tr><td align="left">NK cells</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/><td char="." align="char">0.9313</td><td char="." align="char">0.9433</td><td char="." align="char">0.9196</td></tr><tr><td align="left">Myeloid Cells</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/><td char="." align="char">0.8321</td><td char="." align="char">0.9489</td><td char="." align="char">0.7409</td></tr><tr><td align="left">CD56dim</td><td char="." align="char">0.9827</td><td char="." align="char">0.9683</td><td char="." align="char">0.9975</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/></tr><tr><td align="left">Eosinophils</td><td char="." align="char">0.9722</td><td char="." align="char">0.9713</td><td char="." align="char">0.9732</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/></tr><tr><td align="left">Monocytoid DC</td><td char="." align="char">0.9563</td><td char="." align="char">0.9713</td><td char="." align="char">0.9417</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/></tr><tr><td align="left">Basophils</td><td char="." align="char">0.9123</td><td char="." align="char">0.9877</td><td char="." align="char">0.8476</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/></tr><tr><td align="left">Neutrophils (U.S.)</td><td char="." align="char">0.7632</td><td char="." align="char">0.7106</td><td char="." align="char">0.8242</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/></tr><tr><td align="left">Myeloid DC</td><td char="." align="char">0.8908</td><td char="." align="char">0.8413</td><td char="." align="char">0.9464</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/></tr><tr><td align="left">CD56bright</td><td char="." align="char">0.8785</td><td char="." align="char">0.9860</td><td char="." align="char">0.7921</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/></tr><tr><td align="left">Plasmocytoid DC</td><td char="." align="char">0.7790</td><td char="." align="char">0.8011</td><td char="." align="char">0.7581</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/></tr><tr><td align="left">Plasma Cells</td><td char="." align="char">0.9677</td><td char="." align="char">1.0000</td><td char="." align="char">0.9375</td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/></tr></tbody></table><table-wrap-foot><p>Recall and precision are defined in (<xref rid="Equ9" ref-type="">9</xref>)</p></table-wrap-foot></table-wrap></p>
    </sec>
  </sec>
  <sec id="Sec12">
    <title>Discussion</title>
    <p id="Par77">From the results shown in Section Clustering cytometries and template obtention, particularly in Fig. <xref rid="Fig5" ref-type="fig">5</xref>, we see that optimalFlowTemplates produces trees very similar to the ones given by flowMatch and that it also captures accurately the ground truth. We see that both procedures identify the data coming from the same individuals in 2 of the 3 shown cases.</p>
    <p id="Par78">As shown in Fig. <xref rid="Fig6" ref-type="fig">6</xref>, it seems that optimalFlowTemplates captures the difference between healthy and sick individuals accurately in the <inline-formula id="IEq265"><alternatives><tex-math id="M557">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {DB}$$\end{document}</tex-math><mml:math id="M558"><mml:mi mathvariant="script">DB</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq265.gif"/></alternatives></inline-formula> example. This comes from the fact that clusters of sick individuals merge other clusters high in the tree. Hence, producing clusters from cuts high in the tree will form separate clusters for healthy and sick individuals. However, we see that this is not entirely the case for flowMatch. Therefore, in this case, optimalFlowTemplates offers an advantage over flowMeans when we want to produce templates that will be used for classifying a new cytometry.</p>
    <p id="Par79">Some additional facts should be stated: first, the similarity distance is independent of parameters, something that is not the case for the generalized edge cover distance used in flowMatch. Second, optimalFlowTemplates produces templates only at one stage, once the number of clusters is determined, while flowMatch produces templates at every stage of the hierarchical clustering procedure. Third, optimalFlowTemplates uses a similarity distance which is bound between 0 and 1 and has a clear meaning. However, no such bounds are available for flowMatch. Fourth, flowMatch could be adapted to use the Wasserstein distance between cell types, but this is not implemented in the Bioconductor package that we used to make our comparisons.</p>
    <p id="Par80">We also notice that optimalFlowTemplates can capture differences within the groups of healthy and sick individuals. This is seen in Fig. <xref rid="Fig5" ref-type="fig">5</xref>. Therefore, it seems to be capturing additional biological and/or technical variability and not just the one provided by the distinction between healthy and sick. This can be clearly seen in Table <xref rid="Tab2" ref-type="table">2</xref>, where we have several clusters for healthy individuals and several clusters for sick individuals. Hence, we can infer that the similarity distance is sensitive enough to differentiate between cytometries, and therefore that it is a suitable distance for comparing them.</p>
    <p id="Par81">Raw FC data are usually processed via different transformations to produce data more suitable for analysis. This raises two relevant questions: first, what are the effects of the transformations on the hierarchies and the templates that we obtain?; and second, are the templates and hierarchies invariant under transformations? We thank the referee that suggested us these topics.</p>
    <p id="Par82">To address the first question, we will assume that all raw cytometries will be submitted to the same type of transformation. In the setting we have presented, which is mainly model-based, the more the data look like mixtures of a location-scale distribution, the better the performance will be, and the more realistic the artificial templates will seem. On the other hand, if we choose a cost in the similarity distance (<xref rid="Equ2" ref-type="">2</xref>) that is non-parametric, such transformations may not be needed, although they may prove to be helpful. However, templates may be more unrealistic since the location-scale approximation may not be well suited. We expect to address production of templates in a non-parametric fashion in future work.</p>
    <p id="Par83">The hierarchies and templates we obtain, as well as the ones obtained using procedures as flowMatch and QFMatch, are not transformation invariant. Similar transformations will produce similar hierarchies and similar templates. Therefore, from a purely mathematical point of view, there is no true or correct hierarchy. However, from a practical point of view, transformations that allow to produce hierarchies and templates that capture more relevant information for the problem at hand should be preferred.</p>
    <p id="Par84">With respect to the results shown in Section Gating and classification, there are several interesting implications. Firstly, as expected, our supervised method, optimalFlowTemplates + optimalFlowClassification outperforms an unsupervised method such as flowMeans. This is seen in the higher values in each entry of column 3, with respect to column 1, of Table <xref rid="Tab3" ref-type="table">3</xref>. We also see that the F-measures obtained by our procedure are very satisfactory giving a mean value of 0.9539 and a median value of 0.9587 for <inline-formula id="IEq266"><alternatives><tex-math id="M559">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}$$\end{document}</tex-math><mml:math id="M560"><mml:mi mathvariant="script">TS</mml:mi></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq266.gif"/></alternatives></inline-formula>. It is also worth noting that good results are obtained both for healthy individuals and for cancer patients.</p>
    <p id="Par85">Secondly, a comparison with a supervised method, DeepCyTOF, based on neural networks and domain adaptation has been provided. We want to stress that, at least with the implementation provided in Github, we were unable to apply DeepCyTOF to cytometries with different cell types, which limits the applicability of this method. Hence, we had to produce a modified test group given by <inline-formula id="IEq267"><alternatives><tex-math id="M561">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'$$\end{document}</tex-math><mml:math id="M562"><mml:msup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq267.gif"/></alternatives></inline-formula>. This favours DeepCyTOF since our procedure was instead applied to the original cytometries. From column 2 of Table <xref rid="Tab3" ref-type="table">3</xref>, we see that DeepCyTOF works well for cytometries <inline-formula id="IEq268"><alternatives><tex-math id="M563">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}^{2'},{\mathcal {C}}^{5'},{\mathcal {C}}^{14'},{\mathcal {C}}^{15'}\}$$\end{document}</tex-math><mml:math id="M564"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>2</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>5</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>14</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>15</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq268.gif"/></alternatives></inline-formula> giving results comparable to our own procedure. However, it does not work as well for cytometries <inline-formula id="IEq269"><alternatives><tex-math id="M565">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}^{7'}, {\mathcal {C}}^{17'}, {\mathcal {C}}^{18'}\}$$\end{document}</tex-math><mml:math id="M566"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>7</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>17</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>18</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq269.gif"/></alternatives></inline-formula>. We see that our procedure outperforms DeepCyTOF for every cytometry in <inline-formula id="IEq270"><alternatives><tex-math id="M567">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'$$\end{document}</tex-math><mml:math id="M568"><mml:msup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq270.gif"/></alternatives></inline-formula>, even in the previously mentioned disadvantageous position, except for <inline-formula id="IEq271"><alternatives><tex-math id="M569">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{14'}$$\end{document}</tex-math><mml:math id="M570"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>14</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq271.gif"/></alternatives></inline-formula>. We stress that DeepCyTOF is using precisely <inline-formula id="IEq272"><alternatives><tex-math id="M571">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{14'}$$\end{document}</tex-math><mml:math id="M572"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>14</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq272.gif"/></alternatives></inline-formula> for learning, as indicated in italic in column 2 of Table <xref rid="Tab3" ref-type="table">3</xref>. Therefore, it is using 80% of the data in <inline-formula id="IEq273"><alternatives><tex-math id="M573">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{14'}$$\end{document}</tex-math><mml:math id="M574"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>14</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq273.gif"/></alternatives></inline-formula> to calibrate the neural network. Hence, it is natural that DeepCyTOF is the best procedure for this cytometry.</p>
    <p id="Par86">Thirdly, because of the versatility of our procedure optimalFlowTemplates, we can use it to improve the results of DeepCyTOF. In essence, DeepCyTOF’s domain adaptation is not able to account for the high variability in <inline-formula id="IEq274"><alternatives><tex-math id="M575">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'$$\end{document}</tex-math><mml:math id="M576"><mml:msup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq274.gif"/></alternatives></inline-formula>, but this is exactly what optimalFlowTemplate is for. We start by creating a set of gated cytometries by gating in an unsupervised fashion, using flowMeans, the cytometries in <inline-formula id="IEq275"><alternatives><tex-math id="M577">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'$$\end{document}</tex-math><mml:math id="M578"><mml:msup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq275.gif"/></alternatives></inline-formula>. Then we apply optimalFlowTemplates and obtain the tree shown in Fig. <xref rid="Fig7" ref-type="fig">7</xref>. This suggests splitting the original group of cytometries into three different clusters <inline-formula id="IEq276"><alternatives><tex-math id="M579">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'_1$$\end{document}</tex-math><mml:math id="M580"><mml:msubsup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mo>′</mml:mo></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq276.gif"/></alternatives></inline-formula>, <inline-formula id="IEq277"><alternatives><tex-math id="M581">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'_2$$\end{document}</tex-math><mml:math id="M582"><mml:msubsup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mn>2</mml:mn><mml:mo>′</mml:mo></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq277.gif"/></alternatives></inline-formula> and <inline-formula id="IEq278"><alternatives><tex-math id="M583">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathcal {TS}'_3$$\end{document}</tex-math><mml:math id="M584"><mml:msubsup><mml:mrow><mml:mi mathvariant="script">TS</mml:mi></mml:mrow><mml:mn>3</mml:mn><mml:mo>′</mml:mo></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq278.gif"/></alternatives></inline-formula>. Now, applying DeepCyTOF to each cluster separately, we obtain the results shown in column 3 of Table <xref rid="Tab3" ref-type="table">3</xref>, which show a significant improvement with respect to baseline DeepCyTOF for cytometries <inline-formula id="IEq279"><alternatives><tex-math id="M585">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}^{7'},{\mathcal {C}}^{17'},{\mathcal {C}}^{18'}\}$$\end{document}</tex-math><mml:math id="M586"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>7</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>17</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>18</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq279.gif"/></alternatives></inline-formula> and comparable results for <inline-formula id="IEq280"><alternatives><tex-math id="M587">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}^{2'}, {\mathcal {C}}^{5'},{\mathcal {C}}^{14'},{\mathcal {C}}^{15'}\}$$\end{document}</tex-math><mml:math id="M588"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>2</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>5</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>14</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>15</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq280.gif"/></alternatives></inline-formula>. Hence, our procedure has indeed helped to improve the performance of DeepCyTOF.</p>
    <p id="Par87">It is important to note that when DeepCyTOF learns in a cytometry, as is the case for <inline-formula id="IEq281"><alternatives><tex-math id="M589">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{14'}$$\end{document}</tex-math><mml:math id="M590"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>14</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq281.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq282"><alternatives><tex-math id="M591">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}^{2'},{\mathcal {C}}^{7'},{\mathcal {C}}^{17'}\}$$\end{document}</tex-math><mml:math id="M592"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>2</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>7</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:msup><mml:mn>17</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq282.gif"/></alternatives></inline-formula>, for columns 2 and 3 of Table <xref rid="Tab3" ref-type="table">3</xref>, respectively, it uses 80% of the sample. This justifies the great result for <inline-formula id="IEq283"><alternatives><tex-math id="M593">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^2$$\end{document}</tex-math><mml:math id="M594"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq283.gif"/></alternatives></inline-formula> and <inline-formula id="IEq284"><alternatives><tex-math id="M595">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^7$$\end{document}</tex-math><mml:math id="M596"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>7</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq284.gif"/></alternatives></inline-formula> in column 3 of Table <xref rid="Tab3" ref-type="table">3</xref>.</p>
    <p id="Par88">Additionally, we want to highlight something that is reflected in Table <xref rid="Tab4" ref-type="table">4</xref>. Cytometries <inline-formula id="IEq285"><alternatives><tex-math id="M597">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\mathcal {C}}^{26},{\mathcal {C}}^{27}\}$$\end{document}</tex-math><mml:math id="M598"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>26</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>27</mml:mn></mml:msup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq285.gif"/></alternatives></inline-formula>, taken from individuals with cancer, are assigned to clusters of cytometries of patients with cancer. Therefore, our procedure is correctly assigning sick individuals to clusters of sick individuals. Furthermore, when there is a patient with the same type of cancer in the cluster results are very good. This is the case for <inline-formula id="IEq286"><alternatives><tex-math id="M599">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{27}$$\end{document}</tex-math><mml:math id="M600"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>27</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq286.gif"/></alternatives></inline-formula>, which is assigned to cluster 5 in the third column of Table <xref rid="Tab2" ref-type="table">2</xref>, where <inline-formula id="IEq287"><alternatives><tex-math id="M601">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {C}}^{28}$$\end{document}</tex-math><mml:math id="M602"><mml:msup><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mn>28</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2020_3795_Article_IEq287.gif"/></alternatives></inline-formula> also has Chronic Lymphocytic Leukemia. It is also worth noting that healthy individuals are, likewise, assigned to clusters of healthy individuals.</p>
    <p id="Par89">The last thing we want to discuss is the meaning of the median F-measure values, as the ones given in Table <xref rid="Tab4" ref-type="table">4</xref>, which are obtained from values such as the ones shown in Table <xref rid="Tab5" ref-type="table">5</xref>. A high median F-measure value indicates that classification is good along all cell types, regardless of the number of cells in each cell type. This is quite important since often cell types with a small number of cells are very relevant for diagnosis. Indeed, from the values in Table <xref rid="Tab5" ref-type="table">5</xref> we see that our procedure achieves good performance in almost all cell types.</p>
  </sec>
  <sec id="Sec13">
    <title>Conclusion</title>
    <p id="Par90">In this work we have presented a viable automated supervised gating workflow which is efficient, robust, scalable, and accountable. In particular, we ensure efficiency by using automatically produced clusters of previously gated cytometries capable of capturing information such as sickness and other types of variability. Throughout our experiments, we have shown that our method is robust due to the grouping of cytometries and the automatic assignment of a new one to the most similar group.</p>
    <p id="Par91">Our method does not necessarily require manual gating, so it can be applied to big datasets with only computational cost as a burden, with the added benefit of counteracting the shortcomings of the manual gating approach (namely, human error and the need for experts).</p>
    <p id="Par92">The way in which we approached the problem ensures accountability. Cluster memberships can be screened and, furthermore, synthetic prototypes can be manually gated to check their suitability. Hence even when classification is used with some black-box procedure, we have an accurate understanding of the starting point. Finally, we have shown that our method is versatile, as our workflow can incorporate many previously existing tools in automated flow cytometry gating and it can accommodate many supervised learning procedures.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec16">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="12859_2020_3795_MOESM1_ESM.pdf">
            <caption>
              <p><bold>Additional file 1.</bold> Notions on optimal transport. Supporting information is provided in a PDF file, in which we present a brief overview of the main results on optimal transport used in this work.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>BM</term>
        <def>
          <p id="Par4">bone marrow</p>
        </def>
      </def-item>
      <def-item>
        <term>CLL</term>
        <def>
          <p id="Par5">chronic lymphocytic leukimia</p>
        </def>
      </def-item>
      <def-item>
        <term>DLBCL</term>
        <def>
          <p id="Par6">diffuse large B-cell lymphoma</p>
        </def>
      </def-item>
      <def-item>
        <term>FC</term>
        <def>
          <p id="Par7">flow cytometry</p>
        </def>
      </def-item>
      <def-item>
        <term>FL</term>
        <def>
          <p id="Par8">follicular lymphoma</p>
        </def>
      </def-item>
      <def-item>
        <term>GEC</term>
        <def>
          <p id="Par9">generalized edge cover</p>
        </def>
      </def-item>
      <def-item>
        <term>HCL</term>
        <def>
          <p id="Par10">hairy cell leukimia</p>
        </def>
      </def-item>
      <def-item>
        <term>HD</term>
        <def>
          <p id="Par11">healthy diagnosis</p>
        </def>
      </def-item>
      <def-item>
        <term>LN</term>
        <def>
          <p id="Par12">lymph node</p>
        </def>
      </def-item>
      <def-item>
        <term>LPL</term>
        <def>
          <p id="Par13">lymphoplasmacytic lymphoma</p>
        </def>
      </def-item>
      <def-item>
        <term>MCL</term>
        <def>
          <p id="Par14">mantle cell lymphoma</p>
        </def>
      </def-item>
      <def-item>
        <term>PB</term>
        <def>
          <p id="Par15">peripherial blood</p>
        </def>
      </def-item>
      <def-item>
        <term>QDA</term>
        <def>
          <p id="Par16">quadratic discriminant analysis</p>
        </def>
      </def-item>
      <def-item>
        <term>QF</term>
        <def>
          <p id="Par17">quadratic form</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher's Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p><bold>Supplementary information</bold> accompanies this paper at 10.1186/s12859-020-03795-w.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>The motivation of this work is due to a collaboration with the clinical research team, led by Dr. Alberto Orfao, of the Cancer Research Center in Salamanca. We are extremely grateful for their insights and help, as well as for all the data they have kindly allowed us to use in this work.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors' contributions</title>
    <p>EdB, CM and HI designed the study. JML and AMÍ were involved in the design of the algorithms and in the analysis of the results. HI designed the algorithms and wrote the manuscript. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>Research partially supported by FEDER, Spanish Ministerio de Economía y Competitividad, grant MTM2017-86061-C2-1-P and Junta de Castilla y León, grants VA005P17 and VA002G18. Research partially supported by DEEL IRT. We thank the AI interdisciplinary institute ANITI, grant agreement number ANR-19-PI3A-0004 under the French investing for the future PIA3 program. The funding bodies did not play any role in the design of the methodology, creation of the algorithms, analysis, and interpretation of data, or in writing the manuscript.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>With the user in mind we have developed an R package called optimalFlow that implements our methodology which is available in the Bioconductor repository at <ext-link ext-link-type="uri" xlink:href="https://bioconductor.org/packages/optimalFlow">https://bioconductor.org/packages/optimalFlow</ext-link>. The data used in this work is freely available for researchers after registration on <ext-link ext-link-type="uri" xlink:href="https://www.EuroFlow.org">https://www.EuroFlow.org</ext-link>.</p>
  </notes>
  <notes id="FPar2">
    <title>Ethics approval and consent to participate</title>
    <p id="Par93">Data used in this work were obtained under the project with acronym EuroFlow which was approved by the ethics comity <italic>Comité de Ética Asistencial del Área de Salud de Salamanca (Hospital Universitario de Salamanca, Salamanca (Spain))</italic> in an ordinary session on February the 26th of 2007. The participants granted written permission for their data to be used for research purposes.</p>
  </notes>
  <notes>
    <title>Consent for publication</title>
    <p id="Par94">Not applicable</p>
  </notes>
  <notes id="FPar3" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par95">The authors declare that they have no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aghaeepour</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Finak</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Hoos</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Mosmann</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Brinkman</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Gottardo</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Scheuermann</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Critical assessment of automated flow cytometry data analysis techniques</article-title>
        <source>Nat Methods</source>
        <year>2013</year>
        <volume>10</volume>
        <fpage>228</fpage>
        <lpage>238</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2365</pub-id>
        <pub-id pub-id-type="pmid">23396282</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Saeys</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Gassen</surname>
            <given-names>SV</given-names>
          </name>
          <name>
            <surname>Lambrecht</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Computational flow cytometry: helping to make sense of high-dimensional immunology data</article-title>
        <source>Nat Rev Immunol</source>
        <year>2016</year>
        <volume>16</volume>
        <fpage>449</fpage>
        <lpage>462</lpage>
        <pub-id pub-id-type="doi">10.1038/nri.2016.56</pub-id>
        <pub-id pub-id-type="pmid">27320317</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Shaham</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Stanton</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Yao</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Montgomery</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Kluger</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Gating mass cytometry data by deep learning</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <fpage>3423</fpage>
        <lpage>3430</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btx448</pub-id>
        <pub-id pub-id-type="pmid">29036374</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Anchang</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Do</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Zhao</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Plevritis</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Ccast: a model-based gating strategy to isolate homogeneous subpopulations in a heterogeneous population of single cells</article-title>
        <source>PLOS Comput Biol</source>
        <year>2014</year>
        <volume>10</volume>
        <issue>7</issue>
        <fpage>e1003664</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1003664</pub-id>
        <pub-id pub-id-type="pmid">25078380</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qian</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Wei</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>FE-H</given-names>
          </name>
          <name>
            <surname>Campbell</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Halliley</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cai</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Kong</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Sadat</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Thomson</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Dunn</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Seegmiller</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Karandikar</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Tipton</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Mosmann</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Sanz</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Scheuermann</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Elucidation of seventeen human peripheral blood b cell subsets and quantification of the tetanus response using a density-based method for the automated identification of cell populations in multidimensional flow cytometry data</article-title>
        <source>Cytom B Clin Cytom</source>
        <year>2010</year>
        <volume>78</volume>
        <fpage>69</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="doi">10.1002/cyto.b.20554</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pyne</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Rossin</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Maier</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Baecher-Allan</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>McLachlan</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Tamayo</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Hafler</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Jager</surname>
            <given-names>PD</given-names>
          </name>
          <name>
            <surname>Mesirov</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Automated high-dimensional flow cytometric data analysis</article-title>
        <source>PNAS</source>
        <year>2009</year>
        <volume>106</volume>
        <fpage>8519</fpage>
        <lpage>8524</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.0903028106</pub-id>
        <pub-id pub-id-type="pmid">19443687</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lo</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Brinkman</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Gottardo</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Automated gating of flow cytometry data via robust model-based clustering</article-title>
        <source>Cytom A</source>
        <year>2008</year>
        <volume>73</volume>
        <fpage>321</fpage>
        <lpage>332</lpage>
        <pub-id pub-id-type="doi">10.1002/cyto.a.20531</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lo</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Hahne</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Brinkman</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Gottardo</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>flowClust: a bioconductor package for automated gating of flow cytometry data</article-title>
        <source>BMC Bioinform</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>145</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-10-145</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ge</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Sealfon</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>flowpeaks: a fast unsupervised clustering for flow cytometry data via k-means and density peak finding</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <fpage>2052</fpage>
        <lpage>2058</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bts300</pub-id>
        <pub-id pub-id-type="pmid">22595209</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aghaeepour</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Nikolic</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Hoos</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Brinkman</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Rapid cell population identification in flow cytometry data</article-title>
        <source>Cytom A</source>
        <year>2011</year>
        <volume>79</volume>
        <fpage>6</fpage>
        <lpage>13</lpage>
        <pub-id pub-id-type="doi">10.1002/cyto.a.21007</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lux</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Brinkman</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Chauve</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Laing</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Lorenc</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Abeler-Dörner</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Hammer</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>flowlearn: fast and precise identification and quality checking of cell populations in flow cytometry</article-title>
        <source>Bioinformatics</source>
        <year>2018</year>
        <volume>34</volume>
        <fpage>2245</fpage>
        <lpage>2253</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty082</pub-id>
        <pub-id pub-id-type="pmid">29462241</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Alpaydin</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <source>Introduction to machine learning</source>
        <year>2014</year>
        <edition>3</edition>
        <publisher-loc>Cambridge</publisher-loc>
        <publisher-name>MIT Press</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Azad</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Pyne</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Pothen</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Matching phosphorylation response patterns of antigen-receptor-stimulated t cells via flow cytometry</article-title>
        <source>BMC Bioinform</source>
        <year>2012</year>
        <volume>13</volume>
        <fpage>10</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-13-S2-S10</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hsiao</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Stanton</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>McGee</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Qian</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Scheuermann</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Mapping cell populations in flow cytometry data for cross-sample comparison using the friedman-rafsky test statistic as a distance measure</article-title>
        <source>Cytom A</source>
        <year>2016</year>
        <volume>89</volume>
        <fpage>71</fpage>
        <lpage>88</lpage>
        <pub-id pub-id-type="doi">10.1002/cyto.a.22735</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <mixed-citation publication-type="other">Coen M, Ansari MH, Filmore N. Comparing clusterings in space. In: ICML’10 proceedings of the 27th international conference on international conference on machine learning. 2010. p. 231–238.</mixed-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gouic</surname>
            <given-names>TL</given-names>
          </name>
          <name>
            <surname>Loubes</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Existence and consistency of wasserstein barycenters</article-title>
        <source>Probab Theory Relat</source>
        <year>2017</year>
        <volume>168</volume>
        <fpage>901</fpage>
        <lpage>917</lpage>
        <pub-id pub-id-type="doi">10.1007/s00440-016-0727-z</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Boissard</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Le Gouic</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Loubes</surname>
            <given-names>J-M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Distribution/s template estimate with wasserstein metrics</article-title>
        <source>Bernoulli</source>
        <year>2015</year>
        <volume>21</volume>
        <issue>2</issue>
        <fpage>740</fpage>
        <lpage>759</lpage>
        <pub-id pub-id-type="doi">10.3150/13-BEJ585</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Álvarez-Esteban</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>del Barrio</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Cuesta-Albertos</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Matrán</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>A fixed-point approach to barycenters in wasserstein space</article-title>
        <source>J Math Anal Appl</source>
        <year>2016</year>
        <volume>441</volume>
        <fpage>744</fpage>
        <lpage>762</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jmaa.2016.04.045</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>del Barrio</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Cuesta-Albertos</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Matrán</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Mayo-Íscar</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Robust clustering tools based on optimal transportation</article-title>
        <source>Stat Comput</source>
        <year>2019</year>
        <volume>29</volume>
        <fpage>139</fpage>
        <lpage>160</lpage>
        <pub-id pub-id-type="doi">10.1007/s11222-018-9800-z</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Álvarez-Esteban</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>del Barrio</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Cuesta-Albertos</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Matrán</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Wide consensus aggregation in the wasserstein space. Application to location-scatter families</article-title>
        <source>Bernoulli</source>
        <year>2018</year>
        <volume>24</volume>
        <fpage>3147</fpage>
        <lpage>3179</lpage>
        <pub-id pub-id-type="doi">10.3150/17-BEJ957</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>García-Escudero</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Gordaliza</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Matrán</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Mayo-Íscar</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>A general trimming approach to robust cluster analysis</article-title>
        <source>Ann Stat</source>
        <year>2008</year>
        <volume>36</volume>
        <fpage>1324</fpage>
        <lpage>1345</lpage>
        <pub-id pub-id-type="doi">10.1214/07-AOS515</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dost</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Su</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Bafna</surname>
            <given-names>V</given-names>
          </name>
        </person-group>
        <article-title>Tclust: a fast method for clustering genome-scale expression data</article-title>
        <source>IEEE/ACM Trans Comput Biol Bioinform</source>
        <year>2011</year>
        <volume>8</volume>
        <fpage>808</fpage>
        <lpage>818</lpage>
        <pub-id pub-id-type="doi">10.1109/TCBB.2010.34</pub-id>
        <pub-id pub-id-type="pmid">20479508</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Orlova</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Zimmerman</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Meehan</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Meehan</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Waters</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Earth mover’s distance (emd): a true metric for comparing biomarker expression levels in cell populations</article-title>
        <source>PLOS ONE</source>
        <year>2016</year>
        <volume>11</volume>
        <issue>3</issue>
        <fpage>0151859</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0151859</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Orlova</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Meehan</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Parks</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Moore</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Meehan</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Waters</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Qfmatch: multidimensional flow and mass cytometry samples alignmen</article-title>
        <source>Sci Rep</source>
        <year>2018</year>
        <volume>8</volume>
        <issue>1</issue>
        <fpage>3291</fpage>
        <pub-id pub-id-type="doi">10.1038/s41598-018-21444-4</pub-id>
        <pub-id pub-id-type="pmid">29459702</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cuturi</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Doucet</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Fast computation of wasserstein barycenters</article-title>
        <source>PMLR</source>
        <year>2014</year>
        <volume>32</volume>
        <fpage>685</fpage>
        <lpage>693</lpage>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <mixed-citation publication-type="other">Ester M, Kriegel H, Sander J, Xu X. A density-based algorithm for discovering clusters in large spatial databases with noise. In: Proceedings of the second international conference on knowledge discovery and data mining. 1996. p. 226–231.</mixed-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Campello R, Moulavi D, Sander J. Density-based clustering based on hierarchical density estimates. In: Advances in knowledge discovery and data mining. PAKDD 2013, vol. 7819. 2013. p. 160–72.</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fraley</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Raftery</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Model-based clustering, discriminant analysis, and density estimation</article-title>
        <source>J Am Stat Assoc</source>
        <year>2002</year>
        <volume>97</volume>
        <fpage>611</fpage>
        <lpage>631</lpage>
        <pub-id pub-id-type="doi">10.1198/016214502760047131</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Scrucca</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Fop</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Murphy</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Raftery</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>mclust 5: clustering, classification and density estimation using gaussian finite mixture models</article-title>
        <source>R J</source>
        <year>2016</year>
        <volume>8</volume>
        <fpage>289</fpage>
        <lpage>317</lpage>
        <pub-id pub-id-type="doi">10.32614/RJ-2016-021</pub-id>
        <pub-id pub-id-type="pmid">27818791</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fritz</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>García-Escudero</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Mayo-Íscar</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>A fast algorithm for robust constrained clustering</article-title>
        <source>Comput Stat Data Anal</source>
        <year>2013</year>
        <volume>61</volume>
        <fpage>124</fpage>
        <lpage>136</lpage>
        <pub-id pub-id-type="doi">10.1016/j.csda.2012.11.018</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kuhn</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>The Hungarian method for the assignment problem</article-title>
        <source>Naval Rese Logist Q</source>
        <year>1995</year>
        <volume>2</volume>
        <fpage>83</fpage>
        <lpage>97</lpage>
        <pub-id pub-id-type="doi">10.1002/nav.3800020109</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Azad</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Rajwa</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Pothen</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Immunophenotype discovery, hierarchical organization, and template-based classification of flow cytometry samples</article-title>
        <source>Front Oncol</source>
        <year>2016</year>
        <volume>6</volume>
        <fpage>188</fpage>
        <pub-id pub-id-type="doi">10.3389/fonc.2016.00188</pub-id>
        <pub-id pub-id-type="pmid">27630823</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
