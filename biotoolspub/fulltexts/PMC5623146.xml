<?properties open_access?>
<?properties manuscript?>
<?origin nihpa?>
<?iso-abbr Nat. Methods?>
<?submitter-system nihms?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 8068858?>
<?submitter-authority myNCBI?>
<?submitter-login nature-structure?>
<?submitter-name Nature Publishing Group?>
<?domain nihpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5623146</article-id>
    <article-id pub-id-type="pmid">28825706</article-id>
    <article-id pub-id-type="doi">10.1038/nmeth.4401</article-id>
    <article-id pub-id-type="manuscript">nihpa896446</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>chromVAR: Inferring transcription factor-associated accessibility from single-cell epigenomic data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Schep</surname>
          <given-names>Alicia N.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wu</surname>
          <given-names>Beijing</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Buenrostro</surname>
          <given-names>Jason D.</given-names>
        </name>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref ref-type="aff" rid="A4">4</xref>
        <xref rid="FN1" ref-type="author-notes">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Greenleaf</surname>
          <given-names>William J.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="aff" rid="A5">5</xref>
        <xref rid="FN1" ref-type="author-notes">*</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Department of Genetics, Stanford University School of Medicine, Stanford, CA 94305, USA</aff>
    <aff id="A2"><label>2</label>Center for Personal Dynamic Regulomes, Stanford University, Stanford, CA 94305</aff>
    <aff id="A3"><label>3</label>Broad Institute of MIT and Harvard, Cambridge, MA 02142, USA</aff>
    <aff id="A4"><label>4</label>Harvard Society of Fellows, Harvard University, Cambridge, MA 02138, USA</aff>
    <aff id="A5"><label>5</label>Department of Applied Physics, Stanford University, Stanford, CA 94025, USA</aff>
    <author-notes>
      <corresp id="FN1"><label>*</label>Authors for correspondence: <email>jbuen@broadinstitute.org</email> or <email>wjg@stanford.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>2</day>
      <month>8</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>21</day>
      <month>8</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>10</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>21</day>
      <month>2</month>
      <year>2018</year>
    </pub-date>
    <volume>14</volume>
    <issue>10</issue>
    <fpage>975</fpage>
    <lpage>978</lpage>
    <!--elocation-id from pubmed: 10.1038/nmeth.4401-->
    <permissions>
      <license>
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:
<uri xlink:type="simple" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</uri></license-p>
      </license>
    </permissions>
    <abstract>
      <p id="P1">Single cell ATAC-seq (scATAC) yields sparse data that makes application of conventional analysis approaches challenging. We developed chromVAR, an R package for analyzing sparse chromatin accessibility data by estimating gain or loss of accessibility within peaks sharing the same motif or annotation while controlling for technical biases. chromVAR enables accurate clustering of scATAC-seq profiles and enables characterization of known and <italic>de novo</italic> sequence motifs associated with variation in chromatin accessibility.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <sec id="S1">
    <title>Main Text</title>
    <p id="P2">Transcription factor binding to regulatory DNA sequences controls the activity of <italic>cis</italic>-regulatory elements, which modulate gene expression programs that define cell phenotype. Assays for probing chromatin accessibility have enabled the discovery of <italic>cis</italic>-regulatory elements and <italic>trans</italic>-acting factors across different cell states and types that lead to functional changes in gene expression<sup><xref rid="R1" ref-type="bibr">1</xref></sup>. Concurrently, single cell genomic and transcriptomic methods have enabled unbiased <italic>de novo</italic> deconvolution of dynamic or diverse cellular populations<sup><xref rid="R2" ref-type="bibr">2</xref>,<xref rid="R3" ref-type="bibr">3</xref></sup>. Recently-developed assays for measuring chromatin accessibility within single cells<sup><xref rid="R4" ref-type="bibr">4</xref>–<xref rid="R6" ref-type="bibr">6</xref></sup> promise to enable the identification of causative <italic>cis-</italic> and <italic>trans-</italic> regulators that bring about these diverse cellular phenotypes.</p>
    <p id="P3">However, the exceedingly sparse nature of single cell epigenomic data sets present unique and significant computational challenges. All single-cell epigenomic methods are intrinsically sparse, as the total potential signal at a genomic locus is fundamentally limited by the copy number of DNA, thus generating 0, 1 or 2 reads from regulatory elements within a diploid genome. Methods developed for single cell RNA-seq have shown that measuring the dispersion of gene sets, such as Gene Ontology or co-expression modules, rather than individual genes can be a powerful approach for analyzing sparse data<sup><xref rid="R7" ref-type="bibr">7</xref></sup>. In this vein, and building on previous work from our group and others<sup><xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R8" ref-type="bibr">8</xref>,<xref rid="R9" ref-type="bibr">9</xref></sup>, we have developed <italic>chromVAR</italic>, a versatile R package for analyzing sparse chromatin accessibility data by measuring the gain or loss of chromatin accessibility within sets of genomic features while controlling for known technical biases in epigenomic data (<xref rid="SD1" ref-type="supplementary-material">Supplementary Software</xref>). We show that <italic>chromVAR</italic> can be used to identify transcription factor (TF) motifs that define different cell types and vary within populations, providing a unique analytical toolkit for analysis of sparse epigenomic data.</p>
    <p id="P4">The chromVAR package takes as inputs 1) aligned sequencing reads, 2) chromatin accessibility peaks (derived from either data aggregated across cells or external resources), and 3) a set of chromatin features representing either motif position weight matrices (PWMs) or genomic annotations (<xref rid="F1" ref-type="fig">Fig. 1a</xref>, <xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 1</xref>). For use as input (3) into chromVAR, we have curated a set of human and mouse PWMs from the cisBP database<sup><xref rid="R10" ref-type="bibr">10</xref></sup> that represent a diverse and comprehensive collection of known TF motifs. Alternately, user provided TF motifs or other types of genomic annotations, such as enhancer modules, ChIP-seq peaks, or GWAS disease annotation may be used. chromVAR may also be applied to a collection of kmers—DNA sequences of a specific length k—in order to perform an unbiased analysis of DNA sequence features that correlate with chromatin accessibility variation across the cells or samples.</p>
    <p id="P5">chromVAR first computes a “raw accessibility deviation” for each motif and cell, representing the difference between the total number of fragments mapping to peaks containing the given motif and the total expected number of fragments based on the average of all input cells. This aggregation across peaks sharing a common motif yields a signal that is considerably less sparse than the signal within individual peaks, however this aggregation can also amplify technical biases between cells due to PCR amplification or variable Tn5 tagmentation conditions (<xref rid="SD1" ref-type="supplementary-material">Supplementary Note 1</xref>). These technical biases can lead to differences in the number of observed fragment counts between cells for a given peak set with distinct GC content or mean accessibility (<xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 2</xref>). To account for these technical confounders, “background” peak sets are created for each annotation, which comprise of an equal number of peaks matched for GC content and average accessibility (<xref rid="SD2" ref-type="supplementary-material">Supplementary Figs. 2–5</xref>; <xref rid="SD1" ref-type="supplementary-material">Supplementary Note 2</xref>). The raw accessibility deviations for these background peak sets are used to compute a bias corrected deviation and z-score for each annotation and cell, providing a bias-corrected differential measure describing the gain or loss of accessibility of a given genomic annotation relative to the average cell profile (<bold>see methods</bold>). These bias corrected deviations and z-scores can be used for a number of downstream analyses, including <italic>de novo</italic> clustering of cells and identification of key regulators that vary within and between different cell types. The chromVAR package includes a collection of tools for such downstream analysis, including an interactive web application for exploring the relationship between key TF motifs and clustering of cells (<xref rid="SD2" ref-type="supplementary-material">Supplementary Figure 6</xref>). We have also incorporated tools for generating previously-described analyses characterizing the correlation and potential cooperativity between two TF binding sites within the same regulatory element, and computing chromatin variability across regions in <italic>cis</italic><sup><xref rid="R4" ref-type="bibr">4</xref></sup>.</p>
    <p id="P6">To test the applicability of this computational workflow for single-cell analysis, we set out to measure the robustness of <italic>chromVAR</italic> outputs to data downsampling. To do this, we applied chromVAR to bulk ATAC-seq data from a deeply-sequenced set of hematopoietic cell types<sup><xref rid="R8" ref-type="bibr">8</xref></sup>, and compared the results of the analysis for the data across various degrees of downsampling. We found that the TF motif deviations using 10<sup>6</sup> to 5×10<sup>3</sup> fragments per sample are highly correlated to those determined using the full data set (<xref rid="F1" ref-type="fig">Fig. 1b</xref>, <xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 7</xref>). The clustering accuracy using the bias corrected deviations is also largely preserved after downsampling, and compares favorably to clustering using PCA or other peak-based approaches (<xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 7</xref>; <bold>see methods</bold>).</p>
    <p id="P7">Importantly, chromVAR provides robust results for 10,000 fragments per cell, a typical number of fragments generated from a single-cell using scATAC-seq<sup><xref rid="R4" ref-type="bibr">4</xref></sup> (<xref rid="SD2" ref-type="supplementary-material">Supplementary Figure 7</xref>). By projecting the vector of bias corrected deviations from individual cells into two dimensions using tSNE<sup><xref rid="R11" ref-type="bibr">11</xref></sup>, <italic>chromVAR</italic> enables the reconstruction of the major hematopoietic lineages using 10,000 fragments per sample. With this analytical framework, we can also visualize the TFs associated with significant chromatin accessibility within each simulated single cell epigenome, thereby correctly identifying known master regulators of hematopoiesis, including HOXA9, SPI1, TBX21, and GATA1<sup><xref rid="R12" ref-type="bibr">12</xref>–<xref rid="R15" ref-type="bibr">15</xref></sup> (<xref rid="F1" ref-type="fig">Fig. 1c</xref>).</p>
    <p id="P8">We next characterized chromVAR’s ability to capture biologically relevant chromatin variability from single cell ATAC-seq data drawn from multiple distinct cell lines and human samples (<xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 8</xref>). Using tSNE with bias corrected deviations for motifs and 7mers, we clustered individual cells into distinct cell types and observe individual motifs that best distinguish each cell type (<xref rid="F2" ref-type="fig">Fig. 2a</xref>). Notably, well defined, distinct clusters are formed in this tSNE projection when using the bias corrected deviations, but the clustering is confounded by technical biases when using raw deviations without the bias correction infrastructure. Importantly this approach for classifying cell types also compares favorably performing tSNE on the counts within peaks using a variety of approaches (<xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 9</xref>). Interestingly, we also observe that cells from acute myeloid leukemia (AML) patients cluster between lymphoid-primed multipotent progenitors (LMPPs), monocytes, and HL60 (an AML derived cancer cell line) cells. In this unsupervised analysis, we find that the AML leukemic stem cells are more similar to LMPPs, while the AML blasts are more similar to the monocytes. In addition, we also observe that patient 1 (AML blast 1) maintains a more stem-like state when compared to patient 2 (AML blast 2) as anticipated from alternate analyses of these cells<sup><xref rid="R16" ref-type="bibr">16</xref></sup>. By visualizing the cell-specific Z-scores layered on this projection, we identify putative TFs that may promote the stem-like versus differentiated leukemia phenotype; for example, the master-regulators of myeloid cell development SPI1 (PU.1) and CEBPA<sup><xref rid="R17" ref-type="bibr">17</xref></sup> appear as the most differential motifs between AML leukemic stem cells (LSCs) and blasts (<xref rid="F2" ref-type="fig">Fig. 2b–c</xref>).</p>
    <p id="P9">In addition to visualizing the similarity of cells, we inverted our tSNE analysis to visualize the similarity of motifs and kmers in their activity patterns across cells (<xref rid="F3" ref-type="fig">Fig. 3a</xref>). In this visualization, motifs and kmers that have similar activity profiles across cells cluster together in the tSNE subspace, allowing the identification of major clusters representing several different TF families. Notably, different TFs within the same family (e.g. GATA1 and GATA2) often bind highly similar motifs, and therefore chromVAR alone cannot distinguish the causative regulator binding a particular TF motif. In the inverted tSNE visualization for motif and kmer similarity, most, but not all kmers cluster with a known motifs, suggesting k-mer analysis may enable <italic>de novo</italic> discovery of previously unannotated motifs.</p>
    <p id="P10">By comparing the variation in chromatin accessibility across cells between highly similar kmers, we can identify critical bases associated with chromatin accessibility variation. For example, the “AGATAAG” kmer, which closely matches the GATA1 motif, is highly variable across single cells, but most kmers differing by one nucleotide share little or none of that variability (<xref rid="F3" ref-type="fig">Fig. 3b</xref>, <xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 10</xref>). The mismatched kmer with the greatest correlated variability is “TGATAAG”, which is consistent with the weights of each nucleotide in the GATA1 motif. Similarly strong sequence specificity is seen across other variable motifs (<xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 10</xref>).</p>
    <p id="P11">We can use these comparisons of variation between highly similar kmers to construct <italic>de novo</italic> motifs representing sequences associated with variation in chromatin accessibility. In brief, we start with highly variable “seed” kmers, and use the covariance between the seed kmer and kmers either differing by one mismatch or partially overlapping the seed kmer to assign weights to different nucleotide bases at each position of the motif model (<xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 11</xref>; <bold>see methods</bold>). Importantly, many <italic>de novo</italic> motifs assembled using this approach closely match known motifs (<xref rid="F3" ref-type="fig">Figs. 3c–f</xref>, <xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 11</xref>). For motifs that do not closely match to a known TF, we confirmed that the constructed motifs were also associated with variation in DNase hypersensitivity between different samples represented in the Roadmap Epigenomics Project<sup><xref rid="R18" ref-type="bibr">18</xref></sup> (<xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 12</xref>), demonstrating that these <italic>de novo</italic> motifs are associated with chromatin accessibility variation in two distinct accessibility assays. To further validate the discovery of these putative <italic>trans</italic>-regulators we calculated aggregate TF “footprints”, a measure of the DNase or Tn5 cut density around the given motif, and found a diverse set of accessibility profiles (<xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 12</xref>). Interestingly, several of these motifs did not match canonical narrow (~20 bp) transcription factor footprints, but rather are associated with a large footprint (&gt;20 bp) potentially indicative of larger regulatory complexes.</p>
    <p id="P12">In summary, we envision that <italic>chromVAR</italic> will be broadly applicable to single-cell and bulk epigenomics data to provide an unbiased characterization of cell types and the <italic>trans</italic> regulators that define them. As such, we applied chromVAR to two bulk chromatin accessibility data sets<sup><xref rid="R18" ref-type="bibr">18</xref>,<xref rid="R19" ref-type="bibr">19</xref></sup> down-sampled to 10,000 fragments per sample and data from an alternate scATAC-seq approach and find chromVAR to generalize to these additional data (<xref rid="SD2" ref-type="supplementary-material">Supplementary Figs 13–15</xref>; <xref rid="SD1" ref-type="supplementary-material">Supplementary Note 3</xref>). As methods for measuring the epigenome in single-cells and bulk populations continue to improve in throughput and in quality, scalable analytical infrastructure is needed. Analysis workflows for ATAC or DNase-seq data often include the identification of motifs enriched in differentially accessible peaks, but such approaches scale poorly to comparisons across many sample types and require sufficient read depth per-locus to determine differential peak accessibility (<xref rid="SD1" ref-type="supplementary-material">Supplementary Note 4</xref>). In contrast, <italic>chromVAR</italic> analysis is highly robust to low sequencing depth and readily scales to hundreds or thousands of cells or samples. Budget-constrained researchers often face a trade-off between the number of samples to sequence and the sequencing depth for each sample; sparse sequencing analysis coupled with chromVAR analysis may enable new applications of “bulk” ATAC, DNase-seq or other epigenomic methods as large-scale screening tools. We also anticipate that <italic>chromVAR</italic> will enable additional downstream analyses of single cell chromatin accessibility data, as the reduction of dimensionality associated with vectors of bias corrected deviations provide a powerful input to existing algorithms for inferring inferring spatial and temporal relationships between cells.</p>
  </sec>
  <sec id="S2" specific-use="web-only">
    <title>Online Methods</title>
    <sec id="S3">
      <title>chromVAR algorithm</title>
      <sec id="S4">
        <title>Bias corrected deviations and z-scores</title>
        <p id="P13">For each motif (or kmer or genomic annotation), a “raw accessibility deviation” for each cell or sample is computed that represents the difference in the total accessibility of peaks with that motif minus the expected count based on the accessibility profile across all cells, divided by that expected count (<xref rid="SD2" ref-type="supplementary-material">Figure S1</xref>). Using the matrix of fragment counts in peaks <bold>X</bold>, where <italic>x<sub>i,j</sub></italic> represents the number of fragments from cell <italic>i</italic> in peak <italic>j</italic>, and the matrix of motif matches <bold>M</bold>, where <italic>m<sub>k,j</sub></italic> is 1 if motif <italic>k</italic> is present in peak <italic>j</italic>. The total number of reads mapping to every peak containing motif k in cell i is given by <italic>M</italic> * <italic>X<sup>T</sup></italic>. For each peak, the expected number of fragments per cell E is computed as the fraction of all fragments across all cells mapping to that peak multiplied by the total number of fragments in peaks for that cell: 
<disp-formula id="FD1"><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi mathvariant="normal">∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="normal">∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi mathvariant="normal">∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>∗</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munder><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p>
        <p id="P14">The expected number of fragments mapping to every peak containing motif <italic>k</italic> in cell <italic>i</italic> is then given by <italic>M</italic> * <italic>E<sup>T</sup></italic>, and the raw accessibility deviation Y by: 
<disp-formula id="FD2"><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mi>Y</mml:mi><mml:mo>=</mml:mo><mml:mstyle scriptlevel="1"><mml:mfrac><mml:mrow><mml:mi>M</mml:mi><mml:mo>∗</mml:mo><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mo>-</mml:mo><mml:mi>M</mml:mi><mml:mo>∗</mml:mo><mml:msup><mml:mi>E</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mrow><mml:mi>M</mml:mi><mml:mo>∗</mml:mo><mml:msup><mml:mi>E</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:mfrac></mml:mstyle></mml:mrow></mml:math></disp-formula></p>
        <p id="P15">For each motif or genomic annotation, background peak sets are sampled that match the set of peaks with the motif or genomic annotation in terms of the distribution of GC content and average accessibility. These background peak sets are determined by finding possible background peaks for each peak, as described in the next section. For each background iteration, we can represent the background peak assignments as a matrix <bold><italic>B</italic></bold> where <italic>b<sub>j,j</sub></italic>, is 1 if peak <italic>j</italic> has peak <italic>j′</italic> as it’s background peak and 0 otherwise. A background motif match matrix M′ is thus computed as <italic>M</italic>′ = <italic>M</italic> * <italic>B</italic>, and a background raw deviation as: 
<disp-formula id="FD3"><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:msup><mml:mi>Y</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mstyle scriptlevel="1"><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:mo>∗</mml:mo><mml:mi>B</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∗</mml:mo><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mo>-</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:mo>∗</mml:mo><mml:mi>B</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∗</mml:mo><mml:msup><mml:mi>E</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mrow><mml:mi>M</mml:mi><mml:mo>∗</mml:mo><mml:msup><mml:mi>E</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:mfrac></mml:mstyle><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
        <p id="P16">Y′ is calculated for each background iteration, and these background deviations are used to compute a bias-corrected deviation as <italic>Y</italic> − <italic>mean</italic>(<italic>Y</italic>′). A deviation Z-score is computed by dividing the bias-corrected deviation by the standard deviation of the background raw deviations for each iteration: 
<disp-formula id="FD4"><mml:math id="M4" display="block" overflow="scroll"><mml:mrow><mml:mstyle scriptlevel="1"><mml:mfrac><mml:mrow><mml:mi>Y</mml:mi><mml:mo>-</mml:mo><mml:mi mathvariant="italic">mean</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>Y</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>d</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>Y</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mstyle><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      </sec>
      <sec id="S5" sec-type="background">
        <title>Background peak selection</title>
        <p id="P17">The state space of GC content and the log of the average accessibility of peaks is transformed by the Mahalanobis transformation in order to remove the correlation between the two variables. This transformed space is split into an even grid of bins with a specified number of divisions (50) along each axis evenly spaced between the minimum and maximum values. For a peak in a given bin j, the probability of selecting another peak x in bin i is given by: 
<disp-formula id="FD5"><mml:math id="M5" display="block" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo mathvariant="italic">∈</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>-</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∣</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfrac></mml:mrow></mml:math></disp-formula></p>
        <p id="P18">Where f is the probability distribution function of the normal distribution with mean zero and standard deviation w (set to 0.01), and <italic>ρ</italic> is the number of peaks in the bin j.</p>
      </sec>
      <sec id="S6">
        <title>Variability</title>
        <p id="P19">The variability of a TF motif across samples or cells was determined by computing the standard deviation of the z-scores across the cells or samples. The expected value of this metric is one if the motif peak sets are no more variable than the background peak sets for that motif.</p>
      </sec>
      <sec id="S7">
        <title>De novo motif assembly</title>
        <p id="P20">As a measure of the shared variability in chromatin accessibility between a reference kmer (or motif) and other kmers (or motifs), we compute a normalized co-variance based on deviation z-scores. This normalized covariance is simply the covariance of the z-scores across each cell divided by the variance of the z-scores for the reference kmer (or motif).</p>
        <p id="P21">For assembling <italic>de novo</italic> motifs, we start with the kmer associated with the greatest variability in chromatin accessibility across the cells as a “seed” kmer. We first find the distribution of the normalized covariances between that seed kmer and all other kmers with an edit distance from that seed kmer of at least 3; these values are used as a null distribution for testing the significance of the observed covariances for kmers with a single nucleotide mismatch using a Z-test. For each position along the kmer, the nucleotide of the seed kmer is given a weight of 1. Each alternate nucleotides is given a weight of zero if the p-value for the normalized covariance of the kmer with that mismatch is greater than 0.05; if the p-value is less than 0.05 the nucleotide is given a weight equal to the square of the normalized covariance. The weights for each base pair are then normalized to sum to 1. To further extend the <italic>de novo</italic> motif, we used kmers overlapping the seed kmer with an offset of 1 or 2 bases. For the two bases immediately outside the seed kmer, the weighting of each nucleotide is given by <italic>x</italic> * <italic>y</italic><sup>2</sup> + (1 − <italic>x</italic>)) * 0.25, where <italic>y</italic><sup>2</sup> is the square of the normalized covariance for the kmer with the given nucleotide offset (if significant at 0.05 and otherwise 0) and <italic>x</italic> is the maximum value of the normalized covariances for the four kmers (bounded by 0 and 1). For the bases offset by two from the seed kmer, the weighting is computed in the same way except that there are four possible kmers with a given nucleotide at that position that overlap the seed kmer; only the kmer with the maximum normalized covariance with the seed kmer is used (<xref rid="SD2" ref-type="supplementary-material">Figure S11</xref>).</p>
      </sec>
    </sec>
    <sec id="S8">
      <title>Input data and pre-processing</title>
      <sec id="S9">
        <title>ATAC-seq, scATAC, and DNase Data</title>
        <p id="P22">In addition to the previously published data, we generated three new replicates of single-cell K562s (ATCC; validated using STR genotyping (Genetica DNA laboratories)) using the previously published protocol<sup><xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R8" ref-type="bibr">8</xref></sup>. Bulk ATAC-seq and scATAC-seq data was aligned and filtered as described previously<sup><xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R8" ref-type="bibr">8</xref></sup>. Uniformly processed DNase data was downloaded from the Roadmap Epigenomics Project Portal<sup><xref rid="R18" ref-type="bibr">18</xref></sup>. ATAC-seq data from Lavin et al. (2014) was obtained from GSE63341 and processed as follows: adapters were trimmed using Cutadapt<sup><xref rid="R20" ref-type="bibr">20</xref></sup>, reads were aligned using Bowtie2<sup><xref rid="R21" ref-type="bibr">21</xref></sup>, and filtered for mapping quality (mapq &gt; 30). For the scATAC-seq data from the GM12878 and HEK293T mixture from the combinatorial indexing approach, a count matrix was obtained from GSM1647122.</p>
      </sec>
      <sec id="S10">
        <title>Peaks</title>
        <p id="P23">For the bulk data analysis, we obtained DNase hypersensitivity peaks from the Roadmap Epigenomics Project. MACS2<sup><xref rid="R22" ref-type="bibr">22</xref></sup> peaks for blood cells (Primary monocytes from peripheral blood, Primary B cells from peripheral blood, Primary T cells from peripheral blood, Primary Natural Killer cells from peripheral blood, Primary hematopoietic stem cells G-CSF-mobilized Female, Primary hematopoietic stem cells G-CSF-mobilized Male, and Monocytes-CD14+ RO01746 Cell line) were downloaded from the Epigenomics Roadmap Portal<sup><xref rid="R18" ref-type="bibr">18</xref></sup>. For the single cell ATAC-seq data, peaks were called for each cell line or type using MACS2 applied to the merged single cell ATAC-seq data. All peaks were re-sized to a uniform width of 500 bp, centered at the summit. For both the set of peak calls from the blood cells in Roadmap and the set of peak calls from the scATAC-seq data, peaks were combined by removing any peaks overlapping with a peak with greater signal. Peak width was chosen based on typical sizes of ATAC-seq peaks across a wide collection of experiments, although chromVAR is fairly robust to the exact size of the peaks used (<xref rid="SD2" ref-type="supplementary-material">Figure S5</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Note 2</xref>).</p>
      </sec>
      <sec id="S11">
        <title>Motif collection</title>
        <p id="P24">We curated Position Frequency Matrices from cisBP representing a total of 15,389 human motifs and 14,367 mouse motifs. To filter motifs to a representative subset, we first categorized motifs as high, medium or low quality, as is provided in the cisBP database. We then grouped all 870 unique human or 850 unique mouse TF regulators represented in the database and assigned these regulators to their most representative TF motif(s). To do this, we first iterated through each TF regulator to find all motifs associated with that regulator from the high-quality motif list. For these associated high quality motifs, we first computed a similarity matrix using the Pearson correlation of the motifs. To calculate the Pearson correlation between pair-wise motifs, the shorter motif was padded with an equal distribution of A,C,G,T. Then the Pearson correlation was calculated at every possible offset, and the maximum correlation of all offset comparisons was recorded. To select a representative subset of motifs for each TF regulator, we first found the motif correlated with the most other motifs at R&gt;0.9. Treating that motif and all of the correlated motifs (R&gt;0.9) as a group, we next found the motif with the greatest mean correlation to the other members of the group, and kept that motif as a representative motif for the TF. Motifs highly correlated with that chosen motif (R&gt;0.9) were then discarded from further analysis, and the process was iterated until no motifs remained. We repeated the process using the medium and low-quality databases for TF regulators with no associated motifs in the high-quality database. The final curated motif database contains 1,764 human motifs and 1,346 mouse motifs representing 870 human and 850 mouse regulators. The resulting names are formatted as follows:: “ensemble ID”_”unique line number”_”common TF name”_”direct (D) or inferred (I)”_”number of similar motifs grouped”. These position frequency matrices were then converted into Position Weight Matrices (PWMS) by taking the log of the frequency after adding a 0.008 pseudocount and dividing by 0.25.</p>
        <p id="P25">These PWMs were used for all analyses in main text figures. For <xref rid="SD2" ref-type="supplementary-material">Figures S2–5 and S13</xref> a smaller set of motifs from the JASPAR CORE database 2016 were used<sup><xref rid="R23" ref-type="bibr">23</xref></sup>. For <xref rid="SD2" ref-type="supplementary-material">Figure S14</xref>, motifs downloaded from <ext-link ext-link-type="uri" xlink:href="http://homer.ucsd.edu/homer/custom.motifs">http://homer.ucsd.edu/homer/custom.motifs</ext-link> were used<sup><xref rid="R24" ref-type="bibr">24</xref></sup>, and for <xref rid="SD2" ref-type="supplementary-material">Figure S15</xref> motifs downloaded from <ext-link ext-link-type="uri" xlink:href="http://compbio.mit.edu/encode-motifs/">http://compbio.mit.edu/encode-motifs/</ext-link> were used<sup><xref rid="R25" ref-type="bibr">25</xref></sup> in order to use the same motifs as the original publication for those data sets.</p>
      </sec>
      <sec id="S12">
        <title>Motif matching</title>
        <p id="P26">The MOODS<sup><xref rid="R26" ref-type="bibr">26</xref></sup> C++ library (Version 1.9.3) was used for identifying peaks containing a motif match, using a p-value cutoff of 5×10<sup>−5</sup>. As background frequencies we used the nucleotide frequencies across all peaks. We wrapped the MOODS library into an R package, <italic>motifmatchr</italic>, which enables fast determination of motif presence or positions within genomic regions. The package is available at <ext-link ext-link-type="uri" xlink:href="www.github.com/GreenleafLab/motifmatchr">www.github.com/GreenleafLab/motifmatchr</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://bioconductor.org/packages/devel/bioc/html/motifmatchr.html">https://bioconductor.org/packages/devel/bioc/html/motifmatchr.html</ext-link>.</p>
      </sec>
    </sec>
    <sec id="S13">
      <title>Analysis</title>
      <sec id="S14">
        <title>Downsampling Analysis</title>
        <p id="P27">To downsample a sample with X total fragments to a depth of Y total fragments, we use the fragment count matrix and for each fragment within a peak retained each fragment with probability Y/X. Thus the downsampled samples are equivalent to having approximately Y total fragments, but not precisely.</p>
        <p id="P28">The set of peaks used for the analysis remained the same for each down-sampled data set, as the peaks used were from an external data source (Roadmap Epigenomics Project).</p>
        <p id="P29">For clustering samples using chromVAR results, highly correlated motifs were first removed and then one minus the pearson correlation of the bias corrected deviations was used as the distance matrix for input into hierarchical clustering. For clustering samples using PCA, PCA was performed on the log of the fragment counts for all peaks after normalization for the total number of reads in peaks, and clustering was performed on the euclidean distance between the first five principal components. Hierarchical clustering was performed with complete linkage, and the resulting dendrogram was cut into 13 groups (the number of cell types). Clustering accuracy was measured using normalized mutual information <sup><xref rid="R27" ref-type="bibr">27</xref></sup>.</p>
      </sec>
      <sec id="S15">
        <title>Differential Accessibility and Variability</title>
        <p id="P30">For determining differentially accessible motifs between AML LSC and blast cells, an unequal variances t-test (two-sided) was used on the bias corrected deviations. For determining differential variability, a Brown–Forsythe test was used on the deviation z-scores.</p>
      </sec>
      <sec id="S16">
        <title>Sample similarity tSNE</title>
        <p id="P31">For performing sample similarity tSNE, highly correlated motifs or kmers as well as motifs or kmers with variability below a certain threshold (1.5) were first removed from the bias corrected deviations matrix. The transpose of that matrix was then used as input to the Rtsne package<sup><xref rid="R28" ref-type="bibr">28</xref></sup>, with a perplexity parameter of 8 used for the down-sampled bulk hematopoiesis data and 25 for the single cell ATAC-seq data.</p>
      </sec>
      <sec id="S17">
        <title>Motif and kmer similarity tSNE</title>
        <p id="P32">For performing motif similarity tSNE, motifs or kmers with variability below a certain threshold (1.5) were first removed from the bias corrected deviations matrix, which was then used as input to the Rtsne package <sup><xref rid="R28" ref-type="bibr">28</xref></sup> with perplexity parameter set to 15.</p>
      </sec>
      <sec id="S18">
        <title>Motif Similarity Scores</title>
        <p id="P33">To score the similarity between a de novo motif and the most similar known motif, we first computed the normalized Euclidean distance between the de novo motif and all the known motifs in our collection using the optimal local alignment with at least five overlapping bases. We then selected the known motif with the lowest distance as the closest match. The similarity score was computed as the negative of the Z-score for this distance using the distribution of distances for all the motifs in the collection.</p>
      </sec>
    </sec>
    <sec id="S19">
      <title>Software Availability</title>
      <p id="P34">The chromVAR R package is freely available under the MIT license at <ext-link ext-link-type="uri" xlink:href="www.github.com/GreenleafLab/chromVAR">www.github.com/GreenleafLab/chromVAR</ext-link> and as <xref rid="SD1" ref-type="supplementary-material">Supplementary Software</xref>. The motifmatchr R package is freely available under a GPL-3 license is available at <ext-link ext-link-type="uri" xlink:href="www.github.com/GreenleafLab/motifmatchr">www.github.com/GreenleafLab/motifmatchr</ext-link> and as <xref rid="SD1" ref-type="supplementary-material">supplementary software</xref>.</p>
    </sec>
    <sec id="S20">
      <title>Data Availability</title>
      <p id="P35">The additional K562 scATAC-seq data have been deposited at GEO with accession number GSE99172. Previously published single cell ATAC-seq data are available from GSE74310 and GSE65360. Bulk hematopeisis ATAC-seq data are available at GSE74912. Macrophage bulk ATAC-seq data was obtained from GSE63341, combinatorial scATAC-seq from GSM1647122, and Roadmap Epigenomics data from the Roadmap Epigenomics Portal (<ext-link ext-link-type="uri" xlink:href="http://egg2.wustl.edu/roadmap/web_portal/">http://egg2.wustl.edu/roadmap/web_portal/</ext-link>).</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="S21">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>1</label>
      <media xlink:href="NIHMS896446-supplement-1.doc" orientation="portrait" xlink:type="simple" id="d36e1051" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>2</label>
      <media xlink:href="NIHMS896446-supplement-2.pdf" orientation="portrait" xlink:type="simple" id="d36e1055" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S22">
    <p>This work was supported by National Institutes of Health (NIH) P50HG007735 (to W.J.G.), U19AI057266 (to W.J.G.), the Rita Allen Foundation (to W.J.G.) and the Baxter Foundation Faculty Scholar Grant and the Human Frontiers Science Program (to W.J.G). J.D.B. acknowledges support from the Harvard Society of Fellows and Broad Institute Fellowship. ANS acknowledges support from the National Science Foundation (NSF) GRFP (DGE-114747). We thank Caleb Lareau for valuable suggestions for improvements on the package as well as members of Greenleaf and Buenrostro labs for useful discussions.</p>
  </ack>
  <fn-group>
    <fn fn-type="COI-statement" id="FN2">
      <p>
        <bold>Competing Interests</bold>
      </p>
      <p>J.D.B. and W.J.G. are listed as inventors on a patent for the ATAC- seq method. W.J.G. is a scientific cofounder of Epinomics.</p>
    </fn>
    <fn id="FN3" fn-type="con">
      <p>
        <bold>Author Contributions</bold>
      </p>
      <p>A.N.S, J.D.B, and W.J.G conceived the project and wrote the manuscript. A.N.S. wrote the chromVAR R package and performed the analyses with input from J.D.B and W.J.G. B.W. generated the scATAC-seq data.</p>
    </fn>
  </fn-group>
  <ref-list>
    <ref id="R1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Thurman</surname>
            <given-names>RE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The accessible chromatin landscape of the human genome</article-title>
        <source>Nature</source>
        <volume>489</volume>
        <fpage>75</fpage>
        <lpage>82</lpage>
        <year>2012</year>
        <pub-id pub-id-type="pmid">22955617</pub-id>
      </element-citation>
    </ref>
    <ref id="R2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tang</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Tracing the derivation of embryonic stem cells from the inner cell mass by single-cell RNA-Seq analysis</article-title>
        <source>Cell Stem Cell</source>
        <volume>6</volume>
        <fpage>468</fpage>
        <lpage>478</lpage>
        <year>2010</year>
        <pub-id pub-id-type="pmid">20452321</pub-id>
      </element-citation>
    </ref>
    <ref id="R3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jaitin</surname>
            <given-names>DA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel single-cell RNA-seq for marker-free decomposition of tissues into cell types</article-title>
        <source>Science</source>
        <volume>343</volume>
        <fpage>776</fpage>
        <lpage>779</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">24531970</pub-id>
      </element-citation>
    </ref>
    <ref id="R4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Buenrostro</surname>
            <given-names>JD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell chromatin accessibility reveals principles of regulatory variation</article-title>
        <source>Nature</source>
        <volume>523</volume>
        <fpage>486</fpage>
        <lpage>490</lpage>
        <year>2015</year>
        <pub-id pub-id-type="pmid">26083756</pub-id>
      </element-citation>
    </ref>
    <ref id="R5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jin</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genome-wide detection of DNase I hypersensitive sites in single cells and FFPE tissue samples</article-title>
        <source>Nature</source>
        <year>2015</year>
        <pub-id pub-id-type="doi">10.1038/nature15740</pub-id>
      </element-citation>
    </ref>
    <ref id="R6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cusanovich</surname>
            <given-names>DA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiplex single cell profiling of chromatin accessibility by combinatorial cellular indexing</article-title>
        <source>Science</source>
        <volume>348</volume>
        <fpage>910</fpage>
        <lpage>914</lpage>
        <year>2015</year>
        <pub-id pub-id-type="pmid">25953818</pub-id>
      </element-citation>
    </ref>
    <ref id="R7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fan</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Characterizing transcriptional heterogeneity through pathway and gene set overdispersion analysis</article-title>
        <source>Nat Methods</source>
        <volume>13</volume>
        <fpage>241</fpage>
        <lpage>244</lpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">26780092</pub-id>
      </element-citation>
    </ref>
    <ref id="R8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ryan Corces</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Lineage-specific and single-cell chromatin accessibility charts human hematopoiesis and leukemia evolution</article-title>
        <source>Nat Genet</source>
        <volume>48</volume>
        <fpage>1193</fpage>
        <lpage>1203</lpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">27526324</pub-id>
      </element-citation>
    </ref>
    <ref id="R9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Farlik</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell DNA methylome sequencing and bioinformatic inference of epigenomic cell-state dynamics</article-title>
        <source>Cell Rep</source>
        <volume>10</volume>
        <fpage>1386</fpage>
        <lpage>1397</lpage>
        <year>2015</year>
        <pub-id pub-id-type="pmid">25732828</pub-id>
      </element-citation>
    </ref>
    <ref id="R10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Weirauch</surname>
            <given-names>MT</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Determination and inference of eukaryotic transcription factor sequence specificity</article-title>
        <source>Cell</source>
        <volume>158</volume>
        <fpage>1431</fpage>
        <lpage>1443</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">25215497</pub-id>
      </element-citation>
    </ref>
    <ref id="R11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van der</surname>
            <given-names>Maaten L</given-names>
          </name>
          <name>
            <surname>Hinton</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Visualizing Data using t-SNE</article-title>
        <source>J Mach Learn Res</source>
        <volume>9</volume>
        <fpage>2579</fpage>
        <lpage>2605</lpage>
        <year>2008</year>
      </element-citation>
    </ref>
    <ref id="R12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fujiwara</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Browne</surname>
            <given-names>CP</given-names>
          </name>
          <name>
            <surname>Cunniff</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Goff</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Orkin</surname>
            <given-names>SH</given-names>
          </name>
        </person-group>
        <article-title>Arrested development of embryonic red cell precursors in mouse embryos lacking transcription factor GATA-1</article-title>
        <source>Proc Natl Acad Sci U S A</source>
        <volume>93</volume>
        <fpage>12355</fpage>
        <lpage>12358</lpage>
        <year>1996</year>
        <pub-id pub-id-type="pmid">8901585</pub-id>
      </element-citation>
    </ref>
    <ref id="R13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ramos-Mejía</surname>
            <given-names>V</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>HOXA9 promotes hematopoietic commitment of human embryonic stem cells</article-title>
        <source>Blood</source>
        <volume>124</volume>
        <fpage>3065</fpage>
        <lpage>3075</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">25185710</pub-id>
      </element-citation>
    </ref>
    <ref id="R14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nerlov</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Graf</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>PU. 1 induces myeloid lineage commitment in multipotent hematopoietic progenitors</article-title>
        <source>Genes Dev</source>
        <volume>12</volume>
        <fpage>2403</fpage>
        <lpage>2412</lpage>
        <year>1998</year>
        <pub-id pub-id-type="pmid">9694804</pub-id>
      </element-citation>
    </ref>
    <ref id="R15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gordon</surname>
            <given-names>SM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The transcription factors T-bet and Eomes control key checkpoints of natural killer cell maturation</article-title>
        <source>Immunity</source>
        <volume>36</volume>
        <fpage>55</fpage>
        <lpage>67</lpage>
        <year>2012</year>
        <pub-id pub-id-type="pmid">22261438</pub-id>
      </element-citation>
    </ref>
    <ref id="R16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Goardon</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Coexistence of LMPP-like and GMP-like leukemia stem cells in acute myeloid leukemia</article-title>
        <source>Cancer Cell</source>
        <volume>19</volume>
        <fpage>138</fpage>
        <lpage>152</lpage>
        <year>2011</year>
        <pub-id pub-id-type="pmid">21251617</pub-id>
      </element-citation>
    </ref>
    <ref id="R17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Enhancement of hematopoietic stem cell repopulating capacity and self-renewal in the absence of the transcription factor C/EBP alpha</article-title>
        <source>Immunity</source>
        <volume>21</volume>
        <fpage>853</fpage>
        <lpage>863</lpage>
        <year>2004</year>
        <pub-id pub-id-type="pmid">15589173</pub-id>
      </element-citation>
    </ref>
    <ref id="R18">
      <label>18</label>
      <element-citation publication-type="journal">
        <collab>Roadmap Epigenomics Consortium et al</collab>
        <article-title>Integrative analysis of 111 reference human epigenomes</article-title>
        <source>Nature</source>
        <volume>518</volume>
        <fpage>317</fpage>
        <lpage>330</lpage>
        <year>2015</year>
        <pub-id pub-id-type="pmid">25693563</pub-id>
      </element-citation>
    </ref>
    <ref id="R19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lavin</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Tissue-resident macrophage enhancer landscapes are shaped by the local microenvironment</article-title>
        <source>Cell</source>
        <volume>159</volume>
        <fpage>1312</fpage>
        <lpage>1326</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">25480296</pub-id>
      </element-citation>
    </ref>
    <ref id="R20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Martin</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Cutadapt removes adapter sequences from high-throughput sequencing reads</article-title>
        <source>EMBnet.journal</source>
        <volume>17</volume>
        <fpage>10</fpage>
        <lpage>12</lpage>
        <year>2011</year>
      </element-citation>
    </ref>
    <ref id="R21">
      <label>21</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Langmead</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <article-title>Fast gapped-read alignment with Bowtie 2</article-title>
        <source>Nat Methods</source>
        <volume>9</volume>
        <fpage>357</fpage>
        <lpage>359</lpage>
        <year>2012</year>
        <pub-id pub-id-type="pmid">22388286</pub-id>
      </element-citation>
    </ref>
    <ref id="R22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Model-based analysis of ChIP-Seq (MACS)</article-title>
        <source>Genome Biol</source>
        <volume>9</volume>
        <fpage>R137</fpage>
        <year>2008</year>
        <pub-id pub-id-type="pmid">18798982</pub-id>
      </element-citation>
    </ref>
    <ref id="R23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mathelier</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>JASPAR 2016: a major expansion and update of the open-access database of transcription factor binding profiles</article-title>
        <source>Nucleic Acids Res</source>
        <year>2015</year>
        <pub-id pub-id-type="doi">10.1093/nar/gkv1176</pub-id>
      </element-citation>
    </ref>
    <ref id="R24">
      <label>24</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heinz</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Simple combinations of lineage-determining transcription factors prime cis-regulatory elements required for macrophage and B cell identities</article-title>
        <source>Mol Cell</source>
        <volume>38</volume>
        <fpage>576</fpage>
        <lpage>589</lpage>
        <year>2010</year>
        <pub-id pub-id-type="pmid">20513432</pub-id>
      </element-citation>
    </ref>
    <ref id="R25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kheradpour</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Kellis</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Systematic discovery and characterization of regulatory motifs in ENCODE TF binding experiments</article-title>
        <source>Nucleic Acids Res</source>
        <volume>42</volume>
        <fpage>2976</fpage>
        <lpage>2987</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">24335146</pub-id>
      </element-citation>
    </ref>
    <ref id="R26">
      <label>26</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korhonen</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Martinmäki</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Pizzi</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Rastas</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Ukkonen</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>MOODS: fast search for position weight matrix matches in DNA sequences</article-title>
        <source>Bioinformatics</source>
        <volume>25</volume>
        <fpage>3181</fpage>
        <lpage>3182</lpage>
        <year>2009</year>
        <pub-id pub-id-type="pmid">19773334</pub-id>
      </element-citation>
    </ref>
    <ref id="R27">
      <label>27</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Danon</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Díaz-Guilera</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Duch</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Arenas</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Comparing community structure identification</article-title>
        <source>J Stat Mech</source>
        <volume>2005</volume>
        <fpage>P09008</fpage>
        <lpage>P09008</lpage>
        <year>2005</year>
      </element-citation>
    </ref>
    <ref id="R28">
      <label>28</label>
      <element-citation publication-type="web">
        <person-group person-group-type="author">
          <name>
            <surname>Krijthe</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Rtsne: T-Distributed Stochastic Neighbor Embedding using Barnes-Hut Implementation</article-title>
        <source>R package version 0. 10</source>
        <comment>URL<ext-link ext-link-type="uri" xlink:href="http://CRAN.R-project.org/package=Rtsne">http://CRAN.R-project.org/package=Rtsne</ext-link></comment>
        <year>2015</year>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <title><italic>chromVAR</italic> enables interpretable analysis of sparse chromatin accessibility data</title>
      <p>(a) Schematic illustrating how chromVAR uses aggregation of accessibility across peaks sharing a common feature (e.g. a motif) with bias correction to generate scores for each cell or sample that can be used for downstream analysis (b) Pearson correlation of bias corrected deviations for 77 samples from different hematopoietic populations before and after downs down-sampling total sequencing reads from full data. Each point shows the correlation for a different motif. The top 20% most variable motifs are shown. Three of the most variable motifs are highlighted. (c) tSNE visualization of different samples using normalized deviations calculated from data down-sampled to 10,000 fragments per sample. In the first panel, cells are colored by cell type, and in other panels cells are colored by the deviations score for different motifs.</p>
    </caption>
    <graphic xlink:href="nihms896446f1"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <title><italic>chromVAR</italic> enables clustering of single cell populations and interpretation of motifs underlying chromatin accessibility variation in single cells</title>
      <p>(a) tSNE visualization of similarity of 1561 single cells based on chromVAR raw (left) or bias corrected deviations (right) for motifs and 7mers (see methods). In top panels, points are colored by cell type and in bottom panels points are colored by raw (left) or bias corrected (right) calculated deviations for a set of random peaks with high GC content and high average accessibility (the bias set). (b) Volcano plot showing the mean difference in bias corrected accessibility deviations (left) and variability (right) for each motif between the AML blast (n = 122) and LSC cells (n = 144) versus the −log<sub>10</sub>(P-value) for that difference. (c) tSNE with bias corrected deviations for AML blast and LSC, monocyte, LMPP, and HL60 cells (n = 509). In top panel, points are colored by cell type, and in other panels points are colored by deviation Z-scores for CEBPA and ZEB1 respectively.</p>
    </caption>
    <graphic xlink:href="nihms896446f2"/>
  </fig>
  <fig id="F3" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <title><italic>chromVAR</italic> identifies <italic>de novo</italic> motifs associated with chromatin accessibility variation in single cells</title>
      <p>(a) tSNE visualization of similarity between motifs and kmers based on the vector of normalized deviations across different cells. Labels highlight predominant families of motifs within a cluster and example kmers (b) For the seed kmer “AGATAAG”, the shared variability of k-mers with one mismatch from the seed kmer. The shared variability is defined as the square of the covariance of the deviation z-scores for the two kmers divided by the variance of the seed kmer for covariances greater than zero, and zero otherwise. These shared variabilities were used to assemble a <italic>de novo</italic> motif, shown under the plot along with the GATA1 motif. (c) Example <italic>de novo</italic> motifs assembled by chromVAR using deviations scores for 7-mers, along with the closest matching known motif below it. (d) Variability for both the <italic>de novo</italic> motif and the known motif for each pair in panel (c). (e) Motif similarity score (see methods) between the <italic>de novo</italic> motif and the known motifs in (c) (f) The Pearson correlation between the normalized deviations of the <italic>de novo</italic> motif and the known motif for each pair in (c).</p>
    </caption>
    <graphic xlink:href="nihms896446f3"/>
  </fig>
</floats-group>
