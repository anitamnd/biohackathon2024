<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nucleic Acids Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nucleic Acids Res</journal-id>
    <journal-id journal-id-type="publisher-id">nar</journal-id>
    <journal-title-group>
      <journal-title>Nucleic Acids Research</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0305-1048</issn>
    <issn pub-type="epub">1362-4962</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6582336</article-id>
    <article-id pub-id-type="pmid">31076776</article-id>
    <article-id pub-id-type="doi">10.1093/nar/gkz361</article-id>
    <article-id pub-id-type="publisher-id">gkz361</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Computational Biology</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Fast hierarchical Bayesian analysis of population structure</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0003-4397-2224</contrib-id>
        <name>
          <surname>Tonkin-Hill</surname>
          <given-names>Gerry</given-names>
        </name>
        <!--<email>gqt20@cam.ac.uk</email>-->
        <xref ref-type="aff" rid="AFF1">1</xref>
        <xref ref-type="corresp" rid="COR1"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0001-5360-1254</contrib-id>
        <name>
          <surname>Lees</surname>
          <given-names>John A</given-names>
        </name>
        <xref ref-type="aff" rid="AFF2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bentley</surname>
          <given-names>Stephen D</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Frost</surname>
          <given-names>Simon D W</given-names>
        </name>
        <xref ref-type="aff" rid="AFF3">3</xref>
        <xref ref-type="aff" rid="AFF4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Corander</surname>
          <given-names>Jukka</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">1</xref>
        <xref ref-type="aff" rid="AFF5">5</xref>
        <xref ref-type="aff" rid="AFF6">6</xref>
      </contrib>
    </contrib-group>
    <aff id="AFF1"><label>1</label>Parasites and Microbes, Wellcome Sanger Institute, Cambridge, CB10 1SA, UK</aff>
    <aff id="AFF2"><label>2</label>Department of Microbiology, New York University School of Medicine, NY 10016, USA</aff>
    <aff id="AFF3"><label>3</label>Department of Veterinary Medicine, University of Cambridge, Cambridge, CB3 0ES, UK</aff>
    <aff id="AFF4"><label>4</label>The Alan Turing Institute, London, NW1 2DB, UK</aff>
    <aff id="AFF5"><label>5</label>Department of Biostatistics, University of Oslo, Blindern 0317, Norway</aff>
    <aff id="AFF6"><label>6</label>Helsinki Institute for Information Technology HIIT, Department of Mathematics and Statistics, University of Helsinki, Aalto FI-00076, Finland</aff>
    <author-notes>
      <corresp id="COR1">To whom correspondence should be addressed. Tel: +44 1223 834244; Fax: +44 1223 494919; Email: <email>gqt20@cam.ac.uk</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>20</day>
      <month>6</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2019-05-11">
      <day>11</day>
      <month>5</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>11</day>
      <month>5</month>
      <year>2019</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>47</volume>
    <issue>11</issue>
    <fpage>5539</fpage>
    <lpage>5549</lpage>
    <history>
      <date date-type="accepted">
        <day>29</day>
        <month>4</month>
        <year>2019</year>
      </date>
      <date date-type="received">
        <day>25</day>
        <month>3</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2019. Published by Oxford University Press on behalf of Nucleic Acids Research.</copyright-statement>
      <copyright-year>2019</copyright-year>
      <license license-type="cc-by" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="gkz361.pdf"/>
    <abstract>
      <title>Abstract</title>
      <p>We present fastbaps, a fast solution to the genetic clustering problem. Fastbaps rapidly identifies an approximate fit to a Dirichlet process mixture model (DPM) for clustering multilocus genotype data. Our efficient model-based clustering approach is able to cluster datasets 10–100 times larger than the existing model-based methods, which we demonstrate by analyzing an alignment of over 110 000 sequences of HIV-1 pol genes. We also provide a method for rapidly partitioning an existing hierarchy in order to maximize the DPM model marginal likelihood, allowing us to split phylogenetic trees into clades and subclades using a population genomic model. Extensive tests on simulated data as well as a diverse set of real bacterial and viral datasets show that fastbaps provides comparable or improved solutions to previous model-based methods, while being significantly faster. The method is made freely available under an open source MIT licence as an easy to use R package at <ext-link ext-link-type="uri" xlink:href="https://github.com/gtonkinhill/fastbaps">https://github.com/gtonkinhill/fastbaps</ext-link>.</p>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Wellcome Trust</named-content>
          <named-content content-type="funder-identifier">10.13039/100004440</named-content>
        </funding-source>
        <award-id>206194</award-id>
        <award-id>204016</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">ERC</named-content>
          <named-content content-type="funder-identifier">10.13039/501100000781</named-content>
        </funding-source>
        <award-id>742158</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Alan Turing Institute</named-content>
          <named-content content-type="funder-identifier">10.13039/100012338</named-content>
        </funding-source>
        <award-id>EP/510129/1</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">National Institutes of Health</named-content>
          <named-content content-type="funder-identifier">10.13039/100000002</named-content>
        </funding-source>
        <award-id>R01AI135970</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="11"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="intro" id="SEC1">
    <title>INTRODUCTION</title>
    <p>Identifying clusters of genetically similar individuals within a larger population is a common problem in genetics and ecology. Population structure is helpful in understanding past historical population events, conservation genetics, the analysis of invasive species and disease outbreaks. Confounding population structure must also be considered in tests for natural selection as well as genetic association studies (<xref rid="B1" ref-type="bibr">1–3</xref>).</p>
    <p>Methods for clustering genotype data can generally be separated into those based on a statistical model of population structure, where observations from each underlying cluster are assumed to be drawn from a parametric population genetics model (<xref rid="B4" ref-type="bibr">4</xref>), and distance-based methods that rely on more general clustering techniques such as <italic>k</italic>-means (<xref rid="B5" ref-type="bibr">5</xref>). While distance-based approaches are generally faster, they are not as readily interpretable and typically do not provide group membership probabilities making distinguishing weak separation between clusters and strong population structure difficult (<xref rid="B6" ref-type="bibr">6</xref>). Model-based methods typically indicate the probability that an individual belongs to a certain cluster, allow for different models to be compared, and can provide estimates of uncertainty for the inferred parameters. Generally, either Bayesian or maximum-likelihood based approaches are widely used for inference in population structure models.</p>
    <p>A commonly considered model of population structure assumes that there is a fixed number of uncorrelated underlying populations, <italic>K</italic>. An individual is then assumed to originate either from a single population, the no-admixture model or to carry alleles from multiple populations, which corresponds to the admixture model (<xref rid="B4" ref-type="bibr">4</xref>). Solutions to this problem include STRUCTURE (<xref rid="B4" ref-type="bibr">4</xref>,<xref rid="B7" ref-type="bibr">7</xref>), BAPS (<xref rid="B8" ref-type="bibr">8–10</xref>), Admixture (<xref rid="B11" ref-type="bibr">11</xref>), fast Structure (<xref rid="B12" ref-type="bibr">12</xref>), sNMF (<xref rid="B13" ref-type="bibr">13</xref>) and the method of Anderson and Thompson (<xref rid="B14" ref-type="bibr">14</xref>). More recently, methods that combine model-based techniques with an initial faster distance-based clustering have been proposed including snapclust (<xref rid="B6" ref-type="bibr">6</xref>) and hierBAPS (<xref rid="B15" ref-type="bibr">15</xref>). Admixture, fastStructure and sNMF solve for the admixture model and are not considered here.</p>
    <p>A common theme of most clustering methods is that they require the underlying number of clusters, <italic>K</italic>, to be provided. In practice, the methods are usually run over a range of <italic>K</italic> and the ‘best fitting’ model is selected (<xref rid="B16" ref-type="bibr">16</xref>,<xref rid="B17" ref-type="bibr">17</xref>). An alternative Bayesian solution is to put a prior on the number of clusters, usually using a Dirichlet process mixture model (DPM) in an attempt to infer <italic>K</italic> as part of the model (<xref rid="B18" ref-type="bibr">18</xref>,<xref rid="B19" ref-type="bibr">19</xref>). While this provides a natural method for inferring an appropriate <italic>K</italic>, the approach is very computationally expensive and does not scale to large numbers of loci and individuals. The greedy stochastic optimization approach in hierBAPS (<xref rid="B15" ref-type="bibr">15</xref>) places a discrete uniform prior on <italic>K</italic> up to a supplied maximum value and is able to scale to larger datasets. However, as datasets become very large, inferring <italic>K</italic> using model-based clustering approaches has so far been infeasible. An example of a dataset that is too large for current model-based methods is the set of HIV-1 pol genes, which are routinely generated in clinical settings for the purpose of identifying resistance to antivirals. Despite the relatively short length of this region (typically 1200–1500 bp long), the very large number of sequences—in excess of 100 000 in public databases alone—makes choosing an appropriate value for <italic>K</italic> very challenging.</p>
    <p>A DPM assumes a joint prior over the cluster allocation vector <italic>p</italic>, which indicates which cluster each individual is allocated to as well as the overall number of clusters <italic>K</italic> (<xref rid="B18" ref-type="bibr">18</xref>,<xref rid="B20" ref-type="bibr">20</xref>). More specifically the prior is assumed to follow a Dirichlet process where the prior joint probability of the allocation vector <italic>p</italic> and the number of clusters <italic>K</italic> is given by
<disp-formula><tex-math id="M1">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} f(p,K | \alpha , n) = \alpha ^k \frac{\prod _{i=1}^K (n_i -1)}{\prod _{i=1}^n (\alpha +i-1)} \end{equation*}\end{document}</tex-math></disp-formula></p>
    <p>The concentration parameter α determines the degree to which individuals group together in clusters. A smaller α value leads to larger clusters. However, it has previously been shown that the choice of α has little impact on the results when the number of loci is large (<xref rid="B20" ref-type="bibr">20</xref>). In addition to using a Dirichlet process prior on the allocation vector and number of clusters <italic>K</italic> we assume a separate Dirichlet prior distribution on the underlying allele frequencies within each cluster parameterized by β. Thus, we draw alleles frequencies from the model by first drawing the allocation vector and the number of clusters <italic>K</italic> and then drawing the allele count data <italic>D</italic> from a Multinomial–Dirichlet distribution. The marginal distribution of counts in each cluster component is given in the ‘Materials and Methods’ section.</p>
    <p>Unfortunately, methods that rely on a fully Bayesian inference approach using MCMC such as structurama are not feasible for very large datasets (<xref rid="B19" ref-type="bibr">19</xref>,<xref rid="B20" ref-type="bibr">20</xref>) with current faster approximations such as hierBAPS also failing to scale to some real world datasets (see ‘Results’ section). Other approximate inference methods for DPM models include variational inference (<xref rid="B21" ref-type="bibr">21</xref>), fast search (<xref rid="B22" ref-type="bibr">22</xref>), sequential updating and greedy search (SUGS) (<xref rid="B23" ref-type="bibr">23</xref>,<xref rid="B24" ref-type="bibr">24</xref>) and expectation propagation (<xref rid="B25" ref-type="bibr">25</xref>). While these methods offer substantial speed improvements over a full MCMC-based approach none of them are able to take advantage of the phylogenetic structure present in the datasets we consider. Instead, we leverage the inherent hierarchical structure of prokaryotic population genomic datasets to provide substantial speed improvements in inference.</p>
    <p>The Bayesian hierarchical clustering (BHC) algorithm (<xref rid="B26" ref-type="bibr">26</xref>) presents an alternative approach that approximates a DPM while guaranteeing a solution in polynomial time. The method performs a version of agglomerative bottom up clustering using a Dirichlet process to account for uncertainty in the data and Bayesian model selection to decide which clusters should be merged at each step. While the approach has been shown to succeed in clustering text documents, microarray data and even electrical demand profiles (<xref rid="B26" ref-type="bibr">26–28</xref>), it has yet to be successfully applied to the problem of identifying population structure. A reason for this is that the hyperparameters, β, of the model defining each component of the mixture are set to be proportional to the counts of each allele at each locus in the complete dataset. In practice setting the hyperparameters to be proportional to the entire dataset leads to an overpartitioning of population genetic data whereby the algorithm identifies a very high number of clusters (see ‘Results’ section). A common alternative prior in population structure studies is to use a symmetric Dirichlet prior (<xref rid="B4" ref-type="bibr">4</xref>). However, at the lowest levels of the hierarchy a symmetric prior will lead to different clustering combinations having the same likelihood. This greatly reduces the ability of the algorithm to accurately cluster sequences at the lower levels. In contrast, the hierBAPS algorithm relies on a fast initial clustering using complete-linkage agglomerative clustering to provide an initial partition of the dataset. hierBAPS then performs a greedy stochastic optimization procedure to identify the local maximum a posteriori (MAP). By taking advantage of a fast initial clustering approach similar to that used in hierBAPS we are able to place a symmetric or BAPS prior on the mixture components, enabling the BHC algorithm to distinguish between different combinations of clusters.</p>
    <p>Though methods such as hierBAPS and snapclust have allowed for analyses to scale to much larger datasets than previous approaches, they remain in practice inapplicable to the currently emerging datasets comprising tens of thousands or even hundreds of thousands of sequences, where large numbers of underlying clusters may be present. Here, through incorporating ideas from both BHC and hierBAPS, we produce an efficient inference solution to the no-admixture model for very large datasets when the underlying number of clusters may be in the tens or hundreds.</p>
  </sec>
  <sec sec-type="materials|methods" id="SEC2">
    <title>MATERIALS AND METHODS</title>
    <sec id="SEC2-1">
      <title>Initial clustering</title>
      <p>Similar to hierBAPS, but unlike the original BHC algorithm, fastbaps begins by generating a fast initial clustering of the data using a value for <italic>K</italic> much larger than expected (<italic>K</italic><sub>init</sub>). This has the advantage of both reducing the complexity of the Bayesian agglomerative stage while allowing for symmetric priors to be used. Starting with a multiple sequence alignment in FASTA format, we first generate a pairwise single nucleotide polymorphism distance matrix before clustering using Ward’s agglomerative clustering (<xref rid="B29" ref-type="bibr">29</xref>). This hierarchy is cut to generate <italic>K</italic><sub>init</sub> clusters. The hierarchy is also used to estimate the hyperparameters β of the individual mixture component priors. Very large datasets make the calculation of the initial pairwise distance matrix prohibitive. To counter this limitation, for datasets with more than 10 000 individuals we produce the initial clustering by first performing a Principal Component Analysis (PCA) before clustering the first 50 principal components using a fast hierarchical algorithm such as genie or the memory efficient Ward algorithm in the fastcluster package (<xref rid="B30" ref-type="bibr">30</xref>,<xref rid="B31" ref-type="bibr">31</xref>). This removes the need to calculate the complete distance matrix. The results were found to be robust to the number of principal components used with this approach found to provide near identical results to the distance matrix approach on the smaller datasets. This is expected in general as the PCA step is also only used at the lower levels of the clustering hierarchy and thus its impact is minimal on the final clustering solution.</p>
    </sec>
    <sec id="SEC2-2">
      <title>Bayesian hierarchical clustering</title>
      <p>Given a collection of small clusters and their respective hierarchies <italic>T</italic><sub><italic>i</italic></sub> where <italic>i</italic> ∈ {1..<italic>K</italic><sub><italic>init</italic></sub>}, the BHC algorithm of Heller and Ghahramani (<xref rid="B26" ref-type="bibr">26</xref>) proceeds in a similar fashion to traditional agglomerative clustering. In the place of a distance metric, Bayesian hypothesis testing is conducted at each level to decide which clusters to merge. Let <inline-formula><tex-math id="M2">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mathcal {D} = {x^{(1)},...,x^{(n)}}$\end{document}</tex-math></inline-formula> describe the entire dataset of <italic>n</italic> samples and <inline-formula><tex-math id="M3">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mathcal {D}_i$\end{document}</tex-math></inline-formula> the set of points at the leaves of the subtree <italic>T</italic><sub><italic>i</italic></sub>. We initialize the algorithm with the small subtrees obtained using the fast clustering step as shown in Figure <xref ref-type="fig" rid="F1">1</xref>. At each subsequent stage we then consider merging all pairs of existing trees. If trees <italic>T</italic><sub><italic>i</italic></sub> and <italic>T</italic><sub><italic>j</italic></sub> are merged into a combined tree <italic>T</italic><sub><italic>k</italic></sub> then the set of points corresponding to the new tree is <inline-formula><tex-math id="M4">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mathcal {D}_k = \mathcal {D}_i \cup \mathcal {D}_j$\end{document}</tex-math></inline-formula>. At each merge we compare two hypotheses. The merged hypothesis, which we denote <inline-formula><tex-math id="M5">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mathcal {H}_1^k$\end{document}</tex-math></inline-formula>, is that all data in <inline-formula><tex-math id="M6">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mathcal {D}_k$\end{document}</tex-math></inline-formula> were generated identically and independently from the same probabilistic model <inline-formula><tex-math id="M7">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$p(\boldsymbol{x} | \theta )$\end{document}</tex-math></inline-formula> with unknown parameters θ. In our case this model is a multinomial, with parameters θ = (<italic>n</italic>, ϕ). We also specify a Dirichlet prior over the parameters ϕ with hyperparameters β. Thus, we can write the probability of the data <inline-formula><tex-math id="M8">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mathcal {D}_k$\end{document}</tex-math></inline-formula> under <inline-formula><tex-math id="M9">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mathcal {H}_1^k$\end{document}</tex-math></inline-formula> as
<disp-formula><tex-math id="M10">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} p(\mathcal {D}_k | \mathcal {H}_1^k) = \int p(\mathcal {D}_k | \theta ) p(\theta | \beta ) d \theta \end{equation*}\end{document}</tex-math></disp-formula></p>
      <fig id="F1" orientation="portrait" position="float">
        <label>Figure 1.</label>
        <caption>
          <p>A diagram outlining the fastbaps algorithm. An initial clustering is performed by default using agglomerative clustering with the Ward linkage method. Subsequently the merge with the highest posterior probability is chosen. The final clustering is then determined by only accepting merges with a posterior probability &gt;0.5</p>
        </caption>
        <graphic xlink:href="gkz361fig1"/>
      </fig>
      <p>Assuming a multinomial–Dirichlet distribution, this integral is tractable and we can rewrite the above equation as:
<disp-formula><tex-math id="M11">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} p(\mathcal {D}_k | \mathcal {H}_1^k) = \prod _{j=1}^{N_L} \frac{\Gamma (\sum _l \beta _j)}{\Gamma \left(\sum _l ( \beta _j + n_{jl})\right)} \prod _{l=1}^{N_{A(j)}} \frac{\Gamma (\beta _j + n_{jl})}{\Gamma (\beta _j)} \end{equation*}\end{document}</tex-math></disp-formula></p>
      <p>Where <italic>N</italic><sub><italic>L</italic></sub> is the number of loci, <inline-formula><tex-math id="M12">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$N_{A_{(j)}}$\end{document}</tex-math></inline-formula> is the number of possible alleles at loci <italic>j</italic> and <italic>n</italic><sub><italic>jl</italic></sub> is the number of copies of allele <italic>l</italic> at locus <italic>j</italic>. β<sub><italic>j</italic></sub> is the corresponding Dirichlet prior hyperparameter.</p>
      <p>The alternative hypothesis to merging two clusters (<inline-formula><tex-math id="M13">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mathcal {H}_1^k$\end{document}</tex-math></inline-formula>) is that the data <inline-formula><tex-math id="M14">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mathcal {D}_k$\end{document}</tex-math></inline-formula> have two or more clusters. Summing over all the possible partitions of <inline-formula><tex-math id="M15">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mathcal {D}_k$\end{document}</tex-math></inline-formula> into two or more groups is in practice intractable. However, by only considering partitions that are consistent with the subtrees <italic>T</italic><sub><italic>i</italic></sub> and <italic>T</italic><sub><italic>j</italic></sub>, we can use recursion to quickly compute this sum. Under the restriction of remaining consistent with the subtrees, the probability of the data under the alternative hypothesis <inline-formula><tex-math id="M16">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\mathcal {H}_2^k$\end{document}</tex-math></inline-formula>, is just the product over the subtrees <inline-formula><tex-math id="M17">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$p(\mathcal {D}_k | \mathcal {H}_2^k) = p(\mathcal {D}_i | T_i) p(\mathcal {D}_j | T_j)$\end{document}</tex-math></inline-formula> (see Figure <xref ref-type="fig" rid="F1">1</xref>) where the probability of the data given the tree is given by
<disp-formula><tex-math id="M18">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} p(\mathcal {D}_k | T_k) = \pi _k p(\mathcal {D}_k | \mathcal {H}_1^k) + (1-\pi _k) p(\mathcal {D}_i | T_i) p(\mathcal {D}_j | T_j) \end{equation*}\end{document}</tex-math></disp-formula></p>
      <p>Here, the first term for each initial cluster is defined recursively using the fast clustering based hierarchy with initial prior for the merged hypothesis set to <italic>π</italic><sub>0</sub> = 1. The prior for the merged hypothesis <inline-formula><tex-math id="M19">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\pi _k := p(\mathcal {H}_1^k)$\end{document}</tex-math></inline-formula>, can then be computed bottom-up as described in Heller and Ghahramani, (<xref rid="B26" ref-type="bibr">26</xref>) and is a deterministic function of the concentration parameter of the DPM. In practice, for the size of datasets we are considering, the actual value of α makes very little difference as the prior π<sub><italic>k</italic></sub> is dominated by the factorial on the number of points within a cluster. Similar to Savage <italic>et al.</italic>, (<xref rid="B28" ref-type="bibr">28</xref>), we fix the value of α, the concentration parameter of the DPM, rather than keeping it as a user-tunable hyperparameter in the resulting clustering algorithm.</p>
      <p>At last, given the probabilities of each hypothesis described above we can calculate the posterior probability of the merged hypothesis <inline-formula><tex-math id="M20">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$r_k := p(\mathcal {H}_1^k | D_k)$\end{document}</tex-math></inline-formula> using Bayes’ rule
<disp-formula><tex-math id="M21">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} r_k = \frac{\pi _k p(\mathcal {D}_k | \mathcal {H}_1^k)}{\pi _k p(\mathcal {D}_k | \mathcal {H}_1^k) + (1-\pi _k)p(\mathcal {D}_i|T_i)p(\mathcal {D}_j | T_j)} \end{equation*}\end{document}</tex-math></disp-formula>We use this quantity to greedily decide which two subtrees to merge. After generating a final hierarchy we then use the same quantity to identify which merges were justified and cut the tree when <italic>r</italic><sub><italic>k</italic></sub> &lt; 0.5.</p>
    </sec>
    <sec id="SEC2-3">
      <title>Hyperparameter selection</title>
      <p>As described in Heller and Ghahramani (<xref rid="B26" ref-type="bibr">26</xref>), for any given set of hyperparameters, the root node of the hierarchy approximates the probability of the data given that setting of the hyperparameters. By leveraging this, we use the marginal likelihood of the root node <inline-formula><tex-math id="M22">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$p(\mathcal {D}|T)$\end{document}</tex-math></inline-formula> to perform model comparisons for different settings of the hyperparameters. We found that different settings of the hyperparameter α had a negligible impact on the final clustering due to the dominance of the factorial component of π<sub><italic>k</italic></sub>, which provided a strong motivation to fix the hyperparameter at the value <italic>α</italic> = 1. Similar to Heller and Ghahramani (<xref rid="B26" ref-type="bibr">26</xref>) and Savage <italic>et al.</italic>, (<xref rid="B28" ref-type="bibr">28</xref>), we use golden section search as provided in R’s ‘optimize’ function to select the β parameters and thus the variance of the Dirichlet prior. Unlike previous approaches, we did not set the β parameters to be proportional to the discrete total counts for the entire dataset. Instead we used either a symmetric prior, similar to Pritchard <italic>et al.</italic>, (<xref rid="B4" ref-type="bibr">4</xref>) or the non-informative prior <inline-formula><tex-math id="M23">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\beta _j \propto \frac{1}{N_{A_{(j)}}}$\end{document}</tex-math></inline-formula> as used in hierBAPS and suggested in Anderson and Thompson (<xref rid="B14" ref-type="bibr">14</xref>). These priors are referred to as optimized symmetric, and optimized BAPS priors hereafter. These priors were found to generally outperform the prior used in the original BHC algorithm. To increase the efficiency in optimizing the variance of the Dirichlet prior, we relied on an initial hierarchy produced using Ward’s agglomerative clustering. The marginal likelihood of the root node was then used to select an appropriate scaling for the β hyperparameters. We subsequently refer to the combination of fast cluster initialization, BHC and prior hyperparameter optimization using a symmetric or BAPS based prior as ‘fastbaps’.</p>
    </sec>
    <sec id="SEC2-4">
      <title>Conditioning on a pre-computed hierarchy</title>
      <p>Given a pre-computed hierarchy or phylogeny, we can use the recursion method described previously to decide when merging sub-clades of the tree is justified according to the DPM model. This provides a parametric model based alternative to previous tree partition algorithms such as Cluster Picker (<xref rid="B32" ref-type="bibr">32</xref>), also relaxing the computationally intensive requirement for bootstrap replicates of the tree being partitioned. It allows us to identify a partition of the tree into clades that maximizes the marginal likelihood of a DPM model given a hierarchy. As the hierarchy is pre-calculated, the approach is highly efficient and has a linear computational complexity in the number of nodes in the hierarchy. By leveraging the sparse matrix data structures in fastbaps and coupling them with the efficient implementation of Ward’s hierarchical clustering in the fastcluster package (<xref rid="B31" ref-type="bibr">31</xref>), we are able to generate clusterings of comparable quality to the full fastbaps algorithm very quickly (see Figure <xref ref-type="fig" rid="F4">4</xref> and <xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S8</xref>).</p>
    </sec>
    <sec id="SEC2-5">
      <title>Cluster stability using the Bootstrap</title>
      <p>In order to determine the sensitivity of the resulting clusters to the alignment, we implemented a simple bootstrap procedure. For each bootstrap replicate, the loci are sampled with replacement and the fastbaps clustering algorithm is run. A binary similarity matrix is then produced as described in Strehl and Ghosh (<xref rid="B33" ref-type="bibr">33</xref>) where for each pair of sequences (i,j), the (i,j)th entry in the matrix is 1 if the ith and jth sequences are clustered together and 0 otherwise. As this matrix is invariant to label switching (<xref rid="B34" ref-type="bibr">34</xref>) and its dimension is invariant to the underlying number of clusters, the sum of the resulting matrices can be used to provide an indication of the stability of a given clustering of two isolates. This can be plotted in a heatmap alongside the dendrogram produced using the full algorithm to illustrate the robustness of the final clustering.</p>
    </sec>
    <sec id="SEC2-6">
      <title>Implementation</title>
      <p>The fastbaps method is implemented using R and C<monospace>++</monospace> and is available as an R package under the MIT open source licence at <ext-link ext-link-type="uri" xlink:href="https://github.com/gtonkinhill/fastbaps">https://github.com/gtonkinhill/fastbaps</ext-link>. It can be run on Unix, Mac, or Windows operating systems and takes a multiple sequence alignment as input. The results can easily be parsed in R allowing for the generation of informative plots and further processing. The sparse matrix data structure generated by the package can also be used in other analysis types such as PCA or <italic>k</italic>-means. All code to reproduce the simulations and results in this paper is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/gtonkinhill/fastbaps_manuscript">https://github.com/gtonkinhill/fastbaps_manuscript</ext-link>.</p>
    </sec>
    <sec id="SEC2-7">
      <title>Simulation and evaluation</title>
      <p>To compare the results of different algorithms, population structure was simulated using scrm as part of the Coala R package (<xref rid="B35" ref-type="bibr">35</xref>,<xref rid="B36" ref-type="bibr">36</xref>). The number of underlying populations, recombination rate and migration rate were varied as described in <xref ref-type="supplementary-material" rid="sup1">Supplementary Table S1</xref>. Each parameter combination was run for three replicates providing 90 test datasets for analysis. A more detailed description of how the simulations were run can be found in the supplementary R notebook. Three clustering algorithms were considered in addition to the fastbaps approach. Snapclust and hierBAPS are available as R packages and were compared with fastbaps along with the fully Bayesian Structure algorithm (<xref rid="B4" ref-type="bibr">4</xref>,<xref rid="B6" ref-type="bibr">6</xref>,<xref rid="B15" ref-type="bibr">15</xref>,<xref rid="B37" ref-type="bibr">37</xref>). Snapclust was run in parallel with the number of underlying clusters, <italic>K</italic>, varied between 2 and 30. The best fitting model was then chosen using either the Bayesian Information Criterion (BIC) or the Akaike Information Criterion (AIC). HierBAPS was run with 50 initial clusters. At last, Structure was run with the no admixture model with 100 000 burn in iterations and 500 000 sampled iterations with three separate starting conditions. The run with highest likelihood was kept. The underlying number of clusters was fixed to the simulated <italic>K</italic> when running Structure to obtain a result in a reasonable amount of time, which nevertheless gives the method an unrealistic advantage against the alternatives which are fast enough to identify <italic>K</italic>.</p>
      <p>We implement a number of strategies to validate our clustering approach and demonstrate its ability to generate biologically informative clusters. That is clusters that identify broad population structure that allow us to divide large datasets into smaller related subsets for further investigation or to use as a covariate in phenotype association studies. We show that similar to previous programs our clustering approach is able to retrieve the true clusters from simulated data while maintaining a considerable advantage in terms of speed. We compare our algorithm to alternative approaches that solve similar problems such as phylogeny reconstruction using Fasttree and dimension reduction using UMAP. We show that our results are consistent with these algorithms while using a parametric model of population structure which provides additional insight over clustering on the outputs of either Fasttree or UMAP alone. In addition, using the outputs of Fasttree we compare our algorithm with other competing approaches over a wide range of real world datasets using a distance function which accounts for both within-cluster and between-cluster similarity, penalizing solutions that achieve a high within-cluster similarity by producing a large number of very tightly connected clusters. At last, to investigate our results on the large HIV dataset we consider the concordance of our inferred clusters with the geography and sub-type of the HIV pol genes considered. In summary, our comparisons aimed to provide a wide range of biologically relevant scenarios where the statistical and computational choices made in the different methods may result in biologically relevant variation in the data partitions and thus enable an assessment of the general applicability and robustness of a particular method.</p>
      <p>To compare the simulated populations with those inferred by the different clustering algorithms, we used the Fowlkes–Mallows index (<xref rid="B38" ref-type="bibr">38</xref>). This accounts for both false positives and false negatives in determining the similarity between two clusterings and is defined as
<disp-formula><tex-math id="M24">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} \text{FM} = \sqrt{\frac{\text{TP}}{\text{TP}+\text{FP}} \frac{\text{TP}}{\text{TP}+\text{FN}}} \end{equation*}\end{document}</tex-math></disp-formula></p>
      <p>Here <italic>TP</italic> is the number of pairs of individuals that appear together in both clusterings, <italic>FP</italic> is the number that appear together in the inferred clusters but not the simulated and <italic>FN</italic> are those pairs that originated from the same population in the simulated data but are separated in the inferred clusters. Thus a clustering that perfectly matches the simulation will receive a Fowlkes–Mallows index of 1.</p>
      <p>To compare with real data, six bacterial and two viral datasets were considered. The sets were chosen to cover a diverse range of pathogen species. The bacterial sets included the enteric bacteria <italic>Escherichia coli</italic>, the gram negative respiratory pathogen <italic>Haemophilus influenzae</italic>, as well as the firmicutes <italic>Streptococcus pneumoniae, Listeria monocytogenes</italic> and <italic>Staphylococcus aureus</italic> (<xref rid="B39" ref-type="bibr">39–43</xref>). The two viral datasets comprised a subset of sequences from the recent Ebola outbreak as well as a global dataset of over 110 000 HIV partial pol genes (positions 1–1497) obtained from the Los Alamos HIV Database (<xref rid="B44" ref-type="bibr">44</xref>,<xref rid="B45" ref-type="bibr">45</xref>), with associated metadata on subtype and country of sampling. A summary of the size of each dataset is given in <xref ref-type="supplementary-material" rid="sup1">Supplementary Table S2</xref>. As there is no gold standard truth set for the real datasets we instead chose to compare the inferred clusters with a phylogeny built using Fasttree v2.1.10 (<xref rid="B46" ref-type="bibr">46</xref>). Here, we counted the number of pairs of isolates within each cluster that were inconsistent with the phylogeny in that there was an isolate belonging to another cluster within the clade representing their most recent common ancestor. These were considered ‘false positives’. This count was then divided by the total number of possible pairs within each cluster to give an indication of the error rate of the clustering (assuming the phylogeny to be correct). As the number of possible pairs increases with cluster size, this approach appropriately penalizes clustering solutions with too many clusters.</p>
    </sec>
  </sec>
  <sec sec-type="results" id="SEC3">
    <title>RESULTS</title>
    <sec id="SEC3-1">
      <title>Fastbaps accurately clusters previously intractable viral and bacterial datasets containing thousands of samples</title>
      <p>To investigate the performance of fastbaps on very large datasets, we analyzed a dataset of over 110 000 HIV partial pol genes downloaded from the Los Alamos National Laboratories HIV Sequence Database (<ext-link ext-link-type="uri" xlink:href="http://www.hiv.lanl.gov">http://www.hiv.lanl.gov</ext-link>). The large number of sequences in this set presents a significant challenge to most model-based techniques as determining even the range of values of <italic>K</italic> is not straightforward. Additionally, we investigated the success of the algorithm on over 3100 pneumococcal genomes from the Maela refugee camp in Thailand (<xref rid="B39" ref-type="bibr">39</xref>). While this dataset has fewer genomes, the large number of variable sites (284 194) makes this dataset very challenging for all current methods.</p>
      <p>Figure <xref ref-type="fig" rid="F2">2</xref> illustrates the resulting clusters inferred by fastbaps using the optimized BAPS prior on both the pneumococcal and HIV datasets. We made use of the UMAP dimensionality reduction method as implemented in the umap-learn python package to project the isolates onto a 2D plane (<xref rid="B47" ref-type="bibr">47</xref>). UMAP is a non-linear dimensionality reduction technique that has been shown to perform well on large biological datasets including visualizing large genetic population datasets as well as in the analysis of single cell RNAseq data (<xref rid="B48" ref-type="bibr">48</xref>,<xref rid="B49" ref-type="bibr">49</xref>). As the other model based-methods considered here were unable to produce results on either of these datasets in under a week, we compared the resulting clusters to those inferred using <italic>k</italic>-means. We used both the <italic>K</italic> identified by fastbaps as well as the <italic>K</italic> found using the ‘elbow method’ (<xref rid="B50" ref-type="bibr">50</xref>) when running the <italic>k</italic>-means algorithm. Figure <xref ref-type="fig" rid="F2">2A</xref> indicates that fastbaps mostly corresponds with the groupings formed in the UMAP projection. The visualization also demonstrates the utility of investigating the variability of the level of clonality across the clusters, as the layout of some clusters is more scattered spatially, reflecting the varying influence of recombination on the relatedness of pneumococcal strains. While the <italic>k</italic>-means algorithm using the fastbaps inferred <italic>K</italic> (<italic>K</italic> = 79), provides a similar result, the <italic>K</italic> inferred using the elbow method leads to many inferred clusters being separated across the projection (Supplementary Figures 1 and 2). This highlights the advantages of using model-based techniques when investigating genetic datasets.</p>
      <fig id="F2" orientation="portrait" position="float">
        <label>Figure 2.</label>
        <caption>
          <p>(<bold>A</bold>) A UMAP projection of over 3100 pneumococcal genomes from Maela Thailand. The points are labeled and colored by the cluster inferred using fastbaps with the optimized BAPS prior. In general the labeling appears to agree with the grouping observed in the UMAP projection. (<bold>B</bold>) Over 110 000 HIV-1 pol gene sequences from the Los Alamos public database. Sequences are colored by their fastbaps inferred cluster. The large red cluster in the center contrasts with the noisy clustering observed using <italic>k</italic>-means (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S3</xref>). The same plot with points numbered with their corresponding cluster is shown in <xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S4</xref>. (<bold>C</bold>) Violin plots indicating the proportion of each inferred cluster that make up its most dominant subtype. Cluster size is represented by the size of a point and the width of the violin plot is proportional to the total number of clusters inferred. The fastbaps algorithm with the optimized BAPS prior provides a clustering that is most consistent with the underlying HIV subtypes while not overly segmenting the dataset. (<bold>D</bold>) Violin plots indicating the proportion of each inferred cluster that make up its most dominant country. Interestingly, the fastbaps approach is able to provide clusters that are more consistent with the underlying geography than alternative approaches such as <italic>k</italic>-means.</p>
        </caption>
        <graphic xlink:href="gkz361fig2"/>
      </fig>
      <p>The fastbaps algorithm provides a cleaner clustering of the HIV dataset as seen in Figure <xref ref-type="fig" rid="F2">2B</xref>. The large group of isolates in the center of the UMAP projection has been assigned to one cluster. Conversely, <italic>k</italic>-means is unable to distinguish this group, and instead partitions it into many smaller overlapping clusters (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figures S3 and 4</xref>). Similar to the pneumococcal dataset, when the lower value of <italic>K</italic> identified using the elbow method is used (<italic>K</italic> = 21), the resulting clusters are separated out over the UMAP projection (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S5</xref>).</p>
      <p>As HIV is highly recombinant, comparing the clustering of such a large global dataset to a phylogeny is unlikely to be informative. Instead, to further investigate the quality of the fastbaps clustering we examined the HIV subtype composition (inferred using a variety of methods, and including circulating recombinant forms as well as non-recombinant subtypes) as well as the distribution of the countries of origin of the isolates found in each cluster. Figure <xref ref-type="fig" rid="F2">2</xref> indicates the proportion of each cluster that was dominated by a single subtype or any of its recombinant forms. Thus a cluster that is composed entirely of one subtype will have a proportion of 1. The figure indicates that despite having the same number of clusters as <italic>k</italic>-means, the fastbaps algorithm with both the optimized BAPS and optimized symmetric prior identifies larger clusters of purely one subtype.</p>
      <p>This suggests the algorithm is identifying legitimate clusters within the dataset without over-partitioning the data. A similar comparison was made to investigate the proportion of each cluster that was dominated by a single country. Figure <xref ref-type="fig" rid="F2">2D</xref> indicates that fastbaps provides clusters that are more consistent with the underlying geography where as the <italic>k</italic>-means is dominated by many clusters that comprise isolates from many countries. Fastbaps was also used to partition a phylogeny. The resulting clustering produced a larger number of clusters due to the restriction of the phylogeny but the resulting clusters were more consistent by subtype and geography than those inferred using <italic>k</italic>-means.</p>
    </sec>
    <sec id="SEC3-2">
      <title>Simulations show that fastbaps cluster accuracy is the same as previous methods</title>
      <p>In order to compare with different methods we made use of simulations where the true clustering solution was known. The Structure, hierBAPS, snapclust and fastbaps algorithms all achieved similar levels of accuracy on the simulated datasets (Figure <xref ref-type="fig" rid="F3">3</xref>). As expected, an increase in the migration rate between the simulated demes led to a subsequent decrease in the ability of the methods to accurately identify the underlying population structure. Additionally, a lower recombination rate led to poorer results, which is probably due to the algorithms correctly identifying additional phylogenetic structure within each cluster. Snapclust using AIC to select <italic>K</italic> as well as the fastbaps algorithm with the optimized BAPS prior achieved the best results over the simulated datasets. hierBAPS achieved a similar level of accuracy to the fastbaps algorithms using both the original (unscaled) BAPS prior as well as the optimized symmetric prior. Structure and Snapclust with BIC performed worst over the simulations. This was despite the MCMC chains of each Structure run showing good convergence characteristics (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S6</xref>). A closer investigation of the Structure results indicated that it tended to allocate empty clusters despite being given the correct <italic>K</italic>. This suggests that both Snapclust with BIC and Structure tend to be overly conservative in estimating the number of underlying clusters <italic>K</italic>.</p>
      <fig id="F3" orientation="portrait" position="float">
        <label>Figure 3.</label>
        <caption>
          <p>Violin plot indicating the Fowlkes-Mallows distance between the simulated clusters and those inferred by the different algorithms. Results for two distinct recombination rates are shown (10 and 100) as well as four different migration rates. The underlying number of clusters varied between 5 and 25. The plot indicates that as the migration rate increases the accuracy of the algorithm falls. Additionally, a lower recombination rate leads to lower accuracy, which is likely due to the algorithms identifying additional population structure within each simulated deme.</p>
        </caption>
        <graphic xlink:href="gkz361fig3"/>
      </fig>
    </sec>
    <sec id="SEC3-3">
      <title>Fastbaps is efficient and accurate on a diverse range of viral and bacterial datasets</title>
      <p>To investigate the ability of each algorithm to detect population structure in real datasets, we made use of six additional bacterial and viral datasets of varying sizes and complexity (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S2</xref>). Figure <xref ref-type="fig" rid="F4">4</xref> indicates the resulting clusters inferred by the most promising algorithms from the simulation analysis on both a <italic>Neisseria meningitidis</italic> and <italic>Haemophilus influenzae</italic> dataset. Here, we also provide comparisons with the prior from the original BHC algorithm and a partition of a Fasttree phylogeny using fastbaps. On the <italic>H. influenzae</italic> dataset, fastbaps using the optimized BAPS prior provided a clustering that was the most consistent with the phylogeny. Both the hierBAPS and snapclust solutions included polyphyletic clusters while the BHC population mean based prior gave a similar result to the optimized BAPS solution. It should be noted that the initial fast clustering step was the same for both the BHC and optimized BAPS clusterings. The BHC prior failed to perform adequately on the large <italic>N. meningitidis</italic> dataset. Here, the BHC prior led to a highly partitioned solution with over 80 very small clusters. While such a high number of clusters may be valid it does not aid in the biological interpretation of the dataset, where we are generally interested in broad population structure that allows us to divide large collections into smaller subsets that can be more closely investigated or controlled for in phenotype association studies. Conversely, the optimized BAPS prior led to a solution of similar quality to both hierBAPS and snapclust. Uncertainty in the Fasttree phylogenies was considered by comparing them with a bootstrapped phylogeny built using IQTREE v1.6.5 with the results found to be very similar. In both of these datasets the partition of the phylogeny using fastbaps provided a solution similar to that found using the optimized BAPS prior indicating it is an appropriate choice if a user’s goal is to simply partition a pre-calculated phylogeny. In addition, the uncertainty in the fastbaps clusters could be explored using the bootstrap procedure described in the ‘Materials and Methods’ section as shown in <xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S7</xref>.</p>
      <fig id="F4" orientation="portrait" position="float">
        <label>Figure 4.</label>
        <caption>
          <p>(<bold>A</bold> and<bold>B</bold>) The resulting clustering inferred by hierBAPS, snapclust and fastbaps with both the original BHC prior and the optimized BAPS prior on both <italic>Staphylococcus aureus</italic> (A) and <italic>Neisseria meningitidis</italic> (B). The clusters are shown in comparison to a phylogeny generated using Fasttree. The final clustering indicates a partition of the Fasttree phylogeny using the fastbaps algorithm and thus is constrained to be consistent with the phylogeny. (<bold>C</bold>) The proportion of isolate pairs that appear in the same inferred cluster but have isolates from a separate cluster in the clade represented by their most recent common ancestor in the Fasttree phylogeny. This provides an indication of the error of each algorithm assuming the phylogeny generated by Fasttree is correct. The fastbaps algorithm using either the optimized BAPS or symmetric prior outperforms the other methods on five out of six datasets.</p>
        </caption>
        <graphic xlink:href="gkz361fig4"/>
      </fig>
      <p>Figure <xref ref-type="fig" rid="F4">4C</xref> summarizes the results of running the algorithms on all these datasets except the large HIV and pneumococcal collections. The figure indicates the number of pairs of isolates that are clustered together using the population structure algorithms but that are inconsistent with the phylogeny. Assuming the Fasttree phylogeny is accurate, this provides a measurement of error for each of the runs. The fastbaps algorithm with either the optimized symmetric or optimized BAPS priors achieves a superior clustering on five out of six of the datasets. On the <italic>N. meningitidis</italic> dataset the snapclust algorithm using the BIC model selection criteria outperforms the other methods. The BIC model selection technique more heavily penalizes solutions with a larger number of clusters and was in the simulations shown to frequently result in too few clusters. It is unlikely that the other methods are over-partitioning these data relative to snapclust with BIC. Hence, the outlying result for <italic>N. meningitidis</italic> could rather be due to inaccuracies in the Fasttree phylogeny, since <italic>N. meningitidis</italic> has a high recombination rate.</p>
      <p>The computational run times and maximum memory requirements of each of the algorithms are shown in Tables <xref rid="tbl1" ref-type="table">1</xref> and <xref rid="tbl2" ref-type="table">2</xref>, respectively. The tables indicate that fastbaps often performs more than an order of magnitude faster than snapclust and hierBAPS which themselves significantly outperform Structure in computational efficiency (<xref rid="B6" ref-type="bibr">6</xref>,<xref rid="B51" ref-type="bibr">51</xref>). Part of this speed is due to the use of highly optimized sparse matrix libraries in fastbaps. As snapclust must be run for all values of <italic>K</italic> that are to be considered, its computational performance is directly tied to the maximum <italic>K</italic> chosen. Here, snapclust was run for a maximum <italic>K</italic> = 50 as this corresponded to a sensible upper bound for the <italic>E. coli</italic> dataset. Reducing the maximum <italic>K</italic> to use would improve the timing of the snapclust algorithm at the expense of failing to explore higher dimension solutions. However, Table <xref rid="tbl1" ref-type="table">1</xref> indicates that the fastbaps algorithm achieves a superior runtime compared with snapclust even for a single value of <italic>K</italic>, while automatically determining an appropriate number of clusters. Depending on the dataset, the prior optimization step in fastbaps can take longer than running the complete algorithm. Thus if a short run-time is a necessity, running the method with a fixed prior is available as an option. At last, if a hierarchy is already available, either through the use of a traditional phylogeny reconstruction algorithm such as Fasttree or via agglomerative clustering a partition using the fastbaps algorithm can be achieved with a complexity linear in the number of sequences. Fastbaps was able to partition a phylogeny of the full HIV dataset built using Fasttree (<xref rid="B46" ref-type="bibr">46</xref>) including reading in the data in 45.8 s. <xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S8</xref> indicates the running time of the different modes of fastbaps excluding loading each dataset. The phylogeny conditioned mode can be seen to scale linearly, while the full fastbaps mode scales quadratically with the number of samples. Genie is a sub-quadratic hierarchical clustering method and by fixing the number of initial clusters <xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S8</xref> indicates we are able to achieve a sub-quadratic clustering algorithm. However, as the initial number of sub-clusters is fixed this mode would be most useful in cases where the user expected a large amount of redundancy in the dataset.</p>
      <table-wrap id="tbl1" orientation="portrait" position="float">
        <label>Table 1.</label>
        <caption>
          <p>Total CPU time (seconds) of the different algorithms</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Dataset</th>
              <th rowspan="1" colspan="1">N</th>
              <th rowspan="1" colspan="1">L</th>
              <th rowspan="1" colspan="1">fastbaps BAPS prior</th>
              <th rowspan="1" colspan="1">fastbaps optimized BAPS prior</th>
              <th rowspan="1" colspan="1">fastbaps optimized symmetric prior</th>
              <th rowspan="1" colspan="1">rhierbaps</th>
              <th rowspan="1" colspan="1">snapclust</th>
              <th rowspan="1" colspan="1">snapclust single K</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>Ebola</bold>
              </td>
              <td rowspan="1" colspan="1">1610</td>
              <td rowspan="1" colspan="1">2279</td>
              <td rowspan="1" colspan="1">9.93</td>
              <td rowspan="1" colspan="1">16.52</td>
              <td rowspan="1" colspan="1">16.24</td>
              <td rowspan="1" colspan="1">11556.36</td>
              <td rowspan="1" colspan="1">686.18</td>
              <td rowspan="1" colspan="1">45.8</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>
                  <italic>Escherichia coli</italic>
                </bold>
              </td>
              <td rowspan="1" colspan="1">1508</td>
              <td rowspan="1" colspan="1">241 750</td>
              <td rowspan="1" colspan="1">282.97</td>
              <td rowspan="1" colspan="1">1210.3</td>
              <td rowspan="1" colspan="1">1155.3</td>
              <td rowspan="1" colspan="1">515913.93</td>
              <td rowspan="1" colspan="1">498433.4</td>
              <td rowspan="1" colspan="1">15007.32</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>
                  <italic>Haemophilus influenzae</italic>
                </bold>
              </td>
              <td rowspan="1" colspan="1">75</td>
              <td rowspan="1" colspan="1">113605</td>
              <td rowspan="1" colspan="1">9.36</td>
              <td rowspan="1" colspan="1">30.85</td>
              <td rowspan="1" colspan="1">33.4</td>
              <td rowspan="1" colspan="1">9018.08</td>
              <td rowspan="1" colspan="1">13472.79</td>
              <td rowspan="1" colspan="1">277.64</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>HIV</bold>
              </td>
              <td rowspan="1" colspan="1">118 091</td>
              <td rowspan="1" colspan="1">1497</td>
              <td rowspan="1" colspan="1">39718.89</td>
              <td rowspan="1" colspan="1">55012.17</td>
              <td rowspan="1" colspan="1">55067.16</td>
              <td rowspan="1" colspan="1">NA</td>
              <td rowspan="1" colspan="1">NA</td>
              <td rowspan="1" colspan="1">NA</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>
                  <italic>Listeria monocytogenes</italic>
                </bold>
              </td>
              <td rowspan="1" colspan="1">128</td>
              <td rowspan="1" colspan="1">150 759</td>
              <td rowspan="1" colspan="1">22.86</td>
              <td rowspan="1" colspan="1">78.39</td>
              <td rowspan="1" colspan="1">68.36</td>
              <td rowspan="1" colspan="1">18787.03</td>
              <td rowspan="1" colspan="1">29257.58</td>
              <td rowspan="1" colspan="1">392.6</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>
                  <italic>Neisseria meningitidis</italic>
                </bold>
              </td>
              <td rowspan="1" colspan="1">882</td>
              <td rowspan="1" colspan="1">87 730</td>
              <td rowspan="1" colspan="1">77.71</td>
              <td rowspan="1" colspan="1">278.62</td>
              <td rowspan="1" colspan="1">283.58</td>
              <td rowspan="1" colspan="1">110312.24</td>
              <td rowspan="1" colspan="1">76361.75</td>
              <td rowspan="1" colspan="1">1900.13</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>
                  <italic>Staphylococcus aureus</italic>
                </bold>
              </td>
              <td rowspan="1" colspan="1">284</td>
              <td rowspan="1" colspan="1">50 104</td>
              <td rowspan="1" colspan="1">12.18</td>
              <td rowspan="1" colspan="1">39.82</td>
              <td rowspan="1" colspan="1">41.26</td>
              <td rowspan="1" colspan="1">6514.21</td>
              <td rowspan="1" colspan="1">35322.14</td>
              <td rowspan="1" colspan="1">212.02</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>
                  <italic>Streptococcus pneumoniae</italic>
                </bold>
              </td>
              <td rowspan="1" colspan="1">3156</td>
              <td rowspan="1" colspan="1">392 524</td>
              <td rowspan="1" colspan="1">794.99</td>
              <td rowspan="1" colspan="1">3822.11</td>
              <td rowspan="1" colspan="1">3998.63</td>
              <td rowspan="1" colspan="1">NA</td>
              <td rowspan="1" colspan="1">NA</td>
              <td rowspan="1" colspan="1">NA</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="T1TFN1">
            <p>Only fastbaps was able to run in a week for the Pneumococcal and HIV datasets.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <table-wrap id="tbl2" orientation="portrait" position="float">
        <label>Table 2.</label>
        <caption>
          <p>Maximum memory usage of the different algorithms (Mb)</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Dataset</th>
              <th rowspan="1" colspan="1">N</th>
              <th rowspan="1" colspan="1">L</th>
              <th rowspan="1" colspan="1">fastbaps BAPS prior</th>
              <th rowspan="1" colspan="1">fastbaps optimized BAPS prior</th>
              <th rowspan="1" colspan="1">fastbaps optimized symmetric prior</th>
              <th rowspan="1" colspan="1">rhierBAPS</th>
              <th rowspan="1" colspan="1">snapclust</th>
              <th rowspan="1" colspan="1">snapclust single K</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>Ebola</bold>
              </td>
              <td rowspan="1" colspan="1">1610</td>
              <td rowspan="1" colspan="1">2279</td>
              <td rowspan="1" colspan="1">411.64</td>
              <td rowspan="1" colspan="1">468.64</td>
              <td rowspan="1" colspan="1">487.32</td>
              <td rowspan="1" colspan="1">1102.51</td>
              <td rowspan="1" colspan="1">519.71</td>
              <td rowspan="1" colspan="1">498.44</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>
                  <italic>Escherichia coli</italic>
                </bold>
              </td>
              <td rowspan="1" colspan="1">1508</td>
              <td rowspan="1" colspan="1">241 750</td>
              <td rowspan="1" colspan="1">4290.98</td>
              <td rowspan="1" colspan="1">4559.68</td>
              <td rowspan="1" colspan="1">5178.42</td>
              <td rowspan="1" colspan="1">15194.38</td>
              <td rowspan="1" colspan="1">54714.39</td>
              <td rowspan="1" colspan="1">45680.39</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>
                  <italic>Haemophilus influenzae</italic>
                </bold>
              </td>
              <td rowspan="1" colspan="1">75</td>
              <td rowspan="1" colspan="1">113 605</td>
              <td rowspan="1" colspan="1">394.56</td>
              <td rowspan="1" colspan="1">375.84</td>
              <td rowspan="1" colspan="1">382.09</td>
              <td rowspan="1" colspan="1">852.5</td>
              <td rowspan="1" colspan="1">4148.99</td>
              <td rowspan="1" colspan="1">2113.79</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>HIV</bold>
              </td>
              <td rowspan="1" colspan="1">118091</td>
              <td rowspan="1" colspan="1">1497</td>
              <td rowspan="1" colspan="1">3465.45</td>
              <td rowspan="1" colspan="1">6511.35</td>
              <td rowspan="1" colspan="1">7409.47</td>
              <td rowspan="1" colspan="1">NA</td>
              <td rowspan="1" colspan="1">NA</td>
              <td rowspan="1" colspan="1">NA</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>
                  <italic>Listeria monocytogenes</italic>
                </bold>
              </td>
              <td rowspan="1" colspan="1">128</td>
              <td rowspan="1" colspan="1">150 759</td>
              <td rowspan="1" colspan="1">791.76</td>
              <td rowspan="1" colspan="1">842.88</td>
              <td rowspan="1" colspan="1">823.48</td>
              <td rowspan="1" colspan="1">1400.69</td>
              <td rowspan="1" colspan="1">5814.35</td>
              <td rowspan="1" colspan="1">5194.14</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>
                  <italic>Neisseria meningitidis</italic>
                </bold>
              </td>
              <td rowspan="1" colspan="1">882</td>
              <td rowspan="1" colspan="1">87 730</td>
              <td rowspan="1" colspan="1">1439.4</td>
              <td rowspan="1" colspan="1">1477.06</td>
              <td rowspan="1" colspan="1">1382.16</td>
              <td rowspan="1" colspan="1">4231.05</td>
              <td rowspan="1" colspan="1">13779.11</td>
              <td rowspan="1" colspan="1">10822.19</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>
                  <italic>Staphylococcus aureus</italic>
                </bold>
              </td>
              <td rowspan="1" colspan="1">284</td>
              <td rowspan="1" colspan="1">50 104</td>
              <td rowspan="1" colspan="1">384.85</td>
              <td rowspan="1" colspan="1">387.04</td>
              <td rowspan="1" colspan="1">396.44</td>
              <td rowspan="1" colspan="1">742</td>
              <td rowspan="1" colspan="1">3152.37</td>
              <td rowspan="1" colspan="1">2423.9</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>
                  <italic>Streptococcus pneumoniae</italic>
                </bold>
              </td>
              <td rowspan="1" colspan="1">3156</td>
              <td rowspan="1" colspan="1">392 524</td>
              <td rowspan="1" colspan="1">3915.3</td>
              <td rowspan="1" colspan="1">5790.93</td>
              <td rowspan="1" colspan="1">5710.96</td>
              <td rowspan="1" colspan="1">NA</td>
              <td rowspan="1" colspan="1">NA</td>
              <td rowspan="1" colspan="1">NA</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
  </sec>
  <sec sec-type="discussion" id="SEC4">
    <title>DISCUSSION</title>
    <p>Finding clusters of related sequences present in a genetic alignment is a critical first step for many genetic and ecological analyses, allowing targeted sub-analysis and determination of the structure of the population when external classifications are not present. Model-based clustering methods are attractive due to their ability to hierarchically find highly specific clusters, estimate meaningful clustering parameters incorporating uncertainties, compare different model fits and produce probabilities of cluster assignment. Typical cohort sizes now range between thousands and tens of thousands of samples, growing even larger if combined with previous cohorts. However, the ability of methods to fit a clustering model to these alignments has not increased in step with these increases in alignment size (<xref rid="B6" ref-type="bibr">6</xref>,<xref rid="B37" ref-type="bibr">37</xref>), with even modestly sized datasets requiring gene-by-gene or distance based approaches to determine clusters (<xref rid="B5" ref-type="bibr">5</xref>,<xref rid="B52" ref-type="bibr">52</xref>,<xref rid="B53" ref-type="bibr">53</xref>). Model-based approaches have also proved impractical in surveillance settings, where the continuous addition of small numbers of new sequences would require refitting the entire model.</p>
    <p>By leveraging ideas from both the BHC (<xref rid="B26" ref-type="bibr">26</xref>) and the hierBAPS (<xref rid="B15" ref-type="bibr">15</xref>) algorithms, along with a fast sparse matrix based implementation, fastbaps enables efficient model-based clustering of large alignments that were previously infeasible to analyze using existing methods. Our approach enjoys all of the advantages inherent in model-based approaches and can produce comparable or higher quality clusters than previous methods. Additionally, our algorithm is able to rapidly partition pre-computed phylogenies. This provides an attractive alternative approach for clustering genetic data when a phylogeny is available. The significant acceleration of inference provided by fastbaps enables the use of bootstrap replicates, allowing for the sensitivity of the resulting clusters to the alignment to be investigated in manner that has traditionally not been possible for model-based clustering methods on large alignments.</p>
    <p>We verified our new approach by comparing its performance with other algorithms on both simulated data and eight real datasets. We show that as well as a considerable increase in the speed of the algorithm, we are able to achieve comparable accuracy, often outperforming previous model-based approaches. The speed of our new approach allowed us to cluster a large HIV sequence dataset containing over 100 000 sequences. The resulting clusters have higher concordance with HIV subtypes and geography than an alternative approach using <italic>k</italic>-means, while providing a principled method for selecting the underlying number of clusters; a major limitation of <italic>k</italic>-means.</p>
    <p>While our method enables the clustering of very large alignments, its complexity is still tied to the initial hierarchy generation and thus is <italic>O</italic>(<italic>n</italic><sup>2</sup>) or possibly <italic>O</italic>(<italic>nlog</italic>(<italic>n</italic>)) if single linkage hierarchical clustering is used. After the initial hierarchy is generated, the remaining BHC is of the order <italic>O</italic>(<italic>lm</italic><sup>2</sup>) where <italic>m</italic> is the number of clusters generated in the first stage and <italic>l</italic> is the number of variable sites. Thus, in the future, as alignments begin to comprise tens of millions of sequences, additional improvements will need to be explored. Possible options include exploring the randomized extension to the BHC algorithm (<xref rid="B54" ref-type="bibr">54</xref>) or other machine learning based approaches such as those based on matrix decomposition (<xref rid="B55" ref-type="bibr">55</xref>).</p>
    <p>Fastbaps therefore offers two new ways to rapidly find high-quality clusters from a genetic alignment or phylogeny. The significant speed increase our software provides over previous approaches enables fitting a clustering model to previously intractable large alignments, and has the potential to allow continuous model refitting in surveillance settings. Fastbaps is provided as an open source package with a clearly documented interface.</p>
  </sec>
  <sec id="SEC5">
    <title>SOFTWARE AVAILABILITY</title>
    <p>Source code available from: <ext-link ext-link-type="uri" xlink:href="https://github.com/gtonkinhill/fastbaps">https://github.com/gtonkinhill/fastbaps</ext-link></p>
    <p>Code for reproducing figures from: <ext-link ext-link-type="uri" xlink:href="https://github.com/gtonkinhill/fastbaps_manuscript">https://github.com/gtonkinhill/fastbaps_manuscript</ext-link></p>
    <p>Archived source code at time of publication to bioRxiv: <ext-link ext-link-type="doi" xlink:href="10.5281/zenodo.1472299">https://doi.org/10.5281/zenodo.1472299</ext-link></p>
    <p>Archived code for figures at time of publication to bioRxiv: <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/badge/latestdoi/142294532">https://zenodo.org/badge/latestdoi/142294532</ext-link></p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>gkz361_Supplemental_File</label>
      <media xlink:href="gkz361_supplemental_file.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ACK1">
    <title>ACKNOWLEDGEMENTS</title>
    <p>We thank Mathew Beale for helping to test the software and the three anonymous referees for helpful comments and suggestions.</p>
  </ack>
  <sec id="SEC6">
    <title>SUPPLEMENTARY DATA</title>
    <p><ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/nar/article-lookup/doi/10.1093/nar/gkz361#supplementary-data">Supplementary Data</ext-link> are available at NAR Online.</p>
  </sec>
  <sec id="SEC7">
    <title>FUNDING</title>
    <p>Wellcome Trust [206194 to S.D.B]; Wellcome Trust PhD Scholarship Grant [204016 to G.T.H]; ERC [742158 to J.C.]; The Alan Turing Institute via an Engineering and Physical Sciences Research Council Grant [EP/510129/1 to S.D.W.F]; U.S. National Institutes of Health [R01AI135970 to S.D.W.F.]. Funding for open access charge: Wellcome Trust.</p>
    <p><italic>Conflict of interest statement</italic>. None declared.</p>
  </sec>
  <ref-list id="REF1">
    <title>REFERENCES</title>
    <ref id="B1">
      <label>1.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Kosakovsky Pond</surname><given-names>S.L.</given-names></name>, <name name-style="western"><surname>Frost</surname><given-names>S. D.W.</given-names></name></person-group><article-title>Not so different after all: a comparison of methods for detecting amino acid sites under selection</article-title>. <source>Mol. Biol. Evol.</source><year>2005</year>; <volume>22</volume>:<fpage>1208</fpage>–<lpage>1222</lpage>.<pub-id pub-id-type="pmid">15703242</pub-id></mixed-citation>
    </ref>
    <ref id="B2">
      <label>2.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lees</surname><given-names>J.A.</given-names></name>, <name name-style="western"><surname>Vehkala</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Välimäki</surname><given-names>N.</given-names></name>, <name name-style="western"><surname>Harris</surname><given-names>S.R.</given-names></name>, <name name-style="western"><surname>Chewapreecha</surname><given-names>C.</given-names></name>, <name name-style="western"><surname>Croucher</surname><given-names>N.J.</given-names></name>, <name name-style="western"><surname>Marttinen</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Davies</surname><given-names>M.R.</given-names></name>, <name name-style="western"><surname>Steer</surname><given-names>A.C.</given-names></name>, <name name-style="western"><surname>Tong</surname><given-names>S.</given-names></name><etal>et al</etal>.</person-group><article-title>Sequence element enrichment analysis to determine the genetic basis of bacterial phenotypes</article-title>. <source>Nat. Commun.</source><year>2016</year>; <volume>7</volume>:<fpage>12797</fpage>–<lpage>12805</lpage>.<pub-id pub-id-type="pmid">27633831</pub-id></mixed-citation>
    </ref>
    <ref id="B3">
      <label>3.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Earle</surname><given-names>S.G.</given-names></name>, <name name-style="western"><surname>Wu</surname><given-names>C.-H.</given-names></name>, <name name-style="western"><surname>Charlesworth</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Stoesser</surname><given-names>N.</given-names></name>, <name name-style="western"><surname>Gordon</surname><given-names>N.C.</given-names></name>, <name name-style="western"><surname>Walker</surname><given-names>T.M.</given-names></name>, <name name-style="western"><surname>Spencer</surname><given-names>C.C.A.</given-names></name>, <name name-style="western"><surname>Iqbal</surname><given-names>Z.</given-names></name>, <name name-style="western"><surname>Clifton</surname><given-names>D.A.</given-names></name>, <name name-style="western"><surname>Hopkins</surname><given-names>K.L.</given-names></name><etal>et al</etal>.</person-group><article-title>Identifying lineage effects when controlling for population structure improves power in bacterial association studies</article-title>. <source>Nat.Microbiol.</source><year>2016</year>; <fpage>16041</fpage>–<lpage>16049</lpage>.<pub-id pub-id-type="pmid">27572646</pub-id></mixed-citation>
    </ref>
    <ref id="B4">
      <label>4.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Pritchard</surname><given-names>J.K.</given-names></name>, <name name-style="western"><surname>Stephens</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Donnelly</surname><given-names>P.</given-names></name></person-group><article-title>Inference of population structure using multilocus genotype data</article-title>. <source>Genetics</source>. <year>2000</year>; <volume>155</volume>:<fpage>945</fpage>–<lpage>959</lpage>.<pub-id pub-id-type="pmid">10835412</pub-id></mixed-citation>
    </ref>
    <ref id="B5">
      <label>5.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Jombart</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Devillard</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Balloux</surname><given-names>F.</given-names></name></person-group><article-title>Discriminant analysis of principal components: a new method for the analysis of genetically structured populations</article-title>. <source>BMC Genet.</source><year>2010</year>; <volume>11</volume>:<fpage>94</fpage>–<lpage>109</lpage>.<pub-id pub-id-type="pmid">20950446</pub-id></mixed-citation>
    </ref>
    <ref id="B6">
      <label>6.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Beugin</surname><given-names>M.-P.</given-names></name>, <name name-style="western"><surname>Gayet</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Pontier</surname><given-names>D.</given-names></name>, <name name-style="western"><surname>Devillard</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Jombart</surname><given-names>T.</given-names></name></person-group><article-title>A fast likelihood solution to the genetic clustering problem</article-title>. <source>Methods Ecol. Evol.</source><year>2018</year>; <volume>9</volume>:<fpage>1006</fpage>–<lpage>1016</lpage>.<pub-id pub-id-type="pmid">29938015</pub-id></mixed-citation>
    </ref>
    <ref id="B7">
      <label>7.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Falush</surname><given-names>D.</given-names></name>, <name name-style="western"><surname>Stephens</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Pritchard</surname><given-names>J.K.</given-names></name></person-group><article-title>Inference of population structure using multilocus genotype data: linked loci and correlated allele frequencies</article-title>. <source>Genetics</source>. <year>2003</year>; <volume>164</volume>:<fpage>1567</fpage>–<lpage>1587</lpage>.<pub-id pub-id-type="pmid">12930761</pub-id></mixed-citation>
    </ref>
    <ref id="B8">
      <label>8.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Corander</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Marttinen</surname><given-names>P.</given-names></name></person-group><article-title>Bayesian identification of admixture events using multilocus molecular markers</article-title>. <source>Mol. Ecol.</source><year>2006</year>; <volume>15</volume>:<fpage>2833</fpage>–<lpage>2843</lpage>.<pub-id pub-id-type="pmid">16911204</pub-id></mixed-citation>
    </ref>
    <ref id="B9">
      <label>9.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Corander</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Marttinen</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Sirén</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Tang</surname><given-names>J.</given-names></name></person-group><article-title>Enhanced Bayesian modelling in BAPS software for learning genetic structures of populations</article-title>. <source>BMC Bioinformatics</source>. <year>2008</year>; <volume>9</volume>:<fpage>539</fpage>–<lpage>553</lpage>.<pub-id pub-id-type="pmid">19087322</pub-id></mixed-citation>
    </ref>
    <ref id="B10">
      <label>10.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Corander</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Waldmann</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Sillanpää</surname><given-names>M.J.</given-names></name></person-group><article-title>Bayesian analysis of genetic differentiation between populations</article-title>. <source>Genetics</source>. <year>2003</year>; <volume>163</volume>:<fpage>367</fpage>–<lpage>374</lpage>.<pub-id pub-id-type="pmid">12586722</pub-id></mixed-citation>
    </ref>
    <ref id="B11">
      <label>11.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Alexander</surname><given-names>D.H.</given-names></name>, <name name-style="western"><surname>Novembre</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Lange</surname><given-names>K.</given-names></name></person-group><article-title>Fast model-based estimation of ancestry in unrelated individuals</article-title>. <source>Genome Res.</source><year>2009</year>; <volume>19</volume>:<fpage>1655</fpage>–<lpage>1664</lpage>.<pub-id pub-id-type="pmid">19648217</pub-id></mixed-citation>
    </ref>
    <ref id="B12">
      <label>12.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Raj</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Stephens</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Pritchard</surname><given-names>J.K.</given-names></name></person-group><article-title>fastSTRUCTURE: variational inference of population structure in large SNP data sets</article-title>. <source>Genetics</source>. <year>2014</year>; <volume>197</volume>:<fpage>573</fpage>–<lpage>589</lpage>.<pub-id pub-id-type="pmid">24700103</pub-id></mixed-citation>
    </ref>
    <ref id="B13">
      <label>13.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Frichot</surname><given-names>E.</given-names></name>, <name name-style="western"><surname>Mathieu</surname><given-names>F.</given-names></name>, <name name-style="western"><surname>Trouillon</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Bouchard</surname><given-names>G.</given-names></name>, <name name-style="western"><surname>François</surname><given-names>O.</given-names></name></person-group><article-title>Fast and efficient estimation of individual ancestry coefficients</article-title>. <source>Genetics</source>. <year>2014</year>; <volume>196</volume>:<fpage>973</fpage>–<lpage>983</lpage>.<pub-id pub-id-type="pmid">24496008</pub-id></mixed-citation>
    </ref>
    <ref id="B14">
      <label>14.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Anderson</surname><given-names>E.C.</given-names></name>, <name name-style="western"><surname>Thompson</surname><given-names>E.A.</given-names></name></person-group><article-title>A model-based method for identifying species hybrids using multilocus genetic data</article-title>. <source>Genetics</source>. <year>2002</year>; <volume>160</volume>:<fpage>1217</fpage>–<lpage>1229</lpage>.<pub-id pub-id-type="pmid">11901135</pub-id></mixed-citation>
    </ref>
    <ref id="B15">
      <label>15.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Cheng</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Connor</surname><given-names>T.R.</given-names></name>, <name name-style="western"><surname>Sirén</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Aanensen</surname><given-names>D.M.</given-names></name>, <name name-style="western"><surname>Corander</surname><given-names>J.</given-names></name></person-group><article-title>Hierarchical and spatially explicit clustering of DNA sequences with BAPS software</article-title>. <source>Mol. Biol. Evol.</source><year>2013</year>; <volume>30</volume>:<fpage>1224</fpage>–<lpage>1228</lpage>.<pub-id pub-id-type="pmid">23408797</pub-id></mixed-citation>
    </ref>
    <ref id="B16">
      <label>16.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Evanno</surname><given-names>G.</given-names></name>, <name name-style="western"><surname>Regnaut</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Goudet</surname><given-names>J.</given-names></name></person-group><article-title>Detecting the number of clusters of individuals using the software STRUCTURE: a simulation study</article-title>. <source>Mol. Ecol.</source><year>2005</year>; <volume>14</volume>:<fpage>2611</fpage>–<lpage>2620</lpage>.<pub-id pub-id-type="pmid">15969739</pub-id></mixed-citation>
    </ref>
    <ref id="B17">
      <label>17.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Akaike</surname><given-names>H.</given-names></name></person-group><article-title>A new look at the statistical model identification</article-title>. <source>IEEE Trans. Automat. Contr.</source><year>1974</year>; <volume>19</volume>:<fpage>716</fpage>–<lpage>723</lpage>.</mixed-citation>
    </ref>
    <ref id="B18">
      <label>18.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Pella</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Masuda</surname><given-names>M.</given-names></name></person-group><article-title>The Gibbs and split-merge sampler for population mixture analysis from genetic data with incomplete baselines</article-title>. <source>Can. J. Fish. Aquat. Sci.</source><year>2011</year>; <volume>63</volume>:<fpage>576</fpage>–<lpage>596</lpage>.</mixed-citation>
    </ref>
    <ref id="B19">
      <label>19.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Huelsenbeck</surname><given-names>J.P.</given-names></name>, <name name-style="western"><surname>Andolfatto</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Huelsenbeck</surname><given-names>E.T.</given-names></name></person-group><article-title>Structurama: bayesian inference of population structure</article-title>. <source>Evol. Bioinform. Online</source>. <year>2011</year>; <volume>7</volume>:<fpage>55</fpage>–<lpage>59</lpage>.<pub-id pub-id-type="pmid">21698091</pub-id></mixed-citation>
    </ref>
    <ref id="B20">
      <label>20.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Huelsenbeck</surname><given-names>J.P.</given-names></name>, <name name-style="western"><surname>Andolfatto</surname><given-names>P.</given-names></name></person-group><article-title>Inference of population structure under a Dirichlet process model</article-title>. <source>Genetics</source>. <year>2007</year>; <volume>175</volume>:<fpage>1787</fpage>–<lpage>1802</lpage>.<pub-id pub-id-type="pmid">17237522</pub-id></mixed-citation>
    </ref>
    <ref id="B21">
      <label>21.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Blei</surname><given-names>D.M.</given-names></name>, <name name-style="western"><surname>Jordan</surname><given-names>M.I.</given-names></name></person-group><article-title>Variational inference for Dirichlet process mixtures</article-title>. <source>Bayesian Anal.</source><year>2006</year>; <volume>1</volume>:<fpage>121</fpage>–<lpage>143</lpage>.</mixed-citation>
    </ref>
    <ref id="B22">
      <label>22.</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Iii</surname><given-names>H.D.</given-names></name></person-group><year>2009</year>; <article-title>Fast search for Dirichlet process mixture models</article-title>. <source>Proceedings of Machine Learning Research</source>. <publisher-loc>San Juan</publisher-loc><fpage>83</fpage>–<lpage>90</lpage>.</mixed-citation>
    </ref>
    <ref id="B23">
      <label>23.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Wang</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Dunson</surname><given-names>D.B.</given-names></name></person-group><article-title>Fast Bayesian inference in Dirichlet process mixture models</article-title>. <source>J. Comput. Graph. Stat.</source><year>2011</year>; <volume>20</volume>:<fpage>296</fpage>–<lpage>216</lpage>.</mixed-citation>
    </ref>
    <ref id="B24">
      <label>24.</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Crook</surname><given-names>O.M.</given-names></name>, <name name-style="western"><surname>Gatto</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Kirk</surname><given-names>P.D.W.</given-names></name></person-group><article-title>Fast approximate inference for variable selection in Dirichlet process mixtures, with an application to pan-cancer proteomics</article-title>. <year>2018</year>; arXiv doi: <uri xlink:href="https://www.arxiv.org/abs/1810.05450">https://arxiv.org/abs/1810.05450</uri>, 12 October 2018, preprint: not peer reviewed.</mixed-citation>
    </ref>
    <ref id="B25">
      <label>25.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Minka</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Ghahramani</surname><given-names>Z.</given-names></name></person-group><article-title>Expectation propagation for infinite mixtures</article-title>. <source>NIPS Workshop on Nonparametric Bayesian Methods and Infinite Models</source>. <year>2003</year>; <volume>19</volume>:<uri xlink:href="https://www.tminka.github.io/papers/infinite/">https://tminka.github.io/papers/infinite/</uri>.</mixed-citation>
    </ref>
    <ref id="B26">
      <label>26.</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Heller</surname><given-names>K.A.</given-names></name>, <name name-style="western"><surname>Ghahramani</surname><given-names>Z.</given-names></name></person-group><article-title>Bayesian Hierarchical Clustering</article-title>. <source>Proceedings of the 22Nd International Conference on Machine Learning</source>. <year>2005</year>; <publisher-loc>NY</publisher-loc><publisher-name>ACM</publisher-name><fpage>297</fpage>–<lpage>304</lpage>.</mixed-citation>
    </ref>
    <ref id="B27">
      <label>27.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Florita</surname><given-names>A.R.</given-names></name>, <name name-style="western"><surname>Brackney</surname><given-names>L.J.</given-names></name>, <name name-style="western"><surname>Otanicar</surname><given-names>T.P.</given-names></name>, <name name-style="western"><surname>Robertson</surname><given-names>J.</given-names></name></person-group><article-title>Classification of commercial building electrical demand profiles for energy storage applications</article-title>. <source>J. Sol. Energy Eng.</source><year>2013</year>; <volume>135</volume>:<fpage>031020</fpage>.</mixed-citation>
    </ref>
    <ref id="B28">
      <label>28.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Savage</surname><given-names>R.S.</given-names></name>, <name name-style="western"><surname>Heller</surname><given-names>K.</given-names></name>, <name name-style="western"><surname>Xu</surname><given-names>Y.</given-names></name>, <name name-style="western"><surname>Ghahramani</surname><given-names>Z.</given-names></name>, <name name-style="western"><surname>Truman</surname><given-names>W.M.</given-names></name>, <name name-style="western"><surname>Grant</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Denby</surname><given-names>K.J.</given-names></name>, <name name-style="western"><surname>Wild</surname><given-names>D.L.</given-names></name></person-group><article-title>R/BHC: fast Bayesian hierarchical clustering for microarray data</article-title>. <source>BMC Bioinformatics</source>. <year>2009</year>; <volume>10</volume>:<fpage>242</fpage>–<lpage>251</lpage>.<pub-id pub-id-type="pmid">19660130</pub-id></mixed-citation>
    </ref>
    <ref id="B29">
      <label>29.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Murtagh</surname><given-names>F.</given-names></name>, <name name-style="western"><surname>Legendre</surname><given-names>P.</given-names></name></person-group><article-title>Ward’s Hierarchical agglomerative clustering Method: Which algorithms implement Ward’s criterion</article-title>. <source>J. Classification</source>. <year>2014</year>; <volume>31</volume>:<fpage>274</fpage>–<lpage>295</lpage>.</mixed-citation>
    </ref>
    <ref id="B30">
      <label>30.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gagolewski</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Bartoszuk</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Cena</surname><given-names>A.</given-names></name></person-group><article-title>Genie: a new, fast, and outlier-resistant hierarchical clustering algorithm</article-title>. <source>Inf. Sci.</source><year>2016</year>; <volume>363</volume>:<fpage>8</fpage>–<lpage>23</lpage>.</mixed-citation>
    </ref>
    <ref id="B31">
      <label>31.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Müllner</surname><given-names>D.</given-names></name><etal>et al</etal>.</person-group><article-title>fastcluster: Fast hierarchical, agglomerative clustering routines for R and Python</article-title>. <source>J. Stat. Softw.</source><year>2013</year>; <volume>53</volume>:<fpage>1</fpage>–<lpage>18</lpage>.</mixed-citation>
    </ref>
    <ref id="B32">
      <label>32.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Ragonnet-Cronin</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Hodcroft</surname><given-names>E.</given-names></name>, <name name-style="western"><surname>Hué</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Fearnhill</surname><given-names>E.</given-names></name>, <name name-style="western"><surname>Delpech</surname><given-names>V.</given-names></name>, <name name-style="western"><surname>Brown</surname><given-names>A. J.L.</given-names></name>, <name name-style="western"><surname>Lycett</surname><given-names>S.</given-names></name><collab>UK HIV Drug Resistance Database</collab></person-group><article-title>Automated analysis of phylogenetic clusters</article-title>. <source>BMC Bioinformatics</source>. <year>2013</year>; <volume>14</volume>:<fpage>317</fpage>–<lpage>326</lpage>.<pub-id pub-id-type="pmid">24191891</pub-id></mixed-citation>
    </ref>
    <ref id="B33">
      <label>33.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Strehl</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Ghosh</surname><given-names>J.</given-names></name></person-group><article-title>Cluster Ensembles—a knowledge reuse framework for combining multiple partitions</article-title>. <source>J. Mach. Learn. Res.</source><year>2002</year>; <volume>3</volume>:<fpage>583</fpage>–<lpage>617</lpage>.</mixed-citation>
    </ref>
    <ref id="B34">
      <label>34.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Richardson</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Green</surname><given-names>P.J.</given-names></name></person-group><article-title>On Bayesian analysis of mixtures with an unknown number of components (with discussion)</article-title>. <source>J. R. Stat. Soc.</source><year>1997</year>; <volume>59</volume>:<fpage>731</fpage>–<lpage>792</lpage>.</mixed-citation>
    </ref>
    <ref id="B35">
      <label>35.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Staab</surname><given-names>P.R.</given-names></name>, <name name-style="western"><surname>Zhu</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Metzler</surname><given-names>D.</given-names></name>, <name name-style="western"><surname>Lunter</surname><given-names>G.</given-names></name></person-group><article-title>scrm: efficiently simulating long sequences using the approximated coalescent with recombination</article-title>. <source>Bioinformatics</source>. <year>2015</year>; <volume>31</volume>:<fpage>1680</fpage>–<lpage>1682</lpage>.<pub-id pub-id-type="pmid">25596205</pub-id></mixed-citation>
    </ref>
    <ref id="B36">
      <label>36.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Staab</surname><given-names>P.R.</given-names></name>, <name name-style="western"><surname>Metzler</surname><given-names>D.</given-names></name></person-group><article-title>Coala: an R framework for coalescent simulation</article-title>. <source>Bioinformatics</source>. <year>2016</year>; <volume>32</volume>:<fpage>1903</fpage>–<lpage>1904</lpage>.<pub-id pub-id-type="pmid">27153679</pub-id></mixed-citation>
    </ref>
    <ref id="B37">
      <label>37.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Tonkin-Hill</surname><given-names>G.</given-names></name>, <name name-style="western"><surname>Lees</surname><given-names>J.A.</given-names></name>, <name name-style="western"><surname>Bentley</surname><given-names>S.D.</given-names></name>, <name name-style="western"><surname>Frost</surname><given-names>S.D.W.</given-names></name>, <name name-style="western"><surname>Corander</surname><given-names>J.</given-names></name></person-group><article-title>RhierBAPS: an R implementation of the population clustering algorithm hierBAPS</article-title>. <source>Wellcome Open Res.</source><year>2018</year>; <volume>3</volume>:<fpage>93</fpage>–<lpage>98</lpage>.<pub-id pub-id-type="pmid">30345380</pub-id></mixed-citation>
    </ref>
    <ref id="B38">
      <label>38.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Fowlkes</surname><given-names>E.B.</given-names></name>, <name name-style="western"><surname>Mallows</surname><given-names>C.L.</given-names></name></person-group><article-title>A method for comparing two hierarchical clusterings</article-title>. <source>J. Am. Stat. Assoc.</source><year>1983</year>; <volume>78</volume>:<fpage>553</fpage>–<lpage>569</lpage>.</mixed-citation>
    </ref>
    <ref id="B39">
      <label>39.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Chewapreecha</surname><given-names>C.</given-names></name>, <name name-style="western"><surname>Harris</surname><given-names>S.R.</given-names></name>, <name name-style="western"><surname>Croucher</surname><given-names>N.J.</given-names></name>, <name name-style="western"><surname>Turner</surname><given-names>C.</given-names></name>, <name name-style="western"><surname>Marttinen</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Cheng</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Pessia</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Aanensen</surname><given-names>D.M.</given-names></name>, <name name-style="western"><surname>Mather</surname><given-names>A.E.</given-names></name>, <name name-style="western"><surname>Page</surname><given-names>A.J.</given-names></name><etal>et al</etal>.</person-group><article-title>Dense genomic sampling identifies highways of pneumococcal recombination</article-title>. <source>Nat. Genet.</source><year>2014</year>; <volume>46</volume>:<fpage>305</fpage>–<lpage>309</lpage>.<pub-id pub-id-type="pmid">24509479</pub-id></mixed-citation>
    </ref>
    <ref id="B40">
      <label>40.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Aanensen</surname><given-names>D.M.</given-names></name>, <name name-style="western"><surname>Feil</surname><given-names>E.J.</given-names></name>, <name name-style="western"><surname>Holden</surname><given-names>M.T.G.</given-names></name>, <name name-style="western"><surname>Dordel</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Yeats</surname><given-names>C.A.</given-names></name>, <name name-style="western"><surname>Fedosejev</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Goater</surname><given-names>R.</given-names></name>, <name name-style="western"><surname>Castillo-Ramírez</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Corander</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Colijn</surname><given-names>C.</given-names></name><collab>European SRL Working Group</collab><etal>et al</etal>.</person-group><article-title>Whole-Genome sequencing for routine pathogen surveillance in public Health: a population snapshot of invasive staphylococcus aureus in Europe</article-title>. <source>Mbio</source>. <year>2016</year>; <volume>7</volume>:<fpage>e00444-16</fpage>.<pub-id pub-id-type="pmid">27150362</pub-id></mixed-citation>
    </ref>
    <ref id="B41">
      <label>41.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lees</surname><given-names>J.A.</given-names></name>, <name name-style="western"><surname>Kremer</surname><given-names>P.H.C.</given-names></name>, <name name-style="western"><surname>Manso</surname><given-names>A.S.</given-names></name>, <name name-style="western"><surname>Croucher</surname><given-names>N.J.</given-names></name>, <name name-style="western"><surname>Ferwerda</surname><given-names>B.</given-names></name>, <name name-style="western"><surname>Serón</surname><given-names>M.V.</given-names></name>, <name name-style="western"><surname>Oggioni</surname><given-names>M.R.</given-names></name>, <name name-style="western"><surname>Parkhill</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Brouwer</surname><given-names>M.C.</given-names></name>, <name name-style="western"><surname>van der Ende</surname><given-names>A.</given-names></name><etal>et al</etal>.</person-group><article-title>Large scale genomic analysis shows no evidence for pathogen adaptation between the blood and cerebrospinal fluid niches during bacterial meningitis</article-title>. <source>Microb. Genome</source>. <year>2017</year>; <volume>3</volume>:<fpage>e000103</fpage>.</mixed-citation>
    </ref>
    <ref id="B42">
      <label>42.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Kremer</surname><given-names>P.H.C.</given-names></name>, <name name-style="western"><surname>Lees</surname><given-names>J.A.</given-names></name>, <name name-style="western"><surname>Koopmans</surname><given-names>M.M.</given-names></name>, <name name-style="western"><surname>Ferwerda</surname><given-names>B.</given-names></name>, <name name-style="western"><surname>Arends</surname><given-names>A. W.M.</given-names></name>, <name name-style="western"><surname>Feller</surname><given-names>M.M.</given-names></name>, <name name-style="western"><surname>Schipper</surname><given-names>K.</given-names></name>, <name name-style="western"><surname>Valls Seron</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>van der Ende</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Brouwer</surname><given-names>M.C.</given-names></name><etal>et al</etal>.</person-group><article-title>Benzalkonium tolerance genes and outcome in Listeria monocytogenes meningitis</article-title>. <source>Clin. Microbiol. Infect.</source><year>2017</year>; <volume>23</volume>:<fpage>265.e1</fpage>–<lpage>265.e7</lpage>.</mixed-citation>
    </ref>
    <ref id="B43">
      <label>43.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Koelman</surname><given-names>D.</given-names></name>, <name name-style="western"><surname>Kremer</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Lees</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Brouwer</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Bentley</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>van de Beek</surname><given-names>D.</given-names></name></person-group><article-title>Bacterial hypervirulence in haemophilus influenzae meningitis identified by whole genome sequencing</article-title>. <source>J. Neurol. Sci.</source><year>2017</year>; <volume>381</volume>:<fpage>181</fpage>–<lpage>182</lpage>.</mixed-citation>
    </ref>
    <ref id="B44">
      <label>44.</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><collab>HIV Sequence Compendium</collab><name name-style="western"><surname>Foley</surname><given-names>B.</given-names></name>, <name name-style="western"><surname>Leitner</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Apetrei</surname><given-names>C.</given-names></name>, <name name-style="western"><surname>Hahn</surname><given-names>B.</given-names></name>, <name name-style="western"><surname>Mizrachi</surname><given-names>I.</given-names></name>, <name name-style="western"><surname>Mullins</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Wolinksy</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Korber</surname><given-names>B.</given-names></name></person-group><source>Theoretical Biology and Biophysics Group</source>. <year>2018</year>; <publisher-loc>NM</publisher-loc><publisher-name>Los Alamos National Laboratory</publisher-name>.</mixed-citation>
    </ref>
    <ref id="B45">
      <label>45.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Dudas</surname><given-names>G.</given-names></name>, <name name-style="western"><surname>Carvalho</surname><given-names>L.M.</given-names></name>, <name name-style="western"><surname>Bedford</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Tatem</surname><given-names>A.J.</given-names></name>, <name name-style="western"><surname>Baele</surname><given-names>G.</given-names></name>, <name name-style="western"><surname>Faria</surname><given-names>N.R.</given-names></name>, <name name-style="western"><surname>Park</surname><given-names>D.J.</given-names></name>, <name name-style="western"><surname>Ladner</surname><given-names>J.T.</given-names></name>, <name name-style="western"><surname>Arias</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Asogun</surname><given-names>D.</given-names></name><etal>et al</etal>.</person-group><article-title>Virus genomes reveal factors that spread and sustained the Ebola epidemic</article-title>. <source>Nature</source>. <year>2017</year>; <volume>544</volume>:<fpage>309</fpage>–<lpage>315</lpage>.<pub-id pub-id-type="pmid">28405027</pub-id></mixed-citation>
    </ref>
    <ref id="B46">
      <label>46.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Price</surname><given-names>M.N.</given-names></name>, <name name-style="western"><surname>Dehal</surname><given-names>P.S.</given-names></name>, <name name-style="western"><surname>Arkin</surname><given-names>A.P.</given-names></name></person-group><article-title>FastTree 2—approximately maximum-likelihood trees for large alignments</article-title>. <source>PLoS One</source>. <year>2010</year>; <volume>5</volume>:<fpage>e9490</fpage>.<pub-id pub-id-type="pmid">20224823</pub-id></mixed-citation>
    </ref>
    <ref id="B47">
      <label>47.</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>McInnes</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Healy</surname><given-names>J.</given-names></name></person-group><article-title>UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction</article-title>. <year>2018</year>; arXiv doi: <uri xlink:href="https://www.arxiv.org/abs/1802.03426">https://arxiv.org/abs/1802.03426</uri>, 09 February 2018, preprint: not peer reviewed.</mixed-citation>
    </ref>
    <ref id="B48">
      <label>48.</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Diaz-Papkovich</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Anderson-Trocme</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Gravel</surname><given-names>S.</given-names></name></person-group><article-title>Revealing multi-scale population structure in large cohorts</article-title>. <year>2018</year>; bioRxiv doi: <pub-id pub-id-type="doi">10.1101/423632</pub-id>, 23 September 2018, preprint: not peer reviewed.</mixed-citation>
    </ref>
    <ref id="B49">
      <label>49.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Becht</surname><given-names>E.</given-names></name>, <name name-style="western"><surname>McInnes</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Healy</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Dutertre</surname><given-names>C.-A.</given-names></name>, <name name-style="western"><surname>Kwok</surname><given-names>I. W.H.</given-names></name>, <name name-style="western"><surname>Ng</surname><given-names>L.G.</given-names></name>, <name name-style="western"><surname>Ginhoux</surname><given-names>F.</given-names></name>, <name name-style="western"><surname>Newell</surname><given-names>E.W.</given-names></name></person-group><article-title>Dimensionality reduction for visualizing single-cell data using UMAP</article-title>. <source>Nat. Biotechnol.</source><year>2018</year>; <volume>37</volume>:<fpage>38</fpage>–<lpage>48</lpage>.</mixed-citation>
    </ref>
    <ref id="B50">
      <label>50.</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Kassambara</surname><given-names>A.</given-names></name></person-group><source>Practical Guide to Cluster Analysis in R: Unsupervised Machine Learning</source>. <year>2017</year>; <volume>1</volume>:<publisher-name>STHDA</publisher-name><fpage>129</fpage>–<lpage>130</lpage>.</mixed-citation>
    </ref>
    <ref id="B51">
      <label>51.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Latch</surname><given-names>E.K.</given-names></name>, <name name-style="western"><surname>Dharmarajan</surname><given-names>G.</given-names></name>, <name name-style="western"><surname>Glaubitz</surname><given-names>J.C.</given-names></name>, <name name-style="western"><surname>Rhodes</surname><given-names>O.E.</given-names></name></person-group><article-title>Relative performance of Bayesian clustering software for inferringpopulation substructure and individual assignment at low levels of population differentiation</article-title>. <source>Conserv. Genet.</source><year>2006</year>; <volume>7</volume>:<fpage>295</fpage>–<lpage>302</lpage>.</mixed-citation>
    </ref>
    <ref id="B52">
      <label>52.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Zhang</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Halkilahti</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Hänninen</surname><given-names>M.-L.</given-names></name>, <name name-style="western"><surname>Rossi</surname><given-names>M.</given-names></name></person-group><article-title>Refinement of whole-genome multilocus sequence typing analysis by addressing gene paralogy</article-title>. <source>J. Clin. Microbiol.</source><year>2015</year>; <volume>53</volume>:<fpage>1765</fpage>–<lpage>1767</lpage>.<pub-id pub-id-type="pmid">25788543</pub-id></mixed-citation>
    </ref>
    <ref id="B53">
      <label>53.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lees</surname><given-names>J.A.</given-names></name>, <name name-style="western"><surname>Harris</surname><given-names>S.R.</given-names></name>, <name name-style="western"><surname>Tonkin-Hill</surname><given-names>G.</given-names></name>, <name name-style="western"><surname>Gladstone</surname><given-names>R.A.</given-names></name>, <name name-style="western"><surname>Lo</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Weiser</surname><given-names>J.N.</given-names></name>, <name name-style="western"><surname>Corander</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Bentley</surname><given-names>S.D.</given-names></name>, <name name-style="western"><surname>Croucher</surname><given-names>N.J.</given-names></name></person-group><article-title>Fast and flexible bacterial genomic epidemiology with PopPUNK</article-title>. <source>Genome Res.</source><year>2018</year>; <volume>29</volume>:<fpage>304</fpage>–<lpage>316</lpage>.</mixed-citation>
    </ref>
    <ref id="B54">
      <label>54.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Katherine</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Heller</surname><given-names>Z.G.</given-names></name></person-group><article-title>Randomized algorithms for fast bayesian hierarchical clustering</article-title>. <source>PASCAL Workshop on Statistics and Optimization of Clustering</source>. <year>2005</year>; <volume>25</volume>:<fpage>1</fpage>–<lpage>22</lpage>.</mixed-citation>
    </ref>
    <ref id="B55">
      <label>55.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Yang</surname><given-names>Z.</given-names></name>, <name name-style="western"><surname>Corander</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Oja</surname><given-names>E.</given-names></name></person-group><article-title>Low-rank doubly stochastic matrix decomposition for cluster analysis</article-title>. <source>J. Mach. Learn. Res.</source><year>2016</year>; <volume>17</volume>:<fpage>1</fpage>–<lpage>25</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
