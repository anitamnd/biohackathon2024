<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">2865860</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btq118</article-id>
    <article-id pub-id-type="publisher-id">btq118</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group>
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Supervised normalization of microarrays</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Mecham</surname>
          <given-names>Brigham H.</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Nelson</surname>
          <given-names>Peter S.</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="AFF1">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Storey</surname>
          <given-names>John D.</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>3</sup>
        </xref>
        <xref ref-type="corresp" rid="COR1">*</xref>
      </contrib>
    </contrib-group>
    <aff id="AFF1"><sup>1</sup> Department of Genome Sciences, University of Washington, Seattle, WA 98195, <sup>2</sup> Divisions of Human Biology and Clinical Research, Fred Hutchinson Cancer Research Center, Seattle, WA 98109 and <sup>3</sup> Lewis-Sigler Institute for Integrative Genomics and Department of Molecular Biology, Princeton University, Princeton, NJ 08544, USA</aff>
    <author-notes>
      <corresp id="COR1">* To whom correspondence should be addressed.</corresp>
      <fn>
        <p>Associate Editor: Joaquin Dopazo</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>5</month>
      <year>2010</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>31</day>
      <month>3</month>
      <year>2010</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>31</day>
      <month>3</month>
      <year>2010</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>26</volume>
    <issue>10</issue>
    <fpage>1308</fpage>
    <lpage>1315</lpage>
    <history>
      <date date-type="received">
        <day>30</day>
        <month>12</month>
        <year>2009</year>
      </date>
      <date date-type="rev-recd">
        <day>30</day>
        <month>12</month>
        <year>2009</year>
      </date>
      <date date-type="accepted">
        <day>4</day>
        <month>2</month>
        <year>2010</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2010. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2010</copyright-year>
      <license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by-nc/2.0/uk/">
        <license-p><!--CREATIVE COMMONS-->This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/2.5">http://creativecommons.org/licenses/by-nc/2.5</ext-link>), which permits unrestricted non-commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Motivation:</bold> A major challenge in utilizing microarray technologies to measure nucleic acid abundances is ‘normalization’, the goal of which is to separate biologically meaningful signal from other confounding sources of signal, often due to unavoidable technical factors. It is intuitively clear that true biological signal and confounding factors need to be simultaneously considered when performing normalization. However, the most popular normalization approaches do not utilize what is known about the study, both in terms of the biological variables of interest and the known technical factors in the study, such as batch or array processing date.</p>
      <p><bold>Results:</bold> We show here that failing to include all study-specific biological and technical variables when performing normalization leads to biased downstream analyses. We propose a general normalization framework that fits a study-specific model employing every known variable that is relevant to the expression study. The proposed method is generally applicable to the full range of existing probe designs, as well as to both single-channel and dual-channel arrays. We show through real and simulated examples that the method has favorable operating characteristics in comparison to some of the most highly used normalization methods.</p>
      <p><bold>Availability:</bold> An R package called <monospace>snm</monospace> implementing the methodology will be made available from Bioconductor (<ext-link ext-link-type="uri" xlink:href="http://bioconductor.org">http://bioconductor.org</ext-link>).</p>
      <p>
        <bold>Contact:</bold>
        <email>jstorey@princeton.edu</email>
      </p>
      <p><bold>Supplementary information:</bold><ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq118/DC1">Supplementary data</ext-link> are available at <italic>Bioinformatics</italic> online.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <sec sec-type="intro" id="SEC1">
    <title>1 INTRODUCTION</title>
    <p>The microarray technology measures nucleic acid abundances, such as from mRNA, in biological samples by producing fluorescence intensities that reflect hybridization events between nucleotide sequences. Attached to the microarray are single-stranded DNA probes, which represent a short segment of complementary DNA within a gene. Differences among current microarray technologies are typically in terms of probe design and the number of fluorescent dyes applied to any given array. Regardless of the technology, statistical analysis of these data usually attempts to infer the relationship between nucleic acid abundance variation and biological phenotype. One of the main challenges of this inference process is normalization, which addresses the fact that factors not of biological relevance can influence the observed intensities (Bolstad <italic>et al.</italic>, <xref ref-type="bibr" rid="B2">2003</xref>; Dudoit <italic>et al.</italic>, <xref ref-type="bibr" rid="B4">2002</xref>; Tseng <italic>et al.</italic>, <xref ref-type="bibr" rid="B15">2001</xref>; Wu <italic>et al.</italic>, <xref ref-type="bibr" rid="B18">2004</xref>), complicating approaches used to infer relationships from these data (Dabney and Storey, <xref ref-type="bibr" rid="B3">2007</xref>; Rattray <italic>et al.</italic>, <xref ref-type="bibr" rid="B11">2006</xref>; Wu and Irrizary, <xref ref-type="bibr" rid="B17">2007</xref>). The major contribution of this paper is to provide a general ‘supervised’ framework for microarray normalization (<xref ref-type="fig" rid="F1">Fig. 1</xref>). This approach is applicable to all major microarray technologies and performs the normalization in a manner supervised by all known variables relevant to the study.
<fig id="F1" position="float"><label>Fig. 1.</label><caption><p>A demonstration of the main ideas behind supervised normalization of microarrays. (<bold>A</bold>) A hypothetical example to demonstrate the differences between supervised and unsupervised normalization strategies. The three boxes arranged across the top display different types of potential effects. Each of these potentially influences the unnormalized observed intensities, which are presented as densities in the middle panel. The blue and red lines describe the different biological conditions, while the dashed and dotted lines describe the different dates. The differences among the four arise either from the biology or study design. After normalization with a supervised approach that takes all three effects into account when normalizing the data, the differences between the blue and red lines are still present, while the differences between the dashed and dotted lines have been removed. However, for unsupervised approaches, such as quantile normalization, the resulting data have been transformed so that all arrays have the same distribution, a result that clearly violates the biological relationship of interest. (<bold>B</bold>) An example of the model we fit to the probe-level data from a microarray study. The model has probe-specific terms, intensity-dependent terms and may include other terms such as probe composition effects or surface level spatial effects.</p></caption><graphic xlink:href="btq118f1"/></fig></p>
    <p>Some of the most highly used microarray normalization methods are what we call ‘unsupervised’ methods. These are normalization procedures that do not utilize the variables describing the study, specifically the biological variables of interest (<xref ref-type="fig" rid="F1">Fig. 1</xref>). For example, suppose the goal of a microarray study is to identify genes differentially expressed with respect to an experimental treatment. Also, suppose that the arrays were processed in two separate batches. Unsupervised methods ignore the treatment and batch variables when performing the normalization. However, if the goal of normalization is to separate biologically meaningful signal from technical confounders, then it seems infeasible to do so without taking into account the signal explained by the study-specific variables, such as treatment and batch in this example.</p>
    <p>While unsupervised methods may show favorable operating characteristics in specialized settings—such as when biological variables contribute relatively negligible signal to the data—it has been shown they make assumptions about data that are commonly invalidated in practice (Dabney and Storey, <xref ref-type="bibr" rid="B3">2007</xref>; Irizarry <italic>et al.</italic>, <xref ref-type="bibr" rid="B6">2006</xref>). As a simple motivating example meant to illustrate how easily these assumptions are violated, we simulated microarray data (extensive details are given in following sections) with signal due to a dichotomous biological variable and intensity-dependent array effects. We simulated 100 000 probes, 30% of which are differentially expressed. <xref ref-type="fig" rid="F2">Figure 2</xref> shows the <italic>P</italic>-value histograms corresponding to probes, which are not differentially expressed. <xref ref-type="fig" rid="F2">Figure 2</xref>A is the method we propose in this work, where the <italic>P</italic>-values are correctly Uniform(0,1). <xref ref-type="fig" rid="F2">Figure 2</xref>C and E show the <italic>P</italic>-values from the same probes when using invariant set normalization (ISN; Li and Wong, <xref ref-type="bibr" rid="B9">2001</xref>) and quantile normalization (QN; Bolstad <italic>et al.</italic>, <xref ref-type="bibr" rid="B2">2003</xref>), respectively. It can be seen that both sets of <italic>P</italic>-values are anti-conservatively biased.
<fig id="F2" position="float"><label>Fig. 2.</label><caption><p>Results from simulated data with differential expression and array effects. The true proportion of null probes is π<sub>0</sub> = 0.70. (<bold>A</bold>) <italic>P</italic>-value histogram of null probes after SNM normalization. (<bold>B</bold>) <italic>P</italic>-value histogram of all probes after SNM normalization. (<bold>C</bold>) <italic>P</italic>-value histogram of null probes after QN. (<bold>D</bold>) <italic>P</italic>-value histogram of all probes after QN. (<bold>E</bold>) <italic>P</italic>-value histogram of null probes after ISN. (<bold>F</bold>) <italic>P</italic>-value histogram of all probes after ISN.</p></caption><graphic xlink:href="btq118f2"/></fig></p>
    <p>We show that the main reason for the anti-conservative null <italic>P</italic>-value distribution from the two unsupervised normalization methods is that the known biological variable was not taken into account. We also show that unsupervised normalization methods may become more problematic and unpredictable as more study-specific variables are ignored. The basic reason for this is that when performing normalization, one cannot unbiasedly separate true biological signal from technical and other study-specific confounders unless both sets of variables are taken into account during the normalization process. On the other hand, supervised normalization methods (Baird <italic>et al.</italic>, <xref ref-type="bibr" rid="B1">2004</xref>; Dabney and Storey, <xref ref-type="bibr" rid="B3">2007</xref>; Wolfinger <italic>et al.</italic>, <xref ref-type="bibr" rid="B16">2001</xref>; Wu and Irrizary, <xref ref-type="bibr" rid="B17">2007</xref>; Wu <italic>et al.</italic>, <xref ref-type="bibr" rid="B18">2004</xref>) use all measured variables as a basis for normalization. Several supervised methods have been developed for the analysis of dual-channel microarrays (Baird <italic>et al.</italic>, <xref ref-type="bibr" rid="B1">2004</xref>; Dabney and Storey, <xref ref-type="bibr" rid="B3">2007</xref>; Wolfinger <italic>et al.</italic>, <xref ref-type="bibr" rid="B16">2001</xref>), and recent work has demonstrated that results from supervised techniques offer a clear improvement over results obtained from unsupervised approaches (Dabney and Storey, <xref ref-type="bibr" rid="B3">2007</xref>). However, these methods require highly structured experimental designs and are not applicable to single-channel microarrays or microarrays with several probes per gene.</p>
    <p>We develop a framework for supervised normalization of microarray data, which is applicable to a large class of experimental designs and technologies, including single-channel arrays, dual-channel arrays and different probe designs (e.g. one probe per gene, probe sets and exon arrays). We focus the examples on common sources of confounding variation and demonstrate that the proposed supervised method accounts for their effects on the data without perturbing the resulting inference. We provide examples that show how the framework presented here can be used to analyze several types of microarray data, thus unifying the problems of data normalization for these alternative microarray technologies.</p>
  </sec>
  <sec id="SEC2">
    <title>2 APPROACH</title>
    <p>In any given study, there are a set of study-specific variables known to the researcher that are also capable of being included in the model used to perform inference. These study-specific variables fall into one of the two categories: biological variables or adjustment variables. We define <italic>biological variables</italic> to be those whose relationships with nucleic acid variation are the target of the statistical analysis. The other variables, which are utilized as covariates to account for other sources of variation, are what we call <italic>adjustment variables</italic>. Essentially, adjustment variables are all of the study-specific variables not of inferential interest in the study but may correctly explain variation in the data. These include technical variables such as dye, surface and probe-composition effects. They include study design variables, such as batch, technical replicates, or the dates on which the arrays were processed. Adjustment variables may also include those that are biological in nature, but not of interest in the study. For example, perhaps the goal is to characterize the relationship between an experimental treatment and gene expression, but the study is performed on both males and females. If the relationship between sex and expression is not of interest, then this variable would be included among the adjustment variables.</p>
    <p>The basic idea of the proposed approach and how it differs from unsupervised methods is displayed in <xref ref-type="fig" rid="F1">Figure 1</xref>. <xref ref-type="fig" rid="F1">Figure 1</xref>A shows that the proposed normalization approach utilizes all that is known about the study (biology, study design and technology) in order to perform the normalization. This allows for the signal due to biology to be left intact in the normalized data. <xref ref-type="fig" rid="F1">Figure 1</xref>B displays an example of the model we fit to the probe-level data from a microarray study. The model has probe-specific terms, intensity-dependent terms and may include other terms such as probe composition effects or array surface spatial effects. The probe-specific terms are partitioned between the biological variables and the adjustment variables. The intensity-dependent terms are written as smooth, random functions of these probe-specific terms. We jointly fit this model to all probes simultaneously, allowing all relevant variables to be properly included in the model. Our model fitting procedure is iterative in order to minimize confounding between the biological variation of interest and the other sources of variation.</p>
  </sec>
  <sec sec-type="methods" id="SEC3">
    <title>3 METHODS</title>
    <sec id="SEC3.1">
      <title>3.1 A general model</title>
      <p>We first consider the situation where the complete data from a microarray experiment consists of three terms: the observed probe intensities, biological variables and adjustment variables. The intensities are usually presented as an <italic>m</italic> × <italic>n</italic> matrix, <bold>Y</bold>, where <italic>m</italic> and <italic>n</italic> describe the number of probes and arrays in the entire study, respectively. Define <italic>y</italic><sub><italic>ij</italic></sub> as the observed intensity for probe <italic>i</italic> = 1,…, <italic>m</italic> on array <italic>j</italic> =1,.., <italic>n</italic>, and <bold>y</bold><sub><italic>i</italic></sub> = (<italic>y</italic><sub><italic>i</italic>1</sub>, <italic>y</italic><sub><italic>i</italic>2</sub>,…, <italic>y</italic><sub><italic>in</italic></sub>) as the observed intensities for probe <italic>i</italic> across the <italic>n</italic> arrays. The <italic>k</italic>-th biological variable for array <italic>j</italic>, <italic>x</italic><sub><italic>kj</italic></sub>, describes factors of interest such as disease status, experimental treatment, or time point. All <italic>d</italic> covariates for an individual sample <italic>j</italic> are denoted by the vector <bold>x</bold><sub><italic>j</italic></sub>, and we group all <italic>n</italic> such vectors into a <italic>d</italic> × <italic>n</italic> matrix <bold>X</bold> = (<bold>x</bold><sub>1</sub>,…, <bold>x</bold><sub><italic>n</italic></sub>).</p>
      <p>Similarly, the ℓth adjustment variable for array <italic>j</italic>, <italic>z</italic><sub>ℓ<italic>j</italic></sub>, parameterizes variables to be fit in a probe−specific manner. Let <italic>r</italic><sub><italic>c</italic></sub> denote the number of probe-specific adjustment variables. When the baseline value of <italic>y</italic><sub><italic>ij</italic></sub> is not of interest, this probe-specific intercept term is included among the adjustment variables. Define the vector <bold>z</bold><sub><italic>j</italic></sub> and matrix <bold>Z</bold> in a fashion analogous to the one described for <bold>x</bold><sub><italic>j</italic></sub> and <bold>X</bold>, respectfully. Finally, we assume that there are <italic>r</italic><sub><italic>f</italic></sub> intensity-dependent effects, which we denote by <italic>f</italic><sub><italic>tj</italic></sub> for effect <italic>t</italic> = 1,…, <italic>r</italic><sub><italic>f</italic></sub> and array <italic>j</italic>.</p>
      <p>Note that we construct <bold>X</bold> and <bold>Z</bold> such that <bold>b</bold><sub><italic>i</italic></sub> = <bold>0</bold> represents the case where the biological variables of interest show no association with probe <italic>i</italic>. (This is straightforward to construct even for time course studies; Storey <italic>et al.</italic> <xref ref-type="bibr" rid="B14">2005</xref>). A concrete example of <bold>X</bold> and <bold>Z</bold> can be found in the <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq118/DC1">Supplementary Material</ext-link>.</p>
      <p>We model <italic>y</italic><sub><italic>ij</italic></sub> as linear combinations of <bold>x</bold><sub><italic>j</italic></sub>, <bold>z</bold><sub><italic>j</italic></sub>, and intensity-dependent effects. The model for each probe intensity measurement is written as
<disp-formula id="M1"><label>(1)</label><graphic xlink:href="btq118m1"/></disp-formula>
where <italic>m</italic><sub><italic>ij</italic></sub> = ∑<sub><italic>k</italic>=1</sub><sup><italic>d</italic></sup> <italic>b</italic><sub><italic>ik</italic></sub><italic>x</italic><sub><italic>kj</italic></sub> + ∑<sub>ℓ=1</sub><sup><italic>r</italic><sub><italic>c</italic></sub></sup> <italic>a</italic><sub><italic>i</italic>ℓ</sub><italic>z</italic><sub>ℓ<italic>j</italic></sub>. The coefficients <italic>b</italic><sub><italic>ik</italic></sub> and <italic>a</italic><sub><italic>i</italic>ℓ</sub> describe the influence of the <italic>k</italic>-th biological and ℓ-th adjustment variable on probe <italic>i</italic>'s intensity. We assume that the <italic>t</italic>-th intensity-dependent function <italic>f</italic><sub><italic>tj</italic></sub> is a random smooth function such that E[<italic>f</italic><sub><italic>tj</italic></sub>(<italic>m</italic>)|<italic>m</italic>] = 0 for all <italic>m</italic>. These are parameterized as Normal distributed coefficients applied to a <italic>B</italic>-spline basis (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq118/DC1">Supplementary Material</ext-link>). The zero expectation can be made without loss of generality because we allow for probe-specific offset terms (i.e. intercepts), which absorb any systematic deviation from these intensity−dependent functions. Finally, <italic>e</italic><sub><italic>ij</italic></sub> is the unexplained random error for probe <italic>i</italic> on array <italic>j</italic> with E[<italic>e</italic><sub><italic>ij</italic></sub>] = 0.</p>
      <p>We can write model (<xref ref-type="disp-formula" rid="M1">1</xref>) for probe <italic>i</italic> data across all <italic>n</italic> arrays, <bold>y</bold><sub><italic>i</italic></sub>, as
<disp-formula id="M2"><label>(2)</label><graphic xlink:href="btq118m2"/></disp-formula>
where <bold>b</bold><sub><italic>i</italic></sub> and <bold>a</bold><sub><italic>i</italic></sub> are 1 × <italic>d</italic> and 1 × <italic>r</italic><sub><italic>c</italic></sub> vectors of the <italic>b</italic><sub><italic>ik</italic></sub> and <italic>a</italic><sub><italic>i</italic>ℓ</sub> terms in (<xref ref-type="disp-formula" rid="M1">1</xref>), and <bold><italic>f</italic></bold><sub><italic>t</italic></sub>(<bold>b</bold><sub><italic>i</italic></sub> <bold>X</bold> + <bold>a</bold><sub><italic>i</italic></sub><bold>Z</bold>) = (<italic>f</italic><sub><italic>t</italic>1</sub>(<italic>m</italic><sub><italic>i</italic>1</sub>),…, <italic>f</italic><sub><italic>tn</italic></sub>(<italic>m</italic><sub><italic>in</italic></sub>)). The model for the entire dataset <bold>Y</bold> can be written as
<disp-formula id="M3"><label>(3)</label><graphic xlink:href="btq118m3"/></disp-formula>
where <bold>B</bold> and <bold>A</bold> are <italic>m</italic> × <italic>d</italic> and <italic>m</italic> × <italic>r</italic><sub><italic>c</italic></sub> matrices of coefficients, the <italic>i</italic>-th row corresponding to <bold>b</bold><sub><italic>i</italic></sub> and <bold>a</bold><sub><italic>i</italic></sub>, respectively. Also, <bold><italic>f</italic></bold><sub><italic>t</italic></sub>(<bold>BX</bold> + <bold>AZ</bold>) is an <italic>m</italic> × <italic>n</italic> matrix with the <italic>i</italic>-th row equal to <bold><italic>f</italic></bold><sub><italic>t</italic></sub>(<bold>b</bold><sub><italic>i</italic></sub><bold>X</bold> + <bold>a</bold><sub><italic>i</italic></sub><bold>Z</bold>).</p>
    </sec>
    <sec id="SEC3.2">
      <title>3.2 The goal of normalization</title>
      <p>The statistical goal of microarray analysis is to infer relationships between biological variables and individual probes or sets of probes. Different microarray platforms employ different designs. Regardless of the platform, relevant biological variation can be identified using individual probes, or groups of probes that share certain biological characteristics; for example, probes mapping to the same gene, chromosomal position or pathway. We use the term ‘probe set’ for any such grouping of probes. We first establish a definition of a correct normalization when inference is performed on individual probes (e.g. when there is one probe per gene).</p>
      <p>One property that a normalization should satisfy is that <inline-formula><inline-graphic xlink:href="btq118i1.jpg"/></inline-formula> when <bold>b</bold><sub><italic>i</italic></sub> = <bold>0</bold> and <inline-formula><inline-graphic xlink:href="btq118i2.jpg"/></inline-formula> when <bold>b</bold><sub><italic>i</italic></sub> ≠ <bold>0</bold>. Stated more directly, the normalization procedure should preserve the biological relationships of interest in the expected values of the estimated coefficients corresponding to the biological variables. A second, less obvious property is that a normalization method should remove all latent structure shared across probes due to adjustment variables. Specifically, any remaining component of the <bold>a</bold><sub><italic>i</italic></sub><bold>Z</bold> + ∑<sub><italic>t</italic>=1</sub><sup><italic>r</italic><sub><italic>f</italic></sub></sup><bold><italic>f</italic></bold><sub><italic>t</italic></sub>(<bold>b</bold><sub><italic>i</italic></sub><bold>X</bold> + <bold>a</bold><sub><italic>i</italic></sub><bold>Z</bold>) term will induce dependence in the error terms across probes, and unmodeled dependence has been shown to cause large-scale study−specific biases (Leek and Storey, <xref ref-type="bibr" rid="B7">2007</xref>, <xref ref-type="bibr" rid="B8">2008</xref>). An imperfect normalization procedure can bias the <inline-formula><inline-graphic xlink:href="btq118i3.jpg"/></inline-formula> or induce new sources of latent structure shared across probes (Dabney and Storey, <xref ref-type="bibr" rid="B3">2007</xref>).</p>
      <p>Violation of either of these properties can be seen in the joint distribution of <italic>P</italic>-values obtained from testing <italic>H</italic><sub>0<italic>i</italic></sub> : <bold>b</bold><sub><italic>i</italic></sub> = <bold>0</bold> versus <italic>H</italic><sub>1<italic>i</italic></sub> : <bold>b</bold><sub><italic>i</italic></sub> ≠ <bold>0</bold>. Therefore, we propose the following criteria as the ideal properties for a normalization model to achieve.</p>
      <statement>
        <title>D<sc>efinition</sc> 1.</title>
        <p><italic>Microarray Normalization Criteria</italic>.
<list list-type="order"><list-item><p><italic>The set of ‘null P-values’, obtained from testing H</italic><sub>0<italic>i</italic></sub> : <bold>b</bold><sub><italic>i</italic></sub> = <bold>0</bold> <italic>versus H</italic><sub>1<italic>i</italic></sub> : <bold>b</bold><sub><italic>i</italic></sub> ≠ <bold>0</bold> <italic>for all probes i where</italic> <bold>b</bold><sub><italic>i</italic></sub> = <bold>0</bold>, <italic>have a joint distribution following the</italic> Uniform(0,1) <italic>distribution</italic>.</p></list-item><list-item><p><italic>The set of ‘alternative P-values’ obtained from the above hypothesis tests for all probes i where</italic><bold>b</bold><sub><italic>i</italic></sub> ≠ <bold>0</bold> <italic>have a joint distribution stochastically smaller than the</italic> Uniform(0, 1) distribution.</p></list-item></list></p>
      </statement>
      <p>Correctly normalizing a microarray study is, therefore, a procedure that preserves the biological relationships of interest and the expected operating characteristics of the model fits at the probe level. The framework we introduce in this paper is designed to accomplish this goal, and numerical evidence we give indicates it does so when all relevant variables have been measured and included in the model.</p>
      <p>We now explain how this definition relates to probe sets. The central challenge for inference on probe sets is that technical sources of variation are very much probe specific, while biological sources influence the entire set of probes. For example, intensity-specific effects, probe nucleotide composition and spatial effects are all most appropriately dealt with at the probe level, while differential expression in response to a treatment is best measured in terms of its effect across the entire set of probes measuring a given gene.</p>
      <p>In our framework, a probe set summarization would combine all <bold>b</bold><sub><italic>i</italic></sub> for all probes <italic>i</italic> corresponding to a given probe set, where the <bold>b</bold><sub><italic>i</italic></sub> coefficients parameterize the biological relationships for each probe. A general probe set summarization for probe set <italic>k</italic> that takes this into account is
<disp-formula><graphic xlink:href="btq118um1"/></disp-formula>
where the α<sub><italic>i</italic></sub> have been chosen to represent relative reliability of probe <italic>i</italic>, the set 𝒮<sub><italic>k</italic></sub> is the set of all probe indices in probe set <italic>k</italic>, and ∑<sub><italic>i</italic>∈𝒮<sub><italic>k</italic></sub></sub> α<sub><italic>i</italic></sub> = 1. Note that if <bold>b</bold><sub><italic>i</italic></sub> = <bold>0</bold> for all <italic>i</italic> ∈ 𝒮<sub><italic>k</italic></sub> then ∑<sub><italic>i</italic>∈𝒮<sub><italic>k</italic></sub></sub> α<sub><italic>i</italic></sub><bold>b</bold><sub><italic>i</italic></sub> = <bold>0</bold>. In other words, preserving the proper operating characteristics of <inline-formula><inline-graphic xlink:href="btq118i4.jpg"/></inline-formula> for all <italic>i</italic> also preserves them for <inline-formula><inline-graphic xlink:href="btq118i5.jpg"/></inline-formula> (notwithstanding issues with <italic>P</italic>-value calculations of multiple variables, which is unrelated to the normalization problem).</p>
      <p>Given that this general model for probe summarization lacks terms for adjustment variables, and that statistical inference will be carried out on these summarized values, the goal for normalization remains the same: namely, to remove the influence of adjustment variables on probe intensities in order to maintain their true relationships with the biological variables of interest. This is the motivation for formulating the above goal in terms of inference on probe-level data, making this goal relevant regardless of microarray platform, technology or biological question.</p>
    </sec>
    <sec id="SEC3.3">
      <title>3.3 Supervised normalization of microarrays</title>
      <p>Our proposed method, called ‘supervised normalization of microarrays’ (SNM), fits the model from <xref ref-type="sec" rid="SEC3.1">Section 3.1</xref> to all probes and arrays simultaneously. The big picture idea of the method is to fit a study-specific model based on that in (<xref ref-type="disp-formula" rid="M1">1</xref>)–(<xref ref-type="disp-formula" rid="M3">3</xref>) to yield estimates <inline-formula><inline-graphic xlink:href="btq118i6.jpg"/></inline-formula>, <inline-formula><inline-graphic xlink:href="btq118i7.jpg"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="btq118i8.jpg"/></inline-formula>. (Note that there may be more terms in the model to account for other types of effects—see <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq118/DC1">Supplementary Material</ext-link>.) The fitted model can then be used accordingly to perform subsequent analyses.</p>
      <p>A key feature of SNM is that it involves simultaneously fitting the biological and study-specific adjustment variables. The fact that the intensity-dependent effects are functions of terms to be estimated by the model (i.e. <bold>BX</bold> + <bold>AZ</bold>) required us to develop a novel algorithm. The method we propose attempts to estimate a set of probes that are not associated to the biological variables (i.e. probes such that <bold>b</bold><sub><italic>i</italic></sub> = <bold>0</bold>). For ease of discussion, we call any probe <italic>i</italic> such that <bold>b</bold><sub><italic>i</italic></sub> = <bold>0</bold> a ‘null probe’ and any probe <italic>i</italic> such that <bold>b</bold><sub><italic>i</italic></sub> ≠ <bold>0</bold> an ‘alternative probe’. Once this set of null probes has been identified, we estimate the intensity-dependent effects using only these probes. Successfully doing so allows us to obtain estimates of the biological variables' coefficients satisfying the criteria from <xref ref-type="sec" rid="SEC3.2">Section 3.2</xref> . Thus, another key feature of SNM is that it specially handles the biological variables in order to obtain valid-fitted model coefficients of these variables.</p>
      <p>The following are the main steps of the SNM algorithm; see <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq118/DC1">Supplementary Material</ext-link> for more details, such as specifically how we fit smooth, random functions to model the intensity-dependent effects.</p>
      <p>
        <inline-graphic xlink:href="btq118i19.jpg"/>
      </p>
      <p>The reason we provide two different types of data adjustments in Step 6 is that exploratory analyses of the biological signal are best carried out on data where all signal <italic>not</italic> of interest has been modeled and removed. However, for statistical inference, it is necessary to account for the variation explained and degrees of freedom utilized by the adjustment variables, <bold>a</bold><sub><italic>i</italic></sub><bold>Z</bold>. It should be noted that the model fits we obtain at the final iteration of Steps 2–5 are exactly what would be obtained when fitting model (4) anyway.</p>
    </sec>
  </sec>
  <sec sec-type="results" id="SEC4">
    <title>4 RESULTS</title>
    <p>Unsupervised normalization methods make data transformations based on graphical trends visible in diagnostic plots. QN (Bolstad <italic>et al.</italic>, <xref ref-type="bibr" rid="B2">2003</xref>) transforms the data so that a quantile–quantile plot comparing the ordered probe intensities between any two arrays in a study is equal to the line <italic>y</italic> = <italic>x</italic> (<xref ref-type="fig" rid="F1">Fig. 1</xref>A); ISN (Li and Wong, <xref ref-type="bibr" rid="B9">2001</xref>) transforms the data so that a plot comparing the intensities of a selected subset of probes between any two arrays is centered about the line <italic>y</italic> = <italic>x</italic>; and MA-normalization (Dudoit <italic>et al.</italic>, <xref ref-type="bibr" rid="B4">2002</xref>; Tseng <italic>et al.</italic>, <xref ref-type="bibr" rid="B15">2001</xref>; Yang <italic>et al.</italic>, <xref ref-type="bibr" rid="B19">2002</xref>) transforms the data so that the relationship between the difference between two groups and their average value is centered about the line <italic>y</italic> = 0. The implicit assumption behind each of these unsupervised methods is that transforming the data to satisfy these criteria removes all variation due to technical variables, but does not change the signal due to biological variables. Interestingly, an implicit assumption of QN is also that the probe intensity distributions among arrays is always exactly the same, regardless of biology or study design. This precludes different overall levels and variation of mRNA across biological conditions, as well as any overall asymmetric differential expression.</p>
    <p>In this section, we demonstrate the operating characteristics of SNM through simulations and real data analysis, and make comparisons to the QN and ISN approaches. We also make comparisons to the eCADS method (Dabney and Storey, <xref ref-type="bibr" rid="B3">2007</xref>), which is well suited for balanced two group comparisons on dual-channel arrays and has been shown to outperform the MA-normalization approach.</p>
    <sec id="SEC4.1">
      <title>4.1 Simulations</title>
      <p>While the set of biological and adjustment variables to be utilized may vary from study to study, we present simulations in the context of several variables most commonly used: array, batch and dye effects (Baird <italic>et al.</italic>, <xref ref-type="bibr" rid="B1">2004</xref>; Dabney and Storey, <xref ref-type="bibr" rid="B3">2007</xref>; Wolfinger <italic>et al.</italic>, <xref ref-type="bibr" rid="B16">2001</xref>; Wu and Irrizary, <xref ref-type="bibr" rid="B17">2007</xref>; Wu <italic>et al.</italic>, <xref ref-type="bibr" rid="B18">2004</xref>). For each type of variable we describe results from data simulations. In the first scenario, we demonstrate how to estimate array effects in the presence of biological signal. These simulations mimic the most commonly assumed models for single channel microarray data such as that provided by Affymetrix. Then, we extend this to a scenario where we also estimate batch effects, an adjustment variable that arises in many large microarray datasets, and, as shown below, can also be present in smaller studies. Finally, we apply SNM to a scenario based on two-color experiments where the signal is influenced by intensity-dependent dye and array effects.</p>
      <p>A total of 100 simulated studies were carried out for each of the three scenarios, with the biological and technical effects simulated as follows. Data were simulated for a total of 100 000 probes and 12 arrays. The biological variable of interest is a dichotomous variable defining two groups (Groups 1 and 2) with six arrays sampled from each group. A randomly selected set of 30 000 probes were defined as differentially expressed between two groups, with the magnitude of the difference sampled from the Normal(1,1) distribution.</p>
      <p>To make our simulations as realistic as possible we based our sampling of baseline probe intensities on data from a commonly used spike-in study (Irizarry <italic>et al.</italic>, <xref ref-type="bibr" rid="B5">2003</xref>). Specifically, the baseline probe intensities were sampled from a distribution consisting of the mean raw probe intensities for each of the 201 800 probes used in this study.</p>
      <p>The random variation terms <italic>e</italic><sub><italic>ij</italic></sub> were sampled from a Normal distribution with mean 0 and a probe-specific variance term that was sampled from the Uniform(0.2,0.4) distribution. This implies that each probe does not have the same variance. The array and dye functions were defined by randomly selecting coefficients for a two-dimensional <italic>B</italic>-spline basis function from a N(0,0.75<sup>2</sup>), the probe-specific batch effects were sampled from a N(0,0.4<sup>2</sup>).</p>
      <p>For the first two scenarios, we compare the SNM normalized data to QN and ISN normalized data. For the third simulation, we compare the SNM results to those obtained from eCADS. For all three simulations we use Kolmogorov–Smirnov tests (KS-test) to assess the validity of each normalization method in terms of the criteria described in <xref ref-type="sec" rid="SEC3.2">Section 3.2</xref> defining the desired normalization operating characteristics. To assess Criterion I, we use a two-sided KS-test to compare the distribution of observed <italic>P</italic>-values from the null probes to a Uniform(0,1) distribution. To assess Criterion II, we use a one-sided KS-test to compare the distributions of <italic>P</italic>-values from the alternative probes to a Uniform(0,1) distribution. Both tests are performed at the 0.05 level, so we expect 5 or less significant tests out of 100 when the criteria are satisfied. The results of these simulations are summarized in <xref ref-type="table" rid="T1">Table 1</xref>.
<table-wrap id="T1" position="float"><label>Table 1.</label><caption><p>Results from data simulations</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1"/><th align="left" colspan="4" rowspan="1">Average <inline-formula><inline-graphic xlink:href="btq118i9.jpg"/></inline-formula> (π<sub>0</sub> = 0.70)<hr/></th><th align="left" colspan="4" rowspan="1">No. significant KS-tests<hr/></th></tr><tr><th align="left" rowspan="1" colspan="1">Simulations</th><th align="left" rowspan="1" colspan="1">ISN</th><th align="left" rowspan="1" colspan="1">QN</th><th align="left" rowspan="1" colspan="1">SNM</th><th align="left" rowspan="1" colspan="1">eCADS</th><th align="left" rowspan="1" colspan="1">ISN</th><th align="left" rowspan="1" colspan="1">QN</th><th align="left" rowspan="1" colspan="1">SNM</th><th align="left" rowspan="1" colspan="1">eCADS</th></tr></thead><tbody align="left"><tr><td align="left" rowspan="1" colspan="1">Array</td><td align="left" rowspan="1" colspan="1">0.55</td><td align="left" rowspan="1" colspan="1">0.54</td><td align="left" rowspan="1" colspan="1">0.75</td><td align="left" rowspan="1" colspan="1">NA</td><td align="left" rowspan="1" colspan="1">100</td><td align="left" rowspan="1" colspan="1">100</td><td align="left" rowspan="1" colspan="1">1</td><td align="left" rowspan="1" colspan="1">NA</td></tr><tr><td align="left" rowspan="1" colspan="1">Array + batch</td><td align="left" rowspan="1" colspan="1">1.00</td><td align="left" rowspan="1" colspan="1">1.00</td><td align="left" rowspan="1" colspan="1">0.74</td><td align="left" rowspan="1" colspan="1">NA</td><td align="left" rowspan="1" colspan="1">100</td><td align="left" rowspan="1" colspan="1">100</td><td align="left" rowspan="1" colspan="1">4</td><td align="left" rowspan="1" colspan="1">NA</td></tr><tr><td align="left" rowspan="1" colspan="1">Array + dye</td><td align="left" rowspan="1" colspan="1">NA</td><td align="left" rowspan="1" colspan="1">NA</td><td align="left" rowspan="1" colspan="1">0.73</td><td align="left" rowspan="1" colspan="1">0.72</td><td align="left" rowspan="1" colspan="1">NA</td><td align="left" rowspan="1" colspan="1">NA</td><td align="left" rowspan="1" colspan="1">4</td><td align="left" rowspan="1" colspan="1">1</td></tr></tbody></table><table-wrap-foot><fn><p>Shown are the average estimated π<sub>0</sub> statistics and the KS-tests of Criterion I. The KS-tests were performed at the 0.05 level, so we expect 5 of 100 to be significant when Criterion I holds, and many &gt;5 to be significant when the criterion does not hold. We do not include results of testing for Criterion II because all methods passed this criterion in these simulations.</p></fn></table-wrap-foot></table-wrap>
</p>
      <sec id="SEC4.1.1">
        <title>4.1.1 Array effects</title>
        <p>The data were simulated according to the above protocol where only the biological group differences and intensity-dependent array effects were included. In terms of the SNM model: <bold>Y</bold> is a 100 000 × 12 matrix of probe intensities; <bold>X</bold> is a 1 × 12 matrix indicating Group 2 membership; <bold>Z</bold> is a 1 × 12 matrix of 1's parameterizing the intercept term; and <bold><italic>f</italic></bold>(<bold>BX</bold> + <bold>AZ</bold>) is a 100 000 × 12 matrix that represents the intensity-dependent array effects. Note that under this construction, we achieve that <bold>b</bold><sub><italic>i</italic></sub> = <bold>0</bold> is equivalent to no difference in mean probe intensities between Groups 1 and 2.</p>
        <p>We normalized data from each of the 100 simulations using SNM, QN and ISN. <xref ref-type="fig" rid="F2">Figure 2</xref> presents representative histograms of <italic>P</italic>-values of null probes after normalization using SNM (<xref ref-type="fig" rid="F2">Fig. 2</xref>A), QN (<xref ref-type="fig" rid="F2">Fig. 2</xref>C) and ISN (<xref ref-type="fig" rid="F2">Fig. 2</xref>E). In relation to Criterion I, we expect these <italic>P</italic>-values to be Uniform(0,1). While the SNM approach appears to meet this criterion, the null <italic>P</italic>-values from the unsupervised methods are clearly not Uniform(0,1). Of the 100 simulated studies, 1, 100 and 100 were significant for SNM, QN and ISN, respectively.</p>
        <p>We examined the estimated π<sub>0</sub> statistic for each simulation, which is the proportion of true null probes (Storey, <xref ref-type="bibr" rid="B12">2002</xref>; Storey and Tibshirani, <xref ref-type="bibr" rid="B13">2003</xref>). Recall that in this simulation the true π<sub>0</sub> = 70%. The 95% confidence intervals of <inline-formula><inline-graphic xlink:href="btq118i10.jpg"/></inline-formula> from the 100 simulations are 0.71 ± 0.04 for SNM, 0.54 ± 0.05 for QN and 0.55 ± 0.04 for ISN. The distributions of all <italic>P</italic>-values are presented in <xref ref-type="fig" rid="F2">Figure 2</xref>B, D and F for SNM, QN and ISN, respectively. These results suggest that including the study-specific biological variables provides unbiased inference, while the inference derived from unsupervised methods is biased by the asymmetric biological signal.</p>
        <p>We also performed a KS-test of Criterion II, specifically whether the alternative <italic>P</italic>-values have a joint distribution stochastically smaller than the Uniform(0,1) distribution. Among the 100 simulated studies, 0 tests were significant for SNM, QN and ISN. These results suggest that SNM, QN and ISN satisify Criterion II.</p>
        <p>Taken together, these results suggest that SNM satisifies Criteria I and II for a correctly normalized study in this scenario, while QN and ISN do not satisfy Criterion I. The bias of QN and ISN is anti-conservative, meaning that <italic>P</italic>-values have been spuriously made smaller than they should be.</p>
      </sec>
      <sec id="SEC4.1.2">
        <title>4.1.2 Array effects plus batch effects</title>
        <p>The simulated probe intensities for the second scenario included biological, array and batch effects as described above. Batch effects generally arise due to some need of the experimenter to manufacture or hybridize the arrays in groups; the real data example we consider below includes a batch effect. To apply SNM, we used the same model as in the previous simulation, except now <bold>Z</bold> is a 2 × 12 matrix parameterizing the probe-specific intercept terms in the first row and an indicator of batch in the second row.</p>
        <p>SNM was applied to normalize data from each of the 100 simulated studies. In the KS-test of Criterion I, 4 out of 100 were significant. The 95% confidence intervals for <inline-formula><inline-graphic xlink:href="btq118i11.jpg"/></inline-formula> was 0.72 ± 0.04. In the KS-test of Criterion II, 0 out of 100 were significant. Thus, it appears SNM again provides a valid normalization in this simulation scenario.</p>
        <p>Given that there is an extra study-specific variable, we applied QN and ISN in two ways. First, we ignored the batch variable throughout the analysis. In other words, after normalization, batch was not utilized as an adjustment variable when testing the probes for differential expression between Groups 1 and 2. Of the 100 simulated studies, all 100 were significant for the KS-test of Criterion I for both QN and ISN. The 95% confidence intervals for the <inline-formula><inline-graphic xlink:href="btq118i12.jpg"/></inline-formula> were 1 ± 0 for both QN and ISN.</p>
        <p><xref ref-type="fig" rid="F3">Figure 3</xref>B shows a plot of the null probe <italic>P</italic>-values when applying QN. (The analogous plot for ISN shows the same qualitative result and can be found in <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq118/DC1">Supplementary Fig. 1</ext-link>E.) It can be seen that the null <italic>P</italic>-values have been biased in a conservative fashion, pushed towards one. This is due to the fact that ignoring the batch variable induced systematic variation in the probe intensities that was not taken into account.
<fig id="F3" position="float"><label>Fig. 3.</label><caption><p>Summary of null <italic>P</italic>-values from simulated data with differential expression, batch and array effects. The true proportion of null probes is π<sub>0</sub> = 0.70. (<bold>A</bold>) <italic>P</italic>-value histogram of null probes after the SNM normalization. (<bold>B</bold>) <italic>P</italic>-value histogram of null probes after QN. (<bold>C</bold>) <italic>P</italic>-value histogram of null probes after QN using a model that includes a term for the batch effects.</p></caption><graphic xlink:href="btq118f3"/></fig></p>
        <p>We then applied QN and ISN in a second way, this time including batch as an adjustment variable in the test of differential expression after normalization. This would likely be the recommended way to include the batch variable when utilizing an unsupervised approach. Specifically, the unsupervised normalization is carried out ignoring the batch variable in addition to the biology variable, and then both are included in the analysis on the normalized data. Of the 100 simulated studies, all 100 were significant for the KS-test of Criterion I for both QN and ISN. The 95% confidence intervals for the <inline-formula><inline-graphic xlink:href="btq118i13.jpg"/></inline-formula> were 0.52 ± 0.03 for QN and 0.53 ± 0.04 for ISN. Among the 100 simulations, 0 were significant for the criterion II test for all three normalization methods.</p>
        <p><xref ref-type="fig" rid="F3">Figure 3</xref>C shows a plot of the null probe <italic>P</italic>-values when applying QN in this manner. (Again, the analogous plot for ISN shows the same qualitative result and can be found in <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq118/DC1">Supplementary Fig. 1</ext-link>F.) Now, the null <italic>P</italic>-values are anti-conservatively biased; they are pushed toward zero as in the previous scenario. This follows because the systematic variation due to batch has now been modeled at the inference stage, and the anti-conservative bias due to array effects has returned. Additionally, since now both the biology and batch variables were not utilized in the unsupervised normalization, the null <italic>P</italic>-value bias and fluctuation from study to study have become more unpredictable.</p>
      </sec>
      <sec id="SEC4.1.3">
        <title>4.1.3 Array effects plus dye effects</title>
        <p>The probe intensities for the third simulation scenario included biological effects, array effects and intensity-dependent dye effects as described above. Dye effects arise in experiments that use two-color microarrays because of different incorporation rates of the Cy3 and Cy5 fluorescent dyes. To apply SNM, all terms in the model were defined exactly as in the first scenario, except we now defined <bold><italic>f</italic></bold><sub>1</sub>(<bold>BX</bold> + <bold>AZ</bold>) to be a 100 000 × 12 matrix that represents the intensity-dependent array effects and <bold><italic>f</italic></bold><sub>2</sub>(<bold>BX</bold> + <bold>AZ</bold>) to be a 100 000 × 12 matrix that represents the intensity-dependent dye effects. The study-specific model for this case is, therefore, <bold>Y</bold> = <bold>BX</bold> + <bold>AZ</bold> + <bold><italic>f</italic></bold><sub>1</sub>(<bold>BX</bold> + <bold>AZ</bold>) + <bold><italic>f</italic></bold><sub>2</sub>(<bold>BX</bold> + <bold>AZ</bold>) + <bold>E</bold>.</p>
        <p>SNM and eCADS were used to normalize data from each of the 100 simulated studies. Of the 100 studies, 4 KS-tests were significant for Criterion I when applying SNM and 1 was significant when applying eCADS. The 95% confidence intervals for the <inline-formula><inline-graphic xlink:href="btq118i14.jpg"/></inline-formula> were 0.73 ± 0.03 for SNM and 0.72 ± 0.03 for eCADS. Among the 100 simulations for both SNM and QN, 0 were significant for the Criterion II test. These results show that SNM and eCADS behave similarly in this scenario, both providing acceptable normalizations. In fact, eCADS can be viewed as a special case of the more general SNM framework.</p>
      </sec>
    </sec>
    <sec id="SEC4.2">
      <title>4.2 Vascular development study</title>
      <p>A study was carried out designed to measure the association between gene expression levels and aging in the mouse aorta. Aorta were micro-dissected from mice aged 1, 7, 14 and 60 days, RNA was extracted, a single RNA pool was generated for each age, and each pool was hybridized to a single Affymetrix mouse430 version 2 microarray. This entire experiment was carried out twice, resulting in two technical batches.</p>
      <p>We first verified that there are intensity-dependent array effects and effect due to the two batches. To this end, we regressed age on the unnormalized data by for each probe, ignoring batch and intensity-depdendent effects. On the residuals resulting from this regression, we investigated the relationship across arrays using hierarchical clustering (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq118/DC1">Supplementary Fig. 2</ext-link>A). From this clustering, it can be seen that there is a strong batch effect in this study. Finally, the relationship between overall intensity and the array-specific residuals were plotted for each array (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq118/DC1">Supplementary Fig. 2</ext-link>B). This result shows that there exist non-linear trends between intensity and the remaining error. Taken together, these results suggest that batch and intensity-dependent array effects contribute to the variation of probe level measurements.</p>
      <p>Next, we applied SNM to the study. In relation to model (<xref ref-type="disp-formula" rid="M3">3</xref>), <bold>Y</bold> is a 450 000 × 8 vector of observed intensities, <bold>X</bold> parameterizes the different ages and <bold>Z</bold> represents the parameterized probe-specific intercepts and batch effects. The results when applying SNM are shown in <xref ref-type="fig" rid="F4">Figure 4</xref>. First, note that the histogram of <italic>P</italic>-values (<xref ref-type="fig" rid="F4">Fig. 4</xref>C) suggests that age has a pronounced effect on differential expression (<inline-formula><inline-graphic xlink:href="btq118i15.jpg"/></inline-formula> = 0.53). Many genes with known roles in vascular biology exhibited robust changes in expression across this time series, suggesting that the experiment-captured biological signal. For example, previous work identified a cluster of seven genes whose expression is activated soon after birth (List C Elastic Fiber Genes from McLean <italic>et al.</italic> <xref ref-type="bibr" rid="B10">2005</xref>). Moreover, the relationship across samples, as described by a clustering dendrogram, correctly places the replicate arrays for each age on adjacent nodes (<xref ref-type="fig" rid="F4">Fig. 4</xref>A).
<fig id="F4" position="float"><label>Fig. 4.</label><caption><p>Results from Vascular Development Study obtained from QN and SNM. The relationship between samples after normalization are presented as a clustering dendogram. The labels for each node denote the corresponding age of the sample hybridized to that array, and the colored boxes indicate the batch. Note that the SNM results correctly position biological replicate samples on adjacent nodes (<bold>A</bold>), and predicts a robust effect of age on gene expression [<inline-formula><inline-graphic xlink:href="btq118i16.jpg"/></inline-formula> = 0.51 (<bold>C</bold>)]. Conversely, the first bifurcation in the QN data separates the data by the batch (<bold>B</bold>) and these data suggest there is no effect of age on gene expression [<inline-formula><inline-graphic xlink:href="btq118i17.jpg"/></inline-formula> = 1 (<bold>D</bold>)].</p></caption><graphic xlink:href="btq118f4"/></fig></p>
      <p>We also investigated the results when these data are normalized with the two unsupervised normalization procedures considered above, ISN and QN. The histogram of resulting <italic>P</italic>-values from QN is shown in <xref ref-type="fig" rid="F4">Figure 4</xref>D. Results for the ISN method are nearly identical (as in the simulations) and are not shown here. Note that both approaches estimate <inline-formula><inline-graphic xlink:href="btq118i18.jpg"/></inline-formula>, suggesting that there are no genes differentially expressed between the four ages explored in this study. This result directly contradicts previously published data from a similar study (McLean <italic>et al.</italic>, <xref ref-type="bibr" rid="B10">2005</xref>) . Moreover, the clustering of the normalized data, shown in <xref ref-type="fig" rid="F4">Figure 4</xref>B, suggests that batch exhibits a stronger influence on the variation of the QN normalized data than does the biology. This analysis provides a real data example that supports the results from the data simulations explored earlier, and the results suggest that the SNM approach outperforms the unsupervised approaches in this example.</p>
    </sec>
  </sec>
  <sec sec-type="discussion" id="SEC5">
    <title>5 DISCUSSION</title>
    <p>In this article, we described a framework for the normalization of microarray data. The central premise of this work is that the study under investigation should inform the normalization process. The framework is intended to be general enough to address most microarray studies, regardless of platform or biological goal. The examples we explored were selected as they are commonly occurring in practice and clearly describe the effects on inference of ignoring relevant information from an analysis. We note that the study-specific models utilized in this paper will not satisfy all studies. Rather, we view this work as a general supervised normalization framework based on a well-defined goal, namely to remove the effects of adjustment variables without biasing inference, and the examples as a means to illustrate the benefit of this approach. A researcher would utilize this framework to build a study-specific model and then apply the proposed algorithm, which is quite general.</p>
    <p>The results presented in this paper demonstrate some of the problems associated with unsupervised normalization methods. For example, the simulations show how such approaches can introduce signal in the presence of asymmetric biological variation. Similarly, the simulations and vascular development example make clear that unsupervised approaches ignore effects of study design on expression data. Finally, these approaches make the assumption that few genes are differentially expressed, an assumption that is clearly false in many settings. These and other limitations of unsupervised methods are the motivation for this work.</p>
    <p>The framework is designed to handle a variety of study designs. We presented a modeling strategy that is designed to model relevant study-specific variables (e.g. probe-specific biological effects, probe-specific technical effects and intensity-dependent effects). The flexibility of our modeling strategy is demonstrated by the fact that it straightforwardly derives previously described supervised normalization models for more specialized experimental designs and technologies (Baird <italic>et al.</italic>, <xref ref-type="bibr" rid="B1">2004</xref>; Dabney and Storey, <xref ref-type="bibr" rid="B3">2007</xref>; Wolfinger <italic>et al.</italic>, <xref ref-type="bibr" rid="B16">2001</xref>). Another benefit is that other terms described in the literature can be included. We describe such a process for probe sequence effects in the <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq118/DC1">Supplementary Material</ext-link>. These and other benefits support the claim that we have presented a flexible set of models for the normalization and analysis of microarray data.</p>
    <p>Model building is paramount to successful implementation of any supervised normalization, including ours. Properly defining the model for a given study requires that relevant biological and study-specific adjustment variables of interest are known to the analyst, a situation that is rarely present in the clinical setting. The vascular development example shows one of many approaches to diagnose a model from a given dataset. In this work, we focused less on the difficulties associated with this approach; however, future work will address diagnosing models from the existing data.</p>
    <p>Given the potential difficulties associated with knowing the true model, we base our framework on a goal that can be used to understand the validity of a study-specific model. The idea to remove the effects of technical variables without biasing inference has its roots in ideas originally presented in Dabney and Storey (<xref ref-type="bibr" rid="B3">2007</xref>); Leek and Storey (<xref ref-type="bibr" rid="B7">2007</xref>, <xref ref-type="bibr" rid="B8">2008</xref>). To our knowledge, we are the first to explicitly state a goal for microarray data normalization. Three positive contributions of this goal are: (i) it unifies results from any particular instance of a study-specific model; (ii) basing a normalization algorithm on this goal clarifies its purpose and expected operating characteristics; and (iii) attaining this goal suggests that the experimenter understands all systematic sources of variation present in the data. This last point is important as it allows a user to understand when their assumed model accounts for variation from all relevant study-specific variables.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>[Supplementary Data]</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="btq118_index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="btq118_1.pdf"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>ACKNOWLEDGEMENTS</title>
    <p>We thank Dr Robert Mecham and Dr Sean McLean, Washington University School of Medicine, for providing the mouse vascular array data.</p>
    <p><italic>Funding</italic>: <funding-source>National Institutes of Health</funding-source> grants <award-id>T32 HG00035</award-id> and <award-id>T32 CA80416</award-id> (to B.H.M.); PNW Prostate SPORE CA097186 and R01 DK069690 (to P.S.N.); R01 HG002913 (J.D.S.).</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </ack>
  <ref-list>
    <title>REFERENCES</title>
    <ref id="B1">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baird</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Normalization of microarray data using a spatial mixed model analysis which includes splines</article-title>
        <source>Bioinformatics</source>
        <year>2004</year>
        <volume>20</volume>
        <fpage>3196</fpage>
        <pub-id pub-id-type="pmid">15231532</pub-id>
      </element-citation>
    </ref>
    <ref id="B2">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bolstad</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A comparison of normalization methods for high density oligonucleotide array data based on variance and bias</article-title>
        <source>Bioinformatics</source>
        <year>2003</year>
        <volume>19</volume>
        <fpage>185</fpage>
        <lpage>193</lpage>
        <pub-id pub-id-type="pmid">12538238</pub-id>
      </element-citation>
    </ref>
    <ref id="B3">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dabney</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Storey</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Normalization of two-channel microarrays accounting for experimental design and intensity-dependent relationships</article-title>
        <source>Genome Biol.</source>
        <year>2007</year>
        <volume>8</volume>
        <fpage>R44</fpage>
        <pub-id pub-id-type="pmid">17391524</pub-id>
      </element-citation>
    </ref>
    <ref id="B4">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dudoit</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Statistical methods for identifying differentially expressed genes in replicated cDNA microarray experiments</article-title>
        <source>Stat. Sin.</source>
        <year>2002</year>
        <volume>12</volume>
        <fpage>111</fpage>
        <lpage>140</lpage>
      </element-citation>
    </ref>
    <ref id="B5">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Irizarry</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Summaries of Affymetrix GeneChip probe level data</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2003</year>
        <volume>31</volume>
        <fpage>e15</fpage>
        <pub-id pub-id-type="pmid">12582260</pub-id>
      </element-citation>
    </ref>
    <ref id="B6">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Irizarry</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Feature-level exploration of a published Affymetrix GeneChip control dataset</article-title>
        <source>Genome Biol.</source>
        <year>2006</year>
        <volume>7</volume>
        <fpage>404</fpage>
        <pub-id pub-id-type="pmid">16953902</pub-id>
      </element-citation>
    </ref>
    <ref id="B7">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Leek</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Storey</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Capturing heterogeneity in gene expression studies by surrogate variable analysis</article-title>
        <source>PLoS Genet.</source>
        <year>2007</year>
        <volume>3</volume>
        <fpage>e161</fpage>
      </element-citation>
    </ref>
    <ref id="B8">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Leek</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Storey</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>A general framework for multiple testing dependence</article-title>
        <source>Proc. Natl Acad. Sci.</source>
        <year>2008</year>
        <volume>105</volume>
        <fpage>18718</fpage>
        <pub-id pub-id-type="pmid">19033188</pub-id>
      </element-citation>
    </ref>
    <ref id="B9">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Wong</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Model-based analysis of oligonucleotide arrays: model validation, design issues and standard error application</article-title>
        <source>Genome Biol.</source>
        <year>2001</year>
        <volume>2</volume>
        <fpage>0032</fpage>
        <lpage>1</lpage>
      </element-citation>
    </ref>
    <ref id="B10">
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>McLean</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <person-group person-group-type="editor">
          <name>
            <surname>Miner</surname>
            <given-names>Jeffrey H</given-names>
          </name>
        </person-group>
        <article-title>Extracellular matrix gene expression in the developing mouse aorta</article-title>
        <source>Extracellular Matrix in Development and Disease.</source>
        <year>2005</year>
        <volume>15</volume>
        <publisher-loc>San Diego, CA</publisher-loc>
        <publisher-name>Elsevier</publisher-name>
        <comment>of <italic>Advances in Developmental Biology</italic></comment>
      </element-citation>
    </ref>
    <ref id="B11">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rattray</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Propagating uncertainty in microarray data analysis</article-title>
        <source>Brief. Bioinformatics</source>
        <year>2006</year>
        <volume>7</volume>
        <fpage>37</fpage>
        <lpage>47</lpage>
        <pub-id pub-id-type="pmid">16761363</pub-id>
      </element-citation>
    </ref>
    <ref id="B12">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Storey</surname>
            <given-names>JD</given-names>
          </name>
        </person-group>
        <article-title>A direct approach to false discovery rates</article-title>
        <source>J. R. Stat. Soc. B</source>
        <year>2002</year>
        <volume>64</volume>
        <fpage>479</fpage>
        <lpage>498</lpage>
      </element-citation>
    </ref>
    <ref id="B13">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Storey</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Tibshirani</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Statistical significance for genome-wide studies</article-title>
        <source>Proc. Natl Acad. Sci.</source>
        <year>2003</year>
        <volume>100</volume>
        <fpage>9440</fpage>
        <lpage>9445</lpage>
        <pub-id pub-id-type="pmid">12883005</pub-id>
      </element-citation>
    </ref>
    <ref id="B14">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Storey</surname>
            <given-names>JD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Significance analysis of time course microarray experiments</article-title>
        <source>Proc. Natl Acad. Sci.</source>
        <year>2005</year>
        <volume>102</volume>
        <fpage>12837</fpage>
        <lpage>12842</lpage>
        <pub-id pub-id-type="pmid">16141318</pub-id>
      </element-citation>
    </ref>
    <ref id="B15">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tseng</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Issues in cDNA microarray analysis: quality filtering, channel normalization, models of variations and assessment of gene effects</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2001</year>
        <volume>29</volume>
        <fpage>2549</fpage>
        <pub-id pub-id-type="pmid">11410663</pub-id>
      </element-citation>
    </ref>
    <ref id="B16">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolfinger</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Assessing gene significance from cDNA microarray expression data via mixed models</article-title>
        <source>J. Comput. Biol.</source>
        <year>2001</year>
        <volume>8</volume>
        <fpage>625</fpage>
        <lpage>637</lpage>
        <pub-id pub-id-type="pmid">11747616</pub-id>
      </element-citation>
    </ref>
    <ref id="B17">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Irrizary</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>A statistical framework for the analysis of microarray probe-level data</article-title>
        <source>Ann. Appl. Stat.</source>
        <year>2007</year>
        <volume>1</volume>
        <fpage>333</fpage>
      </element-citation>
    </ref>
    <ref id="B18">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A model-based background adjustment for oligonucleotide expression arrays</article-title>
        <source>J. Am. Stat. Assoc.</source>
        <year>2004</year>
        <volume>99</volume>
        <fpage>909</fpage>
        <lpage>917</lpage>
      </element-citation>
    </ref>
    <ref id="B19">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yang</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Normalization for cDNA microarray data: a robust composite method addressing single and multiple slide systematic variation</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2002</year>
        <volume>30</volume>
        <fpage>e15</fpage>
        <pub-id pub-id-type="pmid">11842121</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
