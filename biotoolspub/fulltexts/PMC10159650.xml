<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10159650</article-id>
    <article-id pub-id-type="pmid">37042725</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btad190</article-id>
    <article-id pub-id-type="publisher-id">btad190</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>bootRanges: flexible generation of null sets of genomic ranges for hypothesis testing</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Mu</surname>
          <given-names>Wancen</given-names>
        </name>
        <aff><institution>Department of Biostatistics, University of North Carolina</institution>, Chapel Hill 27514, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-4051-3217</contrib-id>
        <name>
          <surname>Davis</surname>
          <given-names>Eric S</given-names>
        </name>
        <aff><institution>Curriculum in Bioinformatics and Computational Biology, University of North Carolina, Chapel Hill</institution> 27514, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lee</surname>
          <given-names>Stuart</given-names>
        </name>
        <aff><institution>Genentech, South San Francisco</institution>, Western California 94080, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Dozmorov</surname>
          <given-names>Mikhail G</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Virginia Commonwealth University</institution>, Richmond, VA 23284, <country country="US">United States</country></aff>
        <aff><institution>Department of Pathology, Virginia Commonwealth University</institution>, Richmond, VA 23284, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-2123-0051</contrib-id>
        <name>
          <surname>Phanstiel</surname>
          <given-names>Douglas H</given-names>
        </name>
        <aff><institution>Curriculum in Bioinformatics and Computational Biology, University of North Carolina, Chapel Hill</institution> 27514, <country country="US">United States</country></aff>
        <aff><institution>Thurston Arthritis Research Center, University of North Carolina</institution>, Chapel Hill 27514, <country country="US">United States</country></aff>
        <aff><institution>Department of Cell Biology and Physiology, University of North Carolina</institution>, Chapel Hill 27514, <country country="US">United States</country></aff>
        <aff><institution>Lineberger Comprehensive Cancer Center, University of North Carolina</institution>, Chapel Hill 27514, <country country="US">United States</country></aff>
        <aff><institution>Curriculum in Genetics and Molecular Biology, University of North Carolina</institution>, Chapel Hill 27514, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8401-0545</contrib-id>
        <name>
          <surname>Love</surname>
          <given-names>Michael I</given-names>
        </name>
        <aff><institution>Department of Biostatistics, University of North Carolina</institution>, Chapel Hill 27514, <country country="US">United States</country></aff>
        <aff><institution>Curriculum in Bioinformatics and Computational Biology, University of North Carolina, Chapel Hill</institution> 27514, <country country="US">United States</country></aff>
        <aff><institution>Lineberger Comprehensive Cancer Center, University of North Carolina</institution>, Chapel Hill 27514, <country country="US">United States</country></aff>
        <aff><institution>Department of Genetics, University of North Carolina</institution>, Chapel Hill 27514, <country country="US">United States</country></aff>
        <xref rid="btad190-cor1" ref-type="corresp"/>
        <!--michaelisaiahlove@gmail.com-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Marschall</surname>
          <given-names>Tobias</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btad190-cor1">Corresponding author. Department of Genetics, 120 Mason Farm Rd., Chapel Hill 27514, United States. E-mail: <email>michaelisaiahlove@gmail.com</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-04-12">
      <day>12</day>
      <month>4</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>12</day>
      <month>4</month>
      <year>2023</year>
    </pub-date>
    <volume>39</volume>
    <issue>5</issue>
    <elocation-id>btad190</elocation-id>
    <history>
      <date date-type="received">
        <day>20</day>
        <month>9</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>06</day>
        <month>1</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>28</day>
        <month>3</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>04</day>
        <month>5</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btad190.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Enrichment analysis is a widely utilized technique in genomic analysis that aims to determine if there is a statistically significant association between two sets of genomic features. To conduct this type of hypothesis testing, an appropriate null model is typically required. However, the null distribution that is commonly used can be overly simplistic and may result in inaccurate conclusions.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p><italic toggle="yes">bootRanges</italic> provides fast functions for generation of block bootstrapped genomic ranges representing the null hypothesis in enrichment analysis. As part of a modular workflow, <italic toggle="yes">bootRanges</italic> offers greater flexibility for computing various test statistics leveraging other Bioconductor packages. We show that shuffling or permutation schemes may result in overly narrow test statistic null distributions and over-estimation of statistical significance, while creating new range sets with a block bootstrap preserves local genomic correlation structure and generates more reliable null distributions. It can also be used in more complex analyses, such as accessing correlations between cis-regulatory elements (CREs) and genes across cell types or providing optimized thresholds, e.g. log fold change (logFC) from differential analysis.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p><italic toggle="yes">bootRanges</italic> is freely available in the R/Bioconductor package <italic toggle="yes">nullranges</italic> hosted at <ext-link xlink:href="https://bioconductor.org/packages/nullranges" ext-link-type="uri">https://bioconductor.org/packages/nullranges</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Chan Zuckerberg Initiative</institution>
            <institution-id institution-id-type="DOI">10.13039/100014989</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>NIH</institution>
            <institution-id institution-id-type="DOI">10.13039/100000002</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>R01-HG009937</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>In genomic analysis, to assess whether there is a significant positional association between two sets of genomic ranges, one must choose an appropriate null model (<xref rid="btad190-B5" ref-type="bibr">De et al. 2014</xref>; <xref rid="btad190-B8" ref-type="bibr">Kanduri et al. 2018</xref>). Here, we use the term “ranges” to denote a set of genomic features defined by sequence name (e.g. chromosome), starting basepair, ending basepair, and optionally strand and other metadata variables. For example, an enrichment of assay for transposase-accessible chromatin with sequencing (ATAC-seq) peaks near certain genes may indicate a regulatory relationship (<xref rid="btad190-B11" ref-type="bibr">Lee et al. 2020</xref>), and enrichment of genome-wide association study (GWAS) single nucleotide polymorphisms (SNPs) near tissue-specific ATAC-seq peaks may suggest mechanisms underlying the GWAS trait. Such analyses rely on specifying a null distribution, where one strategy is to uniformly shuffle one set of the genomic ranges in the genome, possibly considering a set of excluded regions where ranges should not be placed (<xref rid="btad190-B13" ref-type="bibr">Ogata et al. 2022</xref>). However, uniformly distributed null sets will not exhibit the clumping property common with genomic regions. Using an overly simplistic null distribution that doesn’t take into account local dependencies could result in misleading conclusions. More sophisticated methods exist, for example GAT, which allows for controlling confounding factors via segmentation (<xref rid="btad190-B7" ref-type="bibr">Heger et al. 2013</xref>), and regioneR, which implements a circular shift to preserve the clumping property (<xref rid="btad190-B6" ref-type="bibr">Gel et al. 2016</xref>). The block bootstrap (<xref rid="btad190-B14" ref-type="bibr">Politis et al. 1999</xref>) provides an alternative, where one instead generates random sets of ranges by sampling large blocks of ranges from the original set with replacement, as originally proposed for genomic data by <xref rid="btad190-B2" ref-type="bibr">Bickel et al. (2010)</xref> in Genome Structure Correlation (GSC). Using the block bootstrap is more computationally intensive than simple shuffling, and so GSC implements a strategy of swapping pairs of blocks to compute overlaps, while avoiding a genome-scale bootstrap.</p>
    <p>Here, we describe the <italic toggle="yes">bootRanges</italic> software, with efficient vectorized code for performing block bootstrap sampling of genomic ranges stored as <monospace>GRanges</monospace> objects in R/Bioconductor (<xref rid="btad190-B9" ref-type="bibr">Lawrence et al. 2013</xref>). <italic toggle="yes">bootRanges</italic> is part of a modular analysis workflow, where bootstrapped ranges can be analyzed at block or genome scale using tidy analysis with packages including <italic toggle="yes">plyranges</italic> (<xref rid="btad190-B10" ref-type="bibr">Lee et al. 2019</xref>), and <italic toggle="yes">tidybulk</italic> (<xref rid="btad190-B12" ref-type="bibr">Mangiola et al. 2021</xref>). We provide recommendations for genome segmentation and block length motivated by analysis of example datasets. We demonstrate how <italic toggle="yes">bootRanges</italic> can be incorporated into complex downstream analyses, including choosing the thresholds during enrichment analysis and single-cell multi-omics. <italic toggle="yes">bootRanges</italic> is distributed as part of the <italic toggle="yes">nullranges</italic> R/Bioconductor package. If directly controlling for nuisance covariates when building background sets is of interest, the sister function <italic toggle="yes">matchRanges</italic> (<xref rid="btad190-B4" ref-type="bibr">Davis et al. 2022</xref>) may be more appropriate, see the package documentation for an overview of <italic toggle="yes">bootRanges</italic> and <italic toggle="yes">matchRanges</italic>.</p>
  </sec>
  <sec>
    <title>2 Features</title>
    <p><italic toggle="yes">bootRanges</italic> offers a “segmented” block bootstrap: since the distribution of ranges in the genome exhibits multi-scale structure, we follow the logic of <xref rid="btad190-B2" ref-type="bibr">Bickel et al. (2010)</xref> and consider to perform block bootstrapping within <italic toggle="yes">segments</italic> of the genome, which are more homogeneous in their range density. A simple “unsegmented” block bootstrap is additionally implemented but the segmented version is generally recommended. We consider various genome segmentation procedures, segmenting on gene density, or pre-existing annotations, e.g. Giemsa bands or published segmentations. The genome segments define large (e.g. on the order of ∼1 Mb), relatively homogeneous segments from which to sample blocks (<xref rid="btad190-F1" ref-type="fig">Fig. 1A</xref>). Blocks are sampled across segments that are in the same segmentation <italic toggle="yes">state</italic> (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref> for details). The input for the workflow is range sets <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">x</mml:mi></mml:math></inline-formula> and <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">y</mml:mi></mml:math></inline-formula>, with optional metadata columns that can be used for computing a more complex test statistic than overlaps. Given a segmentation and block length <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, a <italic toggle="yes">BootRanges</italic> object is generated, which concatenates ranges across bootstrap iterations. This <italic toggle="yes">BootRanges</italic> object can be manipulated with <italic toggle="yes">plyranges</italic> to derive the bootstrap distribution of test statistics <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> and a bootstrap <italic toggle="yes">P</italic>-value: <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>R</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>R</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">I</mml:mi></mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mtext>obs</mml:mtext></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref rid="btad190-F1" ref-type="fig">Fig. 1B</xref>). The <italic toggle="yes">bootRanges</italic> algorithms are explained schematically in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1.6</xref>.</p>
    <fig position="float" id="btad190-F1">
      <label>Figure 1.</label>
      <caption>
        <p>Schematic overview of the segmented block bootstrap for assessing significance of an observed statistic. (A) In each bootstrap sample, new sets of ranges are created by resampling blocks of length <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, with replacement, from the original set <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">y</mml:mi></mml:math></inline-formula>. Color represents genome segmentation states, such that blocks may be sampled across chromosomes, from within the same segmentation state. (B) Workflow for testing association between ranges in <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">x</mml:mi></mml:math></inline-formula> and <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">y</mml:mi></mml:math></inline-formula>, e.g. counting the number of overlapping ranges. First, <italic toggle="yes">R</italic> bootstrap samples of <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">y</mml:mi></mml:math></inline-formula> are generated and stored as a <italic toggle="yes">BootRanges</italic> object. Then, the bootstrap distribution of test statistics (e.g. count of overlaps) between <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">x</mml:mi></mml:math></inline-formula> and <italic toggle="yes">BootRanges</italic> is computed. Finally, the observed overlap statistic between <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">x</mml:mi></mml:math></inline-formula> and <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">y</mml:mi></mml:math></inline-formula> is compared to the bootstrap distribution.</p>
      </caption>
      <graphic xlink:href="btad190f1" position="float"/>
    </fig>
  </sec>
  <sec>
    <title>3 Application</title>
    <sec>
      <title>3.1 Test for association between SNPs and peaks</title>
      <p>We first applied <italic toggle="yes">bootRanges</italic> to determine the significance of the overlap of liver ATAC-seq (<xref rid="btad190-B3" ref-type="bibr">Currin et al. 2021</xref>) with SNPs associated with total cholesterol, bootstrapping the SNPs to assess significance. While the observed overlap was significant across many combinations of various segmentation methods and <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> according to typical <italic toggle="yes">P</italic>-value cutoff, the variance of the bootstrap statistics distribution and the resulting <italic toggle="yes">z</italic> score varied across segmentation choice, though varying more across block length (<xref rid="btad190-F2" ref-type="fig">Fig. 2A and B</xref>). The effect of segmentation may be stronger in other contexts. We used the <italic toggle="yes">z</italic> score to measure the distance between the observed statistics and bootstrap distribution in terms of standard deviations. Overlap rate was defined as the proportion of SNPs that had peaks within 10 kb. That the variance of the overlap rate in <xref rid="btad190-F2" ref-type="fig">Fig. 2A</xref> for the unsegmented bootstrap was larger than for the segmented cases and increased with <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> indicated that the density of ranges varies along the genome and that bootstrapping with respect to a genome segmentation may be a more appropriate choice (<xref rid="btad190-B2" ref-type="bibr">Bickel et al. 2010</xref>). The decreasing trend using pre-defined segmentation from Roadmap Epigenomics indicated too many short segments, where <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is too close to <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> for effective block randomization. To chose an optimal segmentation, we noted those for which the variance of the bootstrap distribution becomes stable as <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> increases (<xref rid="btad190-F2" ref-type="fig">Fig. 2A</xref>). To choose an optimal <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> range, two aspects were considered: (i) we sought a minimum value of a scaled version of the change in the variance of bootstrap statistics distribution across <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, as recommended previously (<xref rid="btad190-B2" ref-type="bibr">Bickel et al. 2010</xref>), and (ii) we assessed whether the distribution of inter-range distances was preserved, when comparing to the original ranges (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1.5</xref>). Here, <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub><mml:mo>≈</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> Mb and <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>300</mml:mn><mml:mtext>kb</mml:mtext><mml:mo>,</mml:mo><mml:mn>600</mml:mn><mml:mtext>kb</mml:mtext><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> was shown to be a good range for segment and block lengths (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S2A–C</xref>, and <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2.2</xref>). The scientific conclusion of this example was that liver ATAC-seq peaks were much closer to total cholesterol SNPs than expected even when placing blocks of SNPs to match a genome segmentation. Shuffling of genomic ranges (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1.3</xref>) resulted in a much higher <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:mi>z</mml:mi><mml:mo>=</mml:mo><mml:mn>18.5</mml:mn></mml:mrow></mml:math></inline-formula>, compared to <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mrow><mml:mi>z</mml:mi><mml:mo>≈</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math></inline-formula> consistent with previous conclusions that shuffling may overestimate significance leading to misinterpretation of enrichment.</p>
      <fig position="float" id="btad190-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Parameter selection and overlap analysis. (A) Variance of the rate of overlaps and (B) <italic toggle="yes">z</italic> score for the overlap, for different segmentations and <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> on the liver dataset. (C) GAM predicted curves for observed (black line) and bootstrapped data (densities), for the overlap count over gene logFC. Conditional densities are colored by the <italic toggle="yes">z</italic> score for the overlap.</p>
        </caption>
        <graphic xlink:href="btad190f2" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.2 Choosing thresholds for enrichment analysis</title>
      <p>We demonstrated using <italic toggle="yes">bootRanges</italic> to motivate the choice of data-driven thresholds during enrichment analyses. We tested this on a dataset of differential chromatin accessibility and gene expression (<xref rid="btad190-B1" ref-type="bibr">Alasoo et al. 2018</xref>; <xref rid="btad190-B11" ref-type="bibr">Lee et al. 2020</xref>) and the liver ATAC-seq. A generalized linear model with penalized splines was fit to the overlap count over gene logFC, both for the original data and to each of the generated null sets. Conditional densities of splines fit to null sets were computed at various thresholds to reveal how the threshold choice would affect the variance of the bootstrap density and the resulting <italic toggle="yes">z</italic> score (<xref rid="btad190-F2" ref-type="fig">Fig. 2C</xref>). The observed enrichment with respect to bootstrapped ranges varies over the logFC threshold. Instead of picking an arbitrary logFC cutoff, these analyses suggested that SNPs with -log10 (<italic toggle="yes">P</italic>-value) &gt; 8 and genes with <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mtext>logFC</mml:mtext><mml:mo>|</mml:mo><mml:mo>&gt;</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> were sets where the <italic toggle="yes">z</italic> score reflected strong separation of the observed statistic from the bootstrap statistic distribution (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S3</xref>).</p>
    </sec>
    <sec>
      <title>3.3 Identification of gene-promoter pairs by single-cell multi-omics</title>
      <p>We applied <italic toggle="yes">bootRanges</italic> to single cell multiome ATAC-seq and RNA-seq, to assess the correlation (<inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mo>ρ</mml:mo></mml:math></inline-formula>) of log counts for the two modalities for all pairs of genes and peaks, across 14 cell types (pseudo-bulk). Across all genes, we observed <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mn>0.33</mml:mn></mml:mrow></mml:math></inline-formula>, which was significantly higher than the bootstrap correlation mean (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S4A</xref>, <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>R</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0.007</mml:mn></mml:mrow></mml:math></inline-formula>). As expected, RNA and ATAC measured at local peaks had similar cell-type-specificity. Additionally, the average gene-peaks correlation per gene can be computed and compared to a bootstrap distribution to identify gene-promoter pairs that were significantly correlated across cell types (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S4B</xref> and <xref rid="sup1" ref-type="supplementary-material">C</xref>).</p>
    </sec>
    <sec>
      <title>3.4 Simulation and timing</title>
      <p>To assess the accuracy of the bootstrap distribution in capturing the true null distribution, we generated a simulation in which there was no true association between <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">x</mml:mi></mml:math></inline-formula> and <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">y</mml:mi></mml:math></inline-formula>. We compared the bootstrap distribution using <italic toggle="yes">bootRanges</italic> with that using shuffling. Details are provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2.1</xref>. Given that there is no true association, we would expect false positive rate (FPR) <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:mo>≈</mml:mo><mml:mo>α</mml:mo></mml:mrow></mml:math></inline-formula>, the threshold for significance, if the randomization method was successfully approximating the data generating distribution for <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">y</mml:mi></mml:math></inline-formula>. We found that <italic toggle="yes">bootRanges</italic> could achieve an FPR near <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mo>α</mml:mo></mml:math></inline-formula>. Shuffling however generated a distribution of statistics with similar mean as the original distribution, but with much lower variance. Therefore, the FPR for shuffling in this simulation was relatively high and would lead to overestimation of the significance of the overlap (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>).</p>
      <p>To compare speed, we ran <italic toggle="yes">bootRanges</italic> and GSC on ENCODE kidney and bladder ChIP-seq. The average time to block bootstrap the genome using <italic toggle="yes">bootRanges</italic> was 0.30 s and 0.37 s with overlap computation. A comparable analysis with GSC took 7.56 s.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Conclusion</title>
    <p><italic toggle="yes">bootRanges</italic> efficiently generates null models of genomic ranges preserving local genomic correlations, and can be used easily in combination with other range-based tools such as <italic toggle="yes">plyranges</italic>. Its versatility allows for the exploration of various hypotheses related to any type of feature in genomic analysis, including investigating gene regulation that is specific to certain cell types.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btad190_Supplementary_Data</label>
      <media xlink:href="btad190_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p><italic toggle="yes">bootRanges</italic> is distributed in the <italic toggle="yes">nullranges</italic> R/Bioconductor package, while all of the R scripts and data used in this article are available at the following GitHub repository: <ext-link xlink:href="https://github.com/Wancen/bootRangespaper" ext-link-type="uri">https://github.com/Wancen/bootRangespaper</ext-link>.</p>
  </sec>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> is available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the Chan Zuckerberg Initiative (CZI) [Essential Open Source Software for Science (EOSS) award to M.I.L.], by NIH NHGRI [R01-HG009937 to M.I.L.], and by NIH NIGMS [R35-GM128645 to D.H.P.].</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btad190-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Alasoo</surname><given-names>K</given-names></string-name>, <string-name><surname>Rodrigues</surname><given-names>J</given-names></string-name>, <string-name><surname>Mukhopadhyay</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal>; <collab>HIPSCI Consortium</collab>. <article-title>Shared genetic effects on chromatin and gene expression indicate a role for enhancer priming in immune response</article-title>. <source>Nat Genet</source><year>2018</year>;<volume>50</volume>:<fpage>424</fpage>–<lpage>31</lpage>.<pub-id pub-id-type="pmid">29379200</pub-id></mixed-citation>
    </ref>
    <ref id="btad190-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bickel</surname><given-names>PJ</given-names></string-name>, <string-name><surname>Boley</surname><given-names>N</given-names></string-name>, <string-name><surname>Brown</surname><given-names>JB</given-names></string-name></person-group><etal>et al</etal><article-title>Subsampling methods for genomic inference</article-title>. <source>Ann Appl Stat</source><year>2010</year>;<volume>4</volume>:<fpage>1660</fpage>–<lpage>1697</lpage>.</mixed-citation>
    </ref>
    <ref id="btad190-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Currin</surname><given-names>KW</given-names></string-name>, <string-name><surname>Erdos</surname><given-names>MR</given-names></string-name>, <string-name><surname>Narisu</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal>; <collab>NISC Comparative Sequencing Program</collab>. <article-title>Genetic effects on liver chromatin accessibility identify disease regulatory variants</article-title>. <source>Am J Hum Genet</source><year>2021</year>;<volume>108</volume>:<fpage>1169</fpage>–<lpage>89</lpage>.<pub-id pub-id-type="pmid">34038741</pub-id></mixed-citation>
    </ref>
    <ref id="btad190-B4">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Davis</surname><given-names>ES</given-names></string-name></person-group>, Mu W, Lee S, <etal>et al</etal> matchRanges: Generating null hypothesis genomic ranges via covariate-matched sampling. <italic toggle="yes">bioRxiv</italic><year>2022</year>. <ext-link xlink:href="https://10.1101/2022.08.05.502985" ext-link-type="uri">https://10.1101/2022.08.05.502985</ext-link>.</mixed-citation>
    </ref>
    <ref id="btad190-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>De</surname><given-names>S</given-names></string-name>, <string-name><surname>Pedersen</surname><given-names>BS</given-names></string-name>, <string-name><surname>Kechris</surname><given-names>K</given-names></string-name></person-group><etal>et al</etal><article-title>The dilemma of choosing the ideal permutation strategy while estimating statistical significance of genome-wide enrichment</article-title>. <source>Brief Bioinform</source><year>2014</year>;<volume>15</volume>:<fpage>919</fpage>–<lpage>28</lpage>.<pub-id pub-id-type="pmid">23956260</pub-id></mixed-citation>
    </ref>
    <ref id="btad190-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gel</surname><given-names>B</given-names></string-name>, <string-name><surname>Díez-Villanueva</surname><given-names>A</given-names></string-name>, <string-name><surname>Serra</surname><given-names>E</given-names></string-name></person-group><etal>et al</etal><article-title>regioneR: an R/bioconductor package for the association analysis of genomic regions based on permutation tests</article-title>. <source>Bioinformatics</source><year>2016</year>;<volume>32</volume>:<fpage>289</fpage>–<lpage>91</lpage>.<pub-id pub-id-type="pmid">26424858</pub-id></mixed-citation>
    </ref>
    <ref id="btad190-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Heger</surname><given-names>A</given-names></string-name>, <string-name><surname>Webber</surname><given-names>C</given-names></string-name>, <string-name><surname>Goodson</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>GAT: a simulation framework for testing the association of genomic intervals</article-title>. <source>Bioinformatics</source><year>2013</year>;<volume>29</volume>:<fpage>2046</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">23782611</pub-id></mixed-citation>
    </ref>
    <ref id="btad190-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kanduri</surname><given-names>C</given-names></string-name>, <string-name><surname>Bock</surname><given-names>C</given-names></string-name>, <string-name><surname>Gundersen</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>Colocalization analyses of genomic elements: approaches, recommendations and challenges</article-title>. <source>Bioinformatics</source><year>2018</year>;<volume>35</volume>:<fpage>1615</fpage>–<lpage>24</lpage>.</mixed-citation>
    </ref>
    <ref id="btad190-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lawrence</surname><given-names>M</given-names></string-name>, <string-name><surname>Huber</surname><given-names>W</given-names></string-name>, <string-name><surname>Pagès</surname><given-names>H</given-names></string-name></person-group><etal>et al</etal><article-title>Software for computing and annotating genomic ranges</article-title>. <source>PLoS Comput Biol</source><year>2013</year>;<volume>9</volume>:<fpage>e1003118</fpage>.<pub-id pub-id-type="pmid">23950696</pub-id></mixed-citation>
    </ref>
    <ref id="btad190-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>S</given-names></string-name>, <string-name><surname>Cook</surname><given-names>D</given-names></string-name>, <string-name><surname>Lawrence</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>Plyranges: a grammar of genomic data transformation</article-title>. <source>Genome Biol</source><year>2019</year>;<volume>20</volume>:<fpage>1</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">30606230</pub-id></mixed-citation>
    </ref>
    <ref id="btad190-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>S</given-names></string-name>, <string-name><surname>Lawrence</surname><given-names>M</given-names></string-name>, <string-name><surname>Love</surname><given-names>MI</given-names></string-name></person-group><etal>et al</etal><article-title>Fluent genomics with plyranges and tximeta</article-title>. <source>F1000Res</source><year>2020</year>;<volume>9</volume>:<fpage>109</fpage>.<pub-id pub-id-type="pmid">32528659</pub-id></mixed-citation>
    </ref>
    <ref id="btad190-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mangiola</surname><given-names>S</given-names></string-name>, <string-name><surname>Molania</surname><given-names>R</given-names></string-name>, <string-name><surname>Dong</surname><given-names>R</given-names></string-name></person-group><etal>et al</etal><article-title>Tidybulk: an r tidy framework for modular transcriptomic data analysis</article-title>. <source>Genome Biol</source><year>2021</year>;<volume>22</volume>:<fpage>1</fpage>–<lpage>15</lpage>.<pub-id pub-id-type="pmid">33397451</pub-id></mixed-citation>
    </ref>
    <ref id="btad190-B13">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Ogata</surname><given-names>JD</given-names></string-name></person-group><etal>Mu W, Davis ES, et al.</etal> excluderanges: exclusion sets for t2t-chm13, grcm39, and other genome assemblies. <italic toggle="yes">bioRxiv</italic><year>2022</year>. <pub-id pub-id-type="doi">10.1101/2022.11.21.517407</pub-id>.</mixed-citation>
    </ref>
    <ref id="btad190-B14">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Politis</surname><given-names>DN</given-names></string-name></person-group>, Romano JP, Wolf M . <source>Subsampling</source>. <publisher-name>Springer Science &amp; Business Media</publisher-name>, <year>1999</year>. New York. ISBN 978-0-387-98854-2.</mixed-citation>
    </ref>
  </ref-list>
</back>
