<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6852764</article-id>
    <article-id pub-id-type="publisher-id">3167</article-id>
    <article-id pub-id-type="doi">10.1186/s12859-019-3167-9</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SCOPIT: sample size calculations for single-cell sequencing experiments</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Davis</surname>
          <given-names>Alexander</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gao</surname>
          <given-names>Ruli</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Navin</surname>
          <given-names>Nicholas E.</given-names>
        </name>
        <address>
          <email>nnavin@mdanderson.org</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2291 4776</institution-id><institution-id institution-id-type="GRID">grid.240145.6</institution-id><institution>Department of Genetics, </institution><institution>The University of Texas MD Anderson Cancer Center, </institution></institution-wrap>Houston, TX USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2291 4776</institution-id><institution-id institution-id-type="GRID">grid.240145.6</institution-id><institution>The University of Texas MD Anderson Cancer Center UTHealth Graduate School of Biomedical Sciences, </institution></institution-wrap>Houston, TX USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2291 4776</institution-id><institution-id institution-id-type="GRID">grid.240145.6</institution-id><institution>Department of Bioinformatics and Computational Biology, </institution><institution>The University of Texas MD Anderson Cancer Center, </institution></institution-wrap>Houston, TX USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>12</day>
      <month>11</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>12</day>
      <month>11</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2019</year>
    </pub-date>
    <volume>20</volume>
    <elocation-id>566</elocation-id>
    <history>
      <date date-type="received">
        <day>20</day>
        <month>2</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>21</day>
        <month>10</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s). 2019</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold> This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">In single cell DNA and RNA sequencing experiments, the number of cells to sequence must be decided before running an experiment, and afterwards, it is necessary to decide whether sufficient cells were sampled. These questions can be addressed by calculating the probability of sampling at least a defined number of cells from each subpopulation (cell type or cancer clone).</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">We developed an interactive web application called SCOPIT (Single-Cell One-sided Probability Interactive Tool), which calculates the required probabilities using a multinomial distribution (<ext-link ext-link-type="uri" xlink:href="http://www.navinlab.com/SCOPIT">www.navinlab.com/SCOPIT</ext-link>). In addition, we created an R package called pmultinom for scripting these calculations.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3">Our tool for fast multinomial calculations provide a simple and intuitive procedure for prospectively planning single-cell experiments or retrospectively evaluating if sufficient numbers of cells have been sequenced. The web application can be accessed at <ext-link ext-link-type="uri" xlink:href="http://navinlab.com/SCOPIT">navinlab.com/SCOPIT</ext-link>.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Single cell sequencing</kwd>
      <kwd>Sample size</kwd>
      <kwd>Multinomial distributions</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000048</institution-id>
            <institution>American Cancer Society</institution>
          </institution-wrap>
        </funding-source>
        <award-id>129098-RSG-16-092-01-TBG</award-id>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>CPRIT</institution>
        </funding-source>
        <award-id>RP180684</award-id>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Susan G. Komen ()</institution>
        </funding-source>
        <award-id>PDF17487910</award-id>
        <principal-award-recipient>
          <name>
            <surname>Gao</surname>
            <given-names>Ruli</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>American Association for Cancer Research ()</institution>
        </funding-source>
        <award-id>174042GAO</award-id>
        <principal-award-recipient>
          <name>
            <surname>Gao</surname>
            <given-names>Ruli</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. National Library of Medicine ()</institution>
        </funding-source>
        <award-id>4T15LM007093-25</award-id>
        <principal-award-recipient>
          <name>
            <surname>Davis</surname>
            <given-names>Alexander</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000054</institution-id>
            <institution>National Cancer Institute</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01CA240526</award-id>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Chan-Zuckerberg Initiative</institution>
        </funding-source>
        <award-id>MCA3-0000000147</award-id>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2019</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par5">Biological tissues consist of a heterogeneous mixture of cells, including a variety of cell types in normal tissue or subclones in tumor tissue. This heterogeneity can be resolved using single-cell DNA or RNA sequencing methods [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR2">2</xref>]. Single-cell sequencing studies require sufficiently many cells to be sampled so that normal cell types or cancer subclones of interest (both hereafter referred to as “subpopulations”) are represented in the sample. In most studies, however, the total number of cells is determined arbitrarily by the limits of an instrumentation run, or by budget constraints, which may result in the sampling of too few or too many cells. Here, we have developed an interactive web tool, called SCOPIT (Single-Cell One-sided Probability Interactive Tool), which provides assistance for planning experiments, using calculations from a multinomial distribution.</p>
  </sec>
  <sec id="Sec2">
    <title>Implementation</title>
    <p id="Par6">The first fact used for calculating multinomial probabilities is the well-known equivalence between the probability mass function of a multinomial distribution and conditional probabilities of a Poisson distribution. This equivalence was first noted, to our knowledge, by Fisher [<xref ref-type="bibr" rid="CR3">3</xref>].</p>
    <p id="Par7">
      <bold>Theorem 1</bold>
      <italic>Assume that</italic>
      <disp-formula id="Equa">
        <alternatives>
          <tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ N\sim \mathrm{Multinomial}\left(p,n\right) $$\end{document}</tex-math>
          <mml:math id="M2" display="block">
            <mml:mi>N</mml:mi>
            <mml:mo>∼</mml:mo>
            <mml:mtext>Multinomial</mml:mtext>
            <mml:mfenced close=")" open="(" separators=",">
              <mml:mi>p</mml:mi>
              <mml:mi>n</mml:mi>
            </mml:mfenced>
          </mml:math>
          <graphic xlink:href="12859_2019_3167_Article_Equa.gif" position="anchor"/>
        </alternatives>
      </disp-formula>
    </p>
    <p id="Par8">
      <italic>where N and p are length k vectors, and</italic>
      <inline-formula id="IEq1">
        <alternatives>
          <tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \sum \limits_{i=1}^k{p}_i=1 $$\end{document}</tex-math>
          <mml:math id="M4" display="inline">
            <mml:munderover>
              <mml:mo>∑</mml:mo>
              <mml:mrow>
                <mml:mi>i</mml:mi>
                <mml:mo>=</mml:mo>
                <mml:mn>1</mml:mn>
              </mml:mrow>
              <mml:mi>k</mml:mi>
            </mml:munderover>
            <mml:msub>
              <mml:mi>p</mml:mi>
              <mml:mi>i</mml:mi>
            </mml:msub>
            <mml:mo>=</mml:mo>
            <mml:mn>1</mml:mn>
          </mml:math>
          <inline-graphic xlink:href="12859_2019_3167_Article_IEq1.gif"/>
        </alternatives>
      </inline-formula>
      <italic>. Also assume that</italic>
      <disp-formula id="Equb">
        <alternatives>
          <tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {X}_i\sim \mathrm{Poisson}\left({\lambda}_i\right) $$\end{document}</tex-math>
          <mml:math id="M6" display="block">
            <mml:msub>
              <mml:mi>X</mml:mi>
              <mml:mi>i</mml:mi>
            </mml:msub>
            <mml:mo>∼</mml:mo>
            <mml:mtext>Poisson</mml:mtext>
            <mml:mfenced close=")" open="(">
              <mml:msub>
                <mml:mi>λ</mml:mi>
                <mml:mi>i</mml:mi>
              </mml:msub>
            </mml:mfenced>
          </mml:math>
          <graphic xlink:href="12859_2019_3167_Article_Equb.gif" position="anchor"/>
        </alternatives>
      </disp-formula>
    </p>
    <p id="Par9"><italic>for i</italic> = 1 <italic>to k, where λ</italic><sub><italic>i</italic></sub> = <italic>αp</italic><sub><italic>i</italic></sub><italic>for some α. Furthermore, assume that X</italic><sub>1</sub>…<italic>X</italic><sub><italic>k</italic></sub><italic>are independent. Then for any event E,</italic><disp-formula id="Equc"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ P\left(N\in E\right)=P\left(X\in E\left|\sum \limits_{i=1}^k{X}_i=n\right.\right) $$\end{document}</tex-math><mml:math id="M8" display="block"><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>N</mml:mi><mml:mo>∈</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>X</mml:mi><mml:mo>∈</mml:mo><mml:mi>E</mml:mi><mml:mfenced close="" open="|"><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="12859_2019_3167_Article_Equc.gif" position="anchor"/></alternatives></disp-formula></p>
    <p id="Par10">The second fact is a relationship between conditional Poisson probabilities, and an expression involving the sum of truncated Poisson random variables. The following is a slight variant of a theorem due to Levin [<xref ref-type="bibr" rid="CR4">4</xref>].</p>
    <p id="Par11">
      <bold>Theorem 2</bold>
      <italic>Let</italic>
      <inline-formula id="IEq2">
        <alternatives>
          <tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {X}_i^{\left({a}_i,{b}_i\right)} $$\end{document}</tex-math>
          <mml:math id="M10" display="inline">
            <mml:msubsup>
              <mml:mi>X</mml:mi>
              <mml:mi>i</mml:mi>
              <mml:mfenced close=")" open="(" separators=",">
                <mml:msub>
                  <mml:mi>a</mml:mi>
                  <mml:mi>i</mml:mi>
                </mml:msub>
                <mml:msub>
                  <mml:mi>b</mml:mi>
                  <mml:mi>i</mml:mi>
                </mml:msub>
              </mml:mfenced>
            </mml:msubsup>
          </mml:math>
          <inline-graphic xlink:href="12859_2019_3167_Article_IEq2.gif"/>
        </alternatives>
      </inline-formula>
      <italic>be a truncated Poisson random variable, with probability mass function</italic>
      <disp-formula id="Equd">
        <alternatives>
          <tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ P\left({X}_i^{\left({a}_i,{b}_i\right)}=x\right)=P\left({X}_i=x|{a}_i&lt;{X}_i\le {b}_i\right) $$\end{document}</tex-math>
          <mml:math id="M12" display="block">
            <mml:mi>P</mml:mi>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:msubsup>
                <mml:mrow>
                  <mml:mi>X</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mrow>
                        <mml:mi>a</mml:mi>
                      </mml:mrow>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>,</mml:mo>
                    <mml:msub>
                      <mml:mrow>
                        <mml:mi>b</mml:mi>
                      </mml:mrow>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:msubsup>
              <mml:mo>=</mml:mo>
              <mml:mi>x</mml:mi>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mi>P</mml:mi>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>X</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:mo>=</mml:mo>
              <mml:mi>x</mml:mi>
              <mml:mrow>
                <mml:mo stretchy="false">|</mml:mo>
              </mml:mrow>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>a</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:mo>&lt;</mml:mo>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>X</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:mo>≤</mml:mo>
              <mml:msub>
                <mml:mrow>
                  <mml:mi>b</mml:mi>
                </mml:mrow>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:math>
          <graphic xlink:href="12859_2019_3167_Article_Equd.gif" position="anchor"/>
        </alternatives>
      </disp-formula>
    </p>
    <p id="Par12"><italic>where X</italic><sub><italic>i</italic></sub><italic>is a Poisson random variable with rate λ</italic><sub><italic>i</italic></sub><italic>. For vectors a and b, let X</italic><sup>(<italic>a</italic>, <italic>b</italic>)</sup><italic>be the vector containing all of these truncated Poisson random variables. Let E be the set of vectors x such that a</italic><sub><italic>i</italic></sub> &lt; <italic>x</italic><sub><italic>i</italic></sub> ≤ <italic>b</italic><sub><italic>i</italic></sub>. <italic>Then,</italic><disp-formula id="Eque"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ P\left(X\in E\left|\sum \limits_{i=1}^k{X}_i=n\right.\right)=\prod \limits_{i=1}^kP\left({a}_i&lt;{X}_i\le {b}_i\right)\frac{P\left(\sum \limits_{i=1}^k{X}_i^{\left({a}_i,{b}_i\right)}=n\right)}{P\left(\sum \limits_{i=1}^k{X}_i=n\right)} $$\end{document}</tex-math><mml:math id="M14" display="block"><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>X</mml:mi><mml:mo>∈</mml:mo><mml:mi>E</mml:mi><mml:mfenced close="" open="|"><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced></mml:msubsup><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="12859_2019_3167_Article_Eque.gif" position="anchor"/></alternatives></disp-formula></p>
    <p id="Par13"><bold>Proof:</bold> By Bayes’ theorem,
<disp-formula id="Equf"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ P\left(X\in E\left|\sum \limits_{i=1}^k{X}_i=n\right.\right)=P\left(X\in E\right)\frac{P\left(\left.\sum \limits_{i=1}^k{X}_i=n\right|X\in E\right)}{P\left(\sum \limits_{i=1}^k{X}_i=n\right)} $$\end{document}</tex-math><mml:math id="M16" display="block"><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>X</mml:mi><mml:mo>∈</mml:mo><mml:mi>E</mml:mi><mml:mfenced close="" open="|"><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>X</mml:mi><mml:mo>∈</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:mfenced><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfenced close="|" open=""><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced><mml:mi>X</mml:mi><mml:mo>∈</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="12859_2019_3167_Article_Equf.gif" position="anchor"/></alternatives></disp-formula></p>
    <p id="Par14">Substituting <inline-formula id="IEq3"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ P\left(\sum \limits_{i=1}^k{X}_i^{\left({a}_i,{b}_i\right)}=n\right) $$\end{document}</tex-math><mml:math id="M18" display="inline"><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced></mml:msubsup><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="12859_2019_3167_Article_IEq3.gif"/></alternatives></inline-formula> for <inline-formula id="IEq4"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ P\left(\left.\sum \limits_{i=1}^k{X}_i=n\right|X\in E\right) $$\end{document}</tex-math><mml:math id="M20" display="inline"><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfenced close="|" open=""><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced><mml:mi>X</mml:mi><mml:mo>∈</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="12859_2019_3167_Article_IEq4.gif"/></alternatives></inline-formula> and <inline-formula id="IEq5"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \prod \limits_{i=1}^kP\left({a}_i&lt;{X}_i\le {b}_i\right) $$\end{document}</tex-math><mml:math id="M22" display="inline"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="12859_2019_3167_Article_IEq5.gif"/></alternatives></inline-formula> for <italic>P</italic>(<italic>X</italic> ∈ <italic>E</italic>) yields the theorem. □</p>
    <p id="Par15">This theorem enables a fast calculation of the multinomial probability. The rate-limiting step is calculation of the probability distribution of <inline-formula id="IEq6"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \sum \limits_{i=1}^k{X}_i^{\left({a}_i,{b}_i\right)} $$\end{document}</tex-math><mml:math id="M24" display="inline"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2019_3167_Article_IEq6.gif"/></alternatives></inline-formula>. Levin [<xref ref-type="bibr" rid="CR4">4</xref>] provided two suggestions for computing this probability distribution: the first by convolution of the distributions of each <inline-formula id="IEq7"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {X}_i^{\left({a}_i,{b}_i\right)} $$\end{document}</tex-math><mml:math id="M26" display="inline"><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2019_3167_Article_IEq7.gif"/></alternatives></inline-formula>, and the second using an Edgeworth expansion of the probability distribution of <inline-formula id="IEq8"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \sum \limits_{i=1}^k{X}_i^{\left({a}_i,{b}_i\right)} $$\end{document}</tex-math><mml:math id="M28" display="inline"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2019_3167_Article_IEq8.gif"/></alternatives></inline-formula>. We implemented both suggestions, which are used for different values of <italic>n</italic>. For small values of <italic>n</italic>, convolution is performed, using The Fastest Fourier Transform In The West algorithm [<xref ref-type="bibr" rid="CR5">5</xref>]. For large values of <italic>n</italic>, an Edgeworth expansion is used. However, whereas Levin [<xref ref-type="bibr" rid="CR4">4</xref>] used the first four terms in the expansion, we continue adding terms until the last term added is sufficiently small.</p>
    <p id="Par16">SCOPIT also computes Bayesian posterior probability distributions for the multinomial probabilities. The multinomial probabilities described above are a function of the population frequencies. When the true population frequencies are not known, but observed frequencies from a previous experiment are available, SCOPIT computes a posterior distribution for the frequencies. The prior used for the frequencies is Dirichlet(0, …, 0), following Jaynes [<xref ref-type="bibr" rid="CR6">6</xref>] for an experiment in which the possible outcomes are not known in advance. The resulting posterior is Dirichlet(<italic>n</italic><sub>1</sub>, …, <italic>n</italic><sub><italic>k</italic></sub>), where <italic>n</italic><sub><italic>i</italic></sub> is the number of cells observed from population <italic>i</italic>. Possible frequency vectors are randomly drawn from this posterior using the R package rBeta2009 [<xref ref-type="bibr" rid="CR7">7</xref>, <xref ref-type="bibr" rid="CR8">8</xref>]. Then, the desired multinomial probability is calculated from each sampled frequency vector, resulting in samples from the posterior distribution of possible multinomial probabilities. A posterior distribution over the number of cells required is calculated in the same way.</p>
  </sec>
  <sec id="Sec3">
    <title>Results</title>
    <sec id="Sec4">
      <title>Estimating required sample size using the multinomial distribution</title>
      <p id="Par17">We make the simplifying assumption that a successful experiment requires sampling a sufficient number of representatives from each subpopulation of interest in the tissue. Defining <italic>c</italic> as the required number of representatives from each subpopulation, <italic>N</italic><sub><italic>i</italic></sub> as the number of cells of subpopulation <italic>i</italic> which are sampled, and <italic>k</italic> as the number of subpopulations of interest, then the probability of meeting this condition is
<disp-formula id="Equg"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ P\left({N}_1\ge c,{N}_2\ge c,\dots, {N}_k\ge c\right) $$\end{document}</tex-math><mml:math id="M30" display="block"><mml:mi>P</mml:mi><mml:mfenced close=")" open="(" separators=",,,"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>≥</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>≥</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>…</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>≥</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="12859_2019_3167_Article_Equg.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par18">Assuming that a fixed number of cells are chosen at random from the population, the distribution of <italic>N</italic><sub>1</sub>, …, <italic>N</italic><sub><italic>k</italic></sub> is multinomial. To calculate this probability, we created an R implementation of a previously described algorithm [<xref ref-type="bibr" rid="CR4">4</xref>], described further in the Implementation section. Our implementation is available for R scripting in the package “pmultinom”, available from CRAN (Table <xref rid="Tab1" ref-type="table">1</xref>).
<table-wrap id="Tab1"><label>Table 1</label><caption><p>Package functions for pmultinom. This table lists the R functions for the package “pmultinom” for calculating multinomial probabilities</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Function</th><th>Arguments</th><th>Description</th></tr></thead><tbody><tr><td>pmultinom</td><td>lower, upper, size, probs, method</td><td>Probability that a multinomial random vector is elementwise greater than “lower” and elementwise less than or equal to “upper”. “size” and “probs” specify the parameters of the multinomial distribution. Either “lower” or “upper” may be left unspecified.</td></tr><tr><td>invert.pmultinom</td><td>lower, upper, probs, target.prob, method</td><td>Returns the “size” parameter required for pmultinom to reach the target probability “target.prob”.</td></tr></tbody></table></table-wrap></p>
      <p id="Par19">Our web tool, SCOPIT, provides an interactive interface for multinomial calculations. SCOPIT provides both prospective and retrospective calculations, described below.</p>
    </sec>
    <sec id="Sec5">
      <title>Prospective calculations</title>
      <p id="Par20">SCOPIT’s prospective mode is intended to estimate the number of cells that must be sampled in a single-cell sequencing experiment. Ideally, the number of cells can be decided by finding a number of cells, <italic>n</italic><sup>∗</sup>, such that the above multinomial probability is above a specified success probability, <italic>p</italic><sup>∗</sup>. Such a calculation would require specifying the frequency of each subpopulation of cells in the tissue, but the precise subpopulation frequencies are usually unknown before performing the experiment.</p>
      <p id="Par21">The strategy implemented in the prospective mode is to specify the frequency of the rarest subpopulations that the researcher intends to find, as well as <italic>k</italic>, the number of populations with approximately this frequency. Both numbers are relevant, since it is harder to find, for example, 10 subpopulations with frequency 1%, than it is to find only one.</p>
      <p id="Par22">The required number of cells is defined as follows:
<disp-formula id="Equh"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {n}^{\ast }=\min\;\left\{n\;|\;P\left({N}_1\ge c,{N}_2\ge c,\dots, {N}_k\ge c\right)\ge {p}^{\ast}\right\} $$\end{document}</tex-math><mml:math id="M32" display="block"><mml:msup><mml:mi>n</mml:mi><mml:mo>∗</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mo>min</mml:mo><mml:mspace width="0.12em"/><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:mi>n</mml:mi><mml:mspace width="0.12em"/></mml:mrow><mml:mrow><mml:mspace width="0.12em"/><mml:mi>P</mml:mi><mml:mfenced close=")" open="(" separators=",,,"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>≥</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>≥</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>…</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>≥</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:mfenced><mml:mo>≥</mml:mo><mml:msup><mml:mi>p</mml:mi><mml:mo>∗</mml:mo></mml:msup></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="12859_2019_3167_Article_Equh.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par23">SCOPIT reports <italic>n</italic><sup>∗</sup> along with a plot of the probability as a function of the number of cells sequenced (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a).
<fig id="Fig1"><label>Fig. 1</label><caption><p>SCOPIT interface. <bold>a</bold>. Interface for prospective calculations. Orange lines identify the number of cells required and the target probability of detecting a specified number of each subpopulation. <bold>b</bold>. Interface for retrospective calculations. The number of cells which were sequenced is entered, and is marked on the plot with a dotted green line. In this example, the orange line is far to the left of the dotted green line, suggesting that more cells were sequenced than required to detect these three subpopulations. To quantify confidence in the results, a dotted black line is plotted that shows the lower end of a 95% credible interval for the probability. The plot title states the upper end of a 95% credible interval for the number of cells required</p></caption><graphic xlink:href="12859_2019_3167_Fig1_HTML" id="MO1"/></fig></p>
      <p id="Par24">This mode requires only one subpopulation frequency to be specified: the minimum frequency among all subpopulations of interest. The SCOPIT interface does enable the user to add additional subpopulations with higher frequencies, but the user will find that these additional subpopulations have negligible effects on <italic>n</italic><sup>∗</sup>, unless they are very close in frequency to the rarest subpopulations. This phenomenon justifies specifying only the lowest frequency.</p>
    </sec>
    <sec id="Sec6">
      <title>Retrospective calculations</title>
      <p id="Par25">After an experiment has been performed, estimates of the subpopulation frequencies are available as input parameters. It is then possible to use SCOPIT in retrospective mode to estimate how many cells would be required, in a hypothetical replicate experiment, to detect all <italic>k</italic> observed subpopulations, with <italic>c</italic> representatives from each. In retrospective mode, the information required from the user consists of the total number of cells sequenced in a previous experiment, and the number of cells observed from each subpopulation. With this information, SCOPIT will calculate, for each number of cells <italic>n</italic>, the probability <italic>P</italic>(<italic>N</italic><sub>1</sub> ≥ <italic>c</italic>, <italic>N</italic><sub>2</sub> ≥ <italic>c</italic>, …, <italic>N</italic><sub><italic>k</italic></sub> ≥ <italic>c</italic>), assuming the true subpopulation frequencies are equal to the empirically observed ones. For example, in Fig. <xref rid="Fig1" ref-type="fig">1</xref>b, we use single cell DNA data from a triple-negative breast tumor [<xref ref-type="bibr" rid="CR9">9</xref>] in which the authors sequenced <italic>N</italic> = 84 single cells and detected two major clonal subpopulations. Using SCOPIT we estimated that only 19 cells were required to detect the two subpopulations with a 0.95 probability, suggesting that this study sequenced about 4 times the number of cells that were necessary.</p>
      <p id="Par26">Because the retrospective analysis involves uncertainty about the true frequencies of each population, SCOPIT provides measures of uncertainty using Bayesian credible intervals at a 95% confidence level. For the number of cells required, SCOPIT reports the upper end of a one-sided credible interval, which is interpretable as the highest number of cells consistent with the data. For the probability of obtaining a sufficient number of cells from each population, SCOPIT plots the lower end of a one-sided credible interval, interpretable as the lowest probability consistent with the data. In the example described above, the credible interval boundaries were close to the estimated values, indicating that the estimated values were strongly supported by the data provided.</p>
      <p id="Par27">The retrospective tool is useful for planning a second experiment, assuming that all the subpopulations of interest were observed in the first experiment, and that the underlying subpopulation frequencies are consistent in both experiments. Although the exact subpopulation frequencies are not known, overconfident conclusions on the basis of limited information can be avoided using the credible intervals provided by the retrospective tool.</p>
    </sec>
    <sec id="Sec7">
      <title>Comparison with independence approximation</title>
      <p id="Par28">Another previous software tool for estimating single cell sample sizes is an unpublished web application (<ext-link ext-link-type="uri" xlink:href="https://satijalab.org/howmanycells">https://satijalab.org/howmanycells</ext-link>). The previous tool is based upon two simplifying assumptions: that the subpopulations have equal frequencies, and that the observed frequencies of each subpopulation are statistically independent. Under these assumptions:
<disp-formula id="Equi"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ P\left({N}_1\ge c,{N}_2\ge c,\dots, {N}_k\ge c\right)=P{\left(N\ge c\right)}^k $$\end{document}</tex-math><mml:math id="M34" display="block"><mml:mi>P</mml:mi><mml:mfenced close=")" open="(" separators=",,,"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>≥</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>≥</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>…</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>≥</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mi>N</mml:mi><mml:mo>≥</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:mfenced><mml:mi>k</mml:mi></mml:msup></mml:math><graphic xlink:href="12859_2019_3167_Article_Equi.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par29">where <italic>N</italic> represents the number of cells sampled from an arbitrary subpopulation. To compare the independence approximation method to SCOPIT, the required number of cells was calculated with and without the independence assumption (Table <xref rid="Tab2" ref-type="table">2</xref>). The calculations performed under the independence assumption underestimated the required number of cells by at most 1 cell and were highly similar. These data suggests that using independence approximation is an alternative approach that can also be used for estimating single cell sample sizes.
<table-wrap id="Tab2"><label>Table 2</label><caption><p>Comparison of Independent Approximation and Exact Calculations.</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Subpopulation frequency</th><th># of subpopulations</th><th>Cells required (exact)</th><th>Cells required (approx.)</th></tr></thead><tbody><tr><td>0.1</td><td>6</td><td>186</td><td>186</td></tr><tr><td>0.2</td><td>3</td><td>85</td><td>85</td></tr><tr><td>0.3</td><td>2</td><td>53</td><td>53</td></tr><tr><td>0.1</td><td>8</td><td>191</td><td>191</td></tr><tr><td>0.2</td><td>4</td><td>87</td><td>87</td></tr><tr><td>0.4</td><td>2</td><td>39</td><td>39</td></tr><tr><td>0.1</td><td>9</td><td>193</td><td>193</td></tr><tr><td>0.3</td><td>3</td><td>55</td><td>55</td></tr><tr><td>0.1</td><td>10</td><td>195</td><td>194</td></tr><tr><td>0.2</td><td>5</td><td>89</td><td>89</td></tr><tr><td>0.5</td><td>2</td><td>30</td><td>30</td></tr></tbody></table><table-wrap-foot><p>The number of cells required to achieve a 95% certainty of sampling sufficiently many cells from each subpopulation. The number of cells was calculated in two ways: by an exact calculation, and by an approximate calculation in which the counts of different subpopulations were assumed to be independent</p></table-wrap-foot></table-wrap></p>
    </sec>
  </sec>
  <sec id="Sec8">
    <title>Discussion</title>
    <p id="Par30">SCOPIT’s function is to calculate the number of cells that must be sampled in a single-cell sequencing experiment, on the basis of input subpopulation frequencies, and under the assumption of random sampling. To achieve this goal, we implemented a fast multinomial probability calculation approach that is provided as open access software through the R package ‘pmultinom’. This method enables calculations at speeds sufficient for interactive plotting. The retrospective sample size calculation performed by SCOPIT is distinct from estimation of the number of undiscovered subpopulations [<xref ref-type="bibr" rid="CR10">10</xref>] or the number likely to be discovered in further sampling [<xref ref-type="bibr" rid="CR11">11</xref>], and can instead be interpreted as the required sample size of a replicate experiment which would detect the same subpopulations as the original experiment.</p>
    <p id="Par31">To determine the number of cells required, SCOPIT calculates the probability of sampling sufficiently many representatives of each subpopulation. The probability calculated by SCOPIT is relevant to a wide variety of analyses and technologies, but specific technologies introduce additional experimental design considerations. For example, in single-cell differential expression analysis, it is important not only to sample sufficiently many cells, but also to sample sufficiently many transcripts from each cell. Other tools have been developed to calculate the probability of detecting a specific transcript [<xref ref-type="bibr" rid="CR12">12</xref>], to calculate the power to detect differential expression [<xref ref-type="bibr" rid="CR13">13</xref>], and to determine the number of cells and reads required to find accurate low-dimensional representations of single-cell RNA sequencing data [<xref ref-type="bibr" rid="CR14">14</xref>]. Accommodating the unique aspects of other technologies and analyses is an important topic for future research in the design of single-cell sequencing experiments.</p>
    <p id="Par32">A previous tool is available for calculating the number of cells to sequence (<ext-link ext-link-type="uri" xlink:href="https://satijalab.org/howmanycells">https://satijalab.org/howmanycells</ext-link>) and a direct comparison to SCOPIT shows that it generates results that are highly similar to SCOPIT, despite using independent approximations instead of exact probabilities. However SCOPIT offers several additional features, including the ability to enter multiple cell type frequencies, and interfaces to perform both prospective estimates of the sample sizes for planning experiments and retrospective calculations which include measures of confidence in the result.</p>
    <p id="Par33">While SCOPIT can be used to decide how many cells to sample from a tissue, another important question is how many spatial regions to sample to capture the diversity of the population. In the case of sampling from tumor tissue, the question of how widely to sample can be addressed by simulating the generation of intratumor heterogeneity [<xref ref-type="bibr" rid="CR15">15</xref>], followed by simulating sampling. However, simpler statistical calculations which avoid detailed simulations are currently not available and represent an important future direction.</p>
  </sec>
  <sec id="Sec9">
    <title>Conclusions</title>
    <p id="Par34">This study reports a useful tool for estimating sample size calculations for planning single cell sequencing experiments prospectively and retrospectively. We expect that SCOPIT will have applications in many diverse areas of biology, and for planning experiments on a variety of single cell technologies (scDNA, scRNA and scATAC-seq).</p>
  </sec>
  <sec id="Sec10">
    <title>Availability and requirements</title>
    <p id="Par35">Project name: SCOPIT</p>
    <p id="Par36">Project homepage: <ext-link ext-link-type="uri" xlink:href="https://github.com/navinlabcode/scopit">https://github.com/navinlabcode/scopit</ext-link></p>
    <p id="Par37">Web interface: <ext-link ext-link-type="uri" xlink:href="http://www.navinlab.com/SCOPIT">http://www.navinlab.com/SCOPIT</ext-link></p>
    <p id="Par38">Operating system: Platform independent</p>
    <p id="Par39">Programming language: R</p>
    <p id="Par40">License: AGPL v3</p>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>SCOPIT</term>
        <def>
          <p id="Par4">Single-cell one-sided probability interactive tool</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <ack>
    <p>We thank Aislyn Schalck for assistance with the project.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>AD was involved in all aspects. RG conceptualized the project, and NN wrote the manuscript. All authors have read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>This work was supported by grants to NN from the American Cancer Society (129098-RSG-16-092-01-TBG), the Chan-Zuckerberg Initiative Human Cell Atlas Seed Network Grant (HCA3–0000000147) and the CPRIT Single Cell Genomics Center Grant (RP180684). This work was also supported by Susan Komen (PDF17487910) and AACR Basic Cancer Research Fellowships (174042GAO) to RG. AD was supported by an NLM fellowship (4T15LM007093–25). These funding agencies did not play any role in the design of the study, the collection, analysis, and interpretation of data, or in the writing of the manuscript.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The source code used in the current study are available from GitHub, <ext-link ext-link-type="uri" xlink:href="https://github.com/navinlabcode/">https://github.com/navinlabcode/</ext-link></p>
  </notes>
  <notes>
    <title>Ethics approval and consent to participate</title>
    <p id="Par41">Not applicable.</p>
  </notes>
  <notes>
    <title>Consent for publication</title>
    <p id="Par42">Not applicable.</p>
  </notes>
  <notes notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par43">The authors declare that they have no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baran-Gale</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chandra</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Kirschner</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Experimental design for single-cell RNA sequencing</article-title>
        <source>Brief Funct Genomics</source>
        <year>2018</year>
        <volume>17</volume>
        <issue>4</issue>
        <fpage>233</fpage>
        <lpage>239</lpage>
        <pub-id pub-id-type="doi">10.1093/bfgp/elx035</pub-id>
        <?supplied-pmid 29126257?>
        <pub-id pub-id-type="pmid">29126257</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Navin</surname>
            <given-names>NE</given-names>
          </name>
        </person-group>
        <article-title>The first five years of single-cell cancer genomics and beyond</article-title>
        <source>Genome Res</source>
        <year>2015</year>
        <volume>25</volume>
        <issue>10</issue>
        <fpage>1499</fpage>
        <lpage>1507</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.191098.115</pub-id>
        <?supplied-pmid 26430160?>
        <pub-id pub-id-type="pmid">26430160</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <mixed-citation publication-type="other">Fisher RA. On the Interpretation of <italic>χ</italic><sup>2</sup> from Contingency Tables, and the Calculation of P. J R Stat Soc. 1922;85(1). 10.2307/2340521.</mixed-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Levin</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>A representation for multinomial cumulative distribution functions</article-title>
        <source>Ann Stat</source>
        <year>1981</year>
        <volume>9</volume>
        <issue>5</issue>
        <fpage>1123</fpage>
        <lpage>1126</lpage>
        <pub-id pub-id-type="doi">10.1214/aos/1176345593</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Frigo</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Johnson</surname>
            <given-names>SG</given-names>
          </name>
        </person-group>
        <article-title>The design and implementation of FFTW3</article-title>
        <source>Proc IEEE</source>
        <year>2005</year>
        <volume>93</volume>
        <issue>2</issue>
        <fpage>216</fpage>
        <lpage>231</lpage>
        <pub-id pub-id-type="doi">10.1109/JPROC.2004.840301</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <mixed-citation publication-type="other">Jaynes ET. Probability theory: the logic of science: Cambridge University Press; 2003. <ext-link ext-link-type="uri" xlink:href="https://books.google.com/books?id=UjsgAwAAQBAJ">https://books.google.com/books?id=UjsgAwAAQBAJ</ext-link>. Accessed 11 Sept 2009.</mixed-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <mixed-citation publication-type="other">Cheng CW, Hung YC, Balakrishnan N. rBeta2009: The Beta Random Number and Dirichlet Random Vector Generating Functions. 2012. <ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/package=rBeta2009">https://cran.r-project.org/package=rBeta2009</ext-link>. Accessed 11 Sept 2009.</mixed-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hung</surname>
            <given-names>YC</given-names>
          </name>
          <name>
            <surname>Balakrishnan</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Cheng</surname>
            <given-names>CW</given-names>
          </name>
        </person-group>
        <article-title>Evaluation of algorithms for generating Dirichlet random vectors</article-title>
        <source>J Stat Comput Simul</source>
        <year>2011</year>
        <volume>81</volume>
        <issue>4</issue>
        <fpage>445</fpage>
        <lpage>459</lpage>
        <pub-id pub-id-type="doi">10.1080/00949650903409999</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gao</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Davis</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>McDonald</surname>
            <given-names>TO</given-names>
          </name>
          <name>
            <surname>Sei</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Tsai</surname>
            <given-names>P-C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Punctuated copy number evolution and clonal stasis in triple-negative breast cancer</article-title>
        <source>Nat Genet</source>
        <year>2016</year>
        <volume>48</volume>
        <fpage>1</fpage>
        <lpage>15</lpage>
        <pub-id pub-id-type="doi">10.1038/ng.3641</pub-id>
        <pub-id pub-id-type="pmid">26711105</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Gotelli</surname>
            <given-names>NJ</given-names>
          </name>
          <name>
            <surname>Colwell</surname>
            <given-names>RK</given-names>
          </name>
        </person-group>
        <article-title>Estimating species richness</article-title>
        <source>Biological Diversity. Frontiers in Measurement and Assessment</source>
        <year>2011</year>
        <fpage>39</fpage>
        <lpage>54</lpage>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <mixed-citation publication-type="other">Shen TJ, Chao A, Lin CF. Predicting the number of new species in further taxonomic sampling. Ecology. 2003;84(3):798–804. 10.1890/0012-9658(2003)084[0798:PTNONS]2.0.CO;2.</mixed-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <mixed-citation publication-type="other">Svensson V, Natarajan KN, Ly LH, Miragaia RJ, Labalette C, Macaulay IC, Cvejic A, Teichmann SA. Power analysis of single-cell RNA-sequencing experiments. Nat Methods. 2017;14(4):381–7. 10.1038/nmeth.4220.</mixed-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <mixed-citation publication-type="other">Jenkins D, Faits T, Khan MM, Briars E, Pro SC, Johnson WE. singleCellTK: Interactive Analysis of Single Cell RNA-Seq Data. 2018. 10.18129/B9.bioc.singleCellTK.</mixed-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Svensson V, da Veiga Beltrame E, Pachter L. Quantifying the tradeoff between sequencing depth and cell number in single-cell RNA-seq. bioRxiv. 2019. 10.1101/762773.</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <mixed-citation publication-type="other">Sun R, Hu Z, Sottoriva A, Graham TA, Harpak A, Ma Z, Fischer JM, Shibata D, Curtis C. Between-region genetic divergence reflects the mode and tempo of tumor evolution. Nat Genet. 2017:1–13. 10.1038/ng.3891.</mixed-citation>
    </ref>
  </ref-list>
</back>
