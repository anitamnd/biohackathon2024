<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d1 20130915//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5167063</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btw538</article-id>
    <article-id pub-id-type="publisher-id">btw538</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>BatchQC: interactive software for evaluating sample and batch effects in genomic data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Manimaran</surname>
          <given-names>Solaiappan</given-names>
        </name>
        <xref ref-type="aff" rid="btw538-aff1">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="btw538-aff2">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Selby</surname>
          <given-names>Heather Marie</given-names>
        </name>
        <xref ref-type="aff" rid="btw538-aff3">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Okrah</surname>
          <given-names>Kwame</given-names>
        </name>
        <xref ref-type="aff" rid="btw538-aff4">
          <sup>4</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ruberman</surname>
          <given-names>Claire</given-names>
        </name>
        <xref ref-type="aff" rid="btw538-aff5">
          <sup>5</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Leek</surname>
          <given-names>Jeffrey T.</given-names>
        </name>
        <xref ref-type="aff" rid="btw538-aff5">
          <sup>5</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Quackenbush</surname>
          <given-names>John</given-names>
        </name>
        <xref ref-type="aff" rid="btw538-aff6">
          <sup>6</sup>
        </xref>
        <xref ref-type="aff" rid="btw538-aff7">
          <sup>7</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Haibe-Kains</surname>
          <given-names>Benjamin</given-names>
        </name>
        <xref ref-type="aff" rid="btw538-aff8">
          <sup>8</sup>
        </xref>
        <xref ref-type="aff" rid="btw538-aff9">
          <sup>9</sup>
        </xref>
        <xref ref-type="aff" rid="btw538-aff10">
          <sup>10</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bravo</surname>
          <given-names>Hector Corrada</given-names>
        </name>
        <xref ref-type="aff" rid="btw538-aff11">
          <sup>11</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Johnson</surname>
          <given-names>W. Evan</given-names>
        </name>
        <xref ref-type="aff" rid="btw538-aff1">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="btw538-aff2">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="btw538-aff3">
          <sup>3</sup>
        </xref>
        <xref ref-type="corresp" rid="btw538-cor1">*</xref>
      </contrib>
      <aff id="btw538-aff1"><label>1</label>Department of Biostatistics, Boston University, Boston, MA</aff>
      <aff id="btw538-aff2"><label>2</label>Division of Computational Biomedicine, Boston University School of Medicine, Boston, MA</aff>
      <aff id="btw538-aff3"><label>3</label>Bioinformatics Program, Boston University, Boston, MA</aff>
      <aff id="btw538-aff4"><label>4</label>gRED Oncology Biostatistics, Genentech, South San Francisco, CA</aff>
      <aff id="btw538-aff5"><label>5</label>Department of Biostatistics, Johns Hopkins Bloomberg School of Public Health, Baltimore, MD</aff>
      <aff id="btw538-aff6"><label>6</label>Department of Biostatistics and Computational Biology, Dana-Farber Cancer Institute, Boston, MA</aff>
      <aff id="btw538-aff7"><label>7</label>Department of Biostatistics, Harvard T.H. Chan School of Public Health, Boston, MA</aff>
      <aff id="btw538-aff8"><label>8</label>Departments of Medical Biophysics and Computer Science, University of Toronto, Toronto, Ontario, Canada</aff>
      <aff id="btw538-aff9"><label>9</label>Princess Margaret Cancer Centre, University Health NetworkToronto, Ontario, Canada</aff>
      <aff id="btw538-aff10"><label>10</label>Ontario Institute of Cancer Research, Toronto, Ontario, Canada</aff>
      <aff id="btw538-aff11"><label>11</label>Center for Bioinformatics and Computational Biology, University of Maryland, College Park, MD</aff>
    </contrib-group>
    <author-notes>
      <corresp id="btw538-cor1"><label>*</label>To whom correspondence should be addressed.</corresp>
      <fn id="btw538-FM1">
        <p>Associate Editor: Inanc Birol</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>12</month>
      <year>2016</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>8</month>
      <year>2016</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>18</day>
      <month>8</month>
      <year>2016</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>32</volume>
    <issue>24</issue>
    <fpage>3836</fpage>
    <lpage>3838</lpage>
    <history>
      <date date-type="received">
        <day>03</day>
        <month>4</month>
        <year>2016</year>
      </date>
      <date date-type="rev-recd">
        <day>10</day>
        <month>8</month>
        <year>2016</year>
      </date>
      <date date-type="accepted">
        <day>10</day>
        <month>8</month>
        <year>2016</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author 2016. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2016</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by-nc/4.0/" license-type="creative-commons">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <abstract>
      <p>Sequencing and microarray samples often are collected or processed in multiple batches or at different times. This often produces technical biases that can lead to incorrect results in the downstream analysis. There are several existing batch adjustment tools for ‘-omics’ data, but they do not indicate a priori whether adjustment needs to be conducted or how correction should be applied. We present a software pipeline, BatchQC, which addresses these issues using interactive visualizations and statistics that evaluate the impact of batch effects in a genomic dataset. BatchQC can also apply existing adjustment tools and allow users to evaluate their benefits interactively. We used the BatchQC pipeline on both simulated and real data to demonstrate the effectiveness of this software toolkit.</p>
      <p><bold>Availability and Implementation:</bold> BatchQC is available through Bioconductor: <ext-link ext-link-type="uri" xlink:href="http://bioconductor.org/packages/BatchQC">http://bioconductor.org/packages/BatchQC</ext-link> and GitHub: <ext-link ext-link-type="uri" xlink:href="https://github.com/mani2012/BatchQC">https://github.com/mani2012/BatchQC</ext-link>.</p>
      <p>
        <bold>Contact:</bold>
        <email>wej@bu.edu</email>
      </p>
      <p><bold>Supplementary information:</bold><ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btw538/-/DC1">Supplementary data</ext-link> are available at <italic>Bioinformatics</italic> online.</p>
    </abstract>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec id="SEC1">
    <title>1 Introduction</title>
    <p>Non-biological variation, including batch effects, is commonly present across multiple batches of ‘-omics’ data of the same type (e.g. microarray, RNA-seq, DNA methylation, proteomics) and can be caused by technical factors such as differences in profiling platform, lab protocol, experimenter, processing procedures or reagent batch. These data can be affected by technical variation attributable to both observed and unobserved factors (<xref rid="btw538-B6" ref-type="bibr">Leek <italic>et al.</italic>, 2010</xref>). Batch effects can act as a confounder and produce technical biases that lead to incorrect downstream analyses (<xref rid="btw538-B1" ref-type="bibr">Akey <italic>et al.</italic>, 2007</xref>; <xref rid="btw538-B4" ref-type="bibr">Lambert and Black, 2012</xref>). Many effective methods have been developed to filter technical heterogeneity and batch effects from high-throughput biological data (<xref rid="btw538-B2" ref-type="bibr">Gagnon-Bartsch <italic>et al.</italic>, 2013</xref>; <xref rid="btw538-B3" ref-type="bibr">Johnson and Li, 2007</xref>; <xref rid="btw538-B5" ref-type="bibr">Leek <italic>et al.</italic>, 2012</xref>); however, it is often unclear which method should be applied when combining particular sets of experimental data. In some cases, significant batch correction is needed, whereas in other cases no correction is required. Thus, a complete evaluation of each case is necessary before devising an appropriate correction strategy. This process requires preliminary analyses including data visualization, hierarchical clustering, principle components analysis (PCA), and significance testing. These analyses entail considerable effort, and must be repeated for every set of experimental data. BatchQC streamlines batch evaluation by providing interactive diagnostics, visualizations and statistical analyses to explore the extent to which batch variation impacts the data. BatchQC diagnostics guide the user in determining whether batch adjustment needs to be conducted, and how it should be applied before downstream analysis. BatchQC interactively applies multiple batch effect approaches to the data, and the user can see the benefits of each method.</p>
  </sec>
  <sec id="SEC2">
    <title>2 Methods</title>
    <p>BatchQC is a Shiny App (<ext-link ext-link-type="uri" xlink:href="http://shiny.rstudio.com/">http://shiny.rstudio.com/</ext-link>) R-package (R ver. 3.3+). The output is organized into multiple tabs, each featuring a part of the batch effect analysis of the data. The package was developed for flexible future development: tabs can be modified, added, or removed as needs change or as new approaches are developed. We highlight many of the interactive features that are provided by BatchQC:</p>
    <sec>
      <title>2.1 Summary and sample diagnostics</title>
      <p>BatchQC provides diagnostic and measures for the impacts of study design, batch and treatment effects and for individual samples. These include tabular summary of the samples from each condition and batch, and estimates of the level of confounding present in the study design between batch and condition. BatchQC also provides summary statistics and figures for the percentage of the variation explained by the batch and condition variables for each gene, and a <italic>P</italic>-value analysis that tests statistical significance of both the batch and condition effects across genes (summarizing their distributions using boxplots, histograms and tables). Moreover, BatchQC includes visualizations for between sample correlations to help identify outlying samples and batches.</p>
    </sec>
    <sec>
      <title>2.2 Visualization and differential expression</title>
      <p>BatchQC provides an interactive box plot of user-inputted genomic values (read count, probe intensity etc.) for each sample, with options to sort and color the samples by condition or batch, which enables the user to visualize differences across conditions and batches (<xref ref-type="fig" rid="btw538-F1">Fig. 1</xref>, top). BatchQC also provides heatmap plots for gene-level values and a sample-level circular dendrogram that clusters the samples using the choice of several different agglomeration measures. BatchQC also provides gene-level significance tests.
<fig id="btw538-F1" orientation="portrait" position="float"><label>Fig. 1.</label><caption><p>Examples from the BatchQC interface. (top) Boxplots from the simulated dataset showing clear distributional differences between batches. (bottom) The first two PCA components from the signature dataset shows strong batch effects</p></caption><graphic xlink:href="btw538f1p"/></fig>
</p>
    </sec>
    <sec>
      <title>2.3 PCA and shape analysis</title>
      <p>BatchQC conducts PCA on the dataset and produces an interactive plot for displaying the user’s choice of any two components at the same time, with the points colored by the choice of condition or batch (<xref ref-type="fig" rid="btw538-F1">Fig. 1</xref>, bottom). BatchQC also provides a summary table that associates the percentage of variation of each PCA component explained by batch and condition, and tests for the statistical significance of these effects. In addition, BatchQC conducts a distributional shape analysis, namely the skewness and kurtosis, to evaluate batch effects in higher moments in the data (<xref rid="btw538-B7" ref-type="bibr">Okrah and Bravo, 2015</xref>).</p>
    </sec>
    <sec>
      <title>2.4 Batch adjustment</title>
      <p>BatchQC can interactively adjust the data for batch effects using ComBat or Surrogate Variable Analysis (SVA). BatchQC determines the number of surrogate variables to identify in the given data set, estimates the surrogate variables, and performs the batch adjustment. After batch adjustment, all of the previous diagnostics can be viewed for the raw or adjusted data, and the user can interactively toggle between the two and evaluate the impact of batch adjustment.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Data examples and comparisons</title>
    <p>The <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btw538/-/DC1">supplementary materials</ext-link> and package vignettes illustrate the functionalities of BatchQC using multiple simulated and real datasets that are included with the package. The need for batch adjustment in the first simulated dataset (details in <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btw538/-/DC1">Supplementary Materials</ext-link>) can be noted in the boxplots (<xref ref-type="fig" rid="btw538-F1">Fig. 1</xref>, top), variation analysis, PCA and the clustered heatmap. After adjustment, the boxplots and variation analysis showed no remaining evidence of batch effects, and the samples clustered strongly by condition and not by batch as was previously the case in heatmap and PCA. Interestingly, in the second simulated dataset, PCA did not reveal the batch differences, while the boxplot and heatmaps did show batch differences, indicating the need for multiple diagnostic measures in each data scenario.</p>
    <p>As a real-data example, we applied BatchQC to sequencing data captured from human mammary epithelial cells after activating key growth pathway genes (BatchQC examples; GEO accession GSE73628). The data consists of three batches and ten different conditions corresponding to control and activation of nine different pathways (details in Supplement). The PCA plots show a batch effect (<xref ref-type="fig" rid="btw538-F1">Fig. 1</xref>, bottom). Similarly, the circular dendrogram and median correlation plots reveal clustering based on batch status. Batch adjustment using either ComBat or SVA diffuses the batch clusters in the PCA and circular dendrogram. These examples demonstrate the utility of all features of the BatchQC package.</p>
  </sec>
  <sec id="SEC4">
    <title>4 Conclusions</title>
    <p>BatchQC is beneficial for the analyses of ‘-omic’ data and is particularly advantageous in studies where samples are collected in multiple batches or at different times. BatchQC streamlines batch preprocessing and evaluation by providing interactive diagnostics, visualizations and statistical analyses to explore whether batch adjustment needs to be conducted and how correction should be applied (see <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btw538/-/DC1">Supplementary Materials</ext-link> for recommendations on when batch adjustment should be applied). Moreover, BatchQC interactively applies multiple batch effect approaches to the data, and the user can quickly see the benefits of each method interactively. BatchQC is the first software tool to integrate batch diagnostics and correction methods. BatchQC is available as a Shiny user interface that makes the application easy to use and can be easily installed on any computer with standard R installation (R ver. 3.3+) and pandoc (1.12.0+).</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>Supplementary Data</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="supp_32_24_3836__index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="x-zip-compressed" xlink:href="supp_btw538_suppl_data.zip"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Funding</title>
    <p>This research was supported by funds from the National Institutes of Health (R01 HG005692, R01 ES025002), and the National Science Foundation (DGE 0654108).</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="btw538-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Akey</surname><given-names>J.M.</given-names></name></person-group><etal/> (<year>2007</year>) <article-title>On the design and analysis of gene expression studies in human populations</article-title>. <source>Nat. Genet</source>., <volume>39</volume>, <fpage>807</fpage>–<lpage>808</lpage>.<pub-id pub-id-type="pmid">17597765</pub-id></mixed-citation>
    </ref>
    <ref id="btw538-B2">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name><surname>Gagnon-Bartsch</surname><given-names>J.A.</given-names></name></person-group><etal/> (<year>2013</year>) Removing unwanted variation from high dimensional data with negative controls, <italic>Tech. Rep</italic>. 820, Department of Statistics, University of California, Berkeley.</mixed-citation>
    </ref>
    <ref id="btw538-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Johnson</surname><given-names>W.E.</given-names></name><name><surname>Li</surname><given-names>C.</given-names></name></person-group> (<year>2007</year>) <article-title>Adjusting batch effects in microarray expression data using empirical Bayes methods</article-title>. <source>Biostatistics</source>, <volume>8</volume>, <fpage>118</fpage>–<lpage>127</lpage>.<pub-id pub-id-type="pmid">16632515</pub-id></mixed-citation>
    </ref>
    <ref id="btw538-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lambert</surname><given-names>C.G.</given-names></name><name><surname>Black</surname><given-names>L.J.</given-names></name></person-group> (<year>2012</year>) <article-title>Learning from our GWAS mistakes: from experimental design to scientific method</article-title>. <source>Biostatistics</source>, <volume>13</volume>, <fpage>195</fpage>–<lpage>203</lpage>.<pub-id pub-id-type="pmid">22285994</pub-id></mixed-citation>
    </ref>
    <ref id="btw538-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Leek</surname><given-names>J.T.</given-names></name></person-group><etal/> (<year>2012</year>) <article-title>The sva package for removing batch effects and other unwanted variation in high-throughput experiments</article-title>. <source>Bioinformatics</source>, <volume>28</volume>, <fpage>882</fpage>–<lpage>883</lpage>.<pub-id pub-id-type="pmid">22257669</pub-id></mixed-citation>
    </ref>
    <ref id="btw538-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Leek</surname><given-names>J.T.</given-names></name></person-group><etal/> (<year>2010</year>) <article-title>Tackling the widespread and critical impact of batch effects in high-throughput data</article-title>. <source>Nat. Rev. Genet</source>., <volume>11</volume>, <fpage>733</fpage>–<lpage>739</lpage>.<pub-id pub-id-type="pmid">20838408</pub-id></mixed-citation>
    </ref>
    <ref id="btw538-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Okrah</surname><given-names>K.</given-names></name><name><surname>Bravo</surname><given-names>H.C.</given-names></name></person-group> (<year>2015</year>) <article-title>Shape analysis of high-throughput transcriptomics experiment data</article-title>. <source>Biostatistics</source>, <volume>16</volume>, <fpage>627</fpage>–<lpage>640</lpage>.<pub-id pub-id-type="pmid">25964664</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
