<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5860325</article-id>
    <article-id pub-id-type="pmid">28961926</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btx517</article-id>
    <article-id pub-id-type="publisher-id">btx517</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MAPseq: highly efficient k-mer search with confidence estimates, for rRNA sequence analysis</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Matias Rodrigues</surname>
          <given-names>João F</given-names>
        </name>
        <xref ref-type="aff" rid="btx517-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Schmidt</surname>
          <given-names>Thomas S B</given-names>
        </name>
        <xref ref-type="aff" rid="btx517-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Tackmann</surname>
          <given-names>Janko</given-names>
        </name>
        <xref ref-type="aff" rid="btx517-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>von Mering</surname>
          <given-names>Christian</given-names>
        </name>
        <xref ref-type="corresp" rid="btx517-cor1"/>
        <!--<email>mering@imls.uzh.ch</email>-->
        <xref ref-type="aff" rid="btx517-aff1"/>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Birol</surname>
          <given-names>Inanc</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <aff id="btx517-aff1">Department of Molecular Life Sciences, and Swiss Institute of Bioinformatics, University of Zurich, Zurich, Switzerland</aff>
    <author-notes>
      <corresp id="btx517-cor1">To whom correspondence should be addressed. Email: <email>mering@imls.uzh.ch</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>01</day>
      <month>12</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2017-08-14">
      <day>14</day>
      <month>8</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>14</day>
      <month>8</month>
      <year>2017</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>33</volume>
    <issue>23</issue>
    <fpage>3808</fpage>
    <lpage>3810</lpage>
    <history>
      <date date-type="received">
        <day>13</day>
        <month>4</month>
        <year>2017</year>
      </date>
      <date date-type="rev-recd">
        <day>19</day>
        <month>7</month>
        <year>2017</year>
      </date>
      <date date-type="accepted">
        <day>10</day>
        <month>8</month>
        <year>2017</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author 2017. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2017</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/" license-type="cc-by">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btx517.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Ribosomal RNA profiling has become crucial to studying microbial communities, but meaningful taxonomic analysis and inter-comparison of such data are still hampered by technical limitations, between-study design variability and inconsistencies between taxonomies used.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>Here we present MAPseq, a framework for reference-based rRNA sequence analysis that is up to 30% more accurate (<italic>F</italic><sub>½</sub> score) and up to one hundred times faster than existing solutions, providing in a single run multiple taxonomy classifications and hierarchical operational taxonomic unit mappings, for rRNA sequences in both amplicon and shotgun sequencing strategies, and for datasets of virtually any size.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>Source code and binaries are freely available at <ext-link ext-link-type="uri" xlink:href="https://github.com/jfmrod/mapseq">https://github.com/jfmrod/mapseq</ext-link></p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Swiss National Science Foundation</named-content>
          <named-content content-type="funder-identifier">10.13039/501100001711</named-content>
        </funding-source>
        <award-id>31003A-160095</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Sequencing the DNA of microbial communities, either wholesale or after amplification of selected marker genes, has greatly advanced our understanding in many fields, including ecology, evolution and medical microbiology. However, the sheer amount of data and the conceptual and technical variability introduced by the wide variety of sequencing and analysis approaches pose difficult challenges for the consolidation and inter-comparability of findings, within and across studies.</p>
    <p>The most widely used common denominator for inter-comparisons is taxonomy classification based on ribosomal RNA (rRNA), implemented in a number of software packages including RDP Classifier (<xref rid="btx517-B6" ref-type="bibr">Wang <italic>et al.</italic>, 2007</xref>), USEARCH (<xref rid="btx517-B3" ref-type="bibr">Edgar, 2010</xref>), VSEARCH (<xref rid="btx517-B4" ref-type="bibr">Rognes <italic>et al.</italic>, 2016</xref>) and NINJA-OPS (<xref rid="btx517-B1" ref-type="bibr">Al-Ghalith <italic>et al.</italic>, 2016</xref>), which are often bundled in broader pipelines such as MOTHUR (<xref rid="btx517-B5" ref-type="bibr">Schloss <italic>et al.</italic>, 2009</xref>) and QIIME (<xref rid="btx517-B2" ref-type="bibr">Caporaso <italic>et al.</italic>, 2010</xref>). However, these packages are either restricted to previously known taxa only, are suffering from computational limitations, or cannot be applied in a reference-mapping mode at the scales currently needed. Furthermore, approaches that are restricted to existing taxonomically classified reference sequences may not fully cover microbial diversity. This can be solved by including also unclassified reference sequences, pre-clustered into <italic>operational taxonomic units</italic> (OTUs)—and, ideally, these OTUs should be created at various different identity cutoffs and related to each other hierarchically. Such <italic>hierarchical OTUs</italic> (hOTUs) constitute an operational taxonomy in themselves and enable the assessment of taxa (even uncharacterized taxa) across different studies, at adjustable levels of granularity. MAPseq enables both, by providing a fast and accurate sequence read mapping against hierarchically clustered and annotated reference sequences. In addition to the software itself, we provide a large, curated reference of full-length rRNA genes, pre-clustered into hOTUs at different identity thresholds, and pre-classified to taxonomic categories based on the NCBI taxonomy and the All-species Living Tree Project dataset (<xref rid="btx517-B7" ref-type="bibr">Yilmaz <italic>et al.</italic>, 2014</xref>).</p>
  </sec>
  <sec>
    <title>2 Results</title>
    <p>MAPseq is ten times faster than its closest competitor NINJA-OPS, and a hundred times faster than VSEARCH, on amplicon data (<xref ref-type="fig" rid="btx517-F1">Fig. 1a</xref> ). Its memory requirements are lower than those of all other tools tested here (<xref ref-type="fig" rid="btx517-F1">Fig. 1b</xref>). It can be used also on metagenomic shotgun sequence data, which it automatically searches for suitable rRNA sequences. Accuracy was benchmarked based on placements of reads of known identity, against hOTUs clustered at 98% identity (<xref ref-type="fig" rid="btx517-F1">Fig. 1d and f</xref>) as well as against taxonomic categories at genus level (<xref ref-type="fig" rid="btx517-F1">Fig. 1c and e</xref>). We also tested MAPseq‘s performance on reads of different lengths (<xref ref-type="fig" rid="btx517-F1">Fig. 1e and f</xref>), as well as different hyper-variable regions of the rRNA gene (<xref ref-type="fig" rid="btx517-F1">Fig. 1c and d</xref>).
</p>
    <fig id="btx517-F1" orientation="portrait" position="float">
      <label>Fig. 1</label>
      <caption>
        <p>Benchmarking results on rRNA classification tasks. <bold>(a)</bold> Runtime complexity with increasing database size (using up to 8 CPU threads if supported). <bold>(b)</bold> Maximum memory usage during benchmarking. (<bold>c–f)</bold><italic>F</italic><sub>½</sub>-scores for OTU (98%) or taxonomy (genus) classification, for fragments varying in length or rRNA region. Concordance tests on 2, 194 Human Microbiome Project samples, sequenced twice for both the V1V3 and V3V5 regions; <bold>(g)</bold> Pearson correlation of OTU abundances, and <bold>(h)</bold> overlaps in terms of OTUs identified</p>
      </caption>
      <graphic xlink:href="btx517f1"/>
    </fig>
    <p>With few exceptions, MAPseq outperformed all other tools, achieving a maximum <italic>F</italic><sub>½</sub>-score (weighted harmonic mean of precision and recall) of 0.86 in genus mapping and 0.96 in OTU mapping. The accuracy increase over existing tools is most notable in genus classification, with 30% better <italic>F</italic><sub>½</sub>-score at 500 bp long reads (<xref ref-type="fig" rid="btx517-F1">Fig. 1e</xref>). For all methods, accuracy tends to increase with increasing read lengths, and hyper-variable regions within the rRNA gene yield better placement accuracy than reads originating within random positions within the gene. The increased computational efficiency and higher accuracy of MAPseq are due to several algorithmic innovations, including improved <italic>k-mer</italic> counting based on a pre-clustering step, full Needleman-Wunsch alignment of high scoring segment pairs, and a sensitive algorithm to compute classification confidence; see <xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref> for details.</p>
    <p>Strikingly, we find that even small reductions in the comprehensiveness of the reference dataset, by removal of near-identical sequences, can affect the accuracy for all methods tested (<xref ref-type="fig" rid="btx517-F1">Fig. 1g and h;</xref><xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S2</xref>). This shows that making reference datasets less redundant for runtime reasons has a significant trade-off cost in terms of mapping accuracy.</p>
    <p>For an independent test of classification accuracy, we took advantage of a large data collection for which the very same samples had been subjected to two independent sequencing runs, using different regions of the rRNA gene (2194 samples from the Human Microbiome Project). Here, any good analysis framework should report strongly correlated results. As shown in <xref ref-type="fig" rid="btx517-F1">Figure 1g</xref>, the correlations of abundances of mapped OTUs between sequencing runs were found to be fairly high for most methods; however, MAPseq achieved by far the best trade-off in terms of speed versus accuracy. We observed a similar trend in terms of the fraction of shared OTU identifications (Jaccard overlap, <xref ref-type="fig" rid="btx517-F1">Fig. 1h</xref>): MAPseq resulted in the highest overlap (median = 0.52), followed by VSEARCH, NINJA-OPS, and USEARCH. Finally, we investigated the effect of using a different method for the <italic>ab initio</italic> clustering of reference sequences into OTUs. Using reference OTUs obtained with UCLUST (a widely adopted method) resulted in lower overall abundance correlations (median = 0.62) and Jaccard overlaps (median = 0.33) (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S3</xref>), independent of the software subsequently used for the mapping.</p>
    <p>As a final validation, we have processed artificial ‘mock’ community data (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S4</xref>). We observe that MAPseq recovers their expected abundances better than other tools, at the species, genus and family levels.</p>
    <p>In summary, MAPseq outperforms state-of-the-art methods dramatically in terms of speed, while also providing a more accurate and consistent approach. It can be used with the reference data provided, but also with custom references and/or taxonomies. MAPseq is open-source software implemented in multi-threaded C ++. Both the software and its reference data are available at: <ext-link ext-link-type="uri" xlink:href="http://www.meringlab.org/software/mapseq/">http://www.meringlab.org/software/mapseq/</ext-link>.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the Swiss National Science Foundation (grant nr. 31003A-160095).</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>Supplementary Data</label>
      <media xlink:href="btx517_supplementary_text_including_figures.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list>
    <title>References</title>
    <ref id="btx517-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Al-Ghalith</surname><given-names>G.A.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>NINJA-OPS: fast accurate marker gene alignment using concatenated ribosomes</article-title>. <source>PLoS Comput. Biol</source>., <volume>12</volume>, <fpage>e1004658</fpage>.<pub-id pub-id-type="pmid">26820746</pub-id></mixed-citation>
    </ref>
    <ref id="btx517-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Caporaso</surname><given-names>J.G.</given-names></name></person-group><etal>et al</etal> (<year>2010</year>) 
<article-title>QIIME allows analysis of high-throughput community sequencing data</article-title>. <source>Nat. Methods</source>, <volume>7</volume>, <fpage>335</fpage>–<lpage>336</lpage>.<pub-id pub-id-type="pmid">20383131</pub-id></mixed-citation>
    </ref>
    <ref id="btx517-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Edgar</surname><given-names>R.C.</given-names></name></person-group> (<year>2010</year>) 
<article-title>Search and clustering orders of magnitude faster than BLAST</article-title>. <source>Bioinformatics</source>, <volume>26</volume>, <fpage>2460</fpage>–<lpage>2461</lpage>.<pub-id pub-id-type="pmid">20709691</pub-id></mixed-citation>
    </ref>
    <ref id="btx517-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Rognes</surname><given-names>T.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>VSEARCH: a versatile open source tool for metagenomics</article-title>. <source>PeerJ</source>, <volume>4</volume>, <fpage>e2584.</fpage><pub-id pub-id-type="pmid">27781170</pub-id></mixed-citation>
    </ref>
    <ref id="btx517-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Schloss</surname><given-names>P.D.</given-names></name></person-group><etal>et al</etal> (<year>2009</year>) 
<article-title>Introducing mothur: open-source, platform-independent, community-supported software for describing and comparing microbial communities</article-title>. <source>Appl. Environ. Microbiol</source>., <volume>75</volume>, <fpage>7537</fpage>–<lpage>7541</lpage>.<pub-id pub-id-type="pmid">19801464</pub-id></mixed-citation>
    </ref>
    <ref id="btx517-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Wang</surname><given-names>Q.</given-names></name></person-group><etal>et al</etal> (<year>2007</year>) 
<article-title>Naive Bayesian classifier for rapid assignment of rRNA sequences into the new bacterial taxonomy</article-title>. <source>Appl. Environ. Microbiol</source>., <volume>73</volume>, <fpage>5261</fpage>–<lpage>5267</lpage>.<pub-id pub-id-type="pmid">17586664</pub-id></mixed-citation>
    </ref>
    <ref id="btx517-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Yilmaz</surname><given-names>P.</given-names></name></person-group><etal>et al</etal> (<year>2014</year>) 
<article-title>The SILVA and “All-species Living Tree Project (LTP)” taxonomic frameworks</article-title>. <source>Nucleic Acids Res</source>., <volume>42</volume>, <fpage>D643</fpage>–<lpage>D648</lpage>.<pub-id pub-id-type="pmid">24293649</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
