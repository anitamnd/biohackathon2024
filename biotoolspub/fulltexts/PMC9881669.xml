<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9881669</article-id>
    <article-id pub-id-type="pmid">29447341</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/bty080</article-id>
    <article-id pub-id-type="publisher-id">bty080</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Systems Biology</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ChemDistiller: an engine for metabolite annotation in mass spectrometry</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Laponogov</surname>
          <given-names>Ivan</given-names>
        </name>
        <aff>Department of Surgery and Cancer, Faculty of Medicine, Imperial College London, London, UK</aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Sadawi</surname>
          <given-names>Noureddin</given-names>
        </name>
        <aff>Department of Surgery and Cancer, Faculty of Medicine, Imperial College London, London, UK</aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Galea</surname>
          <given-names>Dieter</given-names>
        </name>
        <aff>Department of Surgery and Cancer, Faculty of Medicine, Imperial College London, London, UK</aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Mirnezami</surname>
          <given-names>Reza</given-names>
        </name>
        <aff>Department of Surgery and Cancer, Faculty of Medicine, Imperial College London, London, UK</aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Veselkov</surname>
          <given-names>Kirill A</given-names>
        </name>
        <aff>Department of Surgery and Cancer, Faculty of Medicine, Imperial College London, London, UK</aff>
        <xref rid="bty080-cor1" ref-type="corresp"/>
        <!--kirill.veselkov04@imperial.ac.uk-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Wren</surname>
          <given-names>Jonathan</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="bty080-cor1">To whom correspondence should be addressed. Email: <email>kirill.veselkov04@imperial.ac.uk</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>15</day>
      <month>6</month>
      <year>2018</year>
    </pub-date>
    <pub-date iso-8601-date="2018-02-12" pub-type="epub">
      <day>12</day>
      <month>2</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>12</day>
      <month>2</month>
      <year>2018</year>
    </pub-date>
    <volume>34</volume>
    <issue>12</issue>
    <fpage>2096</fpage>
    <lpage>2102</lpage>
    <history>
      <date date-type="received">
        <day>11</day>
        <month>10</month>
        <year>2017</year>
      </date>
      <date date-type="rev-recd">
        <day>19</day>
        <month>1</month>
        <year>2018</year>
      </date>
      <date date-type="accepted">
        <day>12</day>
        <month>2</month>
        <year>2018</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2018. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2018</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="bioinformatics_34_12_2096.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>High-resolution mass spectrometry permits simultaneous detection of thousands of different metabolites in biological samples; however, their automated annotation still presents a challenge due to the limited number of tailored computational solutions freely available to the scientific community.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>Here, we introduce ChemDistiller, a customizable engine that combines automated large-scale annotation of metabolites using tandem MS data with a compiled database containing tens of millions of compounds with pre-calculated ‘fingerprints’ and fragmentation patterns. Our tests using publicly and commercially available tandem MS spectra for reference compounds show retrievals rates comparable to or exceeding the ones obtainable by the current state-of-the-art solutions in the field while offering higher throughput, scalability and processing speed.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>Source code freely available for download at <ext-link xlink:href="https://bitbucket.org/iAnalytica/chemdistillerpython" ext-link-type="uri">https://bitbucket.org/iAnalytica/chemdistillerpython</ext-link>.</p>
      </sec>
      <sec id="s4">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>BBSRC</institution>
            <institution-id institution-id-type="doi">10.13039/501100000268</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>BB/L020858/1</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution>EU-METASPACE</institution>
        </funding-source>
        <award-id>34402</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution>Imperial College Stratified Medicine Graduate Training Programme in Systems Medicine and Spectroscopic Profiling</institution>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution>STRATiGRAD</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="7"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Genomic, proteomic and metabolomic molecular phenotyping approaches have significantly enhanced our understanding of the biological complexities that govern the balance between health and disease. Metabolomics involves the quantitative analysis of biochemical activity within a living system brought about by gene-environment interactions. Mass spectrometry (MS) represents one of the most widely utilized approaches in metabolic phenotyping. Modern MS analytical platforms are capable of profiling thousands of metabolites with high mass accuracy. In the case of mass spectrometry imaging (MSI), it is also possible to spatially resolve the distribution of metabolites within a biological sample with up to a near-cellular or even organelle-level resolution (<xref rid="bty080-B6" ref-type="bibr">Duenas <italic toggle="yes">et al.</italic>, 2017</xref>). Comprehensive characterization of the metabolome promises unique insights into the biological mechanisms regulating the status (healthy versus diseased, for example) of a living organism, and these in turn can be expected to lead to significant diagnostic and therapeutic advancements. A fundamental step in any metabolic profiling experiment is the identification of detected mass spectral peaks. Although a variety of tools are currently available to assist metabolite identification [MetFrag (<xref rid="bty080-B20" ref-type="bibr">Ruttkies <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="bty080-B25" ref-type="bibr">Wolf <italic toggle="yes">et al.</italic>, 2010</xref>), CSI:FingerID (<xref rid="bty080-B7" ref-type="bibr">Dührkop <italic toggle="yes">et al.</italic>, 2015</xref>), CFM-ID (<xref rid="bty080-B1" ref-type="bibr">Allen <italic toggle="yes">et al.</italic>, 2014</xref>) etc.], these are generally tailored to efficiently handle the annotation of small batch or individual MS datasets.</p>
    <p>Consequently, there is a critical need for solutions to be developed with the capacity for high-volume chemical annotation from MS derived spectra. The ideal solution would operate within a computational workflow that integrates a modular annotation engine with a dedicated database of candidate compounds. The annotation engine should fulfill the following requirements: (a) provide modular design incorporating state-of-the-art metabolite annotation approaches in customizable and easily extendable fashion; (b) be scalable and permit efficient batch processing of hundreds-to-thousands of metabolite spectra, cross-referencing these against large-scale chemical compound databases; (c) support multiprocessing and permit intuitive deployment, installation, use and modification and (d) operate within an open-access platform for enhanced data transparency.</p>
    <p>Here, we introduce the ChemDistiller platform which has been designed specifically to address the requirements outlined above for chemical annotation of tandem-MS derived data. ChemDistiller combines a custom-developed annotation engine for retrieval, filtering and scoring of candidate molecules based on tandem-MS experimental data (<xref rid="bty080-F1" ref-type="fig">Fig. 1</xref>) with the use of in-built large-scale chemical compound repositories (<xref rid="bty080-F1" ref-type="fig">Fig. 1</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Note</xref> S1). ChemDistiller relies on peak-picked data as the input [which can be generated by XCMS (<xref rid="bty080-B21" ref-type="bibr">Smith <italic toggle="yes">et al.</italic>, 2006</xref>), mzMine (<xref rid="bty080-B19" ref-type="bibr">Pluskal <italic toggle="yes">et al.</italic>, 2010</xref>) etc.], can benefit from additional information such as suggested formula or element composition [e.g. from SIRIUS (<xref rid="bty080-B3" ref-type="bibr">Bocker <italic toggle="yes">et al.</italic>, 2009</xref>) or MetaSpace (<xref rid="bty080-B17" ref-type="bibr">Palmer <italic toggle="yes">et al.</italic>, 2017</xref>)] and produces the lists of the best candidate compounds for the query tandem MS spectra in the hierarchical text format and as the HTML report.
</p>
    <fig position="float" id="bty080-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>ChemDistiller. Conceptual scheme of the engine </p>
      </caption>
      <graphic xlink:href="bioinformatics_34_12_2096_f1" position="float"/>
    </fig>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>For large-scale data processing, it is essential to have as many biochemical properties of molecules as possible pre-computed and stored in a dedicated database in order to minimize compound annotation time. Thus, we have collected, pre-processed and compiled data from publically available chemical databases including: (a) dedicated metabolome and biological compound databases [ChEBI (<xref rid="bty080-B5" ref-type="bibr">Degtyarenko <italic toggle="yes">et al.</italic>, 2008</xref>), LipidMaps (<xref rid="bty080-B8" ref-type="bibr">Fahy <italic toggle="yes">et al.</italic>, 2007</xref>), HMDB (<xref rid="bty080-B24" ref-type="bibr">Wishart <italic toggle="yes">et al.</italic>, 2013</xref>) and YMDB (<xref rid="bty080-B14" ref-type="bibr">Jewison <italic toggle="yes">et al.</italic>, 2012</xref>)]; (b) <italic toggle="yes">in silico</italic> predicted metabolite structures [MINE database series (<xref rid="bty080-B13" ref-type="bibr">Jeffryes <italic toggle="yes">et al.</italic>, 2015</xref>)]; (c) pharmacologically relevant compounds [ZINC (<xref rid="bty080-B12" ref-type="bibr">Irwin and Shoichet, 2005</xref>)] and (d) general large-scale compound databases [PubChem (<xref rid="bty080-B15" ref-type="bibr">Kim, <italic toggle="yes">et al.</italic>, 2016</xref>)]. To our knowledge this covers all major publicly available and downloadable compound databases (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Note</xref> S1 and <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref> for the full list of databases covered) and includes approximately 130 million chemical compounds in total. All databases have been converted into HDF5-based format for efficient data storage and access, with the following fields generated by OpenBabel/Pybel (<xref rid="bty080-B16" ref-type="bibr">O’Boyle <italic toggle="yes">et al.</italic>, 2011</xref>) from either SMILES (<xref rid="bty080-B23" ref-type="bibr">Weininger, 1988</xref>) or SDF/MDL format: InChI (<xref rid="bty080-B10" ref-type="bibr">Heller <italic toggle="yes">et al.</italic>, 2013</xref>), InChI key, exact mass, charge and formula (<xref rid="sup1" ref-type="supplementary-material">Supplementary Note</xref> S1). For each compound, chemical fingerprint and <italic toggle="yes">in silico</italic> fragmentation patterns were calculated and stored in our purpose-built HDF5-based database (<xref rid="sup1" ref-type="supplementary-material">Supplementary Note</xref> S1).</p>
    <p>To perform the tandem MS spectra annotation ChemDistiller applies a series of filters to the candidate compounds stored in the compound database; the first filter step generates a list of potential candidate compounds from the user selected database(s) based on m/z value (within a specified tolerance window) derived from the MS1 peak. The user can specify, a priori, whether to use all databases available (by default) or a specific one(s) according to requirements. Filtered molecules are then subjected to a set of additional customizable filters including chemical formula, elemental composition and metabolite likeness (<xref rid="bty080-F1" ref-type="fig">Fig. 1</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Note</xref> S1). Filtered candidate compounds are then ranked according to aggregated scores derived through a combination of machine-learning predicted chemical fingerprints [using an approach inspired by CSI:FingerID (<xref rid="bty080-B7" ref-type="bibr">Dührkop <italic toggle="yes">et al.</italic>, 2015</xref>)] and <italic toggle="yes">in silico</italic> generated compound fragmentation patterns [using MetFrag (<xref rid="bty080-B20" ref-type="bibr">Ruttkies <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="bty080-B25" ref-type="bibr">Wolf <italic toggle="yes">et al.</italic>, 2010</xref>) and CFM-ID (<xref rid="bty080-B1" ref-type="bibr">Allen <italic toggle="yes">et al.</italic>, 2014</xref>; <xref rid="bty080-B2" ref-type="bibr">Allen <italic toggle="yes">et al.</italic>, 2015</xref>) -like approaches]. Where necessary, the modular design enables the user to extend the annotation engine with custom-developed scoring approaches.</p>
    <p>In brief, the chemical fingerprinting approach (FingerScorer) calculates a list of chemical features for a given compound (the so-called ‘fingerprint’). This fingerprint is composed of a binary array where every feature (e.g. aromatic ring or -OH group), is set to ‘1’ if present, and ‘0’ otherwise. We united Klekota-Roth, MACCS, EState, Hybridization, PubChem, Substructure, Extended, GraphOnly and Fingerprinter fingerprint generators provided in CDK (<xref rid="bty080-B22" ref-type="bibr">Steinbeck <italic toggle="yes">et al.</italic>, 2006</xref>) to form a 11 416 bit long fingerprint per compound. Each fingerprint is stored in the generated databases in a compressed binary form for fast retrieval and analysis. In our application, a support vector machine-learning approach (SVM) [as implemented in libSVM software package (<xref rid="bty080-B4" ref-type="bibr">Chang and Lin, 2011</xref>)] was used first to train SVM models to predict molecular fingerprints from tandem MS experimental data using a set of reference ‘training’ spectra. For SVM class balance, only bits with occupancy between 0.05 and 0.95 from the entire array of fingerprint bits were considered (∼2500 bits out of 11 416 total). The obtained models are used to predict fingerprint bits for the ‘test’ compounds based on their merged tandem MS/MS spectra. Candidate compounds retrieved from chemical databases are then ranked according to the similarity of predicted versus actual molecular fingerprints using Jaccard similarity function. The best candidates are reported to the user.</p>
    <p>The <italic toggle="yes">in silico</italic> fragmentation approach (FragScorer) directly generates fragmentation patterns that are later compared with the experimentally observed tandem MS spectra. For each molecule in the database its fragmentation pattern is calculated by recursively breaking down its chemical bonds and aggregating the resulting fragmentation masses. Up to two bonds can be broken simultaneously with the default configuration. The molecules are broken in their neutral state, unless they are inherently charged and the fragments are stored in the database for candidate retrieval. Estimation of the bond breakage rates is not used in the current implementation. For candidate molecule retrieval, the experimental tandem MS/MS spectrum is normalized so that the sum of intensities is equal to 1.0 and then matched against the pre-calculated fragmentation pattern of the candidate compounds from the database. The adduct form and isotope information are applied at this stage to the predicted fragmentation pattern to match the experimental settings (thus the same pattern from the database can be used to predict both negative and positive mode ion fragments). Fragment intensity weighted match is used as a scoring function, i.e. the score is the sum of intensities of the matched peaks. Furthermore, we found that the retrieval rates are generally improved by addition of –1/+1 hydrogen mass to the predicted peaks, possibly accounting for tautomerism (empirically established correction, 5-fold cross-validated).</p>
    <p>When both FingerScorer and FragScorer are used together or additional scores are available from other methods, the reported scores are multiplied together by default to produce the TotalScore which is in turn used to sort candidate molecules and select the best ones. If only a single method is used, the TotalScore is set to the return value of this method. Our experimentation with different ways of combining the scores showed this approach to be the most effective and robust (data not shown), however, other methods for calculation of the combined TotalScore are easy to implement if needed. The maximal value the TotalScore can theoretically reach is 1.0 and the minimum is 0.0. In practice the values of the TotalScore are quite varied for correctly identified compounds (<xref rid="sup1" ref-type="supplementary-material">Supplementary Table S2</xref>), meaning that there are no absolute ‘good’ or ‘bad’ TotalScore values. However, if used relative to the maximum TotalScore value returned for the set of candidate compounds, the correct value is often close to 80–90% of the maximum value (<xref rid="sup1" ref-type="supplementary-material">Supplementary Table S3</xref>) both for small and large compound databases.</p>
    <p>If multiple MS2 spectra with different collision energy are available per MS1 peak, they are merged into one for analysis and re-normalized so that the sum of intensities equals to 1.0. This is roughly equivalent to having a spectrum recorded in the ramp mode. At the moment of generation of this manuscript both FingerScorer and FragScorer did not use the collision energy information, so for the current method implementation we would recommend using either the ramp mode or several collision energies covering the range which assures ∼50% fragmentation of the original MS1 peak as a default setting. This may change in the future, however, with the new generations of ChemDistiller.</p>
    <p>To our knowledge, the two approaches implemented (i.e. FingerScorer and FragScorer) represent the only methods that are scalable to the processing of millions of candidate compounds, unlike methods that are reliant on experimental databases limited to a smaller number of reference MS spectra.</p>
  </sec>
  <sec>
    <title>3 Results and discussion</title>
    <p>The primary objective in the development of ChemDistiller was to facilitate the annotation of tens of thousands of experimentally acquired tandem-MS spectra, and thus computational efficiency was of paramount importance. We have built upon the methodologies utilized in the existing solutions such as MetFrag (<xref rid="bty080-B20" ref-type="bibr">Ruttkies <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="bty080-B25" ref-type="bibr">Wolf <italic toggle="yes">et al.</italic>, 2010</xref>), CFM-ID (<xref rid="bty080-B2" ref-type="bibr">Allen <italic toggle="yes">et al.</italic>, 2015</xref>) or CSI:FingerID (<xref rid="bty080-B7" ref-type="bibr">Dührkop <italic toggle="yes">et al.</italic>, 2015</xref>) (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S1 and S2</xref> for test results and <xref rid="sup1" ref-type="supplementary-material">Supplementary Note</xref> S1 for details of the method implementations. See <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S3</xref> for the example of tandem MS spectrum annotation for test compounds). Our system benefits from storing calculated molecular properties and re-using these for subsequent compound annotation tasks without the need for re-calculation for each run (improvement over processing speed of MetFrag). Furthermore, our system is tailored for batch processing and does not rely on the web service availability which makes it more suitable for large scale high-throughput tandem MS spectra annotation than CFM-ID and CSI:FingerID platforms.</p>
    <p>For fingerprint based approaches, the models were trained using a combination of commercially (NIST14) and publicly [MassBank (<xref rid="bty080-B11" ref-type="bibr">Horai <italic toggle="yes">et al.</italic>, 2010</xref>) and HMDB (<xref rid="bty080-B24" ref-type="bibr">Wishart <italic toggle="yes">et al.</italic>, 2013</xref>)] available spectral databases of pure compounds. Only high mass accuracy spectra (m/z error &lt;20 ppm or &lt;0.005 Da) were used. This is because our preliminary analysis indicated that retrieval methods benefit greatly from high mass accuracy data due to the reduced search space for candidate molecules, especially when used with large scale chemical databases (e.g. when used with PubChem, the mass window of 1 Da for the molecular mass of 400 Da yields 250 079 candidate molecules, while the mass window of 20 ppm yields only 3229 candidate molecules, reducing the search space ∼77.5 times). For low mass accuracy spectra (i.e. for the data from the unit mass resolution spectrometers) one would need to use small tailored chemical databases (e.g. HMDB) in order to achieve sufficiently high retrieval rates. Redundant compound repetitions across multiple databases were filtered out based on their InChI identifiers (<xref rid="bty080-B10" ref-type="bibr">Heller <italic toggle="yes">et al.</italic>, 2013</xref>), leaving a final set of 6297 compounds with their corresponding tandem MS spectra. These data were split at random into training and test batches (80%:20%). Training and optimization of modeling parameters was performed on the training batch (80%) using nested 5-fold cross validation with the remaining batch (20%) being reserved for testing to minimize bias. The same training dataset was used to train CFM-ID and CSI:FingerID models (<xref rid="sup1" ref-type="supplementary-material">Supplementary Note</xref>s 3 and 4) and the same test dataset was employed throughout in order to compare our approach to the current state-of-the-art (MetFrag, CFM-ID and CSI:FingerID, <xref rid="sup1" ref-type="supplementary-material">Supplementary Note</xref>s 2–4). Retrieval rates were separately acquired for small (combination of HMDB, ChEBI, MassBank and NIST14) and large (combination of PubChem, HMDB, ChEBI, MassBank and NIST14) databases to estimate the performance of our methods and their combinations as well as compare them to the methods implemented in MetFrag, CFM-ID and CSI:FingerID under different conditions. In the case of the small database (HMDB, ChEBI, MassBank and NIST14; in combination totaling ∼130 thousand compounds), 24 candidates were on average retrieved per single MS1 peak, of which there were 1153 submitted for annotation (862 in positive ion mode and 291 in negative ion mode). For the large database (PubChem, HMDB, ChEBI, MassBank and NIST14; in combination totaling ∼87 million compounds), ∼10 000 candidates were on average retrieved per single MS1 peak for the same set of peaks submitted for annotation. The performance results for all modeling approaches for the test batch are summarized in <xref rid="bty080-T1" ref-type="table">Table 1</xref> and Supplementary Figures S1 and S2, where 20 ppm or greater mass accuracy has been assumed throughout for database compound retrieval.
<table-wrap position="float" id="bty080-T1"><label>Table 1.</label><caption><p>Retrieval statistics (per cent)</p></caption><table frame="hsides" rules="groups"><colgroup span="1"><col align="left" valign="top" span="1"/><col align="char" char="." valign="top" span="1"/><col align="char" char="." valign="top" span="1"/><col align="char" char="." valign="top" span="1"/><col align="char" char="." valign="top" span="1"/><col align="char" char="." valign="top" span="1"/><col align="char" char="." valign="top" span="1"/></colgroup><thead><tr><th rowspan="2" colspan="1"/><th colspan="3" rowspan="1">Positive mode<hr/></th><th colspan="3" rowspan="1">Negative mode<hr/></th></tr><tr><th rowspan="1" colspan="1">Baseline performance</th><th rowspan="1" colspan="1">+Element filter</th><th rowspan="1" colspan="1">+Known formula</th><th rowspan="1" colspan="1">Baseline performance</th><th rowspan="1" colspan="1">+Element filter</th><th rowspan="1" colspan="1">+Known formula</th></tr></thead><tbody><tr><td colspan="6" rowspan="1">Small database (HMDB, MassBank, ChEBI, NIST14) Correct in <bold>TOP 1</bold><hr/></td></tr><tr><td rowspan="1" colspan="1">FingerScorer</td><td rowspan="1" colspan="1">37.5 ± 3.5</td><td rowspan="1" colspan="1">44.5 ± 3.5 (+7.0)</td><td rowspan="1" colspan="1">46.0 ± 3.0 (+8.5)</td><td rowspan="1" colspan="1">32.5 ± 4.5</td><td rowspan="1" colspan="1">37.5 ± 4.5 (+5.0)</td><td rowspan="1" colspan="1">38.5 ± 4.5 (+6.0)</td></tr><tr><td rowspan="1" colspan="1">FragScorer</td><td rowspan="1" colspan="1">50.0 ± 2.0</td><td rowspan="1" colspan="1">54.0 ± 2.0 (+4.0)</td><td rowspan="1" colspan="1">56.0 ± 2.0 (+6.0)</td><td rowspan="1" colspan="1">44.0 ± 3.0</td><td rowspan="1" colspan="1">45.5 ± 3.5 (+1.5)</td><td rowspan="1" colspan="1">47.0 ± 4.0 (+3.0)</td></tr><tr><td rowspan="1" colspan="1">FingerScorer&amp;FragScorer</td><td rowspan="1" colspan="1">49.0 ± 2.0</td><td rowspan="1" colspan="1">52.0 ± 2.0 (+3.0)</td><td rowspan="1" colspan="1">53.0 ± 2.0 (+4.0)</td><td rowspan="1" colspan="1">42.5 ± 3.5</td><td rowspan="1" colspan="1">45.0 ± 3.0 (+2.5)</td><td rowspan="1" colspan="1">46.0 ± 3.0 (+3.5)</td></tr><tr><td rowspan="1" colspan="1">MetFrag</td><td rowspan="1" colspan="1">51.7 ± 0.0</td><td rowspan="1" colspan="1">51.7 ± 0.0 (+0.0)</td><td rowspan="1" colspan="1">51.7 ± 0.0 (+0.0)</td><td rowspan="1" colspan="1">45.0 ± 0.0</td><td rowspan="1" colspan="1">45.0 ± 0.0 (+0.0)</td><td rowspan="1" colspan="1">45.0 ± 0.0 (+0.0)</td></tr><tr><td rowspan="1" colspan="1">CFM-ID<xref rid="tblfn1" ref-type="table-fn"><sup>a</sup></xref></td><td rowspan="1" colspan="1">41.0 ± 4.0</td><td rowspan="1" colspan="1">47.5 ± 3.5 (+6.5)</td><td rowspan="1" colspan="1">48.5 ± 2.5 (+7.5)</td><td rowspan="1" colspan="1">36.5 ± 4.5</td><td rowspan="1" colspan="1">41.5 ± 3.5 (+5.0)</td><td rowspan="1" colspan="1">42.5 ± 3.5 (+6.0)</td></tr><tr><td rowspan="1" colspan="1">CSI:FingerID</td><td align="center" rowspan="1" colspan="1">N/A</td><td rowspan="1" colspan="1">42.5 ± 2.5 </td><td rowspan="1" colspan="1">45.0 ± 3.0 (+2.5)</td><td align="center" rowspan="1" colspan="1">N/A</td><td rowspan="1" colspan="1">38.0 ± 5.0 </td><td rowspan="1" colspan="1">39.0 ± 5.0 (+1.0)</td></tr><tr><td colspan="7" rowspan="1">Small database (HMDB, MassBank, ChEBI, NIST) Correct in <bold>TOP 5</bold></td></tr><tr><td rowspan="1" colspan="1">FingerScorer</td><td rowspan="1" colspan="1">80.0 ± 3.0</td><td rowspan="1" colspan="1">83.0 ± 3.0 (+3.0)</td><td rowspan="1" colspan="1">83.5 ± 2.5 (+3.5)</td><td rowspan="1" colspan="1">71.5 ± 5.5</td><td rowspan="1" colspan="1">74.5 ± 5.5 (+3.0)</td><td rowspan="1" colspan="1">75.0 ± 5.0 (+3.5)</td></tr><tr><td rowspan="1" colspan="1">FragScorer</td><td rowspan="1" colspan="1">82.5 ± 2.5</td><td rowspan="1" colspan="1">84.0 ± 2.0 (+1.5)</td><td rowspan="1" colspan="1">84.5 ± 2.5 (+2.0)</td><td rowspan="1" colspan="1">76.5 ± 4.5</td><td rowspan="1" colspan="1">77.5 ± 4.5 (+1.0)</td><td rowspan="1" colspan="1">77.5 ± 4.5 (+1.0)</td></tr><tr><td rowspan="1" colspan="1">FingerScorer&amp;FragScorer</td><td rowspan="1" colspan="1">86.0 ± 2.0</td><td rowspan="1" colspan="1">87.0 ± 2.0 (+1.0)</td><td rowspan="1" colspan="1">87.0 ± 2.0 (+1.0)</td><td rowspan="1" colspan="1">78.0 ± 4.0</td><td rowspan="1" colspan="1">80.0 ± 4.0 (+2.0)</td><td rowspan="1" colspan="1">80.0 ± 4.0 (+2.0)</td></tr><tr><td rowspan="1" colspan="1">MetFrag</td><td rowspan="1" colspan="1">86.5 ± 0.0</td><td rowspan="1" colspan="1">88.6 ± 0.0 (+2.1)</td><td rowspan="1" colspan="1">89.1 ± 0.0 (+2.6)</td><td rowspan="1" colspan="1">83.5 ± 0.0</td><td rowspan="1" colspan="1">85.6 ± 0.0 (+2.1)</td><td rowspan="1" colspan="1">85.6 ± 0.0 (+2.1)</td></tr><tr><td rowspan="1" colspan="1">CFM-ID<xref rid="tblfn1" ref-type="table-fn"><sup>a</sup></xref></td><td rowspan="1" colspan="1">76.5 ± 3.5</td><td rowspan="1" colspan="1">80.5 ± 3.5 (+4.0)</td><td rowspan="1" colspan="1">82.0 ± 2.0 (+5.5)</td><td rowspan="1" colspan="1">68.0 ± 7.0</td><td rowspan="1" colspan="1">74.0 ± 2.0 (+6.0)</td><td rowspan="1" colspan="1">74.0 ± 2.0 (+6.0)</td></tr><tr><td rowspan="1" colspan="1">CSI:FingerID</td><td align="center" rowspan="1" colspan="1">N/A</td><td rowspan="1" colspan="1">76.0 ± 3.0 </td><td rowspan="1" colspan="1">76.5 ± 2.5 (+0.5)</td><td align="center" rowspan="1" colspan="1">N/A</td><td rowspan="1" colspan="1">69.0 ± 5.0 </td><td rowspan="1" colspan="1">69.5 ± 4.5 (+0.5)</td></tr><tr><td colspan="7" rowspan="1">Large database (PubChem, HMDB, MassBank, ChEBI) Correct in <bold>TOP 20</bold></td></tr><tr><td rowspan="1" colspan="1">FingerScorer</td><td rowspan="1" colspan="1">48.5 ± 4.5</td><td rowspan="1" colspan="1">52.0 ± 5.0 (+3.5)</td><td rowspan="1" colspan="1">56.5 ± 5.5 (+8.0)</td><td rowspan="1" colspan="1">47.0 ± 7.0</td><td rowspan="1" colspan="1">52.5 ± 8.5 (+5.5)</td><td rowspan="1" colspan="1">56.0 ± 9.0 (+9.0)</td></tr><tr><td rowspan="1" colspan="1">FragScorer</td><td rowspan="1" colspan="1">26.5 ± 1.5</td><td rowspan="1" colspan="1">34.5 ± 1.5 (+8.0)</td><td rowspan="1" colspan="1">41.5 ± 1.5 (+15.0)</td><td rowspan="1" colspan="1">36.5 ± 2.5</td><td rowspan="1" colspan="1">45.0 ± 4.0 (+8.5)</td><td rowspan="1" colspan="1">45.5 ± 3.5 (+9.0)</td></tr><tr><td rowspan="1" colspan="1">FingerScorer&amp;FragScorer</td><td rowspan="1" colspan="1">45.0 ± 3.0</td><td rowspan="1" colspan="1">49.5 ± 3.5 (+4.5)</td><td rowspan="1" colspan="1">52.5 ± 3.5 (+7.5)</td><td rowspan="1" colspan="1">50.5 ± 7.5</td><td rowspan="1" colspan="1">56.0 ± 8.0 (+5.5)</td><td rowspan="1" colspan="1">58.5 ± 8.5 (+8.0)</td></tr><tr><td rowspan="1" colspan="1">MetFrag</td><td rowspan="1" colspan="1">32.8 ± 0.0</td><td rowspan="1" colspan="1">41.4 ± 0.0 (+8.6)</td><td rowspan="1" colspan="1">50.0 ± 0.0 (+17.2)</td><td rowspan="1" colspan="1">41.2 ± 0.0</td><td rowspan="1" colspan="1">48.5 ± 0.0 (+7.3)</td><td rowspan="1" colspan="1">50.2 ± 0.0 (+9.0)</td></tr><tr><td rowspan="1" colspan="1">CFM-ID<xref rid="tblfn1" ref-type="table-fn"><sup>a</sup></xref></td><td rowspan="1" colspan="1">23.0 ± 1.0</td><td rowspan="1" colspan="1">31.5 ± 1.5 (+8.5)</td><td rowspan="1" colspan="1">37.5 ± 1.5 (+14.6)</td><td rowspan="1" colspan="1">30.0 ± 0.0</td><td rowspan="1" colspan="1">34.5 ± 0.5 (+4.5)</td><td rowspan="1" colspan="1">38.0 ± 1.0 (+8.0)</td></tr><tr><td rowspan="1" colspan="1">CSI:FingerID</td><td align="center" rowspan="1" colspan="1">N/A</td><td rowspan="1" colspan="1">34.5 ± 4.5 </td><td rowspan="1" colspan="1">38.0 ± 5.0 (+3.5)</td><td align="center" rowspan="1" colspan="1">N/A</td><td rowspan="1" colspan="1">41.5 ± 6.5 </td><td rowspan="1" colspan="1">43.5 ± 6.5 (+2.0)</td></tr></tbody></table><table-wrap-foot><fn id="tblfn1"><label>a</label><p>For CFM-ID the best retrieval rate is reported for all scoring functions used, however the best performing scoring function was not consistent between different tests (<xref rid="sup1" ref-type="supplementary-material">Supplementary Note</xref> S3). Improvement relative to baseline performance is shown in brackets.</p></fn></table-wrap-foot></table-wrap></p>
    <sec>
      <title>3.1 ChemDistiller performance</title>
      <p>Overall, our methodology achieved up to 37.5%/32.5% (here and further: positive/negative experimental acquisition mode) correct annotations in top 1 (i.e. the correct annotation will be among the first top <italic toggle="yes">n</italic> candidates in 37.5%/32.5% of the test cases with <italic toggle="yes">n</italic> being equal to 1 in this case) for the small database with FingerScorer and up to 50%/44% correct annotations using FragScorer. The combination of both approaches performed slightly less well for the top 1 rank (49%/42.5%) compared to FragScorer on its own. However, for the correct annotation in top 5 using the small database, the combination of the two was shown to outperform any one approach used in isolation (combined 86%/78% versus individual 80%/71.5% and 82.5%/76.5% for FingerScorer and FragScorer, respectively). For the large database, FingerScorer significantly outperformed FragScorer with the retrieval rates for the top 20 being 48.5%/47% versus 26.5%/36.5% for FingerScorer and FragScorer, respectively. The combination of the two scorers performed slightly less efficiently compared to the FingerScorer on its own for positive mode (45% versus 48.5%), however in negative mode the combined approach was found to be superior (50.5% for the combination, 47.0% for FingerScorer). Overall the combination of the two scorers either outperforms the individual scorers, or closely follows the best individual scorer (i.e. FragScorer for the small, metabolite-targeting database and FingerScorer for the large general database). As such the combination of the two scorers can be recommended in circumstances where overall robustness is more critical than the top possible performance.</p>
      <p>Furthermore, addition of the elemental composition information or known chemical formula [for example, determined by SIRIUS (Bocker <italic toggle="yes">et al.</italic>, 2009) or MetaSpace (<xref rid="bty080-B17" ref-type="bibr">Palmer <italic toggle="yes">et al.</italic>, 2017</xref>) engine] can increase the retrieval rates further by 1–8.5% for the small and 3.5–17.2% for the large databases, respectively. Interestingly, the comparatively weaker scorers benefit generally more from the elemental composition and known chemical formula information; this is best exemplified in the case of FragScorer, where retrieval rates for the top 20 candidates from the large chemical database was seen to increase from 26.5% to 41.5% (<xref rid="bty080-T1" ref-type="table">Table 1</xref>).</p>
      <p>All retrieval rate tests were performed using our standalone workstation (8 core Intel <sup>®</sup> Xeon <sup>®</sup> E5-2630 v3 @2.4 GHz, 64 Gb RAM). The number of available CPU cores was limited to 6 for worker threads + 1 for the main thread for these tests. Processing of 1153 test spectra took from 2 min using FragScorer on its own (30 min with FragScorer and FingerScorer combined) and a small database (HMDB, MassBank, NIST14, ChEBI; in combination totaling ∼130 thousand candidate compounds) to 4–4.5 h using both FragScorer and FingerScorer and a large database (PubChem, HMDB, ChEBI, MassBank and NIST14; in combination totaling ∼87 million candidate compounds). The memory footprint registered was of ∼4 Gb for the main thread and ∼400 Mb per worker thread. These results show that tandem MS spectra (each corresponding to the individual compound of interest) can be annotated at a rate of at least several thousand spectra per day using an ordinary desk-top PC (4–6 cores, 16 Gb RAM recommended, ∼80 Gb HDD free space for the full set of databases and SVMs) when employing the combination of both FingerScorer and FragScorer and the large database of ∼87 million candidate compounds (FingerScorer was used with the radial kernel SVM for better prediction at the expense of the longer running times). If smaller tailored databases are used, the number of spectra annotated per day can easily reach 50 000–1 000 000 depending upon the selection of the scoring methods. Further speed-ups can be achieved by using SSD disks for the database storage or deployment of ChemDistiller onto HPC cluster.</p>
    </sec>
    <sec>
      <title>3.2 ChemDistiller compared to the state-of-the-art solutions available in the field (i.e. MetFrag, CFM-ID and CSI:FingerID)</title>
      <p>Compared with other state-of-the-art solutions in the field, we have found that under the same conditions MetFrag can slightly outperform our best scorer for the top 1 position in the case of the small database (51.7%/45% versus 50%/44%) or the combination of our scorers for the top 5 (86.5%/83.5% versus 86%/78%). However, when applied to the large database our methods performed noticeably better (32.8%/41.2% versus 48.5%/47% versus 45%/50.5% for MetFrag, FingerScorer and the combination of the FingerScorer and FragScorer, respectively, see <xref rid="bty080-T1" ref-type="table">Table 1</xref>). Furthermore, thanks to the stored pre-calculated fragmentation patterns in the database, our method performs ∼6–8 times faster than the current implementation of MetFrag where fragmentation patterns are calculated each time ‘on the fly’. The noticeable discrepancy between retrieval rates for positive and negative mode data is likely attributed to the differences in (a) the size of the test/training data and (b) the molecular weight and molecular type distribution differences between the datasets of the two experimental acquisition modes. Overall, in our experience, the command line version of MetFrag (<xref rid="bty080-B20" ref-type="bibr">Ruttkies <italic toggle="yes">et al.</italic>, 2016</xref>) proved to be the most simple to use and robust among the available state-of-the-art solutions in the field. MetFrag is very efficient at <italic toggle="yes">in silico</italic> fragmentation based retrieval. It would be a very useful addition to the scoring methods presented herein, if the possibility of pre-calculation and storing of the predicted fragmentation patterns from MetFrag was realized.</p>
      <p>When comparing our engine to CFM-ID (<xref rid="bty080-B1" ref-type="bibr">Allen <italic toggle="yes">et al.</italic>, 2014</xref>; <xref rid="bty080-B2" ref-type="bibr">Allen <italic toggle="yes">et al.</italic>, 2015</xref>) we had to focus on the single energy method implemented in CFM-ID (<xref rid="sup1" ref-type="supplementary-material">Supplementary Note</xref> S3) as the multiple energy method was found to be too computationally expensive for the entire training dataset with no significant improvement in the performance relative to the single energy one. To our surprise, in all our tests our methods managed to provide better annotation scores than CFM-ID (improvement ranged from ∼4% to ∼20% depending upon the acquisition mode, used method and the database size, see <xref rid="bty080-T1" ref-type="table">Table 1</xref>).</p>
      <p>For CSI:FingerID, we used SIRIUS to generate fragmentation trees and then train and optimize parameters of the kernels used by the FingerID python script (<xref rid="sup1" ref-type="supplementary-material">Supplementary Note</xref> S4). The retrieval rates obtained for CSI:FingerID were close to the ones observed for our methods, however our combined methods (FingerScorer and FragScorer) outperformed CSI:FingerID by a small margin in all the tests (improvement ranged from ∼8% to ∼15% depending upon the acquisition mode and the database size, see <xref rid="bty080-T1" ref-type="table">Table 1</xref>).</p>
    </sec>
    <sec>
      <title>3.3 Results overlap between different methods</title>
      <p>Interestingly, for all methods the returned results did not overlap 100% (<xref rid="sup1" ref-type="supplementary-material">Supplementary Table S5</xref>) with the overlap percentages varying from 74% to 93% for small molecular databases (HMDB, NIST14, MassBank, ChEBI) and from 27% to 78% for large molecular databases (PubChem, HMDB, MassBank, ChEBI) depending on the combinations of methods and filters used. This means that the success of the annotation is both method and query molecule dependent, allowing us to theorize that for different classes of metabolites selective application of the methods could prove to be a more effective strategy than a direct combination of available methods to generate a single TotalScore. However, it remains to be seen if it is possible to determine the best method to use based on the spectrum of the query compound in a situation when the class of this compound is not known a priori. Though answering this question falls outside of the scope of this paper, we anticipate it could open up a new area of research in the field of annotation of the tandem MS spectra of metabolites.</p>
    </sec>
    <sec>
      <title>3.4 Metabolite likeness filter</title>
      <p>In an attempt to further improve the retrieval performance of our solution, we implemented machine learning based classification of candidate molecules into metabolites and non-metabolites according to their ‘metabolite-likeness’ using an approach similar to that proposed previously by J.E. Peironecely <italic toggle="yes">et al.</italic> (<xref rid="bty080-B18" ref-type="bibr">Peironcely <italic toggle="yes">et al.</italic>, 2011</xref>). This approach is expected to help reduce the search space for large databases by focusing only on compounds which are likely to originate from living organisms. HMDB (<xref rid="bty080-B24" ref-type="bibr">Wishart <italic toggle="yes">et al.</italic>, 2013</xref>), MassBank (<xref rid="bty080-B11" ref-type="bibr">Horai <italic toggle="yes">et al.</italic>, 2010</xref>), ChEBI (<xref rid="bty080-B5" ref-type="bibr">Degtyarenko <italic toggle="yes">et al.</italic>, 2008</xref>), PlantCyc (<xref rid="bty080-B26" ref-type="bibr">Zhang <italic toggle="yes">et al.</italic>, 2010</xref>), ECMDB (<xref rid="bty080-B9" ref-type="bibr">Guo <italic toggle="yes">et al.</italic>, 2013</xref>), YMDB (<xref rid="bty080-B14" ref-type="bibr">Jewison <italic toggle="yes">et al.</italic>, 2012</xref>), BMDB (Bovine Metabolome Database) and LipidMaps (<xref rid="bty080-B8" ref-type="bibr">Fahy <italic toggle="yes">et al.</italic>, 2007</xref>) were assumed to be the databases of metabolites, while the selection of compounds from ZINC (<xref rid="bty080-B12" ref-type="bibr">Irwin and Shoichet, 2005</xref>) (<xref rid="sup1" ref-type="supplementary-material">Supplementary Note</xref> S5) were assumed to be non-metabolites. We used pre-calculated fingerprints to train a two-class SVM, achieving ∼95% accuracy with 5-fold cross-validation. The model was applied to calculate metabolite likeness for all compounds in our collection of databases and the appropriate filter was added to the annotation pipeline. In general metabolite databases such as HMDB (<xref rid="bty080-B24" ref-type="bibr">Wishart <italic toggle="yes">et al.</italic>, 2013</xref>), LipidMaps (<xref rid="bty080-B8" ref-type="bibr">Fahy <italic toggle="yes">et al.</italic>, 2007</xref>) and YMDB (<xref rid="bty080-B14" ref-type="bibr">Jewison <italic toggle="yes">et al.</italic>, 2012</xref>) were predicted to contain over 90%, while PubChem (<xref rid="bty080-B15" ref-type="bibr">Kim <italic toggle="yes">et al.</italic>, 2016</xref>) was estimated to have ∼35% and ZINC (<xref rid="bty080-B12" ref-type="bibr">Irwin and Shoichet, 2005</xref>)–∼20% metabolite like entries (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S4</xref> for the full list of predicted percentages of metabolite like entries). Approximately 79% of our NIST/MassBank (<xref rid="bty080-B11" ref-type="bibr">Horai <italic toggle="yes">et al.</italic>, 2010</xref>) reference compounds were classified as metabolites and the subsequent analysis was performed using these metabolite-like compounds only to estimate the improvement in retrieval with the addition of this filter. PubChem (<xref rid="bty080-B15" ref-type="bibr">Kim <italic toggle="yes">et al.</italic>, 2016</xref>) was selected as a representative large database. We observed a decrease in the average number of candidates per annotation from ∼10 k down to ∼4 k with the metabolite likeness filter applied and further down to 1 k with the known formula assumed. However, the improvements observed in retrieval rates were comparatively more modest (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S6</xref>) adding 3–4% improvement on average, compared to 6–9% gained by the addition of known formula. This can be explained by the majority of filtering power being provided by the tandem MS based methods in this case.</p>
      <p>In particular, machine learning based approach of FingerScorer seem to dominate in terms of performance when applied to large scale compound databases. This potentially could be explained by the initial bias of the training set of molecules towards the ‘biologically relevant’ ones (e.g. metabolites, drugs) as those are generally of a higher interest to the scientific community and the databases of the reference compound tandem MS spectra would target those first. One can see it as ‘metabolite likeness’ filtering being already partially realized as part of the FingerScorer method and when applied to the large databases, ‘biologically relevant’ molecules are more likely to be picked first than the ‘biologically irrelevant’ ones. This also explains why the search against small databases of biologically relevant compounds does not benefit as much from machine learning approach–the databases are already focused on biological compounds and thus the benefit of the ‘biological relevance’ bias is negated. The bias towards ‘biological relevance’ of the FingerScorer is not possible to overcome without additional training datasets being available which would focus on non-‘biologically relevant’ compounds. Thus, our recommendation is to use both FingerScorer and FragScorer together in the situation where the ‘biological relevance’ of the compound in question is not yet determined. FragScorer is relying on a set of more general rules of fragmentation and is not biased towards ‘biologically relevant’ compounds.</p>
      <p>In the current version of ChemDistiller, the metabolite likeness filter is not enabled by default in order to avoid exclusion of potentially important non-metabolites (e.g. synthetic drugs) and should be switched on by the user where needed.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Conclusion</title>
    <p>In conclusion, ChemDistiller is comparable to the state-of-the-art tools available for metabolite annotation using tandem MS data while at the same time offering customizability, speed and high-throughput batch processing. It supports multi-processing and multiple operating systems. With its core written in Python, it is easy to install, use and further develop/expand. It has minimal library dependencies and modular architecture with standardized interfaces for filter and scorer classes.</p>
    <p>In the near future, we plan to develop an independent web interface and a server-based solution for individual and batch processing of tandem MS data. Additional filters and scorers will be developed and deployed as new experimental data becomes available and downloadable databases and SVM models are updated accordingly, with particular focus on the collision cross-section energy as an alternative to LC (liquid chromatography) retention time prediction.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>Supplementary Data</label>
      <media xlink:href="bioinformatics_34_12_2096_s2.doc">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors thank L.-F. Nothias and P. Dorrestein (UCSD) for their help with aggregation of publicly available chemical databases. E. Chekmeneva is thanked for help with non-metabolite database selection. METASPACE consortium is thanked for their help, support and constructive criticism.</p>
    <sec>
      <title>Funding</title>
      <p>The authors acknowledge the financial support for bioinformatics developments as part of BBSRC (BB/L020858/1) and EU-METASPACE (34402) projects; DG acknowledges Imperial College Stratified Medicine Graduate Training Programme in Systems Medicine and Spectroscopic Profiling (STRATiGRAD); KV acknowledges Waters corporation for funding and support throughout this study.</p>
      <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="bty080-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Allen</surname>
 <given-names>F.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2014</year>) 
<article-title>CFM-ID: a web server for annotation, spectrum prediction and metabolite identification from tandem mass spectra</article-title>. <source>Nucleic Acids Res</source>., <volume>42(Web Server issue)</volume>, <fpage>W94</fpage>–<lpage>W99</lpage>.<pub-id pub-id-type="pmid">24895432</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Allen</surname>
 <given-names>F.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2015</year>) 
<article-title>Competitive fragmentation modeling of ESI–MS/MS spectra for putative metabolite identification</article-title>. <source>Metabolomics</source>, <volume>11</volume>, <fpage>98</fpage>–<lpage>110</lpage>.</mixed-citation>
    </ref>
    <ref id="bty080-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bocker</surname>
 <given-names>S.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2009</year>) 
<article-title>SIRIUS: decomposing isotope patterns for metabolite identification</article-title>. <source>Bioinformatics</source>, <volume>25</volume>, <fpage>218</fpage>–<lpage>224</lpage>.<pub-id pub-id-type="pmid">19015140</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chang</surname>
 <given-names>C.-C.</given-names></string-name>, <string-name><surname>Lin</surname><given-names>C.-J.</given-names></string-name></person-group> (<year>2011</year>) 
<article-title>LIBSVM</article-title>. <source>A library for support vector machines. ACM TIST</source>, <volume>2</volume>, 27:1–27:7.</mixed-citation>
    </ref>
    <ref id="bty080-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Degtyarenko</surname>
 <given-names>K.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2008</year>) 
<article-title>ChEBI: a database and ontology for chemical entities of biological interest</article-title>. <source>Nucleic Acids Res</source>., <volume>36(Database issue)</volume>, <fpage>D344</fpage>–<lpage>D350</lpage>.<pub-id pub-id-type="pmid">17932057</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Duenas</surname>
 <given-names>M.E.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2017</year>) 
<article-title>High spatial resolution mass spectrometry imaging reveals the genetically programmed, developmental modification of the distribution of thylakoid membrane lipids among individual cells of maize leaf</article-title>. <source>Plant J</source>., <volume>89</volume>, <fpage>825</fpage>–<lpage>838</lpage>.<pub-id pub-id-type="pmid">27859865</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dührkop</surname>
 <given-names>K.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2015</year>) 
<article-title>Searching molecular structure databases with tandem mass spectra using CSI: fingerID</article-title>. <source>Proc. Natl. Acad. Sci</source>., <volume>112</volume>, <fpage>12580</fpage>–<lpage>12585</lpage>.<pub-id pub-id-type="pmid">26392543</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Fahy</surname>
 <given-names>E.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2007</year>) 
<article-title>LIPID MAPS online tools for lipid research</article-title>. <source>Nucleic Acids Res</source>., <volume>35(Web Server issue)</volume>, <fpage>W606</fpage>–<lpage>W612</lpage>.<pub-id pub-id-type="pmid">17584797</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Guo</surname>
 <given-names>A.C.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2013</year>) 
<article-title>ECMDB: the <italic toggle="yes">E. coli</italic> metabolome database</article-title>. <source>Nucleic Acids Res</source>., <volume>41</volume>, <fpage>D625</fpage>–<lpage>D630</lpage>. (Database issue),<pub-id pub-id-type="pmid">23109553</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Heller</surname>
 <given-names>S.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2013</year>) 
<article-title>InChI–the worldwide chemical structure identifier standard</article-title>. <source>J. Cheminform</source>., <volume>5</volume>, <fpage>7</fpage>.<pub-id pub-id-type="pmid">23343401</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Horai</surname>
 <given-names>H.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2010</year>) 
<article-title>MassBank: a public repository for sharing mass spectral data for life sciences</article-title>. <source>J. Mass Spectrom</source>, <volume>45</volume>, <fpage>703</fpage>–<lpage>714</lpage>.<pub-id pub-id-type="pmid">20623627</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Irwin</surname>
 <given-names>J.J.</given-names></string-name>, <string-name><surname>Shoichet</surname><given-names>B.K.</given-names></string-name></person-group> (<year>2005</year>) 
<article-title>ZINC - a free database of commercially available compounds for virtual screening</article-title>. <source>J. Chem. Inf. Model</source>, <volume>45</volume>, <fpage>177</fpage>–<lpage>182</lpage>.<pub-id pub-id-type="pmid">15667143</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jeffryes</surname>
 <given-names>J.G.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2015</year>) 
<article-title>MINEs: open access databases of computationally predicted enzyme promiscuity products for untargeted metabolomics</article-title>. <source>J. Cheminform</source>., <volume>7</volume>, <fpage>44.</fpage><pub-id pub-id-type="pmid">26322134</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jewison</surname>
 <given-names>T.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2012</year>) 
<article-title>YMDB: the yeast metabolome database</article-title>. <source>Nucleic Acids Res</source>., <volume>40(Database issue)</volume>, <fpage>D815</fpage>–<lpage>D820</lpage>.<pub-id pub-id-type="pmid">22064855</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kim</surname>
 <given-names>S.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2016</year>) 
<article-title>PubChem substance and compound databases</article-title>. <source>Nucleic Acids Res</source>., <volume>44</volume>, <fpage>D1202</fpage>–<lpage>D1213</lpage>.<pub-id pub-id-type="pmid">26400175</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>O’Boyle</surname>
 <given-names>N.M.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2011</year>) 
<article-title>Open Babel: an open chemical toolbox</article-title>. <source>J. Cheminform</source>., <volume>3</volume>, <fpage>33</fpage>.<pub-id pub-id-type="pmid">21982300</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Palmer</surname>
 <given-names>A.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2017</year>) 
<article-title>FDR-controlled metabolite annotation for high-resolution imaging mass spectrometry</article-title>. <source>Nat. Methods</source>, <volume>14</volume>, <fpage>57</fpage>–<lpage>60</lpage>.<pub-id pub-id-type="pmid">27842059</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Peironcely</surname>
 <given-names>J.E.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2011</year>) 
<article-title>Understanding and classifying metabolite space and metabolite-likeness</article-title>. <source>PLoS One</source>, <volume>6</volume>, <fpage>e28966.</fpage><pub-id pub-id-type="pmid">22194963</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pluskal</surname>
 <given-names>T.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2010</year>) 
<article-title>MZmine 2: modular framework for processing, visualizing, and analyzing mass spectrometry-based molecular profile data</article-title>. <source>BMC Bioinformatics</source>, <volume>11</volume>, <fpage>395</fpage>.<pub-id pub-id-type="pmid">20650010</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ruttkies</surname>
 <given-names>C.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2016</year>) 
<article-title>MetFrag relaunched: incorporating strategies beyond <italic toggle="yes">in silico</italic> fragmentation</article-title>. <source>J. Cheminform</source>., <volume>8</volume>, <fpage>3</fpage>.<pub-id pub-id-type="pmid">26834843</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Smith</surname>
 <given-names>C.A.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2006</year>) 
<article-title>XCMS: processing mass spectrometry data for metabolite profiling using nonlinear peak alignment, matching, and identification</article-title>. <source>Anal. Chem</source>., <volume>78</volume>, <fpage>779</fpage>–<lpage>787</lpage>.<pub-id pub-id-type="pmid">16448051</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Steinbeck</surname>
 <given-names>C.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2006</year>) 
<article-title>Recent developments of the chemistry development kit (CDK)—an open-source java library for chemo- and bio-informatics</article-title>. <source>Curr. Pharm. Des</source>., <volume>12</volume>, <fpage>2111</fpage>–<lpage>2120</lpage>.<pub-id pub-id-type="pmid">16796559</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Weininger</surname>
 <given-names>D.</given-names></string-name></person-group> (<year>1988</year>) 
<article-title>SMILES, a chemical language and information system. 1. Introduction to methodology and encoding rules</article-title>. <source>J. Chem. Inf. Comp. Sci</source>., <volume>28</volume>, <fpage>31</fpage>–<lpage>36</lpage>.</mixed-citation>
    </ref>
    <ref id="bty080-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wishart</surname>
 <given-names>D.S.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2013</year>) 
<article-title>HMDB 3.0–the human metabolome database in 2013</article-title>. <source>Nucleic Acids Res</source>., <volume>41(Database issue)</volume>, <fpage>D801</fpage>–<lpage>D807</lpage>.<pub-id pub-id-type="pmid">23161693</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wolf</surname>
 <given-names>S.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2010</year>) 
<article-title><italic toggle="yes">In silico</italic> fragmentation for computer assisted identification of metabolite mass spectra</article-title>. <source>BMC Bioinformatics</source>, <volume>11</volume>, <fpage>148</fpage>.<pub-id pub-id-type="pmid">20307295</pub-id></mixed-citation>
    </ref>
    <ref id="bty080-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname>
 <given-names>P.</given-names></string-name></person-group>
 <etal>et al</etal> (<year>2010</year>) 
<article-title>Creation of a genome-wide metabolic pathway database for Populus trichocarpa using a new approach for reconstruction and curation of metabolic pathways for plants</article-title>. <source>Plant Physiol</source>., <volume>153</volume>, <fpage>1479</fpage>–<lpage>1491</lpage>.<pub-id pub-id-type="pmid">20522724</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
