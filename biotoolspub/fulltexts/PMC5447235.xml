<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5447235</article-id>
    <article-id pub-id-type="pmid">28158333</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btx048</article-id>
    <article-id pub-id-type="publisher-id">btx048</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genetics and Population Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>admixturegraph: an R package for admixture graph manipulation and fitting</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Leppälä</surname>
          <given-names>Kalle</given-names>
        </name>
        <xref ref-type="aff" rid="btx048-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Nielsen</surname>
          <given-names>Svend V</given-names>
        </name>
        <xref ref-type="aff" rid="btx048-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Mailund</surname>
          <given-names>Thomas</given-names>
        </name>
        <xref ref-type="corresp" rid="btx048-cor1"/>
        <xref ref-type="aff" rid="btx048-aff1"/>
        <!--<email>mailund@birc.au.dk</email>-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Wren</surname>
          <given-names>Jonathan</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <aff id="btx048-aff1">Bioinformatics Research Centre, Aarhus University, Aarhus, Denmark</aff>
    <author-notes>
      <corresp id="btx048-cor1">To whom correspondence should be addressed. Email: <email>mailund@birc.au.dk</email>.</corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>01</day>
      <month>6</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2017-01-31">
      <day>31</day>
      <month>1</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>31</day>
      <month>1</month>
      <year>2017</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>33</volume>
    <issue>11</issue>
    <fpage>1738</fpage>
    <lpage>1740</lpage>
    <history>
      <date date-type="received">
        <day>23</day>
        <month>8</month>
        <year>2016</year>
      </date>
      <date date-type="rev-recd">
        <day>14</day>
        <month>12</month>
        <year>2016</year>
      </date>
      <date date-type="accepted">
        <day>24</day>
        <month>1</month>
        <year>2017</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author 2017. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2017</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by-nc/4.0/" license-type="cc-by-nc">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btx048.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="SA1">
        <title>Summary</title>
        <p>Admixture graphs generalize phylogenetic trees by allowing genetic lineages to merge as well as split. In this paper we present the R package admixturegraph containing tools for building and visualizing admixture graphs, for fitting graph parameters to genetic data, for visualizing goodness of fit and for evaluating the relative goodness of fit between different graphs.</p>
      </sec>
      <sec id="SA2">
        <title>Availability and Implementation</title>
        <p>GitHub: <ext-link ext-link-type="uri" xlink:href="https://github.com/mailund/admixture_graph">https://github.com/mailund/admixture_graph</ext-link> and CRAN: <ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/packages/admixturegraph">https://cran.r-project.org/web/packages/admixturegraph</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Danish Council for Independent Research, Sapere Aude</named-content>
        </funding-source>
        <award-id>12-125062</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>The relationship between populations is not always a simple tree. In addition to the splitting events, where an ancestral population split into two or more isolated groups, admixture events can merge two or more populations. Admixture graphs are extensions of phylogenetic trees that allow such merging events.</p>
    <p>Inference of admixture graphs has not received the same attention as phylogenetic trees, but a number of methods have recently been developed for fitting genetic data to graphs and for using heuristics or brute-force search approaches to finding best-fitting graphs qpgraph (<xref rid="btx048-B2" ref-type="bibr">Castelo and Roberato, 2006</xref>), TreeMix (<xref rid="btx048-B7" ref-type="bibr">Pickrell and Pritchard, 2012</xref>), AdmixTools (<xref rid="btx048-B6" ref-type="bibr">Patterson <italic>et al.</italic>, 2012</xref>; <xref rid="btx048-B5" ref-type="bibr">Zhao and Patterson, 2016</xref>), MixMapper (<xref rid="btx048-B4" ref-type="bibr">Lipson <italic>et al.</italic>, 2013</xref>). These methods model the genetic relationship between populations as a graph where observed populations are represented as leaves, inner nodes represent ancestral populations, and edges represent the genetic drift separating an ancestral population from a descendent population. Without admixture events, the structure is simply a tree, but when the ancestry of the populations contain admixture, the graph contains nodes with more than one parent.</p>
    <p>The graph describes the genetic drift within populations and the correlation of drift between populations. Data is usually summarized in some form studying patterns of allele frequency correlations across populations. In the TreeMix method by <xref rid="btx048-B7" ref-type="bibr">Pickrell and Pritchard (2012)</xref> data is thus represented as the covariance matrix of genetic drift while the AdmixTools software by <xref rid="btx048-B6" ref-type="bibr">Patterson <italic>et al.</italic> (2012)</xref> summarizes patterns of drift through so-called <italic>f</italic>-statistics. Given a graph topology together with edge lengths and admixture proportions the expected drift patterns can be computed and a likelihood derived and parameters of the graph can be inferred.</p>
    <p>In this paper we describe the R package admixturegraph. This package contains functionality for:
<list list-type="bullet"><list-item><p>constructing and visualizing admixture graphs</p></list-item><list-item><p>fitting graph parameters and visualizing the goodness-of-fit</p></list-item><list-item><p>computing Bayes factors between graphs for comparing them</p></list-item><list-item><p>exploring the space of graph topologies to find the best fitting graphs</p></list-item></list>For comparison, qpgraph and AdmixTools work on a user specified admixture graph, and MixMapper and TreeMix use a sequential heuristic building new admixture events based on the previous ones. The package admixturegraph can be used either for brute-force search on the graph topologies or for a heuristic approach generalizing the sequential one, building more complicated admixture graphs from a selected set of well performing simpler admixture graphs (as the sequential approach is not guaranteed to converge towards the best fitting admixture graphs). The package does not automatically infer an admixture graph from the data.</p>
    <p>The R package does not add functionality that cannot be found in existing software, but by providing an R interface to working interactively with admixture graphs, fitting and visualizing the goodness of fit of graphs, we believe that we make admixture graphs more accessible to users.</p>
  </sec>
  <sec>
    <title>2 Features</title>
    <p>The admixturegraph R package provides a framework for constructing and analysing admixture graphs and evaluating their fit to genetic data summarized as <italic>f</italic>-statistics (<xref rid="btx048-B6" ref-type="bibr">Patterson <italic>et al.</italic>, 2012</xref>).</p>
    <sec>
      <title>2.1 Constructing and visualizing admixture graphs</title>
      <p>Admixture graphs are constructed using R functions specifying the nodes and edges and naming the admixture proportion parameters. <xref ref-type="fig" rid="btx048-F1">Figure 1a</xref> shows a toy example dataset, adapted from <xref rid="btx048-B1" ref-type="bibr">Cahill <italic>et al.</italic> (2013)</xref>, consisting of one black bear (BLK), one polar bear (PB) and a number of brown bear samples. <xref ref-type="fig" rid="btx048-F1">Figure 1b</xref> shows example code for constructing an admixture graph that models that the ABC-bears (Adm, Bar, Chi) are admixed between polar bears and brown bears as suggested by <xref rid="btx048-B1" ref-type="bibr">Cahill <italic>et al.</italic> (2013)</xref>. <xref ref-type="fig" rid="btx048-F1">Figure 1e</xref> shows an alternative where polar bears are admixed (see <xref rid="btx048-B3" ref-type="bibr">Lan <italic>et al.</italic>, 2016</xref>, <ext-link ext-link-type="uri" xlink:href="https://dx.doi.org/10.1101/047498">https://dx.doi.org/10.1101/047498</ext-link>).</p>
      <fig id="btx048-F1" orientation="portrait" position="float">
        <label>Fig. 1.</label>
        <caption>
          <p>(<bold>a</bold>) Example data in the form of <italic>D</italic> statistics (equivalent to <italic>f</italic><sub>4</sub> statistics. (<bold>b</bold>) Example of graph construction and plotting code. (<bold>c</bold>) and (<bold>e</bold>) Examples of admixture graphs. (<bold>d</bold>) and (<bold>f</bold>) Goodness-of-fit of the graphs in (b) and (d)</p>
        </caption>
        <graphic xlink:href="btx048f1"/>
      </fig>
      <p>Unlike visualizing trees, which are always planar graphs, it is not trivial to present graphs in a visually pleasing way. We have therefore implemented heuristics for laying out graphs for plotting while providing a number of options for overruling the heuristics to customize plots. Examples of plotted graphs are shown in c and e.</p>
    </sec>
    <sec>
      <title>2.2 Fitting graph parameters and visualizing fits</title>
      <p>For fitting graph parameters to data, the data should be collected in an R data frame or equivalent (see package documentation for details on the expected format). The fitting procedure first extracts from the graph topology a set of equations for the expected values of each <italic>f</italic>-statistics in the data. These are linear equations on edge lengths and polynomials on admixture proportions. From the observed data and this set of equations, the likelihood of parameters can be computed and maximized. The likelihood used is
<disp-formula id="E1"><mml:math id="MM1"><mml:mrow><mml:mi>det</mml:mi><mml:mo>⁡</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo>π</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo> </mml:mo><mml:mtext>exp</mml:mtext><mml:mo> </mml:mo><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mi>L</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo> </mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
where
<disp-formula id="E2"><mml:math id="MM2"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>F</mml:mi><mml:mo>−</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>t</mml:mi></mml:msup><mml:msup><mml:mo>Σ</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mi>F</mml:mi><mml:mo>−</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo> </mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula><italic>f</italic> is the vector of observed statistics, <italic>F</italic> is the vector of statistics predicted by the graph topology and parameters, and Σ is the covariance matrix of the observed statistics <italic>f</italic>, which is either given by the user or replaced by a proxy of the identity or a diagonal matrix constructed from <italic>Z</italic>-scores given by AdmixTools for instance. The maximizing procedure used alternates between solving the linear problem on edge lengths, which can be optimized analytically, and the polynomial problem on admixture proportions, which is solved using numerical optimization.</p>
      <p>Once we have fitted a graph to data we can visualize the goodness-of-fit by plotting the expected statistics against the observed statistics (see <xref ref-type="fig" rid="btx048-F1">Fig. 1d and f</xref> where shows the fit of the two graphs in c and e). The genetic data is shown as observations with error bars (black lines) while the expected values are shown as solid dots.</p>
    </sec>
    <sec>
      <title>2.3 Posterior distributions and graph comparisons</title>
      <p>Fitting graph parameters to data provides a maximum likelihood point-estimate. To obtain confidence intervals for parameters, one can use a blocked jackknife or bootstrap procedure as in (<xref rid="btx048-B6" ref-type="bibr">Patterson <italic>et al.</italic>, 2012</xref>) but the admixturegraph package also provides an alternative in the form of a Markov Chain Monte Carlo (MCMC) procedure for sampling from the posterior distribution of joint parameters.</p>
      <p>Comparing the fit of two different graphs is not straight forward since graphs can have very different numbers of parameters and are usually not nested models. Instead we propose to use Bayes factors—the ration of the likelihood of one graph over another—to compare models. To do this it is necessary to integrate out the graph parameters and obtain a likelihood for a topology alone. To estimate this integral we use the MCMC to obtain samples from the posterior likelihood and use these in an importance sampler procedure to compute the graph likelihood.</p>
    </sec>
    <sec>
      <title>2.4 Exploring the space of graph topologies</title>
      <p>While we can compare the fit of different graph topologies to data, there are no known algorithms for inferring the optimal graph topology. Instead the package implements a few functions for brute force exploration of topologies and heuristics for extending topologies.</p>
      <p>The set of all possible graphs, even when limited to one or two admixture events, grows super-exponentially in the number of leaves and it is generally not computationally feasible to explore this set exhaustively. Still, we give graph libraries for searching through all possible topologies with not too many leaves and admixture events. For larger graphs we provide functions for exploring all possible graphs that can be reached from a given graph by adding one extra admixture event or by adding one additional leaf. However, the best fitting admixture graphs are not necessarily extensions of best fitting smaller graphs, so we recommend that users not only expand the best smaller graph but a selected few best of them.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Conclusion</title>
    <p>We have presented an R package for exploring and fitting admixture graphs. The package provides functionality for constructing and visualizing admixture graphs, for fitting graph parameters to genetic data, for visualizing goodness-of-fit, and for comparing the quality of fits between non-nested graph models. While the package does not contain algorithms for automatically inferring optimal graph topologies, it does provide functionality for exploring the space of possible topologies.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This research was funded by the Danish Council for Independent Research, Sapere Aude grant 12-125062.</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </sec>
</body>
<back>
  <ref-list>
    <title>References</title>
    <ref id="btx048-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Cahill</surname><given-names>J.A.</given-names></name></person-group><etal>et al</etal> (<year>2013</year>) 
<article-title>Genomic evidence for island population conversion resolves conflicting theories of polar bear evolution</article-title>. <source>PLoS Genet</source>., <volume>9</volume>, <fpage>e1003345–e1003345.</fpage><pub-id pub-id-type="pmid">23516372</pub-id></mixed-citation>
    </ref>
    <ref id="btx048-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Castelo</surname><given-names>R.</given-names></name>, <name name-style="western"><surname>Roberato</surname><given-names>A.</given-names></name></person-group> (<year>2006</year>) 
<article-title>A robust procedure for Gaussian graphical model search from microarray data with <italic>p</italic> larger than <italic>n</italic></article-title>. <source>J. Mach. Learn. Res</source>., <volume>7</volume>, <fpage>2621</fpage>–<lpage>2650</lpage>.</mixed-citation>
    </ref>
    <ref id="btx048-B3">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Lan</surname><given-names>T.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) <source>Genome-Wide Evidence for a Hybrid Origin of Modern Polar Bears</source>. <comment>bioRxiv 047498</comment>.</mixed-citation>
    </ref>
    <ref id="btx048-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lipson</surname><given-names>M.</given-names></name></person-group><etal>et al</etal> (<year>2013</year>) 
<article-title>Efficient moment-based inference of admixture parameters and sources of gene flow</article-title>. <source>Mol. Biol. Evol</source>., <volume>30</volume>, <fpage>1788</fpage>–<lpage>1802</lpage>.<pub-id pub-id-type="pmid">23709261</pub-id></mixed-citation>
    </ref>
    <ref id="btx048-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Patterson</surname><given-names>N.</given-names></name></person-group><etal>et al</etal> (<year>2012</year>) 
<article-title>Ancient admixture in human history</article-title>. <source>Genetics</source>, <volume>192</volume>, <fpage>1065</fpage>–<lpage>1093</lpage>.<pub-id pub-id-type="pmid">22960212</pub-id></mixed-citation>
    </ref>
    <ref id="btx048-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Pickrell</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Pritchard</surname><given-names>J.K.</given-names></name></person-group> (<year>2012</year>) 
<article-title>Inference of population splits and mixtures from genome-wide allele frequency data</article-title>. <source>PLoS Genet</source>., <volume>8</volume>, <fpage>e1002967.</fpage><pub-id pub-id-type="pmid">23166502</pub-id></mixed-citation>
    </ref>
    <ref id="btx048-B5">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Zhao</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Patterson</surname><given-names>N.</given-names></name></person-group> (<year>2016</year>) ADMIXTOOLS v4.1.</mixed-citation>
    </ref>
  </ref-list>
</back>
