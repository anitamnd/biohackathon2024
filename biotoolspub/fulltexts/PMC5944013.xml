<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5944013</article-id>
    <article-id pub-id-type="publisher-id">2166</article-id>
    <article-id pub-id-type="doi">10.1186/s12859-018-2166-6</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methodology Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>An automatic method to calculate heart rate from zebrafish larval cardiac videos</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Kang</surname>
          <given-names>Chia-Pin</given-names>
        </name>
        <address>
          <email>n26030203@mail.ncku.edu.tw</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Tu</surname>
          <given-names>Hung-Chi</given-names>
        </name>
        <address>
          <email>t36044021@mail.ncku.edu.tw</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fu</surname>
          <given-names>Tzu-Fun</given-names>
        </name>
        <address>
          <email>tffu@mail.ncku.edu.tw</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wu</surname>
          <given-names>Jhe-Ming</given-names>
        </name>
        <address>
          <email>n26060224@mail.ncku.edu.tw</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Chu</surname>
          <given-names>Po-Hsun</given-names>
        </name>
        <address>
          <email>n26040290@mail.ncku.edu.tw</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9119-4231</contrib-id>
        <name>
          <surname>Chang</surname>
          <given-names>Darby Tien-Hao</given-names>
        </name>
        <address>
          <email>darby@mail.ncku.edu.tw</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0532 3255</institution-id><institution-id institution-id-type="GRID">grid.64523.36</institution-id><institution>Department of Electronic Engineering, </institution><institution>National Cheng Kung University, </institution></institution-wrap>Tainan, 70101 Taiwan </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0532 3255</institution-id><institution-id institution-id-type="GRID">grid.64523.36</institution-id><institution>The Institute of Basic Medical Sciences, </institution><institution>National Cheng Kung University, </institution></institution-wrap>Tainan, 70101 Taiwan </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>9</day>
      <month>5</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>9</day>
      <month>5</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2018</year>
    </pub-date>
    <volume>19</volume>
    <elocation-id>169</elocation-id>
    <history>
      <date date-type="received">
        <day>7</day>
        <month>2</month>
        <year>2018</year>
      </date>
      <date date-type="accepted">
        <day>25</day>
        <month>4</month>
        <year>2018</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s). 2018</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold>This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">Zebrafish is a widely used model organism for studying heart development and cardiac-related pathogenesis. With the ability of surviving without a functional circulation at larval stages, strong genetic similarity between zebrafish and mammals, prolific reproduction and optically transparent embryos, zebrafish is powerful in modeling mammalian cardiac physiology and pathology as well as in large-scale high throughput screening. However, an economical and convenient tool for rapid evaluation of fish cardiac function is still in need. There have been several image analysis methods to assess cardiac functions in zebrafish embryos/larvae, but they are still improvable to reduce manual intervention in the entire process. This work developed a fully automatic method to calculate heart rate, an important parameter to analyze cardiac function, from videos. It contains several filters to identify the heart region, to reduce video noise and to calculate heart rates.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">The proposed method was evaluated with 32 zebrafish larval cardiac videos that were recording at three-day post-fertilization. The heart rate measured by the proposed method was comparable to that determined by manual counting. The experimental results show that the proposed method does not lose accuracy while largely reducing the labor cost and uncertainty of manual counting.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3">With the proposed method, researchers do not have to manually select a region of interest before analyzing videos. Moreover, filters designed to reduce video noise can alleviate background fluctuations during the video recording stage (e.g. shifting), which makes recorders generate usable videos easily and therefore reduce manual efforts while recording.</p>
      </sec>
      <sec>
        <title>Electronic supplementary material</title>
        <p>The online version of this article (10.1186/s12859-018-2166-6) contains supplementary material, which is available to authorized users.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Zebrafish</kwd>
      <kwd>Image processing</kwd>
      <kwd>Heart rate</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100004663</institution-id>
            <institution>Ministry of Science and Technology, Taiwan</institution>
          </institution-wrap>
        </funding-source>
        <award-id>MOST 104-2628-E-006-004-MY3</award-id>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2018</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par17">Congenital heart disease (CHD) is the most common congenital defect, which accounts for 3% of infant deaths [<xref ref-type="bibr" rid="CR1">1</xref>]. To better prevent and treat this defect, a further understanding on the cardiac development is pre-requisite. Many automatic or semi-automatic analysis systems based on optical recording have been proposed for this purpose. Zebrafish is a vertebrate model with high genetic similarity to mammals [<xref ref-type="bibr" rid="CR2">2</xref>]. The externally fertilized transparent embryos and larvae enable a real-time observation of cardiac development during embryogenesis. Embryos receive oxygen directly from the surrounding environment by passive diffusion before reaching seven-day post-fertilization (dpf). This characteristic allows for investigation on cardiac structure and function even when severe congenital heart defects are induced [<xref ref-type="bibr" rid="CR3">3</xref>]. The aforementioned advantages make zebrafish an ideal model for studying cardiac development [<xref ref-type="bibr" rid="CR4">4</xref>].</p>
    <p id="Par18">To date, there have been many methods that assess cardiac functions in zebrafish embryos/larvae [<xref ref-type="bibr" rid="CR5">5</xref>–<xref ref-type="bibr" rid="CR13">13</xref>]. These methods need manually pre-selected regions of interest (ROI) for satisfying results. To solve this problem, several digital image analysis methods have been developed to standardize and automate cardiac assessment in zebrafish embryos/larvae [<xref ref-type="bibr" rid="CR14">14</xref>–<xref ref-type="bibr" rid="CR20">20</xref>]. The aforementioned semi-automatic and automatic methods have been developed for videos obtained under different conditions. For example, the work of Luca et al. [<xref ref-type="bibr" rid="CR15">15</xref>] used videos from resonant laser scanning confocal microscope, which is rather expensive for some laboratories. The issue of anesthetization has been addressed in Pylatiuk et al.’s work [<xref ref-type="bibr" rid="CR16">16</xref>], but a recent work by Puybareau et al. [<xref ref-type="bibr" rid="CR19">19</xref>] still chose to anesthetize the fish embryos with Tricaine. The contribution of these computational methods is to accurately estimate heart rate for a practical acquisition process.</p>
    <p id="Par19">Although the videos were obtained under different conditions, all of the aforementioned methods have to face two important issues after video acquisition: (a) identification of the heart area and (b) image processing to enhance heartbeat signals in the video. This work has developed a novel method for heart rate estimation. For the first issue, this work proposes a half-heart mask to identify the ROI. For the second issue, this work proposes that Empirical Mode Decomposition (EMD) could be used as a high-pass filter to reduce video noise. Another contribution of this work is the comparison strategy between the proposed method and manual counting. This work designed an experiment to quantify manual error, which was used as a reference to evaluate the computational error. The experimental results show that the proposed method achieves the same error level as human.</p>
    <p id="Par20">This article is organized as follows. Section 2 describes the proposed method, which includes three major steps. Section 3 describes its performance, including the details of zebrafish larva preparation, video acquisition and an experiment to compare the calculated heartbeat rate with manual counting. Section 4 concludes this work and discusses possible extensions.</p>
  </sec>
  <sec id="Sec2">
    <title>Methods</title>
    <p id="Par21">The concept of the proposed heart rate calculation is based on brightness intensity of each video frame. Fig. <xref rid="Fig1" ref-type="fig">1</xref> shows that the brightness intensity through a video has a repetitive pattern related to heartbeats. This brightness intensity function is denoted heartbeat signal (h-signal) in this article. Fig. <xref rid="Fig2" ref-type="fig">2</xref> shows the workflow of the proposed method. For a zebrafish larva video, the first step is to generate a mask where the brightness intensity is calculated. The second step is to extract an h-signal. The third step is to calculate a heart rate from the extracted h-signal.<fig id="Fig1"><label>Fig. 1</label><caption><p>Heartbeat signals (h-signals): (<bold>a</bold>) a zebrafish larva video (ID: MVI_5280) in which each heartbeat corresponds to two brightness intensity peaks; (<bold>b</bold>) a zebrafish larva video (ID: MVI_5269) of which the zebrafish larva slid. The x-axis is frame index; the y-axis is brightness intensity of that frame. Light (the top half) and dark (the bottom half) curves indicate brightness intensities before and after, respectively, the proposed processing steps. Vertical dotted lines indicate the counting timings of the operator when he recognized a heartbeat through the video</p></caption><graphic xlink:href="12859_2018_2166_Fig1_HTML" id="MO1"/></fig><fig id="Fig2"><label>Fig. 2</label><caption><p>Flow chart of the proposed heart rate calculation</p></caption><graphic xlink:href="12859_2018_2166_Fig2_HTML" id="MO2"/></fig></p>
    <sec id="Sec3">
      <title>Half-heart mask generation</title>
      <p id="Par22">Figure <xref rid="Fig3" ref-type="fig">3a</xref> shows the variation level of brightness intensities of all frames in a video. Extracting the h-signal from the entire video region includes brightness intensity from uninteresting regions, such as the bright pixels at the top right of Fig. <xref rid="Fig3" ref-type="fig">3a</xref>. They seriously affect the extracted h-signal but are weakly related to the heartbeats. A common practice to solve this problem is pre-selecting the heart region as a mask to screen out uninteresting regions. However, this practice requires manual intervention, which is not applicable for an automatic pipeline.<fig id="Fig3"><label>Fig. 3</label><caption><p>Outputs of the four filters in the proposed half-heart mask generation step: (<bold>a</bold>) variation level of brightness intensity (brighter pixels have higher variation); (<bold>b</bold>) highly varied region; (<bold>c</bold>) heart mask; (<bold>d</bold>) half-heart mask. The outputs require the information of all frames of a video and are generated only once for each video</p></caption><graphic xlink:href="12859_2018_2166_Fig3_HTML" id="MO3"/></fig></p>
      <p id="Par23">This work developed a procedure for half-heart mask generation, which consists of four filters. Given a zebrafish larva video, the first filter is to calculate, for each pixel, the variation level of brightness intensity through the video. This filter first converts each video frame to a grayscale image. In this work, 12 color-to-grayscale methods analyzed in [<xref ref-type="bibr" rid="CR21">21</xref>] have been tested. The Luma method [<xref ref-type="bibr" rid="CR22">22</xref>] without Gamma correction yielded the best performance and was adopted in this work. The performance of using the 12 color-to-grayscale methods can be found in the Additional file <xref rid="MOESM1" ref-type="media">1</xref>. After this conversion, each pixel in the frame has a brightness intensity, <italic>y</italic>. This work defines the variation level of brightness intensity of a pixel at (<italic>i</italic>, <italic>j</italic>) in an <italic>n</italic>-frame video as the variation of the <italic>n</italic>-1 brightness intensity differences of two consecutive frames at that pixel:<disp-formula id="Equa"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \frac{1}{n-1}\sum \limits_{k=1}^{n-1}\left|{y}_{i,j,k+1}-{y}_{i,j,k}\right| $$\end{document}</tex-math><mml:math id="M2" display="block"><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:mfenced close="|" open="|"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="12859_2018_2166_Article_Equa.gif" position="anchor"/></alternatives></disp-formula>where <italic>y</italic><sub><italic>i,j,k</italic></sub> is the brightness intensity of pixel (<italic>i</italic>, <italic>j</italic>) in the <italic>k</italic>-th video frame. The variation levels of all pixels for a video are normalized to [0,255] so that they can be rendered to a grayscale image as shown in Fig. <xref rid="Fig3" ref-type="fig">3a</xref>, which is the output of the first filter.</p>
      <p id="Par24">The second filter is to find a region in which the brightness intensity varies drastically. This filter converts the grayscale image of variation levels into a binary mask by setting a percentage threshold, <italic>θ</italic>. The <italic>θ</italic>% pixels with the highest variation levels are converted to black (region of interest), otherwise are converted to white (region of non-interest). Since the target area of interest is heart, the ideal <italic>θ</italic> of a zebrafish larva video depends on its heart-to-video ratio: the area ratio of the heart region to the entire video. The heart-to-video ratios of the 32 testing videos collected in this work varied from 0.9% to 10.0%. This work used <italic>θ</italic> = 4 for all testing videos. The result of this filter is a binary mask as shown in Fig. <xref rid="Fig3" ref-type="fig">3b</xref>.</p>
      <p id="Par25">The third filter is to further reduce the archipelago-like mask of Fig. <xref rid="Fig3" ref-type="fig">3b</xref> to focus on the heart region. The concept of this filter is to retrieve the biggest circle-like island. Long and narrow islands, even with large area, are not the region of interest. Invoking region-growing algorithms can solve this problem [<xref ref-type="bibr" rid="CR23">23</xref>, <xref ref-type="bibr" rid="CR24">24</xref>]. The DBSCAN algorithm [<xref ref-type="bibr" rid="CR25">25</xref>], which clusters pixels by “pixel density”, was adopted for this task. The nature of DBSCAN inhibits the growth of long and narrow clusters, because their pixel densities are difficult to maintain during the scanning process. Another benefit of DBSCAN is that the number of clusters is not pre-required. By applying neighborhood expansion, DBSCAN can filter out noise (i.e. spots in an image) to accurately recognize clusters of arbitrary size [<xref ref-type="bibr" rid="CR26">26</xref>]. The DBSCAN algorithm defines core pixels based on two parameters, epsilon (<italic>eps</italic>) and minimum number of points (<italic>minPts</italic>). For a black pixel, <italic>q,</italic> its <italic>eps</italic>-neighborhood contains pixels of which the distance to <italic>q</italic> is less than <italic>eps</italic>. If the <italic>eps</italic>-neighborhood has more than <italic>minPts</italic> pixels, <italic>q</italic> is defined as a core pixel. The scanning process of DBSCAN picks an arbitrary pixel <italic>p</italic> from the un-scanned black pixels to start. If <italic>p</italic> is a core pixel, <italic>p</italic> and its <italic>eps</italic>-neighborhood form a new island. All pixels in this island are then scanned and their <italic>eps</italic>-neighborhoods are added into the island. The newly added pixels are also scanned to see if more pixels can be added to the island. This scanning process is conducted recursively until no more pixels can be added to island. If <italic>p</italic> is not a core pixel, <italic>p</italic> is considered as a noise and assigned to no island. Then, DBSCAN moves to the next un-scanned black pixel and stops when all black pixels have been scanned. Figure <xref rid="Fig4" ref-type="fig">4</xref> shows the pseudocode of DBSCAN. This work used <italic>eps</italic> = 20 and <italic>minPts</italic> = 300 for all testing videos, of which the video resolution was 1280 X 720. If the video resolution changes, <italic>minPts</italic> should be adjusted because the number of pixels in the same area changes. The <italic>eps</italic> should also be adjusted to maintain the pixel density (<italic>minPts</italic>/<italic>eps</italic><sup><italic>2</italic></sup>). For example, if a video resolution changes from 1280 X 720 to 640 X 360 (i.e. area becomes 1/4), the <italic>minPts</italic> is suggested to be 300/4 = 75 and the <italic>eps</italic> is suggested to be 20/sqrt(4) = 10. The result of this filter is the largest island of DBSCAN as shown in Fig. <xref rid="Fig3" ref-type="fig">3c</xref>, which is close to the heart.<fig id="Fig4"><label>Fig. 4</label><caption><p>Pseudocode of the DBSCAN algorithm</p></caption><graphic xlink:href="12859_2018_2166_Fig4_HTML" id="MO4"/></fig></p>
      <p id="Par26">The fourth filter is to split the heart mask of Fig. <xref rid="Fig3" ref-type="fig">3c</xref> into halves, corresponding to the atrial and ventricular of a zebrafish heart. When most of the blood cells stay in atrial, the brightness intensity in the atrial region reaches a minimum but that in the ventricular region reaches a maximum. Therefore, the brightness intensity in the entire heart region falls into two states, where a heartbeat might correspond to two brightness intensity peaks as the light curve in Fig. <xref rid="Fig1" ref-type="fig">1a</xref>. To solve such a double-peak issue, this work aims to extract the brightness intensity from either the atrial or ventricular rather than from the entire heart. To split the heart mask into two halves, this filter first calculates the brightness intensity centroid in the heart mask of each video frame. An <italic>n</italic>-frame video results in <italic>n</italic> centroids. The <italic>k</italic>-means algorithm [<xref ref-type="bibr" rid="CR27">27</xref>] is then invoked to cluster the <italic>n</italic> centroids into the two clusters: one contains frames where most blood cells are in the atrial and the other contains frames where most blood cells are in the ventricular. The <italic>k</italic>-means algorithm partitions centroids based on their locations into <italic>k</italic> disjoint clusters. When clustering <italic>n</italic> data points into <italic>k</italic> cluster, the <italic>k</italic>-means algorithm minimizes the following equation:<disp-formula id="Equb"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \sum \limits_{i=1}^k\sum \limits_{j=1}^n{w}_{i,j}\cdotp {\left\Vert {c}_i-{p}_j\right\Vert}^2 $$\end{document}</tex-math><mml:math id="M4" display="block"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>·</mml:mo><mml:msup><mml:mfenced close="‖" open="‖"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:mn>2</mml:mn></mml:msup></mml:math><graphic xlink:href="12859_2018_2166_Article_Equb.gif" position="anchor"/></alternatives></disp-formula>where <italic>c</italic><sub><italic>j</italic></sub> is the center of the <italic>i</italic>-th cluster, <italic>p</italic><sub><italic>j</italic></sub> is the <italic>j</italic>-th data point, and <italic>w</italic><sub><italic>i,j</italic></sub> equals to 1 if <italic>p</italic><sub><italic>j</italic></sub> belongs to <italic>c</italic><sub><italic>j</italic></sub> or 0 otherwise. This work sets <italic>k</italic> = 2 for atrial and ventricular. After <italic>k</italic>-means, the two cluster centers are connected to form a line segment. The perpendicular bisector of the line segment cuts the heart mask into two halves. The final mask of this step is the first half as shown in Fig. <xref rid="Fig3" ref-type="fig">3d</xref>. Depending on recording angles, the final half-heart mask could be either an atrial or ventricular.</p>
    </sec>
    <sec id="Sec4">
      <title>Heartbeat signal extraction</title>
      <p id="Par27">In this step, the brightness intensity of each video frame inside the half-heart mask is extracted to form an h-signal. For the h-signal of a video, the <italic>y</italic>-value at position <italic>x</italic> is defined as the brightness intensity sum of all pixels in the <italic>x</italic>-th frame of that video. Peaks in an h-signal correspond to heartbeats (Fig. <xref rid="Fig1" ref-type="fig">1</xref>). Before peak detection, two filters are introduced in this step to enhance signals. The first filter uses moving average to reduce high frequency noise; the second filter uses the Empirical Mode Decomposition (EMD) method [<xref ref-type="bibr" rid="CR28">28</xref>] to reduce low frequency noise.</p>
      <p id="Par28">In an h-signal, the variation of brightness intensity comes from the distribution change of blood cells. The distribution of blood cells has a repetitive pattern related to heartbeats but not stable. Therefore, h-signals are usually jagged. A jagged signal could be modelled as a target signal (i.e. heartbeat in this work) mixed with noise signals of frequency higher than the target signal [<xref ref-type="bibr" rid="CR29">29</xref>]. Moving average is a widely adopted technique to reduce high frequency noise. In this work, the exponential moving average (EMA) is adopted as a low-pass filter. The EMA method is model-free and has been widely used in time series analyses [<xref ref-type="bibr" rid="CR30">30</xref>]. In EMA, recent data points have higher weights than older ones [<xref ref-type="bibr" rid="CR31">31</xref>]. The smoothed (EMA-transformed) h-signal is the output of this filter.</p>
      <p id="Par29">In addition to high frequency noise, the smoothed h-signals of some zebrafish larva videos have low frequency noise such as the light curve in Fig. <xref rid="Fig1" ref-type="fig">1b</xref>. Visually, smoothed h-signals with low frequency noise have an overall increasing/decreasing trend. The overall trend could be modelled as adding a signal of frequency much lower than the target signal. To deal with this problem, this work proposes a high-pass filter based on EMD. The EMD method is a way to decompose an input signal into intrinsic mode functions (IMFs), which represent a collection of simple oscillatory modes that compose the input signal. In an IMF, by definition, the number of extrema is equal to or at most differ by one with the number of zero-crossings [<xref ref-type="bibr" rid="CR28">28</xref>]. Figure <xref rid="Fig5" ref-type="fig">5</xref> shows the workflow of the EMD-based filter. First, the smoothed h-signal is used as the initial signal, <italic>s</italic>. Second, the local maxima of <italic>s</italic> are connected as an upper envelope; while the local minima of <italic>s</italic> are connected as a lower envelope. Third, the mean curve, <italic>m</italic>, between the upper and lower envelopes is interpolated. Fourth, the component, <italic>h</italic>, is calculated as the difference between <italic>s</italic> and <italic>m</italic>. If <italic>h</italic> is not an IMF, the above four operations are repeated with <italic>s</italic> = <italic>h</italic> to obtain a new component. The entire loop stops when some component fulfills the requirements of IMF. The final component is the output of the high-pass filter as well as the output of the h-signal extraction step. The subsection “Effects of half-heart mask generation” discusses the low frequency noise and the effects of the proposed EMD-based filter on it.<fig id="Fig5"><label>Fig. 5</label><caption><p>Workflow of the Empirical Mode Decomposition-based filter: (<bold>a</bold>) input signal, <italic>s</italic>; (<bold>b</bold>) upper and lower envelopes; (<bold>c</bold>) mean curve, <italic>m</italic>; (<bold>d</bold>) IMF component, <italic>h</italic> = <italic>s</italic> - <italic>m</italic></p></caption><graphic xlink:href="12859_2018_2166_Fig5_HTML" id="MO5"/></fig></p>
    </sec>
    <sec id="Sec5">
      <title>Heart rate calculation</title>
      <p id="Par30">This step calculates heart rates based on peaks in h-signals. Common recording operations (e.g. setup and remove the camera) might introduce fluctuations at the start and end of a video. To preclude such interferences, only the middle 20% time of an h-signal is considered for heart rate calculation. If the duration of an h-signal is less than 15 s, the middle 3 s are considered. In this step, the input h-signal is decomposed into data points. Each data point is the brightness intensity sum of a video frame. A data point is detected as a peak if its value is greater than its two consecutive points. Suppose <italic>n</italic> peaks are detected in the considered time span, <italic>t</italic>. The conventional formula of heart rate is <italic>n</italic>/<italic>t</italic>. This formula assumes that the time span contains roughly <italic>n</italic> periods. In practice, however, the time from the span start to the first peak plus the time from the last peak to the span end is not guaranteed to be a complete period. To prevent such an uncertainty, this work proposed a heart rate formula that trims the time outside the first and last peaks:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \frac{n-1}{t_n-{t}_1} $$\end{document}</tex-math><mml:math id="M6" display="block"><mml:mfrac><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="12859_2018_2166_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where <italic>t</italic><sub><italic>n</italic></sub> and <italic>t</italic><sub>1</sub> are the timestamps of the last and first peaks, respectively, in the considered time span.</p>
    </sec>
  </sec>
  <sec id="Sec6">
    <title>Results</title>
    <p id="Par31">The subsection “<xref rid="Sec7" ref-type="sec">Evaluation indices</xref>” introduces four evaluation indices. The subsection “<xref rid="Sec8" ref-type="sec">Performance of heartbeat rate calculation</xref>” presents a validation that compared the heart rates calculated by the proposed method against those by manual counting. The subsection “<xref rid="Sec9" ref-type="sec">Effects of half-heart mask generation</xref>” explores the effect of the proposed half-heart mask. The subsection “<xref rid="Sec10" ref-type="sec">Larva sliding problem and the EMD-based filter</xref>” discusses a larva sliding problem and the proposed EMD-based filter.</p>
    <sec id="Sec7">
      <title>Evaluation indices</title>
      <p id="Par32">Table <xref rid="Tab1" ref-type="table">1</xref> shows the four error indices adopted in this work to evaluate heart rate calculation. The first index is mean absolute error (MAE), which is the expected difference of each estimation to the answer. The second index is root-mean-square error (RMSE), which squares each error and then reports the square root of the average of the squared errors. This square-then-root operation amplifies extreme values, which makes RMSE an indicator of outliers. The third and fourth indices are relative MAE (rMAE) and RMSE (rRMSE), which transform each error to its relative form (i.e. divide the error by the answer) before other calculations.<table-wrap id="Tab1"><label>Table 1</label><caption><p>Evaluation indices</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Index</th><th>Abbreviation</th><th>Equation<sup>a</sup></th></tr></thead><tbody><tr><td>Mean absolute error</td><td>MAE</td><td><inline-formula id="IEq1"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \frac{1}{n}\sum \left|{e}_i-{a}_i\right| $$\end{document}</tex-math><mml:math id="M8" display="inline"><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mo>∑</mml:mo><mml:mfenced close="|" open="|"><mml:mrow><mml:msub><mml:mi>e</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="12859_2018_2166_Article_IEq1.gif"/></alternatives></inline-formula></td></tr><tr><td>Root-mean-square error</td><td>RMSE</td><td><inline-formula id="IEq2"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\left(\frac{1}{n}\sum {\left|{e}_i-{a}_i\right|}^2\right)}^{1/2} $$\end{document}</tex-math><mml:math id="M10" display="inline"><mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mo>∑</mml:mo><mml:msup><mml:mfenced close="|" open="|"><mml:mrow><mml:msub><mml:mi>e</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfenced><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12859_2018_2166_Article_IEq2.gif"/></alternatives></inline-formula></td></tr><tr><td>Relative MAE</td><td>rMAE</td><td><inline-formula id="IEq3"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \frac{1}{n}\bullet \sum \left|\frac{e_i-{a}_i}{a_i}\right| $$\end{document}</tex-math><mml:math id="M12" display="inline"><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mo>∙</mml:mo><mml:mo>∑</mml:mo><mml:mfenced close="|" open="|"><mml:mfrac><mml:mrow><mml:msub><mml:mi>e</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfrac></mml:mfenced></mml:math><inline-graphic xlink:href="12859_2018_2166_Article_IEq3.gif"/></alternatives></inline-formula></td></tr><tr><td>Relative RMSE</td><td>rRMSE</td><td><inline-formula id="IEq4"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\left(\frac{1}{n}\sum {\left|\frac{e_i-{a}_i}{a_i}\right|}^2\right)}^{1/2} $$\end{document}</tex-math><mml:math id="M14" display="inline"><mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mo>∑</mml:mo><mml:msup><mml:mfenced close="|" open="|"><mml:mfrac><mml:mrow><mml:msub><mml:mi>e</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfrac></mml:mfenced><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfenced><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12859_2018_2166_Article_IEq4.gif"/></alternatives></inline-formula></td></tr></tbody></table><table-wrap-foot><p><sup>a</sup>The definition of the abbreviations used: <italic>n</italic> is the number of samples, <italic>e</italic><sub><italic>i</italic></sub> is the estimation for the <italic>i</italic>-th sample, and <italic>a</italic><sub><italic>i</italic></sub> is the answer of the <italic>i</italic>-th sample. For heartbeat detection, <italic>e</italic><sub><italic>i</italic></sub> and <italic>a</italic><sub><italic>i</italic></sub> are the number of heartbeats of the <italic>i</italic>-th video. For heart rate estimation, <italic>e</italic><sub><italic>i</italic></sub> and <italic>a</italic><sub><italic>i</italic></sub> are the heart rates of the <italic>i</italic>-th video</p></table-wrap-foot></table-wrap></p>
    </sec>
    <sec id="Sec8">
      <title>Performance of heartbeat rate calculation</title>
      <p id="Par33">The proposed method was applied to calculate the heartbeat rates of 32 zebrafish larval cardiac videos. Each video was also counted by 11 operators for manual counting results. The 11 operators came from a bioinformatics laboratory with basic training. In nature, the heart rates delivered by an operator have certain differences when counting the same video multiple times. To alleviate such manual instability, a video was counted 30 times by an operator. With 30 repeated counting results of 11 operators, this work defined two kinds of manual errors: (a) individual error, which measures the variation between repeated experiments of an operator (i.e. human instability) and (b) crowd error, which measures the variation between different operators. The answer of a video for computational results and for crowd error was the average of all manual counting results for that video. The answer of a video for individual error was different by operator, where the answer of an operator was the average of his 30 counting results.</p>
      <p id="Par34">Table <xref rid="Tab2" ref-type="table">2</xref> shows the error of the proposed method and of manual counting in heartbeat detection and heart rate calculation. The performance of this work with the main features (the half-heart mask and noise filters described in the subsections of “Half-heart mask generation” and “Heartbeat signal extraction”) disabled, denoted as “This work (-)” in Table <xref rid="Tab2" ref-type="table">2</xref>, is also provided. For heartbeat detection, the average error was less than one (MAE = 0.844), indicates that the proposed method is accurate. However, the manual counting achieved better performance in terms of MAE, RMSE and rMAE. The relatively bad rRMSE of manual counting was caused by a few outliers—operators whose errors were extremely large than those of others. This reveals a problem of manual counting—the operator must be carefully selected. This problem is a critical advantage of automatic counting. Finally, the MAE, RMSE, rMAE and rRMSE of this work were 50.9%, 63.7%, 52.7% and 65.7% to those of this work (−). This gap reveals the importance of the proposed half-heart mask and noise filters, which are further analyzed in the next two subsections.<table-wrap id="Tab2"><label>Table 2</label><caption><p>Performance of heart rate calculation</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Method</th><th>MAE</th><th>RMSE</th><th>rMAE</th><th>rRMSE</th></tr></thead><tbody><tr><td colspan="5">Number of heartbeats</td></tr><tr><td> This work</td><td>0.844</td><td>1.490</td><td>7.0%</td><td>12.4%</td></tr><tr><td> Individual<sup>1</sup></td><td>0.498</td><td>0.673</td><td>3.3%</td><td>17.3%</td></tr><tr><td> Crowd<sup>2</sup></td><td>0.524</td><td>0.848</td><td>3.5%</td><td>21.9%</td></tr><tr><td> This work (−)<sup>3</sup></td><td>1.656</td><td>2.339</td><td>13.3%</td><td>18.8%</td></tr><tr><td colspan="5">Heart rate</td></tr><tr><td> This work</td><td>0.054</td><td>0.071</td><td>1.8%</td><td>2.4%</td></tr><tr><td> Individual</td><td>0.073</td><td>0.106</td><td>2.1%</td><td>5.6%</td></tr><tr><td> Crowd</td><td>0.089</td><td>0.167</td><td>2.5%</td><td>8.8%</td></tr><tr><td> This work (−)</td><td>0.338</td><td>0.528</td><td>11.1%</td><td>17.4%</td></tr></tbody></table><table-wrap-foot><p>The best performance of each evaluation index in heartbeat detection and in heart rate calculation are highlighted in bold. <sup>1</sup>Error of manual counting, where the average of an operator was used as the answer for his 30 results. <sup>2</sup>Error of manual counting, where the average of all operators was used as the answer. <sup>3</sup>Stands for “This work minus,” in which main features (the half-heart mask and noise filters) of this work were disabled</p></table-wrap-foot></table-wrap></p>
      <p id="Par35">For heart rate calculation, this work achieved the best performance in all evaluation indices. Note that the error of number of heartbeats and that of heart rate cannot be compared directly since they are in difference scales. The time span of consideration (the denominator of Eq. <xref rid="Equ1" ref-type="">1</xref>) for the 32 videos ranges from 2.3 to 6.3. Namely, an undetected heartbeat, which contributes 1 absolute error in terms of heartbeat, contributes about 0.16 to 0.43 absolute error in terms of heart rate. Although the number of heartbeats (<italic>n</italic> in Eq. <xref rid="Equ1" ref-type="">1</xref>) was less accurate than manual counting, it was compensated by the duration (the denominator of Eq. <xref rid="Equ1" ref-type="">1</xref>). The instability of counting timing on the first (<italic>t</italic><sub>1</sub> in Eq. <xref rid="Equ1" ref-type="">1</xref>) and last (<italic>t</italic><sub><italic>n</italic></sub> in Eq. <xref rid="Equ1" ref-type="">1</xref>) cycles harmed the performance of manual counting. Fig. <xref rid="Fig1" ref-type="fig">1</xref> illustrates a typical manual error in heart rate calculation—the counting timings (vertical dotted lines) did not locate at the h-signal peaks. When watching a video, an operator naturally figures out a visual pattern to recognize a heartbeat. This visual pattern is repetitive (i.e. the relative location of the manual counting timing in each h-signal cycle is similar as those in other cycles) but varies among individuals (i.e. the relative locations of the manual counting timing in an h-signal are different by operator). In addition to the crowd error of different visual patterns, there is always individual error. It is hard for human to count at exactly the same timings when counting the same video multiple times. The displacement of the first (<italic>t</italic><sub>1</sub>) and the last (<italic>t</italic><sub><italic>n</italic></sub>) counts leads to individual error. This work outperformed manual counting in heart rate calculation because of eliminating such instability. Finally, as in heartbeat detection, the half-heart mask and noise filters played important roles in heart rate calculation. The MAE, RMSE, rMAE and rRMSE of this work were 15.8%, 13.4%, 16.4% and 14.0% to those of this work (−). The gap was larger than that in heartbeat detection.</p>
      <p id="Par36">In summary, heart rates calculated by the proposed method and by manual counting were accurate (MAE &lt; 0.1 and rMAE &lt; 5%). The performance of manual counting depended on the operator (relatively large RMSE and rRMSE). The proposed half-mask mask and noise filters largely reduced the heart rate error (reduced more than 80% error in all evaluation indices). These results indicate that the proposed method can accurately and stably calculate heart rate from zebrafish larval cardiac videos.</p>
    </sec>
    <sec id="Sec9">
      <title>Effects of half-heart mask generation</title>
      <p id="Par37">As described in the subsection “<xref rid="Sec3" ref-type="sec">Half-heart mask generation</xref>”, the automatic half-heart mask generation of this work has four filters. The first two filters ask the brightness intensity of the generated region to be highly varied. The third filter asks the region to be big and be circle-like. The fourth filter asks the brightness intensities of pixels in the region to vary in a similar phase. This subsection discusses the effects of these filters on heart rate calculation. The heartbeat error is omitted here since it is alleviated by the trimmed version of heart rate calculation and is not critical to the proposed method.</p>
      <p id="Par38">Table <xref rid="Tab3" ref-type="table">3</xref> shows the heart rate errors of the proposed method with the four filters enabled incrementally. The performance of video mask does not match that of this work (−) in Table <xref rid="Tab2" ref-type="table">2</xref> because the noise filters (subsection “Heartbeat signal extraction”) were enabled. The varied region mask filtered out more than 95% of the area. The area of the final half-heart mask was only 1.4% to the entire video, which is close to the smallest heart-to-video ratio of the testing videos. All evaluation indices show a strictly decreasing trend as the filters enabled incrementally. Namely, these filters successfully identified sub-regions that are more critical than the regions delivered by the previous filters. Fig. <xref rid="Fig6" ref-type="fig">6</xref> compares the performance improvement among filters. In general, the varied region mask contributed the largest improvement. The half-heart mask had the second largest contribution and the heart mask had the least contribution. The contribution of the heart mask was small because it also amplified the double-peak issue—the brightness intensity in the entire heart region has two peaks in a heartbeat cycle—while filtering out region of non-interest. Therefore, some improvement was neutralized. In this regard, the half-heart mask then recovered the improvement of focusing on heart region by solving the double-peak issue. Moreover, the contributions of the half-heart mask in RMSE and rRMSE were relatively larger than those in MAE and rMAE. The contribution of the half-heart mask exceeded that of the varied region mask in rRMSE (42.4% vs. 38.2%). These results suggest that the half-heart mask played a relatively critical role in reducing outliers and in the stability of the proposed method.<table-wrap id="Tab3"><label>Table 3</label><caption><p>Effects of the half-heart mask generation on heart rate estimation</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Mask</th><th>Area<sup>a</sup></th><th>MAE</th><th>RMSE</th><th>rMAE</th><th>rRMSE</th></tr></thead><tbody><tr><td>Video<sup>b</sup></td><td>787.2 k</td><td>0.491</td><td>0.665</td><td>11.1%</td><td>17.4%</td></tr><tr><td>Varied region<sup>c</sup></td><td>30.2 k</td><td>0.180</td><td>0.339</td><td>6.1%</td><td>11.6%</td></tr><tr><td>Heart<sup>d</sup></td><td>23.7 k</td><td>0.161</td><td>0.284</td><td>5.2%</td><td>8.8%</td></tr><tr><td>Half-heart<sup>e</sup></td><td>11.3 k</td><td>0.054</td><td>0.071</td><td>1.8%</td><td>2.4%</td></tr></tbody></table><table-wrap-foot><p><sup>a</sup>Area of the mask (unit: pixel). Heartbeat signals were extracted from the <sup>b</sup>entire video (i.e. no filter of the half-heart mask generation was enabled), <sup>c</sup>highly varied region (the first two filters were enabled), <sup>d</sup>heart region (the first three filters were enabled) and <sup>e</sup>half-heart region (all filters were enabled)</p></table-wrap-foot></table-wrap><fig id="Fig6"><label>Fig. 6</label><caption><p>Contribution of each mask generation step. For each bar, the steps from top to bottom are varied region, heart region and half-heart region. For the Area bar, the contributions of heart and half-heart regions are 0.8% and 1.6%, respectively</p></caption><graphic xlink:href="12859_2018_2166_Fig6_HTML" id="MO6"/></fig></p>
      <p id="Par39">In summary, the large contribution of the varied region mask came from filtering out a large area. The heart mask yielded a relatively small contribution, but it is a necessary step for the half-heart mask. The large contribution of the half-heart mask came from accurately identifying pixels whose brightness intensities vary in a similar phase. This phase consistency was important to enhance stability.</p>
    </sec>
    <sec id="Sec10">
      <title>Larva sliding problem and the EMD-based filter</title>
      <p id="Par40">Although the zebrafish larvae in this work were mounted on slides, the sliding of larva was still observed in some videos. Fig. <xref rid="Fig7" ref-type="fig">7</xref> shows a sample video with the larva sliding problem, which leads to a global “tilting” preference of h-signals. The EMD-based filter of this work was developed to solve the tilting preference by removing the low frequency noise in h-signals. To evaluate the effect of the EMD-based filter, this work proposed an index to measure the tilting preference (denoted as tp-index):<disp-formula id="Equc"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ 1-\frac{1}{n}\sum \limits_{i=1}^n\frac{\min \left({p}_i-{l}_i,{p}_i-{r}_i\right)}{\max \left({p}_i-{l}_i,{p}_i-{r}_i\right)} $$\end{document}</tex-math><mml:math id="M16" display="block"><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mfrac><mml:mrow><mml:mo>min</mml:mo><mml:mfenced close=")" open="(" separators=","><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>max</mml:mo><mml:mfenced close=")" open="(" separators=","><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="12859_2018_2166_Article_Equc.gif" position="anchor"/></alternatives></disp-formula>where <italic>n</italic> is the number of peaks, <italic>p</italic><sub><italic>i</italic></sub> is the <italic>i</italic>-th peak, <italic>l</italic><sub><italic>i</italic></sub> is the left trough of <italic>p</italic><sub><italic>i</italic></sub>, while <italic>r</italic><sub><italic>i</italic></sub> is the right trough of <italic>p</italic><sub><italic>i</italic></sub> (Fig. <xref rid="Fig8" ref-type="fig">8</xref>). The sub-equation within the summation measures the ratio of the smaller peak-trough difference of the <italic>i</italic>-th peak to the larger one. The ratio decreases when the titling preference increases. The tp-index is normalized to a range of [0, 1], from small to large tilting preference. Videos with large tp-indices were manually reviewed and confirmed to have larva sliding.<fig id="Fig7"><label>Fig. 7</label><caption><p>A zebrafish video with larva sliding problem (ID: MVI_5269). The timestamps of (<bold>a</bold>) to (<bold>d</bold>) are 0, 7, 13 and 20 s. The top area shows the full video frame and the bottom area zooms into the red rectangle. The bottom area shows that the larva in the video slides upward. Namely, the larva slides towards the top right corner of the full video frame. In a video frame, the larva is darker than the background. If a larva slides into the screen when recording, the extracted h-signal has an overall decreasing trend; conversely, if a larva slides out the screen like this sample video, the extracted h-signal has an overall increasing trend as shown in Fig. <xref rid="Fig1" ref-type="fig">1b</xref></p></caption><graphic xlink:href="12859_2018_2166_Fig7_HTML" id="MO7"/></fig><fig id="Fig8"><label>Fig. 8</label><caption><p>A schematic diagram of the proposed tp-index</p></caption><graphic xlink:href="12859_2018_2166_Fig8_HTML" id="MO8"/></fig></p>
      <p id="Par41">With the tp-index, the 32 testing videos were divided into two groups. The first group, denoted as large-tp group, included ten videos with tp-index &gt; 0.5; the other group, denoted as small-tp group, included 22 videos with tp-index &lt; 0.5. The EMD-based filter was expected to have a larger effect on the first group than that on the second group. Table <xref rid="Tab4" ref-type="table">4</xref> shows the performance on the two groups with and without the EMD-based filter. The tp-index difference between two groups was large (0.623 vs. 0.300). The tp-index average of the large-tp group exceeded 0.5, indicating the ten videos suffered from serious larva sliding conditions. The EMD-based filter largely decreased the tp-index of this group (0.623–0.256 = 0.367). A smaller improvement (0.300–0.120 = 0.180) was also observed in the small-tp group. With reducing the tilting preference, the EMD-based filter improved all evaluation indices on both groups. The performance of EMD (+) in the large-tp group was close to those of EMD (−) and EMD (+) in the small-tp group. This indicates that the EMD-based filter successfully solved the larva sliding problem.<table-wrap id="Tab4"><label>Table 4</label><caption><p>Effects of the EMD-based filter</p></caption><table frame="hsides" rules="groups"><thead><tr><th/><th>tp-index</th><th>MAE</th><th>RMSE</th><th>rMAE</th><th>rRMSE</th></tr></thead><tbody><tr><td colspan="6">Large tilting preference (10 videos)</td></tr><tr><td> EMD (−)<sup>1</sup></td><td>0.623</td><td>0.746</td><td>0.925</td><td>26.4%</td><td>32.5%</td></tr><tr><td> EMD (+)<sup>2</sup></td><td>0.256</td><td>0.062</td><td>0.095</td><td>2.2%</td><td>3.3%</td></tr><tr><td colspan="6">Small tilting preference (22 videos)</td></tr><tr><td> EMD (−)</td><td>0.300</td><td>0.065</td><td>0.090</td><td>2.2%</td><td>2.9%</td></tr><tr><td> EMD (+)</td><td>0.120</td><td>0.049</td><td>0.057</td><td>1.7%</td><td>1.9%</td></tr></tbody></table><table-wrap-foot><p>Heartbeat signals were extracted <sup>1</sup>without and <sup>2</sup>with the proposed EMD-based filter</p></table-wrap-foot></table-wrap></p>
    </sec>
  </sec>
  <sec id="Sec11">
    <title>Discussion</title>
    <p id="Par42">The proposed method has been tested on two videos provided in [<xref ref-type="bibr" rid="CR10">10</xref>], where one is a fly heart (BTN4602-RR-Ocorr-Sup_85747a.mov) and the other is a mouse heart (BTN4602-RR-Ocorr-Sup_85750a.mov). The program output of the two videos can be found in our online demo page (<ext-link ext-link-type="uri" xlink:href="https://merry.ee.ncku.edu.tw/zebrafish">https://merry.ee.ncku.edu.tw/zebrafish/</ext-link>). Table <xref rid="Tab5" ref-type="table">5</xref> shows the results.<table-wrap id="Tab5"><label>Table 5</label><caption><p>performance on two videos of other species</p></caption><table frame="hsides" rules="groups"><thead><tr><th/><th colspan="2">Fly heart</th><th colspan="2">Mouse heart</th></tr></thead><tbody><tr><td>Method</td><td># of heartbeats</td><td>Heart rate</td><td># of heartbeats</td><td>Heart rate</td></tr><tr><td>Manual counting</td><td>61</td><td>2.01</td><td>12</td><td>1.278</td></tr><tr><td>This work</td><td>61</td><td>2.04</td><td>12</td><td>1.667</td></tr></tbody></table></table-wrap></p>
    <p id="Par43">Although making a conclusion based on only two independent videos might be too arbitrary, the results reveal the potential of the proposed method on heart videos of other species.</p>
  </sec>
  <sec id="Sec12">
    <title>Conclusions</title>
    <p id="Par44">This work introduced a pipeline that calculate heart rate from zebrafish larval cardiac videos. The proposed method contains filters to identify the heart region automatically and can be performed without pre-selecting a region of heart manually. It also contains filters to withstand background fluctuations during the video recording stage, which makes recorders generate usable videos easily. The experimental results show that the proposed method does not lose accuracy while largely reducing the labor cost in long-period heartbeat counting. The automatic and accurate heart rate calculation method proposed in this work can be extended to calculate other cardiac functions like heartbeat regularity.</p>
    <sec id="Sec13">
      <title>Online demonstration</title>
      <p id="Par45">As the target of the proposed method is video, an online demo page at <ext-link ext-link-type="uri" xlink:href="https://merry.ee.ncku.edu.tw/zebrafish">https://merry.ee.ncku.edu.tw/zebrafish/</ext-link> was setup to supplement the static figures in this manuscript. The source code of the proposed method is deposited in Github at <ext-link ext-link-type="uri" xlink:href="https://github.com/mbilab/zebrafish">https://github.com/mbilab/zebrafish</ext-link>.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Additional file</title>
    <sec id="Sec14">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="12859_2018_2166_MOESM1_ESM.docx">
            <label>Additional file 1:</label>
            <caption>
              <p><bold>Table S1.</bold> Performance of heart rate estimation with different color-to-grayscale methods. (DOCX 14 kb)</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>CHD</term>
        <def>
          <p id="Par4">Congenital heart disease</p>
        </def>
      </def-item>
      <def-item>
        <term>dpf</term>
        <def>
          <p id="Par5">Days post fertilization</p>
        </def>
      </def-item>
      <def-item>
        <term>EMA</term>
        <def>
          <p id="Par6">Exponential moving average</p>
        </def>
      </def-item>
      <def-item>
        <term>EMD</term>
        <def>
          <p id="Par7">Empirical mode decomposition</p>
        </def>
      </def-item>
      <def-item>
        <term>h-signal</term>
        <def>
          <p id="Par8">Heartbeat signal</p>
        </def>
      </def-item>
      <def-item>
        <term>IMFs</term>
        <def>
          <p id="Par9">Intrinsic mode functions</p>
        </def>
      </def-item>
      <def-item>
        <term>MAE</term>
        <def>
          <p id="Par10">Mean absolute error</p>
        </def>
      </def-item>
      <def-item>
        <term>rMAE</term>
        <def>
          <p id="Par11">Relative MAE</p>
        </def>
      </def-item>
      <def-item>
        <term>RMSE</term>
        <def>
          <p id="Par12">Root-mean-square error</p>
        </def>
      </def-item>
      <def-item>
        <term>ROI</term>
        <def>
          <p id="Par13">Regions of interest</p>
        </def>
      </def-item>
      <def-item>
        <term>rRMSE</term>
        <def>
          <p id="Par14">Relative RMSE</p>
        </def>
      </def-item>
      <def-item>
        <term>this work (−)</term>
        <def>
          <p id="Par15">Main features (the half-heart mask and noise filters) of this work was disabled.</p>
        </def>
      </def-item>
      <def-item>
        <term>tp-index</term>
        <def>
          <p id="Par16">Index to measure the tilting preference</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Electronic supplementary material</bold>
      </p>
      <p>The online version of this article (10.1186/s12859-018-2166-6) contains supplementary material, which is available to authorized users.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>Specially thank Yu-Jie Zheng and Yi-Hsuan Lin for helping us analyze and present the results.</p>
    <sec id="FPar1">
      <title>Funding</title>
      <p id="Par46">This work was supported by Ministry of Science and Technology, Taiwan (MOST 104–2628-E-006-004-MY3).</p>
    </sec>
    <sec id="FPar2">
      <title>Availability of data and materials</title>
      <p id="Par47">The datasets generated and/or analyzed during the current study are available from the corresponding author on reasonable request.</p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>DTHC and TFF conceived the research topic. HCT prepared the zebrafish videos. CPK and PHC developed the algorithm and wrote the manuscript. JMW improved the algorithm and developed the online system. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="COI-statement">
    <sec id="FPar3">
      <title>Ethics approval and consent to participate</title>
      <p id="Par48">This work prepared 32 zebrafish (<italic>Danio rerio</italic>, AB strain) larvae that were treated with 0.003% 1-phenyl 2-thiourea (PTU) at 24-h post-fertilization (hpf) to prevent melanogenesis. At 3 dpf, the zebrafish larvae were placed on concavity slides and mounted in 3% methylcellulose without anesthesia for recording. The zebrafish maintenance followed the standard husbandry procedures [<xref ref-type="bibr" rid="CR32">32</xref>]. All the zebrafish experiments were approved by the Affidavit of Approval of Animal Use Protocol of National Cheng Kung University (IACUC Approval NO. 96062). The larval cardiac videos were recorded by Leica Z16 APO microscope equipped with Canon EOS 550D megapixel digital single-lens reflex camera. The videos used for analysis were recorded in 60 frames per second (fps) with a resolution of 1280 X 720.</p>
    </sec>
    <sec id="FPar4">
      <title>Competing interests</title>
      <p id="Par49">The authors declare that they have no competing interests.</p>
    </sec>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sadowski</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <article-title>Congenital cardiac disease in the newborn infant: past, present, and future</article-title>
        <source>Crit Care Nurs Clin North Am</source>
        <year>2009</year>
        <volume>21</volume>
        <issue>1</issue>
        <fpage>37</fpage>
        <lpage>48</lpage>
        <pub-id pub-id-type="doi">10.1016/j.ccell.2008.10.001</pub-id>
        <?supplied-pmid 19237042?>
        <pub-id pub-id-type="pmid">19237042</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kimmel</surname>
            <given-names>CB</given-names>
          </name>
        </person-group>
        <article-title>Genetics and early development of zebrafish</article-title>
        <source>Trends Genet</source>
        <year>1989</year>
        <volume>5</volume>
        <fpage>283</fpage>
        <lpage>288</lpage>
        <pub-id pub-id-type="doi">10.1016/0168-9525(89)90103-0</pub-id>
        <?supplied-pmid 2686119?>
        <pub-id pub-id-type="pmid">2686119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lieschke</surname>
            <given-names>GJ</given-names>
          </name>
          <name>
            <surname>Currie</surname>
            <given-names>PD</given-names>
          </name>
        </person-group>
        <article-title>Animal models of human disease: zebrafish swim into view</article-title>
        <source>Nat Rev Genet</source>
        <year>2007</year>
        <volume>8</volume>
        <issue>5</issue>
        <fpage>353</fpage>
        <lpage>367</lpage>
        <pub-id pub-id-type="doi">10.1038/nrg2091</pub-id>
        <?supplied-pmid 17440532?>
        <pub-id pub-id-type="pmid">17440532</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Stainier</surname>
            <given-names>DY</given-names>
          </name>
        </person-group>
        <article-title>Zebrafish in the study of early cardiac development</article-title>
        <source>Circ Res</source>
        <year>2012</year>
        <volume>110</volume>
        <issue>6</issue>
        <fpage>870</fpage>
        <lpage>874</lpage>
        <pub-id pub-id-type="doi">10.1161/CIRCRESAHA.111.246504</pub-id>
        <?supplied-pmid 22427324?>
        <pub-id pub-id-type="pmid">22427324</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gervais-Pingot</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Legrand</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Nasr</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Schoevaert</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>In vitro quantification by image analysis of inotropic and chronotropic effects of drugs on cultures of cardiac myocytes</article-title>
        <source>Cell Biol Toxicol</source>
        <year>1994</year>
        <volume>10</volume>
        <issue>5–6</issue>
        <fpage>297</fpage>
        <lpage>300</lpage>
        <pub-id pub-id-type="doi">10.1007/BF00755773</pub-id>
        <?supplied-pmid 7697488?>
        <pub-id pub-id-type="pmid">7697488</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stainier</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Fouquet</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>J-N</given-names>
          </name>
          <name>
            <surname>Warren</surname>
            <given-names>KS</given-names>
          </name>
          <name>
            <surname>Weinstein</surname>
            <given-names>BM</given-names>
          </name>
          <name>
            <surname>Meiler</surname>
            <given-names>SE</given-names>
          </name>
          <name>
            <surname>Mohideen</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Neuhauss</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Solnica-Krezel</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Schier</surname>
            <given-names>AF</given-names>
          </name>
        </person-group>
        <article-title>Mutations affecting the formation and function of the cardiovascular system in the zebrafish embryo</article-title>
        <source>Development</source>
        <year>1996</year>
        <volume>123</volume>
        <issue>1</issue>
        <fpage>285</fpage>
        <lpage>292</lpage>
        <?supplied-pmid 9007248?>
        <pub-id pub-id-type="pmid">9007248</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schwerte</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Überbacher</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Pelster</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Non-invasive imaging of blood cell concentration and blood distribution in zebrafish Danio rerio incubated in hypoxic conditions in vivo</article-title>
        <source>J Exp Biol</source>
        <year>2003</year>
        <volume>206</volume>
        <issue>8</issue>
        <fpage>1299</fpage>
        <lpage>1307</lpage>
        <pub-id pub-id-type="doi">10.1242/jeb.00249</pub-id>
        <?supplied-pmid 12624165?>
        <pub-id pub-id-type="pmid">12624165</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Forouhar</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hove</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Calvert</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Flores</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Jadvar</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Gharib</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Electrocardiographic characterization of embryonic zebrafish</article-title>
        <source>Engineering in medicine and biology society, 2004 IEMBS'04 26th annual international conference of the IEEE</source>
        <year>2004</year>
        <fpage>3615</fpage>
        <lpage>3617</lpage>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Burns</surname>
            <given-names>CG</given-names>
          </name>
          <name>
            <surname>Milan</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Grande</surname>
            <given-names>EJ</given-names>
          </name>
          <name>
            <surname>Rottbauer</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>MacRae</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Fishman</surname>
            <given-names>MC</given-names>
          </name>
        </person-group>
        <article-title>High-throughput assay for small molecules that modulate zebrafish embryonic heart rate</article-title>
        <source>Nat Chem Biol</source>
        <year>2005</year>
        <volume>1</volume>
        <issue>5</issue>
        <fpage>263</fpage>
        <pub-id pub-id-type="doi">10.1038/nchembio732</pub-id>
        <?supplied-pmid 16408054?>
        <pub-id pub-id-type="pmid">16408054</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fink</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Callol-Massot</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Chu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Ruiz-Lozano</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Belmonte</surname>
            <given-names>JCI</given-names>
          </name>
          <name>
            <surname>Giles</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Bodmer</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Ocorr</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>A new method for detection and quantification of heartbeat parameters in Drosophila, zebrafish, and embryonic mouse hearts</article-title>
        <source>BioTechniques</source>
        <year>2009</year>
        <volume>46</volume>
        <issue>2</issue>
        <fpage>101</fpage>
        <pub-id pub-id-type="doi">10.2144/000113078</pub-id>
        <?supplied-pmid 19317655?>
        <pub-id pub-id-type="pmid">19317655</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <mixed-citation publication-type="other">Ocorr K, Fink M, Cammarato A, Bernstein SI, Bodmer R: Semi-automated optical heartbeat analysis of small hearts. <italic>Journal of visualized experiments: JoVE</italic> 2009;(31):e1435.</mixed-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Ohn</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Liebling</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>In vivo, high-throughput imaging for functional characterization of the embryonic zebrafish heart</article-title>
        <source>Biomedical imaging: from Nano to macro, 2011 IEEE international symposium on</source>
        <year>2011</year>
        <fpage>1549</fpage>
        <lpage>1552</lpage>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yozzo</surname>
            <given-names>KL</given-names>
          </name>
          <name>
            <surname>Isales</surname>
            <given-names>GM</given-names>
          </name>
          <name>
            <surname>Raftery</surname>
            <given-names>TD</given-names>
          </name>
          <name>
            <surname>Volz</surname>
            <given-names>DC</given-names>
          </name>
        </person-group>
        <article-title>High-content screening assay for identification of chemicals impacting cardiovascular function in zebrafish embryos</article-title>
        <source>Environmental science &amp; technology</source>
        <year>2013</year>
        <volume>47</volume>
        <issue>19</issue>
        <fpage>11302</fpage>
        <lpage>11310</lpage>
        <pub-id pub-id-type="doi">10.1021/es403360y</pub-id>
        <pub-id pub-id-type="pmid">24015875</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chan</surname>
            <given-names>PK</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>CC</given-names>
          </name>
          <name>
            <surname>Cheng</surname>
            <given-names>SH</given-names>
          </name>
        </person-group>
        <article-title>Noninvasive technique for measurement of heartbeat regularity in zebrafish (Danio rerio) embryos</article-title>
        <source>BMC Biotechnol</source>
        <year>2009</year>
        <volume>9</volume>
        <issue>1</issue>
        <fpage>11</fpage>
        <pub-id pub-id-type="doi">10.1186/1472-6750-9-11</pub-id>
        <?supplied-pmid 19228382?>
        <pub-id pub-id-type="pmid">19228382</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>De Luca</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Zaccaria</surname>
            <given-names>GM</given-names>
          </name>
          <name>
            <surname>Hadhoud</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Rizzo</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Ponzini</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Morbiducci</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Santoro</surname>
            <given-names>MM</given-names>
          </name>
        </person-group>
        <article-title>ZebraBeat: a flexible platform for the analysis of the cardiac rate in zebrafish embryos</article-title>
        <source>Sci Rep</source>
        <year>2014</year>
        <volume>4</volume>
        <fpage>4898</fpage>
        <pub-id pub-id-type="doi">10.1038/srep04898</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pylatiuk</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Sanchez</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Mikut</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Alshut</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Reischl</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Hirth</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Rottbauer</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Just</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Automatic zebrafish heartbeat detection and analysis for zebrafish embryos</article-title>
        <source>Zebrafish</source>
        <year>2014</year>
        <volume>11</volume>
        <issue>4</issue>
        <fpage>379</fpage>
        <lpage>383</lpage>
        <pub-id pub-id-type="doi">10.1089/zeb.2014.1002</pub-id>
        <?supplied-pmid 25003305?>
        <pub-id pub-id-type="pmid">25003305</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Puybareau</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Talbot</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Léonard</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Automated heart rate estimation in fish embryo</article-title>
        <source>Image processing theory, tools and applications (IPTA), 2015 international conference on</source>
        <year>2015</year>
        <fpage>379</fpage>
        <lpage>384</lpage>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nepstad</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Davies</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Altin</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Nordtug</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Hansen</surname>
            <given-names>BH</given-names>
          </name>
        </person-group>
        <article-title>Automatic determination of heart rates from microscopy videos of early life stages of fish</article-title>
        <source>J Toxic Environ Health A</source>
        <year>2017</year>
        <volume>80</volume>
        <issue>16–18</issue>
        <fpage>932</fpage>
        <lpage>940</lpage>
        <pub-id pub-id-type="doi">10.1080/15287394.2017.1352212</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Puybareau</surname>
            <given-names>É</given-names>
          </name>
          <name>
            <surname>Genest</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Barbeau</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Léonard</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Talbot</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>An automated assay for the assessment of cardiac arrest in fish embryo</article-title>
        <source>Comput Biol Med</source>
        <year>2017</year>
        <volume>81</volume>
        <fpage>32</fpage>
        <lpage>44</lpage>
        <pub-id pub-id-type="doi">10.1016/j.compbiomed.2016.12.007</pub-id>
        <?supplied-pmid 28013025?>
        <pub-id pub-id-type="pmid">28013025</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Krishna S, Chatti K, Galigekere RR: Automatic and robust estimation of heart rate in zebrafish larvae. <italic>IEEE transactions on automation science and engineering</italic> 2017.</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kanan</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Cottrell</surname>
            <given-names>GW</given-names>
          </name>
        </person-group>
        <article-title>Color-to-grayscale: does the method matter in image recognition?</article-title>
        <source>PLoS One</source>
        <year>2012</year>
        <volume>7</volume>
        <issue>1</issue>
        <fpage>e29740</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0029740</pub-id>
        <?supplied-pmid 22253768?>
        <pub-id pub-id-type="pmid">22253768</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Jack K. Video Demystified-forth edition. Newnes: Elsevier; 2007.</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Cramariuc</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Gabbouj</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Astola</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Clustering based region growing algorithm for color image segmentation</article-title>
        <source>Digital signal processing proceedings, 1997 DSP 97, 1997 13th international conference on</source>
        <year>1997</year>
        <fpage>857</fpage>
        <lpage>860</lpage>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tremeau</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Borel</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>A region growing and merging algorithm to color segmentation</article-title>
        <source>Pattern Recogn</source>
        <year>1997</year>
        <volume>30</volume>
        <issue>7</issue>
        <fpage>1191</fpage>
        <lpage>1203</lpage>
        <pub-id pub-id-type="doi">10.1016/S0031-3203(96)00147-1</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Celebi</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>Aslandogan</surname>
            <given-names>YA</given-names>
          </name>
          <name>
            <surname>Bergstresser</surname>
            <given-names>PR</given-names>
          </name>
        </person-group>
        <article-title>Mining biomedical images with density-based clustering</article-title>
        <source>International conference on information technology: coding and computing (ITCC'05)-volume II</source>
        <year>2005</year>
        <fpage>163</fpage>
        <lpage>168</lpage>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Ester</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Kriegel</surname>
            <given-names>H-P</given-names>
          </name>
          <name>
            <surname>Sander</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>A density-based algorithm for discovering clusters in large spatial databases with noise</article-title>
        <source>Kdd</source>
        <year>1996</year>
        <fpage>226</fpage>
        <lpage>231</lpage>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Hartigan JA, Wong MA. Algorithm AS 136: a k-means clustering algorithm. Appl Stat. 1979:100–8.</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <mixed-citation publication-type="other">Huang NE, Shen SS: Hilbert-Huang transform and its applications, vol. 5. Singapore: World Scientific; 2005.</mixed-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <mixed-citation publication-type="other">lun Chou Y: Statistical Analysis. Mishawaka: Holt International 1975.</mixed-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Awheda</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Schwartz</surname>
            <given-names>HM</given-names>
          </name>
        </person-group>
        <article-title>Exponential moving average based multiagent reinforcement learning algorithms</article-title>
        <source>Artif Intell Rev</source>
        <year>2016</year>
        <volume>45</volume>
        <issue>3</issue>
        <fpage>299</fpage>
        <lpage>332</lpage>
        <pub-id pub-id-type="doi">10.1007/s10462-015-9447-5</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Burkov</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Chaib-draa</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Effective learning in the presence of adaptive counterparts</article-title>
        <source>Journal of Algorithms</source>
        <year>2009</year>
        <volume>64</volume>
        <issue>4</issue>
        <fpage>127</fpage>
        <lpage>138</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jalgor.2009.04.003</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <mixed-citation publication-type="other">Westerfield M: The zebrafish book: a guide for the laboratory use of zebrafish (<italic>Brachydanio rerio</italic>). Eugene: University of Oregon Press; 1995.</mixed-citation>
    </ref>
  </ref-list>
</back>
