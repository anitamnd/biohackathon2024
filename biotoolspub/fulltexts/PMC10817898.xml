<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10817898</article-id>
    <article-id pub-id-type="publisher-id">44503</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-44503-5</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Using deep learning to quantify neuronal activation from single-cell and spatial transcriptomic data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Bahl</surname>
          <given-names>Ethan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-4873-9416</contrib-id>
        <name>
          <surname>Chatterjee</surname>
          <given-names>Snehajyoti</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-4849-9475</contrib-id>
        <name>
          <surname>Mukherjee</surname>
          <given-names>Utsav</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1019-3905</contrib-id>
        <name>
          <surname>Elsadany</surname>
          <given-names>Muhammad</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7522-3191</contrib-id>
        <name>
          <surname>Vanrobaeys</surname>
          <given-names>Yann</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lin</surname>
          <given-names>Li-Chun</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-0481-324X</contrib-id>
        <name>
          <surname>McDonough</surname>
          <given-names>Miriam</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Resch</surname>
          <given-names>Jon</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-4503-7344</contrib-id>
        <name>
          <surname>Giese</surname>
          <given-names>K. Peter</given-names>
        </name>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2423-4592</contrib-id>
        <name>
          <surname>Abel</surname>
          <given-names>Ted</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9713-0992</contrib-id>
        <name>
          <surname>Michaelson</surname>
          <given-names>Jacob J.</given-names>
        </name>
        <address>
          <email>jacob-michaelson@uiowa.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff8">8</xref>
        <xref ref-type="aff" rid="Aff9">9</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Department of Psychiatry, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Interdisciplinary Graduate Program in Genetics, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Iowa Neuroscience Institute, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Department of Neuroscience &amp; Pharmacology, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Interdisciplinary Graduate Program in Neuroscience, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Interdisciplinary Graduate Program in Molecular Medicine, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/0220mzb33</institution-id><institution-id institution-id-type="GRID">grid.13097.3c</institution-id><institution-id institution-id-type="ISNI">0000 0001 2322 6764</institution-id><institution>Department of Basic and Clinical Neuroscience, </institution><institution>King’s College London, </institution></institution-wrap>London, UK </aff>
      <aff id="Aff8"><label>8</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Department of Biomedical Engineering, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff9"><label>9</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Department of Communication Sciences &amp; Disorders, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>26</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>26</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2024</year>
    </pub-date>
    <volume>15</volume>
    <elocation-id>779</elocation-id>
    <history>
      <date date-type="received">
        <day>23</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>15</day>
        <month>12</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© This is a U.S. Government work and not under copyright protection in the US; foreign copyright protection may apply 2024</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Neuronal activity-dependent transcription directs molecular processes that regulate synaptic plasticity, brain circuit development, behavioral adaptation, and long-term memory. Single cell RNA-sequencing technologies (scRNAseq) are rapidly developing and allow for the interrogation of activity-dependent transcription at cellular resolution. Here, we present NEUROeSTIMator, a deep learning model that integrates transcriptomic signals to estimate neuronal activation in a way that we demonstrate is associated with Patch-seq electrophysiological features and that is robust against differences in species, cell type, and brain region. We demonstrate this method’s ability to accurately detect neuronal activity in previously published studies of single cell activity-induced gene expression. Further, we applied our model in a spatial transcriptomic study to identify unique patterns of learning-induced activity across different brain regions in male mice. Altogether, our findings establish NEUROeSTIMator as a powerful and broadly applicable tool for measuring neuronal activation, whether as a critical covariate or a primary readout of interest.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Neuronal activity is associated with transcriptional changes. Here, the authors present a deep learning model that integrates single cell transcriptomic signals to estimate neuronal activation.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Learning and memory</kwd>
      <kwd>Synaptic plasticity</kwd>
      <kwd>Transcriptomics</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000025</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Institute of Mental Health (NIMH)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01 MH 087463</award-id>
        <principal-award-recipient>
          <name>
            <surname>Michaelson</surname>
            <given-names>Jacob J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000055</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Institute on Deafness and Other Communication Disorders (NIDCD)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01 DC 014489</award-id>
        <principal-award-recipient>
          <name>
            <surname>Michaelson</surname>
            <given-names>Jacob J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000002</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>K99 AG 068306</award-id>
        <principal-award-recipient>
          <name>
            <surname>Michaelson</surname>
            <given-names>Jacob J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100009633</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | Eunice Kennedy Shriver National Institute of Child Health and Human Development (NICHD)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>P50 HD 103556</award-id>
        <principal-award-recipient>
          <name>
            <surname>Michaelson</surname>
            <given-names>Jacob J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2024</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Transcriptional regulation is a key component in the downstream response to neuronal stimulation, and the dysregulation of this activity-dependent gene expression has been linked to several nervous system disorders<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR6">6</xref></sup>. Although several techniques exist to identify active neurons with transgenic single-gene reporter systems<sup><xref ref-type="bibr" rid="CR7">7</xref>–<xref ref-type="bibr" rid="CR10">10</xref></sup>, there is currently no method available to estimate neuronal activity from transcriptome-wide signal in gene expression data. Estimating neuronal activation based on gene expression data is vital for unraveling the intricate processes governing neuronal function and dysfunction, and decades of research has been devoted to characterizing these processes<sup><xref ref-type="bibr" rid="CR1">1</xref>,<xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR11">11</xref></sup>. Accurate estimation of activation could provide insights into neural circuitry, advance our understanding of neurological disorders, and ultimately contribute to the development of targeted therapeutic interventions. With advances in single-cell RNA-sequencing (scRNAseq) technologies, researchers can now study activity-dependent transcription at the individual neuron level<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR13">13</xref></sup>. However, scRNAseq has persistent limitations such as sparsity and stochasticity in gene expression measurements, which challenge our ability to use these tools to understand neuronal activation<sup><xref ref-type="bibr" rid="CR14">14</xref>–<xref ref-type="bibr" rid="CR17">17</xref></sup>.</p>
    <p id="Par4">To address these challenges, we present an innovative tool that estimates neuronal activation using transcriptome-scale data as input. Using a comprehensive multi-species gene expression dataset, our deep learning model employs a single unit bottleneck to derive interpretable neuronal activity scores and an auxiliary input to the decoder to counteract dataset-specific biases. This novel approach, which distills the whole transcriptome into a single integrative activity score, challenges the single-gene paradigm (e.g., <italic>Fos</italic>) for measuring activity at the single cell and bulk tissue level.</p>
    <p id="Par5">Distilling transcriptome-scale signatures into a one-dimensional information bottleneck, our approach reconstructs the expression profiles of 22 well-established neuronal activity markers. We show that the resulting activity score is significantly associated with electrophysiological features of increased excitability, demonstrating its applicability in classifying neurons along this essential characteristic. We further show its application in secondary analyses of several single-cell data sets, as well as in new spatial transcriptomic data that captures learning-related circuit activation in the murine brain.</p>
    <p id="Par6">To facilitate community usage, we developed NEUROeSTIMator, an R package with a tutorial that demonstrates our model’s application to single-cell data. This innovative method offers a powerful solution to estimate neuronal activation based on de-noised latent patterns in single-cell gene expression, outperforming alternative approaches and providing significant associations with electrophysiological features at the single-cell level.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Multi-species training, test, and validation data sets</title>
      <p id="Par7">We developed a neural network to quantify signatures of transcriptional activation by training an autoencoder to reconstruct expression of 22 coexpressed activity-dependent genes from a 1-dimensional latent space (Fig. <xref rid="Fig1" ref-type="fig">1</xref>). We trained, validated, and tested the model using publicly available datasets, including single cell datasets from the Allen Institute of Brain Science<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> (AIBS) totaling over one million combined samples, as well as GEO datasets and a novel spatial transcriptomics dataset (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>). Activity-dependent genes were identified by intersecting differential expression results of three studies of experimental manipulation of neuron activity<sup><xref ref-type="bibr" rid="CR19">19</xref>–<xref ref-type="bibr" rid="CR21">21</xref></sup>. All three differential expression studies examined different brain regions, used different methods of neuronal stimulation, and were published from independent groups. Intersecting these three lists yielded a list of 29 candidate target genes (i.e., genes to be reconstructed in autoencoder output) Principal component analysis of the candidate genes revealed a relatively low dimensionality of expression profiles, with PC1 explaining a majority of the variance (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1a</xref>). Using the Allen datasets, we then performed bootstrap permutations of principal component analysis on candidate target genes and found a subset of 22 genes robustly exhibiting greater PC1 loadings than expected under a null PCA with randomly shuffled data (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1b</xref>). These 22 genes were selected as the final set of target genes to be reconstructed by the autoencoder during training. The Allen Cell Type Databases were downsampled with hierarchical weighting to increase balance of cell types, datasets, technical variation, and biological variation (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2a, b</xref>). Five hundred thousand neurons were selected and partitioned into cell type-balanced training and testing sets, and the training set was further split into 5 folds for cross validation. We trained the neural network to predict expression of the 22 activity-dependent target genes through a 1-dimensional hidden bottleneck layer with sigmoidal activation (see methods for a detailed description of model architecture and training). To evaluate model performance, we applied it to a diverse test set of 164,658 neurons held out from the training process, including 86,650 samples from the Allen and 78,108 samples from additional labeled datasets. We selected our final model based on classification accuracy of labeled test set data through cross validation.<fig id="Fig1"><label>Fig. 1</label><caption><title>Schematic Overview of NEUROeSTIMator.</title><p>The graphical abstract illustrates the application of NEUROeSTIMator, a deep learning model, to estimate neuronal activity. Transcriptome-wide gene expression data from individual neurons is input to an autoencoder, which reconstructs expression of immediate early genes from a single unit latent space called the ‘activity score’. The activity score can be applied to gene expression data, including single cell RNA-sequencing, Patch-seq, or spatial transcriptomics studies for detecting transcriptomic signatures of activity.</p></caption><graphic xlink:href="41467_2023_44503_Fig1_HTML" id="d32e434"/></fig></p>
      <p id="Par8">For further analyses, model output at the bottleneck activation layer was extracted to index activity level for each neuron passed through the model. Hereafter, we refer to this output as the predicted activity or activity score.</p>
    </sec>
    <sec id="Sec4">
      <title>Genes informing model predictions</title>
      <p id="Par9">To identify genes whose expression levels influence model predictions, we calculated integrated gradients<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> for all input genes with respect to predicted activity using data from the held out test set. Integrated gradients attribute model predictions to input features for each cell. We first compared the attributions of target and non-target genes on predicted activity. The most influential genes were <italic>Fos, Egr1</italic>, <italic>Fosl2, Junb, Fbxo33</italic>, and <italic>Nr4a1</italic>. We further explored gene importance for all non-target input genes and found varying degrees of influence throughout the transcriptome (Supplementary Data <xref rid="MOESM4" ref-type="media">2</xref>). The most influential non-target genes, such as <italic>Fosb</italic>, <italic>Npas4</italic>, <italic>Egr2</italic>, and <italic>Ntrk2</italic> tended to have higher initial support for consideration as a target gene and were more often differentially expressed in multiple transcriptomic studies of neuronal activity-dependent transcription (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a</xref>). Other known activity response genes such as <italic>Homer1, Egr4, Dusp6</italic>, and <italic>Bdnf</italic> were also among the top fifty genes with the highest feature attribution. To evaluate whether influential genes were enriched for specific annotated biological mechanisms, we performed gene set enrichment analysis on gene ontology and pathway annotation sets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3b</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">3</xref>). Among the most highly enriched gene sets were DNA binding transcription factor activator activity (<italic>p</italic><sub>adjusted</sub> = 3.97 × 10<sup>−9</sup>, NES = 2.29), signaling by NTRKs (<italic>p</italic><sub>adjusted</sub> = 2.07 × 10<sup>−8</sup>, NES = 2.40), cognition (<italic>p</italic><sub>adjusted</sub> = 5.35 × 10<sup>−3</sup>, NES = 2.01), MAPK signaling pathway (<italic>p</italic><sub>adjusted</sub> = 2.02 × 10<sup>−4</sup>, NES = 2.01), circadian rhythm (<italic>p</italic><sub>adjusted</sub> = 1.60 × 10<sup>−3</sup>, NES = 2.03), and cellular response to extracellular stimulus (<italic>p</italic><sub>adjusted</sub> = 0.033, NES = 1.89). To identify gene sets with higher attribution in non-target genes, we removed target genes, repeated the analysis, and identified gene sets that remained, or became significant. Of the 45 pathways significantly enriched when examining all genes, seven sets remained significant when excluding target genes, and seven new sets became significant, including positive regulation of neurogenesis (<italic>p</italic><sub>adjusted</sub> = 0.019, NES = 1.48), regulation of synapse structure or activity (<italic>p</italic><sub>adjusted</sub> = 0.018, NES = 1.49), and PI3/AKT signaling (<italic>p</italic><sub>adjusted</sub> = 0.019, NES = 1.37) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3b</xref>).</p>
    </sec>
    <sec id="Sec5">
      <title>Electrophysiological features of individual neurons predicted by transcription via NEUROeSTIMator</title>
      <p id="Par10">As an initial application of our model, we examined neurons subjected to direct electrical stimulation. We integrated single cell RNA assays of a Patch-seq dataset<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> with a SMART-seq dataset<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> of mouse GABAergic neurons, both generated by the Allen Institute for Brain Science (AIBS) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a</xref>). Using the standard Seurat workflow<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>, we identified seven clusters corresponding to AIBS-defined neuron types including Sst, Sst Chodl, Pvalb, Vip, Lamp5, Sncg, and Meis2 neuron clusters. We applied NEUROeSTIMator to both datasets and observed elevated activity score predictions in the Patch-seq dataset relative to the SMART-seq dataset for seven neuron types (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). We obtained empirical p-value estimates of the Kolmogorov–Smirnov (KS) test by permuting expression values in each cell and recalculating activity score for one thousand permutations. Six of the seven neuron types showed significant differences in activity score distributions between datasets (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>), of which Lamp5 neurons showed the greatest difference (<italic>p</italic> &lt; 0.001, D = 0.79, KS test) and Vip neurons showing the smallest difference (<italic>p</italic> = 0.033, D = 0.41, KS test). We also noted that several immediate early genes, which serve as predictive targets for NEUROeSTIMator, were among the top genes with higher mean expression in the Patch-seq dataset compared to the SMART-seq dataset (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b</xref>). Together, these results suggest that the Patch-seq protocol induces significantly greater transcriptional upregulation of activity-dependent genes as compared to the standard SMART-seq protocol, and our model is sensitive to these differences. Notably, this effect is consistent for nearly all neuronal types tested.<fig id="Fig2"><label>Fig. 2</label><caption><title>Electrophysiological features of neuronal stimulation captured by transcriptome-based activity score.</title><p><bold>a</bold> Activity score distributions compared between stimulated Patch-seq neurons (gold) and unstimulated SMART-seq neurons (violet). The number of cells in each comparison are given as text annotations for each density plot. <bold>b</bold> Observed D statistics (red line) and empirical distribution from Kolmogorov–Smirnov tests (two-sided) between activity score distributions of Patch-seq and SMART-seq datasets, using permutations of shuffled expression values (<italic>n</italic> = 1000 permutations per cell type) from all cells represented in <bold>a</bold>. Boxplots depict median value, box bounds denote interquartile range (IQR), whiskers denote values within ±1.5 x IQR, and points outside of whisker range denote outliers with values ≥1.5 x IQR. <bold>c</bold> Associations between electrophysiological (e-phys) features and predicted activity (<italic>n</italic> = 1277 cells). Heatmap shows feature value columns ordered by the mean bootstrap coefficient, and individual neuron rows ordered by ephys-based lasso model prediction of NEUROeSTIMator output (top). Predicted and observed NEUROeSTIMator output shown to the right. Colors represent z-scaled values, with red colors indicating higher values and blue indicating lower values. The dot plot (bottom) shows a summary of coefficients estimated by fitting lasso-regularized linear models between electrophysiology feature value and NEUROeSTIMator output (<italic>n</italic> = 10,000 bootstrap permutations per feature). Dots represent the mean coefficient estimate across bootstraps, lines indicate standard error across bootstraps. <italic>P</italic>-values were estimated by counting the number of bootstrap permutations where the coefficient was zero or the opposite sign of coefficients observed from the lasso model fit to all data. Significant features with standard errors that do not cross zero (<italic>p</italic> &lt; 0.05, unadjusted) are depicted by green-colored dots (bottom). See source data for full statistics and feature descriptions. <bold>d</bold> Spike train comparison of two Vip<italic>/</italic>Ptprt<italic>/</italic>Pkp2 neurons exhibiting representative electrophysiological features of high (red) and low (blue) NEUROeSTIMator predictions (ramp current injected - top panel, membrane potential - bottom panel). <bold>e</bold> Patch-seq validation of the positive association between input resistance and NEUROeSTIMator predictions in a novel set of human excitatory neurons (<italic>n</italic> = 25 cells). Pearson’s correlation test (two-sided) statistics annotated; linear fit (orange line). Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_44503_Fig2_HTML" id="d32e624"/></fig></p>
      <p id="Par11">We established that our model detects transcriptomic signals that separate the electrically stimulated Patch-seq dataset from the unstimulated SMART-seq dataset. However, it is not clear whether elevated activity was due to electrical stimulation and neuron depolarization, or general features of the Patch-seq protocol. Patch-seq neurons showed variability in predicted activity and, because all neurons underwent the stimulation protocol, we hypothesized that variability in activity score predictions were linked to individual neuron differences in electrophysiological features, either intrinsic properties, or responses to stimulation.</p>
      <p id="Par12">To determine if NEUROeSTIMator predictions of activity could be explained by electrophysiology, we fit a lasso-regularized generalized linear model with 10-fold cross validation to predict NEUROeSTIMator output using only electrophysiological features derived from Patch-seq recordings. We used 41 electrophysiological features, including features measured at baseline and in response to the current ramp stimulus. As substantial differences in electrophysiology exist between neuron types, we residualized activity score and derived features for neuron type in order to force the model to learn cell type-agnostic combinations of features that explain variability in activity score. For further analyses, we focus on the four most abundant neuron types: Lamp5, Pvalb, Sst, and Vip neurons. A PCA on these 41 features revealed 90% of variance is explained by fifteen principal components, three of which were associated with activity score (<italic>p</italic> &lt; 0.05) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4c</xref>). The cross-validated lasso model predictions were significantly correlated with NEUROeSTIMator output (R = 0.234, <italic>p</italic> &lt; 2.2 × 10<sup>−16</sup>). To evaluate feature importance for each electrophysiological feature, we obtained bootstrap coefficient estimates and standard errors by permuting sample weights for each of 10,000 model fits (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). Three features showed robust non-zero coefficients; membrane time constant (tau) (coefficient = −0.154, standard error = 0.037), input resistance (coefficient: 0.088, standard error = 0.041), and the threshold current to depolarization (coefficient = −0.080, standard error = 0.038). The combination of these features and their direction of effect suggest that the most stimulus-responsive neurons, those which exhibit a transcriptional response, are more excitable than other neurons of the same type (Fig. <xref rid="Fig2" ref-type="fig">2d</xref>). We then examined specifically the relationship between input resistance and NEUROeSTIMator predictions in an independent Patch-seq dataset of human excitatory neurons and, again, found a significant positive correlation (<italic>r</italic> = 0.497, <italic>p</italic> = 0.011) (Fig. <xref rid="Fig2" ref-type="fig">2e</xref>). Despite the fundamental differences between Patch-seq datasets in species and major neuron class, this successful validation emphasizes the robustness of the relationship between neuronal excitability and transcriptional response to stimulation, as revealed through NEUROeSTIMator predictions.</p>
      <p id="Par13">To better understand how NEUROeSTIMator connects gene expression to electrophysiology, we performed generalized canonical correlation analysis using three input matrices: the gene expression matrix, a matrix containing the three significant electrophysiology features, and a one column matrix containing the NEUROeSTIMator output. We computed a single component and examined gene expression loadings to understand genes explaining covariance of both predicted activity and the electrophysiological features of excitability. We used GSEA to identify gene sets enriched for the genes correlated to both predicted activity and excitability (Supplementary Data <xref rid="MOESM4" ref-type="media">4</xref>). We found significant enrichment of several gene sets including DNA binding transcription activator activity (<italic>p</italic><sub>adjusted</sub> = 2.74 × 10<sup>−5</sup>, NES = 1.91), MAPK signaling (<italic>p</italic><sub>adjusted</sub> = 2.54 × 10<sup>−4</sup>, NES = 1.78), and RAS signaling (<italic>p</italic><sub>adjusted</sub> = 3.80 × 10<sup>−2</sup>, NES = 1.48) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4d</xref>). Genes common to these pathways with high loadings included <italic>Dusp6</italic>, <italic>Dusp10</italic>, <italic>Map3k4</italic>, <italic>Ntrk2</italic>, <italic>Rasgrp1</italic>, and <italic>Prkca</italic>. These pathways constitute an established molecular signaling cascade that functions to link neuron depolarization and related calcium influx to transcriptional response<sup><xref ref-type="bibr" rid="CR25">25</xref>,<xref ref-type="bibr" rid="CR26">26</xref></sup>.</p>
      <p id="Par14">Taken together, these results demonstrate that NEUROeSTIMator captures transcriptomic signatures of activity that are associated with electrophysiological properties measured in response to electrical stimulation of individual neurons. Building upon this successful application in electrophysiology, we next extended our analyses to demonstrate NEUROeSTIMator’s utility across a range of applications (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>Detecting pharmacological activation of neurons</title>
      <p id="Par15">We applied our model to three single-cell datasets containing neurons from rodents and human cell lines treated with powerful stimulating, pharmacological agents. From the first dataset, we computed activity score for neurons of mice treated with either saline or pentylenetetrazol (PTZ), a depolarizing agent used to model status epilepticus and induce seizures<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR28">28</xref></sup>. As expected, we observed significant differences in distributions of predicted activity (KS test) for 11/14 neuronal subclasses tested, including excitatory cortical layer 2/3 (L2/3) neurons, Lamp5 interneurons, and Sst interneurons (L2/3 IT CTX: D = 0.40, <italic>p</italic> = 9.67 × 10<sup>−24</sup>), (L2/3 IT ENT: D = 0.5, <italic>p</italic> = 4.64 × 10<sup>−28</sup>), (Lamp5: D = 0.49, <italic>p</italic> = 1.73 × 10<sup>−4</sup>), (Sst: D = 0.42, <italic>p</italic> = 3.81 × 10<sup>−6</sup>) (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">5</xref>).<fig id="Fig3"><label>Fig. 3</label><caption><title>Multi-species generalization of neuronal activity score applied to previously published chemical induction studies.</title><p>Predicted activity for various neuron types responding to treatment with potent chemical modulators of neuron activity. <bold>a</bold> Response to PTZ-induced seizure (red) and controls (white) in mouse cortical neurons. <bold>b</bold> Cocaine treatment (red) or controls (white) in rat nucleus accumbens neurons. <bold>c</bold> Time series of predicted activity for human iPSCs treated with depolarizing potassium chloride at 0 h (control), 1 h, 2 h, and 4 h. Annotated statistics from Kolmogorov–Smirnov tests (one-sided) are provided in Supplementary Data <xref rid="MOESM4" ref-type="media">5</xref>. Boxplots depict median value, box bounds denote interquartile range (IQR), whiskers denote values within ±1.5 x IQR, and points outside of whisker range denote outliers with values ≥1.5 x IQR. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_44503_Fig3_HTML" id="d32e776"/></fig></p>
      <p id="Par16">Next, we compared activity score between neurons from the nucleus accumbens (NAc) of rats treated with either saline or cocaine, a stimulant acting on dopaminergic neurotransmission<sup><xref ref-type="bibr" rid="CR29">29</xref>,<xref ref-type="bibr" rid="CR30">30</xref></sup>. We found neuron subtype-specific increases in activity score. Two subclasses of dopaminergic medium spiny neurons (MSNs) and both Pvalb interneurons exhibited significant differences in predicted activity (Drd1-MSN: D = 0.15, <italic>p</italic> = 5.92 × 10<sup>−7</sup>), (Drd3-MSN: D = 0.19, <italic>p</italic> = 0.049), (Pvalb: D = 0.22, <italic>p</italic> = 0.028 (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">5</xref>). Because our model was not trained using any rat or dopaminergic neurons, these findings provide further endorsement for robust estimation of neuronal activity induced by potent pharmacological agents of stimulation.</p>
      <p id="Par17">To further evaluate whether our model could be successfully applied to human data, we examined a dataset of human induced pluripotent stem cell-derived neurons<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. Neuron cultures were either unstimulated or treated with KCl depolarization<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> buffer for 1, 2, or 4 h. Our model predicted low neuronal activity for the unstimulated group, which was consistent among cell types and biological replicates. Cells treated with KCl for 1 h demonstrated substantial and significant increases in predicted activity. Although significant shifts in predicted activity were observed for all cell types (<italic>p</italic> &lt; 0.05), the activity score of post-mitotic neurons displayed a stronger response to KCl compared to mitotic progenitors. The most responsive neuron types were the mature striatal neurons and pallial neurons (striatal: D<sub>1hr</sub> = 0.69, D<sub>2hr</sub> = 0.58, D<sub>4hr</sub> = 0.50, <italic>p</italic><sub>1hr/2hr/4hr</sub> &lt; 2.22 × 10<sup>−16</sup>), (pallial: D<sub>1hr</sub> = 0.75, D<sub>2hr</sub> = 0.67, D<sub>4hr</sub> = 0.64, <italic>p</italic><sub>1hr/2hr/4hr</sub> &lt; 2.22×10<sup>−16</sup>) (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">5</xref>). Notably, all cell clusters except neural progenitors and septal neurons followed a similar temporal pattern of predicted activity modestly declining at 2 h relative to peak activity at 1 h, with a further decline at 4 h (i.e., D<sub>1hr</sub> &gt; D<sub>2hr</sub> &gt; D<sub>4h</sub>). Despite the steady decline in predicted activity after 1 h, none of the neuron clusters completely returned to basal activity by 4 h, the final time point in the experiment. The temporal trends of predicted activity are indicative of synaptic depression<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>, suggesting NEUROeSTIMator is sensitive to detecting short term plasticity mechanisms.</p>
      <p id="Par18">Together, these analyses suggest our model can robustly assign higher estimates of activity to cells subjected to chemical exposures that are expected to elicit strong and generally ubiquitous transcriptional responses to stimulation.</p>
    </sec>
    <sec id="Sec7">
      <title>Activity score as a generalizable classifier of neuronal stimulation</title>
      <p id="Par19">Next, we asked if our model could detect neuronal activation by more subtle forms of stimuli, such as sensory experience. We applied our model to a dataset containing visual cortex neurons from mice housed in darkness for seven days prior to light exposure for 0, 1, or 4 h<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). We observed a significant increase in predicted activity for neurons from mice exposed to light, relative to controls. To elucidate temporal patterns of activity, we tested differences in activity score distributions between pairs of each time point. Activity score was significantly increased at 1 h for all cell types, in particular for excitatory cortical neurons (layer 2/3: D = 0.56, <italic>p</italic> &lt; 2.22 × 10<sup>−16</sup>), (layer 4: D = 0.60, <italic>p</italic> &lt; 2.22 × 10<sup>−16</sup>), (layer 6: D = 0.54, <italic>p</italic> &lt; 2.22 × 10<sup>−16</sup>). At 4 h of light exposure, predicted activity began to show diverging trends which were foreshadowed by predicted activity at 1 h. Although trending towards a return to baseline, activity scores of neurons at 4 h were not significantly different from neurons at 1 h, while several glial cell types returned to baseline (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">6</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>Temporal patterns and classification of in vivo sensory activation.</title><p><bold>a</bold> Cell type activity predictions of visual cortex neurons in freely behaving mice exposed to light for 0, 1, or 4 h. Activity predictions summarized by cell type and experimental group, and Kolmogorov–Smirnov (one-sided) test results are provided in Supplementary Data <xref rid="MOESM4" ref-type="media">6</xref>. Color indicates cell type and shape indicates major cell type groupings. <bold>b</bold> ROC plots indicate the ability of predicted activity to distinguish between the 0 h and 1 h experimental groups. Diagonals from bottom left to top right indicate an accuracy similar to random chance, while lines moving straight vertically, then straight horizontally indicate perfect separation. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_44503_Fig4_HTML" id="d32e911"/></fig></p>
      <p id="Par20">As we observed similar trends in temporal activity predictions between the unstimulated (0 h) and 1 h group, we investigated the degree to which the activity score derived from our model could be used as a classifier of experimental group. The degree to which activity score is predictive of experimental group in a particular cell type is expected to represent the robustness of the response in that cell type. Using the visual cortex dataset (VIS) mentioned above, we constructed receiver-operator curve (ROC) plots for neuronal and non-neuronal cell types (Fig. <xref rid="Fig4" ref-type="fig">4b</xref>). For both excitatory neuron and interneuron subtypes, the activity score demonstrated varying degrees of predictive power. For example, the activity score alone was able to almost perfectly separate stimulation groups when considering excitatory cortical layer cell types (layer 2/3: AUC = 0.84), (layer 4: AUC = 0.89), (layer 6: AUC = 0.823), as well as certain interneuron cell types (Sst-2: AUC: 0.97), (Vip: AUC = 0.90). Despite the model being trained on purely neuronal cell type populations, the activity score was able to separate stimulation groups for astrocytes (AUC = 0.84) and endothelial cells (AUC = 0.72) with comparable accuracy to neurons.</p>
    </sec>
    <sec id="Sec8">
      <title>Utility in data modalities beyond scRNA-seq</title>
      <p id="Par21">Next, we asked whether our model could identify spatial signatures of learning in brain slices of mice following spatial object recognition (SOR) training - a widely used behavioral paradigm to investigate spatial memory mechanisms<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. Using spatial transcriptomic data from brain slices of SOR-trained and homecage control (HC) male mice, we applied our model to predict activity for each spot (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5a</xref>) and clustered all spots into anatomical regions. The 22 resulting clusters were annotated with brain region naming conventions from the Allen Mouse Brain Atlas (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). In baseline homecage samples, we noted weak activation signatures, primarily covering regions of the striatum and hypothalamus as well as subregions of the hippocampus (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>, left). Following SOR training, we noted region-specific increases in predicted activity (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>, right). To identify a spatial activation signature of SOR for the entire brain slice, we tested for differences in predicted activity for each brain region cluster (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>). We observed significant increases in predicted activity for several cortical and subcortical regions. Multiple layers of the isocortex and the retrosplenial area showed increases in activity following SOR (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>), with the greatest increases observed in layers 2/3 (β = 0.17, <italic>p</italic><sub>adjusted</sub> = 3.16 × 10<sup>−4</sup>) and the retrosplenial cortex (β = 0.17, <italic>p</italic><sub>adjusted</sub> = 1.00 × 10<sup>−6</sup>). The caudoputamen area of the dorsal striatum, subregions of the hippocampus, and the olfactory/piriform areas also showed significant increases in activity, of comparable magnitude (caudoputamen: β = 0.12, <italic>p</italic><sub>adjusted</sub> = 8.01 × 10<sup>−4</sup>). Subregions of the hippocampus were variably activated following SOR, with the strongest induction observed in the CA1 subregion (β = 0.12, <italic>p</italic><sub>adjusted</sub> = 9.14 × 10<sup>−5</sup>), while the dentate gyrus subregion did not show significant activation (β = 0.03, <italic>p</italic><sub>adjusted</sub> = 0.07). Other regions predicted to be least activated by SOR include the thalamus, hypothalamus, and fiber tracts (Supplementary Data <xref rid="MOESM4" ref-type="media">7</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><title>Spatial transcriptomic patterns of neuronal activation after spatial learning.</title><p><bold>a</bold> Spatial anatomical clustering of RNA-sequencing spots. RSP retrosplenial area, HY hypothalamus, AMY amygdala, med: medial, lat lateral. <bold>b</bold> Activity score per spot, averaged within experimental groups of homecage controls (left) and 1 h after SOR training (right). Yellow color indicates low activity and red indicates high activity. <bold>c</bold> Brain region-specific induction of activity following SOR training. Differences tested using a linear mixed effects model (two-sided), colored by the SOR coefficient estimate per region (<italic>n</italic> = 3 biologically independent mice per group). Dark purple colors represent greater differences between groups. Cluster-wise differential activity statistics are summarized in (<bold>d</bold>) and provided in Supplementary Data <xref rid="MOESM4" ref-type="media">7</xref>. Dots represent estimated coefficients of SOR on activity score; linear fit. Brackets indicate standard error of the coefficient. Asterisks indicate a significant difference in activity score between homecage and SOR groups—false discovery rate (FDR)-adjusted <italic>p</italic>-values are *FDR ≤ 0.05, **FDR ≤ 0.01, ***FDR ≤ 0.001, and ****FDR ≤ 0.0001. Exact <italic>p</italic>-values, FDR, coefficients, and the number of cells per group, per brain region are provided in Supplementary Data <xref rid="MOESM4" ref-type="media">7</xref>. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_44503_Fig5_HTML" id="d32e1012"/></fig></p>
      <p id="Par22">Visium samples contain signal from multiple neuronal and non-neuronal cells. Cortical layers and CA1 showed profound increases in activity but are also known to have relatively high neuron density. Therefore, we considered the extent to which regional neuron density influences coefficient estimates in Fig. <xref rid="Fig5" ref-type="fig">5d</xref>. We performed cell type deconvolution on each Visium spot, using neuronal and non-neuronal cell type expression profiles from the Allen Cell Types Database. For a subset of genes with high variability across cell classes, we fit a linear model to each Visium spot as a function of GABAergic, glutamatergic, and non-neuronal expression profiles. Coefficient estimates for each cell class were rescaled across samples to a range of zero to one, and then adjusted for each sample to sum to one, thus providing a proxy measure of cell class density (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a</xref>). We found a significant positive relationship between estimated regional neuron abundance and log-estimated regional effect of learning on activity (β = 0.87, <italic>p</italic> = 0.01), (Spearman correlation = 0.54, <italic>p</italic> = 0.009) (Supplementary. Fig. <xref rid="MOESM1" ref-type="media">6b</xref>). We used the residuals of the linear model in Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b</xref> as a neuron density-corrected view of the effect of learning (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6c</xref>). Cortical layers, retrosplenial cortex, CA1, and caudoputamen regions show greater learning-induced increases in activity score than expected based on neuron density estimates alone, suggesting that neurons in these regions exhibit a more potent transcriptional response to learning, or that there are other cell types contributing to the activity signature. The dentate gyrus and regions of the hypothalamus, amygdala, thalamus showed lower activity induction than expected.</p>
      <p id="Par23">To validate the finding that the CA1 region was preferentially activated by spatial learning over the dentate gyrus, we performed RNAscope<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> on coronal brain slices from SOR-trained (1 h post-training) and homecage control mice (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5b</xref>). We selected three NEUROeSTIMator target genes, <italic>Egr1</italic>, <italic>Egr3</italic>, and <italic>Nr4a1</italic> as probes. For each brain slice, we quantified mean fluorescent intensity (MFI) of each probeand then averaged the MFI of all three probes for each hippocampal subregion. A two-way ANOVA revealed a significant interaction between hippocampal subregions and training groups. In line with the spatial transcriptomic data (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5c</xref>), we found that CA1 showed a preferential increase in average probe intensity following spatial learning (Sidak’s test, CA1: <italic>p</italic><sub>adjusted</sub> = 0.0075, dentate gyrus: <italic>p</italic><sub>adjusted</sub> = 0.5553) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5d</xref>).</p>
    </sec>
    <sec id="Sec9">
      <title>NEUROeSTIMator outperforms competing methods in discriminating experimental stimulation groups</title>
      <p id="Par24">The NEUROeSTIMator approach to quantifying activity uses an encoding neural network to infer transcriptome-wide coexpression with a set of 22 activity-dependent target genes. We investigated whether the added complexities of our model are necessary to produce a metric that successfully discerns stimulated samples from unstimulated. We compared NEUROeSTIMator to seven alternative models. The first competing method is a scaled additive model, a simple and easily implementable approach that scales normalized expression of NEUROeSTIMator’s 22 target genes across samples to range of [0,1], and then sums scaled values within samples. The second method, the PC1 model, scores samples with target gene loadings derived from the first component of a PCA on the NEUROeSTIMator training dataset. The third method uses MAGIC for graph-based imputation before applying the scaled additive approach to the imputed expression values. The fourth method, the transcriptome-naïve model, is a neural network trained with identical parameters to NEUROeSTIMator, but without access to non-target gene expression inputs. The fifth approach, the transcriptome reconstruction approach, is a neural network trained with identical parameters to NEUROeSTIMator but reconstructs the entire transcriptome with the 22 target genes having equal total loss weight to all other genes. The sixth and seventh approaches, the 2 &amp; 3-unit bottleneck models, are neural networks trained with identical parameters to NEUROeSTIMator, but using two and three bottleneck units, respectively. We evaluated each model by scoring activity in stimulated and unstimulated samples from six datasets (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>) and determined separability of the experimental groups using area under the curve (AUC). This approach was applied to datasets featured in Figs. <xref rid="Fig3" ref-type="fig">3</xref>, <xref rid="Fig4" ref-type="fig">4</xref>, and <xref rid="Fig5" ref-type="fig">5</xref>, as well as a novel single nuclei dataset from mouse dorsal hippocampus following SOR. For each method, dataset, and neuron type we computed AUC and summarized the performance differences between NEUROeSTIMator and competing methods (ΔAUC). (Supplementary Figs. <xref rid="MOESM1" ref-type="media">7</xref>, <xref rid="MOESM1" ref-type="media">8</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">8</xref>). NEUROeSTIMator demonstrated higher performance than each of the competing methods (AUC<sub>NEUROeSTIMator</sub> = 0.732, AUC<sub>scaled.additive</sub> = 0.651, AUC<sub>MAGIC</sub> = 0.587, AUC<sub>PC1</sub> = 0.661, AUC<sub>transcriptome.naive</sub> = 0.671, AUC<sub>transcriptome.reconstruction</sub> = 0.702, AUC<sub>NEUROeSTIMator.2units</sub> = 0.725, AUC<sub>NEUROeSTIMator.3units</sub> = 0.717), (mean ΔAUC<sub>scaled.additive</sub> = +0.081, ΔAUC<sub>MAGIC</sub> = +0.145, ΔAUC<sub>PC1</sub> = +0.071, ΔAUC<sub>transcriptome.naive</sub> = +0.061, ΔAUC<sub>transcriptome.reconstruction</sub> = +0.030, ΔAUC<sub>NEUROeSTIMator.2units</sub> = +0.007, ΔAUC<sub>NEUROeSTIMator.3units</sub> = +0.015). Across all competing methods, datasets, and sample groupings, NEUROeSTIMator increased AUC in 77.9% of 763 comparisons. For comparisons where NEUROeSTIMator outperformed the competing method, the average increase in AUC was +0.077. For the remaining 22.1% of comparisons where NEUROeSTIMator did worse than the competing method, the average decrease in AUC was −0.031. Together, these results suggest that the neural network architecture and NEUROeSTIMator’s use of broader transcriptomic signals underlie its enhanced performance compared to alternative approaches.</p>
    </sec>
  </sec>
  <sec id="Sec10" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par25">We introduce NEUROeSTIMator, a versatile tool that estimates neuronal activity from transcriptome-wide single-cell gene expression data. Our method generates an activity score that reflects whole-transcriptome response to stimulation, facilitating the rapid identification and prioritization of neurons displaying stimulus response. NEUROeSTIMator’s performance and generalizability are demonstrated through capturing electrophysiological (e-phys) features and detecting activation signatures across various stimulation protocols, neuron subtypes, species, and sequencing technologies, including spatial transcriptomics.</p>
    <p id="Par26">Our analysis reveals that activity-predictive signals are distributed broadly across the transcriptome and are enriched for genes related to external stimulus response, synaptic plasticity, MAP kinase activity, and circadian rhythm. Moreover, we demonstrate a significant link between NEUROeSTIMator’s predictions and increased neuronal excitability, utilizing a unique single-cell Patch-seq dataset containing gene expression and e-phys readouts from individual GABAergic murine neurons<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. These results were further confirmed through a significant association between the activity score and measures of excitability in human excitatory neurons<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>.</p>
    <p id="Par27">We showcase NEUROeSTIMator’s flexibility and generalizability through secondary analyses of several diverse published datasets, detecting potent pharmacologically induced neuronal activity and generalizing across species and cell types. Importantly, our model also detects physiologically relevant activation in response to sensory experiences and uncovers unexpected activity in non-neuronal cells (e.g., astrocytes), suggesting potential applicability to other cell types and stimulus responses.</p>
    <p id="Par28">In a novel application, we use NEUROeSTIMator to analyze spatial transcriptomic data from mice subjected to a spatial learning task, revealing a brain-wide map of learning-induced activation. This highlights the method’s adaptability to spatial transcriptomics (and other varieties of bulk RNA-seq data) and suggests potential for uncovering distinct spatial signatures of transcriptional activation related to cognitive processes.</p>
    <p id="Par29">While our model demonstrates a significant link between transcriptional response and e-phys features in murine interneurons and human excitatory neurons, its applicability to e-phys features in broader cell types is limited by the few available Patch-seq datasets. Additionally, our model does not inherently differentiate stimulation types (e.g., pharmacological vs. naturalistic), and we observed some sensitivity to activity signatures in non-neuronal cell types (a potentially desirable feature, depending on the application). Further, the activity score is limited to detecting activation linked to immediate early gene expression; other potential mechanisms that may be linked to neuronal activation and that act independently of this well-established mechanism may not be detected by our tool. Despite these limitations, NEUROeSTIMator delivers key insights across several neuroscience research domains.</p>
    <p id="Par30">As the first robust and generalizable method for estimating neuronal activation from transcriptomic data, NEUROeSTIMator has broad implications for molecular neuroscience research and challenges the single-gene paradigm of measuring neuronal activity. Our method enables the estimation of cellular activity state, a fundamental variable in gene expression research, paving the way for its integration into single-cell and spatial transcriptomics analyses.</p>
  </sec>
  <sec id="Sec11">
    <title>Methods</title>
    <sec id="Sec12">
      <title>Dataset for model training and evaluation</title>
      <p id="Par31">To train the model, we utilized publicly available datasets provided by the Allen Institute for Brain Science, including a single-cell RNA-sequencing (scRNAseq) dataset of over a million cells isolated from mouse cortical and hippocampal tissue<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>, and a single-nuclei RNA-sequencing (snRNAseq) dataset of 76,000 nuclei isolated from human cortical tissue. Hereafter, these datasets will be referred to as the Allen Mouse and Allen Human datasets. Both datasets used the 10X Genomics Chromium system for droplet capture. The Allen Mouse dataset was prepared using the Chromium Next GEM Single Cell 3’ v3 reagent kit, while the Allen Human dataset used v2.</p>
    </sec>
    <sec id="Sec13">
      <title>Datasets for model application—publicly available</title>
      <p id="Par32">We downloaded multiple datasets from Gene Expression Omnibus (GEO) to demonstrate the utility of our model. The following GEO accessions were included in analyses: GSE102827<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>, GSE106678<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>, GSE136656<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>, and GSE137763<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>.</p>
    </sec>
    <sec id="Sec14">
      <title>Gene identifier mapping</title>
      <p id="Par33">We used the R package biomaRt (version 2.46.3) to map gene identifiers from various annotations used in public datasets, and between species, to a common set of reliably mapped genes<sup><xref ref-type="bibr" rid="CR39">39</xref>,<xref ref-type="bibr" rid="CR40">40</xref></sup>. Ensembl gene identifiers (Ensembl IDs) were used as the primary identifier for mapping genes, and gene symbols were used as secondary identifiers in cases of ambiguous mapping. The Ensembl release 93 archive (July 2018 release) was used for cross-species gene mapping<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>. Genes with one-to-one orthology between mouse and human, as well as mouse and rat, were selected to facilitate cross species utility. All datasets lacking Ensembl ID annotation contained gene symbols, which were then queried against multiple Ensembl archives to determine which archive maximized identifier mapping rate. For instances, when a gene symbol mapped to multiple Ensembl IDs, identifiers present in the cross-species mapping table were preferentially selected. We provide a helper function for mapping gene identifiers to the feature set used by our model, and we further demonstrate usage in the associated tutorial.</p>
    </sec>
    <sec id="Sec15">
      <title>Choice of neural network target genes</title>
      <p id="Par34">To identify robust markers of neuronal activity for use as targets of the neural network, we intersected lists of stimulus-responsive genes from three published RNA-sequencing experiments. Each publication was from a different group of authors, focused on different brain regions, and used different forms of neuronal stimulation (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>). One publication categorized stimulus-responsive genes into three groups—rapid primary response genes (rPRGs), delayed primary response genes (dPRGs), and secondary response genes (SRGs)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>. As SRGs are thought to demonstrate higher celltype-specificity relative to PRGs<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>, only rPRGs and dPRGs were considered from this publication. In another publication, approximately 600 genes upregulated in response to kainic acid treatment in the hippocampus were considered<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
      <p id="Par35">In a third publication, two sets of KCl-responsive genes were available, one from a brain region enriched in glutamatergic neurons and one enriched for GABAergic neurons<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. For this study, we sought to intersect the results of both the glutamatergic and GABAergic analyses into one list of genes. Published p-value distributions suggested differences in statistical power between these two analyses, and only statistically significant results were published. To expand the list of genes overlapping between these analyses, we reanalyzed the data using GEO2R to obtain two sets of transcriptome-wide statistics. Using significance rankings from the GEO2R reanalysis, we jointly determined p-value thresholds for each analysis based on rank-rank hypergeometric overlap (RRHO, see Supplementary Fig. <xref rid="MOESM1" ref-type="media">9</xref>) and identified genes with p-values below these thresholds in both sets with concordant direction of effect<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. Because this approach used unconventional p-value thresholding, we additionally required intersecting genes to have an estimated fold change greater than or equal to 0.5 in both analyses.</p>
      <p id="Par36">Intersecting the three lists of stimulus response genes provided 41 candidate target genes. From these 41, four genes were excluded due to ambiguous or failed cross-species gene identifier mapping. We also excluded an additional eight genes that were detected in less than 1% of cells in more than one out of the four species-by-class groups (i.e., mouse-GABA, mouse-glut, human-GABA, human-glut) to mitigate the potential for the model to learn spurious target correlations to cell class markers or species markers. We performed principal component analysis (PCA) on the reaming 29 candidate target genes to assess dimensionality and found that PCs beyond PC1 added very little to the variance explained (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1a</xref>). All but one gene had a positive loading on PC1, and several genes had a loading near zero. We identified genes that had extreme positive loadings by comparing them to an outlier threshold for PC1 loadings from a shuffled, null PCA. A scaling factor, the ratio of variance from the observed PC1 to the null PC1, was used to make the loadings comparable. The outlier threshold was defined as the median null loading plus or minus three times the median absolute deviation of the null loadings. We found that 22 of 29 genes had loadings considered to be outliers under the null expectation (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1b</xref>). We then did 1000 bootstrap permutations of this analysis, each using random samples of 10,000 cells, and counted the number of permutations where each gene’s loading surpassed the outlier threshold. The same 22 genes surpassed the threshold in at least 5% of the permutations, while the other 7 genes did not (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1c</xref>). With evidence of robust coexpression, those 22 genes were selected as the final set of targets for our neural network: <italic>Arc</italic>, <italic>Btg2</italic>, <italic>Coq10b</italic>, <italic>Crem</italic>, <italic>Dusp1</italic>, <italic>Dusp5</italic>, <italic>Egr1</italic>, <italic>Egr3</italic>, <italic>Fbxo33</italic>, <italic>Fos</italic>, <italic>Fosl2</italic>, <italic>Gadd45g</italic>, <italic>Gmeb2</italic>, <italic>Grasp</italic>, <italic>Junb</italic>, <italic>Nr4a1</italic>, <italic>Nr4a2</italic>, <italic>Nr4a3</italic>, <italic>Per1</italic>, <italic>Rgs2</italic>, <italic>Sertad1</italic>, and <italic>Tiparp</italic>.</p>
    </sec>
    <sec id="Sec16">
      <title>Sample filtering, downsampling, and partitioning</title>
      <p id="Par37">Cells were filtered out if they had less than 5000 total counts, greater than 50,000 total counts, less than 1000 genes detected, more than 10% reads originating from mitochondrial genes, or more than 10% reads originating from the most highly expressed gene. Non-neuronal cells and ultra-rare neuron subclasses with less than 1000 cells were removed, and imbalances among species, neuron type, quality control metrics and naively estimated activity were alleviated using weighted downsampling with hierarchically readjusted weights. Cells were grouped hierarchically by species, class, brain region neighborhood, subclass, and finally, by two-dimensional binning of one source of technical variation (log<sub>10</sub> of total counts), and one source of biological variation (PC1 of target genes). Each group at the leaf nodes of the hierarchy were assigned equal weights summing to one. At each level of the hierarchy, moving from leaves to root, weights were readjusted to sum to one for each group. Using these weights, we downsampled the dataset and calculated Shannon’s entropy to measure imbalance at different values of <italic>N</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2a</xref>) We chose to downsample to 500,000 cells to strike a balance between dataset size and diversity. The effects of downsampling are demonstrated for four subclasses in Supplementary Fig. <xref rid="MOESM1" ref-type="media">2b</xref>. The R package groupdata2 (version 1.4.1) was used to create five training folds (91.3%, 456,725 samples) and one test split (8.7%, 43,275 samples). We used the groupdata2 function ‘fold’ with the parameters ‘cat_col’ set to the species-class group and ‘num_col’ set to the target gene PC1 values in order to keep these balanced across folds, but also set the ‘id_col’ parameter to the subclass label so each subclass was present in some folds but not others. This was done to discourage the undesirable learning of subclass-specific bias in cross-validation.</p>
    </sec>
    <sec id="Sec17">
      <title>Dataset augmentation</title>
      <p id="Par38">The Allen Cell Types Database has higher average total counts per cell compared to many publicly available datasets. To increase representation of lower quality cells, we created augmented samples by synthetically downsampling raw counts using the R package scater<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> (version 1.18.6). For each combination of species and neuron subclass, an equal number of cells were randomly assigned a value of either 10<sup>3</sup>, 10<sup>3.25</sup>, or 10<sup>3.5</sup> total counts to be downsampled to. All genes were considered for downsampling.</p>
    </sec>
    <sec id="Sec18">
      <title>Feature normalization and preprocessing</title>
      <p id="Par39">Log-normalization, as implemented in Seurat, was used to normalize input gene expression. Total counts for each cell were calculated by summing only the 10,017 features used by the model. Normalized expression levels for each gene were centered and scaled based on mean and standard deviation estimated from the training data. For cross validation, mean and standard deviation were estimated without the held-out fold.</p>
    </sec>
    <sec id="Sec19">
      <title>Model architecture</title>
      <p id="Par40">The architecture of the model was adapted from DCA<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> (see Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). Briefly, input gene expression is supplied to encoder branches; a series of three fully connected dense layers with ELU activations and batch normalization. ELU activations were chosen over RELU to increase learning speed and performance. The first three hidden layers of the encoders contained 16, 8, and 4 units. The encoder then connects to the information bottleneck, a single-unit dense layer with sigmoid activation. Variations of the single unit bottleneck (i.e., two and three unite bottlenecks) were also investigated. Downstream of the bottleneck, a decoder layer outputs the expression values of the target genes, i.e., the estimated mean parameter <bold>µ</bold> of the zero-inflated negative binomial (ZINB) model. A separate parallel encoder branch outputs estimates of the dispersion and dropout parameters. To restrict the bottleneck from capturing biases in the training data, we directly supplied auxiliary inputs (neuron subclass, dataset, and quality control variables) to the decoder. Auxiliary inputs were passed through two hidden layers, producing a six-unit dense layer which was then concatenated with the bottleneck activation as well as the output branch for dispersion and dropout parameters to form penultimate decoder layers. The ZINB loss function was used as implemented in DCA, with the only difference being that our implantation only computes loss for the target genes rather than all inputs to the model. This reconstruction loss is based on the maximum likelihood estimate of the ZINB count model, a common model assumed to underlie the count distributions of single cell RNA-seq datasets. A binary cross entropy loss was added to the bottleneck layer to monitor classification accuracy. For model applications, the model outputs are not used, but the sigmoidal bottleneck activation value is the metric extracted to index neuronal activity (see Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). Two additional variations of the model architecture were also investigated. One alternative model was restricted to using information from only the 22 target genes. Another alternative model reconstructed two separate output branches, each contributing equally to the total loss: one to reconstruct the 22 target genes, and one to reconstruct the whole transcriptome (i.e., all genes supplied at the inputs).</p>
    </sec>
    <sec id="Sec20">
      <title>Model training</title>
      <p id="Par41">We trained the model using the R package keras, version 2.3.0.0, and Tensorflow version 1.15.0<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. Training proceeded for 10 epochs using the ADAM optimizer. Gaussian dropout was applied to input expression to simulate uncertainty in measurements. Augmented samples were given the same output as the original data to curtail the learning of depth-dependent information, and augmented samples appeared in the same training batches as the samples they were derived from. We used basic hyperparameter tuning to evaluate the impact of training epochs, learning rate, and regularization parameters such as dropout, L1, and L2 penalty. The final model was selected based on the minimum cross-validation bottleneck layer loss for labeled data (binary cross entropy). Although samples from labeled datasets contributed to the ZINB reconstruction loss, the bottleneck loss did not contribute to weight updates during training to curtail the possibility of information leakage between the training and test splits. Only test split samples were included in any downstream analysis presented in this paper.</p>
    </sec>
    <sec id="Sec21">
      <title>Evaluating feature importance</title>
      <p id="Par42">To evaluate relative importance of each gene on predicted activity, we implemented a strategy adapted from the integrated gradients<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, a popular feature attribution approach used in image classification. Briefly, model gradients were calculated from input genes to bottleneck activation for the test set. For each gene we fit a generalized additive model (GAM) with smoothing between the sample gradients and bottleneck activation. We estimated global feature importance by approximating the integral of the fit. We took the summation of the GAM output for the full range of possible bottleneck activation values [0,1], with a step size of 1 × 10<sup>−3</sup>. Gene set enrichment analysis was run using the R package fgsea (version 1.16.0). We calculated enrichment for gene ontology, Reactome, KEGG, and Wikipathways terms of size between 100–200.</p>
    </sec>
    <sec id="Sec22">
      <title>Comparison of Patch-seq and Smart-seq datasets</title>
      <p id="Par43">The SMART-seq and Patch-seq datasets were integrated, clustered, and visualized using the R package Seurat<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> (version 4.0.1). The sctransform ‘v2’ method was used for normalization<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>. Cell clustering results were cross-referenced with provided neuron type annotations to identify neuron types common to both datasets and harmonize labels. We used the Kolmogorov–Smirnov test (KS test) to assess distributional differences in predicted activity of samples from the Smart-seq and Patch-seq datasets at the neuron type level. Only neuron types with at least one hundred samples in each dataset were considered. To derive empirical <italic>p</italic>-values and determine whether dataset-specific biases is transcriptome-wide expression levels contributed to observed differences in predicted activity, we ran 1000 permutations of the KS test using activity score predictions from within-sample shuffled gene expression values. Empirical p-values were calculated from the frequency of permutation D statistics that were more extreme than those observed in the actual data.</p>
    </sec>
    <sec id="Sec23">
      <title>Modeling activity score with electrophysiological features</title>
      <p id="Par44">The whole-cell Patch-seq electrophysiology recordings from neurons of mouse visual cortex provided by the Allen Institute for Brain Sciences were downloaded as NWB files from the DANDI (ID: 000020, September 2021 update)<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. The dataset included electrophysiological recordings of 4284 specimens from 1040 mouse subjects. The Python package IPFX (version 1.0.5) was used to perform quality control and compute electrophysiological features from the NWB files. We built a generalized linear model with lasso regularization using the R package glmnet (version 4.1-6) to predict output of NEUROeSTIMator using only electrophysiological features. Cells included in the glmnet training belonged to major neuron types (e.g., Vip, Sst) with at least 200 cells, and minor neuron types (e.g., Sst Rxfp1 Prdm8) with at least 10 cells. Features with missing values in five hundred or more cells were removed, and cells with any missing values for the remaining features were discarded. We engineered additional features from the IPFX output, including time and voltage changes between various action potential landmarks (e.g., voltage change between action potential threshold and peak). Minor neuron type was regressed out of the activity score and electrophysiological features. Cells with feature values more extreme than three standard deviations of the mean were considered outliers and removed. Significance of non-zero coefficients from the glmnet model was evaluated with 10,000 bootstrap permutations. In each permutation, a vector of weights is shuffled and used in fitting the glmnet model. For each input feature, we computed the mean bootstrap coefficient. The confidence interval was defined as the mean estimate plus or minus 1.96 times the standard deviation of the bootstrapped coefficients. Feature significance is indicated by the confidence intervals not reaching or overlapping zero. To validate the electrophysiology findings, we did a Pearson’s correlation test between NEUROeSTIMator output and input resistance for Patch-seq neurons from the AIBS dataset ‘Multimodal Analysis of Human Layer 5 Pyramidal Neurons’<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>. Canonical correlation analysis (CCA) was used to explore gene expression profiles with shared relationships to predicted activity and three electrophysiological features. Inputs to the generalizable CCA included the NEUROeSTIMator output matrix, the matrix of three significant electrophysiological features, and the gene expression matrix. One canonical component was calculated for each input matrix, with the tau parameter set to 0 to maximize correlations between all sets of variables. Gene set enrichment analysis was performed as described above using the gene loadings for the gene expression canonical component.</p>
    </sec>
    <sec id="Sec24">
      <title>Preparation of application datasets</title>
      <p id="Par45">Application datasets were downloaded from the Gene Expression Omnibus (GEO). In datasets without provided labels, cell types were identified by running the standard Seurat pipeline, identifying cell clusters, and cross-referencing cluster marker genes to those used in the source publications or the Allen Cell Types Database. To prepare datasets for input to NEUROeSTIMator, gene expression data was log-normalized sample-wise and scaled gene-wise using mean and standard deviation values from the original training dataset. Samples with at least 1000 counts were then input to the model and activity score was the 1-unit bottleneck activation layer output.</p>
    </sec>
    <sec id="Sec25">
      <title>Testing differences in predicted activity</title>
      <p id="Par46">For all datasets analyzed in Figs. <xref rid="Fig2" ref-type="fig">2</xref> and <xref rid="Fig3" ref-type="fig">3</xref>, we used the KS test to evaluate differences in activity score distributions. For statistical tests in Fig. <xref rid="Fig5" ref-type="fig">5</xref>, we used the R package lmerTest to fit alinear mixed effect model with donor as a random effect to test for differences in predicted activity of experimental groups across the spatial transcriptomic clusters, deriving p-values and coefficient estimates of learning on predicted activity per cluster. In Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b</xref>, we adjusted the coefficient estimates of learning on predicted activity for neuron density. We estimated neuron density using a cell type deconvolution technique. We derived gene signatures for GABAergic neurons, glutamatergic neurons, and non-neuronal cell classes by averaging the median gene expression for their respective clusters and subclasses from the Allen Cell Types Database.</p>
      <p id="Par47">For each sample in the Visium dataset, we constructed a linear model, correlating the gene expression vector with a three-column matrix that contained class-averaged expression signatures. We then normalized the coefficient estimates across all Visium samples for each cell class by scaling them to a 0–1 range and then adjusting their sum to one within samples. This process provided an estimate of abundance for each cell class. We summed the estimated abundances of glutamatergic and GABAergic neurons to determine neuron abundance or density for a specific Visium spot, Subsequently, we created a linear model of brain region log coefficient estimates as a function of brain region averaged neuron density estimates. The residuals of this model represent the neuron density-corrected coefficient estimates.</p>
    </sec>
    <sec id="Sec26">
      <title>Performance benchmarking</title>
      <p id="Par48">We compared the performance of NEUROeSTIMator to seven alternative approaches to quantify activity. Performance was defined by the ability to separate labeled cells based on the stimulation status (i.e., experimental group) using area under the curve (AUC). The seven alternative approaches were calculated as follows. The scaled additive measure of activity is calculated by first scaling log-normalized target expression values to a range between 0 and 1, and then summing the scaled targets in each cell or sample. We also applied this scaled additive approach to target expression levels imputed by MAGIC<sup><xref ref-type="bibr" rid="CR47">47</xref></sup>, as implemented in the R package Rmagic (version 2.0.3), with default parameters. To calculate the PC1 measure, we first performed PCA on target genes of the training set used to train NEUROeSTIMator. The loadings for PC1 were then applied to the test set. The remaining four approaches were alternative versions of NEUROeSTIMator. The transcriptome-naïve model is a version of NEUROeSTIMator trained with the same parameters, but information from the non-target input genes is blocked by setting their input values and weights to the first hidden layer to zero. The whole-transcriptome model reconstructed the entire transcriptome during training, as opposed to reconstructing only the targets. For this model, the 22 target genes and the broader transcriptome were assigned equal weight in the loss function during training. The final two models were trained with a bottleneck of either two or three units. To summarize these multivariate bottleneck outputs to a univariate score for AUC calculation, we fit generalized linear models to the binary stimulation group status as a function of the bottleneck outputs in the training data, and then applied the models to test data. To benchmark NEUROeSTIMator against alternative models for binary outcome prediction of stimulation group status, we evaluated model ability to separate stimulated from unstimulated samples. We computed the Area Under the Receiver Operating Characteristic Curve (AUC-ROC) for each model across all combinations of source dataset and sample groupings. We then determined the AUC differences between NEUROeSTIMator and the alternative models for each sample grouping. To summarize the average AUC difference within each dataset, we calculated the mean of the AUC differences for the respective sample groups. This yielded a single value representing the mean AUC difference for each source dataset in the test set. Lastly, we derived the final performance metric by computing the mean of these mean AUC differences across all data sources, offering a comprehensive evaluation of the NEUROeSTIMator’s performance relative to the alternative models.</p>
    </sec>
    <sec id="Sec27">
      <title>Animals</title>
      <p id="Par49">The spatial transcriptomic and RNAscope experiments were performed using male C57BL/6 J mice obtained from Jackson Laboratory (#000664), aged between 2 and 4 months. The mice were housed in groups of up to five individuals per cage, which contained soft bedding material. They had access to food (NIH-31 irradiated modified mouse diet #7913) and water ad libitum. A 12-h light-dark schedule was maintained, with the start of the lights-on period designated as Zeitgeber time zero (ZT 0). Animals were housed in the Animal care facility of the University of Iowa under a pathogen-free condition at the temperature of 21–22 °C and relative humidity of 60–70%. The experimental procedures followed the guidelines for animal care and use set forth by the National Institutes of Health, and they were approved by the Institutional Animal Care and Use Committee (IACUC) at the University of Iowa.</p>
    </sec>
    <sec id="Sec28">
      <title>Behavioral training for spatial transcriptomics</title>
      <p id="Par50">We generated a novel spatial transcriptomic dataset examining the effects of spatial learning in mice. The dataset contains spatial RNA-sequencing of whole brain slices from 1 h after SOR training or home cage controls (HC). 10–12 weeks old C57BL/6 J male mice were trained in SOR task as described previously<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. Briefly, mice were handled for 5 consecutive days prior to the SOR training. On the day of the training, animals were individually placed in an open field with a spatial cue and was allowed to habituate for 6 min. They were returned to their home cage and the arena was wiped clean with ethanol. The animals were again placed back into the open field with three objects at specific spatial locations. The animals were allowed to freely explore the objects in the arena for 6 min. This training with objects comprised of three trials of 6 min each. One hour after the completion of the training, mice were euthanized and whole brains were flash frozen in isopentane placed on dry ice.</p>
    </sec>
    <sec id="Sec29">
      <title>Spatial transcriptomics</title>
      <p id="Par51">Mouse brain section per mouse was cut at 10 µm thickness and mounted onto each Visium slide capture area. After H&amp;E staining, each bright-field image was taken as described in the spatial transcriptomics protocol. Tissue permeabilization was performed for 18 min, as established in the tissue optimization assay. The Visium Spatial Gene Expression Slide &amp; Reagent kit (10x Genomics) was used to generate sequencing libraries for Visium samples. Libraries were constructed according to the 10x Visium library construction protocol and sequenced by Illumina NovaSeq6000. Raw data was then processed using the 10x Genomics Space Ranger analysis pipeline. See Supplementary Fig. <xref rid="MOESM1" ref-type="media">5a</xref> for images of predicted activity for each replicate.</p>
    </sec>
    <sec id="Sec30">
      <title>In situ hybridization</title>
      <p id="Par52">In situ hybridization was performed on 20 μm coronal brain sections from SOR-trained and HC mice using RNAscope reagents (Advanced Cell Diagnostics). Briefly, fixed frozen brains were sectioned on a cryotome and mounted on Superfrost™ Plus microscope slides (Fisherbrand). Slides then underwent serial dehydration in Ethanol, followed by Hydrogen Peroxide treatment, target retrieval, and Protease III treatment—all of which were done according to the manufacturer’s protocol. Hybridization of probes was done at 40 °C for 2 h in an HybEZ oven using a 50:1:1 cocktail of <italic>Egr1</italic>, <italic>Nr4a1</italic>, and <italic>Egr3</italic> respectively. The probe signals were amplified with Pre-amplifier 1 (Amp 1-FL) and counterstained with OPAL dyes (Akoya Biosciences) corresponding to different excitation-emission wavelengths. Finally, the slides were mounted with Vectashield® Antifade Mounting Medium with DAPI (Vector Laboratories). Slides were stored in 4 °C until they were imaged.</p>
    </sec>
    <sec id="Sec31">
      <title>Confocal imaging and analysis</title>
      <p id="Par53">After performing the RNAscope assay, brain sections were imaged using Olympus FV3000 confocal microscope with a 10X NA = 0.4 objective at 800 × 800-pixel resolution. High magnification images of the hippocampus were obtained using a 40X NA = 1.30 oil immersion objective at 800 × 800-pixel resolution and 1.25 optical zoom. All images (8 bit) were acquired with identical settings for laser power, detector gain and pinhole diameter for each experiment and between experiments. Images from the different channels were stacked and projected at maximum intensity using ImageJ (NIH). Hippocampal subregion-specific Mean Fluorescence Intensity (MFI) of each RNAscope probe was evaluated using plugins in ImageJ. The average MFI for all the 3 probes corresponding to each hippocampal subregion was compared between the two experimental groups. Two-way ANOVA was used to assess significance of subregion-by-training interaction (<italic>n</italic> = 4 for each subregion/training combination). A post-hoc Sidak’s multiple comparisons test was applied to assess significance of individual subregion differences.</p>
    </sec>
    <sec id="Sec32">
      <title>Reporting summary</title>
      <p id="Par54">Further information on research design is available in the <xref rid="MOESM5" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec33">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_44503_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_44503_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_44503_MOESM3_ESM.docx">
            <caption>
              <p>Description of supplementary information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_44503_MOESM4_ESM.xlsx">
            <caption>
              <p>Supplementary Data 1–8</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_44503_MOESM5_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
    <sec id="Sec34">
      <title>Source data</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2023_44503_MOESM6_ESM.xlsx">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-44503-5.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was supported by NIH grant R01 MH 087463 to T.A., NIH grant R01 DC014489 to J.J.M., NIH grant K99 AG 068306 and the Nellie Ball Trust to S.C., and The University of Iowa Hawkeye Intellectual and Developmental Disabilities Research Center (HAWK-IDDRC) P50 HD103556 to T.A. and Lane Strathearn. T.A. and J.J.M. are also supported by the Roy J. Carver Charitable Trust. We thank the Allen Institute for Brain Sciences for their valuable datasets we used to train our model. We thank the creators and authors of DCA, whose work inspired the approach we implemented in this paper. We also thank Mahesh Shetty for his valuable contributions to discussions about this project. Figure <xref rid="Fig1" ref-type="fig">1</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref> were created using graphical elements from BioRender.com.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>E.B., S.C., T.A., and J.J.M. conceived the study. E.B. performed data curation, model training, analyses, and visualizations. S.C. and T.A. designed the molecular biology experiments with input from J.J.M. and K.P.G. S.C. performed behavioral experiments, stereotactic surgeries, and single nuclei sequencing. L.C.L. performed Visium spatial transcriptomic sequencing experiments. Y.V. and M.E. processed Visium data. J.R. and M.M. performed RNAscope experiments. U.M. performed statistical analysis and created visualization pertaining to the RNAscope data. E.B. and J.J.M. wrote the article.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par55"><italic>Nature Communications</italic> thanks Jun Ding, Chris Gaiteri and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>Spatial RNA-sequencing data, including gene expression measurements, tissue images, spot coordinates, and raw FASTQ files have been deposited in the Gene Expression Omnibus (GEO) repository under the accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE201610">GSE201610</ext-link>”. GEO datasets used in this study can be accessed under the following accession codes “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE111899">GSE111899</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE125068">GSE125068</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE55591">GSE55591</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE106678">GSE106678</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE137763">GSE137763</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE136656">GSE136656</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE102827">GSE102827</ext-link>”. Other datasets used in this study can be accessed through the Allen Institute for Brain Science: “Allen Cell Types Database [<ext-link ext-link-type="uri" xlink:href="https://portal.brain-map.org/atlases-and-data/rnaseq">https://portal.brain-map.org/atlases-and-data/rnaseq</ext-link>]”, “Mouse PatchSeq VIS [<ext-link ext-link-type="uri" xlink:href="https://knowledge.brain-map.org/data/1HEYEW7GMUKWIQW37BO/summary">https://knowledge.brain-map.org/data/1HEYEW7GMUKWIQW37BO/summary</ext-link>]”, “Human PatchSeq L2/3 [<ext-link ext-link-type="uri" xlink:href="https://knowledge.brain-map.org/data/0R94W5U07IHCMVJ4TVK/summary">https://knowledge.brain-map.org/data/0R94W5U07IHCMVJ4TVK/summary</ext-link>]”. Results used in the analyses of this publication have been deposited to Zenodo under the accession 10.5281/zenodo.10183210. <xref ref-type="sec" rid="Sec34">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>NEUROeSTIMator is available at <ext-link ext-link-type="uri" xlink:href="https://research-git.uiowa.edu/michaelson-lab-public/neuroestimator/">https://research-git.uiowa.edu/michaelson-lab-public/neuroestimator/</ext-link> as a free R package with installation instructions and a tutorial.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par56">T.A. serves on the Scientific Advisory Board of EmbarkNeuro and is a scientific advisor to Aditum Bio and Radius Health. The other authors declare no conflicting interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yap</surname>
            <given-names>EL</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>Activity-regulated transcription: bridging the gap between neural activity and behavior</article-title>
        <source>Neuron</source>
        <year>2018</year>
        <volume>100</volume>
        <fpage>330</fpage>
        <lpage>348</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2018.10.013</pub-id>
        <?supplied-pmid 30359600?>
        <pub-id pub-id-type="pmid">30359600</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cohen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>Communication between the synapse and the nucleus in neuronal development, plasticity, and disease</article-title>
        <source>Annu Rev. Cell Dev. Biol.</source>
        <year>2008</year>
        <volume>24</volume>
        <fpage>183</fpage>
        <lpage>209</lpage>
        <pub-id pub-id-type="doi">10.1146/annurev.cellbio.24.110707.175235</pub-id>
        <?supplied-pmid 18616423?>
        <pub-id pub-id-type="pmid">18616423</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <mixed-citation publication-type="other">West, A. E. &amp; Greenberg, M. E. Neuronal activity-regulated gene transcription in synapse development and cognitive function. <italic>Cold Spring Harb. Perspect Biol.</italic><bold>3</bold>, 10.1101/cshperspect.a005744 (2011).</mixed-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gallo</surname>
            <given-names>FT</given-names>
          </name>
          <name>
            <surname>Katche</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Morici</surname>
            <given-names>JF</given-names>
          </name>
          <name>
            <surname>Medina</surname>
            <given-names>JH</given-names>
          </name>
          <name>
            <surname>Weisstaub</surname>
            <given-names>NV</given-names>
          </name>
        </person-group>
        <article-title>Immediate early genes, memory and psychiatric disorders: focus on c-Fos, Egr1 and Arc</article-title>
        <source>Front Behav. Neurosci.</source>
        <year>2018</year>
        <volume>12</volume>
        <fpage>79</fpage>
        <pub-id pub-id-type="doi">10.3389/fnbeh.2018.00079</pub-id>
        <?supplied-pmid 29755331?>
        <pub-id pub-id-type="pmid">29755331</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mews</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>From circuits to chromatin: the emerging role of epigenetics in mental health</article-title>
        <source>J. Neurosci.</source>
        <year>2021</year>
        <volume>41</volume>
        <fpage>873</fpage>
        <lpage>882</lpage>
        <pub-id pub-id-type="doi">10.1523/JNEUROSCI.1649-20.2020</pub-id>
        <?supplied-pmid 33446519?>
        <pub-id pub-id-type="pmid">33446519</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nido</surname>
            <given-names>GS</given-names>
          </name>
          <name>
            <surname>Ryan</surname>
            <given-names>MM</given-names>
          </name>
          <name>
            <surname>Benuskova</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>JM</given-names>
          </name>
        </person-group>
        <article-title>Dynamical properties of gene regulatory networks involved in long-term potentiation</article-title>
        <source>Front Mol. Neurosci.</source>
        <year>2015</year>
        <volume>8</volume>
        <fpage>42</fpage>
        <pub-id pub-id-type="doi">10.3389/fnmol.2015.00042</pub-id>
        <?supplied-pmid 26300724?>
        <pub-id pub-id-type="pmid">26300724</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hudson</surname>
            <given-names>AE</given-names>
          </name>
        </person-group>
        <article-title>Genetic reporters of neuronal activity: c-Fos and G-CaMP6</article-title>
        <source>Methods Enzymol.</source>
        <year>2018</year>
        <volume>603</volume>
        <fpage>197</fpage>
        <lpage>220</lpage>
        <pub-id pub-id-type="doi">10.1016/bs.mie.2018.01.023</pub-id>
        <?supplied-pmid 29673526?>
        <pub-id pub-id-type="pmid">29673526</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kawashima</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Okuno</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Bito</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>A new era for functional labeling of neurons: activity-dependent promoters have come of age</article-title>
        <source>Front. Neural Circuits</source>
        <year>2014</year>
        <volume>8</volume>
        <fpage>37</fpage>
        <pub-id pub-id-type="doi">10.3389/fncir.2014.00037</pub-id>
        <?supplied-pmid 24795570?>
        <pub-id pub-id-type="pmid">24795570</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guenthner</surname>
            <given-names>CJ</given-names>
          </name>
          <name>
            <surname>Miyamichi</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>HH</given-names>
          </name>
          <name>
            <surname>Heller</surname>
            <given-names>HC</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Permanent genetic access to transiently active neurons via TRAP: targeted recombination in active populations</article-title>
        <source>Neuron</source>
        <year>2013</year>
        <volume>78</volume>
        <fpage>773</fpage>
        <lpage>784</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2013.03.025</pub-id>
        <?supplied-pmid 23764283?>
        <pub-id pub-id-type="pmid">23764283</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Ramirez</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Redondo</surname>
            <given-names>RL</given-names>
          </name>
          <name>
            <surname>Tonegawa</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Identification and manipulation of memory engram cells</article-title>
        <source>Cold Spring Harb. Symp. Quant. Biol.</source>
        <year>2014</year>
        <volume>79</volume>
        <fpage>59</fpage>
        <lpage>65</lpage>
        <pub-id pub-id-type="doi">10.1101/sqb.2014.79.024901</pub-id>
        <?supplied-pmid 25637263?>
        <pub-id pub-id-type="pmid">25637263</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sheng</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>The regulation and function of c-fos and other immediate early genes in the nervous system</article-title>
        <source>Neuron</source>
        <year>1990</year>
        <volume>4</volume>
        <fpage>477</fpage>
        <lpage>485</lpage>
        <pub-id pub-id-type="doi">10.1016/0896-6273(90)90106-p</pub-id>
        <?supplied-pmid 1969743?>
        <pub-id pub-id-type="pmid">1969743</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>YE</given-names>
          </name>
          <name>
            <surname>Pan</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Zuo</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Hong</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Detecting activated cell populations using single-cell RNA-Seq</article-title>
        <source>Neuron</source>
        <year>2017</year>
        <volume>96</volume>
        <fpage>313</fpage>
        <lpage>329 e316</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2017.09.026</pub-id>
        <?supplied-pmid 29024657?>
        <pub-id pub-id-type="pmid">29024657</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Dissecting cell-type composition and activity-dependent transcriptional state in mammalian brains by massively parallel single-nucleus RNA-Seq</article-title>
        <source>Mol. Cell</source>
        <year>2017</year>
        <volume>68</volume>
        <fpage>1006</fpage>
        <lpage>1015 e1007</lpage>
        <pub-id pub-id-type="doi">10.1016/j.molcel.2017.11.017</pub-id>
        <?supplied-pmid 29220646?>
        <pub-id pub-id-type="pmid">29220646</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vallejos</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Risso</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Scialdone</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Dudoit</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Normalizing single-cell RNA sequencing data: challenges and opportunities</article-title>
        <source>Nat. Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>565</fpage>
        <lpage>571</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4292</pub-id>
        <?supplied-pmid 28504683?>
        <pub-id pub-id-type="pmid">28504683</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hicks</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Townes</surname>
            <given-names>FW</given-names>
          </name>
          <name>
            <surname>Teng</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Irizarry</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <article-title>Missing data and technical variability in single-cell RNA-sequencing experiments</article-title>
        <source>Biostatistics</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>562</fpage>
        <lpage>578</lpage>
        <pub-id pub-id-type="doi">10.1093/biostatistics/kxx053</pub-id>
        <?supplied-pmid 29121214?>
        <pub-id pub-id-type="pmid">29121214</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hafemeister</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Normalization and variance stabilization of single-cell RNA-seq data using regularized negative binomial regression</article-title>
        <source>Genome Biol.</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>296</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1874-1</pub-id>
        <?supplied-pmid 31870423?>
        <pub-id pub-id-type="pmid">31870423</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lahnemann</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Eleven grand challenges in single-cell data science</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>31</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-1926-6</pub-id>
        <?supplied-pmid 32033589?>
        <pub-id pub-id-type="pmid">32033589</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yao</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A taxonomy of transcriptomic cell types across the isocortex and hippocampal formation</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3222</fpage>
        <lpage>3241.e3226</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.021</pub-id>
        <?supplied-pmid 34004146?>
        <pub-id pub-id-type="pmid">34004146</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spiegel</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Npas4 regulates excitatory-inhibitory balance within neural circuits through cell-type-specific gene programs</article-title>
        <source>Cell</source>
        <year>2014</year>
        <volume>157</volume>
        <fpage>1216</fpage>
        <lpage>1229</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2014.03.058</pub-id>
        <?supplied-pmid 24855953?>
        <pub-id pub-id-type="pmid">24855953</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fernandez-Albert</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Immediate and deferred epigenomic signatures of in vivo neuronal activation in mouse hippocampus</article-title>
        <source>Nat. Neurosci.</source>
        <year>2019</year>
        <volume>22</volume>
        <fpage>1718</fpage>
        <lpage>1730</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-019-0476-2</pub-id>
        <?supplied-pmid 31501571?>
        <pub-id pub-id-type="pmid">31501571</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tyssowski</surname>
            <given-names>KM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Different neuronal activity patterns induce different gene expression programs</article-title>
        <source>Neuron</source>
        <year>2018</year>
        <volume>98</volume>
        <fpage>530</fpage>
        <lpage>546.e511</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2018.04.001</pub-id>
        <?supplied-pmid 29681534?>
        <pub-id pub-id-type="pmid">29681534</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Sundararajan, M., Taly, A. &amp; Yan, Q. <italic>Axiomatic attribution for deep networks</italic>. arXiv:1703.01365. <ext-link ext-link-type="uri" xlink:href="https://ui.adsabs.harvard.edu/abs/2017arXiv170301365S">https://ui.adsabs.harvard.edu/abs/2017arXiv170301365S</ext-link> (2017).</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gouwens</surname>
            <given-names>NW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated morphoelectric and transcriptomic classification of cortical GABAergic cells</article-title>
        <source>Cell</source>
        <year>2020</year>
        <volume>183</volume>
        <fpage>935</fpage>
        <lpage>953.e919</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2020.09.057</pub-id>
        <?supplied-pmid 33186530?>
        <pub-id pub-id-type="pmid">33186530</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573</fpage>
        <lpage>3587.e3529</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id>
        <?supplied-pmid 34062119?>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Thomas</surname>
            <given-names>GM</given-names>
          </name>
          <name>
            <surname>Huganir</surname>
            <given-names>RL</given-names>
          </name>
        </person-group>
        <article-title>MAPK cascade signalling and synaptic plasticity</article-title>
        <source>Nat. Rev. Neurosci.</source>
        <year>2004</year>
        <volume>5</volume>
        <fpage>173</fpage>
        <lpage>183</lpage>
        <pub-id pub-id-type="doi">10.1038/nrn1346</pub-id>
        <?supplied-pmid 14976517?>
        <pub-id pub-id-type="pmid">14976517</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rosen</surname>
            <given-names>LB</given-names>
          </name>
          <name>
            <surname>Ginty</surname>
            <given-names>DD</given-names>
          </name>
          <name>
            <surname>Weber</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>Membrane depolarization and calcium influx stimulate MEK and MAP kinase via activation of Ras</article-title>
        <source>Neuron</source>
        <year>1994</year>
        <volume>12</volume>
        <fpage>1207</fpage>
        <lpage>1221</lpage>
        <pub-id pub-id-type="doi">10.1016/0896-6273(94)90438-3</pub-id>
        <?supplied-pmid 8011335?>
        <pub-id pub-id-type="pmid">8011335</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baraban</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Taylor</surname>
            <given-names>MR</given-names>
          </name>
          <name>
            <surname>Castro</surname>
            <given-names>PA</given-names>
          </name>
          <name>
            <surname>Baier</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Pentylenetetrazole induced changes in zebrafish behavior, neural activity and c-fos expression</article-title>
        <source>Neuroscience</source>
        <year>2005</year>
        <volume>131</volume>
        <fpage>759</fpage>
        <lpage>768</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuroscience.2004.11.031</pub-id>
        <?supplied-pmid 15730879?>
        <pub-id pub-id-type="pmid">15730879</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dhir</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Pentylenetetrazol (PTZ) kindling model of epilepsy</article-title>
        <source>Curr. Protoc. Neurosci. 9</source>
        <year>2012</year>
        <volume>Unit9</volume>
        <fpage>37</fpage>
        <pub-id pub-id-type="doi">10.1002/0471142301.ns0937s58</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Savell</surname>
            <given-names>KE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A dopamine-induced gene expression signature regulates neuronal function and cocaine response</article-title>
        <source>Sci. Adv.</source>
        <year>2020</year>
        <volume>6</volume>
        <fpage>eaba4221</fpage>
        <pub-id pub-id-type="doi">10.1126/sciadv.aba4221</pub-id>
        <?supplied-pmid 32637607?>
        <pub-id pub-id-type="pmid">32637607</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luo</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Volkow</surname>
            <given-names>ND</given-names>
          </name>
          <name>
            <surname>Heintz</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Pan</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Du</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Acute cocaine induces fast activation of D1 receptor and progressive deactivation of D2 receptor striatal neurons: in vivo optical microprobe [Ca2+]i imaging</article-title>
        <source>J. Neurosci.</source>
        <year>2011</year>
        <volume>31</volume>
        <fpage>13180</fpage>
        <lpage>13190</lpage>
        <pub-id pub-id-type="doi">10.1523/JNEUROSCI.2369-11.2011</pub-id>
        <?supplied-pmid 21917801?>
        <pub-id pub-id-type="pmid">21917801</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Boulting</surname>
            <given-names>GL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Activity-dependent regulome of human GABAergic neurons reveals new patterns of gene regulation and neurological disease heritability</article-title>
        <source>Nat. Neurosci.</source>
        <year>2021</year>
        <volume>24</volume>
        <fpage>437</fpage>
        <lpage>448</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-020-00786-1</pub-id>
        <?supplied-pmid 33542524?>
        <pub-id pub-id-type="pmid">33542524</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rienecker</surname>
            <given-names>KDA</given-names>
          </name>
          <name>
            <surname>Poston</surname>
            <given-names>RG</given-names>
          </name>
          <name>
            <surname>Saha</surname>
            <given-names>RN</given-names>
          </name>
        </person-group>
        <article-title>Merits and limitations of studying neuronal depolarization-dependent processes using elevated external potassium</article-title>
        <source>ASN Neuro</source>
        <year>2020</year>
        <volume>12</volume>
        <fpage>1759091420974807</fpage>
        <pub-id pub-id-type="doi">10.1177/1759091420974807</pub-id>
        <?supplied-pmid 33256465?>
        <pub-id pub-id-type="pmid">33256465</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rienecker</surname>
            <given-names>KDA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mild membrane depolarization in neurons induces immediate early gene transcription and acutely subdues responses to a successive stimulus</article-title>
        <source>J. Biol. Chem.</source>
        <year>2022</year>
        <volume>298</volume>
        <fpage>102278</fpage>
        <pub-id pub-id-type="doi">10.1016/j.jbc.2022.102278</pub-id>
        <?supplied-pmid 35863435?>
        <pub-id pub-id-type="pmid">35863435</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hrvatin</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell analysis of experience-dependent transcriptomic states in the mouse visual cortex</article-title>
        <source>Nat. Neurosci.</source>
        <year>2018</year>
        <volume>21</volume>
        <fpage>120</fpage>
        <lpage>129</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-017-0029-5</pub-id>
        <?supplied-pmid 29230054?>
        <pub-id pub-id-type="pmid">29230054</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chatterjee</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Endoplasmic reticulum chaperone genes encode effectors of long-term memory</article-title>
        <source>Sci. Adv.</source>
        <year>2022</year>
        <volume>8</volume>
        <fpage>eabm6063</fpage>
        <pub-id pub-id-type="doi">10.1126/sciadv.abm6063</pub-id>
        <?supplied-pmid 35319980?>
        <pub-id pub-id-type="pmid">35319980</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>RNAscope: a novel in situ RNA analysis platform for formalin-fixed, paraffin-embedded tissues</article-title>
        <source>J. Mol. Diagn.</source>
        <year>2012</year>
        <volume>14</volume>
        <fpage>22</fpage>
        <lpage>29</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jmoldx.2011.08.002</pub-id>
        <?supplied-pmid 22166544?>
        <pub-id pub-id-type="pmid">22166544</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kalmbach</surname>
            <given-names>BE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Signature morpho-electric, transcriptomic, and dendritic properties of human layer 5 neocortical pyramidal neurons</article-title>
        <source>Neuron</source>
        <year>2021</year>
        <volume>109</volume>
        <fpage>2914</fpage>
        <lpage>2927.e2915</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2021.08.030</pub-id>
        <?supplied-pmid 34534454?>
        <pub-id pub-id-type="pmid">34534454</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hrvatin</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Publisher Correction: Single-cell analysis of experience-dependent transcriptomic states in the mouse visual cortex</article-title>
        <source>Nat. Neurosci.</source>
        <year>2018</year>
        <volume>21</volume>
        <fpage>1017</fpage>
        <pub-id pub-id-type="doi">10.1038/s41593-018-0112-6</pub-id>
        <?supplied-pmid 29752482?>
        <pub-id pub-id-type="pmid">29752482</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Durinck</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>BioMart and Bioconductor: a powerful link between biological databases and microarray data analysis</article-title>
        <source>Bioinformatics</source>
        <year>2005</year>
        <volume>21</volume>
        <fpage>3439</fpage>
        <lpage>3440</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bti525</pub-id>
        <?supplied-pmid 16082012?>
        <pub-id pub-id-type="pmid">16082012</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Durinck</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Spellman</surname>
            <given-names>PT</given-names>
          </name>
          <name>
            <surname>Birney</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Huber</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Mapping identifiers for the integration of genomic datasets with the R/Bioconductor package biomaRt</article-title>
        <source>Nat. Protoc.</source>
        <year>2009</year>
        <volume>4</volume>
        <fpage>1184</fpage>
        <lpage>1191</lpage>
        <pub-id pub-id-type="doi">10.1038/nprot.2009.97</pub-id>
        <?supplied-pmid 19617889?>
        <pub-id pub-id-type="pmid">19617889</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zerbino</surname>
            <given-names>DR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ensembl 2018</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2018</year>
        <volume>46</volume>
        <fpage>D754</fpage>
        <lpage>D761</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkx1098</pub-id>
        <?supplied-pmid 29155950?>
        <pub-id pub-id-type="pmid">29155950</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Plaisier</surname>
            <given-names>SB</given-names>
          </name>
          <name>
            <surname>Taschereau</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wong</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Graeber</surname>
            <given-names>TG</given-names>
          </name>
        </person-group>
        <article-title>Rank-rank hypergeometric overlap: identification of statistically significant overlap between gene-expression signatures</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2010</year>
        <volume>38</volume>
        <fpage>e169</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkq636</pub-id>
        <?supplied-pmid 20660011?>
        <pub-id pub-id-type="pmid">20660011</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Campbell</surname>
            <given-names>KR</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>AT</given-names>
          </name>
          <name>
            <surname>Wills</surname>
            <given-names>QF</given-names>
          </name>
        </person-group>
        <article-title>Scater: pre-processing, quality control, normalization and visualization of single-cell RNA-seq data in R</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <fpage>1179</fpage>
        <lpage>1186</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw777</pub-id>
        <?supplied-pmid 28088763?>
        <pub-id pub-id-type="pmid">28088763</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eraslan</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Simon</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Mircea</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Mueller</surname>
            <given-names>NS</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA-seq denoising using a deep count autoencoder</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>390</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-018-07931-2</pub-id>
        <?supplied-pmid 30674886?>
        <pub-id pub-id-type="pmid">30674886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <mixed-citation publication-type="other">Abadi, M. et al. TensorFlow: A system for large-scale machine learning. <italic>Proceedings of Osdi'16: 12th Usenix Symposium on Operating Systems Design and Implementation</italic>, 265–283 (2016).</mixed-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Choudhary</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Comparison and evaluation of statistical error models for scRNA-seq</article-title>
        <source>Genome Biol.</source>
        <year>2022</year>
        <volume>23</volume>
        <fpage>27</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-021-02584-9</pub-id>
        <?supplied-pmid 35042561?>
        <pub-id pub-id-type="pmid">35042561</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van Dijk</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Recovering gene interactions from single-cell data using data diffusion</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>716</fpage>
        <lpage>729.e727</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.05.061</pub-id>
        <?supplied-pmid 29961576?>
        <pub-id pub-id-type="pmid">29961576</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10817898</article-id>
    <article-id pub-id-type="publisher-id">44503</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-44503-5</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Using deep learning to quantify neuronal activation from single-cell and spatial transcriptomic data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Bahl</surname>
          <given-names>Ethan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-4873-9416</contrib-id>
        <name>
          <surname>Chatterjee</surname>
          <given-names>Snehajyoti</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-4849-9475</contrib-id>
        <name>
          <surname>Mukherjee</surname>
          <given-names>Utsav</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1019-3905</contrib-id>
        <name>
          <surname>Elsadany</surname>
          <given-names>Muhammad</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7522-3191</contrib-id>
        <name>
          <surname>Vanrobaeys</surname>
          <given-names>Yann</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lin</surname>
          <given-names>Li-Chun</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-0481-324X</contrib-id>
        <name>
          <surname>McDonough</surname>
          <given-names>Miriam</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Resch</surname>
          <given-names>Jon</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-4503-7344</contrib-id>
        <name>
          <surname>Giese</surname>
          <given-names>K. Peter</given-names>
        </name>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2423-4592</contrib-id>
        <name>
          <surname>Abel</surname>
          <given-names>Ted</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9713-0992</contrib-id>
        <name>
          <surname>Michaelson</surname>
          <given-names>Jacob J.</given-names>
        </name>
        <address>
          <email>jacob-michaelson@uiowa.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff8">8</xref>
        <xref ref-type="aff" rid="Aff9">9</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Department of Psychiatry, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Interdisciplinary Graduate Program in Genetics, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Iowa Neuroscience Institute, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Department of Neuroscience &amp; Pharmacology, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Interdisciplinary Graduate Program in Neuroscience, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Interdisciplinary Graduate Program in Molecular Medicine, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/0220mzb33</institution-id><institution-id institution-id-type="GRID">grid.13097.3c</institution-id><institution-id institution-id-type="ISNI">0000 0001 2322 6764</institution-id><institution>Department of Basic and Clinical Neuroscience, </institution><institution>King’s College London, </institution></institution-wrap>London, UK </aff>
      <aff id="Aff8"><label>8</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Department of Biomedical Engineering, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff9"><label>9</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Department of Communication Sciences &amp; Disorders, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>26</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>26</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2024</year>
    </pub-date>
    <volume>15</volume>
    <elocation-id>779</elocation-id>
    <history>
      <date date-type="received">
        <day>23</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>15</day>
        <month>12</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© This is a U.S. Government work and not under copyright protection in the US; foreign copyright protection may apply 2024</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Neuronal activity-dependent transcription directs molecular processes that regulate synaptic plasticity, brain circuit development, behavioral adaptation, and long-term memory. Single cell RNA-sequencing technologies (scRNAseq) are rapidly developing and allow for the interrogation of activity-dependent transcription at cellular resolution. Here, we present NEUROeSTIMator, a deep learning model that integrates transcriptomic signals to estimate neuronal activation in a way that we demonstrate is associated with Patch-seq electrophysiological features and that is robust against differences in species, cell type, and brain region. We demonstrate this method’s ability to accurately detect neuronal activity in previously published studies of single cell activity-induced gene expression. Further, we applied our model in a spatial transcriptomic study to identify unique patterns of learning-induced activity across different brain regions in male mice. Altogether, our findings establish NEUROeSTIMator as a powerful and broadly applicable tool for measuring neuronal activation, whether as a critical covariate or a primary readout of interest.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Neuronal activity is associated with transcriptional changes. Here, the authors present a deep learning model that integrates single cell transcriptomic signals to estimate neuronal activation.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Learning and memory</kwd>
      <kwd>Synaptic plasticity</kwd>
      <kwd>Transcriptomics</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000025</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Institute of Mental Health (NIMH)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01 MH 087463</award-id>
        <principal-award-recipient>
          <name>
            <surname>Michaelson</surname>
            <given-names>Jacob J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000055</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Institute on Deafness and Other Communication Disorders (NIDCD)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01 DC 014489</award-id>
        <principal-award-recipient>
          <name>
            <surname>Michaelson</surname>
            <given-names>Jacob J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000002</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>K99 AG 068306</award-id>
        <principal-award-recipient>
          <name>
            <surname>Michaelson</surname>
            <given-names>Jacob J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100009633</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | Eunice Kennedy Shriver National Institute of Child Health and Human Development (NICHD)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>P50 HD 103556</award-id>
        <principal-award-recipient>
          <name>
            <surname>Michaelson</surname>
            <given-names>Jacob J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2024</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Transcriptional regulation is a key component in the downstream response to neuronal stimulation, and the dysregulation of this activity-dependent gene expression has been linked to several nervous system disorders<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR6">6</xref></sup>. Although several techniques exist to identify active neurons with transgenic single-gene reporter systems<sup><xref ref-type="bibr" rid="CR7">7</xref>–<xref ref-type="bibr" rid="CR10">10</xref></sup>, there is currently no method available to estimate neuronal activity from transcriptome-wide signal in gene expression data. Estimating neuronal activation based on gene expression data is vital for unraveling the intricate processes governing neuronal function and dysfunction, and decades of research has been devoted to characterizing these processes<sup><xref ref-type="bibr" rid="CR1">1</xref>,<xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR11">11</xref></sup>. Accurate estimation of activation could provide insights into neural circuitry, advance our understanding of neurological disorders, and ultimately contribute to the development of targeted therapeutic interventions. With advances in single-cell RNA-sequencing (scRNAseq) technologies, researchers can now study activity-dependent transcription at the individual neuron level<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR13">13</xref></sup>. However, scRNAseq has persistent limitations such as sparsity and stochasticity in gene expression measurements, which challenge our ability to use these tools to understand neuronal activation<sup><xref ref-type="bibr" rid="CR14">14</xref>–<xref ref-type="bibr" rid="CR17">17</xref></sup>.</p>
    <p id="Par4">To address these challenges, we present an innovative tool that estimates neuronal activation using transcriptome-scale data as input. Using a comprehensive multi-species gene expression dataset, our deep learning model employs a single unit bottleneck to derive interpretable neuronal activity scores and an auxiliary input to the decoder to counteract dataset-specific biases. This novel approach, which distills the whole transcriptome into a single integrative activity score, challenges the single-gene paradigm (e.g., <italic>Fos</italic>) for measuring activity at the single cell and bulk tissue level.</p>
    <p id="Par5">Distilling transcriptome-scale signatures into a one-dimensional information bottleneck, our approach reconstructs the expression profiles of 22 well-established neuronal activity markers. We show that the resulting activity score is significantly associated with electrophysiological features of increased excitability, demonstrating its applicability in classifying neurons along this essential characteristic. We further show its application in secondary analyses of several single-cell data sets, as well as in new spatial transcriptomic data that captures learning-related circuit activation in the murine brain.</p>
    <p id="Par6">To facilitate community usage, we developed NEUROeSTIMator, an R package with a tutorial that demonstrates our model’s application to single-cell data. This innovative method offers a powerful solution to estimate neuronal activation based on de-noised latent patterns in single-cell gene expression, outperforming alternative approaches and providing significant associations with electrophysiological features at the single-cell level.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Multi-species training, test, and validation data sets</title>
      <p id="Par7">We developed a neural network to quantify signatures of transcriptional activation by training an autoencoder to reconstruct expression of 22 coexpressed activity-dependent genes from a 1-dimensional latent space (Fig. <xref rid="Fig1" ref-type="fig">1</xref>). We trained, validated, and tested the model using publicly available datasets, including single cell datasets from the Allen Institute of Brain Science<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> (AIBS) totaling over one million combined samples, as well as GEO datasets and a novel spatial transcriptomics dataset (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>). Activity-dependent genes were identified by intersecting differential expression results of three studies of experimental manipulation of neuron activity<sup><xref ref-type="bibr" rid="CR19">19</xref>–<xref ref-type="bibr" rid="CR21">21</xref></sup>. All three differential expression studies examined different brain regions, used different methods of neuronal stimulation, and were published from independent groups. Intersecting these three lists yielded a list of 29 candidate target genes (i.e., genes to be reconstructed in autoencoder output) Principal component analysis of the candidate genes revealed a relatively low dimensionality of expression profiles, with PC1 explaining a majority of the variance (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1a</xref>). Using the Allen datasets, we then performed bootstrap permutations of principal component analysis on candidate target genes and found a subset of 22 genes robustly exhibiting greater PC1 loadings than expected under a null PCA with randomly shuffled data (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1b</xref>). These 22 genes were selected as the final set of target genes to be reconstructed by the autoencoder during training. The Allen Cell Type Databases were downsampled with hierarchical weighting to increase balance of cell types, datasets, technical variation, and biological variation (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2a, b</xref>). Five hundred thousand neurons were selected and partitioned into cell type-balanced training and testing sets, and the training set was further split into 5 folds for cross validation. We trained the neural network to predict expression of the 22 activity-dependent target genes through a 1-dimensional hidden bottleneck layer with sigmoidal activation (see methods for a detailed description of model architecture and training). To evaluate model performance, we applied it to a diverse test set of 164,658 neurons held out from the training process, including 86,650 samples from the Allen and 78,108 samples from additional labeled datasets. We selected our final model based on classification accuracy of labeled test set data through cross validation.<fig id="Fig1"><label>Fig. 1</label><caption><title>Schematic Overview of NEUROeSTIMator.</title><p>The graphical abstract illustrates the application of NEUROeSTIMator, a deep learning model, to estimate neuronal activity. Transcriptome-wide gene expression data from individual neurons is input to an autoencoder, which reconstructs expression of immediate early genes from a single unit latent space called the ‘activity score’. The activity score can be applied to gene expression data, including single cell RNA-sequencing, Patch-seq, or spatial transcriptomics studies for detecting transcriptomic signatures of activity.</p></caption><graphic xlink:href="41467_2023_44503_Fig1_HTML" id="d32e434"/></fig></p>
      <p id="Par8">For further analyses, model output at the bottleneck activation layer was extracted to index activity level for each neuron passed through the model. Hereafter, we refer to this output as the predicted activity or activity score.</p>
    </sec>
    <sec id="Sec4">
      <title>Genes informing model predictions</title>
      <p id="Par9">To identify genes whose expression levels influence model predictions, we calculated integrated gradients<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> for all input genes with respect to predicted activity using data from the held out test set. Integrated gradients attribute model predictions to input features for each cell. We first compared the attributions of target and non-target genes on predicted activity. The most influential genes were <italic>Fos, Egr1</italic>, <italic>Fosl2, Junb, Fbxo33</italic>, and <italic>Nr4a1</italic>. We further explored gene importance for all non-target input genes and found varying degrees of influence throughout the transcriptome (Supplementary Data <xref rid="MOESM4" ref-type="media">2</xref>). The most influential non-target genes, such as <italic>Fosb</italic>, <italic>Npas4</italic>, <italic>Egr2</italic>, and <italic>Ntrk2</italic> tended to have higher initial support for consideration as a target gene and were more often differentially expressed in multiple transcriptomic studies of neuronal activity-dependent transcription (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a</xref>). Other known activity response genes such as <italic>Homer1, Egr4, Dusp6</italic>, and <italic>Bdnf</italic> were also among the top fifty genes with the highest feature attribution. To evaluate whether influential genes were enriched for specific annotated biological mechanisms, we performed gene set enrichment analysis on gene ontology and pathway annotation sets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3b</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">3</xref>). Among the most highly enriched gene sets were DNA binding transcription factor activator activity (<italic>p</italic><sub>adjusted</sub> = 3.97 × 10<sup>−9</sup>, NES = 2.29), signaling by NTRKs (<italic>p</italic><sub>adjusted</sub> = 2.07 × 10<sup>−8</sup>, NES = 2.40), cognition (<italic>p</italic><sub>adjusted</sub> = 5.35 × 10<sup>−3</sup>, NES = 2.01), MAPK signaling pathway (<italic>p</italic><sub>adjusted</sub> = 2.02 × 10<sup>−4</sup>, NES = 2.01), circadian rhythm (<italic>p</italic><sub>adjusted</sub> = 1.60 × 10<sup>−3</sup>, NES = 2.03), and cellular response to extracellular stimulus (<italic>p</italic><sub>adjusted</sub> = 0.033, NES = 1.89). To identify gene sets with higher attribution in non-target genes, we removed target genes, repeated the analysis, and identified gene sets that remained, or became significant. Of the 45 pathways significantly enriched when examining all genes, seven sets remained significant when excluding target genes, and seven new sets became significant, including positive regulation of neurogenesis (<italic>p</italic><sub>adjusted</sub> = 0.019, NES = 1.48), regulation of synapse structure or activity (<italic>p</italic><sub>adjusted</sub> = 0.018, NES = 1.49), and PI3/AKT signaling (<italic>p</italic><sub>adjusted</sub> = 0.019, NES = 1.37) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3b</xref>).</p>
    </sec>
    <sec id="Sec5">
      <title>Electrophysiological features of individual neurons predicted by transcription via NEUROeSTIMator</title>
      <p id="Par10">As an initial application of our model, we examined neurons subjected to direct electrical stimulation. We integrated single cell RNA assays of a Patch-seq dataset<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> with a SMART-seq dataset<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> of mouse GABAergic neurons, both generated by the Allen Institute for Brain Science (AIBS) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a</xref>). Using the standard Seurat workflow<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>, we identified seven clusters corresponding to AIBS-defined neuron types including Sst, Sst Chodl, Pvalb, Vip, Lamp5, Sncg, and Meis2 neuron clusters. We applied NEUROeSTIMator to both datasets and observed elevated activity score predictions in the Patch-seq dataset relative to the SMART-seq dataset for seven neuron types (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). We obtained empirical p-value estimates of the Kolmogorov–Smirnov (KS) test by permuting expression values in each cell and recalculating activity score for one thousand permutations. Six of the seven neuron types showed significant differences in activity score distributions between datasets (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>), of which Lamp5 neurons showed the greatest difference (<italic>p</italic> &lt; 0.001, D = 0.79, KS test) and Vip neurons showing the smallest difference (<italic>p</italic> = 0.033, D = 0.41, KS test). We also noted that several immediate early genes, which serve as predictive targets for NEUROeSTIMator, were among the top genes with higher mean expression in the Patch-seq dataset compared to the SMART-seq dataset (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b</xref>). Together, these results suggest that the Patch-seq protocol induces significantly greater transcriptional upregulation of activity-dependent genes as compared to the standard SMART-seq protocol, and our model is sensitive to these differences. Notably, this effect is consistent for nearly all neuronal types tested.<fig id="Fig2"><label>Fig. 2</label><caption><title>Electrophysiological features of neuronal stimulation captured by transcriptome-based activity score.</title><p><bold>a</bold> Activity score distributions compared between stimulated Patch-seq neurons (gold) and unstimulated SMART-seq neurons (violet). The number of cells in each comparison are given as text annotations for each density plot. <bold>b</bold> Observed D statistics (red line) and empirical distribution from Kolmogorov–Smirnov tests (two-sided) between activity score distributions of Patch-seq and SMART-seq datasets, using permutations of shuffled expression values (<italic>n</italic> = 1000 permutations per cell type) from all cells represented in <bold>a</bold>. Boxplots depict median value, box bounds denote interquartile range (IQR), whiskers denote values within ±1.5 x IQR, and points outside of whisker range denote outliers with values ≥1.5 x IQR. <bold>c</bold> Associations between electrophysiological (e-phys) features and predicted activity (<italic>n</italic> = 1277 cells). Heatmap shows feature value columns ordered by the mean bootstrap coefficient, and individual neuron rows ordered by ephys-based lasso model prediction of NEUROeSTIMator output (top). Predicted and observed NEUROeSTIMator output shown to the right. Colors represent z-scaled values, with red colors indicating higher values and blue indicating lower values. The dot plot (bottom) shows a summary of coefficients estimated by fitting lasso-regularized linear models between electrophysiology feature value and NEUROeSTIMator output (<italic>n</italic> = 10,000 bootstrap permutations per feature). Dots represent the mean coefficient estimate across bootstraps, lines indicate standard error across bootstraps. <italic>P</italic>-values were estimated by counting the number of bootstrap permutations where the coefficient was zero or the opposite sign of coefficients observed from the lasso model fit to all data. Significant features with standard errors that do not cross zero (<italic>p</italic> &lt; 0.05, unadjusted) are depicted by green-colored dots (bottom). See source data for full statistics and feature descriptions. <bold>d</bold> Spike train comparison of two Vip<italic>/</italic>Ptprt<italic>/</italic>Pkp2 neurons exhibiting representative electrophysiological features of high (red) and low (blue) NEUROeSTIMator predictions (ramp current injected - top panel, membrane potential - bottom panel). <bold>e</bold> Patch-seq validation of the positive association between input resistance and NEUROeSTIMator predictions in a novel set of human excitatory neurons (<italic>n</italic> = 25 cells). Pearson’s correlation test (two-sided) statistics annotated; linear fit (orange line). Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_44503_Fig2_HTML" id="d32e624"/></fig></p>
      <p id="Par11">We established that our model detects transcriptomic signals that separate the electrically stimulated Patch-seq dataset from the unstimulated SMART-seq dataset. However, it is not clear whether elevated activity was due to electrical stimulation and neuron depolarization, or general features of the Patch-seq protocol. Patch-seq neurons showed variability in predicted activity and, because all neurons underwent the stimulation protocol, we hypothesized that variability in activity score predictions were linked to individual neuron differences in electrophysiological features, either intrinsic properties, or responses to stimulation.</p>
      <p id="Par12">To determine if NEUROeSTIMator predictions of activity could be explained by electrophysiology, we fit a lasso-regularized generalized linear model with 10-fold cross validation to predict NEUROeSTIMator output using only electrophysiological features derived from Patch-seq recordings. We used 41 electrophysiological features, including features measured at baseline and in response to the current ramp stimulus. As substantial differences in electrophysiology exist between neuron types, we residualized activity score and derived features for neuron type in order to force the model to learn cell type-agnostic combinations of features that explain variability in activity score. For further analyses, we focus on the four most abundant neuron types: Lamp5, Pvalb, Sst, and Vip neurons. A PCA on these 41 features revealed 90% of variance is explained by fifteen principal components, three of which were associated with activity score (<italic>p</italic> &lt; 0.05) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4c</xref>). The cross-validated lasso model predictions were significantly correlated with NEUROeSTIMator output (R = 0.234, <italic>p</italic> &lt; 2.2 × 10<sup>−16</sup>). To evaluate feature importance for each electrophysiological feature, we obtained bootstrap coefficient estimates and standard errors by permuting sample weights for each of 10,000 model fits (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). Three features showed robust non-zero coefficients; membrane time constant (tau) (coefficient = −0.154, standard error = 0.037), input resistance (coefficient: 0.088, standard error = 0.041), and the threshold current to depolarization (coefficient = −0.080, standard error = 0.038). The combination of these features and their direction of effect suggest that the most stimulus-responsive neurons, those which exhibit a transcriptional response, are more excitable than other neurons of the same type (Fig. <xref rid="Fig2" ref-type="fig">2d</xref>). We then examined specifically the relationship between input resistance and NEUROeSTIMator predictions in an independent Patch-seq dataset of human excitatory neurons and, again, found a significant positive correlation (<italic>r</italic> = 0.497, <italic>p</italic> = 0.011) (Fig. <xref rid="Fig2" ref-type="fig">2e</xref>). Despite the fundamental differences between Patch-seq datasets in species and major neuron class, this successful validation emphasizes the robustness of the relationship between neuronal excitability and transcriptional response to stimulation, as revealed through NEUROeSTIMator predictions.</p>
      <p id="Par13">To better understand how NEUROeSTIMator connects gene expression to electrophysiology, we performed generalized canonical correlation analysis using three input matrices: the gene expression matrix, a matrix containing the three significant electrophysiology features, and a one column matrix containing the NEUROeSTIMator output. We computed a single component and examined gene expression loadings to understand genes explaining covariance of both predicted activity and the electrophysiological features of excitability. We used GSEA to identify gene sets enriched for the genes correlated to both predicted activity and excitability (Supplementary Data <xref rid="MOESM4" ref-type="media">4</xref>). We found significant enrichment of several gene sets including DNA binding transcription activator activity (<italic>p</italic><sub>adjusted</sub> = 2.74 × 10<sup>−5</sup>, NES = 1.91), MAPK signaling (<italic>p</italic><sub>adjusted</sub> = 2.54 × 10<sup>−4</sup>, NES = 1.78), and RAS signaling (<italic>p</italic><sub>adjusted</sub> = 3.80 × 10<sup>−2</sup>, NES = 1.48) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4d</xref>). Genes common to these pathways with high loadings included <italic>Dusp6</italic>, <italic>Dusp10</italic>, <italic>Map3k4</italic>, <italic>Ntrk2</italic>, <italic>Rasgrp1</italic>, and <italic>Prkca</italic>. These pathways constitute an established molecular signaling cascade that functions to link neuron depolarization and related calcium influx to transcriptional response<sup><xref ref-type="bibr" rid="CR25">25</xref>,<xref ref-type="bibr" rid="CR26">26</xref></sup>.</p>
      <p id="Par14">Taken together, these results demonstrate that NEUROeSTIMator captures transcriptomic signatures of activity that are associated with electrophysiological properties measured in response to electrical stimulation of individual neurons. Building upon this successful application in electrophysiology, we next extended our analyses to demonstrate NEUROeSTIMator’s utility across a range of applications (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>Detecting pharmacological activation of neurons</title>
      <p id="Par15">We applied our model to three single-cell datasets containing neurons from rodents and human cell lines treated with powerful stimulating, pharmacological agents. From the first dataset, we computed activity score for neurons of mice treated with either saline or pentylenetetrazol (PTZ), a depolarizing agent used to model status epilepticus and induce seizures<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR28">28</xref></sup>. As expected, we observed significant differences in distributions of predicted activity (KS test) for 11/14 neuronal subclasses tested, including excitatory cortical layer 2/3 (L2/3) neurons, Lamp5 interneurons, and Sst interneurons (L2/3 IT CTX: D = 0.40, <italic>p</italic> = 9.67 × 10<sup>−24</sup>), (L2/3 IT ENT: D = 0.5, <italic>p</italic> = 4.64 × 10<sup>−28</sup>), (Lamp5: D = 0.49, <italic>p</italic> = 1.73 × 10<sup>−4</sup>), (Sst: D = 0.42, <italic>p</italic> = 3.81 × 10<sup>−6</sup>) (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">5</xref>).<fig id="Fig3"><label>Fig. 3</label><caption><title>Multi-species generalization of neuronal activity score applied to previously published chemical induction studies.</title><p>Predicted activity for various neuron types responding to treatment with potent chemical modulators of neuron activity. <bold>a</bold> Response to PTZ-induced seizure (red) and controls (white) in mouse cortical neurons. <bold>b</bold> Cocaine treatment (red) or controls (white) in rat nucleus accumbens neurons. <bold>c</bold> Time series of predicted activity for human iPSCs treated with depolarizing potassium chloride at 0 h (control), 1 h, 2 h, and 4 h. Annotated statistics from Kolmogorov–Smirnov tests (one-sided) are provided in Supplementary Data <xref rid="MOESM4" ref-type="media">5</xref>. Boxplots depict median value, box bounds denote interquartile range (IQR), whiskers denote values within ±1.5 x IQR, and points outside of whisker range denote outliers with values ≥1.5 x IQR. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_44503_Fig3_HTML" id="d32e776"/></fig></p>
      <p id="Par16">Next, we compared activity score between neurons from the nucleus accumbens (NAc) of rats treated with either saline or cocaine, a stimulant acting on dopaminergic neurotransmission<sup><xref ref-type="bibr" rid="CR29">29</xref>,<xref ref-type="bibr" rid="CR30">30</xref></sup>. We found neuron subtype-specific increases in activity score. Two subclasses of dopaminergic medium spiny neurons (MSNs) and both Pvalb interneurons exhibited significant differences in predicted activity (Drd1-MSN: D = 0.15, <italic>p</italic> = 5.92 × 10<sup>−7</sup>), (Drd3-MSN: D = 0.19, <italic>p</italic> = 0.049), (Pvalb: D = 0.22, <italic>p</italic> = 0.028 (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">5</xref>). Because our model was not trained using any rat or dopaminergic neurons, these findings provide further endorsement for robust estimation of neuronal activity induced by potent pharmacological agents of stimulation.</p>
      <p id="Par17">To further evaluate whether our model could be successfully applied to human data, we examined a dataset of human induced pluripotent stem cell-derived neurons<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. Neuron cultures were either unstimulated or treated with KCl depolarization<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> buffer for 1, 2, or 4 h. Our model predicted low neuronal activity for the unstimulated group, which was consistent among cell types and biological replicates. Cells treated with KCl for 1 h demonstrated substantial and significant increases in predicted activity. Although significant shifts in predicted activity were observed for all cell types (<italic>p</italic> &lt; 0.05), the activity score of post-mitotic neurons displayed a stronger response to KCl compared to mitotic progenitors. The most responsive neuron types were the mature striatal neurons and pallial neurons (striatal: D<sub>1hr</sub> = 0.69, D<sub>2hr</sub> = 0.58, D<sub>4hr</sub> = 0.50, <italic>p</italic><sub>1hr/2hr/4hr</sub> &lt; 2.22 × 10<sup>−16</sup>), (pallial: D<sub>1hr</sub> = 0.75, D<sub>2hr</sub> = 0.67, D<sub>4hr</sub> = 0.64, <italic>p</italic><sub>1hr/2hr/4hr</sub> &lt; 2.22×10<sup>−16</sup>) (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">5</xref>). Notably, all cell clusters except neural progenitors and septal neurons followed a similar temporal pattern of predicted activity modestly declining at 2 h relative to peak activity at 1 h, with a further decline at 4 h (i.e., D<sub>1hr</sub> &gt; D<sub>2hr</sub> &gt; D<sub>4h</sub>). Despite the steady decline in predicted activity after 1 h, none of the neuron clusters completely returned to basal activity by 4 h, the final time point in the experiment. The temporal trends of predicted activity are indicative of synaptic depression<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>, suggesting NEUROeSTIMator is sensitive to detecting short term plasticity mechanisms.</p>
      <p id="Par18">Together, these analyses suggest our model can robustly assign higher estimates of activity to cells subjected to chemical exposures that are expected to elicit strong and generally ubiquitous transcriptional responses to stimulation.</p>
    </sec>
    <sec id="Sec7">
      <title>Activity score as a generalizable classifier of neuronal stimulation</title>
      <p id="Par19">Next, we asked if our model could detect neuronal activation by more subtle forms of stimuli, such as sensory experience. We applied our model to a dataset containing visual cortex neurons from mice housed in darkness for seven days prior to light exposure for 0, 1, or 4 h<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). We observed a significant increase in predicted activity for neurons from mice exposed to light, relative to controls. To elucidate temporal patterns of activity, we tested differences in activity score distributions between pairs of each time point. Activity score was significantly increased at 1 h for all cell types, in particular for excitatory cortical neurons (layer 2/3: D = 0.56, <italic>p</italic> &lt; 2.22 × 10<sup>−16</sup>), (layer 4: D = 0.60, <italic>p</italic> &lt; 2.22 × 10<sup>−16</sup>), (layer 6: D = 0.54, <italic>p</italic> &lt; 2.22 × 10<sup>−16</sup>). At 4 h of light exposure, predicted activity began to show diverging trends which were foreshadowed by predicted activity at 1 h. Although trending towards a return to baseline, activity scores of neurons at 4 h were not significantly different from neurons at 1 h, while several glial cell types returned to baseline (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">6</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>Temporal patterns and classification of in vivo sensory activation.</title><p><bold>a</bold> Cell type activity predictions of visual cortex neurons in freely behaving mice exposed to light for 0, 1, or 4 h. Activity predictions summarized by cell type and experimental group, and Kolmogorov–Smirnov (one-sided) test results are provided in Supplementary Data <xref rid="MOESM4" ref-type="media">6</xref>. Color indicates cell type and shape indicates major cell type groupings. <bold>b</bold> ROC plots indicate the ability of predicted activity to distinguish between the 0 h and 1 h experimental groups. Diagonals from bottom left to top right indicate an accuracy similar to random chance, while lines moving straight vertically, then straight horizontally indicate perfect separation. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_44503_Fig4_HTML" id="d32e911"/></fig></p>
      <p id="Par20">As we observed similar trends in temporal activity predictions between the unstimulated (0 h) and 1 h group, we investigated the degree to which the activity score derived from our model could be used as a classifier of experimental group. The degree to which activity score is predictive of experimental group in a particular cell type is expected to represent the robustness of the response in that cell type. Using the visual cortex dataset (VIS) mentioned above, we constructed receiver-operator curve (ROC) plots for neuronal and non-neuronal cell types (Fig. <xref rid="Fig4" ref-type="fig">4b</xref>). For both excitatory neuron and interneuron subtypes, the activity score demonstrated varying degrees of predictive power. For example, the activity score alone was able to almost perfectly separate stimulation groups when considering excitatory cortical layer cell types (layer 2/3: AUC = 0.84), (layer 4: AUC = 0.89), (layer 6: AUC = 0.823), as well as certain interneuron cell types (Sst-2: AUC: 0.97), (Vip: AUC = 0.90). Despite the model being trained on purely neuronal cell type populations, the activity score was able to separate stimulation groups for astrocytes (AUC = 0.84) and endothelial cells (AUC = 0.72) with comparable accuracy to neurons.</p>
    </sec>
    <sec id="Sec8">
      <title>Utility in data modalities beyond scRNA-seq</title>
      <p id="Par21">Next, we asked whether our model could identify spatial signatures of learning in brain slices of mice following spatial object recognition (SOR) training - a widely used behavioral paradigm to investigate spatial memory mechanisms<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. Using spatial transcriptomic data from brain slices of SOR-trained and homecage control (HC) male mice, we applied our model to predict activity for each spot (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5a</xref>) and clustered all spots into anatomical regions. The 22 resulting clusters were annotated with brain region naming conventions from the Allen Mouse Brain Atlas (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). In baseline homecage samples, we noted weak activation signatures, primarily covering regions of the striatum and hypothalamus as well as subregions of the hippocampus (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>, left). Following SOR training, we noted region-specific increases in predicted activity (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>, right). To identify a spatial activation signature of SOR for the entire brain slice, we tested for differences in predicted activity for each brain region cluster (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>). We observed significant increases in predicted activity for several cortical and subcortical regions. Multiple layers of the isocortex and the retrosplenial area showed increases in activity following SOR (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>), with the greatest increases observed in layers 2/3 (β = 0.17, <italic>p</italic><sub>adjusted</sub> = 3.16 × 10<sup>−4</sup>) and the retrosplenial cortex (β = 0.17, <italic>p</italic><sub>adjusted</sub> = 1.00 × 10<sup>−6</sup>). The caudoputamen area of the dorsal striatum, subregions of the hippocampus, and the olfactory/piriform areas also showed significant increases in activity, of comparable magnitude (caudoputamen: β = 0.12, <italic>p</italic><sub>adjusted</sub> = 8.01 × 10<sup>−4</sup>). Subregions of the hippocampus were variably activated following SOR, with the strongest induction observed in the CA1 subregion (β = 0.12, <italic>p</italic><sub>adjusted</sub> = 9.14 × 10<sup>−5</sup>), while the dentate gyrus subregion did not show significant activation (β = 0.03, <italic>p</italic><sub>adjusted</sub> = 0.07). Other regions predicted to be least activated by SOR include the thalamus, hypothalamus, and fiber tracts (Supplementary Data <xref rid="MOESM4" ref-type="media">7</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><title>Spatial transcriptomic patterns of neuronal activation after spatial learning.</title><p><bold>a</bold> Spatial anatomical clustering of RNA-sequencing spots. RSP retrosplenial area, HY hypothalamus, AMY amygdala, med: medial, lat lateral. <bold>b</bold> Activity score per spot, averaged within experimental groups of homecage controls (left) and 1 h after SOR training (right). Yellow color indicates low activity and red indicates high activity. <bold>c</bold> Brain region-specific induction of activity following SOR training. Differences tested using a linear mixed effects model (two-sided), colored by the SOR coefficient estimate per region (<italic>n</italic> = 3 biologically independent mice per group). Dark purple colors represent greater differences between groups. Cluster-wise differential activity statistics are summarized in (<bold>d</bold>) and provided in Supplementary Data <xref rid="MOESM4" ref-type="media">7</xref>. Dots represent estimated coefficients of SOR on activity score; linear fit. Brackets indicate standard error of the coefficient. Asterisks indicate a significant difference in activity score between homecage and SOR groups—false discovery rate (FDR)-adjusted <italic>p</italic>-values are *FDR ≤ 0.05, **FDR ≤ 0.01, ***FDR ≤ 0.001, and ****FDR ≤ 0.0001. Exact <italic>p</italic>-values, FDR, coefficients, and the number of cells per group, per brain region are provided in Supplementary Data <xref rid="MOESM4" ref-type="media">7</xref>. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_44503_Fig5_HTML" id="d32e1012"/></fig></p>
      <p id="Par22">Visium samples contain signal from multiple neuronal and non-neuronal cells. Cortical layers and CA1 showed profound increases in activity but are also known to have relatively high neuron density. Therefore, we considered the extent to which regional neuron density influences coefficient estimates in Fig. <xref rid="Fig5" ref-type="fig">5d</xref>. We performed cell type deconvolution on each Visium spot, using neuronal and non-neuronal cell type expression profiles from the Allen Cell Types Database. For a subset of genes with high variability across cell classes, we fit a linear model to each Visium spot as a function of GABAergic, glutamatergic, and non-neuronal expression profiles. Coefficient estimates for each cell class were rescaled across samples to a range of zero to one, and then adjusted for each sample to sum to one, thus providing a proxy measure of cell class density (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a</xref>). We found a significant positive relationship between estimated regional neuron abundance and log-estimated regional effect of learning on activity (β = 0.87, <italic>p</italic> = 0.01), (Spearman correlation = 0.54, <italic>p</italic> = 0.009) (Supplementary. Fig. <xref rid="MOESM1" ref-type="media">6b</xref>). We used the residuals of the linear model in Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b</xref> as a neuron density-corrected view of the effect of learning (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6c</xref>). Cortical layers, retrosplenial cortex, CA1, and caudoputamen regions show greater learning-induced increases in activity score than expected based on neuron density estimates alone, suggesting that neurons in these regions exhibit a more potent transcriptional response to learning, or that there are other cell types contributing to the activity signature. The dentate gyrus and regions of the hypothalamus, amygdala, thalamus showed lower activity induction than expected.</p>
      <p id="Par23">To validate the finding that the CA1 region was preferentially activated by spatial learning over the dentate gyrus, we performed RNAscope<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> on coronal brain slices from SOR-trained (1 h post-training) and homecage control mice (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5b</xref>). We selected three NEUROeSTIMator target genes, <italic>Egr1</italic>, <italic>Egr3</italic>, and <italic>Nr4a1</italic> as probes. For each brain slice, we quantified mean fluorescent intensity (MFI) of each probeand then averaged the MFI of all three probes for each hippocampal subregion. A two-way ANOVA revealed a significant interaction between hippocampal subregions and training groups. In line with the spatial transcriptomic data (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5c</xref>), we found that CA1 showed a preferential increase in average probe intensity following spatial learning (Sidak’s test, CA1: <italic>p</italic><sub>adjusted</sub> = 0.0075, dentate gyrus: <italic>p</italic><sub>adjusted</sub> = 0.5553) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5d</xref>).</p>
    </sec>
    <sec id="Sec9">
      <title>NEUROeSTIMator outperforms competing methods in discriminating experimental stimulation groups</title>
      <p id="Par24">The NEUROeSTIMator approach to quantifying activity uses an encoding neural network to infer transcriptome-wide coexpression with a set of 22 activity-dependent target genes. We investigated whether the added complexities of our model are necessary to produce a metric that successfully discerns stimulated samples from unstimulated. We compared NEUROeSTIMator to seven alternative models. The first competing method is a scaled additive model, a simple and easily implementable approach that scales normalized expression of NEUROeSTIMator’s 22 target genes across samples to range of [0,1], and then sums scaled values within samples. The second method, the PC1 model, scores samples with target gene loadings derived from the first component of a PCA on the NEUROeSTIMator training dataset. The third method uses MAGIC for graph-based imputation before applying the scaled additive approach to the imputed expression values. The fourth method, the transcriptome-naïve model, is a neural network trained with identical parameters to NEUROeSTIMator, but without access to non-target gene expression inputs. The fifth approach, the transcriptome reconstruction approach, is a neural network trained with identical parameters to NEUROeSTIMator but reconstructs the entire transcriptome with the 22 target genes having equal total loss weight to all other genes. The sixth and seventh approaches, the 2 &amp; 3-unit bottleneck models, are neural networks trained with identical parameters to NEUROeSTIMator, but using two and three bottleneck units, respectively. We evaluated each model by scoring activity in stimulated and unstimulated samples from six datasets (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>) and determined separability of the experimental groups using area under the curve (AUC). This approach was applied to datasets featured in Figs. <xref rid="Fig3" ref-type="fig">3</xref>, <xref rid="Fig4" ref-type="fig">4</xref>, and <xref rid="Fig5" ref-type="fig">5</xref>, as well as a novel single nuclei dataset from mouse dorsal hippocampus following SOR. For each method, dataset, and neuron type we computed AUC and summarized the performance differences between NEUROeSTIMator and competing methods (ΔAUC). (Supplementary Figs. <xref rid="MOESM1" ref-type="media">7</xref>, <xref rid="MOESM1" ref-type="media">8</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">8</xref>). NEUROeSTIMator demonstrated higher performance than each of the competing methods (AUC<sub>NEUROeSTIMator</sub> = 0.732, AUC<sub>scaled.additive</sub> = 0.651, AUC<sub>MAGIC</sub> = 0.587, AUC<sub>PC1</sub> = 0.661, AUC<sub>transcriptome.naive</sub> = 0.671, AUC<sub>transcriptome.reconstruction</sub> = 0.702, AUC<sub>NEUROeSTIMator.2units</sub> = 0.725, AUC<sub>NEUROeSTIMator.3units</sub> = 0.717), (mean ΔAUC<sub>scaled.additive</sub> = +0.081, ΔAUC<sub>MAGIC</sub> = +0.145, ΔAUC<sub>PC1</sub> = +0.071, ΔAUC<sub>transcriptome.naive</sub> = +0.061, ΔAUC<sub>transcriptome.reconstruction</sub> = +0.030, ΔAUC<sub>NEUROeSTIMator.2units</sub> = +0.007, ΔAUC<sub>NEUROeSTIMator.3units</sub> = +0.015). Across all competing methods, datasets, and sample groupings, NEUROeSTIMator increased AUC in 77.9% of 763 comparisons. For comparisons where NEUROeSTIMator outperformed the competing method, the average increase in AUC was +0.077. For the remaining 22.1% of comparisons where NEUROeSTIMator did worse than the competing method, the average decrease in AUC was −0.031. Together, these results suggest that the neural network architecture and NEUROeSTIMator’s use of broader transcriptomic signals underlie its enhanced performance compared to alternative approaches.</p>
    </sec>
  </sec>
  <sec id="Sec10" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par25">We introduce NEUROeSTIMator, a versatile tool that estimates neuronal activity from transcriptome-wide single-cell gene expression data. Our method generates an activity score that reflects whole-transcriptome response to stimulation, facilitating the rapid identification and prioritization of neurons displaying stimulus response. NEUROeSTIMator’s performance and generalizability are demonstrated through capturing electrophysiological (e-phys) features and detecting activation signatures across various stimulation protocols, neuron subtypes, species, and sequencing technologies, including spatial transcriptomics.</p>
    <p id="Par26">Our analysis reveals that activity-predictive signals are distributed broadly across the transcriptome and are enriched for genes related to external stimulus response, synaptic plasticity, MAP kinase activity, and circadian rhythm. Moreover, we demonstrate a significant link between NEUROeSTIMator’s predictions and increased neuronal excitability, utilizing a unique single-cell Patch-seq dataset containing gene expression and e-phys readouts from individual GABAergic murine neurons<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. These results were further confirmed through a significant association between the activity score and measures of excitability in human excitatory neurons<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>.</p>
    <p id="Par27">We showcase NEUROeSTIMator’s flexibility and generalizability through secondary analyses of several diverse published datasets, detecting potent pharmacologically induced neuronal activity and generalizing across species and cell types. Importantly, our model also detects physiologically relevant activation in response to sensory experiences and uncovers unexpected activity in non-neuronal cells (e.g., astrocytes), suggesting potential applicability to other cell types and stimulus responses.</p>
    <p id="Par28">In a novel application, we use NEUROeSTIMator to analyze spatial transcriptomic data from mice subjected to a spatial learning task, revealing a brain-wide map of learning-induced activation. This highlights the method’s adaptability to spatial transcriptomics (and other varieties of bulk RNA-seq data) and suggests potential for uncovering distinct spatial signatures of transcriptional activation related to cognitive processes.</p>
    <p id="Par29">While our model demonstrates a significant link between transcriptional response and e-phys features in murine interneurons and human excitatory neurons, its applicability to e-phys features in broader cell types is limited by the few available Patch-seq datasets. Additionally, our model does not inherently differentiate stimulation types (e.g., pharmacological vs. naturalistic), and we observed some sensitivity to activity signatures in non-neuronal cell types (a potentially desirable feature, depending on the application). Further, the activity score is limited to detecting activation linked to immediate early gene expression; other potential mechanisms that may be linked to neuronal activation and that act independently of this well-established mechanism may not be detected by our tool. Despite these limitations, NEUROeSTIMator delivers key insights across several neuroscience research domains.</p>
    <p id="Par30">As the first robust and generalizable method for estimating neuronal activation from transcriptomic data, NEUROeSTIMator has broad implications for molecular neuroscience research and challenges the single-gene paradigm of measuring neuronal activity. Our method enables the estimation of cellular activity state, a fundamental variable in gene expression research, paving the way for its integration into single-cell and spatial transcriptomics analyses.</p>
  </sec>
  <sec id="Sec11">
    <title>Methods</title>
    <sec id="Sec12">
      <title>Dataset for model training and evaluation</title>
      <p id="Par31">To train the model, we utilized publicly available datasets provided by the Allen Institute for Brain Science, including a single-cell RNA-sequencing (scRNAseq) dataset of over a million cells isolated from mouse cortical and hippocampal tissue<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>, and a single-nuclei RNA-sequencing (snRNAseq) dataset of 76,000 nuclei isolated from human cortical tissue. Hereafter, these datasets will be referred to as the Allen Mouse and Allen Human datasets. Both datasets used the 10X Genomics Chromium system for droplet capture. The Allen Mouse dataset was prepared using the Chromium Next GEM Single Cell 3’ v3 reagent kit, while the Allen Human dataset used v2.</p>
    </sec>
    <sec id="Sec13">
      <title>Datasets for model application—publicly available</title>
      <p id="Par32">We downloaded multiple datasets from Gene Expression Omnibus (GEO) to demonstrate the utility of our model. The following GEO accessions were included in analyses: GSE102827<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>, GSE106678<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>, GSE136656<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>, and GSE137763<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>.</p>
    </sec>
    <sec id="Sec14">
      <title>Gene identifier mapping</title>
      <p id="Par33">We used the R package biomaRt (version 2.46.3) to map gene identifiers from various annotations used in public datasets, and between species, to a common set of reliably mapped genes<sup><xref ref-type="bibr" rid="CR39">39</xref>,<xref ref-type="bibr" rid="CR40">40</xref></sup>. Ensembl gene identifiers (Ensembl IDs) were used as the primary identifier for mapping genes, and gene symbols were used as secondary identifiers in cases of ambiguous mapping. The Ensembl release 93 archive (July 2018 release) was used for cross-species gene mapping<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>. Genes with one-to-one orthology between mouse and human, as well as mouse and rat, were selected to facilitate cross species utility. All datasets lacking Ensembl ID annotation contained gene symbols, which were then queried against multiple Ensembl archives to determine which archive maximized identifier mapping rate. For instances, when a gene symbol mapped to multiple Ensembl IDs, identifiers present in the cross-species mapping table were preferentially selected. We provide a helper function for mapping gene identifiers to the feature set used by our model, and we further demonstrate usage in the associated tutorial.</p>
    </sec>
    <sec id="Sec15">
      <title>Choice of neural network target genes</title>
      <p id="Par34">To identify robust markers of neuronal activity for use as targets of the neural network, we intersected lists of stimulus-responsive genes from three published RNA-sequencing experiments. Each publication was from a different group of authors, focused on different brain regions, and used different forms of neuronal stimulation (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>). One publication categorized stimulus-responsive genes into three groups—rapid primary response genes (rPRGs), delayed primary response genes (dPRGs), and secondary response genes (SRGs)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>. As SRGs are thought to demonstrate higher celltype-specificity relative to PRGs<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>, only rPRGs and dPRGs were considered from this publication. In another publication, approximately 600 genes upregulated in response to kainic acid treatment in the hippocampus were considered<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
      <p id="Par35">In a third publication, two sets of KCl-responsive genes were available, one from a brain region enriched in glutamatergic neurons and one enriched for GABAergic neurons<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. For this study, we sought to intersect the results of both the glutamatergic and GABAergic analyses into one list of genes. Published p-value distributions suggested differences in statistical power between these two analyses, and only statistically significant results were published. To expand the list of genes overlapping between these analyses, we reanalyzed the data using GEO2R to obtain two sets of transcriptome-wide statistics. Using significance rankings from the GEO2R reanalysis, we jointly determined p-value thresholds for each analysis based on rank-rank hypergeometric overlap (RRHO, see Supplementary Fig. <xref rid="MOESM1" ref-type="media">9</xref>) and identified genes with p-values below these thresholds in both sets with concordant direction of effect<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. Because this approach used unconventional p-value thresholding, we additionally required intersecting genes to have an estimated fold change greater than or equal to 0.5 in both analyses.</p>
      <p id="Par36">Intersecting the three lists of stimulus response genes provided 41 candidate target genes. From these 41, four genes were excluded due to ambiguous or failed cross-species gene identifier mapping. We also excluded an additional eight genes that were detected in less than 1% of cells in more than one out of the four species-by-class groups (i.e., mouse-GABA, mouse-glut, human-GABA, human-glut) to mitigate the potential for the model to learn spurious target correlations to cell class markers or species markers. We performed principal component analysis (PCA) on the reaming 29 candidate target genes to assess dimensionality and found that PCs beyond PC1 added very little to the variance explained (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1a</xref>). All but one gene had a positive loading on PC1, and several genes had a loading near zero. We identified genes that had extreme positive loadings by comparing them to an outlier threshold for PC1 loadings from a shuffled, null PCA. A scaling factor, the ratio of variance from the observed PC1 to the null PC1, was used to make the loadings comparable. The outlier threshold was defined as the median null loading plus or minus three times the median absolute deviation of the null loadings. We found that 22 of 29 genes had loadings considered to be outliers under the null expectation (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1b</xref>). We then did 1000 bootstrap permutations of this analysis, each using random samples of 10,000 cells, and counted the number of permutations where each gene’s loading surpassed the outlier threshold. The same 22 genes surpassed the threshold in at least 5% of the permutations, while the other 7 genes did not (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1c</xref>). With evidence of robust coexpression, those 22 genes were selected as the final set of targets for our neural network: <italic>Arc</italic>, <italic>Btg2</italic>, <italic>Coq10b</italic>, <italic>Crem</italic>, <italic>Dusp1</italic>, <italic>Dusp5</italic>, <italic>Egr1</italic>, <italic>Egr3</italic>, <italic>Fbxo33</italic>, <italic>Fos</italic>, <italic>Fosl2</italic>, <italic>Gadd45g</italic>, <italic>Gmeb2</italic>, <italic>Grasp</italic>, <italic>Junb</italic>, <italic>Nr4a1</italic>, <italic>Nr4a2</italic>, <italic>Nr4a3</italic>, <italic>Per1</italic>, <italic>Rgs2</italic>, <italic>Sertad1</italic>, and <italic>Tiparp</italic>.</p>
    </sec>
    <sec id="Sec16">
      <title>Sample filtering, downsampling, and partitioning</title>
      <p id="Par37">Cells were filtered out if they had less than 5000 total counts, greater than 50,000 total counts, less than 1000 genes detected, more than 10% reads originating from mitochondrial genes, or more than 10% reads originating from the most highly expressed gene. Non-neuronal cells and ultra-rare neuron subclasses with less than 1000 cells were removed, and imbalances among species, neuron type, quality control metrics and naively estimated activity were alleviated using weighted downsampling with hierarchically readjusted weights. Cells were grouped hierarchically by species, class, brain region neighborhood, subclass, and finally, by two-dimensional binning of one source of technical variation (log<sub>10</sub> of total counts), and one source of biological variation (PC1 of target genes). Each group at the leaf nodes of the hierarchy were assigned equal weights summing to one. At each level of the hierarchy, moving from leaves to root, weights were readjusted to sum to one for each group. Using these weights, we downsampled the dataset and calculated Shannon’s entropy to measure imbalance at different values of <italic>N</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2a</xref>) We chose to downsample to 500,000 cells to strike a balance between dataset size and diversity. The effects of downsampling are demonstrated for four subclasses in Supplementary Fig. <xref rid="MOESM1" ref-type="media">2b</xref>. The R package groupdata2 (version 1.4.1) was used to create five training folds (91.3%, 456,725 samples) and one test split (8.7%, 43,275 samples). We used the groupdata2 function ‘fold’ with the parameters ‘cat_col’ set to the species-class group and ‘num_col’ set to the target gene PC1 values in order to keep these balanced across folds, but also set the ‘id_col’ parameter to the subclass label so each subclass was present in some folds but not others. This was done to discourage the undesirable learning of subclass-specific bias in cross-validation.</p>
    </sec>
    <sec id="Sec17">
      <title>Dataset augmentation</title>
      <p id="Par38">The Allen Cell Types Database has higher average total counts per cell compared to many publicly available datasets. To increase representation of lower quality cells, we created augmented samples by synthetically downsampling raw counts using the R package scater<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> (version 1.18.6). For each combination of species and neuron subclass, an equal number of cells were randomly assigned a value of either 10<sup>3</sup>, 10<sup>3.25</sup>, or 10<sup>3.5</sup> total counts to be downsampled to. All genes were considered for downsampling.</p>
    </sec>
    <sec id="Sec18">
      <title>Feature normalization and preprocessing</title>
      <p id="Par39">Log-normalization, as implemented in Seurat, was used to normalize input gene expression. Total counts for each cell were calculated by summing only the 10,017 features used by the model. Normalized expression levels for each gene were centered and scaled based on mean and standard deviation estimated from the training data. For cross validation, mean and standard deviation were estimated without the held-out fold.</p>
    </sec>
    <sec id="Sec19">
      <title>Model architecture</title>
      <p id="Par40">The architecture of the model was adapted from DCA<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> (see Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). Briefly, input gene expression is supplied to encoder branches; a series of three fully connected dense layers with ELU activations and batch normalization. ELU activations were chosen over RELU to increase learning speed and performance. The first three hidden layers of the encoders contained 16, 8, and 4 units. The encoder then connects to the information bottleneck, a single-unit dense layer with sigmoid activation. Variations of the single unit bottleneck (i.e., two and three unite bottlenecks) were also investigated. Downstream of the bottleneck, a decoder layer outputs the expression values of the target genes, i.e., the estimated mean parameter <bold>µ</bold> of the zero-inflated negative binomial (ZINB) model. A separate parallel encoder branch outputs estimates of the dispersion and dropout parameters. To restrict the bottleneck from capturing biases in the training data, we directly supplied auxiliary inputs (neuron subclass, dataset, and quality control variables) to the decoder. Auxiliary inputs were passed through two hidden layers, producing a six-unit dense layer which was then concatenated with the bottleneck activation as well as the output branch for dispersion and dropout parameters to form penultimate decoder layers. The ZINB loss function was used as implemented in DCA, with the only difference being that our implantation only computes loss for the target genes rather than all inputs to the model. This reconstruction loss is based on the maximum likelihood estimate of the ZINB count model, a common model assumed to underlie the count distributions of single cell RNA-seq datasets. A binary cross entropy loss was added to the bottleneck layer to monitor classification accuracy. For model applications, the model outputs are not used, but the sigmoidal bottleneck activation value is the metric extracted to index neuronal activity (see Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). Two additional variations of the model architecture were also investigated. One alternative model was restricted to using information from only the 22 target genes. Another alternative model reconstructed two separate output branches, each contributing equally to the total loss: one to reconstruct the 22 target genes, and one to reconstruct the whole transcriptome (i.e., all genes supplied at the inputs).</p>
    </sec>
    <sec id="Sec20">
      <title>Model training</title>
      <p id="Par41">We trained the model using the R package keras, version 2.3.0.0, and Tensorflow version 1.15.0<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. Training proceeded for 10 epochs using the ADAM optimizer. Gaussian dropout was applied to input expression to simulate uncertainty in measurements. Augmented samples were given the same output as the original data to curtail the learning of depth-dependent information, and augmented samples appeared in the same training batches as the samples they were derived from. We used basic hyperparameter tuning to evaluate the impact of training epochs, learning rate, and regularization parameters such as dropout, L1, and L2 penalty. The final model was selected based on the minimum cross-validation bottleneck layer loss for labeled data (binary cross entropy). Although samples from labeled datasets contributed to the ZINB reconstruction loss, the bottleneck loss did not contribute to weight updates during training to curtail the possibility of information leakage between the training and test splits. Only test split samples were included in any downstream analysis presented in this paper.</p>
    </sec>
    <sec id="Sec21">
      <title>Evaluating feature importance</title>
      <p id="Par42">To evaluate relative importance of each gene on predicted activity, we implemented a strategy adapted from the integrated gradients<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, a popular feature attribution approach used in image classification. Briefly, model gradients were calculated from input genes to bottleneck activation for the test set. For each gene we fit a generalized additive model (GAM) with smoothing between the sample gradients and bottleneck activation. We estimated global feature importance by approximating the integral of the fit. We took the summation of the GAM output for the full range of possible bottleneck activation values [0,1], with a step size of 1 × 10<sup>−3</sup>. Gene set enrichment analysis was run using the R package fgsea (version 1.16.0). We calculated enrichment for gene ontology, Reactome, KEGG, and Wikipathways terms of size between 100–200.</p>
    </sec>
    <sec id="Sec22">
      <title>Comparison of Patch-seq and Smart-seq datasets</title>
      <p id="Par43">The SMART-seq and Patch-seq datasets were integrated, clustered, and visualized using the R package Seurat<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> (version 4.0.1). The sctransform ‘v2’ method was used for normalization<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>. Cell clustering results were cross-referenced with provided neuron type annotations to identify neuron types common to both datasets and harmonize labels. We used the Kolmogorov–Smirnov test (KS test) to assess distributional differences in predicted activity of samples from the Smart-seq and Patch-seq datasets at the neuron type level. Only neuron types with at least one hundred samples in each dataset were considered. To derive empirical <italic>p</italic>-values and determine whether dataset-specific biases is transcriptome-wide expression levels contributed to observed differences in predicted activity, we ran 1000 permutations of the KS test using activity score predictions from within-sample shuffled gene expression values. Empirical p-values were calculated from the frequency of permutation D statistics that were more extreme than those observed in the actual data.</p>
    </sec>
    <sec id="Sec23">
      <title>Modeling activity score with electrophysiological features</title>
      <p id="Par44">The whole-cell Patch-seq electrophysiology recordings from neurons of mouse visual cortex provided by the Allen Institute for Brain Sciences were downloaded as NWB files from the DANDI (ID: 000020, September 2021 update)<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. The dataset included electrophysiological recordings of 4284 specimens from 1040 mouse subjects. The Python package IPFX (version 1.0.5) was used to perform quality control and compute electrophysiological features from the NWB files. We built a generalized linear model with lasso regularization using the R package glmnet (version 4.1-6) to predict output of NEUROeSTIMator using only electrophysiological features. Cells included in the glmnet training belonged to major neuron types (e.g., Vip, Sst) with at least 200 cells, and minor neuron types (e.g., Sst Rxfp1 Prdm8) with at least 10 cells. Features with missing values in five hundred or more cells were removed, and cells with any missing values for the remaining features were discarded. We engineered additional features from the IPFX output, including time and voltage changes between various action potential landmarks (e.g., voltage change between action potential threshold and peak). Minor neuron type was regressed out of the activity score and electrophysiological features. Cells with feature values more extreme than three standard deviations of the mean were considered outliers and removed. Significance of non-zero coefficients from the glmnet model was evaluated with 10,000 bootstrap permutations. In each permutation, a vector of weights is shuffled and used in fitting the glmnet model. For each input feature, we computed the mean bootstrap coefficient. The confidence interval was defined as the mean estimate plus or minus 1.96 times the standard deviation of the bootstrapped coefficients. Feature significance is indicated by the confidence intervals not reaching or overlapping zero. To validate the electrophysiology findings, we did a Pearson’s correlation test between NEUROeSTIMator output and input resistance for Patch-seq neurons from the AIBS dataset ‘Multimodal Analysis of Human Layer 5 Pyramidal Neurons’<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>. Canonical correlation analysis (CCA) was used to explore gene expression profiles with shared relationships to predicted activity and three electrophysiological features. Inputs to the generalizable CCA included the NEUROeSTIMator output matrix, the matrix of three significant electrophysiological features, and the gene expression matrix. One canonical component was calculated for each input matrix, with the tau parameter set to 0 to maximize correlations between all sets of variables. Gene set enrichment analysis was performed as described above using the gene loadings for the gene expression canonical component.</p>
    </sec>
    <sec id="Sec24">
      <title>Preparation of application datasets</title>
      <p id="Par45">Application datasets were downloaded from the Gene Expression Omnibus (GEO). In datasets without provided labels, cell types were identified by running the standard Seurat pipeline, identifying cell clusters, and cross-referencing cluster marker genes to those used in the source publications or the Allen Cell Types Database. To prepare datasets for input to NEUROeSTIMator, gene expression data was log-normalized sample-wise and scaled gene-wise using mean and standard deviation values from the original training dataset. Samples with at least 1000 counts were then input to the model and activity score was the 1-unit bottleneck activation layer output.</p>
    </sec>
    <sec id="Sec25">
      <title>Testing differences in predicted activity</title>
      <p id="Par46">For all datasets analyzed in Figs. <xref rid="Fig2" ref-type="fig">2</xref> and <xref rid="Fig3" ref-type="fig">3</xref>, we used the KS test to evaluate differences in activity score distributions. For statistical tests in Fig. <xref rid="Fig5" ref-type="fig">5</xref>, we used the R package lmerTest to fit alinear mixed effect model with donor as a random effect to test for differences in predicted activity of experimental groups across the spatial transcriptomic clusters, deriving p-values and coefficient estimates of learning on predicted activity per cluster. In Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b</xref>, we adjusted the coefficient estimates of learning on predicted activity for neuron density. We estimated neuron density using a cell type deconvolution technique. We derived gene signatures for GABAergic neurons, glutamatergic neurons, and non-neuronal cell classes by averaging the median gene expression for their respective clusters and subclasses from the Allen Cell Types Database.</p>
      <p id="Par47">For each sample in the Visium dataset, we constructed a linear model, correlating the gene expression vector with a three-column matrix that contained class-averaged expression signatures. We then normalized the coefficient estimates across all Visium samples for each cell class by scaling them to a 0–1 range and then adjusting their sum to one within samples. This process provided an estimate of abundance for each cell class. We summed the estimated abundances of glutamatergic and GABAergic neurons to determine neuron abundance or density for a specific Visium spot, Subsequently, we created a linear model of brain region log coefficient estimates as a function of brain region averaged neuron density estimates. The residuals of this model represent the neuron density-corrected coefficient estimates.</p>
    </sec>
    <sec id="Sec26">
      <title>Performance benchmarking</title>
      <p id="Par48">We compared the performance of NEUROeSTIMator to seven alternative approaches to quantify activity. Performance was defined by the ability to separate labeled cells based on the stimulation status (i.e., experimental group) using area under the curve (AUC). The seven alternative approaches were calculated as follows. The scaled additive measure of activity is calculated by first scaling log-normalized target expression values to a range between 0 and 1, and then summing the scaled targets in each cell or sample. We also applied this scaled additive approach to target expression levels imputed by MAGIC<sup><xref ref-type="bibr" rid="CR47">47</xref></sup>, as implemented in the R package Rmagic (version 2.0.3), with default parameters. To calculate the PC1 measure, we first performed PCA on target genes of the training set used to train NEUROeSTIMator. The loadings for PC1 were then applied to the test set. The remaining four approaches were alternative versions of NEUROeSTIMator. The transcriptome-naïve model is a version of NEUROeSTIMator trained with the same parameters, but information from the non-target input genes is blocked by setting their input values and weights to the first hidden layer to zero. The whole-transcriptome model reconstructed the entire transcriptome during training, as opposed to reconstructing only the targets. For this model, the 22 target genes and the broader transcriptome were assigned equal weight in the loss function during training. The final two models were trained with a bottleneck of either two or three units. To summarize these multivariate bottleneck outputs to a univariate score for AUC calculation, we fit generalized linear models to the binary stimulation group status as a function of the bottleneck outputs in the training data, and then applied the models to test data. To benchmark NEUROeSTIMator against alternative models for binary outcome prediction of stimulation group status, we evaluated model ability to separate stimulated from unstimulated samples. We computed the Area Under the Receiver Operating Characteristic Curve (AUC-ROC) for each model across all combinations of source dataset and sample groupings. We then determined the AUC differences between NEUROeSTIMator and the alternative models for each sample grouping. To summarize the average AUC difference within each dataset, we calculated the mean of the AUC differences for the respective sample groups. This yielded a single value representing the mean AUC difference for each source dataset in the test set. Lastly, we derived the final performance metric by computing the mean of these mean AUC differences across all data sources, offering a comprehensive evaluation of the NEUROeSTIMator’s performance relative to the alternative models.</p>
    </sec>
    <sec id="Sec27">
      <title>Animals</title>
      <p id="Par49">The spatial transcriptomic and RNAscope experiments were performed using male C57BL/6 J mice obtained from Jackson Laboratory (#000664), aged between 2 and 4 months. The mice were housed in groups of up to five individuals per cage, which contained soft bedding material. They had access to food (NIH-31 irradiated modified mouse diet #7913) and water ad libitum. A 12-h light-dark schedule was maintained, with the start of the lights-on period designated as Zeitgeber time zero (ZT 0). Animals were housed in the Animal care facility of the University of Iowa under a pathogen-free condition at the temperature of 21–22 °C and relative humidity of 60–70%. The experimental procedures followed the guidelines for animal care and use set forth by the National Institutes of Health, and they were approved by the Institutional Animal Care and Use Committee (IACUC) at the University of Iowa.</p>
    </sec>
    <sec id="Sec28">
      <title>Behavioral training for spatial transcriptomics</title>
      <p id="Par50">We generated a novel spatial transcriptomic dataset examining the effects of spatial learning in mice. The dataset contains spatial RNA-sequencing of whole brain slices from 1 h after SOR training or home cage controls (HC). 10–12 weeks old C57BL/6 J male mice were trained in SOR task as described previously<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. Briefly, mice were handled for 5 consecutive days prior to the SOR training. On the day of the training, animals were individually placed in an open field with a spatial cue and was allowed to habituate for 6 min. They were returned to their home cage and the arena was wiped clean with ethanol. The animals were again placed back into the open field with three objects at specific spatial locations. The animals were allowed to freely explore the objects in the arena for 6 min. This training with objects comprised of three trials of 6 min each. One hour after the completion of the training, mice were euthanized and whole brains were flash frozen in isopentane placed on dry ice.</p>
    </sec>
    <sec id="Sec29">
      <title>Spatial transcriptomics</title>
      <p id="Par51">Mouse brain section per mouse was cut at 10 µm thickness and mounted onto each Visium slide capture area. After H&amp;E staining, each bright-field image was taken as described in the spatial transcriptomics protocol. Tissue permeabilization was performed for 18 min, as established in the tissue optimization assay. The Visium Spatial Gene Expression Slide &amp; Reagent kit (10x Genomics) was used to generate sequencing libraries for Visium samples. Libraries were constructed according to the 10x Visium library construction protocol and sequenced by Illumina NovaSeq6000. Raw data was then processed using the 10x Genomics Space Ranger analysis pipeline. See Supplementary Fig. <xref rid="MOESM1" ref-type="media">5a</xref> for images of predicted activity for each replicate.</p>
    </sec>
    <sec id="Sec30">
      <title>In situ hybridization</title>
      <p id="Par52">In situ hybridization was performed on 20 μm coronal brain sections from SOR-trained and HC mice using RNAscope reagents (Advanced Cell Diagnostics). Briefly, fixed frozen brains were sectioned on a cryotome and mounted on Superfrost™ Plus microscope slides (Fisherbrand). Slides then underwent serial dehydration in Ethanol, followed by Hydrogen Peroxide treatment, target retrieval, and Protease III treatment—all of which were done according to the manufacturer’s protocol. Hybridization of probes was done at 40 °C for 2 h in an HybEZ oven using a 50:1:1 cocktail of <italic>Egr1</italic>, <italic>Nr4a1</italic>, and <italic>Egr3</italic> respectively. The probe signals were amplified with Pre-amplifier 1 (Amp 1-FL) and counterstained with OPAL dyes (Akoya Biosciences) corresponding to different excitation-emission wavelengths. Finally, the slides were mounted with Vectashield® Antifade Mounting Medium with DAPI (Vector Laboratories). Slides were stored in 4 °C until they were imaged.</p>
    </sec>
    <sec id="Sec31">
      <title>Confocal imaging and analysis</title>
      <p id="Par53">After performing the RNAscope assay, brain sections were imaged using Olympus FV3000 confocal microscope with a 10X NA = 0.4 objective at 800 × 800-pixel resolution. High magnification images of the hippocampus were obtained using a 40X NA = 1.30 oil immersion objective at 800 × 800-pixel resolution and 1.25 optical zoom. All images (8 bit) were acquired with identical settings for laser power, detector gain and pinhole diameter for each experiment and between experiments. Images from the different channels were stacked and projected at maximum intensity using ImageJ (NIH). Hippocampal subregion-specific Mean Fluorescence Intensity (MFI) of each RNAscope probe was evaluated using plugins in ImageJ. The average MFI for all the 3 probes corresponding to each hippocampal subregion was compared between the two experimental groups. Two-way ANOVA was used to assess significance of subregion-by-training interaction (<italic>n</italic> = 4 for each subregion/training combination). A post-hoc Sidak’s multiple comparisons test was applied to assess significance of individual subregion differences.</p>
    </sec>
    <sec id="Sec32">
      <title>Reporting summary</title>
      <p id="Par54">Further information on research design is available in the <xref rid="MOESM5" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec33">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_44503_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_44503_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_44503_MOESM3_ESM.docx">
            <caption>
              <p>Description of supplementary information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_44503_MOESM4_ESM.xlsx">
            <caption>
              <p>Supplementary Data 1–8</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_44503_MOESM5_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
    <sec id="Sec34">
      <title>Source data</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2023_44503_MOESM6_ESM.xlsx">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-44503-5.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was supported by NIH grant R01 MH 087463 to T.A., NIH grant R01 DC014489 to J.J.M., NIH grant K99 AG 068306 and the Nellie Ball Trust to S.C., and The University of Iowa Hawkeye Intellectual and Developmental Disabilities Research Center (HAWK-IDDRC) P50 HD103556 to T.A. and Lane Strathearn. T.A. and J.J.M. are also supported by the Roy J. Carver Charitable Trust. We thank the Allen Institute for Brain Sciences for their valuable datasets we used to train our model. We thank the creators and authors of DCA, whose work inspired the approach we implemented in this paper. We also thank Mahesh Shetty for his valuable contributions to discussions about this project. Figure <xref rid="Fig1" ref-type="fig">1</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref> were created using graphical elements from BioRender.com.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>E.B., S.C., T.A., and J.J.M. conceived the study. E.B. performed data curation, model training, analyses, and visualizations. S.C. and T.A. designed the molecular biology experiments with input from J.J.M. and K.P.G. S.C. performed behavioral experiments, stereotactic surgeries, and single nuclei sequencing. L.C.L. performed Visium spatial transcriptomic sequencing experiments. Y.V. and M.E. processed Visium data. J.R. and M.M. performed RNAscope experiments. U.M. performed statistical analysis and created visualization pertaining to the RNAscope data. E.B. and J.J.M. wrote the article.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par55"><italic>Nature Communications</italic> thanks Jun Ding, Chris Gaiteri and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>Spatial RNA-sequencing data, including gene expression measurements, tissue images, spot coordinates, and raw FASTQ files have been deposited in the Gene Expression Omnibus (GEO) repository under the accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE201610">GSE201610</ext-link>”. GEO datasets used in this study can be accessed under the following accession codes “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE111899">GSE111899</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE125068">GSE125068</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE55591">GSE55591</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE106678">GSE106678</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE137763">GSE137763</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE136656">GSE136656</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE102827">GSE102827</ext-link>”. Other datasets used in this study can be accessed through the Allen Institute for Brain Science: “Allen Cell Types Database [<ext-link ext-link-type="uri" xlink:href="https://portal.brain-map.org/atlases-and-data/rnaseq">https://portal.brain-map.org/atlases-and-data/rnaseq</ext-link>]”, “Mouse PatchSeq VIS [<ext-link ext-link-type="uri" xlink:href="https://knowledge.brain-map.org/data/1HEYEW7GMUKWIQW37BO/summary">https://knowledge.brain-map.org/data/1HEYEW7GMUKWIQW37BO/summary</ext-link>]”, “Human PatchSeq L2/3 [<ext-link ext-link-type="uri" xlink:href="https://knowledge.brain-map.org/data/0R94W5U07IHCMVJ4TVK/summary">https://knowledge.brain-map.org/data/0R94W5U07IHCMVJ4TVK/summary</ext-link>]”. Results used in the analyses of this publication have been deposited to Zenodo under the accession 10.5281/zenodo.10183210. <xref ref-type="sec" rid="Sec34">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>NEUROeSTIMator is available at <ext-link ext-link-type="uri" xlink:href="https://research-git.uiowa.edu/michaelson-lab-public/neuroestimator/">https://research-git.uiowa.edu/michaelson-lab-public/neuroestimator/</ext-link> as a free R package with installation instructions and a tutorial.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par56">T.A. serves on the Scientific Advisory Board of EmbarkNeuro and is a scientific advisor to Aditum Bio and Radius Health. The other authors declare no conflicting interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yap</surname>
            <given-names>EL</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>Activity-regulated transcription: bridging the gap between neural activity and behavior</article-title>
        <source>Neuron</source>
        <year>2018</year>
        <volume>100</volume>
        <fpage>330</fpage>
        <lpage>348</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2018.10.013</pub-id>
        <?supplied-pmid 30359600?>
        <pub-id pub-id-type="pmid">30359600</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cohen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>Communication between the synapse and the nucleus in neuronal development, plasticity, and disease</article-title>
        <source>Annu Rev. Cell Dev. Biol.</source>
        <year>2008</year>
        <volume>24</volume>
        <fpage>183</fpage>
        <lpage>209</lpage>
        <pub-id pub-id-type="doi">10.1146/annurev.cellbio.24.110707.175235</pub-id>
        <?supplied-pmid 18616423?>
        <pub-id pub-id-type="pmid">18616423</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <mixed-citation publication-type="other">West, A. E. &amp; Greenberg, M. E. Neuronal activity-regulated gene transcription in synapse development and cognitive function. <italic>Cold Spring Harb. Perspect Biol.</italic><bold>3</bold>, 10.1101/cshperspect.a005744 (2011).</mixed-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gallo</surname>
            <given-names>FT</given-names>
          </name>
          <name>
            <surname>Katche</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Morici</surname>
            <given-names>JF</given-names>
          </name>
          <name>
            <surname>Medina</surname>
            <given-names>JH</given-names>
          </name>
          <name>
            <surname>Weisstaub</surname>
            <given-names>NV</given-names>
          </name>
        </person-group>
        <article-title>Immediate early genes, memory and psychiatric disorders: focus on c-Fos, Egr1 and Arc</article-title>
        <source>Front Behav. Neurosci.</source>
        <year>2018</year>
        <volume>12</volume>
        <fpage>79</fpage>
        <pub-id pub-id-type="doi">10.3389/fnbeh.2018.00079</pub-id>
        <?supplied-pmid 29755331?>
        <pub-id pub-id-type="pmid">29755331</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mews</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>From circuits to chromatin: the emerging role of epigenetics in mental health</article-title>
        <source>J. Neurosci.</source>
        <year>2021</year>
        <volume>41</volume>
        <fpage>873</fpage>
        <lpage>882</lpage>
        <pub-id pub-id-type="doi">10.1523/JNEUROSCI.1649-20.2020</pub-id>
        <?supplied-pmid 33446519?>
        <pub-id pub-id-type="pmid">33446519</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nido</surname>
            <given-names>GS</given-names>
          </name>
          <name>
            <surname>Ryan</surname>
            <given-names>MM</given-names>
          </name>
          <name>
            <surname>Benuskova</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>JM</given-names>
          </name>
        </person-group>
        <article-title>Dynamical properties of gene regulatory networks involved in long-term potentiation</article-title>
        <source>Front Mol. Neurosci.</source>
        <year>2015</year>
        <volume>8</volume>
        <fpage>42</fpage>
        <pub-id pub-id-type="doi">10.3389/fnmol.2015.00042</pub-id>
        <?supplied-pmid 26300724?>
        <pub-id pub-id-type="pmid">26300724</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hudson</surname>
            <given-names>AE</given-names>
          </name>
        </person-group>
        <article-title>Genetic reporters of neuronal activity: c-Fos and G-CaMP6</article-title>
        <source>Methods Enzymol.</source>
        <year>2018</year>
        <volume>603</volume>
        <fpage>197</fpage>
        <lpage>220</lpage>
        <pub-id pub-id-type="doi">10.1016/bs.mie.2018.01.023</pub-id>
        <?supplied-pmid 29673526?>
        <pub-id pub-id-type="pmid">29673526</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kawashima</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Okuno</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Bito</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>A new era for functional labeling of neurons: activity-dependent promoters have come of age</article-title>
        <source>Front. Neural Circuits</source>
        <year>2014</year>
        <volume>8</volume>
        <fpage>37</fpage>
        <pub-id pub-id-type="doi">10.3389/fncir.2014.00037</pub-id>
        <?supplied-pmid 24795570?>
        <pub-id pub-id-type="pmid">24795570</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guenthner</surname>
            <given-names>CJ</given-names>
          </name>
          <name>
            <surname>Miyamichi</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>HH</given-names>
          </name>
          <name>
            <surname>Heller</surname>
            <given-names>HC</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Permanent genetic access to transiently active neurons via TRAP: targeted recombination in active populations</article-title>
        <source>Neuron</source>
        <year>2013</year>
        <volume>78</volume>
        <fpage>773</fpage>
        <lpage>784</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2013.03.025</pub-id>
        <?supplied-pmid 23764283?>
        <pub-id pub-id-type="pmid">23764283</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Ramirez</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Redondo</surname>
            <given-names>RL</given-names>
          </name>
          <name>
            <surname>Tonegawa</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Identification and manipulation of memory engram cells</article-title>
        <source>Cold Spring Harb. Symp. Quant. Biol.</source>
        <year>2014</year>
        <volume>79</volume>
        <fpage>59</fpage>
        <lpage>65</lpage>
        <pub-id pub-id-type="doi">10.1101/sqb.2014.79.024901</pub-id>
        <?supplied-pmid 25637263?>
        <pub-id pub-id-type="pmid">25637263</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sheng</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>The regulation and function of c-fos and other immediate early genes in the nervous system</article-title>
        <source>Neuron</source>
        <year>1990</year>
        <volume>4</volume>
        <fpage>477</fpage>
        <lpage>485</lpage>
        <pub-id pub-id-type="doi">10.1016/0896-6273(90)90106-p</pub-id>
        <?supplied-pmid 1969743?>
        <pub-id pub-id-type="pmid">1969743</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>YE</given-names>
          </name>
          <name>
            <surname>Pan</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Zuo</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Hong</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Detecting activated cell populations using single-cell RNA-Seq</article-title>
        <source>Neuron</source>
        <year>2017</year>
        <volume>96</volume>
        <fpage>313</fpage>
        <lpage>329 e316</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2017.09.026</pub-id>
        <?supplied-pmid 29024657?>
        <pub-id pub-id-type="pmid">29024657</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Dissecting cell-type composition and activity-dependent transcriptional state in mammalian brains by massively parallel single-nucleus RNA-Seq</article-title>
        <source>Mol. Cell</source>
        <year>2017</year>
        <volume>68</volume>
        <fpage>1006</fpage>
        <lpage>1015 e1007</lpage>
        <pub-id pub-id-type="doi">10.1016/j.molcel.2017.11.017</pub-id>
        <?supplied-pmid 29220646?>
        <pub-id pub-id-type="pmid">29220646</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vallejos</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Risso</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Scialdone</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Dudoit</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Normalizing single-cell RNA sequencing data: challenges and opportunities</article-title>
        <source>Nat. Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>565</fpage>
        <lpage>571</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4292</pub-id>
        <?supplied-pmid 28504683?>
        <pub-id pub-id-type="pmid">28504683</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hicks</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Townes</surname>
            <given-names>FW</given-names>
          </name>
          <name>
            <surname>Teng</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Irizarry</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <article-title>Missing data and technical variability in single-cell RNA-sequencing experiments</article-title>
        <source>Biostatistics</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>562</fpage>
        <lpage>578</lpage>
        <pub-id pub-id-type="doi">10.1093/biostatistics/kxx053</pub-id>
        <?supplied-pmid 29121214?>
        <pub-id pub-id-type="pmid">29121214</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hafemeister</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Normalization and variance stabilization of single-cell RNA-seq data using regularized negative binomial regression</article-title>
        <source>Genome Biol.</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>296</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1874-1</pub-id>
        <?supplied-pmid 31870423?>
        <pub-id pub-id-type="pmid">31870423</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lahnemann</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Eleven grand challenges in single-cell data science</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>31</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-1926-6</pub-id>
        <?supplied-pmid 32033589?>
        <pub-id pub-id-type="pmid">32033589</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yao</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A taxonomy of transcriptomic cell types across the isocortex and hippocampal formation</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3222</fpage>
        <lpage>3241.e3226</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.021</pub-id>
        <?supplied-pmid 34004146?>
        <pub-id pub-id-type="pmid">34004146</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spiegel</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Npas4 regulates excitatory-inhibitory balance within neural circuits through cell-type-specific gene programs</article-title>
        <source>Cell</source>
        <year>2014</year>
        <volume>157</volume>
        <fpage>1216</fpage>
        <lpage>1229</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2014.03.058</pub-id>
        <?supplied-pmid 24855953?>
        <pub-id pub-id-type="pmid">24855953</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fernandez-Albert</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Immediate and deferred epigenomic signatures of in vivo neuronal activation in mouse hippocampus</article-title>
        <source>Nat. Neurosci.</source>
        <year>2019</year>
        <volume>22</volume>
        <fpage>1718</fpage>
        <lpage>1730</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-019-0476-2</pub-id>
        <?supplied-pmid 31501571?>
        <pub-id pub-id-type="pmid">31501571</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tyssowski</surname>
            <given-names>KM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Different neuronal activity patterns induce different gene expression programs</article-title>
        <source>Neuron</source>
        <year>2018</year>
        <volume>98</volume>
        <fpage>530</fpage>
        <lpage>546.e511</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2018.04.001</pub-id>
        <?supplied-pmid 29681534?>
        <pub-id pub-id-type="pmid">29681534</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Sundararajan, M., Taly, A. &amp; Yan, Q. <italic>Axiomatic attribution for deep networks</italic>. arXiv:1703.01365. <ext-link ext-link-type="uri" xlink:href="https://ui.adsabs.harvard.edu/abs/2017arXiv170301365S">https://ui.adsabs.harvard.edu/abs/2017arXiv170301365S</ext-link> (2017).</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gouwens</surname>
            <given-names>NW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated morphoelectric and transcriptomic classification of cortical GABAergic cells</article-title>
        <source>Cell</source>
        <year>2020</year>
        <volume>183</volume>
        <fpage>935</fpage>
        <lpage>953.e919</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2020.09.057</pub-id>
        <?supplied-pmid 33186530?>
        <pub-id pub-id-type="pmid">33186530</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573</fpage>
        <lpage>3587.e3529</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id>
        <?supplied-pmid 34062119?>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Thomas</surname>
            <given-names>GM</given-names>
          </name>
          <name>
            <surname>Huganir</surname>
            <given-names>RL</given-names>
          </name>
        </person-group>
        <article-title>MAPK cascade signalling and synaptic plasticity</article-title>
        <source>Nat. Rev. Neurosci.</source>
        <year>2004</year>
        <volume>5</volume>
        <fpage>173</fpage>
        <lpage>183</lpage>
        <pub-id pub-id-type="doi">10.1038/nrn1346</pub-id>
        <?supplied-pmid 14976517?>
        <pub-id pub-id-type="pmid">14976517</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rosen</surname>
            <given-names>LB</given-names>
          </name>
          <name>
            <surname>Ginty</surname>
            <given-names>DD</given-names>
          </name>
          <name>
            <surname>Weber</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>Membrane depolarization and calcium influx stimulate MEK and MAP kinase via activation of Ras</article-title>
        <source>Neuron</source>
        <year>1994</year>
        <volume>12</volume>
        <fpage>1207</fpage>
        <lpage>1221</lpage>
        <pub-id pub-id-type="doi">10.1016/0896-6273(94)90438-3</pub-id>
        <?supplied-pmid 8011335?>
        <pub-id pub-id-type="pmid">8011335</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baraban</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Taylor</surname>
            <given-names>MR</given-names>
          </name>
          <name>
            <surname>Castro</surname>
            <given-names>PA</given-names>
          </name>
          <name>
            <surname>Baier</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Pentylenetetrazole induced changes in zebrafish behavior, neural activity and c-fos expression</article-title>
        <source>Neuroscience</source>
        <year>2005</year>
        <volume>131</volume>
        <fpage>759</fpage>
        <lpage>768</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuroscience.2004.11.031</pub-id>
        <?supplied-pmid 15730879?>
        <pub-id pub-id-type="pmid">15730879</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dhir</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Pentylenetetrazol (PTZ) kindling model of epilepsy</article-title>
        <source>Curr. Protoc. Neurosci. 9</source>
        <year>2012</year>
        <volume>Unit9</volume>
        <fpage>37</fpage>
        <pub-id pub-id-type="doi">10.1002/0471142301.ns0937s58</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Savell</surname>
            <given-names>KE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A dopamine-induced gene expression signature regulates neuronal function and cocaine response</article-title>
        <source>Sci. Adv.</source>
        <year>2020</year>
        <volume>6</volume>
        <fpage>eaba4221</fpage>
        <pub-id pub-id-type="doi">10.1126/sciadv.aba4221</pub-id>
        <?supplied-pmid 32637607?>
        <pub-id pub-id-type="pmid">32637607</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luo</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Volkow</surname>
            <given-names>ND</given-names>
          </name>
          <name>
            <surname>Heintz</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Pan</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Du</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Acute cocaine induces fast activation of D1 receptor and progressive deactivation of D2 receptor striatal neurons: in vivo optical microprobe [Ca2+]i imaging</article-title>
        <source>J. Neurosci.</source>
        <year>2011</year>
        <volume>31</volume>
        <fpage>13180</fpage>
        <lpage>13190</lpage>
        <pub-id pub-id-type="doi">10.1523/JNEUROSCI.2369-11.2011</pub-id>
        <?supplied-pmid 21917801?>
        <pub-id pub-id-type="pmid">21917801</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Boulting</surname>
            <given-names>GL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Activity-dependent regulome of human GABAergic neurons reveals new patterns of gene regulation and neurological disease heritability</article-title>
        <source>Nat. Neurosci.</source>
        <year>2021</year>
        <volume>24</volume>
        <fpage>437</fpage>
        <lpage>448</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-020-00786-1</pub-id>
        <?supplied-pmid 33542524?>
        <pub-id pub-id-type="pmid">33542524</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rienecker</surname>
            <given-names>KDA</given-names>
          </name>
          <name>
            <surname>Poston</surname>
            <given-names>RG</given-names>
          </name>
          <name>
            <surname>Saha</surname>
            <given-names>RN</given-names>
          </name>
        </person-group>
        <article-title>Merits and limitations of studying neuronal depolarization-dependent processes using elevated external potassium</article-title>
        <source>ASN Neuro</source>
        <year>2020</year>
        <volume>12</volume>
        <fpage>1759091420974807</fpage>
        <pub-id pub-id-type="doi">10.1177/1759091420974807</pub-id>
        <?supplied-pmid 33256465?>
        <pub-id pub-id-type="pmid">33256465</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rienecker</surname>
            <given-names>KDA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mild membrane depolarization in neurons induces immediate early gene transcription and acutely subdues responses to a successive stimulus</article-title>
        <source>J. Biol. Chem.</source>
        <year>2022</year>
        <volume>298</volume>
        <fpage>102278</fpage>
        <pub-id pub-id-type="doi">10.1016/j.jbc.2022.102278</pub-id>
        <?supplied-pmid 35863435?>
        <pub-id pub-id-type="pmid">35863435</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hrvatin</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell analysis of experience-dependent transcriptomic states in the mouse visual cortex</article-title>
        <source>Nat. Neurosci.</source>
        <year>2018</year>
        <volume>21</volume>
        <fpage>120</fpage>
        <lpage>129</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-017-0029-5</pub-id>
        <?supplied-pmid 29230054?>
        <pub-id pub-id-type="pmid">29230054</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chatterjee</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Endoplasmic reticulum chaperone genes encode effectors of long-term memory</article-title>
        <source>Sci. Adv.</source>
        <year>2022</year>
        <volume>8</volume>
        <fpage>eabm6063</fpage>
        <pub-id pub-id-type="doi">10.1126/sciadv.abm6063</pub-id>
        <?supplied-pmid 35319980?>
        <pub-id pub-id-type="pmid">35319980</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>RNAscope: a novel in situ RNA analysis platform for formalin-fixed, paraffin-embedded tissues</article-title>
        <source>J. Mol. Diagn.</source>
        <year>2012</year>
        <volume>14</volume>
        <fpage>22</fpage>
        <lpage>29</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jmoldx.2011.08.002</pub-id>
        <?supplied-pmid 22166544?>
        <pub-id pub-id-type="pmid">22166544</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kalmbach</surname>
            <given-names>BE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Signature morpho-electric, transcriptomic, and dendritic properties of human layer 5 neocortical pyramidal neurons</article-title>
        <source>Neuron</source>
        <year>2021</year>
        <volume>109</volume>
        <fpage>2914</fpage>
        <lpage>2927.e2915</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2021.08.030</pub-id>
        <?supplied-pmid 34534454?>
        <pub-id pub-id-type="pmid">34534454</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hrvatin</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Publisher Correction: Single-cell analysis of experience-dependent transcriptomic states in the mouse visual cortex</article-title>
        <source>Nat. Neurosci.</source>
        <year>2018</year>
        <volume>21</volume>
        <fpage>1017</fpage>
        <pub-id pub-id-type="doi">10.1038/s41593-018-0112-6</pub-id>
        <?supplied-pmid 29752482?>
        <pub-id pub-id-type="pmid">29752482</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Durinck</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>BioMart and Bioconductor: a powerful link between biological databases and microarray data analysis</article-title>
        <source>Bioinformatics</source>
        <year>2005</year>
        <volume>21</volume>
        <fpage>3439</fpage>
        <lpage>3440</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bti525</pub-id>
        <?supplied-pmid 16082012?>
        <pub-id pub-id-type="pmid">16082012</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Durinck</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Spellman</surname>
            <given-names>PT</given-names>
          </name>
          <name>
            <surname>Birney</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Huber</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Mapping identifiers for the integration of genomic datasets with the R/Bioconductor package biomaRt</article-title>
        <source>Nat. Protoc.</source>
        <year>2009</year>
        <volume>4</volume>
        <fpage>1184</fpage>
        <lpage>1191</lpage>
        <pub-id pub-id-type="doi">10.1038/nprot.2009.97</pub-id>
        <?supplied-pmid 19617889?>
        <pub-id pub-id-type="pmid">19617889</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zerbino</surname>
            <given-names>DR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ensembl 2018</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2018</year>
        <volume>46</volume>
        <fpage>D754</fpage>
        <lpage>D761</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkx1098</pub-id>
        <?supplied-pmid 29155950?>
        <pub-id pub-id-type="pmid">29155950</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Plaisier</surname>
            <given-names>SB</given-names>
          </name>
          <name>
            <surname>Taschereau</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wong</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Graeber</surname>
            <given-names>TG</given-names>
          </name>
        </person-group>
        <article-title>Rank-rank hypergeometric overlap: identification of statistically significant overlap between gene-expression signatures</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2010</year>
        <volume>38</volume>
        <fpage>e169</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkq636</pub-id>
        <?supplied-pmid 20660011?>
        <pub-id pub-id-type="pmid">20660011</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Campbell</surname>
            <given-names>KR</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>AT</given-names>
          </name>
          <name>
            <surname>Wills</surname>
            <given-names>QF</given-names>
          </name>
        </person-group>
        <article-title>Scater: pre-processing, quality control, normalization and visualization of single-cell RNA-seq data in R</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <fpage>1179</fpage>
        <lpage>1186</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw777</pub-id>
        <?supplied-pmid 28088763?>
        <pub-id pub-id-type="pmid">28088763</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eraslan</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Simon</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Mircea</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Mueller</surname>
            <given-names>NS</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA-seq denoising using a deep count autoencoder</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>390</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-018-07931-2</pub-id>
        <?supplied-pmid 30674886?>
        <pub-id pub-id-type="pmid">30674886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <mixed-citation publication-type="other">Abadi, M. et al. TensorFlow: A system for large-scale machine learning. <italic>Proceedings of Osdi'16: 12th Usenix Symposium on Operating Systems Design and Implementation</italic>, 265–283 (2016).</mixed-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Choudhary</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Comparison and evaluation of statistical error models for scRNA-seq</article-title>
        <source>Genome Biol.</source>
        <year>2022</year>
        <volume>23</volume>
        <fpage>27</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-021-02584-9</pub-id>
        <?supplied-pmid 35042561?>
        <pub-id pub-id-type="pmid">35042561</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van Dijk</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Recovering gene interactions from single-cell data using data diffusion</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>716</fpage>
        <lpage>729.e727</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.05.061</pub-id>
        <?supplied-pmid 29961576?>
        <pub-id pub-id-type="pmid">29961576</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10817898</article-id>
    <article-id pub-id-type="publisher-id">44503</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-44503-5</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Using deep learning to quantify neuronal activation from single-cell and spatial transcriptomic data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Bahl</surname>
          <given-names>Ethan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-4873-9416</contrib-id>
        <name>
          <surname>Chatterjee</surname>
          <given-names>Snehajyoti</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-4849-9475</contrib-id>
        <name>
          <surname>Mukherjee</surname>
          <given-names>Utsav</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1019-3905</contrib-id>
        <name>
          <surname>Elsadany</surname>
          <given-names>Muhammad</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7522-3191</contrib-id>
        <name>
          <surname>Vanrobaeys</surname>
          <given-names>Yann</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lin</surname>
          <given-names>Li-Chun</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-0481-324X</contrib-id>
        <name>
          <surname>McDonough</surname>
          <given-names>Miriam</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Resch</surname>
          <given-names>Jon</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-4503-7344</contrib-id>
        <name>
          <surname>Giese</surname>
          <given-names>K. Peter</given-names>
        </name>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2423-4592</contrib-id>
        <name>
          <surname>Abel</surname>
          <given-names>Ted</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9713-0992</contrib-id>
        <name>
          <surname>Michaelson</surname>
          <given-names>Jacob J.</given-names>
        </name>
        <address>
          <email>jacob-michaelson@uiowa.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff8">8</xref>
        <xref ref-type="aff" rid="Aff9">9</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Department of Psychiatry, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Interdisciplinary Graduate Program in Genetics, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Iowa Neuroscience Institute, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Department of Neuroscience &amp; Pharmacology, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Interdisciplinary Graduate Program in Neuroscience, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Interdisciplinary Graduate Program in Molecular Medicine, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/0220mzb33</institution-id><institution-id institution-id-type="GRID">grid.13097.3c</institution-id><institution-id institution-id-type="ISNI">0000 0001 2322 6764</institution-id><institution>Department of Basic and Clinical Neuroscience, </institution><institution>King’s College London, </institution></institution-wrap>London, UK </aff>
      <aff id="Aff8"><label>8</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Department of Biomedical Engineering, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
      <aff id="Aff9"><label>9</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/036jqmy94</institution-id><institution-id institution-id-type="GRID">grid.214572.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 8294</institution-id><institution>Department of Communication Sciences &amp; Disorders, </institution><institution>University of Iowa, </institution></institution-wrap>Iowa City, IA USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>26</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>26</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2024</year>
    </pub-date>
    <volume>15</volume>
    <elocation-id>779</elocation-id>
    <history>
      <date date-type="received">
        <day>23</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>15</day>
        <month>12</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© This is a U.S. Government work and not under copyright protection in the US; foreign copyright protection may apply 2024</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Neuronal activity-dependent transcription directs molecular processes that regulate synaptic plasticity, brain circuit development, behavioral adaptation, and long-term memory. Single cell RNA-sequencing technologies (scRNAseq) are rapidly developing and allow for the interrogation of activity-dependent transcription at cellular resolution. Here, we present NEUROeSTIMator, a deep learning model that integrates transcriptomic signals to estimate neuronal activation in a way that we demonstrate is associated with Patch-seq electrophysiological features and that is robust against differences in species, cell type, and brain region. We demonstrate this method’s ability to accurately detect neuronal activity in previously published studies of single cell activity-induced gene expression. Further, we applied our model in a spatial transcriptomic study to identify unique patterns of learning-induced activity across different brain regions in male mice. Altogether, our findings establish NEUROeSTIMator as a powerful and broadly applicable tool for measuring neuronal activation, whether as a critical covariate or a primary readout of interest.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Neuronal activity is associated with transcriptional changes. Here, the authors present a deep learning model that integrates single cell transcriptomic signals to estimate neuronal activation.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Learning and memory</kwd>
      <kwd>Synaptic plasticity</kwd>
      <kwd>Transcriptomics</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000025</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Institute of Mental Health (NIMH)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01 MH 087463</award-id>
        <principal-award-recipient>
          <name>
            <surname>Michaelson</surname>
            <given-names>Jacob J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000055</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Institute on Deafness and Other Communication Disorders (NIDCD)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01 DC 014489</award-id>
        <principal-award-recipient>
          <name>
            <surname>Michaelson</surname>
            <given-names>Jacob J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000002</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>K99 AG 068306</award-id>
        <principal-award-recipient>
          <name>
            <surname>Michaelson</surname>
            <given-names>Jacob J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100009633</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | Eunice Kennedy Shriver National Institute of Child Health and Human Development (NICHD)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>P50 HD 103556</award-id>
        <principal-award-recipient>
          <name>
            <surname>Michaelson</surname>
            <given-names>Jacob J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2024</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Transcriptional regulation is a key component in the downstream response to neuronal stimulation, and the dysregulation of this activity-dependent gene expression has been linked to several nervous system disorders<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR6">6</xref></sup>. Although several techniques exist to identify active neurons with transgenic single-gene reporter systems<sup><xref ref-type="bibr" rid="CR7">7</xref>–<xref ref-type="bibr" rid="CR10">10</xref></sup>, there is currently no method available to estimate neuronal activity from transcriptome-wide signal in gene expression data. Estimating neuronal activation based on gene expression data is vital for unraveling the intricate processes governing neuronal function and dysfunction, and decades of research has been devoted to characterizing these processes<sup><xref ref-type="bibr" rid="CR1">1</xref>,<xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR11">11</xref></sup>. Accurate estimation of activation could provide insights into neural circuitry, advance our understanding of neurological disorders, and ultimately contribute to the development of targeted therapeutic interventions. With advances in single-cell RNA-sequencing (scRNAseq) technologies, researchers can now study activity-dependent transcription at the individual neuron level<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR13">13</xref></sup>. However, scRNAseq has persistent limitations such as sparsity and stochasticity in gene expression measurements, which challenge our ability to use these tools to understand neuronal activation<sup><xref ref-type="bibr" rid="CR14">14</xref>–<xref ref-type="bibr" rid="CR17">17</xref></sup>.</p>
    <p id="Par4">To address these challenges, we present an innovative tool that estimates neuronal activation using transcriptome-scale data as input. Using a comprehensive multi-species gene expression dataset, our deep learning model employs a single unit bottleneck to derive interpretable neuronal activity scores and an auxiliary input to the decoder to counteract dataset-specific biases. This novel approach, which distills the whole transcriptome into a single integrative activity score, challenges the single-gene paradigm (e.g., <italic>Fos</italic>) for measuring activity at the single cell and bulk tissue level.</p>
    <p id="Par5">Distilling transcriptome-scale signatures into a one-dimensional information bottleneck, our approach reconstructs the expression profiles of 22 well-established neuronal activity markers. We show that the resulting activity score is significantly associated with electrophysiological features of increased excitability, demonstrating its applicability in classifying neurons along this essential characteristic. We further show its application in secondary analyses of several single-cell data sets, as well as in new spatial transcriptomic data that captures learning-related circuit activation in the murine brain.</p>
    <p id="Par6">To facilitate community usage, we developed NEUROeSTIMator, an R package with a tutorial that demonstrates our model’s application to single-cell data. This innovative method offers a powerful solution to estimate neuronal activation based on de-noised latent patterns in single-cell gene expression, outperforming alternative approaches and providing significant associations with electrophysiological features at the single-cell level.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Multi-species training, test, and validation data sets</title>
      <p id="Par7">We developed a neural network to quantify signatures of transcriptional activation by training an autoencoder to reconstruct expression of 22 coexpressed activity-dependent genes from a 1-dimensional latent space (Fig. <xref rid="Fig1" ref-type="fig">1</xref>). We trained, validated, and tested the model using publicly available datasets, including single cell datasets from the Allen Institute of Brain Science<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> (AIBS) totaling over one million combined samples, as well as GEO datasets and a novel spatial transcriptomics dataset (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>). Activity-dependent genes were identified by intersecting differential expression results of three studies of experimental manipulation of neuron activity<sup><xref ref-type="bibr" rid="CR19">19</xref>–<xref ref-type="bibr" rid="CR21">21</xref></sup>. All three differential expression studies examined different brain regions, used different methods of neuronal stimulation, and were published from independent groups. Intersecting these three lists yielded a list of 29 candidate target genes (i.e., genes to be reconstructed in autoencoder output) Principal component analysis of the candidate genes revealed a relatively low dimensionality of expression profiles, with PC1 explaining a majority of the variance (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1a</xref>). Using the Allen datasets, we then performed bootstrap permutations of principal component analysis on candidate target genes and found a subset of 22 genes robustly exhibiting greater PC1 loadings than expected under a null PCA with randomly shuffled data (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1b</xref>). These 22 genes were selected as the final set of target genes to be reconstructed by the autoencoder during training. The Allen Cell Type Databases were downsampled with hierarchical weighting to increase balance of cell types, datasets, technical variation, and biological variation (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2a, b</xref>). Five hundred thousand neurons were selected and partitioned into cell type-balanced training and testing sets, and the training set was further split into 5 folds for cross validation. We trained the neural network to predict expression of the 22 activity-dependent target genes through a 1-dimensional hidden bottleneck layer with sigmoidal activation (see methods for a detailed description of model architecture and training). To evaluate model performance, we applied it to a diverse test set of 164,658 neurons held out from the training process, including 86,650 samples from the Allen and 78,108 samples from additional labeled datasets. We selected our final model based on classification accuracy of labeled test set data through cross validation.<fig id="Fig1"><label>Fig. 1</label><caption><title>Schematic Overview of NEUROeSTIMator.</title><p>The graphical abstract illustrates the application of NEUROeSTIMator, a deep learning model, to estimate neuronal activity. Transcriptome-wide gene expression data from individual neurons is input to an autoencoder, which reconstructs expression of immediate early genes from a single unit latent space called the ‘activity score’. The activity score can be applied to gene expression data, including single cell RNA-sequencing, Patch-seq, or spatial transcriptomics studies for detecting transcriptomic signatures of activity.</p></caption><graphic xlink:href="41467_2023_44503_Fig1_HTML" id="d32e434"/></fig></p>
      <p id="Par8">For further analyses, model output at the bottleneck activation layer was extracted to index activity level for each neuron passed through the model. Hereafter, we refer to this output as the predicted activity or activity score.</p>
    </sec>
    <sec id="Sec4">
      <title>Genes informing model predictions</title>
      <p id="Par9">To identify genes whose expression levels influence model predictions, we calculated integrated gradients<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> for all input genes with respect to predicted activity using data from the held out test set. Integrated gradients attribute model predictions to input features for each cell. We first compared the attributions of target and non-target genes on predicted activity. The most influential genes were <italic>Fos, Egr1</italic>, <italic>Fosl2, Junb, Fbxo33</italic>, and <italic>Nr4a1</italic>. We further explored gene importance for all non-target input genes and found varying degrees of influence throughout the transcriptome (Supplementary Data <xref rid="MOESM4" ref-type="media">2</xref>). The most influential non-target genes, such as <italic>Fosb</italic>, <italic>Npas4</italic>, <italic>Egr2</italic>, and <italic>Ntrk2</italic> tended to have higher initial support for consideration as a target gene and were more often differentially expressed in multiple transcriptomic studies of neuronal activity-dependent transcription (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a</xref>). Other known activity response genes such as <italic>Homer1, Egr4, Dusp6</italic>, and <italic>Bdnf</italic> were also among the top fifty genes with the highest feature attribution. To evaluate whether influential genes were enriched for specific annotated biological mechanisms, we performed gene set enrichment analysis on gene ontology and pathway annotation sets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3b</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">3</xref>). Among the most highly enriched gene sets were DNA binding transcription factor activator activity (<italic>p</italic><sub>adjusted</sub> = 3.97 × 10<sup>−9</sup>, NES = 2.29), signaling by NTRKs (<italic>p</italic><sub>adjusted</sub> = 2.07 × 10<sup>−8</sup>, NES = 2.40), cognition (<italic>p</italic><sub>adjusted</sub> = 5.35 × 10<sup>−3</sup>, NES = 2.01), MAPK signaling pathway (<italic>p</italic><sub>adjusted</sub> = 2.02 × 10<sup>−4</sup>, NES = 2.01), circadian rhythm (<italic>p</italic><sub>adjusted</sub> = 1.60 × 10<sup>−3</sup>, NES = 2.03), and cellular response to extracellular stimulus (<italic>p</italic><sub>adjusted</sub> = 0.033, NES = 1.89). To identify gene sets with higher attribution in non-target genes, we removed target genes, repeated the analysis, and identified gene sets that remained, or became significant. Of the 45 pathways significantly enriched when examining all genes, seven sets remained significant when excluding target genes, and seven new sets became significant, including positive regulation of neurogenesis (<italic>p</italic><sub>adjusted</sub> = 0.019, NES = 1.48), regulation of synapse structure or activity (<italic>p</italic><sub>adjusted</sub> = 0.018, NES = 1.49), and PI3/AKT signaling (<italic>p</italic><sub>adjusted</sub> = 0.019, NES = 1.37) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3b</xref>).</p>
    </sec>
    <sec id="Sec5">
      <title>Electrophysiological features of individual neurons predicted by transcription via NEUROeSTIMator</title>
      <p id="Par10">As an initial application of our model, we examined neurons subjected to direct electrical stimulation. We integrated single cell RNA assays of a Patch-seq dataset<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> with a SMART-seq dataset<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> of mouse GABAergic neurons, both generated by the Allen Institute for Brain Science (AIBS) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a</xref>). Using the standard Seurat workflow<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>, we identified seven clusters corresponding to AIBS-defined neuron types including Sst, Sst Chodl, Pvalb, Vip, Lamp5, Sncg, and Meis2 neuron clusters. We applied NEUROeSTIMator to both datasets and observed elevated activity score predictions in the Patch-seq dataset relative to the SMART-seq dataset for seven neuron types (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). We obtained empirical p-value estimates of the Kolmogorov–Smirnov (KS) test by permuting expression values in each cell and recalculating activity score for one thousand permutations. Six of the seven neuron types showed significant differences in activity score distributions between datasets (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>), of which Lamp5 neurons showed the greatest difference (<italic>p</italic> &lt; 0.001, D = 0.79, KS test) and Vip neurons showing the smallest difference (<italic>p</italic> = 0.033, D = 0.41, KS test). We also noted that several immediate early genes, which serve as predictive targets for NEUROeSTIMator, were among the top genes with higher mean expression in the Patch-seq dataset compared to the SMART-seq dataset (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b</xref>). Together, these results suggest that the Patch-seq protocol induces significantly greater transcriptional upregulation of activity-dependent genes as compared to the standard SMART-seq protocol, and our model is sensitive to these differences. Notably, this effect is consistent for nearly all neuronal types tested.<fig id="Fig2"><label>Fig. 2</label><caption><title>Electrophysiological features of neuronal stimulation captured by transcriptome-based activity score.</title><p><bold>a</bold> Activity score distributions compared between stimulated Patch-seq neurons (gold) and unstimulated SMART-seq neurons (violet). The number of cells in each comparison are given as text annotations for each density plot. <bold>b</bold> Observed D statistics (red line) and empirical distribution from Kolmogorov–Smirnov tests (two-sided) between activity score distributions of Patch-seq and SMART-seq datasets, using permutations of shuffled expression values (<italic>n</italic> = 1000 permutations per cell type) from all cells represented in <bold>a</bold>. Boxplots depict median value, box bounds denote interquartile range (IQR), whiskers denote values within ±1.5 x IQR, and points outside of whisker range denote outliers with values ≥1.5 x IQR. <bold>c</bold> Associations between electrophysiological (e-phys) features and predicted activity (<italic>n</italic> = 1277 cells). Heatmap shows feature value columns ordered by the mean bootstrap coefficient, and individual neuron rows ordered by ephys-based lasso model prediction of NEUROeSTIMator output (top). Predicted and observed NEUROeSTIMator output shown to the right. Colors represent z-scaled values, with red colors indicating higher values and blue indicating lower values. The dot plot (bottom) shows a summary of coefficients estimated by fitting lasso-regularized linear models between electrophysiology feature value and NEUROeSTIMator output (<italic>n</italic> = 10,000 bootstrap permutations per feature). Dots represent the mean coefficient estimate across bootstraps, lines indicate standard error across bootstraps. <italic>P</italic>-values were estimated by counting the number of bootstrap permutations where the coefficient was zero or the opposite sign of coefficients observed from the lasso model fit to all data. Significant features with standard errors that do not cross zero (<italic>p</italic> &lt; 0.05, unadjusted) are depicted by green-colored dots (bottom). See source data for full statistics and feature descriptions. <bold>d</bold> Spike train comparison of two Vip<italic>/</italic>Ptprt<italic>/</italic>Pkp2 neurons exhibiting representative electrophysiological features of high (red) and low (blue) NEUROeSTIMator predictions (ramp current injected - top panel, membrane potential - bottom panel). <bold>e</bold> Patch-seq validation of the positive association between input resistance and NEUROeSTIMator predictions in a novel set of human excitatory neurons (<italic>n</italic> = 25 cells). Pearson’s correlation test (two-sided) statistics annotated; linear fit (orange line). Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_44503_Fig2_HTML" id="d32e624"/></fig></p>
      <p id="Par11">We established that our model detects transcriptomic signals that separate the electrically stimulated Patch-seq dataset from the unstimulated SMART-seq dataset. However, it is not clear whether elevated activity was due to electrical stimulation and neuron depolarization, or general features of the Patch-seq protocol. Patch-seq neurons showed variability in predicted activity and, because all neurons underwent the stimulation protocol, we hypothesized that variability in activity score predictions were linked to individual neuron differences in electrophysiological features, either intrinsic properties, or responses to stimulation.</p>
      <p id="Par12">To determine if NEUROeSTIMator predictions of activity could be explained by electrophysiology, we fit a lasso-regularized generalized linear model with 10-fold cross validation to predict NEUROeSTIMator output using only electrophysiological features derived from Patch-seq recordings. We used 41 electrophysiological features, including features measured at baseline and in response to the current ramp stimulus. As substantial differences in electrophysiology exist between neuron types, we residualized activity score and derived features for neuron type in order to force the model to learn cell type-agnostic combinations of features that explain variability in activity score. For further analyses, we focus on the four most abundant neuron types: Lamp5, Pvalb, Sst, and Vip neurons. A PCA on these 41 features revealed 90% of variance is explained by fifteen principal components, three of which were associated with activity score (<italic>p</italic> &lt; 0.05) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4c</xref>). The cross-validated lasso model predictions were significantly correlated with NEUROeSTIMator output (R = 0.234, <italic>p</italic> &lt; 2.2 × 10<sup>−16</sup>). To evaluate feature importance for each electrophysiological feature, we obtained bootstrap coefficient estimates and standard errors by permuting sample weights for each of 10,000 model fits (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). Three features showed robust non-zero coefficients; membrane time constant (tau) (coefficient = −0.154, standard error = 0.037), input resistance (coefficient: 0.088, standard error = 0.041), and the threshold current to depolarization (coefficient = −0.080, standard error = 0.038). The combination of these features and their direction of effect suggest that the most stimulus-responsive neurons, those which exhibit a transcriptional response, are more excitable than other neurons of the same type (Fig. <xref rid="Fig2" ref-type="fig">2d</xref>). We then examined specifically the relationship between input resistance and NEUROeSTIMator predictions in an independent Patch-seq dataset of human excitatory neurons and, again, found a significant positive correlation (<italic>r</italic> = 0.497, <italic>p</italic> = 0.011) (Fig. <xref rid="Fig2" ref-type="fig">2e</xref>). Despite the fundamental differences between Patch-seq datasets in species and major neuron class, this successful validation emphasizes the robustness of the relationship between neuronal excitability and transcriptional response to stimulation, as revealed through NEUROeSTIMator predictions.</p>
      <p id="Par13">To better understand how NEUROeSTIMator connects gene expression to electrophysiology, we performed generalized canonical correlation analysis using three input matrices: the gene expression matrix, a matrix containing the three significant electrophysiology features, and a one column matrix containing the NEUROeSTIMator output. We computed a single component and examined gene expression loadings to understand genes explaining covariance of both predicted activity and the electrophysiological features of excitability. We used GSEA to identify gene sets enriched for the genes correlated to both predicted activity and excitability (Supplementary Data <xref rid="MOESM4" ref-type="media">4</xref>). We found significant enrichment of several gene sets including DNA binding transcription activator activity (<italic>p</italic><sub>adjusted</sub> = 2.74 × 10<sup>−5</sup>, NES = 1.91), MAPK signaling (<italic>p</italic><sub>adjusted</sub> = 2.54 × 10<sup>−4</sup>, NES = 1.78), and RAS signaling (<italic>p</italic><sub>adjusted</sub> = 3.80 × 10<sup>−2</sup>, NES = 1.48) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4d</xref>). Genes common to these pathways with high loadings included <italic>Dusp6</italic>, <italic>Dusp10</italic>, <italic>Map3k4</italic>, <italic>Ntrk2</italic>, <italic>Rasgrp1</italic>, and <italic>Prkca</italic>. These pathways constitute an established molecular signaling cascade that functions to link neuron depolarization and related calcium influx to transcriptional response<sup><xref ref-type="bibr" rid="CR25">25</xref>,<xref ref-type="bibr" rid="CR26">26</xref></sup>.</p>
      <p id="Par14">Taken together, these results demonstrate that NEUROeSTIMator captures transcriptomic signatures of activity that are associated with electrophysiological properties measured in response to electrical stimulation of individual neurons. Building upon this successful application in electrophysiology, we next extended our analyses to demonstrate NEUROeSTIMator’s utility across a range of applications (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>Detecting pharmacological activation of neurons</title>
      <p id="Par15">We applied our model to three single-cell datasets containing neurons from rodents and human cell lines treated with powerful stimulating, pharmacological agents. From the first dataset, we computed activity score for neurons of mice treated with either saline or pentylenetetrazol (PTZ), a depolarizing agent used to model status epilepticus and induce seizures<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR28">28</xref></sup>. As expected, we observed significant differences in distributions of predicted activity (KS test) for 11/14 neuronal subclasses tested, including excitatory cortical layer 2/3 (L2/3) neurons, Lamp5 interneurons, and Sst interneurons (L2/3 IT CTX: D = 0.40, <italic>p</italic> = 9.67 × 10<sup>−24</sup>), (L2/3 IT ENT: D = 0.5, <italic>p</italic> = 4.64 × 10<sup>−28</sup>), (Lamp5: D = 0.49, <italic>p</italic> = 1.73 × 10<sup>−4</sup>), (Sst: D = 0.42, <italic>p</italic> = 3.81 × 10<sup>−6</sup>) (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">5</xref>).<fig id="Fig3"><label>Fig. 3</label><caption><title>Multi-species generalization of neuronal activity score applied to previously published chemical induction studies.</title><p>Predicted activity for various neuron types responding to treatment with potent chemical modulators of neuron activity. <bold>a</bold> Response to PTZ-induced seizure (red) and controls (white) in mouse cortical neurons. <bold>b</bold> Cocaine treatment (red) or controls (white) in rat nucleus accumbens neurons. <bold>c</bold> Time series of predicted activity for human iPSCs treated with depolarizing potassium chloride at 0 h (control), 1 h, 2 h, and 4 h. Annotated statistics from Kolmogorov–Smirnov tests (one-sided) are provided in Supplementary Data <xref rid="MOESM4" ref-type="media">5</xref>. Boxplots depict median value, box bounds denote interquartile range (IQR), whiskers denote values within ±1.5 x IQR, and points outside of whisker range denote outliers with values ≥1.5 x IQR. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_44503_Fig3_HTML" id="d32e776"/></fig></p>
      <p id="Par16">Next, we compared activity score between neurons from the nucleus accumbens (NAc) of rats treated with either saline or cocaine, a stimulant acting on dopaminergic neurotransmission<sup><xref ref-type="bibr" rid="CR29">29</xref>,<xref ref-type="bibr" rid="CR30">30</xref></sup>. We found neuron subtype-specific increases in activity score. Two subclasses of dopaminergic medium spiny neurons (MSNs) and both Pvalb interneurons exhibited significant differences in predicted activity (Drd1-MSN: D = 0.15, <italic>p</italic> = 5.92 × 10<sup>−7</sup>), (Drd3-MSN: D = 0.19, <italic>p</italic> = 0.049), (Pvalb: D = 0.22, <italic>p</italic> = 0.028 (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">5</xref>). Because our model was not trained using any rat or dopaminergic neurons, these findings provide further endorsement for robust estimation of neuronal activity induced by potent pharmacological agents of stimulation.</p>
      <p id="Par17">To further evaluate whether our model could be successfully applied to human data, we examined a dataset of human induced pluripotent stem cell-derived neurons<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. Neuron cultures were either unstimulated or treated with KCl depolarization<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> buffer for 1, 2, or 4 h. Our model predicted low neuronal activity for the unstimulated group, which was consistent among cell types and biological replicates. Cells treated with KCl for 1 h demonstrated substantial and significant increases in predicted activity. Although significant shifts in predicted activity were observed for all cell types (<italic>p</italic> &lt; 0.05), the activity score of post-mitotic neurons displayed a stronger response to KCl compared to mitotic progenitors. The most responsive neuron types were the mature striatal neurons and pallial neurons (striatal: D<sub>1hr</sub> = 0.69, D<sub>2hr</sub> = 0.58, D<sub>4hr</sub> = 0.50, <italic>p</italic><sub>1hr/2hr/4hr</sub> &lt; 2.22 × 10<sup>−16</sup>), (pallial: D<sub>1hr</sub> = 0.75, D<sub>2hr</sub> = 0.67, D<sub>4hr</sub> = 0.64, <italic>p</italic><sub>1hr/2hr/4hr</sub> &lt; 2.22×10<sup>−16</sup>) (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">5</xref>). Notably, all cell clusters except neural progenitors and septal neurons followed a similar temporal pattern of predicted activity modestly declining at 2 h relative to peak activity at 1 h, with a further decline at 4 h (i.e., D<sub>1hr</sub> &gt; D<sub>2hr</sub> &gt; D<sub>4h</sub>). Despite the steady decline in predicted activity after 1 h, none of the neuron clusters completely returned to basal activity by 4 h, the final time point in the experiment. The temporal trends of predicted activity are indicative of synaptic depression<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>, suggesting NEUROeSTIMator is sensitive to detecting short term plasticity mechanisms.</p>
      <p id="Par18">Together, these analyses suggest our model can robustly assign higher estimates of activity to cells subjected to chemical exposures that are expected to elicit strong and generally ubiquitous transcriptional responses to stimulation.</p>
    </sec>
    <sec id="Sec7">
      <title>Activity score as a generalizable classifier of neuronal stimulation</title>
      <p id="Par19">Next, we asked if our model could detect neuronal activation by more subtle forms of stimuli, such as sensory experience. We applied our model to a dataset containing visual cortex neurons from mice housed in darkness for seven days prior to light exposure for 0, 1, or 4 h<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). We observed a significant increase in predicted activity for neurons from mice exposed to light, relative to controls. To elucidate temporal patterns of activity, we tested differences in activity score distributions between pairs of each time point. Activity score was significantly increased at 1 h for all cell types, in particular for excitatory cortical neurons (layer 2/3: D = 0.56, <italic>p</italic> &lt; 2.22 × 10<sup>−16</sup>), (layer 4: D = 0.60, <italic>p</italic> &lt; 2.22 × 10<sup>−16</sup>), (layer 6: D = 0.54, <italic>p</italic> &lt; 2.22 × 10<sup>−16</sup>). At 4 h of light exposure, predicted activity began to show diverging trends which were foreshadowed by predicted activity at 1 h. Although trending towards a return to baseline, activity scores of neurons at 4 h were not significantly different from neurons at 1 h, while several glial cell types returned to baseline (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">6</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>Temporal patterns and classification of in vivo sensory activation.</title><p><bold>a</bold> Cell type activity predictions of visual cortex neurons in freely behaving mice exposed to light for 0, 1, or 4 h. Activity predictions summarized by cell type and experimental group, and Kolmogorov–Smirnov (one-sided) test results are provided in Supplementary Data <xref rid="MOESM4" ref-type="media">6</xref>. Color indicates cell type and shape indicates major cell type groupings. <bold>b</bold> ROC plots indicate the ability of predicted activity to distinguish between the 0 h and 1 h experimental groups. Diagonals from bottom left to top right indicate an accuracy similar to random chance, while lines moving straight vertically, then straight horizontally indicate perfect separation. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_44503_Fig4_HTML" id="d32e911"/></fig></p>
      <p id="Par20">As we observed similar trends in temporal activity predictions between the unstimulated (0 h) and 1 h group, we investigated the degree to which the activity score derived from our model could be used as a classifier of experimental group. The degree to which activity score is predictive of experimental group in a particular cell type is expected to represent the robustness of the response in that cell type. Using the visual cortex dataset (VIS) mentioned above, we constructed receiver-operator curve (ROC) plots for neuronal and non-neuronal cell types (Fig. <xref rid="Fig4" ref-type="fig">4b</xref>). For both excitatory neuron and interneuron subtypes, the activity score demonstrated varying degrees of predictive power. For example, the activity score alone was able to almost perfectly separate stimulation groups when considering excitatory cortical layer cell types (layer 2/3: AUC = 0.84), (layer 4: AUC = 0.89), (layer 6: AUC = 0.823), as well as certain interneuron cell types (Sst-2: AUC: 0.97), (Vip: AUC = 0.90). Despite the model being trained on purely neuronal cell type populations, the activity score was able to separate stimulation groups for astrocytes (AUC = 0.84) and endothelial cells (AUC = 0.72) with comparable accuracy to neurons.</p>
    </sec>
    <sec id="Sec8">
      <title>Utility in data modalities beyond scRNA-seq</title>
      <p id="Par21">Next, we asked whether our model could identify spatial signatures of learning in brain slices of mice following spatial object recognition (SOR) training - a widely used behavioral paradigm to investigate spatial memory mechanisms<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. Using spatial transcriptomic data from brain slices of SOR-trained and homecage control (HC) male mice, we applied our model to predict activity for each spot (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5a</xref>) and clustered all spots into anatomical regions. The 22 resulting clusters were annotated with brain region naming conventions from the Allen Mouse Brain Atlas (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). In baseline homecage samples, we noted weak activation signatures, primarily covering regions of the striatum and hypothalamus as well as subregions of the hippocampus (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>, left). Following SOR training, we noted region-specific increases in predicted activity (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>, right). To identify a spatial activation signature of SOR for the entire brain slice, we tested for differences in predicted activity for each brain region cluster (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>). We observed significant increases in predicted activity for several cortical and subcortical regions. Multiple layers of the isocortex and the retrosplenial area showed increases in activity following SOR (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>), with the greatest increases observed in layers 2/3 (β = 0.17, <italic>p</italic><sub>adjusted</sub> = 3.16 × 10<sup>−4</sup>) and the retrosplenial cortex (β = 0.17, <italic>p</italic><sub>adjusted</sub> = 1.00 × 10<sup>−6</sup>). The caudoputamen area of the dorsal striatum, subregions of the hippocampus, and the olfactory/piriform areas also showed significant increases in activity, of comparable magnitude (caudoputamen: β = 0.12, <italic>p</italic><sub>adjusted</sub> = 8.01 × 10<sup>−4</sup>). Subregions of the hippocampus were variably activated following SOR, with the strongest induction observed in the CA1 subregion (β = 0.12, <italic>p</italic><sub>adjusted</sub> = 9.14 × 10<sup>−5</sup>), while the dentate gyrus subregion did not show significant activation (β = 0.03, <italic>p</italic><sub>adjusted</sub> = 0.07). Other regions predicted to be least activated by SOR include the thalamus, hypothalamus, and fiber tracts (Supplementary Data <xref rid="MOESM4" ref-type="media">7</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><title>Spatial transcriptomic patterns of neuronal activation after spatial learning.</title><p><bold>a</bold> Spatial anatomical clustering of RNA-sequencing spots. RSP retrosplenial area, HY hypothalamus, AMY amygdala, med: medial, lat lateral. <bold>b</bold> Activity score per spot, averaged within experimental groups of homecage controls (left) and 1 h after SOR training (right). Yellow color indicates low activity and red indicates high activity. <bold>c</bold> Brain region-specific induction of activity following SOR training. Differences tested using a linear mixed effects model (two-sided), colored by the SOR coefficient estimate per region (<italic>n</italic> = 3 biologically independent mice per group). Dark purple colors represent greater differences between groups. Cluster-wise differential activity statistics are summarized in (<bold>d</bold>) and provided in Supplementary Data <xref rid="MOESM4" ref-type="media">7</xref>. Dots represent estimated coefficients of SOR on activity score; linear fit. Brackets indicate standard error of the coefficient. Asterisks indicate a significant difference in activity score between homecage and SOR groups—false discovery rate (FDR)-adjusted <italic>p</italic>-values are *FDR ≤ 0.05, **FDR ≤ 0.01, ***FDR ≤ 0.001, and ****FDR ≤ 0.0001. Exact <italic>p</italic>-values, FDR, coefficients, and the number of cells per group, per brain region are provided in Supplementary Data <xref rid="MOESM4" ref-type="media">7</xref>. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_44503_Fig5_HTML" id="d32e1012"/></fig></p>
      <p id="Par22">Visium samples contain signal from multiple neuronal and non-neuronal cells. Cortical layers and CA1 showed profound increases in activity but are also known to have relatively high neuron density. Therefore, we considered the extent to which regional neuron density influences coefficient estimates in Fig. <xref rid="Fig5" ref-type="fig">5d</xref>. We performed cell type deconvolution on each Visium spot, using neuronal and non-neuronal cell type expression profiles from the Allen Cell Types Database. For a subset of genes with high variability across cell classes, we fit a linear model to each Visium spot as a function of GABAergic, glutamatergic, and non-neuronal expression profiles. Coefficient estimates for each cell class were rescaled across samples to a range of zero to one, and then adjusted for each sample to sum to one, thus providing a proxy measure of cell class density (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a</xref>). We found a significant positive relationship between estimated regional neuron abundance and log-estimated regional effect of learning on activity (β = 0.87, <italic>p</italic> = 0.01), (Spearman correlation = 0.54, <italic>p</italic> = 0.009) (Supplementary. Fig. <xref rid="MOESM1" ref-type="media">6b</xref>). We used the residuals of the linear model in Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b</xref> as a neuron density-corrected view of the effect of learning (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6c</xref>). Cortical layers, retrosplenial cortex, CA1, and caudoputamen regions show greater learning-induced increases in activity score than expected based on neuron density estimates alone, suggesting that neurons in these regions exhibit a more potent transcriptional response to learning, or that there are other cell types contributing to the activity signature. The dentate gyrus and regions of the hypothalamus, amygdala, thalamus showed lower activity induction than expected.</p>
      <p id="Par23">To validate the finding that the CA1 region was preferentially activated by spatial learning over the dentate gyrus, we performed RNAscope<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> on coronal brain slices from SOR-trained (1 h post-training) and homecage control mice (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5b</xref>). We selected three NEUROeSTIMator target genes, <italic>Egr1</italic>, <italic>Egr3</italic>, and <italic>Nr4a1</italic> as probes. For each brain slice, we quantified mean fluorescent intensity (MFI) of each probeand then averaged the MFI of all three probes for each hippocampal subregion. A two-way ANOVA revealed a significant interaction between hippocampal subregions and training groups. In line with the spatial transcriptomic data (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5c</xref>), we found that CA1 showed a preferential increase in average probe intensity following spatial learning (Sidak’s test, CA1: <italic>p</italic><sub>adjusted</sub> = 0.0075, dentate gyrus: <italic>p</italic><sub>adjusted</sub> = 0.5553) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5d</xref>).</p>
    </sec>
    <sec id="Sec9">
      <title>NEUROeSTIMator outperforms competing methods in discriminating experimental stimulation groups</title>
      <p id="Par24">The NEUROeSTIMator approach to quantifying activity uses an encoding neural network to infer transcriptome-wide coexpression with a set of 22 activity-dependent target genes. We investigated whether the added complexities of our model are necessary to produce a metric that successfully discerns stimulated samples from unstimulated. We compared NEUROeSTIMator to seven alternative models. The first competing method is a scaled additive model, a simple and easily implementable approach that scales normalized expression of NEUROeSTIMator’s 22 target genes across samples to range of [0,1], and then sums scaled values within samples. The second method, the PC1 model, scores samples with target gene loadings derived from the first component of a PCA on the NEUROeSTIMator training dataset. The third method uses MAGIC for graph-based imputation before applying the scaled additive approach to the imputed expression values. The fourth method, the transcriptome-naïve model, is a neural network trained with identical parameters to NEUROeSTIMator, but without access to non-target gene expression inputs. The fifth approach, the transcriptome reconstruction approach, is a neural network trained with identical parameters to NEUROeSTIMator but reconstructs the entire transcriptome with the 22 target genes having equal total loss weight to all other genes. The sixth and seventh approaches, the 2 &amp; 3-unit bottleneck models, are neural networks trained with identical parameters to NEUROeSTIMator, but using two and three bottleneck units, respectively. We evaluated each model by scoring activity in stimulated and unstimulated samples from six datasets (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>) and determined separability of the experimental groups using area under the curve (AUC). This approach was applied to datasets featured in Figs. <xref rid="Fig3" ref-type="fig">3</xref>, <xref rid="Fig4" ref-type="fig">4</xref>, and <xref rid="Fig5" ref-type="fig">5</xref>, as well as a novel single nuclei dataset from mouse dorsal hippocampus following SOR. For each method, dataset, and neuron type we computed AUC and summarized the performance differences between NEUROeSTIMator and competing methods (ΔAUC). (Supplementary Figs. <xref rid="MOESM1" ref-type="media">7</xref>, <xref rid="MOESM1" ref-type="media">8</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">8</xref>). NEUROeSTIMator demonstrated higher performance than each of the competing methods (AUC<sub>NEUROeSTIMator</sub> = 0.732, AUC<sub>scaled.additive</sub> = 0.651, AUC<sub>MAGIC</sub> = 0.587, AUC<sub>PC1</sub> = 0.661, AUC<sub>transcriptome.naive</sub> = 0.671, AUC<sub>transcriptome.reconstruction</sub> = 0.702, AUC<sub>NEUROeSTIMator.2units</sub> = 0.725, AUC<sub>NEUROeSTIMator.3units</sub> = 0.717), (mean ΔAUC<sub>scaled.additive</sub> = +0.081, ΔAUC<sub>MAGIC</sub> = +0.145, ΔAUC<sub>PC1</sub> = +0.071, ΔAUC<sub>transcriptome.naive</sub> = +0.061, ΔAUC<sub>transcriptome.reconstruction</sub> = +0.030, ΔAUC<sub>NEUROeSTIMator.2units</sub> = +0.007, ΔAUC<sub>NEUROeSTIMator.3units</sub> = +0.015). Across all competing methods, datasets, and sample groupings, NEUROeSTIMator increased AUC in 77.9% of 763 comparisons. For comparisons where NEUROeSTIMator outperformed the competing method, the average increase in AUC was +0.077. For the remaining 22.1% of comparisons where NEUROeSTIMator did worse than the competing method, the average decrease in AUC was −0.031. Together, these results suggest that the neural network architecture and NEUROeSTIMator’s use of broader transcriptomic signals underlie its enhanced performance compared to alternative approaches.</p>
    </sec>
  </sec>
  <sec id="Sec10" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par25">We introduce NEUROeSTIMator, a versatile tool that estimates neuronal activity from transcriptome-wide single-cell gene expression data. Our method generates an activity score that reflects whole-transcriptome response to stimulation, facilitating the rapid identification and prioritization of neurons displaying stimulus response. NEUROeSTIMator’s performance and generalizability are demonstrated through capturing electrophysiological (e-phys) features and detecting activation signatures across various stimulation protocols, neuron subtypes, species, and sequencing technologies, including spatial transcriptomics.</p>
    <p id="Par26">Our analysis reveals that activity-predictive signals are distributed broadly across the transcriptome and are enriched for genes related to external stimulus response, synaptic plasticity, MAP kinase activity, and circadian rhythm. Moreover, we demonstrate a significant link between NEUROeSTIMator’s predictions and increased neuronal excitability, utilizing a unique single-cell Patch-seq dataset containing gene expression and e-phys readouts from individual GABAergic murine neurons<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. These results were further confirmed through a significant association between the activity score and measures of excitability in human excitatory neurons<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>.</p>
    <p id="Par27">We showcase NEUROeSTIMator’s flexibility and generalizability through secondary analyses of several diverse published datasets, detecting potent pharmacologically induced neuronal activity and generalizing across species and cell types. Importantly, our model also detects physiologically relevant activation in response to sensory experiences and uncovers unexpected activity in non-neuronal cells (e.g., astrocytes), suggesting potential applicability to other cell types and stimulus responses.</p>
    <p id="Par28">In a novel application, we use NEUROeSTIMator to analyze spatial transcriptomic data from mice subjected to a spatial learning task, revealing a brain-wide map of learning-induced activation. This highlights the method’s adaptability to spatial transcriptomics (and other varieties of bulk RNA-seq data) and suggests potential for uncovering distinct spatial signatures of transcriptional activation related to cognitive processes.</p>
    <p id="Par29">While our model demonstrates a significant link between transcriptional response and e-phys features in murine interneurons and human excitatory neurons, its applicability to e-phys features in broader cell types is limited by the few available Patch-seq datasets. Additionally, our model does not inherently differentiate stimulation types (e.g., pharmacological vs. naturalistic), and we observed some sensitivity to activity signatures in non-neuronal cell types (a potentially desirable feature, depending on the application). Further, the activity score is limited to detecting activation linked to immediate early gene expression; other potential mechanisms that may be linked to neuronal activation and that act independently of this well-established mechanism may not be detected by our tool. Despite these limitations, NEUROeSTIMator delivers key insights across several neuroscience research domains.</p>
    <p id="Par30">As the first robust and generalizable method for estimating neuronal activation from transcriptomic data, NEUROeSTIMator has broad implications for molecular neuroscience research and challenges the single-gene paradigm of measuring neuronal activity. Our method enables the estimation of cellular activity state, a fundamental variable in gene expression research, paving the way for its integration into single-cell and spatial transcriptomics analyses.</p>
  </sec>
  <sec id="Sec11">
    <title>Methods</title>
    <sec id="Sec12">
      <title>Dataset for model training and evaluation</title>
      <p id="Par31">To train the model, we utilized publicly available datasets provided by the Allen Institute for Brain Science, including a single-cell RNA-sequencing (scRNAseq) dataset of over a million cells isolated from mouse cortical and hippocampal tissue<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>, and a single-nuclei RNA-sequencing (snRNAseq) dataset of 76,000 nuclei isolated from human cortical tissue. Hereafter, these datasets will be referred to as the Allen Mouse and Allen Human datasets. Both datasets used the 10X Genomics Chromium system for droplet capture. The Allen Mouse dataset was prepared using the Chromium Next GEM Single Cell 3’ v3 reagent kit, while the Allen Human dataset used v2.</p>
    </sec>
    <sec id="Sec13">
      <title>Datasets for model application—publicly available</title>
      <p id="Par32">We downloaded multiple datasets from Gene Expression Omnibus (GEO) to demonstrate the utility of our model. The following GEO accessions were included in analyses: GSE102827<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>, GSE106678<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>, GSE136656<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>, and GSE137763<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>.</p>
    </sec>
    <sec id="Sec14">
      <title>Gene identifier mapping</title>
      <p id="Par33">We used the R package biomaRt (version 2.46.3) to map gene identifiers from various annotations used in public datasets, and between species, to a common set of reliably mapped genes<sup><xref ref-type="bibr" rid="CR39">39</xref>,<xref ref-type="bibr" rid="CR40">40</xref></sup>. Ensembl gene identifiers (Ensembl IDs) were used as the primary identifier for mapping genes, and gene symbols were used as secondary identifiers in cases of ambiguous mapping. The Ensembl release 93 archive (July 2018 release) was used for cross-species gene mapping<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>. Genes with one-to-one orthology between mouse and human, as well as mouse and rat, were selected to facilitate cross species utility. All datasets lacking Ensembl ID annotation contained gene symbols, which were then queried against multiple Ensembl archives to determine which archive maximized identifier mapping rate. For instances, when a gene symbol mapped to multiple Ensembl IDs, identifiers present in the cross-species mapping table were preferentially selected. We provide a helper function for mapping gene identifiers to the feature set used by our model, and we further demonstrate usage in the associated tutorial.</p>
    </sec>
    <sec id="Sec15">
      <title>Choice of neural network target genes</title>
      <p id="Par34">To identify robust markers of neuronal activity for use as targets of the neural network, we intersected lists of stimulus-responsive genes from three published RNA-sequencing experiments. Each publication was from a different group of authors, focused on different brain regions, and used different forms of neuronal stimulation (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>). One publication categorized stimulus-responsive genes into three groups—rapid primary response genes (rPRGs), delayed primary response genes (dPRGs), and secondary response genes (SRGs)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>. As SRGs are thought to demonstrate higher celltype-specificity relative to PRGs<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>, only rPRGs and dPRGs were considered from this publication. In another publication, approximately 600 genes upregulated in response to kainic acid treatment in the hippocampus were considered<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
      <p id="Par35">In a third publication, two sets of KCl-responsive genes were available, one from a brain region enriched in glutamatergic neurons and one enriched for GABAergic neurons<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. For this study, we sought to intersect the results of both the glutamatergic and GABAergic analyses into one list of genes. Published p-value distributions suggested differences in statistical power between these two analyses, and only statistically significant results were published. To expand the list of genes overlapping between these analyses, we reanalyzed the data using GEO2R to obtain two sets of transcriptome-wide statistics. Using significance rankings from the GEO2R reanalysis, we jointly determined p-value thresholds for each analysis based on rank-rank hypergeometric overlap (RRHO, see Supplementary Fig. <xref rid="MOESM1" ref-type="media">9</xref>) and identified genes with p-values below these thresholds in both sets with concordant direction of effect<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. Because this approach used unconventional p-value thresholding, we additionally required intersecting genes to have an estimated fold change greater than or equal to 0.5 in both analyses.</p>
      <p id="Par36">Intersecting the three lists of stimulus response genes provided 41 candidate target genes. From these 41, four genes were excluded due to ambiguous or failed cross-species gene identifier mapping. We also excluded an additional eight genes that were detected in less than 1% of cells in more than one out of the four species-by-class groups (i.e., mouse-GABA, mouse-glut, human-GABA, human-glut) to mitigate the potential for the model to learn spurious target correlations to cell class markers or species markers. We performed principal component analysis (PCA) on the reaming 29 candidate target genes to assess dimensionality and found that PCs beyond PC1 added very little to the variance explained (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1a</xref>). All but one gene had a positive loading on PC1, and several genes had a loading near zero. We identified genes that had extreme positive loadings by comparing them to an outlier threshold for PC1 loadings from a shuffled, null PCA. A scaling factor, the ratio of variance from the observed PC1 to the null PC1, was used to make the loadings comparable. The outlier threshold was defined as the median null loading plus or minus three times the median absolute deviation of the null loadings. We found that 22 of 29 genes had loadings considered to be outliers under the null expectation (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1b</xref>). We then did 1000 bootstrap permutations of this analysis, each using random samples of 10,000 cells, and counted the number of permutations where each gene’s loading surpassed the outlier threshold. The same 22 genes surpassed the threshold in at least 5% of the permutations, while the other 7 genes did not (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1c</xref>). With evidence of robust coexpression, those 22 genes were selected as the final set of targets for our neural network: <italic>Arc</italic>, <italic>Btg2</italic>, <italic>Coq10b</italic>, <italic>Crem</italic>, <italic>Dusp1</italic>, <italic>Dusp5</italic>, <italic>Egr1</italic>, <italic>Egr3</italic>, <italic>Fbxo33</italic>, <italic>Fos</italic>, <italic>Fosl2</italic>, <italic>Gadd45g</italic>, <italic>Gmeb2</italic>, <italic>Grasp</italic>, <italic>Junb</italic>, <italic>Nr4a1</italic>, <italic>Nr4a2</italic>, <italic>Nr4a3</italic>, <italic>Per1</italic>, <italic>Rgs2</italic>, <italic>Sertad1</italic>, and <italic>Tiparp</italic>.</p>
    </sec>
    <sec id="Sec16">
      <title>Sample filtering, downsampling, and partitioning</title>
      <p id="Par37">Cells were filtered out if they had less than 5000 total counts, greater than 50,000 total counts, less than 1000 genes detected, more than 10% reads originating from mitochondrial genes, or more than 10% reads originating from the most highly expressed gene. Non-neuronal cells and ultra-rare neuron subclasses with less than 1000 cells were removed, and imbalances among species, neuron type, quality control metrics and naively estimated activity were alleviated using weighted downsampling with hierarchically readjusted weights. Cells were grouped hierarchically by species, class, brain region neighborhood, subclass, and finally, by two-dimensional binning of one source of technical variation (log<sub>10</sub> of total counts), and one source of biological variation (PC1 of target genes). Each group at the leaf nodes of the hierarchy were assigned equal weights summing to one. At each level of the hierarchy, moving from leaves to root, weights were readjusted to sum to one for each group. Using these weights, we downsampled the dataset and calculated Shannon’s entropy to measure imbalance at different values of <italic>N</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2a</xref>) We chose to downsample to 500,000 cells to strike a balance between dataset size and diversity. The effects of downsampling are demonstrated for four subclasses in Supplementary Fig. <xref rid="MOESM1" ref-type="media">2b</xref>. The R package groupdata2 (version 1.4.1) was used to create five training folds (91.3%, 456,725 samples) and one test split (8.7%, 43,275 samples). We used the groupdata2 function ‘fold’ with the parameters ‘cat_col’ set to the species-class group and ‘num_col’ set to the target gene PC1 values in order to keep these balanced across folds, but also set the ‘id_col’ parameter to the subclass label so each subclass was present in some folds but not others. This was done to discourage the undesirable learning of subclass-specific bias in cross-validation.</p>
    </sec>
    <sec id="Sec17">
      <title>Dataset augmentation</title>
      <p id="Par38">The Allen Cell Types Database has higher average total counts per cell compared to many publicly available datasets. To increase representation of lower quality cells, we created augmented samples by synthetically downsampling raw counts using the R package scater<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> (version 1.18.6). For each combination of species and neuron subclass, an equal number of cells were randomly assigned a value of either 10<sup>3</sup>, 10<sup>3.25</sup>, or 10<sup>3.5</sup> total counts to be downsampled to. All genes were considered for downsampling.</p>
    </sec>
    <sec id="Sec18">
      <title>Feature normalization and preprocessing</title>
      <p id="Par39">Log-normalization, as implemented in Seurat, was used to normalize input gene expression. Total counts for each cell were calculated by summing only the 10,017 features used by the model. Normalized expression levels for each gene were centered and scaled based on mean and standard deviation estimated from the training data. For cross validation, mean and standard deviation were estimated without the held-out fold.</p>
    </sec>
    <sec id="Sec19">
      <title>Model architecture</title>
      <p id="Par40">The architecture of the model was adapted from DCA<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> (see Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). Briefly, input gene expression is supplied to encoder branches; a series of three fully connected dense layers with ELU activations and batch normalization. ELU activations were chosen over RELU to increase learning speed and performance. The first three hidden layers of the encoders contained 16, 8, and 4 units. The encoder then connects to the information bottleneck, a single-unit dense layer with sigmoid activation. Variations of the single unit bottleneck (i.e., two and three unite bottlenecks) were also investigated. Downstream of the bottleneck, a decoder layer outputs the expression values of the target genes, i.e., the estimated mean parameter <bold>µ</bold> of the zero-inflated negative binomial (ZINB) model. A separate parallel encoder branch outputs estimates of the dispersion and dropout parameters. To restrict the bottleneck from capturing biases in the training data, we directly supplied auxiliary inputs (neuron subclass, dataset, and quality control variables) to the decoder. Auxiliary inputs were passed through two hidden layers, producing a six-unit dense layer which was then concatenated with the bottleneck activation as well as the output branch for dispersion and dropout parameters to form penultimate decoder layers. The ZINB loss function was used as implemented in DCA, with the only difference being that our implantation only computes loss for the target genes rather than all inputs to the model. This reconstruction loss is based on the maximum likelihood estimate of the ZINB count model, a common model assumed to underlie the count distributions of single cell RNA-seq datasets. A binary cross entropy loss was added to the bottleneck layer to monitor classification accuracy. For model applications, the model outputs are not used, but the sigmoidal bottleneck activation value is the metric extracted to index neuronal activity (see Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). Two additional variations of the model architecture were also investigated. One alternative model was restricted to using information from only the 22 target genes. Another alternative model reconstructed two separate output branches, each contributing equally to the total loss: one to reconstruct the 22 target genes, and one to reconstruct the whole transcriptome (i.e., all genes supplied at the inputs).</p>
    </sec>
    <sec id="Sec20">
      <title>Model training</title>
      <p id="Par41">We trained the model using the R package keras, version 2.3.0.0, and Tensorflow version 1.15.0<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. Training proceeded for 10 epochs using the ADAM optimizer. Gaussian dropout was applied to input expression to simulate uncertainty in measurements. Augmented samples were given the same output as the original data to curtail the learning of depth-dependent information, and augmented samples appeared in the same training batches as the samples they were derived from. We used basic hyperparameter tuning to evaluate the impact of training epochs, learning rate, and regularization parameters such as dropout, L1, and L2 penalty. The final model was selected based on the minimum cross-validation bottleneck layer loss for labeled data (binary cross entropy). Although samples from labeled datasets contributed to the ZINB reconstruction loss, the bottleneck loss did not contribute to weight updates during training to curtail the possibility of information leakage between the training and test splits. Only test split samples were included in any downstream analysis presented in this paper.</p>
    </sec>
    <sec id="Sec21">
      <title>Evaluating feature importance</title>
      <p id="Par42">To evaluate relative importance of each gene on predicted activity, we implemented a strategy adapted from the integrated gradients<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, a popular feature attribution approach used in image classification. Briefly, model gradients were calculated from input genes to bottleneck activation for the test set. For each gene we fit a generalized additive model (GAM) with smoothing between the sample gradients and bottleneck activation. We estimated global feature importance by approximating the integral of the fit. We took the summation of the GAM output for the full range of possible bottleneck activation values [0,1], with a step size of 1 × 10<sup>−3</sup>. Gene set enrichment analysis was run using the R package fgsea (version 1.16.0). We calculated enrichment for gene ontology, Reactome, KEGG, and Wikipathways terms of size between 100–200.</p>
    </sec>
    <sec id="Sec22">
      <title>Comparison of Patch-seq and Smart-seq datasets</title>
      <p id="Par43">The SMART-seq and Patch-seq datasets were integrated, clustered, and visualized using the R package Seurat<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> (version 4.0.1). The sctransform ‘v2’ method was used for normalization<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>. Cell clustering results were cross-referenced with provided neuron type annotations to identify neuron types common to both datasets and harmonize labels. We used the Kolmogorov–Smirnov test (KS test) to assess distributional differences in predicted activity of samples from the Smart-seq and Patch-seq datasets at the neuron type level. Only neuron types with at least one hundred samples in each dataset were considered. To derive empirical <italic>p</italic>-values and determine whether dataset-specific biases is transcriptome-wide expression levels contributed to observed differences in predicted activity, we ran 1000 permutations of the KS test using activity score predictions from within-sample shuffled gene expression values. Empirical p-values were calculated from the frequency of permutation D statistics that were more extreme than those observed in the actual data.</p>
    </sec>
    <sec id="Sec23">
      <title>Modeling activity score with electrophysiological features</title>
      <p id="Par44">The whole-cell Patch-seq electrophysiology recordings from neurons of mouse visual cortex provided by the Allen Institute for Brain Sciences were downloaded as NWB files from the DANDI (ID: 000020, September 2021 update)<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. The dataset included electrophysiological recordings of 4284 specimens from 1040 mouse subjects. The Python package IPFX (version 1.0.5) was used to perform quality control and compute electrophysiological features from the NWB files. We built a generalized linear model with lasso regularization using the R package glmnet (version 4.1-6) to predict output of NEUROeSTIMator using only electrophysiological features. Cells included in the glmnet training belonged to major neuron types (e.g., Vip, Sst) with at least 200 cells, and minor neuron types (e.g., Sst Rxfp1 Prdm8) with at least 10 cells. Features with missing values in five hundred or more cells were removed, and cells with any missing values for the remaining features were discarded. We engineered additional features from the IPFX output, including time and voltage changes between various action potential landmarks (e.g., voltage change between action potential threshold and peak). Minor neuron type was regressed out of the activity score and electrophysiological features. Cells with feature values more extreme than three standard deviations of the mean were considered outliers and removed. Significance of non-zero coefficients from the glmnet model was evaluated with 10,000 bootstrap permutations. In each permutation, a vector of weights is shuffled and used in fitting the glmnet model. For each input feature, we computed the mean bootstrap coefficient. The confidence interval was defined as the mean estimate plus or minus 1.96 times the standard deviation of the bootstrapped coefficients. Feature significance is indicated by the confidence intervals not reaching or overlapping zero. To validate the electrophysiology findings, we did a Pearson’s correlation test between NEUROeSTIMator output and input resistance for Patch-seq neurons from the AIBS dataset ‘Multimodal Analysis of Human Layer 5 Pyramidal Neurons’<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>. Canonical correlation analysis (CCA) was used to explore gene expression profiles with shared relationships to predicted activity and three electrophysiological features. Inputs to the generalizable CCA included the NEUROeSTIMator output matrix, the matrix of three significant electrophysiological features, and the gene expression matrix. One canonical component was calculated for each input matrix, with the tau parameter set to 0 to maximize correlations between all sets of variables. Gene set enrichment analysis was performed as described above using the gene loadings for the gene expression canonical component.</p>
    </sec>
    <sec id="Sec24">
      <title>Preparation of application datasets</title>
      <p id="Par45">Application datasets were downloaded from the Gene Expression Omnibus (GEO). In datasets without provided labels, cell types were identified by running the standard Seurat pipeline, identifying cell clusters, and cross-referencing cluster marker genes to those used in the source publications or the Allen Cell Types Database. To prepare datasets for input to NEUROeSTIMator, gene expression data was log-normalized sample-wise and scaled gene-wise using mean and standard deviation values from the original training dataset. Samples with at least 1000 counts were then input to the model and activity score was the 1-unit bottleneck activation layer output.</p>
    </sec>
    <sec id="Sec25">
      <title>Testing differences in predicted activity</title>
      <p id="Par46">For all datasets analyzed in Figs. <xref rid="Fig2" ref-type="fig">2</xref> and <xref rid="Fig3" ref-type="fig">3</xref>, we used the KS test to evaluate differences in activity score distributions. For statistical tests in Fig. <xref rid="Fig5" ref-type="fig">5</xref>, we used the R package lmerTest to fit alinear mixed effect model with donor as a random effect to test for differences in predicted activity of experimental groups across the spatial transcriptomic clusters, deriving p-values and coefficient estimates of learning on predicted activity per cluster. In Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b</xref>, we adjusted the coefficient estimates of learning on predicted activity for neuron density. We estimated neuron density using a cell type deconvolution technique. We derived gene signatures for GABAergic neurons, glutamatergic neurons, and non-neuronal cell classes by averaging the median gene expression for their respective clusters and subclasses from the Allen Cell Types Database.</p>
      <p id="Par47">For each sample in the Visium dataset, we constructed a linear model, correlating the gene expression vector with a three-column matrix that contained class-averaged expression signatures. We then normalized the coefficient estimates across all Visium samples for each cell class by scaling them to a 0–1 range and then adjusting their sum to one within samples. This process provided an estimate of abundance for each cell class. We summed the estimated abundances of glutamatergic and GABAergic neurons to determine neuron abundance or density for a specific Visium spot, Subsequently, we created a linear model of brain region log coefficient estimates as a function of brain region averaged neuron density estimates. The residuals of this model represent the neuron density-corrected coefficient estimates.</p>
    </sec>
    <sec id="Sec26">
      <title>Performance benchmarking</title>
      <p id="Par48">We compared the performance of NEUROeSTIMator to seven alternative approaches to quantify activity. Performance was defined by the ability to separate labeled cells based on the stimulation status (i.e., experimental group) using area under the curve (AUC). The seven alternative approaches were calculated as follows. The scaled additive measure of activity is calculated by first scaling log-normalized target expression values to a range between 0 and 1, and then summing the scaled targets in each cell or sample. We also applied this scaled additive approach to target expression levels imputed by MAGIC<sup><xref ref-type="bibr" rid="CR47">47</xref></sup>, as implemented in the R package Rmagic (version 2.0.3), with default parameters. To calculate the PC1 measure, we first performed PCA on target genes of the training set used to train NEUROeSTIMator. The loadings for PC1 were then applied to the test set. The remaining four approaches were alternative versions of NEUROeSTIMator. The transcriptome-naïve model is a version of NEUROeSTIMator trained with the same parameters, but information from the non-target input genes is blocked by setting their input values and weights to the first hidden layer to zero. The whole-transcriptome model reconstructed the entire transcriptome during training, as opposed to reconstructing only the targets. For this model, the 22 target genes and the broader transcriptome were assigned equal weight in the loss function during training. The final two models were trained with a bottleneck of either two or three units. To summarize these multivariate bottleneck outputs to a univariate score for AUC calculation, we fit generalized linear models to the binary stimulation group status as a function of the bottleneck outputs in the training data, and then applied the models to test data. To benchmark NEUROeSTIMator against alternative models for binary outcome prediction of stimulation group status, we evaluated model ability to separate stimulated from unstimulated samples. We computed the Area Under the Receiver Operating Characteristic Curve (AUC-ROC) for each model across all combinations of source dataset and sample groupings. We then determined the AUC differences between NEUROeSTIMator and the alternative models for each sample grouping. To summarize the average AUC difference within each dataset, we calculated the mean of the AUC differences for the respective sample groups. This yielded a single value representing the mean AUC difference for each source dataset in the test set. Lastly, we derived the final performance metric by computing the mean of these mean AUC differences across all data sources, offering a comprehensive evaluation of the NEUROeSTIMator’s performance relative to the alternative models.</p>
    </sec>
    <sec id="Sec27">
      <title>Animals</title>
      <p id="Par49">The spatial transcriptomic and RNAscope experiments were performed using male C57BL/6 J mice obtained from Jackson Laboratory (#000664), aged between 2 and 4 months. The mice were housed in groups of up to five individuals per cage, which contained soft bedding material. They had access to food (NIH-31 irradiated modified mouse diet #7913) and water ad libitum. A 12-h light-dark schedule was maintained, with the start of the lights-on period designated as Zeitgeber time zero (ZT 0). Animals were housed in the Animal care facility of the University of Iowa under a pathogen-free condition at the temperature of 21–22 °C and relative humidity of 60–70%. The experimental procedures followed the guidelines for animal care and use set forth by the National Institutes of Health, and they were approved by the Institutional Animal Care and Use Committee (IACUC) at the University of Iowa.</p>
    </sec>
    <sec id="Sec28">
      <title>Behavioral training for spatial transcriptomics</title>
      <p id="Par50">We generated a novel spatial transcriptomic dataset examining the effects of spatial learning in mice. The dataset contains spatial RNA-sequencing of whole brain slices from 1 h after SOR training or home cage controls (HC). 10–12 weeks old C57BL/6 J male mice were trained in SOR task as described previously<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. Briefly, mice were handled for 5 consecutive days prior to the SOR training. On the day of the training, animals were individually placed in an open field with a spatial cue and was allowed to habituate for 6 min. They were returned to their home cage and the arena was wiped clean with ethanol. The animals were again placed back into the open field with three objects at specific spatial locations. The animals were allowed to freely explore the objects in the arena for 6 min. This training with objects comprised of three trials of 6 min each. One hour after the completion of the training, mice were euthanized and whole brains were flash frozen in isopentane placed on dry ice.</p>
    </sec>
    <sec id="Sec29">
      <title>Spatial transcriptomics</title>
      <p id="Par51">Mouse brain section per mouse was cut at 10 µm thickness and mounted onto each Visium slide capture area. After H&amp;E staining, each bright-field image was taken as described in the spatial transcriptomics protocol. Tissue permeabilization was performed for 18 min, as established in the tissue optimization assay. The Visium Spatial Gene Expression Slide &amp; Reagent kit (10x Genomics) was used to generate sequencing libraries for Visium samples. Libraries were constructed according to the 10x Visium library construction protocol and sequenced by Illumina NovaSeq6000. Raw data was then processed using the 10x Genomics Space Ranger analysis pipeline. See Supplementary Fig. <xref rid="MOESM1" ref-type="media">5a</xref> for images of predicted activity for each replicate.</p>
    </sec>
    <sec id="Sec30">
      <title>In situ hybridization</title>
      <p id="Par52">In situ hybridization was performed on 20 μm coronal brain sections from SOR-trained and HC mice using RNAscope reagents (Advanced Cell Diagnostics). Briefly, fixed frozen brains were sectioned on a cryotome and mounted on Superfrost™ Plus microscope slides (Fisherbrand). Slides then underwent serial dehydration in Ethanol, followed by Hydrogen Peroxide treatment, target retrieval, and Protease III treatment—all of which were done according to the manufacturer’s protocol. Hybridization of probes was done at 40 °C for 2 h in an HybEZ oven using a 50:1:1 cocktail of <italic>Egr1</italic>, <italic>Nr4a1</italic>, and <italic>Egr3</italic> respectively. The probe signals were amplified with Pre-amplifier 1 (Amp 1-FL) and counterstained with OPAL dyes (Akoya Biosciences) corresponding to different excitation-emission wavelengths. Finally, the slides were mounted with Vectashield® Antifade Mounting Medium with DAPI (Vector Laboratories). Slides were stored in 4 °C until they were imaged.</p>
    </sec>
    <sec id="Sec31">
      <title>Confocal imaging and analysis</title>
      <p id="Par53">After performing the RNAscope assay, brain sections were imaged using Olympus FV3000 confocal microscope with a 10X NA = 0.4 objective at 800 × 800-pixel resolution. High magnification images of the hippocampus were obtained using a 40X NA = 1.30 oil immersion objective at 800 × 800-pixel resolution and 1.25 optical zoom. All images (8 bit) were acquired with identical settings for laser power, detector gain and pinhole diameter for each experiment and between experiments. Images from the different channels were stacked and projected at maximum intensity using ImageJ (NIH). Hippocampal subregion-specific Mean Fluorescence Intensity (MFI) of each RNAscope probe was evaluated using plugins in ImageJ. The average MFI for all the 3 probes corresponding to each hippocampal subregion was compared between the two experimental groups. Two-way ANOVA was used to assess significance of subregion-by-training interaction (<italic>n</italic> = 4 for each subregion/training combination). A post-hoc Sidak’s multiple comparisons test was applied to assess significance of individual subregion differences.</p>
    </sec>
    <sec id="Sec32">
      <title>Reporting summary</title>
      <p id="Par54">Further information on research design is available in the <xref rid="MOESM5" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec33">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_44503_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_44503_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_44503_MOESM3_ESM.docx">
            <caption>
              <p>Description of supplementary information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_44503_MOESM4_ESM.xlsx">
            <caption>
              <p>Supplementary Data 1–8</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_44503_MOESM5_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
    <sec id="Sec34">
      <title>Source data</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2023_44503_MOESM6_ESM.xlsx">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-44503-5.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was supported by NIH grant R01 MH 087463 to T.A., NIH grant R01 DC014489 to J.J.M., NIH grant K99 AG 068306 and the Nellie Ball Trust to S.C., and The University of Iowa Hawkeye Intellectual and Developmental Disabilities Research Center (HAWK-IDDRC) P50 HD103556 to T.A. and Lane Strathearn. T.A. and J.J.M. are also supported by the Roy J. Carver Charitable Trust. We thank the Allen Institute for Brain Sciences for their valuable datasets we used to train our model. We thank the creators and authors of DCA, whose work inspired the approach we implemented in this paper. We also thank Mahesh Shetty for his valuable contributions to discussions about this project. Figure <xref rid="Fig1" ref-type="fig">1</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref> were created using graphical elements from BioRender.com.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>E.B., S.C., T.A., and J.J.M. conceived the study. E.B. performed data curation, model training, analyses, and visualizations. S.C. and T.A. designed the molecular biology experiments with input from J.J.M. and K.P.G. S.C. performed behavioral experiments, stereotactic surgeries, and single nuclei sequencing. L.C.L. performed Visium spatial transcriptomic sequencing experiments. Y.V. and M.E. processed Visium data. J.R. and M.M. performed RNAscope experiments. U.M. performed statistical analysis and created visualization pertaining to the RNAscope data. E.B. and J.J.M. wrote the article.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par55"><italic>Nature Communications</italic> thanks Jun Ding, Chris Gaiteri and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>Spatial RNA-sequencing data, including gene expression measurements, tissue images, spot coordinates, and raw FASTQ files have been deposited in the Gene Expression Omnibus (GEO) repository under the accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE201610">GSE201610</ext-link>”. GEO datasets used in this study can be accessed under the following accession codes “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE111899">GSE111899</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE125068">GSE125068</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE55591">GSE55591</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE106678">GSE106678</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE137763">GSE137763</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE136656">GSE136656</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE102827">GSE102827</ext-link>”. Other datasets used in this study can be accessed through the Allen Institute for Brain Science: “Allen Cell Types Database [<ext-link ext-link-type="uri" xlink:href="https://portal.brain-map.org/atlases-and-data/rnaseq">https://portal.brain-map.org/atlases-and-data/rnaseq</ext-link>]”, “Mouse PatchSeq VIS [<ext-link ext-link-type="uri" xlink:href="https://knowledge.brain-map.org/data/1HEYEW7GMUKWIQW37BO/summary">https://knowledge.brain-map.org/data/1HEYEW7GMUKWIQW37BO/summary</ext-link>]”, “Human PatchSeq L2/3 [<ext-link ext-link-type="uri" xlink:href="https://knowledge.brain-map.org/data/0R94W5U07IHCMVJ4TVK/summary">https://knowledge.brain-map.org/data/0R94W5U07IHCMVJ4TVK/summary</ext-link>]”. Results used in the analyses of this publication have been deposited to Zenodo under the accession 10.5281/zenodo.10183210. <xref ref-type="sec" rid="Sec34">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>NEUROeSTIMator is available at <ext-link ext-link-type="uri" xlink:href="https://research-git.uiowa.edu/michaelson-lab-public/neuroestimator/">https://research-git.uiowa.edu/michaelson-lab-public/neuroestimator/</ext-link> as a free R package with installation instructions and a tutorial.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par56">T.A. serves on the Scientific Advisory Board of EmbarkNeuro and is a scientific advisor to Aditum Bio and Radius Health. The other authors declare no conflicting interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yap</surname>
            <given-names>EL</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>Activity-regulated transcription: bridging the gap between neural activity and behavior</article-title>
        <source>Neuron</source>
        <year>2018</year>
        <volume>100</volume>
        <fpage>330</fpage>
        <lpage>348</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2018.10.013</pub-id>
        <?supplied-pmid 30359600?>
        <pub-id pub-id-type="pmid">30359600</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cohen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>Communication between the synapse and the nucleus in neuronal development, plasticity, and disease</article-title>
        <source>Annu Rev. Cell Dev. Biol.</source>
        <year>2008</year>
        <volume>24</volume>
        <fpage>183</fpage>
        <lpage>209</lpage>
        <pub-id pub-id-type="doi">10.1146/annurev.cellbio.24.110707.175235</pub-id>
        <?supplied-pmid 18616423?>
        <pub-id pub-id-type="pmid">18616423</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <mixed-citation publication-type="other">West, A. E. &amp; Greenberg, M. E. Neuronal activity-regulated gene transcription in synapse development and cognitive function. <italic>Cold Spring Harb. Perspect Biol.</italic><bold>3</bold>, 10.1101/cshperspect.a005744 (2011).</mixed-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gallo</surname>
            <given-names>FT</given-names>
          </name>
          <name>
            <surname>Katche</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Morici</surname>
            <given-names>JF</given-names>
          </name>
          <name>
            <surname>Medina</surname>
            <given-names>JH</given-names>
          </name>
          <name>
            <surname>Weisstaub</surname>
            <given-names>NV</given-names>
          </name>
        </person-group>
        <article-title>Immediate early genes, memory and psychiatric disorders: focus on c-Fos, Egr1 and Arc</article-title>
        <source>Front Behav. Neurosci.</source>
        <year>2018</year>
        <volume>12</volume>
        <fpage>79</fpage>
        <pub-id pub-id-type="doi">10.3389/fnbeh.2018.00079</pub-id>
        <?supplied-pmid 29755331?>
        <pub-id pub-id-type="pmid">29755331</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mews</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>From circuits to chromatin: the emerging role of epigenetics in mental health</article-title>
        <source>J. Neurosci.</source>
        <year>2021</year>
        <volume>41</volume>
        <fpage>873</fpage>
        <lpage>882</lpage>
        <pub-id pub-id-type="doi">10.1523/JNEUROSCI.1649-20.2020</pub-id>
        <?supplied-pmid 33446519?>
        <pub-id pub-id-type="pmid">33446519</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nido</surname>
            <given-names>GS</given-names>
          </name>
          <name>
            <surname>Ryan</surname>
            <given-names>MM</given-names>
          </name>
          <name>
            <surname>Benuskova</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>JM</given-names>
          </name>
        </person-group>
        <article-title>Dynamical properties of gene regulatory networks involved in long-term potentiation</article-title>
        <source>Front Mol. Neurosci.</source>
        <year>2015</year>
        <volume>8</volume>
        <fpage>42</fpage>
        <pub-id pub-id-type="doi">10.3389/fnmol.2015.00042</pub-id>
        <?supplied-pmid 26300724?>
        <pub-id pub-id-type="pmid">26300724</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hudson</surname>
            <given-names>AE</given-names>
          </name>
        </person-group>
        <article-title>Genetic reporters of neuronal activity: c-Fos and G-CaMP6</article-title>
        <source>Methods Enzymol.</source>
        <year>2018</year>
        <volume>603</volume>
        <fpage>197</fpage>
        <lpage>220</lpage>
        <pub-id pub-id-type="doi">10.1016/bs.mie.2018.01.023</pub-id>
        <?supplied-pmid 29673526?>
        <pub-id pub-id-type="pmid">29673526</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kawashima</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Okuno</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Bito</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>A new era for functional labeling of neurons: activity-dependent promoters have come of age</article-title>
        <source>Front. Neural Circuits</source>
        <year>2014</year>
        <volume>8</volume>
        <fpage>37</fpage>
        <pub-id pub-id-type="doi">10.3389/fncir.2014.00037</pub-id>
        <?supplied-pmid 24795570?>
        <pub-id pub-id-type="pmid">24795570</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guenthner</surname>
            <given-names>CJ</given-names>
          </name>
          <name>
            <surname>Miyamichi</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>HH</given-names>
          </name>
          <name>
            <surname>Heller</surname>
            <given-names>HC</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Permanent genetic access to transiently active neurons via TRAP: targeted recombination in active populations</article-title>
        <source>Neuron</source>
        <year>2013</year>
        <volume>78</volume>
        <fpage>773</fpage>
        <lpage>784</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2013.03.025</pub-id>
        <?supplied-pmid 23764283?>
        <pub-id pub-id-type="pmid">23764283</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Ramirez</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Redondo</surname>
            <given-names>RL</given-names>
          </name>
          <name>
            <surname>Tonegawa</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Identification and manipulation of memory engram cells</article-title>
        <source>Cold Spring Harb. Symp. Quant. Biol.</source>
        <year>2014</year>
        <volume>79</volume>
        <fpage>59</fpage>
        <lpage>65</lpage>
        <pub-id pub-id-type="doi">10.1101/sqb.2014.79.024901</pub-id>
        <?supplied-pmid 25637263?>
        <pub-id pub-id-type="pmid">25637263</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sheng</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>The regulation and function of c-fos and other immediate early genes in the nervous system</article-title>
        <source>Neuron</source>
        <year>1990</year>
        <volume>4</volume>
        <fpage>477</fpage>
        <lpage>485</lpage>
        <pub-id pub-id-type="doi">10.1016/0896-6273(90)90106-p</pub-id>
        <?supplied-pmid 1969743?>
        <pub-id pub-id-type="pmid">1969743</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>YE</given-names>
          </name>
          <name>
            <surname>Pan</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Zuo</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Hong</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Detecting activated cell populations using single-cell RNA-Seq</article-title>
        <source>Neuron</source>
        <year>2017</year>
        <volume>96</volume>
        <fpage>313</fpage>
        <lpage>329 e316</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2017.09.026</pub-id>
        <?supplied-pmid 29024657?>
        <pub-id pub-id-type="pmid">29024657</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Dissecting cell-type composition and activity-dependent transcriptional state in mammalian brains by massively parallel single-nucleus RNA-Seq</article-title>
        <source>Mol. Cell</source>
        <year>2017</year>
        <volume>68</volume>
        <fpage>1006</fpage>
        <lpage>1015 e1007</lpage>
        <pub-id pub-id-type="doi">10.1016/j.molcel.2017.11.017</pub-id>
        <?supplied-pmid 29220646?>
        <pub-id pub-id-type="pmid">29220646</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vallejos</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Risso</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Scialdone</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Dudoit</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Normalizing single-cell RNA sequencing data: challenges and opportunities</article-title>
        <source>Nat. Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>565</fpage>
        <lpage>571</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4292</pub-id>
        <?supplied-pmid 28504683?>
        <pub-id pub-id-type="pmid">28504683</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hicks</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Townes</surname>
            <given-names>FW</given-names>
          </name>
          <name>
            <surname>Teng</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Irizarry</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <article-title>Missing data and technical variability in single-cell RNA-sequencing experiments</article-title>
        <source>Biostatistics</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>562</fpage>
        <lpage>578</lpage>
        <pub-id pub-id-type="doi">10.1093/biostatistics/kxx053</pub-id>
        <?supplied-pmid 29121214?>
        <pub-id pub-id-type="pmid">29121214</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hafemeister</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Normalization and variance stabilization of single-cell RNA-seq data using regularized negative binomial regression</article-title>
        <source>Genome Biol.</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>296</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1874-1</pub-id>
        <?supplied-pmid 31870423?>
        <pub-id pub-id-type="pmid">31870423</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lahnemann</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Eleven grand challenges in single-cell data science</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>31</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-1926-6</pub-id>
        <?supplied-pmid 32033589?>
        <pub-id pub-id-type="pmid">32033589</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yao</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A taxonomy of transcriptomic cell types across the isocortex and hippocampal formation</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3222</fpage>
        <lpage>3241.e3226</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.021</pub-id>
        <?supplied-pmid 34004146?>
        <pub-id pub-id-type="pmid">34004146</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spiegel</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Npas4 regulates excitatory-inhibitory balance within neural circuits through cell-type-specific gene programs</article-title>
        <source>Cell</source>
        <year>2014</year>
        <volume>157</volume>
        <fpage>1216</fpage>
        <lpage>1229</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2014.03.058</pub-id>
        <?supplied-pmid 24855953?>
        <pub-id pub-id-type="pmid">24855953</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fernandez-Albert</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Immediate and deferred epigenomic signatures of in vivo neuronal activation in mouse hippocampus</article-title>
        <source>Nat. Neurosci.</source>
        <year>2019</year>
        <volume>22</volume>
        <fpage>1718</fpage>
        <lpage>1730</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-019-0476-2</pub-id>
        <?supplied-pmid 31501571?>
        <pub-id pub-id-type="pmid">31501571</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tyssowski</surname>
            <given-names>KM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Different neuronal activity patterns induce different gene expression programs</article-title>
        <source>Neuron</source>
        <year>2018</year>
        <volume>98</volume>
        <fpage>530</fpage>
        <lpage>546.e511</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2018.04.001</pub-id>
        <?supplied-pmid 29681534?>
        <pub-id pub-id-type="pmid">29681534</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Sundararajan, M., Taly, A. &amp; Yan, Q. <italic>Axiomatic attribution for deep networks</italic>. arXiv:1703.01365. <ext-link ext-link-type="uri" xlink:href="https://ui.adsabs.harvard.edu/abs/2017arXiv170301365S">https://ui.adsabs.harvard.edu/abs/2017arXiv170301365S</ext-link> (2017).</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gouwens</surname>
            <given-names>NW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated morphoelectric and transcriptomic classification of cortical GABAergic cells</article-title>
        <source>Cell</source>
        <year>2020</year>
        <volume>183</volume>
        <fpage>935</fpage>
        <lpage>953.e919</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2020.09.057</pub-id>
        <?supplied-pmid 33186530?>
        <pub-id pub-id-type="pmid">33186530</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573</fpage>
        <lpage>3587.e3529</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id>
        <?supplied-pmid 34062119?>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Thomas</surname>
            <given-names>GM</given-names>
          </name>
          <name>
            <surname>Huganir</surname>
            <given-names>RL</given-names>
          </name>
        </person-group>
        <article-title>MAPK cascade signalling and synaptic plasticity</article-title>
        <source>Nat. Rev. Neurosci.</source>
        <year>2004</year>
        <volume>5</volume>
        <fpage>173</fpage>
        <lpage>183</lpage>
        <pub-id pub-id-type="doi">10.1038/nrn1346</pub-id>
        <?supplied-pmid 14976517?>
        <pub-id pub-id-type="pmid">14976517</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rosen</surname>
            <given-names>LB</given-names>
          </name>
          <name>
            <surname>Ginty</surname>
            <given-names>DD</given-names>
          </name>
          <name>
            <surname>Weber</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>Membrane depolarization and calcium influx stimulate MEK and MAP kinase via activation of Ras</article-title>
        <source>Neuron</source>
        <year>1994</year>
        <volume>12</volume>
        <fpage>1207</fpage>
        <lpage>1221</lpage>
        <pub-id pub-id-type="doi">10.1016/0896-6273(94)90438-3</pub-id>
        <?supplied-pmid 8011335?>
        <pub-id pub-id-type="pmid">8011335</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baraban</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Taylor</surname>
            <given-names>MR</given-names>
          </name>
          <name>
            <surname>Castro</surname>
            <given-names>PA</given-names>
          </name>
          <name>
            <surname>Baier</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Pentylenetetrazole induced changes in zebrafish behavior, neural activity and c-fos expression</article-title>
        <source>Neuroscience</source>
        <year>2005</year>
        <volume>131</volume>
        <fpage>759</fpage>
        <lpage>768</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuroscience.2004.11.031</pub-id>
        <?supplied-pmid 15730879?>
        <pub-id pub-id-type="pmid">15730879</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dhir</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Pentylenetetrazol (PTZ) kindling model of epilepsy</article-title>
        <source>Curr. Protoc. Neurosci. 9</source>
        <year>2012</year>
        <volume>Unit9</volume>
        <fpage>37</fpage>
        <pub-id pub-id-type="doi">10.1002/0471142301.ns0937s58</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Savell</surname>
            <given-names>KE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A dopamine-induced gene expression signature regulates neuronal function and cocaine response</article-title>
        <source>Sci. Adv.</source>
        <year>2020</year>
        <volume>6</volume>
        <fpage>eaba4221</fpage>
        <pub-id pub-id-type="doi">10.1126/sciadv.aba4221</pub-id>
        <?supplied-pmid 32637607?>
        <pub-id pub-id-type="pmid">32637607</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luo</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Volkow</surname>
            <given-names>ND</given-names>
          </name>
          <name>
            <surname>Heintz</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Pan</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Du</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Acute cocaine induces fast activation of D1 receptor and progressive deactivation of D2 receptor striatal neurons: in vivo optical microprobe [Ca2+]i imaging</article-title>
        <source>J. Neurosci.</source>
        <year>2011</year>
        <volume>31</volume>
        <fpage>13180</fpage>
        <lpage>13190</lpage>
        <pub-id pub-id-type="doi">10.1523/JNEUROSCI.2369-11.2011</pub-id>
        <?supplied-pmid 21917801?>
        <pub-id pub-id-type="pmid">21917801</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Boulting</surname>
            <given-names>GL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Activity-dependent regulome of human GABAergic neurons reveals new patterns of gene regulation and neurological disease heritability</article-title>
        <source>Nat. Neurosci.</source>
        <year>2021</year>
        <volume>24</volume>
        <fpage>437</fpage>
        <lpage>448</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-020-00786-1</pub-id>
        <?supplied-pmid 33542524?>
        <pub-id pub-id-type="pmid">33542524</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rienecker</surname>
            <given-names>KDA</given-names>
          </name>
          <name>
            <surname>Poston</surname>
            <given-names>RG</given-names>
          </name>
          <name>
            <surname>Saha</surname>
            <given-names>RN</given-names>
          </name>
        </person-group>
        <article-title>Merits and limitations of studying neuronal depolarization-dependent processes using elevated external potassium</article-title>
        <source>ASN Neuro</source>
        <year>2020</year>
        <volume>12</volume>
        <fpage>1759091420974807</fpage>
        <pub-id pub-id-type="doi">10.1177/1759091420974807</pub-id>
        <?supplied-pmid 33256465?>
        <pub-id pub-id-type="pmid">33256465</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rienecker</surname>
            <given-names>KDA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mild membrane depolarization in neurons induces immediate early gene transcription and acutely subdues responses to a successive stimulus</article-title>
        <source>J. Biol. Chem.</source>
        <year>2022</year>
        <volume>298</volume>
        <fpage>102278</fpage>
        <pub-id pub-id-type="doi">10.1016/j.jbc.2022.102278</pub-id>
        <?supplied-pmid 35863435?>
        <pub-id pub-id-type="pmid">35863435</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hrvatin</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell analysis of experience-dependent transcriptomic states in the mouse visual cortex</article-title>
        <source>Nat. Neurosci.</source>
        <year>2018</year>
        <volume>21</volume>
        <fpage>120</fpage>
        <lpage>129</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-017-0029-5</pub-id>
        <?supplied-pmid 29230054?>
        <pub-id pub-id-type="pmid">29230054</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chatterjee</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Endoplasmic reticulum chaperone genes encode effectors of long-term memory</article-title>
        <source>Sci. Adv.</source>
        <year>2022</year>
        <volume>8</volume>
        <fpage>eabm6063</fpage>
        <pub-id pub-id-type="doi">10.1126/sciadv.abm6063</pub-id>
        <?supplied-pmid 35319980?>
        <pub-id pub-id-type="pmid">35319980</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>RNAscope: a novel in situ RNA analysis platform for formalin-fixed, paraffin-embedded tissues</article-title>
        <source>J. Mol. Diagn.</source>
        <year>2012</year>
        <volume>14</volume>
        <fpage>22</fpage>
        <lpage>29</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jmoldx.2011.08.002</pub-id>
        <?supplied-pmid 22166544?>
        <pub-id pub-id-type="pmid">22166544</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kalmbach</surname>
            <given-names>BE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Signature morpho-electric, transcriptomic, and dendritic properties of human layer 5 neocortical pyramidal neurons</article-title>
        <source>Neuron</source>
        <year>2021</year>
        <volume>109</volume>
        <fpage>2914</fpage>
        <lpage>2927.e2915</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2021.08.030</pub-id>
        <?supplied-pmid 34534454?>
        <pub-id pub-id-type="pmid">34534454</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hrvatin</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Publisher Correction: Single-cell analysis of experience-dependent transcriptomic states in the mouse visual cortex</article-title>
        <source>Nat. Neurosci.</source>
        <year>2018</year>
        <volume>21</volume>
        <fpage>1017</fpage>
        <pub-id pub-id-type="doi">10.1038/s41593-018-0112-6</pub-id>
        <?supplied-pmid 29752482?>
        <pub-id pub-id-type="pmid">29752482</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Durinck</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>BioMart and Bioconductor: a powerful link between biological databases and microarray data analysis</article-title>
        <source>Bioinformatics</source>
        <year>2005</year>
        <volume>21</volume>
        <fpage>3439</fpage>
        <lpage>3440</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bti525</pub-id>
        <?supplied-pmid 16082012?>
        <pub-id pub-id-type="pmid">16082012</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Durinck</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Spellman</surname>
            <given-names>PT</given-names>
          </name>
          <name>
            <surname>Birney</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Huber</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Mapping identifiers for the integration of genomic datasets with the R/Bioconductor package biomaRt</article-title>
        <source>Nat. Protoc.</source>
        <year>2009</year>
        <volume>4</volume>
        <fpage>1184</fpage>
        <lpage>1191</lpage>
        <pub-id pub-id-type="doi">10.1038/nprot.2009.97</pub-id>
        <?supplied-pmid 19617889?>
        <pub-id pub-id-type="pmid">19617889</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zerbino</surname>
            <given-names>DR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ensembl 2018</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2018</year>
        <volume>46</volume>
        <fpage>D754</fpage>
        <lpage>D761</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkx1098</pub-id>
        <?supplied-pmid 29155950?>
        <pub-id pub-id-type="pmid">29155950</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Plaisier</surname>
            <given-names>SB</given-names>
          </name>
          <name>
            <surname>Taschereau</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wong</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Graeber</surname>
            <given-names>TG</given-names>
          </name>
        </person-group>
        <article-title>Rank-rank hypergeometric overlap: identification of statistically significant overlap between gene-expression signatures</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2010</year>
        <volume>38</volume>
        <fpage>e169</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkq636</pub-id>
        <?supplied-pmid 20660011?>
        <pub-id pub-id-type="pmid">20660011</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Campbell</surname>
            <given-names>KR</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>AT</given-names>
          </name>
          <name>
            <surname>Wills</surname>
            <given-names>QF</given-names>
          </name>
        </person-group>
        <article-title>Scater: pre-processing, quality control, normalization and visualization of single-cell RNA-seq data in R</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <fpage>1179</fpage>
        <lpage>1186</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw777</pub-id>
        <?supplied-pmid 28088763?>
        <pub-id pub-id-type="pmid">28088763</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eraslan</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Simon</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Mircea</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Mueller</surname>
            <given-names>NS</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA-seq denoising using a deep count autoencoder</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>390</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-018-07931-2</pub-id>
        <?supplied-pmid 30674886?>
        <pub-id pub-id-type="pmid">30674886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <mixed-citation publication-type="other">Abadi, M. et al. TensorFlow: A system for large-scale machine learning. <italic>Proceedings of Osdi'16: 12th Usenix Symposium on Operating Systems Design and Implementation</italic>, 265–283 (2016).</mixed-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Choudhary</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Comparison and evaluation of statistical error models for scRNA-seq</article-title>
        <source>Genome Biol.</source>
        <year>2022</year>
        <volume>23</volume>
        <fpage>27</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-021-02584-9</pub-id>
        <?supplied-pmid 35042561?>
        <pub-id pub-id-type="pmid">35042561</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van Dijk</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Recovering gene interactions from single-cell data using data diffusion</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>716</fpage>
        <lpage>729.e727</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.05.061</pub-id>
        <?supplied-pmid 29961576?>
        <pub-id pub-id-type="pmid">29961576</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
