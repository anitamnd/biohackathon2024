<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Mol Biol Evol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Mol. Biol. Evol</journal-id>
    <journal-id journal-id-type="publisher-id">molbev</journal-id>
    <journal-title-group>
      <journal-title>Molecular Biology and Evolution</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0737-4038</issn>
    <issn pub-type="epub">1537-1719</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6735705</article-id>
    <article-id pub-id-type="doi">10.1093/molbev/msz131</article-id>
    <article-id pub-id-type="publisher-id">msz131</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methods</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>A Fast Likelihood Method to Reconstruct and Visualize Ancestral Scenarios</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Ishikawa</surname>
          <given-names>Sohta A</given-names>
        </name>
        <xref ref-type="author-notes" rid="msz131-FM1"/>
        <xref ref-type="aff" rid="msz131-aff1">1</xref>
        <xref ref-type="aff" rid="msz131-aff2">2</xref>
        <xref ref-type="aff" rid="msz131-aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zhukova</surname>
          <given-names>Anna</given-names>
        </name>
        <xref ref-type="author-notes" rid="msz131-FM1"/>
        <xref ref-type="aff" rid="msz131-aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Iwasaki</surname>
          <given-names>Wataru</given-names>
        </name>
        <xref ref-type="aff" rid="msz131-aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gascuel</surname>
          <given-names>Olivier</given-names>
        </name>
        <xref ref-type="corresp" rid="msz131-cor1"/>
        <xref ref-type="aff" rid="msz131-aff1">1</xref>
        <!--<email>olivier.gascuel@pasteur.fr</email>-->
      </contrib>
    </contrib-group>
    <aff id="msz131-aff1"><label>1</label>Unité Bioinformatique Evolutive, Institut Pasteur, C3BI USR 3756 IP &amp; CNRS, Paris, France</aff>
    <aff id="msz131-aff2"><label>2</label>Department of Biological Sciences, The University of Tokyo, Tokyo, Japan</aff>
    <aff id="msz131-aff3"><label>3</label>Evolutionary Genomics of RNA Viruses, Virology Department, Institut Pasteur, Paris, France</aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Pupko</surname>
          <given-names>Tal</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="msz131-cor1"><bold>Corresponding author:</bold> E-mail: <email>olivier.gascuel@pasteur.fr</email>.</corresp>
      <fn id="msz131-FM1">
        <p>These authors contributed equally to this work.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <month>9</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2019-05-24">
      <day>24</day>
      <month>5</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>24</day>
      <month>5</month>
      <year>2019</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>36</volume>
    <issue>9</issue>
    <fpage>2069</fpage>
    <lpage>2085</lpage>
    <permissions>
      <copyright-statement>© The Author(s) 2019. Published by Oxford University Press on behalf of the Society for Molecular Biology and Evolution.</copyright-statement>
      <copyright-year>2019</copyright-year>
      <license license-type="cc-by-nc" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="msz131.pdf"/>
    <abstract>
      <title>Abstract</title>
      <p>The reconstruction of ancestral scenarios is widely used to study the evolution of characters along phylogenetic trees. One commonly uses the marginal posterior probabilities of the character states, or the joint reconstruction of the most likely scenario. However, marginal reconstructions provide users with state probabilities, which are difficult to interpret and visualize, whereas joint reconstructions select a unique state for every tree node and thus do not reflect the uncertainty of inferences.</p>
      <p>We propose a simple and fast approach, which is in between these two extremes. We use decision-theory concepts (namely, the Brier score) to associate each node in the tree to a set of likely states. A unique state is predicted in tree regions with low uncertainty, whereas several states are predicted in uncertain regions, typically around the tree root. To visualize the results, we cluster the neighboring nodes associated with the same states and use graph visualization tools. The method is implemented in the PastML program and web server.</p>
      <p>The results on simulated data demonstrate the accuracy and robustness of the approach. PastML was applied to the phylogeography of Dengue serotype 2 (DENV2), and the evolution of drug resistances in a large HIV data set. These analyses took a few minutes and provided convincing results. PastML retrieved the main transmission routes of human DENV2 and showed the uncertainty of the human-sylvatic DENV2 geographic origin. With HIV, the results show that resistance mutations mostly emerge independently under treatment pressure, but resistance clusters are found, corresponding to transmissions among untreated patients.</p>
    </abstract>
    <kwd-group kwd-group-type="author">
      <kwd>phylogenetics</kwd>
      <kwd>ancestral character reconstruction</kwd>
      <kwd>maximum likelihood</kwd>
      <kwd>marginal and joint posterior probabilities</kwd>
      <kwd>maximum a posteriori</kwd>
      <kwd>Brier scoring rule</kwd>
      <kwd>simulations</kwd>
      <kwd>Dengue</kwd>
      <kwd>HIV</kwd>
      <kwd>phylogeography</kwd>
      <kwd>drug resistance mutations</kwd>
    </kwd-group>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Virogenesis project</named-content>
        </funding-source>
        <award-id>634650</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">INCEPTION project</named-content>
        </funding-source>
        <award-id>PIA/ANR-16-CONV-0005</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Postdoctoral Fellowship and KAKENHI</named-content>
        </funding-source>
        <award-id>282725</award-id>
        <award-id>16H06279</award-id>
        <award-id>16H06154</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Japan Society for the Promotion of Science</named-content>
          <named-content content-type="funder-identifier">10.13039/501100001691</named-content>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="17"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>A central issue in biology is to recover and understand the evolutionary history of biological entities. These may be of different nature and scale, ranging from DNA and protein sequences to communities, going through biological systems, organs, strains, individuals, species, and populations. The characteristics and evolution of these objects are measured using a variety of “characters,” including molecular properties (e.g., <xref rid="msz131-B79" ref-type="bibr">Werner et al. 2014</xref>; <xref rid="msz131-B6" ref-type="bibr">Bickelmann et al. 2015</xref>; <xref rid="msz131-B8" ref-type="bibr">Busch et al. 2016</xref>), gene contents of genomes (e.g., <xref rid="msz131-B36" ref-type="bibr">Iwasaki and Takagi 2007</xref>), morphological and phenotypic characteristics (e.g., <xref rid="msz131-B17" ref-type="bibr">Endress and Doyle 2009</xref>; <xref rid="msz131-B54" ref-type="bibr">Marazzi et al. 2012</xref>; <xref rid="msz131-B4" ref-type="bibr">Beaulieu et al. 2013</xref>; <xref rid="msz131-B69" ref-type="bibr">Sauquet et al. 2017</xref>), ecological traits (e.g., <xref rid="msz131-B53" ref-type="bibr">Maor et al. 2017</xref>), and geographic locations (e.g., <xref rid="msz131-B1" ref-type="bibr">Arbogast 2001</xref>; <xref rid="msz131-B78" ref-type="bibr">Wallace et al. 2007</xref>; <xref rid="msz131-B46" ref-type="bibr">Lemey et al. 2009</xref>, <xref rid="msz131-B45" ref-type="bibr">2014</xref>; <xref rid="msz131-B16" ref-type="bibr">Edwards et al. 2011</xref>; <xref rid="msz131-B14" ref-type="bibr">Dudas et al. 2017</xref>; <xref rid="msz131-B52" ref-type="bibr">Magee et al. 2017</xref>). Ancestral character reconstruction (ACR) is central in all these studies to trace the origin and evolution of the character of interest. ACR relies first on the inference of phylogenetic relationships among the studied objects, that is, a phylogenetic tree, typically inferred from DNA or protein sequences. The character state is generally known for all (most) tips of the tree (some methods can accommodate for unknown or ambiguous state values). ACR is commonly used to reconstruct ancestral sequences corresponding to specific tree nodes (typically the tree root). ACR is also used to determine how the character of interest has changed on the tree from the root to the tips over evolutionary time, by assigning the most likely ancestral character states to every internal node. This global reconstruction over the whole tree describes the evolutionary history of the character and is commonly called an “ancestral scenario,” which is the focus of this article. Several approaches have been proposed for ACR so far, including parsimony (<xref rid="msz131-B73" ref-type="bibr">Swofford and Maddison 1987</xref>), maximum likelihood (ML; <xref rid="msz131-B61" ref-type="bibr">Pagel 1999</xref>; <xref rid="msz131-B64" ref-type="bibr">Pupko et al. 2000</xref>; <xref rid="msz131-B20" ref-type="bibr">Felsenstein 2004</xref>; <xref rid="msz131-B67" ref-type="bibr">Ree and Smith 2008</xref>), and Bayesian methods (<xref rid="msz131-B34" ref-type="bibr">Huelsenbeck and Bollback 2001</xref>; <xref rid="msz131-B62" ref-type="bibr">Pagel et al. 2004</xref>).</p>
    <p>Parsimony-based ACR provides quick and simple methods to infer ancestral scenarios. However, due to the oversimplification of evolutionary processes (e.g., not accounting for branch lengths and evolutionary times), parsimony has limited accuracy (<xref rid="msz131-B12" ref-type="bibr">Collins et al. 1994</xref>). ML and Bayesian approaches are based on probabilistic models of character evolution. ML methods were shown to perform better than parsimony, using both theoretical arguments and simulation studies under a variety of conditions ( <xref rid="msz131-B81" ref-type="bibr">Zhang and Nei 1997</xref>; <xref rid="msz131-B23" ref-type="bibr">Gascuel and Steel 2014</xref>). Simulation results showed that even the simplest models (e.g., JC, <xref rid="msz131-B38" ref-type="bibr">Jukes and Cantor 1969</xref>) yield more accurate reconstructions than parsimony (<xref rid="msz131-B23" ref-type="bibr">Gascuel and Steel 2014</xref>), thanks to the consideration of evolutionary times and branch lengths, and are robust to moderate model violations and phylogenetic uncertainty (<xref rid="msz131-B30" ref-type="bibr">Hanson-Smith et al. 2010</xref>).</p>
    <p>The size of the trees subjected to ACR has rapidly increased thanks to new generation sequencing technologies. Evolutionary and epidemiological analysis of pathogens, like human immunodeficiency virus (HIV), Influenza, and Ebola, is one of the hotspots of this problem, with data sets commonly comprising thousands of strains (<xref rid="msz131-B33" ref-type="bibr">Holmes et al. 2016</xref>; <xref rid="msz131-B66" ref-type="bibr">Ratmann et al. 2017</xref>; <xref rid="msz131-B15" ref-type="bibr">Durães-Carvalho and Salemi 2018</xref>). With such rapidly evolving pathogens, the links between evolutionary and epidemiological processes raise essential public health questions with important practical issues, notably the routes and patterns of pathogen spread (<xref rid="msz131-B78" ref-type="bibr">Wallace et al. 2007</xref>; <xref rid="msz131-B18" ref-type="bibr">Faria et al. 2014</xref>; <xref rid="msz131-B45" ref-type="bibr">Lemey et al. 2014</xref>; <xref rid="msz131-B27" ref-type="bibr">Gräf et al. 2015</xref>; <xref rid="msz131-B14" ref-type="bibr">Dudas et al. 2017</xref>; <xref rid="msz131-B52" ref-type="bibr">Magee et al. 2017</xref>) and the emergence of drug resistances (<xref rid="msz131-B57" ref-type="bibr">Mourad et al. 2015</xref>; <xref rid="msz131-B83" ref-type="bibr">Zhukova et al. 2017</xref>). In these studies (and many others), ACR was a major tool, aiming to map ancestral states of pathogen characters (e.g., sampling location, risk group of the host, and presence of drug resistance) on the tree inferred from DNA or protein sequences.</p>
    <p>Bayesian methods (<xref rid="msz131-B34" ref-type="bibr">Huelsenbeck and Bollback 2001</xref>; <xref rid="msz131-B62" ref-type="bibr">Pagel et al. 2004</xref>; <xref rid="msz131-B13" ref-type="bibr">Drummond et al. 2012</xref>) are commonly used in this context, notably in phylogeography studies (<xref rid="msz131-B49" ref-type="bibr">Lewis et al. 2015</xref>; <xref rid="msz131-B52" ref-type="bibr">Magee et al. 2017</xref>). The main approach is to infer the joint posterior distributions of ancestral character states, phylogenetic tree, and model parameters, using a Markov chain Monte Carlo (MCMC) procedure. This involves complex probabilistic models describing the evolution of the sequences, the molecular clock (possibly relaxed and correlated), the demography, and last but not least the evolution of the studied character. Stochastic mapping (<xref rid="msz131-B58" ref-type="bibr">Nielsen 2002</xref>; <xref rid="msz131-B35" ref-type="bibr">Huelsenbeck et al. 2003</xref>) is simpler and commonly used to generate and compare alternative, plausible evolutionary histories of the studied character on a given tree. The character evolution model can be very simple, typically symmetrical with a few states, but the current trend is to rely on increasingly complex models, nonsymmetrical, with latent variables, dozens of character states, and evolution over time (<xref rid="msz131-B70" ref-type="bibr">Stadler and Bonhoeffer 2013</xref>; <xref rid="msz131-B44" ref-type="bibr">Lambert et al. 2014</xref>; <xref rid="msz131-B48" ref-type="bibr">Leventhal et al. 2014</xref>; <xref rid="msz131-B42" ref-type="bibr">Kühnert et al. 2014</xref><xref rid="msz131-B43" ref-type="bibr">, 2016</xref>). The Bayesian approach is very popular because of this wealth of options and flexibility, via famous software programs like BEAST (<xref rid="msz131-B13" ref-type="bibr">Drummond et al. 2012</xref>). However, Markov chain Monte Carlo based methods have a high computational cost, and the joint inference of all the tree, parameter, and character distributions cannot be achieved for large data sets. Even the stepwise approach where we first infer the tree distribution, and then the distribution of the studied character along the most likely trees is hardly applicable to medium data sets (500–1,000 tips), requiring high performance computing units (Graphics Processing Units [GPUs]), sophisticated parallel implementations (<xref rid="msz131-B3" ref-type="bibr">Ayres et al. 2012</xref>, <xref rid="msz131-B2" ref-type="bibr">2019</xref>), and days to weeks of computation. In contrast, the ML approach is less computationally demanding as it gives point estimates for the parameters of interest, instead of distributions. For example, TreeTime (<xref rid="msz131-B68" ref-type="bibr">Sagulenko et al. 2018</xref>) is able to deal with large trees comprising thousands of tips and perform fast ML-based ACR in a few minutes or even a few seconds.</p>
    <p>However, there are still potential limitations in applying standard ML-based ACR to large data sets and trees. These limitations are related to the inference of the character states, the uncertainty that is inherent to such inference and that of the phylogeny, as well as the visualization and interpretation of the (large) resulting ancestral scenario. Two main approaches are used in ML-based ACR:
<list list-type="bullet"><list-item><p>Either we compute the marginal posterior probabilities of every state for each of the tree nodes (<xref rid="msz131-B20" ref-type="bibr">Felsenstein 2004</xref>; <xref rid="msz131-B80" ref-type="bibr">Yang 2007</xref>). Then, we usually select the state with the highest posterior. This maximum a posteriori (MAP) selection is independent from one node to another, which could induce globally inconsistent scenarios (typically: two very close nodes with incompatible predictions). This possible shortcoming formed the basis of criticisms against MAP-based ACR.</p></list-item><list-item><p>Or we compute the joint ancestral scenario with the maximal posterior probability (<xref rid="msz131-B64" ref-type="bibr">Pupko et al. 2000</xref>) using dynamic programing. This approach has some global consistency guarantee but returns a unique scenario, and thus does not reflect the fact that with real data and large trees, billions of scenarios may have similar posterior probabilities.</p></list-item></list></p>
    <p>Our simulations (<xref rid="msz131-B23" ref-type="bibr">Gascuel and Steel 2014</xref>; see also results below) showed that the predictions and accuracy of MAP and joint approaches are very close. This advocates for the use of the full marginal approach, which not only indicates the most likely state for each node (as predicted by MAP) but also returns the marginal posterior probabilities of all states, thus reflecting the uncertainties of node predictions. However, interpreting and using these probabilistic outputs is difficult, for example when two states have similar posteriors. Another difficulty is to visualize and summarize the resulting, global scenario, which commonly involves thousands of probability distributions attached to each of the tree nodes.</p>
    <p>Here, we propose a simple and fast approach to overcome these limitations. We use decision theoretic concepts and tools to infer a limited set of likely states for each of the tree nodes, which best approximate the marginal posterior probabilities. In the easy regions of the tree (typically close to the tips [<xref rid="msz131-B23" ref-type="bibr">Gascuel and Steel 2014</xref>]), this approach predicts a unique state, whereas in the difficult parts (typically close to the root) it may predict several likely states reflecting the uncertainty of the inferences. Such results are typically encountered in phylogeography, where the deep origin of the studied species or virus cannot be determined with certainty, whereas its recent history is almost certain (see application to Dengue below). When one is mostly interested in the best guess, this approach will highlight that some of the nodes are predicted with high confidence, whereas some others are not (as with numerical values and confidence intervals). This approach is generic and could be used to reconstruct ancestral sequences (see <xref rid="msz131-B60" ref-type="bibr">Oliva et al. [2019</xref>] for a closely related method), but we restrict ourselves here to unique, discrete characters, for example geographical or morphological. To summarize and visualize the resulting scenarios in this framework, we cluster the neighboring nodes with identical predictions and reuse some of the ideas we developed in parsimony-based PhyloType software (<xref rid="msz131-B11" ref-type="bibr">Chevenet et al. 2013</xref>). This way we obtain a compact, tree-shaped and easily interpretable graphical representation of the most likely ancestral scenarios, which is robust to phylogenetic uncertainties and sampling rate variations. In the following, we first describe the different components of the method, then the results with simulated data along with comparisons with other ACR methods, and lastly two real data analyses on the phylogeography of Dengue and the evolution of drug resistances in a large HIV data set. All methods developed and studied in this article are implemented in the PastML software, which is freely available in several versions and interfaces, including a web server (<ext-link ext-link-type="uri" xlink:href="https://pastml.pasteur.fr/">https://pastml.pasteur.fr/</ext-link>).</p>
  </sec>
  <sec>
    <title>New Approaches</title>
    <sec>
      <title>Preamble</title>
      <p>The method can be decomposed into three main steps: 1) ML-based rescaling of the tree and estimation of the model parameters, 2) ancestral reconstruction of the most likely character states, and 3) compression and visualization of the inferred ancestral scenario. These three steps are described in turn in the following. In this section, we describe the input data, notation, model and global framework, and goals.</p>
      <p>The input of the method is a rooted tree denoted as <italic>T</italic>, where every tip is associated with a character state. The number of tree tips is denoted as <italic>n</italic> and the tree root as <italic>R</italic>. <italic>T</italic> may be not fully resolved, the method applies to both binary and nonbinary trees. In most cases, <italic>T</italic> is obtained from a multiple alignment of sequences (DNA or proteins) using some standard phylogenetic software. Then, the branch lengths are expressed in number of substitutions per site. As we shall see, the input tree is rescaled to fit the evolution of the studied character, and thus all branch-length measures are acceptable. Most interesting results will be obtained with time scaled trees, where branch lengths are expressed in years. Then, the rescaling factor estimated from the input data represents the average number of character changes per year.</p>
      <p>The studied character may be of various natures, as discussed in the Introduction. Here, we consider discrete characters with values taken from a finite, nonordered set of states; for example: {Africa, America, Asia, Australia, Europe} in phylogeography, or {Sensitive, Resistant} when studying drug resistances. <italic>S</italic> denotes the set of possible states, with size <italic>s</italic>. A tree tip (or leaf) is denoted as <italic>l</italic>, and <inline-formula id="IE1"><mml:math id="IM1"><mml:mrow><mml:mi>c</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>l</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mi>S</mml:mi></mml:mrow></mml:math></inline-formula> is the character state associated with <italic>l</italic>. The method is able to accommodate tips with unknown character values, denoted as <inline-formula id="IE2"><mml:math id="IM2"><mml:mrow><mml:mi>c</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>l</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>X</mml:mi></mml:mrow></mml:math></inline-formula>, as well as ambiguities when for a given tip several states are possible. Then, <inline-formula id="IE3"><mml:math id="IM3"><mml:mrow><mml:mi>c</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>l</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is a subset of <italic>S</italic>, and consistently <inline-formula id="IE4"><mml:math id="IM4"><mml:mrow><mml:mi>c</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>l</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>X</mml:mi></mml:mrow></mml:math></inline-formula> is equivalent to <inline-formula id="IE5"><mml:math id="IM5"><mml:mrow><mml:mi>c</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>l</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>S</mml:mi></mml:mrow></mml:math></inline-formula>.</p>
      <p>Continuous-time Markov models are commonly used to represent the evolution of characters, notably with sequences where all sites of the studied multiple alignment are usually assumed to evolve according to the same model (with different rates when using rates across sites models, e.g., gamma distributed). In this setting, especially with DNA having four states only, one is able to accurately estimate the parameters of relatively complex models, for example GTR (<xref rid="msz131-B74" ref-type="bibr">Tavaré 1986</xref>) having ten parameters and 8 degrees of freedom with DNA. Here, we have a unique observation describing the evolution of the studied character through the tips values, and accurately estimating the parameters of complex models is usually difficult, if not impossible, especially when <italic>s</italic> is large (<xref rid="msz131-B24" ref-type="bibr">Gascuel and Steel 2018</xref>). We therefore use simple <italic>s</italic>-state JC-like and F81-like models, which generalize to <italic>s</italic> states the 4-state JC and F81 models for DNA (<xref rid="msz131-B38" ref-type="bibr">Jukes and Cantor 1969</xref>; <xref rid="msz131-B19" ref-type="bibr">Felsenstein 1981</xref>). With JC-like models all rates of changes from state <italic>i</italic> to state <italic>j</italic> (<italic>i </italic>≠<italic> j</italic>) are equal, whereas with F81-like models, the rate of changes from <italic>i</italic> to <italic>j</italic> (<italic>i </italic>≠<italic> j</italic>) is proportional to the equilibrium frequency of <italic>j</italic>, denoted as <italic>π<sub>j</sub></italic>. JC-like models are special cases of F81-like ones, with all equilibrium frequencies equal to <inline-formula id="IE6"><mml:math id="IM6"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>. Several studies advocate the use of <italic>s</italic>-state F81-like models. We showed (<xref rid="msz131-B23" ref-type="bibr">Gascuel and Steel 2014</xref>), using simulations, that even the simpler JC-like version performs nearly as well as the true model, with DNA-like data generated using an HKY model (<xref rid="msz131-B31" ref-type="bibr">Hasegawa et al. 1985</xref>) with high transition/transversion rate and heterogeneous nucleotide frequencies. Moreover, <xref rid="msz131-B14" ref-type="bibr">Dudas et al. (2017)</xref> showed that the origin and destination population sizes (represented by <italic>π<sub>i</sub></italic> and <italic>π<sub>j</sub></italic>, respectively) are two of the main factors explaining Ebola dissemination in West Africa. This finding is in accordance with the use of <italic>s</italic>-state F81-like models, where the expected number of changes from <italic>i</italic> to <italic>j</italic> is proportional to <italic>π<sub>i</sub>π<sub>j</sub></italic>. Another advantage of F81-like models is that the probability of changes along a branch of length <italic>t</italic> is simply expressed as
<disp-formula id="E1"><mml:math id="M1"><mml:mtable><mml:mtr><mml:mtd><mml:mtext>PC</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>→</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mi>μ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mtext>if</mml:mtext><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mi>j</mml:mi><mml:mo>≠</mml:mo><mml:mi>i</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mi>μ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mi>μ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mtext>otherwise</mml:mtext><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
where <italic>μ</italic> is the normalization factor:
<disp-formula id="E2"><mml:math id="M2"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo>∑</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>An <italic>s</italic>-state F81-like model has <italic>s</italic> parameters (<inline-formula id="IE7"><mml:math id="IM7"><mml:mrow><mml:mi>s</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> degrees of freedom) corresponding to the equilibrium frequencies of the <italic>s</italic> states. In our software, these frequencies can be user supplied, roughly estimated from the state frequencies observed at the tree tips (not recommended, see <xref rid="msz131-B24" ref-type="bibr">Gascuel and Steel [2018</xref>]), or estimated by ML as explained in the next section.</p>
    </sec>
    <sec>
      <title>Tree Rescaling and Editing, Parameter Estimation</title>
      <p>Beyond the state equilibrium frequencies, the whole model involves one additional parameter, namely the “global rate,” denoted as <italic>ρ</italic>. With a unique character, as is the case here, estimating all branch lengths in the tree is just impossible. We therefore assume that the number of character changes along the tree is proportional to the branch lengths of the input tree. Every branch length <italic>t</italic> is turned into <italic>ρt</italic>, which is interpreted as the expected number of character changes along the given branch. Moreover, we assume that <italic>ρ</italic> is constant across the tree over evolutionary time, which is a similar assumption to the one-rate model (<xref rid="msz131-B56" ref-type="bibr">Mooers and Schluter 1999</xref>). With dated input trees, the original branch lengths are measured in years and <italic>ρ</italic> in number of state changes per year. The estimated value of <italic>ρ</italic> is then highly informative about the global evolutionary rate of the studied character along the tree.</p>
      <p>Both dated and molecular trees may have branches of length zero. For example, when two input sequences are identical (quite common with virus strains), we expect that any reasonable phylogenetic method infers a cherry with null branches connecting the two sequences (a cherry is a rooted subtree of two taxa). Similar configurations may happen in dated trees due to temporal constraints (<xref rid="msz131-B75" ref-type="bibr">To et al. 2016</xref>). However, two identical sequences may have been observed in different countries, thus giving rise to two different character states linked by a path of length zero, and the same may happen with other types of characters (e.g., phenotypic). In a standard phylogenetic setting, the likelihood of any scenario containing such a configuration is null and no ML-based ancestral reconstruction is possible. To circumvent this difficulty, we edit the input tree. First, all internal branches of length zero are turned into polytomies. Then, for each node having daughter tips with branches of length zero, we compute the union of their states, which is assigned to all these tips (e.g., consider a node <italic>v</italic> with three daughter tips: <italic>x</italic> with state <italic>i</italic> and zero branch length, <italic>y</italic> with state <italic>j</italic> and zero branch length, and <italic>z</italic> with state <italic>i</italic> and nonzero branch length; then, in the edited tree <italic>x</italic> and <italic>y</italic> are associated with state set <inline-formula id="IE8"><mml:math id="IM8"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <italic>z</italic> is unchanged). This simply expresses that the corresponding taxa were observed with different states (e.g., the same sequences in different countries). The likelihood is computed as usual (Materials and Methods) from this edited (and rescaled) tree, in order to estimate the model parameters and infer the ancestral states. Before outputting the state predictions and visualizing the results, the zero-tip configurations are reedited back to their original state.</p>
      <p>To estimate the model parameters (<italic>ρ</italic>, the equilibrium frequencies with F81-like models, and <italic>κ</italic> the transition/transversion ratio with the HKY model used in simulations), we compute the scenario likelihood using the standard pruning algorithm (<xref rid="msz131-B19" ref-type="bibr">Felsenstein 1981</xref>), and use the limited-memory bounded BFGS optimization routine to obtain ML estimates (L-BFGS-B [<xref rid="msz131-B9" ref-type="bibr">Byrd et al. 1995</xref>; <xref rid="msz131-B82" ref-type="bibr">Zhu et al. 1997</xref>], available in Python SciPy library [<xref rid="msz131-B59" ref-type="bibr">Oliphant 2007</xref>]). This is achieved in two steps (both using the pruning and L-BFGS-B algorithms): first we obtain a rough estimate of <italic>ρ</italic> assuming a JC-like model, then we estimate all parameters together, starting from the previously estimated value of <italic>ρ</italic> and equal frequencies for all the states (and <italic>κ</italic> = 4 with HKY). The L-BFGS-B algorithm allows for constraints. To avoid very large or very low values of the global rate <italic>ρ</italic> (possible when the tip states are very similar or highly divergent), we impose: <inline-formula id="IE9"><mml:math id="IM9"><mml:mrow><mml:msup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>×</mml:mo><mml:mrow><mml:mn/><mml:mo/><mml:mrow><mml:mn>0</mml:mn><mml:mo>.</mml:mo><mml:mn>001</mml:mn></mml:mrow></mml:mrow><mml:mo>≤</mml:mo><mml:mi>ρ</mml:mi><mml:mo>≤</mml:mo><mml:msup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>×</mml:mo><mml:mn>10</mml:mn><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> where <italic>β</italic> is the average length of nonzero branches. This means that in the rescaled tree the number of changes along a branch with original length <italic>β</italic> is in between 0.001 and 10 (note that with 10 changes per branch reconstructing ancestral scenarios is just impossible). These bounds on the <italic>ρ</italic> estimate performed well in all our applications to real and simulated data. To ensure that the sum of frequencies is 1.0, one of the frequencies is kept equal to <inline-formula id="IE10"><mml:math id="IM10"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, the others are freely optimized (but constrained to be positive), and all frequencies are normalized in likelihood computations and when outputting the results.</p>
    </sec>
    <sec>
      <title>Discrete Approximation of the State Marginal Posterior Probabilities</title>
      <p>Our method is based on a discrete approximation of the marginal posterior probabilities of the character states, attached to the internal nodes of the tree. The computation of these probabilities is standard and used under different forms in most if not all ML-based phylogenetic programs. However, the complete description of the procedure is rarely available and is included in the Materials and Methods for the sake of completeness. To summarize, we first use the pruning algorithm (<xref rid="msz131-B19" ref-type="bibr">Felsenstein 1981</xref>), which performs a bottom up, postorder tree traversal, and accounts for the information of the descendants of every tree node; then, we perform a top-down, preorder tree traversal, which adds to the previous calculations the information coming from the rest of the tree. We thusly obtain for every tree node <italic>N</italic> and state <italic>i</italic>, the marginal posterior probability of <italic>i</italic> for <italic>N</italic>, <inline-formula id="IE11"><mml:math id="IM11"><mml:mrow><mml:mtext>Marginal</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, which accounts for the state value of all tree tips. This procedure has a time complexity in <inline-formula id="IE12"><mml:math id="IM12"><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where <italic>n</italic> is the number of tips and <italic>s</italic> the number of states. It is therefore linear in <italic>n</italic> and able to process trees with dozens of thousands of tips in a few seconds. It is equivalent (but faster) to the procedure consisting in iteratively rerooting the tree with every internal node and applying the pruning algorithm. The reconstruction accuracy is clearly higher than that obtained with the pruning algorithm (without rerooting) and the descendant information only (<xref rid="msz131-B23" ref-type="bibr">Gascuel and Steel 2014</xref>).</p>
      <p>Let <italic>N</italic> be any given internal node of <italic>T</italic>. Based on the marginal posterior probabilities <inline-formula id="IE13"><mml:math id="IM13"><mml:mrow><mml:mtext>Marginal</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, we have to decide which states are predicted for <italic>N</italic> and which ones are discarded because their posteriors are too low. We could use some thresholding approach, but the choice of the threshold values and decision procedure would be very subjective, without any formal guarantee on the accuracy of the predictions (see <xref rid="msz131-B60" ref-type="bibr">Oliva et al. 2019</xref> for simulation results). We therefore used concepts and tools from decision theory and supervised classification (<xref rid="msz131-B7" ref-type="bibr">Brier 1950</xref>; <xref rid="msz131-B25" ref-type="bibr">Gneiting and Raftery 2007</xref>).</p>
      <p>Assume that the true evolutionary model (tree, branch lengths, and model of character changes) is fully known; then, a standard result (<xref rid="msz131-B28" ref-type="bibr">Guiasu 1977</xref>), known as the Bayes decision rule, is that the most accurate prediction for <italic>N</italic> is obtained by selecting the state with the highest posterior (MAP). In this framework, we predict a unique state, and the accuracy is simply measured by the probability of correctly predicting the true ancestral state. However, in our framework, a unique prediction per node is often unsatisfactory, especially when several states corresponding to different scenarios have similar posteriors. Then, a refined approach involves using probabilistic predictions, where states are assigned to probabilities instead of binary, mutually exclusive decisions as with the Bayes rule. When the true evolutionary model is fully known, the marginal posterior probabilities can be shown to be optimal among all probabilistic predictors (<xref rid="msz131-B25" ref-type="bibr">Gneiting and Raftery 2007</xref>). Various scoring criteria (or scoring rules) have been proposed to measure the accuracy of probabilistic predictors. The most used is the logarithmic scoring criterion from information theory. This is the negative of “surprisal,” which is commonly used in Bayesian inference. However, this scoring criterion is not appropriate here, where we have state predictions with null probabilities (see below). Our approach is derived from the Brier quadratic scoring criterion. Let <inline-formula id="IE14"><mml:math id="IM14"><mml:mrow><mml:mtext>PPr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> be the predicted probability of state <italic>i</italic> for node <italic>N</italic> and <inline-formula id="IE15"><mml:math id="IM15"><mml:mrow><mml:mtext>Truth</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> be the “truth” of <italic>i</italic> for <italic>N</italic>, which is equal to 1 when the ancestral state of <italic>N</italic> is <italic>i</italic>, and 0 otherwise. The Brier score can be expressed as
<disp-formula id="E3"><mml:math id="M3"><mml:mrow><mml:mtext>Brier</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mi>S</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtext>PPr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mtext>Truth</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p>
      <p>In this form, the Brier score is simply the squared Euclidean distance between <inline-formula id="IE16"><mml:math id="IM16"><mml:mrow><mml:mtext>PPr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE17"><mml:math id="IM17"><mml:mrow><mml:mtext>Truth</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (the lower the better). In practice, the truth is rarely known, except when analyzing simulation results and past events (e.g., in weather forecasting). In this context, the Brier score is commonly used to measure the accuracy of probabilistic predictors. For instance, assuming that we assign probability 1 to the true state, then <inline-formula id="IE18"><mml:math id="IM18"><mml:mrow><mml:mtext>Brier</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>. On the opposite, if we assign probability 1 to an incorrect state, then <inline-formula id="IE19"><mml:math id="IM19"><mml:mrow><mml:mtext>Brier</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula>, which is the worst possible value of the score. Assume now that we have no information on the ancestral state of <italic>N</italic>. Then, we have two natural solutions: 1) assign probability <inline-formula id="IE20"><mml:math id="IM20"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> to every state, then <inline-formula id="IE21"><mml:math id="IM21"><mml:mrow><mml:mtext>Brier</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>; 2) randomly, uniformly predict one of the states, then the expected value of <inline-formula id="IE22"><mml:math id="IM22"><mml:mrow><mml:mtext>Brier</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is equal to <inline-formula id="IE23"><mml:math id="IM23"><mml:mrow><mml:mrow><mml:mrow><mml:mn>0</mml:mn><mml:mo>×</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>. In other words, random predictions are worse than the recognition of our ignorance.</p>
      <p>As already stated, when the model is fully known predicting the marginal posterior probabilities of the states is optimal, regarding the Brier criterion (and other proper scoring rules, as the logarithmic one). Thus, we use a discrete approximation of the posteriors, which is consistently selected using the Euclidean distance. The goal is to add as little error as possible to the (unknown) optimal value of <inline-formula id="IE24"><mml:math id="IM24"><mml:mrow><mml:mtext>Brier</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Thanks to the triangle inequality, this ensures a form of minimization of the Brier score (see below). Assuming that we decide to retain <italic>k</italic> states (among <italic>s</italic>) in the predictions, then each of these has probability 1/<italic>k</italic>, whereas the discarded states have probability 0. These probabilities are used in the selection of state subsets but are implicit. The method returns a set of likely states without any associated probabilities. To define the state subsets to be explored, we rank the states based on their posteriors: <inline-formula id="IE25"><mml:math id="IM25"><mml:mrow><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo>(</mml:mo><mml:mtext>=</mml:mtext><mml:mo> </mml:mo><mml:mtext>MAP</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> is best and <inline-formula id="IE26"><mml:math id="IM26"><mml:mrow><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> has the lowest posterior. Then, we select the best subset <inline-formula id="IE27"><mml:math id="IM27"><mml:mrow><mml:mi>S</mml:mi><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo> </mml:mo><mml:mn>…</mml:mn><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<italic>k </italic>=<italic> </italic>1 to <italic>s</italic>) by minimizing the Euclidean distance <inline-formula id="IE28"><mml:math id="IM28"><mml:mrow><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> between <inline-formula id="IE29"><mml:math id="IM29"><mml:mrow><mml:mtext>Marginal</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and the probability vector defined by <inline-formula id="IE30"><mml:math id="IM30"><mml:mrow><mml:mi>Pr</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mtext>to</mml:mtext><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo> </mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE31"><mml:math id="IM31"><mml:mrow><mml:mi>Pr</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mtext>to</mml:mtext><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
      <p>This method is named Marginal Posterior Probabilities Approximation (MPPA) in the following. Let <inline-formula id="IE32"><mml:math id="IM32"><mml:mrow><mml:mtext>BrierMPP</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> be the Brier score of the marginal posteriors probabilities, and <inline-formula id="IE33"><mml:math id="IM33"><mml:mrow><mml:mtext>BrierMPPA</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> the Brier score of MPPA. Both scores are unknown, since the truth is unknown, but we have (triangle inequality): <inline-formula id="IE34"><mml:math id="IM34"><mml:mrow><mml:msqrt><mml:mrow><mml:mtext>BrierMPPA</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msqrt><mml:mo>−</mml:mo><mml:msqrt><mml:mrow><mml:mtext>BrierMPP</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msqrt><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. In other words, by minimizing <inline-formula id="IE35"><mml:math id="IM35"><mml:mrow><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, we minimize the gap between the two Brier scores, where <inline-formula id="IE36"><mml:math id="IM36"><mml:mrow><mml:mtext>BrierMPP</mml:mtext></mml:mrow></mml:math></inline-formula> is optimal assuming a fully correct model. We shall see with simulated data that BrierMPPA is close to BrierMPP, especially with analyzes performed under the true model.</p>
      <p>This method is both simple and fast, with time complexity in <inline-formula id="IE37"><mml:math id="IM37"><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> again. Its accuracy strongly depends on the accuracy of the marginal posteriors, and thus on the severity of model violations, which are inevitable with real data. A possible shortcoming could be that these computations are performed independently for each of the nodes. However, we observed with simulations (<xref rid="msz131-B23" ref-type="bibr">Gascuel and Steel 2014</xref>; results below) that joint reconstructions have no clear advantage over marginal ones. Actually, in a large fraction of cases, the MAP and joint states are the same, which explains this finding. Moreover, the MAP state is always included in the set of states resulting from MPPA. For the rare cases (≪1% in our simulations below) where the joint state is not included in MPPA state set, a program option adds it systematically to ensure that the joint (most likely) scenario is included in MPPA solution.</p>
    </sec>
    <sec>
      <title>Tree Compression and Visualization</title>
      <p>On large phylogenies with hundreds or thousands of tips, once the ancestral states are reconstructed on each node, it might be difficult for a human eye to visualize and interpret the results. To overcome this issue, we provide a compressed representation of the ancestral scenarios, which highlights the main facts and hides minor details. This representation is calculated in two steps: 1) “vertical merge” that clusters together the parts of the tree where no state change happens and 2) “horizontal merge” that clusters independent events of the same kind. Algorithmically, the two merges are performed in the following way:
<list list-type="bullet"><list-item><p>Vertical merge (vertical arrow in <xref ref-type="fig" rid="msz131-F1">fig. 1</xref>) : while there exists a parent–child couple such that the child’s set of input/predicted states is the same as the parents’ one, merge them. Note that tips can be merged as well as internal nodes in this process. We compute the size of a cluster so obtained, by the number of tips contained in the cluster, as the tips correspond to the input data units used for tree and ancestral scenario reconstructions. Accordingly, in the initial tree each tip has a size of 1, each internal node has a size of 0, and when merging two nodes we sum their sizes. In the compressed tree, a cluster is a node or “phylotype” following <xref rid="msz131-B11" ref-type="bibr">Chevenet et al. (2013)</xref>.
</p></list-item><list-item><p>Horizontal merge (horizontal arrow in <xref ref-type="fig" rid="msz131-F1">fig. 1</xref>): starting at the root and going top-down toward the tips, at each node we compare its child subtrees. If two or more identical subtrees are found, we keep just one representative and assign their number to the size of the branch that connects the kept subtree to the current node. Hence, a branch size corresponds to the number of times its subtree is found in the initial tree. Before the horizontal merge all branches have a size of 1. Two trees are considered <italic>identical</italic> if they have the same topology and their corresponding nodes have the same state(s) and sizes.</p></list-item></list></p>
      <fig id="msz131-F1" orientation="portrait" position="float">
        <label><sc>Fig</sc>. 1.</label>
        <caption>
          <p>ACR and visualization steps. Starting from the initial tree with annotated tips (top left, different annotations correspond to different colors), we reconstruct the ancestral node states (top right; colored sectors are used for ambiguous nodes, e.g., orange and purple), and then perform a two-step compression: the vertical compression (bottom right) clusters together the regions of the tree where no state change happens and puts the number of tips collapsed into each node as its size (e.g., the blue root cluster of size 5 in the bottom right tree corresponds to the part of the top-right tree highlighted blue and containing 5 tips), whereas the horizontal compression (bottom left) merges identical subtree configurations, keeping their number as branch sizes (e.g., the two red tip children of the bottom right root are merged into a red tip attached with a branch of size 2 in the bottom left tree).</p>
        </caption>
        <graphic xlink:href="msz131f1"/>
      </fig>
      <p>These two routines are illustrated in <xref ref-type="fig" rid="msz131-F1">figure 1</xref>. In the case of a transmission tree with states representing countries, the vertical merge will cluster together the transmissions happening within the same country and having the same source within that country; for instance, see the clouds colored in blue, orange and purple in <xref ref-type="fig" rid="msz131-F1">figure 1</xref>. Then, the horizontal merge detects independent transmissions from a country A to a country B; for instance in <xref ref-type="fig" rid="msz131-F1">figure 1</xref>, the two red nodes (=B) that branch independently from a big blue circle (=A).</p>
      <p>For large trees with many state changes, even after compression the visualization might contain too many details. To address this issue, a program option makes it possible to specify the desired number of tips shown in the compressed tree (15 by default), which is then achieved by performing a relaxed horizontal merge and hiding less important nodes. In a relaxed horizontal merge, the definition of identical trees is updated: instead of requiring identical sizes of the corresponding nodes, we allow for nodes of sizes of the same order (log 10); for instance, now a node in state A of size 3 can correspond to a node in state A of any size between 1 and 9, and a node in state B of size 25 can correspond to a node in state B of any size between 10 and 99.</p>
      <p>If even after a relaxed horizontal merge the compressed representation contains too many details, we trim less important tips as follows. For each node, we calculate its importance by multiplying its size by the sizes of all the branches on the path to the root, therefore obtaining the number of tips of the original tree that are represented by this node; for instance, a node of size 2 connected to the root via branches of sizes 1, 3, and 5 gets an importance of 30. We call a node blocked by its descendant if its importance is smaller than the descendant’s one. The intuition behind is that this node cannot be removed from the tree unless the importance threshold allows the removal of its descendant first. We then set the cutoff threshold to the 15th largest nonblocked node’s importance (a parameter that can be adjusted), and iteratively trim all tips with smaller importance (once a tip is removed its parent becomes an unblocked tip itself and is also considered for trimming). Finally, we rerun relaxed horizontal merge as some of the previously different topologies might have become identical after trimming. This trimming procedure and its parameters are somewhat empirical, but we observed that it performed well on all data sets we analyzed here and in other studies.</p>
      <p>To simplify the ancestral state analysis of phylogenetic trees with multiple character data, we developed a pipeline that combines the results for different characters, for example geographical location and resistance to drugs. We first apply ancestral reconstruction separately for each character to obtain their ancestral states, and visualize each character on the tree nodes as sectors (see application to HIV below). If we could not choose a unique state for a character, we keep the corresponding sector uncolored (i.e., white). Once the tree is colored and each node is assigned its combined states (pie of colors), we compress the tree as described in the previous section.</p>
      <p>When sampling dates are available for the tree tips, it is possible to visualize a timeline: we split the time between the oldest and the most recent samples into five intervals, and add a visualization slider to navigate in time. At each milestone we hide the subtrees for which all tips were sampled later. When sampling dates are not available, the timeline is based on root-to-tip distances instead.</p>
    </sec>
    <sec>
      <title>Software and Utilities</title>
      <p>PastML takes as input a rooted tree and a tip state annotation table (for one or more characters). It produces a table with predicted ancestral states, and an interactively modifiable visualization (an html file that can be viewed in a browser). PastML is implemented in python 3, uses Scipy/Numpy (<xref rid="msz131-B59" ref-type="bibr">Oliphant 2007</xref>) for parameter optimization/estimation, and Cytoscape.js library (<xref rid="msz131-B21" ref-type="bibr">Franz et al. 2016</xref>) for tree visualization. An additional option performs an automatic upload of the full tree, annotated with ACR predictions, to iTOL, an interactive tool for tree management and visualization (<xref rid="msz131-B47" ref-type="bibr">Letunic and Bork 2016</xref>). PastML is available as a python library/command-line program on pip3. We also provide a docker container that includes all the functionality and does not require installing python: evolbioinfo/pastml. Last but not least, a user friendly web application is available to perform ACR and visualization of ancestral scenarios. Several ACR methods are available: our new MPPA algorithm; the standard marginal posterior probability approach (both MAP and full probabilistic predictions); the joint posterior probability estimation algorithm of <xref rid="msz131-B64" ref-type="bibr">Pupko et al. (2000)</xref>; and the three usual variants of parsimony: ACCTRAN, DELTRAN, and DOWNPASS (<xref rid="msz131-B51" ref-type="bibr">Maddison and Maddison 2000</xref>). All this material (source code, docker container, web server, etc.) is available from <ext-link ext-link-type="uri" xlink:href="https://pastml.pasteur.fr">https://pastml.pasteur.fr</ext-link>.</p>
    </sec>
  </sec>
  <sec>
    <title>Results: Method Comparison Using Simulated Data</title>
    <sec>
      <title>Simulation Protocol</title>
      <p>In this study, we basically followed the simulation procedure used in <xref rid="msz131-B23" ref-type="bibr">Gascuel and Steel (2014)</xref>. We generated pure-birth trees with <italic>n </italic>=<italic> </italic>1,000 tips. To obtain a broad range of ACR difficulties, we used 16 values of the speciation/evolutionary rate ratio (<italic>ω</italic>) ranging from 0.2 to 8.0, which correspond to an average number of state changes per branch of 2.5 and 0.0625, respectively (<xref rid="msz131-B72" ref-type="bibr">Steel and Mooers 2010</xref>). With a high number of state changes per branch (e.g., 2.5) ACR is very difficult, especially for the tree root, whereas with a low number of changes (e.g., 0.0625) ACR becomes easy as all tips and nodes tend to have the same state value. For each value of <italic>ω</italic>, 50 trees were generated, and for each tree we simulated the evolution of 50 unique characters with 4 states, and 50 with 20 states. To ease the implementation, reproducibility and interpretation of the results, we used DNA and protein models, although the method and software are intended for unique characters. We generated 4-state data sets using Seq-Gen v1.3.2 (<xref rid="msz131-B65" ref-type="bibr">Rambaut and Grass 1997</xref>) and the HKY model (<xref rid="msz131-B31" ref-type="bibr">Hasegawa et al. 1985</xref>) with equilibrium frequencies of A, C, G, and T being equal to 0.2, 0.1, 0.3, and 0.4, respectively, and a transition/transversion ratio <italic>κ</italic> of 8.0. These relatively extreme values were chosen to challenge ACR when using the F81 model implemented in PastML. Likewise, we generated 20-state data sets using Seq-Gen and the JTT model (<xref rid="msz131-B37" ref-type="bibr">Jones et al. 1992</xref>) with its default amino-acid equilibrium frequencies. We thusly obtained 16 (<italic>ω</italic> values) × 50 (1,000-tip trees) × 50 (number of characters) × 2 (4-state/20-state) data sets to assess the accuracy of ACR methods. During the simulation procedure with Seq-Gen, we recorded the ancestral state of the character seen at each internal node, including the root. Thus, the “true” ancestral scenario was known. All these data sets are available from <ext-link ext-link-type="uri" xlink:href="https://pastml.pasteur.fr/">https://pastml.pasteur.fr/</ext-link>.</p>
    </sec>
    <sec>
      <title>Methods Being Compared</title>
      <p>These simulated trees and tip state values were then subjected to ACR with five methods:
<list list-type="bullet"><list-item><p>Parsimony: We computed the most parsimonious states for all nodes including the root. This computation was performed using UPPASS (Fitch-Hartigan) and then DOWNPASS algorithms, which combine the state information from all tree tips (analogous to the calculation of posteriors, Materials and Methods). DOWNPASS returns all most parsimonious states for all nodes, as opposed to ACCTRAN and DELTRAN which solve part of the ancestral ambiguities heuristically (<xref rid="msz131-B51" ref-type="bibr">Maddison and Maddison 2000</xref>). This method returns a set of possible states for each node, and thus shares common points with MPPA.</p></list-item><list-item><p>Joint: We used the dynamic programing algorithm described in <xref rid="msz131-B64" ref-type="bibr">Pupko et al. (2000)</xref> to infer the most likely ancestral scenario over all the tree and possible state values. For each of the nodes, we thus obtained a joint estimation of the most likely state. This method returns a unique state for each node.</p></list-item><list-item><p>Marginal: we computed the marginal likelihoods and posterior probabilities of all states for all internal nodes including the root (see Materials and Methods). This method returns full probabilistic predictions (each state is assigned a probability) for all nodes. Marginal is the best possible probabilistic predictor (as measured by the Brier score, and other proper scoring rule) when the model is fully known.</p></list-item><list-item><p>MAP: Using previous computations, we assigned the state with the highest marginal posterior to each node. MAP thus returns a unique state for each of the nodes, just as Joint.</p></list-item><list-item><p>MPPA: We used the method described above to approximate the state posteriors and return for every node a subset of likely states.</p></list-item></list></p>
      <p>With the ML-based methods (i.e., Joint, Marginal, MAP, and MPPA), the simulated data sets were analyzed under the four following conditions, corresponding to various model violations intended to measure the robustness of the ACR methods being compared:
<list list-type="order"><list-item><p>True model and branch lengths: the true evolutionary model (i.e., the model used in simulations, HKY with 4 states and JTT with 20 states) was used for ACR. The model parameters were estimated from the data (i.e., with HKY: the global rate <italic>ρ</italic>, the nucleotide frequencies, and <italic>κ</italic>; with JTT: <italic>ρ</italic> only, we used JTT frequencies as usual). The (true) input tree was rescaled using the estimated value of <italic>ρ</italic> before performing ACR (standard usage of PastML, used in all conditions). In this setting, there is no model violation and Marginal is expected to be optimal regarding the Brier score. The goal was to check that the results were only slightly degraded with model violations.</p></list-item><list-item><p>True model and noised branch lengths: the true model was used, as in previous setting (including parameter estimation and rescaling), but the branch lengths of the input trees were perturbed. The goal was to account for approximate branch-length estimation and molecular-clock violation, two common features with usual data sets. To obtain the input tree, all branch lengths of the true tree were multiplied by independent, lognormal variables, with mean 1.0 and standard deviation 0.5 (i.e., uncorrelated, lognormal molecular-clock model with standard deviation similar to that observed in HIV data [<xref rid="msz131-B75" ref-type="bibr">To et al. 2016</xref>]).</p></list-item><list-item><p>F81 model and true branch lengths: we used F81 and F81-like models for 4- and 20-state data sets, respectively. The model parameters (<italic>ρ</italic> and equilibrium frequencies) were estimated from the input data. This setting corresponds to the default option of PastML. The goal was to check that the loss of accuracy was low, compared with the perfect “true model and branch lengths” setting.</p></list-item><list-item><p>F81 model and noised branch lengths: we combined 4- and 20-state F81-like models and optimizations, with noised input trees (see conditions 2 and 3 above). This setting can be seen as realistic as it combines the default evolutionary model in PastML with branch-length perturbation.</p></list-item></list></p>
    </sec>
    <sec>
      <title>Comparison Criteria</title>
      <p>To compare the accuracy of the various ACR methods being tested, we used the Brier score of the predicted states against the known, true scenario. In the above Brier score formula <inline-formula id="IE38"><mml:math id="IM38"><mml:mrow><mml:mtext>Truth</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> was equal to 1 when the true state of node <italic>N</italic> was <italic>i</italic>, and 0 otherwise. Accordingly, <inline-formula id="IE39"><mml:math id="IM39"><mml:mrow><mml:mtext>PPr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> was equal to 1 (<italic>i</italic> is predicted) or 0 (<italic>i</italic> is not predicted) for the methods predicting a unique state (i.e., Joint and MAP); <inline-formula id="IE40"><mml:math id="IM40"><mml:mrow><mml:mtext>PPr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> was equal to <inline-formula id="IE41"><mml:math id="IM41"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> (<italic>i</italic> is predicted) or 0 (<italic>i</italic> is not predicted) with Parsimony and MPPA when <italic>k</italic> states were predicted; with Marginal, <inline-formula id="IE42"><mml:math id="IM42"><mml:mrow><mml:mtext>PPr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> was simply equal to the marginal posterior probability of state <italic>i</italic> for node <italic>N</italic>. The Brier scores of the nodes were then averaged, and we returned the average score over 2,500 trials (50 trees × 50 trials) for each of the simulation conditions. The same criterion was also applied to the tree root, as ACR is expected to be more difficult with the root than with other tree nodes, especially those being close to the tips (<xref rid="msz131-B23" ref-type="bibr">Gascuel and Steel 2014</xref>).</p>
      <p>To compare the performance of the various methods in producing consistent predictions across the tree, we applied the Brier score to edges instead of nodes. The goal was to check that the predictions for the two extremities of any given edge were compatible and close to the truth, thus establishing, or not, the superiority of global predictions as produced by Joint, over independent predictions as produced by MAP or MPPA (see also <xref rid="msz131-B23" ref-type="bibr">Gascuel and Steel 2014</xref>). An edge <italic>E</italic> was perfectly predicted <inline-formula id="IE43"><mml:math id="IM43"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtext>PPr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mtext>Truth</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> when its two extremity states <italic>i</italic>, <italic>j</italic> were the same as the true ones. In case of multiple predictions, <italic>k</italic> on one extremity and <italic>p</italic> on the other, <inline-formula id="IE44"><mml:math id="IM44"><mml:mrow><mml:mtext>PPr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> was equal to <inline-formula id="IE45"><mml:math id="IM45"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mrow><mml:mi mathvariant="italic">kp</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> when both states were included in the predicted states at both edge extremities, and 0 otherwise. With Marginal we simply used for <inline-formula id="IE46"><mml:math id="IM46"><mml:mrow><mml:mtext>PPr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> the product of the state posteriors of <italic>i</italic> and <italic>j</italic> at both extremities of <italic>E</italic>. The formula to compute the Brier score was the same as for nodes, but considering a state space of size <inline-formula id="IE47"><mml:math id="IM47"><mml:mrow><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula>.</p>
      <p>For Parsimony and MPPA, we counted the average number of predicted states per node in the various simulation conditions. The goal was to check the advantage of predicting several states instead of a single one, in case of uncertainty. The same was also applied to the tree root, where a larger number of states is expected as predictions are more difficult.</p>
    </sec>
    <sec>
      <title>Accuracy of the Various ACR Approaches</title>
      <p>The results are displayed in <xref ref-type="fig" rid="msz131-F2">figure 2</xref> (4 states) and <xref ref-type="fig" rid="msz131-F3">figure 3</xref> (20 states) for the most relevant simulation conditions. Additional results are provided in <xref ref-type="supplementary-material" rid="sup1">supplementary figures S1–S5</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> online, for all simulation conditions and the root and edge predictions. We observe that
</p>
      <fig id="msz131-F2" orientation="portrait" position="float">
        <label><sc>Fig</sc>. 2.</label>
        <caption>
          <p>Accuracy of ACR methods with 4-state DNA-like simulated data. <italic>x</italic> axis: speciation/substitution (or evolutionary) rate ratio. <italic>y</italic> axis: Brier score (the lower the better; panels <italic>A</italic> and <italic>B</italic>); Number of predicted states per node (panel <italic>C</italic>). (<italic>A</italic>) ML-based methods use the true model (HKY, with estimated parameters) and branch lengths (rescaled by PastML). (<italic>B</italic>) ML-based methods use the F81 model (with estimated equilibrium frequencies) and noisy branch lengths (rescaled by PastML). (<italic>C</italic>) Number of nodes predicted by parsimony and MPPA. “All states”: all states are predicted with equal probability (=1/4). “Marginal True”: best possible accuracy, obtained with Marginal using the true model and tree, as in panel <italic>A</italic>. See text for details.</p>
        </caption>
        <graphic xlink:href="msz131f2"/>
      </fig>
      <fig id="msz131-F3" orientation="portrait" position="float">
        <label><sc>Fig</sc>. 3.</label>
        <caption>
          <p>Accuracy of ACR methods with 20-state protein-like simulated data. (<italic>A</italic>) True model (JTT) and tree (rescaled by PastML). (<italic>B</italic>) 20-state F81-like model (with estimated frequencies) and noisy branch lengths (rescaled by PastML). With “All states” every state is predicted with probability 1/20. See note to <xref ref-type="fig" rid="msz131-F2">figure 2</xref> and text for details.</p>
        </caption>
        <graphic xlink:href="msz131f3"/>
      </fig>
      <list list-type="bullet">
        <list-item>
          <p><italic>Evolutionary rate</italic>: As expected, predictions are very difficult with the lowest <italic>ρ</italic> value (speciation/evolutionary rate ratio, 0.2, i.e., 2.5 changes per branch in average); then, all methods have similar or worse accuracy to/than the agnostic method predicting all states with equal probability. With higher <italic>ρ</italic> values, predictions become easy, as few mutations occur in the tree. With the highest <italic>ρ</italic> values (≥5.0, i.e., ≤0.1 changes/branch) all methods succeed (Brier score ≈0) and are equivalent.</p>
        </list-item>
        <list-item>
          <p><italic>Root prediction</italic>: As expected, predicting the root is much more difficult (<xref ref-type="supplementary-material" rid="sup1">supplementary figs. S1 and S2</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> online): when <italic>ρ</italic> is ≤0.5 (≥1.0 changes/branch), even the best method (Marginal with the correct model) does not improve much over the agnostic method, and with the highest <italic>ρ</italic> value (8.0, easiest condition), the Brier score is still substantially larger than 0.</p>
        </list-item>
        <list-item>
          <p><italic>Number of states</italic>: As expected again, predictions are more difficult with 20 states (<xref ref-type="fig" rid="msz131-F3">fig. 3</xref>, Brier score ≈1.5 for the worst methods and conditions) than with 4 states (<xref ref-type="fig" rid="msz131-F2">fig. 2</xref>, Brier score ≈0.95 for the worse methods and conditions). Moreover, the gap between the best and worse methods is larger with 20 states than with 4 states. However, the ranking of the various methods is the same in both settings, and this holds for root prediction as well.</p>
        </list-item>
        <list-item>
          <p><italic>Ranking of ACR methods</italic>: Marginal is the best method regarding the Brier score, as expected with decision theory, and its advantage still holds with model violations (<xref ref-type="fig" rid="msz131-F2">figs. 2 and 3</xref> and <xref ref-type="supplementary-material" rid="sup1">supplementary fig. S5</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> online). Joint and MAP are the worst, due to the fact that they predict a unique state and do not account for uncertainty. Their accuracies are similar, with a slight advantage for MAP in certain conditions (e.g., in the absence of model violations, <xref ref-type="fig" rid="msz131-F2">figs. 2<italic>A</italic> and 3<italic>A</italic></xref>). This result still holds with the edge Brier score (<xref ref-type="supplementary-material" rid="sup1">supplementary figs. S3 and S4</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> online), thus indicating again that Joint and global predictions have no advantage compared with the more local calculations of marginal posterior probabilities (still highly dependent for neighboring nodes). Moreover, the ranking of all methods with the edge Brier score is the same as that obtained with the node Brier score.</p>
        </list-item>
        <list-item>
          <p><italic>Multiple/single state predictions</italic>: Thanks to multiple predictions in uncertain configurations, Parsimony has a clear advantage over Joint and MAP (<xref ref-type="fig" rid="msz131-F2">figs. 2 and 3</xref>). The advantage of MPPA is even larger, due to the fact that MPPA predicts more states than Parsimony, and that these states are predicted using a rigorous probabilistic approach. With medium <italic>ρ</italic> value (1.0), the number of predicted state by MPPA is ∼1.3 and ∼3.0, for 4 and 20 states, respectively. This indicates that the large accuracy gain of MPPA, compared with unique state prediction methods (Joint, MAP), is obtained thanks to a relatively low number of predicted states, which eases the interpretability and visualization of the global scenarios returned by MPPA. However, in difficult conditions (low <italic>ρ</italic> values and/or root prediction, <xref ref-type="fig" rid="msz131-F2">figs. 2 and 3</xref> and <xref ref-type="supplementary-material" rid="sup1">supplementary figs. S1 and S2</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> online) the number of states predicted by MPPA is larger (and much larger than parsimony’s), indicating that MPPA “recognizes its ignorance.” We shall see that these findings are confirmed with real data.</p>
        </list-item>
        <list-item>
          <p><italic>Model violations</italic>: In terms of accuracy, MPPA is close to Marginal in all conditions, especially with 20 states, and is the second best method (<xref ref-type="fig" rid="msz131-F2">figs. 2 and 3</xref>). Moreover, MPPA’s accuracy remains nearly identical with noisy branch lengths, compared with true branch lengths (<xref ref-type="supplementary-material" rid="sup1">supplementary fig. S5</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> online). When violations occur in the model describing state changes (i.e., F81-like models are used to analyze data simulated with HKY and JTT) we observe different results depending on the number of states. With 4 states, there is a low but visible gap between “Marginal true” and “Marginal F81,” which added to the gap between MPPA and “Marginal F81” indicates that model violations have a substantial impact. However, MPPA is still better than Parsimony, especially in the difficult region (low <italic>ρ</italic> values). With 20 states, all these differences are low and the impact of model violations is negligible. This advocates for the use of F81-like models, especially with a large number of states, where estimating all the parameters of complex models is likely unfeasible (but see <xref rid="msz131-B45" ref-type="bibr">Lemey et al. 2014</xref>).</p>
        </list-item>
      </list>
      <p>To summarize, MPPA performs well in this simulation study, with an accuracy close to the fully probabilistic Marginal method, but outputs that are much easier to interpret and visualize. Moreover, the F81-like model seems to be a relevant choice, especially with 20 states, as it yields accurate ancestral predictions while avoiding difficult estimations of the relative rates of changes from one state to another. Results of <xref rid="msz131-B60" ref-type="bibr">Oliva et al. (2019)</xref> confirm these findings. The method proposed in that study , named MPPE, shares common points with MPPA (e.g., ranking of the character states using their posteriors, and selection of the best <italic>k</italic> states) but uses a different selection criterion based on the expected classification error. The accuracies of MPPE and MPPA are very close, and clearly better than the accuracy of all other methods considered in that study.</p>
    </sec>
  </sec>
  <sec>
    <title>Results: Phylogeography of Dengue Epidemics</title>
    <p>To demonstrate the performance of PastML on real data, we reconstructed the ancestral history of Dengue serotype 2 (DENV2) epidemics. We used a medium-size data set of 356 sequences, obtained from <xref rid="msz131-B2" ref-type="bibr">Ayres et al. (2019)</xref>. This data set is annotated with: sampling years (between 1944 and 2014); countries, which we grouped in 10 regions (Central America, Caribbean, South America, Europe, Africa, Western Asia, Eastern Asia, South-eastern Asia, and Oceania); and genotypes (13 sequences of Sylvatic lineage, and 343 sequences of 5 endemic genotypes: American, Asian-American, Asian I, Asian II, and Cosmopolitan). We inferred a ML tree from the DNA sequences, and dated and rooted this tree (based on dates) using LSD (<xref rid="msz131-B75" ref-type="bibr">To et al. 2016</xref>). To check the robustness of PastML inferences against phylogenetic uncertainty, the tree reconstruction was performed with three ML tools: RAxML (<xref rid="msz131-B71" ref-type="bibr">Stamatakis 2014</xref>), PhyML (<xref rid="msz131-B29" ref-type="bibr">Guindon et al. 2010</xref>), and FastTree (<xref rid="msz131-B63" ref-type="bibr">Price at al. 2010</xref>), resulting in three trees with substantial topological differences (mean normalized bipartition distance ∼10%). However, the global topological information was preserved (e.g., the genotypes and sylvatic lineage were perfectly identified and supported in the three trees). To further study the impact of poorly supported branches and topological uncertainties, we created a fourth tree by collapsing the 40 poorly supported branches of the PhyML tree (SH-like support &lt;50%). This collapsed tree was dated and rooted as the three others. The phylogeography of DENV2 epidemics was reconstructed from these four trees and location annotations using PastML with default options (MPPA with F81-like model). We also checked the robustness of ACR results regarding state sampling variations. For this purpose, we generated five new DENV2 alignments, each by picking 356 sequences randomly with replacement from the original alignment. This way we obtained five randomized alignments of the same size as the original one, but with some sequences removed and some present multiple times, which in turn perturbed the numbers of samples per location. We then reconstructed the phylogeography of these five resampled data sets using RaxML and the same approach as for the original alignment.</p>
    <p>PastML results with the RAxML tree are shown in <xref ref-type="fig" rid="msz131-F4">figure 4</xref>. The location of the root is unresolved between five regions: the Caribbean, Eastern Asia, Oceania, South America, and South-eastern Asia. Provided that the root represents the common ancestor of the sylvatic and endemic/epidemic strains (dated 1209 [1147–1249]), this result is not surprising. If instead we focus on the endemic/epidemic subtree (left subtree of the root), its root (dated 1744 [1723–1759]) is resolved to South-eastern Asia. The South-eastern Asian endemic/epidemic cluster has grown over years and by 2014 contained 145 strains from our data set (large orange node on the compressed representation). From there, the epidemic was spread to Southern Asia (lilac), Eastern Asia (six independent introductions represented as an edge of size six leading to a green node), Oceania (red), Africa (light blue), and the Caribbean (blue). From Caribbean, it was further spread to South America (multiple introductions leading to clusters of various sizes in light-orange), and from there to Central America (light-green). These findings agree with the study of global Dengue type 2 phylogeography by <xref rid="msz131-B77" ref-type="bibr">Walimbe et al. (2014)</xref> performed using a Bayesian approach on 307 E-gene sequences (sampled between 1944 and 2011). They also could not pinpoint the ancestral location for DENV2 sylvatic and endemic/epidemic strains, and detected South-eastern Asia as the origin for Asian, Asian-American, and Cosmopolitan endemic genotypes. They also found multiple migrations from Caribbean countries to the American mainland. However, in some cases, PastML predictions remain more cautious. For example, for sylvatic strains Walimbe et al. predicted West Africa as the most probable ancestral location, whereas PastML hesitates between five possible locations, including Africa (gray subtree). For the American endemic genotype (light-yellow subtree), Walimbe et al. predicted India to be the ancestral location, whereas PastML hesitates between Southern (including India) and South-eastern Asia.
</p>
    <fig id="msz131-F4" orientation="portrait" position="float">
      <label><sc>Fig</sc>. 4.</label>
      <caption>
        <p>Ancestral reconstruction of DENV2 epidemic locations. The figure shows the full tree (top) and compressed (bottom left) visualizations produced by PastML using MPPA with an F81-like model. Different colors correspond to different geographical regions as shown in the map in the bottom right corner. The sylvatic and American genotype subtrees are shown with grey and light-yellow backgrounds, respectively. The Joint and MAP predictions are shown for the uncertain nodes. MAP and Joint disagree on the tree root, but their predictions are included in MPPA predictions for all nodes (including those with unique MPPA prediction).</p>
      </caption>
      <graphic xlink:href="msz131f4"/>
    </fig>
    <p>PastML compressed scenarios for RAxML, FastTree, PhyML, and PhyML-collapsed trees are almost identical, with a few minor differences that can be mostly eliminated by resolving some unresolved nodes (<xref ref-type="supplementary-material" rid="sup1">supplementary fig. S6</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> online). This illustrates the robustness of PastML against phylogenetic uncertainty. The same holds regarding sampling variations: PastML ancestral scenarios with resampled data sets are very similar to the scenario inferred using the original alignment (<xref ref-type="supplementary-material" rid="sup1">supplementary fig. S7</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> online). <xref ref-type="fig" rid="msz131-F4">Figure 4</xref> shows the advantage of the approach, where uncertain inferences are not solved arbitrarily but made explicit. For example, the MAP and Joint inferences for the tree root are Eastern Asia and South-eastern Asia, respectively, whereas MPPA predicts five possible origins including both MAP and Joint predictions. However, for most of the nodes MPPA predicts a unique location (average number of states per node ∼1.03). The log-likelihood of the Map, Joint, and MPPA scenarios is equal to −197.3, −197.2, and −193.8, respectively (as expected Joint is better than MAP, and MPPA is even better as it includes several states for some of the nodes). PastML thus represents a larger fraction of the data, while producing a scenario which is almost fully resolved.</p>
  </sec>
  <sec>
    <title>Results: Drug Resistance Mutations in HIV</title>
    <p>To demonstrate the performance of PastML with large data sets, we studied the emergence, transmission and reversion of drug resistance mutations (DRMs, <xref rid="msz131-B5" ref-type="bibr">Bennett et al. 2009</xref>) in HIV. DRMs emerge under the pressure of drug treatments, and then may be transmitted to drug naïve patients (<xref rid="msz131-B83" ref-type="bibr">Zhukova et al. 2017</xref>). An essential public health issue is to detect potential drug resistant subepidemics, which could become prevalent and pose major problems, as is already the case with other pathogens and diseases (e.g., malaria). Parsimony-based ancestral reconstructions were already used fruitfully in this context, with patients from the UK (<xref rid="msz131-B57" ref-type="bibr">Mourad et al. 2015</xref>). We focused here on the subtype C of HIV1 (HIV1-C), the most prevalent subtype around the world (∼50% of HIV infections), originating from Central Africa, spread in Southern and Eastern Africa, and then in Europe and the Americas, with multiple introductions (<xref rid="msz131-B76" ref-type="bibr">Vidal et al. 2000</xref>; <xref rid="msz131-B32" ref-type="bibr">Hemelaar 2012</xref>; <xref rid="msz131-B18" ref-type="bibr">Faria et al. 2014</xref>).</p>
    <p>We used a large data set of 3,619 HIV-1C <italic>pol</italic> sequences, obtained from <xref rid="msz131-B39" ref-type="bibr">Jung et al. (2012)</xref>, <xref rid="msz131-B11" ref-type="bibr">Chevenet et al. (2013)</xref>, and the latest (2017) <italic>pol</italic> alignment of the Los Alamos HIV database. This data set is annotated with sampling dates and countries. We built a tree from the DNA sequences using PhyML (<xref rid="msz131-B29" ref-type="bibr">Guindon et al. 2010</xref>), and rooted it using non-C sequences. As in <xref rid="msz131-B57" ref-type="bibr">Mourad et al. (2015)</xref>, we first computed the presence of the studied DRM in the sequences, thus obtaining the value of a 2-state character (sensitive/resistant) for every tree tip. Then, we used PastML with default options to reconstruct the ancestral resistance status of the tree nodes and root. We also performed analyses through time, to study the dynamics of DRM emergence, diffusion and reversion, and combined DRM analyses with phylogeography to reveal the spatial propagation of resistances. Five of the most prevalent DRMs were analyzed.</p>
    <p>Results for M184V (the most prevalent DRM in our data set) and the combination with phylogeography for the largest resistance cluster are displayed in <xref ref-type="fig" rid="msz131-F5">figure 5</xref>. M184V is a major nonnucleoside RT inhibitor (NRTI) mutation selected in patients receiving Lamivudine (3TC) and Emtricitabine (FTC) (<xref rid="msz131-B22" ref-type="bibr">Gallant 2006</xref>). 3TC was approved for medical use in the United States in 1995, and FTC in 2006. They are both used worldwide nowadays. According to the study of <xref rid="msz131-B10" ref-type="bibr">Castro et al. (2013)</xref> on the persistence of DRMs, in the absence of drug-selective pressure M184V is lost relatively quickly (median time to loss ∼1.0 [0.5–2.0] years).
</p>
    <fig id="msz131-F5" orientation="portrait" position="float">
      <label><sc>Fig</sc>. 5.</label>
      <caption>
        <p>Ancestral state reconstruction of the presence/absence of DRM M184V over time (top), and combined with location data (bottom left). The reconstruction was done by PastML with MPPA + F81 option. For the timeline, the tree was pruned at each year to remove the tips sampled after that year. In the bottom left panel, M184V presence/absence is combined with location data: M184V state is shown color-coded in the left half of each node (green when mutation is absent, and orange for resistant strains), countries are color-coded in the right half of each node, and shown in the labels.</p>
      </caption>
      <graphic xlink:href="msz131f5"/>
    </fig>
    <p>Ancestral state reconstruction allows us to detect potentially acquired (ADR) and transmitted drug resistance (TDR) patterns. An acquired drug resistance is represented by a single-patient resistant node in the compressed visualization, which implies a state change from a sensitive parent node. Potential TDRs are represented by cluster(s) of resistant patients, where internal edges correspond to transmissions of resistant strains. Note that these simple statements still hold with incomplete sampling (<xref rid="msz131-B57" ref-type="bibr">Mourad et al. 2015</xref>): transmissions of DRMs within resistant clusters are then indirect, whereas a one-patient resistant node may correspond to a small resistance cluster, the root of which acquired the DRM.</p>
    <p>We analyzed the reconstructed transmission tree at different time points, each time pruning the tree to remove the tips and nodes sampled after the corresponding year. <xref ref-type="fig" rid="msz131-F5">Figure 5</xref> shows the results for 1996 (the sampling year corresponding to the first sequences with M184V in our data set), 2005 and 2015 (last sampling year in our data set). We see the emergence and growth of potential TDR clusters over time. In 2005, the main configurations included a major TDR cluster of 53 patients, and 76 cases of independent DRM emergence (ADR, i.e., 1-patient node, or small resistant clusters of 2–3 patients). There are also multiple cases of reversion of the DRM (e.g., 66 cases of patients having a sensitive virus at the time of sampling, which originate from the major resistant cluster). By 2015 the main TDR cluster grew (to 72 patients), and so did the numbers of cases of ADR and DRM reversion. Importantly, the main resistance cluster in 2005 is included in the one of 2015, which demonstrates the potential of the method in surveying the emergence of problematic resistant subepidemics, as the 2015 cluster was already predictable in 2005.</p>
    <p>To further investigate the largest TDR cluster, we combined the ancestral state reconstruction for M184V with the location. The result located the whole resistant cluster in South America. We then increased the geographical resolution by replacing the regions with the countries and focused on the subtree with the root in East Africa, as this is from where the virus was spread to South America according to our reconstruction. The results are shown in the bottom left panel of <xref ref-type="fig" rid="msz131-F5">figure 5</xref>, and suggest that the resistance cluster is located in Brazil, and that it originated from either a sensitive or a resistant case in Brazil (the parent node of the TDR cluster is a Brazilian node with unresolved M184V state). The reconstruction also shows that the virus was introduced to Brazil from Burundi, from where it was also spread to Tanzania, and Ethiopia. This geographical result agrees with the study on HIV-1C epidemics in Eastern Africa and Southern Brazil by <xref rid="msz131-B55" ref-type="bibr">Mir et al. (2018)</xref>, although the latter was performed using a Bayesian approach and a different data set, which included more Brazilian sequences.</p>
    <p>The results for the second, third, and fourth most prevalent DRMs in our data set (K103N, D67N, and K70R) are similar to those for M184V: they show emergence and growth of TDR clusters over time, and well as growth of the number of ADR and reversions to sensitive state. The largest TDR clusters for these three DRMs are located in Brazil, just as with M184V. With the decrease of DRM prevalence, the size of TDR clusters in our data decreases, from a 72-patient TDR cluster for M184V to a 7-patient one for K70R. The analysis of K103N can be found in <xref ref-type="supplementary-material" rid="sup1">supplementary figure S8</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> online. The results for the fifth most prevalent DRM (Y181C) are different: We hardly see any TDR clusters (their size is at most four patients), and the largest TDR cluster is located in India (<xref ref-type="supplementary-material" rid="sup1">supplementary fig. S9</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> online). This could be the very start of TDR spread for this mutation hence making it a candidate for closer surveillance, or it could simply be due to the quick reversion time of Y181C (median of 1.3 years, cf., <xref rid="msz131-B10" ref-type="bibr">Castro et al. [2013</xref>]) and hence inability to form TDR clusters.</p>
    <p><xref ref-type="fig" rid="msz131-F5">Figure 5</xref> and the results illustrate again the advantage of MPPA reconstructions. For example, the Joint and MAP predictions for the root of the Brazilian subtree (unresolved by MPPA) disagree, they are respectively resistant and sensitive. The same occurs with 34 other nodes, where MPPA predictions contain again both states predicted by MAP and Joint. In total, ∼2.5% of the tree nodes cannot be fully resolved by MPPA, which corresponds to ∼1.025 states per node in average. The total log-likelihood of MPPA is equal to −834.9, whereas the log-likelihood of Joint is −861.8, and of MAP is −872.4 (as expected substantially lower than Joint). MPPA thus represents a much larger fraction of the data, while producing a scenario which is almost fully resolved.</p>
    <p>PastML analyses were performed on a laptop with a 4-core 2.50GHz CPU. ACR and visualization of Dengue phylogeography (356 tips, 10 states) as well as of HIV-1C DRM dynamics (3,619 tips, 2 states) took ∼1 min per tree.</p>
  </sec>
  <sec sec-type="conclusions">
    <title>Conclusions</title>
    <p>We presented a new, simple, and fast approach to reconstruct ancestral scenarios, deal with the uncertainty of ancestral inferences in the difficult regions of the tree (typically around the tree root), and visualize and edit interactively a tree-shaped graphical representation of the most likely ancestral scenarios. The results obtained with the Dengue and a large HIV data sets are congruent with previous studies. Moreover, these results are robust against phylogenetic uncertainty and sampling variations.</p>
    <p>The method proposed here to account for uncertainties in ancestral inferences could easily be adapted to sequences and especially proteins, where its ability to provide an inventory of a limited number of alternative amino acids should be very useful to examine likely variants and determine the best candidate based on the structure and physicochemical properties. Directions for further research include the exploration of other loss functions, in place of the Brier scoring rule, for example in line of <xref rid="msz131-B60" ref-type="bibr">Oliva et al. (2019)</xref> or reusing previous concepts and results from decision theory (<xref rid="msz131-B25" ref-type="bibr">Gneiting and Raftery 2007</xref>). Moreover, the current version of PastML is based on JC-like and F81-like models, due to the limited information available with unique characters. Some refinements (e.g., in the line of <xref rid="msz131-B45" ref-type="bibr">Lemey et al. [2014</xref>], and <xref rid="msz131-B14" ref-type="bibr">Dudas et al. [2017</xref>]) should be useful, not only to improve the accuracy and ancestral reconstructions but also to provide users with a global view of the evolutionary processes at stake (strain flow between regions and countries, acquisitions and losses of molecular characters, dynamics of ecological character changes, etc.). Lastly, an interesting direction would be to develop methods and tools to compare our tree-shaped, compressed representations of ancestral scenarios, calculate some distance between two scenarios, extract the common parts and the differences, and propose some consensus.</p>
  </sec>
  <sec sec-type="materials|methods">
    <title>Materials and Methods</title>
    <sec>
      <title>Computation of the Marginal Posterior Probabilities</title>
      <p>Let <italic>N</italic> be a given internal node of the tree <italic>T</italic>, and <italic>U</italic>, <italic>V</italic>, and <italic>F</italic> be the left descendant, right descendant, and father of <italic>N</italic>, respectively, with corresponding rescaled branch lengths denoted as <italic>u</italic>, <italic>v</italic>, and <italic>f.</italic> Moreover, let <inline-formula id="IE48"><mml:math id="IM48"><mml:mrow><mml:mtext>Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> be the vector of state conditional likelihoods induced by the state values of the tips of the “<italic>down</italic>” subtree rooted with <italic>N</italic>. <inline-formula id="IE49"><mml:math id="IM49"><mml:mrow><mml:mtext>Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is equal to the likelihood of having state <italic>i</italic> in <italic>N</italic> given the states observed in the extant descendants of <italic>N</italic>. <inline-formula id="IE50"><mml:math id="IM50"><mml:mrow><mml:mtext>Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is computed recursively using the pruning algorithm (<xref rid="msz131-B19" ref-type="bibr">Felsenstein 1981</xref>), which combines a postorder tree traversal with the following formula:
<disp-formula id="E4"><mml:math id="M4"><mml:mtable><mml:mtr><mml:mtd><mml:mtext>Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder><mml:mrow><mml:mtext>PC</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>→</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mi>u</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>U</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder><mml:mrow><mml:mtext>PC</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>→</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext>and for </mml:mtext><mml:mi mathvariant="normal">a</mml:mi><mml:mtext> tip </mml:mtext><mml:mi>l</mml:mi><mml:mo>:</mml:mo><mml:mtext> if </mml:mtext><mml:mi>c</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>l</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>i</mml:mi><mml:mtext> or </mml:mtext><mml:mi>X</mml:mi><mml:mo>,</mml:mo><mml:mtext> then Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mtext>else Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0.</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
This algorithm proceeds in a bottom-up fashion, first computing the conditional likelihoods of the nodes close to the tips and progressing until the tree root. The conditional likelihoods so obtained can be used to compute marginal posterior probabilities and then predict the ancestral states attached to every tree node. Several ancestral reconstruction programs use this approach. However, a more accurate method does exist (<xref rid="msz131-B80" ref-type="bibr">Yang 2007</xref>; <xref rid="msz131-B23" ref-type="bibr">Gascuel and Steel 2014</xref>). Indeed, when using <inline-formula id="IE51"><mml:math id="IM51"><mml:mrow><mml:mtext>Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> we only account for the information contained in the tips descending from <italic>N</italic>, and not for the information contained in the rest of the tree.</p>
      <p>To account for all tree information, we define a second vector of conditional likelihoods attached to <italic>N</italic>, <inline-formula id="IE52"><mml:math id="IM52"><mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE53"><mml:math id="IM53"><mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> denotes the conditional likelihood of having <italic>i</italic> in <italic>N</italic> given the tip values observed in the “<italic>up</italic>” subtree of <italic>N</italic>. To define this subtree, assume that <italic>T</italic> is rerooted with <italic>N</italic>; then <italic>N</italic> has three direct descendants: <italic>U</italic>, <italic>V</italic>, and <italic>F</italic>, each associated with a subtree. The <italic>up</italic> subtree of <italic>N</italic> is defined as the subtree associated with <italic>F</italic> including the branch (of length <italic>f</italic>) from <italic>F</italic> to <italic>N.</italic> In other words, the <italic>up</italic> subtree contains all branches, nodes and tips which are not included in the <italic>down</italic> subtree of <italic>N.</italic> To compute the <italic>Up</italic> conditional likelihoods we use the following formula (applied to node <italic>U</italic> to simplify the notation, but the same formula applies to <italic>V</italic>, <italic>N</italic> and all tree nodes):
<disp-formula id="E5"><mml:math id="M5"><mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>U</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder><mml:mrow><mml:mtext>PC</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>→</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mi>u</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>k</mml:mi></mml:munder><mml:mrow><mml:mtext>PC</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>→</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>This formula is exploited recursively thanks to a top-down, preorder tree traversal. We start from the tree root <italic>R</italic>, having <inline-formula id="IE54"><mml:math id="IM54"><mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> for all states <italic>i</italic>, and progress toward the tips; for example, <inline-formula id="IE55"><mml:math id="IM55"><mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is computed after <inline-formula id="IE56"><mml:math id="IM56"><mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>F</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and before <inline-formula id="IE57"><mml:math id="IM57"><mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>U</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE58"><mml:math id="IM58"><mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>V</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, as seen in the formula. Moreover, this formula uses the <italic>Down</italic> likelihoods, which have to be computed first. Both <italic>Down</italic> and <italic>Up</italic> calculations are easily extended to polytomies: the <italic>Down</italic> formula contains as many sum terms as <italic>N</italic> has descendants (instead of 2 above with <italic>U</italic> and <italic>V</italic>); the <italic>Up</italic> formula contains as many internal sum terms as <italic>U</italic> has brother nodes (instead of 1 above with <italic>V</italic>).</p>
      <p>Once <inline-formula id="IE59"><mml:math id="IM59"><mml:mrow><mml:mtext>Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE60"><mml:math id="IM60"><mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> have been computed, the state marginal posterior probabilities of <italic>N</italic> are computed using (remember that for the tree root <inline-formula id="IE61"><mml:math id="IM61"><mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>):
<disp-formula id="E6"><mml:math id="M6"><mml:mtable><mml:mtr><mml:mtd><mml:mtext>Marginal</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mtext>Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mtext>TotalProba</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mtext>where </mml:mtext><mml:mo>(</mml:mo><mml:mtext>law of total probability</mml:mtext><mml:mo>)</mml:mo><mml:mo>:</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext>TotalProba</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mi>S</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mtext>Down</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Up</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula></p>
      <p>These algorithms have a time complexity in <inline-formula id="IE62"><mml:math id="IM62"><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where <italic>n</italic> is the number of tree tips and <italic>s</italic> the number of states. The whole procedure is thus linear in <italic>n</italic> and remarkably fast.</p>
      <p>All along these calculations, some of the conditional likelihood values may be extremely small when <italic>n</italic> is large, and smaller than the minimum value permitted for double floating numbers. As in other ML programs, if the conditional likelihoods of <italic>N</italic> are smaller than a given threshold, then all conditional likelihoods of <italic>N</italic> are multiplied by a power of 2. This numerical trick does not change the marginal posterior probabilities, as the relative values of the conditional likelihoods are preserved.</p>
    </sec>
    <sec>
      <title>DENV2 Data and Analyses</title>
      <p>We used a data set of 356 aligned sequences of Dengue serotype 2, obtained from <xref rid="msz131-B2" ref-type="bibr">Ayres et al. (2019)</xref>. We built ML trees from the DNA sequences using three inference tools: RAxML v8.2.11-sse3 (<xref rid="msz131-B71" ref-type="bibr">Stamatakis 2014</xref>), PhyML v3.3.20180621 (<xref rid="msz131-B29" ref-type="bibr">Guindon et al. 2010</xref>), and FastTree v2.1.10 (Price at al. 2010), all with GTR + Γ6 substitution model and default options. The trees were then dated and rooted (based on dates) using LSD v0.3beta-55183ca9d0 (<xref rid="msz131-B75" ref-type="bibr">To et al. 2016</xref>). PastML was used with default options (MPPA+F81) to reconstruct the ancestral locations of all tree nodes and root, among ten regions (character states) present in the data set.</p>
    </sec>
    <sec>
      <title>HIV-1C Data and Analyses</title>
      <p>We used an HIV-1C <italic>pol</italic> sequence data set, previously used in <xref rid="msz131-B39" ref-type="bibr">Jung et al. (2012)</xref>, and then (in a slightly updated version) in <xref rid="msz131-B11" ref-type="bibr">Chevenet et al. (2013)</xref>. We extended the latter alignment with HIV-1C <italic>pol</italic> sequences from the latest (2017) <italic>pol</italic> alignment in the Los Alamos HIV database (<ext-link ext-link-type="uri" xlink:href="https://www.hiv.lanl.gov/content/index">https://www.hiv.lanl.gov/content/index</ext-link>; Last accessed June 1, 2019), hence adding 583 sequences. Addition of the new sequences was performed using MAFFT multiple sequence alignment program with the –add option (<xref rid="msz131-B40" ref-type="bibr">Katoh and Standley 2013</xref>). The final alignment contains 3,619 HIV-1C <italic>pol</italic> sequences, plus 35 outgroup reference sequences from the non-C subtypes. The data set is annotated with sampling dates and countries.</p>
      <p>We detected the Surveillance Drug Resistance Mutations (<xref rid="msz131-B5" ref-type="bibr">Bennett et al. 2009</xref>), using the Sierra web service of the Stanford HIV drug resistance database (<xref rid="msz131-B50" ref-type="bibr">Liu and Shafer 2006</xref>). We removed the Surveillance Drug Resistance Mutation positions from the alignment and reconstructed five most parsimonious trees using TNT (<xref rid="msz131-B26" ref-type="bibr">Goloboff and Catalano 2016</xref>), which were used as starting trees for five runs of PhyML (<xref rid="msz131-B29" ref-type="bibr">Guindon et al. 2010</xref>) with GTR+I + Γ6 substitution model and aLRT SH-like branch supports. The most likely tree was retained for further analyses and ancestral reconstructions. This tree was rooted with the outgroup sequences, which were subsequently removed from the tree. The branches of length zero and aLRT SH-like support &lt;0.5 were collapsed into polytomies.</p>
      <p>PastML was then used to reconstruct, along this tree, the ancestral scenarios describing the emergence, diffusion, and reversion in some cases, of DRMs. We analyzed DRMs with high prevalence in our data set: M184V with a prevalence of 0.07 (highest prevalence in our data set), K103N (prevalence = 0.05, second highest prevalence), and Y181C (prevalence = 0.03, fifth highest prevalence). Results (available at <ext-link ext-link-type="uri" xlink:href="https://pastml.pasteur.fr">https://pastml.pasteur.fr</ext-link>) for the third and fourth highest prevalence DRMs are similar to those of M184V and K103N. PastML was used with MPPA + F81 and a node importance threshold of 10. We performed analyses through time to study the dynamics of DRM emergence, diffusion and reversion. In this context, we have two character states: the DRM is absent or present, and the corresponding strain (tip, node) is sensitive or resistant, respectively. Results for the most prevalent DRM (M184V) are provided in <xref ref-type="fig" rid="msz131-F4">figure 4</xref>. Results for the two other DRMs are in supplementary figures S8 and S9, <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> online.</p>
    </sec>
  </sec>
  <sec sec-type="data-availability">
    <title>Data Availability</title>
    <p>All of our data, trees, ACRs, and Snakemake pipelines (<xref rid="msz131-B41" ref-type="bibr">Köster and Rahmann 2012</xref>) used to reconstruct the trees and analyze them are available from <ext-link ext-link-type="uri" xlink:href="https://pastml.pasteur.fr">https://pastml.pasteur.fr</ext-link>; Last accessed June 1, 2019.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Molecular Biology and Evolution</italic> online.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>msz131_Supplementary_Data</label>
      <media xlink:href="msz131_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="AK1">
    <title>Acknowledgments</title>
    <p>Sincere thanks to L. Blassel, S. Cosentino, S. Duchêne, F. Lemoine, M. Matsui, H. Ménager, S. Mestack, and K. Theys for their help and comments. We also thank Tal Pupko and two anonymous reviewers for their suggestions to improve the first submitted manuscript. This work was supported by the EU-H2020 Virogenesis project (Grant No. 634650, O.G.), by the INCEPTION project (PIA/ANR-16-CONV-0005, A.Z. and O.G.), and by Postdoctoral Fellowship and KAKENHI 282725 (S.A.I.), 16H06279 (W.I.), and 16H06154 (W.I.) from Japan Society for the Promotion of Science.</p>
  </ack>
  <ref-list id="RL1">
    <title>References</title>
    <ref id="msz131-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Arbogast</surname><given-names>BS.</given-names></name></person-group><year>2001</year><article-title>Phylogeography: the history and formation of species</article-title>. <source>Am Zool</source>. <volume>41</volume><issue>1</issue>:<fpage>134</fpage>–<lpage>135</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B2">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Ayres</surname><given-names>DL</given-names></name>, <name name-style="western"><surname>Cummings</surname><given-names>MP</given-names></name>, <name name-style="western"><surname>Baele</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Darling</surname><given-names>AE</given-names></name>, <name name-style="western"><surname>Lewis</surname><given-names>PO</given-names></name>, <name name-style="western"><surname>Huelsenbeck</surname><given-names>JP</given-names></name>, <name name-style="western"><surname>Lemey</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA.</given-names></name></person-group><year>2019</year> BEAGLE 3: improved usability for a high-performance computing library for statistical phylogenetics, <italic>Syst Biol.</italic> (Advanced Access, Published: 23 April 2019, <pub-id pub-id-type="doi">10.1093/sysbio/syz020</pub-id>).</mixed-citation>
    </ref>
    <ref id="msz131-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Ayres</surname><given-names>DL</given-names></name>, <name name-style="western"><surname>Darling</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Zwickl</surname><given-names>DJ</given-names></name>, <name name-style="western"><surname>Beerli</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Holder</surname><given-names>MT</given-names></name>, <name name-style="western"><surname>Lewis</surname><given-names>PO</given-names></name>, <name name-style="western"><surname>Huelsenbeck</surname><given-names>JP</given-names></name>, <name name-style="western"><surname>Ronquist</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Swofford</surname><given-names>DL</given-names></name>, <name name-style="western"><surname>Cummings</surname><given-names>MP</given-names></name></person-group>,
<etal>et al</etal><year>2012</year><article-title>BEAGLE: an application programming interface and high-performance computing library for statistical phylogenetics</article-title>. <source>Syst Biol</source>. <volume>61</volume><issue>1</issue>:<fpage>170</fpage>–<lpage>173</lpage>.<pub-id pub-id-type="pmid">21963610</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Beaulieu</surname><given-names>JM</given-names></name>, <name name-style="western"><surname>O’Meara</surname><given-names>BC</given-names></name>, <name name-style="western"><surname>Donoghue</surname><given-names>MJ.</given-names></name></person-group><year>2013</year><article-title>Identifying hidden rate changes in the evolution of a binary morphological character: the evolution of plant habit in campanulid angiosperms</article-title>. <source>Syst Biol</source>. <volume>62</volume><issue>5</issue>:<fpage>725</fpage>–<lpage>737</lpage>.<pub-id pub-id-type="pmid">23676760</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bennett</surname><given-names>DE</given-names></name>, <name name-style="western"><surname>Camacho</surname><given-names>RJ</given-names></name>, <name name-style="western"><surname>Otelea</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Kuritzkes</surname><given-names>DR</given-names></name>, <name name-style="western"><surname>Fleury</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Kiuchi</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Heneine</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Kantor</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Jordan</surname><given-names>MR</given-names></name>, <name name-style="western"><surname>Schapiro</surname><given-names>JM</given-names></name></person-group>,
<etal>et al</etal><year>2009</year><article-title>Drug resistance mutations for surveillance of transmitted HIV-1 drug-resistance: 2009 update</article-title>. <source>PLoS One</source><volume>4</volume><issue>3</issue>:<fpage>e4724.</fpage><pub-id pub-id-type="pmid">19266092</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bickelmann</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Morrow</surname><given-names>JM</given-names></name>, <name name-style="western"><surname>Du</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Schott</surname><given-names>RK</given-names></name>, <name name-style="western"><surname>Hazel</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Lim</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Müller</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Chang</surname><given-names>BS.</given-names></name></person-group><year>2015</year><article-title>The molecular origin and evolution of dim‐light vision in mammals</article-title>. <source>Evolution</source><volume>69</volume><issue>11</issue>:<fpage>2995</fpage>–<lpage>3003</lpage>.<pub-id pub-id-type="pmid">26536060</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Brier</surname><given-names>GW.</given-names></name></person-group><year>1950</year><article-title>Verification of forecasts expressed in terms of probability</article-title>. <source>Monthly Weather Rev</source>. <volume>78</volume><issue>1</issue>:<fpage>1</fpage>–<lpage>3</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Busch</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Rajendran</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Heyn</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Schlee</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Merkl</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Sterner</surname><given-names>R.</given-names></name></person-group><year>2016</year><article-title>Ancestral tryptophan synthase reveals functional sophistication of primordial enzyme complexes</article-title>. <source>Cell Chem Biol</source>. <volume>23</volume><issue>6</issue>:<fpage>709</fpage>–<lpage>715</lpage>.<pub-id pub-id-type="pmid">27291401</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Byrd</surname><given-names>RH</given-names></name>, <name name-style="western"><surname>Lu</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Nocedal</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Zhu</surname><given-names>C.</given-names></name></person-group><year>1995</year><article-title>A limited memory algorithm for bound constrained optimization</article-title>. <source>SIAM J Sci Comput</source>. <volume>16</volume><issue>5</issue>:<fpage>1190</fpage>–<lpage>1208</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Castro</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Pillay</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Cane</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Asboe</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Cambiano</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Phillips</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Dunn</surname><given-names>DT</given-names></name>, <name name-style="western"><surname>Aitken</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Asboe</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Webster</surname><given-names>D</given-names></name></person-group>,
<etal>et al</etal><year>2013</year><article-title>Persistence of HIV-1 transmitted drug resistance mutations</article-title>. <source>J Infect Dis</source>. <volume>208</volume><issue>9</issue>:<fpage>1459</fpage>–<lpage>1463</lpage>.<pub-id pub-id-type="pmid">23904291</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Chevenet</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Jung</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Peeters</surname><given-names>M</given-names></name>, <name name-style="western"><surname>De Oliveira</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Gascuel</surname><given-names>O.</given-names></name></person-group><year>2013</year><article-title>Searching for virus phylotypes</article-title>. <source>Bioinformatics</source><volume>29</volume><issue>5</issue>:<fpage>561</fpage>–<lpage>570</lpage>.<pub-id pub-id-type="pmid">23329414</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Collins</surname><given-names>TM</given-names></name>, <name name-style="western"><surname>Wimberger</surname><given-names>PH</given-names></name>, <name name-style="western"><surname>Naylor</surname><given-names>GJ.</given-names></name></person-group><year>1994</year><article-title>Compositional bias, character-state bias, and character-state reconstruction using parsimony</article-title>. <source>Syst Biol</source>. <volume>43</volume><issue>4</issue>:<fpage>482</fpage>–<lpage>496</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA</given-names></name>, <name name-style="western"><surname>Xie</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A.</given-names></name></person-group><year>2012</year><article-title>Bayesian phylogenetics with BEAUti and the BEAST 1.7</article-title>. <source>Mol Biol Evol</source>. <volume>29</volume><issue>8</issue>:<fpage>1969</fpage>–<lpage>1973</lpage>.<pub-id pub-id-type="pmid">22367748</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Dudas</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Carvalho</surname><given-names>LM</given-names></name>, <name name-style="western"><surname>Bedford</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Tatem</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Baele</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Faria</surname><given-names>NR</given-names></name>, <name name-style="western"><surname>Park</surname><given-names>DJ</given-names></name>, <name name-style="western"><surname>Ladner</surname><given-names>JT</given-names></name>, <name name-style="western"><surname>Arias</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Asogun</surname><given-names>D</given-names></name></person-group>,
<etal>et al</etal><year>2017</year><article-title>Virus genomes reveal factors that spread and sustained the Ebola epidemic</article-title>. <source>Nature</source><volume>544</volume><issue>7650</issue>:<fpage>309.</fpage><pub-id pub-id-type="pmid">28405027</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Durães-Carvalho</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Salemi</surname><given-names>M.</given-names></name></person-group><year>2018</year><article-title>In-depth phylodynamics, evolutionary analysis and in silico predictions of universal epitopes of Influenza A subtypes and Influenza B viruses</article-title>. <source>Mol Phylogenet Evol</source>. <volume>121</volume>:<fpage>174</fpage>–<lpage>182</lpage>.<pub-id pub-id-type="pmid">29355604</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Edwards</surname><given-names>CJ</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA</given-names></name>, <name name-style="western"><surname>Lemey</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Welch</surname><given-names>JJ</given-names></name>, <name name-style="western"><surname>Barnes</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Fulton</surname><given-names>TL</given-names></name>, <name name-style="western"><surname>Barnett</surname><given-names>R</given-names></name>, <name name-style="western"><surname>O’Connell</surname><given-names>TC</given-names></name>, <name name-style="western"><surname>Coxon</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Monaghan</surname><given-names>N.</given-names></name></person-group><year>2011</year><article-title>Ancient hybridization and an Irish origin for the modern polar bear matriline</article-title>. <source>Curr Biol</source>. <volume>21</volume><issue>15</issue>:<fpage>1251</fpage>–<lpage>1258</lpage>.<pub-id pub-id-type="pmid">21737280</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Endress</surname><given-names>PK</given-names></name>, <name name-style="western"><surname>Doyle</surname><given-names>JA.</given-names></name></person-group><year>2009</year><article-title>Reconstructing the ancestral angiosperm flower and its initial specializations</article-title>. <source>Am J Bot</source>. <volume>96</volume><issue>1</issue>:<fpage>22</fpage>–<lpage>66</lpage>.<pub-id pub-id-type="pmid">21628175</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Faria</surname><given-names>NR</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA</given-names></name>, <name name-style="western"><surname>Baele</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Bedford</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Ward</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Tatem</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Sousa</surname><given-names>JD</given-names></name>, <name name-style="western"><surname>Arinaminpathy</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Pépin</surname><given-names>J</given-names></name></person-group>,
<etal>et al</etal><year>2014</year><article-title>HIV epidemiology. The early spread and epidemic ignition of HIV-1 in human populations</article-title>. <source>Science</source><volume>346</volume><issue>6205</issue>:<fpage>56</fpage>–<lpage>61</lpage>.<pub-id pub-id-type="pmid">25278604</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Felsenstein</surname><given-names>J.</given-names></name></person-group><year>1981</year><article-title>Evolutionary trees from DNA sequences: a maximum likelihood approach</article-title>. <source>J Mol Evol</source>. <volume>17</volume><issue>6</issue>:<fpage>368</fpage>–<lpage>376</lpage>.<pub-id pub-id-type="pmid">7288891</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B20">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Felsenstein</surname><given-names>J.</given-names></name></person-group><year>2004</year><source>Inferring phylogenies</source>.
<publisher-loc>Sunderland (MA</publisher-loc>):
<publisher-name>Sinauer</publisher-name>.</mixed-citation>
    </ref>
    <ref id="msz131-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Franz</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Lopes</surname><given-names>CT</given-names></name>, <name name-style="western"><surname>Huck</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Dong</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Sumer</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Bader</surname><given-names>GD.</given-names></name></person-group><year>2016</year><article-title>Cytoscape.js: a graph theory library for visualisation and analysis</article-title>. <source>Bioinformatics</source><volume>32</volume><issue>2</issue>:<fpage>309</fpage>–<lpage>311</lpage>.<pub-id pub-id-type="pmid">26415722</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gallant</surname><given-names>JE.</given-names></name></person-group><year>2006</year><article-title>The M184V mutation: what it does, how to prevent it, and what to do with it when it’s there</article-title>. <source>AIDS Reader</source><volume>16</volume><issue>10</issue>:<fpage>556</fpage>–<lpage>559</lpage>.<pub-id pub-id-type="pmid">17096474</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gascuel</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Steel</surname><given-names>M.</given-names></name></person-group><year>2014</year><article-title>Predicting the ancestral character changes in a tree is typically easier than predicting the root state</article-title>. <source>Syst Biol</source>. <volume>63</volume><issue>3</issue>:<fpage>421</fpage>–<lpage>435</lpage>.<pub-id pub-id-type="pmid">24562915</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gascuel</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Steel</surname><given-names>M.</given-names></name></person-group><year>2018</year><article-title>A Darwinian uncertainty principle</article-title>. <source>BioRxiv</source>. <pub-id pub-id-type="doi">10.1101/506535</pub-id>.</mixed-citation>
    </ref>
    <ref id="msz131-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gneiting</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Raftery</surname><given-names>AE.</given-names></name></person-group><year>2007</year><article-title>Strictly proper scoring rules, prediction, and estimation</article-title>. <source>J Am Stat Assoc</source>. <volume>102</volume><issue>477</issue>:<fpage>359</fpage>–<lpage>378</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Goloboff</surname><given-names>PA</given-names></name>, <name name-style="western"><surname>Catalano</surname><given-names>SA.</given-names></name></person-group><year>2016</year><article-title>TNT version 1.5, including a full implementation of phylogenetic morphometrics</article-title>. <source>Cladistics</source><volume>32</volume><issue>3</issue>:<fpage>221</fpage>–<lpage>238</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gräf</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Vrancken</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Junqueira</surname><given-names>DM</given-names></name>, <name name-style="western"><surname>de Medeiros</surname><given-names>RM</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA</given-names></name>, <name name-style="western"><surname>Lemey</surname><given-names>P</given-names></name>, <name name-style="western"><surname>de Matos Almeida</surname><given-names>SE</given-names></name>, <name name-style="western"><surname>Pinto</surname><given-names>AR.</given-names></name></person-group><year>2015</year><article-title>Contribution of epidemiological predictors in unraveling the phylogeographic history of HIV-1 subtype C in Brazil</article-title>. <source>J Virol</source>. <volume>89</volume><issue>24</issue>:<fpage>12341</fpage>–<lpage>12348</lpage>.<pub-id pub-id-type="pmid">26423943</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B28">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Guiasu</surname><given-names>S.</given-names></name></person-group><year>1977</year><source>Information theory with applications</source>.
<publisher-loc>New York</publisher-loc>:
<publisher-name>McGraw-Hill</publisher-name>.</mixed-citation>
    </ref>
    <ref id="msz131-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Guindon</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Dufayard</surname><given-names>JF</given-names></name>, <name name-style="western"><surname>Lefort</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Anisimova</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Hordijk</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Gascuel</surname><given-names>O.</given-names></name></person-group><year>2010</year><article-title>New algorithms and methods to estimate maximum-likelihood phylogenies: assessing the performance of PhyML 3.0</article-title>. <source>Syst Biol</source>. <volume>59</volume><issue>3</issue>:<fpage>307</fpage>–<lpage>321</lpage>.<pub-id pub-id-type="pmid">20525638</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Hanson-Smith</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Kolaczkowski</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Thornton</surname><given-names>J.</given-names></name></person-group><year>2010</year><article-title>Robustness of ancestral sequence reconstruction to phylogenetic uncertainty</article-title>. <source>Mol Biol Evol</source>. <volume>27</volume><issue>9</issue>:<fpage>1988</fpage>–<lpage>1999</lpage>.<pub-id pub-id-type="pmid">20368266</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Hasegawa</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Kishino</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Yano</surname><given-names>TA.</given-names></name></person-group><year>1985</year><article-title>Dating of the human-ape splitting by a molecular clock of mitochondrial DNA</article-title>. <source>J Mol Evol</source>. <volume>22</volume><issue>2</issue>:<fpage>160</fpage>–<lpage>174</lpage>.<pub-id pub-id-type="pmid">3934395</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Hemelaar</surname><given-names>J.</given-names></name></person-group><year>2012</year><article-title>The origin and diversity of the HIV-1 pandemic</article-title>. <source>Trends Mol Med</source>. <volume>18</volume><issue>3</issue>:<fpage>182</fpage>–<lpage>192</lpage>.<pub-id pub-id-type="pmid">22240486</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Holmes</surname><given-names>EC</given-names></name>, <name name-style="western"><surname>Dudas</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Andersen</surname><given-names>KG.</given-names></name></person-group><year>2016</year><article-title>The evolution of Ebola virus: insights from the 2013–2016 epidemic</article-title>. <source>Nature</source><volume>538</volume><issue>7624</issue>:<fpage>193.</fpage><pub-id pub-id-type="pmid">27734858</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Huelsenbeck</surname><given-names>JP</given-names></name>, <name name-style="western"><surname>Bollback</surname><given-names>JP.</given-names></name></person-group><year>2001</year><article-title>Empirical and hierarchical Bayesian estimation of ancestral states</article-title>. <source>Syst Biol</source>. <volume>50</volume><issue>3</issue>:<fpage>351</fpage>–<lpage>366</lpage>.<pub-id pub-id-type="pmid">12116580</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Huelsenbeck</surname><given-names>JP</given-names></name>, <name name-style="western"><surname>Nielsen</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Bollback</surname><given-names>JP.</given-names></name></person-group><year>2003</year><article-title>Stochastic mapping of morphological characters</article-title>. <source>Syst Biol</source>. <volume>52</volume><issue>2</issue>:<fpage>131</fpage>–<lpage>158</lpage>.<pub-id pub-id-type="pmid">12746144</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Iwasaki</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Takagi</surname><given-names>T.</given-names></name></person-group><year>2007</year><article-title>Reconstruction of highly heterogeneous gene-content evolution across the three domains of life</article-title>. <source>Bioinformatics</source><volume>23</volume><issue>13</issue>:<fpage>i230</fpage>–<lpage>i239</lpage>.<pub-id pub-id-type="pmid">17646301</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Jones</surname><given-names>DT</given-names></name>, <name name-style="western"><surname>Taylor</surname><given-names>WR</given-names></name>, <name name-style="western"><surname>Thornton</surname><given-names>JM.</given-names></name></person-group><year>1992</year><article-title>The rapid generation of mutation data matrices from protein sequences</article-title>. <source>Bioinformatics</source><volume>8</volume><issue>3</issue>:<fpage>275</fpage>–<lpage>282</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B38">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Jukes</surname><given-names>TH</given-names></name>, <name name-style="western"><surname>Cantor</surname><given-names>CR.</given-names></name></person-group><year>1969</year><article-title>Evolution of protein molecules</article-title>. <source>Mamm Protein Metab</source>. <volume>3</volume><issue>21</issue>:<fpage>132.</fpage></mixed-citation>
    </ref>
    <ref id="msz131-B39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Jung</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Leye</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Vidal</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Fargette</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Diop</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Toure Kane</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Gascuel</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Peeters</surname><given-names>M.</given-names></name></person-group><year>2012</year><article-title>The origin and evolutionary history of HIV-1 subtype C in Senegal</article-title>. <source>PLoS One</source><volume>7</volume><issue>3</issue>:<fpage>e33579.</fpage><pub-id pub-id-type="pmid">22470456</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B40">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Katoh</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Standley</surname><given-names>DM.</given-names></name></person-group><year>2013</year><article-title>MAFFT multiple sequence alignment software version 7: improvements in performance and usability</article-title>. <source>Mol Biol Evol</source>. <volume>30</volume><issue>4</issue>:<fpage>772</fpage>–<lpage>780</lpage>.<pub-id pub-id-type="pmid">23329690</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B41">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Köster</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Rahmann</surname><given-names>S.</given-names></name></person-group><year>2012</year><article-title>Snakemake—a scalable bioinformatics workflow engine</article-title>. <source>Bioinformatics</source><volume>28</volume><issue>19</issue>:<fpage>2520</fpage>–<lpage>2522</lpage>.<pub-id pub-id-type="pmid">22908215</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B42">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Kühnert</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Vaughan</surname><given-names>TG</given-names></name>, <name name-style="western"><surname>Drummond</surname><given-names>AJ.</given-names></name></person-group><year>2014</year><article-title>Simultaneous reconstruction of evolutionary history and epidemiological dynamics from viral sequences with the birth–death SIR model</article-title>. <source>J R Soc Interface</source><volume>11</volume><issue>94</issue>:<fpage>20131106.</fpage><pub-id pub-id-type="pmid">24573331</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B43">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Kühnert</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Vaughan</surname><given-names>TG</given-names></name>, <name name-style="western"><surname>Drummond</surname><given-names>AJ.</given-names></name></person-group><year>2016</year><article-title>Phylodynamics with migration: a computational framework to quantify population structure from genomic data</article-title>. <source>Mol Biol Evol</source>. <volume>33</volume><issue>8</issue>:<fpage>2102</fpage>–<lpage>2116</lpage>.<pub-id pub-id-type="pmid">27189573</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B44">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lambert</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Alexander</surname><given-names>HK</given-names></name>, <name name-style="western"><surname>Stadler</surname><given-names>T.</given-names></name></person-group><year>2014</year><article-title>Phylogenetic analysis accounting for age-dependent death and sampling with applications to epidemics</article-title>. <source>J Theor Biol</source>. <volume>352</volume>:<fpage>60</fpage>–<lpage>70</lpage>.<pub-id pub-id-type="pmid">24607743</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B45">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lemey</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Bedford</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Faria</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Bielejec</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Baele</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Russell</surname><given-names>CA</given-names></name>, <name name-style="western"><surname>Smith</surname><given-names>DJ</given-names></name>, <name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name>, <name name-style="western"><surname>Brockmann</surname><given-names>D</given-names></name></person-group>,
<etal>et al</etal><year>2014</year><article-title>Unifying viral genetics and human transportation data to predict the global transmission dynamics of human influenza H3N2</article-title>. <source>PLoS Pathog</source>. <volume>10</volume><issue>2</issue>:<fpage>e1003932.</fpage><pub-id pub-id-type="pmid">24586153</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B46">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lemey</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA.</given-names></name></person-group><year>2009</year><article-title>Bayesian phylogeography finds its roots</article-title>. <source>PLoS Comput Biol</source>. <volume>5</volume><issue>9</issue>:<fpage>e1000520.</fpage><pub-id pub-id-type="pmid">19779555</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B47">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Letunic</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Bork</surname><given-names>P.</given-names></name></person-group><year>2016</year><article-title>Interactive tree of life (iTOL) v3: an online tool for the display and annotation of phylogenetic and other trees</article-title>. <source>Nucleic Acids Res</source>. <volume>44</volume>(<issue>W1</issue>):<fpage>W242</fpage>–<lpage>W245</lpage>.<pub-id pub-id-type="pmid">27095192</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B48">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Leventhal</surname><given-names>GE</given-names></name>, <name name-style="western"><surname>Günthard</surname><given-names>HF</given-names></name>, <name name-style="western"><surname>Bonhoeffer</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Stadler</surname><given-names>T.</given-names></name></person-group><year>2014</year><article-title>Using an epidemiological model for phylogenetic inference reveals density dependence in HIV transmission</article-title>. <source>Mol Biol Evol</source>. <volume>31</volume><issue>1</issue>:<fpage>6</fpage>–<lpage>17</lpage>.<pub-id pub-id-type="pmid">24085839</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B49">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lewis</surname><given-names>NS</given-names></name>, <name name-style="western"><surname>Verhagen</surname><given-names>JH</given-names></name>, <name name-style="western"><surname>Javakhishvili</surname><given-names>Z</given-names></name>, <name name-style="western"><surname>Russell</surname><given-names>CA</given-names></name>, <name name-style="western"><surname>Lexmond</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Westgeest</surname><given-names>KB</given-names></name>, <name name-style="western"><surname>Bestebroer</surname><given-names>TM</given-names></name>, <name name-style="western"><surname>Halpin</surname><given-names>RA</given-names></name>, <name name-style="western"><surname>Lin</surname><given-names>X</given-names></name>, <name name-style="western"><surname>Ransier</surname><given-names>A</given-names></name></person-group>,
<etal>et al</etal><year>2015</year><article-title>Influenza A virus evolution and spatio-temporal dynamics in Eurasian wild birds: a phylogenetic and phylogeographical study of whole-genome sequence data</article-title>. <source>J Gen Virol</source>. <volume>96</volume><issue>8</issue>:<fpage>2050</fpage>–<lpage>2060</lpage>.<pub-id pub-id-type="pmid">25904147</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B50">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Liu</surname><given-names>TF</given-names></name>, <name name-style="western"><surname>Shafer</surname><given-names>RW.</given-names></name></person-group><year>2006</year><article-title>Web resources for HIV type 1 genotypic-resistance test interpretation</article-title>. <source>Clin Infect Dis</source>. <volume>42</volume><issue>11</issue>:<fpage>1608</fpage>–<lpage>1618</lpage>.<pub-id pub-id-type="pmid">16652319</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B51">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Maddison</surname><given-names>WP</given-names></name>, <name name-style="western"><surname>Maddison</surname><given-names>DR.</given-names></name></person-group><year>2000</year><source>MacClade, version 4.0</source>.
<publisher-loc>Sunderland (MA</publisher-loc>):
<publisher-name>Sinauer</publisher-name>.</mixed-citation>
    </ref>
    <ref id="msz131-B52">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Magee</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA</given-names></name>, <name name-style="western"><surname>Scotch</surname><given-names>M.</given-names></name></person-group><year>2017</year><article-title>Bayesian phylogeography of influenza A/H3N2 for the 2014-15 season in the United States using three frameworks of ancestral state reconstruction</article-title>. <source>PLoS Comput Biol</source>. <volume>13</volume><issue>2</issue>:<fpage>e1005389.</fpage><pub-id pub-id-type="pmid">28170397</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B53">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Maor</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Dayan</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Ferguson-Gow</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Jones</surname><given-names>KE.</given-names></name></person-group><year>2017</year><article-title>Temporal niche expansion in mammals from a nocturnal ancestor after dinosaur extinction</article-title>. <source>Nat Ecol Evol</source>. <volume>1</volume><issue>12</issue>:<fpage>1889</fpage>–<lpage>1895</lpage>.<pub-id pub-id-type="pmid">29109469</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B54">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Marazzi</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Ané</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Simon</surname><given-names>MF</given-names></name>, <name name-style="western"><surname>Delgado-Salinas</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Luckow</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Sanderson</surname><given-names>MJ.</given-names></name></person-group><year>2012</year><article-title>Locating evolutionary precursors on a phylogenetic tree</article-title>. <source>Evolution</source><volume>66</volume><issue>12</issue>:<fpage>3918</fpage>–<lpage>3930</lpage>.<pub-id pub-id-type="pmid">23206146</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B55">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Mir</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Gräf</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Esteves de Matos Almeida</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Pinto</surname><given-names>AR</given-names></name>, <name name-style="western"><surname>Delatorre</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Bello</surname><given-names>G.</given-names></name></person-group><year>2018</year><article-title>Inferring population dynamics of HIV-1 subtype C epidemics in Eastern Africa and Southern Brazil applying different Bayesian phylodynamics approaches</article-title>. <source>Sci Rep</source>. <volume>8</volume><issue>1</issue>:<fpage>8778.</fpage><pub-id pub-id-type="pmid">29884822</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B56">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Mooers</surname><given-names>AØ</given-names></name>, <name name-style="western"><surname>Schluter</surname><given-names>D.</given-names></name></person-group><year>1999</year><article-title>Reconstructing ancestor states with maximum likelihood: support for one-and two-rate models</article-title>. <source>Syst Biol</source>. <volume>48</volume><issue>3</issue>:<fpage>623</fpage>–<lpage>633</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B57">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Mourad</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Chevennet</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Dunn</surname><given-names>DT</given-names></name>, <name name-style="western"><surname>Fearnhill</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Delpech</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Asboe</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Gascuel</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Hue</surname><given-names>S.</given-names></name></person-group><year>2015</year><article-title>A phylotype-based analysis highlights the role of drug-naive HIV-positive individuals in the transmission of antiretroviral resistance in the UK</article-title>. <source>AIDS</source><volume>29</volume><issue>15</issue>:<fpage>1917</fpage>–<lpage>1925</lpage>.<pub-id pub-id-type="pmid">26355570</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B58">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Nielsen</surname><given-names>R.</given-names></name></person-group><year>2002</year><article-title>Mapping mutations on phylogenies</article-title>. <source>Syst Biol</source>. <volume>51</volume><issue>5</issue>:<fpage>729</fpage>–<lpage>739</lpage>.<pub-id pub-id-type="pmid">12396587</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B59">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Oliphant</surname><given-names>TE.</given-names></name></person-group><year>2007</year><article-title>Python for scientific computing</article-title>. <source>Comput Sci Eng</source>. <volume>9</volume><issue>3</issue>:<fpage>10</fpage>–<lpage>20</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B60">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Oliva</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Pulicani</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Lefort</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Brehelin</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Gascuel</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Guindon</surname><given-names>S.</given-names></name></person-group> Forthcoming <year>2019</year> Accounting for ambiguity in ancestral sequence reconstruction. <italic>Bioinformatics</italic> Advanced Access, Published: 12 April 2019, <pub-id pub-id-type="doi">10.1093/bioinformatics/btz249</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B61">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Pagel</surname><given-names>M.</given-names></name></person-group><year>1999</year><article-title>The maximum likelihood approach to reconstructing ancestral character states of discrete characters on phylogenies</article-title>. <source>Syst Biol</source>. <volume>48</volume><issue>3</issue>:<fpage>612</fpage>–<lpage>622</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B62">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Pagel</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Meade</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Barker</surname><given-names>D.</given-names></name></person-group><year>2004</year><article-title>Bayesian estimation of ancestral character states on phylogenies</article-title>. <source>Syst Biol</source>. <volume>53</volume><issue>5</issue>:<fpage>673</fpage>–<lpage>684</lpage>.<pub-id pub-id-type="pmid">15545248</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B63">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Price</surname><given-names>MN</given-names></name>, <name name-style="western"><surname>Dehal</surname><given-names>PS</given-names></name>, <name name-style="western"><surname>Arkin</surname><given-names>AP.</given-names></name></person-group><year>2010</year><article-title>FastTree 2—approximately maximum-likelihood trees for large alignments</article-title>. <source>PLoS One</source><volume>5</volume>:<fpage>e9590</fpage>.<pub-id pub-id-type="pmid">20231880</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B64">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Pupko</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Pe</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Shamir</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Graur</surname><given-names>D.</given-names></name></person-group><year>2000</year><article-title>A fast algorithm for joint reconstruction of ancestral amino acid sequences</article-title>. <source>Mol Biol Evol</source>. <volume>17</volume><issue>6</issue>:<fpage>890</fpage>–<lpage>896</lpage>.<pub-id pub-id-type="pmid">10833195</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B65">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Grass</surname><given-names>NC.</given-names></name></person-group><year>1997</year><article-title>Seq-Gen: an application for the Monte Carlo simulation of DNA sequence evolution along phylogenetic trees</article-title>. <source>Bioinformatics</source><volume>13</volume><issue>3</issue>:<fpage>235</fpage>–<lpage>238</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B66">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Ratmann</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Hodcroft</surname><given-names>EB</given-names></name>, <name name-style="western"><surname>Pickles</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Cori</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Hall</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Lycett</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Colijn</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Dearlove</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Didelot</surname><given-names>X</given-names></name>, <name name-style="western"><surname>Frost</surname><given-names>S</given-names></name></person-group>,
<etal>et al</etal><year>2017</year><article-title>Phylogenetic tools for generalized HIV-1 epidemics: findings from the PANGEA-HIV methods comparison</article-title>. <source>Mol Biol Evol</source>. <volume>34</volume><issue>1</issue>:<fpage>185</fpage>–<lpage>203</lpage>.<pub-id pub-id-type="pmid">28053012</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B67">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Ree</surname><given-names>RH</given-names></name>, <name name-style="western"><surname>Smith</surname><given-names>SA.</given-names></name></person-group><year>2008</year><article-title>Maximum likelihood inference of geographic range evolution by dispersal, local extinction, and cladogenesis</article-title>. <source>Syst Biol</source>. <volume>57</volume><issue>1</issue>:<fpage>4</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">18253896</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B68">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Sagulenko</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Puller</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Neher</surname><given-names>RA.</given-names></name></person-group><year>2018</year><article-title>TreeTime: maximum-likelihood phylodynamic analysis</article-title>. <source>Virus Evol</source>. <volume>4</volume><issue>1</issue>:<fpage>vex042.</fpage><pub-id pub-id-type="pmid">29340210</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B69">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Sauquet</surname><given-names>H</given-names></name>, <name name-style="western"><surname>von Balthazar</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Magallón</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Doyle</surname><given-names>JA</given-names></name>, <name name-style="western"><surname>Endress</surname><given-names>PK</given-names></name>, <name name-style="western"><surname>Bailes</surname><given-names>EJ</given-names></name>, <name name-style="western"><surname>Barroso de Morais</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Bull-Hereñu</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Carrive</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Chartier</surname><given-names>M</given-names></name></person-group>,
<etal>et al</etal><year>2017</year><article-title>The ancestral flower of angiosperms and its early diversification</article-title>. <source>Nat Commun</source>. <volume>8</volume>:<fpage>16047.</fpage><pub-id pub-id-type="pmid">28763051</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B70">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Bonhoeffer</surname><given-names>S.</given-names></name></person-group><year>2013</year><article-title>Uncovering epidemiological dynamics in heterogeneous host populations using phylogenetic methods</article-title>. <source>Philos Trans R Soc B Biol Sci</source>. <volume>368</volume><issue>1614</issue>:<fpage>20120198.</fpage></mixed-citation>
    </ref>
    <ref id="msz131-B71">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Stamatakis</surname><given-names>A.</given-names></name></person-group><year>2014</year><article-title>RAxML version 8: a tool for phylogenetic analysis and post-analysis of large phylogenies</article-title>. <source>Bioinformatics</source><volume>30</volume><issue>9</issue>:<fpage>1312</fpage>–<lpage>1313</lpage>.<pub-id pub-id-type="pmid">24451623</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B72">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Steel</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Mooers</surname><given-names>A.</given-names></name></person-group><year>2010</year><article-title>The expected length of pendant and interior edges of a Yule tree</article-title>. <source>Appl Math Lett</source>. <volume>23</volume><issue>11</issue>:<fpage>1315</fpage>–<lpage>1319</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B73">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Swofford</surname><given-names>DL</given-names></name>, <name name-style="western"><surname>Maddison</surname><given-names>WP.</given-names></name></person-group><year>1987</year><article-title>Reconstructing ancestral character states under Wagner parsimony</article-title>. <source>Math Biosci</source>. <volume>87</volume><issue>2</issue>:<fpage>199</fpage>–<lpage>229</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B74">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Tavaré</surname><given-names>S.</given-names></name></person-group><year>1986</year><article-title>Some probabilistic and statistical problems in the analysis of DNA sequences</article-title>. <source>Lect Math Life Sci</source>. <volume>17</volume><issue>2</issue>:<fpage>57</fpage>–<lpage>86</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B75">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>To</surname><given-names>HT</given-names></name>, <name name-style="western"><surname>Jung</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Lycett</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Gascuel</surname><given-names>O.</given-names></name></person-group><year>2016</year><article-title>Fast dating using least-squares criteria and algorithms</article-title>. <source>Syst Biol</source>. <volume>65</volume><issue>1</issue>:<fpage>82</fpage>–<lpage>97</lpage>.<pub-id pub-id-type="pmid">26424727</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B76">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Vidal</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Peeters</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Mulanga-Kabeya</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Nzilambi</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Robertson</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Ilunga</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Sema</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Tshimanga</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Bongo</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Delaporte</surname><given-names>E.</given-names></name></person-group><year>2000</year><article-title>Unprecedented degree of human immunodeficiency virus type 1 (HIV-1) group M genetic diversity in the Democratic Republic of Congo suggests that the HIV-1 pandemic originated in Central Africa</article-title>. <source>J Virol</source>. <volume>74</volume><issue>22</issue>:<fpage>10498</fpage>–<lpage>10507</lpage>.<pub-id pub-id-type="pmid">11044094</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B77">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Walimbe</surname><given-names>AM</given-names></name>, <name name-style="western"><surname>Lotankar</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Cecilia</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Cherian</surname><given-names>SS.</given-names></name></person-group><year>2014</year><article-title>Global phylogeography of Dengue type 1 and 2 viruses reveals the role of India</article-title>. <source>Infect Genet Evol</source>. <volume>22</volume>:<fpage>30</fpage>–<lpage>39</lpage>.<pub-id pub-id-type="pmid">24418211</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B78">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Wallace</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Hodac</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Lathrop</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Fitch</surname><given-names>W.</given-names></name></person-group><year>2007</year><article-title>A statistical phylogeography of influenza A H5N1</article-title>. <source>Proc Natl Acad Sci U S A</source>. <volume>104</volume><issue>11</issue>:<fpage>4473</fpage>–<lpage>4478</lpage>.<pub-id pub-id-type="pmid">17360548</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B79">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Werner</surname><given-names>GD</given-names></name>, <name name-style="western"><surname>Cornwell</surname><given-names>WK</given-names></name>, <name name-style="western"><surname>Sprent</surname><given-names>JI</given-names></name>, <name name-style="western"><surname>Kattge</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Kiers</surname><given-names>ET.</given-names></name></person-group><year>2014</year><article-title>A single evolutionary innovation drives the deep evolution of symbiotic N2-fixation in angiosperms</article-title>. <source>Nat Commun</source>. <volume>5</volume>:<fpage>4087.</fpage><pub-id pub-id-type="pmid">24912610</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B80">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Yang</surname><given-names>Z.</given-names></name></person-group><year>2007</year><article-title>PAML 4: phylogenetic analysis by maximum likelihood</article-title>. <source>Mol Biol Evol</source>. <volume>24</volume><issue>8</issue>:<fpage>1586</fpage>–<lpage>1591</lpage>.<pub-id pub-id-type="pmid">17483113</pub-id></mixed-citation>
    </ref>
    <ref id="msz131-B81">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Zhang</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Nei</surname><given-names>M.</given-names></name></person-group><year>1997</year><article-title>Accuracies of ancestral amino acid sequences inferred by the parsimony, likelihood, and distance methods</article-title>. <source>J Mol Evol</source>. <volume>44</volume><issue>1</issue>:<fpage>139</fpage>–<lpage>146</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B82">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Zhu</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Byrd</surname><given-names>RH</given-names></name>, <name name-style="western"><surname>Lu</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Nocedal</surname><given-names>J.</given-names></name></person-group><year>1997</year><article-title>Algorithm 778: l -BFGS-B: Fortran subroutines for large-scale bound-constrained optimization</article-title>. <source>ACM Trans Math Softw</source>. <volume>23</volume><issue>4</issue>:<fpage>550</fpage>–<lpage>560</lpage>.</mixed-citation>
    </ref>
    <ref id="msz131-B83">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Zhukova</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Cutino-Moguel</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Gascuel</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Pillay</surname><given-names>D.</given-names></name></person-group><year>2017</year><article-title>The role of phylogenetics as a tool to predict the spread of resistance</article-title>. <source>J Infect Dis</source>. <volume>216(Suppl 9)</volume>:<fpage>S820</fpage>–<lpage>S823</lpage>.<pub-id pub-id-type="pmid">29029155</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
