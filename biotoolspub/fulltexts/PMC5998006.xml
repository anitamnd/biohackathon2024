<?properties open_access?>
<?subarticle report34839?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v3.0 20080202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing3.dtd?>
<?SourceDTD.Version 3.0?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">F1000Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">F1000Res</journal-id>
    <journal-id journal-id-type="pmc">F1000Research</journal-id>
    <journal-title-group>
      <journal-title>F1000Research</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2046-1402</issn>
    <publisher>
      <publisher-name>F1000 Research Limited</publisher-name>
      <publisher-loc>London, UK</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5998006</article-id>
    <article-id pub-id-type="doi">10.12688/f1000research.14148.2</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software Tool Article</subject>
      </subj-group>
      <subj-group>
        <subject>Articles</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>segment_liftover : a Python tool to convert segments between genome assemblies</article-title>
      <fn-group content-type="pub-status">
        <fn>
          <p>[version 2; referees: 2 approved]</p>
        </fn>
      </fn-group>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Gao</surname>
          <given-names>Bo</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Software</role>
        <role content-type="http://credit.casrai.org/">Writing – Original Draft Preparation</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-2818-4000</contrib-id>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Huang</surname>
          <given-names>Qingyao</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Formal Analysis</role>
        <role content-type="http://credit.casrai.org/">Visualization</role>
        <role content-type="http://credit.casrai.org/">Writing – Original Draft Preparation</role>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Baudis</surname>
          <given-names>Michael</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Supervision</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-9903-4248</contrib-id>
        <xref ref-type="corresp" rid="c1">a</xref>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <aff id="a1"><label>1</label>Institute of molecular Life Sciences, University of Zürich, Zürich, CH-8057, Switzerland</aff>
      <aff id="a2"><label>2</label>Swiss Institute of Bioinformatics, University of Zürich, Zürich, CH-8057, Switzerland</aff>
    </contrib-group>
    <author-notes>
      <corresp id="c1">
        <label>a</label>
        <email xlink:href="mailto:mbaudis@me.com">mbaudis@me.com</email>
      </corresp>
      <fn fn-type="COI-statement">
        <p>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>8</day>
      <month>6</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2018</year>
    </pub-date>
    <volume>7</volume>
    <elocation-id>319</elocation-id>
    <history>
      <date date-type="accepted">
        <day>1</day>
        <month>6</month>
        <year>2018</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright: © 2018 Gao B et al.</copyright-statement>
      <copyright-year>2018</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:type="simple" xlink:href="f1000research-7-16527.pdf"/>
    <abstract>
      <p>The process of assembling a species’ reference genome may be performed in a number of iterations, with subsequent genome assemblies differing in the coordinates of mapped elements. The conversion of genome coordinates between different assemblies is required for many integrative and comparative studies. While currently a number of bioinformatics tools are available to accomplish this task, most of them are tailored towards the conversion of single genome coordinates. When converting the boundary positions of segments spanning larger genome regions, segments may be mapped into smaller sub-segments if the original segment’s continuity is disrupted in the target assembly. Such a conversion may lead to a relevant degree of data loss in some circumstances such as copy number variation (CNV) analysis, where the quantitative representation of a genomic region takes precedence over base-specific accuracy.
<italic>segment_liftover</italic> aims at continuity-preserving remapping of genome segments between assemblies and provides features such as approximate locus conversion, automated batch processing and comprehensive logging to facilitate processing of datasets containing large numbers of structural genome variation data.</p>
    </abstract>
    <kwd-group kwd-group-type="author">
      <kwd>Genome assembly</kwd>
      <kwd>liftover</kwd>
      <kwd>remap</kwd>
      <kwd>copy number segment.</kwd>
    </kwd-group>
    <funding-group>
      <award-group id="fund-1">
        <funding-source>China Scholarship Council</funding-source>
        <award-id>201606620032</award-id>
      </award-group>
      <award-group id="fund-2">
        <funding-source>Universität Zürich</funding-source>
      </award-group>
      <funding-statement>BG is recipient of a grant from the China Scholarship Council (CSC 201606620032). QH is supported throughthe University of Zurich’s "CanDoc" program.</funding-statement>
      <funding-statement>
        <italic>The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</italic>
      </funding-statement>
    </funding-group>
  </article-meta>
  <notes notes-type="version-changes">
    <sec sec-type="version-changes">
      <label>Revised</label>
      <title>Amendments from Version 1</title>
      <p>In response to review comments: the logging and temp files mechanism is modified; new options are added to provide demonstration and more flexibility; the conversion result (previous figure 3) is replaced with a table, for clarity; adding more explanation for use-case 2 (comparison of different strategies) to elaborate the settings and purpose.</p>
    </sec>
  </notes>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>The first draft version of human genome was published in 2001
<sup><xref rid="ref-1" ref-type="bibr">1</xref></sup>. In subsequent years, several new editions were released to perfect the quality of the genome assembly. The current version of human genome (GRCh38, UCSC hg38) was made available in 2013, with the latest revision (Grch38.p12) still containing more than 10 million unplaced bases (
<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/assembly/GCA_000001405.27">see NCBI website</ext-link>). Over the years, large numbers of genomic studies have been performed, generating data mapped to different versions of the reference genome. However, when performing genome analyses integrating data from multiple resources, it is imperative to convert all data to the same genomic coordinate system.</p>
    <p>Two general methodologies are used for conversion between coordinates from different genome assemblies. The first approach is to re-align the original sequence data to the target assembly. This method could provide the best result but is very time-consuming, and is not possible if the original sequence data is not available or does not consist of direct sequences (i.e. segmentation of array based data). Another approach is to convert the coordinates of genome data between assemblies by using a mapping file. This method, although bearing a side effect of minor information loss, for most applications provides a good balance between performance and accuracy.</p>
    <p>Currently, three tools are in widespread use for the conversion between genome assemblies by coordinates:
<ext-link ext-link-type="uri" xlink:href="https://genome.ucsc.edu/cgi-bin/hgLiftOver"><italic>liftOver</italic></ext-link> from University of California, Santa Cruz (referred as
<italic>UCSC liftOver</italic> in the following article)
<sup><xref rid="ref-2" ref-type="bibr">2</xref></sup>;
<ext-link ext-link-type="uri" xlink:href="https://pypi.python.org/pypi/CrossMap/0.2.6"><italic>CrossMap</italic></ext-link> from Zhao
<sup><xref rid="ref-3" ref-type="bibr">3</xref></sup>; and
<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/genome/tools/remap"><italic>Remap</italic></ext-link> from NCBI
<sup><xref rid="ref-4" ref-type="bibr">4</xref></sup>. The
<italic>UCSC liftOver</italic> tool exists in two flavours, both as web service and command line utility. It offers the most comprehensive selection of assemblies for different organisms with the capability to convert between many of them.
<italic>CrossMap</italic> has the unique functionality to convert files in BAM/SAM or BigWig format. It generates almost identical results as
<italic>UCSC liftOver</italic>, but is not optimised for converting genome coordinates between species.
<italic>Remap</italic> provides for each organism a comprehensive list of major assemblies and the corresponding sub-versions. It can also perform cross species mapping, however, with only a limited number of organisms.</p>
    <p>All those tools are efficient in coordinate conversion and provide almost identical results. However, as shown in
<xref ref-type="fig" rid="f1">Figure 1a</xref>, challenges arise when dealing with genome segments that are not continuous anymore in the target assembly; there, these three tools take on different strategies.
<italic>CrossMap</italic> and
<italic>UCSC liftOver</italic> break the segment into smaller segments and map them to different locations.
<italic>Remap</italic> keeps the integrity of the segment and maps the span to the target assembly.</p>
    <fig fig-type="figure" id="f1" orientation="portrait" position="anchor">
      <label>Figure 1. </label>
      <caption>
        <title>The challenge of segment liftover:</title>
        <p>(
<bold>a</bold>) When lifting a segment to another assembly, the landscape of the segment may be affected by indels and copy number variations, but the overall span of the segment does not change significantly. (
<bold>b</bold>) When the end positions cannot be converted by the
<italic>UCSC liftOver</italic>, the nearby regions will be searched for convertible positions as approximation. (
<bold>c</bold>) Quality control checks for changes of chromosome or size to make sure the segment is converted properly.</p>
      </caption>
      <graphic xlink:href="f1000research-7-16527-g0000"/>
    </fig>
    <p>In research such as analysis of copy number variation (CNV) data, where the quantitative representation of a genomic range takes precedence over base-specific representation, the integrity of a continuous segment indicates the proper conversion between assemblies, but may not be a direct outcome of current re-mapping approaches. Although
<italic>Remap</italic> can convert contiguous segments, it only provides web service with submission limits, which is difficult to use for large scale or pipelined applications. The limitation to single input files is a general limitation of those tools, which precludes their direct use in comparative studies which may require to work with hundreds or thousands of files, as indicated through our own projects and requests from the research community.</p>
    <p>In this article, we introduce
<italic>segment_liftover</italic>, a tool to perform an integrity-preserving conversion of genomic segments data between genome assemblies. It features two major functional additions over existing tools: First, re-conversion by locus approximation, in instances where a precise conversion of genomic positions fails; and second, the capability to handle any number of files and optional integration into data processing pipelines with supporting features such as automatic file traversal, interruption resumption and detailed logging.</p>
  </sec>
  <sec sec-type="methods">
    <title>Methods</title>
    <sec>
      <title>Implementation</title>
      <p><italic>segment_liftover</italic> can convert both probe files and segment files at the same time or in separate runs. It starts from a structured directory or a list of files, then traverses and converts all files meeting the specified name pattern, and finally outputs to a designated directory. To convert a probe file,
<italic>segment_liftover</italic> will first use the
<italic>UCSC liftOver</italic> to convert the file, then apply an approximate conversion on probes that the
<italic>UCSC liftOver</italic> failed to convert. To convert a segment file,
<italic>segment_liftover</italic> will use the
<italic>UCSC liftOver</italic> to convert the
<italic>start</italic> and
<italic>end</italic> positions of segments. A successful segment conversion needs to satisfy the following four criteria:</p>
      <p>                                                                                                                
<italic>position
<sub>new_start</sub></italic> ≠ ∅                                                       (1)</p>
      <p>                                                                                                                  
<italic>position
<sub>new_end</sub></italic> ≠ ∅                                                       (2)</p>
      <p>                                                                                                       
<italic>chromosome
<sub>new_start</sub></italic> =
<italic>chromosome
<sub>new_end</sub></italic>                             (3)</p>
      <p>
        <disp-formula>
          <mml:math id="math1">
            <mml:mrow>
              <mml:mfrac>
                <mml:mn>1</mml:mn>
                <mml:mi>β</mml:mi>
              </mml:mfrac>
              <mml:mspace width="0.2em"/>
              <mml:mo>&lt;</mml:mo>
              <mml:mspace width="0.2em"/>
              <mml:mfrac>
                <mml:mrow>
                  <mml:mi>l</mml:mi>
                  <mml:mi>e</mml:mi>
                  <mml:mi>n</mml:mi>
                  <mml:mi>g</mml:mi>
                  <mml:mi>t</mml:mi>
                  <mml:mi>h</mml:mi>
                  <mml:mo stretchy="false">(</mml:mo>
                  <mml:mi>o</mml:mi>
                  <mml:mi>l</mml:mi>
                  <mml:mi>d</mml:mi>
                  <mml:mo>_</mml:mo>
                  <mml:mi>s</mml:mi>
                  <mml:mi>e</mml:mi>
                  <mml:mi>g</mml:mi>
                  <mml:mi>m</mml:mi>
                  <mml:mi>e</mml:mi>
                  <mml:mi>n</mml:mi>
                  <mml:mi>t</mml:mi>
                  <mml:mo stretchy="false">)</mml:mo>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi>l</mml:mi>
                  <mml:mi>e</mml:mi>
                  <mml:mi>n</mml:mi>
                  <mml:mi>g</mml:mi>
                  <mml:mi>t</mml:mi>
                  <mml:mi>h</mml:mi>
                  <mml:mo stretchy="false">(</mml:mo>
                  <mml:mi>n</mml:mi>
                  <mml:mi>e</mml:mi>
                  <mml:mi>w</mml:mi>
                  <mml:mo>_</mml:mo>
                  <mml:mi>s</mml:mi>
                  <mml:mi>e</mml:mi>
                  <mml:mi>g</mml:mi>
                  <mml:mi>m</mml:mi>
                  <mml:mi>e</mml:mi>
                  <mml:mi>n</mml:mi>
                  <mml:mi>t</mml:mi>
                  <mml:mo stretchy="false">)</mml:mo>
                </mml:mrow>
              </mml:mfrac>
              <mml:mspace width="0.2em"/>
              <mml:mo>&lt;</mml:mo>
              <mml:mi>β</mml:mi>
              <mml:mspace width="10em"/>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mn>4</mml:mn>
              <mml:mo stretchy="false">)</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>Where
<italic>β</italic> controls the threshold of the length ratio and the default value is set to 2. If criteria (1) or (2) fails,
<italic>segment_liftover</italic> will apply an approximate conversion; if the conversion still fails, it is reported as unconvertible. If criteria (3) or (4) fails, the conversion is reported as rejected (
<xref ref-type="fig" rid="f1">Figure 1c</xref>). The reason of failure is recorded in log files.</p>
      <p>When a position cannot be converted by the
<italic>UCSC liftOver</italic>,
<italic>segment_liftover</italic> will attempt an approximate conversion and try to find a convertible position in the adjacency (
<xref ref-type="fig" rid="f1">Figure 1b</xref>). The range and the resolution of the search is defined by parameters
<italic>–range</italic> and
<italic>–step_size</italic>, respectively.</p>
    </sec>
    <sec>
      <title>Operation</title>
      <p>The
<italic>segment_liftover</italic> tool is implemented in Python. The package is available for both Linux and OSX. It requires a minimum of 2G memory and the capacity of running Python 3. We recommend an installation using
<italic>pip</italic> in a Python virtual environment.
<italic>segment_liftover</italic> requires and depends on the
<italic>UCSC liftOver</italic> program. A chain file, which provides alignments from source to target assembly, is also required. The chain files between common human assemblies (hg18, hg19 and hg38) are included in the program package. Chain files of other species and assemblies are available from the USCS Genome Browser.
<xref ref-type="fig" rid="f2">Figure 2</xref> illustrates the work-flow of
<italic>segment_liftover</italic>.</p>
      <fig fig-type="figure" id="f2" orientation="portrait" position="anchor">
        <label>Figure 2. </label>
        <caption>
          <title>The workflow of
<italic>segment_liftover</italic>:</title>
          <p>(1) It can take either a folder or a file containing the list of files as the input. (2) It will try to convert by approximation when
<italic>UCSC liftOver</italic> fails to convert a coordinate. (3) The directory structure will be kept in the output folder and detailed log files are also available.</p>
        </caption>
        <graphic xlink:href="f1000research-7-16527-g0001"/>
      </fig>
    </sec>
  </sec>
  <sec>
    <title>Use cases</title>
    <p>In this section, we provide two examples of using
<italic>segment_liftover</italic> to convert probes and segments, respectively. The two examples are part of the pipeline which updates the
<italic>arrayMap</italic> database, a reference resource of somatic genome copy number variations in cancer
<sup><xref rid="ref-5" ref-type="bibr">5</xref></sup>, from human genome assembly hg19 to hg38.</p>
    <sec>
      <title>Converting arrayMap data from hg19 to hg38</title>
      <p>In the first example, we converted 44,632 probe files and 44,471 segment files from hg19 to hg38. The probe data were generated from nine
<ext-link ext-link-type="uri" xlink:href="https://www.affymetrix.com/support/technical/byproduct.affx?cat=arrays">Affymetrix genotyping array platforms</ext-link>, which currently only support annotations for hg19. Circular binary segmentation (CBS) analysis (DNAcopy R-package) was used to infer copy number segments from log2 values of probes. The final segment files contain a list of genomic regions separated by their copy number values
<sup><xref rid="ref-6" ref-type="bibr">6</xref></sup>. We ran the
<italic>segment_liftover</italic> tool on a 12-core, 128GB RAM machine with 8 parallel processes. It took 42 hours to convert 44,632 probe files with 5.5 billion probe positions and 40 minutes to convert 44,471 segment files with 4.8 million segments.</p>
      <p>Overall, more than 99.99% of probes and more than 99% of segments could be directly converted from hg19 to hg38 (
<xref ref-type="table" rid="T1">Table 1</xref>). As conversion of segments is more complicated and involves a quality control procedure to ensure the meaningfulness of the segment, it is expected to have a higher number of unconvertible segments than probes. As shown in
<xref ref-type="fig" rid="f3">Figure 3</xref>, the unconvertible regions are mainly around telomeres, centromeres, or other gene-sparse locations. In total, 38 genetic elements were found to be affected by the conversion (description in
<xref ref-type="other" rid="ST1">Supplementary Table 1</xref>).</p>
      <table-wrap id="T1" orientation="portrait" position="anchor">
        <label>Table 1. </label>
        <caption>
          <title>Conversion results:</title>
          <p><italic>Directly converted</italic> is the sum of successful conversion from
<italic>UCSC liftOver</italic>;
<italic>approximately converted</italic> is the sum of successful approximate conversion;
<italic>converted but rejected</italic> is the sum of all rejections from quality control;
<italic>unconvertible</italic> is the sum of everything that can not be converted at all.</p>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th rowspan="1" colspan="1"/>
              <th align="right" valign="top" rowspan="1" colspan="1">probes</th>
              <th align="right" valign="top" rowspan="1" colspan="1">segments</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" valign="top" rowspan="1" colspan="1">directly converted</td>
              <td align="right" valign="top" rowspan="1" colspan="1">5,515,432,156</td>
              <td align="right" valign="top" rowspan="1" colspan="1">4,800,078</td>
            </tr>
            <tr>
              <td align="left" valign="top" rowspan="1" colspan="1">approximately converted</td>
              <td align="right" valign="top" rowspan="1" colspan="1">373,788</td>
              <td align="right" valign="top" rowspan="1" colspan="1">14,707</td>
            </tr>
            <tr>
              <td align="left" valign="top" rowspan="1" colspan="1">converted but rejected</td>
              <td align="right" valign="top" rowspan="1" colspan="1">953,624</td>
              <td align="right" valign="top" rowspan="1" colspan="1">41,201</td>
            </tr>
            <tr>
              <td align="left" valign="top" rowspan="1" colspan="1">unconvertible</td>
              <td align="right" valign="top" rowspan="1" colspan="1">10,914</td>
              <td align="right" valign="top" rowspan="1" colspan="1">1,064</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <fig fig-type="figure" id="f3" orientation="portrait" position="anchor">
        <label>Figure 3. </label>
        <caption>
          <title>Genomic regions of unconvertible probe positions from human genome hg19.</title>
          <p>Unconvertible positions are marked red on the karyogram, annotated with HGNC symbol or ENSEMBL gene ID (if HGNC not available), retrieved from biomaRt_2.30.0.</p>
        </caption>
        <graphic xlink:href="f1000research-7-16527-g0002"/>
      </fig>
    </sec>
    <sec>
      <title>Comparison of different conversion strategies</title>
      <p>In the second example, we compared the performance of different conversion strategies using 1,000 samples randomly drawn from the first example (
<xref ref-type="table" rid="T2">Table 2</xref>). Copy number segments were generated using four different strategies (
<xref ref-type="fig" rid="f4">Figure 4</xref>): (1) segments in hg19, which were generated directly from probes in hg19; (2) segments in hg38, which were generated from probes converted from hg19 to hg38 using
<italic>segment_liftover</italic>; (3) segments in hg38, which were converted from hg19 to hg38 using
<italic>segment_liftover</italic> with approximate conversion; (4) segments in hg38, which were converted from hg19 to hg38 using
<italic>segment_liftover</italic> without approximate conversion. Strategy (1) is the standard procedure of copy number segment calling, and is used a the basic reference to compare with (2). Strategy (2) converts the raw data (probes) to hg38, then follows the same procedure as in (1). It is used as a reference for (3) and (4) to compare with. Strategies (3) and (4) convert segments (results from (1)) from hg19 to hg38, the difference is whether approximate conversion is used.</p>
      <table-wrap id="T2" orientation="portrait" position="anchor">
        <label>Table 2. </label>
        <caption>
          <title>Number of samples from nine platforms in use case examples.</title>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th rowspan="1" colspan="1"/>
              <th align="right" rowspan="1" colspan="1">all</th>
              <th align="right" rowspan="1" colspan="1">1000
<break/>samples</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">CytoScanHD_Array</td>
              <td align="right" rowspan="1" colspan="1">2963</td>
              <td align="right" rowspan="1" colspan="1">73</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">CytoScan750K_Array</td>
              <td align="right" rowspan="1" colspan="1">173</td>
              <td align="right" rowspan="1" colspan="1">2</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Mapping50K_Hind240</td>
              <td align="right" rowspan="1" colspan="1">2699</td>
              <td align="right" rowspan="1" colspan="1">58</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Mapping50K_Xba240</td>
              <td align="right" rowspan="1" colspan="1">3303</td>
              <td align="right" rowspan="1" colspan="1">72</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Mapping10K_Xba142</td>
              <td align="right" rowspan="1" colspan="1">912</td>
              <td align="right" rowspan="1" colspan="1">19</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Mapping250K_Nsp</td>
              <td align="right" rowspan="1" colspan="1">9738</td>
              <td align="right" rowspan="1" colspan="1">223</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Mapping250K_Sty</td>
              <td align="right" rowspan="1" colspan="1">7561</td>
              <td align="right" rowspan="1" colspan="1">184</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">GenomeWideSNP_6</td>
              <td align="right" rowspan="1" colspan="1">16570</td>
              <td align="right" rowspan="1" colspan="1">359</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">GenomeWideSNP_5</td>
              <td align="right" rowspan="1" colspan="1">552</td>
              <td align="right" rowspan="1" colspan="1">10</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <fig fig-type="figure" id="f4" orientation="portrait" position="anchor">
        <label>Figure 4. </label>
        <caption>
          <title>Chromosome 9 from GSM276858 with probe and segment data from hg19 coordinate(left) and hg38(right).</title>
          <p>Segments directly processed from hg38 probes are used as reference (top right). hg19 segments converted with approximation (middle right) and without approximation (bottom right) are used for comparison.</p>
        </caption>
        <graphic xlink:href="f1000research-7-16527-g0003"/>
      </fig>
      <p><xref ref-type="table" rid="T3">Table 3</xref> shows the comparison of conversion results in average between (3), (4) and (2) (complete table in
<xref ref-type="other" rid="ST2">Supplementary Table 2</xref>). Exact segment matches are categorized as "perfect"; "minor difference" is defined the same as condition (3) of quality control; the rest of the segments are categorized as "significant difference"; "sum" is average number of segments per sample. By comparing the sum of
<italic>reference hg19</italic>,
<italic>reference hg38</italic> and
<italic>approximation</italic>, it shows that the conversion result is very close to the result of the standard pipeline. The difference between converted and generated sums is much smaller than the difference between two generated sums of different genome versions. On average, the approximate conversion could rescue one additional segment per file. Finally, we zoom into a specific example on chromosome 9 in GSM276858 (illustrated in
<xref ref-type="fig" rid="f4">Figure 4</xref>). Because of the removal of probes from hg19 to hg38, the second segment will be lost without approximate conversion.</p>
      <table-wrap id="T3" orientation="portrait" position="anchor">
        <label>Table 3. </label>
        <caption>
          <title>Number of segments with or without approximation on average.</title>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th rowspan="1" colspan="1"/>
              <th align="left" rowspan="1" colspan="1">perfect</th>
              <th align="left" rowspan="1" colspan="1">minor
<break/>difference</th>
              <th align="left" rowspan="1" colspan="1">significant
<break/>difference</th>
              <th align="left" rowspan="1" colspan="1">sum</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">reference hg19</td>
              <td rowspan="1" colspan="1">
                <italic>na</italic>
              </td>
              <td rowspan="1" colspan="1">
                <italic>na</italic>
              </td>
              <td rowspan="1" colspan="1">
                <italic>na</italic>
              </td>
              <td rowspan="1" colspan="1">218.42</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">reference hg38</td>
              <td rowspan="1" colspan="1">
                <italic>na</italic>
              </td>
              <td rowspan="1" colspan="1">
                <italic>na</italic>
              </td>
              <td rowspan="1" colspan="1">
                <italic>na</italic>
              </td>
              <td rowspan="1" colspan="1">215.04</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">approximation</td>
              <td rowspan="1" colspan="1">198.18</td>
              <td rowspan="1" colspan="1">6.24</td>
              <td rowspan="1" colspan="1">10.25</td>
              <td rowspan="1" colspan="1">214.67</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">no approximation</td>
              <td rowspan="1" colspan="1">198.18</td>
              <td rowspan="1" colspan="1">5.23</td>
              <td rowspan="1" colspan="1">10.01</td>
              <td rowspan="1" colspan="1">213.42</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <p>The two examples above demonstrated the efficiency and effectiveness of
<italic>segment_liftover</italic> in processing large number of probe and segment files. It can provide conversion results that are similar to results generated from the standard pipeline. Moreover, with approximate conversion, the number of properly converted segments is slightly increased. In general,
<italic>segment_liftover</italic> is able to provide reliable conversions and the ease of use.</p>
    </sec>
  </sec>
  <sec>
    <title>Summary</title>
    <p>Translation between genome versions of sequencing data is a tedious but crucial task in bioinformatics. With the functionalities of automated batching, approximate conversion and segment conversion,
<italic>segment_liftover</italic> can dramatically reduce the complexity and workload of such data processing. Furthermore,
<italic>segment_liftover</italic>’s detailed logs of execution result provide an easy and clear foundation for follow up analysis.</p>
  </sec>
  <sec>
    <title>Software availability</title>
    <list list-type="simple">
      <list-item>
        <label>1. </label>
        <p>pip version:
<ext-link ext-link-type="uri" xlink:href="https://pypi.python.org/pypi/segment-liftover">https://pypi.python.org/pypi/segment-liftover</ext-link>
</p>
      </list-item>
      <list-item>
        <label>2. </label>
        <p>Latest source code:
<ext-link ext-link-type="uri" xlink:href="https://github.com/baudisgroup/segment-liftover">https://github.com/baudisgroup/segment-liftover</ext-link>
</p>
      </list-item>
      <list-item>
        <label>3. </label>
        <p>Archived source code as at time of publication:
<ext-link ext-link-type="uri" xlink:href="https://dx.doi.org/10.5281/zenodo.1186803">https://dx.doi.org/10.5281/zenodo.1186803</ext-link>
<sup><xref rid="ref-7" ref-type="bibr">7</xref></sup>
</p>
      </list-item>
      <list-item>
        <label>4. </label>
        <p>Software license: MIT</p>
      </list-item>
    </list>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>We thank Paula Carrio Cordo and the participants of the "Zurich Seminars in Bioinformatics" for helpful discussions.</p>
  </ack>
  <sec sec-type="supplementary-material">
    <title>Supplementary material</title>
    <p id="ST1">Supplementary Table 1 : genetic elements affected by the conversion The 38 genetic elements that are affected by the segment_liftover conversion from hg19 to hg38.</p>
    <p>
      <supplementary-material content-type="local-data" id="S0">
        <media xlink:href="f1000research-7-16527-s0000.tgz">
          <caption>
            <p>Click here for additional data file.</p>
          </caption>
        </media>
      </supplementary-material>
    </p>
    <p id="ST2">Supplementary Table 2 : complete conversion results of different strategies A complete list of conversion results of comparing different conversion strategies using 1000 random samples.</p>
    <p>
      <supplementary-material content-type="local-data" id="S1">
        <media xlink:href="f1000research-7-16527-s0001.tgz">
          <caption>
            <p>Click here for additional data file.</p>
          </caption>
        </media>
      </supplementary-material>
    </p>
  </sec>
  <ref-list>
    <ref id="ref-1">
      <label>1</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kent</surname><given-names>WJ</given-names></name><name><surname>Haussler</surname><given-names>D</given-names></name></person-group>:
<article-title>Assembly of the working draft of the human genome with GigAssembler.</article-title><source><italic>Genome Res.</italic></source><year>2001</year>;<volume>11</volume>(<issue>9</issue>):<fpage>1541</fpage>–<lpage>1548</lpage>.
<pub-id pub-id-type="doi">10.1101/gr.183201</pub-id><!--<pub-id pub-id-type="pmcid">311095</pub-id>--><?supplied-pmid 11544197?><pub-id pub-id-type="pmid">11544197</pub-id></mixed-citation>
    </ref>
    <ref id="ref-2">
      <label>2</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kuhn</surname><given-names>RM</given-names></name><name><surname>Haussler</surname><given-names>D</given-names></name><name><surname> Kent</surname><given-names>WJ</given-names></name></person-group>:
<article-title>The UCSC genome browser and associated tools.</article-title><source><italic>Brief Bioinform.</italic></source><year>2013</year>;<volume>14</volume>(<issue>2</issue>):<fpage>144</fpage>–<lpage>161</lpage>.
<pub-id pub-id-type="doi">10.1093/bib/bbs038</pub-id><!--<pub-id pub-id-type="pmcid">3603215</pub-id>--><?supplied-pmid 22908213?><pub-id pub-id-type="pmid">22908213</pub-id></mixed-citation>
    </ref>
    <ref id="ref-3">
      <label>3</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhao</surname><given-names>H</given-names></name><name><surname>Sun</surname><given-names>Z</given-names></name><name><surname>Wang</surname><given-names>J</given-names></name><etal/></person-group>:
<article-title>Crossmap: a versatile tool for coordinate conversion between genome assemblies.</article-title><source><italic>Bioinformatics.</italic></source><year>2014</year>;<volume>30</volume>(<issue>7</issue>):<fpage>1006</fpage>–<lpage>1007</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btt730</pub-id><!--<pub-id pub-id-type="pmcid">3967108</pub-id>--><?supplied-pmid 24351709?><pub-id pub-id-type="pmid">24351709</pub-id></mixed-citation>
    </ref>
    <ref id="ref-4">
      <label>4</label>
      <mixed-citation publication-type="journal"><collab>NCBI Resource Coordinators</collab>:
<article-title>Database resources of the National Center for Biotechnology Information.</article-title><source><italic>Nucleic Acids Res.</italic></source><year>2016</year>;<volume>44</volume>(<issue>D1</issue>):<fpage>D7</fpage>–<lpage>D19</lpage>.
<pub-id pub-id-type="doi">10.1093/nar/gkv1290</pub-id><!--<pub-id pub-id-type="pmcid">4702911</pub-id>--><?supplied-pmid 26615191?><pub-id pub-id-type="pmid">26615191</pub-id></mixed-citation>
    </ref>
    <ref id="ref-5">
      <label>5</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cai</surname><given-names>H</given-names></name><name><surname>Gupta</surname><given-names>S</given-names></name><name><surname>Rath</surname><given-names>P</given-names></name><etal/></person-group>:
<article-title>arrayMap 2014: an updated cancer genome resource.</article-title><source><italic>Nucleic Acids Res.</italic></source><year>2015</year>;<volume>43</volume>(<issue>Database issue</issue>):<fpage>D825</fpage>–<lpage>D830</lpage>.
<pub-id pub-id-type="doi">10.1093/nar/gku1123</pub-id><!--<pub-id pub-id-type="pmcid">4383937</pub-id>--><?supplied-pmid 25428357?><pub-id pub-id-type="pmid">25428357</pub-id></mixed-citation>
    </ref>
    <ref id="ref-6">
      <label>6</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Olshen</surname><given-names>AB</given-names></name><name><surname>Venkatraman</surname><given-names>ES</given-names></name><name><surname>Lucito</surname><given-names>R</given-names></name><etal/></person-group>:
<article-title>Circular binary segmentation for the analysis of array-based DNA copy number data.</article-title><source><italic>Biostatistics.</italic></source><year>2004</year>;<volume>5</volume>(<issue>4</issue>):<fpage>557</fpage>–<lpage>572</lpage>.
<pub-id pub-id-type="doi">10.1093/biostatistics/kxh008</pub-id><?supplied-pmid 15475419?><pub-id pub-id-type="pmid">15475419</pub-id></mixed-citation>
    </ref>
    <ref id="ref-7">
      <label>7</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gao</surname><given-names>B</given-names></name><name><surname> Baudis</surname><given-names>M</given-names></name></person-group>:
<article-title>baudisgroup/segment-liftover: First public version (Version 0.948).</article-title><source><italic>Zenodo.</italic></source><year>2018</year><ext-link ext-link-type="uri" xlink:href="http://doi.org/10.5281/zenodo.1186803">Data Source</ext-link></mixed-citation>
    </ref>
  </ref-list>
</back>
<sub-article id="report34839" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.16527.r34839</article-id>
    <title-group>
      <article-title>Referee response for version 2</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Dale</surname>
          <given-names>Ryan K.</given-names>
        </name>
        <xref ref-type="aff" rid="r34839a1">1</xref>
        <role>Referee</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-2664-3744</contrib-id>
      </contrib>
      <aff id="r34839a1"><label>1</label>Laboratory of Cellular and Developmental Biology, National Institute of Diabetes and Digestive and Kidney Diseases, National Institutes of Health, Bethesda, MD, USA</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>8</day>
      <month>6</month>
      <year>2018</year>
    </pub-date>
    <related-article id="d35e1288" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.14148.2">Version 2</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>The revisions address my concerns -- and the new demo mode is especially useful.</p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
<sub-article id="report32847" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.15390.r32847</article-id>
    <title-group>
      <article-title>Referee response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Dale</surname>
          <given-names>Ryan K.</given-names>
        </name>
        <xref ref-type="aff" rid="r32847a1">1</xref>
        <role>Referee</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-2664-3744</contrib-id>
      </contrib>
      <aff id="r32847a1"><label>1</label>Laboratory of Cellular and Developmental Biology, National Institute of Diabetes and Digestive and Kidney Diseases, National Institutes of Health, Bethesda, MD, USA</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>17</day>
      <month>4</month>
      <year>2018</year>
    </pub-date>
    <related-article id="d35e1339" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.14148.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve-with-reservations</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>The authors describe how using existing genome coordinate conversion tools can be problematic on large domains in which continuity of the converted region is preferred over precision of the coordinate conversion. They describe a method that iteratively retries the conversion and applies QC criteria to the original and iterative conversions. The method is implemented using a Python package that wraps the UCSC liftover tool and performs the iterative remapping and QC steps, and provides this functionality over directories of files instead of on a per-file basis.</p>
    <p> To make it scientifically sound there should be a clear example in the documentation that works (details below). I have additional concerns and suggestions, particularly about the code, that I hope will improve the paper and the tool.</p>
    <p> Major comments:</p>
    <p> - Figure 3 is difficult to interpret as-is because some probes are double-counted across bars. I think a better approach would be to have a stacked bar for which the full height indicates the total number of probes that can be subset into converted and not-converted. These can be further subset by colors or by an adjacent stacked bar to indicate the proportion of converted that were directly converted or approximately converted, and the proportion of QC-failed.</p>
    <p> - I see in the code that there are some human-specific hard-coded conversions between chr23/24 and chrX/Y. This may cause unexpected results when running on other genomes. One solution would be to run a check on the chromosomes observed in the chainfile to see if it looks like a human liftover before doing the 23/24 -&gt; X/Y conversions.</p>
    <p> - Currently the liftOver executable is required to be in the working directory or manually specified with the "--liftover" arg. A friendlier solution would be to expect liftOver to be found on the PATH variable (while also keeping the ability to explicitly specify if needed). This avoids having to symlink the executable to the working directory or requiring system-dependent command-line arguments.</p>
    <p> - A "logs" directory is created in the working directory, even just after running "segment_liftover --help". It would be nice to defer creating this directory until it's actually needed. This also means that running parallel jobs on a cluster from the same directory will clobber the log files, making debugging difficult. It would be better to expose log directory configuration on the CLI and/or put the logs directory as a subdirectory of the output directory by default.</p>
    <p> - the "tmp" directory behaves the same way (clutters the working directory; clobbers files when running in parallel). Furthermore it's not cleaned up after running. Better would be to use Python's tempfile module, which respects the environment's TMPDIR variable and is periodically automatically cleaned.</p>
    <p> - Example data in the correct directory structure should be provided, and a single command to run that data should be provided. That way the user can easily verify that everything is installed correctly. As it is, I had to create the directory structure and paste the example segments content from the README into a new file in that directory. That allowed segment_liftover to run, but then it failed on the example segments data in the README. Digging around in the logs, in general.log there appears to be an issue with int vs str expectations when loading as pandas.DataFrame (this is with pandas v0.22.0).</p>
    <p> - Are there requirements for chromosome names in segment files or probe files? The examples use integer chromosome names, but liftOver chainfiles use UCSC "chr" chromosome names. It appears that using an input file with "chr" names fails, again from expectations about int vs str columns in pandas. It would be good to describe what kind of chromosome names are supported (or link to a segments file specification if there is one).</p>
    <p> Minor comment:  Typo in text, "tensor" -&gt; "tens or", and various typos in help text when running segment_liftover</p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard, however I have significant reservations, as outlined above.</p>
  </body>
</sub-article>
<sub-article id="report31947" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.15390.r31947</article-id>
    <title-group>
      <article-title>Referee response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Krijgsman</surname>
          <given-names>Oscar</given-names>
        </name>
        <xref ref-type="aff" rid="r31947a1">1</xref>
        <role>Referee</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-0825-3291</contrib-id>
      </contrib>
      <aff id="r31947a1"><label>1</label>Division of Molecular Oncology and Immunology, Netherlands Cancer Institute, Amsterdam, Netherlands</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>26</day>
      <month>3</month>
      <year>2018</year>
    </pub-date>
    <related-article id="d35e1431" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.14148.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>This manuscript discusses a new tool developed by the authors that improves the ‘liftover’ between genomic builds. “Segment_liftover” is built on the already available liftover tool from UCSC with the novelty that it the tool implements a better conversion between genomic builds for stretches of the genome (segments) like in for example DNA copy number analyses. In addition, the tool provides options to perform the analysis in batches and provides log files of execution and results. The tool, as available on github, provides ample documentation and examples to run without experiencing too many difficulties.</p>
    <p> The authors provide an interesting new tool that shows an improvement over existing tools. In general, the manuscript is clear and concise. However, a few minor points need to be addressed to improve the interpretation of the results described in the manuscript.</p>
    <p>  
<list list-type="bullet"><list-item><p>The second use case is basically a direct comparison between UCSC liftover and the newly developed segment_liftover tool. However, this is not explicitly mentioned in the text. In the current version it is not evident that you did the nice/required comparison with a currently available tool. Furthermore, a little more explanation on the 4 different strategies would benefit the reader.</p></list-item><list-item><p>Figure 3 does not convincingly convey its message. For example, it is not clear from the figure that the percentage of unconvertible segments is higher that probes although properly mentioned in the text. But also, the difference between the first bars is over a factor 1000. I understand the choice of a log10 scale but the authors might consider a different way of showing this data (table? Add percentages or number?).</p></list-item></list>
</p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
