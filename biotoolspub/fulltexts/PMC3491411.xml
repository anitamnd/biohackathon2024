<?DTDIdentifier.IdentifierValue article.dtd?>
<?DTDIdentifier.IdentifierType system?>
<?SourceDTD.DTDName article.dtd?>
<?SourceDTD.Version 1.0?>
<?ConverterInfo.XSLTName bmc2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Biol</journal-id>
    <journal-title-group>
      <journal-title>Genome Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1465-6906</issn>
    <issn pub-type="epub">1465-6914</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3491411</article-id>
    <article-id pub-id-type="publisher-id">gb-2012-13-10-r83</article-id>
    <article-id pub-id-type="pmid">23034175</article-id>
    <article-id pub-id-type="doi">10.1186/gb-2012-13-10-r83</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>BSmooth: from whole genome bisulfite sequencing reads to differentially methylated regions</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes" equal-contrib="yes" id="A1">
        <name>
          <surname>Hansen</surname>
          <given-names>Kasper D</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <email>khansen@jhsph.edu</email>
      </contrib>
      <contrib contrib-type="author" corresp="yes" equal-contrib="yes" id="A2">
        <name>
          <surname>Langmead</surname>
          <given-names>Benjamin</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <xref ref-type="aff" rid="I2">2</xref>
        <email>blangmea@jhsph.edu</email>
      </contrib>
      <contrib contrib-type="author" corresp="yes" id="A3">
        <name>
          <surname>Irizarry</surname>
          <given-names>Rafael A</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <xref ref-type="aff" rid="I2">2</xref>
        <email>rafa@jhu.edu</email>
      </contrib>
    </contrib-group>
    <aff id="I1"><label>1</label>Department of Biostatistics, Johns Hopkins Bloomberg School of Public Health, Baltimore, MD 21205, USA</aff>
    <aff id="I2"><label>2</label>Center for Epigenetics, Johns Hopkins University School of Medicine, Baltimore, MD 21205, USA</aff>
    <pub-date pub-type="ppub">
      <year>2012</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>3</day>
      <month>10</month>
      <year>2012</year>
    </pub-date>
    <volume>13</volume>
    <issue>10</issue>
    <fpage>R83</fpage>
    <lpage>R83</lpage>
    <history>
      <date date-type="received">
        <day>30</day>
        <month>3</month>
        <year>2012</year>
      </date>
      <date date-type="rev-recd">
        <day>19</day>
        <month>6</month>
        <year>2012</year>
      </date>
      <date date-type="accepted">
        <day>3</day>
        <month>10</month>
        <year>2012</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright ©2012 Hansen et al.; licensee BioMed Central Ltd.</copyright-statement>
      <copyright-year>2012</copyright-year>
      <copyright-holder>Hansen et al.; licensee BioMed Central Ltd.</copyright-holder>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0">
        <license-p>This is an open access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/2.0">http://creativecommons.org/licenses/by/2.0</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="http://genomebiology.com/2012/13/10/R83"/>
    <abstract>
      <p>DNA methylation is an important epigenetic modification involved in gene regulation, which can now be measured using whole-genome bisulfite sequencing. However, cost, complexity of the data, and lack of comprehensive analytical tools are major challenges that keep this technology from becoming widely applied. Here we present BSmooth, an alignment, quality control and analysis pipeline that provides accurate and precise results even with low coverage data, appropriately handling biological replicates. BSmooth is open source software, and can be downloaded from <ext-link ext-link-type="uri" xlink:href="http://rafalab.jhsph.edu/bsmooth">http://rafalab.jhsph.edu/bsmooth</ext-link>.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <sec>
    <title>Background</title>
    <p>DNA methylation is an important epigenetic modification involved in gene silencing, tissue differentiation, and cancer [<xref ref-type="bibr" rid="B1">1</xref>]. High-resolution, genome-wide measurement of DNA methylation is now possible using whole-genome bisulfite sequencing (WGBS), a process whereby input DNA is treated with sodium bisulfite and sequenced. While WGBS is comprehensive, it is also quite costly [<xref ref-type="bibr" rid="B2">2</xref>]. For instance, an application of WGBS by Lister <italic>et al</italic>. [<xref ref-type="bibr" rid="B3">3</xref>] compared DNA methylation profiles of an embryonic stem cell line and a fibroblast cell line. Both were sequenced to about 30× coverage (25× coverage of all CpGs), requiring 376 total lanes of bisulfite sequencing on the Illumina GA II instrument. While conventional wisdom is that 30× coverage or deeper is needed to achieve accurate results, advanced statistical techniques proposed here, such as local likelihood smoothing, can reduce this requirement to as little as 4×.</p>
    <p>It has also been shown that different genomic regions exhibit different levels of DNA methylation variation among individuals [<xref ref-type="bibr" rid="B4">4</xref>]. As a consequence, regions that are inherently variable can easily be confused with regions that differ consistently between groups when few replicates are available [<xref ref-type="bibr" rid="B1">1</xref>] (Figure <xref ref-type="fig" rid="F1">1</xref>). But performing WGBS on the number of biological replicates required to overcome such issues can be quite expensive. The techniques proposed here address this issue both by making full use of replicate information during analysis, and by potentially reducing the coverage needed for (and therefore the cost of) replication.</p>
    <fig id="F1" position="float">
      <label>Figure 1</label>
      <caption>
        <p><bold>The need for biological replicates</bold>. We show smoothed methylation profiles for three normal samples (blue) and matched cancers (red) from the Hansen data [<xref ref-type="bibr" rid="B1">1</xref>]. Also shown is the smoothed methylation profile for an IMR90 cell-line (black) from the Lister data [<xref ref-type="bibr" rid="B3">3</xref>]. Had we only analyzed normal-cancer pair 3 (thick lines), there would appear to be a methylation difference between cancer and normal in this genomic region. When all three cancer-normal pairs are considered, however, this region does not appear to be a cancer-specific differentially methylated region.</p>
      </caption>
      <graphic xlink:href="gb-2012-13-10-r83-1"/>
    </fig>
    <p>Analysis of WGBS data starts with alignment of bisulfite converted reads. After alignment, statistical methods are employed to identify differentially methylated regions (DMRs) between two or more conditions. Extensive work has been dedicated to alignment [<xref ref-type="bibr" rid="B5">5</xref>-<xref ref-type="bibr" rid="B10">10</xref>] but methods for post-alignment analysis are limited. Published work based on WGBS has relied on a modular approach that first identifies differentially methylated CpGs that are then grouped into regions using <italic>ad hoc </italic>grouping rules. The first step is carried out using either Fisher's exact test [<xref ref-type="bibr" rid="B3">3</xref>,<xref ref-type="bibr" rid="B11">11</xref>-<xref ref-type="bibr" rid="B13">13</xref>], arbitrary cutoffs for differences in observed methylation levels [<xref ref-type="bibr" rid="B14">14</xref>], or a beta-binomial model [<xref ref-type="bibr" rid="B15">15</xref>]. None of these methods take biological variability into account. To the best of our knowledge, no software is available implementing these approaches.</p>
    <p>Here we present BSmooth, a comprehensive analysis tool for WGBS datasets. The BSmooth pipeline begins with an unbiased and bisulfite-aware read alignment step, compiles quality assessment metrics based on stratifying methylation estimates by read position, applies local averaging to improve precision of regional methylation measurements, and detects DMRs accounting for biological variability when replicates are available. The main methodological contribution of BSmooth is the ability to identify DMRs accounting for biological variability, as well as the quality control measures we propose. In addition, BSmooth includes a new aligner, Merman, which appropriately handles colorspace. We demonstrate the benefits of BSmooth with four publicly available datasets: the Lister data [<xref ref-type="bibr" rid="B3">3</xref>], the Hansen data [<xref ref-type="bibr" rid="B1">1</xref>], the Hansen-capture data [<xref ref-type="bibr" rid="B1">1</xref>] and the Tung data [<xref ref-type="bibr" rid="B16">16</xref>] (see Materials and methods for details). We use these data to demonstrate the advantages of BSmooth over existing algorithms based on Fisher's exact test. BSmooth is the first pipeline for WGBS datasets yielding DMRs as output, while also taking biological variation into account. It can handle low-coverage experimental designs, allowing researchers to profile several samples at the same cost as a high-coverage profile of a single sample.</p>
  </sec>
  <sec>
    <title>Results and discussion</title>
    <sec>
      <title>Alignment</title>
      <p>Sodium bisulfite treatment converts unmethylated cytosine (C) nucleotides to uracils, which are reported as thymines (T) by the sequencer, and leaves methylated cytosines unmodified. When sequencing reads derived from treated DNA are aligned to a reference genome, the methylation status of a C in the reference can be measured by examining aligned reads overlapping it. For instance, when a C in a bisulfite-treated read overlaps a C in the reference, this indicates the reference C is methylated in at least one molecule in the sample.</p>
      <p>Alignment of sequencing reads derived from bisulfite-treated DNA is complicated by the fact that a reference C's methylation status affects the scores of alignments covering it. This can result in bias either toward or against alignments covering methylated cytosines. Algorithms have been proposed that avoid bias by removing the penalty associated with aligning a C or T in the read to a C in the reference genome. One such approach is '<italic>in silico </italic>bisulfite conversion', whereby C nucleotides both in the reads and in the reference genome are converted to T nucleotides prior to alignment [<xref ref-type="bibr" rid="B3">3</xref>,<xref ref-type="bibr" rid="B8">8</xref>]. A related approach is to convert only the reference genome in this way [<xref ref-type="bibr" rid="B17">17</xref>,<xref ref-type="bibr" rid="B18">18</xref>], but this results in bias against reads overlapping both methylated and unmethylated cytosines.</p>
      <p>Other approaches avoid bias by, at some point in the alignment process, considering all possible combinations of methylation status. VerJinxer [<xref ref-type="bibr" rid="B5">5</xref>] and BSMAP [<xref ref-type="bibr" rid="B9">9</xref>], for example, build a 'seed' index of the reference genome. For each seed extracted, multiple versions of the seed are added to the index: one for each possible assignment of either C or T to a position that originally contained a C. This ensures that the index-assisted alignment steps are not biased by methylation status. The approach of PASH [<xref ref-type="bibr" rid="B6">6</xref>] is similar, with seeds being extracted from the read rather than the reference.</p>
      <p>An advantage of <italic>in silico </italic>bisulfite conversion is that post-conversion alignment can be performed using a fast tool such as Bowtie [<xref ref-type="bibr" rid="B19">19</xref>]. A disadvantage is that it does not straightforwardly handle 'colorspace' reads from the SOLiD sequencing instrument. For this reason, BSmooth implements two alignment algorithms, which the user may choose between. The first is based on <italic>in silico </italic>bisulfite conversion and uses Bowtie 2 [<xref ref-type="bibr" rid="B20">20</xref>] to align. Because it uses Bowtie 2, this pipeline fully supports gapped alignment and alignment of paired-end bisulfite-treated reads. The second pipeline uses a new aligner called Merman, which supports unbiased alignment of colorspace bisulfite reads. Merman extends the indexing approach of VerJinxer [<xref ref-type="bibr" rid="B5">5</xref>] and BSMAP [<xref ref-type="bibr" rid="B9">9</xref>]; as in those approaches, we build a 'seed' index of the reference genome. Instead of extracting nucleotide subsequences, though, we extract corresponding color subsequences. For each subsequence extracted, multiple versions may be added to the index: one for each color subsequence resulting from each possible assignment of either C or T to positions originally containing a C. This closely follows the approaches of VerJinxer [<xref ref-type="bibr" rid="B5">5</xref>] and BSMAP [<xref ref-type="bibr" rid="B9">9</xref>], but additionally translates nucleotide ambiguity into color ambiguity. The Merman-based pipeline does not support gapped alignment or paired-end alignment.</p>
      <p>The Merman alignment pipeline is included chiefly to allow users to align a greater breadth of input types. It is generally slower and less memory-efficient than the Bowtie 2-based pipeline. BSmooth also allows the user to bypass the alignment stage, in which case the user must provide a collection of SAM [<xref ref-type="bibr" rid="B21">21</xref>] files formatted as though they had been generated by one of BSmooth's pipelines. A comparison between different alignment strategies demonstrated that the effect on downstream results is negligible (Figure S5 in Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>), compared to technical variation. As we demonstrate below, the choice of statistical analysis method has a much stronger impact.</p>
    </sec>
    <sec>
      <title>Quality control</title>
      <p>Systematic sequencing and base-calling errors that adversely affect downstream results are common and increasingly well characterized [<xref ref-type="bibr" rid="B22">22</xref>,<xref ref-type="bibr" rid="B23">23</xref>]. For instance, incorrect base calls toward the 3' ends of reads can favor specific nucleotides [<xref ref-type="bibr" rid="B23">23</xref>]. We observed similar biases in WGBS data and developed a sample-specific quality assessment plot to visualize them. For each uniquely aligned read, we recorded read positions corresponding to CpG cytosines in the reference, along with the read base overlapping that position if it is C (methylated) or T (unmethylated). We refer to these as the read-level measurements. We then stratified these measurements by read position, computed the percent of Cs in each stratum, and plotted them (Figure <xref ref-type="fig" rid="F2">2</xref>). Since methylation state should not depend on read position, these plots ought to show a flat horizontal line (Figure <xref ref-type="fig" rid="F2">2a</xref>). However, biases were observed in two of the three examined datasets (Figure <xref ref-type="fig" rid="F2">2b,c</xref>). We therefore refer to them as M-bias plots. For datasets with mixed read lengths, we recommend one plot per read length (Figure <xref ref-type="fig" rid="F2">2b</xref>; Figures S1 to S3 in Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>).</p>
      <fig id="F2" position="float">
        <label>Figure 2</label>
        <caption>
          <p><bold>Quality control plots</bold>. <bold>(a) </bold>M-bias plot for the Hansen data, a WGBS experiment on cancer samples. Each sample was sequenced on two flowcells. We show the methylation proportion across each possible read position. This plot shows limited evidence of methylation bias across the read positions. Vertical lines indicate cutoffs used for M-bias filtering. <bold>(b) </bold>M-bias plots for the Lister data, a WGBS experiment in a fibroblast cell line. These data were aligned using iterative trimming and each read length is depicted separately (different colors). The plot shows methylation bias toward the end of reads for all read lengths. <bold>(c) </bold>M-bias plot for the Hansen-capture data, a capture bisulfite sequencing experiment on cancer samples. The plot shows methylation bias at the start of the reads.</p>
        </caption>
        <graphic xlink:href="gb-2012-13-10-r83-2"/>
      </fig>
      <p>These plots can also be used to make filtering decisions. In the three datasets we examined, inspection of the M-bias plot motivated restricting the read positions used to a certain range: read-level measurements for which the position was outside this range were excluded from further analysis (but the whole read was still used for alignment). We refer to this procedure as M-bias filtering. In the Lister data we excluded the last 10 bp from each trimmed read. In the Hansen dataset we excluded measurements from the first three and last three positions (Figure <xref ref-type="fig" rid="F2">2a</xref>). In the Hansen-capture dataset we excluded measurements from the first 15 positions (Figure <xref ref-type="fig" rid="F2">2c</xref>). This filtering led to substantially increased agreement between the datasets representing the same sample processed with two different protocols (Figure S4 in Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>).</p>
    </sec>
    <sec>
      <title>Smoothing</title>
      <p>We employed smoothing to estimate the methylation level in a genomic region for a single sample. We denote the number of reads associated with the <italic>j</italic>th CpG being methylated and unmethylated with <italic>M<sub>j </sub></italic>and <italic>U<sub>j </sub></italic>respectively. The CpG-level summary is simply the proportion <italic>M<sub>j</sub></italic>/<italic>N<sub>j</sub></italic>, with <italic>N<sub>j</sub></italic>=<italic>M<sub>j</sub></italic>+<italic>U<sub>J </sub></italic>the coverage for the <italic>j</italic>th CpG. We assume each <italic>M<sub>j </sub></italic>follows a binomial distribution with success probability π<italic><sub>j</sub></italic>. The success probability represents the true proportion of chromosomes for which the <italic>j</italic>th CpG is methylated in the sample being assayed. The proportion <italic>M<sub>j</sub></italic>/<italic>N<sub>j</sub></italic>, denoted the single-CpG methylation estimate, is an unbiased estimate of π<italic><sub>j </sub></italic>with standard error <inline-formula><mml:math id="M1" name="gb-2012-13-10-r83-i1" overflow="scroll"><mml:msqrt><mml:mrow><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo class="MathClass-open">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo class="MathClass-bin">-</mml:mo><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo class="MathClass-close">)</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msqrt></mml:math></inline-formula>. This has led most WGBS studies to employ a high coverage design since even 30× coverage yields standard errors as large as 0.09. However, various authors have noted that methylation levels are strongly correlated across the genome [<xref ref-type="bibr" rid="B24">24</xref>,<xref ref-type="bibr" rid="B25">25</xref>]. Furthermore, functionally relevant findings are generally associated with genomic regions rather than single CpGs, either CpG islands [<xref ref-type="bibr" rid="B26">26</xref>], CpG island shores [<xref ref-type="bibr" rid="B27">27</xref>], genomic blocks [<xref ref-type="bibr" rid="B1">1</xref>], or generic 2 kb regions [<xref ref-type="bibr" rid="B3">3</xref>]. This implies that we can assume that π<sub>j </sub>varies smoothly along the genome, without distorting signal or losing functional information. We can therefore improve precision by the use of modern statistical techniques such as local likelihood smoothing [<xref ref-type="bibr" rid="B28">28</xref>] (see Materials and methods for details; Figure <xref ref-type="fig" rid="F3">3a,b</xref>).</p>
      <fig id="F3" position="float">
        <label>Figure 3</label>
        <caption>
          <p><bold>The advantages of smoothing</bold>. <bold>(a) </bold>Points represent single-CpG methylation estimates plotted against their genomic location. Large points are based on greater than 20× coverage. The orange circle denotes the location for which we are estimating the methylation profile. The blue points are those receiving positive weight in the local likelihood estimation. The orange line is obtained from the fitted parabola. The black line is the methylation profile resulting from repeating the procedure for each location. <bold>(b) </bold>The curve represents the kernel used in the weighted regression and the points are the actual weights, which are also influenced by coverage. <bold>(c) </bold>Points are as in (a) for the 25× coverage Lister data. The pink line is obtained by applying BSmooth to a the full data. The black line is the estimate from BSmooth based on a 5× subset of the Lister data. <bold>(d) </bold>The points are as in (a) but for the Hansen-capture data with average 35× coverage, and average across three replicates. The black line is the BSmooth estimate obtained from the 4× Hansen data, averaged across three replicates.</p>
        </caption>
        <graphic xlink:href="gb-2012-13-10-r83-3"/>
      </fig>
      <p>Using this method on data with 4× coverage, we achieved precision comparable to deeper coverage without smoothing. Specifically, we applied BSmooth to a subset of the IMR90 cell line study with 5× coverage; we used one of the six different library preparations applied to two different DNA extractions [<xref ref-type="bibr" rid="B3">3</xref>]. We compared the estimated methylation profile based on the 5× data to results obtained using the full data; for each CpG we averaged single-CpG methylation estimates based on the full 30× data over a 1 kb interval using only loci with at least 10× coverage. We found close agreement between the two sets of results (Figure <xref ref-type="fig" rid="F3">3c</xref>) with a correlation of 0.90 and a median absolute difference of 0.056. Additionally, when smoothing both high coverage data and low coverage data there was also close agreement: correlation of 0.97 and a median absolute difference of 0.024, using all CpGs in the genome. These two results show that we accurately estimate regional methylation level using low coverage data, and that there is little difference between the results of smoothing a high coverage dataset and the results of smoothing a low coverage dataset.</p>
      <p>We also compared low coverage colon cancer data to high coverage capture data obtained with padlock probes (Figure <xref ref-type="fig" rid="F3">3d</xref>). For the capture data we only considered CpGs with 30× coverage or greater and computed an average methylation level across each capture region. Using the smoothed methylation profiles, an average smoothed methylation level was computed by averaging the smoothed value for all CpGs in the capture region. We found excellent agreement, with correlations between 0.89 and 0.92 and median absolute differences between 0.045 and 0.069. Additionally, there is a striking qualitative agreement between the single-resolution CpG estimates from the high-coverage capture data and the results of smoothing the low-coverage WGBS data (Figure <xref ref-type="fig" rid="F3">3d</xref>). Note that the two datasets being compared here, unlike the IMR90 data described above, were generated using two very different protocols, performed in two separate laboratories.</p>
    </sec>
    <sec>
      <title>Differentially methylated regions</title>
      <p>Previous publications have focused on precisely estimating methylation levels at single-base resolution. For example, Fisher's exact test has been used to identify CpGs differentially methylated across two samples [<xref ref-type="bibr" rid="B3">3</xref>]. However, these studies are ultimately concerned with DMRs or differences between groups of samples. For example, Lister <italic>et al</italic>. [<xref ref-type="bibr" rid="B3">3</xref>] searched for genomic regions containing many differentially methylated CpGs, resulting in DMRs that are at least 2 kb long. A problem with this approach is that Fisher's exact test accounts for DNA sampling variability but not biological variability. Biological variability is well-established [<xref ref-type="bibr" rid="B4">4</xref>] and necessitates biological replicates from each group under consideration [<xref ref-type="bibr" rid="B1">1</xref>]. The goal is then to find regions that exhibit consistent differences even when taking biological variation into account. The DMR detection algorithm implemented in BSmooth is based on a statistic that appropriately summarizes consistent differences. Briefly, we first use the local-likelihood approach to estimate a sample-specific methylation profile, then compute estimates of the mean differences and standard errors for each CpG to form a statistic similar to that used in a <italic>t</italic>-test (see Materials and methods for details).</p>
      <p>We applied BSmooth to identify DMRs between normal colon and colon cancer in the Hansen dataset. To address how well our method compares to having high-coverage data, we used the Hansen-capture bisulfite sequencing data as gold-standard and created receiver operating characteristic (ROC) curves. Specifically, we computed the average methylation difference between the cancer and normal samples inside each capture region, using only CpGs with 30× or more coverage, and considered this to be gold-standard measurements. We defined positives and negatives in two ways: one based on mean differences and the other taking biological variability into account. Specifically, for the first, we defined positives as capture regions with an average difference &gt;0.25 using the gold-standard measurements (364 regions) and negatives as those with average differences &lt;0.03 (2,012 regions; see Materials and Methods for details). This definition does not take biological variability into account. We computed false and true positive rates for different cutoff choices for the t-statistic by counting how many reported regions overlapped, by more than 50%, with gold standard positive and negative regions, respectively. We also required that the reported regions show methylation differences going in the same direction as the gold standard differences. Here, our method achieved 87% sensitivity at 95% specificity (Figure <xref ref-type="fig" rid="F4">4a</xref>). In the second definition of positives and negatives we accounted for biological variability by using a Welch <italic>t</italic>-test on the gold-standard measurements. Specifically, positives were defined as regions with an unadjusted <italic>P</italic>-value from the Welch <italic>t</italic>-test of &lt;1% (114 regions) and negatives as those with an unadjusted <italic>P</italic>-value &gt;25% (925 regions). Using this definition, our method achieved 70% sensitivity at 95% specificity (Figure <xref ref-type="fig" rid="F4">4b</xref>). We compared the results of BSmooth to the results of a method using Fisher's exact test [<xref ref-type="bibr" rid="B3">3</xref>] (see Materials and Methods for details). Because the Fisher based method does not account for biological variability, we pooled the data from the three cancer samples and the three normal samples. We compared the two methods using ROC curves and demonstrated that BSmooth outperforms the existing method (Figure <xref ref-type="fig" rid="F4">4a,b</xref>).</p>
      <fig id="F4" position="float">
        <label>Figure 4</label>
        <caption>
          <p><bold>Evaluation of the differentialy methylated regions finder</bold>. <bold>(a) </bold>Specificity plotted against sensitivity for the BSmooth DMR finder (black) and a method based on Fisher's exact test (orange) applied to the Hansen data. The gold-standard definition is based on mean differences. Details are explained in the text. <bold>(b) </bold>As (a), but using a gold-standard definition accounting for biological variation. <bold>(c) </bold>Comparison based on the association between gene expression and methylation changes in the Tung data. For DMR lists of varying sizes (x-axis), the log2-odds ratios of finding a DMR within 5 kb of the transcription start site of a differentially expressed gene (FDR ≤5%) compared to genes not differentially expression (FDR ≥25%) are shown. FP, false positive; TP, true positive.</p>
        </caption>
        <graphic xlink:href="gb-2012-13-10-r83-4"/>
      </fig>
      <p>We also applied BSmooth to the Tung dataset. Tung <italic>et al</italic>. [<xref ref-type="bibr" rid="B16">16</xref>] studied the relationship between gene expression and social rank in a cohort of 49 monkeys, using microarrays. Out of the 6,097 genes studied, they identified 454 to be significantly related to social rank at a false discovery rate (FDR) of 5%. These 6,097 genes map to a total of 9,386 transcription start sites (TSSs). To assess the extent to which methylation might be involved in regulating the observed expression changes, they also performed WGBS on three high ranking and three low ranking individuals at medium CpG coverage (11× to 14×). Again, we compare the results of BSmooth to the results of a method using Fisher's exact test. Figure <xref ref-type="fig" rid="F4">4c</xref> depicts the log-odds ratio for finding a DMR near (within 5kb) the TSS of a differentially expressed gene (FDR ≤5%) compared to finding a DMR near the TSS of a gene not differentially expressed (FDR ≥25%). This figure shows that BSmooth consistently finds more DMRs near TSSs of differentially expressed genes compared to the method based on Fisher's exact test. We note that the odds ratio for Fisher's exact test is slightly below one, suggesting that this test is no better than random guessing at finding DMRs near differentially expressed genes. Due to the low percentage of differentially expressed genes, Fisher's exact test does not have enough sensitivity to detect the associated DMRs.</p>
      <p>The code used for the results presented above are included as Additional files <xref ref-type="supplementary-material" rid="S2">2</xref> and <xref ref-type="supplementary-material" rid="S3">3</xref>.</p>
    </sec>
  </sec>
  <sec sec-type="conclusions">
    <title>Conclusions</title>
    <p>We present BSmooth, a data analysis pipeline that permits precise and accurate estimates of methylation profiles with low coverage WGBS data. The pipeline starts with sequencing reads, aligns them in a bisulfite-aware fashion, compiles per-sample CpG level measurement tables, estimates methylation profiles precisely and accurately, and reports a table of DMRs taking biological variability into account. We demonstrated that our method outperforms existing methods based on Fisher's exact test. Although our comparison was limited because only two datasets appropriate for assessment were available, we expect our work to serve as a model for further assessments based on new datasets as they become available.</p>
    <p>Finally, note that BSmooth assumes that the true methylation profile is smooth. In genomic regions where the true methylation profile is not smooth, BSmooth will still provide smooth estimates. Thus, biological events involving single CpGs might not be detected by our procedure. However, our method is well-suited for functional differences involving multiple CpGs working in conjunction.</p>
  </sec>
  <sec sec-type="materials|methods">
    <title>Materials and methods</title>
    <sec>
      <title>Datasets</title>
      <p>The Lister data are from a WGBS experiment on the IMR90 fibroblast cell line. Six different library preparations were sequenced individually on an Illumina sequencer using up to 87 bp single-end reads and subsequently pooled to yield 25× coverage of CpGs. The Hansen data are from a WGBS experiment on three paired tumor-normal colon samples, sequenced on ABI SOLiD using 50 bp single-end reads with a CpG coverage of 4×. These data were prepared and sequenced in the laboratory of AP Feinberg. The Hansen-capture data comprise the same six samples as the Hansen data sequenced on an Illumina sequencer with up to 80 bp single reads, using a bisulfite padlock probe (BSPP) capture protocol, yielding a CpG coverage of 11× to 57× of 40,000 capture regions (one sample had substantially lower coverage than the rest, and the capture regions varied in efficiency). These data were prepared and sequenced in the laboratory of K Zhang. The Tung data are from a WGBS experiment on peripheral blood mononuclear cells from six rhesus macaque individuals, three of high social rank and three of low social rank. The data were sequenced using an Illumina sequencer with 75 bp single end reads, yielding a CpG coverage of 11× to 14×.</p>
      <p>The Lister data were created in the following way: we obtained the raw reads from the IMR90 cell line and aligned against the hg19 genome using Merman with iterative trimming. Prior to alignment, two bases were trimmed from the start of the read and one base from the end of the read. Based on our M-bias plots, we furthermore filtered the last ten bases of every read (based on its trimmed length), when we summarized the methylation evidence. Based on the quality control plots, the flowcells marked ECKER_1062 were discarded. These data form the basis for all analysis of the Lister data in the manuscript as well as Figures S1 to S4 in Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>.</p>
      <p>In order to produce Figure S5 in Additional file <xref ref-type="supplementary-material" rid="S1">1</xref> we obtained aligned and summarized data from the Salk Institute website [<xref ref-type="bibr" rid="B29">29</xref>], specifically the two files mc_imr90_r1.tar.gz and mc_imr90_r2.tar.gz. For these two files, methylation calls in non-CpG context (of which there were very few) were discarded and their stranded methylation calls were summed into calls without strand. These files were mapped against the hg18 reference genome. We converted the coordinates from hg18 to hg19 using the liftOver tool from University of California, Santa Cruz.</p>
      <p>The Hansen WGBS data were aligned against hg19 without iterative trimming due to the short read length. Prior to alignment, we trimmed the primer base and one color from the start of the reads (this is a standard procedure before aligning colorspace reads and was not related to quality control assessment). Based on our M-bias plots we filtered 3 bp on either side of the read as part of summarizing the methylation evidence.</p>
      <p>The Hansen-capture data were aligned using iterative trimming, without trimming any initial bases before alignment. Based on our M-bias plots we filtered the first 15 bases of each read as part of summarizing the methylation evidence.</p>
      <p>The Tung data were aligned against rheMac 2.0 using Bismark [<xref ref-type="bibr" rid="B10">10</xref>]. The reads were truncated to 70 bp prior to alignment and the first three bases of each read were filtered as part of summarizing the methylation evidence. Additional detail is in [<xref ref-type="bibr" rid="B16">16</xref>]. The WGBS data were smoothed using the same parameters as for human data.</p>
      <p>We obtained the preprocessed gene expression data presented in the Tung <italic>et al</italic>. manuscript from the journal website. TSSs were obtained from the authors (personal communication).</p>
    </sec>
    <sec>
      <title>Smoothing</title>
      <p>We denote the number of reads associated with the <italic>j</italic>th CpG being methylated and unmethylated with <italic>M<sub>j </sub></italic>and <italic>U<sub>j</sub></italic>, respectively. The CpG-level summary is simply the proportion <italic>M<sub>j</sub></italic>/<italic>N<sub>j</sub></italic>, with <italic>N<sub>j</sub></italic>=<italic>M<sub>j</sub></italic>+<italic>U<sub>j </sub></italic>the coverage for the <italic>j</italic>th CpG. We assume each <italic>M<sub>j </sub></italic>follows a binomial distribution with success probability <italic>π<sub>j</sub></italic>. The success probability represents the true proportion of cells for which the <italic>j</italic>th CpG is methylated in the sample being assayed. The proportion <italic>M<sub>j</sub></italic>/<italic>N<sub>j </sub></italic>is an unbiased estimate of π<italic><sub>j </sub></italic>with standard error <inline-formula><mml:math id="M2" name="gb-2012-13-10-r83-i2" overflow="scroll"><mml:msqrt><mml:mrow><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo class="MathClass-open">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo class="MathClass-bin">-</mml:mo><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo class="MathClass-close">)</mml:mo></mml:mrow><mml:mo class="MathClass-bin">/</mml:mo><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msqrt></mml:math></inline-formula>, and we denote <inline-formula><mml:math id="M3" name="gb-2012-13-10-r83-i3" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>π</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>≡</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>/</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> the single-CpG methylation estimate of π<italic><sub>j</sub></italic>. We furthermore assume that π<italic><sub>j </sub></italic>is defined by a smoothly varying function <italic>f </italic>of the genomic location, that is, for location <italic>l<sub>j</sub></italic>, π<italic><sub>j</sub></italic>=<italic>f</italic>(<italic>l<sub>j</sub></italic>). We estimate <italic>f </italic>with a local-likelihood smoother [<xref ref-type="bibr" rid="B28">28</xref>]. We start by choosing a genomic window size <italic>h</italic>(<italic>l<sub>j</sub></italic>) for each <italic>l<sub>j</sub></italic>. The window is made large enough so that 70 CpGs are included but at least 2 kb wide. Within each genomic window we assume log[<italic>f</italic>(<italic>l<sub>j</sub></italic>)/{1-<italic>f</italic>(<italic>l<sub>j</sub></italic>)}] is approximated by a second degree polynomial. We assume that data follow a binomial distribution and the parameters defining the polynomial are estimated by fitting a weighted generalized linear model to the data inside the genomic window. For data points inside this window, indexed by <italic>l<sub>k</sub></italic>, weights are inversely proportional to the standard errors of the CpG-level measurements, <inline-formula><mml:math id="M4" name="gb-2012-13-10-r83-i4" overflow="scroll"><mml:msqrt><mml:mrow><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo class="MathClass-open">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo class="MathClass-bin">-</mml:mo><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo class="MathClass-close">)</mml:mo></mml:mrow><mml:mo class="MathClass-bin">/</mml:mo><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msqrt></mml:math></inline-formula>, and decrease with the distance between the loci |<italic>l<sub>k</sub></italic>-<italic>l<sub>j</sub></italic>| according to a tricube kernel (Figure <xref ref-type="fig" rid="F3">3a,b</xref>). Note that the smoothness of our estimated profile <inline-formula><mml:math id="M5" name="gb-2012-13-10-r83-i7" overflow="scroll"><mml:mrow><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> depends on genomic CpG density. We recommend users adapt the algorithm's parameters when applying it to organisms other than human.</p>
    </sec>
    <sec>
      <title>Identification of differentially methylated regions</title>
      <p>To find regions exhibiting consistent differences between groups of samples, taking biological variation into account, we compute a signal-to-noise statistic similar to the <italic>t</italic>-test. Specifically, we denote individuals with <italic>i </italic>and use <italic>X<sub>i </sub></italic>do denote group; for example, <italic>X<sub>i</sub></italic>=0 if the <italic>i</italic>th sample is a control and <italic>X<sub>i</sub></italic>=1 if a case. The number of controls is denoted <italic>n</italic><sub>1 </sub>and the number of cases <italic>n</italic><sub>2</sub>. We assume that the samples are biological replicates within a group. Similar to the previous section, we denote the number of reads for the <italic>i</italic>th sample associated with the <italic>j</italic>th CpG being methylated and unmethylated with <italic>M<sub>i,j </sub></italic>and <italic>U<sub>i,j</sub></italic>, respectively. We assume that <italic>Y<sub>i,j </sub></italic>follows a binomial distribution with <italic>M<sub>i,j</sub></italic>+<italic>U<sub>i,j </sub></italic>trials and success probability π<italic><sub>i,j</sub></italic>, which we assume is a sample-specific smooth function of genomic location <italic>l<sub>j</sub></italic>: π<italic><sub>i,j</sub></italic>=<italic>f</italic><sub>i</sub>(<italic>l<sub>j</sub></italic>). Furthermore, we assume that <italic>f<sub>i </sub></italic>has the form <italic>f<sub>i</sub></italic>(<italic>l<sub>j</sub></italic>)=α(<italic>l<sub>j</sub></italic>)+β(<italic>l<sub>j</sub></italic>)<italic>X<sub>i</sub></italic>+ε<italic><sub>i,j</sub></italic>. Here α(<italic>l<sub>j</sub></italic>) represents the baseline methylation profile and β(<italic>l<sub>j</sub></italic>) the true difference between the two groups. The latter is the function of interest, with non-zero values associated with DMRs. The ε<italic><sub>i,j </sub></italic>s represent biological variability with the location-dependent variance var(ε<italic><sub>i,j</sub></italic>)≡σ<sup>2</sup>(<italic>j</italic>) assumed to be a smooth function. Note that increasing coverage does not reduce the variability introduced by ε; for this we need to increase the number of biological replicates.</p>
      <p>We use the smoothed methylation profiles described in the previous section as estimates for the fi, denoted <inline-formula><mml:math id="M6" name="gb-2012-13-10-r83-i8" overflow="scroll"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. We estimate α and β as empirical averages and difference of averages: <inline-formula><mml:math id="M7" name="gb-2012-13-10-r83-i5" overflow="scroll"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="normal">α</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M8" name="gb-2012-13-10-r83-i12" overflow="scroll"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="normal">β</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>:</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo></mml:mrow></mml:mstyle><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>:</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula>. To estimate the smooth location-dependent standard deviation, we first compute the empirical standard deviation across the two groups. To improve precision, we used an approach similar to [<xref ref-type="bibr" rid="B30">30</xref>]: we floored these standard deviations at their 75th percentile. To further improve precision, we smoothed the resulting floored values using a running mean with a window size of 101. We denote this final estimate of local variation with <inline-formula><mml:math id="M9" name="gb-2012-13-10-r83-i9" overflow="scroll"><mml:mrow><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. We then formed signal-to-noise statistics: <inline-formula><mml:math id="M10" name="gb-2012-13-10-r83-i6" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mi mathvariant="normal">β</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>/</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mover accent="true"><mml:mi mathvariant="normal">σ</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msqrt><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:msqrt><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>. To find DMRs, that is, regions for which β(<italic>l<sub>j</sub></italic>)≠0, we defined groups of consecutive CpGs for which all <italic>t</italic>(<italic>l<sub>j</sub></italic>)&gt;<italic>c </italic>or <italic>t</italic>(<italic>l<sub>j</sub></italic>)&lt;-<italic>c </italic>with <italic>c</italic>&gt;0 a cutoff selected based on the marginal empirical distribution of <italic>t</italic>. We adapted our algorithm so that CpGs further than 300 bp apart were not permitted to be in the same DMR.</p>
      <p>We recommend including in the procedure only CpGs that have some coverage in most or all samples. Furthermore, we recommend filtering the set of DMRs by requiring each DMR to contain at least three CpGs, have an average β of 0.1 or greater, and have at least one CpG every 300 bp.</p>
    </sec>
    <sec>
      <title>Practical considerations</title>
      <sec>
        <title>Sequencing effort</title>
        <p>BSmooth can estimate methylation precisely with as little as 4× average coverage, but two additional points should be considered regarding sequencing depth. First, greater depth generally allows a greater fraction of CpGs to be covered with read-level measurements. Second, in addition to depth, a key concern is the length of the reads and whether the reads are paired-end reads. Longer reads and paired-end reads are more likely to align with high mapping quality, that is, a low probability of having been aligned to the wrong location. Alignments with higher mapping quality lead to higher-confidence read-level measurements.</p>
        <p>At the time of writing, a single lane of the Illumina HiSeq 2000 instrument produces about 35 to 45 billion nucleotides of bisulfite sequencing data. After discarding low-quality alignment and bases, this results in around 19 million CpGs with a coverage of 2 or greater. If two lanes are used per sample, the increased depth results in around 23 million CpGs with a coverage of 2 or greater.</p>
      </sec>
      <sec>
        <title>Non-CpG methylation</title>
        <p>In humans, extensive non-CpG methylation has only been observed in embryonic stem cells [<xref ref-type="bibr" rid="B3">3</xref>]. We have not used BSmooth to study non-CpG methylation in humans, but we hypothesize it would be well suited for this purpose. Note that the alignment part of BSmooth is not affected by non-CpG methylation provided the sequencing reads are generated in nucleotide space and not colorspace. Note that there are many more Cs in the genome than CpGs; thus, analyzing these data greatly increased the memory requirements of our software. Although the current implementation does not allow this, it is a software issue that could potentially be addressed.</p>
      </sec>
      <sec>
        <title>Detection limit</title>
        <p>BSmooth assumes that the true methylation profile is smooth. In genomic regions where the true methylation profile is not smooth, BSmooth will still provide smooth estimates. Thus, biological events involving single CpGs might not be detected by our procedure. However, our procedure should still be useful if a single CpG is associated with a biological event, provided that changes in methylation of this single CpG also lead to changes in methylation of nearby CpGs. Detecting methylation changes in a single CpG without changes in nearby CpGs would need to use single-CpG estimates based on higher coverage than 4×. Such single-CpG estimates could potentially be more affected by technical biases. Note that Fisher's exact test does not account for biological variation.</p>
      </sec>
    </sec>
    <sec>
      <title>Modification of the algorithm for analysis of cancer datasets</title>
      <p>Note that between-sample variability is larger in cancer samples [<xref ref-type="bibr" rid="B1">1</xref>]. If one is interested in detecting DMRs in which the cancer varies but the normal samples are consistent, then we recommend using only the normal samples to estimate σ(<italic>j</italic>). Cancer/normal comparisons also exhibit large blocks of hypo-methylation in cancer [<xref ref-type="bibr" rid="B1">1</xref>]. These blocks are much longer genomic regions than previously reported DMRs and are observed in CpG sparse genomic regions. To account for these features we adapted the DMR algorithm as described in detail in Hansen <italic>et al</italic>. [<xref ref-type="bibr" rid="B1">1</xref>] and below.</p>
      <p>To identify large hypomethylated blocks in cancer, we changed the DMR detection algorithm in two ways: first, we changed the smoothing algorithm described above to increase the window size to include 500 CpGs of at least 40 kb wide. We also relaxed the cutoff on the signal-to-noise statistics, since many more CpGs are involved in blocks. This method - essentially the same method as used to find small scale DMRs, but using smoothing across a wider window - identifies large scale changes that are consistently different between cancer and normals. In case these large scale changes have different boundaries in different samples, this method will detect segments that are consistently different. However, in Hansen <italic>et al</italic>. [<xref ref-type="bibr" rid="B1">1</xref>] we show that the observed boundaries appear to be consistent across samples.</p>
      <p>Once these large scale changes were identified we also modified the algorithm to identify small-scale DMRs (&lt;10 kb) within the block regions, as described below. For all of this, we use an estimate of σ(<italic>j</italic>) that is only based on the three normal samples, as described above. Given the large hypo-methylated blocks in cancer, it is necessary to update the model described in the section on 'Identification of differentially methylated regions' as described above. The previous model assumes that <italic>f<sub>i</sub></italic>(<italic>l<sub>j</sub></italic>)=α(<italic>l<sub>j</sub></italic>)+β(<italic>l<sub>j</sub></italic>)<italic>X<sub>i</sub></italic>+ε<italic><sub>i,j</sub></italic>. We now additionally assume that β(<italic>l<sub>j</sub></italic>) has the form β(<italic>l<sub>j</sub></italic>)=β<sub>1</sub>(<italic>l<sub>j</sub></italic>)+β<sub>2</sub>(<italic>l<sub>j</sub></italic>), and thus is composed of two components, β<sub>1</sub>(<italic>l<sub>j</sub></italic>) and β<sub>2</sub>(<italic>l<sub>j</sub></italic>), representing small DMRs and blocks, respectively. Note that β<sub>2</sub>(<italic>l<sub>j</sub></italic>) is much more slowly varying than β<sub>1</sub>(<italic>l<sub>j</sub></italic>). The signal-to-noise statistics <italic>t</italic>(<italic>l<sub>j</sub></italic>), described in the section on 'Identification of differentially methylated regions', should be large (in absolute value) when either β<sub>1 </sub>or β<sub>2 </sub>are different from 0. Because β(<italic>l<sub>j</sub></italic>) now consists of two components, the signal-to-noise statistic <italic>t</italic>(<italic>l<sub>j</sub></italic>) also decomposes into two components <italic>t</italic>(<italic>l<sub>j</sub></italic>)=<italic>t</italic><sub>1</sub>(<italic>l<sub>j</sub></italic>)+<italic>t</italic><sub>2</sub>(<italic>l<sub>j</sub></italic>), with the first component associated with β<sub>1</sub>(<italic>l<sub>j</sub></italic>) and the second, slowly varying, component associated with β<sub>2</sub>(<italic>l<sub>j</sub></italic>). In order to find small DMRs, we need to form an estimate of the second component, denoted <inline-formula><mml:math id="M11" name="gb-2012-13-10-r83-i10" overflow="scroll"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>t</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and form corrected signal-to-noise statistics <inline-formula><mml:math id="M12" name="gb-2012-13-10-r83-i11" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>t</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. We estimate <italic>t</italic><sub>2</sub>(<italic>l<sub>j</sub></italic>) by identifying the slow-varying component of <italic>t</italic>(<italic>l<sub>j</sub></italic>) in the following way: first we interpolate <italic>t</italic>(<italic>l<sub>j</sub></italic>) to define <italic>t</italic>(<italic>l</italic>) for a general genomic location <italic>l</italic>. This function is evaluated at a 2 kb grid, and smoothed using a robust local likelihood model with a window size of 50 kb. This slowly varying function is then evaluated at CpG locations <italic>l<sub>j </sub></italic>to form the estimate <inline-formula><mml:math id="M13" name="gb-2012-13-10-r83-i10" overflow="scroll"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>t</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. We the identify small DMRs by using corrected signal-to-noise statistics <inline-formula><mml:math id="M14" name="gb-2012-13-10-r83-i11" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>t</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> instead of <italic>t</italic>(<italic>l<sub>j</sub></italic>), in the section on 'Identification of differentially methylated regions'.</p>
    </sec>
    <sec>
      <title>ROC curves and Fisher's exact test</title>
      <p>We defined gold standard regions as follows. We consider high-coverage CpGs to be CpGs with a coverage ≥30×, and we use the pre-defined capture regions. For the first definition of positive and negative regions, we include regions for which at least two out of three cancer samples and at least two out of three normal samples have at least five high-coverage CpGs. This was done because one of the normal samples had lower coverage than the other two. For each such region we compute the average methylation in the cancer samples and the normal samples by first averaging methylation across high-coverage CpGs within a sample and then average across samples. Positives were defined as regions with difference between average cancer methylation and average normal methylation &gt;0.25. Negatives were defined as regions for which the difference is &lt;0.03. For the second definition, we compute the sample-specific average methylation level across the capture region using only high-coverage CpGs, and we only include regions with at least four high-coverage CpGs in each of the six samples. This was done because the Welch <italic>t</italic>-test requires at least three samples in each group, but it also leads to the exclusion of many regions included in the first definition, because of the single sample with lower coverage. For each region with data from all six samples, a Welch <italic>t</italic>-test was done on six numbers representing the average methylation across the region in each sample. Positives were such regions with an unadjusted <italic>P</italic>-value &lt;1%. Negatives were such regions with an unadjusted <italic>P</italic>-value &gt;25%.</p>
      <p>We implemented a DMR finder based on Fisher's exact test, closely following the description in the supplementary material of Lister <italic>et al</italic>. [<xref ref-type="bibr" rid="B3">3</xref>]. We were able to reproduce 99% of the DMRs reported in that study. This DMR finder produces DMRs that are at least 2 kb long, containing at least 10 CpGs that are differentially methylated according to Fisher's exact test. In addition, every 1 kb subregion contains at least four such CpGs.</p>
    </sec>
    <sec>
      <title>Software</title>
      <p>BSmooth is open source software [<xref ref-type="bibr" rid="B31">31</xref>].</p>
    </sec>
  </sec>
  <sec>
    <title>Abbreviations</title>
    <p>DMR: differentially methylated region; FDR: false discovery rate; ROC: receiver operating characteristic; TSS: transcription start site; WGBS: whole-genome bisulfite sequencing.</p>
  </sec>
  <sec>
    <title>Competing interests</title>
    <p>The authors declare that they have no competing interests.</p>
  </sec>
  <sec>
    <title>Authors' contributions</title>
    <p>KDH and RAI designed the smoothing method, and KDH implemented it. BL designed and implemented the alignment methods. All authors read and approved the final manuscript for publication.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="S1">
      <caption>
        <title>Additional file 1</title>
        <p><bold>Additional figures</bold>. A PDF file containing Figures S1 to S5.</p>
      </caption>
      <media xlink:href="gb-2012-13-10-r83-S1.pdf" mimetype="application" mime-subtype="pdf">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="S2">
      <caption>
        <title>Additional file 2</title>
        <p><bold>Alignment code</bold>.</p>
      </caption>
      <media xlink:href="gb-2012-13-10-r83-S2.gz" mimetype="application" mime-subtype="x-zip-compressed">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="S3">
      <caption>
        <title>Additional file 3</title>
        <p><bold>Data analysis code</bold>.</p>
      </caption>
      <media xlink:href="gb-2012-13-10-r83-S3.gz" mimetype="application" mime-subtype="x-zip-compressed">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Acknowledgements</title>
    <p>This work was partially funded by HG004059 and P50HG003233. We thank Andrew P Feinberg for motivating the biological questions that led to the development of the analytical method; also for trusting us and running a large cancer experiment with 4× coverage. We thank Sarven Sabunciyan for helping us understand the technology, Héctor Corrada-Bravo for discussions related to quality control and Margaret Taub for general comments and suggestions.</p>
  </sec>
  <ref-list>
    <ref id="B1">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Hansen</surname>
          <given-names>KD</given-names>
        </name>
        <name>
          <surname>Timp</surname>
          <given-names>W</given-names>
        </name>
        <name>
          <surname>Corrada Bravo</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Sabunciyan</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Langmead</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>McDonald</surname>
          <given-names>OG</given-names>
        </name>
        <name>
          <surname>Wen</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Wu</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Liu</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Diep</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Briem</surname>
          <given-names>E</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Irizarry</surname>
          <given-names>RA</given-names>
        </name>
        <name>
          <surname>Feinberg</surname>
          <given-names>AP</given-names>
        </name>
        <article-title>Generalized loss of stability of epigenetic domains across cancer types.</article-title>
        <source>Nat Genet</source>
        <year>2011</year>
        <volume>43</volume>
        <fpage>768</fpage>
        <lpage>775</lpage>
        <pub-id pub-id-type="doi">10.1038/ng.865</pub-id>
        <pub-id pub-id-type="pmid">21706001</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B2">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Laird</surname>
          <given-names>PW</given-names>
        </name>
        <article-title>Principles and challenges of genome-wide DNA methylation analysis</article-title>
        <source>Nat Rev Genet</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>191</fpage>
        <pub-id pub-id-type="pmid">20125086</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B3">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Lister</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Pelizzola</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Dowen</surname>
          <given-names>RH</given-names>
        </name>
        <name>
          <surname>Hawkins</surname>
          <given-names>RD</given-names>
        </name>
        <name>
          <surname>Hon</surname>
          <given-names>GC</given-names>
        </name>
        <name>
          <surname>Tonti-Filippini</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Nery</surname>
          <given-names>JR</given-names>
        </name>
        <name>
          <surname>Lee</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Ye</surname>
          <given-names>Z</given-names>
        </name>
        <name>
          <surname>Ngo</surname>
          <given-names>QM</given-names>
        </name>
        <name>
          <surname>Edsall</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Antosiewicz-Bourget</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Stewart</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Ruotti</surname>
          <given-names>V</given-names>
        </name>
        <name>
          <surname>Millar</surname>
          <given-names>AH</given-names>
        </name>
        <name>
          <surname>Thomson</surname>
          <given-names>JA</given-names>
        </name>
        <name>
          <surname>Ren</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Ecker</surname>
          <given-names>JR</given-names>
        </name>
        <article-title>Human DNA methylomes at base resolution show widespread epigenomic differences.</article-title>
        <source>Nature</source>
        <year>2009</year>
        <volume>462</volume>
        <fpage>315</fpage>
        <lpage>322</lpage>
        <pub-id pub-id-type="doi">10.1038/nature08514</pub-id>
        <pub-id pub-id-type="pmid">19829295</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B4">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Jaffe</surname>
          <given-names>AE</given-names>
        </name>
        <name>
          <surname>Feinberg</surname>
          <given-names>AP</given-names>
        </name>
        <name>
          <surname>Irizarry</surname>
          <given-names>RA</given-names>
        </name>
        <name>
          <surname>Leek</surname>
          <given-names>JT</given-names>
        </name>
        <article-title>Significance analysis and statistical dissection of variably methylated regions</article-title>
        <source>Biostatistics</source>
        <year>2012</year>
        <volume>13</volume>
        <fpage>166</fpage>
        <lpage>178</lpage>
        <pub-id pub-id-type="doi">10.1093/biostatistics/kxr013</pub-id>
        <pub-id pub-id-type="pmid">21685414</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B5">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Zeschnigk</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Martin</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Betzl</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Kalbe</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Sirsch</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Buiting</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Gross</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Fritzilas</surname>
          <given-names>E</given-names>
        </name>
        <name>
          <surname>Frey</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Rahmann</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Hors- themke</surname>
          <given-names>B</given-names>
        </name>
        <article-title>Massive parallel bisulfite sequencing of CG-rich DNA fragments reveals that methylation of many X-chromosomal CpG islands in female blood DNA is incomplete</article-title>
        <source>Hum Mol Genet</source>
        <year>2009</year>
        <volume>18</volume>
        <fpage>1439</fpage>
        <lpage>1448</lpage>
        <pub-id pub-id-type="doi">10.1093/hmg/ddp054</pub-id>
        <pub-id pub-id-type="pmid">19223391</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B6">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Coarfa</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Yu</surname>
          <given-names>F</given-names>
        </name>
        <name>
          <surname>Miller</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Chen</surname>
          <given-names>Z</given-names>
        </name>
        <name>
          <surname>Harris</surname>
          <given-names>RA</given-names>
        </name>
        <name>
          <surname>Milosavljevic</surname>
          <given-names>A</given-names>
        </name>
        <article-title>Pash 3.0: A versatile software package for read mapping and integrative analysis of genomic and epigenomic variation using massively parallel DNA sequencing</article-title>
        <source>BMC Bioinformatics</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>572</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-11-572</pub-id>
        <pub-id pub-id-type="pmid">21092284</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B7">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Harris</surname>
          <given-names>EY</given-names>
        </name>
        <name>
          <surname>Ponts</surname>
          <given-names>N</given-names>
        </name>
        <name>
          <surname>Levchuk</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Roch</surname>
          <given-names>KL</given-names>
        </name>
        <name>
          <surname>Lonardi</surname>
          <given-names>S</given-names>
        </name>
        <article-title>BRAT: bisulfite-treated reads analysis tool</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>572</fpage>
        <lpage>573</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp706</pub-id>
        <pub-id pub-id-type="pmid">20031974</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B8">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Chen</surname>
          <given-names>PY</given-names>
        </name>
        <name>
          <surname>Cokus</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Pellegrini</surname>
          <given-names>M</given-names>
        </name>
        <article-title>BS Seeker: precise mapping for bisulfite sequencing.</article-title>
        <source>BMC Bioinformatics</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>203</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-11-203</pub-id>
        <pub-id pub-id-type="pmid">20416082</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B9">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Xi</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Li</surname>
          <given-names>W</given-names>
        </name>
        <article-title>BSMAP: whole genome bisulfite sequence MAPping program</article-title>
        <source>BMC Bioinformatics</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>232</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-10-232</pub-id>
        <pub-id pub-id-type="pmid">19635165</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B10">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Krueger</surname>
          <given-names>F</given-names>
        </name>
        <name>
          <surname>Andrews</surname>
          <given-names>SR</given-names>
        </name>
        <article-title>Bismark: a flexible aligner and methylation caller for Bisulfite-Seq applications</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>27</volume>
        <fpage>1571</fpage>
        <lpage>1572</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr167</pub-id>
        <pub-id pub-id-type="pmid">21493656</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B11">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Lister</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Pelizzola</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Kida</surname>
          <given-names>YS</given-names>
        </name>
        <name>
          <surname>Hawkins</surname>
          <given-names>RD</given-names>
        </name>
        <name>
          <surname>Nery</surname>
          <given-names>JR</given-names>
        </name>
        <name>
          <surname>Hon</surname>
          <given-names>GC</given-names>
        </name>
        <name>
          <surname>Antosiewicz-Bourget</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>O'Malley</surname>
          <given-names>RC</given-names>
        </name>
        <name>
          <surname>Castanon</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Klugman</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Downes</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Yu</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Stewart</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Ren</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Thomson</surname>
          <given-names>JA</given-names>
        </name>
        <name>
          <surname>Evans</surname>
          <given-names>RM</given-names>
        </name>
        <name>
          <surname>Ecker</surname>
          <given-names>JR</given-names>
        </name>
        <article-title>Hotspots of aberrant epigenomic reprogramming in human induced pluripotent stem cells.</article-title>
        <source>Nature</source>
        <year>2011</year>
        <volume>471</volume>
        <fpage>68</fpage>
        <lpage>73</lpage>
        <pub-id pub-id-type="doi">10.1038/nature09798</pub-id>
        <pub-id pub-id-type="pmid">21289626</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B12">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Li</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Zhu</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Tian</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Li</surname>
          <given-names>N</given-names>
        </name>
        <name>
          <surname>Li</surname>
          <given-names>Q</given-names>
        </name>
        <name>
          <surname>Ye</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Zheng</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Yu</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Wu</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Sun</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Chen</surname>
          <given-names>Q</given-names>
        </name>
        <name>
          <surname>Luo</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Chen</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>He</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Jin</surname>
          <given-names>X</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>Q</given-names>
        </name>
        <name>
          <surname>Yu</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Zhou</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Sun</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Huang</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Zheng</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Cao</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Zhou</surname>
          <given-names>X</given-names>
        </name>
        <name>
          <surname>Guo</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Hu</surname>
          <given-names>X</given-names>
        </name>
        <name>
          <surname>Li</surname>
          <given-names>X</given-names>
        </name>
        <name>
          <surname>Kristiansen</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Bolund</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Xu</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Wang</surname>
          <given-names>W</given-names>
        </name>
        <name>
          <surname>Yang</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Wang</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Li</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Beck</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Wang</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>X</given-names>
        </name>
        <article-title>The DNA methylome of human peripheral blood mononuclear cells</article-title>
        <source>PLoS Biol</source>
        <year>2010</year>
        <volume>8</volume>
        <fpage>e1000533</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pbio.1000533</pub-id>
        <pub-id pub-id-type="pmid">21085693</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B13">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Becker</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Hagmann</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>MÄuller</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Koenig</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Stegle</surname>
          <given-names>O</given-names>
        </name>
        <name>
          <surname>Borgwardt</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Weigel</surname>
          <given-names>D</given-names>
        </name>
        <article-title>Spontaneous epigenetic variation in the Arabidopsis thaliana methylome.</article-title>
        <source>Nature</source>
        <year>2011</year>
        <volume>480</volume>
        <fpage>245</fpage>
        <lpage>249</lpage>
        <pub-id pub-id-type="doi">10.1038/nature10555</pub-id>
        <pub-id pub-id-type="pmid">22057020</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B14">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Laurent</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Wong</surname>
          <given-names>E</given-names>
        </name>
        <name>
          <surname>Li</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Huynh</surname>
          <given-names>T</given-names>
        </name>
        <name>
          <surname>Tsirigos</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Ong</surname>
          <given-names>CT</given-names>
        </name>
        <name>
          <surname>Low</surname>
          <given-names>HM</given-names>
        </name>
        <name>
          <surname>Kin Sung</surname>
          <given-names>KW</given-names>
        </name>
        <name>
          <surname>Rigoutsos</surname>
          <given-names>I</given-names>
        </name>
        <name>
          <surname>Loring</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Wei</surname>
          <given-names>CL</given-names>
        </name>
        <article-title>Dynamic changes in the human methylome during differentiation.</article-title>
        <source>Genome Res</source>
        <year>2010</year>
        <volume>20</volume>
        <fpage>320</fpage>
        <lpage>331</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.101907.109</pub-id>
        <pub-id pub-id-type="pmid">20133333</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B15">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Hodges</surname>
          <given-names>E</given-names>
        </name>
        <name>
          <surname>Molaro</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Dos Santos</surname>
          <given-names>CO</given-names>
        </name>
        <name>
          <surname>Thekkat</surname>
          <given-names>P</given-names>
        </name>
        <name>
          <surname>Song</surname>
          <given-names>Q</given-names>
        </name>
        <name>
          <surname>Uren</surname>
          <given-names>PJ</given-names>
        </name>
        <name>
          <surname>Park</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Butler</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Rafii</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>McCombie</surname>
          <given-names>WR</given-names>
        </name>
        <name>
          <surname>Smith</surname>
          <given-names>AD</given-names>
        </name>
        <name>
          <surname>Hannon</surname>
          <given-names>GJ</given-names>
        </name>
        <article-title>Directional DNA methylation changes and complex intermediate states accompany lineage specificity in the adult hematopoietic compartment.</article-title>
        <source>Mol Cell</source>
        <year>2011</year>
        <volume>44</volume>
        <fpage>17</fpage>
        <lpage>28</lpage>
        <pub-id pub-id-type="doi">10.1016/j.molcel.2011.08.026</pub-id>
        <pub-id pub-id-type="pmid">21924933</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B16">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Tung</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Barreiro</surname>
          <given-names>LB</given-names>
        </name>
        <name>
          <surname>Johnson</surname>
          <given-names>ZP</given-names>
        </name>
        <name>
          <surname>Hansen</surname>
          <given-names>KD</given-names>
        </name>
        <name>
          <surname>Michopoulos</surname>
          <given-names>V</given-names>
        </name>
        <name>
          <surname>Toufexis</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Michelini</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Wilson</surname>
          <given-names>ME</given-names>
        </name>
        <name>
          <surname>Gilad</surname>
          <given-names>Y</given-names>
        </name>
        <article-title>Social environment is associated with gene regulatory variation in the rhesus macaque immune system.</article-title>
        <source>Proc Natl Acad Sci USA</source>
        <year>2012</year>
        <volume>109</volume>
        <fpage>6490</fpage>
        <lpage>6495</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1202734109</pub-id>
        <pub-id pub-id-type="pmid">22493251</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B17">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Lister</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>O'Malley</surname>
          <given-names>RC</given-names>
        </name>
        <name>
          <surname>Tonti-Filippini</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Gregory</surname>
          <given-names>BD</given-names>
        </name>
        <name>
          <surname>Berry</surname>
          <given-names>CC</given-names>
        </name>
        <name>
          <surname>Millar</surname>
          <given-names>AH</given-names>
        </name>
        <name>
          <surname>Ecker</surname>
          <given-names>JR</given-names>
        </name>
        <article-title>Highly integrated single-base resolution maps of the epigenome in Arabidopsis.</article-title>
        <source>Cell</source>
        <year>2008</year>
        <volume>133</volume>
        <fpage>523</fpage>
        <lpage>536</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2008.03.029</pub-id>
        <pub-id pub-id-type="pmid">18423832</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B18">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Kreck</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Marnellos</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Richter</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Krueger</surname>
          <given-names>F</given-names>
        </name>
        <name>
          <surname>Siebert</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Franke</surname>
          <given-names>A</given-names>
        </name>
        <article-title>B-SOLANA: an approach for the analysis of two-base encoding bisulfite sequencing data</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <fpage>428</fpage>
        <lpage>429</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr660</pub-id>
        <pub-id pub-id-type="pmid">22155865</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B19">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Langmead</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Trapnell</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Pop</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Salzberg</surname>
          <given-names>S</given-names>
        </name>
        <article-title>Ultrafast and memory-efficient alignment of short DNA sequences to the human genome</article-title>
        <source>Genome Biol</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>R25</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2009-10-3-r25</pub-id>
        <pub-id pub-id-type="pmid">19261174</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B20">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Langmead</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Salzberg</surname>
          <given-names>SL</given-names>
        </name>
        <article-title>Fast gapped-read alignment with Bowtie 2.</article-title>
        <source>Nat Methods</source>
        <year>2012</year>
        <volume>9</volume>
        <fpage>357</fpage>
        <lpage>359</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.1923</pub-id>
        <pub-id pub-id-type="pmid">22388286</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B21">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Li</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Handsaker</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Wysoker</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Fennell</surname>
          <given-names>T</given-names>
        </name>
        <name>
          <surname>Ruan</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Homer</surname>
          <given-names>N</given-names>
        </name>
        <name>
          <surname>Marth</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Abecasis</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Durbin</surname>
          <given-names>R</given-names>
        </name>
        <article-title>The sequence alignment/map format and SAMtools.</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>2078</fpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp352</pub-id>
        <pub-id pub-id-type="pmid">19505943</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B22">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Taub</surname>
          <given-names>MA</given-names>
        </name>
        <name>
          <surname>Corrada Bravo</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Irizarry</surname>
          <given-names>RA</given-names>
        </name>
        <article-title>Overcoming bias and systematic errors in next generation sequencing data</article-title>
        <source>Genome Med</source>
        <year>2010</year>
        <volume>2</volume>
        <fpage>87</fpage>
        <pub-id pub-id-type="doi">10.1186/gm208</pub-id>
        <pub-id pub-id-type="pmid">21144010</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B23">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Corrada Bravo</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Irizarry</surname>
          <given-names>RA</given-names>
        </name>
        <article-title>Model-based quality assessment and base-calling for second-generation sequencing data</article-title>
        <source>Biometrics</source>
        <year>2010</year>
        <volume>66</volume>
        <fpage>665</fpage>
        <lpage>674</lpage>
        <pub-id pub-id-type="doi">10.1111/j.1541-0420.2009.01353.x</pub-id>
        <pub-id pub-id-type="pmid">19912177</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B24">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Eckhardt</surname>
          <given-names>F</given-names>
        </name>
        <name>
          <surname>Lewin</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Cortese</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Rakyan</surname>
          <given-names>VK</given-names>
        </name>
        <name>
          <surname>Attwood</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Burger</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Burton</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Cox</surname>
          <given-names>TV</given-names>
        </name>
        <name>
          <surname>Davies</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Down</surname>
          <given-names>TA</given-names>
        </name>
        <name>
          <surname>Haefliger</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Horton</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Howe</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Jackson</surname>
          <given-names>DK</given-names>
        </name>
        <name>
          <surname>Kunde</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Koenig</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Liddle</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Niblett</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Otto</surname>
          <given-names>T</given-names>
        </name>
        <name>
          <surname>Pettett</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Seemann</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Thompson</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>West</surname>
          <given-names>T</given-names>
        </name>
        <name>
          <surname>Rogers</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Olek</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Berlin</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Beck</surname>
          <given-names>S</given-names>
        </name>
        <article-title>DNA methylation profiling of human chromosomes 6, 20 and 22.</article-title>
        <source>Nat Genet</source>
        <year>2006</year>
        <volume>38</volume>
        <fpage>1378</fpage>
        <lpage>1385</lpage>
        <pub-id pub-id-type="doi">10.1038/ng1909</pub-id>
        <pub-id pub-id-type="pmid">17072317</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B25">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Irizarry</surname>
          <given-names>RA</given-names>
        </name>
        <name>
          <surname>Ladd-Acosta</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Carvalho</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Wu</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Brandenburg</surname>
          <given-names>SA</given-names>
        </name>
        <name>
          <surname>Jeddeloh</surname>
          <given-names>JA</given-names>
        </name>
        <name>
          <surname>Wen</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Feinberg</surname>
          <given-names>AP</given-names>
        </name>
        <article-title>Comprehensive high-throughput arrays for relative methylation (CHARM).</article-title>
        <source>Genome Res</source>
        <year>2008</year>
        <volume>18</volume>
        <fpage>780</fpage>
        <lpage>790</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.7301508</pub-id>
        <pub-id pub-id-type="pmid">18316654</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B26">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Jaenisch</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Bird</surname>
          <given-names>A</given-names>
        </name>
        <article-title>Epigenetic regulation of gene expression: how the genome integrates intrinsic and environmental signals</article-title>
        <source>Nat Genet</source>
        <year>2003</year>
        <volume>33</volume>
        <fpage>245</fpage>
        <lpage>254</lpage>
        <pub-id pub-id-type="doi">10.1038/ng1089</pub-id>
        <pub-id pub-id-type="pmid">12610534</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B27">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Irizarry</surname>
          <given-names>RA</given-names>
        </name>
        <name>
          <surname>Ladd-Acosta</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Wen</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Wu</surname>
          <given-names>Z</given-names>
        </name>
        <name>
          <surname>Montano</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Onyango</surname>
          <given-names>P</given-names>
        </name>
        <name>
          <surname>Cui</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Gabo</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Rongione</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Webster</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Ji</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Potash</surname>
          <given-names>JB</given-names>
        </name>
        <name>
          <surname>Sabunciyan</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Feinberg</surname>
          <given-names>AP</given-names>
        </name>
        <article-title>The human colon cancer methylome shows similar hypo- and hypermethylation at conserved tissue-specific CpG island shores.</article-title>
        <source>Nat Genet</source>
        <year>2009</year>
        <volume>41</volume>
        <fpage>178</fpage>
        <lpage>186</lpage>
        <pub-id pub-id-type="doi">10.1038/ng.298</pub-id>
        <pub-id pub-id-type="pmid">19151715</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B28">
      <mixed-citation publication-type="book">
        <name>
          <surname>Loader</surname>
          <given-names>C</given-names>
        </name>
        <source>Local Regression and Likelihood</source>
        <year>1999</year>
        <publisher-name>New York: Springer-Verlag</publisher-name>
      </mixed-citation>
    </ref>
    <ref id="B29">
      <mixed-citation publication-type="other">
        <article-title>The Human DNA Methylome</article-title>
        <ext-link ext-link-type="uri" xlink:href="http://neomorph.salk.edu/human_methylome/data.html">http://neomorph.salk.edu/human_methylome/data.html</ext-link>
      </mixed-citation>
    </ref>
    <ref id="B30">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Tusher</surname>
          <given-names>VG</given-names>
        </name>
        <name>
          <surname>Tibshirani</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Chu</surname>
          <given-names>G</given-names>
        </name>
        <article-title>Significance analysis of microarrays applied to the ionizing radiation response</article-title>
        <source>Proc Natl Acad Sci USA</source>
        <year>2001</year>
        <volume>98</volume>
        <fpage>5116</fpage>
        <lpage>5121</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.091062498</pub-id>
        <pub-id pub-id-type="pmid">11309499</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B31">
      <mixed-citation publication-type="other">
        <article-title>BSmooth</article-title>
        <ext-link ext-link-type="uri" xlink:href="http://rafalab.jhsph.edu/bsmooth">http://rafalab.jhsph.edu/bsmooth</ext-link>
      </mixed-citation>
    </ref>
  </ref-list>
</back>
