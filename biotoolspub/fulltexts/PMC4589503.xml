<?properties open_access?>
<?properties manuscript?>
<?origin nihpa?>
<?iso-abbr Nat. Methods?>
<?submitter-system nihms?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 8068858?>
<?submitter-authority myNCBI?>
<?submitter-login nature-structure?>
<?submitter-name Nature Publishing Group?>
<?domain nihpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4589503</article-id>
    <article-id pub-id-type="pmid">26301841</article-id>
    <article-id pub-id-type="doi">10.1038/nmeth.3549</article-id>
    <article-id pub-id-type="manuscript">nihpa712805</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Oscope identifies oscillatory genes in unsynchronized single cell RNA-seq experiments</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Leng</surname>
          <given-names>Ning</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Chu</surname>
          <given-names>Li-Fang</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Barry</surname>
          <given-names>Chris</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Yuan</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Choi</surname>
          <given-names>Jeea</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Xiaomao</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jiang</surname>
          <given-names>Peng</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Stewart</surname>
          <given-names>Ron M.</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Thomson</surname>
          <given-names>James A.</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref ref-type="aff" rid="A4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kendziorski</surname>
          <given-names>Christina</given-names>
        </name>
        <xref ref-type="aff" rid="A5">5</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Department of Statistics, University of Wisconsin, Madison, WI, USA</aff>
    <aff id="A2"><label>2</label>Morgridge Institute for Research, Madison, WI, USA</aff>
    <aff id="A3"><label>3</label>Department of Cell and Regenerative Biology, University of Wisconsin, Madison, WI, USA</aff>
    <aff id="A4"><label>4</label>Department of Molecular, Cellular, and Developmental Biology, University of California, Santa Barbara, CA, USA</aff>
    <aff id="A5"><label>5</label>Department of Biostatistics and Medical Informatics, University of Wisconsin, Madison, WI, USA</aff>
    <author-notes>
      <corresp id="CR1">Corresponding author: Christina Kendziorski (<email>kendzior@biostat.wisc.edu</email>)</corresp>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>6</day>
      <month>8</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>24</day>
      <month>8</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>10</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>01</day>
      <month>4</month>
      <year>2016</year>
    </pub-date>
    <volume>12</volume>
    <issue>10</issue>
    <fpage>947</fpage>
    <lpage>950</lpage>
    <!--elocation-id from pubmed: 10.1038/nmeth.3549-->
    <permissions>
      <license xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:<ext-link ext-link-type="uri" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</ext-link></license-p>
      </license>
    </permissions>
    <abstract>
      <p id="P1">Oscillatory gene expression is fundamental to mammalian development, but technologies to monitor expression oscillations are limited. We have developed a statistical approach called Oscope to identify and characterize the transcriptional dynamics of oscillating genes in single-cell RNA-seq data from an unsynchronized cell population. Applications to a number of data sets demonstrate the utility of the approach and also identify a potential artifact in the Fluidigm C1 platform.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P2">Oscillatory gene expression is fundamental to mammalian development, homeostasis, and function<sup><xref rid="R1" ref-type="bibr">1</xref></sup>, yet technologies to monitor expression oscillations are limited. Recent advances in live-cell imaging have improved the sensitivity and specificity with which continuous measurements can be made within a single cell<sup><xref rid="R2" ref-type="bibr">2</xref></sup>, but due to limitations associated with reporters and detection channels, relatively few genes can be monitored in any given experiment. To study transcriptional oscillations on a genome-wide scale, mRNA microarray or RNA-seq time series experiments are often conducted<sup><xref rid="R3" ref-type="bibr">3</xref></sup>. Despite the benefits, heterogeneity in gene-specific frequency and phase make it difficult to identify an optimal sampling rate; and these methods require large quantities of synchronized starting material and consequently are limited to measurements of expression averaged over thousands of cells. Averaging over cells may miss or even misrepresent<sup><xref rid="R4" ref-type="bibr">4</xref></sup> oscillations. Cell synchronization prior to profiling attenuates a number of these problems to enable study of a known oscillatory system (typically the cell cycle), but can dramatically alter the transcriptional dynamics of others, and does not facilitate <italic>de novo</italic> discovery.</p>
  <p id="P3">Single cell RNA-seq (scRNA-seq) is a promising technology that allows for genome-wide expression profiling within a single cell, and thereby has the potential to capture a more precise representation of oscillation dynamics as well as unmask oscillations that are missed in bulk expression experiments. However, continuous monitoring within a cell is not possible, and high-resolution scRNA-seq time series experiments in distinct cells are prohibitive given the time required for sample preparation and sequencing. Even when scRNA-seq time series experiments become feasible, challenges associated with rate heterogeneity, sampling, and synchronization will remain.</p>
  <p id="P4">Computational algorithms have been developed to address some of these challenges in both microarray<sup><xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R7" ref-type="bibr">7</xref></sup> and scRNA-seq studies<sup><xref rid="R4" ref-type="bibr">4</xref></sup>, but none are focused on identifying oscillating genes. Most are based on the recognition that different samples represent distinct states in a system, such as time points along a continuum or progression toward an endpoint. By obtaining multiple samples at a single<sup><xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R7" ref-type="bibr">7</xref></sup> or a few<sup><xref rid="R4" ref-type="bibr">4</xref></sup> time points, and computationally reconstructing an appropriate order, temporal or other meaningful dynamics can be resolved. A key assumption that enables ordering is that genes do not change direction very often and thus samples with similar transcriptional profiles should be close in order.</p>
  <p id="P5">Oscillating genes pose challenges for these types of approaches since genes following the same oscillatory process need not have similar transcriptional profiles. Two genes with an identical frequency that are phase shifted, for example, will have little similarity (<bold><xref ref-type="fig" rid="F1">Fig. 1a</xref></bold>). We have developed an approach called Oscope to identify oscillating genes in static, unsynchronized, scRNA-seq experiments. Like previous algorithms, Oscope capitalizes on the fact that cells from an unsynchronized population represent distinct states in a system. However, unlike previous approaches, we do not attempt to construct a linear order based on minimizing change among adjacent samples. Rather, Oscope utilizes co-regulation information among oscillators to identify groups of putative oscillating genes, and then reconstructs the cyclic order of samples for each group, defined as the order that specifies each sample's position within one cycle of the oscillation (referred to as a base cycle). As detailed below and in Online Methods, the reconstructed order aims to recover gene-specific cyclic profiles defined by the group's base cycle allowing for phase shifts between different genes. Importantly, for different groups of genes following independent oscillatory processes and/or having distinct frequencies, the cyclic orders of cells need not be the same (see <bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 1</xref></bold>).</p>
  <p id="P6">Oscope is developed to identify oscillators in the scenario where a single cell's mRNA expression is oscillating through cell states. An overview is provided (<bold><xref ref-type="fig" rid="F1">Fig. 1a-g</xref>)</bold>. Specifically, shown is a schematic of a single-cell oscillating through cell states (<bold><xref ref-type="fig" rid="F1">Fig. 1a</xref></bold>). For simplicity, states are defined there by oscillations in just two genes. In a typical scRNA-seq experiment, cells are collected at the same calendar time <italic>T</italic>. However, without synchronizing, cells will be in different states at time <italic>T</italic> and consequently will have different gene expression values (<bold><xref ref-type="fig" rid="F1">Fig. 1b</xref></bold>). If it were possible to sort cells by the oscillation times of genes, defined as the amount of calendar time the cell has been oscillating prior to collection time <italic>T</italic>, identifying oscillating genes and characterizing their dynamics would be straightforward (<bold><xref ref-type="fig" rid="F1">Fig. 1c</xref></bold>). However, oscillation time is unobserved in an scRNA-seq experiment. With this type of snapshot data, gene expression of oscillating genes is indistinguishable from random noise (<bold><xref ref-type="fig" rid="F1">Fig. 1d</xref></bold>) and therefore existing methods<sup><xref rid="R8" ref-type="bibr">8</xref>,<xref rid="R9" ref-type="bibr">9</xref></sup> for identifying cyclic features are not applicable here. Recognizing that a scatter plot of expression values for genes oscillating with similar frequency will form an ellipse independent of order (<bold><xref ref-type="fig" rid="F1">Fig. 1e</xref></bold>), Oscope fits a 2-dimensional sinusoidal function to all gene pairs and chooses those with high scores. Note the elliptical shape is preserved when the oscillation has varying speed and/or when partial synchronization happens (see <bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 2</xref></bold>). Once candidate genes are identified, the K-medoids algorithm is applied to cluster genes into groups with similar frequencies, but possibly different phases. Then, for each group, Oscope recovers the cyclic order which places cells by their position within one cycle of the oscillatory process underlying the group. Given static data, it is not possible to reconstruct multiple cycles of an oscillatory process since the dynamics of late cycles are identical to those of earlier cycles, by definition. For example, the gene expression values in cells 2 and 4 are identical (<bold><xref ref-type="fig" rid="F1">Fig. 1b</xref></bold>), even though cell 2 has passed through a full cycle but cell 4 has not. Here we define the base cycle as the minimal cycle that is repeated in an oscillatory process (an example is shown in <bold><xref ref-type="fig" rid="F1">Fig. 1c</xref></bold>). Oscope uses an extended nearest insertion algorithm to order cells with respect to their position in a base cycle without specifying a direction of time (<bold><xref ref-type="fig" rid="F1">Fig. 1f</xref></bold>).</p>
  <p id="P7">The nearest insertion algorithm<sup><xref rid="R10" ref-type="bibr">10</xref></sup> was developed to address the traveling salesman problem. Given pairwise distances among cities, the nearest insertion algorithm provides a computationally efficient way to order cities so that overall distance travelled is minimized. Here, we extend the nearest insertion algorithm to order cells within an oscillatory gene group so that distance between each gene's expression and its gene-specific base cycle profile is minimized on average over all genes in the group. Once the recovered order for each group is obtained, if it is of interest to estimate phase or further characterize oscillations, subsequent algorithms developed for time course analysis may be applied (e.g. Fourier transformation, spline fitting, etc.).</p>
  <p id="P8">To evaluate the ability of Oscope to identify oscillating groups of genes and reconstruct the cyclic order underlying their base cycles, we consider a time series experiment where oscillating genes were of interest<sup><xref rid="R8" ref-type="bibr">8</xref></sup> and applied Oscope after permuting the sample order. The top gene group identified by Oscope had 151 genes, 116 of which were validated as oscillating in earlier work<sup><xref rid="R8" ref-type="bibr">8</xref></sup>. Shown are the reconstructed base cycles for four of the genes identified by Oscope (<bold><xref ref-type="fig" rid="F2">Fig. 2a</xref></bold>) compared with the known time series order (<bold><xref ref-type="fig" rid="F2">Fig. 2b</xref></bold>). The results demonstrate that Oscope successfully recovered the base cycle profile of each gene; phase shifts are also correctly inferred (<bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 3</xref></bold> shows all 151 genes). The results of simulation studies and additional case studies provide further insights into the operating characteristics of the approach (<xref ref-type="supplementary-material" rid="SD1">Supplementary Note, Supplementary Fig. 4-10 and Supplementary Table 1</xref>).</p>
  <p id="P9">To further evaluate Oscope on scRNA-seq data, we profiled single undifferentiated human embryonic stem cells (hESCs)<sup><xref rid="R11" ref-type="bibr">11</xref></sup>. We applied Oscope to three replicate scRNA-seq experiments on H1 hESCs (n=213). One of the top groups identified by the K-medoids algorithm in Oscope contained 29 genes (<bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Table 2</xref></bold>), 21 of which are annotated as belonging to the Gene Ontology Cell Cycle biological process (GO:0007049). The reconstructed base cycle is characterized by peaked expression of genes known to be involved in G2 phase progression (e.g. <italic>NUSAP1</italic> and <italic>KPNA2</italic>) and M phase progression (e.g. <italic>CCNB1</italic> and <italic>TPX2</italic>)<sup><xref rid="R12" ref-type="bibr">12</xref></sup> (<bold><xref ref-type="fig" rid="F2">Fig. 2c</xref></bold> and <bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 11</xref></bold>). To confirm whether the recovered profiles were associated with cell cycle phasing, we performed additional scRNA-seq experiments (n=247) on H1 hESCs harboring the fluorescent ubiquitination-based cell cycle indicators<sup><xref rid="R13" ref-type="bibr">13</xref></sup> (H1-Fucci, see Online Methods) in which cells were identified as being in G1, S, or G2/M phase. We combined the H1 and H1-Fucci data sets and applied Oscope. The reconstructed order using the same 29 genes largely recapitulates the three phases of the cell cycle (<bold><xref ref-type="fig" rid="F2">Fig. 2d</xref></bold> and <bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 12</xref></bold>). The phase boundaries defined by the reconstructed order classified 72% of H1-Fucci hESCs into the correct phase. Since the H1-Fucci data set does not provide an unbiased estimate of the number of cells in each phase, we classified the unlabeled H1 hESCs by the phase boundaries and estimated the proportion in each phase. The proportion of unlabeled H1 cells in each phase is consistent with the notion of a shortened G1 phase in undifferentiated hESCs<sup><xref rid="R14" ref-type="bibr">14</xref></sup>(<bold><xref ref-type="fig" rid="F2">Fig. 2e</xref></bold>). Out of the eight genes that were not annotated as belonging to the cell cycle pathway, six of them have been shown to be associated with cell cycle in a previous publication<sup><xref rid="R12" ref-type="bibr">12</xref></sup>. All eight genes, including the two less well-characterized oscillatory genes <italic>CALM2</italic> and <italic>ZNF165</italic>, show cell cycle related base cycle profiles (<bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 13</xref></bold>).</p>
  <p id="P10">A second top group of genes identified by Oscope showed an oscillatory pattern related to the capture site and output well positions on the Fluidigm C1 chip (<bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Table 3</xref></bold>). In particular, these genes all have increased expression in cells captured in sites with small or large plate output IDs, across all three replicate hESC scRNA-seq experiments. The capture sites involving increased gene expression are physically located close to each other on the chip (<bold><xref ref-type="fig" rid="F3">Fig. 3a</xref></bold>, the capture sites’ corresponding plate output IDs are labeled following the recommendation by the manufacture user guide). To examine this potential artifact, we developed an ANOVA-based artificial trend detection algorithm (Online Methods), and applied the algorithm on the combined data from the three H1 experiments. We found that 403 genes show strong artificial trends (<bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 14</xref></bold> and <bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Table 4</xref></bold>), consistent in each experiment (<bold><xref ref-type="fig" rid="F3">Fig. 3b</xref></bold>). To further investigate the artifact and to rule out biases that may be due to sequencing, we estimated expression via qPCR on select genes (<bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 15</xref></bold>) and found the trend already present in the full-length single-cell cDNA libraries. We also see this trend in publicly available datasets from other labs using various cell types (<bold><xref ref-type="fig" rid="F3">Fig. 3c</xref></bold> and <bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 16</xref></bold>).</p>
  <p id="P11">The scRNA-seq technology offers an unprecedented ability to snapshot genome-wide transcription in single cells, but is not amenable to longitudinal studies that monitor changes in individual cells <italic>in situ</italic>. Oscope allows investigators to identify and characterize oscillating gene groups. Applications in a number of settings should improve our understanding of known oscillators, as well as facilitate the discovery of novel ones. Furthermore, adjusting for oscillators using the characterization provided by Oscope should increase the power to investigate other signals associated with differentiation and/or subpopulations<sup><xref rid="R15" ref-type="bibr">15</xref></sup>.</p>
  <sec sec-type="methods" id="S1" specific-use="web-only">
    <title>ONLINE METHODS</title>
    <sec id="S2">
      <title>Oscope: paired-sine model</title>
      <p id="P12">An oscillatory gene group is a group of genes having the same frequency with phase shifts that may vary among pairs but are preserved across cells. For example, if <italic>ψ</italic><sub><italic>gi,gj,s</italic></sub> denotes the phase shift between <italic>gi</italic> and <italic>gj</italic> in cell <italic>s</italic>, then <italic>ψ</italic><sub><italic>gi,gj,s</italic></sub> needs not equal <italic>ψ</italic><sub><italic>gj,gk,s</italic></sub>, but <italic>ψ</italic><sub><italic>gi,gj</italic>,1</sub> = <italic>ψ</italic><sub><italic>gi,gj</italic>,2</sub> = ··· = <italic>ψ</italic><sub><italic>gi,gj,S</italic></sub>. Oscillation time is the difference between cell collection time <italic>T</italic> and the start of oscillation.</p>
      <p id="P13">For a pair of genes <italic>g</italic>1 and <italic>g</italic>2, denote the matched gene expression (rescaled to [−1, 1]) in <italic>S</italic> cells as (<italic>X</italic><sub><italic>g</italic>1,1</sub>, <italic>X</italic><sub><italic>g</italic>2,1</sub>), (<italic>X</italic><sub><italic>g</italic>1,2</sub>, <italic>X</italic><sub><italic>g</italic>2,2</sub>), ... , (<italic>X</italic><sub><italic>g</italic>1,<italic>S</italic></sub>, <italic>X</italic><sub><italic>g</italic>2,<italic>S</italic></sub>). If the two genes follow a sinusoidal process with a phase shift, then the following equations hold for each cell <italic>s</italic> in 1,2, ··· , <italic>S</italic>: <italic>X</italic><sub><italic>g</italic>1,<italic>s</italic></sub> = <italic>sin</italic>(<italic>t<sub>s</sub></italic> = <italic>φ</italic><sub><italic>g</italic>1</sub>) and <italic>X</italic><sub><italic>g</italic>2,<italic>s</italic></sub> = <italic>sin</italic>(<italic>t<sub>s</sub></italic> + <italic>φ</italic><sub><italic>g</italic>1</sub> + <italic>ψ</italic><sub><italic>g</italic>1,<italic>g</italic>2</sub>), where <italic>t<sub>s</sub></italic> indicates oscillation time of cell <italic>s</italic>; <italic>φ</italic><sub><italic>g</italic>1</sub> indicates the starting phase of gene 1; and <italic>ψ</italic><sub><italic>g</italic>1,<italic>g</italic>2</sub> indicates the phase shift between the two genes where the subscript <italic>s</italic> is dropped since <italic>ψ</italic><sub><italic>g</italic>1,<italic>g</italic>2</sub> is assumed common to all cells.</p>
      <p id="P14">By trigonometric identities, <disp-formula id="FD1"><mml:math display="block" id="M1" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>φ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>φ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>φ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>±</mml:mo><mml:msqrt><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:msqrt><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula> Given this, the following equation holds for any cell: <disp-formula id="FD2"><mml:math display="block" id="M2" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:msup><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>;</mml:mo></mml:mrow></mml:math></disp-formula> and there exists an optimal <italic>ψ</italic><sub><italic>g</italic>1,<italic>g</italic>2</sub> for which the error term <inline-formula><mml:math display="inline" id="M3" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>∊</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> is zero, where <disp-formula id="FD3"><mml:math display="block" id="M4" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>∊</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>s</mml:mi></mml:munder><mml:mrow><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:msup><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:math></disp-formula> To search for gene pairs with associated dynamic changes, Oscope linearly rescales gene-specific gene expression measurements to range between −1 and 1, and estimates the optimal <italic>ψ</italic><sub><italic>gi</italic>,<italic>gj</italic></sub> for all gene pairs (gene <italic>i</italic>, gene <italic>j</italic>) defined as that which minimizes <inline-formula><mml:math display="inline" id="M5" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>∊</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>. With this metric, gene pairs are rank ordered by <inline-formula><mml:math display="inline" id="M6" overflow="scroll"><mml:mrow><mml:mo>−</mml:mo><mml:mi>log</mml:mi><mml:mn>10</mml:mn><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>∊</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>; and candidate oscillatory genes are those genes in the top gene pairs (Oscope's default is the top 5%; this threshold may be changed by users based on the empirical distribution of the <inline-formula><mml:math display="inline" id="M7" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>∊</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>'s).</p>
    </sec>
    <sec id="S3">
      <title>Oscope: K-medoids clustering</title>
      <p id="P15">To cluster the candidate oscillatory genes detected from the paired-sine model into distinct groups, we use the K-medoids algorithm with <inline-formula><mml:math display="inline" id="M8" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>∊</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> as the dissimilarity metric. With this metric, gene pairs with small <inline-formula><mml:math display="inline" id="M9" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>∊</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>'s are more likely to be clustered together. The optimal <italic>K</italic> is picked by maximizing the Silhouette distance. To avoid detecting gene groups with a purely linear relationship, only groups having within-group phase differences are further considered in order recovery. Specifically, for any pair of genes <italic>gi,gj</italic> within a group, we define the phase-shift residual as <italic>υ</italic><sub><italic>gi,gj</italic></sub> = <italic>min</italic>((<italic>π</italic> – <italic>η</italic><sub><italic>gi,gj</italic></sub>), <italic>η</italic><sub><italic>gi,gj</italic></sub>), in which <italic>η</italic><sub><italic>gi,gj</italic></sub> = (<italic>ψ</italic><sub><italic>gi,gj</italic></sub> mod <italic>π</italic>). Oscope's default takes groups whose 90<sup><italic>th</italic></sup> quantile of <italic>υ</italic><sub><italic>gi,gj</italic></sub>'s is greater than <italic>π</italic>/4 for further order recovery.</p>
    </sec>
    <sec id="S4">
      <title>Oscope: Extended Nearest Insertion</title>
      <p id="P16">We developed an extended nearest insertion (ENI) algorithm to recover the cyclic order for each oscillatory group defined in the K-medoids clustering step. Cells are ordered cyclically according to their position within one cycle of the oscillation, referred to as a base cycle. The ENI starts with three randomly selected cells and forms a loop (undirected graph). A 4<sup><italic>th</italic></sup> cell is chosen at random and inserted into the three cell-cell gaps on the loop. This forms three candidate orders. We evaluate each order using the aggregated mean squared error (MSE) of a sliding polynomial regression (SPR). For a given order, SPR is fitted to the expression of each gene. To capture cyclic features of the data, SPR fits <italic>m</italic> polynomial regression models starting with <italic>m</italic> evenly distributed points on the loop. The largest MSE among the <italic>m</italic> models is defined as the MSE of the SPR for this gene. For each order, the aggregated MSE of an oscillatory gene group is defined as the summation of the MSE's among all genes. The optimal order of the first 4 cells is then selected as the one that minimizes the aggregated MSE. This process is repeated to insert the fifth cell and so on, until all cells are in the loop. A 2-opt algorithm is then applied to avoid finding local maxima.</p>
    </sec>
    <sec id="S5">
      <title>Whitfield data and statistical analysis</title>
      <p id="P17">Microarray gene expression data were downloaded from <ext-link ext-link-type="uri" xlink:href="http://genome-www.stanford.edu/Human-CellCycle/HeLa/">http://genome-www.stanford.edu/Human-CellCycle/HeLa/</ext-link>. In total, five experiments were available at this site from Whitfield <italic>et al.</italic>, 2002<sup><xref rid="R8" ref-type="bibr">8</xref></sup>; experiment 3 was used here as it has the largest sample size. For this experiment, double thymidine block was used to synchronize HeLa cells and expression was profiled for 9,559 genes at 48 time points following synchronization. To minimize the effect of outliers, gene-specific values &gt; 95<sup><italic>th</italic></sup> (&lt; 5<sup><italic>th</italic></sup>) quantile of expression were imputed to the 95<sup><italic>th</italic></sup> (5<sup><italic>th</italic></sup>) quantile. Oscope was applied on the data with permuted sample order (<bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Table 5</xref></bold>). After applying the paired-sine model to all genes, the top 5% were used as input for the K-medoids algorithm. Using the 151 genes in the top cluster (<bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Table 6</xref></bold>), the ENI algorithm was applied with <italic>m</italic> = 4 and the degree of freedom of SPR was set to 3. To obtain the optimal order, the 2-opt algorithm was applied with 20,000 iterations (<bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Table 7</xref></bold>). 874 genes were defined as periodic by the auto-regression model in Whitfield <italic>et al.</italic>, 2002<sup><xref rid="R8" ref-type="bibr">8</xref></sup>. We used these 874 genes as a validation set in our evaluation.</p>
    </sec>
    <sec id="S6">
      <title>H1 hESC cell culture</title>
      <p id="P18">Undifferentiated H1 human embryonic stem cells (hESCs) were cultured in E8 medium<sup><xref rid="R16" ref-type="bibr">16</xref></sup> on Matrigel-coated tissue culture plates with daily media feeding at 37 °C with 5% (vol/vol) CO<sub>2</sub>. Cells were split every 3-4 days with 0.5 mM EDTA in 1 × PBS for standard maintenance. Immediately before preparing single cell suspensions for each experiment, hESCs were individualized by Accutase (Life Technologies), washed once with E8 medium, and resuspended at densities of 5.0-8.0 × 10<sup>5</sup> cells/mL in E8 medium for cell capture. The H1 hESCs is registered in the NIH Human Embryonic Stem Cell Registry with the Approval Number: NIHhESC-10-0043. Details of the H1 cells can be found online (<ext-link ext-link-type="uri" xlink:href="http://grants.nih.gov/stem_cells/registry/current.htm?id=29">http://grants.nih.gov/stem_cells/registry/current.htm?id=29</ext-link>). All the cell culture performed in our laboratory have been routinely tested negative for mycoplasma contamination and authenticated by cytogenetic tests.</p>
    </sec>
    <sec id="S7">
      <title>H1 hESC single cell capture and single-cell cDNA library preparation</title>
      <p id="P19">Single-cell loading, capture, and library preparations were performed following the Fluidigm user manual “Using the C1 Single-Cell Auto Prep System to Generate mRNA from Single Cells and Libraries for Sequencing.” Briefly, 5,000-8,000 cells were loaded onto a medium size (10-17 <italic>μm</italic>) C1 Single-Cell Auto Prep IFC (Fluidigm), and cell-loading script was performed according to the manufacturer's instructions. The capture efficiency was inspected using EVOS FL Auto Cell Imaging system (Life Technologies) to perform an automated area scanning of the 96 capture sites on the IFC. Empty capture sites or sites having more than one cell captured were first noted and those samples were later excluded from further library processing for RNA-seq. Immediately after capture and imaging, reverse transcription and cDNA amplification were performed in the C1 system using the SMARTer PCR cDNA Synthesis kit (Clontech) and the Advantage 2 PCR kit (Clontech) according to the instructions in the Fluidigm user manual. Full-length, single-cell cDNA libraries were harvested the next day from the C1 chip and diluted to a range of 0.1-0.3 ng/μL. Diluted single-cell cDNA libraries were fragmented and amplified using the Nextera XT DNA Sample Preparation Kit and the Nextera XT DNA Sample Preparation Index Kit (Illumina). Libraries were multiplexed at 24 libraries per lane, and single-end reads of 67-bp were sequenced on an Illumina HiSeq 2500 system.</p>
    </sec>
    <sec id="S8">
      <title>H1 hESC: read mapping and quality control</title>
      <p id="P20">Reads were mapped against the Hg19 Refseq reference via Bowtie 0.12.8<sup><xref rid="R17" ref-type="bibr">17</xref></sup> allowing up to two mismatches and up to 20 multiple hits. The expected counts and TPM's were estimated via RSEM 1.2.3<sup><xref rid="R18" ref-type="bibr">18</xref></sup>. Cells having less than 5,000 genes with TPM &gt; 1 were removed in quality control. 62, 78 and 73 cells passed the quality control in three replicate hESC experiments for a total of 213 H1 hESCs.</p>
    </sec>
    <sec id="S9">
      <title>H1 hESC: statistical analysis</title>
      <p id="P21">Expression within each cell was normalized following median normalization<sup><xref rid="R19" ref-type="bibr">19</xref></sup> implemented in EBSeq 1.5.4<sup><xref rid="R20" ref-type="bibr">20</xref></sup>. Gene means and variances were also estimated using EBSeq after adjusting for library sizes. High mean and high variance genes were selected prior to applying Oscope. Specifically, we took genes with mean expected count greater than 100 as genes with high mean. To define high variance genes, we fit a linear model on log(variance) ~ log(mean) + <italic>c</italic>. Genes with variance above the fitted line were defined as high variance genes. Genes with mappability scores<sup><xref rid="R18" ref-type="bibr">18</xref></sup> less than 0.8 were further eliminated. Applying these steps to the 213 H1 hESCs gave 2,376 genes to which Oscope was applied (<bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Table 8</xref></bold>). To minimize the effect of outliers, gene-specific values &gt; 95<sup><italic>th</italic></sup> (&lt; 5<sup><italic>th</italic></sup>) quantile of expression were imputed to the 95<sup><italic>th</italic></sup> (5<sup><italic>th</italic></sup>) quantile. After applying the paired-sine model, the top 5% of genes were used as input for the K-medoids algorithm. Using the 29 genes in the cell cycle cluster, the ENI module was applied with <italic>m</italic> = 4 and the degree of freedom of SPR was set to 3. To obtain the optimal order, the 2-opt algorithm was applied with 20,000 iterations (<bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Table 9</xref></bold>).</p>
    </sec>
    <sec id="S10">
      <title>H1-Fucci hESC cell line</title>
      <p id="P22">Fluorescent ubiquitination-based cell cycle indicator (Fucci) H1 hESCs were generated by PiggyBAC insertion of a cassette encoding an <italic>EEF1A</italic> promoter-driven <italic>mCherryCDT1-IRES-EgfpGMNN</italic> double transgene (custom ordered from GenScript). Individual clones were isolated by sorting double-positive single cells by fluorescence activated cell sorting (FACS) and maintained as described above. The H1-Fucci cell line provides a two color fluorescence labeling system allowing single-cell suspensions from G1, S or G2/M cell-cycle phases to be isolated by FACS, followed by loading single-cell suspensions onto the Single-Cell Auto Prep IFC using a medium size (10-17 μm) chip. FACS was performed on the FACSAria IIIu instrument and using FACSDiva software version 6.1.3 (both from Becton Dickinson). Unlabeled H1 cells or cells stained with single fluorochromes served as controls for fluorescence gating. Libraries and sequencing reads were processed in the same manner as described above.</p>
    </sec>
    <sec id="S11">
      <title>H1-Fucci: read mapping, quality control and statistical analysis</title>
      <p id="P23">Reads were processed in the same way as in the H1 hESC data. A total of 91, 80 and 76 cells in G1, S and G2/M, respectively, passed our quality control criteria as defined in the H1 hESC read mapping and quality control section. Statistical analysis on H1 and H1-Fucci combined data was carried out as described in H1 hESC statistical analysis. Based on the recovered order (<bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Table 10</xref></bold>), the phase boundaries (<bold><xref ref-type="fig" rid="F2">Fig. 2d</xref></bold>) are defined as the boundaries that give the smallest misclassification rate between three cell cycle phases based on the reconstructed order.</p>
    </sec>
    <sec id="S12">
      <title>Statistical model to identify genes with ordering effects</title>
      <p id="P24">We used an ANOVA model to identify genes with potential ordering effects. Within each H1 hESC experiment, we grouped cells into eight groups defined by capture site. Recall that capture sites are labeled as A01, ... , A12, B01, ..., B12, ..., H01, ..., H12 to match their corresponding position in the output wells (<bold><xref ref-type="fig" rid="F3">Fig. 3a</xref></bold> and <bold><xref ref-type="supplementary-material" rid="SD1">Supplementary Table 11</xref></bold>). We grouped cells from sites with the same starting letters. For each gene, we applied an ANOVA model on the combined data set from all three H1 hESC experiments. The model tests for differences in mean expression across the eight cell groups. A total of 403 genes were identified (p-value &lt; 0.005) using this ANOVA approach.</p>
    </sec>
    <sec id="S13">
      <title>Single-cell real-time quantitative PCR (qPCR)</title>
      <p id="P25">Single-cell cDNA harvested from the Fluidigm C1 IFC was transferred to a 96-well plate and subsequently quantified and diluted according to the Fluidigm user manual. Two microliters of the diluted single-cell cDNA were subsequently used in replicated qPCR reactions with individual 1 × TaqMan Gene Expression assays and 1 × TaqMan Universial PCR Master Mix II (Life Technologies) in a total volume of 10.0 μL. qPCR was performed using ViiA<sup>™</sup> 7 System; and data analysis was performed using ExpressionSuite<sup>™</sup> (all from Life Technologies). TaqMan Gene Expression assays (Life Technologies) were used for two genes: <italic>PFN1</italic> (Hs00748915_s1), <italic>MIF</italic> (Hs00236988_g1), with <italic>GAPDH</italic> (Hs02758991_g1) as an internal control. Although the TaqMan Gene Expression assay are compliant with the MIQE guidelines for publications, the actual sequences of the primers and probes are not released for each assay. The amplicon context sequence for each assay can be identified as following:</p>
      <p id="P26"><italic>&gt;PFN1</italic>: 223 bps (5’-to-3’)</p>
      <p id="P27">ccaccttcggcgttcccagtactgacctcgtctgtcccttccccttcaccgctccccacagctttgcacccctttcctccccatacac acacaaaccattttattttttgggccattaccccataccccttattgctgccaaaaccacatgggctgggggccagggctggatgg acagacacctccccctacccatatccctcccgtgtgtggttggaaaact</p>
      <p id="P28">&gt;<italic>MIF</italic>: 83 bps (5’-to-3’)</p>
      <p id="P29">ctgtgcggcctgctggccgagcgcctgcgcatcagcccggacagggtctacatcaactattacgacatgaacgcggccaatgt</p>
      <p id="P30">&gt;<italic>GAPDH</italic>: 110 bps (5’-to-3’)</p>
      <p id="P31">ccctggccaaggtcatccatgacaactttggtatcgtggaaggactcatgaccacagtccatgccatcactgccacccagaaga ctgtggatggcccctccgggaaactg</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="SM">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>1</label>
      <media xlink:href="NIHMS712805-supplement-1.pdf" orientation="portrait" xlink:type="simple" id="d37e1626" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S14">
    <title>ACKNOWLEDGMENTS</title>
    <p>This work was supported by the National Institutes of Health GM102756, 4UH3TR000506-03, 5U01HL099773-06, the Charlotte Geyer Foundation, and the Morgridge Institute for Research. N.L. was supported by the Shapiro Fellowship. C.B. was supported by the Canadian Institutes of Health Research Banting Postdoctoral Fellowship. We thank M. Probasco and N. Propson for their assistance of sorting cells by FACS; J. Bolin, A. Elwell, and B.K. Nguyen for the preparation and sequencing of the RNA-seq samples. We thank A. Gitter, K. Korthauer and R. Bacher for comments that helped improve the manuscript.</p>
  </ack>
  <fn-group>
    <fn id="FN1">
      <p id="P32">AUTHOR CONTRIBUTIONS</p>
      <p id="P33">N.L., L.C., R.M.S., J.A.T. and C.K. designed research, analyzed data and wrote the manuscript; C.B. generated the H1-Fucci cell line; Y.L., J.C. and X.L. contributed to the simulation studies; and P.J. performed RNA-seq read mapping, quantification and quality control.</p>
    </fn>
    <fn id="FN2">
      <p id="P34">COMPETING FINANCIAL INTERESTS</p>
      <p id="P35">J.A.T. is a founder, stockowner, consultant, and board member of Cellular Dynamics International (CDI).</p>
    </fn>
    <fn id="FN3">
      <p id="P36">ACCESSION CODES</p>
      <p id="P37">Gene expression omnibus: GSE64016</p>
    </fn>
    <fn id="FN4">
      <p id="P38"><bold>Code availability.</bold> The R package R/Oscope is available at <ext-link ext-link-type="uri" xlink:href="https://www.biostat.wisc.edu/~kendzior/OSCOPE/">https://www.biostat.wisc.edu/~kendzior/OSCOPE/</ext-link></p>
    </fn>
  </fn-group>
  <ref-list>
    <title>REFERENCE</title>
    <ref id="R1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aulehla</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Pourquie</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <source>Current opinion in cell biology</source>
        <year>2008</year>
        <volume>20</volume>
        <fpage>632</fpage>
        <lpage>637</lpage>
        <pub-id pub-id-type="pmid">18845254</pub-id>
      </element-citation>
    </ref>
    <ref id="R2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shin</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Nucleic acids research</source>
        <year>2014</year>
        <volume>42</volume>
        <fpage>e90</fpage>
        <pub-id pub-id-type="pmid">24753407</pub-id>
      </element-citation>
    </ref>
    <ref id="R3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bar-Joseph</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Gitter</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Simon</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <source>Nature Reviews Genetics</source>
        <year>2012</year>
        <volume>13</volume>
        <fpage>552</fpage>
        <lpage>564</lpage>
      </element-citation>
    </ref>
    <ref id="R4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Nature biotechnology</source>
        <year>2014</year>
      </element-citation>
    </ref>
    <ref id="R5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qiu</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Gentles</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Plevritis</surname>
            <given-names>SK</given-names>
          </name>
        </person-group>
        <source>PLoS computational biology</source>
        <year>2011</year>
        <volume>7</volume>
        <fpage>e1001123</fpage>
        <pub-id pub-id-type="pmid">21533210</pub-id>
      </element-citation>
    </ref>
    <ref id="R6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gupta</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Bar-Joseph</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <source>Computational Biology and Bioinformatics, IEEE/ACM Transactions on</source>
        <year>2008</year>
        <volume>5</volume>
        <fpage>172</fpage>
        <lpage>182</lpage>
      </element-citation>
    </ref>
    <ref id="R7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Magwene</surname>
            <given-names>PM</given-names>
          </name>
          <name>
            <surname>Lizardi</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <source>Bioinformatics</source>
        <year>2003</year>
        <volume>19</volume>
        <fpage>842</fpage>
        <lpage>850</lpage>
        <pub-id pub-id-type="pmid">12724294</pub-id>
      </element-citation>
    </ref>
    <ref id="R8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Whitfield</surname>
            <given-names>ML</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Molecular biology of the cell</source>
        <year>2002</year>
        <volume>13</volume>
        <fpage>1977</fpage>
        <lpage>2000</lpage>
        <pub-id pub-id-type="pmid">12058064</pub-id>
      </element-citation>
    </ref>
    <ref id="R9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>De Lichtenberg</surname>
            <given-names>U</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Bioinformatics</source>
        <year>2005</year>
        <volume>21</volume>
        <fpage>1164</fpage>
        <lpage>1171</lpage>
        <pub-id pub-id-type="pmid">15513999</pub-id>
      </element-citation>
    </ref>
    <ref id="R10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rosenkrantz</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Stearns</surname>
            <given-names>RE</given-names>
          </name>
          <name>
            <surname>Lewis</surname>
            <given-names>PM</given-names>
            <suffix>II</suffix>
          </name>
        </person-group>
        <source>SIAM journal on computing</source>
        <year>1977</year>
        <volume>6</volume>
        <fpage>563</fpage>
        <lpage>581</lpage>
      </element-citation>
    </ref>
    <ref id="R11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Thomson</surname>
            <given-names>JA</given-names>
          </name>
          <etal/>
        </person-group>
        <source>science</source>
        <year>1998</year>
        <volume>282</volume>
        <fpage>1145</fpage>
        <lpage>1147</lpage>
        <pub-id pub-id-type="pmid">9804556</pub-id>
      </element-citation>
    </ref>
    <ref id="R12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Santos</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wernersson</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Jensen</surname>
            <given-names>LJ</given-names>
          </name>
        </person-group>
        <source>Nucleic acids research</source>
        <year>2014</year>
        <volume>43</volume>
        <fpage>D1140</fpage>
        <lpage>D1144</lpage>
        <pub-id pub-id-type="pmid">25378319</pub-id>
      </element-citation>
    </ref>
    <ref id="R13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sakaue-Sawano</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Cell</source>
        <year>2008</year>
        <volume>132</volume>
        <fpage>487</fpage>
        <lpage>498</lpage>
        <pub-id pub-id-type="pmid">18267078</pub-id>
      </element-citation>
    </ref>
    <ref id="R14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Becker</surname>
            <given-names>KA</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Journal of cellular physiology</source>
        <year>2006</year>
        <volume>209</volume>
        <fpage>883</fpage>
        <lpage>893</lpage>
        <pub-id pub-id-type="pmid">16972248</pub-id>
      </element-citation>
    </ref>
    <ref id="R15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Buettner</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Nature biotechnology</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>155</fpage>
        <lpage>160</lpage>
      </element-citation>
    </ref>
    <ref id="R16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Nature methods</source>
        <year>2011</year>
        <volume>8</volume>
        <fpage>424</fpage>
        <lpage>429</lpage>
        <pub-id pub-id-type="pmid">21478862</pub-id>
      </element-citation>
    </ref>
    <ref id="R17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Langmead</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Pop</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <source>Genome Biology</source>
        <year>2010</year>
        <volume>R25</volume>
      </element-citation>
    </ref>
    <ref id="R18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Dewey</surname>
            <given-names>CN</given-names>
          </name>
        </person-group>
        <source>BMC Bioinformatics</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>323</fpage>
        <pub-id pub-id-type="pmid">21816040</pub-id>
      </element-citation>
    </ref>
    <ref id="R19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Anders</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Huber</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <source>Genome Biology</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>R106</fpage>
        <pub-id pub-id-type="pmid">20979621</pub-id>
      </element-citation>
    </ref>
    <ref id="R20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Leng</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Bioinformatics</source>
        <year>2013</year>
        <volume>29</volume>
        <fpage>1035</fpage>
        <lpage>1043</lpage>
        <pub-id pub-id-type="pmid">23428641</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <p>Overview of Oscope. (<bold>a</bold>) Shown are an oscillating gene group with two genes and corresponding cell state. (<bold>b</bold>) In an unsynchronized scRNA-seq experiment, mRNA is collected at time <italic>T</italic> from cells in varying states. <italic>t</italic><sub>0,<italic>i</italic></sub> and <italic>t<sub>i</sub></italic> show cell <italic>i</italic>'s oscillation start time and oscillation time, respectively. (<bold>c</bold>) The same genes and cells as in <bold>b</bold>, where cells are ordered by the genes’ oscillation times. (<bold>d</bold>) Expression for 100 unsynchronized cells. (<bold>e</bold>) Scatter plots of gene 1 vs. gene 2, which are independent of order. Cells are colored from cyan to brown following the x-axes of <bold>c</bold> and <bold>d</bold>, respectively. (<bold>f</bold>) Results of base cycle reconstruction for the 100 cells shown in <bold>d</bold>. (<bold>g</bold>) Flowchart of the Oscope pipeline (see Online Methods).</p>
    </caption>
    <graphic xlink:href="nihms-712805-f0001"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <p>Oscope uncovers oscillatory signals in case study datasets. (<bold>a</bold>) Four genes in the time series data from Whitfield <italic>et al.</italic> 2002<sup><xref rid="R8" ref-type="bibr">8</xref></sup> with profiles ordered by Oscope; the peak of the base cycle is marked in gray. (<bold>b</bold>) The same four genes following the known order over time with the peak of the first base cycle (shown in yellow) marked in gray. (<bold>c</bold>) Four genes from a 29 gene group identified by Oscope using scRNA-seq data from 213 unlabeled hESCs. Shown are Oscope recovered profiles. (<bold>d</bold>) The same four genes ordered using 460 cells (213 unlabeled and 247 H1-Fucci cells are shown as open circles and dots, respectively). The Fucci labels (ignored prior to applying Oscope) are shown in different colors for the 247 cells. Phase boundaries defined by the reconstructed order are shown above the plots. (<bold>e</bold>) The proportion of unlabeled cells that fall into each phase defined by the boundaries in <bold>d</bold>.</p>
    </caption>
    <graphic xlink:href="nihms-712805-f0002"/>
  </fig>
  <fig id="F3" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <p>Oscope uncovers dynamic signals of technical origin in scRNA-seq datasets. (<bold>a</bold>) Default plate output ID layouts of the capture sites on the C1 chip. (<bold>b</bold>) Expression of four genes with potential ordering effects. Cells are ordered by the C1 plate output ID (A01-A12, B01-B12, ..., H01-H12). Cells from the colored capture sites in <bold>a</bold> are also shown in magenta. Three replicate hESC experiments are separated by gray lines. (<bold>c</bold>) The same four genes for a data set obtained from Trapnell <italic>et al.</italic>, 2014, ordered following the cell order listed in their supplementary data<sup><xref rid="R4" ref-type="bibr">4</xref></sup>. The four experiments are separated by gray lines. The y-axes are limited to 98th quantile of gene-specific FPKMs for better visualization.</p>
    </caption>
    <graphic xlink:href="nihms-712805-f0003"/>
  </fig>
</floats-group>
