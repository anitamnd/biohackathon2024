<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3436815</article-id>
    <article-id pub-id-type="pmid">22962453</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/bts388</article-id>
    <article-id pub-id-type="publisher-id">bts388</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group>
          <subject>Sequencing and Sequence Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Stitching gene fragments with a network matching algorithm improves gene assembly for metagenomics</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Wu</surname>
          <given-names>Yu-Wei</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rho</surname>
          <given-names>Mina</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Doak</surname>
          <given-names>Thomas G.</given-names>
        </name>
        <xref ref-type="aff" rid="AFF2">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ye</surname>
          <given-names>Yuzhen</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="COR1">
          <sup>*</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="AFF1"><sup>1</sup>School of Informatics and Computing</aff>
    <aff id="AFF2"><sup>2</sup>Department of Biology, Indiana University, Bloomington, IN 47405, USA</aff>
    <author-notes>
      <corresp id="COR1"><sup>*</sup>To whom correspondence should be addressed.</corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>9</month>
      <year>2012</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>3</day>
      <month>9</month>
      <year>2012</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>3</day>
      <month>9</month>
      <year>2012</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>28</volume>
    <issue>18</issue>
    <issue-title>ECCB 2012 PROCEEDINGS PAPERS COMMITTEE SEPTEMBER 9 TO SEPTEMBER 12, 2012, CONFERENCE CENTER BASEL, SWITZERLAND</issue-title>
    <fpage>i363</fpage>
    <lpage>i369</lpage>
    <permissions>
      <copyright-statement>© The Author(s) (2012). Published by Oxford University Press.</copyright-statement>
      <copyright-year>2012</copyright-year>
      <license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/3.0">
        <license-p><!--CREATIVE COMMONS-->This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/3.0">http://creativecommons.org/licenses/by/3.0</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Motivation:</bold> One of the difficulties in metagenomic assembly is that homologous genes from evolutionarily closely related species may behave like repeats and confuse assemblers. As a result, small contigs, each representing a short gene fragment, instead of complete genes, may be reported by an assembler. This further complicates annotation of metagenomic datasets, as annotation tools (such as gene predictors or similarity search tools) typically perform poorly on configs encoding short gene fragments.</p>
      <p><bold>Results:</bold> We present a novel way of using the de Bruijn graph assembly of metagenomes to improve the assembly of genes. A network matching algorithm is proposed for matching the de Bruijn graph of contigs against reference genes, to derive ‘gene paths’ in the graph (sequences of contigs containing gene fragments) that have the highest similarities to known genes, allowing gene fragments contained in multiple contigs to be connected to form more complete (or intact) genes. Tests on simulated and real datasets show that our approach (called GeneStitch) is able to significantly improve the assembly of genes from metagenomic sequences, by connecting contigs with the guidance of homologous genes—information that is orthogonal to the sequencing reads. We note that the improvement of gene assembly can be observed even when only distantly related genes are available as the reference. We further propose to use ‘gene graphs’ to represent the assembly of reads from homologous genes and discuss potential applications of gene graphs to improving functional annotation for metagenomics.</p>
      <p><bold>Availability:</bold> The tools are available as open source for download at <ext-link ext-link-type="uri" xlink:href="http://omics.informatics.indiana.edu/GeneStitch">http://omics.informatics.indiana.edu/GeneStitch</ext-link></p>
      <p>
        <bold>Contact:</bold>
        <email>yye@indiana.edu</email>
      </p>
    </abstract>
    <counts>
      <page-count count="7"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec id="SEC1">
    <title>1 INTRODUCTION</title>
    <p>Metagenomics, also called environmental sequencing, is the study of microbial genomes sampled directly from the environment. We are seeing more metagenomics projects than ever before, due to (i) advances in next-generation sequencing (NGS) technology, such as Roche/454 (<xref ref-type="bibr" rid="B13">Margulies <italic>et al.</italic>, 2005</xref>) and Illumina/Solexa (<xref ref-type="bibr" rid="B1">Bentley, 2006</xref>); (ii) the fact that only a few species can be cultured and studied using conventional microbiological techniques (<xref ref-type="bibr" rid="B22">Schloss and Handelsman, 2005</xref>) and (iii) many studies that have shown the impact of the ‘microbiome’ (i.e. the entire set of genomes in a microbial community) on almost every aspect of life on Earth [e.g. microbes residing in the human body encode far more genes than the genes encoded by the human genome (<xref ref-type="bibr" rid="B6">Gill <italic>et al.</italic>, 2006</xref>)]. Metagenomics has been applied to many studies of natural environments (<xref ref-type="bibr" rid="B25">Venter <italic>et al.</italic>, 2004</xref>; <xref ref-type="bibr" rid="B24">Tyson <italic>et al.</italic>, 2004</xref>) as well as human and animal associated microbiomes (<xref ref-type="bibr" rid="B9">Hess <italic>et al.</italic>, 2011</xref>; <xref ref-type="bibr" rid="B16">Peterson <italic>et al.</italic>, 2009</xref>; <xref ref-type="bibr" rid="B18">Qin <italic>et al.</italic>, 2010</xref>; <xref ref-type="bibr" rid="B23">Turnbaugh <italic>et al.</italic>, 2006</xref>), providing an unprecedented opportunity to gain knowledge about the vast majority of uncultured microbial species.</p>
    <p>One of the first steps to analyzing metagenomic sequences is to assemble the reads. For example, reads sequenced from the Acid Mine Drainage dataset yielded two near-complete and three partial genomes (<xref ref-type="bibr" rid="B24">Tyson <italic>et al.</italic>, 2004</xref>). This, however, is a very simple bacterial community; assembling sequences sampled from most whole microbial communities remains a challenging problem (<xref ref-type="bibr" rid="B17">Pop, 2009</xref>). Since most metagenomic sequences are obtained using NGS technology, the traditional ‘overlap-layout-consensus’approach may not be realistic due to the short reads. On the other hand, the de Bruijn graph approach (<xref ref-type="bibr" rid="B2">Compeau <italic>et al.</italic>, 2011</xref>), which breaks the reads into <italic>k</italic>-mers and then constructs a de Bruijn graph on these <italic>k</italic>-mers, is difficult because of the mixture of genomic sequences from many species and the higher rate of NGS sequencing errors. As a result, it is difficult to assemble complete genomes from metagenomic sequences, even when the community structure is simple—for example, the Acid Mine Drainage dataset (<xref ref-type="bibr" rid="B24">Tyson <italic>et al.</italic>, 2004</xref>) contains merely five species, but yields only two nearly complete genomes.</p>
    <p>One of the characteristics of de Bruijn graph-based assemblers is that the resulting graph is usually very tangled, especially when sequencing errors exist. This greatly impedes the formation of long contigs, because the branches cannot be resolved. Moreover, <italic>k</italic>-mers from different regions or even from different species may be connected together, which further complicates the structure of the de Bruijn graph. As a result, many short contigs will be reported, which are often insufficient for downstream analysis, such as <italic>ab initio</italic> gene prediction in these short contigs (<xref ref-type="bibr" rid="B10">Hoff, 2009</xref>), or homology searches of the contigs (<xref ref-type="bibr" rid="B26">Wommack <italic>et al.</italic>, 2008</xref>). For instance, the MetaHIT consortium only considered contigs of length &gt;500 bp, which represented only 42.7% of the sequencing reads (<xref ref-type="bibr" rid="B18">Qin <italic>et al.</italic>, 2010</xref>).</p>
    <p>Salzberg <italic>et al.</italic> proposed a gene-boosted assembly approach to improve assembly quality, which used proteins from reference genomes to recruit sequencing reads to fill in the gaps between contigs (2008). Combining this approach with several other strategies, they successfully produced 76 contigs from 8 27 900 33 bp reads obtained from <italic>Pseudomonas aeruginosa</italic> PAb1, with the largest contig being 512 638 bp. They also demonstrated that most of the genes in a newly sequenced bacterial strain can be assembled using the genome of another strain of the same species as the reference, using gene-boosted assembly. This approach, however, was only applied to single genome assembly problems. Metagenome assembly is more difficult, because of the presence of homologous genes from multiple species in the same community that may behave like repeats for assemblers. Hence, the success of the approach relies on the utilization of a closely related genome (e.g. the genome of the same species but a different strain), which may not be available in metagenomics, which aims to study un-cultured microbial species in natural habitats.</p>
    <p>Here, we present GeneStitch to infer gene paths (sequences of contigs), each of which represents a gene or a gene fragment, in the tangled de Bruijn graph resulted from <italic>de novo</italic> assembly of metagenomic reads, using a network matching algorithm. Given a reference gene sequence, GeneStitch searches for a path in the de Bruijn graph that is most similar to the given reference gene. Assuming that the gene paths found by GeneStitch consist of reads most likely sampled from a real gene, we can assemble genes in a metagenomic dataset by using known homologous genes as references. When prior knowledge of the species composition and gene contents of the sequenced metagenome is unavailable, we can use as many reference gene sequences as possible (e.g. the entire set of genes from all available microbial genomes) to guide the inference of gene paths.</p>
    <p>One challenge of inferring gene paths is the separation of very similar genes in a metagenome. The gene paths inferred from GeneStitch may overlap substantially with each other, because homologous genes will share identical regions. Instead of attempting to separate these individual genes (with the risk of introducing misassemblies), we propose to merge these paths into ‘gene graphs’, each of which is a subgraph of the de Bruijn graph that contains reads from the same gene family (homologous genes). We argue that such gene graphs may be considered as single units for downstream analysis of metagenomes, for example for functional predictions by similarity search.</p>
    <p>We test our approach on simulated single-genome and metagenomic datasets, and a mock dataset (<xref ref-type="bibr" rid="B15">Morgan <italic>et al.</italic>, 2010</xref>), which consists of real sequencing reads from an artificial community of 10 already-sequenced genomes. The results show that we are able to generate more complete genes by applying GeneStitch, and most of the gene graphs consist only of contigs from homologous genes.</p>
  </sec>
  <sec id="SEC2">
    <title>2 METHODS</title>
    <p>We formulate the inference of gene paths from a de Bruijn graph as a problem of aligning the graph against a set of reference genes, aiming to derive—in the graph—paths of sequence blocks (or contigs) that are most similar to the reference genes; each path represents a gene or a gene fragment that contains shorter gene fragments. Computationally, this problem is equivalent to the ‘network matching problem’ (to find the best alignment between a graph and a sequence, or between two graphs), which has been applied in computational biology; examples are (i) the spliced alignment problem for eukaryotic gene prediction considering all potential exon predictions (<xref ref-type="bibr" rid="B4">Gelfand <italic>et al.</italic>, 1996</xref>) and (ii) protein sequence alignments considering all potential secondary structural predictions (<xref ref-type="bibr" rid="B28">Ye <italic>et al.</italic>, 2003</xref>). The network matching problem can be solved efficiently by a dynamic programing algorithm that searches for the set of connected blocks with the highest similarity to the reference sequence, without exploring all possible paths through the blocks (which would be exponential in the number of blocks).</p>
    <sec id="SEC2.1">
      <title>2.1 Network matching algorithm</title>
      <p>Consider a set of contigs (<italic>C</italic><sub>1</sub>,···, <italic>C<sub>n</sub></italic>) and a de Bruijn graph <italic>G</italic>,<xref ref-type="fn" rid="FN1"><sup>1</sup></xref> in which each node represents a contig, and a directed edge is connected between two nodes if these two contigs share <italic>k</italic> − 1 nucleotides (<italic>k</italic> is a pre-defined number, e.g. <italic>k</italic> = 30). Our goal is to find the optimal local alignment between the contigs (sequence blocks) and a reference sequence <italic>T</italic> = <italic>t</italic><sub>1</sub> ···<italic>t<sub>m</sub></italic>, as illustrated in <xref ref-type="fig" rid="F1">Figure 1</xref>.
<fig id="F1" position="float"><label>Fig. 1.</label><caption><p>Alignment between a de Bruijn graph and a reference sequence. Blocks in the de Bruijn graph represent nodes, and black arrowheads represent the directed edges that connect nodes with overlapping <italic>k</italic> − 1 mers. Typically, a de Bruijn graph-based assembler will output each of the nodes as a contig. Red arrowheads constitute the optimal path of the nodes that aligns with the reference sequence derived by the network matching algorithm</p></caption><graphic xlink:href="bts388f1"/></fig>
</p>
      <p>The network matching problem can be solved using a dynamic programming algorithm in polynomial time. Let <italic>S</italic>(<italic>i</italic>,<italic>j</italic>,<italic>k</italic>) be the optimal alignment score between all possible paths ending at position <italic>i</italic> of contig <italic>k</italic> in the input de Bruijn graph and the prefix of the input reference sequence ending at position <italic>j</italic> (i.e., <italic>t</italic><sub>1</sub><italic>t</italic><sub>2</sub> ···<italic>t<sub>j</sub></italic>). For each contig <italic>C<sub>k</sub></italic>, we denote its first letter as <italic>first</italic>(<italic>k</italic>) and its last letter as <italic>last</italic>(<italic>k</italic>). A path in the de Bruijn graph can start from any contig and will contain at least one contig, but must strictly follow the de Bruijn graph structure, where two contigs <italic>C<sub>l</sub></italic> and <italic>C<sub>k</sub></italic> can be connected only if a directed edge goes from <italic>C<sub>l</sub></italic> to <italic>C<sub>k</sub></italic> (denoted by <italic>C<sub>l</sub> → C<sub>k</sub></italic>). Let <italic>E</italic>(<italic>k</italic>)= {<italic>l</italic> : <italic>C<sub>l</sub> → C<sub>k</sub></italic> } be the set of contigs that are connected to contig <italic>k</italic>. Our network matching algorithm first computes a dynamic programming matrix to record the optimal alignment scores for 1 ≤ <italic>i</italic> ≤ last(<italic>k</italic>), 1≤ <italic>j</italic>≤ <italic>m</italic>, and 1≤ <italic>k</italic> ≤ <italic>n</italic> (<italic>n</italic> is the total number of contigs). <italic>S</italic>(<italic>i</italic>,<italic>j</italic>,<italic>k</italic>) can be computed recursively as
<disp-formula id="M1"><label>(1)</label><graphic xlink:href="bts388m1"/></disp-formula>
where <italic>i</italic> = 1 indicates it is the first nucleotide in contig <italic>k</italic>, and <italic>g</italic>(<italic>i<sub>k</sub></italic>,<italic>j</italic>) is the scoring function for matching the nucleotide at position <italic>i</italic> in contig <italic>k</italic> and the nucleotide at position <italic>j</italic> of the input reference sequence: <italic>g</italic>(<italic>i<sub>k</sub></italic>, <italic>j</italic>)= Δ match if the two nucleotides are the same; otherwise <italic>g</italic>(<italic>i<sub>k</sub></italic>, <italic>j</italic>)= Δ mismatch (Δ match and Δ mismatch are two preset parameters). <italic>I</italic>(<italic>i</italic>,<italic>j</italic>,<italic>k</italic>) and <italic>D</italic>(<italic>i</italic>,<italic>j</italic>,<italic>k</italic>) are the optimal alignment scores between the paths of the de Bruijn graph (ending at position <italic>i</italic> in contig <italic>k</italic>) and the prefix of the input reference sequence (ending at position <italic>j</italic>), ending with insertion and deletion in the alignment, respectively. The recursive definitions of <italic>I</italic>(<italic>i</italic>,<italic>j</italic>,<italic>k</italic>) and <italic>D</italic>(<italic>i</italic>,<italic>j</italic>,<italic>k</italic>) are as follows:
<disp-formula id="M2"><label>(2)</label><graphic xlink:href="bts388m2"/></disp-formula>
<disp-formula id="M3"><label>(3)</label><graphic xlink:href="bts388m3"/></disp-formula>
where Δ<italic>g</italic>_open and Δ<italic>g</italic>_ext are penalties for opening and extending gaps, respectively (affine gap penalty is used in our network matching algorithm).</p>
      <p>For initialization, <italic>S</italic>(<italic>i</italic>,0,<italic>k</italic>), <italic>S</italic>(0,<italic>j</italic>,<italic>k</italic>), <italic>I</italic>(<italic>i</italic>,0,<italic>k</italic>), <italic>I</italic>(0,<italic>j</italic>,<italic>k</italic>), <italic>D</italic>(<italic>i</italic>,0,<italic>k</italic>) and <italic>D</italic>(0,<italic>j</italic>,<italic>k</italic>) are all set to 0 for all <italic>i</italic>, <italic>j</italic> and <italic>k</italic>.</p>
      <p>Once we are done filling in the matrix, we use a traceback procedure to find the best local alignment between the de Bruijn graph and the reference sequence. We first find the maximum score in the dynamic programming matrix and then trace back from that corresponding cell until we reach a score of 0 to find the path of the contigs (which we call a gene path) that leads to the best alignment. We also retrieve the gene sequence by concatenating the nucleotide sequences of the contigs in the path. Since two nodes connected by an edge in a de Bruijn graph overlap in <italic>k</italic> − 1 nucleotides, we need to exclude one redundant copy of the <italic>k</italic> − 1 nucleotides when retrieving the gene sequence.</p>
      <p>We note that GeneStitch does not explicitly consider the cycles that may be found in de Bruijn graphs, in order to use an efficient dynamic programming algorithm to solve the network matching problem: GeneStitch will traverse (randomly) through one of the cyclic paths (if present). In our tests, GeneStitch rarely encounters such cases, as gene sequences typically do not contain repeats.</p>
    </sec>
    <sec id="SEC2.2">
      <title>2.2 Speeding the network matching process</title>
      <p>The network matching algorithm described above aligns the reference sequence against the entire de Bruijn graph. The amount of time required for this process is linearly correlated to the number of nodes (representing contigs) in the graph and the lengths of the contigs. Accordingly, we implement two strategies to speed up the network matching procedure, given that a single gene will only span a small portion of the graph.</p>
      <p>The first strategy is to use a similarity-based approach to constrain the search space in the de Bruijn graph for each reference gene sequence. First, we use BLAST to search all nodes (i.e. contigs) of the de Bruijn graph against the reference sequences with a relatively high <italic>E</italic>-value cutoff (currently set to 0.1). For each reference sequence, the node with the best alignment score will be used as the starting node to recruit more inbound and outbound nodes with BLAST hits. Considering that short contigs may be missed by the similarity search process (<xref ref-type="bibr" rid="B26">Wommack <italic>et al.</italic>, 2008</xref>), we allow the recruiting process to extend an additional <italic>N</italic> layers of inbound and outbound nodes without BLAST hits (<italic>N</italic> is set to 5). This process is repeated until no more nodes can be recruited. The included nodes (and the edges that connect them)—instead of the whole graph—then serve as the input graph for the network matching process.</p>
      <p>The second strategy is to exclude intact genes found in the input contigs. We use FragGeneScan (<xref ref-type="bibr" rid="B19">Rho <italic>et al.</italic>, 2010</xref>) to predict fragmented genes as well as intact genes in all contigs, and then remove intact genes (defined as the predicted gene fragments that do not include the first or the last nucleotide of any contig) from the contigs prior to the network matching process, retaining only fragmented genes and intergenic regions adjacent to them. This preprocessing step greatly speeds the network-matching process.</p>
    </sec>
    <sec id="SEC2.3">
      <title>2.3 Construction of gene graphs</title>
      <p>Gene paths—each representing a (fragmented) gene—inferred from a de Brujin graph using homologous reference genes by the network matching algorithm described above may overlap with each other. These paths can be merged into a gene graph that represents a collection of homologous genes in a compact fashion.</p>
      <p>To make sure that we generate gene graphs that consist of only homologous genes, three empirical criteria are applied when finding gene paths in the de Bruijn graph: (i) the optimal score of the alignment between the gene path and the reference gene is ≥50 (score threshold), (ii) the identity of the alignment is ≥60% (identify threshold) and (iii) the alignment covers at least 40% of the length of the reference sequence (gene coverage threshold). The identity threshold is set to 60%, since genes may not be very similar at the nucleotide level, especially if the reference genes are obtained from not-so-closely related species. Two gene paths sharing at least one contig are merged into a gene graph if the reference sequences used to infer the gene paths are highly similar (i.e. with identity ≥70%). We will further compare the merged gene graphs with other gene paths or gene graphs and merge them if they contain genes inferred from very similar reference genes. This merging process is performed between any two gene graphs until all pairs of graphs have been checked. Once the merging is completed, we will select—for each gene graph—its composite gene path with the highest network-matching alignment score as its representative sequence.</p>
    </sec>
    <sec id="SEC2.4">
      <title>2.4 Extension of gene graphs</title>
      <p>The network matching algorithm and the subsequent merging steps may leave out gene segments from the constructed gene graphs that are not sufficiently similar to the reference sequences. To make gene graphs complete, we will extend each gene graph by recruiting the inbound and outbound nodes of its contigs if they share similarities with the contigs already included in the graph. This process is repeated until no more nodes can be added. The algorithm is given as follows.</p>
      <p>
        <inline-formula>
          <inline-graphic xlink:href="bts388i1.jpg"/>
        </inline-formula>
      </p>
      <p>Currently, we set the identity threshold to 70% so that only very similar inbound and outbound contigs will be recruited into the gene graph.</p>
    </sec>
    <sec sec-type="methods" id="SEC2.5">
      <title>2.5 Datasets and tools used</title>
      <p>We implemented our algorithm in C++ and tested our program (named GeneStitch) on simulated datasets for a single genome and a dataset for an artificial microbial community.</p>
      <p>We produced three test datasets of sequencing depths 6×, 13×, and 20× from the <italic>Escherichia coli</italic> str. K-12 substr. MG1655 genome (NC_000913) using Metasim software (<xref ref-type="bibr" rid="B20">Richter <italic>et al.</italic>, 2008</xref>). We used the 80 bp error model downloaded from the Metasim website to simulate Illumina reads of 80 bp with a 1% error rate. Genes from the <italic>E. coli</italic> HS (NC_009800), <italic>Escherichia fergusonni</italic> (NC_011740), and <italic>Salmonella enterica</italic> (NC_003198) were used as the references for GeneStitch.</p>
      <p>The community dataset comprises sequencing reads obtained from an artificial microbial community with 10 mixed lab-cultured species (<xref ref-type="bibr" rid="B15">Morgan <italic>et al.</italic>, 2010</xref>). The main reason we chose this dataset (of 454 sequencing reads) as our test case is that we can directly evaluate the quality of the assembled genes because the genes and genomes of the species in the community are already known. Among the 10 species, 9 are either bacterial or archaeal, and 1 is eukaryotic (<italic>Saccharomyces cerevisiae</italic> S288C). We use genes from nine species as the reference gene sets, which are different at the species level (or higher level if species level is not available) compared with the bacteria or archaea species in the mock dataset. <xref ref-type="table" rid="T1">Table 1</xref> lists the species we chose. We do not test on the eukaryotic genome because eukaryotic genes contain an intron–exon structure that our method is not currently designed for. To check for misassembly, we map assembled genes against the source genomes, using bwasw, provided by the BWA package (<xref ref-type="bibr" rid="B11">Li and Durbin, 2010</xref>). A gene is considered to be misassembled if it cannot be mapped, or maps to two or more locations in the genomes.<table-wrap id="T1" position="float"><label>Table 1.</label><caption><p>The list of species contained in the mock dataset and corresponding species used as references in GeneStitch</p></caption><table frame="hsides" rules="groups"><thead><tr><th rowspan="1" colspan="1">Species in mock dataset</th><th rowspan="1" colspan="1">Reference species<xref ref-type="table-fn" rid="TF1"><sup>a</sup></xref></th></tr></thead><tbody><tr><td rowspan="1" colspan="1">NC_002662 <italic>Lactococcus lactis</italic> subsp. <italic>lactis</italic> Il1403</td><td rowspan="1" colspan="1">NC_012984 <italic>Lactobacillus plantarum</italic> JDM1 (genus)</td></tr><tr><td rowspan="1" colspan="1">NC_008527 <italic>L. lactis</italic> subsp. <italic>cremoris</italic> SK11</td><td rowspan="1" colspan="1">NC_014724 <italic>Lactobacillus amylovorus</italic> GRL 1112 (order)</td></tr><tr><td rowspan="1" colspan="1">NC_008525 <italic>Pediococcus pentosaceus</italic> ATCC 25745</td><td rowspan="1" colspan="1">NC_008529 <italic>Lactobacillus delbrueckii</italic> subsp. <italic>bulgaricus</italic> ATCC BAA-365 (family)</td></tr><tr><td rowspan="1" colspan="1">NC_010999 <italic>Lactobacillus casei</italic> BL23</td><td rowspan="1" colspan="1">NC_014106 <italic>Lactobacillus crispatus</italic> ST1 (genus)</td></tr><tr><td rowspan="1" colspan="1">NC_008497 <italic>Lactobacillus brevis</italic> ATCC 367</td><td rowspan="1" colspan="1">NC_009513 <italic>Lactobacillus reuteri</italic> DSM 20016 (genus)</td></tr><tr><td rowspan="1" colspan="1">NC_008700 <italic>Shewanella amazonensis</italic> SB2B</td><td rowspan="1" colspan="1">NC_014012 <italic>Shewanella violacea</italic> DSS12 (genus)</td></tr><tr><td rowspan="1" colspan="1">NC_008095 <italic>Myxococcus xanthus</italic> DK 1622</td><td rowspan="1" colspan="1">NC_011891 <italic>Anaeromyxobacter dehalogenans</italic> 2CP-1 (family)</td></tr><tr><td rowspan="1" colspan="1">NC_008578 <italic>Acidothermus cellulolyticus</italic> 11B</td><td rowspan="1" colspan="1">NC_014666 <italic>Frankia</italic> sp. EuI1c (order)</td></tr><tr><td rowspan="1" colspan="1">NC_002607 <italic>Halobacterium</italic> sp. NRC-1</td><td rowspan="1" colspan="1">NC_013967 <italic>Haloferax volcanii</italic> DS2 (family)</td></tr></tbody></table><table-wrap-foot><fn id="TF1"><p><sup>a</sup>The taxonomic ranks in the parentheses indicate the lowest common taxonomy level shared between the reference species and the species in the mock dataset.</p></fn></table-wrap-foot></table-wrap></p>
      <p>The SOAPdenovo assembler (<xref ref-type="bibr" rid="B11">Li <italic>et al.</italic>, 2010</xref>) is used to assemble both the simulated datasets and the artificial community dataset (we use k=31). The de Bruijn graph outputs from SOAPdenovo are used as inputs to GeneStitch. We use Δmatch = 1, Δmismatch = −2, Δ<italic>g</italic>_open = −3 and Δ<italic>g</italic>_ext = −1 in all our tests. Note that GraphStitch can work with any assembler that utilizes de Bruijn graphs.</p>
    </sec>
  </sec>
  <sec id="SEC3">
    <title>3 RESULTS</title>
    <sec id="SEC3.1">
      <title>3.1 GeneStitch improves gene assembly</title>
      <p>We first test our algorithm on datasets simulated from only one genome (<italic>E. coli</italic> K-12) to show that reference genes from closely related (<italic>E. coli</italic> HS and <italic>E. fergusonni</italic>) or more distantly related species (<italic>S. enterica</italic>) can be used to improve gene assembly. We evaluate the performance of GeneStitch by both ‘gene coverage’, and the number of ‘complete genes’assembled. The gene coverage is defined as the average percentage of the annotated genes (in length) that are covered by the assemblies (e.g. a gene coverage of 100% means that full-length genes are assembled). An assembled gene is considered complete if it covers at least 90% of the actual gene, sharing at least 98% sequence identity.</p>
      <p>The results are summarized in <xref ref-type="table" rid="T2">Table 2</xref>. Since GeneStitch is designed for assembling fragmented genes, we isolate the fragmented genes from the contigs either from the initial assembly or after various GeneStitch treatments and calculate the gene coverage for them (the statistics of all genes are also given). For all datasets, GeneStitch significantly improves the completeness of assembled genes as compared with initial assembly's genes (with higher gene coverage), and the number of complete genes, especially for the datasets with lower sequencing depths (6× or 13×). For example, for the dataset with 13× sequencing depth, SOAPdenovo alone assembled 2320 complete genes, and GeneStitch assembled 1070 more (i.e. a 46% improvement). Improvement is also observed, although less significant, for the dataset with 20× sequencing depth (which can already be assembled fairly well by SOAPdenovo with a gene coverage—for all genes in contigs—of 81%). These results demonstrate the ability of GeneStitch to link fragmented genes together and form longer genes.</p>
      <table-wrap id="T2" position="float">
        <label>Table 2.</label>
        <caption>
          <p>A summary of the GeneStitch results for <italic>E. coli</italic> K-12 at 6×, 13× and 20× sequencing depths</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Sequencing depth</th>
              <th rowspan="1" colspan="1">Reference</th>
              <th rowspan="1" colspan="1">Genes/fragments<italic><sup>a</sup></italic></th>
              <th rowspan="1" colspan="1">Gene coverage<italic><sup>b</sup></italic></th>
              <th rowspan="1" colspan="1">Complete genes<italic><sup>c</sup></italic></th>
              <th rowspan="1" colspan="1">Complete gene ratio<italic><sup>d</sup></italic></th>
              <th rowspan="1" colspan="1">Misassembly rate</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="4" valign="middle" colspan="1">6×</td>
              <td rowspan="1" colspan="1">—<italic><sup>e</sup></italic></td>
              <td rowspan="1" colspan="1">13 947 (14 149)<italic><sup>f</sup></italic></td>
              <td rowspan="1" colspan="1">26% (28%)<italic><sup>f</sup></italic></td>
              <td rowspan="1" colspan="1">572</td>
              <td rowspan="1" colspan="1">14%</td>
              <td rowspan="1" colspan="1">—</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"><italic>E. coli</italic> HS</td>
              <td rowspan="1" colspan="1">5365</td>
              <td rowspan="1" colspan="1">62%</td>
              <td rowspan="1" colspan="1">+318</td>
              <td rowspan="1" colspan="1">21%<italic><sup>g</sup></italic></td>
              <td rowspan="1" colspan="1">0.3%</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic>E. fergusonni</italic>
              </td>
              <td rowspan="1" colspan="1">4489</td>
              <td rowspan="1" colspan="1">62%</td>
              <td rowspan="1" colspan="1">+269</td>
              <td rowspan="1" colspan="1">20%</td>
              <td rowspan="1" colspan="1">0.5%</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic>S. enterica</italic>
              </td>
              <td rowspan="1" colspan="1">3916</td>
              <td rowspan="1" colspan="1">62%</td>
              <td rowspan="1" colspan="1">+227</td>
              <td rowspan="1" colspan="1">19%</td>
              <td rowspan="1" colspan="1">0.2%</td>
            </tr>
            <tr>
              <td rowspan="4" valign="middle" colspan="1">13×</td>
              <td rowspan="1" colspan="1">—<italic><sup>e</sup></italic></td>
              <td rowspan="1" colspan="1">6642 (9158)<italic><sup>f</sup></italic></td>
              <td rowspan="1" colspan="1">33% (50%)<italic><sup>f</sup></italic></td>
              <td rowspan="1" colspan="1">2320</td>
              <td rowspan="1" colspan="1">56%</td>
              <td rowspan="1" colspan="1">—</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"><italic>E. coli</italic> HS</td>
              <td rowspan="1" colspan="1">4375</td>
              <td rowspan="1" colspan="1">75%</td>
              <td rowspan="1" colspan="1">+1070</td>
              <td rowspan="1" colspan="1">82%</td>
              <td rowspan="1" colspan="1">0.2%</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic>E. fergusonni</italic>
              </td>
              <td rowspan="1" colspan="1">3664</td>
              <td rowspan="1" colspan="1">75%</td>
              <td rowspan="1" colspan="1">+932</td>
              <td rowspan="1" colspan="1">78%</td>
              <td rowspan="1" colspan="1">0.3%</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic>S. enterica</italic>
              </td>
              <td rowspan="1" colspan="1">3212</td>
              <td rowspan="1" colspan="1">75%</td>
              <td rowspan="1" colspan="1">+824</td>
              <td rowspan="1" colspan="1">76%</td>
              <td rowspan="1" colspan="1">0.2%</td>
            </tr>
            <tr>
              <td rowspan="4" valign="middle" colspan="1">20×</td>
              <td rowspan="1" colspan="1">—<italic><sup>e</sup></italic></td>
              <td rowspan="1" colspan="1">1904 (3491)<italic><sup>f</sup></italic></td>
              <td rowspan="1" colspan="1">45% (81%)<italic><sup>f</sup></italic></td>
              <td rowspan="1" colspan="1">3264</td>
              <td rowspan="1" colspan="1">79%</td>
              <td rowspan="1" colspan="1">—</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"><italic>E. coli</italic> HS</td>
              <td rowspan="1" colspan="1">1960</td>
              <td rowspan="1" colspan="1">75%</td>
              <td rowspan="1" colspan="1">+461</td>
              <td rowspan="1" colspan="1">90%</td>
              <td rowspan="1" colspan="1">0.6%</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic>E. fergusonni</italic>
              </td>
              <td rowspan="1" colspan="1">1484</td>
              <td rowspan="1" colspan="1">76%</td>
              <td rowspan="1" colspan="1">+418</td>
              <td rowspan="1" colspan="1">89%</td>
              <td rowspan="1" colspan="1">0.2%</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <italic>S. enterica</italic>
              </td>
              <td rowspan="1" colspan="1">1261</td>
              <td rowspan="1" colspan="1">75%</td>
              <td rowspan="1" colspan="1">+349</td>
              <td rowspan="1" colspan="1">87%</td>
              <td rowspan="1" colspan="1">0.2%</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="TF2">
            <p><italic><sup>a</sup></italic>This column specifies the number of gene fragments in assembled contigs (the first row for each section) or the number of genes assembled by GeneStitch.</p>
          </fn>
          <fn id="TF3">
            <p><italic><sup>b</sup></italic>Gene coverage reflects the completeness of assembled genes; a small value indicates that assembled genes are highly fragmented.</p>
          </fn>
          <fn id="TF4">
            <p><italic><sup>c</sup></italic>This column lists the assembled genes or genes in contigs (the first row for each section) that are complete or almost complete (at least 90% of the entire length) as compared with the real genes. Additional complete gene numbers assembled by GeneStitch are highlighted by a ‘+’ sign.</p>
          </fn>
          <fn id="TF5">
            <p><italic><sup>d</sup></italic> This column lists the ratio of completely assembled genes versus all annotated genes in the <italic>E. coli</italic> K-12 genome.</p>
          </fn>
          <fn id="TF6">
            <p><italic><sup>e</sup></italic>This row lists the assembly results before applying GeneStitch.</p>
          </fn>
          <fn id="TF7">
            <p><italic><sup>f</sup></italic> The two numbers indicate the statistics of fragmented genes and all genes (within parentheses) in contigs. See text for details.</p>
          </fn>
          <fn id="TF8">
            <p><italic><sup>g</sup></italic>The ratio is calculated over all complete genes, including the ones assembled by SOAPdenovo and GeneStitch.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>Another observation is that the improvement introduced by GeneStitch decreases with the taxonomic distances of the reference species, which is not surprising. Our tests, however, show that even when using distantly related species (e.g. <italic>S. enterica</italic>) as references, GeneStitch improved the quality of gene assembly. Overall these results demonstrate the power of GeneStitch, in which fragmented genes split into different contigs are assembled into longer gene fragments even if we use reference species of different genera (e.g. target species <italic>E. coli</italic> K-12 vs reference <italic>S. enterica</italic>).</p>
      <p>We also examined the potential for misassembly in the assembled gene sequences by mapping the assembled genes against the <italic>E. coli</italic> K-12 genome. The proportions of misassembled sequences are very low for all three test datasets, indicating that GeneStitch introduces few misassemblies into single genome assemblies.</p>
    </sec>
    <sec sec-type="methods" id="SEC3.2">
      <title>3.2 GeneStitch successfully identifies genes in a metagenomic dataset</title>
      <p>We next tested GeneStitch with the artificial community dataset. Since the sequencing depth of the 454 dataset is not very high (2.86×) and contains a eukaryote organism, we also simulated a dataset with higher depth (9×) that included only the prokaryotic species from the dataset. The results are shown in <xref ref-type="fig" rid="F2">Figure 2</xref>. Similar to the single genome cases, the gene coverage ratio for both the simulated and real metagenomic datasets increases (shown in <xref ref-type="fig" rid="F2">Figure 2A</xref>), suggesting that GeneStitch is capable of assembling longer genes from the metagenomes. An intriguing observation is that even though there are fewer genes assembled from the real sequence dataset (8283 genes) as compared with the simulated dataset (22 331 genes), the gene coverage ratio of the assembled genes in the real dataset is actually higher after treatment with GeneStitch (71 versus 52%) .
<fig id="F2" position="float"><label>Fig. 2.</label><caption><p>Improvement of gene assembly by GeneStitch for the simulated and real community datasets, as evaluated by gene coverage (A) and the number of complete genes (B)</p></caption><graphic xlink:href="bts388f2"/></fig>
</p>
      <p>The number of complete genes, as demonstrated in <xref ref-type="fig" rid="F2">Figure 2B</xref>, also suggests that GeneStitch has the ability to produce complete genes from metagenomes. Besides the already complete genes in the contigs, GeneStitch is able to build 1212 and 1656 more complete genes from gene fragments. From the real dataset, GeneStitch assembled more than five times more complete genes than those in contigs. The reason that the number of complete genes assembled for the simulated dataset is less than that for the real dataset is that many complete genes are already well assembled for the simulated data due to its higher sequencing depth. On the other hand, the genes in the real dataset are mostly fragmented and are then recovered using GeneStitch. Nevertheless, the number of assembled genes for the simulated dataset (22 331 genes) is still higher than the real dataset (8283), suggesting that higher sequencing depth is still needed for ideal gene assemblies.</p>
      <p>The misassembly rates for the genes assembled from the metagenomes are higher than those for single genomes. In total, 1109 genes (4.97%) and 165 genes (1.99%) are probably misassembled for the simulated and real dataset, respectively. Further analysis reveals that the majority of these genes (832 out of 1109 genes for simulated dataset and 37 of 165 genes for real dataset) can be mapped to exactly two homologous genes in the community: for example an assembled gene may consist of segments from two homologous genes and produce a chimeric sequence. Considering that these cases are sometimes unavoidable for metagenome assembly (and we call them ‘minor’ misassembles), especially when very similar genes from different species exist in the sample (there are two strains of <italic>Lactococcus lactis</italic>, namely <italic>L. lactis</italic> cremoris IL1403 and <italic>L. lactis</italic> cremoris SK11, in the mock dataset), the ‘severely’ misassembly rate is only 1.24 and 1.55% for the simulated and real datasets.</p>
      <p>Below, we present two cases from the real community dataset, to demonstrate how we find the gene graph from the assembled de Bruijn graph.</p>
    </sec>
    <sec id="SEC3.3">
      <title>3.3 Example gene graph No. 1</title>
      <p>The first example demonstrates how a gene path can be inferred from a connected component in the de Bruijn graph with 17 nodes. Only one gene annotated as beta glucosidase, YP_812362 from the species <italic>Lactobacillus delbrueckii</italic> subsp. <italic>bulgaricus</italic> ATCC BAA-365, passes the threshold values and is detected in this example. The result is shown in <xref ref-type="fig" rid="F3">Figure 3</xref>: the path with similarity to the reference gene contains seven nodes; no nodes can be further recruited into this connected graph, thus only seven nodes (contigs) covered by the path represent the gene graph, and the sequences in this path constitute the representative gene for this gene graph.
<fig id="F3" position="float"><label>Fig. 3.</label><caption><p>An example demonstrating the inference of a gene path from a connected component in the de Bruijn graph. The reference gene recruited by BLAST in this example is YP_812362. (A) In total, 17 nodes are present in this connected component. (B) The path found by GeneStitch using the reference gene. (C) The gene path</p></caption><graphic xlink:href="bts388f3"/></fig>
</p>
    </sec>
    <sec id="SEC3.4">
      <title>3.4 Example gene graph No. 2</title>
      <p>This example demonstrates how we infer gene graphs by merging paths (or gene graphs). <xref ref-type="fig" rid="F4">Figure 4A</xref> shows a connected component of the de Bruijn graph. Two reference genes, YP_003601430 from <italic>Lactobacillus amylovorus</italic> GRL 1112 and YP_004031707 from <italic>Lactobacillus crispatus</italic> ST1, can be recruited as reference genes to this graph. The identity between these two genes is 76%. From <xref ref-type="fig" rid="F4">Figure 4B</xref> one can observe that the paths are very similar—only one branching node is different. Since the identity of the two reference genes is higher than the threshold (default 70%; see <xref ref-type="sec" rid="SEC2.3">Section 2.3</xref>) and the two graphs are overlapping, these two graphs are merged into one gene graph, as shown in <xref ref-type="fig" rid="F4">Figure 4C</xref>. The first assembled sequence, which has a higher score value (as well as a higher identity), is selected as the representative gene for this gene graph.
<fig id="F4" position="float"><label>Fig. 4.</label><caption><p>An example demonstrating the construction of a gene graph by merging gene paths. (A) only 19 nodes are shown in this figure for clarity (the actual component is larger). (B) Two paths are found by GeneStitch, using YP_003601430 and YP_004031707 as the reference genes. (C) The two paths are merged into a gene graph</p></caption><graphic xlink:href="bts388f4"/></fig>
</p>
    </sec>
  </sec>
  <sec id="SEC4">
    <title>4 DISCUSSION</title>
    <p>We present GeneStitch, which is based on a network matching algorithm, for inferring gene paths and gene graphs from the tangled de Bruijn graphs that result from assembly of metagenomic sequences. If we have prior knowledge of the taxonomic composition of a metagenomic dataset (e.g. through 16S rRNA gene profiling (<xref ref-type="bibr" rid="B8">Hamady <italic>et al.</italic>, 2008</xref>), or taxonomic analysis using shotgun sequences (<xref ref-type="bibr" rid="B5">Gerlach and Stoye, 2011</xref>)), we can use genes from the most closely related species available as references for GeneStitch, considering that GeneStitch benefits more by using the most similar gene sequences as the reference. However, in principle, we can use a general dataset of genes (e.g. microbial genes in the NCBI nr dataset) as reference genes in GeneStitch, if we have no prior knowledge of the taxonomic composition of a metagenomic sample.</p>
    <p>For all tests that we performed, the application of GeneStitch greatly improves the assembly of genes, resulting in complete or nearly complete genes. The assembly of complete gene sequences is important because traditional metagenome sequencing projects are largely limited by the length of contigs and scaffolds, and small contigs are often difficult (if not possible) to use for subsequent functional analysis. We believe that our approach will increase the amount of information that can be gleaned from past and future genome and metagenome projects, by providing longer genes for analysis. We note that GeneStitch is able to improve the gene assembly even when only distantly related species are available as references, and when sequence depth is modest. This capability is especially important because sequenced bacterial or archaeal genomes are still limited and very closely related species (such as different strain of the same species) are not always available. GeneStitch greatly broadens the choice of reference species for gene annotation in metagenomic assemblies.</p>
    <p>Our approach can be conceived as a gene predictor that works with de Bruijn graphs for assembly, instead of linear sequences. In this sense, GeneStitch is fundamentally different from current gene predictors including FragGeneScan (<xref ref-type="bibr" rid="B19">Rho <italic>et al.</italic>, 2010</xref>) and GLIMMER (<xref ref-type="bibr" rid="B3">Delcher <italic>et al.</italic>, 1999</xref>). Note that gene paths are fundamentally different from the directed acyclic graphs used to represent exons (as nodes) and their connectivity (the edges) in predictors for eukaryotic genes (<xref ref-type="bibr" rid="B14">Mathe <italic>et al.</italic>, 2002</xref>). We have also proposed a novel concept, the gene graph, to represent a collection of homologous genes in a metagenomic dataset. A gene graph may not include all similar (or homologous) genes in a metagenomic dataset, because we set the identity threshold to a relatively high value (e.g. 70%) in the process of constructing gene graphs. But it is not our goal to build comprehensive gene graphs; instead, we want to assemble metagenomic sequences into separate genes as long as we have strong evidence the assembled genes contain no misassemblies. We note that GeneStitch cannot help with the assembly of novel genes that lack similarity with known genes.</p>
    <p>Although the gene graph is used to represent the cases where gene paths overlap with each other—a non-conventional way of representing genes—we argue that gene graphs can be considered as single units for downstream functional analysis of metagenomes. For example, we can attempt to get all real genes from the gene graphs by walking all potential paths in the gene graphs and select those supported by reads. This approach is used by the Trinity assembler to find all spliced isoforms and transcripts of recently duplicated genes from transcriptomes (<xref ref-type="bibr" rid="B7">Grabherr <italic>et al.</italic>, 2011</xref>). Another application would be functional prediction, we can search an unknown gene against all gene graphs and determine which gene graph is most similar to this gene, in order to determine its function.</p>
    <p>Notably, other strategies have been used to improve metagenome assembly, for examples by merging assemblies from different assemblers or using the same assembler but with various parameter settings (<xref ref-type="bibr" rid="B29">Zimin <italic>et al.</italic>, 2008</xref>); by recruiting reads to fill in gaps between contigs using tblastn searches against reference genes as in the gene-boosted assembly approach (<xref ref-type="bibr" rid="B21">Salzberg <italic>et al.</italic>, 2008</xref>) and by assembling potential protein-coding reads at the peptide level as in the ORFome assembly approach (<xref ref-type="bibr" rid="B27">Ye and Tang, 2009</xref>). GeneStitch uses similarity between the genes included in a metagenomic dataset and reference genes available in a novel way and uses the matches between the de Bruijn graph assembly and the reference genes to improve the gene assembly. In principle, GeneStitch and other strategies to improve assembly can be combined to further improve the assembly of metagenomes.</p>
  </sec>
  <sec id="SEC5">
    <title>5 CONCLUSION</title>
    <p>We designed an approach to infer gene paths and gene graphs from a <italic>de novo</italic> assembled metagenomic dataset that each represents a gene or a single family of homologous genes. Each gene graph also generates a representative sequence that best represents the graph. We tested this approach on simulated datasets consisting of reads from one genome and the results are promising—longer genes are assembled and more intact genes are retrieved, and there are almost no misassembled genes. We also tested it with a dataset from an artificial microbial community and found that we again assembled more complete genes. We expect that gene graphs can be used to improve metagenome assemblies and that gene graphs will be a useful resource for the functional annotation of metagenomic samples.</p>
  </sec>
</body>
<back>
  <ack>
    <title>ACKNOWLEDGEMENT</title>
    <p>We thank Dr Haixu Tang for helpful discussions and suggestions.</p>
    <p><italic>Funding:</italic> Grants <funding-source>NIH</funding-source>
<award-id>1R01HG004908</award-id> and <funding-source>NSF</funding-source>
<award-id>DBI-0845685</award-id>.</p>
  </ack>
  <fn-group>
    <fn id="FN1">
      <p><sup>1</sup>Throughout this article, we consider the de Bruijn graph in which each simple path (a maximal directed path in the graph, in that all internal vertices have one incoming and one outgoing edge) is collapsed into a single node.</p>
    </fn>
  </fn-group>
  <ref-list>
    <title>REFERENCES</title>
    <ref id="B1">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bentley</surname>
            <given-names>D.R.</given-names>
          </name>
        </person-group>
        <article-title>Whole-genome re-sequencing</article-title>
        <source>Curr. Opin. Genet. Dev.</source>
        <year>2006</year>
        <volume>16</volume>
        <fpage>545</fpage>
        <lpage>552</lpage>
        <pub-id pub-id-type="pmid">17055251</pub-id>
      </element-citation>
    </ref>
    <ref id="B2">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Compeau</surname>
            <given-names>Phillip E.C.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>How to apply de Bruijn graphs to genome assembly</article-title>
        <source>Natl Biotechnol.</source>
        <year>2011</year>
        <volume>29</volume>
        <fpage>987</fpage>
        <lpage>991</lpage>
      </element-citation>
    </ref>
    <ref id="B3">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Delcher</surname>
            <given-names>A.L.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Improved microbial gene identification with GLIMMER</article-title>
        <source>Nucleic Acids Res</source>
        <year>1999</year>
        <volume>27</volume>
        <fpage>4636</fpage>
        <lpage>4641</lpage>
        <pub-id pub-id-type="pmid">10556321</pub-id>
      </element-citation>
    </ref>
    <ref id="B4">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gelfand</surname>
            <given-names>M.S.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene recognition via spliced sequence alignment</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>1996</year>
        <volume>93</volume>
        <fpage>9061</fpage>
        <lpage>9066</lpage>
        <pub-id pub-id-type="pmid">8799154</pub-id>
      </element-citation>
    </ref>
    <ref id="B5">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gerlach</surname>
            <given-names>W.</given-names>
          </name>
          <name>
            <surname>Stoye</surname>
            <given-names>J.</given-names>
          </name>
        </person-group>
        <article-title>Taxonomic classification of metagenomic shotgun sequences with CARMA3</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2011</year>
        <volume>39</volume>
        <fpage>e91</fpage>
        <pub-id pub-id-type="pmid">21586583</pub-id>
      </element-citation>
    </ref>
    <ref id="B6">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gill</surname>
            <given-names>S.R.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metagenomic analysis of the human distal gut microbiome</article-title>
        <source>Science</source>
        <year>2006</year>
        <volume>312</volume>
        <fpage>1355</fpage>
        <lpage>1359</lpage>
        <pub-id pub-id-type="pmid">16741115</pub-id>
      </element-citation>
    </ref>
    <ref id="B7">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grabherr</surname>
            <given-names>M.G.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Full-length transcriptome assembly from RNA-Seq data without a reference genome</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2011</year>
        <volume>29</volume>
        <fpage>644</fpage>
        <lpage>652</lpage>
        <pub-id pub-id-type="pmid">21572440</pub-id>
      </element-citation>
    </ref>
    <ref id="B8">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hamady</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Error-correcting barcoded primers for pyrosequencing hundreds of samples in multiplex</article-title>
        <source>Nat. Methods</source>
        <year>2008</year>
        <volume>5</volume>
        <fpage>235</fpage>
        <lpage>237</lpage>
        <pub-id pub-id-type="pmid">18264105</pub-id>
      </element-citation>
    </ref>
    <ref id="B9">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hess</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metagenomic discovery of biomass-degrading genes and genomes from cow rumen</article-title>
        <source>Science</source>
        <year>2011</year>
        <volume>331</volume>
        <fpage>463</fpage>
        <lpage>467</lpage>
        <pub-id pub-id-type="pmid">21273488</pub-id>
      </element-citation>
    </ref>
    <ref id="B10">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hoff</surname>
            <given-names>K.J.</given-names>
          </name>
        </person-group>
        <article-title>The effect of sequencing errors on metagenomic gene prediction</article-title>
        <source>BMC Genomics</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>520</fpage>
        <pub-id pub-id-type="pmid">19909532</pub-id>
      </element-citation>
    </ref>
    <ref id="B11">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Durbin</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>Fast and accurate long-read alignment with Burrows-Wheeler transform</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>589</fpage>
        <lpage>595</lpage>
        <pub-id pub-id-type="pmid">20080505</pub-id>
      </element-citation>
    </ref>
    <ref id="B12">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>R.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>De novo assembly of human genomes with massively parallel short read sequencing</article-title>
        <source>Genome Res.</source>
        <year>2010</year>
        <volume>20</volume>
        <fpage>265</fpage>
        <lpage>272</lpage>
        <pub-id pub-id-type="pmid">20019144</pub-id>
      </element-citation>
    </ref>
    <ref id="B13">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Margulies</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genome sequencing in microfabricated high-density picolitre reactors</article-title>
        <source>Nature</source>
        <year>2005</year>
        <volume>437</volume>
        <fpage>376</fpage>
        <lpage>380</lpage>
        <pub-id pub-id-type="pmid">16056220</pub-id>
      </element-citation>
    </ref>
    <ref id="B14">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mathe</surname>
            <given-names>C.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Current methods of gene prediction, their strengths and weaknesses</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2002</year>
        <volume>30</volume>
        <fpage>4103</fpage>
        <lpage>4117</lpage>
        <pub-id pub-id-type="pmid">12364589</pub-id>
      </element-citation>
    </ref>
    <ref id="B15">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Morgan</surname>
            <given-names>J.L.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metagenomic sequencing of an in vitro-simulated microbial community</article-title>
        <source>PLoS One</source>
        <year>2010</year>
        <volume>5</volume>
        <fpage>e10209</fpage>
        <pub-id pub-id-type="pmid">20419134</pub-id>
      </element-citation>
    </ref>
    <ref id="B16">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Peterson</surname>
            <given-names>J.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The NIH Human Microbiome Project</article-title>
        <source>Genome Res.</source>
        <year>2009</year>
        <volume>19</volume>
        <fpage>2317</fpage>
        <lpage>2323</lpage>
        <pub-id pub-id-type="pmid">19819907</pub-id>
      </element-citation>
    </ref>
    <ref id="B17">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pop</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>Genome assembly reborn: recent computational challenges</article-title>
        <source>Brief Bioinform.</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>354</fpage>
        <lpage>366</lpage>
        <pub-id pub-id-type="pmid">19482960</pub-id>
      </element-citation>
    </ref>
    <ref id="B18">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qin</surname>
            <given-names>J.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A human gut microbial gene catalogue established by metagenomic sequencing</article-title>
        <source>Nature</source>
        <year>2010</year>
        <volume>464</volume>
        <fpage>59</fpage>
        <lpage>65</lpage>
        <pub-id pub-id-type="pmid">20203603</pub-id>
      </element-citation>
    </ref>
    <ref id="B19">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rho</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>FragGeneScan: predicting genes in short and error-prone reads</article-title>
        <source>Nucleic Acids Res</source>
        <year>2010</year>
        <volume>38</volume>
        <fpage>e191</fpage>
        <pub-id pub-id-type="pmid">20805240</pub-id>
      </element-citation>
    </ref>
    <ref id="B20">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Richter</surname>
            <given-names>D.C.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MetaSim: a sequencing simulator for genomics and metagenomics</article-title>
        <source>PLoS One</source>
        <year>2008</year>
        <volume>3</volume>
        <fpage>e3373</fpage>
        <pub-id pub-id-type="pmid">18841204</pub-id>
      </element-citation>
    </ref>
    <ref id="B21">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Salzberg</surname>
            <given-names>S.L.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene-boosted assembly of a novel bacterial genome from very short reads</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2008</year>
        <volume>4</volume>
        <fpage>e1000186</fpage>
        <pub-id pub-id-type="pmid">18818729</pub-id>
      </element-citation>
    </ref>
    <ref id="B22">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schloss</surname>
            <given-names>P.D.</given-names>
          </name>
          <name>
            <surname>Handelsman</surname>
            <given-names>J.</given-names>
          </name>
        </person-group>
        <article-title>Metagenomics for studying unculturable microorganisms: cutting the Gordian knot</article-title>
        <source>Genome Biol.</source>
        <year>2005</year>
        <volume>6</volume>
        <fpage>229</fpage>
        <pub-id pub-id-type="pmid">16086859</pub-id>
      </element-citation>
    </ref>
    <ref id="B23">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Turnbaugh</surname>
            <given-names>P.J.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>An obesity-associated gut microbiome with increased capacity for energy harvest</article-title>
        <source>Nature</source>
        <year>2006</year>
        <volume>444</volume>
        <fpage>1027</fpage>
        <lpage>1031</lpage>
        <pub-id pub-id-type="pmid">17183312</pub-id>
      </element-citation>
    </ref>
    <ref id="B24">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tyson</surname>
            <given-names>G.W.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Community structure and metabolism through reconstruction of microbial genomes from the environment</article-title>
        <source>Nature</source>
        <year>2004</year>
        <volume>428</volume>
        <fpage>37</fpage>
        <lpage>43</lpage>
        <pub-id pub-id-type="pmid">14961025</pub-id>
      </element-citation>
    </ref>
    <ref id="B25">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Venter</surname>
            <given-names>J.C.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Environmental genome shotgun sequencing of the Sargasso Sea</article-title>
        <source>Science</source>
        <year>2004</year>
        <volume>304</volume>
        <fpage>66</fpage>
        <lpage>74</lpage>
        <pub-id pub-id-type="pmid">15001713</pub-id>
      </element-citation>
    </ref>
    <ref id="B26">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wommack</surname>
            <given-names>K.E.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metagenomics: read length matters</article-title>
        <source>Appl. Environ. Microbiol.</source>
        <year>2008</year>
        <volume>74</volume>
        <fpage>1453</fpage>
        <lpage>1463</lpage>
        <pub-id pub-id-type="pmid">18192407</pub-id>
      </element-citation>
    </ref>
    <ref id="B27">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ye</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Tang</surname>
            <given-names>H.</given-names>
          </name>
        </person-group>
        <article-title>An ORFome assembly approach to metagenomics sequences analysis</article-title>
        <source>J. Bioinform. Comput. Biol.</source>
        <year>2009</year>
        <volume>7</volume>
        <fpage>455</fpage>
        <lpage>471</lpage>
        <pub-id pub-id-type="pmid">19507285</pub-id>
      </element-citation>
    </ref>
    <ref id="B28">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ye</surname>
            <given-names>Y.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Asegment alignment approach to protein comparison</article-title>
        <source>Bioinformatics</source>
        <year>2003</year>
        <volume>19</volume>
        <fpage>742</fpage>
        <lpage>749</lpage>
        <pub-id pub-id-type="pmid">12691986</pub-id>
      </element-citation>
    </ref>
    <ref id="B29">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zimin</surname>
            <given-names>A.V.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Assembly reconciliation</article-title>
        <source>Bioinformatics</source>
        <year>2008</year>
        <volume>24</volume>
        <fpage>42</fpage>
        <lpage>45</lpage>
        <pub-id pub-id-type="pmid">18057021</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
