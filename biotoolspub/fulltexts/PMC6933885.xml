<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6933885</article-id>
    <article-id pub-id-type="publisher-id">3319</article-id>
    <article-id pub-id-type="doi">10.1186/s12859-019-3319-y</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ICGRM: integrative construction of genomic relationship matrix combining multiple genomic regions for big dataset</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Jiang</surname>
          <given-names>Dan</given-names>
        </name>
        <address>
          <email>Jiangdan666@163.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Xin</surname>
          <given-names>Cong</given-names>
        </name>
        <address>
          <email>xincongdoctor@163.com</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Ye</surname>
          <given-names>Jinhua</given-names>
        </name>
        <address>
          <email>jinhuayexiaoy@126.com</email>
        </address>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Yuan</surname>
          <given-names>Yingbo</given-names>
        </name>
        <address>
          <email>260054249@qq.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-3066-4855</contrib-id>
        <name>
          <surname>Fang</surname>
          <given-names>Ming</given-names>
        </name>
        <address>
          <email>fangming618@126.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 0643 6866</institution-id><institution-id institution-id-type="GRID">grid.411902.f</institution-id><institution>Key Laboratory of Healthy Mariculture for the East China Sea, Ministry of Agriculture and Rural Affairs, Fisheries College, </institution><institution>Jimei University, </institution></institution-wrap>Xiamen, 361021 Fujian Province China </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 1771 3402</institution-id><institution-id institution-id-type="GRID">grid.412679.f</institution-id><institution>Institute of Dermatology and Department of Dermatology, </institution><institution>the First Affiliated Hospital of Anhui Medical University, </institution></institution-wrap>Hefei, 230032 China </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 1808 3449</institution-id><institution-id institution-id-type="GRID">grid.412064.5</institution-id><institution>College of Science, </institution><institution>Heilongjiang Bayi Agricultural University, </institution></institution-wrap>Daqing, 163319 China </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>26</day>
      <month>12</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>26</day>
      <month>12</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2019</year>
    </pub-date>
    <volume>20</volume>
    <elocation-id>731</elocation-id>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>5</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>16</day>
        <month>12</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s). 2019</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold>This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">Genomic prediction is an advanced method for estimating genetic values, which has been widely accepted for genetic evaluation in animal and disease-risk prediction in human. It estimates genetic values with genome-wide distributed SNPs instead of pedigree. The key step of it is to construct genomic relationship matrix (GRM) via genome-wide SNPs; however, usually the calculation of GRM needs huge computer memory especially when the SNP number and sample size are big, so that sometimes it will become computationally prohibitive even for super computer clusters. We herein developed an integrative algorithm to compute GRM. To avoid calculating GRM for the whole genome, ICGRM freely divides the genome-wide SNPs into several segments and computes the summary statistics related to GRM for each segment that requires quite few computer RAM; then it integrates these summary statistics to produce GRM for whole genome.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">It showed that the computer memory of ICGRM was reduced by 15 times (from 218Gb to 14Gb) after the genome SNPs were split into 5 to 200 parts in terms of the number of SNPs in our simulation dataset, making it computationally feasible for almost all kinds of computer servers. ICGRM is implemented in C/C++ and freely available via <ext-link ext-link-type="uri" xlink:href="https://github.com/mingfang618/CLGRM">https://github.com/mingfang618/CLGRM</ext-link>.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3">ICGRM is computationally efficient software to build GRM and can be used for big dataset.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Genomic relationship matrix</kwd>
      <kwd>Genomic selection</kwd>
      <kwd>Gblup</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001809</institution-id>
            <institution>National Natural Science Foundation of China</institution>
          </institution-wrap>
        </funding-source>
        <award-id>31672399</award-id>
        <award-id>31872560</award-id>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2019</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par4">Majority of economic traits in animal and human diseases have polygenic nature, the precise estimate of genetic value is important for animal breeding and disease-risk evaluation in human. Henderson [<xref ref-type="bibr" rid="CR1">1</xref>] proposed a best linear unbiased estimate (BLUP) to estimate genetic value, which takes advantage of the inheritance similarities among individuals based on pedigree information. With the development of sequencing technique, using whole genome-wide SNPs to calculate the similarities among individuals has been well developed [<xref ref-type="bibr" rid="CR2">2</xref>], in which the pairwise kinship among individuals is usually described with a matrix called genomic relationship matrix (GRM). The method using GRM instead of pedigree to estimate breeding value is called genomic best linear unbiased estimate (GBLUP), which has been widely applied to estimate breeding value in the animal breeding program for dairy cattle and pig [<xref ref-type="bibr" rid="CR3">3</xref>–<xref ref-type="bibr" rid="CR5">5</xref>] instead of BLUP method.</p>
    <p id="Par5">Recently, whole-genome re-sequencing technique has been applied to genomic selection, by which millions of SNPs can be genotyped. Although it is able to increase the accuracy of breeding-value estimate, the computational RAM is very demanding. Furthermore, for some species, such as dairy cattle, usually animals from multiple breeding farms and countries are combined for breeding value prediction, which increases the RAM requirement cubically. Therefore, it is very meaningful to develop new software to solve this problem.</p>
    <p id="Par6">Sophisticated statistical method plays an important role on discovery of important biology law, especially in the genomic era [<xref ref-type="bibr" rid="CR6">6</xref>, <xref ref-type="bibr" rid="CR7">7</xref>], it also helps to accelerate the computational speed or decrease the computer memory [<xref ref-type="bibr" rid="CR8">8</xref>]. Current method for GRM construction is largely based on VanRaden’s algorithm [<xref ref-type="bibr" rid="CR9">9</xref>–<xref ref-type="bibr" rid="CR13">13</xref>], although it is mathematically simple, the computer RAM cost is very big especially when the number of individual and SNPs are huge. However, we found the equation of VanRaden’s algorithm is additive for both numerator and denominator. It motives us to factorize VanRaden’s equation into two parts and calculates numerator and denominator respectively. Taking advantage of such additive character, we are able to use split and combine strategy to reduce the computational burden.</p>
    <p id="Par7">We herein develop a package, called ICGRM, which splits the genome SNPs into several parts and calculate the summary statistics for each part that only needs very few computer RAM; then combines the summary statistics for each part to produce GRM. ICGRM avoids calculating GRM for the whole genome at the same time; thus it makes the construction of the GRM more efficient for big dataset. The other feature of ICGRM is that it can assign a weight for each SNP effect in the construction of the GRM, by which it further increases the prediction accuracy for breeding value estimate.</p>
    <sec id="Sec2">
      <title>Implementation</title>
      <p id="Par8">We use Intel Math Kernel Library (Intel MKL) with BLAS routine to perform matrix operation. BLAS implementations are optimized for speed on a machine in parallel, which greatly reduces the computational time. We wrap the algorithm to computational package ICGRM, which is implemented with a command line script, including two parts, GRM calculation and integration routines. The command lines to achieve the task are below.</p>
      <p id="Par9">
        <bold>./clgrm_grm --in_file &lt;inputFile&gt; --weight_file &lt;inputWeightFile&gt; --out_file &lt;outputFile&gt; -–threads_num &lt;numberOfThreads&gt;</bold>
      </p>
      <p id="Par10">
        <bold>./clgrm_combine &lt;inputFileList&gt;</bold>
      </p>
      <p id="Par11">The first command line is to construct GRM matrix for a specific genome segment, by which ICGRM calculates GRM for each segment separately, where users can optionally define the weight of SNP effect with “<bold>--weight_file</bold>”; and the second command line is to combine each GRM from each segment/loci for generation of the final GRM.</p>
    </sec>
  </sec>
  <sec id="Sec3">
    <title>Results</title>
    <p id="Par12">The idea of the proposed method is that it firstly splits the genome SNPs into <italic>d</italic> segments, for each segment, it calculates the summary statistics related to each GRM; finally, it combines these summary statistics to produce the GRM (see Fig. <xref rid="Fig1" ref-type="fig">1</xref>).
<fig id="Fig1"><label>Fig. 1</label><caption><p>The flowchart of the ICGRM</p></caption><graphic xlink:href="12859_2019_3319_Fig1_HTML" id="MO1"/></fig></p>
    <sec id="Sec4">
      <title>Integrating summary statistics to GRM</title>
      <p id="Par13">Suppose there are <italic>k</italic> SNPs in genome, in VanRaden’s equation (VanRaden 2008), the GRM is expressed as:
<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ G=\frac{ZZ^{\prime }}{2{\sum}_{j=1}^k{p}_j\left(1-{p}_j\right)} $$\end{document}</tex-math><mml:math id="M2" display="block"><mml:mi>G</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="italic">ZZ</mml:mi><mml:mo>′</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:msubsup><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="12859_2019_3319_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par14">Specifically, for two individual <italic>m</italic> and <italic>n</italic> with <italic>K</italic> SNPs investigated, the relationship for individual <italic>m</italic> and <italic>n</italic> can be expressed as
<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {G}_{mn}=\frac{\sum_{j=1}^K\left({x}_{mj}-2{p}_j\right)\left({x}_{nj}-2{p}_j\right)}{2{\sum}_{j=1}^K{p}_j\left(1-{p}_j\right)}=\frac{\sum_{j=1}^K{z}_{mj}{z}_{nj}^{\prime }}{2{\sum}_{j=1}^K{p}_j\left(1-{p}_{\mathrm{j}}\right)} $$\end{document}</tex-math><mml:math id="M4" display="block"><mml:msub><mml:mi>G</mml:mi><mml:mi mathvariant="italic">mn</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi mathvariant="italic">mj</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi mathvariant="italic">nj</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:msub><mml:mi>z</mml:mi><mml:mi mathvariant="italic">mj</mml:mi></mml:msub><mml:msubsup><mml:mi>z</mml:mi><mml:mi mathvariant="italic">nj</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi mathvariant="normal">j</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="12859_2019_3319_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par15">Both numerator and denominator is the sum over statistics of <italic>K</italic> SNPs, respectively, which motivates us to split <italic>k</italic> SNPs into <italic>d</italic> segments, each containing <italic>k</italic><sub>1</sub>, <italic>k</italic><sub>2</sub>, ⋯, and <italic>k</italic><sub><italic>d</italic></sub> SNPs, respectively, and <italic>K=</italic>
<inline-formula id="IEq1"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\sum}_{s=1}^d{k}_s $$\end{document}</tex-math><mml:math id="M6" display="inline"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>d</mml:mi></mml:msubsup><mml:msub><mml:mi>k</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2019_3319_Article_IEq1.gif"/></alternatives></inline-formula>. Then we calculate the two statistics for each segment. Specifically, for segment <italic>s</italic> with <italic>k</italic><sub><italic>s</italic></sub> SNPs, we calculate <inline-formula id="IEq2"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {D}_s=\sum \limits_{j={k}_{s-1}}^{k_s}{z}_{mj}{z}_{nj}^{\prime } $$\end{document}</tex-math><mml:math id="M8" display="inline"><mml:msub><mml:mi>D</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:munderover><mml:msub><mml:mi>z</mml:mi><mml:mi mathvariant="italic">mj</mml:mi></mml:msub><mml:msubsup><mml:mi>z</mml:mi><mml:mi mathvariant="italic">nj</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2019_3319_Article_IEq2.gif"/></alternatives></inline-formula> and <inline-formula id="IEq3"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {N}_s={\sum}_{j={k}_{s-1}}^{k_s}{p}_j\left(1-{p}_j\right) $$\end{document}</tex-math><mml:math id="M10" display="inline"><mml:msub><mml:mi>N</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:msubsup><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="12859_2019_3319_Article_IEq3.gif"/></alternatives></inline-formula>, respectively, for <italic>s</italic> = 1, 2, ⋯, <italic>d</italic> and <italic>k</italic><sub>0</sub> = 1. After calculating these summary statistics, we save them on computer disk, and then use them to calculate GRM for whole genome using the eq. (<xref rid="Equ3" ref-type="">3</xref>).
<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {G}_{mn}=\frac{\sum_{s=1}^d{D}_s}{2{\sum}_{s=1}^d{N}_s} $$\end{document}</tex-math><mml:math id="M12" display="block"><mml:msub><mml:mi>G</mml:mi><mml:mi mathvariant="italic">mn</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>d</mml:mi></mml:msubsup><mml:msub><mml:mi>D</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>d</mml:mi></mml:msubsup><mml:msub><mml:mi>N</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="12859_2019_3319_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
    </sec>
    <sec id="Sec5">
      <title>Weighted GRM with SNPs</title>
      <p id="Par16">As suggested by Fragomeni et al. (2017), the accuracy of the GBLUP can be further increased by taking the weight of SNP effect into account and the weighted GRM can be written as
<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ G=\frac{ZDZ^{\prime }}{2{\sum}_{j=1}^k{p}_j\left(1-{p}_j\right)} $$\end{document}</tex-math><mml:math id="M14" display="block"><mml:mi>G</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="italic">ZDZ</mml:mi><mml:mo>′</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:msubsup><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="12859_2019_3319_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula>where, <italic>D</italic> is a diagonal matrix with the diagonal entry <italic>d</italic><sub><italic>j</italic></sub> being the weight of each SNP effect. For two individual <italic>m</italic> and <italic>n</italic>,
<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\mathrm{G}}_{mn}=\frac{\sum_{j=1}^K\left({x}_{mj}-2{p}_j\right){d}_j\left({x}_{nj}-2{p}_j\right)}{2{\sum}_{j=1}^K{p}_j\left(1-{p}_j\right)}=\frac{\sum_{j=1}^K{z}_{mj}{d}_j{z}_{nj}^{\prime }}{2{\sum}_{j=1}^K{p}_j\left(1-{p}_j\right)}, $$\end{document}</tex-math><mml:math id="M16" display="block"><mml:msub><mml:mi mathvariant="normal">G</mml:mi><mml:mi mathvariant="italic">mn</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi mathvariant="italic">mj</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:msub><mml:mi>d</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi mathvariant="italic">nj</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:msub><mml:mi>z</mml:mi><mml:mi mathvariant="italic">mj</mml:mi></mml:msub><mml:msub><mml:mi>d</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msubsup><mml:mi>z</mml:mi><mml:mi mathvariant="italic">nj</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>, </mml:mo></mml:math><graphic xlink:href="12859_2019_3319_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>which shows that the numerator and denominator are also additive for each SNP or segment, suggesting that our split-combine strategy is also applicable for this case. We also add this function into our package ICGRM for ease of use.</p>
    </sec>
    <sec id="Sec6">
      <title>Simulations</title>
      <p id="Par17">To illustrate the performance of the proposed method, we simulate a genome with the number of individuals from 5000 to 30,000; and the number of SNPs ranged from 0.1 to 10 million. As shown in Table <xref rid="Tab1" ref-type="table">1</xref>, when the number of SNPs is greater than 10 million and the number of individuals is greater than 10,000, the computational memory cost is greater than 250G, which has already been difficult for many computer servers to run the job and we also do not complete the job due to computer memory limitation. We therefore employ ICGRM to achieve this. For comparison, we keep using 10 CPU threads for calculation although we can use more. We conduct an experiment using datasets with 10 million SNPs and 5000, 10,000, 20,000, 30,000 individuals, respectively. To decrease the memory use, for each setup, we split dataset into 5, 10, 20, 50, 100 and 200 parts, respectively, in terms of SNP number; we calculate summary statistics for each part, separately, and then integrate them together to produce GRM. The memory and computational time cost are shown in Fig. <xref rid="Fig2" ref-type="fig">2</xref>a. It can be seen that when the dataset is split into more parts, the memory cost decreased dramatically (~ 15 times reduction from 5 to 200 parts); specifically, when the individual number is set at 30,000, the memory cost reduces from 218Gb to 14Gb, making it computationally feasible for almost all kinds of computer server. We also summarize the total computational time in Fig. <xref rid="Fig2" ref-type="fig">2</xref>b. It shows that when data are split into 5 to 50 parts, the total computational time cost is reduced about 7 times (using server with Intel Xeon CPU and total RAM 384Gb); but when the number of splitting parts is greater than 50, the computational time is starting to increase, and most of the computational time is consumed during data writing process.
<table-wrap id="Tab1"><label>Table 1</label><caption><p>The computer memory cost at different level of individuals and SNPs</p></caption><table frame="hsides" rules="groups"><thead><tr><th/><th>0.1 Million SNPs</th><th>0.5 Million SNPs</th><th>1 Million SNPs</th><th>10 Million SNPs</th></tr></thead><tbody><tr><td>5000</td><td>3. 9G</td><td>11.4G</td><td>20.7G</td><td>181.2Gb</td></tr><tr><td>10,000</td><td>6.4G</td><td>21.2G</td><td>39.9G</td><td>–</td></tr><tr><td>20,000</td><td>12.3G</td><td>42.1G</td><td>79.4G</td><td>–</td></tr><tr><td>30,000</td><td>19.8G</td><td>64.5G</td><td>118.3 G</td><td>–</td></tr></tbody></table></table-wrap>
<fig id="Fig2"><label>Fig. 2</label><caption><p>The computational memory (<bold>a</bold>) and time cost (<bold>b</bold>) at different number of individuals and splitting parts</p></caption><graphic xlink:href="12859_2019_3319_Fig2_HTML" id="MO2"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec7">
    <title>Discussion</title>
    <p id="Par18">We have developed a computational efficient algorithm and software ICGRM, which is useful for big dataset. When the number of SNPs is greater than 10 million and number of individual is greater than 10,000, the current method is not able to run due to the computer memory limit, but ICGRM solves this problem by splitting the dataset and merging the summary statistics, which reduces the computer memory dramatically. The software will be useful in future for prediction of genomic breeding value for big dataset.</p>
  </sec>
  <sec id="Sec8">
    <title>Conclusions</title>
    <p id="Par19">ICGRM is computational efficient software to build GRM and can be used for big dataset.</p>
  </sec>
  <sec id="Sec9">
    <title>Availability and requirements</title>
    <p id="Par20"><bold>Project name:</bold> CLGRM.</p>
    <p id="Par21">
      <bold>Project home page:</bold>
      <ext-link ext-link-type="uri" xlink:href="https://github.com/mingfang618/CLGRM">https://github.com/mingfang618/CLGRM</ext-link>
    </p>
    <p id="Par22"><bold>Operating system(s):</bold> Linux.</p>
    <p id="Par23"><bold>Programming language:</bold> C++.</p>
    <p id="Par24"><bold>License:</bold> No.</p>
    <p id="Par25"><bold>Any restrictions to use by non-academics:</bold> Communication with author.</p>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>Dan Jiang, Cong Xin and Jinhua Ye contributed equally to this work.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>Not applicable.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>DJ developed the idea and wrote the paper, DJ, CX and JY deduced the principle of method, YBY wrote the program, MF designed the experiment and organized the paper. All authors have read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>The research was supported by National Natural Science Foundation of China Grant 31672399 and 31872560. Funding body did not participate in the design of the study and collection, analysis, and interpretation of data and in writing the manuscript.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The simulation datasets used in the study are available from the corresponding author.</p>
  </notes>
  <notes>
    <title>Ethics approval and consent to participate</title>
    <p id="Par26">Not applicable.</p>
  </notes>
  <notes>
    <title>Consent for publication</title>
    <p id="Par27">Not applicable.</p>
  </notes>
  <notes notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par28">The authors declare that they have no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Henderson</surname>
          </name>
        </person-group>
        <article-title>Sire evaluation and genetic trends</article-title>
        <source>Proceedings of the animal Breeding and genetics symposium in Honor of Or. Jay L. Lush</source>
        <year>1972</year>
        <fpage>10</fpage>
        <lpage>41</lpage>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Meuwissen</surname>
            <given-names>THE</given-names>
          </name>
          <name>
            <surname>Hayes</surname>
            <given-names>BJ</given-names>
          </name>
          <name>
            <surname>Goddard</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>Prediction of total genetic value using genome wide dense marker maps</article-title>
        <source>Genetics</source>
        <year>2001</year>
        <volume>157</volume>
        <fpage>1819</fpage>
        <lpage>1829</lpage>
        <?supplied-pmid 11290733?>
        <pub-id pub-id-type="pmid">11290733</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Christensen</surname>
            <given-names>OF</given-names>
          </name>
          <name>
            <surname>Madsen</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Nielsen</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-step methods for genomic evaluation in pigs animal</article-title>
        <source>Genet Sel Evol</source>
        <year>2012</year>
        <volume>6</volume>
        <issue>10</issue>
        <fpage>1565</fpage>
        <lpage>1571</lpage>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Legarra</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Christensen</surname>
            <given-names>OF</given-names>
          </name>
          <name>
            <surname>Aguilar</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single step, a general approach for genomic selection</article-title>
        <source>Livest Sci</source>
        <year>2014</year>
        <volume>166</volume>
        <fpage>54</fpage>
        <lpage>65</lpage>
        <pub-id pub-id-type="doi">10.1016/j.livsci.2014.04.029</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Goddard</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>Reinhardt</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-step genomic model with direct estimation of marker effects</article-title>
        <source>J Dairy Sci</source>
        <year>2014</year>
        <volume>97</volume>
        <issue>9</issue>
        <fpage>5833</fpage>
        <lpage>5850</lpage>
        <pub-id pub-id-type="doi">10.3168/jds.2014-7924</pub-id>
        <pub-id pub-id-type="pmid">25022678</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sangwan</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Xia</surname>
            <given-names>FF</given-names>
          </name>
          <name>
            <surname>Gilbert</surname>
            <given-names>JA</given-names>
          </name>
        </person-group>
        <article-title>Recovering complete and draft population genomes from metagenome datasets</article-title>
        <source>Microbiome</source>
        <year>2016</year>
        <volume>4</volume>
        <fpage>8</fpage>
        <pub-id pub-id-type="doi">10.1186/s40168-016-0154-5</pub-id>
        <pub-id pub-id-type="pmid">26951112</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Imani</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Ghoreishi</surname>
            <given-names>SF</given-names>
          </name>
          <name>
            <surname>Braga-Neto</surname>
            <given-names>UM</given-names>
          </name>
        </person-group>
        <article-title>Bayesian control of large MDPs with unknown dynamics in data-poor environments</article-title>
        <source>Advances in neural information processing systems</source>
        <year>2018</year>
        <fpage>8146</fpage>
        <lpage>8156</lpage>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>March</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Willcox</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <source>MFBO-SSM: Multi-Fidelity Bayesian Optimization for Fast Inference in State-Space Models</source>
        <year>2019</year>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Meyer</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Tier</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Swan</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Estimates of genetic trend for single-step genomic evaluations</article-title>
        <source>Genet Sel Evol</source>
        <year>2018</year>
        <volume>50</volume>
        <fpage>39</fpage>
        <pub-id pub-id-type="doi">10.1186/s12711-018-0410-1</pub-id>
        <pub-id pub-id-type="pmid">30075705</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ødegård</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Indahl</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Strandén</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Large-scale genomic prediction using singular value decomposition of the genotype matrix</article-title>
        <source>Genet Sel Evol</source>
        <year>2018</year>
        <volume>50</volume>
        <fpage>6</fpage>
        <pub-id pub-id-type="doi">10.1186/s12711-018-0373-2</pub-id>
        <pub-id pub-id-type="pmid">29490611</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vandenplas</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Calus</surname>
            <given-names>MPL</given-names>
          </name>
          <name>
            <surname>Gorjanc</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Genomic prediction using individual-level data and summary statistics from multiple populations</article-title>
        <source>Genetics</source>
        <year>2018</year>
        <volume>2018</volume>
        <issue>210</issue>
        <fpage>53</fpage>
        <lpage>69</lpage>
        <pub-id pub-id-type="doi">10.1534/genetics.118.301109</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>VanRaden</surname>
            <given-names>PM</given-names>
          </name>
        </person-group>
        <article-title>Efficient methods to compute genomic predictions</article-title>
        <source>J Dairy Sci</source>
        <year>2008</year>
        <volume>91</volume>
        <fpage>4414</fpage>
        <lpage>4423</lpage>
        <pub-id pub-id-type="doi">10.3168/jds.2007-0980</pub-id>
        <pub-id pub-id-type="pmid">18946147</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>VanRaden</surname>
            <given-names>PM</given-names>
          </name>
          <name>
            <surname>Null</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Sargolzaei</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genomic imputation and evaluation using high-density Holstein genotypes</article-title>
        <source>J Dairy Sci</source>
        <year>2013</year>
        <volume>96</volume>
        <issue>1</issue>
        <fpage>668</fpage>
        <lpage>678</lpage>
        <pub-id pub-id-type="doi">10.3168/jds.2012-5702</pub-id>
        <pub-id pub-id-type="pmid">23063157</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
