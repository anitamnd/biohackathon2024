<?properties open_access?>
<?properties no_embargo?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title>Bioinformatics</journal-title>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1460-2059</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">2639009</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btn603</article-id>
    <article-id pub-id-type="publisher-id">btn603</article-id>
    <article-id pub-id-type="pmid">19015140</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group>
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SIRIUS: decomposing isotope patterns for metabolite identification<xref ref-type="author-notes" rid="FN1"><sup>†</sup></xref></article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Böcker</surname>
          <given-names>Sebastian</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Letzel</surname>
          <given-names>Matthias C.</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lipták</surname>
          <given-names>Zsuzsanna</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pervukhin</surname>
          <given-names>Anton</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="COR1">*</xref>
      </contrib>
    </contrib-group>
    <aff id="AFF1"><sup>1</sup>Lehrstuhl für Bioinformatik, Friedrich-Schiller-Universität Jena, 07743 Jena, <sup>2</sup>Organische Chemie I, Fakultät für Chemie, Universität Bielefeld, 33501 Bielefeld and <sup>3</sup>AG Genominformatik, Technische Fakultät, Universität Bielefeld, 33501 Bielefeld, Germany</aff>
    <author-notes>
      <corresp id="COR1">*To whom correspondence should be addressed.</corresp>
      <fn id="FN1">
        <p><sup>†</sup>Apreliminary version of this article appeared under the title ‘Decomposing metabolomic isotope patterns’ in the Proceedings of the 6th Workshop on Algorithms in Bioinformatics, WABI 2006, in LNCS, Vol. 4175, Springer, pp. 12–23.</p>
      </fn>
      <fn>
        <p>Associate Editor: Olga Troyanskaya</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>1</month>
      <year>2009</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>17</day>
      <month>11</month>
      <year>2008</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>17</day>
      <month>11</month>
      <year>2008</year>
    </pub-date>
    <volume>25</volume>
    <issue>2</issue>
    <fpage>218</fpage>
    <lpage>224</lpage>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>8</month>
        <year>2008</year>
      </date>
      <date date-type="rev-recd">
        <day>13</day>
        <month>11</month>
        <year>2008</year>
      </date>
      <date date-type="accepted">
        <day>14</day>
        <month>11</month>
        <year>2008</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2008 The Author(s)</copyright-statement>
      <copyright-year>2008</copyright-year>
      <license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by-nc/2.0/uk/">
        <p><!--CREATIVE COMMONS-->This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/2.0/uk/">http://creativecommons.org/licenses/by-nc/2.0/uk/</ext-link>) which permits unrestricted non-commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.</p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Motivation:</bold> High-resolution mass spectrometry (MS) is among the most widely used technologies in metabolomics. Metabolites participate in almost all cellular processes, but most metabolites still remain uncharacterized. Determination of the sum formula is a crucial step in the identification of an unknown metabolite, as it reduces its possible structures to a hopefully manageable set.</p>
      <p><bold>Results:</bold> We present a method for determining the sum formula of a metabolite solely from its mass and the natural distribution of its isotopes. Our input is a measured isotope pattern from a high resolution mass spectrometer, and we want to find those molecules that best match this pattern. Our method is computationally efficient, and results on experimental data are very promising: for orthogonal time-of-flight mass spectrometry, we correctly identify sum formulas for &gt;90% of the molecules, ranging in mass up to 1000 Da.</p>
      <p><bold>Availability:</bold> SIRIUS is available under the LGPL license at <ext-link ext-link-type="uri" xlink:href="http://bio.informatik.uni-jena.de/sirius/">http://bio.informatik.uni-jena.de/sirius/</ext-link></p>
      <p>
        <bold>Contact:</bold>
        <email>anton.pervukhin@minet.uni-jena.de</email>
      </p>
      <p><bold>Supplementary information:</bold><ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btn603/DC1">Supplementary data</ext-link> are available at <italic>Bioinformatics</italic> online.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <sec sec-type="intro" id="SEC1">
    <title>1 INTRODUCTION</title>
    <p>High-resolution mass spectrometry (MS) allows determining the mass of sample molecules with very high accuracy (1–5 p.p.m.), and has become one preferred method of analyzing metabolites. The output of a mass spectrometer, after preprocessing, consists of peaks that ideally correspond to the masses of the sample molecules and their abundance. This brings into play the natural isotopic distributions of the elements: several peaks in the output correspond to the same type of sample molecule, reflecting its isotope pattern. In this article, we use this isotope pattern to identify the sample molecule by determining its molecular formula or sum formula, i.e. the number of atoms of each element.</p>
    <p>The term “metabolite” is usually restricted to small molecules that are intermediates and products of the metabolism. These small molecules participate in almost all cellular processes such as signal transduction, stress response, catabolism, or anabolism. Today, databases mostly contain primary metabolites directly relevant for growth, development, and reproduction of a cell or an organism. In contrast, most of the metabolites not directly involved in the aforementioned functions are yet uncharacterized. The majority of known metabolites have mass &lt;1000 Da: 96.5% of sum formulas in the KEGG COMPOUND database (Kanehisa <italic>et al</italic>., <xref ref-type="bibr" rid="B8">2006</xref>) fall into this mass range. To identify a sample metabolite, its mass spectrum is compared to spectra in a reference database. This method is limited to identifying metabolites and chemical compounds that have been included in some reference mass spectra library. Hence, <italic>de novo</italic> interpretation of metabolite mass spectra is highly sought.</p>
    <p>Our input is a list of masses <italic>M</italic><sub>0</sub>,…,<italic>M<sub>K</sub></italic> with intensities <italic>f</italic><sub>0</sub>,…,<italic>f<sub>K</sub></italic>, normalized such that ∑<sub><italic>i</italic></sub><italic>f<sub>i</sub></italic> =1. We extract this data from a high-resolution mass spectrum in a preprocessing step, and assume that it corresponds to the isotope pattern of a sample molecule. Note that for molecular mixtures, separating isotopic peaks that belong to different molecules is mostly trivial in this case. Our goal is to find the molecule, or rather its sum formula, whose isotope pattern best matches the input. In the following, we use ‘molecule’ and ‘sum formula’ interchangeably. We stress that this method cannot be used as-is to identify peptides or amino acid compositions, because certain sum formulas correspond to multiple peptides.</p>
    <p>To resolve the sum formula, Kind and Fiehn (<xref ref-type="bibr" rid="B10">2006</xref>) suggest to proceed as follows: first, compute all sum formulas that share monoisotopic mass with the input mass spectrum. For every such candidate molecule, simulate its isotope pattern, and match and rank it against the input isotope pattern. Several experimental studies using this setup have been reported in the literature, the most prominent by Iijima <italic>et al</italic>. (<xref ref-type="bibr" rid="B7">2008</xref>) who claim to have discovered almost 500 novel metabolites in Tomato (<italic>Solanum lycopersicum</italic>). Zhang <italic>et al</italic>. (<xref ref-type="bibr" rid="B19">2005</xref>) address a related problem for analyzing peptides, but this approach heavily builds on several <italic>ad hoc</italic> rules regarding admissible sum formulas and uses a heuristic search. Böcker and Rasche (<xref ref-type="bibr" rid="B4">2008</xref>) present a method for the automated interpretation of metabolite tandem mass spectra but ignore isotope patterns.</p>
    <p>In this article, we present efficient algorithms for all steps of the analysis pipeline suggested above. We limit our presentation to the elements most abundant in living beings, but note that our methods also work for other sets of elements. We first show how to use integer decomposition techniques (Böcker and Lipták, <xref ref-type="bibr" rid="B3">2007</xref>) for decomposing real-valued masses, with large improvements over naïve approaches. Second, we present a method for rapid computation of isotope distributions and mean masses of isotope peaks, improving on previously best known results (Rockwood <italic>et al</italic>., <xref ref-type="bibr" rid="B15">2004</xref>). Fast simulation of isotope patterns is vital due to the large search space. Third, we show how to rapidly match and rank such simulated spectra against the measured spectrum. We then report on the application of our method to high-resolution mass spectra. Finally, we present the software tool SIRIUS (Sum formula Identification by Ranking Isotope patterns Using mass Spectrometry) that implements all of the above algorithms and combines them with an easy-to-use graphical user interface.</p>
  </sec>
  <sec id="SEC2">
    <title>2 ISOTOPES AND ISOTOPE PATTERNS</title>
    <p>The elements most abundant in living beings are hydrogen (H), carbon (C), nitrogen (N), oxygen (O), phosphor (P) and sulfur (S). Atoms with the same number of protons but different number of neutrons are called <italic>isotopes</italic> of the element. Each of these isotopes occurs in nature with a certain abundance, and we limit our attention to these naturally occurring isotopes. The superscript preceding a symbol denotes the <italic>mass number</italic> of the atom: the number of protons plus the number of neutrons. The <italic>mass</italic> of an atom is measured in Dalton (Da). An atom's mass is roughly but not exactly equal to its mass number, the difference being due to the binding energy in the atom's nucleus. The masses of the different isotopes and their abundance are known up to very high precision (Audi <italic>et al</italic>., <xref ref-type="bibr" rid="B1">2003</xref>) (see <xref ref-type="table" rid="T1">Table 1</xref> for the six elements described above). Note that unlike their mass, natural abundances of isotopes are not physical constants. Values may slightly vary depending on, say, the continent where a sample was taken.
<table-wrap id="T1" position="float"><label>Table 1.</label><caption><p>Natural isotopic distribution: relative abundance of isotopes and their masses in Dalton</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Element</th><th rowspan="1" colspan="1">Isotope</th><th rowspan="1" colspan="1">mass</th><th rowspan="1" colspan="1">Mass difference</th><th rowspan="1" colspan="1">Abundance (%)</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">Hydrogen</td><td rowspan="1" colspan="1"><sup>1</sup>H</td><td rowspan="1" colspan="1">1.007825</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">99.985</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>2</sup>H</td><td rowspan="1" colspan="1">2.014102</td><td rowspan="1" colspan="1">+1.006277</td><td rowspan="1" colspan="1">0.015</td></tr><tr><td rowspan="1" colspan="1">Carbon</td><td rowspan="1" colspan="1"><sup>12</sup>C</td><td rowspan="1" colspan="1">12.0</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">98.890</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>13</sup>C</td><td rowspan="1" colspan="1">13.003355</td><td rowspan="1" colspan="1">+1.003355</td><td rowspan="1" colspan="1">1.110</td></tr><tr><td rowspan="1" colspan="1">Nitrogen</td><td rowspan="1" colspan="1"><sup>14</sup>N</td><td rowspan="1" colspan="1">14.003074</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">99.634</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>15</sup>N</td><td rowspan="1" colspan="1">15.000109</td><td rowspan="1" colspan="1">+0.997035</td><td rowspan="1" colspan="1">0.366</td></tr><tr><td rowspan="1" colspan="1">Oxygen</td><td rowspan="1" colspan="1"><sup>16</sup>O</td><td rowspan="1" colspan="1">15.994915</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">99.762</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>17</sup>O</td><td rowspan="1" colspan="1">16.999132</td><td rowspan="1" colspan="1">+1.004217</td><td rowspan="1" colspan="1">0.038</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>18</sup>O</td><td rowspan="1" colspan="1">17.999161</td><td rowspan="1" colspan="1">+2.004246</td><td rowspan="1" colspan="1">0.200</td></tr><tr><td rowspan="1" colspan="1">Phosphor</td><td rowspan="1" colspan="1"><sup>31</sup>P</td><td rowspan="1" colspan="1">30.973762</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">100</td></tr><tr><td rowspan="1" colspan="1">Sulfur</td><td rowspan="1" colspan="1"><sup>32</sup>S</td><td rowspan="1" colspan="1">31.972071</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">95.020</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>33</sup>S</td><td rowspan="1" colspan="1">32.971459</td><td rowspan="1" colspan="1">+0.999388</td><td rowspan="1" colspan="1">0.750</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>34</sup>S</td><td rowspan="1" colspan="1">33.967867</td><td rowspan="1" colspan="1">+1.995796</td><td rowspan="1" colspan="1">4.210</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>36</sup>S</td><td rowspan="1" colspan="1">35.967081</td><td rowspan="1" colspan="1">+3.995010</td><td rowspan="1" colspan="1">0.020</td></tr></tbody></table></table-wrap></p>
    <p>The <italic>nominal mass</italic> (also called <italic>nucleon number</italic>) of a molecule is the sum of protons and neutrons of the constituting atoms. The <italic>mass</italic> of the molecule is the sum of masses of these atoms. Clearly, nominal mass and mass depend on the isotopes the molecule consists of, thus on the <italic>isotope species</italic> of the molecule. The isotope species where each atom is the isotope with the lowest nominal mass is called <italic>monoisotopic</italic>. Likewise, the mass of the monoisotopic species is called the <italic>monoisotopic mass</italic> of the molecule. Mass defects and, hence, differences from the ideal mass depend on the elemental composition of a molecule. For example, sucrose (C<sub>12</sub>H<sub>22</sub>O<sub>11</sub>) has monoisotopic mass 342.116215 Da; whereas, the short peptide Leu-Asn-Pro (C<sub>15</sub>H<sub>26</sub>N<sub>4</sub>O<sub>5</sub>) has monoisotopic mass 342.190321, while both molecules have monoisotopic nominal mass 342.</p>
    <p>The number of distinct isotope species for a molecule with <italic>i</italic><sub>H</sub> hydrogen, <italic>i</italic><sub>C</sub> carbon, <italic>i</italic><sub>N</sub> nitrogen, <italic>i</italic><sub>O</sub> oxygen, <italic>i</italic><sub>P</sub> phosphor and <italic>i</italic><sub>S</sub> sulfur atoms is <inline-formula><inline-graphic xlink:href="btn603i1.jpg"/></inline-formula>. This follows because for an element <italic>E</italic> with <italic>r</italic> isotope types, a molecule <italic>E<sub>l</sub></italic> consisting of <italic>l</italic> atoms of the element has <inline-formula><inline-graphic xlink:href="btn603i2.jpg"/></inline-formula> different isotope species. The probability that a certain isotope species occurs can be computed by multiplying the probabilities of the underlying isotopes.</p>
    <p>Even with high-resolution MS, it is often impossible to resolve isotope species with identical nominal mass. Instead, these isotope species appear as one single peak in the MS output. For this reason, we merge isotope species with identical nominal mass; we refer to the resulting distribution as the molecule's <italic>isotopic distribution</italic>.</p>
    <p>For each element <italic>E</italic> we define two discrete random variables, denoted <italic>X<sub>E</sub></italic> and <italic>Y<sub>E</sub></italic>, representing the mass and the mass number, respectively. For example, <italic>X</italic><sub>C</sub> with state space {12, 13.003355}, <italic>Y</italic><sub>C</sub> with state space {12,13} and ℙ(<italic>X</italic><sub>C</sub> = 12) = ℙ(<italic>Y</italic><sub>C</sub> = 12) = 0.98890, ℙ(<italic>X</italic><sub>C</sub> = 13.003355)=ℙ(<italic>Y</italic><sub>C</sub> = 13) = 0.01110 are the random variables of carbon. Given a molecule consisting of <italic>l</italic> atoms, we assign to the <italic>i</italic>-th atom, <italic>i</italic>=1,…,<italic>l</italic>, two random variables <italic>X<sub>i</sub></italic> and <italic>Y<sub>i</sub></italic>, where <italic>X<sub>i</sub></italic> ∼ <italic>X<sub>E</sub></italic> and <italic>Y<sub>i</sub></italic> ∼ <italic>Y<sub>E</sub></italic>, with <italic>E</italic> being the corresponding element. Now we can represent the molecule's <italic>mass distribution</italic> by the random variable <italic>X</italic> := <italic>X</italic><sub>1</sub> +…+ <italic>X<sub>l</sub></italic>, and its nominal mass distribution, or <italic>isotopic distribution</italic>, by <italic>Y</italic> := <italic>Y</italic><sub>1</sub> + … + <italic>Y<sub>l</sub></italic>. In an ideal mass spectrum, normalized peak intensities correspond to the isotopic distribution of the molecule. Note that <italic>X</italic> and <italic>Y</italic> are correlated, since <italic>X<sub>E</sub></italic> can be viewed as a function of <italic>Y<sub>E</sub></italic> and <italic>E</italic>.</p>
    <p>We refer to the peak at the monoisotopic mass as the monoisotopic peak, which is followed by the +1, +2, … peaks. What is the mass of the +k peak, which is a superposition of several isotope species? It is reasonable to assume that its mass is the mean mass of all isotope species that add to its intensity (Rockwood <italic>et al</italic>., <xref ref-type="bibr" rid="B15">2004</xref>): for a molecule with monoisotopic nominal mass <italic>N</italic>, let <italic>X</italic> = <italic>X</italic><sub>1</sub> + ··· + <italic>X<sub>l</sub></italic> be the mass distribution and <italic>Y</italic> = <italic>Y</italic><sub>1</sub> + ··· + <italic>Y<sub>l</sub></italic> be the isotopic distribution. The mean peak mass of the +k peak is then <italic>m<sub>k</sub></italic> = 𝔼(<italic>X</italic> | <italic>Y</italic>=<italic>N+k</italic>). We refer to the isotopic distribution together with the mean peak masses as the molecule's <italic>isotope pattern</italic>.</p>
  </sec>
  <sec sec-type="methods" id="SEC3">
    <title>3 METHODS AND ALGORITHMS</title>
    <sec id="SEC3.1">
      <title>3.1 Real-valued decompositions</title>
      <p>We first concentrate on the problem of decomposing the monoisotopic mass <italic>M</italic><sub>0</sub>. We want to find all molecules with monoisotopic mass in the interval [<italic>l,u</italic>] ⊆ ℝ where <italic>l</italic>:=<italic>M</italic><sub>0</sub>−ε and <italic>u</italic>:=<italic>M</italic><sub>0</sub>+ε for some measurement inaccuracy ε. Formally, we search for all solutions of the integer knapsack equation (Kellerer <italic>et al</italic>., <xref ref-type="bibr" rid="B9">2004</xref>)
<disp-formula id="M1"><label>(1)</label><graphic xlink:href="btn603m1.jpg" position="float"/></disp-formula>
where <italic>a<sub>j</sub></italic>, <italic>j</italic>=1,…,<italic>n</italic> are real-valued monoisotopic masses of elements satisfying <italic>a<sub>j</sub></italic> ≧ 0. We search for all solution vectors <italic>c</italic> = (<italic>c</italic><sub>1</sub>,…,<italic>c<sub>n</sub></italic>) such that all <italic>c<sub>j</sub></italic> are non-negative integers. We may assume <italic>a</italic><sub>1</sub> &lt; <italic>a</italic><sub>2</sub> &lt; … &lt; <italic>a<sub>n</sub></italic>.</p>
      <p>A straightforward solution is to enumerate all vectors <italic>c</italic> with <italic>c</italic><sub>1</sub>=0 and ∑<sub><italic>j</italic></sub> <italic>a<sub>j</sub> c<sub>j</sub></italic> ≤ <italic>u</italic> and next to test if there is some <italic>c</italic><sub>1</sub> ≧ 0 such that ∑<sub><italic>j</italic></sub> <italic>a<sub>j</sub> c<sub>j</sub></italic> ∈ [<italic>l,u</italic>]. This results in Θ(<italic>M</italic><sub>0</sub><sup><italic>n</italic>-1</sup>) running time, for constant element masses. Alternatively, we can compute all potential decompositions up to some upper bound <italic>U</italic> during preprocessing, sort them with respect to mass and use binary search; this results in Θ(<italic>U<sup>n</sup></italic>) space requirement. These approaches are unfavorable in theoretical complexity as well as in practice: for the elements CHNOPS there exist more than 7 × 10<sup>9</sup> molecular formulas with mass ≤1500 Da.</p>
      <p>In the remainder of this section, we transform the integer knapsack problem with real-valued coefficients into a problem instance with <italic>integer</italic> coefficients. We will show in the next section how to efficiently solve such instances. Choosing a <italic>blowup factor b</italic> ∈ ℝ, corresponding to precision 1/<italic>b</italic>, we can round coefficients by ϕ(<italic>x</italic>) := ⌈ <italic>bx</italic> ⌉, so <inline-formula><inline-graphic xlink:href="btn603i3.jpg"/></inline-formula> and <italic>l</italic>′ := ϕ(<italic>l</italic>), <italic>u</italic>′ := ϕ(<italic>u</italic>) form an integer knapsack. Precision 1/<italic>b</italic> is merely a parameter of the decomposition algorithm and in principle independent of the measurement mass accuracy ε. To avoid rounding error accumulation, precision is usually set one to two orders of magnitude smaller than the measurement accuracy. Now, certain solutions <italic>c</italic> of the integer coefficient knapsack are no solutions of the real-valued coefficient knapsack and vice versa. We can easily sort out false positive solutions by checking (1), resulting in additional running time. We now concentrate on the more intriguing problem of false negative solutions that are missed by the integer coefficient knapsack.</p>
      <p>Clearly ∑<sub><italic>j</italic></sub> <italic>a<sub>j</sub> c<sub>j</sub></italic> ≧ <italic>l</italic> implies <inline-formula><inline-graphic xlink:href="btn603i4.jpg"/></inline-formula> since all <inline-formula><inline-graphic xlink:href="btn603i5.jpg"/></inline-formula> are integers. We have to increase the upper bound <italic>u</italic>′ to guarantee that all solutions of (1) are generated. We define relative rounding errors
<disp-formula><graphic xlink:href="btn603um1.jpg" position="float"/></disp-formula>
and note that <inline-formula><inline-graphic xlink:href="btn603i6.jpg"/></inline-formula>. Let Δ = Δ(<italic>b</italic>) := max {Δ<sub><italic>j</italic></sub>}. If <italic>c</italic> satisfies ∑<sub><italic>j</italic></sub> <italic>a<sub>j</sub> c<sub>j</sub></italic> ≤ <italic>u</italic> then <inline-formula><inline-graphic xlink:href="btn603i7.jpg"/></inline-formula>: clearly, <inline-formula><inline-graphic xlink:href="btn603i8.jpg"/></inline-formula> and our claim follows from
<disp-formula><graphic xlink:href="btn603um2.jpg" position="float"/></disp-formula>
One can easily check that this bound is tight. So, we re-define the integer interval by <italic>u</italic>′ := ⌊<italic>bu</italic> + Δ <italic>u</italic> ⌋. Without rounding correction we have to decompose (<italic>u</italic>−<italic>l</italic>) <italic>b</italic> integers, but rounding correction forces us to decompose an additional Δ <italic>u</italic> integers, independent of the interval size <italic>u</italic>−<italic>l</italic>. As an example, consider the elements CHNOPS and blowup factor <italic>b</italic> = 10<sup>5</sup>, then Δ(<italic>b</italic>) = Δ<sub>H</sub> (<italic>b</italic>) = 0.492936. So for <italic>M</italic><sub>0</sub> = 1000, we have to decompose an additional 492 integers. Clearly, increasing <italic>b</italic> usually decreases Δ(<italic>b</italic>). We stress that the running time of this approach is dominated by the number of <italic>decompositions</italic> of these integers, and not by the number of integers itself.</p>
    </sec>
    <sec id="SEC3.2">
      <title>3.2 Integer decompositions</title>
      <p>Assume that both the element masses <italic>a</italic><sub>1</sub>,…,<italic>a<sub>n</sub></italic> and the query mass <italic>m</italic> are positive integers. We are looking for all non-negative integer vectors (<italic>c</italic><sub>1</sub>,…,<italic>c<sub>n</sub></italic>) satisfying (1) (with <italic>l</italic> = <italic>u</italic> = <italic>m</italic>). This is a well-studied problem, referred to in its different variants as Coin Change Problem, Change Making Problem or Money Changing Problem, and can be solved with a simple dynamic programming algorithm in pseudo-polynomial time (Martello and Toth, <xref ref-type="bibr" rid="B13">1990</xref>). The main disadvantage of this approach is rather large memory requirement, which again depends on the maximal mass <italic>U</italic> we want to decompose.</p>
      <p>Böcker and Lipták (<xref ref-type="bibr" rid="B3">2007</xref>) present an algorithm for determining all such decompositions with running time <italic>O</italic>(<italic>na</italic><sub>1</sub> · γ(<italic>m</italic>)) and space <italic>O</italic>(<italic>na</italic><sub>1</sub>), where <italic>a</italic><sub>1</sub> is the smallest mass and γ(<italic>m</italic>) the number of decompositions of mass <italic>m</italic>. We briefly sketch the algorithm. Given integer masses <italic>a</italic><sub>1</sub> ≤ … ≤ <italic>a<sub>n</sub></italic>, a data structure of size <italic>na</italic><sub>1</sub>, referred to as <italic>Extended Residue Table</italic> (ER table), is computed in a preprocessing step. Entry ER(<italic>r,i</italic>), for <italic>r</italic>=0,…, <italic>a</italic><sub>1</sub>−1 and <italic>i</italic>=1,…,<italic>n</italic>, is the smallest number congruent <italic>r</italic> modulo <italic>a</italic><sub>1</sub> which is decomposable over <italic>a</italic><sub>1</sub>,…,<italic>a<sub>i</sub></italic>. Thus, the last column ER(·,<italic>n</italic>) of the table gives, for each residue <italic>r</italic>, the smallest number congruent <italic>r</italic> modulo <italic>a</italic><sub>1</sub> that is decomposable over <italic>a</italic><sub>1</sub>,…,<italic>a<sub>n</sub></italic>. Computation time is <italic>O</italic>(<italic>na</italic><sub>1</sub>). All decompositions of the query <italic>m</italic> are then recursively generated, limiting the number of unsuccessful paths by using information from the ER table. As a result, the running time of the algorithm is proportional only to the size of the table <italic>na</italic><sub>1</sub> and the number of decompositions γ(<italic>m</italic>), and does not depend directly on the input <italic>m</italic>. For decomposing molecule masses, this decomposition technique has several advantages over classical dynamic programming, such as improved running times and preprocessing independent of the largest mass we want to decompose in the future. Regarding the application of decomposing molecule masses, this approach uses only one fifteenth of memory and shows better running times.</p>
      <p>The number of decompositions γ(<italic>m</italic>) for an integer mass <italic>m</italic> over coprime integers <italic>a</italic><sub>1</sub>,…,<italic>a<sub>n</sub></italic> asymptotically behaves like a polynomial of degree <italic>n</italic>−1 in <italic>m</italic> (Wilf, <xref ref-type="bibr" rid="B17">1990</xref>). Following Beck <italic>et al</italic>. (<xref ref-type="bibr" rid="B2">2001</xref>), we can approximate the number of molecules over the elements CHNOPS with <italic>real mass</italic> in the interval [<italic>M,M</italic>+ϵ] by
<disp-formula id="M2"><label>(2)</label><graphic xlink:href="btn603m2.jpg" position="float"/></disp-formula>
We can also approximate the number of molecules with mass <italic>up to M</italic> by integrating (2). In <xref ref-type="fig" rid="F1">Figure 1</xref>, we plot the number of decompositions for masses of up to 1500 Da over the elements CHNOPS.
<fig id="F1" position="float"><label>Fig. 1.</label><caption><p>Number of decompositions over the elements CHNOPS for intervals of width 0.001 Da. Minima and maxima taken in intervals of width 1 Da. True number of decompositions in comparison with approximate (2) (approx). As is shown in the inlay, γ(<italic>m</italic>) varies with a periodic function of period ∼1 Da.</p></caption><graphic xlink:href="btn603f1"/></fig></p>
    </sec>
    <sec id="SEC3.3">
      <title>3.3 Simulating isotope patterns</title>
      <p>We first observe that for elements CHNOPS, all molecules have isotopic distributions that decrease rapidly with increasing mass. In particular, we can restrict ourselves to computing the first <italic>K</italic> non-zero values of the distribution, for rather small <italic>K</italic> such as <italic>K</italic>=10. For example, amongst 11 479 entries in the KEGG COMPOUND database with mass ≤3000 Da, no molecule has intensity of the +10 peak larger than 0.00007.</p>
      <p>The atoms hydrogen, carbon and nitrogen have only two natural isotopes. Thus, the isotopic distribution of a molecule <italic>E<sub>l</sub></italic> consisting of <italic>l</italic> identical atoms of type <italic>E</italic> with <italic>E</italic> ∈ {H,C,N} follows a binomial distribution: let <italic>q<sub>k</sub></italic> denote the probability that <italic>E<sub>l</sub></italic> has nominal mass <italic>N</italic>+<italic>k</italic>, where <italic>N</italic> is the monoisotopic nominal mass of <italic>E<sub>l</sub></italic>. Then, <inline-formula><inline-graphic xlink:href="btn603i9.jpg"/></inline-formula>, where <italic>p</italic> is the probability of the monoisotopic isotope. The values of the <italic>q<sub>k</sub></italic> can be computed iteratively, since <inline-formula><inline-graphic xlink:href="btn603i10.jpg"/></inline-formula> for <italic>k</italic>≧ 0, thus computation time is <italic>O</italic>(<italic>K</italic>).</p>
      <p>Where an element <italic>E</italic> has <italic>r</italic>&gt;2 isotopes (such as oxygen and sulfur), the isotopic distribution of <italic>E<sub>l</sub></italic> can in theory be computed as follows: let <italic>p<sub>i</sub></italic> for <italic>i</italic>=0,…,<italic>r</italic>−1 denote the probability of occurrence of the <italic>i</italic>-th isotope. Then, the probability that <italic>E<sub>l</sub></italic> has nominal mass <italic>N</italic>+<italic>k</italic> is <inline-formula><inline-graphic xlink:href="btn603i11.jpg"/></inline-formula>, where the sum runs over all <italic>l</italic><sub>0</sub>,…,<italic>l</italic><sub><italic>r</italic>−1</sub> ≧ 0 satisfying <inline-formula><inline-graphic xlink:href="btn603i12.jpg"/></inline-formula> and <inline-formula><inline-graphic xlink:href="btn603i13.jpg"/></inline-formula> <inline-formula><inline-graphic xlink:href="btn603i14.jpg"/></inline-formula> (Hsu, <xref ref-type="bibr" rid="B6">1984</xref>). However, this computation is infeasible in practice.</p>
      <p>Given two discrete random variables <italic>Y</italic> and <italic>Y</italic>′ with state spaces Ω,Ω′ ⊆ ℕ, we can compute the distribution of the random variable <italic>Z</italic> := <italic>Y</italic>+<italic>Y</italic>′ by folding the distributions,
<disp-formula><graphic xlink:href="btn603um3.jpg" position="float"/></disp-formula>
If we restrict ourselves to the first <italic>K</italic> values of this distribution, we can compute it in time <italic>O</italic>(<italic>K</italic><sup>2</sup>). Kubinyi (<xref ref-type="bibr" rid="B12">1991</xref>) suggests to compute the isotopic distributions of oxygen O<sub><italic>l</italic></sub> and sulfur S<sub><italic>l</italic></sub> by successive folding of the respective distribution: using a Russian multiplication scheme for the folding, this results in an algorithm with running time <italic>O</italic>(<italic>K</italic><sup>2</sup> log <italic>l</italic>). In applications, we do not compute these distributions on the fly but during preprocessing, for all <italic>l</italic>≤<italic>L</italic> fixed. This results in <italic>O</italic>(<italic>KL</italic>) memory for every such element, where <italic>l</italic> is small: The 128 oxygen atoms already have mass of about 2048 Da, exceeding the relevant mass range. For molecules consisting of different elements, we first compute or look up the isotopic distributions of the individual elements, and then combine these distributions by folding in <italic>O</italic>(<italic>n</italic> · K<sup>2</sup>) time.</p>
      <p>Using Fourier transforms of isotope distributions, we can multiply Fourier transforms instead of folding these distributions (Rockwood and Van Orden, <xref ref-type="bibr" rid="B14">1996</xref>). Doing so we can eventually replace the <italic>K</italic><sup>2</sup> factor in the algorithm's running time by a <italic>K</italic>log<italic>K</italic> factor. As we limit our attention to small <italic>K</italic> such as <italic>K</italic>=10, this will not result in a speedup of the algorithm in practice. Also, this approach may face the problem of numerical errors.</p>
      <p>We now come to the more challenging problem of efficiently computing the mean peak masses of a distribution. Doing so using the definition <italic>m<sub>k</sub></italic> =𝔼(<italic>X</italic> | <italic>Y</italic>=<italic>N</italic>+<italic>k</italic>) is highly inefficient, because we have to sum up over all isotope species. Pruning strategies have been developed to speed up computation (Yergey, <xref ref-type="bibr" rid="B18">1983</xref>), but pruning leads to a loss of accuracy (Rockwood <italic>et al</italic>., <xref ref-type="bibr" rid="B15">2004</xref>). We now present a simple recurrence for computing these masses analogous to the folding of distributions: let <italic>Y</italic> = Y<sub>1</sub> + ··· + <italic>Y<sub>l</sub></italic> and <inline-formula><inline-graphic xlink:href="btn603i15.jpg"/></inline-formula> be isotopic distributions of two molecules with monoisotopic nominal masses <italic>N</italic> and <italic>N</italic>′, respectively. Let <italic>p<sub>k</sub></italic> := ℙ(<italic>Y</italic> = <italic>N</italic>+<italic>k</italic>) and <italic>q<sub>k</sub></italic> := ℙ(<italic>Y</italic>′ = <italic>N</italic>′′<italic>k</italic>) denote the corresponding probabilities, <italic>m<sub>k</sub></italic> and <inline-formula><inline-graphic xlink:href="btn603i16.jpg"/></inline-formula> the mean peak masses of the +k peaks. Consider the random variable <italic>Z</italic> = <italic>Y</italic> + <italic>Y</italic>′ with monoisotopic nominal mass Ñ = <italic>N</italic>+<italic>N</italic>′.</p>
      <statement>
        <title>T<sc>heorem</sc> 1.</title>
        <p>
          <italic>The mean peak mass <inline-formula><inline-graphic xlink:href="btn603i17.jpg"/></inline-formula> of the +k peak of the random variable <italic>Z</italic> = <italic>Y</italic> + <italic>Y</italic>′ can be computed as:</italic>
          <disp-formula id="M3">
            <label>(3)</label>
            <graphic xlink:href="btn603m3.jpg" position="float"/>
          </disp-formula>
        </p>
      </statement>
      <p>Note that <inline-formula><inline-graphic xlink:href="btn603i18.jpg"/></inline-formula>. Since by independence, ℙ(<italic>Y</italic><sub>1</sub>=<italic>N</italic><sub>1</sub>,…,<italic>Y<sub>l</sub></italic>=<italic>N<sub>l</sub></italic>) = ∏<sub><italic>i</italic></sub> ℙ(<italic>Y<sub>i</sub></italic>=<italic>N<sub>i</sub></italic>), the theorem follows by rearranging summands. We omit the formal proof.</p>
      <p>The theorem allows us to ‘fold’ mean peak masses of two distributions to compute the mean peak masses of their sum. This implies that we can compute mean peak masses as efficiently as the distribution itself. This improves on the previously best known method (Rockwood <italic>et al</italic>., <xref ref-type="bibr" rid="B15">2004</xref>), replacing the linear running time dependence on the number of atoms by its logarithm.</p>
    </sec>
    <sec id="SEC3.4">
      <title>3.4 Scoring candidate molecules</title>
      <p>We want to discriminate between (tens of thousands of) candidate molecules generated by decomposing the monoisotopic mass. To this end, we compare the simulated isotopic distribution with the measured peaks. Matching peak pairs between the spectra is trivial for this application.</p>
      <p>Zhang and Chait (<xref ref-type="bibr" rid="B21">2000</xref>) and Zhang <italic>et al</italic>. (<xref ref-type="bibr" rid="B20">2002</xref>) suggest to use Bayesian Statistics to evaluate mass spectra matches:
<disp-formula id="M4"><label>(4)</label><graphic xlink:href="btn603m4.jpg" position="float"/></disp-formula>
where 𝒟 is the data (the measured spectrum), ℳ<sub><italic>i</italic></sub> are the models (the candidate molecules) and ℬ stands for any prior background information.</p>
      <p>Regarding this background information, we set the prior probability ℙ(ℳ<sub><italic>j</italic></sub> | ℬ) to zero for all molecules but the decompositions of the monoisotopic mass. We also assign prior probability zero to molecular formulas that cannot correspond to a molecule, because of chemical considerations: Senior's third theorem states that the sum of valences has to be greater than or equal to twice the number of atoms minus one (Senior, <xref ref-type="bibr" rid="B16">1951</xref>). Molecules violating Seniors third theorem are rare, particularly for natural compounds: in the KEGG COMPOUND database, &lt;0.16% of substances violate this rule. We also filter out radicals with odd sum of valences. We refrain from using further priors such as the hetero-to-carbon ratio (Kind and Fiehn, <xref ref-type="bibr" rid="B11">2007</xref>) because this might rather reproduce what is already known.</p>
      <p>Next, we assign probabilities to the observed masses and intensities. Assuming independence (in particular from background information) we calculate
<disp-formula id="M5"><label>(5)</label><graphic xlink:href="btn603m5.jpg" position="float"/></disp-formula>
Here, ℙ(<italic>M<sub>j</sub></italic>|<italic>m<sub>j</sub></italic>) is the probability to observe peak <italic>j</italic> at mass <italic>M<sub>j</sub></italic> when its true mass is <italic>m<sub>j</sub></italic>, and ℙ(<italic>f<sub>j</sub></italic>|<italic>p<sub>j</sub></italic>) is the probability to observe peak <italic>j</italic> with intensity <italic>f<sub>j</sub></italic> when its true intensity is <italic>p<sub>j</sub></italic>. Clearly, the independence of peak intensities is violated because these intensities sum to one, but this product can be seen as a rough estimate of the true probability.</p>
      <p>Mass spectrometrists assume that the mass error of a device is roughly normally distributed with mean zero. If the mass accuracy α of the measurement (in p.p.m.) is given, then we can set the standard deviation <inline-formula><inline-graphic xlink:href="btn603i19.jpg"/></inline-formula> for peak <italic>j</italic>, assuming that &gt;99.7% of measurements fall into the specified mass range. But we also observe that peaks of low intensity show less mass accuracy than those with high intensity, which can be attributed to the difficulties of separating a peak of low intensity from the background noise. Our data indicate a roughly linear dependence between peak intensity and mass accuracy. To this end, two mass accuracies α<sub>1</sub> (at full intensity) and α<sub>0</sub> (at minimal intensity) are provided by the user, and we set
<disp-formula><graphic xlink:href="btn603um4.jpg" position="float"/></disp-formula>
We want to estimate the probability that, given a peak with true mass <italic>M<sub>j</sub></italic>, a peak at mass <italic>M<sub>j</sub></italic> is observed in the measured spectrum: more precisely, the probability of observing a mass difference of |<italic>M<sub>j</sub></italic>−<italic>m<sub>j</sub></italic>| or larger. We can compute this probability using the complementary error function ‘erfc’:
<disp-formula id="M6"><label>(6)</label><graphic xlink:href="btn603m6.jpg" position="float"/></disp-formula>
with <inline-formula><inline-graphic xlink:href="btn603i20.jpg"/></inline-formula>.</p>
      <p>Even for high-resolution MS, spectra show a systematic mass shift due to calibration inaccuracies. We can easily eliminate this shift for all masses but the monoisotopic mass: we do not compare masses of the +1, … peaks directly but instead the difference to the monoisotopic peak, <italic>M<sub>j</sub></italic> − <italic>M<sub>0</sub></italic> versus <italic>m<sub>j</sub></italic> − <italic>m</italic><sub>0</sub> for <italic>j</italic> ≧ 1.</p>
      <p>Regarding peak intensities, we have to cope with a systematic error in the measured spectra: we observe in our data that peaks of low intensity are under-estimated in the measured spectrum, whereas peaks of high intensity are over-estimated, (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btn603/DC1">Supplementary Fig. 1</ext-link>). We ascribe this problem to inaccurate peak intensity determination: vendor software estimates peak intensities as signal-to-noise ratio or height above some baseline. The baseline, in turn, is determined using several <italic>ad hoc</italic> rules, and its estimate can be inaccurate. Unfortunately, such inaccuracies have unequal effects on peaks of different intensities. We correct this error by adding some user-defined parameter <italic>off</italic> to the measured intensities <italic>f<sub>i</sub></italic>, and by subsequent re-normalization. We found that for both of our datasets, the same parameter <italic>off</italic> = +0.02 leads to excellent results.</p>
      <p>Computation of ℙ(<italic>f<sub>j</sub></italic>|<italic>p<sub>j</sub></italic>) is done analogously to that of ℙ(<italic>M<sub>j</sub></italic>|<italic>m<sub>j</sub></italic>). Our data indicates that after correction, log ratios between measured and predicted peak intensity log (<italic>f<sub>j</sub></italic>/<italic>p<sub>j</sub></italic>) roughly follow a normal distribution. Again, precision parameters β<sub>1</sub> (at full intensity) and β<sub>0</sub> (at minimal intensity) are provided by the user (in percent). We compute
<disp-formula><graphic xlink:href="btn603um5.jpg" position="float"/></disp-formula>
as our precision interval, such that &gt;99.7% of log intensity ratios log (<italic>f<sub>j</sub></italic>/<italic>p<sub>j</sub></italic>) fall into the range <inline-formula><inline-graphic xlink:href="btn603i21.jpg"/></inline-formula>. Now, ℙ(<italic>f<sub>j</sub></italic>|<italic>p<sub>j</sub></italic>) can be estimated analogously to (6).</p>
    </sec>
  </sec>
  <sec sec-type="results" id="SEC4">
    <title>4 EXPERIMENTAL RESULTS</title>
    <sec id="SEC4.1">
      <title>4.1 Datasets</title>
      <p>To evaluate our method we used two datasets measured on two instruments. Mass spectra with single charge were measured from several organic (macro)molecules, composed of the elements CHNOPS. For every such spectrum, the sum formula of the sample molecule is known. The spectra were acquired over a period of 2 years; the molecules range in mass from 117 Da to ∼1000 Da. Peak detection and estimation of peak masses and intensities were conducted using vendor software.</p>
      <p>The first dataset consists of 153 mass spectra. Electrospray ionization (ESI) experiments were performed using the Fourier Transform Ion Cyclotron Resonance (FT-ICR) mass spectrometer APEX III (Bruker Daltonik GmbH, Bremen, Germany). The FT-MS was equipped with a 7.0 T, 160 mm bore superconducting magnet, infinity cell and interfaced to an external (nano)ESI ion source. All mass spectra were externally mass calibrated. The five analysis parameters were chosen as α<sub>1</sub> = 3, α<sub>0</sub> = 6, β<sub>1</sub> = 10, β<sub>0</sub> = 90 and <italic>off</italic> = +0.02.</p>
      <p>The second dataset consists of 86 mass spectra. ESI experiments were performed using the oa-TOF mass spectrometer MicrOTOF (Bruker Daltonik GmbH, Bremen, Germany). Quasi-internal mass calibration was used, by measurement of an infused calibrant prior to the compound of interest. For the oa-TOF analysis, we set α<sub>1</sub> = 5, α<sub>0</sub> = 6.5, β<sub>1</sub> = 10, β<sub>0</sub> = 90 and again <italic>off</italic> = +0.02.</p>
    </sec>
    <sec id="SEC4.2">
      <title>4.2 Identification accuracy</title>
      <p>Every input ‘mass spectrum’ consists of masses <italic>M</italic><sub>0</sub>,…,<italic>M<sub>k</sub></italic> and intensities <italic>f</italic><sub>0</sub>,…,<italic>f<sub>k</sub></italic>. For every such spectrum, we computed all molecules such that the monoisotopic mass <italic>M</italic><sub>0</sub> has relative mass difference of at most α<sub>1</sub> p.p.m. Next, we discarded molecules violating Senior's third theorem and radicals with odd sum of valences. For each remaining molecule, we computed its theoretical isotopic distribution (with <italic>K</italic>=10) and compared it to the measured isotopic distribution. We ranked the molecules according to resulting probabilities. We did not use any other background information to identify the molecule.</p>
      <p>For the 153 mass spectra in our FT-ICR dataset, 89 resulted in a correct identification; in 86% of the mass spectra, the correct interpretation was found in the TOP 10 explanations. There is a clear correlation between mass and identification accuracy, confer <xref ref-type="table" rid="T2">Table 2</xref>. For mass spectra ≤700 Da, the true interpretation was always found in the TOP 10 explanations, except in one case where it had rank 13. For 86 mass spectra in the oa-TOF dataset, the correct sum formula was found in the TOP 10 interpretations in all but two cases. Moreover, 79 out of 86 compounds were correctly identified, which correspond to an identification rate of &gt;90%, (<xref ref-type="table" rid="T2">Table 2</xref>). Better identification results on the oa-TOF dataset with lower mass accuracy show the crucial importance of including intensity measurements into the candidate evaluation. We note that the intensity accuracy of the oa-TOF instrument is significantly higher than that of the FT-ICR. We have also tested the variation of identification rates with different scoring parameters: identification results are relatively stable for small disturbances of parameter values, see <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btn603/DC1">supplementary material</ext-link>. Parameter estimation could be automated using a small training set. We are planning to include this feature in future implementations.
<table-wrap id="T2" position="float"><label>Table 2.</label><caption><p>Number of correct sum formulas at certain positions of the output list, for the FT-ICR dataset and the oa-TOF dataset</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Mass range</th><th rowspan="1" colspan="1">No. sp.</th><th colspan="5" rowspan="1">Rank in output list<hr/></th><th colspan="3" rowspan="1">No. sum formulas<hr/></th><th rowspan="1" colspan="1"/></tr><tr><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1">1</th><th rowspan="1" colspan="1">2</th><th rowspan="1" colspan="1">3–5</th><th rowspan="1" colspan="1">6–10</th><th rowspan="1" colspan="1">11+</th><th rowspan="1" colspan="1">Int.</th><th rowspan="1" colspan="1">Real</th><th rowspan="1" colspan="1">Chem.</th><th rowspan="1" colspan="1">Time</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">FT-ICR dataset</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/></tr><tr><td rowspan="1" colspan="1">200–300</td><td rowspan="1" colspan="1">13</td><td rowspan="1" colspan="1">11</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">67</td><td rowspan="1" colspan="1">37.2</td><td rowspan="1" colspan="1">8.6</td><td rowspan="1" colspan="1">1.5</td></tr><tr><td rowspan="1" colspan="1">300–400</td><td rowspan="1" colspan="1">37</td><td rowspan="1" colspan="1">28</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">200</td><td rowspan="1" colspan="1">109</td><td rowspan="1" colspan="1">10.4</td><td rowspan="1" colspan="1">4.3</td></tr><tr><td rowspan="1" colspan="1">400–500</td><td rowspan="1" colspan="1">57</td><td rowspan="1" colspan="1">39</td><td rowspan="1" colspan="1">6</td><td rowspan="1" colspan="1">6</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">579.5</td><td rowspan="1" colspan="1">318.2</td><td rowspan="1" colspan="1">22.8</td><td rowspan="1" colspan="1">13.5</td></tr><tr><td rowspan="1" colspan="1">500–600</td><td rowspan="1" colspan="1">7</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1800.4</td><td rowspan="1" colspan="1">990.3</td><td rowspan="1" colspan="1">59.6</td><td rowspan="1" colspan="1">40.1</td></tr><tr><td rowspan="1" colspan="1">600–700</td><td rowspan="1" colspan="1">4</td><td rowspan="1" colspan="1">3</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">2668.5</td><td rowspan="1" colspan="1">1454</td><td rowspan="1" colspan="1">37.3</td><td rowspan="1" colspan="1">55</td></tr><tr><td rowspan="1" colspan="1">700–800</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">8797.8</td><td rowspan="1" colspan="1">4812</td><td rowspan="1" colspan="1">247</td><td rowspan="1" colspan="1">232</td></tr><tr><td rowspan="1" colspan="1">800–900</td><td rowspan="1" colspan="1">14</td><td rowspan="1" colspan="1">3</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">3</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">14781.6</td><td rowspan="1" colspan="1">8101</td><td rowspan="1" colspan="1">534.6</td><td rowspan="1" colspan="1">485</td></tr><tr><td rowspan="1" colspan="1">900–1000</td><td rowspan="1" colspan="1">16</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">13</td><td rowspan="1" colspan="1">31805.7</td><td rowspan="1" colspan="1">17448</td><td rowspan="1" colspan="1">1570</td><td rowspan="1" colspan="1">1281</td></tr></tbody></table><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Mass range</th><th rowspan="1" colspan="1">No. sp.</th><th colspan="3" rowspan="1">Rank<hr/></th><th colspan="3" rowspan="1">No. sum formulas<hr/></th><th rowspan="1" colspan="1"/></tr><tr><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1">1</th><th rowspan="1" colspan="1">2–6</th><th rowspan="1" colspan="1">11+</th><th rowspan="1" colspan="1">Int.</th><th rowspan="1" colspan="1">Real</th><th rowspan="1" colspan="1">Chem.</th><th rowspan="1" colspan="1">Time</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">oa- TOF dataset</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/></tr><tr><td rowspan="1" colspan="1">100–200</td><td rowspan="1" colspan="1">7</td><td rowspan="1" colspan="1">7</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">11.3</td><td rowspan="1" colspan="1">7.4</td><td rowspan="1" colspan="1">1.9</td><td rowspan="1" colspan="1">0</td></tr><tr><td rowspan="1" colspan="1">200–300</td><td rowspan="1" colspan="1">21</td><td rowspan="1" colspan="1">21</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">60.1</td><td rowspan="1" colspan="1">40.1</td><td rowspan="1" colspan="1">4.6</td><td rowspan="1" colspan="1">1.4</td></tr><tr><td rowspan="1" colspan="1">300–400</td><td rowspan="1" colspan="1">27</td><td rowspan="1" colspan="1">26</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">297.8</td><td rowspan="1" colspan="1">199.7</td><td rowspan="1" colspan="1">22.6</td><td rowspan="1" colspan="1">8.1</td></tr><tr><td rowspan="1" colspan="1">400–500</td><td rowspan="1" colspan="1">15</td><td rowspan="1" colspan="1">14</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">725.6</td><td rowspan="1" colspan="1">484.1</td><td rowspan="1" colspan="1">32.4</td><td rowspan="1" colspan="1">17.3</td></tr><tr><td rowspan="1" colspan="1">500–600</td><td rowspan="1" colspan="1">10</td><td rowspan="1" colspan="1">7</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1479.1</td><td rowspan="1" colspan="1">988.9</td><td rowspan="1" colspan="1">54.3</td><td rowspan="1" colspan="1">36</td></tr><tr><td rowspan="1" colspan="1">600–700</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">4600</td><td rowspan="1" colspan="1">3080</td><td rowspan="1" colspan="1">276</td><td rowspan="1" colspan="1">130</td></tr><tr><td rowspan="1" colspan="1">700–800</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">10336</td><td rowspan="1" colspan="1">6909</td><td rowspan="1" colspan="1">578</td><td rowspan="1" colspan="1">461</td></tr><tr><td rowspan="1" colspan="1">800–900</td><td rowspan="1" colspan="1">3</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">18172.3</td><td rowspan="1" colspan="1">12146</td><td rowspan="1" colspan="1">914.3</td><td rowspan="1" colspan="1">757</td></tr></tbody></table><table-wrap-foot><fn><p>We report the number of spectra in this mass range (no. sp.), as well as the average number of sum formulas over all molecules in the mass range (no. sum formulas). We distinguish between the number of integer decompositions (int.), the number of real decompositions (real) and the number of those sum formulas that pass Senior's third theorem (chem.). Finally, we give the average running time in milliseconds per spectrum (time).</p></fn></table-wrap-foot></table-wrap></p>
    </sec>
    <sec id="SEC4.3">
      <title>4.3 Running times</title>
      <p>We analyzed all 239 mass spectra on a Pentium M 1.5 GHz processor with blowup <italic>b</italic> = 5 × 10<sup>4</sup>, using only a few Megabyte of memory. This results in running times of &lt;1.3s per spectrum for the complete analysis of one mass spectrum. Clearly, running times depend on molecule masses, see again <xref ref-type="table" rid="T2">Table 2</xref>. Increasing the blowup beyond 5 × 10<sup>4</sup> increased running times, presumably because the smaller table can be kept in the processor cache.</p>
    </sec>
  </sec>
  <sec id="SEC5">
    <title>5 IMPLEMENTATION</title>
    <p>We have developed a java-based graphical tool called SIRIUS. At the SIRIUS core lie efficient algorithms for generating all elemental compositions for a given mass and error, calculating isotope patterns for all chemically relevant compositions, and matching and ranking the candidate molecules against the input spectrum. SIRIUS combines these algorithms with a powerful graphical user interface. An extensive management system allows simplified data handling and offers an easy way to integrate new algorithms and data structures into the framework. Through a user-friendly interface, SIRIUS allows the user to import datasets in most common mass spectrometry file formats. It supports automatic recognition of molecular ion adducts present in the input spectrum, handy visualization of identified sum formulas and their isotope patterns and customizable export of identification results to common human-readable file formats. Finally, the software provides a basic functionality to search for sum formulas identified by the algorithm in NCBI PubChem Database.<xref ref-type="fn" rid="FN2"><sup>1</sup></xref></p>
    <p>Preparation of a new analysis run can be divided into the following steps: initializing input data and instrument parameters, setting up algorithm parameters and extracting isotope patterns from the input peaklist. Input peaklist and machine settings can be reused for multiple analyses on the same data. SIRIUS provides the user with reasonable default values for algorithm parameters. The program also offers to save all algorithm and mass spectrometer settings. To this end, SIRIUS creates a persistent workspace that can be used to store local settings and to automatically reload them on request.</p>
    <p>We use the ProteomeCommons.org IO Framework (Falkner <italic>et al</italic>., <xref ref-type="bibr" rid="B5">2007</xref>) to import mass spectrometry data, which allows reading most MS data formats including mzData and mzXML. We parse the peaklist and divide it into signal groups related to different compounds. A peaklist can also contain several signal groups belonging to the same compound, modified by different molecular ion adducts. Identifying modifications is done by calculating mass differences between monoisotopic peak masses. In view of the small number of adducts, we apply a simple exhaustive search to find all matching mass differences. If there is no prior knowledge on the source of modification, the user can choose one or more adduct types for an isotope pattern.</p>
    <p>The output of the algorithm is a list of candidate sum formulas for each compound. Sum formulas are listed in the summary table, sorted in decreasing order of likelihoods. To view an entry in more detail, the user can select and compare theoretical and measured isotope patterns visually, (<xref ref-type="fig" rid="F2">Fig. 2</xref>). Analysis results can be exported to the application workspace and opened for further evaluation. Export file formats include plain text, PDF and XML documents.
<fig id="F2" position="float"><label>Fig. 2.</label><caption><p>Screenshot of the SIRIUS software, available from <ext-link ext-link-type="uri" xlink:href="http://bio.informatik.uni-jena.de/sirius">http://bio.informatik.uni-jena.de/sirius</ext-link>.</p></caption><graphic xlink:href="btn603f2"/></fig></p>
  </sec>
  <sec sec-type="conclusions" id="SEC6">
    <title>6 CONCLUSION</title>
    <p>We presented an approach to determine the sum formula of an unknown metabolite solely from its high-resolution isotope pattern. Our approach allows us to reduce the number of potential sum formulas to only a few candidates; in many cases we were able to determine the correct molecular formula. The approach is time- and memory-efficient and can be executed on a regular desktop PC. We further presented methods for the efficient simulation of isotope patterns. This is vital for larger molecules where the search space increases rapidly.</p>
    <p>Results on experimental data clearly show the potential of our approach, in particular for oa-TOF data. In our evaluation, we have deliberately ignored some information such as prior probability of the elements or hetero-to-carbon ratio (Kind and Fiehn, <xref ref-type="bibr" rid="B11">2007</xref>). We believe that such information should rather be used in a ‘post-processing’ step by an expert, instead of automatically filtering out certain sum formulas a priori. Finally, we introduced a user-friendly software called SIRIUS, which implements all of the methods presented.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>[Supplementary Data]</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="btn603_index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="btn603_1.pdf"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="x-zip-compressed" xlink:href="btn603_bioinf-2008-1396-File009.gz"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>ACKNOWLEDGEMENTS</title>
    <p>Additional programming by Martin Engler. We thank Dr H. Luftmann, Universität Münster, Organisch-Chemisches Institut, for making available the oa-TOF dataset and an anonymous referee for helpful comments.</p>
    <p><italic>Funding</italic>: Deutsche Forschungsgemeinschaft (BO 1910/1 to A.P.); Alexander von Humboldt Foundation and the Bundesministerium für Bildung und Forschung, within the group ‘Combinatorial Search Algorithms in Bioinformatics’ (to Z.L.).</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </ack>
  <fn-group>
    <fn id="FN2">
      <p>
        <sup>1</sup>
        <ext-link ext-link-type="uri" xlink:href="http://pubchem.ncbi.nlm.nih.gov/">http://pubchem.ncbi.nlm.nih.gov/</ext-link>
      </p>
    </fn>
  </fn-group>
  <ref-list>
    <title>REFERENCES</title>
    <ref id="B1">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Audi</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The AME2003 atomic mass evaluation (ii): Tables, graphs, and references.</article-title>
        <source>Nucl. Phys. A</source>
        <year>2003</year>
        <volume>729</volume>
        <fpage>129</fpage>
        <lpage>336</lpage>
      </citation>
    </ref>
    <ref id="B2">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Beck</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The polynomial part of a restricted partition function related to the frobenius problem.</article-title>
        <source>Electron. J. Comb</source>
        <year>2001</year>
        <volume>8</volume>
        <fpage>N7</fpage>
      </citation>
    </ref>
    <ref id="B3">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Böcker</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lipták</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>A fast and simple algorithm for the Money Changing Problem.</article-title>
        <source>Algorithmica</source>
        <year>2007</year>
        <volume>48</volume>
        <fpage>413</fpage>
        <lpage>432</lpage>
      </citation>
    </ref>
    <ref id="B4">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Böcker</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Rasche</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Towards de novo identification of metabolites by analyzing tandem mass spectra.</article-title>
        <source>Bioinformatics</source>
        <year>2008</year>
        <volume>24</volume>
        <fpage>I49</fpage>
        <lpage>I55</lpage>
        <pub-id pub-id-type="pmid">18689839</pub-id>
      </citation>
    </ref>
    <ref id="B5">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Falkner</surname>
            <given-names>JA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Proteomecommons.org io framework: reading and writing multiple proteomics data formats.</article-title>
        <source>Bioinformatics</source>
        <year>2007</year>
        <volume>23</volume>
        <fpage>262</fpage>
        <lpage>263</lpage>
        <pub-id pub-id-type="pmid">17121776</pub-id>
      </citation>
    </ref>
    <ref id="B6">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hsu</surname>
            <given-names>CS</given-names>
          </name>
        </person-group>
        <article-title>Diophantine approach to isotopic abundance calculations.</article-title>
        <source>Anal. Chem.</source>
        <year>1984</year>
        <volume>56</volume>
        <fpage>1356</fpage>
        <lpage>1361</lpage>
      </citation>
    </ref>
    <ref id="B7">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Iijima</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metabolite annotations based on the integration of mass spectral information.</article-title>
        <source>Plant J.</source>
        <year>2008</year>
        <volume>54</volume>
        <fpage>949</fpage>
        <lpage>962</lpage>
        <pub-id pub-id-type="pmid">18266924</pub-id>
      </citation>
    </ref>
    <ref id="B8">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kanehisa</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>From genomics to chemical genomics: new developments in KEGG.</article-title>
        <source>Nucl. Acids Res.</source>
        <year>2006</year>
        <volume>34</volume>
        <fpage>D354</fpage>
        <lpage>D357</lpage>
        <pub-id pub-id-type="pmid">16381885</pub-id>
      </citation>
    </ref>
    <ref id="B9">
      <citation citation-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Kellerer</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Knapsack Problems.</source>
        <year>2004</year>
        <publisher-loc>Berlin, Heidelberg</publisher-loc>
        <publisher-name>Springer</publisher-name>
      </citation>
    </ref>
    <ref id="B10">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kind</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Fiehn</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>Metabolomic database annotations via query of elemental compositions: mass accuracy is insufficient even at less than 1 ppm.</article-title>
        <source>BMC Bioinformatics</source>
        <year>2006</year>
        <volume>7</volume>
        <fpage>234</fpage>
        <pub-id pub-id-type="pmid">16646969</pub-id>
      </citation>
    </ref>
    <ref id="B11">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kind</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Fiehn</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>Seven golden rules for heuristic filtering of molecular formulas obtained by accurate mass spectrometry.</article-title>
        <source>BMC Bioinformatics</source>
        <year>2007</year>
        <volume>8</volume>
        <fpage>105</fpage>
        <pub-id pub-id-type="pmid">17389044</pub-id>
      </citation>
    </ref>
    <ref id="B12">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kubinyi</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Calculation of isotope distributions in mass spectrometry: a trivial solution for a non-trivial problem.</article-title>
        <source>Anal. Chim. Acta</source>
        <year>1991</year>
        <volume>247</volume>
        <fpage>107</fpage>
        <lpage>119</lpage>
      </citation>
    </ref>
    <ref id="B13">
      <citation citation-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Martello</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Toth</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <source>Knapsack Problems: Algorithms and Computer Implementations.</source>
        <year>1990</year>
        <publisher-loc>Chichester</publisher-loc>
        <publisher-name>John Wiley &amp; Sons</publisher-name>
      </citation>
    </ref>
    <ref id="B14">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rockwood</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Van Orden</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <article-title>Ultrahigh-speed calculation of isotope distributions.</article-title>
        <source>Anal. Chem.</source>
        <year>1996</year>
        <volume>68</volume>
        <fpage>2027</fpage>
        <lpage>2030</lpage>
      </citation>
    </ref>
    <ref id="B15">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rockwood</surname>
            <given-names>AL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Isotopic compositions and accurate masses of single isotopic peaks.</article-title>
        <source>J. Am. Soc. Mass Spectr</source>
        <year>2004</year>
        <volume>15</volume>
        <fpage>12</fpage>
        <lpage>21</lpage>
      </citation>
    </ref>
    <ref id="B16">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Senior</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Partitions and their representative graphs.</article-title>
        <source>Am. J. Math.</source>
        <year>1951</year>
        <volume>73</volume>
        <fpage>663</fpage>
        <lpage>689</lpage>
      </citation>
    </ref>
    <ref id="B17">
      <citation citation-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Wilf</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <source>Generating functionology.</source>
        <year>1990</year>
        <publisher-loc>New York</publisher-loc>
        <publisher-name>Academic Press</publisher-name>
      </citation>
    </ref>
    <ref id="B18">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yergey</surname>
            <given-names>JA</given-names>
          </name>
        </person-group>
        <article-title>A general approach to calculating isotopic distributions for mass spectrometry.</article-title>
        <source>Int. J. Mass Spectrom. Ion Phys.</source>
        <year>1983</year>
        <volume>52</volume>
        <fpage>337</fpage>
        <lpage>349</lpage>
      </citation>
    </ref>
    <ref id="B19">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Predicting molecular formulas of fragment ions with isotope patterns in tandem mass spectra.</article-title>
        <source>IEEE/ACM Trans. Comput. Biol. Bioinform.</source>
        <year>2005</year>
        <volume>2</volume>
        <fpage>217</fpage>
        <lpage>230</lpage>
        <pub-id pub-id-type="pmid">17044185</pub-id>
      </citation>
    </ref>
    <ref id="B20">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ProbID: a probabilistic algorithm to identify peptides through sequence database searching using tandem mass spectral data.</article-title>
        <source>Proteomics</source>
        <year>2002</year>
        <volume>2</volume>
        <fpage>1406</fpage>
        <lpage>1412</lpage>
        <pub-id pub-id-type="pmid">12422357</pub-id>
      </citation>
    </ref>
    <ref id="B21">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Chait</surname>
            <given-names>BT</given-names>
          </name>
        </person-group>
        <article-title>ProFound: an expert system for protein identification using mass spectrometric peptide mapping information.</article-title>
        <source>Anal. Chem.</source>
        <year>2000</year>
        <volume>72</volume>
        <fpage>2482</fpage>
        <lpage>2489</lpage>
        <pub-id pub-id-type="pmid">10857624</pub-id>
      </citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?properties no_embargo?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title>Bioinformatics</journal-title>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1460-2059</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">2639009</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btn603</article-id>
    <article-id pub-id-type="publisher-id">btn603</article-id>
    <article-id pub-id-type="pmid">19015140</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group>
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SIRIUS: decomposing isotope patterns for metabolite identification<xref ref-type="author-notes" rid="FN1"><sup>†</sup></xref></article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Böcker</surname>
          <given-names>Sebastian</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Letzel</surname>
          <given-names>Matthias C.</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lipták</surname>
          <given-names>Zsuzsanna</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pervukhin</surname>
          <given-names>Anton</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="COR1">*</xref>
      </contrib>
    </contrib-group>
    <aff id="AFF1"><sup>1</sup>Lehrstuhl für Bioinformatik, Friedrich-Schiller-Universität Jena, 07743 Jena, <sup>2</sup>Organische Chemie I, Fakultät für Chemie, Universität Bielefeld, 33501 Bielefeld and <sup>3</sup>AG Genominformatik, Technische Fakultät, Universität Bielefeld, 33501 Bielefeld, Germany</aff>
    <author-notes>
      <corresp id="COR1">*To whom correspondence should be addressed.</corresp>
      <fn id="FN1">
        <p><sup>†</sup>Apreliminary version of this article appeared under the title ‘Decomposing metabolomic isotope patterns’ in the Proceedings of the 6th Workshop on Algorithms in Bioinformatics, WABI 2006, in LNCS, Vol. 4175, Springer, pp. 12–23.</p>
      </fn>
      <fn>
        <p>Associate Editor: Olga Troyanskaya</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>1</month>
      <year>2009</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>17</day>
      <month>11</month>
      <year>2008</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>17</day>
      <month>11</month>
      <year>2008</year>
    </pub-date>
    <volume>25</volume>
    <issue>2</issue>
    <fpage>218</fpage>
    <lpage>224</lpage>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>8</month>
        <year>2008</year>
      </date>
      <date date-type="rev-recd">
        <day>13</day>
        <month>11</month>
        <year>2008</year>
      </date>
      <date date-type="accepted">
        <day>14</day>
        <month>11</month>
        <year>2008</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2008 The Author(s)</copyright-statement>
      <copyright-year>2008</copyright-year>
      <license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by-nc/2.0/uk/">
        <p><!--CREATIVE COMMONS-->This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/2.0/uk/">http://creativecommons.org/licenses/by-nc/2.0/uk/</ext-link>) which permits unrestricted non-commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.</p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Motivation:</bold> High-resolution mass spectrometry (MS) is among the most widely used technologies in metabolomics. Metabolites participate in almost all cellular processes, but most metabolites still remain uncharacterized. Determination of the sum formula is a crucial step in the identification of an unknown metabolite, as it reduces its possible structures to a hopefully manageable set.</p>
      <p><bold>Results:</bold> We present a method for determining the sum formula of a metabolite solely from its mass and the natural distribution of its isotopes. Our input is a measured isotope pattern from a high resolution mass spectrometer, and we want to find those molecules that best match this pattern. Our method is computationally efficient, and results on experimental data are very promising: for orthogonal time-of-flight mass spectrometry, we correctly identify sum formulas for &gt;90% of the molecules, ranging in mass up to 1000 Da.</p>
      <p><bold>Availability:</bold> SIRIUS is available under the LGPL license at <ext-link ext-link-type="uri" xlink:href="http://bio.informatik.uni-jena.de/sirius/">http://bio.informatik.uni-jena.de/sirius/</ext-link></p>
      <p>
        <bold>Contact:</bold>
        <email>anton.pervukhin@minet.uni-jena.de</email>
      </p>
      <p><bold>Supplementary information:</bold><ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btn603/DC1">Supplementary data</ext-link> are available at <italic>Bioinformatics</italic> online.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <sec sec-type="intro" id="SEC1">
    <title>1 INTRODUCTION</title>
    <p>High-resolution mass spectrometry (MS) allows determining the mass of sample molecules with very high accuracy (1–5 p.p.m.), and has become one preferred method of analyzing metabolites. The output of a mass spectrometer, after preprocessing, consists of peaks that ideally correspond to the masses of the sample molecules and their abundance. This brings into play the natural isotopic distributions of the elements: several peaks in the output correspond to the same type of sample molecule, reflecting its isotope pattern. In this article, we use this isotope pattern to identify the sample molecule by determining its molecular formula or sum formula, i.e. the number of atoms of each element.</p>
    <p>The term “metabolite” is usually restricted to small molecules that are intermediates and products of the metabolism. These small molecules participate in almost all cellular processes such as signal transduction, stress response, catabolism, or anabolism. Today, databases mostly contain primary metabolites directly relevant for growth, development, and reproduction of a cell or an organism. In contrast, most of the metabolites not directly involved in the aforementioned functions are yet uncharacterized. The majority of known metabolites have mass &lt;1000 Da: 96.5% of sum formulas in the KEGG COMPOUND database (Kanehisa <italic>et al</italic>., <xref ref-type="bibr" rid="B8">2006</xref>) fall into this mass range. To identify a sample metabolite, its mass spectrum is compared to spectra in a reference database. This method is limited to identifying metabolites and chemical compounds that have been included in some reference mass spectra library. Hence, <italic>de novo</italic> interpretation of metabolite mass spectra is highly sought.</p>
    <p>Our input is a list of masses <italic>M</italic><sub>0</sub>,…,<italic>M<sub>K</sub></italic> with intensities <italic>f</italic><sub>0</sub>,…,<italic>f<sub>K</sub></italic>, normalized such that ∑<sub><italic>i</italic></sub><italic>f<sub>i</sub></italic> =1. We extract this data from a high-resolution mass spectrum in a preprocessing step, and assume that it corresponds to the isotope pattern of a sample molecule. Note that for molecular mixtures, separating isotopic peaks that belong to different molecules is mostly trivial in this case. Our goal is to find the molecule, or rather its sum formula, whose isotope pattern best matches the input. In the following, we use ‘molecule’ and ‘sum formula’ interchangeably. We stress that this method cannot be used as-is to identify peptides or amino acid compositions, because certain sum formulas correspond to multiple peptides.</p>
    <p>To resolve the sum formula, Kind and Fiehn (<xref ref-type="bibr" rid="B10">2006</xref>) suggest to proceed as follows: first, compute all sum formulas that share monoisotopic mass with the input mass spectrum. For every such candidate molecule, simulate its isotope pattern, and match and rank it against the input isotope pattern. Several experimental studies using this setup have been reported in the literature, the most prominent by Iijima <italic>et al</italic>. (<xref ref-type="bibr" rid="B7">2008</xref>) who claim to have discovered almost 500 novel metabolites in Tomato (<italic>Solanum lycopersicum</italic>). Zhang <italic>et al</italic>. (<xref ref-type="bibr" rid="B19">2005</xref>) address a related problem for analyzing peptides, but this approach heavily builds on several <italic>ad hoc</italic> rules regarding admissible sum formulas and uses a heuristic search. Böcker and Rasche (<xref ref-type="bibr" rid="B4">2008</xref>) present a method for the automated interpretation of metabolite tandem mass spectra but ignore isotope patterns.</p>
    <p>In this article, we present efficient algorithms for all steps of the analysis pipeline suggested above. We limit our presentation to the elements most abundant in living beings, but note that our methods also work for other sets of elements. We first show how to use integer decomposition techniques (Böcker and Lipták, <xref ref-type="bibr" rid="B3">2007</xref>) for decomposing real-valued masses, with large improvements over naïve approaches. Second, we present a method for rapid computation of isotope distributions and mean masses of isotope peaks, improving on previously best known results (Rockwood <italic>et al</italic>., <xref ref-type="bibr" rid="B15">2004</xref>). Fast simulation of isotope patterns is vital due to the large search space. Third, we show how to rapidly match and rank such simulated spectra against the measured spectrum. We then report on the application of our method to high-resolution mass spectra. Finally, we present the software tool SIRIUS (Sum formula Identification by Ranking Isotope patterns Using mass Spectrometry) that implements all of the above algorithms and combines them with an easy-to-use graphical user interface.</p>
  </sec>
  <sec id="SEC2">
    <title>2 ISOTOPES AND ISOTOPE PATTERNS</title>
    <p>The elements most abundant in living beings are hydrogen (H), carbon (C), nitrogen (N), oxygen (O), phosphor (P) and sulfur (S). Atoms with the same number of protons but different number of neutrons are called <italic>isotopes</italic> of the element. Each of these isotopes occurs in nature with a certain abundance, and we limit our attention to these naturally occurring isotopes. The superscript preceding a symbol denotes the <italic>mass number</italic> of the atom: the number of protons plus the number of neutrons. The <italic>mass</italic> of an atom is measured in Dalton (Da). An atom's mass is roughly but not exactly equal to its mass number, the difference being due to the binding energy in the atom's nucleus. The masses of the different isotopes and their abundance are known up to very high precision (Audi <italic>et al</italic>., <xref ref-type="bibr" rid="B1">2003</xref>) (see <xref ref-type="table" rid="T1">Table 1</xref> for the six elements described above). Note that unlike their mass, natural abundances of isotopes are not physical constants. Values may slightly vary depending on, say, the continent where a sample was taken.
<table-wrap id="T1" position="float"><label>Table 1.</label><caption><p>Natural isotopic distribution: relative abundance of isotopes and their masses in Dalton</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Element</th><th rowspan="1" colspan="1">Isotope</th><th rowspan="1" colspan="1">mass</th><th rowspan="1" colspan="1">Mass difference</th><th rowspan="1" colspan="1">Abundance (%)</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">Hydrogen</td><td rowspan="1" colspan="1"><sup>1</sup>H</td><td rowspan="1" colspan="1">1.007825</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">99.985</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>2</sup>H</td><td rowspan="1" colspan="1">2.014102</td><td rowspan="1" colspan="1">+1.006277</td><td rowspan="1" colspan="1">0.015</td></tr><tr><td rowspan="1" colspan="1">Carbon</td><td rowspan="1" colspan="1"><sup>12</sup>C</td><td rowspan="1" colspan="1">12.0</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">98.890</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>13</sup>C</td><td rowspan="1" colspan="1">13.003355</td><td rowspan="1" colspan="1">+1.003355</td><td rowspan="1" colspan="1">1.110</td></tr><tr><td rowspan="1" colspan="1">Nitrogen</td><td rowspan="1" colspan="1"><sup>14</sup>N</td><td rowspan="1" colspan="1">14.003074</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">99.634</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>15</sup>N</td><td rowspan="1" colspan="1">15.000109</td><td rowspan="1" colspan="1">+0.997035</td><td rowspan="1" colspan="1">0.366</td></tr><tr><td rowspan="1" colspan="1">Oxygen</td><td rowspan="1" colspan="1"><sup>16</sup>O</td><td rowspan="1" colspan="1">15.994915</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">99.762</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>17</sup>O</td><td rowspan="1" colspan="1">16.999132</td><td rowspan="1" colspan="1">+1.004217</td><td rowspan="1" colspan="1">0.038</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>18</sup>O</td><td rowspan="1" colspan="1">17.999161</td><td rowspan="1" colspan="1">+2.004246</td><td rowspan="1" colspan="1">0.200</td></tr><tr><td rowspan="1" colspan="1">Phosphor</td><td rowspan="1" colspan="1"><sup>31</sup>P</td><td rowspan="1" colspan="1">30.973762</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">100</td></tr><tr><td rowspan="1" colspan="1">Sulfur</td><td rowspan="1" colspan="1"><sup>32</sup>S</td><td rowspan="1" colspan="1">31.972071</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">95.020</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>33</sup>S</td><td rowspan="1" colspan="1">32.971459</td><td rowspan="1" colspan="1">+0.999388</td><td rowspan="1" colspan="1">0.750</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>34</sup>S</td><td rowspan="1" colspan="1">33.967867</td><td rowspan="1" colspan="1">+1.995796</td><td rowspan="1" colspan="1">4.210</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>36</sup>S</td><td rowspan="1" colspan="1">35.967081</td><td rowspan="1" colspan="1">+3.995010</td><td rowspan="1" colspan="1">0.020</td></tr></tbody></table></table-wrap></p>
    <p>The <italic>nominal mass</italic> (also called <italic>nucleon number</italic>) of a molecule is the sum of protons and neutrons of the constituting atoms. The <italic>mass</italic> of the molecule is the sum of masses of these atoms. Clearly, nominal mass and mass depend on the isotopes the molecule consists of, thus on the <italic>isotope species</italic> of the molecule. The isotope species where each atom is the isotope with the lowest nominal mass is called <italic>monoisotopic</italic>. Likewise, the mass of the monoisotopic species is called the <italic>monoisotopic mass</italic> of the molecule. Mass defects and, hence, differences from the ideal mass depend on the elemental composition of a molecule. For example, sucrose (C<sub>12</sub>H<sub>22</sub>O<sub>11</sub>) has monoisotopic mass 342.116215 Da; whereas, the short peptide Leu-Asn-Pro (C<sub>15</sub>H<sub>26</sub>N<sub>4</sub>O<sub>5</sub>) has monoisotopic mass 342.190321, while both molecules have monoisotopic nominal mass 342.</p>
    <p>The number of distinct isotope species for a molecule with <italic>i</italic><sub>H</sub> hydrogen, <italic>i</italic><sub>C</sub> carbon, <italic>i</italic><sub>N</sub> nitrogen, <italic>i</italic><sub>O</sub> oxygen, <italic>i</italic><sub>P</sub> phosphor and <italic>i</italic><sub>S</sub> sulfur atoms is <inline-formula><inline-graphic xlink:href="btn603i1.jpg"/></inline-formula>. This follows because for an element <italic>E</italic> with <italic>r</italic> isotope types, a molecule <italic>E<sub>l</sub></italic> consisting of <italic>l</italic> atoms of the element has <inline-formula><inline-graphic xlink:href="btn603i2.jpg"/></inline-formula> different isotope species. The probability that a certain isotope species occurs can be computed by multiplying the probabilities of the underlying isotopes.</p>
    <p>Even with high-resolution MS, it is often impossible to resolve isotope species with identical nominal mass. Instead, these isotope species appear as one single peak in the MS output. For this reason, we merge isotope species with identical nominal mass; we refer to the resulting distribution as the molecule's <italic>isotopic distribution</italic>.</p>
    <p>For each element <italic>E</italic> we define two discrete random variables, denoted <italic>X<sub>E</sub></italic> and <italic>Y<sub>E</sub></italic>, representing the mass and the mass number, respectively. For example, <italic>X</italic><sub>C</sub> with state space {12, 13.003355}, <italic>Y</italic><sub>C</sub> with state space {12,13} and ℙ(<italic>X</italic><sub>C</sub> = 12) = ℙ(<italic>Y</italic><sub>C</sub> = 12) = 0.98890, ℙ(<italic>X</italic><sub>C</sub> = 13.003355)=ℙ(<italic>Y</italic><sub>C</sub> = 13) = 0.01110 are the random variables of carbon. Given a molecule consisting of <italic>l</italic> atoms, we assign to the <italic>i</italic>-th atom, <italic>i</italic>=1,…,<italic>l</italic>, two random variables <italic>X<sub>i</sub></italic> and <italic>Y<sub>i</sub></italic>, where <italic>X<sub>i</sub></italic> ∼ <italic>X<sub>E</sub></italic> and <italic>Y<sub>i</sub></italic> ∼ <italic>Y<sub>E</sub></italic>, with <italic>E</italic> being the corresponding element. Now we can represent the molecule's <italic>mass distribution</italic> by the random variable <italic>X</italic> := <italic>X</italic><sub>1</sub> +…+ <italic>X<sub>l</sub></italic>, and its nominal mass distribution, or <italic>isotopic distribution</italic>, by <italic>Y</italic> := <italic>Y</italic><sub>1</sub> + … + <italic>Y<sub>l</sub></italic>. In an ideal mass spectrum, normalized peak intensities correspond to the isotopic distribution of the molecule. Note that <italic>X</italic> and <italic>Y</italic> are correlated, since <italic>X<sub>E</sub></italic> can be viewed as a function of <italic>Y<sub>E</sub></italic> and <italic>E</italic>.</p>
    <p>We refer to the peak at the monoisotopic mass as the monoisotopic peak, which is followed by the +1, +2, … peaks. What is the mass of the +k peak, which is a superposition of several isotope species? It is reasonable to assume that its mass is the mean mass of all isotope species that add to its intensity (Rockwood <italic>et al</italic>., <xref ref-type="bibr" rid="B15">2004</xref>): for a molecule with monoisotopic nominal mass <italic>N</italic>, let <italic>X</italic> = <italic>X</italic><sub>1</sub> + ··· + <italic>X<sub>l</sub></italic> be the mass distribution and <italic>Y</italic> = <italic>Y</italic><sub>1</sub> + ··· + <italic>Y<sub>l</sub></italic> be the isotopic distribution. The mean peak mass of the +k peak is then <italic>m<sub>k</sub></italic> = 𝔼(<italic>X</italic> | <italic>Y</italic>=<italic>N+k</italic>). We refer to the isotopic distribution together with the mean peak masses as the molecule's <italic>isotope pattern</italic>.</p>
  </sec>
  <sec sec-type="methods" id="SEC3">
    <title>3 METHODS AND ALGORITHMS</title>
    <sec id="SEC3.1">
      <title>3.1 Real-valued decompositions</title>
      <p>We first concentrate on the problem of decomposing the monoisotopic mass <italic>M</italic><sub>0</sub>. We want to find all molecules with monoisotopic mass in the interval [<italic>l,u</italic>] ⊆ ℝ where <italic>l</italic>:=<italic>M</italic><sub>0</sub>−ε and <italic>u</italic>:=<italic>M</italic><sub>0</sub>+ε for some measurement inaccuracy ε. Formally, we search for all solutions of the integer knapsack equation (Kellerer <italic>et al</italic>., <xref ref-type="bibr" rid="B9">2004</xref>)
<disp-formula id="M1"><label>(1)</label><graphic xlink:href="btn603m1.jpg" position="float"/></disp-formula>
where <italic>a<sub>j</sub></italic>, <italic>j</italic>=1,…,<italic>n</italic> are real-valued monoisotopic masses of elements satisfying <italic>a<sub>j</sub></italic> ≧ 0. We search for all solution vectors <italic>c</italic> = (<italic>c</italic><sub>1</sub>,…,<italic>c<sub>n</sub></italic>) such that all <italic>c<sub>j</sub></italic> are non-negative integers. We may assume <italic>a</italic><sub>1</sub> &lt; <italic>a</italic><sub>2</sub> &lt; … &lt; <italic>a<sub>n</sub></italic>.</p>
      <p>A straightforward solution is to enumerate all vectors <italic>c</italic> with <italic>c</italic><sub>1</sub>=0 and ∑<sub><italic>j</italic></sub> <italic>a<sub>j</sub> c<sub>j</sub></italic> ≤ <italic>u</italic> and next to test if there is some <italic>c</italic><sub>1</sub> ≧ 0 such that ∑<sub><italic>j</italic></sub> <italic>a<sub>j</sub> c<sub>j</sub></italic> ∈ [<italic>l,u</italic>]. This results in Θ(<italic>M</italic><sub>0</sub><sup><italic>n</italic>-1</sup>) running time, for constant element masses. Alternatively, we can compute all potential decompositions up to some upper bound <italic>U</italic> during preprocessing, sort them with respect to mass and use binary search; this results in Θ(<italic>U<sup>n</sup></italic>) space requirement. These approaches are unfavorable in theoretical complexity as well as in practice: for the elements CHNOPS there exist more than 7 × 10<sup>9</sup> molecular formulas with mass ≤1500 Da.</p>
      <p>In the remainder of this section, we transform the integer knapsack problem with real-valued coefficients into a problem instance with <italic>integer</italic> coefficients. We will show in the next section how to efficiently solve such instances. Choosing a <italic>blowup factor b</italic> ∈ ℝ, corresponding to precision 1/<italic>b</italic>, we can round coefficients by ϕ(<italic>x</italic>) := ⌈ <italic>bx</italic> ⌉, so <inline-formula><inline-graphic xlink:href="btn603i3.jpg"/></inline-formula> and <italic>l</italic>′ := ϕ(<italic>l</italic>), <italic>u</italic>′ := ϕ(<italic>u</italic>) form an integer knapsack. Precision 1/<italic>b</italic> is merely a parameter of the decomposition algorithm and in principle independent of the measurement mass accuracy ε. To avoid rounding error accumulation, precision is usually set one to two orders of magnitude smaller than the measurement accuracy. Now, certain solutions <italic>c</italic> of the integer coefficient knapsack are no solutions of the real-valued coefficient knapsack and vice versa. We can easily sort out false positive solutions by checking (1), resulting in additional running time. We now concentrate on the more intriguing problem of false negative solutions that are missed by the integer coefficient knapsack.</p>
      <p>Clearly ∑<sub><italic>j</italic></sub> <italic>a<sub>j</sub> c<sub>j</sub></italic> ≧ <italic>l</italic> implies <inline-formula><inline-graphic xlink:href="btn603i4.jpg"/></inline-formula> since all <inline-formula><inline-graphic xlink:href="btn603i5.jpg"/></inline-formula> are integers. We have to increase the upper bound <italic>u</italic>′ to guarantee that all solutions of (1) are generated. We define relative rounding errors
<disp-formula><graphic xlink:href="btn603um1.jpg" position="float"/></disp-formula>
and note that <inline-formula><inline-graphic xlink:href="btn603i6.jpg"/></inline-formula>. Let Δ = Δ(<italic>b</italic>) := max {Δ<sub><italic>j</italic></sub>}. If <italic>c</italic> satisfies ∑<sub><italic>j</italic></sub> <italic>a<sub>j</sub> c<sub>j</sub></italic> ≤ <italic>u</italic> then <inline-formula><inline-graphic xlink:href="btn603i7.jpg"/></inline-formula>: clearly, <inline-formula><inline-graphic xlink:href="btn603i8.jpg"/></inline-formula> and our claim follows from
<disp-formula><graphic xlink:href="btn603um2.jpg" position="float"/></disp-formula>
One can easily check that this bound is tight. So, we re-define the integer interval by <italic>u</italic>′ := ⌊<italic>bu</italic> + Δ <italic>u</italic> ⌋. Without rounding correction we have to decompose (<italic>u</italic>−<italic>l</italic>) <italic>b</italic> integers, but rounding correction forces us to decompose an additional Δ <italic>u</italic> integers, independent of the interval size <italic>u</italic>−<italic>l</italic>. As an example, consider the elements CHNOPS and blowup factor <italic>b</italic> = 10<sup>5</sup>, then Δ(<italic>b</italic>) = Δ<sub>H</sub> (<italic>b</italic>) = 0.492936. So for <italic>M</italic><sub>0</sub> = 1000, we have to decompose an additional 492 integers. Clearly, increasing <italic>b</italic> usually decreases Δ(<italic>b</italic>). We stress that the running time of this approach is dominated by the number of <italic>decompositions</italic> of these integers, and not by the number of integers itself.</p>
    </sec>
    <sec id="SEC3.2">
      <title>3.2 Integer decompositions</title>
      <p>Assume that both the element masses <italic>a</italic><sub>1</sub>,…,<italic>a<sub>n</sub></italic> and the query mass <italic>m</italic> are positive integers. We are looking for all non-negative integer vectors (<italic>c</italic><sub>1</sub>,…,<italic>c<sub>n</sub></italic>) satisfying (1) (with <italic>l</italic> = <italic>u</italic> = <italic>m</italic>). This is a well-studied problem, referred to in its different variants as Coin Change Problem, Change Making Problem or Money Changing Problem, and can be solved with a simple dynamic programming algorithm in pseudo-polynomial time (Martello and Toth, <xref ref-type="bibr" rid="B13">1990</xref>). The main disadvantage of this approach is rather large memory requirement, which again depends on the maximal mass <italic>U</italic> we want to decompose.</p>
      <p>Böcker and Lipták (<xref ref-type="bibr" rid="B3">2007</xref>) present an algorithm for determining all such decompositions with running time <italic>O</italic>(<italic>na</italic><sub>1</sub> · γ(<italic>m</italic>)) and space <italic>O</italic>(<italic>na</italic><sub>1</sub>), where <italic>a</italic><sub>1</sub> is the smallest mass and γ(<italic>m</italic>) the number of decompositions of mass <italic>m</italic>. We briefly sketch the algorithm. Given integer masses <italic>a</italic><sub>1</sub> ≤ … ≤ <italic>a<sub>n</sub></italic>, a data structure of size <italic>na</italic><sub>1</sub>, referred to as <italic>Extended Residue Table</italic> (ER table), is computed in a preprocessing step. Entry ER(<italic>r,i</italic>), for <italic>r</italic>=0,…, <italic>a</italic><sub>1</sub>−1 and <italic>i</italic>=1,…,<italic>n</italic>, is the smallest number congruent <italic>r</italic> modulo <italic>a</italic><sub>1</sub> which is decomposable over <italic>a</italic><sub>1</sub>,…,<italic>a<sub>i</sub></italic>. Thus, the last column ER(·,<italic>n</italic>) of the table gives, for each residue <italic>r</italic>, the smallest number congruent <italic>r</italic> modulo <italic>a</italic><sub>1</sub> that is decomposable over <italic>a</italic><sub>1</sub>,…,<italic>a<sub>n</sub></italic>. Computation time is <italic>O</italic>(<italic>na</italic><sub>1</sub>). All decompositions of the query <italic>m</italic> are then recursively generated, limiting the number of unsuccessful paths by using information from the ER table. As a result, the running time of the algorithm is proportional only to the size of the table <italic>na</italic><sub>1</sub> and the number of decompositions γ(<italic>m</italic>), and does not depend directly on the input <italic>m</italic>. For decomposing molecule masses, this decomposition technique has several advantages over classical dynamic programming, such as improved running times and preprocessing independent of the largest mass we want to decompose in the future. Regarding the application of decomposing molecule masses, this approach uses only one fifteenth of memory and shows better running times.</p>
      <p>The number of decompositions γ(<italic>m</italic>) for an integer mass <italic>m</italic> over coprime integers <italic>a</italic><sub>1</sub>,…,<italic>a<sub>n</sub></italic> asymptotically behaves like a polynomial of degree <italic>n</italic>−1 in <italic>m</italic> (Wilf, <xref ref-type="bibr" rid="B17">1990</xref>). Following Beck <italic>et al</italic>. (<xref ref-type="bibr" rid="B2">2001</xref>), we can approximate the number of molecules over the elements CHNOPS with <italic>real mass</italic> in the interval [<italic>M,M</italic>+ϵ] by
<disp-formula id="M2"><label>(2)</label><graphic xlink:href="btn603m2.jpg" position="float"/></disp-formula>
We can also approximate the number of molecules with mass <italic>up to M</italic> by integrating (2). In <xref ref-type="fig" rid="F1">Figure 1</xref>, we plot the number of decompositions for masses of up to 1500 Da over the elements CHNOPS.
<fig id="F1" position="float"><label>Fig. 1.</label><caption><p>Number of decompositions over the elements CHNOPS for intervals of width 0.001 Da. Minima and maxima taken in intervals of width 1 Da. True number of decompositions in comparison with approximate (2) (approx). As is shown in the inlay, γ(<italic>m</italic>) varies with a periodic function of period ∼1 Da.</p></caption><graphic xlink:href="btn603f1"/></fig></p>
    </sec>
    <sec id="SEC3.3">
      <title>3.3 Simulating isotope patterns</title>
      <p>We first observe that for elements CHNOPS, all molecules have isotopic distributions that decrease rapidly with increasing mass. In particular, we can restrict ourselves to computing the first <italic>K</italic> non-zero values of the distribution, for rather small <italic>K</italic> such as <italic>K</italic>=10. For example, amongst 11 479 entries in the KEGG COMPOUND database with mass ≤3000 Da, no molecule has intensity of the +10 peak larger than 0.00007.</p>
      <p>The atoms hydrogen, carbon and nitrogen have only two natural isotopes. Thus, the isotopic distribution of a molecule <italic>E<sub>l</sub></italic> consisting of <italic>l</italic> identical atoms of type <italic>E</italic> with <italic>E</italic> ∈ {H,C,N} follows a binomial distribution: let <italic>q<sub>k</sub></italic> denote the probability that <italic>E<sub>l</sub></italic> has nominal mass <italic>N</italic>+<italic>k</italic>, where <italic>N</italic> is the monoisotopic nominal mass of <italic>E<sub>l</sub></italic>. Then, <inline-formula><inline-graphic xlink:href="btn603i9.jpg"/></inline-formula>, where <italic>p</italic> is the probability of the monoisotopic isotope. The values of the <italic>q<sub>k</sub></italic> can be computed iteratively, since <inline-formula><inline-graphic xlink:href="btn603i10.jpg"/></inline-formula> for <italic>k</italic>≧ 0, thus computation time is <italic>O</italic>(<italic>K</italic>).</p>
      <p>Where an element <italic>E</italic> has <italic>r</italic>&gt;2 isotopes (such as oxygen and sulfur), the isotopic distribution of <italic>E<sub>l</sub></italic> can in theory be computed as follows: let <italic>p<sub>i</sub></italic> for <italic>i</italic>=0,…,<italic>r</italic>−1 denote the probability of occurrence of the <italic>i</italic>-th isotope. Then, the probability that <italic>E<sub>l</sub></italic> has nominal mass <italic>N</italic>+<italic>k</italic> is <inline-formula><inline-graphic xlink:href="btn603i11.jpg"/></inline-formula>, where the sum runs over all <italic>l</italic><sub>0</sub>,…,<italic>l</italic><sub><italic>r</italic>−1</sub> ≧ 0 satisfying <inline-formula><inline-graphic xlink:href="btn603i12.jpg"/></inline-formula> and <inline-formula><inline-graphic xlink:href="btn603i13.jpg"/></inline-formula> <inline-formula><inline-graphic xlink:href="btn603i14.jpg"/></inline-formula> (Hsu, <xref ref-type="bibr" rid="B6">1984</xref>). However, this computation is infeasible in practice.</p>
      <p>Given two discrete random variables <italic>Y</italic> and <italic>Y</italic>′ with state spaces Ω,Ω′ ⊆ ℕ, we can compute the distribution of the random variable <italic>Z</italic> := <italic>Y</italic>+<italic>Y</italic>′ by folding the distributions,
<disp-formula><graphic xlink:href="btn603um3.jpg" position="float"/></disp-formula>
If we restrict ourselves to the first <italic>K</italic> values of this distribution, we can compute it in time <italic>O</italic>(<italic>K</italic><sup>2</sup>). Kubinyi (<xref ref-type="bibr" rid="B12">1991</xref>) suggests to compute the isotopic distributions of oxygen O<sub><italic>l</italic></sub> and sulfur S<sub><italic>l</italic></sub> by successive folding of the respective distribution: using a Russian multiplication scheme for the folding, this results in an algorithm with running time <italic>O</italic>(<italic>K</italic><sup>2</sup> log <italic>l</italic>). In applications, we do not compute these distributions on the fly but during preprocessing, for all <italic>l</italic>≤<italic>L</italic> fixed. This results in <italic>O</italic>(<italic>KL</italic>) memory for every such element, where <italic>l</italic> is small: The 128 oxygen atoms already have mass of about 2048 Da, exceeding the relevant mass range. For molecules consisting of different elements, we first compute or look up the isotopic distributions of the individual elements, and then combine these distributions by folding in <italic>O</italic>(<italic>n</italic> · K<sup>2</sup>) time.</p>
      <p>Using Fourier transforms of isotope distributions, we can multiply Fourier transforms instead of folding these distributions (Rockwood and Van Orden, <xref ref-type="bibr" rid="B14">1996</xref>). Doing so we can eventually replace the <italic>K</italic><sup>2</sup> factor in the algorithm's running time by a <italic>K</italic>log<italic>K</italic> factor. As we limit our attention to small <italic>K</italic> such as <italic>K</italic>=10, this will not result in a speedup of the algorithm in practice. Also, this approach may face the problem of numerical errors.</p>
      <p>We now come to the more challenging problem of efficiently computing the mean peak masses of a distribution. Doing so using the definition <italic>m<sub>k</sub></italic> =𝔼(<italic>X</italic> | <italic>Y</italic>=<italic>N</italic>+<italic>k</italic>) is highly inefficient, because we have to sum up over all isotope species. Pruning strategies have been developed to speed up computation (Yergey, <xref ref-type="bibr" rid="B18">1983</xref>), but pruning leads to a loss of accuracy (Rockwood <italic>et al</italic>., <xref ref-type="bibr" rid="B15">2004</xref>). We now present a simple recurrence for computing these masses analogous to the folding of distributions: let <italic>Y</italic> = Y<sub>1</sub> + ··· + <italic>Y<sub>l</sub></italic> and <inline-formula><inline-graphic xlink:href="btn603i15.jpg"/></inline-formula> be isotopic distributions of two molecules with monoisotopic nominal masses <italic>N</italic> and <italic>N</italic>′, respectively. Let <italic>p<sub>k</sub></italic> := ℙ(<italic>Y</italic> = <italic>N</italic>+<italic>k</italic>) and <italic>q<sub>k</sub></italic> := ℙ(<italic>Y</italic>′ = <italic>N</italic>′′<italic>k</italic>) denote the corresponding probabilities, <italic>m<sub>k</sub></italic> and <inline-formula><inline-graphic xlink:href="btn603i16.jpg"/></inline-formula> the mean peak masses of the +k peaks. Consider the random variable <italic>Z</italic> = <italic>Y</italic> + <italic>Y</italic>′ with monoisotopic nominal mass Ñ = <italic>N</italic>+<italic>N</italic>′.</p>
      <statement>
        <title>T<sc>heorem</sc> 1.</title>
        <p>
          <italic>The mean peak mass <inline-formula><inline-graphic xlink:href="btn603i17.jpg"/></inline-formula> of the +k peak of the random variable <italic>Z</italic> = <italic>Y</italic> + <italic>Y</italic>′ can be computed as:</italic>
          <disp-formula id="M3">
            <label>(3)</label>
            <graphic xlink:href="btn603m3.jpg" position="float"/>
          </disp-formula>
        </p>
      </statement>
      <p>Note that <inline-formula><inline-graphic xlink:href="btn603i18.jpg"/></inline-formula>. Since by independence, ℙ(<italic>Y</italic><sub>1</sub>=<italic>N</italic><sub>1</sub>,…,<italic>Y<sub>l</sub></italic>=<italic>N<sub>l</sub></italic>) = ∏<sub><italic>i</italic></sub> ℙ(<italic>Y<sub>i</sub></italic>=<italic>N<sub>i</sub></italic>), the theorem follows by rearranging summands. We omit the formal proof.</p>
      <p>The theorem allows us to ‘fold’ mean peak masses of two distributions to compute the mean peak masses of their sum. This implies that we can compute mean peak masses as efficiently as the distribution itself. This improves on the previously best known method (Rockwood <italic>et al</italic>., <xref ref-type="bibr" rid="B15">2004</xref>), replacing the linear running time dependence on the number of atoms by its logarithm.</p>
    </sec>
    <sec id="SEC3.4">
      <title>3.4 Scoring candidate molecules</title>
      <p>We want to discriminate between (tens of thousands of) candidate molecules generated by decomposing the monoisotopic mass. To this end, we compare the simulated isotopic distribution with the measured peaks. Matching peak pairs between the spectra is trivial for this application.</p>
      <p>Zhang and Chait (<xref ref-type="bibr" rid="B21">2000</xref>) and Zhang <italic>et al</italic>. (<xref ref-type="bibr" rid="B20">2002</xref>) suggest to use Bayesian Statistics to evaluate mass spectra matches:
<disp-formula id="M4"><label>(4)</label><graphic xlink:href="btn603m4.jpg" position="float"/></disp-formula>
where 𝒟 is the data (the measured spectrum), ℳ<sub><italic>i</italic></sub> are the models (the candidate molecules) and ℬ stands for any prior background information.</p>
      <p>Regarding this background information, we set the prior probability ℙ(ℳ<sub><italic>j</italic></sub> | ℬ) to zero for all molecules but the decompositions of the monoisotopic mass. We also assign prior probability zero to molecular formulas that cannot correspond to a molecule, because of chemical considerations: Senior's third theorem states that the sum of valences has to be greater than or equal to twice the number of atoms minus one (Senior, <xref ref-type="bibr" rid="B16">1951</xref>). Molecules violating Seniors third theorem are rare, particularly for natural compounds: in the KEGG COMPOUND database, &lt;0.16% of substances violate this rule. We also filter out radicals with odd sum of valences. We refrain from using further priors such as the hetero-to-carbon ratio (Kind and Fiehn, <xref ref-type="bibr" rid="B11">2007</xref>) because this might rather reproduce what is already known.</p>
      <p>Next, we assign probabilities to the observed masses and intensities. Assuming independence (in particular from background information) we calculate
<disp-formula id="M5"><label>(5)</label><graphic xlink:href="btn603m5.jpg" position="float"/></disp-formula>
Here, ℙ(<italic>M<sub>j</sub></italic>|<italic>m<sub>j</sub></italic>) is the probability to observe peak <italic>j</italic> at mass <italic>M<sub>j</sub></italic> when its true mass is <italic>m<sub>j</sub></italic>, and ℙ(<italic>f<sub>j</sub></italic>|<italic>p<sub>j</sub></italic>) is the probability to observe peak <italic>j</italic> with intensity <italic>f<sub>j</sub></italic> when its true intensity is <italic>p<sub>j</sub></italic>. Clearly, the independence of peak intensities is violated because these intensities sum to one, but this product can be seen as a rough estimate of the true probability.</p>
      <p>Mass spectrometrists assume that the mass error of a device is roughly normally distributed with mean zero. If the mass accuracy α of the measurement (in p.p.m.) is given, then we can set the standard deviation <inline-formula><inline-graphic xlink:href="btn603i19.jpg"/></inline-formula> for peak <italic>j</italic>, assuming that &gt;99.7% of measurements fall into the specified mass range. But we also observe that peaks of low intensity show less mass accuracy than those with high intensity, which can be attributed to the difficulties of separating a peak of low intensity from the background noise. Our data indicate a roughly linear dependence between peak intensity and mass accuracy. To this end, two mass accuracies α<sub>1</sub> (at full intensity) and α<sub>0</sub> (at minimal intensity) are provided by the user, and we set
<disp-formula><graphic xlink:href="btn603um4.jpg" position="float"/></disp-formula>
We want to estimate the probability that, given a peak with true mass <italic>M<sub>j</sub></italic>, a peak at mass <italic>M<sub>j</sub></italic> is observed in the measured spectrum: more precisely, the probability of observing a mass difference of |<italic>M<sub>j</sub></italic>−<italic>m<sub>j</sub></italic>| or larger. We can compute this probability using the complementary error function ‘erfc’:
<disp-formula id="M6"><label>(6)</label><graphic xlink:href="btn603m6.jpg" position="float"/></disp-formula>
with <inline-formula><inline-graphic xlink:href="btn603i20.jpg"/></inline-formula>.</p>
      <p>Even for high-resolution MS, spectra show a systematic mass shift due to calibration inaccuracies. We can easily eliminate this shift for all masses but the monoisotopic mass: we do not compare masses of the +1, … peaks directly but instead the difference to the monoisotopic peak, <italic>M<sub>j</sub></italic> − <italic>M<sub>0</sub></italic> versus <italic>m<sub>j</sub></italic> − <italic>m</italic><sub>0</sub> for <italic>j</italic> ≧ 1.</p>
      <p>Regarding peak intensities, we have to cope with a systematic error in the measured spectra: we observe in our data that peaks of low intensity are under-estimated in the measured spectrum, whereas peaks of high intensity are over-estimated, (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btn603/DC1">Supplementary Fig. 1</ext-link>). We ascribe this problem to inaccurate peak intensity determination: vendor software estimates peak intensities as signal-to-noise ratio or height above some baseline. The baseline, in turn, is determined using several <italic>ad hoc</italic> rules, and its estimate can be inaccurate. Unfortunately, such inaccuracies have unequal effects on peaks of different intensities. We correct this error by adding some user-defined parameter <italic>off</italic> to the measured intensities <italic>f<sub>i</sub></italic>, and by subsequent re-normalization. We found that for both of our datasets, the same parameter <italic>off</italic> = +0.02 leads to excellent results.</p>
      <p>Computation of ℙ(<italic>f<sub>j</sub></italic>|<italic>p<sub>j</sub></italic>) is done analogously to that of ℙ(<italic>M<sub>j</sub></italic>|<italic>m<sub>j</sub></italic>). Our data indicates that after correction, log ratios between measured and predicted peak intensity log (<italic>f<sub>j</sub></italic>/<italic>p<sub>j</sub></italic>) roughly follow a normal distribution. Again, precision parameters β<sub>1</sub> (at full intensity) and β<sub>0</sub> (at minimal intensity) are provided by the user (in percent). We compute
<disp-formula><graphic xlink:href="btn603um5.jpg" position="float"/></disp-formula>
as our precision interval, such that &gt;99.7% of log intensity ratios log (<italic>f<sub>j</sub></italic>/<italic>p<sub>j</sub></italic>) fall into the range <inline-formula><inline-graphic xlink:href="btn603i21.jpg"/></inline-formula>. Now, ℙ(<italic>f<sub>j</sub></italic>|<italic>p<sub>j</sub></italic>) can be estimated analogously to (6).</p>
    </sec>
  </sec>
  <sec sec-type="results" id="SEC4">
    <title>4 EXPERIMENTAL RESULTS</title>
    <sec id="SEC4.1">
      <title>4.1 Datasets</title>
      <p>To evaluate our method we used two datasets measured on two instruments. Mass spectra with single charge were measured from several organic (macro)molecules, composed of the elements CHNOPS. For every such spectrum, the sum formula of the sample molecule is known. The spectra were acquired over a period of 2 years; the molecules range in mass from 117 Da to ∼1000 Da. Peak detection and estimation of peak masses and intensities were conducted using vendor software.</p>
      <p>The first dataset consists of 153 mass spectra. Electrospray ionization (ESI) experiments were performed using the Fourier Transform Ion Cyclotron Resonance (FT-ICR) mass spectrometer APEX III (Bruker Daltonik GmbH, Bremen, Germany). The FT-MS was equipped with a 7.0 T, 160 mm bore superconducting magnet, infinity cell and interfaced to an external (nano)ESI ion source. All mass spectra were externally mass calibrated. The five analysis parameters were chosen as α<sub>1</sub> = 3, α<sub>0</sub> = 6, β<sub>1</sub> = 10, β<sub>0</sub> = 90 and <italic>off</italic> = +0.02.</p>
      <p>The second dataset consists of 86 mass spectra. ESI experiments were performed using the oa-TOF mass spectrometer MicrOTOF (Bruker Daltonik GmbH, Bremen, Germany). Quasi-internal mass calibration was used, by measurement of an infused calibrant prior to the compound of interest. For the oa-TOF analysis, we set α<sub>1</sub> = 5, α<sub>0</sub> = 6.5, β<sub>1</sub> = 10, β<sub>0</sub> = 90 and again <italic>off</italic> = +0.02.</p>
    </sec>
    <sec id="SEC4.2">
      <title>4.2 Identification accuracy</title>
      <p>Every input ‘mass spectrum’ consists of masses <italic>M</italic><sub>0</sub>,…,<italic>M<sub>k</sub></italic> and intensities <italic>f</italic><sub>0</sub>,…,<italic>f<sub>k</sub></italic>. For every such spectrum, we computed all molecules such that the monoisotopic mass <italic>M</italic><sub>0</sub> has relative mass difference of at most α<sub>1</sub> p.p.m. Next, we discarded molecules violating Senior's third theorem and radicals with odd sum of valences. For each remaining molecule, we computed its theoretical isotopic distribution (with <italic>K</italic>=10) and compared it to the measured isotopic distribution. We ranked the molecules according to resulting probabilities. We did not use any other background information to identify the molecule.</p>
      <p>For the 153 mass spectra in our FT-ICR dataset, 89 resulted in a correct identification; in 86% of the mass spectra, the correct interpretation was found in the TOP 10 explanations. There is a clear correlation between mass and identification accuracy, confer <xref ref-type="table" rid="T2">Table 2</xref>. For mass spectra ≤700 Da, the true interpretation was always found in the TOP 10 explanations, except in one case where it had rank 13. For 86 mass spectra in the oa-TOF dataset, the correct sum formula was found in the TOP 10 interpretations in all but two cases. Moreover, 79 out of 86 compounds were correctly identified, which correspond to an identification rate of &gt;90%, (<xref ref-type="table" rid="T2">Table 2</xref>). Better identification results on the oa-TOF dataset with lower mass accuracy show the crucial importance of including intensity measurements into the candidate evaluation. We note that the intensity accuracy of the oa-TOF instrument is significantly higher than that of the FT-ICR. We have also tested the variation of identification rates with different scoring parameters: identification results are relatively stable for small disturbances of parameter values, see <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btn603/DC1">supplementary material</ext-link>. Parameter estimation could be automated using a small training set. We are planning to include this feature in future implementations.
<table-wrap id="T2" position="float"><label>Table 2.</label><caption><p>Number of correct sum formulas at certain positions of the output list, for the FT-ICR dataset and the oa-TOF dataset</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Mass range</th><th rowspan="1" colspan="1">No. sp.</th><th colspan="5" rowspan="1">Rank in output list<hr/></th><th colspan="3" rowspan="1">No. sum formulas<hr/></th><th rowspan="1" colspan="1"/></tr><tr><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1">1</th><th rowspan="1" colspan="1">2</th><th rowspan="1" colspan="1">3–5</th><th rowspan="1" colspan="1">6–10</th><th rowspan="1" colspan="1">11+</th><th rowspan="1" colspan="1">Int.</th><th rowspan="1" colspan="1">Real</th><th rowspan="1" colspan="1">Chem.</th><th rowspan="1" colspan="1">Time</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">FT-ICR dataset</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/></tr><tr><td rowspan="1" colspan="1">200–300</td><td rowspan="1" colspan="1">13</td><td rowspan="1" colspan="1">11</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">67</td><td rowspan="1" colspan="1">37.2</td><td rowspan="1" colspan="1">8.6</td><td rowspan="1" colspan="1">1.5</td></tr><tr><td rowspan="1" colspan="1">300–400</td><td rowspan="1" colspan="1">37</td><td rowspan="1" colspan="1">28</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">200</td><td rowspan="1" colspan="1">109</td><td rowspan="1" colspan="1">10.4</td><td rowspan="1" colspan="1">4.3</td></tr><tr><td rowspan="1" colspan="1">400–500</td><td rowspan="1" colspan="1">57</td><td rowspan="1" colspan="1">39</td><td rowspan="1" colspan="1">6</td><td rowspan="1" colspan="1">6</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">579.5</td><td rowspan="1" colspan="1">318.2</td><td rowspan="1" colspan="1">22.8</td><td rowspan="1" colspan="1">13.5</td></tr><tr><td rowspan="1" colspan="1">500–600</td><td rowspan="1" colspan="1">7</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1800.4</td><td rowspan="1" colspan="1">990.3</td><td rowspan="1" colspan="1">59.6</td><td rowspan="1" colspan="1">40.1</td></tr><tr><td rowspan="1" colspan="1">600–700</td><td rowspan="1" colspan="1">4</td><td rowspan="1" colspan="1">3</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">2668.5</td><td rowspan="1" colspan="1">1454</td><td rowspan="1" colspan="1">37.3</td><td rowspan="1" colspan="1">55</td></tr><tr><td rowspan="1" colspan="1">700–800</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">8797.8</td><td rowspan="1" colspan="1">4812</td><td rowspan="1" colspan="1">247</td><td rowspan="1" colspan="1">232</td></tr><tr><td rowspan="1" colspan="1">800–900</td><td rowspan="1" colspan="1">14</td><td rowspan="1" colspan="1">3</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">3</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">14781.6</td><td rowspan="1" colspan="1">8101</td><td rowspan="1" colspan="1">534.6</td><td rowspan="1" colspan="1">485</td></tr><tr><td rowspan="1" colspan="1">900–1000</td><td rowspan="1" colspan="1">16</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">13</td><td rowspan="1" colspan="1">31805.7</td><td rowspan="1" colspan="1">17448</td><td rowspan="1" colspan="1">1570</td><td rowspan="1" colspan="1">1281</td></tr></tbody></table><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Mass range</th><th rowspan="1" colspan="1">No. sp.</th><th colspan="3" rowspan="1">Rank<hr/></th><th colspan="3" rowspan="1">No. sum formulas<hr/></th><th rowspan="1" colspan="1"/></tr><tr><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1">1</th><th rowspan="1" colspan="1">2–6</th><th rowspan="1" colspan="1">11+</th><th rowspan="1" colspan="1">Int.</th><th rowspan="1" colspan="1">Real</th><th rowspan="1" colspan="1">Chem.</th><th rowspan="1" colspan="1">Time</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">oa- TOF dataset</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/></tr><tr><td rowspan="1" colspan="1">100–200</td><td rowspan="1" colspan="1">7</td><td rowspan="1" colspan="1">7</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">11.3</td><td rowspan="1" colspan="1">7.4</td><td rowspan="1" colspan="1">1.9</td><td rowspan="1" colspan="1">0</td></tr><tr><td rowspan="1" colspan="1">200–300</td><td rowspan="1" colspan="1">21</td><td rowspan="1" colspan="1">21</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">60.1</td><td rowspan="1" colspan="1">40.1</td><td rowspan="1" colspan="1">4.6</td><td rowspan="1" colspan="1">1.4</td></tr><tr><td rowspan="1" colspan="1">300–400</td><td rowspan="1" colspan="1">27</td><td rowspan="1" colspan="1">26</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">297.8</td><td rowspan="1" colspan="1">199.7</td><td rowspan="1" colspan="1">22.6</td><td rowspan="1" colspan="1">8.1</td></tr><tr><td rowspan="1" colspan="1">400–500</td><td rowspan="1" colspan="1">15</td><td rowspan="1" colspan="1">14</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">725.6</td><td rowspan="1" colspan="1">484.1</td><td rowspan="1" colspan="1">32.4</td><td rowspan="1" colspan="1">17.3</td></tr><tr><td rowspan="1" colspan="1">500–600</td><td rowspan="1" colspan="1">10</td><td rowspan="1" colspan="1">7</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1479.1</td><td rowspan="1" colspan="1">988.9</td><td rowspan="1" colspan="1">54.3</td><td rowspan="1" colspan="1">36</td></tr><tr><td rowspan="1" colspan="1">600–700</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">4600</td><td rowspan="1" colspan="1">3080</td><td rowspan="1" colspan="1">276</td><td rowspan="1" colspan="1">130</td></tr><tr><td rowspan="1" colspan="1">700–800</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">10336</td><td rowspan="1" colspan="1">6909</td><td rowspan="1" colspan="1">578</td><td rowspan="1" colspan="1">461</td></tr><tr><td rowspan="1" colspan="1">800–900</td><td rowspan="1" colspan="1">3</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">18172.3</td><td rowspan="1" colspan="1">12146</td><td rowspan="1" colspan="1">914.3</td><td rowspan="1" colspan="1">757</td></tr></tbody></table><table-wrap-foot><fn><p>We report the number of spectra in this mass range (no. sp.), as well as the average number of sum formulas over all molecules in the mass range (no. sum formulas). We distinguish between the number of integer decompositions (int.), the number of real decompositions (real) and the number of those sum formulas that pass Senior's third theorem (chem.). Finally, we give the average running time in milliseconds per spectrum (time).</p></fn></table-wrap-foot></table-wrap></p>
    </sec>
    <sec id="SEC4.3">
      <title>4.3 Running times</title>
      <p>We analyzed all 239 mass spectra on a Pentium M 1.5 GHz processor with blowup <italic>b</italic> = 5 × 10<sup>4</sup>, using only a few Megabyte of memory. This results in running times of &lt;1.3s per spectrum for the complete analysis of one mass spectrum. Clearly, running times depend on molecule masses, see again <xref ref-type="table" rid="T2">Table 2</xref>. Increasing the blowup beyond 5 × 10<sup>4</sup> increased running times, presumably because the smaller table can be kept in the processor cache.</p>
    </sec>
  </sec>
  <sec id="SEC5">
    <title>5 IMPLEMENTATION</title>
    <p>We have developed a java-based graphical tool called SIRIUS. At the SIRIUS core lie efficient algorithms for generating all elemental compositions for a given mass and error, calculating isotope patterns for all chemically relevant compositions, and matching and ranking the candidate molecules against the input spectrum. SIRIUS combines these algorithms with a powerful graphical user interface. An extensive management system allows simplified data handling and offers an easy way to integrate new algorithms and data structures into the framework. Through a user-friendly interface, SIRIUS allows the user to import datasets in most common mass spectrometry file formats. It supports automatic recognition of molecular ion adducts present in the input spectrum, handy visualization of identified sum formulas and their isotope patterns and customizable export of identification results to common human-readable file formats. Finally, the software provides a basic functionality to search for sum formulas identified by the algorithm in NCBI PubChem Database.<xref ref-type="fn" rid="FN2"><sup>1</sup></xref></p>
    <p>Preparation of a new analysis run can be divided into the following steps: initializing input data and instrument parameters, setting up algorithm parameters and extracting isotope patterns from the input peaklist. Input peaklist and machine settings can be reused for multiple analyses on the same data. SIRIUS provides the user with reasonable default values for algorithm parameters. The program also offers to save all algorithm and mass spectrometer settings. To this end, SIRIUS creates a persistent workspace that can be used to store local settings and to automatically reload them on request.</p>
    <p>We use the ProteomeCommons.org IO Framework (Falkner <italic>et al</italic>., <xref ref-type="bibr" rid="B5">2007</xref>) to import mass spectrometry data, which allows reading most MS data formats including mzData and mzXML. We parse the peaklist and divide it into signal groups related to different compounds. A peaklist can also contain several signal groups belonging to the same compound, modified by different molecular ion adducts. Identifying modifications is done by calculating mass differences between monoisotopic peak masses. In view of the small number of adducts, we apply a simple exhaustive search to find all matching mass differences. If there is no prior knowledge on the source of modification, the user can choose one or more adduct types for an isotope pattern.</p>
    <p>The output of the algorithm is a list of candidate sum formulas for each compound. Sum formulas are listed in the summary table, sorted in decreasing order of likelihoods. To view an entry in more detail, the user can select and compare theoretical and measured isotope patterns visually, (<xref ref-type="fig" rid="F2">Fig. 2</xref>). Analysis results can be exported to the application workspace and opened for further evaluation. Export file formats include plain text, PDF and XML documents.
<fig id="F2" position="float"><label>Fig. 2.</label><caption><p>Screenshot of the SIRIUS software, available from <ext-link ext-link-type="uri" xlink:href="http://bio.informatik.uni-jena.de/sirius">http://bio.informatik.uni-jena.de/sirius</ext-link>.</p></caption><graphic xlink:href="btn603f2"/></fig></p>
  </sec>
  <sec sec-type="conclusions" id="SEC6">
    <title>6 CONCLUSION</title>
    <p>We presented an approach to determine the sum formula of an unknown metabolite solely from its high-resolution isotope pattern. Our approach allows us to reduce the number of potential sum formulas to only a few candidates; in many cases we were able to determine the correct molecular formula. The approach is time- and memory-efficient and can be executed on a regular desktop PC. We further presented methods for the efficient simulation of isotope patterns. This is vital for larger molecules where the search space increases rapidly.</p>
    <p>Results on experimental data clearly show the potential of our approach, in particular for oa-TOF data. In our evaluation, we have deliberately ignored some information such as prior probability of the elements or hetero-to-carbon ratio (Kind and Fiehn, <xref ref-type="bibr" rid="B11">2007</xref>). We believe that such information should rather be used in a ‘post-processing’ step by an expert, instead of automatically filtering out certain sum formulas a priori. Finally, we introduced a user-friendly software called SIRIUS, which implements all of the methods presented.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>[Supplementary Data]</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="btn603_index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="btn603_1.pdf"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="x-zip-compressed" xlink:href="btn603_bioinf-2008-1396-File009.gz"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>ACKNOWLEDGEMENTS</title>
    <p>Additional programming by Martin Engler. We thank Dr H. Luftmann, Universität Münster, Organisch-Chemisches Institut, for making available the oa-TOF dataset and an anonymous referee for helpful comments.</p>
    <p><italic>Funding</italic>: Deutsche Forschungsgemeinschaft (BO 1910/1 to A.P.); Alexander von Humboldt Foundation and the Bundesministerium für Bildung und Forschung, within the group ‘Combinatorial Search Algorithms in Bioinformatics’ (to Z.L.).</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </ack>
  <fn-group>
    <fn id="FN2">
      <p>
        <sup>1</sup>
        <ext-link ext-link-type="uri" xlink:href="http://pubchem.ncbi.nlm.nih.gov/">http://pubchem.ncbi.nlm.nih.gov/</ext-link>
      </p>
    </fn>
  </fn-group>
  <ref-list>
    <title>REFERENCES</title>
    <ref id="B1">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Audi</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The AME2003 atomic mass evaluation (ii): Tables, graphs, and references.</article-title>
        <source>Nucl. Phys. A</source>
        <year>2003</year>
        <volume>729</volume>
        <fpage>129</fpage>
        <lpage>336</lpage>
      </citation>
    </ref>
    <ref id="B2">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Beck</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The polynomial part of a restricted partition function related to the frobenius problem.</article-title>
        <source>Electron. J. Comb</source>
        <year>2001</year>
        <volume>8</volume>
        <fpage>N7</fpage>
      </citation>
    </ref>
    <ref id="B3">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Böcker</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lipták</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>A fast and simple algorithm for the Money Changing Problem.</article-title>
        <source>Algorithmica</source>
        <year>2007</year>
        <volume>48</volume>
        <fpage>413</fpage>
        <lpage>432</lpage>
      </citation>
    </ref>
    <ref id="B4">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Böcker</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Rasche</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Towards de novo identification of metabolites by analyzing tandem mass spectra.</article-title>
        <source>Bioinformatics</source>
        <year>2008</year>
        <volume>24</volume>
        <fpage>I49</fpage>
        <lpage>I55</lpage>
        <pub-id pub-id-type="pmid">18689839</pub-id>
      </citation>
    </ref>
    <ref id="B5">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Falkner</surname>
            <given-names>JA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Proteomecommons.org io framework: reading and writing multiple proteomics data formats.</article-title>
        <source>Bioinformatics</source>
        <year>2007</year>
        <volume>23</volume>
        <fpage>262</fpage>
        <lpage>263</lpage>
        <pub-id pub-id-type="pmid">17121776</pub-id>
      </citation>
    </ref>
    <ref id="B6">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hsu</surname>
            <given-names>CS</given-names>
          </name>
        </person-group>
        <article-title>Diophantine approach to isotopic abundance calculations.</article-title>
        <source>Anal. Chem.</source>
        <year>1984</year>
        <volume>56</volume>
        <fpage>1356</fpage>
        <lpage>1361</lpage>
      </citation>
    </ref>
    <ref id="B7">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Iijima</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metabolite annotations based on the integration of mass spectral information.</article-title>
        <source>Plant J.</source>
        <year>2008</year>
        <volume>54</volume>
        <fpage>949</fpage>
        <lpage>962</lpage>
        <pub-id pub-id-type="pmid">18266924</pub-id>
      </citation>
    </ref>
    <ref id="B8">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kanehisa</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>From genomics to chemical genomics: new developments in KEGG.</article-title>
        <source>Nucl. Acids Res.</source>
        <year>2006</year>
        <volume>34</volume>
        <fpage>D354</fpage>
        <lpage>D357</lpage>
        <pub-id pub-id-type="pmid">16381885</pub-id>
      </citation>
    </ref>
    <ref id="B9">
      <citation citation-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Kellerer</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Knapsack Problems.</source>
        <year>2004</year>
        <publisher-loc>Berlin, Heidelberg</publisher-loc>
        <publisher-name>Springer</publisher-name>
      </citation>
    </ref>
    <ref id="B10">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kind</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Fiehn</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>Metabolomic database annotations via query of elemental compositions: mass accuracy is insufficient even at less than 1 ppm.</article-title>
        <source>BMC Bioinformatics</source>
        <year>2006</year>
        <volume>7</volume>
        <fpage>234</fpage>
        <pub-id pub-id-type="pmid">16646969</pub-id>
      </citation>
    </ref>
    <ref id="B11">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kind</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Fiehn</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>Seven golden rules for heuristic filtering of molecular formulas obtained by accurate mass spectrometry.</article-title>
        <source>BMC Bioinformatics</source>
        <year>2007</year>
        <volume>8</volume>
        <fpage>105</fpage>
        <pub-id pub-id-type="pmid">17389044</pub-id>
      </citation>
    </ref>
    <ref id="B12">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kubinyi</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Calculation of isotope distributions in mass spectrometry: a trivial solution for a non-trivial problem.</article-title>
        <source>Anal. Chim. Acta</source>
        <year>1991</year>
        <volume>247</volume>
        <fpage>107</fpage>
        <lpage>119</lpage>
      </citation>
    </ref>
    <ref id="B13">
      <citation citation-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Martello</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Toth</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <source>Knapsack Problems: Algorithms and Computer Implementations.</source>
        <year>1990</year>
        <publisher-loc>Chichester</publisher-loc>
        <publisher-name>John Wiley &amp; Sons</publisher-name>
      </citation>
    </ref>
    <ref id="B14">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rockwood</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Van Orden</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <article-title>Ultrahigh-speed calculation of isotope distributions.</article-title>
        <source>Anal. Chem.</source>
        <year>1996</year>
        <volume>68</volume>
        <fpage>2027</fpage>
        <lpage>2030</lpage>
      </citation>
    </ref>
    <ref id="B15">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rockwood</surname>
            <given-names>AL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Isotopic compositions and accurate masses of single isotopic peaks.</article-title>
        <source>J. Am. Soc. Mass Spectr</source>
        <year>2004</year>
        <volume>15</volume>
        <fpage>12</fpage>
        <lpage>21</lpage>
      </citation>
    </ref>
    <ref id="B16">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Senior</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Partitions and their representative graphs.</article-title>
        <source>Am. J. Math.</source>
        <year>1951</year>
        <volume>73</volume>
        <fpage>663</fpage>
        <lpage>689</lpage>
      </citation>
    </ref>
    <ref id="B17">
      <citation citation-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Wilf</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <source>Generating functionology.</source>
        <year>1990</year>
        <publisher-loc>New York</publisher-loc>
        <publisher-name>Academic Press</publisher-name>
      </citation>
    </ref>
    <ref id="B18">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yergey</surname>
            <given-names>JA</given-names>
          </name>
        </person-group>
        <article-title>A general approach to calculating isotopic distributions for mass spectrometry.</article-title>
        <source>Int. J. Mass Spectrom. Ion Phys.</source>
        <year>1983</year>
        <volume>52</volume>
        <fpage>337</fpage>
        <lpage>349</lpage>
      </citation>
    </ref>
    <ref id="B19">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Predicting molecular formulas of fragment ions with isotope patterns in tandem mass spectra.</article-title>
        <source>IEEE/ACM Trans. Comput. Biol. Bioinform.</source>
        <year>2005</year>
        <volume>2</volume>
        <fpage>217</fpage>
        <lpage>230</lpage>
        <pub-id pub-id-type="pmid">17044185</pub-id>
      </citation>
    </ref>
    <ref id="B20">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ProbID: a probabilistic algorithm to identify peptides through sequence database searching using tandem mass spectral data.</article-title>
        <source>Proteomics</source>
        <year>2002</year>
        <volume>2</volume>
        <fpage>1406</fpage>
        <lpage>1412</lpage>
        <pub-id pub-id-type="pmid">12422357</pub-id>
      </citation>
    </ref>
    <ref id="B21">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Chait</surname>
            <given-names>BT</given-names>
          </name>
        </person-group>
        <article-title>ProFound: an expert system for protein identification using mass spectrometric peptide mapping information.</article-title>
        <source>Anal. Chem.</source>
        <year>2000</year>
        <volume>72</volume>
        <fpage>2482</fpage>
        <lpage>2489</lpage>
        <pub-id pub-id-type="pmid">10857624</pub-id>
      </citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?properties no_embargo?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title>Bioinformatics</journal-title>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1460-2059</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">2639009</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btn603</article-id>
    <article-id pub-id-type="publisher-id">btn603</article-id>
    <article-id pub-id-type="pmid">19015140</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group>
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SIRIUS: decomposing isotope patterns for metabolite identification<xref ref-type="author-notes" rid="FN1"><sup>†</sup></xref></article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Böcker</surname>
          <given-names>Sebastian</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Letzel</surname>
          <given-names>Matthias C.</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lipták</surname>
          <given-names>Zsuzsanna</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pervukhin</surname>
          <given-names>Anton</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="COR1">*</xref>
      </contrib>
    </contrib-group>
    <aff id="AFF1"><sup>1</sup>Lehrstuhl für Bioinformatik, Friedrich-Schiller-Universität Jena, 07743 Jena, <sup>2</sup>Organische Chemie I, Fakultät für Chemie, Universität Bielefeld, 33501 Bielefeld and <sup>3</sup>AG Genominformatik, Technische Fakultät, Universität Bielefeld, 33501 Bielefeld, Germany</aff>
    <author-notes>
      <corresp id="COR1">*To whom correspondence should be addressed.</corresp>
      <fn id="FN1">
        <p><sup>†</sup>Apreliminary version of this article appeared under the title ‘Decomposing metabolomic isotope patterns’ in the Proceedings of the 6th Workshop on Algorithms in Bioinformatics, WABI 2006, in LNCS, Vol. 4175, Springer, pp. 12–23.</p>
      </fn>
      <fn>
        <p>Associate Editor: Olga Troyanskaya</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>1</month>
      <year>2009</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>17</day>
      <month>11</month>
      <year>2008</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>17</day>
      <month>11</month>
      <year>2008</year>
    </pub-date>
    <volume>25</volume>
    <issue>2</issue>
    <fpage>218</fpage>
    <lpage>224</lpage>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>8</month>
        <year>2008</year>
      </date>
      <date date-type="rev-recd">
        <day>13</day>
        <month>11</month>
        <year>2008</year>
      </date>
      <date date-type="accepted">
        <day>14</day>
        <month>11</month>
        <year>2008</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2008 The Author(s)</copyright-statement>
      <copyright-year>2008</copyright-year>
      <license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by-nc/2.0/uk/">
        <p><!--CREATIVE COMMONS-->This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/2.0/uk/">http://creativecommons.org/licenses/by-nc/2.0/uk/</ext-link>) which permits unrestricted non-commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.</p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Motivation:</bold> High-resolution mass spectrometry (MS) is among the most widely used technologies in metabolomics. Metabolites participate in almost all cellular processes, but most metabolites still remain uncharacterized. Determination of the sum formula is a crucial step in the identification of an unknown metabolite, as it reduces its possible structures to a hopefully manageable set.</p>
      <p><bold>Results:</bold> We present a method for determining the sum formula of a metabolite solely from its mass and the natural distribution of its isotopes. Our input is a measured isotope pattern from a high resolution mass spectrometer, and we want to find those molecules that best match this pattern. Our method is computationally efficient, and results on experimental data are very promising: for orthogonal time-of-flight mass spectrometry, we correctly identify sum formulas for &gt;90% of the molecules, ranging in mass up to 1000 Da.</p>
      <p><bold>Availability:</bold> SIRIUS is available under the LGPL license at <ext-link ext-link-type="uri" xlink:href="http://bio.informatik.uni-jena.de/sirius/">http://bio.informatik.uni-jena.de/sirius/</ext-link></p>
      <p>
        <bold>Contact:</bold>
        <email>anton.pervukhin@minet.uni-jena.de</email>
      </p>
      <p><bold>Supplementary information:</bold><ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btn603/DC1">Supplementary data</ext-link> are available at <italic>Bioinformatics</italic> online.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <sec sec-type="intro" id="SEC1">
    <title>1 INTRODUCTION</title>
    <p>High-resolution mass spectrometry (MS) allows determining the mass of sample molecules with very high accuracy (1–5 p.p.m.), and has become one preferred method of analyzing metabolites. The output of a mass spectrometer, after preprocessing, consists of peaks that ideally correspond to the masses of the sample molecules and their abundance. This brings into play the natural isotopic distributions of the elements: several peaks in the output correspond to the same type of sample molecule, reflecting its isotope pattern. In this article, we use this isotope pattern to identify the sample molecule by determining its molecular formula or sum formula, i.e. the number of atoms of each element.</p>
    <p>The term “metabolite” is usually restricted to small molecules that are intermediates and products of the metabolism. These small molecules participate in almost all cellular processes such as signal transduction, stress response, catabolism, or anabolism. Today, databases mostly contain primary metabolites directly relevant for growth, development, and reproduction of a cell or an organism. In contrast, most of the metabolites not directly involved in the aforementioned functions are yet uncharacterized. The majority of known metabolites have mass &lt;1000 Da: 96.5% of sum formulas in the KEGG COMPOUND database (Kanehisa <italic>et al</italic>., <xref ref-type="bibr" rid="B8">2006</xref>) fall into this mass range. To identify a sample metabolite, its mass spectrum is compared to spectra in a reference database. This method is limited to identifying metabolites and chemical compounds that have been included in some reference mass spectra library. Hence, <italic>de novo</italic> interpretation of metabolite mass spectra is highly sought.</p>
    <p>Our input is a list of masses <italic>M</italic><sub>0</sub>,…,<italic>M<sub>K</sub></italic> with intensities <italic>f</italic><sub>0</sub>,…,<italic>f<sub>K</sub></italic>, normalized such that ∑<sub><italic>i</italic></sub><italic>f<sub>i</sub></italic> =1. We extract this data from a high-resolution mass spectrum in a preprocessing step, and assume that it corresponds to the isotope pattern of a sample molecule. Note that for molecular mixtures, separating isotopic peaks that belong to different molecules is mostly trivial in this case. Our goal is to find the molecule, or rather its sum formula, whose isotope pattern best matches the input. In the following, we use ‘molecule’ and ‘sum formula’ interchangeably. We stress that this method cannot be used as-is to identify peptides or amino acid compositions, because certain sum formulas correspond to multiple peptides.</p>
    <p>To resolve the sum formula, Kind and Fiehn (<xref ref-type="bibr" rid="B10">2006</xref>) suggest to proceed as follows: first, compute all sum formulas that share monoisotopic mass with the input mass spectrum. For every such candidate molecule, simulate its isotope pattern, and match and rank it against the input isotope pattern. Several experimental studies using this setup have been reported in the literature, the most prominent by Iijima <italic>et al</italic>. (<xref ref-type="bibr" rid="B7">2008</xref>) who claim to have discovered almost 500 novel metabolites in Tomato (<italic>Solanum lycopersicum</italic>). Zhang <italic>et al</italic>. (<xref ref-type="bibr" rid="B19">2005</xref>) address a related problem for analyzing peptides, but this approach heavily builds on several <italic>ad hoc</italic> rules regarding admissible sum formulas and uses a heuristic search. Böcker and Rasche (<xref ref-type="bibr" rid="B4">2008</xref>) present a method for the automated interpretation of metabolite tandem mass spectra but ignore isotope patterns.</p>
    <p>In this article, we present efficient algorithms for all steps of the analysis pipeline suggested above. We limit our presentation to the elements most abundant in living beings, but note that our methods also work for other sets of elements. We first show how to use integer decomposition techniques (Böcker and Lipták, <xref ref-type="bibr" rid="B3">2007</xref>) for decomposing real-valued masses, with large improvements over naïve approaches. Second, we present a method for rapid computation of isotope distributions and mean masses of isotope peaks, improving on previously best known results (Rockwood <italic>et al</italic>., <xref ref-type="bibr" rid="B15">2004</xref>). Fast simulation of isotope patterns is vital due to the large search space. Third, we show how to rapidly match and rank such simulated spectra against the measured spectrum. We then report on the application of our method to high-resolution mass spectra. Finally, we present the software tool SIRIUS (Sum formula Identification by Ranking Isotope patterns Using mass Spectrometry) that implements all of the above algorithms and combines them with an easy-to-use graphical user interface.</p>
  </sec>
  <sec id="SEC2">
    <title>2 ISOTOPES AND ISOTOPE PATTERNS</title>
    <p>The elements most abundant in living beings are hydrogen (H), carbon (C), nitrogen (N), oxygen (O), phosphor (P) and sulfur (S). Atoms with the same number of protons but different number of neutrons are called <italic>isotopes</italic> of the element. Each of these isotopes occurs in nature with a certain abundance, and we limit our attention to these naturally occurring isotopes. The superscript preceding a symbol denotes the <italic>mass number</italic> of the atom: the number of protons plus the number of neutrons. The <italic>mass</italic> of an atom is measured in Dalton (Da). An atom's mass is roughly but not exactly equal to its mass number, the difference being due to the binding energy in the atom's nucleus. The masses of the different isotopes and their abundance are known up to very high precision (Audi <italic>et al</italic>., <xref ref-type="bibr" rid="B1">2003</xref>) (see <xref ref-type="table" rid="T1">Table 1</xref> for the six elements described above). Note that unlike their mass, natural abundances of isotopes are not physical constants. Values may slightly vary depending on, say, the continent where a sample was taken.
<table-wrap id="T1" position="float"><label>Table 1.</label><caption><p>Natural isotopic distribution: relative abundance of isotopes and their masses in Dalton</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Element</th><th rowspan="1" colspan="1">Isotope</th><th rowspan="1" colspan="1">mass</th><th rowspan="1" colspan="1">Mass difference</th><th rowspan="1" colspan="1">Abundance (%)</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">Hydrogen</td><td rowspan="1" colspan="1"><sup>1</sup>H</td><td rowspan="1" colspan="1">1.007825</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">99.985</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>2</sup>H</td><td rowspan="1" colspan="1">2.014102</td><td rowspan="1" colspan="1">+1.006277</td><td rowspan="1" colspan="1">0.015</td></tr><tr><td rowspan="1" colspan="1">Carbon</td><td rowspan="1" colspan="1"><sup>12</sup>C</td><td rowspan="1" colspan="1">12.0</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">98.890</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>13</sup>C</td><td rowspan="1" colspan="1">13.003355</td><td rowspan="1" colspan="1">+1.003355</td><td rowspan="1" colspan="1">1.110</td></tr><tr><td rowspan="1" colspan="1">Nitrogen</td><td rowspan="1" colspan="1"><sup>14</sup>N</td><td rowspan="1" colspan="1">14.003074</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">99.634</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>15</sup>N</td><td rowspan="1" colspan="1">15.000109</td><td rowspan="1" colspan="1">+0.997035</td><td rowspan="1" colspan="1">0.366</td></tr><tr><td rowspan="1" colspan="1">Oxygen</td><td rowspan="1" colspan="1"><sup>16</sup>O</td><td rowspan="1" colspan="1">15.994915</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">99.762</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>17</sup>O</td><td rowspan="1" colspan="1">16.999132</td><td rowspan="1" colspan="1">+1.004217</td><td rowspan="1" colspan="1">0.038</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>18</sup>O</td><td rowspan="1" colspan="1">17.999161</td><td rowspan="1" colspan="1">+2.004246</td><td rowspan="1" colspan="1">0.200</td></tr><tr><td rowspan="1" colspan="1">Phosphor</td><td rowspan="1" colspan="1"><sup>31</sup>P</td><td rowspan="1" colspan="1">30.973762</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">100</td></tr><tr><td rowspan="1" colspan="1">Sulfur</td><td rowspan="1" colspan="1"><sup>32</sup>S</td><td rowspan="1" colspan="1">31.972071</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">95.020</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>33</sup>S</td><td rowspan="1" colspan="1">32.971459</td><td rowspan="1" colspan="1">+0.999388</td><td rowspan="1" colspan="1">0.750</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>34</sup>S</td><td rowspan="1" colspan="1">33.967867</td><td rowspan="1" colspan="1">+1.995796</td><td rowspan="1" colspan="1">4.210</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"><sup>36</sup>S</td><td rowspan="1" colspan="1">35.967081</td><td rowspan="1" colspan="1">+3.995010</td><td rowspan="1" colspan="1">0.020</td></tr></tbody></table></table-wrap></p>
    <p>The <italic>nominal mass</italic> (also called <italic>nucleon number</italic>) of a molecule is the sum of protons and neutrons of the constituting atoms. The <italic>mass</italic> of the molecule is the sum of masses of these atoms. Clearly, nominal mass and mass depend on the isotopes the molecule consists of, thus on the <italic>isotope species</italic> of the molecule. The isotope species where each atom is the isotope with the lowest nominal mass is called <italic>monoisotopic</italic>. Likewise, the mass of the monoisotopic species is called the <italic>monoisotopic mass</italic> of the molecule. Mass defects and, hence, differences from the ideal mass depend on the elemental composition of a molecule. For example, sucrose (C<sub>12</sub>H<sub>22</sub>O<sub>11</sub>) has monoisotopic mass 342.116215 Da; whereas, the short peptide Leu-Asn-Pro (C<sub>15</sub>H<sub>26</sub>N<sub>4</sub>O<sub>5</sub>) has monoisotopic mass 342.190321, while both molecules have monoisotopic nominal mass 342.</p>
    <p>The number of distinct isotope species for a molecule with <italic>i</italic><sub>H</sub> hydrogen, <italic>i</italic><sub>C</sub> carbon, <italic>i</italic><sub>N</sub> nitrogen, <italic>i</italic><sub>O</sub> oxygen, <italic>i</italic><sub>P</sub> phosphor and <italic>i</italic><sub>S</sub> sulfur atoms is <inline-formula><inline-graphic xlink:href="btn603i1.jpg"/></inline-formula>. This follows because for an element <italic>E</italic> with <italic>r</italic> isotope types, a molecule <italic>E<sub>l</sub></italic> consisting of <italic>l</italic> atoms of the element has <inline-formula><inline-graphic xlink:href="btn603i2.jpg"/></inline-formula> different isotope species. The probability that a certain isotope species occurs can be computed by multiplying the probabilities of the underlying isotopes.</p>
    <p>Even with high-resolution MS, it is often impossible to resolve isotope species with identical nominal mass. Instead, these isotope species appear as one single peak in the MS output. For this reason, we merge isotope species with identical nominal mass; we refer to the resulting distribution as the molecule's <italic>isotopic distribution</italic>.</p>
    <p>For each element <italic>E</italic> we define two discrete random variables, denoted <italic>X<sub>E</sub></italic> and <italic>Y<sub>E</sub></italic>, representing the mass and the mass number, respectively. For example, <italic>X</italic><sub>C</sub> with state space {12, 13.003355}, <italic>Y</italic><sub>C</sub> with state space {12,13} and ℙ(<italic>X</italic><sub>C</sub> = 12) = ℙ(<italic>Y</italic><sub>C</sub> = 12) = 0.98890, ℙ(<italic>X</italic><sub>C</sub> = 13.003355)=ℙ(<italic>Y</italic><sub>C</sub> = 13) = 0.01110 are the random variables of carbon. Given a molecule consisting of <italic>l</italic> atoms, we assign to the <italic>i</italic>-th atom, <italic>i</italic>=1,…,<italic>l</italic>, two random variables <italic>X<sub>i</sub></italic> and <italic>Y<sub>i</sub></italic>, where <italic>X<sub>i</sub></italic> ∼ <italic>X<sub>E</sub></italic> and <italic>Y<sub>i</sub></italic> ∼ <italic>Y<sub>E</sub></italic>, with <italic>E</italic> being the corresponding element. Now we can represent the molecule's <italic>mass distribution</italic> by the random variable <italic>X</italic> := <italic>X</italic><sub>1</sub> +…+ <italic>X<sub>l</sub></italic>, and its nominal mass distribution, or <italic>isotopic distribution</italic>, by <italic>Y</italic> := <italic>Y</italic><sub>1</sub> + … + <italic>Y<sub>l</sub></italic>. In an ideal mass spectrum, normalized peak intensities correspond to the isotopic distribution of the molecule. Note that <italic>X</italic> and <italic>Y</italic> are correlated, since <italic>X<sub>E</sub></italic> can be viewed as a function of <italic>Y<sub>E</sub></italic> and <italic>E</italic>.</p>
    <p>We refer to the peak at the monoisotopic mass as the monoisotopic peak, which is followed by the +1, +2, … peaks. What is the mass of the +k peak, which is a superposition of several isotope species? It is reasonable to assume that its mass is the mean mass of all isotope species that add to its intensity (Rockwood <italic>et al</italic>., <xref ref-type="bibr" rid="B15">2004</xref>): for a molecule with monoisotopic nominal mass <italic>N</italic>, let <italic>X</italic> = <italic>X</italic><sub>1</sub> + ··· + <italic>X<sub>l</sub></italic> be the mass distribution and <italic>Y</italic> = <italic>Y</italic><sub>1</sub> + ··· + <italic>Y<sub>l</sub></italic> be the isotopic distribution. The mean peak mass of the +k peak is then <italic>m<sub>k</sub></italic> = 𝔼(<italic>X</italic> | <italic>Y</italic>=<italic>N+k</italic>). We refer to the isotopic distribution together with the mean peak masses as the molecule's <italic>isotope pattern</italic>.</p>
  </sec>
  <sec sec-type="methods" id="SEC3">
    <title>3 METHODS AND ALGORITHMS</title>
    <sec id="SEC3.1">
      <title>3.1 Real-valued decompositions</title>
      <p>We first concentrate on the problem of decomposing the monoisotopic mass <italic>M</italic><sub>0</sub>. We want to find all molecules with monoisotopic mass in the interval [<italic>l,u</italic>] ⊆ ℝ where <italic>l</italic>:=<italic>M</italic><sub>0</sub>−ε and <italic>u</italic>:=<italic>M</italic><sub>0</sub>+ε for some measurement inaccuracy ε. Formally, we search for all solutions of the integer knapsack equation (Kellerer <italic>et al</italic>., <xref ref-type="bibr" rid="B9">2004</xref>)
<disp-formula id="M1"><label>(1)</label><graphic xlink:href="btn603m1.jpg" position="float"/></disp-formula>
where <italic>a<sub>j</sub></italic>, <italic>j</italic>=1,…,<italic>n</italic> are real-valued monoisotopic masses of elements satisfying <italic>a<sub>j</sub></italic> ≧ 0. We search for all solution vectors <italic>c</italic> = (<italic>c</italic><sub>1</sub>,…,<italic>c<sub>n</sub></italic>) such that all <italic>c<sub>j</sub></italic> are non-negative integers. We may assume <italic>a</italic><sub>1</sub> &lt; <italic>a</italic><sub>2</sub> &lt; … &lt; <italic>a<sub>n</sub></italic>.</p>
      <p>A straightforward solution is to enumerate all vectors <italic>c</italic> with <italic>c</italic><sub>1</sub>=0 and ∑<sub><italic>j</italic></sub> <italic>a<sub>j</sub> c<sub>j</sub></italic> ≤ <italic>u</italic> and next to test if there is some <italic>c</italic><sub>1</sub> ≧ 0 such that ∑<sub><italic>j</italic></sub> <italic>a<sub>j</sub> c<sub>j</sub></italic> ∈ [<italic>l,u</italic>]. This results in Θ(<italic>M</italic><sub>0</sub><sup><italic>n</italic>-1</sup>) running time, for constant element masses. Alternatively, we can compute all potential decompositions up to some upper bound <italic>U</italic> during preprocessing, sort them with respect to mass and use binary search; this results in Θ(<italic>U<sup>n</sup></italic>) space requirement. These approaches are unfavorable in theoretical complexity as well as in practice: for the elements CHNOPS there exist more than 7 × 10<sup>9</sup> molecular formulas with mass ≤1500 Da.</p>
      <p>In the remainder of this section, we transform the integer knapsack problem with real-valued coefficients into a problem instance with <italic>integer</italic> coefficients. We will show in the next section how to efficiently solve such instances. Choosing a <italic>blowup factor b</italic> ∈ ℝ, corresponding to precision 1/<italic>b</italic>, we can round coefficients by ϕ(<italic>x</italic>) := ⌈ <italic>bx</italic> ⌉, so <inline-formula><inline-graphic xlink:href="btn603i3.jpg"/></inline-formula> and <italic>l</italic>′ := ϕ(<italic>l</italic>), <italic>u</italic>′ := ϕ(<italic>u</italic>) form an integer knapsack. Precision 1/<italic>b</italic> is merely a parameter of the decomposition algorithm and in principle independent of the measurement mass accuracy ε. To avoid rounding error accumulation, precision is usually set one to two orders of magnitude smaller than the measurement accuracy. Now, certain solutions <italic>c</italic> of the integer coefficient knapsack are no solutions of the real-valued coefficient knapsack and vice versa. We can easily sort out false positive solutions by checking (1), resulting in additional running time. We now concentrate on the more intriguing problem of false negative solutions that are missed by the integer coefficient knapsack.</p>
      <p>Clearly ∑<sub><italic>j</italic></sub> <italic>a<sub>j</sub> c<sub>j</sub></italic> ≧ <italic>l</italic> implies <inline-formula><inline-graphic xlink:href="btn603i4.jpg"/></inline-formula> since all <inline-formula><inline-graphic xlink:href="btn603i5.jpg"/></inline-formula> are integers. We have to increase the upper bound <italic>u</italic>′ to guarantee that all solutions of (1) are generated. We define relative rounding errors
<disp-formula><graphic xlink:href="btn603um1.jpg" position="float"/></disp-formula>
and note that <inline-formula><inline-graphic xlink:href="btn603i6.jpg"/></inline-formula>. Let Δ = Δ(<italic>b</italic>) := max {Δ<sub><italic>j</italic></sub>}. If <italic>c</italic> satisfies ∑<sub><italic>j</italic></sub> <italic>a<sub>j</sub> c<sub>j</sub></italic> ≤ <italic>u</italic> then <inline-formula><inline-graphic xlink:href="btn603i7.jpg"/></inline-formula>: clearly, <inline-formula><inline-graphic xlink:href="btn603i8.jpg"/></inline-formula> and our claim follows from
<disp-formula><graphic xlink:href="btn603um2.jpg" position="float"/></disp-formula>
One can easily check that this bound is tight. So, we re-define the integer interval by <italic>u</italic>′ := ⌊<italic>bu</italic> + Δ <italic>u</italic> ⌋. Without rounding correction we have to decompose (<italic>u</italic>−<italic>l</italic>) <italic>b</italic> integers, but rounding correction forces us to decompose an additional Δ <italic>u</italic> integers, independent of the interval size <italic>u</italic>−<italic>l</italic>. As an example, consider the elements CHNOPS and blowup factor <italic>b</italic> = 10<sup>5</sup>, then Δ(<italic>b</italic>) = Δ<sub>H</sub> (<italic>b</italic>) = 0.492936. So for <italic>M</italic><sub>0</sub> = 1000, we have to decompose an additional 492 integers. Clearly, increasing <italic>b</italic> usually decreases Δ(<italic>b</italic>). We stress that the running time of this approach is dominated by the number of <italic>decompositions</italic> of these integers, and not by the number of integers itself.</p>
    </sec>
    <sec id="SEC3.2">
      <title>3.2 Integer decompositions</title>
      <p>Assume that both the element masses <italic>a</italic><sub>1</sub>,…,<italic>a<sub>n</sub></italic> and the query mass <italic>m</italic> are positive integers. We are looking for all non-negative integer vectors (<italic>c</italic><sub>1</sub>,…,<italic>c<sub>n</sub></italic>) satisfying (1) (with <italic>l</italic> = <italic>u</italic> = <italic>m</italic>). This is a well-studied problem, referred to in its different variants as Coin Change Problem, Change Making Problem or Money Changing Problem, and can be solved with a simple dynamic programming algorithm in pseudo-polynomial time (Martello and Toth, <xref ref-type="bibr" rid="B13">1990</xref>). The main disadvantage of this approach is rather large memory requirement, which again depends on the maximal mass <italic>U</italic> we want to decompose.</p>
      <p>Böcker and Lipták (<xref ref-type="bibr" rid="B3">2007</xref>) present an algorithm for determining all such decompositions with running time <italic>O</italic>(<italic>na</italic><sub>1</sub> · γ(<italic>m</italic>)) and space <italic>O</italic>(<italic>na</italic><sub>1</sub>), where <italic>a</italic><sub>1</sub> is the smallest mass and γ(<italic>m</italic>) the number of decompositions of mass <italic>m</italic>. We briefly sketch the algorithm. Given integer masses <italic>a</italic><sub>1</sub> ≤ … ≤ <italic>a<sub>n</sub></italic>, a data structure of size <italic>na</italic><sub>1</sub>, referred to as <italic>Extended Residue Table</italic> (ER table), is computed in a preprocessing step. Entry ER(<italic>r,i</italic>), for <italic>r</italic>=0,…, <italic>a</italic><sub>1</sub>−1 and <italic>i</italic>=1,…,<italic>n</italic>, is the smallest number congruent <italic>r</italic> modulo <italic>a</italic><sub>1</sub> which is decomposable over <italic>a</italic><sub>1</sub>,…,<italic>a<sub>i</sub></italic>. Thus, the last column ER(·,<italic>n</italic>) of the table gives, for each residue <italic>r</italic>, the smallest number congruent <italic>r</italic> modulo <italic>a</italic><sub>1</sub> that is decomposable over <italic>a</italic><sub>1</sub>,…,<italic>a<sub>n</sub></italic>. Computation time is <italic>O</italic>(<italic>na</italic><sub>1</sub>). All decompositions of the query <italic>m</italic> are then recursively generated, limiting the number of unsuccessful paths by using information from the ER table. As a result, the running time of the algorithm is proportional only to the size of the table <italic>na</italic><sub>1</sub> and the number of decompositions γ(<italic>m</italic>), and does not depend directly on the input <italic>m</italic>. For decomposing molecule masses, this decomposition technique has several advantages over classical dynamic programming, such as improved running times and preprocessing independent of the largest mass we want to decompose in the future. Regarding the application of decomposing molecule masses, this approach uses only one fifteenth of memory and shows better running times.</p>
      <p>The number of decompositions γ(<italic>m</italic>) for an integer mass <italic>m</italic> over coprime integers <italic>a</italic><sub>1</sub>,…,<italic>a<sub>n</sub></italic> asymptotically behaves like a polynomial of degree <italic>n</italic>−1 in <italic>m</italic> (Wilf, <xref ref-type="bibr" rid="B17">1990</xref>). Following Beck <italic>et al</italic>. (<xref ref-type="bibr" rid="B2">2001</xref>), we can approximate the number of molecules over the elements CHNOPS with <italic>real mass</italic> in the interval [<italic>M,M</italic>+ϵ] by
<disp-formula id="M2"><label>(2)</label><graphic xlink:href="btn603m2.jpg" position="float"/></disp-formula>
We can also approximate the number of molecules with mass <italic>up to M</italic> by integrating (2). In <xref ref-type="fig" rid="F1">Figure 1</xref>, we plot the number of decompositions for masses of up to 1500 Da over the elements CHNOPS.
<fig id="F1" position="float"><label>Fig. 1.</label><caption><p>Number of decompositions over the elements CHNOPS for intervals of width 0.001 Da. Minima and maxima taken in intervals of width 1 Da. True number of decompositions in comparison with approximate (2) (approx). As is shown in the inlay, γ(<italic>m</italic>) varies with a periodic function of period ∼1 Da.</p></caption><graphic xlink:href="btn603f1"/></fig></p>
    </sec>
    <sec id="SEC3.3">
      <title>3.3 Simulating isotope patterns</title>
      <p>We first observe that for elements CHNOPS, all molecules have isotopic distributions that decrease rapidly with increasing mass. In particular, we can restrict ourselves to computing the first <italic>K</italic> non-zero values of the distribution, for rather small <italic>K</italic> such as <italic>K</italic>=10. For example, amongst 11 479 entries in the KEGG COMPOUND database with mass ≤3000 Da, no molecule has intensity of the +10 peak larger than 0.00007.</p>
      <p>The atoms hydrogen, carbon and nitrogen have only two natural isotopes. Thus, the isotopic distribution of a molecule <italic>E<sub>l</sub></italic> consisting of <italic>l</italic> identical atoms of type <italic>E</italic> with <italic>E</italic> ∈ {H,C,N} follows a binomial distribution: let <italic>q<sub>k</sub></italic> denote the probability that <italic>E<sub>l</sub></italic> has nominal mass <italic>N</italic>+<italic>k</italic>, where <italic>N</italic> is the monoisotopic nominal mass of <italic>E<sub>l</sub></italic>. Then, <inline-formula><inline-graphic xlink:href="btn603i9.jpg"/></inline-formula>, where <italic>p</italic> is the probability of the monoisotopic isotope. The values of the <italic>q<sub>k</sub></italic> can be computed iteratively, since <inline-formula><inline-graphic xlink:href="btn603i10.jpg"/></inline-formula> for <italic>k</italic>≧ 0, thus computation time is <italic>O</italic>(<italic>K</italic>).</p>
      <p>Where an element <italic>E</italic> has <italic>r</italic>&gt;2 isotopes (such as oxygen and sulfur), the isotopic distribution of <italic>E<sub>l</sub></italic> can in theory be computed as follows: let <italic>p<sub>i</sub></italic> for <italic>i</italic>=0,…,<italic>r</italic>−1 denote the probability of occurrence of the <italic>i</italic>-th isotope. Then, the probability that <italic>E<sub>l</sub></italic> has nominal mass <italic>N</italic>+<italic>k</italic> is <inline-formula><inline-graphic xlink:href="btn603i11.jpg"/></inline-formula>, where the sum runs over all <italic>l</italic><sub>0</sub>,…,<italic>l</italic><sub><italic>r</italic>−1</sub> ≧ 0 satisfying <inline-formula><inline-graphic xlink:href="btn603i12.jpg"/></inline-formula> and <inline-formula><inline-graphic xlink:href="btn603i13.jpg"/></inline-formula> <inline-formula><inline-graphic xlink:href="btn603i14.jpg"/></inline-formula> (Hsu, <xref ref-type="bibr" rid="B6">1984</xref>). However, this computation is infeasible in practice.</p>
      <p>Given two discrete random variables <italic>Y</italic> and <italic>Y</italic>′ with state spaces Ω,Ω′ ⊆ ℕ, we can compute the distribution of the random variable <italic>Z</italic> := <italic>Y</italic>+<italic>Y</italic>′ by folding the distributions,
<disp-formula><graphic xlink:href="btn603um3.jpg" position="float"/></disp-formula>
If we restrict ourselves to the first <italic>K</italic> values of this distribution, we can compute it in time <italic>O</italic>(<italic>K</italic><sup>2</sup>). Kubinyi (<xref ref-type="bibr" rid="B12">1991</xref>) suggests to compute the isotopic distributions of oxygen O<sub><italic>l</italic></sub> and sulfur S<sub><italic>l</italic></sub> by successive folding of the respective distribution: using a Russian multiplication scheme for the folding, this results in an algorithm with running time <italic>O</italic>(<italic>K</italic><sup>2</sup> log <italic>l</italic>). In applications, we do not compute these distributions on the fly but during preprocessing, for all <italic>l</italic>≤<italic>L</italic> fixed. This results in <italic>O</italic>(<italic>KL</italic>) memory for every such element, where <italic>l</italic> is small: The 128 oxygen atoms already have mass of about 2048 Da, exceeding the relevant mass range. For molecules consisting of different elements, we first compute or look up the isotopic distributions of the individual elements, and then combine these distributions by folding in <italic>O</italic>(<italic>n</italic> · K<sup>2</sup>) time.</p>
      <p>Using Fourier transforms of isotope distributions, we can multiply Fourier transforms instead of folding these distributions (Rockwood and Van Orden, <xref ref-type="bibr" rid="B14">1996</xref>). Doing so we can eventually replace the <italic>K</italic><sup>2</sup> factor in the algorithm's running time by a <italic>K</italic>log<italic>K</italic> factor. As we limit our attention to small <italic>K</italic> such as <italic>K</italic>=10, this will not result in a speedup of the algorithm in practice. Also, this approach may face the problem of numerical errors.</p>
      <p>We now come to the more challenging problem of efficiently computing the mean peak masses of a distribution. Doing so using the definition <italic>m<sub>k</sub></italic> =𝔼(<italic>X</italic> | <italic>Y</italic>=<italic>N</italic>+<italic>k</italic>) is highly inefficient, because we have to sum up over all isotope species. Pruning strategies have been developed to speed up computation (Yergey, <xref ref-type="bibr" rid="B18">1983</xref>), but pruning leads to a loss of accuracy (Rockwood <italic>et al</italic>., <xref ref-type="bibr" rid="B15">2004</xref>). We now present a simple recurrence for computing these masses analogous to the folding of distributions: let <italic>Y</italic> = Y<sub>1</sub> + ··· + <italic>Y<sub>l</sub></italic> and <inline-formula><inline-graphic xlink:href="btn603i15.jpg"/></inline-formula> be isotopic distributions of two molecules with monoisotopic nominal masses <italic>N</italic> and <italic>N</italic>′, respectively. Let <italic>p<sub>k</sub></italic> := ℙ(<italic>Y</italic> = <italic>N</italic>+<italic>k</italic>) and <italic>q<sub>k</sub></italic> := ℙ(<italic>Y</italic>′ = <italic>N</italic>′′<italic>k</italic>) denote the corresponding probabilities, <italic>m<sub>k</sub></italic> and <inline-formula><inline-graphic xlink:href="btn603i16.jpg"/></inline-formula> the mean peak masses of the +k peaks. Consider the random variable <italic>Z</italic> = <italic>Y</italic> + <italic>Y</italic>′ with monoisotopic nominal mass Ñ = <italic>N</italic>+<italic>N</italic>′.</p>
      <statement>
        <title>T<sc>heorem</sc> 1.</title>
        <p>
          <italic>The mean peak mass <inline-formula><inline-graphic xlink:href="btn603i17.jpg"/></inline-formula> of the +k peak of the random variable <italic>Z</italic> = <italic>Y</italic> + <italic>Y</italic>′ can be computed as:</italic>
          <disp-formula id="M3">
            <label>(3)</label>
            <graphic xlink:href="btn603m3.jpg" position="float"/>
          </disp-formula>
        </p>
      </statement>
      <p>Note that <inline-formula><inline-graphic xlink:href="btn603i18.jpg"/></inline-formula>. Since by independence, ℙ(<italic>Y</italic><sub>1</sub>=<italic>N</italic><sub>1</sub>,…,<italic>Y<sub>l</sub></italic>=<italic>N<sub>l</sub></italic>) = ∏<sub><italic>i</italic></sub> ℙ(<italic>Y<sub>i</sub></italic>=<italic>N<sub>i</sub></italic>), the theorem follows by rearranging summands. We omit the formal proof.</p>
      <p>The theorem allows us to ‘fold’ mean peak masses of two distributions to compute the mean peak masses of their sum. This implies that we can compute mean peak masses as efficiently as the distribution itself. This improves on the previously best known method (Rockwood <italic>et al</italic>., <xref ref-type="bibr" rid="B15">2004</xref>), replacing the linear running time dependence on the number of atoms by its logarithm.</p>
    </sec>
    <sec id="SEC3.4">
      <title>3.4 Scoring candidate molecules</title>
      <p>We want to discriminate between (tens of thousands of) candidate molecules generated by decomposing the monoisotopic mass. To this end, we compare the simulated isotopic distribution with the measured peaks. Matching peak pairs between the spectra is trivial for this application.</p>
      <p>Zhang and Chait (<xref ref-type="bibr" rid="B21">2000</xref>) and Zhang <italic>et al</italic>. (<xref ref-type="bibr" rid="B20">2002</xref>) suggest to use Bayesian Statistics to evaluate mass spectra matches:
<disp-formula id="M4"><label>(4)</label><graphic xlink:href="btn603m4.jpg" position="float"/></disp-formula>
where 𝒟 is the data (the measured spectrum), ℳ<sub><italic>i</italic></sub> are the models (the candidate molecules) and ℬ stands for any prior background information.</p>
      <p>Regarding this background information, we set the prior probability ℙ(ℳ<sub><italic>j</italic></sub> | ℬ) to zero for all molecules but the decompositions of the monoisotopic mass. We also assign prior probability zero to molecular formulas that cannot correspond to a molecule, because of chemical considerations: Senior's third theorem states that the sum of valences has to be greater than or equal to twice the number of atoms minus one (Senior, <xref ref-type="bibr" rid="B16">1951</xref>). Molecules violating Seniors third theorem are rare, particularly for natural compounds: in the KEGG COMPOUND database, &lt;0.16% of substances violate this rule. We also filter out radicals with odd sum of valences. We refrain from using further priors such as the hetero-to-carbon ratio (Kind and Fiehn, <xref ref-type="bibr" rid="B11">2007</xref>) because this might rather reproduce what is already known.</p>
      <p>Next, we assign probabilities to the observed masses and intensities. Assuming independence (in particular from background information) we calculate
<disp-formula id="M5"><label>(5)</label><graphic xlink:href="btn603m5.jpg" position="float"/></disp-formula>
Here, ℙ(<italic>M<sub>j</sub></italic>|<italic>m<sub>j</sub></italic>) is the probability to observe peak <italic>j</italic> at mass <italic>M<sub>j</sub></italic> when its true mass is <italic>m<sub>j</sub></italic>, and ℙ(<italic>f<sub>j</sub></italic>|<italic>p<sub>j</sub></italic>) is the probability to observe peak <italic>j</italic> with intensity <italic>f<sub>j</sub></italic> when its true intensity is <italic>p<sub>j</sub></italic>. Clearly, the independence of peak intensities is violated because these intensities sum to one, but this product can be seen as a rough estimate of the true probability.</p>
      <p>Mass spectrometrists assume that the mass error of a device is roughly normally distributed with mean zero. If the mass accuracy α of the measurement (in p.p.m.) is given, then we can set the standard deviation <inline-formula><inline-graphic xlink:href="btn603i19.jpg"/></inline-formula> for peak <italic>j</italic>, assuming that &gt;99.7% of measurements fall into the specified mass range. But we also observe that peaks of low intensity show less mass accuracy than those with high intensity, which can be attributed to the difficulties of separating a peak of low intensity from the background noise. Our data indicate a roughly linear dependence between peak intensity and mass accuracy. To this end, two mass accuracies α<sub>1</sub> (at full intensity) and α<sub>0</sub> (at minimal intensity) are provided by the user, and we set
<disp-formula><graphic xlink:href="btn603um4.jpg" position="float"/></disp-formula>
We want to estimate the probability that, given a peak with true mass <italic>M<sub>j</sub></italic>, a peak at mass <italic>M<sub>j</sub></italic> is observed in the measured spectrum: more precisely, the probability of observing a mass difference of |<italic>M<sub>j</sub></italic>−<italic>m<sub>j</sub></italic>| or larger. We can compute this probability using the complementary error function ‘erfc’:
<disp-formula id="M6"><label>(6)</label><graphic xlink:href="btn603m6.jpg" position="float"/></disp-formula>
with <inline-formula><inline-graphic xlink:href="btn603i20.jpg"/></inline-formula>.</p>
      <p>Even for high-resolution MS, spectra show a systematic mass shift due to calibration inaccuracies. We can easily eliminate this shift for all masses but the monoisotopic mass: we do not compare masses of the +1, … peaks directly but instead the difference to the monoisotopic peak, <italic>M<sub>j</sub></italic> − <italic>M<sub>0</sub></italic> versus <italic>m<sub>j</sub></italic> − <italic>m</italic><sub>0</sub> for <italic>j</italic> ≧ 1.</p>
      <p>Regarding peak intensities, we have to cope with a systematic error in the measured spectra: we observe in our data that peaks of low intensity are under-estimated in the measured spectrum, whereas peaks of high intensity are over-estimated, (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btn603/DC1">Supplementary Fig. 1</ext-link>). We ascribe this problem to inaccurate peak intensity determination: vendor software estimates peak intensities as signal-to-noise ratio or height above some baseline. The baseline, in turn, is determined using several <italic>ad hoc</italic> rules, and its estimate can be inaccurate. Unfortunately, such inaccuracies have unequal effects on peaks of different intensities. We correct this error by adding some user-defined parameter <italic>off</italic> to the measured intensities <italic>f<sub>i</sub></italic>, and by subsequent re-normalization. We found that for both of our datasets, the same parameter <italic>off</italic> = +0.02 leads to excellent results.</p>
      <p>Computation of ℙ(<italic>f<sub>j</sub></italic>|<italic>p<sub>j</sub></italic>) is done analogously to that of ℙ(<italic>M<sub>j</sub></italic>|<italic>m<sub>j</sub></italic>). Our data indicates that after correction, log ratios between measured and predicted peak intensity log (<italic>f<sub>j</sub></italic>/<italic>p<sub>j</sub></italic>) roughly follow a normal distribution. Again, precision parameters β<sub>1</sub> (at full intensity) and β<sub>0</sub> (at minimal intensity) are provided by the user (in percent). We compute
<disp-formula><graphic xlink:href="btn603um5.jpg" position="float"/></disp-formula>
as our precision interval, such that &gt;99.7% of log intensity ratios log (<italic>f<sub>j</sub></italic>/<italic>p<sub>j</sub></italic>) fall into the range <inline-formula><inline-graphic xlink:href="btn603i21.jpg"/></inline-formula>. Now, ℙ(<italic>f<sub>j</sub></italic>|<italic>p<sub>j</sub></italic>) can be estimated analogously to (6).</p>
    </sec>
  </sec>
  <sec sec-type="results" id="SEC4">
    <title>4 EXPERIMENTAL RESULTS</title>
    <sec id="SEC4.1">
      <title>4.1 Datasets</title>
      <p>To evaluate our method we used two datasets measured on two instruments. Mass spectra with single charge were measured from several organic (macro)molecules, composed of the elements CHNOPS. For every such spectrum, the sum formula of the sample molecule is known. The spectra were acquired over a period of 2 years; the molecules range in mass from 117 Da to ∼1000 Da. Peak detection and estimation of peak masses and intensities were conducted using vendor software.</p>
      <p>The first dataset consists of 153 mass spectra. Electrospray ionization (ESI) experiments were performed using the Fourier Transform Ion Cyclotron Resonance (FT-ICR) mass spectrometer APEX III (Bruker Daltonik GmbH, Bremen, Germany). The FT-MS was equipped with a 7.0 T, 160 mm bore superconducting magnet, infinity cell and interfaced to an external (nano)ESI ion source. All mass spectra were externally mass calibrated. The five analysis parameters were chosen as α<sub>1</sub> = 3, α<sub>0</sub> = 6, β<sub>1</sub> = 10, β<sub>0</sub> = 90 and <italic>off</italic> = +0.02.</p>
      <p>The second dataset consists of 86 mass spectra. ESI experiments were performed using the oa-TOF mass spectrometer MicrOTOF (Bruker Daltonik GmbH, Bremen, Germany). Quasi-internal mass calibration was used, by measurement of an infused calibrant prior to the compound of interest. For the oa-TOF analysis, we set α<sub>1</sub> = 5, α<sub>0</sub> = 6.5, β<sub>1</sub> = 10, β<sub>0</sub> = 90 and again <italic>off</italic> = +0.02.</p>
    </sec>
    <sec id="SEC4.2">
      <title>4.2 Identification accuracy</title>
      <p>Every input ‘mass spectrum’ consists of masses <italic>M</italic><sub>0</sub>,…,<italic>M<sub>k</sub></italic> and intensities <italic>f</italic><sub>0</sub>,…,<italic>f<sub>k</sub></italic>. For every such spectrum, we computed all molecules such that the monoisotopic mass <italic>M</italic><sub>0</sub> has relative mass difference of at most α<sub>1</sub> p.p.m. Next, we discarded molecules violating Senior's third theorem and radicals with odd sum of valences. For each remaining molecule, we computed its theoretical isotopic distribution (with <italic>K</italic>=10) and compared it to the measured isotopic distribution. We ranked the molecules according to resulting probabilities. We did not use any other background information to identify the molecule.</p>
      <p>For the 153 mass spectra in our FT-ICR dataset, 89 resulted in a correct identification; in 86% of the mass spectra, the correct interpretation was found in the TOP 10 explanations. There is a clear correlation between mass and identification accuracy, confer <xref ref-type="table" rid="T2">Table 2</xref>. For mass spectra ≤700 Da, the true interpretation was always found in the TOP 10 explanations, except in one case where it had rank 13. For 86 mass spectra in the oa-TOF dataset, the correct sum formula was found in the TOP 10 interpretations in all but two cases. Moreover, 79 out of 86 compounds were correctly identified, which correspond to an identification rate of &gt;90%, (<xref ref-type="table" rid="T2">Table 2</xref>). Better identification results on the oa-TOF dataset with lower mass accuracy show the crucial importance of including intensity measurements into the candidate evaluation. We note that the intensity accuracy of the oa-TOF instrument is significantly higher than that of the FT-ICR. We have also tested the variation of identification rates with different scoring parameters: identification results are relatively stable for small disturbances of parameter values, see <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btn603/DC1">supplementary material</ext-link>. Parameter estimation could be automated using a small training set. We are planning to include this feature in future implementations.
<table-wrap id="T2" position="float"><label>Table 2.</label><caption><p>Number of correct sum formulas at certain positions of the output list, for the FT-ICR dataset and the oa-TOF dataset</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Mass range</th><th rowspan="1" colspan="1">No. sp.</th><th colspan="5" rowspan="1">Rank in output list<hr/></th><th colspan="3" rowspan="1">No. sum formulas<hr/></th><th rowspan="1" colspan="1"/></tr><tr><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1">1</th><th rowspan="1" colspan="1">2</th><th rowspan="1" colspan="1">3–5</th><th rowspan="1" colspan="1">6–10</th><th rowspan="1" colspan="1">11+</th><th rowspan="1" colspan="1">Int.</th><th rowspan="1" colspan="1">Real</th><th rowspan="1" colspan="1">Chem.</th><th rowspan="1" colspan="1">Time</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">FT-ICR dataset</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/></tr><tr><td rowspan="1" colspan="1">200–300</td><td rowspan="1" colspan="1">13</td><td rowspan="1" colspan="1">11</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">67</td><td rowspan="1" colspan="1">37.2</td><td rowspan="1" colspan="1">8.6</td><td rowspan="1" colspan="1">1.5</td></tr><tr><td rowspan="1" colspan="1">300–400</td><td rowspan="1" colspan="1">37</td><td rowspan="1" colspan="1">28</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">200</td><td rowspan="1" colspan="1">109</td><td rowspan="1" colspan="1">10.4</td><td rowspan="1" colspan="1">4.3</td></tr><tr><td rowspan="1" colspan="1">400–500</td><td rowspan="1" colspan="1">57</td><td rowspan="1" colspan="1">39</td><td rowspan="1" colspan="1">6</td><td rowspan="1" colspan="1">6</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">579.5</td><td rowspan="1" colspan="1">318.2</td><td rowspan="1" colspan="1">22.8</td><td rowspan="1" colspan="1">13.5</td></tr><tr><td rowspan="1" colspan="1">500–600</td><td rowspan="1" colspan="1">7</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1800.4</td><td rowspan="1" colspan="1">990.3</td><td rowspan="1" colspan="1">59.6</td><td rowspan="1" colspan="1">40.1</td></tr><tr><td rowspan="1" colspan="1">600–700</td><td rowspan="1" colspan="1">4</td><td rowspan="1" colspan="1">3</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">2668.5</td><td rowspan="1" colspan="1">1454</td><td rowspan="1" colspan="1">37.3</td><td rowspan="1" colspan="1">55</td></tr><tr><td rowspan="1" colspan="1">700–800</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">8797.8</td><td rowspan="1" colspan="1">4812</td><td rowspan="1" colspan="1">247</td><td rowspan="1" colspan="1">232</td></tr><tr><td rowspan="1" colspan="1">800–900</td><td rowspan="1" colspan="1">14</td><td rowspan="1" colspan="1">3</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">3</td><td rowspan="1" colspan="1">5</td><td rowspan="1" colspan="1">14781.6</td><td rowspan="1" colspan="1">8101</td><td rowspan="1" colspan="1">534.6</td><td rowspan="1" colspan="1">485</td></tr><tr><td rowspan="1" colspan="1">900–1000</td><td rowspan="1" colspan="1">16</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">13</td><td rowspan="1" colspan="1">31805.7</td><td rowspan="1" colspan="1">17448</td><td rowspan="1" colspan="1">1570</td><td rowspan="1" colspan="1">1281</td></tr></tbody></table><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Mass range</th><th rowspan="1" colspan="1">No. sp.</th><th colspan="3" rowspan="1">Rank<hr/></th><th colspan="3" rowspan="1">No. sum formulas<hr/></th><th rowspan="1" colspan="1"/></tr><tr><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1">1</th><th rowspan="1" colspan="1">2–6</th><th rowspan="1" colspan="1">11+</th><th rowspan="1" colspan="1">Int.</th><th rowspan="1" colspan="1">Real</th><th rowspan="1" colspan="1">Chem.</th><th rowspan="1" colspan="1">Time</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">oa- TOF dataset</td><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1"/></tr><tr><td rowspan="1" colspan="1">100–200</td><td rowspan="1" colspan="1">7</td><td rowspan="1" colspan="1">7</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">11.3</td><td rowspan="1" colspan="1">7.4</td><td rowspan="1" colspan="1">1.9</td><td rowspan="1" colspan="1">0</td></tr><tr><td rowspan="1" colspan="1">200–300</td><td rowspan="1" colspan="1">21</td><td rowspan="1" colspan="1">21</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">60.1</td><td rowspan="1" colspan="1">40.1</td><td rowspan="1" colspan="1">4.6</td><td rowspan="1" colspan="1">1.4</td></tr><tr><td rowspan="1" colspan="1">300–400</td><td rowspan="1" colspan="1">27</td><td rowspan="1" colspan="1">26</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">297.8</td><td rowspan="1" colspan="1">199.7</td><td rowspan="1" colspan="1">22.6</td><td rowspan="1" colspan="1">8.1</td></tr><tr><td rowspan="1" colspan="1">400–500</td><td rowspan="1" colspan="1">15</td><td rowspan="1" colspan="1">14</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">725.6</td><td rowspan="1" colspan="1">484.1</td><td rowspan="1" colspan="1">32.4</td><td rowspan="1" colspan="1">17.3</td></tr><tr><td rowspan="1" colspan="1">500–600</td><td rowspan="1" colspan="1">10</td><td rowspan="1" colspan="1">7</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1479.1</td><td rowspan="1" colspan="1">988.9</td><td rowspan="1" colspan="1">54.3</td><td rowspan="1" colspan="1">36</td></tr><tr><td rowspan="1" colspan="1">600–700</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">4600</td><td rowspan="1" colspan="1">3080</td><td rowspan="1" colspan="1">276</td><td rowspan="1" colspan="1">130</td></tr><tr><td rowspan="1" colspan="1">700–800</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">10336</td><td rowspan="1" colspan="1">6909</td><td rowspan="1" colspan="1">578</td><td rowspan="1" colspan="1">461</td></tr><tr><td rowspan="1" colspan="1">800–900</td><td rowspan="1" colspan="1">3</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">0</td><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">18172.3</td><td rowspan="1" colspan="1">12146</td><td rowspan="1" colspan="1">914.3</td><td rowspan="1" colspan="1">757</td></tr></tbody></table><table-wrap-foot><fn><p>We report the number of spectra in this mass range (no. sp.), as well as the average number of sum formulas over all molecules in the mass range (no. sum formulas). We distinguish between the number of integer decompositions (int.), the number of real decompositions (real) and the number of those sum formulas that pass Senior's third theorem (chem.). Finally, we give the average running time in milliseconds per spectrum (time).</p></fn></table-wrap-foot></table-wrap></p>
    </sec>
    <sec id="SEC4.3">
      <title>4.3 Running times</title>
      <p>We analyzed all 239 mass spectra on a Pentium M 1.5 GHz processor with blowup <italic>b</italic> = 5 × 10<sup>4</sup>, using only a few Megabyte of memory. This results in running times of &lt;1.3s per spectrum for the complete analysis of one mass spectrum. Clearly, running times depend on molecule masses, see again <xref ref-type="table" rid="T2">Table 2</xref>. Increasing the blowup beyond 5 × 10<sup>4</sup> increased running times, presumably because the smaller table can be kept in the processor cache.</p>
    </sec>
  </sec>
  <sec id="SEC5">
    <title>5 IMPLEMENTATION</title>
    <p>We have developed a java-based graphical tool called SIRIUS. At the SIRIUS core lie efficient algorithms for generating all elemental compositions for a given mass and error, calculating isotope patterns for all chemically relevant compositions, and matching and ranking the candidate molecules against the input spectrum. SIRIUS combines these algorithms with a powerful graphical user interface. An extensive management system allows simplified data handling and offers an easy way to integrate new algorithms and data structures into the framework. Through a user-friendly interface, SIRIUS allows the user to import datasets in most common mass spectrometry file formats. It supports automatic recognition of molecular ion adducts present in the input spectrum, handy visualization of identified sum formulas and their isotope patterns and customizable export of identification results to common human-readable file formats. Finally, the software provides a basic functionality to search for sum formulas identified by the algorithm in NCBI PubChem Database.<xref ref-type="fn" rid="FN2"><sup>1</sup></xref></p>
    <p>Preparation of a new analysis run can be divided into the following steps: initializing input data and instrument parameters, setting up algorithm parameters and extracting isotope patterns from the input peaklist. Input peaklist and machine settings can be reused for multiple analyses on the same data. SIRIUS provides the user with reasonable default values for algorithm parameters. The program also offers to save all algorithm and mass spectrometer settings. To this end, SIRIUS creates a persistent workspace that can be used to store local settings and to automatically reload them on request.</p>
    <p>We use the ProteomeCommons.org IO Framework (Falkner <italic>et al</italic>., <xref ref-type="bibr" rid="B5">2007</xref>) to import mass spectrometry data, which allows reading most MS data formats including mzData and mzXML. We parse the peaklist and divide it into signal groups related to different compounds. A peaklist can also contain several signal groups belonging to the same compound, modified by different molecular ion adducts. Identifying modifications is done by calculating mass differences between monoisotopic peak masses. In view of the small number of adducts, we apply a simple exhaustive search to find all matching mass differences. If there is no prior knowledge on the source of modification, the user can choose one or more adduct types for an isotope pattern.</p>
    <p>The output of the algorithm is a list of candidate sum formulas for each compound. Sum formulas are listed in the summary table, sorted in decreasing order of likelihoods. To view an entry in more detail, the user can select and compare theoretical and measured isotope patterns visually, (<xref ref-type="fig" rid="F2">Fig. 2</xref>). Analysis results can be exported to the application workspace and opened for further evaluation. Export file formats include plain text, PDF and XML documents.
<fig id="F2" position="float"><label>Fig. 2.</label><caption><p>Screenshot of the SIRIUS software, available from <ext-link ext-link-type="uri" xlink:href="http://bio.informatik.uni-jena.de/sirius">http://bio.informatik.uni-jena.de/sirius</ext-link>.</p></caption><graphic xlink:href="btn603f2"/></fig></p>
  </sec>
  <sec sec-type="conclusions" id="SEC6">
    <title>6 CONCLUSION</title>
    <p>We presented an approach to determine the sum formula of an unknown metabolite solely from its high-resolution isotope pattern. Our approach allows us to reduce the number of potential sum formulas to only a few candidates; in many cases we were able to determine the correct molecular formula. The approach is time- and memory-efficient and can be executed on a regular desktop PC. We further presented methods for the efficient simulation of isotope patterns. This is vital for larger molecules where the search space increases rapidly.</p>
    <p>Results on experimental data clearly show the potential of our approach, in particular for oa-TOF data. In our evaluation, we have deliberately ignored some information such as prior probability of the elements or hetero-to-carbon ratio (Kind and Fiehn, <xref ref-type="bibr" rid="B11">2007</xref>). We believe that such information should rather be used in a ‘post-processing’ step by an expert, instead of automatically filtering out certain sum formulas a priori. Finally, we introduced a user-friendly software called SIRIUS, which implements all of the methods presented.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>[Supplementary Data]</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="btn603_index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="btn603_1.pdf"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="x-zip-compressed" xlink:href="btn603_bioinf-2008-1396-File009.gz"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>ACKNOWLEDGEMENTS</title>
    <p>Additional programming by Martin Engler. We thank Dr H. Luftmann, Universität Münster, Organisch-Chemisches Institut, for making available the oa-TOF dataset and an anonymous referee for helpful comments.</p>
    <p><italic>Funding</italic>: Deutsche Forschungsgemeinschaft (BO 1910/1 to A.P.); Alexander von Humboldt Foundation and the Bundesministerium für Bildung und Forschung, within the group ‘Combinatorial Search Algorithms in Bioinformatics’ (to Z.L.).</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </ack>
  <fn-group>
    <fn id="FN2">
      <p>
        <sup>1</sup>
        <ext-link ext-link-type="uri" xlink:href="http://pubchem.ncbi.nlm.nih.gov/">http://pubchem.ncbi.nlm.nih.gov/</ext-link>
      </p>
    </fn>
  </fn-group>
  <ref-list>
    <title>REFERENCES</title>
    <ref id="B1">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Audi</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The AME2003 atomic mass evaluation (ii): Tables, graphs, and references.</article-title>
        <source>Nucl. Phys. A</source>
        <year>2003</year>
        <volume>729</volume>
        <fpage>129</fpage>
        <lpage>336</lpage>
      </citation>
    </ref>
    <ref id="B2">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Beck</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The polynomial part of a restricted partition function related to the frobenius problem.</article-title>
        <source>Electron. J. Comb</source>
        <year>2001</year>
        <volume>8</volume>
        <fpage>N7</fpage>
      </citation>
    </ref>
    <ref id="B3">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Böcker</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lipták</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>A fast and simple algorithm for the Money Changing Problem.</article-title>
        <source>Algorithmica</source>
        <year>2007</year>
        <volume>48</volume>
        <fpage>413</fpage>
        <lpage>432</lpage>
      </citation>
    </ref>
    <ref id="B4">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Böcker</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Rasche</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Towards de novo identification of metabolites by analyzing tandem mass spectra.</article-title>
        <source>Bioinformatics</source>
        <year>2008</year>
        <volume>24</volume>
        <fpage>I49</fpage>
        <lpage>I55</lpage>
        <pub-id pub-id-type="pmid">18689839</pub-id>
      </citation>
    </ref>
    <ref id="B5">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Falkner</surname>
            <given-names>JA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Proteomecommons.org io framework: reading and writing multiple proteomics data formats.</article-title>
        <source>Bioinformatics</source>
        <year>2007</year>
        <volume>23</volume>
        <fpage>262</fpage>
        <lpage>263</lpage>
        <pub-id pub-id-type="pmid">17121776</pub-id>
      </citation>
    </ref>
    <ref id="B6">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hsu</surname>
            <given-names>CS</given-names>
          </name>
        </person-group>
        <article-title>Diophantine approach to isotopic abundance calculations.</article-title>
        <source>Anal. Chem.</source>
        <year>1984</year>
        <volume>56</volume>
        <fpage>1356</fpage>
        <lpage>1361</lpage>
      </citation>
    </ref>
    <ref id="B7">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Iijima</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metabolite annotations based on the integration of mass spectral information.</article-title>
        <source>Plant J.</source>
        <year>2008</year>
        <volume>54</volume>
        <fpage>949</fpage>
        <lpage>962</lpage>
        <pub-id pub-id-type="pmid">18266924</pub-id>
      </citation>
    </ref>
    <ref id="B8">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kanehisa</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>From genomics to chemical genomics: new developments in KEGG.</article-title>
        <source>Nucl. Acids Res.</source>
        <year>2006</year>
        <volume>34</volume>
        <fpage>D354</fpage>
        <lpage>D357</lpage>
        <pub-id pub-id-type="pmid">16381885</pub-id>
      </citation>
    </ref>
    <ref id="B9">
      <citation citation-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Kellerer</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Knapsack Problems.</source>
        <year>2004</year>
        <publisher-loc>Berlin, Heidelberg</publisher-loc>
        <publisher-name>Springer</publisher-name>
      </citation>
    </ref>
    <ref id="B10">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kind</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Fiehn</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>Metabolomic database annotations via query of elemental compositions: mass accuracy is insufficient even at less than 1 ppm.</article-title>
        <source>BMC Bioinformatics</source>
        <year>2006</year>
        <volume>7</volume>
        <fpage>234</fpage>
        <pub-id pub-id-type="pmid">16646969</pub-id>
      </citation>
    </ref>
    <ref id="B11">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kind</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Fiehn</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>Seven golden rules for heuristic filtering of molecular formulas obtained by accurate mass spectrometry.</article-title>
        <source>BMC Bioinformatics</source>
        <year>2007</year>
        <volume>8</volume>
        <fpage>105</fpage>
        <pub-id pub-id-type="pmid">17389044</pub-id>
      </citation>
    </ref>
    <ref id="B12">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kubinyi</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Calculation of isotope distributions in mass spectrometry: a trivial solution for a non-trivial problem.</article-title>
        <source>Anal. Chim. Acta</source>
        <year>1991</year>
        <volume>247</volume>
        <fpage>107</fpage>
        <lpage>119</lpage>
      </citation>
    </ref>
    <ref id="B13">
      <citation citation-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Martello</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Toth</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <source>Knapsack Problems: Algorithms and Computer Implementations.</source>
        <year>1990</year>
        <publisher-loc>Chichester</publisher-loc>
        <publisher-name>John Wiley &amp; Sons</publisher-name>
      </citation>
    </ref>
    <ref id="B14">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rockwood</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Van Orden</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <article-title>Ultrahigh-speed calculation of isotope distributions.</article-title>
        <source>Anal. Chem.</source>
        <year>1996</year>
        <volume>68</volume>
        <fpage>2027</fpage>
        <lpage>2030</lpage>
      </citation>
    </ref>
    <ref id="B15">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rockwood</surname>
            <given-names>AL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Isotopic compositions and accurate masses of single isotopic peaks.</article-title>
        <source>J. Am. Soc. Mass Spectr</source>
        <year>2004</year>
        <volume>15</volume>
        <fpage>12</fpage>
        <lpage>21</lpage>
      </citation>
    </ref>
    <ref id="B16">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Senior</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Partitions and their representative graphs.</article-title>
        <source>Am. J. Math.</source>
        <year>1951</year>
        <volume>73</volume>
        <fpage>663</fpage>
        <lpage>689</lpage>
      </citation>
    </ref>
    <ref id="B17">
      <citation citation-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Wilf</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <source>Generating functionology.</source>
        <year>1990</year>
        <publisher-loc>New York</publisher-loc>
        <publisher-name>Academic Press</publisher-name>
      </citation>
    </ref>
    <ref id="B18">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yergey</surname>
            <given-names>JA</given-names>
          </name>
        </person-group>
        <article-title>A general approach to calculating isotopic distributions for mass spectrometry.</article-title>
        <source>Int. J. Mass Spectrom. Ion Phys.</source>
        <year>1983</year>
        <volume>52</volume>
        <fpage>337</fpage>
        <lpage>349</lpage>
      </citation>
    </ref>
    <ref id="B19">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Predicting molecular formulas of fragment ions with isotope patterns in tandem mass spectra.</article-title>
        <source>IEEE/ACM Trans. Comput. Biol. Bioinform.</source>
        <year>2005</year>
        <volume>2</volume>
        <fpage>217</fpage>
        <lpage>230</lpage>
        <pub-id pub-id-type="pmid">17044185</pub-id>
      </citation>
    </ref>
    <ref id="B20">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ProbID: a probabilistic algorithm to identify peptides through sequence database searching using tandem mass spectral data.</article-title>
        <source>Proteomics</source>
        <year>2002</year>
        <volume>2</volume>
        <fpage>1406</fpage>
        <lpage>1412</lpage>
        <pub-id pub-id-type="pmid">12422357</pub-id>
      </citation>
    </ref>
    <ref id="B21">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Chait</surname>
            <given-names>BT</given-names>
          </name>
        </person-group>
        <article-title>ProFound: an expert system for protein identification using mass spectrometric peptide mapping information.</article-title>
        <source>Anal. Chem.</source>
        <year>2000</year>
        <volume>72</volume>
        <fpage>2482</fpage>
        <lpage>2489</lpage>
        <pub-id pub-id-type="pmid">10857624</pub-id>
      </citation>
    </ref>
  </ref-list>
</back>
