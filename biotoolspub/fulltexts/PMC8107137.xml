<?all-math-mml yes?>
<?use-mml?>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD with MathML3 v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1-mathml3.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName nihms2pmcx2.xsl?>
<?ConverterInfo.Version 1?>
<?properties manuscript?>
<?origin nihpa?>
<?iso-abbr Nat Methods?>
<?submitter-system nihms?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 8068858?>
<?submitter-authority myNCBI?>
<?submitter-login nature-structure?>
<?submitter-name Nature Publishing Group?>
<?domain nihpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8107137</article-id>
    <article-id pub-id-type="pmid">33820988</article-id>
    <article-id pub-id-type="doi">10.1038/s41592-021-01109-3</article-id>
    <article-id pub-id-type="manuscript">nihpa1680058</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Discovering multiple types of DNA methylation from bacteria and microbiome using nanopore sequencing</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Tourancheau</surname>
          <given-names>Alan</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Mead</surname>
          <given-names>Edward A.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zhang</surname>
          <given-names>Xue-Song</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fang</surname>
          <given-names>Gang</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref rid="CR1" ref-type="corresp">#</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Department of Genetics and Genomic Sciences and Icahn Institute for Genomics and Multiscale Biology, Icahn School of Medicine at Mount Sinai, New York, NY 10029, USA</aff>
    <aff id="A2"><label>2</label>Department of Medicine, New York University School of Medicine, New York 10016, USA</aff>
    <author-notes>
      <corresp id="CR1"><label>#</label>Address correspondence to: <email>gang.fang@mssm.edu</email></corresp>
      <fn fn-type="con" id="FN1">
        <p id="P1">Author contributions</p>
        <p id="P2">G.F. conceived and supervised the project. A.T. and G.F. designed the methods. A.T. developed the software package for all the proposed computational analyses. A.T., E.A.M., and X-S.Z. conducted the experiments. A.T. and G.F. analyzed the data and wrote the manuscript with inputs and comments from all co-authors.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>10</day>
      <month>3</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>05</day>
      <month>4</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>5</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>05</day>
      <month>10</month>
      <year>2021</year>
    </pub-date>
    <volume>18</volume>
    <issue>5</issue>
    <fpage>491</fpage>
    <lpage>498</lpage>
    <!--elocation-id from pubmed: 10.1038/s41592-021-01109-3-->
    <permissions>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/">http://www.nature.com/authors/editorial_policies/license.html#terms</ali:license_ref>
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use: <uri xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</uri></license-p>
      </license>
    </permissions>
    <abstract id="ABS1">
      <p id="P3">Bacterial DNA methylation occurs at diverse sequence contexts and plays important functional roles in cellular defense and gene regulation. Existing methods for detecting DNA modification from nanopore sequencing data do not effectively support <italic>de novo</italic> study of unknown bacterial methylomes. In this work, we observed that nanopore sequencing signal displays complex heterogeneity across methylation events of the same type. To enable nanopore sequencing for broadly applicable methylation discovery, we generated a training dataset from an assortment of bacterial species and developed a method, named nanodisco (<ext-link ext-link-type="uri" xlink:href="https://github.com/fanglab/nanodisco">https://github.com/fanglab/nanodisco</ext-link>), that couples the identification and fine mapping of the three forms of methylation into a multi-label classification framework. We applied it to individual bacteria and mouse gut microbiome for reliable methylation discovery. In addition, we demonstrated the use of DNA methylation for binning metagenomic contigs, associating mobile genetic elements with their host genomes, and identifying misassembled metagenomic contigs.</p>
    </abstract>
    <abstract id="ABS2" abstract-type="summary">
      <title>Editor Summary:</title>
      <p id="P4">This work describes nanodisco that is a tool for de novo identifying DNA methylations in bacterial species and microbiomes using nanopore sequencing, as well as performing metagenomic binning using microbial DNA methylation pattern.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <sec id="S1">
    <title>Introduction</title>
    <p id="P5">Single Molecule Real-Time (SMRT) and nanopore sequencing provide a great opportunity for the direct detection of DNA modifications<sup><xref rid="R1" ref-type="bibr">1</xref></sup>. SMRT sequencing monitors the pulse fluorescence associated with each nucleotide and records the time it takes for the DNA polymerase to translocate from one nucleotide to the next, termed inter-pulse duration (IPD). Deviation of IPD, calculated by comparing native DNA with methylation free DNA (<italic>e.g.</italic> produced by whole genome amplification, WGA), is correlated with the presence of DNA modifications<sup><xref rid="R2" ref-type="bibr">2</xref></sup>. SMRT sequencing has helped to study bacterial methylomes<sup><xref rid="R1" ref-type="bibr">1</xref>, <xref rid="R3" ref-type="bibr">3</xref></sup> which contain three primary forms of DNA methylation: N6-methyladenine (6mA), N4-methylcytosine (4mC), and 5-methylcytosine (5mC). Great progress has also been made in methods development for DNA modification detection using nanopore sequencing. Two early studies showed differences in current at multiple consecutive positions near the modified base when comparing nanopore sequencing signals from the same genomic regions with or without DNA methylation<sup><xref rid="R4" ref-type="bibr">4</xref>, <xref rid="R5" ref-type="bibr">5</xref></sup>. Since then, multiple detection methods were published including Nanopolish<sup><xref rid="R6" ref-type="bibr">6</xref></sup>, signalAlign<sup><xref rid="R7" ref-type="bibr">7</xref></sup>, mCaller<sup><xref rid="R8" ref-type="bibr">8</xref></sup>, DeepSignal<sup><xref rid="R9" ref-type="bibr">9</xref></sup>, DeepMod<sup><xref rid="R10" ref-type="bibr">10</xref></sup>, NanoMod<sup><xref rid="R11" ref-type="bibr">11</xref></sup>, and Tombo<sup><xref rid="R12" ref-type="bibr">12</xref></sup>. While encouraging, existing methods were either trained for detecting a specific type of DNA methylation from one of few specific sequence contexts (<italic>e.g.</italic> 5mC at CpG, and 6mA at GATC) or allow more general detection without effectively differentiating between different forms of DNA methylation<sup><xref rid="R13" ref-type="bibr">13</xref></sup>. To date, none of these methods have been applied to characterize unknown bacterial methylomes without prior knowledge, which includes <italic>de novo</italic> identification of methylation type (<italic>i.e.</italic> assigning methylation type: 4mC, 5mC, or 6mA), and <italic>de novo</italic> fine mapping of the methylated nucleotide.</p>
    <p id="P6">In this work, by examining the three types of DNA methylation in diverse sequence contexts, we observed large variation and complex heterogeneity in terms of their impact on ionic current levels captured in nanopore sequencing. This observation suggests that detection methods are best developed using a diverse collection of species. Bacterial epigenomes are highly motif driven, that is, nearly every occurrence ( &gt;95%) of a methylation sequence motif is methylated<sup><xref rid="R1" ref-type="bibr">1</xref>, <xref rid="R14" ref-type="bibr">14</xref>, <xref rid="R15" ref-type="bibr">15</xref></sup>. Following this rationale, we built a comprehensive training dataset and developed a multi-label classification framework for <italic>de novo</italic> methylation typing and fine mapping of the three forms of DNA methylation at constitutively methylated motifs.</p>
  </sec>
  <sec id="S2">
    <title>Results</title>
    <sec id="S3">
      <title>Heterogeneous signal variation induced by DNA methylation in nanopore sequencing</title>
      <p id="P7">In Bacteria, 6mA, 4mC and 5mC events occur in a highly motif-driven manner. On average, each bacterial genome contains three methylation motifs, and nearly every occurrence of the target motifs is methylated<sup><xref rid="R1" ref-type="bibr">1</xref>, <xref rid="R3" ref-type="bibr">3</xref></sup>. To examine the variation of different types of DNA methylation across sequence contexts, we collected seven bacterial species with diverse methylation motifs and genomic GC contents (28.4 to 69.1%; <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>; <xref rid="S9" ref-type="sec">Methods</xref>). According to a previous study<sup><xref rid="R3" ref-type="bibr">3</xref></sup> and REBASE<sup><xref rid="R16" ref-type="bibr">16</xref></sup> (<xref rid="S9" ref-type="sec">Methods</xref>), these strains have a total of 46 unique methylation motifs (6mA: 28; 4mC: 7; 5mC: 11; 308,773 methylation sites in total; <xref rid="F1" ref-type="fig">Fig. 1</xref>; <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 2</xref>). We conducted nanopore sequencing for both the native and WGA samples on the MinION with R9.4 flow cells achieving 175x coverage on average (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 3</xref>).</p>
      <p id="P8">Read events and associated current levels (picoampere, pA) were aligned to reference genomes using Nanopolish<sup><xref rid="R6" ref-type="bibr">6</xref></sup>. After normalization and filtering, current differences between native and WGA datasets were computed for each genomic position (<xref rid="S9" ref-type="sec">Methods</xref>). To examine the variation of current differences across different DNA methylation types and motifs, we extracted current differences around each methylated base ([−6 bp, +7 bp]) and computed the methylation motif signatures (i.e. distribution of current differences at relative distance flanking the methylated bases; <xref rid="F2" ref-type="fig">Fig. 2a</xref>). Generally, the widths and amplitudes of perturbation in the methylation motif signatures vary between motifs and methylation types (<xref rid="F6" ref-type="fig">Extended Data Fig. 1a</xref>-<xref rid="F6" ref-type="fig">c</xref>).</p>
      <p id="P9">To obtain an overall view of the current differences across all the methylation types and methylation motifs, we subjected the 14 bp vectors ([−6 bp, +7 bp]) capturing current differences across 183,818 non-overlapping methylation motif occurrences to t-distributed stochastic neighbor embedding (t-SNE)<sup><xref rid="R17" ref-type="bibr">17</xref></sup> (<xref rid="F2" ref-type="fig">Fig. 2b</xref>,<xref rid="F2" ref-type="fig">c</xref>, <xref rid="F7" ref-type="fig">Extended Data Fig. 2</xref>). While methylation motif occurrences from the same methylation type tend to cluster together (<xref rid="F2" ref-type="fig">Fig. 2c</xref> and <xref rid="F7" ref-type="fig">Extended Data Fig. 2b</xref>), some individual motifs form distinct sub-clusters (e.g. T4mCTTC and GTA4mC; <xref rid="F2" ref-type="fig">Fig. 2c</xref> and <xref rid="F7" ref-type="fig">Extended Data Fig. 2b</xref>), likewise between methylation sites within the same methylation motif (e.g. GGW5mCC, <xref rid="F2" ref-type="fig">Fig. 2a</xref>,<xref rid="F2" ref-type="fig">b</xref> and <xref rid="F7" ref-type="fig">Extended Data Fig. 2a</xref>). Further analysis of the motif signatures suggests that the across-motif and within-motif variations can be largely explained by sequence variation from degenerated position in the motifs (e.g. GGW5mCC, <xref rid="F3" ref-type="fig">Fig. 3a</xref>,<xref rid="F3" ref-type="fig">b</xref>) or by their flanking sequences (e.g. GAT5mC, <xref rid="F3" ref-type="fig">Fig. 3c</xref>). We found these observations are robust after examining potential sources of variations such as base callers, signal processing workflows, and genome assembly (<xref rid="SD1" ref-type="supplementary-material">Supplementary Text</xref>, <xref rid="F8" ref-type="fig">Extended Data Fig. 3</xref>, and <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 1</xref>).</p>
    </sec>
    <sec id="S4">
      <title><italic>de novo</italic> methylation typing and fine mapping</title>
      <p id="P10">The above analyses suggested great signature diversity exists in methylation induced current differences across sequence contexts. To account for this diversity, we developed a method to identify the type of DNA methylation (i.e., methylation typing) and to identify the position of the methylated base (i.e., fine mapping).</p>
      <sec id="S5">
        <title>Methylation motif enrichment.</title>
        <p id="P11">The methylation detection and motif enrichment procedure are built on existing methods<sup><xref rid="R6" ref-type="bibr">6</xref>, <xref rid="R12" ref-type="bibr">12</xref>, <xref rid="R18" ref-type="bibr">18</xref></sup>. In brief, 1) current levels are compared between native and WGA datasets for each genomic position; 2) p-values are combined locally with a sliding window-based approach followed by peak detection; 3) flanking sequences around the center of peaks are used as input for MEME motif discovery analysis (<xref rid="S9" ref-type="sec">Methods</xref>). Overall, 45 of the total 46 well-characterized methylation motifs from seven bacteria were successfully re-discovered (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 2</xref>). The only undetected motif, GT6mAC from <italic>H. pylori</italic>, has much fewer occurrences (<italic>i.e.</italic> 198) than other 4-mer motifs (7169 occurrences on average). The motif discovery analysis also found six additional motifs not among the 46 well-characterized motifs (<xref rid="S9" ref-type="sec">Methods</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Text</xref>), which were not included in the training dataset described below.</p>
      </sec>
      <sec id="S6">
        <title>de novo methylation typing and fine mapping.</title>
        <p id="P12">The t-SNE analysis shows that DNA methylation events of the same type generally cluster well (<xref rid="F2" ref-type="fig">Fig. 2c</xref>). We hypothesized that a classification model trained using diverse methylation types and motifs may serve as a reliable approach for categorizing <italic>de novo</italic> detected methylation. While both methylation type and methylation position are known for the well-characterized training samples (<italic>i.e.</italic> feature vectors can be consistently defined relatively to the methylated base for classifier training), features vector for the test samples cannot be aligned consistently because the methylated position is yet to be predicted in a <italic>de novo</italic> discovery setting. Essentially, methylation type classification and methylation fine mapping are coupled problems that need to be approached simultaneously. Building on the observation that no more than +/− 3 bp offsets from peak centers across the 46 well-characterized motifs (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 2</xref>; <xref rid="F9" ref-type="fig">Extended Data Fig. 4a</xref>), we designed a multi-label classifier training strategy. For training, each methylation occurrence from a wide range of sequence context is learned 7 times by the classifier, each time using current differences at a specific offset from the methylated base; for a given test sample with unknown methylation type and unknown methylated position, the classifier will first use the center of current differences as an approximation of the methylated position and then predict the methylation type and the exact methylated position (<xref rid="S9" ref-type="sec">Methods</xref>; <xref rid="F4" ref-type="fig">Fig. 4a</xref>-<xref rid="F4" ref-type="fig">c</xref>).</p>
        <p id="P13">A set of nine different classifiers was separately trained using current differences flanking known methylated bases following the offset strategy described above (<xref rid="S9" ref-type="sec">Methods</xref>; <xref rid="F4" ref-type="fig">Fig. 4a</xref>-<xref rid="F4" ref-type="fig">c</xref>; <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 4</xref>; <xref rid="F9" ref-type="fig">Extended Data Fig. 4b</xref>,<xref rid="F9" ref-type="fig">d</xref>). For evaluation, we used leave-one-out cross-validation (LOOCV) strategy where one motif is held out for testing while all the other 45 motifs are used for training. With all held out individual methylation sites belonging to a single methylation motif classified, predicted methylated type and position within motif was determined from the consensus across tested occurrences (<xref rid="S9" ref-type="sec">Methods</xref>). Overall results for k-nearest neighbors, random forest, and neural network are largely consistent in terms of accuracy for classifying individual methylation sites (<xref rid="F9" ref-type="fig">Extended Data Fig. 4c</xref>) and methylation motifs with at least 95.7% of motifs correctly typed and fine mapped (<xref rid="F10" ref-type="fig">Extended Data Fig. 5</xref> and <xref rid="F11" ref-type="fig">6</xref>). For simplicity, only results from the neural network model are used for the remainder of the study (<xref rid="F4" ref-type="fig">Fig. 4d</xref>,<xref rid="F4" ref-type="fig">e</xref>). Methylation site classification accuracy varies widely ranging from 36% for G6mAGG to 98% for G5mCCGGC (median accuracy of 78%; <xref rid="F9" ref-type="fig">Extended Data Fig. 4c</xref>, <xref rid="F9" ref-type="fig">4e</xref>, <xref rid="F10" ref-type="fig">5</xref>, and <xref rid="F11" ref-type="fig">6</xref>), which is consistent with the observation that motifs of the same methylation type can have different signatures (<xref rid="F2" ref-type="fig">Fig. 2c</xref> and <xref rid="F7" ref-type="fig">Extended Data Fig. 2</xref>,<xref rid="F8" ref-type="fig">3</xref>,<xref rid="F12" ref-type="fig">7d</xref>-<xref rid="F12" ref-type="fig">e</xref>). Furthermore, breaking down individual methylation sites per methylation type shows balanced accuracy results for 4mC, 6mA, and 5mC motifs, while all the 46 well-characterized motifs are correctly typed and fine mapped (<xref rid="F4" ref-type="fig">Fig. 4f</xref>, <xref rid="F10" ref-type="fig">Extended Data Fig. 5</xref> and <xref rid="F11" ref-type="fig">6</xref>).</p>
        <p id="P14">After training of a final model from the 46 well-characterized motifs, motif typing and fine mapping performances were further assessed on two independent bacterial samples: <italic>N. otitidiscaviarum</italic> and <italic>T. phaeum</italic>. All the 12 known methylation motifs were <italic>de novo</italic> re-discovered as well as accurately typed and fine mapped (11 were not among the 46 motifs in the final training; <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 5</xref>). We also applied the classification method on all <italic>de novo</italic> discovered motifs including the six additional motifs, which resulted in an overall accuracy of 98.1% (51/52 motifs well classified combining LOOCV results for the 46 well-characterized motifs and using the final model on the 6 additional motifs). We further evaluate the impacts of <italic>de novo</italic> genome assembly (<xref rid="F8" ref-type="fig">Extended Data Fig. 3m</xref>,<xref rid="F8" ref-type="fig">n</xref>), genome coverage (<xref rid="F12" ref-type="fig">Extended Data Fig. 7a</xref>-<xref rid="F12" ref-type="fig">c</xref>), and motif frequency (<xref rid="F12" ref-type="fig">Extended Data Fig. 7f</xref>).</p>
      </sec>
    </sec>
    <sec id="S7">
      <title>Methylation discovery from microbiome and methylation-enhanced metagenomic analyses</title>
      <p id="P15">A number of methods have been developed to group metagenomic contigs (i.e. <italic>binning</italic>) using composition features<sup><xref rid="R19" ref-type="bibr">19</xref>-<xref rid="R22" ref-type="bibr">22</xref></sup>, contig coverages<sup><xref rid="R23" ref-type="bibr">23</xref>-<xref rid="R26" ref-type="bibr">26</xref></sup>, and chromosome interaction maps<sup><xref rid="R27" ref-type="bibr">27</xref>-<xref rid="R29" ref-type="bibr">29</xref></sup>. Recent work by <italic>Beaulaurier et al.</italic> demonstrates that microbial DNA methylation can be exploited as complementary features to enhance metagenomic binning (<italic>i.e.</italic> methylation binning) using SMRT sequencing<sup><xref rid="R30" ref-type="bibr">30</xref></sup>. We hypothesized that methylation binning of metagenomic contigs with nanopore sequencing holds great promise by utilizing all three DNA methylations types (6mA, 4mC, and 5mC) beyond the scope of <italic>Beaulaurier et al.</italic> that focused on 6mA (SMRT sequencing does not effectively detect 5mC at diverse sequence contexts)<sup><xref rid="R30" ref-type="bibr">30</xref></sup>.</p>
      <p id="P16">We developed a methylation binning approach with nanopore sequencing data considering the fundamental differences from SMRT sequencing (<xref rid="S9" ref-type="sec">Methods</xref>; <xref rid="F13" ref-type="fig">Extended Data Fig. 8</xref>). In a nutshell, we had to address the observation that current differences associated with methylation are spanning multiple events near methylated bases (<xref rid="F2" ref-type="fig">Fig. 2a</xref>, <xref rid="F3" ref-type="fig">Fig. 3a</xref>, and <xref rid="F6" ref-type="fig">Extended Data Fig. 1</xref>) rather than confined to a single base for 6mA or 4mC as in SMRT sequencing. After prototyping and evaluation on a mock community (<xref rid="SD1" ref-type="supplementary-material">Supplementary Text</xref>; <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 2</xref>), we applied the method on nanopore sequencing data of the same mouse fecal sample used in the SMRT sequencing study (MGM1; <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 6</xref>). To summarize, after the <italic>de novo</italic> metagenome assembly, we computed methylation feature vectors for a large set of candidate methylation motifs (n=210,176; <xref rid="S9" ref-type="sec">Methods</xref>). Motifs with informational feature (<italic>i.e.</italic> significant current differences) were first selected based on large contigs, and methylation feature vectors were then computed in remaining contigs. Methylation feature vectors are then arranged in a methylation profile matrix, which is subjected to clustering analysis based on similarity among contigs (<xref rid="S9" ref-type="sec">Methods</xref>). This initial automated binning resulted in ten bins (<xref rid="F14" ref-type="fig">Extended Data Fig. 9a</xref>), which were further refined by per-bin motif detection and binning guided by discovered motifs (<xref rid="S9" ref-type="sec">Methods</xref>; <xref rid="F14" ref-type="fig">Extended Data Fig. 9b</xref>-<xref rid="F14" ref-type="fig">d</xref>). The final methylation binning of MGM1 contigs was performed using the 80 <italic>de novo</italic> detected methylation motifs (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 7</xref>),which revealed thirteen bins containing from 3 to 43 contigs in each (<xref rid="F5" ref-type="fig">Fig. 5a</xref>; <xref rid="F14" ref-type="fig">Extended Data Fig. 9d</xref>; <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 8</xref>). The unique methylation profiles for each bin are displayed in <xref rid="F5" ref-type="fig">Figure 5c</xref>. Among contigs with length &gt;50kb and with average coverage &gt;5x, 85% can be binned based on methylation information, which correspond to 91% of the contig cumulative lengths. The method was further tested with a second microbiome sample, MGM2 (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 6</xref>), in which eleven bins with unique methylation profiles were identified (<xref rid="F5" ref-type="fig">Fig. 5b</xref>; <xref rid="F15" ref-type="fig">Extended Data Fig. 10</xref>; <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 9</xref>). We observe that bins from nanopore sequencing data closely matched those from SMRT sequencing data<sup><xref rid="R30" ref-type="bibr">30</xref></sup>, and none of the nanopore sequencing bins contained misclassified contigs (<xref rid="S9" ref-type="sec">Methods</xref>; <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 3a</xref> and <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 10</xref>). Consistent between the two technologies, methylation binning effectively separated the multiple Bacteroidales species that are usually hard to distinguish from each other due to their highly similar genome sequence composition and abundance<sup><xref rid="R30" ref-type="bibr">30</xref></sup>.</p>
      <p id="P17">Through the methylation binning analysis, 80 methylation motifs were detected using MEME from the thirteen bins from MGM1 sample (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 7</xref>). We applied the methylation typing and fine mapping method and made confident prediction of methylation types and modified positions for 64 motifs (6mA: 18; 5mC: 46; <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 11</xref>). The <italic>de novo</italic> detection of a large number of 5mC motifs is encouraging because previous large-scale bacterial methylome studies were almost exclusively based on SMRT sequencing, which is known to be ineffective for detecting 5mC methylation across diverse motifs. However, not every 6mA motif found with SMRT sequencing was detected in the analysis of nanopore sequencing data. The missing ones are mostly bipartite 6mA motifs, which are usually not frequent and thus more challenging to detect using nanopore sequencing. This is probably due to the diffuse nature of current differences around 6mA (<xref rid="F2" ref-type="fig">Fig. 2a</xref> and <xref rid="F6" ref-type="fig">Extended Data Fig. 1</xref>) in contrast to the highly specific signal right on top of 6mA in SMRT sequencing.</p>
      <p id="P18">We further attempted to link mobile genetic elements (MGEs) to their host genome based on their methylation profiles. Using the SMRT metagenomic assembly with <italic>de novo</italic> discovered methylation motifs, we were able to bin 11 of the 19 annotated MGEs from this microbiome sample according to their methylation profiles (five plasmids and six conjugative transposons; <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 3b</xref>; <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 12</xref>), while nine were binned with the SMRT analysis<sup><xref rid="R30" ref-type="bibr">30</xref></sup>. With eight MGEs binned as with SMRT analysis and three newly binned MGEs, nanopore sequencing increased MGEs linking potential compared to SMRT methylation binning likely owing to its better sensitivity to 5mC motifs. From our nanopore-only <italic>de novo</italic> metagenome assembly, fewer MGEs were identified (eight), although similar results were obtained in terms of linking MGEs to their host genomes, <italic>i.e.</italic> four out of the eight MGEs identified were binned correctly (<xref rid="F5" ref-type="fig">Fig. 5a</xref>).</p>
      <p id="P19">In addition to contig binning, we hypothesized that the microbial DNA methylation pattern can also be used to discover misassembled contigs. The methylation pattern is expected to be largely consistent across different regions of an authentic metagenomic contig. Following this rationale, we discovered two contigs from SMRT sequencing based metagenomic assembly of the MGM1 sample (marked by an asterisk in <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 3a</xref>) showing inconsistent intra-contig methylation status (<xref rid="F5" ref-type="fig">Fig. 5d</xref>). By comparing methylation patterns from methylation motif sets from the other bins, we found that the contigs in question are chimeric contigs representing two Bacteroidales species (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4</xref>, SMRT Bins 2 and 7). This is consistent with the previous examination of coverage uniformity and contamination through single-copy gene count<sup><xref rid="R30" ref-type="bibr">30</xref></sup>, confirming that those contigs annotated as Bin 7 were misassembled by HGAP2 combining parts of Bin 2 and Bin 7 genomes. Generally, this analysis highlights the benefit of incorporating DNA methylation status (ideally all three types: 6mA, 4mC, and 5mC), which not only help better distinguishing microbial species but also help assess contig homogeneity revealing eventual misassemblies.</p>
    </sec>
  </sec>
  <sec id="S8">
    <title>Discussion</title>
    <p id="P20">In this work, we developed a method for <italic>de novo</italic> discovery (methylation typing and fine mapping) of three forms of bacterial DNA methylation (4mC, 5mC, and 6mA). We also developed a method for nanopore sequencing-based methylation binning of metagenomic contigs and MGEs-to-host mapping, building on the method reported for SMRT sequencing data<sup><xref rid="R30" ref-type="bibr">30</xref></sup>. In addition, we demonstrated that examining the methylation pattern along assembled metagenomic contigs could help identify chimeric contigs. While methylation binning provides additional discriminative power for species with highly similar genome sequences, other binning features (<italic>e.g.</italic> sequence composition and coverage binning) have advantages when contigs are short or when two organisms have the same methylome, although this latter case is not common based on the diversity and variation of bacterial methylomes<sup><xref rid="R30" ref-type="bibr">30</xref></sup>.</p>
    <p id="P21">Our comparative methylation binning analysis between SMRT and Nanopore sequencing from the same microbiome sample provided important insights. First, nanopore sequencing provides reliable 5mC detection across diverse sequence contexts, addressing a challenge faced by SMRT sequencing. The large number of 5mC motifs discovered from the mouse gut microbiome sample using nanopore sequencing suggests the prevalence and diversity of 5mC motifs could have been largely underestimated in the &gt;2,700 bacterial methylome analyses that were almost exclusively based on SMRT sequencing<sup><xref rid="R16" ref-type="bibr">16</xref>, <xref rid="R30" ref-type="bibr">30</xref></sup>. Second, we found that multiple long and rare methylation motifs well detected by SMRT sequencing in the metagenome analysis were missed by nanopore sequencing, which can be explained by the diffuse current differences associated with methylation in contrast to the high IPD ratios confined to a single methylation site (4mC or 6mA) for SMRT sequencing<sup><xref rid="R2" ref-type="bibr">2</xref>, <xref rid="R31" ref-type="bibr">31</xref>-<xref rid="R34" ref-type="bibr">34</xref></sup>. Collectively, it shows that SMRT sequencing and nanopore sequencing have their own strengths and limitations, hence the two technologies are expected to complement each other in various applications.</p>
    <p id="P22">For individual methylation sites, we would like to highlight that the accuracy of the current method for methylation typing and fine mapping varies across different motifs, which calls for development of more accurate methods in future work. In practice, existing tools such as Tombo allow the estimation of partial methylation at individual methylation sites once motifs are <italic>de novo</italic> discovered and characterized, thus are complementary to our method.</p>
    <p id="P23">Lastly, while this study focused on three types of DNA methylation, similar design could be extended for the detection for other forms of DNA modification<sup><xref rid="R35" ref-type="bibr">35</xref>, <xref rid="R36" ref-type="bibr">36</xref></sup>, as well as RNA modifications<sup><xref rid="R37" ref-type="bibr">37</xref>, <xref rid="R38" ref-type="bibr">38</xref></sup> owing to nanopore technology direct RNA sequencing<sup><xref rid="R39" ref-type="bibr">39</xref>, <xref rid="R40" ref-type="bibr">40</xref></sup>.</p>
  </sec>
  <sec id="S9">
    <title>Online Methods</title>
    <sec id="S10">
      <title>Samples collection and DNA extraction</title>
      <p id="P24">A set of nine bacteria was selected using a previous study<sup><xref rid="R3" ref-type="bibr">3</xref></sup> and REBASE<sup><xref rid="R16" ref-type="bibr">16</xref></sup> to provide a large diversity of methylation motifs: <italic>Bacillus amyloliquefaciens</italic> H, <italic>Bacillus fusiformis</italic> 1226, <italic>Clostridium perfringens</italic> ATCC 13124, <italic>Escherichia coli</italic> K-12 substr. MG1655 ATCC 47076, <italic>Methanospirillum hungatei</italic> JF-1, <italic>Helicobacter pylori</italic> JP26, <italic>Neisseria gonorrhoeae</italic> FA 1090, <italic>Nocardia otitidiscaviarum</italic> NEB252, and <italic>Thermacetogenium phaeum</italic> DSM 12270.</p>
      <p id="P25"><italic>B. amyloliquefaciens</italic> H, <italic>B. fusiformis</italic> 1226, and <italic>N. otitidiscaviarum</italic> NEB252 DNA samples were obtained from New England Biolabs (NEB, Ipswich, MA). Those for <italic>C. perfringens</italic> ATCC 13124, <italic>M. hungatei</italic> JF-1, <italic>H. pylori</italic> JP26, <italic>N. gonorrhoeae</italic> FA 1090 and <italic>T. phaeum</italic> DSM 12270 were obtained from the Human Health Therapeutics Research Area at National Research Council Canada, the Department of Microbiology, Immunology, and Molecular Genetics at University of California Los Angeles, the Department of Medicine at New York University Langone Medical Center (NYUMC), the University of Oklahoma Health Sciences Center, and the Department of Biology at the University of Konstanz (Germany), respectively. Finally, we obtained <italic>E. coli</italic> K-12 substr. MG1655 ATCC 47076 from the American Type Culture Collection (ATCC, Manassas, VA).</p>
      <p id="P26">The adult mouse gut microbiome DNA samples (MGM1 and MGM2) were obtained from the Department of Medicine at NYUMC. MGM1 DNA sample was extracted from the fecal pellets used in the SMRT sequencing study<sup><xref rid="R30" ref-type="bibr">30</xref></sup> while MGM2 DNA sample comes from fecal pellets of the same mouse after antibiotic treatment with tylosin. Fecal DNA extraction was performed using QIAamp DNA Microbiome Kit (QIAGEN, Hilden, Germany) followed by cleanup with DNA Clean &amp; Concentrator – 5 elution buffer (ZYMO Research, Irvine, CA) and final elution in 10 mM Tris-HCl, pH 8.5, 0.1 mM EDTA.</p>
    </sec>
    <sec id="S11">
      <title>Library preparation and sequencing</title>
      <p id="P27">The quality of input DNA was controlled with Nanodrop 2000 and concentration measured using Qubit 3.0 (Thermo Fisher Scientific, Waltham, MA). Native libraries were prepared following 1D Genomic DNA by ligation protocol (SQK-LSK108; version GDE_9002_v108_revT_18Oct2016) with minor modifications described below. Whole genome amplification samples were prepared using REPLI-g Mini Kits (QIAGEN, Hilden, Germany) according to the protocol with 12.5 ng of input DNA and 16 h incubation. Next, WGA samples were treated with T7 endonuclease I (NEB) to maximize nanopore sequencing yield according to ONT documentation. WGA libraries were prepared following Premium whole genome amplification protocol from T7 step (version WAL_9030_v108_revJ_26Jan2017) with minor modifications described below. Bacteria (other than <italic>E. coli</italic> and <italic>H. pylori</italic>) and mouse gut microbiome DNA samples, native and WGA, were RNase A treated (FEREN0531, Thermo Fisher Scientific) then fragmented at 8 kbp with g-TUBEs (Covaris, Woburn, MA) to homogenized DNA fragments lengths increasing accuracy of input DNA molarity calculation to maximize yields. Final fragment length distributions were determined using Bioanalyzer 2100 (Agilent Technologies, Santa Clara, CA). Samples were sequenced on R9.4 and R9.4.1 MinION flow cells using MinKNOW (versions 1.5.12 and 1.10.11; <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 3</xref> and <xref rid="SD2" ref-type="supplementary-material">6</xref>).</p>
      <p id="P28"><italic>E. coli</italic> and <italic>H. pylori</italic> libraries (native and WGA) were prepared without fragmentation or Formalin-Fixed, Paraffin-Embedded (FFPE) DNA repair. <italic>E. coli</italic> and <italic>H. pylori</italic> WGA input DNA was increased to 3 μg in T7 step with 20 min incubation. Remaining steps were performed according to corresponding ONT protocol and final libraries sequenced on 3 flow cells with a maximum of two consecutive runs per flow cell. Flow cells were washed between runs using the Flow Cell Wash Kit (EXP-WSH002) from ONT. An additional WGA was produced for <italic>H. pylori</italic> and referred to as independent WGA. Sequencing of native and WGA libraries for <italic>E. coli</italic> and <italic>H. pylori</italic> generated from 289 to 2630x genomic coverage but were down sampled at 200x to more accurately represent common yield targets.</p>
      <p id="P29">DNA samples for the additional bacteria (<italic>B. amyloliquefacien</italic>, <italic>B. fusiformis</italic>, <italic>C. perfringens</italic>, <italic>M. hungatei</italic>, <italic>N. gonorrhoeae</italic>, <italic>N. otitidiscaviarum, and T. phaeum</italic>) were pooled in equimolar quantity for library preparation. Pooling possibility was confirmed by mapping mock nanopore reads datasets generated using Nanosim<sup><xref rid="R41" ref-type="bibr">41</xref></sup> (version 1.0.0; simulator.py linear -r &lt;path_to_fasta&gt; -c &lt;error_model&gt; -o &lt;path_output&gt; -n 50000 --min_len 200 --max_len 50000 using the <italic>E. coli</italic> error model provided by the authors on 03/23/17) on the combined references and verifying accurate separation of reads into genome of origin. Any reads mapping on more than one genome were discarded from all the analysis presented in our study, independently of the mapping type. Native and WGA library preparations were performed using aforementioned ONT protocol and sequenced on separate flow cells (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 3</xref>). Sequencing of native and WGA generated datasets with coverage ranging from 65 to 297x.</p>
      <p id="P30">Finally, mouse gut microbiome libraries (MGM1 and MGM2) were generated according to the One-pot ligation protocol for Oxford Nanopore libraries (<ext-link ext-link-type="doi" xlink:href="10.17504/protocols.io.k9acz2e">dx.doi.org/10.17504/protocols.io.k9acz2e</ext-link>) including the FFPE DNA repair step with exception for the room temperature incubation times that were increased from 10 to 20 minutes. 300 fmol of input DNA were used in FFPE DNA repair steps. Native and WGA libraries were sequenced on separate flow cells for 48 h (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 6</xref>).</p>
    </sec>
    <sec id="S12">
      <title>Nanopore sequencing signal processing</title>
      <p id="P31">Nanopore sequencing reads are base called using ONT Albacore Sequencing Pipeline Software (version 2.3.4). Reads are mapped to corresponding references using BWA-MEM (version 0.7.15 with <italic>–x ont2d</italic> option)<sup><xref rid="R42" ref-type="bibr">42</xref></sup>. The following steps are performed using R (version 3.5.3). Reads are separated by strand according to the initial alignment (package Rsamtools; version 1.34.1)<sup><xref rid="R43" ref-type="bibr">43</xref></sup>, and both groups are processed as forward strand reads by mapping reverse strand reads on the reverse complement of the reference genome using BWA-MEM. Supplementary and reverse strand alignments are then filtered out with samtools (version 1.3; flags 2048 and 16)<sup><xref rid="R44" ref-type="bibr">44</xref></sup>. Next, events are associated to genomic positions according to alignment coordinates from reads and expected current levels with Nanopolish <italic>eventalign</italic> (version 0.11.0)<sup><xref rid="R6" ref-type="bibr">6</xref></sup>. Event levels are normalized across reads by correcting signal scaling and shifting. Both normalization factors are computed for each read by fitting events level to ONT 6-mer model (nanopolish configuration file r9.4_450bps.nucleotide.6mer.template.model) using robust regression (rlm function). Event level outliers are removed using Tukey’s fences methods based on interquartile range (IQR=1.5) for each genomic position. Finally, mean event current differences (pA) were computed by comparing event levels between native sample (maintained methylation state) and WGA sample (essentially methylation free) at each genomic position for both strands separately. This metric is referred to as current differences in our manuscript. Associated p-values from two-sided Mann-Whitney U test are also computed (<italic>wilcox.test</italic> function) which was proposed in <italic>Stoiber et al.</italic><sup><xref rid="R12" ref-type="bibr">12</xref></sup>. Only genomic positions with sufficient coverage are considered in later analysis (min_cov=5).</p>
    </sec>
    <sec id="S13">
      <title>Motif enrichment analysis</title>
      <p id="P32">DNA methylation affects nanopore sequencing signal at multiple positions around the methylated base (<xref rid="F2" ref-type="fig">Fig. 2a</xref> and <xref rid="F6" ref-type="fig">Extended Data Fig. 1a</xref>-<xref rid="F6" ref-type="fig">c</xref>)<sup><xref rid="R4" ref-type="bibr">4</xref></sup> meaning detection of methylated sites can be reinforced by combining information from consecutive genomic positions. As in <italic>Stoiber et al.</italic>, consecutive p-values are combined with Fisher’s method (<italic>sumlog</italic> function) in sliding windows (5 bp) smoothing statistical signal along the genome<sup><xref rid="R12" ref-type="bibr">12</xref></sup>. It combines the methylation related signal near methylated bases and reduces signal noises from spurious genomic positions. Resulting smoothed statistical signals form peaks near methylated positions. Detected peaks are ranked according to their smoothed p-value and the top 2000 peaks are then selected for motif discovery. An alternative strategy is to randomly sample peaks from more than the top-2000 positions as described below. Corresponding genomic sequences are then extracted (22 bp, at the peak position, which was defined to encompass the complete motif recognition sequence for the subsequent motif discovery according to the <italic>H. pylori</italic> dataset) and used as input for <italic>de novo</italic> motifs discovery with MEME software (version 4.11.4; parameters: -dna -mod zoops -nmotifs 5 -minw 4 -maxw 14 -maxsize 1000000)<sup><xref rid="R18" ref-type="bibr">18</xref></sup>. The selection of region of interest based on combined p-values followed by motif detection using MEME was initially proposed in a preprint by <italic>Stoiber et al.</italic><sup><xref rid="R12" ref-type="bibr">12</xref></sup>. However, we enhanced the motif discovery potential by closely integrating MEME in our pipeline as described in next paragraphs.</p>
      <p id="P33">Running time for motif discovery with MEME rapidly increases with size of the sequence dataset to such extent that we had to limit the number of input sequences used. To address this constraint, we adopt a repeated procedure of back and forth between peak detection and motif discovery steps<sup><xref rid="R3" ref-type="bibr">3</xref>, <xref rid="R31" ref-type="bibr">31</xref></sup>. For each pass, a limited number of input sequences are analyzed with MEME and motifs achieving a sufficient confidence (E-value &lt;= 10<sup>−30</sup>) are reported. After each motif discovery step, peaks explained by discovered motifs, whose corresponding genomic sequence contains at least one of the <italic>de novo</italic> detected motifs, are removed making it possible to discover less frequent motifs and ones with weaker signals. This motif discovery procedure is automatically stopped when no additional motif can be found enriched in the input sequences (i.e. no motifs are significantly more frequent in the input sequence than in the background). This repeated procedure is adapted for detecting any number of methylated motifs while decreasing processing time.</p>
      <p id="P34">Furthermore, we observed that with some genomes, top peaks (based on smoothed p-value) could be enriched in specific motif combinations (i.e. motifs in close proximity) preventing MEME from discovering individual motifs in favor of the specific motif combination. This is due to larger than average smoothed p-value happening when two motif occurrences are near each other, which affects current in a broader genomic region. This phenomenon was observed for genomes with multiple frequent motifs such as <italic>H. pylori</italic>. To limit this bias when observed, we provide an option to randomly select sequences among top peaks (i.e. smoothed p-values above a threshold resulting in more than 2000 peaks), effectively avoiding the enrichment of specific motif combinations.</p>
      <p id="P35">Raw motifs called by MEME were further refined by leveraging current difference information. The rationale is that if the initial motif found with MEME is not precise (e.g. GATCH instead of GATC or CCAGG instead of CCWGG) then we can refine it by looking at the motif signature of related motifs, which is expected to stay flat when the motif is not methylated (i.e. current differences distributed around 0 for all positions). For each motif reported by MEME, we generated a set of related motifs by introducing substitutions, one substitution at a time. For example, the refinement of GATC will give 12 related motifs with substituted nucleotide in bold: <bold>A</bold>ATC, <bold>C</bold>ATC, <bold>T</bold>ATC, G<bold>C</bold>TC, G<bold>G</bold>TC, G<bold>T</bold>TC, GA<bold>A</bold>C, GA<bold>C</bold>C, GA<bold>G</bold>C, GAT<bold>A</bold>, GAT<bold>G</bold>, GAT<bold>T</bold>. We then compute each related motif signature (see <xref rid="S16" ref-type="sec">Motif typing and fine mapping</xref>) with associated scores representing total divergence from non-methylated signature (i.e. sum of absolute average current differences).</p>
    </sec>
    <sec id="S14">
      <title>Parameter tuning for signal processing and motif detection</title>
      <p id="P36">To assess our methods performance for <italic>de novo</italic> motif discovery and tune parameters, we evaluated the enrichment of MEME input sequences for expected motifs as the chosen smoothed p-value threshold varies. Method development and choice of default parameters was guided by evaluating various metrics including Precision-Recall (PR) curves, Receiver Operating Characteristic (ROC) curves and area under curves (AUC). We used the following two comparisons to define contingency table classes (i.e. two current differences datasets): native versus WGA, and independent WGA versus WGA. The independent WGA versus WGA comparison is used to improve the true negative (TN) and the false positive (FP) estimation by including information at unmethylated motif occurrences, which is absent from the native versus WGA comparison. True positives (TP) and false negatives (FN) are respectively defined as motif occurrences with or without signal peaks above a threshold in native versus WGA. False positives (FP) are genomic regions without motifs and with signal peaks above a threshold in native versus WGA as well as motif occurrences with signal peaks above a threshold in independent WGA versus WGA. Finally, true negatives (TN) are defined as genomic regions without motifs and without signal peaks above a threshold in native versus WGA as well as motif occurrences without signal peaks above a threshold in independent WGA versus WGA. State of motif occurrences were defined whether a peak was detected above the chosen threshold in a 22 bp window encompassing expected methylated base of motif occurrences. For genomic regions devoid of motif, those were split in 22 bp consecutive units, and used in the computation of FP and TN with similar status definition. Performances were computed on the first 500 kbp of the reference genome only. When comparing performances for <italic>de novo</italic> detection between individual motifs, we took into consideration variation in frequencies (<italic>i.e.</italic> a rare motif will be more difficult to detect). Therefore, in order to make the evaluation more generally applicable, we fixed the ratio of positive regions (22 bp windows from motif occurrences in native versus WGA) over all queried regions to one third by random subsampling either the motif occurrences or the genomic regions without motifs depending on the natural motif frequency (i.e. the original ratio of motif occurrences over all queried regions), effectively avoiding variation in frequencies across the set of <italic>H. pylori</italic> motifs. In the opposite, we also evaluate the impact of motif frequency on <italic>de novo</italic> detection by creating <italic>in silico</italic> datasets with a wide range of motif frequencies using a similar random subsampling strategy. Note that this method evaluation design, which assumes that all motif occurrences are methylated, could be slightly underestimated FP and TP, while FN could be slightly overestimated.</p>
      <p id="P37">Using the aforementioned method, we evaluated parameter performances for <italic>de novo</italic> methylation detection for the following steps or parameters: read mapping (<xref rid="F8" ref-type="fig">Extended Data Fig. 3f</xref>), event current normalization (<xref rid="F8" ref-type="fig">Extended Data Fig. 3g</xref>), outlier removal (<xref rid="F8" ref-type="fig">Extended Data Fig. 3c</xref>,<xref rid="F8" ref-type="fig">d</xref>), statistical test (<xref rid="F8" ref-type="fig">Extended Data Fig. 3h</xref>), smoothing window size (<xref rid="F8" ref-type="fig">Extended Data Fig. 3i</xref>), p-value combining function (<xref rid="F8" ref-type="fig">Extended Data Fig. 3j</xref>), and peaks window size (<xref rid="F8" ref-type="fig">Extended Data Fig. 3k</xref>). We also evaluated the impact of coverage by subsampling at 10 depths ranging from 5x to 200x as well as the impact of motif frequency and the motif specific context (<italic>i.e.</italic> how methylation type and sequence context affect detection potential; <xref rid="F12" ref-type="fig">Extended Data Fig. 7</xref>).</p>
    </sec>
    <sec id="S15">
      <title>Validation of methylation motifs used for classification</title>
      <p id="P38"><italic>E. coli</italic> and <italic>H. pylori</italic> were sequenced with SMRT sequencing in order to confirm 4mC and 6mA methylation motifs using the RS_Modification_and_Motif_Analysis protocol from SMRT Analysis Server (v2.3.0). Methylation status summaries for the remaining bacterial species (modifications.csv and motif_summary.csv files) were obtained from the U.S. Department of Energy Joint Genome Institute and NEB. We confirmed effective methylation of 4mC and 6mA motifs individually by checking if IPD ratio (IPD<sub>native</sub> over IPD<sub>control</sub>, which is either obtained from a WGA sample or an <italic>in silico</italic> model) consistently peaked on expected methylated bases. Finally, REBASE annotation was used as a gold standard for 5mC motifs. Methylation motifs with an ambiguous status (<italic>e.g.</italic> weak or partial IPD ratio peaks) or not reported in REBASE annotation were not used for the classifier training and the performance evaluation.</p>
    </sec>
    <sec id="S16">
      <title>Motif typing and fine mapping</title>
      <p id="P39">For each bacterial genome, we list methylated genomic positions from each strand based on motif recognition sequences. Methylated positions in close proximity are discarded to avoid introducing unwanted complexity (at least 22 bp apart, each strand considered independently as current signal is strand specific). Ambiguous motifs are removed from downstream analysis (see <xref rid="S15" ref-type="sec">Validation of methylation motifs used for classification</xref> in <xref rid="S9" ref-type="sec">Methods</xref>). We extract current differences in [− 10 bp, + 11 bp] range relative to methylated base positions allowing for the subsequent creation of the offsetted dataset used for the classifier training. Each occurrence is labeled with genome of origin, recognition sequence, methylation type, methylation position within motif, and genomic coordinates. This dataset constitutes our methylation motif signatures for motif typing and fine mapping, while we use a subset of it, [− 6 bp, + 7 bp], to examine the variation of current differences across different DNA methylation types and motifs. Note that for <italic>de novo</italic> detected methylation motif and refinement function, signatures are generated considering every position in the motif as potentially methylated, which produced a longer signature not necessarily centered on the methylated base.</p>
      <p id="P40">The training dataset for classification is generated from methylation motif signatures to permit labeling of methylation type and position within motifs simultaneously (<xref rid="F4" ref-type="fig">Fig. 4a</xref>). For each vector of current differences from a methylated site, we generate 7 smaller vectors, lengths 12, offsetted by one position so that each of them still contains the [− 2 bp, + 3 bp] range relative to the methylated base (range with the most current differences, <xref rid="F6" ref-type="fig">Extended Data Fig. 1</xref>). In other words, those 7 vectors contain current differences from the [− 2 bp, + 3 bp] range with up to 3 additional position(s) before or after it (<italic>i.e.</italic> [− 5 bp, + 6 bp] +/− 0 to 3 bp). Each of those vectors is labeled with the type of DNA methylation from corresponding motifs as well as corresponding offset used (from − 3 to + 3) resulting in 21 different labels (7 offsets x 3 DNA methylation types).</p>
      <p id="P41">For the testing datasets, methylated base position is unknown and current difference vectors cannot be defined in the same way. However, methylated base position can be approximate by computing the center of current differences from a motif signature. For that, we average absolute current differences from a motif signature using a sliding window of length 5 and the position with the largest variation is used as an approximation of methylation position within the motif (<xref rid="F9" ref-type="fig">Extended Data Fig. 4a</xref>). In practice, approximations are not further than 3 bp from the methylated position meaning that the vectors of current differences centered on those approximations will match one type of vector offset used for training because they are generated with − 3 to + 3 bp offsets.</p>
      <p id="P42">Prior to any model fitting, the training dataset is balanced by random sampling to contain a similar number of vectors for each label in order to avoid bias toward the more common methylation type. In addition, we also attempted to balance the training dataset according to the local sequence context near the methylation (i.e. [− 1, + 1] range relative to the methylated base) by downsampling common context in priority instead of random sampling. However, while we observe an overall improvement of motif occurrences classification compared to the default balancing (average LOOCV accuracy +3.8%), not all motifs benefit from it. While the context balancing method does not currently improve the motif typing and fine mapping, we note that it could be helpful when the methylation motif signature database becomes larger. Classifier hyperparameters (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 4</xref>) were tuned on the balanced training dataset containing all motifs using repeated 10-fold cross-validation (n=3) with balanced accuracy (mean and standard deviation) as the main metric. Robustness of chosen hyperparameters was confirmed by comparing performances from three classifiers (k-nearest neighbors, random forest, and neural network) when using parameters either tuned on a dataset containing all motifs (as described above) or a dataset only containing <italic>H. pylori</italic> motifs only. Both sets of hyperparameters gave similar results when tested on a dataset without <italic>H. pylori</italic> motifs (<xref rid="F9" ref-type="fig">Extended Data Fig. 4d</xref>).</p>
      <p id="P43">Classifier performance evaluation was performed using leave-one-out cross-validation strategy (LOOCV) by holding out current difference vectors from one motif and training on remaining vectors (from all motifs except one). The resulting model is then used to predict the label of held out vectors from the tested motif. The LOOCV strategy simulates models’ behavior when faced with an unseen motif signature. For testing, we only used the set of vectors corresponding to the approximated methylation position found as described previously. Predicted methylated base type and position for a motif are defined using consensus across all tested motif occurrences. Note that the classifier prognosticates the offset between the approximated methylation position chosen as input and the predicted methylation position, which is then converted into a position within tested motifs. The confidence of the final prediction is defined as percentage of motif occurrences assigned to the type-position combination with the highest number of assignment. Alternatively, the p-value associated with the classifier prediction can be incorporated into the calculation of prediction confidence. One can leverage the p-value distribution generated from all occurrences of the same motifs to estimate the confidence of the prediction or define a confidence threshold.</p>
    </sec>
    <sec id="S17">
      <title>Nanopore sequencing based <italic>de novo</italic> assembly</title>
      <p id="P44">Genome assembly for <italic>E. coli</italic> was performed using Canu<sup><xref rid="R45" ref-type="bibr">45</xref></sup> (version 1.8; <italic>-nanopore-raw genomeSize=4.7m overlapper=mhap utgReAlign=true</italic>) with the native nanopore reads (200x dataset). Next, we generated the genomic consensus with Racon<sup><xref rid="R46" ref-type="bibr">46</xref></sup> (version 1.3.3; default parameters) to correct raw contigs, and correct contig ends using nucmer<sup><xref rid="R47" ref-type="bibr">47</xref></sup> (version 4.0.0beta; <italic>--maxmatch –nosimplify</italic> and <italic>show-coords -lrcTH</italic>) to identify and trim remaining overlaps. Then, we polished the assembly consensus using Nanopolish<sup><xref rid="R6" ref-type="bibr">6</xref></sup> (version 0.11.0; <italic>variants --min-candidate-frequency 0.1</italic> for five consecutive times) with the native nanopore reads. Finally, we performed another polishing step with Nanopolish using nanopore WGA reads (methylation free) to correct remaining assembly error caused by DNA methylation signal in the native reads (same parameters for five consecutive times).</p>
    </sec>
    <sec id="S18">
      <title>Metagenome methylation binning</title>
      <p id="P45">While methylation motif detection could be performed as for individual bacteria, metagenome assemblies often result in many contigs from multiple organisms with various lengths making individual contig analysis lacking power. Instead, we propose to first bin contigs with similar methylation profiles then perform the motif detection. Nanopore sequencing native and WGA datasets are processed in the same way as for individual bacteria (except that supplementary alignment were conserved) generating current differences alongside metagenome contigs using the nanopore sequencing-only <italic>de novo</italic> metagenome assembly.</p>
      <p id="P46"><italic>De novo</italic> metagenome assemblies for MGM1 and MGM2 were performed using Flye<sup><xref rid="R48" ref-type="bibr">48</xref></sup> (version 2.4.2; <italic>--meta –nano-raw –genome-size 100M</italic>) with the native nanopore reads. Next, the metagenome consensus was computed using Racon<sup><xref rid="R46" ref-type="bibr">46</xref></sup> for four consecutive rounds (default parameters). Then, the resulting metagenome assemblies were polished using Nanopolish<sup><xref rid="R6" ref-type="bibr">6</xref></sup> with first the native, then with the WGA nanopore reads (<italic>variants --min-candidate-frequency 0.1</italic> for five rounds with each set of reads).</p>
      <p id="P47">For a candidate motif, an associated methylation feature vector is computed by averaging current differences from aggregated occurrences on a metagenomic contig (<xref rid="F13" ref-type="fig">Extended Data Fig. 8</xref>). Unlike well-characterized methylation motifs, the methylated position in a candidate motif is unknown. Therefore, we consider every position in motifs as potentially methylated by including all potentially affected current differences in the methylation feature vector calculation. For a motif of length k, we compute a methylation feature vector of length k + (2 + 3), which corresponds to the length of current differences that are possibly affected by a methylated base in a k-mer motif (the core current differences is defined as [− 2 bp, + 3 bp] range flanking a methylated base, <xref rid="F6" ref-type="fig">Extended Data Fig. 1</xref>). This procedure results in a methylation feature vector of average current differences of length k + 5, which effectively capture methylation signal flanking a motif of interest for a contig, and discriminate between different modification types of the same motif. This step represents a major difference from SMRT sequencing based methylation binning method where a single methylation score is generated for a motif on a contig<sup><xref rid="R30" ref-type="bibr">30</xref></sup>.</p>
      <p id="P48">The next step is to create a methylation profile matrix comprising methylation feature vectors for each motif of interest in each metagenomic contig, which will be used for methylation binning (<xref rid="F13" ref-type="fig">Extended Data Fig. 8</xref>). A set of 210,176 candidate motifs is generated according to common structures (4-, 5-, and 6-mers, as well as bipartite motifs with 3 to 4 bp specificity part separated by 5 to 6 bp gaps). In order to select motifs of interest, an initial round of motif evaluation is performed on a subset of longer contigs (100 kbp using nanopore sequencing <italic>de novo</italic> assembly) with sufficient coverage (10x; <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 2</xref>) with the rationale that results will have a higher statistical power. Uninformative methylation features are filtered out by discarding the ones with small absolute current difference values across the initial contig set (&lt; 1.5 pA; chosen based on our mock metagenome analysis) as well as the ones computed from fewer than 20 motif occurrences. Next, we additionally filtered out uninformative methylation features from bipartite motifs by removing methylation feature vectors with fewer than two significant features across the initial contig set (significant features if absolute value &gt;= 1.5 pA) to account for the longer vector and generally lower motif frequency. Finally, methylation features from bipartite motifs that overlap with any remaining 4 to 6-mer motifs are also discarded. The resulting list of informative methylation features is then evaluated in each contig of the metagenome assembly to construct a methylation profile matrix (<xref rid="F13" ref-type="fig">Extended Data Fig. 8</xref>). This two-step approach effectively reduces the initial research space on the set of large contigs speeding up the analysis, and reduces noise by only considering methylation features selected from contigs with higher statistical power. The resulting methylation profile matrix (significant methylation features computed across all contigs) is then processed using t-SNE dimensionality reduction method to visualize contig clusters (<xref rid="F13" ref-type="fig">Extended Data Fig. 8</xref>). Missing methylation features and ones computed from fewer than 5 motifs occurrences are set to small random pseudovalues in the [− 0.2, + 0.2] range (reducing correlation from missing methylation features; random number generation seeds are set at 2, 3, and 4 for MGM1, MGM2, and the SMRT assemblies respectively). Small contigs are not considered for methylation binning (&lt;25 kbp for the nanopore sequencing <italic>de novo</italic> assembly analysis), and remaining ones are weighted according to their length. Weighting factors are defined as quotient of contig length divided by 50,000 and capped at a percentage of the number of remaining contigs to avoid extreme imbalance (only contigs with coverage &gt;= 10x for both native and WGA are weighted). We set the capping value at 5% for metagenome with high diversity (large number of metagenome contigs, MGM1) and 10% for simpler metagenome (&lt;500 contigs, MGM2). Finally, bins are defined after t-SNE dimension reduction using DBSCAN (package dbscan version 1.1-4; size of the epsilon neighborhood, <italic>eps</italic>, set to 5 and number of minimum points in the <italic>eps</italic> region, <italic>minPts</italic>, set to 3), an automated clustering method, with additional manual annotation of visible bins that can be missed by DBSCAN.</p>
      <p id="P49">The analysis using the SMRT metagenome assembly (GCA_002754755.1) is performed as described previously using thresholds of 500 kbp and 10x of coverage for initial methylation feature selection (contigs from Bin 3, Bin 4, and Bin 9 are not covered sufficiently due to the use of a different DNA extraction kit than the SMRT study). Contigs smaller than 10 kbp are not considered.</p>
      <p id="P50">Motif detection from bins is performed the same way as for individual bacteria. With <italic>de novo</italic> detected motifs, methylation feature vectors used for binning are not filtered, keeping the full-length methylation feature vectors. Missing methylation features from individual contigs are handled as described previously and contigs are also weighted. We performed three consecutive rounds of binning and motif detection for MGM1 as new bins and therefore new methylation motifs are identified in the first two rounds (<xref rid="F14" ref-type="fig">Extended Data Fig. 9</xref>), while one round was sufficient for MGM2 (<xref rid="F15" ref-type="fig">Extended Data Fig. 10</xref>). Confirmation of <italic>de novo</italic> discovered motifs in MGM1 sample (potential 6mA and 4mC motifs) from nanopore sequencing analysis were realized with per bin motif detection from SMRT sequencing data using the SMRT portal pipeline (RS_Modification_and_Motif_Analysis.1).</p>
      <p id="P51">Binning focused on associating mobile genetic elements (MGEs) to host genome (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 3b</xref>) was performed using metagenome reference from the SMRT study where binned contigs were replaced by per-bin reassemblies<sup><xref rid="R6" ref-type="bibr">6</xref></sup>. MGEs contigs from the nanopore-only <italic>de novo</italic> metagenome assemblies were identified according to the alignment of MGEs sequences from the SMRT study using minimap2 (version 2.15; <italic>-ax asm20</italic>)<sup><xref rid="R49" ref-type="bibr">49</xref></sup>.</p>
    </sec>
    <sec id="S19">
      <title>Detection of metagenome contigs misassemblies</title>
      <p id="P52">The rationale is to examine the consistency of methylation signal for a motif across different occurrence of the motif along a metagenomic contig. For every single motif occurrence, we calculate a score by taking the average of absolute current differences from six consecutives positions with the most perturbation. Then, these individual scores are averaged using a sliding window across the contig to examine the continuity. Motif occurrences from both strands are used in this analysis. However, if a motif occurrence overlaps with another motif site being examined (&lt;15 bp) then both are discarded.</p>
    </sec>
    <sec sec-type="data-availability" id="S20">
      <title>Data availability</title>
      <p id="P53">All sequencing data generated for this study are available at Sequence Read Archive (SRA) under the BioProjects PRJNA559199 for individual bacteria and PRJNA559386 for the mouse gut microbiomes samples. NCBI reference sequences used for the individual bacteria analysis are available under the accession codes: CP041693, CP041696, NC_008261.1, CP014225.1, CP023448.1, NC_007796.1, NC_002946.2, CP041695, and CP003732.1 (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>). Information related to methylation motifs are available from REBASE database (<ext-link ext-link-type="uri" xlink:href="http://rebase.neb.com">http://rebase.neb.com</ext-link>)<sup><xref rid="R16" ref-type="bibr">16</xref></sup>. Data from the SMRT sequencing metagenomic study can be found under the BioProject PRJNA404082.</p>
    </sec>
    <sec id="S21">
      <title>Code availability</title>
      <p id="P54">Software nanodisco and a detailed tutorial with supporting data are available at <ext-link ext-link-type="uri" xlink:href="http://github.com/fanglab/nanodisco">http://github.com/fanglab/nanodisco</ext-link>.</p>
    </sec>
  </sec>
  <sec sec-type="extended-data" id="S22">
    <title>Extended Data</title>
    <fig id="F6" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 1</label>
      <caption>
        <title>General statistics of motif signatures.</title>
        <p id="P63">(<bold>a</bold>) Distribution of current differences are shown for all confident motifs altogether (n=46 motifs) as well as average absolute differences and associated standard deviations near methylated bases ([− 10 bp, + 11 bp]). The lower and upper hinges correspond to the 25th and 75th percentiles while the lower and upper whisker extends to the minima and maxima respectively (capped at 1.5 time the inter-quartile range). (<bold>b</bold>) Same as <bold>a</bold> with distinction between DNA methylation types (n=28 6mA motifs, n=7 4mC motifs, n=11 5mC motifs). (<bold>c</bold>) Same as <bold>a</bold> but for individual methylation motifs.</p>
      </caption>
      <graphic xlink:href="nihms-1680058-f0006"/>
    </fig>
    <fig id="F7" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 2</label>
      <caption>
        <title>Systematic examination of three main DNA methylation types with nanopore sequencing.</title>
        <p id="P64">(<bold>a</bold>) t-SNE projection of isolated methylation motif occurrences separated per motif. The same dataset as <xref rid="F2" ref-type="fig">Fig. 2b</xref> was used with occurrences colored per motif. Other motifs are colored in grey. (<bold>b</bold>) Same as <bold>a</bold> but grouped by methylation type.</p>
      </caption>
      <graphic xlink:href="nihms-1680058-f0007"/>
    </fig>
    <fig id="F8" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 3</label>
      <caption>
        <title>Nanopore sequencing signal processing variable.</title>
        <p id="P65">(<bold>a</bold>) Comparison of current differences across methylation occurrences between datasets base called with Albacore 1.1.0, Albacore 2.3.4, and Guppy 3.2.4 illustrated by projection with t-SNE from for 46 well-characterized motifs (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 2</xref>). Each dot represents one isolated motif occurrence colored by base caller versions. 100, 000 motif occurrences were randomly selected from each dataset to reduce the scatter plot density and ease the visualization. For each motif occurrence, current differences from 22 positions near methylated bases ([− 10 bp, + 11 bp]) were used. (<bold>b</bold>) Performance for <italic>de novo</italic> methylated site detection between datasets base called with Albacore 1.1.0, Albacore 2.3.4, and Guppy 3.2.4. We evaluated individual motif occurrences detection using Precision-Recall curves for <italic>H. pylori</italic> at 75x coverage. Precision-Recall curves and area under the curves (AUC) were computed as described in the <xref rid="S9" ref-type="sec">Method</xref> section. Only confident <italic>H. pylori</italic> motifs were considered for the evaluation. (<bold>c</bold>) Comparison of current differences across methylation occurrences (same as <bold>a</bold>) between datasets produced with or without outlier removal step (<xref rid="S9" ref-type="sec">Methods</xref>). (<bold>d</bold>) Performance for <italic>de novo</italic> methylated site detection (similar than <bold>b</bold>) with datasets produced with or without outlier removal step. (<bold>e</bold>) Variation of current differences across methylation occurrences without outlier removal step as illustrated by motif signatures from three motifs, AG4mCT (n=6550 occurrences), GGW5mCC (n=1875 occurrences), and GCYYG6mAT (n=954 occurrences). For each motif, current differences near methylated bases ([− 6 bp, + 7 bp]) from all isolated occurrences are plotted with conservation of relative distances to methylated bases. Distributions of current differences for each relative distance are displayed as a violin plot. Current differences axis is limited to −8 to 8 pA range. (<bold>f</bold>) Performance for <italic>de novo</italic> methylated site detection across current difference datasets generated with different read alignment type filtering: remove alternative alignments (filtered out XA bam flags; named No Alt.), remove supplementary alignments (filtered out 2048 bam flags; named No Supp.), remove chimeric alignments (filtered out SA bam flags; named No Chim.), only conserve unique mapping (filtered out XA and SA bam flags; named Unique), and keep all alignments (named None). (<bold>g</bold>) Performance for <italic>de novo</italic> methylated site detection across datasets normalized with linear regression (lm function), robust regression (rlm function) or no additional normalization (annotated as none). (<bold>h</bold>) Performance for <italic>de novo</italic> methylated site detection across datasets generated using two-sided Mann-Whitney U test or Student’s t-test. (<bold>i</bold>) Performance for <italic>de novo</italic> methylated site detection across datasets generated using different p-value smoothing window size: no smoothing (named None), 3 nt, 5 nt, and 7 nt. (<bold>j</bold>) Performance for <italic>de novo</italic> methylated site detection across datasets generated using different function for combining consecutives p-values: Fisher’s method (named sumlog), logit method (named logitp), sum p method (named sump), and sum z method (named sumz). (<bold>k</bold>) Performance for <italic>de novo</italic> methylated site detection across peaks datasets generated using different peak detection window size: 5 nt, 7 nt, and 9 nt. Plots <bold>f</bold>, <bold>g</bold>, <bold>h</bold>, <bold>i</bold>, <bold>j</bold>, and <bold>k</bold> show Precision-Recall curves and area under the curves (AUC) for various signal processing steps and were computed as described in the <xref rid="S9" ref-type="sec">Method</xref> section. (<bold>l</bold>) Comparison of current differences across methylation occurrences (same as <bold>a</bold>) with <italic>E. coli</italic> datasets (200x) produced using either the reference genome or the <italic>de novo</italic> assembly (<xref rid="S9" ref-type="sec">Methods</xref>). (<bold>m</bold>) Performance for <italic>de novo</italic> methylated site detection in <italic>E. coli</italic> datasets (200x) using either the reference genome or the <italic>de novo</italic> assembly. (<bold>n</bold>) Performance of methylation motif typing and fine mapping on <italic>E. coli</italic> datasets (200x) produced using either the reference genome or the <italic>de novo</italic> assembly (motif occurrences: n=458 for AACNNNNNNGTGC, n=18451 for CCWGG, n=28110 for GATC, n=463 for GCACNNNNNNGTT). Only results for k-nearest neighbors, neural network, and random forest are displayed.</p>
      </caption>
      <graphic xlink:href="nihms-1680058-f0008"/>
    </fig>
    <fig id="F9" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 4</label>
      <caption>
        <title>Additional information for classification of methylation motif occurrences.</title>
        <p id="P66">(<bold>a</bold>) Approximation of DNA methylation position in three motifs, AG4mCT (n=6549 occurrences), GGW5mCC (n=1875 occurrences), and GCYYG6mAT (n=954 occurrences). Signal strength is computed using a sliding window alongside motif signature to choose the best vector positioning to use for classification. (<bold>b</bold>) Flowchart description of procedure for classifier training and novel motifs dataset annotation. Training the classifier consists of gathering a set of bacteria with characterized methylomes. Confident motifs are selected to assure the robustness of the final classifier, then all motif occurrences are localized in the genome (from corresponding reference genome or <italic>de novo</italic> assembled and polished genome). Current differences are then computed along the genome. Next, the training dataset is built from the offsetted vector of current differences labelled with the known methylation type and the offset combination. Finally, the classifier is trained using the chosen model(s). Analyzing a new bacterial sample consists of <italic>de novo</italic> detecting the methylated motif from processed current differences (see <xref rid="S9" ref-type="sec">Methods</xref>). Then methylated motif occurrences are localized and the motif signatures are computed (i.e. distribution of current differences at relative distance from the methylated bases). Next, those signatures are leveraged to approximate the methylated position for each <italic>de novo</italic> detected motif (see <xref rid="S9" ref-type="sec">Methods</xref>), which is used to define the classifier inputs (i.e. vector of current differences centered on the approximate methylated position). Finally, the trained classifier is used to predict the methylation type and fine map the DNA methylation for each motif. (<bold>c</bold>) Boxplot of overall prediction accuracy in LOOCV evaluation (n=46 motifs) for each classifier. Classifiers are ordered by average accuracy. The lower and upper hinges correspond to the 25th and 75th percentiles while the lower and upper whisker extends to the minima and maxima respectively (capped at 1.5 time the inter-quartile range). (<bold>d</bold>) Effect of hyperparameters on classification accuracy. Boxplot of overall prediction accuracy in LOOCV evaluation with classifiers trained on all motifs except the ones from <italic>H. pylori</italic> (n=27 motifs). Hyperparameters were either tuned on <italic>H. pylori</italic> motifs only (“Alt. HP”) or on all motifs (“Main HP”). The lower and upper hinges correspond to the 25th and 75th percentiles while the lower and upper whisker extends to the minima and maxima respectively (capped at 1.5 time the inter-quartile range). (<bold>e</bold>) Relationship between LOOCV accuracy and current difference signal similarities. Current difference signal near methylated bases is visualized by projection with t-SNE for the 46 well-characterized motifs similar to <xref rid="F2" ref-type="fig">Fig. 2b</xref>. Each dot represents one isolated motif occurrence colored by accuracy from LOOCV analysis.</p>
      </caption>
      <graphic xlink:href="nihms-1680058-f0009"/>
    </fig>
    <fig id="F10" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 5</label>
      <caption>
        <title>Classification and fine mapping of three types of DNA methylation (part 1).</title>
        <p id="P67">Similar to <xref rid="F4" ref-type="fig">Fig. 4d</xref> with full set of prediction results for a subset of methylation motifs for k-nearest neighbors, random forest, and neural network. Filling colors correspond to percentage of occurrences classified to a specific class ranging from blue (0%) to red (100%). Greyed out prediction correspond to out of motif position. Blank columns correspond to within-motif positions without prediction. Prediction percentages of expected classes are displayed in italic and selected predictions based on consensus are displayed in bold.</p>
      </caption>
      <graphic xlink:href="nihms-1680058-f0010"/>
    </fig>
    <fig id="F11" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 6</label>
      <caption>
        <title>Classification and fine mapping of three types of DNA methylation (part 2).</title>
        <p id="P68">See <xref rid="F10" ref-type="fig">Extended Data Fig. 5</xref>.</p>
      </caption>
      <graphic xlink:href="nihms-1680058-f0011"/>
    </fig>
    <fig id="F12" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 7</label>
      <caption>
        <title>Evaluation of motif enrichment with Precision-Recall curves.</title>
        <p id="P69">(<bold>a</bold>) Effect of coverage on <italic>de novo</italic> methylated site detection. We evaluated individual motif occurrences detection using Precision-Recall curves (PR curves) for <italic>H. pylori</italic>. Studied datasets with coverage ranging from 5x to 200x were generated by random subsampling of native and WGA datasets. Precision-Recall curves were generated as described in the <xref rid="S9" ref-type="sec">Method</xref> section. We considered only confident <italic>H. pylori</italic> motifs for evaluation. (<bold>b</bold>) Same as <bold>a</bold> but using ROC curves for representation. Motif occurrences without data due to low coverage (&lt;5x) were not considered. (<bold>c</bold>) Performance of methylation motif typing and fine mapping (n=46 motifs) on datasets with genomic coverage subsampled at 10x, 15x, 20x, and 30x. Only results for k-nearest neighbors, neural network, and random forest are displayed. (<bold>d</bold>) Precision-Recall curves summarizing the detection performance at 75x coverage of individual methylation sites for each motif in <italic>H. pylori</italic> with adjusted frequency (<xref rid="S9" ref-type="sec">Methods</xref>). (<bold>e</bold>) Same as <bold>d</bold> but using ROC curves for representation. (<bold>f</bold>) Effect of motif frequency on <italic>de novo</italic> methylated site detection. For each methylation motif, <italic>in silico</italic> datasets with a wide range of motif frequencies were created using a random subsampling strategy (either the motif occurrences or the genomic regions without motifs, see <xref rid="S9" ref-type="sec">Methods</xref>). The natural motif frequencies (i.e. the original ratio of motif occurrences over all queried regions) are annotated by a point on each motif curve.</p>
      </caption>
      <graphic xlink:href="nihms-1680058-f0012"/>
    </fig>
    <fig id="F13" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 8</label>
      <caption>
        <title>Schematic representation of methylation feature vectors computation and methylation binning of contigs.</title>
        <p id="P70">The computation of methylation features and the building of the methylation profile matrix is described in the method.</p>
      </caption>
      <graphic xlink:href="nihms-1680058-f0013"/>
    </fig>
    <fig id="F14" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 9</label>
      <caption>
        <title>Detailed methylation analysis of MGM1 sample.</title>
        <p id="P71">(<bold>a</bold>) Methylation binning using automated methylation features selection (without precise methylation motif discovery; <xref rid="S9" ref-type="sec">Methods</xref>). Methylation features are projected on two dimensions using t-SNE. Contigs are colored per bin defined using DBSCAN, with point sizes matching contig length according to the legend. Two bins with the same methylation motifs were manually merged into Bin 4. (<bold>b</bold>) Methylation binning using <italic>de novo</italic> discovered motifs on each bin found in <bold>a</bold> (<xref rid="S9" ref-type="sec">Methods</xref>). Methylation features computed from <italic>de novo</italic> discovered motifs are projected on two dimensions using t-SNE. Contigs are colored per bin defined using DBSCAN except Bin 11, which was manually defined. (<bold>c</bold>) Methylation binning using <italic>de novo</italic> discovered motifs on each bin found in <bold>b</bold>. Contigs are colored per bin defined using DBSCAN except for Bin 13, which was manually defined. (<bold>d</bold>) Methylation binning of MGM1 metagenome contigs using <italic>de novo</italic> discovered motifs (after three rounds of motif discovery (same as <xref rid="F5" ref-type="fig">Fig. 5a</xref>).</p>
      </caption>
      <graphic xlink:href="nihms-1680058-f0014"/>
    </fig>
    <fig id="F15" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 10</label>
      <caption>
        <title>Detailed methylation analysis of MGM2 sample.</title>
        <p id="P72">(<bold>a</bold>) Methylation binning using automated methylation features selection (without precise methylation motif discovery; <xref rid="S9" ref-type="sec">Methods</xref>). Methylation features are projected on two dimensions using t-SNE. Contigs are colored per defined bin with point sizes matching contig length according to the legend. Bin 1, 3, 4, and 5 were defined using DBSCAN. The other bins are composed of one or two contigs and were manually defined after <italic>de novo</italic> methylation motif discovery. (<bold>b</bold>) Methylation binning using <italic>de novo</italic> discovered motifs on each bin found in <bold>a</bold> (<xref rid="S9" ref-type="sec">Methods</xref>). Methylation features computed from <italic>de novo</italic> discovered motifs are projected on two dimensions using t-SNE. Contigs are colored per bin as described in <bold>a</bold>.</p>
      </caption>
      <graphic xlink:href="nihms-1680058-f0015"/>
    </fig>
  </sec>
  <sec sec-type="supplementary-material" id="SM1">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>Supplementary Information</label>
      <media xlink:href="NIHMS1680058-supplement-Supplementary_Information.pdf" orientation="portrait" id="d40e1847" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>Supplementary Tables</label>
      <media xlink:href="NIHMS1680058-supplement-Supplementary_Tables.xlsx" orientation="portrait" id="d40e1851" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S23">
    <title>Acknowledgements</title>
    <p id="P55">We thank Alexey Fomenkov and Sir Richard J. Roberts from New England Biolabs for their help with the bacterial strain selection and for providing us with DNA samples (<italic>B. amyloliquefaciens</italic>, <italic>B. fusiformis</italic>, and <italic>N. otitidiscaviarum</italic>). We also thank Robert Gunsalus from the University of California, Los Angeles (<italic>M. hungatei</italic>), Susan Logan from the National Research Council Canada (<italic>C. perfringens</italic>), Lydgia Jackson from the University of Oklahoma Health Sciences Center (<italic>N. gonorrhoeae</italic>), Bernhard Schink, Nicolai Müller, and Anja Keller from the University of Konstanz, Germany (<italic>T. phaeum</italic>) for providing us with DNA samples. We thank Yimeng Kong and Mi Ni for providing helpful feedback for early versions of this manuscript. This work was supported by a seed fund from Icahn Institute for Genomics and Multiscale Biology (G.F.), and by R01 GM128955 (G.F.), R35 GM139655 (G.F.) and R56 HG011095 (G.F.) from the National Institutes of Health. G.F. is a Hirschl Research Scholar by Irma T. Hirschl/Monique Weill-Caulier Trust, and a Nash Family Research Scholar. This work was also supported in part through the computational resources and staff expertise provided by the Department of Scientific Computing at the Icahn School of Medicine at Mount Sinai.</p>
  </ack>
  <fn-group>
    <fn id="FN2">
      <p id="P56">Ethics declaration</p>
      <p id="P57">A.T. and G.F. are inventors of two US Provisional patent applications (62/860,952 and 62/851,205) that describe the methods in this manuscript.</p>
    </fn>
  </fn-group>
  <ref-list>
    <title>Reference</title>
    <ref id="R1">
      <label>1.</label>
      <mixed-citation publication-type="journal"><name><surname>Beaulaurier</surname><given-names>J</given-names></name>, <name><surname>Schadt</surname><given-names>EE</given-names></name> &amp; <name><surname>Fang</surname><given-names>G</given-names></name>
<article-title>Deciphering bacterial epigenomes using modern sequencing technologies</article-title>. <source>Nat Rev Genet</source>
<volume>20</volume>, <fpage>157</fpage>–<lpage>172</lpage> (<year>2019</year>).<pub-id pub-id-type="pmid">30546107</pub-id></mixed-citation>
    </ref>
    <ref id="R2">
      <label>2.</label>
      <mixed-citation publication-type="journal"><name><surname>Flusberg</surname><given-names>BA</given-names></name><etal/><article-title>Direct detection of DNA methylation during single-molecule, real-time sequencing</article-title>. <source>Nat Methods</source><volume>7</volume>, <fpage>461</fpage>–<lpage>465</lpage> (<year>2010</year>).<pub-id pub-id-type="pmid">20453866</pub-id></mixed-citation>
    </ref>
    <ref id="R3">
      <label>3.</label>
      <mixed-citation publication-type="journal"><name><surname>Blow</surname><given-names>MJ</given-names></name><etal/><article-title>The Epigenomic Landscape of Prokaryotes</article-title>. <source>PLoS Genet</source><volume>12</volume>, <fpage>e1005854</fpage> (<year>2016</year>).<pub-id pub-id-type="pmid">26870957</pub-id></mixed-citation>
    </ref>
    <ref id="R4">
      <label>4.</label>
      <mixed-citation publication-type="journal"><name><surname>Laszlo</surname><given-names>AH</given-names></name><etal/><article-title>Detection and mapping of 5-methylcytosine and 5-hydroxymethylcytosine with nanopore MspA</article-title>. <source>Proc Natl Acad Sci U S A</source><volume>110</volume>, <fpage>18904</fpage>–<lpage>18909</lpage> (<year>2013</year>).<pub-id pub-id-type="pmid">24167255</pub-id></mixed-citation>
    </ref>
    <ref id="R5">
      <label>5.</label>
      <mixed-citation publication-type="journal"><name><surname>Schreiber</surname><given-names>J</given-names></name><etal/><article-title>Error rates for nanopore discrimination among cytosine, methylcytosine, and hydroxymethylcytosine along individual DNA strands</article-title>. <source>Proc Natl Acad Sci U S A</source><volume>110</volume>, <fpage>18910</fpage>–<lpage>18915</lpage> (<year>2013</year>).<pub-id pub-id-type="pmid">24167260</pub-id></mixed-citation>
    </ref>
    <ref id="R6">
      <label>6.</label>
      <mixed-citation publication-type="journal"><name><surname>Simpson</surname><given-names>JT</given-names></name><etal/><article-title>Detecting DNA cytosine methylation using nanopore sequencing</article-title>. <source>Nat Methods</source><volume>14</volume>, <fpage>407</fpage>–<lpage>410</lpage> (<year>2017</year>).<pub-id pub-id-type="pmid">28218898</pub-id></mixed-citation>
    </ref>
    <ref id="R7">
      <label>7.</label>
      <mixed-citation publication-type="journal"><name><surname>Rand</surname><given-names>AC</given-names></name><etal/><article-title>Mapping DNA methylation with high-throughput nanopore sequencing</article-title>. <source>Nat Methods</source><volume>14</volume>, <fpage>411</fpage>–<lpage>413</lpage> (<year>2017</year>).<pub-id pub-id-type="pmid">28218897</pub-id></mixed-citation>
    </ref>
    <ref id="R8">
      <label>8.</label>
      <mixed-citation publication-type="journal"><name><surname>McIntyre</surname><given-names>ABR</given-names></name><etal/><article-title>Single-molecule sequencing detection of N6-methyladenine in microbial reference materials</article-title>. <source>Nat Commun</source><volume>10</volume>, <fpage>579</fpage> (<year>2019</year>).<pub-id pub-id-type="pmid">30718479</pub-id></mixed-citation>
    </ref>
    <ref id="R9">
      <label>9.</label>
      <mixed-citation publication-type="journal"><name><surname>Ni</surname><given-names>P</given-names></name><etal/><article-title>DeepSignal: detecting DNA methylation state from Nanopore sequencing reads using deep-learning</article-title>. <source>Bioinformatics</source><volume>35</volume>, <fpage>4586</fpage>–<lpage>4595</lpage> (<year>2019</year>).<pub-id pub-id-type="pmid">30994904</pub-id></mixed-citation>
    </ref>
    <ref id="R10">
      <label>10.</label>
      <mixed-citation publication-type="journal"><name><surname>Liu</surname><given-names>Q</given-names></name><etal/><article-title>Detection of DNA base modifications by deep recurrent neural network on Oxford Nanopore sequencing data</article-title>. <source>Nat Commun</source><volume>10</volume>, <fpage>2449</fpage> (<year>2019</year>).<pub-id pub-id-type="pmid">31164644</pub-id></mixed-citation>
    </ref>
    <ref id="R11">
      <label>11.</label>
      <mixed-citation publication-type="journal"><name><surname>Liu</surname><given-names>Q</given-names></name>, <name><surname>Georgieva</surname><given-names>DC</given-names></name>, <name><surname>Egli</surname><given-names>D</given-names></name> &amp; <name><surname>Wang</surname><given-names>K</given-names></name>
<article-title>NanoMod: a computational tool to detect DNA modifications using Nanopore long-read sequencing data</article-title>. <source>BMC Genomics</source>
<volume>20</volume>, <fpage>78</fpage> (<year>2019</year>).<pub-id pub-id-type="pmid">30712508</pub-id></mixed-citation>
    </ref>
    <ref id="R12">
      <label>12.</label>
      <mixed-citation publication-type="journal"><name><surname>Stoiber</surname><given-names>M</given-names></name><etal/><article-title>De novo Identification of DNA Modifications Enabled by Genome-Guided Nanopore Signal Processing</article-title>. <source>bioRxiv</source> (<year>2017</year>).</mixed-citation>
    </ref>
    <ref id="R13">
      <label>13.</label>
      <mixed-citation publication-type="journal"><name><surname>Amarasinghe</surname><given-names>SL</given-names></name><etal/><article-title>Opportunities and challenges in long-read sequencing data analysis</article-title>. <source>Genome Biol</source><volume>21</volume>, <fpage>30</fpage> (<year>2020</year>).<pub-id pub-id-type="pmid">32033565</pub-id></mixed-citation>
    </ref>
    <ref id="R14">
      <label>14.</label>
      <mixed-citation publication-type="journal"><name><surname>Wion</surname><given-names>D</given-names></name> &amp; <name><surname>Casadesus</surname><given-names>J</given-names></name>
<article-title>N6-methyl-adenine: an epigenetic signal for DNA-protein interactions</article-title>. <source>Nat Rev Microbiol</source>
<volume>4</volume>, <fpage>183</fpage>–<lpage>192</lpage> (<year>2006</year>).<pub-id pub-id-type="pmid">16489347</pub-id></mixed-citation>
    </ref>
    <ref id="R15">
      <label>15.</label>
      <mixed-citation publication-type="journal"><name><surname>Casadesus</surname><given-names>J</given-names></name> &amp; <name><surname>Low</surname><given-names>D</given-names></name>
<article-title>Epigenetic gene regulation in the bacterial world</article-title>. <source>Microbiol Mol Biol Rev</source>
<volume>70</volume>, <fpage>830</fpage>–<lpage>856</lpage> (<year>2006</year>).<pub-id pub-id-type="pmid">16959970</pub-id></mixed-citation>
    </ref>
    <ref id="R16">
      <label>16.</label>
      <mixed-citation publication-type="journal"><name><surname>Roberts</surname><given-names>RJ</given-names></name>, <name><surname>Vincze</surname><given-names>T</given-names></name>, <name><surname>Posfai</surname><given-names>J</given-names></name> &amp; <name><surname>Macelis</surname><given-names>D</given-names></name>
<article-title>REBASE--a database for DNA restriction and modification: enzymes, genes and genomes</article-title>. <source>Nucleic Acids Res</source>
<volume>43</volume>, <fpage>D298</fpage>–<lpage>299</lpage> (<year>2015</year>).<pub-id pub-id-type="pmid">25378308</pub-id></mixed-citation>
    </ref>
    <ref id="R17">
      <label>17.</label>
      <mixed-citation publication-type="journal"><name><surname>Van Der Maaten</surname><given-names>L</given-names></name><article-title>Accelerating t-SNE using tree-based algorithms</article-title>. <source>J. Mach. Learn. Res</source>. <volume>15</volume>, <fpage>3221</fpage>–<lpage>3245</lpage> (<year>2014</year>).</mixed-citation>
    </ref>
    <ref id="R18">
      <label>18.</label>
      <mixed-citation publication-type="journal"><name><surname>Bailey</surname><given-names>TL</given-names></name>, <name><surname>Johnson</surname><given-names>J</given-names></name>, <name><surname>Grant</surname><given-names>CE</given-names></name> &amp; <name><surname>Noble</surname><given-names>WS</given-names></name>
<article-title>The MEME Suite</article-title>. <source>Nucleic Acids Res</source>
<volume>43</volume>, <fpage>W39</fpage>–<lpage>49</lpage> (<year>2015</year>).<pub-id pub-id-type="pmid">25953851</pub-id></mixed-citation>
    </ref>
    <ref id="R19">
      <label>19.</label>
      <mixed-citation publication-type="journal"><name><surname>Saeed</surname><given-names>I</given-names></name>, <name><surname>Tang</surname><given-names>SL</given-names></name> &amp; <name><surname>Halgamuge</surname><given-names>SK</given-names></name>
<article-title>Unsupervised discovery of microbial population structure within metagenomes using nucleotide base composition</article-title>. <source>Nucleic Acids Res</source>
<volume>40</volume>, <fpage>e34</fpage> (<year>2012</year>).<pub-id pub-id-type="pmid">22180538</pub-id></mixed-citation>
    </ref>
    <ref id="R20">
      <label>20.</label>
      <mixed-citation publication-type="journal"><name><surname>Iverson</surname><given-names>V</given-names></name><etal/><article-title>Untangling genomes from metagenomes: revealing an uncultured class of marine Euryarchaeota</article-title>. <source>Science</source><volume>335</volume>, <fpage>587</fpage>–<lpage>590</lpage> (<year>2012</year>).<pub-id pub-id-type="pmid">22301318</pub-id></mixed-citation>
    </ref>
    <ref id="R21">
      <label>21.</label>
      <mixed-citation publication-type="journal"><name><surname>Laczny</surname><given-names>CC</given-names></name>, <name><surname>Pinel</surname><given-names>N</given-names></name>, <name><surname>Vlassis</surname><given-names>N</given-names></name> &amp; <name><surname>Wilmes</surname><given-names>P</given-names></name>
<article-title>Alignment-free visualization of metagenomic data by nonlinear dimension reduction</article-title>. <source>Sci Rep</source>
<volume>4</volume>, <fpage>4516</fpage> (<year>2014</year>).<pub-id pub-id-type="pmid">24682077</pub-id></mixed-citation>
    </ref>
    <ref id="R22">
      <label>22.</label>
      <mixed-citation publication-type="journal"><name><surname>Laczny</surname><given-names>CC</given-names></name><etal/><article-title>VizBin - an application for reference-independent visualization and human-augmented binning of metagenomic data</article-title>. <source>Microbiome</source><volume>3</volume>, <fpage>1</fpage> (<year>2015</year>).<pub-id pub-id-type="pmid">25621171</pub-id></mixed-citation>
    </ref>
    <ref id="R23">
      <label>23.</label>
      <mixed-citation publication-type="journal"><name><surname>Albertsen</surname><given-names>M</given-names></name><etal/><article-title>Genome sequences of rare, uncultured bacteria obtained by differential coverage binning of multiple metagenomes</article-title>. <source>Nat Biotechnol</source><volume>31</volume>, <fpage>533</fpage>–<lpage>538</lpage> (<year>2013</year>).<pub-id pub-id-type="pmid">23707974</pub-id></mixed-citation>
    </ref>
    <ref id="R24">
      <label>24.</label>
      <mixed-citation publication-type="journal"><name><surname>Sharon</surname><given-names>I</given-names></name><etal/><article-title>Time series community genomics analysis reveals rapid shifts in bacterial species, strains, and phage during infant gut colonization</article-title>. <source>Genome Res</source><volume>23</volume>, <fpage>111</fpage>–<lpage>120</lpage> (<year>2013</year>).<pub-id pub-id-type="pmid">22936250</pub-id></mixed-citation>
    </ref>
    <ref id="R25">
      <label>25.</label>
      <mixed-citation publication-type="journal"><name><surname>Alneberg</surname><given-names>J</given-names></name><etal/><article-title>Binning metagenomic contigs by coverage and composition</article-title>. <source>Nat Methods</source><volume>11</volume>, <fpage>1144</fpage>–<lpage>1146</lpage> (<year>2014</year>).<pub-id pub-id-type="pmid">25218180</pub-id></mixed-citation>
    </ref>
    <ref id="R26">
      <label>26.</label>
      <mixed-citation publication-type="journal"><name><surname>Nielsen</surname><given-names>HB</given-names></name><etal/><article-title>Identification and assembly of genomes and genetic elements in complex metagenomic samples without using reference genomes</article-title>. <source>Nat Biotechnol</source><volume>32</volume>, <fpage>822</fpage>–<lpage>828</lpage> (<year>2014</year>).<pub-id pub-id-type="pmid">24997787</pub-id></mixed-citation>
    </ref>
    <ref id="R27">
      <label>27.</label>
      <mixed-citation publication-type="journal"><name><surname>Marbouty</surname><given-names>M</given-names></name><etal/><article-title>Metagenomic chromosome conformation capture (meta3C) unveils the diversity of chromosome organization in microorganisms</article-title>. <source>Elife</source><volume>3</volume>, <fpage>e03318</fpage> (<year>2014</year>).<pub-id pub-id-type="pmid">25517076</pub-id></mixed-citation>
    </ref>
    <ref id="R28">
      <label>28.</label>
      <mixed-citation publication-type="journal"><name><surname>Burton</surname><given-names>JN</given-names></name>, <name><surname>Liachko</surname><given-names>I</given-names></name>, <name><surname>Dunham</surname><given-names>MJ</given-names></name> &amp; <name><surname>Shendure</surname><given-names>J</given-names></name>
<article-title>Species-level deconvolution of metagenome assemblies with Hi-C-based contact probability maps</article-title>. <source>G3 (Bethesda)</source>
<volume>4</volume>, <fpage>1339</fpage>–<lpage>1346</lpage> (<year>2014</year>).<pub-id pub-id-type="pmid">24855317</pub-id></mixed-citation>
    </ref>
    <ref id="R29">
      <label>29.</label>
      <mixed-citation publication-type="journal"><name><surname>Marbouty</surname><given-names>M</given-names></name>, <name><surname>Baudry</surname><given-names>L</given-names></name>, <name><surname>Cournac</surname><given-names>A</given-names></name> &amp; <name><surname>Koszul</surname><given-names>R</given-names></name>
<article-title>Scaffolding bacterial genomes and probing host-virus interactions in gut microbiome by proximity ligation (chromosome capture) assay</article-title>. <source>Sci Adv</source>
<volume>3</volume>, <fpage>e1602105</fpage> (<year>2017</year>).<pub-id pub-id-type="pmid">28232956</pub-id></mixed-citation>
    </ref>
    <ref id="R30">
      <label>30.</label>
      <mixed-citation publication-type="journal"><name><surname>Beaulaurier</surname><given-names>J</given-names></name><etal/><article-title>Metagenomic binning and association of plasmids with bacterial host genomes using DNA methylation</article-title>. <source>Nat Biotechnol</source><volume>36</volume>, <fpage>61</fpage>–<lpage>69</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">29227468</pub-id></mixed-citation>
    </ref>
    <ref id="R31">
      <label>31.</label>
      <mixed-citation publication-type="journal"><name><surname>Fang</surname><given-names>G</given-names></name><etal/><article-title>Genome-wide mapping of methylated adenine residues in pathogenic Escherichia coli using single-molecule real-time sequencing</article-title>. <source>Nat Biotechnol</source><volume>30</volume>, <fpage>1232</fpage>–<lpage>1239</lpage> (<year>2012</year>).<pub-id pub-id-type="pmid">23138224</pub-id></mixed-citation>
    </ref>
    <ref id="R32">
      <label>32.</label>
      <mixed-citation publication-type="journal"><name><surname>Murray</surname><given-names>IA</given-names></name><etal/><article-title>The methylomes of six bacteria</article-title>. <source>Nucleic Acids Res</source><volume>40</volume>, <fpage>11450</fpage>–<lpage>11462</lpage> (<year>2012</year>).<pub-id pub-id-type="pmid">23034806</pub-id></mixed-citation>
    </ref>
    <ref id="R33">
      <label>33.</label>
      <mixed-citation publication-type="journal"><name><surname>Schadt</surname><given-names>EE</given-names></name><etal/><article-title>Modeling kinetic rate variation in third generation DNA sequencing data to detect putative modifications to DNA bases</article-title>. <source>Genome Res</source><volume>23</volume>, <fpage>129</fpage>–<lpage>141</lpage> (<year>2013</year>).<pub-id pub-id-type="pmid">23093720</pub-id></mixed-citation>
    </ref>
    <ref id="R34">
      <label>34.</label>
      <mixed-citation publication-type="journal"><name><surname>Beaulaurier</surname><given-names>J</given-names></name><etal/><article-title>Single molecule-level detection and long read-based phasing of epigenetic variations in bacterial methylomes</article-title>. <source>Nat Commun</source><volume>6</volume>, <fpage>7438</fpage> (<year>2015</year>).<pub-id pub-id-type="pmid">26074426</pub-id></mixed-citation>
    </ref>
    <ref id="R35">
      <label>35.</label>
      <mixed-citation publication-type="journal"><name><surname>Song</surname><given-names>CX</given-names></name>, <name><surname>Yi</surname><given-names>C</given-names></name> &amp; <name><surname>He</surname><given-names>C</given-names></name>
<article-title>Mapping recently identified nucleotide variants in the genome and transcriptome</article-title>. <source>Nat Biotechnol</source>
<volume>30</volume>, <fpage>1107</fpage>–<lpage>1116</lpage> (<year>2012</year>).<pub-id pub-id-type="pmid">23138310</pub-id></mixed-citation>
    </ref>
    <ref id="R36">
      <label>36.</label>
      <mixed-citation publication-type="journal"><name><surname>Yoshihara</surname><given-names>M</given-names></name>, <name><surname>Jiang</surname><given-names>L</given-names></name>, <name><surname>Akatsuka</surname><given-names>S</given-names></name>, <name><surname>Suyama</surname><given-names>M</given-names></name> &amp; <name><surname>Toyokuni</surname><given-names>S</given-names></name>
<article-title>Genome-wide profiling of 8-oxoguanine reveals its association with spatial positioning in nucleus</article-title>. <source>DNA Res</source>
<volume>21</volume>, <fpage>603</fpage>–<lpage>612</lpage> (<year>2014</year>).<pub-id pub-id-type="pmid">25008760</pub-id></mixed-citation>
    </ref>
    <ref id="R37">
      <label>37.</label>
      <mixed-citation publication-type="journal"><name><surname>Li</surname><given-names>S</given-names></name> &amp; <name><surname>Mason</surname><given-names>CE</given-names></name>
<article-title>The pivotal regulatory landscape of RNA modifications</article-title>. <source>Annu Rev Genomics Hum Genet</source>
<volume>15</volume>, <fpage>127</fpage>–<lpage>150</lpage> (<year>2014</year>).<pub-id pub-id-type="pmid">24898039</pub-id></mixed-citation>
    </ref>
    <ref id="R38">
      <label>38.</label>
      <mixed-citation publication-type="journal"><name><surname>Roundtree</surname><given-names>IA</given-names></name>, <name><surname>Evans</surname><given-names>ME</given-names></name>, <name><surname>Pan</surname><given-names>T</given-names></name> &amp; <name><surname>He</surname><given-names>C</given-names></name>
<article-title>Dynamic RNA Modifications in Gene Expression Regulation</article-title>. <source>Cell</source>
<volume>169</volume>, <fpage>1187</fpage>–<lpage>1200</lpage> (<year>2017</year>).<pub-id pub-id-type="pmid">28622506</pub-id></mixed-citation>
    </ref>
    <ref id="R39">
      <label>39.</label>
      <mixed-citation publication-type="journal"><name><surname>Garalde</surname><given-names>DR</given-names></name><etal/><article-title>Highly parallel direct RNA sequencing on an array of nanopores</article-title>. <source>Nat Methods</source><volume>15</volume>, <fpage>201</fpage>–<lpage>206</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">29334379</pub-id></mixed-citation>
    </ref>
    <ref id="R40">
      <label>40.</label>
      <mixed-citation publication-type="journal"><name><surname>Workman</surname><given-names>RE</given-names></name><etal/><article-title>Nanopore native RNA sequencing of a human poly(A) transcriptome</article-title>. <source>Nat Methods</source><volume>16</volume>, <fpage>1297</fpage>–<lpage>1305</lpage> (<year>2019</year>).<pub-id pub-id-type="pmid">31740818</pub-id></mixed-citation>
    </ref>
    <ref id="R41">
      <label>41.</label>
      <mixed-citation publication-type="journal"><name><surname>Yang</surname><given-names>C</given-names></name>, <name><surname>Chu</surname><given-names>J</given-names></name>, <name><surname>Warren</surname><given-names>RL</given-names></name> &amp; <name><surname>Birol</surname><given-names>I</given-names></name>
<article-title>NanoSim: nanopore sequence read simulator based on statistical characterization</article-title>. <source>Gigascience</source>
<volume>6</volume>, <fpage>1</fpage>–<lpage>6</lpage> (<year>2017</year>).</mixed-citation>
    </ref>
    <ref id="R42">
      <label>42.</label>
      <mixed-citation publication-type="journal"><name><surname>Li</surname><given-names>H</given-names></name><article-title>Aligning sequence reads, clone sequences and assembly contigs with BWA-MEM</article-title>. <source>arXiv [q-bio.GN]</source> (<year>2013</year>).</mixed-citation>
    </ref>
    <ref id="R43">
      <label>43.</label>
      <mixed-citation publication-type="journal"><name><surname>Morgan</surname><given-names>M</given-names></name>, <name><surname>Pagès</surname><given-names>H</given-names></name>, <name><surname>Obenchain</surname><given-names>V</given-names></name> &amp; <name><surname>Hayden</surname><given-names>N</given-names></name>
<source>Rsamtools: Binary alignment (BAM), FASTA, variant call (BCF), and tabix file import</source>. (<year>2016</year>).</mixed-citation>
    </ref>
    <ref id="R44">
      <label>44.</label>
      <mixed-citation publication-type="journal"><name><surname>Li</surname><given-names>H</given-names></name><etal/><article-title>The Sequence Alignment/Map format and SAMtools</article-title>. <source>Bioinformatics</source><volume>25</volume>, <fpage>2078</fpage>–<lpage>2079</lpage> (<year>2009</year>).<pub-id pub-id-type="pmid">19505943</pub-id></mixed-citation>
    </ref>
    <ref id="R45">
      <label>45.</label>
      <mixed-citation publication-type="journal"><name><surname>Koren</surname><given-names>S</given-names></name><etal/><article-title>Canu: scalable and accurate long-read assembly via adaptive k-mer weighting and repeat separation</article-title>. <source>Genome Res</source><volume>27</volume>, <fpage>722</fpage>–<lpage>736</lpage> (<year>2017</year>).<pub-id pub-id-type="pmid">28298431</pub-id></mixed-citation>
    </ref>
    <ref id="R46">
      <label>46.</label>
      <mixed-citation publication-type="journal"><name><surname>Vaser</surname><given-names>R</given-names></name>, <name><surname>Sovic</surname><given-names>I</given-names></name>, <name><surname>Nagarajan</surname><given-names>N</given-names></name> &amp; <name><surname>Sikic</surname><given-names>M</given-names></name>
<article-title>Fast and accurate de novo genome assembly from long uncorrected reads</article-title>. <source>Genome Res</source>
<volume>27</volume>, <fpage>737</fpage>–<lpage>746</lpage> (<year>2017</year>).<pub-id pub-id-type="pmid">28100585</pub-id></mixed-citation>
    </ref>
    <ref id="R47">
      <label>47.</label>
      <mixed-citation publication-type="journal"><name><surname>Kurtz</surname><given-names>S</given-names></name><etal/><article-title>Versatile and open software for comparing large genomes</article-title>. <source>Genome Biol</source><volume>5</volume>, <fpage>R12</fpage> (<year>2004</year>).<pub-id pub-id-type="pmid">14759262</pub-id></mixed-citation>
    </ref>
    <ref id="R48">
      <label>48.</label>
      <mixed-citation publication-type="journal"><name><surname>Kolmogorov</surname><given-names>M</given-names></name>, <name><surname>Yuan</surname><given-names>J</given-names></name>, <name><surname>Lin</surname><given-names>Y</given-names></name> &amp; <name><surname>Pevzner</surname><given-names>PA</given-names></name>
<article-title>Assembly of long, error-prone reads using repeat graphs</article-title>. <source>Nat Biotechnol</source>
<volume>37</volume>, <fpage>540</fpage>–<lpage>546</lpage> (<year>2019</year>).<pub-id pub-id-type="pmid">30936562</pub-id></mixed-citation>
    </ref>
    <ref id="R49">
      <label>49.</label>
      <mixed-citation publication-type="journal"><name><surname>Li</surname><given-names>H</given-names></name><article-title>Minimap2: pairwise alignment for nucleotide sequences</article-title>. <source>Bioinformatics</source><volume>34</volume>, <fpage>3094</fpage>–<lpage>3100</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">29750242</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1:</label>
    <caption>
      <p id="P58">Schematics for the method design and applications.</p>
    </caption>
    <graphic xlink:href="nihms-1680058-f0001"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2:</label>
    <caption>
      <p id="P59">Systematic examination of three main types of DNA methylation with nanopore sequencing. (<bold>a</bold>) Variation of current differences across methylation occurrences as illustrated by motif signatures from three motifs, AG4mCT (n=6549 occurrences), GGW5mCC (n=1875 occurrences), and GCYYG6mAT (n=954 occurrences). For each motif, current differences near methylated bases ([− 6 bp, + 7 bp]) from all isolated occurrences are plotted with conservation of relative distances to methylated bases. Distributions of current differences for each relative distance are displayed as a violin plot. (<bold>b</bold>) Variation of current differences across methylation occurrences as illustrated by projection with t-SNE for 46 well-characterized motifs (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 2</xref>). Each dot represents one isolated motif occurrence colored by methylation motif. For each motif occurrence, current differences from 22 positions near methylated bases ([− 10 bp, + 11 bp]) were used. (<bold>c</bold>) Similar to <bold>b</bold> but colored by DNA methylation type with cluster density indicated by relief.</p>
    </caption>
    <graphic xlink:href="nihms-1680058-f0002"/>
  </fig>
  <fig id="F3" orientation="portrait" position="float">
    <label>Figure 3:</label>
    <caption>
      <p id="P60">Local sequence context effect on motif signatures. (<bold>a</bold>) Current differences from violin plots of GGW5mCC in <xref rid="F2" ref-type="fig">Fig. 2a</xref> were plotted as a heatmap with each row representing current differences flanking a methylation occurrence ([−5, +6] relative to methylation). GGW5mCC motif occurrences were split into two groups according to degenerated base (W=[A∣T]; n=933 for GGACC and n=942 for GGTCC) and ordered, within groups, using hierarchical clustering to highlight current difference patterns. (<bold>b</bold>) Independent t-SNE projection of GGW5mCC motif occurrences from <bold>a</bold> with cluster density displayed as relief. Clusters are colored according to degenerated base within the methylation motif. (<bold>c</bold>) Another example of sequence-dependent variation for GAT5mC motif occurrences displayed after independent t-SNE projection with cluster density displayed as relief. Clusters are colored according to the first base following GAT5mC motif.</p>
    </caption>
    <graphic xlink:href="nihms-1680058-f0003"/>
  </fig>
  <fig id="F4" orientation="portrait" position="float">
    <label>Figure 4:</label>
    <caption>
      <p id="P61">Classification and fine mapping of three types of DNA methylation. (<bold>a</bold>) For each motif occurrence, we produced 7 training vectors of length 12 with +/− offsets from 0 to 3 position(s) relative to current differences core defined as [−2, +3] (<xref rid="F6" ref-type="fig">Extended Data Fig. 1a</xref>-<xref rid="F6" ref-type="fig">c</xref>). (<bold>b</bold>) Each training vector is labeled with methylation type and offset used. They are gathered into a training dataset of current differences flanking 183,818 methylated bases from 46 distinct motifs (<xref rid="S9" ref-type="sec">Methods</xref>). (<bold>c</bold>) Description of the classifier performance evaluation using leave-one-out cross-validation (LOOCV). (<bold>d</bold>) Detailed classifier evaluation results for neural network model from the LOOCV evaluation for a subset of the 46 well-characterized methylation motifs are displayed for illustration. Filling colors correspond to percentage of occurrences classified to a specific class: blue (0%) to red (100%). Prediction percentages of expected classes are displayed in italics and fine mapped methylated positions in each motif are displayed in bold. (e) Summary of methylation motifs typing and fine mapping results from the neural network model. Green shows accurately typed and/or fine mapped methylation in motif, while red shows inaccurate prediction with the expected result in parentheses. LOOCV results are used for the “Well-characterized” motifs (n=46), while classification results from the final neural network model trained on the 46 well-characterized motifs are used for both “Additional <italic>de novo</italic> (n=6)” and “Two independent bacteria (n=12)” motifs. (<bold>f</bold>) Classification accuracy for individual motifs sites (n=46 motifs including 6mA: 28, 4mC: 7, 5mC: 11) from the neural network model. The lower and upper hinges correspond to the 25th and 75th percentiles while the lower and upper whisker extends to the minima and maxima respectively (capped at 1.5 time the inter-quartile range).</p>
    </caption>
    <graphic xlink:href="nihms-1680058-f0004"/>
  </fig>
  <fig id="F5" orientation="portrait" position="float">
    <label>Figure 5:</label>
    <caption>
      <p id="P62">Methylation analysis of mouse gut microbiome samples. (<bold>a</bold>) Methylation binning of MGM1 contigs using <italic>de novo</italic> discovered motifs (after three rounds of binning followed by motif discovery; <xref rid="S9" ref-type="sec">Methods</xref>, <xref rid="F13" ref-type="fig">Extended Data Figs. 8</xref>, <xref rid="F14" ref-type="fig">9</xref>). Methylation features computed from <italic>de novo</italic> discovered motifs with t-SNE analysis. Contigs are colored based on bin identities with point sizes matching contig length. (<bold>b</bold>) Same as <bold>a</bold> but for MGM2 contigs (one round of binning followed by motif discovery; <xref rid="S9" ref-type="sec">Methods</xref>, <xref rid="F13" ref-type="fig">Extended Data Figs. 8</xref>, <xref rid="F15" ref-type="fig">10</xref>). Non-zoomed plot (with visible Bins 6, 7) in <xref rid="F15" ref-type="fig">Extended Data Fig. 10b</xref>. (<bold>c</bold>) Heatmap of methylation feature values (all <italic>de novo</italic> discovered motifs) across binned contig from MGM1 sample (n=309 contigs). Only the significant features with absolute values above 1.5 pA in the bin of origin (where the motif was discovered) were selected (n=119 methylation features). Missing methylation features from contigs (less than 5 motif occurrences) are colored in grey. (<bold>d</bold>) Detection of misassemblies using methylation signal along contigs. Left and middle panels: misassembled contigs mislabeled as Bin 7 in SMRT analysis (PDYJ01003082.1 and PDYJ01003083.1, contigs marked with an asterisk in <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 3a</xref>. Right panel: an example of a properly assembled contig from SMRT Bin 7 (PDYJ01000763.1). We selected three <italic>de novo</italic> detected motifs from SMRT Bin 7 and scored their methylation sites along the three contigs. Methylation scores were smoothed and displayed with one color per motif. Methylation scores are consistent in the contig in the right panel, but not in the misassembled contigs. A switch of methylome occurs near 800 kbp and 300 kbp in the left two panels respectively, supporting misassemblies (detailed in <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4a</xref>,<xref rid="SD1" ref-type="supplementary-material">b</xref>).</p>
    </caption>
    <graphic xlink:href="nihms-1680058-f0005"/>
  </fig>
</floats-group>
