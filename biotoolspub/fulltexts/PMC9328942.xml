<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD with MathML3 v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1-mathml3.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?all-math-mml yes?>
<?use-mml?>
<?properties open_access?>
<?properties manuscript?>
<?origin nihpa?>
<?iso-abbr Nat Methods?>
<?submitter-system nihms?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 8068858?>
<?submitter-authority myNCBI?>
<?submitter-login nature-structure?>
<?submitter-name Nature Publishing Group?>
<?domain nihpa?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9328942</article-id>
    <article-id pub-id-type="pmid">33986545</article-id>
    <article-id pub-id-type="doi">10.1038/s41592-021-01142-2</article-id>
    <article-id pub-id-type="manuscript">nihpa1690340</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>TRUST4: immune repertoire reconstruction from bulk and single-cell RNA-seq data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Song</surname>
          <given-names>Li</given-names>
        </name>
        <xref rid="A1" ref-type="aff">1</xref>
        <xref rid="A2" ref-type="aff">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Cohen</surname>
          <given-names>David</given-names>
        </name>
        <xref rid="A1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ouyang</surname>
          <given-names>Zhangyi</given-names>
        </name>
        <xref rid="A3" ref-type="aff">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Cao</surname>
          <given-names>Yang</given-names>
        </name>
        <xref rid="A4" ref-type="aff">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hu</surname>
          <given-names>Xihao</given-names>
        </name>
        <xref rid="A1" ref-type="aff">1</xref>
        <xref rid="A2" ref-type="aff">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Liu</surname>
          <given-names>X. Shirley</given-names>
        </name>
        <xref rid="A1" ref-type="aff">1</xref>
        <xref rid="A2" ref-type="aff">2</xref>
        <xref rid="A5" ref-type="aff">5</xref>
        <xref rid="CR1" ref-type="corresp">*</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1.</label>Department of Data Science, Dana-Farber Cancer Institute, Boston, MA, USA</aff>
    <aff id="A2"><label>2.</label>Harvard T.H. Chan School of Public Health, Boston, MA, USA</aff>
    <aff id="A3"><label>3.</label>Department of Biotechnology, Beijing Institue of Radiation Medicine, Beijing, China</aff>
    <aff id="A4"><label>4.</label>College of Life Sciences, Sichuan University, Chengdu, Sichuan, China</aff>
    <aff id="A5"><label>5.</label>Center for Functional Cancer Epigenetics, Dana-Farber Cancer Institute, Boston, MA, USA</aff>
    <author-notes>
      <fn fn-type="con" id="FN1">
        <p id="P1">Author contributions</p>
        <p id="P2">L.S., X.H. and X.S.L conceived the project. L.S. designed and implemented the method. L.S., D.C., Z.O., Y.C., X.H. and X.S.L. evaluated the method and wrote the manuscript. All authors read and approved the final manuscript.</p>
      </fn>
      <corresp id="CR1"><label>*</label>: Corresponding author. <email>xsliu@ds.dfci.harvard.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>1</day>
      <month>7</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>6</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>13</day>
      <month>5</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>7</month>
      <year>2022</year>
    </pub-date>
    <volume>18</volume>
    <issue>6</issue>
    <fpage>627</fpage>
    <lpage>630</lpage>
    <permissions>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/">http://www.nature.com/authors/editorial_policies/license.html#terms</ali:license_ref>
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:<ext-link ext-link-type="uri" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</ext-link></license-p>
      </license>
    </permissions>
    <abstract id="ABS1">
      <p id="P3">We introduce the TRUST4 open-source algorithm for reconstructing immune receptor repertoires in αβ/γδ T-cells and B-cells from RNA-seq data. Compared to competing methods, TRUST4 supports both FASTQ and BAM formats, is faster and more sensitive in assembling longer, even full-length, receptor repertoires. TRUST4 can also call repertoire sequences from single-cell RNA-seq (scRNA-seq) data without V(D)J enrichment, and is compatible with both SMART-seq and 5’ 10X Genomics platforms.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P4">T cells and B cells can generate diverse receptor (TCR and BCR) repertoires, through somatic V(D)J recombination, to recognize various external antigens or tumor neo-antigens. Upon antigen recognition, BCRs also undergo somatic hypermutations (SHMs) to further improve antigen-binding affinity. Repertoire-sequencing has been increasingly adopted in infectious disease<sup><xref rid="R1" ref-type="bibr">1</xref></sup>, allergy<sup><xref rid="R2" ref-type="bibr">2</xref></sup>, auto-immune<sup><xref rid="R3" ref-type="bibr">3</xref></sup>, tumor immuology<sup><xref rid="R4" ref-type="bibr">4</xref></sup>, and cancer immunotherapy<sup><xref rid="R5" ref-type="bibr">5</xref></sup> studies, but it is an expensive assay and consumes valuable tissue samples. Alternatively, RNA-seq data contain expressed TCR and BCR sequences in tissues or peripheral blood mononuclear cells (PBMC). However, repertoire sequences from V(D)J recombination and SHM are different from the germline thus are often eliminated in the read mapping step.</p>
  <p id="P5">Previously, we developed the TRUST algorithm<sup><xref rid="R6" ref-type="bibr">6</xref>–<xref rid="R8" ref-type="bibr">8</xref></sup> to <italic toggle="yes">de novo</italic> assemble immune receptor repertories directly from tissue or blood RNA-seq data. When applied to The Cancer Genome Atlas tumor RNA-seq data, TRUST revealed significant biological insights on the repertoires of tumor-infiltrating T cells<sup><xref rid="R6" ref-type="bibr">6</xref></sup> and B cells<sup><xref rid="R8" ref-type="bibr">8</xref></sup>, as well as their associated tumor immunity. Although less sensitive than TCR-seq and BCR-seq, TRUST is able to identify the abundantly expressed and potentially more clonally expanded TCRs/BCRs in the RNA-seq data which are more likely to be involved in antigen binding<sup><xref rid="R9" ref-type="bibr">9</xref></sup>. Recent years also see other computational methods for immune repertoire construction from RNA-seq data, such as V’DJer<sup><xref rid="R10" ref-type="bibr">10</xref></sup>, MiXCR<sup><xref rid="R11" ref-type="bibr">11</xref></sup>, CATT<sup><xref rid="R12" ref-type="bibr">12</xref></sup> and ImRep<sup><xref rid="R13" ref-type="bibr">13</xref></sup>. These methods focus on reconstructing complementary-determining region 3 (CDR3s) with limited ability to assemble the full-length V(D)J receptor sequences, although CDR1/CDR2 on the V sequence still contribute significantly to antigen recognition and binding. For example, five out of six mutations predicted in a recent study to influence antibody affinity in the acidic tumor environment are located in CDR1 and CDR2<sup><xref rid="R14" ref-type="bibr">14</xref></sup>; four out of nine positions contributing most to the 4A8 antibody binding to the SARS-COV-2 Spike protein are in CDR1 and CDR2<sup><xref rid="R15" ref-type="bibr">15</xref></sup>. Therefore, algorithms that can infer the full-length immune receptor repertoires can facilitate better receptor-antigen interaction modeling.</p>
  <p id="P6">With the advance of single-cell RNA sequencing (scRNA-seq) technologies, researchers can study immune cell gene expression and receptor repertoire sequences simultaneously. Several algorithms, such as MiXCR<sup><xref rid="R11" ref-type="bibr">11</xref></sup>, BALDR<sup><xref rid="R16" ref-type="bibr">16</xref></sup>, BASIC<sup><xref rid="R17" ref-type="bibr">17</xref></sup>, and VDJPuzzle<sup><xref rid="R18" ref-type="bibr">18</xref></sup>, have been developed to construct full-length paired TCRs or BCRs from the SMART-seq scRNA-seq platform<sup><xref rid="R19" ref-type="bibr">19</xref></sup>. In contrast to SMART-seq, droplet-based scRNA-seq platforms such as 10X Genomics<sup><xref rid="R20" ref-type="bibr">20</xref></sup>, while yielding sparser transcript coverage per cell, can process orders of magnitude more cells at a lower cost. To analyze immune repertoires using the 10X Genomics platform, currently researchers need to prepare extra libraries to amplify TCR/BCR sequences.</p>
  <p id="P7">In this study, we redesigned the TRUST algorithm to TRUST4 with significantly enhanced features and improved performance for immune repertoire reconstruction (<xref rid="F1" ref-type="fig">Figure 1a</xref>). First, TRUST4 supports fast extraction of TCR/BCR candidate reads from either FASTQ or BAM files. Second, TRUST4 prioritizes candidate read assembly by abundance and assembles all the candidate reads with partial overlaps against contigs, thus increasing the algorithm speed. Third, TRUST4 explicitly represents highly similar reads in the contig consensus, thus accommodating somatic hypermutations and improving memory efficiency (<xref rid="S2" ref-type="sec">Online Methods</xref>). Fourth, TRUST4 can assemble full-length V(D)J sequences on TCRs and BCRs. Finally, TRUST4 supports repertoire reconstruction from scRNA-seq platforms without requiring the extra 10X V(DJ) amplification steps.</p>
  <p id="P8">We evaluated TRUST4 performance on TCR/BCR reconstruction from bulk RNA-seq using three different approaches. First, for TCR evaluation, we used the <italic toggle="yes">in silico</italic> RNA-seq datasets with known TRB sequences from an earlier study<sup><xref rid="R11" ref-type="bibr">11</xref></sup>. On average, TRUST4 called 281% more CDR3s than MiXCR, 22.9% more than CATT, 57.8% more than TRUST3, and maintained a zero false positive rate across different read lengths (<xref rid="F1" ref-type="fig">Figure 1b</xref>, more parameter settings in <xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 1a</xref>). Second, for BCR evaluation, we used six tumor RNA-seq samples of ~100M pairs of 150bp reads with corresponding immunoglobulin heavy chain (IGH) BCR-seq as the gold standard<sup><xref rid="R8" ref-type="bibr">8</xref></sup>. Since BCRs also have somatic hypermutation and isotype switch during clonal expansion, we required the algorithm call to match CDR3 and V, J, C (isotype) gene assignments as BCR-seq. TRUST4 showed better precision (&gt; 18%) and sensitivity (&gt; 74%) than MiXCR in five out of six samples (<xref rid="F1" ref-type="fig">Figure 1c</xref>, more parameter settings in <xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 2a</xref>). On the sixth sample, TRUST4 only lost 6% precision with twice the sensitivity than MiXCR (FZ-97). We note that BCR-seq and RNA-seq were conducted on different slices of the same tumor. Even two technical replicates of repertoire sequencing on the same DNA/RNA could not achieve 100% precision and sensitivity, so the performance metrics are likely to be under estimations. TRUST4 consistently assembled more IGHs across different abundance ranges reported in BCR-seq (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 2b</xref>), and found twice as much as IGHs with a single mRNA copy than MiXCR. In addition, TRUST4 only used 20–25% of the time it took MiXCR to process these samples on average (<xref rid="SD1" ref-type="supplementary-material">Supplementary Table 1</xref>), at &lt; 6GB memory usage on an 8-thread processor. Furthermore, TRUST4 ran directly on the FASTQ files was significantly faster than read mapping to generate BAM files followed by TRUST4 on the BAM files. Third, for base-level full-length assembly evaluation, we created a pseudo-bulk RNA-seq data by randomly picking 25M read pairs from 137 SMART-seq B cells as a testing case. To establish a gold-standard of the BCR calls, we used the 128 IGH assemblies that were consistently called by BALDR and BASIC at the single-cell level (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 3a</xref>). TRUST4 and MiXCR correctly identified all the 128 CDR3s, and TRUST4 reconstructed 93 full-length IGH sequences while MiXCR only found 39 (<xref rid="F1" ref-type="fig">Figure 1d</xref>). TRUST4 was able to call some BCRs with only 5,000 randomly sampled read pairs in the SMART-seq data set (18 read pairs/chain), and showed higher sensitivity than MiXCR across all abundance ranges (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 3b</xref>). The high efficiency of TRUST4 allowed us to characterize immune repertoire in tumor samples, and we identified an association IgA1 B cell clonal expansion with poor prognosis in colon adenocarcinoma from The Cancer Genome Atlas (TCGA) RNA-seq samples (<xref rid="S2" ref-type="sec">Online Methods</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 4</xref>). We noted that IGHA1 over expression is not associated with survival, suggesting that immune repertoire analysis provides additional insights onto tumor immunity.</p>
  <p id="P9">Next, we evaluated TRUST4 performance on the 5’ 10X Genomics scRNA-seq data on peripheral blood mononuclear cells (PBMC). For this dataset, the two separately processed T cell and B cell 10X V(D)J libraries served as the gold standards. When considering the single cells that passed the Seurat<sup><xref rid="R21" ref-type="bibr">21</xref></sup> cell-level QC, TRUST4 made 5,091 T cell and 1,318 B cell calls respectively (<xref rid="F2" ref-type="fig">Figure 2a</xref> and <xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 5a</xref>). Among the CDR3s reported by 10X V(D)J, TRUST4 recovered 48.1% (6035/12558) of TCR CDR3s and 78.0% (1946/2494) of BCR CDR3s. The higher sensitivity of TRUST4 on BCR is due to the higher expression level of BCR in B cells (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 5b</xref>). For precision, 94.6% of TCR CDR3s and 98.2% of BCR CDR3s from TRUST4 were identical with 10X V(D)J (<xref rid="F2" ref-type="fig">Figure 2b</xref>). Although CellRanger_VDJ was designed for 10X V(D)J data, we tested it on 5’ 10X scRNA-seq data which has the same data format. TRUST4 found 78% more TCR CDR3s and 16% more BCR CDR3s in the cells that passed QC (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 5c</xref>). In addition, TRUST4 was over 10 times faster and over twice more memory efficient than CellRanger_VDJ. Furthermore, TRUST4 also reported 83 γδT cells, which 10X V(D)J currently does not have a kit to profile. In this data, Seurat did not annotate any γδT cells, instead called 71 out of the 83 TRUST4-annotated γδT cells as CD8 T cells. Close examination of gene expression in these 83 cells revealed that they have higher δV and δC gene expression but lower CD8A or CD8B expression (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 5d</xref>), supporting TRUST4’s annotation of these cells as γδT cells.</p>
  <p id="P10">We further tested TRUST4 on a 10X Genomics non-small cell lung cancer (NSCLC) dataset. In this case, TRUST4 called 1,241 T cells and 2,478 B cells (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 6</xref>). TRUST4 assembled 142 IGH CDR3s out of the Seurat-annotated 144 plasma B cells, while 10X V(D)J only found 131. For these plasma B cells, TRUST4 also reconstructed full-length paired BCRs for 104 cells, in which we observed a high correlation on the SHM rate between IGHs and IGK/IGLs in these cells (<xref rid="F2" ref-type="fig">Figure 2d</xref>, Pearson r=0.67, p-value=8e-15), suggesting coordinated SHMs on two chains during B cell division. Furthermore, TRUST4 found more somatic hypermutations on IGH than on IGK/IGL (p-value&lt;1e-10, two-sided Wilcoxon signed-rank test), supporting the more important role of antibody heavy chain on antigen binding affinity.</p>
  <p id="P11">In summary, TRUST4 is an effective method to infer TCR and BCR repertoires from bulk RNA-seq or scRNA-seq data. TRUST4 not only has high efficiency, sensitivity, and precision on reconstructing CDR3s, but can also assemble full-length immune receptor sequences from bulk RNA-seq data. Furthermore, TRUST4 can reconstruct immune receptor sequences at single-cell level, including γδT cells, directly from 5’ 10X Genomics scRNA-seq data without specific 10X V(D)J enrichment libraries. Our results support the advantage of the 5’ 10X Genomics scRNA-seq platform, which not only provides gene expression information but also enables computational calling of immune repertoires. TRUST4 is available open source at <ext-link xlink:href="https://github.com/liulab-dfci/TRUST4" ext-link-type="uri">https://github.com/liulab-dfci/TRUST4</ext-link>, and can be an important method for tumor immunity and immunotherapy studies.</p>
  <sec id="S1">
    <title>Methods</title>
    <p id="P12">Methods, evaluation details and data availability are available in the <xref rid="S2" ref-type="sec">online method</xref> section.</p>
  </sec>
  <sec id="S2">
    <title>Online methods</title>
    <sec id="S3">
      <title>Algorithm overview</title>
      <p id="P13">TRUST4 reconstructs the immune repertoire in three stages: candidate reads extraction, <italic toggle="yes">de novo</italic> assembly, and annotation (<xref rid="F1" ref-type="fig">Figure 1a</xref>).</p>
    </sec>
    <sec id="S4">
      <title>Candidate reads extraction</title>
      <p id="P14">TRUST4 can find the candidate TCR and BCR reads from either raw sequence files or the alignment file produced by aligners, such as STAR<sup><xref rid="R22" ref-type="bibr">22</xref></sup>, HISAT<sup><xref rid="R23" ref-type="bibr">23</xref></sup>. When the input is an alignment file, if a read or its mate aligns on the V, J, C loci, this read is added to the candidate read set. If a read is unmapped and is not a candidate based on the mate information, TRUST4 will test whether this read has a significant overlap with V, J, C genes. If so, this read and its mate are also candidate reads. When the input is raw sequence files, TRUST4 applies the significant overlap criterion to every read or read pair to find candidate reads. To identify whether a read has significant overlap with one of the V, J, C genes, TRUST4 first locates the receptor gene with the most number of k-mer hits (default: k=9) from the read. TRUST4 then computes the longest chain from these k-mers to filter incompatible hits. Lastly, if the union bases of the k-mers in the longest chain reached the threshold, TRUST4 will claim the read has a significant overlap with the gene. The threshold is max(21, read_length/5+1), so data with shorter reads has less stringent criterion. Since TRUST4 avoids alignment in the candidate reads extraction algorithm, this stage is fast even if the input data is raw sequence files.</p>
      <p id="P15">If the data has barcode information, such as 10X Genomics scRNA-seq data, TRUST4 also corrects erroneous barcode for each candidate reads when given the whitelist. TRUST4 first builds the barcode usage distribution from the first 2 million reads before correcting. Then, for each input barcode that is not in the whitelist, TRUST4 finds all the neighbor barcode within one hamming distance in the whitelist (at most 4*barcode_length) and report the one that is the most frequent barcode in the usage distribution. If there are multiple valid neighbor barcode with the same frequency in the usage distribution, TRUST4 will correct on the base with the lowest FASTQ quality.</p>
    </sec>
    <sec id="S5">
      <title><italic toggle="yes">De novo</italic> assembly</title>
      <p id="P16">When assembling the candidate reads into immune receptor sequences, TRUST4 adopts the read overlap scheme. Cells like plasma B cells can generate thousands of reads for each recombined receptor gene, so comparing every pair of reads to construct the overlap graph as in previous versions of TRUST is inefficient. TRUST4 implements a greedy extension approach by aligning the candidate read to existing contigs one by one. To perform alignment, TRUST4 builds an index for all the k-mers in the contigs and applies the seed-extension paradigm to identify the alignments. TRUST4 deems a read overlaps with a contig if they have a highly similar (90% for BCR, 95% for TCR) alignment block containing at least 31bp exact matches and the unaligned bases of the read are outside of the contig. Based on the overlaps, TRUST4 will update the contigs with following rules: (1) If a read partially overlaps with one contig, TRUST4 extends this contig; (2) if a read partially overlaps several contigs, TRUST4 merges corresponding contigs; (3) If a read does not overlap with any existing contigs, TRUST4 creates a new contig with this read’s sequence. When processing the reads, TRUST4 prioritizes the reads coming from highly expressed TCRs/BCRs. To achieve this, TRUST4 first counts the frequency of k-mers (21-mer by default) across all the candidate reads. If a read comes from a highly expressed receptor sequence, all of its k-mers would have high frequencies in the data. Therefore, the minimum frequency of a read’s k-mers can roughly indicate the abundance of the gene. TRUST4 then sorts the read based on the minimum k-mer frequency rule. The ordering of reads is equivalent to picking the most frequent k-mer as the start point in the de Bruijn graph-based transcriptome assembler Trinity<sup><xref rid="R24" ref-type="bibr">24</xref></sup>.</p>
      <p id="P17">TRUST4 clusters the reads with somatic hypermutations into the same contig by representing a contig as the consensus of assembled reads. Each position in the contig records four weights as how many reads have the corresponding nucleotide for that position. The consensus means the nucleotide for a position is the nucleotide with highest weight, and the index for alignments stores the k-mers of the consensuses. The read alignment takes the weights into account to tolerate the somatic hypermutations in BCRs. For example, for a position, if nucleotides A and T on the contig have high weights, it is a match if the read has nucleotide A or T. Therefore, reads with different somatic hypermutations can align to the same contig, which avoids creating redundant contigs.</p>
      <p id="P18">If the input data is paired-end, TRUST4 will use the mate-pair information to extend the contigs. In the first round of contig assembly, due to the read sorting and greedy extension, a contig for the abundant recombined gene attracts all the reads from the same V, J and C genes even though these reads come from different recombination. The mate-pair information fixes this issue by reassigning the reads to the appropriate contigs. The reassignment will extend the contigs and update the position weights in the affected consensus. When the input data is SMART-seq, since there is no need to perfect the assemblies for low abundant sequences in a cell, TRUST4 can skip the extension to reduce running time.</p>
      <p id="P19">When the input contains barcode information, TRUST4 will assign the read barcode to the contig when creating a new contig, and a read can only align to the contigs with the read’s barcode. As a result, two identical reads with different barcodes will change different sets of contigs. Furthermore, the read-contig overlap criterion is relaxed and requires 17bp instead of 31bp exact matches in the alignment.</p>
    </sec>
    <sec id="S6">
      <title>Annotation</title>
      <p id="P20">TRUST4 aligns the assembled contigs to the sequences from the international ImmunoGeneTics (IMGT) database<sup><xref rid="R25" ref-type="bibr">25</xref></sup> to identify the V, J, C genes. IMGT database curates the sequences for V, D, J and constant genes, and is widely used to annotate BCR and TCR sequences, such as in previous TRUST versions and MiXCR. Besides the sequences, IMGT also annotates the start position of CDR3 in the V gene (104<sup>th</sup> amino acids of the V gene in IMGT coordination). IMGT also defines the end position of CDR3 as amino acid W/F in the amino acid motif W/FGxG in the J gene. TRUST4 determines the CDR3 coordinate based on these IMGT conventions after identifying V and J genes. If the contig is too short to identify the V gene, TRUST4 locates the CDR3 start position as amino acid C in the motif YYC by testing all the open reading frames.</p>
      <p id="P21">In the final step of annotation, TRUST4 retrieves the somatic hypermutated CDR3s and estimates the CDR3 abundances. If a read fully covers the CDR3 on a contig and the CDR3 sequence from the read is different from the consensus, TRUST4 will report the CDR3 from the read. If there is no such read, TRUST4 directly reports the consensus CDR3 sequence. In the abundance estimation, if reads partially overlap with the CDR3, it could be compatible with several different CDR3 sequences. Therefore, TRUST4 applies the Expectation-Maximization algorithm<sup><xref rid="R26" ref-type="bibr">26</xref></sup> similar in RSEM<sup><xref rid="R27" ref-type="bibr">27</xref></sup> to distribute reads’ count to their compatible CDR3s iteratively. For TCR, TRUST4 filters the CDR3 whose abundance is less than 5% of the most abundant CDR3 from the same contig to avoid sequencing errors.</p>
      <p id="P22">For the CDR3s that have only start or end positions determined in the contigs, TRUST4 reports them as a partial CDR3s and tries to extend the partial TCR CDR3s as in MiXCR. For an example of missing start position, the extendable partial CDR3 must overlap with the identified V gene in the contig but could not reach the start position. This scenario could happen when the V gene is identified through mate-pair information. TRUST4 then fills the missing sequences with germline sequences of the V gene to complete the partial CDR3. In scRNA-seq, TRUST4 also utilizes information across all cells to extend partial TCR CDR3s. For two cells A, B with the same V and J genes on both chains, cell B can extend its partial CDR3 if B has a complete CDR3 identical to A’s corresponding complete CDR3 and B’s partial CDR3 is a substring of A’s corresponding complete CDR3.</p>
    </sec>
    <sec id="S7">
      <title>Sequence data</title>
      <p id="P23">We tested TRUST4 on <italic toggle="yes">in silico</italic> and real data. The <italic toggle="yes">in silico</italic> bulk RNA-seq data for evaluating TCRs was generated using the scripts from MiXCR<sup><xref rid="R11" ref-type="bibr">11</xref></sup>, where repseqio (<ext-link xlink:href="https://github.com/repseqio/repseqio" ext-link-type="uri">https://github.com/repseqio/repseqio</ext-link>) and ART<sup><xref rid="R28" ref-type="bibr">28</xref></sup> generated the simulated TRB and RNA-seq data. As a result, each of the <italic toggle="yes">in silico</italic> RNA-seq samples contained 1,000 read fragments randomly from 1,000 recombined TRBs. To evaluate BCR reconstruction, we used six lung cancer RNA-seq data and its pairing BCR-seq data from our previous manuscript<sup><xref rid="R8" ref-type="bibr">8</xref></sup>. iRepertoire processed the BCR-seq data, and the results were the gold standard for the evaluation. For SMART-seq evaluation, we used three SMART-seq datasets from BALDR: AW1, 1620PV (AW2-AW3), VH_CD19pos. For the pseudo-bulk RNA-seq data, we firstly added a pseudo-mate for the 1620PV’s single-end data with a sequence of one nucleotide N. We then randomly selected 25 million read pairs across all the cells of these three samples to create the pseudo-bulk RNA-seq. In the end, 56%, 33% and 11% of the pseudo-bulk RNA-seq data were from AW1, 1620PV and VH_CD19pos respectively. We applied the same procedure to generate psuedo-bulk samples with fewer read pairs (12million, 6million, …, 2.5K, 1K). The 10X Genomics scRNA-seq data and 10X V(D)J data were downloaded from 10X Genomics website.</p>
    </sec>
    <sec id="S8">
      <title>Performance evaluation</title>
      <p id="P24">All the methods were tested with their default parameters without explicit clarification. The BAM files as the input for TRUST4 were generated by STAR v2.5.3a. We used MiXCR v3.0.12, CATT with GitHub commit id 0e7b462, TRUST3 v3.0.3, BALDR with GitHub commit id e865b45 and BASIC v1.5.1 in this study. All the evaluations in this work were at the nucleotide level. For example, the match of CDR3 of TRUST4 and BCR-seq gold standard meant their nucleotide sequences were identical. TRUST4 could report both partial and complete CDR3, and we only considered complete CDR3s in the evaluations.</p>
      <p id="P25">In the TCR evaluation with <italic toggle="yes">in silico</italic> RNA-seq data, the evaluation criteria were based on the scripts from MiXCR’s manuscript<sup><xref rid="R11" ref-type="bibr">11</xref></sup>, We added read length 150bp and ran MiXCR with default parameters. In MiXCR’s original manuscript, the authors used the option “--badQualityThreshold 0” for higher sensitivity (MiXCR_0), and TRUST4 still found about 8% more CDR3s than MiXCR_0 on average (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 1a</xref>). Furthermore, TRUST4 with input from FASTQ and BAM files showed almost identical results, which demonstrated the efficiency of the candidate extraction method. TRUST4 was also the most or one of the most sensitive methods on assembling CDR3s for the TRB chains with different number of reads (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 1b</xref>).</p>
      <p id="P26">In the bulk RNA-seq data, we mainly evaluated the performance of reconstructing BCR heavy chains, including V, J, C gene assignments and CDR3 sequences. We considered gene assignments in addition to CDR3 sequences in the evaluation because that IGHs had different C genes as isotypes, such as IgM, IgG1, IgA1, and were critical in determining antibodies’ functions. Since CATT could not report C gene and TRUST3 only focused on CDR3 assembly, we omitted CATT and TRUST3 in this evaluation. For the match of V, J genes, we ignored the allele id. For example, if the V gene was annotated as IGHV1–18*01, we regarded it as IGHV1–18. In the evaluation, we excluded the assemblies missing V, J or C gene from TRUST4 and MiXCR. The IGH abundances reported by TRUST4 had a better correlation with the corresponding abundances in BCR-seq than MiXCR’s (Pearson r=0.57 vs. 0.53 on average, <xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 2a</xref>). We further checked the precision-recall curve by ranking inferred IGHs by abundances (top 100, 500, 1000, …), and TRUST4 consistently outperformed MiXCR across different thresholds (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 2a</xref>). On this real data, MiXCR_0 did not outperform MiXCR as in the <italic toggle="yes">in silico</italic> data, suggesting the parameter was not effective on real data. TRUST4 with FASTQ and BAM input still showed identical performance across six samples in this real data evaluation. We further evaluated the performance only on CDR3 sequences, which included the results from TRUST3 and CATT. TRUST4 showed the highest sensitivity consistently across all 6 samples, and reported 11% more correct CDR3s than MiXCR_0, the second most sensitive method, with similar precision on average.</p>
      <p id="P27">The evaluations with SMART-seq data focused on whether the methods could reconstruct all the nucleotides in the variable domain. If the assembled V, J sequences were shorter than the genes’ lengths in the IMGT database, we would regard it as unreconstructed. The match of V or J sequences means the nucleotide bases were the same for the regions annotated as V or J genes. In other words, we ignored the bases before or after V, J genes. In addition to the psuedo-bulk RNA-seq data from the three samples, we ran TRUST4 on original cell level data and compared with BALDR and BASIC on all three samples. We picked the top abundant heavy chain and light chain from TRUST4, and they were identical with at least one of the BALDR and BASIC on 272 out of 274 chains (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 3</xref>). The comparison result indicated that TRUST4 could effectively reconstruct the immune repertoire from SMART-seq scRNA-seq data.</p>
      <p id="P28">For the evaluation with 10X Genomics data, we used TCR library and IG library results from 10X Genomics Immune profiling (10X V(D)J) as the gold standard. Since the computational software CellRanger_VDJ might report multiple CDR3s for a cell, we regarded the most abundant CDR3 as the true CDR3 for a chain, and the less abundant CDR3s as secondary. TRUST4 took the BAM file generated by CellRanger as input, which included the barcode information in the field “CB”. TRUST4 also took FASTQ files as input, and corrected the erroneous barcode based on the whitelist provided in CellRanger package. TRUST4 with FASTQ input reported almost identical results as with BAM input (<xref rid="SD1" ref-type="supplementary-material">Supplmentary Figure 5c</xref>). Even though CellRanger_VDJ (v3.1.0) was designed for 10X V(D)J data, we ran it on the 10X 5’ scRNA-seq data using IMGT sequences as reference with 8 cores. In our analysis for full-length assemblies, the somatic hypermutation rate was represented by the proportion of matched bases (similarity) between the assembled V genes and the germline sequences (<xref rid="F2" ref-type="fig">Figure 2c</xref>). If there were many somatic hypermutations, the similarity would be low. Besides the 5’ scRNA-seq data, we also evaluated TRUST4 on the 3’ 10X Genomics PBMC data and only 335 cells had reconstructed CDR3s (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 7</xref>). We used the LM22 marker genes from CIBERSORT<sup><xref rid="R29" ref-type="bibr">29</xref></sup> to determine the cell types.</p>
    </sec>
    <sec id="S9">
      <title>TRUST4 on TCGA-COAD RNA-seq samples</title>
      <p id="P29">We explored the immune repertoire features on the 466 colon adenocarcinoma (COAD) RNA-seq samples in The Cancer Genome Atlas (TCGA) cohorts. To reduce the effects of somatic hypermutated CDR3s, we first clustered highly similar CDR3 nucleotide sequences of the same length and with the same V, J gene assignments reported from TRUST4. We picked the similarity cutoff as 0.8 by comparing the similarities distribution among the pairs of CDR3s within (intra-patient) and between (inter-patient) samples, where the inter-patient distribution can be regarded as the background random CDR3 pair similarity (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 4a</xref>). Therefore, we defined the clonotype for TCR as the CDR3 sequence and the clonotype for BCR as the cluster with the same V, J gene assignments and similar CDR3 sequences. Although TRB and IGH clonalities were positively correlated with their expression respectively (Spearman r=0.346 for TRB, r=0.085 for IGH), they contained additional information on TCR and BCR clonal expansion (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 4b</xref>). The expression for a chain is computed by the sum of transcripts per millions (TPM) obtained from TCGA cohorts on the constant genes of a chain. We defined clonality as 1-(normalized Shannon entropy) based on the clonotype definition above.</p>
      <p id="P30">We identified that IgA1 antibody clonal expansion was related to patient survival in colon adenocarcinoma. Unlike in melanoma, where IgG1 and IgA expressions and abundance fractions were positive and negative associated with survival time respectively<sup><xref rid="R11" ref-type="bibr">11</xref></sup>, we did not observe such association of survival time in COAD (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figure 4c</xref>). However, higher clonality of IgA1 B cells was correlated with significantly shorter survival time (p-value=8.1e-5, hazard ratio 9.14 by Cox proportional hazards regression corrected by age), supporting the immunosuppressive property of IgA antibodies<sup><xref rid="R30" ref-type="bibr">30</xref></sup>. We hypothesize that the clonal expansion of IgA1 B cells could be related to gut microbiota<sup><xref rid="R31" ref-type="bibr">31</xref></sup>, and future work is needed to elucidate the mechanisms.</p>
    </sec>
    <sec sec-type="data-availability" id="S10">
      <title>Data availability</title>
      <p id="P31">The original scripts for generating and evaluating the <italic toggle="yes">in silico</italic> RNA-seq data are available at <ext-link xlink:href="https://github.com/milaboratory/mixcr-rna-seq-paper" ext-link-type="uri">https://github.com/milaboratory/mixcr-rna-seq-paper</ext-link>.</p>
      <p id="P32">The six bulk RNA-seq samples for BCR evaluation are available in the SRA repository PRJNA492301, and their matched iRepertoire data are available at <ext-link xlink:href="https://bitbucket.org/liulab/ng-bcr-validate/src/master/iRep" ext-link-type="uri">https://bitbucket.org/liulab/ng-bcr-validate/src/master/iRep</ext-link>.</p>
      <p id="P33">SMART-seq data is available in the SRA repository SRP126429.</p>
      <p id="P34">10X Genomics scRNA-seq data is available at <ext-link xlink:href="https://support.10xgenomics.com/single-cell-vdj/datasets/3.1.0/vdj_nextgem_hs_pbmc3" ext-link-type="uri">https://support.10xgenomics.com/single-cell-vdj/datasets/3.1.0/vdj_nextgem_hs_pbmc3</ext-link>, <ext-link xlink:href="https://support.10xgenomics.com/single-cell-vdj/datasets/2.2.0/vdj_v1_hs_nsclc_5gex" ext-link-type="uri">https://support.10xgenomics.com/single-cell-vdj/datasets/2.2.0/vdj_v1_hs_nsclc_5gex</ext-link> and <ext-link xlink:href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.1.0/5k_pbmc_protein_v3_nextgem" ext-link-type="uri">https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.1.0/5k_pbmc_protein_v3_nextgem</ext-link>.</p>
      <sec id="S11">
        <title>Code availability</title>
        <p id="P35">TRUST4’s source code is available at <ext-link xlink:href="https://github.com/liulab-dfci/TRUST4" ext-link-type="uri">https://github.com/liulab-dfci/TRUST4</ext-link>.</p>
        <p id="P36">Evaluation codes in this work are available at <ext-link xlink:href="https://github.com/liulab-dfci/TRUST4_manuscript_evaluation" ext-link-type="uri">https://github.com/liulab-dfci/TRUST4_manuscript_evaluation</ext-link>.</p>
      </sec>
      <sec id="S12">
        <title>Reporting Summary</title>
        <p id="P37">Further information on research design is available in the Nature Research Reporting Summary linked to this article.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="SM1">
    <title>Supplementary Material</title>
    <supplementary-material id="SD1" position="float" content-type="local-data">
      <label>Supplementary Table 1 and Supplementary Figures 1-7</label>
      <media xlink:href="NIHMS1690340-supplement-Supplementary_Table_1_and_Supplementary_Figures_1-7.pdf" id="d64e570" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S13">
    <title>Acknowledgments</title>
    <p id="P38">We thank Drs. Bo Li and Chenfei Wang for the helpful discussions. We also acknowledge the funding sources from NIH U01CA226196 and U24CA224316 for supporting this work. The study used some data generated by the TCGA Research Network which is not otherwise cited: <ext-link xlink:href="https://www.cancer.gov/tcga" ext-link-type="uri">https://www.cancer.gov/tcga</ext-link>.</p>
  </ack>
  <fn-group>
    <fn id="FN2">
      <p id="P39">Competing interests</p>
      <p id="P40">X.S.L. is a cofounder, board member, SAB, and consultant of GV20 Oncotherapy and its subsidiaries, SAB of 3DMedCare, consultant for Genentech, and stockholder of AMGN, JNJ, MRK, PFE, and receives sponsored research funding from Takeda and Sanofi. X.H. conducted the work while being a postdoc fellow and is currently a full time employee of GV20 Oncotherapy.</p>
    </fn>
  </fn-group>
  <ref-list>
    <title>References</title>
    <ref id="R1">
      <label>1.</label>
      <mixed-citation publication-type="journal"><name><surname>Lee</surname><given-names>J</given-names></name>. <etal/><article-title>Molecular-level analysis of the serum antibody repertoire in young adults before and after seasonal influenza vaccination</article-title>. <source>Nat Med</source><volume>22</volume>, <fpage>1456</fpage>–<lpage>1464</lpage> (<year>2016</year>).<pub-id pub-id-type="pmid">27820605</pub-id></mixed-citation>
    </ref>
    <ref id="R2">
      <label>2.</label>
      <mixed-citation publication-type="journal"><name><surname>Kiyotani</surname><given-names>K</given-names></name>. <etal/><article-title>Characterization of the B-cell receptor repertoires in peanut allergic subjects undergoing oral immunotherapy</article-title>. <source>J Hum Genet</source><volume>63</volume>, <fpage>239</fpage>–<lpage>248</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">29192240</pub-id></mixed-citation>
    </ref>
    <ref id="R3">
      <label>3.</label>
      <mixed-citation publication-type="journal"><name><surname>Liu</surname><given-names>S</given-names></name>. <etal/><article-title>Direct measurement of B-cell receptor repertoire’s composition and variation in systemic lupus erythematosus</article-title>. <source>Genes Immun</source><volume>18</volume>, <fpage>22</fpage>–<lpage>27</lpage> (<year>2017</year>).<pub-id pub-id-type="pmid">28053320</pub-id></mixed-citation>
    </ref>
    <ref id="R4">
      <label>4.</label>
      <mixed-citation publication-type="journal"><name><surname>Kurtz</surname><given-names>DM</given-names></name><etal/><article-title>Noninvasive monitoring of diffuse large B-cell lymphoma by immunoglobulin high-throughput sequencing</article-title>. <source>Blood</source><volume>125</volume>, <fpage>3679</fpage>–<lpage>3687</lpage> (<year>2015</year>).<pub-id pub-id-type="pmid">25887775</pub-id></mixed-citation>
    </ref>
    <ref id="R5">
      <label>5.</label>
      <mixed-citation publication-type="journal"><name><surname>Riaz</surname><given-names>N</given-names></name>. <etal/><article-title>Tumor and Microenvironment Evolution during Immunotherapy with Nivolumab</article-title>. <source>Cell</source><volume>171</volume>, <fpage>934</fpage>–<lpage>949</lpage>.e16 (<year>2017</year>).<pub-id pub-id-type="pmid">29033130</pub-id></mixed-citation>
    </ref>
    <ref id="R6">
      <label>6.</label>
      <mixed-citation publication-type="journal"><name><surname>Li</surname><given-names>B</given-names></name>. <etal/><article-title>Landscape of tumor-infiltrating T cell repertoire of human cancers</article-title>. <source>Nat Genet</source><volume>48</volume>, <fpage>725</fpage>–<lpage>732</lpage> (<year>2016</year>).<pub-id pub-id-type="pmid">27240091</pub-id></mixed-citation>
    </ref>
    <ref id="R7">
      <label>7.</label>
      <mixed-citation publication-type="journal"><name><surname>Li</surname><given-names>B</given-names></name>. <etal/><article-title>Ultrasensitive detection of TCR hypervariable-region sequences in solid-tissue RNA-seq data</article-title>. <source>Nat Genet</source><volume>49</volume>, <fpage>482</fpage>–<lpage>483</lpage> (<year>2017</year>).<pub-id pub-id-type="pmid">28358132</pub-id></mixed-citation>
    </ref>
    <ref id="R8">
      <label>8.</label>
      <mixed-citation publication-type="journal"><name><surname>Hu</surname><given-names>X</given-names></name>. <etal/><article-title>Landscape of B cell immunity and related immune evasion in human cancers</article-title>. <source>Nat Genet</source><volume>51</volume>, <fpage>560</fpage>–<lpage>567</lpage> (<year>2019</year>).<pub-id pub-id-type="pmid">30742113</pub-id></mixed-citation>
    </ref>
    <ref id="R9">
      <label>9.</label>
      <mixed-citation publication-type="journal"><name><surname>Cao</surname><given-names>Y</given-names></name>. <etal/><article-title>Potent Neutralizing Antibodies against SARS-CoV-2 Identified by High-Throughput Single-Cell Sequencing of Convalescent Patients’ B Cells</article-title>. <source>Cell</source><volume>182</volume>, <fpage>73</fpage>–<lpage>84</lpage>.e16 (<year>2020</year>).<pub-id pub-id-type="pmid">32425270</pub-id></mixed-citation>
    </ref>
    <ref id="R10">
      <label>10.</label>
      <mixed-citation publication-type="journal"><name><surname>Mose</surname><given-names>LE</given-names></name><etal/><article-title>Assembly-based inference of B-cell receptor repertoires from short read RNA sequencing data with V’DJer</article-title>. <source>Bioinformatics</source><volume>32</volume>, <fpage>3729</fpage>–<lpage>3734</lpage> (<year>2016</year>).<pub-id pub-id-type="pmid">27559159</pub-id></mixed-citation>
    </ref>
    <ref id="R11">
      <label>11.</label>
      <mixed-citation publication-type="journal"><name><surname>Bolotin</surname><given-names>DA</given-names></name><etal/><article-title>Antigen receptor repertoire profiling from RNA-seq data</article-title>. <source>Nat Biotechnol</source><volume>35</volume>, <fpage>908</fpage>–<lpage>911</lpage> (<year>2017</year>).<pub-id pub-id-type="pmid">29020005</pub-id></mixed-citation>
    </ref>
    <ref id="R12">
      <label>12.</label>
      <mixed-citation publication-type="journal"><name><surname>Chen</surname><given-names>S-Y</given-names></name>, <name><surname>Liu</surname><given-names>C-J</given-names></name>, <name><surname>Zhang</surname><given-names>Q</given-names></name>. &amp; <name><surname>Guo</surname><given-names>A-Y</given-names></name>
<article-title>An ultrasensitive T-cell receptor detection method for TCR-Seq and RNA-Seq data</article-title>. <source>Bioinformatics</source> (<year>2020</year>).</mixed-citation>
    </ref>
    <ref id="R13">
      <label>13.</label>
      <mixed-citation publication-type="journal"><name><surname>Mandric</surname><given-names>I</given-names></name>. <etal/><article-title>Profiling immunoglobulin repertoires across multiple human tissues using RNA sequencing</article-title>. <source>Nat. Commun</source>. <volume>11</volume>, <fpage>3126</fpage> (<year>2020</year>).<pub-id pub-id-type="pmid">32561710</pub-id></mixed-citation>
    </ref>
    <ref id="R14">
      <label>14.</label>
      <mixed-citation publication-type="journal"><name><surname>Sulea</surname><given-names>T</given-names></name>. <etal/><article-title>Structure-based engineering of pH-dependent antibody binding for selective targeting of solid-tumor microenvironment</article-title>. <source>MAbs</source><volume>12</volume>, 1682866 (<year>2020</year>).</mixed-citation>
    </ref>
    <ref id="R15">
      <label>15.</label>
      <mixed-citation publication-type="journal"><name><surname>Chi</surname><given-names>X</given-names></name>. <etal/><article-title>A neutralizing human antibody binds to the N-terminal domain of the Spike protein of SARS-CoV-2</article-title>. <source>Science</source> (<year>2020</year>).</mixed-citation>
    </ref>
    <ref id="R16">
      <label>16.</label>
      <mixed-citation publication-type="journal"><name><surname>Upadhyay</surname><given-names>AA</given-names></name><etal/><article-title>BALDR: a computational pipeline for paired heavy and light chain immunoglobulin reconstruction in single-cell RNA-seq data</article-title>. <source>Genome Med</source><volume>10</volume>, <fpage>20</fpage> (<year>2018</year>).<pub-id pub-id-type="pmid">29558968</pub-id></mixed-citation>
    </ref>
    <ref id="R17">
      <label>17.</label>
      <mixed-citation publication-type="journal"><name><surname>Canzar</surname><given-names>S</given-names></name>, <name><surname>Neu</surname><given-names>KE</given-names></name>, <name><surname>Tang</surname><given-names>Q</given-names></name>, <name><surname>Wilson</surname><given-names>PC</given-names></name> &amp; <name><surname>Khan</surname><given-names>AA</given-names></name>
<article-title>BASIC: BCR assembly from single cells</article-title>. <source>Bioinformatics</source>
<volume>33</volume>, <fpage>425</fpage>–<lpage>427</lpage> (<year>2017</year>).<pub-id pub-id-type="pmid">28172415</pub-id></mixed-citation>
    </ref>
    <ref id="R18">
      <label>18.</label>
      <mixed-citation publication-type="journal"><name><surname>Rizzetto</surname><given-names>S</given-names></name>. <etal/><article-title>B-cell receptor reconstruction from single-cell RNA-seq with VDJPuzzle</article-title>. <source>Bioinformatics</source><volume>34</volume>, <fpage>2846</fpage>–<lpage>2847</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">29659703</pub-id></mixed-citation>
    </ref>
    <ref id="R19">
      <label>19.</label>
      <mixed-citation publication-type="journal"><name><surname>Hagemann-Jensen</surname><given-names>M</given-names></name>. <etal/><article-title>Single-cell RNA counting at allele and isoform resolution using Smart-seq3</article-title>. <source>Nat Biotechnol</source><volume>38</volume>, <fpage>708</fpage>–<lpage>714</lpage> (<year>2020</year>).<pub-id pub-id-type="pmid">32518404</pub-id></mixed-citation>
    </ref>
    <ref id="R20">
      <label>20.</label>
      <mixed-citation publication-type="journal"><name><surname>Zheng</surname><given-names>GXY</given-names></name><etal/><article-title>Massively parallel digital transcriptional profiling of single cells</article-title>. <source>Nat Commun</source><volume>8</volume>, <fpage>14049</fpage> (<year>2017</year>).<pub-id pub-id-type="pmid">28091601</pub-id></mixed-citation>
    </ref>
    <ref id="R21">
      <label>21.</label>
      <mixed-citation publication-type="journal"><name><surname>Stuart</surname><given-names>T</given-names></name>. <etal/><article-title>Comprehensive Integration of Single-Cell Data</article-title>. <source>Cell</source><volume>177</volume>, <fpage>1888</fpage>–<lpage>1902</lpage>.e21 (<year>2019</year>).<pub-id pub-id-type="pmid">31178118</pub-id></mixed-citation>
    </ref>
    <ref id="R22">
      <label>22.</label>
      <mixed-citation publication-type="journal"><name><surname>Dobin</surname><given-names>A</given-names></name>. <etal/><article-title>STAR: ultrafast universal RNA-seq aligner</article-title>. <source>Bioinformatics</source><volume>29</volume>, <fpage>15</fpage>–<lpage>21</lpage> (<year>2013</year>).<pub-id pub-id-type="pmid">23104886</pub-id></mixed-citation>
    </ref>
    <ref id="R23">
      <label>23.</label>
      <mixed-citation publication-type="journal"><name><surname>Kim</surname><given-names>D</given-names></name>, <name><surname>Langmead</surname><given-names>B</given-names></name>. &amp; <name><surname>Salzberg</surname><given-names>SL</given-names></name>
<article-title>HISAT: a fast spliced aligner with low memory requirements</article-title>. <source>Nat Methods</source>
<volume>12</volume>, <fpage>357</fpage>–<lpage>360</lpage> (<year>2015</year>).<pub-id pub-id-type="pmid">25751142</pub-id></mixed-citation>
    </ref>
    <ref id="R24">
      <label>24.</label>
      <mixed-citation publication-type="journal"><name><surname>Grabherr</surname><given-names>MG</given-names></name><etal/><article-title>Full-length transcriptome assembly from RNA-Seq data without a reference genome</article-title>. <source>Nat Biotechnol</source><volume>29</volume>, <fpage>644</fpage>–<lpage>652</lpage> (<year>2011</year>).<pub-id pub-id-type="pmid">21572440</pub-id></mixed-citation>
    </ref>
    <ref id="R25">
      <label>25.</label>
      <mixed-citation publication-type="journal"><name><surname>Lefranc</surname><given-names>M-P</given-names></name><article-title>IMGT, the International ImMunoGeneTics Information System</article-title>. <source>Cold Spring Harb Protoc</source><volume>2011</volume>, <fpage>595</fpage>–<lpage>603</lpage> (<year>2011</year>).<pub-id pub-id-type="pmid">21632786</pub-id></mixed-citation>
    </ref>
    <ref id="R26">
      <label>26.</label>
      <mixed-citation publication-type="journal"><name><surname>Dempster</surname><given-names>AP</given-names></name>, <name><surname>Laird</surname><given-names>NM</given-names></name> &amp; <name><surname>Rubin</surname><given-names>DB</given-names></name>
<article-title>Maximum Likelihood from Incomplete Data Via the EM Algorithm</article-title>. <source>J R Stat Soc Ser. B Stat Methodol</source>
<volume>39</volume>, <fpage>1</fpage>–<lpage>22</lpage> (<year>1977</year>).</mixed-citation>
    </ref>
    <ref id="R27">
      <label>27.</label>
      <mixed-citation publication-type="journal"><name><surname>Li</surname><given-names>B</given-names></name>. &amp; <name><surname>Dewey</surname><given-names>CN</given-names></name>
<article-title>RSEM: accurate transcript quantification from RNA-Seq data with or without a reference genome</article-title>. <source>BMC Bioinformatics</source>
<volume>12</volume>, <fpage>323</fpage> (<year>2011</year>).<pub-id pub-id-type="pmid">21816040</pub-id></mixed-citation>
    </ref>
    <ref id="R28">
      <label>28.</label>
      <mixed-citation publication-type="journal"><name><surname>Huang</surname><given-names>W</given-names></name>, <name><surname>Li</surname><given-names>L</given-names></name>, <name><surname>Myers</surname><given-names>JR</given-names></name> &amp; <name><surname>Marth</surname><given-names>GT</given-names></name>
<article-title>ART: a next-generation sequencing read simulator</article-title>. <source>Bioinformatics</source>
<volume>28</volume>, <fpage>593</fpage>–<lpage>594</lpage> (<year>2012</year>).<pub-id pub-id-type="pmid">22199392</pub-id></mixed-citation>
    </ref>
    <ref id="R29">
      <label>29.</label>
      <mixed-citation publication-type="journal"><name><surname>Newman</surname><given-names>AM</given-names></name><etal/><article-title>Robust enumeration of cell subsets from tissue expression profiles</article-title>. <source>Nat. Methods</source><volume>12</volume>, <fpage>453</fpage>–<lpage>457</lpage> (<year>2015</year>).<pub-id pub-id-type="pmid">25822800</pub-id></mixed-citation>
    </ref>
    <ref id="R30">
      <label>30.</label>
      <mixed-citation publication-type="journal"><name><surname>Sharonov</surname><given-names>GV</given-names></name>, <name><surname>Serebrovskaya</surname><given-names>EO</given-names></name>, <name><surname>Yuzhakova</surname><given-names>DV</given-names></name>, <name><surname>Britanova</surname><given-names>OV</given-names></name> &amp; <name><surname>Chudakov</surname><given-names>DM</given-names></name>
<article-title>B cells, plasma cells and antibody repertoires in the tumour microenvironment</article-title>. <source>Nat. Rev. Immunol</source>. <volume>20</volume>, <fpage>294</fpage>–<lpage>307</lpage> (<year>2020</year>).<pub-id pub-id-type="pmid">31988391</pub-id></mixed-citation>
    </ref>
    <ref id="R31">
      <label>31.</label>
      <mixed-citation publication-type="journal"><name><surname>Bunker</surname><given-names>JJ</given-names></name> &amp; <name><surname>Bendelac</surname><given-names>A</given-names></name>. <article-title>IgA Responses to Microbiota</article-title>. <source>Immunity</source>
<volume>49</volume>, <fpage>211</fpage>–<lpage>224</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">30134201</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig position="float" id="F1">
    <label>Figure 1.</label>
    <caption>
      <p id="P41">TRUST4 on bulk RNA-seq data (a) Overview of TRUST4 (b) Number of TRB CDR3s reported by MiXCR, CATT, TRUST3 and TRUST4 from the <italic toggle="yes">in silico</italic> RNA-seq data (c) Precision and recall number of six bulk RNA-seq samples using BCR-seq’s results as the gold standard. (d) Evaluation of the full-length V, CDR3 and J sequences assembled by TRUST4 and MiXCR on the pseudo-bulk RNA-seq by grouping SMART-seq data. Each row represents whether the cell’s sequences were recovered in the pseudo-bulk data.</p>
    </caption>
    <graphic xlink:href="nihms-1690340-f0001" position="float"/>
  </fig>
  <fig position="float" id="F2">
    <label>Figure 2.</label>
    <caption>
      <p id="P42">TRUST4 on 5’ 10X Genomics scRNA-seq data (a) UMAP of the 5’ 10X Genomics PBMC data. (b) Number of CDR3s matched with 10X Genomics V(D)J enriched library from the cells annotated by Seurat. (c) TRUST4’s assembled V gene similarities against the reference germline V gene sequences from paired full-length IGH and IGK/IGL assemblies of the 5’ 10X Genomics NSCLC data. Each dot represents one cell.</p>
    </caption>
    <graphic xlink:href="nihms-1690340-f0002" position="float"/>
  </fig>
</floats-group>
