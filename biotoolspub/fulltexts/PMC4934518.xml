<?properties open_access?>
<?subarticle report15361?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v3.0 20080202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing3.dtd?>
<?SourceDTD.Version 3.0?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">F1000Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">F1000Res</journal-id>
    <journal-id journal-id-type="pmc">F1000Research</journal-id>
    <journal-title-group>
      <journal-title>F1000Research</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2046-1402</issn>
    <publisher>
      <publisher-name>F1000Research</publisher-name>
      <publisher-loc>London, UK</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4934518</article-id>
    <article-id pub-id-type="pmid">27508061</article-id>
    <article-id pub-id-type="doi">10.12688/f1000research.8987.2</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software Tool Article</subject>
      </subj-group>
      <subj-group>
        <subject>Articles</subject>
        <subj-group>
          <subject>Genomics</subject>
        </subj-group>
        <subj-group>
          <subject>Statistical Methodologies &amp; Health Informatics</subject>
        </subj-group>
        <subj-group>
          <subject>Theory &amp; Simulation</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>From reads to genes to pathways: differential expression analysis of RNA-Seq experiments using Rsubread and the edgeR quasi-likelihood pipeline</article-title>
      <fn-group content-type="pub-status">
        <fn>
          <p>[version 2; referees: 5 approved]</p>
        </fn>
      </fn-group>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Chen</surname>
          <given-names>Yunshun</given-names>
        </name>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lun</surname>
          <given-names>Aaron T. L.</given-names>
        </name>
        <xref ref-type="aff" rid="a3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Smyth</surname>
          <given-names>Gordon K.</given-names>
        </name>
        <xref ref-type="corresp" rid="c1">a</xref>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a4">4</xref>
      </contrib>
      <aff id="a1"><label>1</label>The Walter and Eliza Hall Institute of Medical Research, Parkville, Victoria, 3052, Australia</aff>
      <aff id="a2"><label>2</label>Department of Medical Biology, The University of Melbourne, Victoria, 3010, Australia</aff>
      <aff id="a3"><label>3</label>Cancer Research UK Cambridge Institute, University of Cambridge, Li Ka Shing Centre, Cambridge, UK</aff>
      <aff id="a4"><label>4</label>Department of Mathematics and Statistics, The University of Melbourne, Victoria, 3010, Australia</aff>
    </contrib-group>
    <author-notes>
      <corresp id="c1">
        <label>a</label>
        <email xlink:href="mailto:smyth@wehi.edu.au">smyth@wehi.edu.au</email>
      </corresp>
      <fn fn-type="con">
        <p>All authors developed and tested the code workflow. All authors wrote the article.</p>
      </fn>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>2</day>
      <month>8</month>
      <year>2016</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2016</year>
    </pub-date>
    <volume>5</volume>
    <elocation-id>1438</elocation-id>
    <history>
      <date date-type="accepted">
        <day>27</day>
        <month>7</month>
        <year>2016</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright: © 2016 Chen Y et al.</copyright-statement>
      <copyright-year>2016</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:type="simple" xlink:href="f1000research-5-9996.pdf"/>
    <abstract>
      <p>In recent years, RNA sequencing (RNA-seq) has become a very widely used technology for profiling gene expression. One of the most common aims of RNA-seq profiling is to identify genes or molecular pathways that are differentially expressed (DE) between two or more biological conditions. This article demonstrates a computational workflow for the detection of DE genes and pathways from RNA-seq data by providing a complete analysis of an RNA-seq experiment profiling epithelial cell subsets in the mouse mammary gland. The workflow uses R software packages from the open-source Bioconductor project and covers all steps of the analysis pipeline, including alignment of read sequences, data exploration, differential expression analysis, visualization and pathway analysis. Read alignment and count quantification is conducted using the Rsubread package and the statistical analyses are performed using the edgeR package. The differential expression analysis uses the quasi-likelihood functionality of edgeR.</p>
    </abstract>
    <kwd-group kwd-group-type="author">
      <kwd>RNA sequencing</kwd>
      <kwd>molecular pathways</kwd>
      <kwd>gene expression</kwd>
      <kwd>R software</kwd>
    </kwd-group>
    <funding-group>
      <funding-statement>This work was supported by the National Health and Medical Research Council (Fellowship 1058892 and Program 1054618 to G.K.S, Independent Research Institutes Infrastructure Support to the Walter and Eliza Hall Institute) and by a Victorian State Government Operational Infrastructure Support Grant.</funding-statement>
    </funding-group>
  </article-meta>
  <notes notes-type="version-changes">
    <sec sec-type="version-changes">
      <label>Revised</label>
      <title>Amendments from Version 1</title>
      <p>A URL is now given via which readers can download the data and source code files. Further explanations have been added regarding sample sizes, quality scores, filtering, normalization and glmTreat. An MD plot of sample 11 has been added with more discussion of normalization factors. A plot of sequence quality scores for the first FASTQ file has been added.</p>
    </sec>
  </notes>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>In recent years, RNA sequencing (RNA-seq) has become a very widely used technology for profiling transcriptional activity in biological systems. One of the most common aims of RNA-seq profiling is to identify genes or molecular pathways that are differentially expressed (DE) between two or more biological conditions. Changes in expression can then be associated with differences in biology, providing avenues for further investigation into potential mechanisms of action.</p>
    <p>This article provides a detailed workflow for analyzing an RNA-seq study from the raw reads through to differential expression and pathway analysis using Bioconductor packages
<sup><xref rid="ref-1" ref-type="bibr">1</xref></sup>. The article gives a complete analysis of RNA-seq data that were collected to study the effects of pregnancy and lactation on the luminal cell lineage in the mouse mammary gland
<sup><xref rid="ref-2" ref-type="bibr">2</xref></sup>. The pipeline uses the
<italic>Rsubread</italic> package
<sup><xref rid="ref-3" ref-type="bibr">3</xref></sup> for mapping reads and assigning them to genes, and the
<italic>edgeR</italic> package
<sup><xref rid="ref-4" ref-type="bibr">4</xref></sup> for statistical analyses.</p>
    <p>RNA-seq analysis involves a number of steps, including read alignment, read summarization, differential expression and pathway analysis. Here we use the Subread aligner
<sup><xref rid="ref-3" ref-type="bibr">3</xref></sup> for mapping and featureCounts
<sup><xref rid="ref-5" ref-type="bibr">5</xref></sup> for assigning reads to genes. As well as being fast and efficient, these algorithms have the advantage of having native implementations as R functions in the
<italic>Rsubread</italic> package. This means that the entire analysis can be conducted efficiently within the R environment.</p>
    <p>The workflow uses
<italic>edgeR</italic>’s quasi-likelihood pipeline (edgeR-quasi) for differential expression. This statistical methodology uses negative binomial generalized linear models
<sup><xref rid="ref-6" ref-type="bibr">6</xref></sup> but with F-tests instead of likelihood ratio tests
<sup><xref rid="ref-7" ref-type="bibr">7</xref></sup>. This method provides stricter error rate control than other negative binomial based pipelines, including the traditional
<italic>edgeR</italic> pipelines
<sup><xref rid="ref-6" ref-type="bibr">6</xref>,
<xref rid="ref-8" ref-type="bibr">8</xref>,
<xref rid="ref-9" ref-type="bibr">9</xref></sup> or
<italic>DESeq2</italic>
<sup><xref rid="ref-10" ref-type="bibr">10</xref></sup>. The edgeR-quasi pipeline is based on similar statistical methodology to that of the
<italic>QuasiSeq</italic> package
<sup><xref rid="ref-7" ref-type="bibr">7</xref></sup>, which has performed well in third-party comparisons
<sup><xref rid="ref-11" ref-type="bibr">11</xref></sup>. Compared to
<italic>QuasiSeq</italic>, the
<italic>edgeR</italic> functions offer speed improvements and some additional statistical refinements
<sup><xref rid="ref-12" ref-type="bibr">12</xref></sup>. The RNA-seq pipelines of the
<italic>limma</italic> package also offer excellent error rate control
<sup><xref rid="ref-13" ref-type="bibr">13</xref>,
<xref rid="ref-14" ref-type="bibr">14</xref></sup>. While the
<italic>limma</italic> pipelines are recommended for large-scale datasets, because of their speed and flexibility, the edgeR-quasi pipeline gives better performance in low-count situations
<sup><xref rid="ref-15" ref-type="bibr">15</xref>,
<xref rid="ref-16" ref-type="bibr">16</xref></sup>. For the data analyzed here, the edgeR-quasi, limma-voom and limma-trend pipelines are all equally suitable and give similar results.</p>
    <p>The analysis approach illustrated in this article can be applied to any RNA-seq study that includes some replication, but it is especially appropriate for designed experiments with multiple treatment factors and with small numbers of biological replicates. The approach assumes that RNA samples have been extracted from cells of interest under two or more treatment conditions, that RNA-seq profiling has been applied to each RNA sample and that there are independent biological replicates for at least one of the treatment conditions. The
<italic>Rsubread</italic> part of the workflow takes FASTQ files of raw sequence reads as input, while the
<italic>edgeR</italic> part of the pipeline takes a matrix of genewise read counts as input.</p>
  </sec>
  <sec>
    <title>Description of the biological experiment</title>
    <p>This workflow demonstrates a complete bioinformatics analysis of an RNA-seq study that is available from the GEO repository as series GSE60450. The RNA-seq data were collected to study the lineage of luminal cells in the mouse mammary gland and in particular how the expression profiles of the members of the lineage change upon pregnancy and lactation
<sup><xref rid="ref-2" ref-type="bibr">2</xref></sup>. Specifically, the study examined the expression profiles of basal stem-cell enriched cells (B) and committed luminal cells (L) in the mammary glands of virgin, pregnant and lactating mice. There are therefore six groups of RNA samples, one for each combination of cell type and mouse status. Two biological replicates were collected for each group.</p>
    <p>This study used an Illumina Hiseq sequencer to generate about 30 million 100bp single-end reads for each sample. Subread version 1.4.4 (
<ext-link ext-link-type="uri" xlink:href="http://subread.sourceforge.net">http://subread.sourceforge.net</ext-link>) was used to align the reads to the mouse mm10 genome and featureCounts was used to assign reads to Entrez Genes using RefSeq gene annotation. The FASTQ files containing the raw sequence reads were deposited to the Sequence Read Archive (SRA) repository and the read counts were deposited to GEO.</p>
    <p>This experimental design is summarized in the table below, where the basal and luminal cell types are abbreviated with B and L respectively. The GEO and SRA identifiers for each RNA sample are also shown:</p>
    <p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; targets</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">read.delim</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"targets.txt"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">stringsAsFactors</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">FALSE</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)
&gt; targets

               GEO        SRA CellType    Status
MCL1.DG GSM1480297 SRR1552450        B    virgin
MCL1.DH GSM1480298 SRR1552451        B    virgin
MCL1.DI GSM1480299 SRR1552452        B  pregnant
MCL1.DJ GSM1480300 SRR1552453        B  pregnant
MCL1.DK GSM1480301 SRR1552454        B lactating
MCL1.DL GSM1480302 SRR1552455        B lactating
MCL1.LA GSM1480291 SRR1552444        L    virgin
MCL1.LB GSM1480292 SRR1552445        L    virgin
MCL1.LC GSM1480293 SRR1552446        L  pregnant
MCL1.LD GSM1480294 SRR1552447        L  pregnant
MCL1.LE GSM1480295 SRR1552448        L lactating
MCL1.LF GSM1480296 SRR1552449        L lactating</styled-content>
      </preformat>
    </p>
    <p>The experiment can be viewed as a one-way layout with six groups. For later use, we combine the treatment factors into a single grouping factor:</p>
    <p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; group</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">paste</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(targets</styled-content>
        <styled-content style="font-size:15px;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">CellType, targets</styled-content>
        <styled-content style="font-size:15px;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">Status,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">sep</styled-content>
        <styled-content style="font-size:15px;color:#;">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"."</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)
&gt; group</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">factor</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(group)
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">table</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(group)

group
B.lactating B.pregnant B.virgin L.lactating L.pregnant L.virgin
          2          2        2           2          2        2</styled-content>
      </preformat>
    </p>
    <p><bold>Note.</bold> This study isolated carefully sorted cell populations obtained from genetically indentical mice under controlled laboratory conditions. As will be shown during the analysis below, the relatively small sample size (
<italic>n</italic> = 2 in each group) here is justified by the low background variability and by the fact that the expression profiles of the different groups are distinctly different. Studies with more variability (for example on human subjects) or with smaller effect sizes may well require more biological replicates for reliable results.</p>
  </sec>
  <sec>
    <title>Preliminary analysis</title>
    <sec>
      <title>Downloading the read counts</title>
      <p>Readers wishing to reproduce the analysis presented in this article can either download the matrix of read counts from GEO or recreate the read count matrix from the raw sequence counts. We will present first the analysis using the downloaded matrix of counts. At the end of this article we will present the R commands needed to recreate this matrix.</p>
      <p>The following commands download the genewise read counts for the GEO series GSE60450. The zipped tab-delimited text file
<monospace>GSE60450_Lactation-GenewiseCounts.txt.gz</monospace> will be downloaded to the working R directory:</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;color:#585858;">&gt; FileURL</styled-content>
          <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">paste</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(
+</styled-content>
          <styled-content style="font-size:15px;color:#317ECC;">"
                            <ext-link ext-link-type="uri" xlink:href="http://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE60450">http://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE60450</ext-link>"</styled-content>
          <styled-content style="font-size:15px;color:#585858;">,
+</styled-content>
          <styled-content style="font-size:15px;color:#317ECC;">"format=file"</styled-content>
          <styled-content style="font-size:15px;color:#585858;">,
+</styled-content>
          <styled-content style="font-size:15px;color:#317ECC;">"file=GSE60450_Lactation-GenewiseCounts.txt.gz"</styled-content>
          <styled-content style="font-size:15px;color:#585858;">,</styled-content>
          <styled-content style="font-size:15px;color:#585858;">+</styled-content>
          <styled-content style="font-size:15px;color:#55AA55;">sep</styled-content>
          <styled-content style="font-size:15px;color:#585858;">=</styled-content>
          <styled-content style="font-size:15px;color:#317ECC;">"&amp;"</styled-content>
          <styled-content style="font-size:15px;color:#585858;">)
&gt;</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">download.file</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(FileURL,</styled-content>
          <styled-content style="font-size:15px;color:#317ECC;">"GSE60450_Lactation-GenewiseCounts.txt.gz"</styled-content>
          <styled-content style="font-size:15px;color:#585858;">)</styled-content>
        </preformat>
      </p>
      <p>The counts can then be read into a data.frame in R:</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;color:#585858;">&gt; GenewiseCounts</styled-content>
          <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">read.delim</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(</styled-content>
          <styled-content style="font-size:15px;color:#317ECC;">"GSE60450_Lactation-GenewiseCounts.txt.gz"</styled-content>
          <styled-content style="font-size:15px;color:#585858;">,
+</styled-content>
          <styled-content style="font-size:15px;color:#55AA55;">row.names</styled-content>
          <styled-content style="font-size:15px;color:#585858;">=</styled-content>
          <styled-content style="font-size:15px;color:#317ECC;">"EntrezGeneID"</styled-content>
          <styled-content style="font-size:15px;color:#585858;">)
&gt;</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">colnames</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(GenewiseCounts)</styled-content>
          <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">substring</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">colnames</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(GenewiseCounts),</styled-content>
          <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
          <styled-content style="font-size:15px;color:#585858;">,</styled-content>
          <styled-content style="font-size:15px;color:#AF0F91;">7</styled-content>
          <styled-content style="font-size:15px;color:#585858;">)
&gt;</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">dim</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(GenewiseCounts)

[1] 27179    13

&gt;</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">head</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(GenewiseCounts)

          Length MCL1.DG MCL1.DH MCL1.DI MCL1.DJ MCL1.DK MCL1.DL MCL1.LA MCL1.LB
497097      3634     438     300      65     237     354     287       0       0
100503874   3259       1       0       1       1       0       4       0       0
100038431   1634       0       0       0       0       0       0       0       0
19888       9747       1       1       0       0       0       0      10       3
20671       3130     106     182      82     105      43      82      16      25
27395       4203     309     234     337     300     290     270     560     464
          MCL1.LC MCL1.LD MCL1.LE MCL1.LF
497097          0       0       0       0
100503874       0       0       0       0     
100038431       0       0       0       0
19888          10       2       0       0
20671          18       8       3      10
27395         489     328     307     342</styled-content>
        </preformat>
      </p>
      <p>The row names of
<monospace>GenewiseCounts</monospace> are the Entrez Gene Identifiers. The first column contains the length of each gene, being the total number of bases in exons and UTRs for that gene. The remaining 12 columns contain read counts and correspond to rows of
<monospace>targets</monospace>.</p>
      <p>The
<italic>edgeR</italic> package stores data in a simple list-based data object called a
<monospace>DGEList</monospace>. This object is easy to use as it can be manipulated like an ordinary list in R, and it can also be subsetted like a matrix. The main components of a
<monospace>DGEList</monospace> object are a matrix of read counts, sample information in the
<monospace>data.frame</monospace> format and optional gene annotation. We enter the counts into a
<monospace>DGEList</monospace> object using the function
<monospace>DGEList</monospace> in
<italic>edgeR</italic>:</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">library</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(edgeR)
&gt; y</styled-content>
          <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">DGEList</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(GenewiseCounts[,-</styled-content>
          <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
          <styled-content style="font-size:15px;color:#585858;">],</styled-content>
          <styled-content style="font-size:15px;color:#55AA55;">group</styled-content>
          <styled-content style="font-size:15px;color:#585858;">=group,
+</styled-content>
          <styled-content style="font-size:15px;color:#55AA55;">genes</styled-content>
          <styled-content style="font-size:15px;color:#585858;">=GenewiseCounts[,</styled-content>
          <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
          <styled-content style="font-size:15px;color:#585858;">,</styled-content>
          <styled-content style="font-size:15px;color:#55AA55;">drop</styled-content>
          <styled-content style="font-size:15px;color:#585858;">=</styled-content>
          <styled-content style="font-size:15px;color:#AF0F91;">FALSE</styled-content>
          <styled-content style="font-size:15px;color:#585858;">])
&gt;</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">options</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(</styled-content>
          <styled-content style="font-size:15px;color:#55AA55;">digits</styled-content>
          <styled-content style="font-size:15px;color:#585858;">=</styled-content>
          <styled-content style="font-size:15px;color:#AF0F91;">3</styled-content>
          <styled-content style="font-size:15px;color:#585858;">)
&gt; y</styled-content>
          <styled-content style="font-size:15px;">$</styled-content>
          <styled-content style="font-size:15px;color:#585858;">samples

              group lib.size norm.factors
MCL1.DG    B.virgin 23227641            1
MCL1.DH    B.virgin 21777891            1
MCL1.DI  B.pregnant 24100765            1
MCL1.DJ  B.pregnant 22665371            1
MCL1.DK B.lactating 21529331            1
MCL1.DL B.lactating 20015386            1
MCL1.LA    L.virgin 20392113            1
MCL1.LB    L.virgin 21708152            1
MCL1.LC  L.pregnant 22241607            1
MCL1.LD  L.pregnant 21988240            1
MCL1.LE L.lactating 24723827            1
MCL1.LF L.lactating 24657293            1</styled-content>
        </preformat>
      </p>
    </sec>
    <sec>
      <title>Adding gene annotation</title>
      <p>The Entrez Gene Ids link to gene information in the NCBI database. The
<italic>org.Mm.eg.db</italic> package can be used to complement the gene annotation information. Here, a column of gene symbols is added to
<monospace>y$genes</monospace>:</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">library</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(org.Mm.eg.db)
&gt; y</styled-content>
          <styled-content style="font-size:15px;">$</styled-content>
          <styled-content style="font-size:15px;color:#585858;">genes</styled-content>
          <styled-content style="font-size:15px;">$</styled-content>
          <styled-content style="font-size:15px;color:#585858;">Symbol</styled-content>
          <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">mapIds</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(org.Mm.eg.db,</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">rownames</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(y),
+</styled-content>
          <styled-content style="font-size:15px;color:#55AA55;">keytype</styled-content>
          <styled-content style="font-size:15px;color:#585858;">=</styled-content>
          <styled-content style="font-size:15px;color:#317ECC;">"ENTREZID"</styled-content>
          <styled-content style="font-size:15px;color:#585858;">,</styled-content>
          <styled-content style="font-size:15px;color:#55AA55;">column</styled-content>
          <styled-content style="font-size:15px;color:#585858;">=</styled-content>
          <styled-content style="font-size:15px;color:#317ECC;">"SYMBOL"</styled-content>
          <styled-content style="font-size:15px;color:#585858;">)
&gt;</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">head</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(y</styled-content>
          <styled-content style="font-size:15px;">$</styled-content>
          <styled-content style="font-size:15px;color:#585858;">genes)

          Length   Symbol
497097      3634     Xkr4
100503874   3259  Gm19938
100038431   1634  Gm10568
19888       9747      Rp1
20671       3130    Sox17
27395       4203   Mrpl15</styled-content>
        </preformat>
      </p>
      <p>Entrez Ids that no longer have official gene symbols are dropped from the analysis. The whole
<monospace>DGEList</monospace> object, including annotation as well as counts, can be subsetted by rows as if it was a matrix:</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;color:#585858;">&gt; y</styled-content>
          <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
          <styled-content style="font-size:15px;color:#585858;">y[</styled-content>
          <styled-content style="font-size:15px;">!</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">is.na</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(y</styled-content>
          <styled-content style="font-size:15px;">$</styled-content>
          <styled-content style="font-size:15px;color:#585858;">genes</styled-content>
          <styled-content style="font-size:15px;">$</styled-content>
          <styled-content style="font-size:15px;color:#585858;">Symbol), ]
&gt;</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">dim</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(y)

[1] 26357    12</styled-content>
        </preformat>
      </p>
    </sec>
    <sec>
      <title>Filtering to remove low counts</title>
      <p>Genes that have very low counts across all the libraries should be removed prior to downstream analysis. This is justified on both biological and statistical grounds. From biological point of view, a gene must be expressed at some minimal level before it is likely to be translated into a protein or to be considered biologically important. From a statistical point of view, genes with consistently low counts are very unlikely be assessed as significantly DE because low counts do not provide enough statistical evidence for a reliable judgement to be made. Such genes can therefore be removed from the analysis without any loss of information.</p>
      <p>As a rule of thumb, we require that a gene have a count of at least 10–15 in at least some libraries before it is considered to be expressed in the study. We could explicitly select for genes that have at least a couple of counts of 10 or more, but it is slightly better to base the filtering on count-per-million (CPM) values so as to avoid favoring genes that are expressed in larger libraries over those expressed in smaller libraries. For the current analysis, we keep genes that have CPM values above 0.5 in at least two libraries:</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;color:#585858;">&gt; keep</styled-content>
          <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">rowSums</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">cpm</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(</styled-content>
          <styled-content style="font-size:15px;color:#585858;">y)</styled-content>
          <styled-content style="font-size:15px;">&gt;</styled-content>
          <styled-content style="font-size:15px;color:#AF0F91;">0.5</styled-content>
          <styled-content style="font-size:15px;color:#585858;">)</styled-content>
          <styled-content style="font-size:15px;">&gt;=</styled-content>
          <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
          <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">table</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(keep)</styled-content>
          <styled-content style="font-size:15px;color:#585858;">keep
FALSE  TRUE
10704 15653</styled-content>
        </preformat>
      </p>
      <p>Here the cutoff of 0.5 for the CPM has been chosen because it is roughly equal to 10
<italic>/L</italic> where
<italic>L</italic> is the minimum library size in millions. The library sizes here are 20–25 million. We used a round value of 0.5 just for simplicity; the exact value is not important because the downstream differential expression analysis is not sensitive to the small changes in this parameter. The requirement of ≥ 2 libraries is because each group contains two replicates. This ensures that a gene will be retained if it is expressed in both the libraries belonging to any of the six groups.</p>
      <p>The above filtering rule attempts to keep the maximum number of interesting genes in the analysis, but other sensible filtering criteria are also possible. For example
<monospace>keep &lt;-rowSums(y$counts) &gt; 50</monospace> is a very simple criterion that would keep genes with a total read count of more than 50. This would give similar downstream results for this dataset to the filtering actually used. Whatever the filtering rule, it should be independent of the information in the targets file. It should not make any reference to which RNA libraries belong to which group, because doing so would bias the subsequent differential expression analysis.</p>
      <p>The
<monospace>DGEList</monospace> object is subsetted to retain only the non-filtered genes:</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;color:#585858;">&gt; y</styled-content>
          <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
          <styled-content style="font-size:15px;color:#585858;">y[keep, ,</styled-content>
          <styled-content style="font-size:15px;color:#55AA55;">keep.lib.sizes</styled-content>
          <styled-content style="font-size:15px;color:#585858;">=</styled-content>
          <styled-content style="font-size:15px;color:#AF0F91;">FALSE</styled-content>
          <styled-content style="font-size:15px;color:#585858;">]</styled-content>
        </preformat>
      </p>
      <p>The option
<monospace>keep.lib.sizes=FALSE</monospace> causes the library sizes to be recomputed after the filtering. This is generally recommended, although the effect on the downstream analysis is usually small.</p>
    </sec>
    <sec>
      <title>Normalization for composition bias</title>
      <p>Normalization by trimmed mean of M values (TMM)
<sup><xref rid="ref-17" ref-type="bibr">17</xref></sup> is performed by using the
<monospace>calcNormFactors</monospace> function, which returns the
<monospace>DGEList</monospace> argument with only the
<monospace>norm.factors</monospace> changed. It calculates a set of normalization factors, one for each sample, to eliminate composition biases between libraries. The product of these factors and the library sizes defines the effective library size, which replaces the original library size in all downstream analyses.</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;color:#585858;">&gt; y</styled-content>
          <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">calcNormFactors</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(y)
&gt; y</styled-content>
          <styled-content style="font-size:15px;">$</styled-content>
          <styled-content style="font-size:15px;color:#585858;">samples

              group lib.size norm.factors
MCL1.DG    B.virgin 23139638        1.235
MCL1.DH    B.virgin 21689576        1.213
MCL1.DI  B.pregnant 23976634        1.126
MCL1.DJ  B.pregnant 22546909        1.069
MCL1.DK B.lactating 21422164        1.036
MCL1.DL B.lactating 19918278        1.087
MCL1.LA    L.virgin 20276400        1.370
MCL1.LB    L.virgin 21571124        1.368
MCL1.LC  L.pregnant 22120647        1.006
MCL1.LD  L.pregnant 21879947        0.924
MCL1.LE L.lactating 24660577        0.529
MCL1.LF L.lactating 24602860        0.535</styled-content>
        </preformat>
      </p>
      <p>The normalization factors of all the libraries multiply to unity. A normalization factor below one indicates that a small number of high count genes are monopolizing the sequencing, causing the counts for other genes to be lower than would be usual given the library size. As a result, the effective library size will be scaled down for that sample. Here we see that the luminal-lactating samples have low normalization factors. This is a sign that these samples contain a number of very highly upregulated genes.</p>
      <p><bold>Note.</bold> In general, we find TMM normalization to be satisfactory for almost all well-designed mRNA gene expression experiments. Single-cell RNA-seq is an exception, for which specialized normalization methods are needed
<sup><xref rid="ref-18" ref-type="bibr">18</xref></sup>. Another, less common, type of study requiring special treatment is that with global differential expression, with more than half of the genome differentially expressed between experimental conditions in the same direction
<sup><xref rid="ref-19" ref-type="bibr">19</xref></sup>. Global differential expression should generally be avoided in well designed experiments. When it can’t be avoided, then some normalization reference such as spike-ins needs to be built into the experiment for reliable normalization to be done
<sup><xref rid="ref-20" ref-type="bibr">20</xref></sup>.</p>
    </sec>
    <sec>
      <title>Exploring differences between libraries</title>
      <p>The RNA samples can be clustered in two dimensions using multi-dimensional scaling (MDS) plots. This is both an analysis step and a quality control step to explore the overall differences between the expression profiles of the different samples. Here we decorate the MDS plot to indicate the cell groups:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858">&gt; pch</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">&lt;- c</styled-content>
        <styled-content style="font-size:15px;color:#585858">(</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">0</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">15</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">16</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">17</styled-content>
        <styled-content style="font-size:15px;color:#585858">)</styled-content>
        <styled-content style="font-size:15px;color:#585858">&gt; colors</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">&lt;- rep</styled-content>
        <styled-content style="font-size:15px;color:#585858">(</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">c</styled-content>
        <styled-content style="font-size:15px;color:#585858">(</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"darkgreen"</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"red"</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"blue"</styled-content>
        <styled-content style="font-size:15px;color:#585858">),</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
        <styled-content style="font-size:15px;color:#585858">)</styled-content>
        <styled-content style="font-size:15px;color:#585858">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">plotMDS</styled-content>
        <styled-content style="font-size:15px;color:#585858">(y,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">col</styled-content>
        <styled-content style="font-size:15px;color:#585858">=colors[group],</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">pch</styled-content>
        <styled-content style="font-size:15px;color:#585858">=pch[group])</styled-content>
        <styled-content style="font-size:15px;color:#585858">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">legend</styled-content>
        <styled-content style="font-size:15px;color:#585858">(</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"topleft"</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">legend</styled-content>
        <styled-content style="font-size:15px;color:#585858">=</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">levels</styled-content>
        <styled-content style="font-size:15px;color:#585858">(group),</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">pch</styled-content>
        <styled-content style="font-size:15px;color:#585858">=pch,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">col</styled-content>
        <styled-content style="font-size:15px;color:#585858">=colors,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">ncol</styled-content>
        <styled-content style="font-size:15px;color:#585858">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
        <styled-content style="font-size:15px;color:#585858">)</styled-content>
      </preformat>
      <p>(see
<xref ref-type="fig" rid="f1">Figure 1</xref>). In the MDS plot, the distance between each pair of samples can be interpreted as the leading log-fold change between the samples for the genes that best distinguish that pair of samples. By default, leading fold-change is defined as the root-mean-square of the largest 500 log2-fold changes between that pair of samples.
<xref ref-type="fig" rid="f1">Figure 1</xref> shows that replicate samples from the same group cluster together while samples from different groups are well separated. In other words, differences between groups are much larger than those within groups, meaning that there are likely to be statistically significant differences between the groups. The distance between basal cells on the left and luminal cells on the right is about six units on the x-axis, corresponding to a leading fold change of about 64-fold between the two cell types. The differences between the virgin, pregnant and lactating expression profiles appear to be magnified in luminal cells compared to basal.</p>
      <fig fig-type="figure" id="f1" orientation="portrait" position="float">
        <label>Figure 1. </label>
        <caption>
          <title>The MDS plot of the data set.</title>
          <p>Samples are separated by the cell type in the first dimension, and by the mouse status in the second dimension.</p>
        </caption>
        <graphic xlink:href="f1000research-5-9996-g0000"/>
      </fig>
      <p>The expression profiles of individual samples can be explored more closely with mean-difference (MD) plots. An MD plot visualizes the library size-adjusted log-fold change between two libraries (the difference) against the average log-expression across those libraries (the mean). The following command produces an MD plot that compares sample 1 to an artificial reference library constructed from the average of all the other samples:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">plotMD</styled-content>
        <styled-content style="font-size:15px;color:#585858">(y,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">column</styled-content>
        <styled-content style="font-size:15px;color:#585858">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
        <styled-content style="font-size:15px;color:#585858">)</styled-content>
        <styled-content style="font-size:15px;color:#585858">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">abline</styled-content>
        <styled-content style="font-size:15px;color:#585858">(</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">h</styled-content>
        <styled-content style="font-size:15px;color:#585858">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">0</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">col</styled-content>
        <styled-content style="font-size:15px;color:#585858">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"red"</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">lty</styled-content>
        <styled-content style="font-size:15px;color:#585858">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">lwd</styled-content>
        <styled-content style="font-size:15px;color:#585858">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
        <styled-content style="font-size:15px;color:#585858">)</styled-content>
      </preformat>
      <p>(see
<xref ref-type="fig" rid="f2">Figure 2</xref>). The bulk of the genes are centered around the line of zero log-fold change. The diagonal lines in the lower left of the plot correspond to genes with counts of 0, 1, 2 and so on in the first sample.</p>
      <fig fig-type="figure" id="f2" orientation="portrait" position="float">
        <label>Figure 2. </label>
        <caption>
          <title>MD plot of log2-expression in sample 1 versus the average log2-expression across all other samples.</title>
          <p>Each point represents a gene, and the red line indicates a log-ratio of zero. The majority of points cluster around the red line.</p>
        </caption>
        <graphic xlink:href="f1000research-5-9996-g0001"/>
      </fig>
      <p>It is good practice to make MD plots for all the samples as a quality check. We now look at one of the luminal lactating samples that were observed have low normalization factors:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">plotMD</styled-content>
        <styled-content style="font-size:15px;color:#585858">(y,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">column</styled-content>
        <styled-content style="font-size:15px;color:#585858">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">11</styled-content>
        <styled-content style="font-size:15px;color:#585858">)</styled-content>
        <styled-content style="font-size:15px;color:#585858">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">abline</styled-content>
        <styled-content style="font-size:15px;color:#585858">(</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">h</styled-content>
        <styled-content style="font-size:15px;color:#585858">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">0</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">col</styled-content>
        <styled-content style="font-size:15px;color:#585858">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"red"</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">lty</styled-content>
        <styled-content style="font-size:15px;color:#585858">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
        <styled-content style="font-size:15px;color:#585858">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">lwd</styled-content>
        <styled-content style="font-size:15px;color:#585858">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
        <styled-content style="font-size:15px;color:#585858">)</styled-content>
      </preformat>
      <p>(see
<xref ref-type="fig" rid="f3">Figure 3</xref>). For this sample, the log-ratios show noticeable positive skew, with a number of very highly upregulated genes. In particular, there are a number of points in the upper right of the plot, corresponding to genes that are both highly expressed and highly up-regulated in this sample compared to others. These genes explain why the normalization factor for this sample is well below one. By contrast, the log-ratios for sample 1 were somewhat negatively skewed, corresponding to a normalization factor above one.</p>
      <fig fig-type="figure" id="f3" orientation="portrait" position="float">
        <label>Figure 3. </label>
        <caption>
          <title>MD plot of log2-expression in sample 11 versus the average log2-expression across all other samples.</title>
          <p>The plot shows a number of genes that are both highly expressed and highly up-regulated.</p>
        </caption>
        <graphic xlink:href="f1000research-5-9996-g0002"/>
      </fig>
    </sec>
    <sec>
      <title>Design matrix</title>
      <p>Linear modeling and differential expression analysis in
<italic>edgeR</italic> requires a design matrix to be specified. The design matrix records which treatment conditions were applied to each samples, and it also defines how the experimental effects are parametrized in the linear models. The experimental design for this study can be viewed as a one-way layout and the design matrix can be constructed in a simple and intuitive way by:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; design</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">model.matrix</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#000000;">
          <sup>~</sup>
        </styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">0</styled-content>
        <styled-content style="font-size:15px;color:#000000;">+</styled-content>
        <styled-content style="font-size:15px;color:#585858;">group)
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">colnames</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(design)</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">levels</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(group)
&gt; design

   B.lactating B.pregnant B.virgin L.lactating L.pregnant L.virgin
1            0          0        1           0          0        0
2            0          0        1           0          0        0
3            0          1        0           0          0        0
4            0          1        0           0          0        0
5            1          0        0           0          0        0
6            1          0        0           0          0        0
7            0          0        0           0          0        1
8            0          0        0           0          0        1
9            0          0        0           0          1        0
10           0          0        0           0          1        0
11           0          0        0           1          0        0
12           0          0        0           1          0        0
attr(,"assign")
[1] 1 1 1 1 1 1
attr(,"contrasts")
attr(,"contrasts")$group
[1] "contr.treatment"</styled-content>
      </preformat>
      <p>This design matrix simply links each group to the samples that belong to it. Each row of the design matrix corresponds to a sample whereas each column represents a coefficient corresponding to one of the six groups.</p>
    </sec>
    <sec>
      <title>Dispersion estimation</title>
      <p><italic>edgeR</italic> uses the negative binomial (NB) distribution to model the read counts for each gene in each sample. The dispersion parameter of the NB distribution accounts for variability between biological replicates
<sup><xref rid="ref-6" ref-type="bibr">6</xref></sup>.
<italic>edgeR</italic> estimates an empirical Bayes moderated dispersion for each individual gene. It also estimates a common dispersion, which is a global dispersion estimate averaged over all genes, and a trended dispersion where the dispersion of a gene is predicted from its abundance. Dispersion estimates are most easily obtained from the
<monospace>estimateDisp</monospace> function:</p>
      <p>
        <preformat>
          <styled-content style="font-size:15px;color:#585858;">&gt; y</styled-content>
          <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
          <styled-content style="font-size:15px;color:#BC5A65;">estimateDisp</styled-content>
          <styled-content style="font-size:15px;color:#585858;">(y, design,</styled-content>
          <styled-content style="font-size:15px;color:#55AA55;">robust</styled-content>
          <styled-content style="font-size:15px;color:#585858;">=</styled-content>
          <styled-content style="font-size:15px;color:#AF0F91;">TRUE</styled-content>
          <styled-content style="font-size:15px;color:#585858;">)</styled-content>
        </preformat>
      </p>
      <p>This returns a
<monospace>DGEList</monospace> object with additional components (
<monospace>common.dispersion, trended.dispersion</monospace> and
<monospace>tagwise.dispersion</monospace>) added to hold the estimated dispersions. Here
<monospace>robust=TRUE</monospace> has been used to protect the empirical Bayes estimates against the possibility of outlier genes with exceptionally large or small individual dispersions
<sup><xref rid="ref-21" ref-type="bibr">21</xref></sup>.</p>
      <p>The dispersion estimates can be visualized with
<monospace>plotBCV</monospace>:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">plotBCV</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(y)</styled-content>
      </preformat>
      <p>(see
<xref ref-type="fig" rid="f4">Figure 4</xref>). The vertical axis of the
<monospace>plotBCV</monospace> plot shows square-root dispersion, also known as
<italic>biological coefficient of variation</italic> (BCV)
<sup><xref rid="ref-6" ref-type="bibr">6</xref></sup>.</p>
      <fig fig-type="figure" id="f4" orientation="portrait" position="float">
        <label>Figure 4. </label>
        <caption>
          <title>Scatterplot of the biological coefficient of variation (BCV) against the average abundance of each gene.</title>
          <p>The plot shows the square-root estimates of the common, trended and tagwise NB dispersions.</p>
        </caption>
        <graphic xlink:href="f1000research-5-9996-g0003"/>
      </fig>
      <p>For RNA-seq studies, the NB dispersions tend to be higher for genes with very low counts. The dispersion trend tends to decrease smoothly with abundance and to asymptotic to a constant value for genes with larger counts. From our past experience, the asymptotic value for the BCV tends to be in range from 0.05 to 0.2 for genetically identical mice or cell lines, whereas somewhat larger values (
<italic>&gt;</italic> 0.3) are observed for human subjects.</p>
      <p>The NB model can be extended with quasi-likelihood (QL) methods to account for gene-specific variability from both biological and technical sources
<sup><xref rid="ref-7" ref-type="bibr">7</xref>,
<xref rid="ref-12" ref-type="bibr">12</xref></sup>. Under the QL framework, the NB dispersion trend is used to describe the overall biological variability across all genes, and gene-specific variability above and below the overall level is picked up by the QL dispersion. In the QL approach, the individual (tagwise) NB dispersions are not used.</p>
      <p>The estimation of QL dispersions is performed using the
<monospace>glmQLFit</monospace> function:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; fit</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">glmQLFit</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(y, design,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">robust</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">TRUE</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">head</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(fit</styled-content>
        <styled-content style="font-size:15px;color:#000000;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">coefficients)

       B.lactating B.pregnant B.virgin L.lactating L.pregnant L.virgin
497097      -11.13     -12.01   -11.22       -19.0     -19.03    -19.0
20671       -12.76     -12.51   -12.15       -14.5     -14.30    -14.1
27395       -11.27     -11.29   -11.53       -10.6     -10.86    -10.9
18777       -10.15     -10.21   -10.76       -10.1     -10.38    -10.4
21399        -9.89      -9.73    -9.78       -10.2      -9.97    -10.0
58175       -16.15     -14.85   -15.98       -13.3     -12.29    -12.0</styled-content>
      </preformat>
      <p>This returns a
<monospace>DGEGLM</monospace> object with the estimated values of the GLM coefficients for each gene. It also contains a number of empirical Bayes (EB) statistics including the QL dispersion trend, the squeezed QL dispersion estimates and the prior degrees of freedom (df). The QL dispersions can be visualized by
<monospace>plotQLDisp</monospace>:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">plotQLDisp</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(fit)</styled-content>
      </preformat>
      <p>(see
<xref ref-type="fig" rid="f5">Figure 5</xref>).</p>
      <fig fig-type="figure" id="f5" orientation="portrait" position="float">
        <label>Figure 5. </label>
        <caption>
          <title>A plot of the quarter-root QL dispersion against the average abundance of each gene.</title>
          <p>Estimates are shown for the raw (before EB moderation), trended and squeezed (after EB moderation) dispersions. Note that the QL dispersions and trend shown here are relative to the NB dispersion trend shown in
<xref ref-type="fig" rid="f4">Figure 4</xref>.</p>
        </caption>
        <graphic xlink:href="f1000research-5-9996-g0004"/>
      </fig>
      <p>The QL functions moderate the genewise QL dispersion estimates in the same way that the
<italic>limma</italic> package moderates variances
<sup><xref rid="ref-22" ref-type="bibr">22</xref></sup>. The raw QL dispersion estimates are squeezed towards a global trend, and this moderation reduces the uncertainty of the estimates and improves testing power. The extent of the squeezing is governed by the value of the prior df estimated from the data. Large prior df estimates indicate that the QL dispersions are less variable between genes, meaning that strong EB moderation should be performed. Smaller prior df estimates indicate that the true unknown dispersions are highly variable, so weaker moderation towards the trend is appropriate.</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">summary</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(fit</styled-content>
        <styled-content style="font-size:15px;color:#000000;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">df.prior)

   Min. 1st Qu. Median Mean 3rd Qu. Max.
   3.00    6.77   6.77 6.63    6.77 6.77</styled-content>
      </preformat>
      <p>Setting
<monospace>robust=TRUE</monospace> in
<monospace>glmQLFit</monospace> is usually recommended
<sup><xref rid="ref-21" ref-type="bibr">21</xref></sup>. This allows gene-specific prior df estimates, with lower values for outlier genes and higher values for the main body of genes. This reduces the Chance of getting false positives from genes with extremely high or low raw dispersions, while at the same time increasing statistical power to detect differential expression for the main body of genes.</p>
    </sec>
  </sec>
  <sec>
    <title>Differential expression analysis</title>
    <sec>
      <title>Testing for differential expression</title>
      <p>The next step is to test for differential expression between the experimental groups. One of the most interesting comparisons is that between the basal pregnant and lactating groups. The contrast corresponding to any specified comparison can be constructed conveniently using the
<monospace>makeContrasts</monospace> function:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; B.LvsP</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">makeContrasts</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(B.lactating</styled-content>
        <styled-content style="font-size:15px;color:#000000;">-</styled-content>
        <styled-content style="font-size:15px;color:#585858;">B.pregnant,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">levels</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=design)</styled-content>
      </preformat>
      <p>In subsequent results, a positive log
<sub>2</sub>-fold-change (logFC) will indicate a gene up-regulated in lactating mice relative to pregnant, whereas a negative logFC will indicate a gene more highly expressed in pregnant mice. We will use QL F-tests instead of the more usual likelihood ratio tests (LRT) as they give stricter error rate control by accounting for the uncertainty in dispersion estimation:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; res</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">glmQLFTest</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(fit,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">contrast</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=B.LvsP)</styled-content>
      </preformat>
      <p>The top DE genes can be viewed with
<monospace>topTags</monospace>:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">topTags</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(res)

Coefficient:   1*B.lactating -1*B.pregnant
       Length   Symbol logFC logCPM   F   PValue      FDR
12992     765  Csn1s2b  6.08  10.19 421 4.78e-11 7.48e-07
211577   2006   Mrgprf  5.15   2.75 343 1.32e-10 7.99e-07
226101   7094     Myof  2.32   6.45 322 1.97e-10 7.99e-07
381290   8292   Atp2b4  2.14   6.15 320 2.04e-10 7.99e-07
140474  11281     Muc4 -7.17   6.06 308 2.60e-10 8.15e-07
231830   3346  Micall2 -2.25   5.19 282 4.41e-10 1.15e-06
24117    2242     Wif1 -1.82   6.77 261 7.13e-10 1.60e-06
12740    1812    Cldn4 -5.32   9.87 298 9.12e-10 1.74e-06
21953     667    Tnni2  5.75   3.86 313 1.00e-09 1.74e-06
231991   2873    Creb5  2.57   4.87 240 1.17e-09 1.83e-06</styled-content>
      </preformat>
      <p>In order to control the false discovery rate (FDR), multiple testing correction is performed using the Benjamini-Hochberg method. The top DE gene
<italic>Csn1s2b</italic> has a large positive logFC, showing that it is far more highly expressed in the basal cells of lactating than pregnant mice. This gene is indeed known to be a major source of protein in milk.</p>
      <p>The total number of DE genes identified at an FDR of 5% can be shown with
<monospace>decideTestsDGE</monospace>. There are in fact more than 5000 DE genes in this comparison:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; is.de</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">decideTestsDGE</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(res)
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">summary</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(is.de)

   [,1]
-1  2757
0  10408
1   2488</styled-content>
      </preformat>
      <p>The magnitude of the differential expression changes can be visualized with a fitted model MD plot:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">plotMD</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(res,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">status</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=is.de,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">values</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">c</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#000000;">-</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
        <styled-content style="font-size:15px;color:#585858;">),</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">col</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">c</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"red"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"blue"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">),</styled-content>
        <styled-content style="font-size:15px;color:#585858;">+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">legend</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"topright"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)</styled-content>
      </preformat>
      <p>(see
<xref ref-type="fig" rid="f6">Figure 6</xref>). The logFC for each gene is plotted against the average abundance in log2-CPM, i.e.,
<monospace>logCPM</monospace> in the table above. Genes that are significantly DE are highlighted:</p>
      <fig fig-type="figure" id="f6" orientation="portrait" position="float">
        <label>Figure 6. </label>
        <caption>
          <title>MD plot showing the log-fold change and average abundance of each gene.</title>
          <p>Significantly up and down DE genes are highlighted in red and blue, respectively.</p>
        </caption>
        <graphic xlink:href="f1000research-5-9996-g0005"/>
      </fig>
    </sec>
    <sec>
      <title>Differential expression relative to a fold-change threshold</title>
      <p><monospace>glmQLFTest</monospace> identifies differential expression based on statistical significance regardless of how small the difference might be. For some purposes we might be interested only in genes with reasonably large expression changes. The above analysis found more than 5000 DE genes between the basal pregnant and lactating groups. With such a large number of DE genes, it makes sense to narrow down the list to genes that are more biologically meaningful.</p>
      <p>A commonly used approach is to apply FDR and logFC cutoffs simultaneously. However this tends to favor lowly expressed genes, and also fails to control the FDR correctly. A better and more rigorous approach is to modify the statistical test so as to detect expression changes greater than a specified threshold. In
<italic>edgeR</italic>, this can be done using the
<monospace>glmTreat</monospace> function. This function is analogous to the TREAT method for microarrays
<sup><xref rid="ref-23" ref-type="bibr">23</xref></sup> but is adapted to the NB framework. Here we test whether the differential expression fold changes are significantly greater than 1.5, that is, whether the logFCs are significantly greater than log
<sub>2</sub>(1.5):</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; tr</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">glmTreat</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(fit,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">contrast</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=B.LvsP,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">lfc</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">log2</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1.5</styled-content>
        <styled-content style="font-size:15px;color:#585858;">))
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">topTags</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(tr)

Coefficient:   1*B.lactating -1*B.pregnant
       Length   Symbol logFC unshrunk.logFC logCPM   PValue      FDR
12992     765  Csn1s2b  6.08           6.09  10.19 5.94e-11 9.30e-07
211577   2006   Mrgprf  5.15           5.15   2.75 1.77e-10 1.38e-06
140474  11281     Muc4 -7.17          -7.34   6.06 3.98e-10 2.07e-06
226101   7094     Myof  2.32           2.32   6.45 7.82e-10 2.69e-06
381290   8292   Atp2b4  2.14           2.14   6.15 1.01e-09 2.69e-06
12740    1812    Cldn4 -5.32          -5.32   9.87 1.14e-09 2.69e-06
21953     667    Tnni2  5.75           5.76   3.86 1.20e-09 2.69e-06
231830   3346  Micall2 -2.25          -2.25   5.19 1.90e-09 3.71e-06
231991   2873    Creb5  2.57           2.57   4.87 3.55e-09 6.18e-06
16012    1289   Igfbp6  2.87           2.87   3.68 4.60e-09 7.20e-06</styled-content>
      </preformat>
      <p>Note that the argument
<monospace>lfc</monospace> is an abbreviation for “log-fold-change”. About 1100 genes are detected as DE with a FC significantly above 1.5 at an FDR cut-off of 5%.</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; is.de</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">decideTestsDGE</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(tr)
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">summary</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(is.de)

   [,1]
-1   723
0  14530
1    400</styled-content>
      </preformat>
      <p>The p-values from
<monospace>glmTreat</monospace> are larger than those from
<monospace>glmQLFTest</monospace>, and the number of significantly DE genes is fewer, because it is testing an interval null hypothesis and requires stronger evidence for differential expression than does a conventional test. It provides greater specificity for identifying the most important genes with large fold changes.</p>
      <p>The test results can be visualized in an MD plot:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">plotMD</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(tr,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">status</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=is.de,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">values</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">c</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#000000;">-</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
        <styled-content style="font-size:15px;color:#585858;">),</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">col</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">c</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"red"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"blue"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">),
+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">legend</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"topright"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)</styled-content>
      </preformat>
      <p>(see
<xref ref-type="fig" rid="f7">Figure 7</xref>). The
<monospace>glmTreat</monospace> method evaluates variability as well as the magnitude of change of expression values and therefore is not equivalent to a simple fold change cutoff. Nevertheless, all the statistically significant expression changes have logFC greater than 0.8 and almost all (97%) are greater than 0.9. These values compare to the threshold value of log
<sub>2</sub>(1.5) = 0.58. In general, an estimated logFC must exceed the TREAT threshold by a number of standard errors for it to be called significant. In other words, the whole confidence interval for the logFC must clear the threshold rather than just the estimated value itself. It is better to interpret the threshold as
<italic>the FC below which we are definitely not interested in the gene</italic> rather than
<italic>the FC above which we are interested in the gene</italic>.</p>
      <fig fig-type="figure" id="f7" orientation="portrait" position="float">
        <label>Figure 7. </label>
        <caption>
          <title>MD plot showing the log-fold change and average abundance of each gene.</title>
          <p>Genes with fold-changes significantly greater than 1.5 are highlighted.</p>
        </caption>
        <graphic xlink:href="f1000research-5-9996-g0006"/>
      </fig>
      <p>The value of the FC threshold can be varied depending on the dataset. In the presence of a huge number of DE genes, a relatively large FC threshold may be appropriate to narrow down the search to genes of interest. In the absence of DE genes, on the other hand, a small or even no FC threshold shall be used. If the threshold level is set to zero, then
<monospace>glmTreat</monospace> becomes equivalent to
<monospace>glmQLFTest</monospace> in the workflow shown here.</p>
      <p>In general, using
<monospace>glmTreat</monospace> to reduce the number of DE genes is better than simply reducing the FDR cutoff, because
<monospace>glmTreat</monospace> prioritizes genes with larger changes that are likely to be more biologically significant.
<monospace>glmTreat</monospace> can also be used with
<italic>edgeR</italic> pipelines other than quasi-likelihood, although we don’t demonstrate that here.</p>
    </sec>
    <sec>
      <title>Heat map clustering</title>
      <p>Heatmaps are a popular way to display differential expression results for publication purposes. To create a heatmap, we first convert the read counts into log2-counts-per-million (logCPM) values. This can be done with the
<monospace>cpm</monospace> function:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; logCPM</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">cpm</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(y,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">prior.count</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">log</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">TRUE</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">rownames</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(logCPM)</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#585858;">y</styled-content>
        <styled-content style="font-size:15px;color:#000000;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">genes</styled-content>
        <styled-content style="font-size:15px;color:#000000;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">Symbol 
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">colnames</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(logCPM)</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">paste</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(y</styled-content>
        <styled-content style="font-size:15px;color:#000000;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">samples</styled-content>
        <styled-content style="font-size:15px;color:#000000;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">group,</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
        <styled-content style="font-size:15px;color:#000000;">:</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">sep</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"-"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)</styled-content>
      </preformat>
      <p>The introduction of
<monospace>prior.count</monospace> is to avoid undefined values and to reduce the variability of the logCPM values for genes with low counts. Larger values for
<monospace>prior.count</monospace> shrink the logFCs for low count genes towards zero.</p>
      <p>We will create a heatmap to visualize the top 30 DE genes according to the TREAT test between
<monospace>B.lactating</monospace> and
<monospace>B.pregnant</monospace>. The advantage of a heatmap is that it can display the expression pattern of the genes across all the samples. Visualization of the results is aided by clustering together genes that have correlated expression patterns. First we select the logCPM values for the 30 top genes:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; o</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">order</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(tr</styled-content>
        <styled-content style="font-size:15px;color:#000000;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">table</styled-content>
        <styled-content style="font-size:15px;color:#000000;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">PValue)
&gt; logCPM</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#585858;">logCPM[o[</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
        <styled-content style="font-size:15px;color:#000000;">:</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">30</styled-content>
        <styled-content style="font-size:15px;color:#585858;">],]</styled-content>
      </preformat>
      <p>Then we scale each row (each gene) to have mean zero and standard deviation one:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; logCPM</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">t</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">scale</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">t</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(logCPM)))</styled-content>
      </preformat>
      <p>This scaling is commonly done for heatmaps and ensures that the heatmap displays relative changes for each gene. A heat map can then be produced by the
<monospace>heatmap.2</monospace> function in the
<italic>gplots</italic> package:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">library</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(gplots)
&gt; col.pan</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">colorpanel</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">100</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"blue"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"white"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"red"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)</styled-content>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">heatmap.2</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(logCPM,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">col</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=col.pan,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">Rowv</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">TRUE</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">scale</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"none"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#585858;">+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">trace</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"none"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">dendrogram</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"both"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">cexRow</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">cexCol</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1.4</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">density.info</styled-content>
        <styled-content style="font-size:15px;">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"none"</styled-content>
        <styled-content style="font-size:15px;">,</styled-content>
        <styled-content style="font-size:15px;color:#585858;">+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">margin</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">c</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">10</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">9</styled-content>
        <styled-content style="font-size:15px;color:#585858;">),</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">lhei</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">c</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">10</styled-content>
        <styled-content style="font-size:15px;color:#585858;">),</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">lwid</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">c</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">6</styled-content>
        <styled-content style="font-size:15px;color:#585858;">))</styled-content>
      </preformat>
      <p>(see
<xref ref-type="fig" rid="f8">Figure 8</xref>). By default,
<monospace>heatmap.2</monospace> clusters genes and samples based on Euclidean distance between the expression values. Because we have pre-standardized the rows of the logCPM matrix, the Euclidean distance between each pair of genes is proportional to (1 −
<italic>r</italic>)
<sup>2</sup>, where
<italic>r</italic> is the Pearson correlation coefficient between the two genes. This shows that the heatmap will cluster together genes that have positively correlated logCPM values, because large positive correlations correspond to small distances.</p>
      <fig fig-type="figure" id="f8" orientation="portrait" position="float">
        <label>Figure 8. </label>
        <caption>
          <title>Heat map across all the samples using the top 30 most DE genes between the basal lactating group and the basal pregnancy group.</title>
        </caption>
        <graphic xlink:href="f1000research-5-9996-g0007"/>
      </fig>
      <p>The positioning of the samples in the heatmap is dependent on how the genes in the display have been chosen. Here we are displaying those genes that are most DE between
<monospace>B.lactating</monospace> and
<monospace>B.pregnant</monospace>, so those two cell populations are well separated on the plot. As expected, the two replicate samples from each group are clustered together.</p>
    </sec>
    <sec>
      <title>Analysis of deviance</title>
      <p>The differential expression analysis comparing two groups can be easily extended to comparisons between three or more groups. This is done by creating a matrix of independent contrasts. In this manner, users can perform a one-way analysis of deviance (ANODEV) for each gene
<sup><xref rid="ref-24" ref-type="bibr">24</xref></sup>.</p>
      <p>Suppose we want to compare the three groups in the luminal population, i.e., virgin, pregnant and lactating. An appropriate contrast matrix can be created as shown below, to make pairwise comparisons between all three groups:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; con</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">makeContrasts</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(
+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">L.PvsL</styled-content>
        <styled-content style="font-size:15px;color:#585858;">= L.pregnant</styled-content>
        <styled-content style="font-size:15px;color:#000000;">-</styled-content>
        <styled-content style="font-size:15px;color:#585858;">L.lactating,
+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">L.VvsL</styled-content>
        <styled-content style="font-size:15px;color:#585858;">= L.virgin</styled-content>
        <styled-content style="font-size:15px;color:#000000;">-</styled-content>
        <styled-content style="font-size:15px;color:#585858;">L.lactating,
+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">L.VvsP</styled-content>
        <styled-content style="font-size:15px;color:#585858;">= L.virgin</styled-content>
        <styled-content style="font-size:15px;color:#000000;">-</styled-content>
        <styled-content style="font-size:15px;color:#585858;">L.pregnant,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">levels</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=design)</styled-content>
      </preformat>
      <p>The QL F-test is then applied to identify genes that are DE between the three groups. This combines the three pairwise comparisons into a single F-statistic and p-value. The top set of significant genes can be displayed with
<monospace>topTags</monospace>:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; res</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">glmQLFTest</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(fit,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">contrast</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=con)
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">topTags</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(res)

Coefficient:  LR test of 2 contrasts
      Length  Symbol logFC.L.PvsL logFC.L.VvsL logCPM     F   PValue      FDR
19242   2021     Ptn        -1.54         7.26   7.97  2386 3.73e-17 5.84e-13
13645   4757     Egf        -5.36        -7.22   3.67  1124 4.47e-15 3.15e-11
52150   4089   Kcnk6        -2.42        -7.00   5.91  1020 8.27e-15 3.15e-11
15439   1345      Hp         1.08         5.42   4.93   992 9.89e-15 3.15e-11
12992    765 Csn1s2b        -8.55       -11.36  10.19  1050 1.01e-14 3.15e-11
14183   5346   Fgfr2        -1.15         3.95   7.38   953 1.28e-14 3.17e-11
20856   1793    Stc2        -1.81         3.20   6.11   919 1.60e-14 3.17e-11
11941   7050  Atp2b2        -7.37       -10.56   6.60  1134 1.78e-14 3.17e-11
13358   1678 Slc25a1        -4.13        -4.91   7.50   888 1.99e-14 3.17e-11
17068    691    Ly6d         3.42         9.24   4.69   886 2.02e-14 3.17e-11</styled-content>
      </preformat>
      <p>Note that the three contrasts of pairwise comparisons are linearly dependent. Constructing the contrast matrix with any two of the contrasts would be sufficient for an ANODEV test. If the contrast matrix contains all three possible pairwise comparisons, then only the log-fold changes of the first two contrasts are shown in the output of
<monospace>topTags</monospace>.</p>
    </sec>
    <sec>
      <title>Complicated contrasts</title>
      <p>The flexibility of the GLM framework makes it possible to specify arbitrary contrasts for differential expression tests. Suppose we are interested in testing whether the change in expression between lactating and pregnant mice is the same for basal cells as it is for luminal cells. In statistical terminology, this is the interaction effect between mouse status and cell type. The contrast corresponding to this testing hypothesis can be made as follows.</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; con</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">makeContrasts</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(
+      (L.lactating</styled-content>
        <styled-content style="font-size:15px;color:#000000;">-</styled-content>
        <styled-content style="font-size:15px;color:#585858;">L.pregnant)</styled-content>
        <styled-content style="font-size:15px;color:#000000;">-</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(B.lactating</styled-content>
        <styled-content style="font-size:15px;color:#000000;">-</styled-content>
        <styled-content style="font-size:15px;color:#585858;">B.pregnant),
+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">levels</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=design)</styled-content>
      </preformat>
      <p>Then the QL F-test is conducted to identify genes that are DE under this contrast. The top set of DE genes are viewed with
<monospace>topTags</monospace>.</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; res</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">glmQLFTest</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(fit,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">contrast</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=con)
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">topTags</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(res)

Coefficient: -1*B.lactating  1*B.pregnant 1*L.lactating -1*L.pregnant
       Length   Symbol logFC logCPM   F   PValue      FDR
19041    6277      Ppl -4.62   6.96 524 9.55e-12 1.49e-07
231991   2873    Creb5 -5.61   4.87 438 2.91e-11 2.13e-07
20512    4206   Slc1a3  5.03   3.65 415 4.09e-11 2.13e-07
217294   1952 BC006965 -3.88   4.68 372 8.11e-11 2.86e-07
14598    2022     Ggt1  3.17   6.38 357 1.04e-10 2.86e-07
13358    1678  Slc25a1  3.47   7.50 354 1.10e-10 2.86e-07
192166   4558    Sardh  2.92   5.11 342 1.36e-10 3.04e-07
19659    2628     Rbp1 -4.40   6.83 337 1.63e-10 3.18e-07
67547    3707  Slc39a8  6.19   5.07 376 1.83e-10 3.18e-07
14063    2768    F2rl1 -3.92   5.61 302 2.93e-10 4.20e-07</styled-content>
      </preformat>
    </sec>
  </sec>
  <sec>
    <title>Pathway analysis</title>
    <sec>
      <title>Gene ontology analysis</title>
      <p>We now consider the problem of interpreting the differential expression results in terms of higher order biological processes or molecular pathways. One of the most common used resources is gene ontology (GO) databases, which annotate genes according to a dictionary of annotation terms. A simple and often effective way to interpret the list of DE genes is to count the number of DE genes that are annotated with each possible GO term. GO terms that occur frequently in the list of DE genes are said to be over-represented or enriched. In
<italic>edgeR</italic>, GO analyses can be conveniently conducted using the
<monospace>goana</monospace> function. Here were apply
<monospace>goana</monospace> to the output of the TREAT analysis comparing
<monospace>B.lactating</monospace> to
<monospace>B.pregnant</monospace>. The top most significantly enriched GO terms can be viewed with
<monospace>topGO</monospace>.</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; go</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">goana</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(tr,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">species</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"Mm"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">topGO</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(go,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">n</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">15</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)

                                     Term Ont    N Up Down  P.Up   P.Down
GO:0022402             cell cycle process  BP  931 19  118 0.913 2.69e-23
GO:0000280               nuclear division  BP  460 10   78 0.789 3.58e-23
GO:1903047     mitotic cell cycle process  BP  628  8   92 0.995 1.56e-22
GO:0048285              organelle fission  BP  500 11   78 0.785 7.35e-21
GO:0007067       mitotic nuclear division  BP  376  4   66 0.991 1.51e-20
GO:0007049                     cell cycle  BP 1301 21  138 0.997 6.22e-20
GO:0000278             mitotic cell cycle  BP  736  8   96 0.999 7.97e-20
GO:0007059         chromosome segregation  BP  237  1   49 0.998 1.50e-18
GO:0051301                  cell division  BP  550  6   77 0.997 8.95e-18
GO:0000776                    kinetochore  CC  112  1   33 0.952 8.99e-18
GO:0000775 chromosome, centromeric region  CC  163  1   38 0.988 1.77e-16
GO:0098813 nuclear chromosome segregation  BP  171  1   38 0.990 9.64e-16
GO:0042254            ribosome biogenesis  BP  223  1   42 0.998 1.43e-14
GO:0098687             chromosomal region  CC  278  6   47 0.756 2.69e-14
GO:0005730                      nucleolus  CC  663  4   78 1.000 9.72e-14</styled-content>
      </preformat>
      <p>The
<monospace>goana</monospace> function automatically extracts DE genes from the
<monospace>tr</monospace> object, and conducts overlap tests for the up- and down-regulated DE genes separately. By default, an FDR cutoff of 5% is used when extracting DE genes, but this can be varied. The row names of the output are the universal identifiers of the GO terms and the
<monospace>Term</monospace> column gives the human-readable names of the terms. The
<monospace>Ont</monospace> column shows the ontology domain that each GO term belongs to. The three domains are: biological process (BP), cellular component (CC) and molecular function (MF). The
<monospace>N</monospace> column represents the total number of genes annotated with each GO term. The
<monospace>Up</monospace> and
<monospace>Down</monospace> columns indicate the number of genes within the GO term that are significantly up- and down-regulated in this differential expression comparison, respectively. The
<monospace>P.Up</monospace> and
<monospace>P.Down</monospace> columns contain the p-values for over-representation of the GO term in the up- and down-regulated genes, respectively. Note that the p-values are not adjusted for multiple testing—we would usually ignore GO terms with p-values greater than about 10
<sup>−5</sup>.</p>
      <p>By default the output table from
<monospace>topGO</monospace> is sorted by the minimum of
<monospace>P.Up</monospace> and
<monospace>P.Down</monospace>. Other options are available. For example,
<monospace>topGO(go, sort="up")</monospace> lists the top GO terms that are over-represented in the up-regulated genes. The domain of the enriched GO terms can also be specified by users. For example,
<monospace>topGO(go, ontology="BP")</monospace> restricts to the top GO terms belonging to the biological process domain while
<monospace>topGO(go, ontology="MF")</monospace> restricts to molecular function terms.</p>
      <p>The
<monospace>goana</monospace> function uses the NCBI RefSeq annotation and requires the use of Entrez Gene Identifiers.</p>
    </sec>
    <sec>
      <title>KEGG pathway analysis</title>
      <p>Another popular annotation database is the Kyoto Encyclopedia of Genes and Genomes (KEGG). Much smaller than GO, this is a curated database of molecular pathways and disease signatures. A KEGG analysis can be done exactly as for GO, but using the
<monospace>kegga</monospace> function:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; keg</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">kegga</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(tr,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">species</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"Mm"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)</styled-content>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">topKEGG</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(keg,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">n</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">15</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">truncate</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">34</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)
			
					 Pathway    N Up Down     P.Up   P.Down
path:mmu03008 Ribosome biogenesis in eukaryot...   75  1   19 4.04e-01 3.23e-19
path:mmu01100                 Metabolic pathways 1030 28   51 3.42e-10 1.11e-15
path:mmu04110                         Cell cycle  120  1   19 5.63e-01 3.78e-15
path:mmu00230                  Purine metabolism  152  2   18 2.80e-01 3.45e-12
path:mmu00240              Pyrimidine metabolism   96  0   15 1.00e+00 3.86e-12
path:mmu05150    Staphylococcus aureus infection   30  0   10 1.00e+00 4.78e-12
path:mmu04510                     Focal adhesion  191 13    9 7.22e-10 1.34e-03
path:mmu04060 Cytokine-cytokine receptor inte...  167  9   16 2.34e-06 1.35e-09
path:mmu04514     Cell adhesion molecules (CAMs)  112  2   13 1.79e-01 4.72e-09
path:mmu04972               Pancreatic secretion   63  8    4 1.14e-08 1.10e-02
path:mmu04970                 Salivary secretion   63  8    7 1.14e-08 2.45e-05
path:mmu04610 Complement and coagulation casc...   47  2    9 4.14e-02 1.32e-08
path:mmu05166                   HTLV-I infection  245  5   17 2.71e-02 5.39e-08
path:mmu00100               Steroid biosynthesis   18  5    0 1.13e-07 1.00e+00
path:mmu04114                     Oocyte meiosis  101  2   11 1.53e-01 1.43e-07</styled-content>
      </preformat>
      <p>The output from
<monospace>topKEGG</monospace> is the same as from
<monospace>topGO</monospace> except that row names become KEGG pathway IDs,
<monospace>Term</monospace> becomes
<monospace>Pathway</monospace> and there is no
<monospace>Ont</monospace> column. Both the GO and KEGG analyses show that the cell cycle pathway is strongly down-regulated upon lactation in mammary stem cells.</p>
      <p>By default, the
<monospace>kegga</monospace> function automatically reads the latest KEGG annotation from the Internet each time it is run. The KEGG database uses Entrez Gene Ids, and the
<monospace>kegga</monospace> function assumes these are available as the row names of
<monospace>tr</monospace>.</p>
    </sec>
    <sec>
      <title>FRY gene set tests</title>
      <p>The GO and KEGG analyses shown above are relatively simple analyses that rely on a list of DE genes. The list of DE genes is overlapped with the various GO and KEGG annotation terms. The results will depend on the significance threshold that is used to assess differential expression.</p>
      <p>If the aim is to test for particular gene expression signatures or particular pathways, a more nuanced approach is to conduct a
<monospace>roast</monospace> or
<monospace>fry</monospace> gene set test
<sup><xref rid="ref-25" ref-type="bibr">25</xref></sup>. These functions test whether a set of genes is DE, assessing the whole set of genes as a whole. Gene set tests consider all the genes in the specified set and do not depend on any pre-emptive significance cutoff. The set of genes can be chosen to be representative of any pathway or phenotype of interest.</p>
      <p><monospace>roast</monospace> gives p-values using random rotations of the residual space. In the
<italic>edgeR</italic> context,
<monospace>fry</monospace> is generally recommended over
<monospace>roast.fry</monospace> gives an accurate analytic approximation to the results that
<monospace>roast</monospace> would give, with default settings, if an extremely large number of rotations was used.</p>
      <p>Here, suppose we are interested in three GO terms related to cytokinesis. Each GO term is used to define a set of genes annotated with that term. The names of these terms are shown below:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">library</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(GO.db)</styled-content>
        <styled-content style="font-size:15px;color:#585858;">&gt; cyt.go</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">c</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"GO:0032465"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"GO:0000281"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"GO:0000920"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)</styled-content>
        <styled-content style="font-size:15px;color:#585858;">&gt; term</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">select</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(GO.db,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">keys</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=cyt.go,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">columns</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"TERM"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)</styled-content>
        <styled-content style="font-size:15px;color:#585858;">&gt; term

        GOID                              TERM
1 GO:0032465         regulation of cytokinesis
2 GO:0000281               mitotic cytokinesis
3 GO:0000920 cell separation after cytokinesis</styled-content>
      </preformat>
      <p>The first step is to extract the genes associated with each GO term from the GO database. This produces a list of three components, one for each GO term. Each component is a vector of Entrez Gene IDs for that GO term:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">Rkeys</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(org.Mm.egGO2ALLEGS)</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#585858;">cyt.go</styled-content>
        <styled-content style="font-size:15px;color:#585858;">&gt; cyt.go.genes</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">as.list</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(org.Mm.egGO2ALLEGS)</styled-content>
      </preformat>
      <p>Suppose the comparison of interest is between the virgin and lactating groups in the basal population. We can use
<monospace>fry</monospace> to test whether the cytokinesis GO terms are DE for this comparison:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; B.VvsL</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">makeContrasts</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(B.virgin-B.lactating,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">levels</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=design)</styled-content>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">fry</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(y,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">index</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=cyt.go.genes,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">design</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=design,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">contrast</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=B.VvsL)</styled-content>
        <styled-content style="font-size:15px;color:#585858;">
           NGenes Direction   PValue     FDR PValue.Mixed FDR.Mixed
GO:0032465     48        Up 0.000464 0.00139     3.71e-06  7.02e-06
GO:0000920     16      Down 0.001902 0.00285     4.68e-06  7.02e-06
GO:0000281     30        Up 0.007277 0.00728     2.50e-05  2.50e-05</styled-content>
      </preformat>
      <p>Each row of the output corresponds to a gene set. The
<monospace>NGenes</monospace> column provides the number of genes in each set. The
<monospace>Direction</monospace> column indicates the net direction of change. The
<monospace>PValue</monospace> column gives the two-sided p-value for testing whether the set is DE as a whole, either up or down. The
<monospace>PValue.Mixed</monospace> column gives a p-value for testing whether genes in the set tend to be DE, without regard to direction. The
<monospace>PValue</monospace> column is appropriate when genes in the set are expected to be co-regulated, all or most changing expression in the same direction. The
<monospace>PValue.Mixed</monospace> column is appropriate when genes in the set are not necessarily co-regulated or may be regulated in different directions for the contrast in question. FDRs are calculated from the corresponding p-values across all sets.</p>
      <p>The results of a gene set test can be viewed in a barcode plot produced by the
<monospace>barcodeplot</monospace> function. Suppose visualization is performed for the gene set defined by the GO term GO:0032465:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; res</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">glmQLFTest</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(fit,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">contrast</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=B.VvsL)</styled-content>
        <styled-content style="font-size:15px;color:#585858;">&gt; index</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">rownames</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(fit)</styled-content>
        <styled-content style="font-size:15px;">%in%</styled-content>
        <styled-content style="font-size:15px;color:#585858;">cyt.go.genes[[</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
        <styled-content style="font-size:15px;color:#585858;">]]
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">barcodeplot</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(res</styled-content>
        <styled-content style="font-size:15px;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">table</styled-content>
        <styled-content style="font-size:15px;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">logFC,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">index</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=index,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">labels</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">c</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"B.virgin"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"B.lactating"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">),
+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">main</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=cyt.go[</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
        <styled-content style="font-size:15px;color:#585858;">])</styled-content>
      </preformat>
      <p>(see
<xref ref-type="fig" rid="f9">Figure 9</xref>). In the plot, all genes are ranked from left to right by decreasing log-fold change for the contrast and the genes within the gene set are represented by vertical bars, forming the barcode-like pattern. The curve (or
<italic>worm</italic>) above the barcode shows the relative local enrichment of the bars in each part of the plot. The dotted horizontal line indicates neutral enrichment; the worm above the dotted line shows enrichment while the worm below the dotted line shows depletion. In this particular barcode plot the worm shows enrichment on the left for positive logFCs, and depletion on the right for negative logFCs. The conclusion is that genes associated with this GO term tend to be up-regulated in the basal cells of virgin mice compared to lactating mice, confirming the result of the
<monospace>fry</monospace> test above.</p>
      <fig fig-type="figure" id="f9" orientation="portrait" position="float">
        <label>Figure 9. </label>
        <caption>
          <title>Barcode plot showing enrichment of the GO term GO:0032465 in the basal virgin group compared to the basal lactating group.</title>
          <p>X-axis shows logFC for B.virgin vs B.lactating. Black bars represent genes annotated with the GO term. The worm shows relative enrichment.</p>
        </caption>
        <graphic xlink:href="f1000research-5-9996-g0008"/>
      </fig>
    </sec>
    <sec>
      <title>Camera gene set enrichment analysis</title>
      <p>Finally we demonstrate a gene set enrichment style analysis using the Molecular Signatures Database (MSigDB)
<sup><xref rid="ref-26" ref-type="bibr">26</xref></sup>. We will use the C2 collection of the MSigDB, which is a collection of nearly 5000 curated gene sets, each representing the molecular signature of a particular biological process or phenotype. The MSigDB itself is purely human, but the Walter and Eliza Hall Institute (WEHI) maintains a mouse version of the database. We load the mouse version of the C2 collection from the WEHI website:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">load</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">url</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"
                        <ext-link ext-link-type="uri" xlink:href="http://bioinf.wehi.edu.au/software/MSigDB/mouse_c2_v5p1.rdata">http://bioinf.wehi.edu.au/software/MSigDB/mouse_c2_v5p1.rdata</ext-link>"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">))</styled-content>
      </preformat>
      <p>This will load
<monospace>Mm.c2</monospace>, which is a list of gene sets, each a vector of Entrez Ids. This can be converted to a list of index numbers:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; idx</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">ids2indices</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(Mm.c2,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">id</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">rownames</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(y))</styled-content>
      </preformat>
      <p>First we compare virgin stem cells to virgin luminal cells:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; BvsL.v</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">makeContrasts</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(B.virgin - L.virgin,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">levels</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=design)</styled-content>
        <styled-content style="font-size:15px;color:#585858;">&gt; cam</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">camera</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(y, idx, design,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">contrast</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=BvsL.v,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">inter.gene.cor</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">0.01</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)</styled-content>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">options</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">digits</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">2</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)</styled-content>
        <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">head</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(cam,</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">14</styled-content>
        <styled-content style="font-size:15px;color:#585858;">)
                                                    NGenes Direction  PValue
LIM_MAMMARY_STEM_CELL_UP                               782        Up 2.0e-43
LIM_MAMMARY_LUMINAL_MATURE_DN                          169        Up 3.7e-25
SASAI_RESISTANCE_TO_NEOPLASTIC_TRANSFROMATION           80        Up 4.1e-20
LIM_MAMMARY_STEM_CELL_DN                               664      Down 2.2e-19
FARMER_BREAST_CANCER_CLUSTER_4                          74        Up 2.9e-19
NABA_BASEMENT_MEMBRANES                                 52        Up 1.6e-17
HAEGERSTRAND_RESPONSE_TO_IMATINIB                       35        Up 4.0e-17
ROZANOV_MMP14_TARGETS_SUBSET                            83        Up 5.2e-16
REACTOME_COLLAGEN_FORMATION                             70        Up 1.3e-15
REACTOME_NCAM1_INTERACTIONS                             71        Up 2.2e-15
OXFORD_RALB_TARGETS_UP                                  27        Up 4.5e-15
ANASTASSIOU_CANCER_MESENCHYMAL_TRANSITION_SIGNATURE    148        Up 7.1e-15
PAPASPYRIDONOS_UNSTABLE_ATEROSCLEROTIC_PLAQUE_DN        68        Up 1.3e-14
LIM_MAMMARY_LUMINAL_PROGENITOR_UP                       92      Down 2.0e-14
                                                        FDR
LIM_MAMMARY_STEM_CELL_UP                            9.3e-40
LIM_MAMMARY_LUMINAL_MATURE_DN                       8.9e-22
SASAI_RESISTANCE_TO_NEOPLASTIC_TRANSFROMATION       6.4e-17
LIM_MAMMARY_STEM_CELL_DN                            2.7e-16
FARMER_BREAST_CANCER_CLUSTER_4                      2.8e-16
NABA_BASEMENT_MEMBRANES                             1.2e-14
HAEGERSTRAND_RESPONSE_TO_IMATINIB                   2.7e-14
ROZANOV_MMP14_TARGETS_SUBSET                        3.0e-13
REACTOME_COLLAGEN_FORMATION                         6.8e-13
REACTOME_NCAM1_INTERACTIONS                         1.0e-12
OXFORD_RALB_TARGETS_UP                              1.9e-12
ANASTASSIOU_CANCER_MESENCHYMAL_TRANSITION_SIGNATURE 2.8e-12
PAPASPYRIDONOS_UNSTABLE_ATEROSCLEROTIC_PLAQUE_DN    4.9e-12
LIM_MAMMARY_LUMINAL_PROGENITOR_UP                   6.8e-12</styled-content>
      </preformat>
      <p>With a large gene set collection, setting
<monospace>inter.gene.cor = 0.01</monospace> gives a good compromise between biological interpretability and FDR control. As expected, the mammary stem cell and mammary luminal cell signatures from Lim
<italic>et al.</italic>
<sup><xref rid="ref-27" ref-type="bibr">27</xref></sup> are top-ranked, and in the expected directions.</p>
      <p>We can visualize the top signature, combining the up and down mammary stem cell signatures to make a bi-directional signature set:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; res</styled-content>
        <styled-content style="font-size:15px;color:#B05A65;">&lt;-</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">glmQLFTest</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(fit,</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">contrast</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=BvsL.v)
&gt;</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">barcodeplot</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(res</styled-content>
        <styled-content style="font-size:15px;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">table</styled-content>
        <styled-content style="font-size:15px;">$</styled-content>
        <styled-content style="font-size:15px;color:#585858;">logFC,
+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">index</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=idx[[</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"LIM_MAMMARY_STEM_CELL_UP"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">]],
+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">index2</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=idx[[</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"LIM_MAMMARY_STEM_CELL_DN"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">]],
+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">labels</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#BC5A65;">c</styled-content>
        <styled-content style="font-size:15px;color:#585858;">(</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"B.virgin"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"L.virgin"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">),
+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">main</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#317ECC;">"LIM_MAMMARY_STEM_CELL"</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,
+</styled-content>
        <styled-content style="font-size:15px;color:#55AA55;">alpha</styled-content>
        <styled-content style="font-size:15px;color:#585858;">=</styled-content>
        <styled-content style="font-size:15px;color:#AF0F91;">1</styled-content>
        <styled-content style="font-size:15px;color:#585858;">,)</styled-content>
      </preformat>
      <p>(see
<xref ref-type="fig" rid="f10">Figure 10</xref>).</p>
      <fig fig-type="figure" id="f10" orientation="portrait" position="float">
        <label>Figure 10. </label>
        <caption>
          <title>Barcode plot showing strong enrichment of mammary stem cell signature in the stem cell vs luminal cell comparison.</title>
          <p>Red bars show up signature genes, blue bars show down genes. The worms
show relative enrichment.</p>
        </caption>
        <graphic xlink:href="f1000research-5-9996-g0009"/>
      </fig>
    </sec>
  </sec>
  <sec>
    <title>Packages used</title>
    <p>This workflow depends on various packages from version 3.3 of the Bioconductor project, running on R version 3.3.0 or higher. The complete list of the packages used for this workflow are shown below:</p>
    <preformat>
      <styled-content style="font-size:15px;color:#585858;">&gt;</styled-content>
      <styled-content style="font-size:15px;color:#BC5A65;">sessionInfo</styled-content>
      <styled-content style="font-size:15px;color:#585858;">()

R version 3.3.1 (2016-06-21)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

locale:
[1] LC_COLLATE=English_Australia.1252    LC_CTYPE=English_Australia.1252
[3] LC_MONETARY=English_Australia.1252   LC_NUMERIC=C
[5] LC_TIME=English_Australia.1252

attached base packages:
[1] parallel  stats4   stats   graphics  grDevices  utils    datasets  methods
[9] base

other attached packages:
 [1] GO.db_3.3.0          gplots_3.0.1        org.Mm.eg.db_3.3.0
 [4] AnnotationDbi_1.34.3 IRanges_2.6.0       S4Vectors_0.10.2
 [7] Biobase_2.32.0       BiocGenerics_0.18.0 edgeR_3.14.0
[10] limma_3.28.6         BiocStyle_2.0.2     knitr_1.13

loaded via a namespace (and not attached):
 [1] magrittr_1.5       splines_3.3.1      statmod_1.4.24   lattice_0.20-33
 [5] stringr_1.0.0      highr_0.6          caTools_1.17.1   tools_3.3.1
 [9] grid_3.3.1         KernSmooth_2.23-15 DBI_0.4-1        gtools_3.5.0
[13] formatR_1.4        bitops_1.0-6       evaluate_0.9     RSQLite_1.0.0
[17] gdata_2.17.0       stringi_1.1.1      locfit_1.5-9.1</styled-content>
    </preformat>
  </sec>
  <sec>
    <title>Read alignment and quantification</title>
    <sec>
      <title>Download raw sequence files from the SRA</title>
      <p>We now revisit the question of recreating the matrix of read counts from the raw sequence reads. Unlike the above workflow, which works for any version of R, read alignment requires Unix or Mac OS and, in practice, a high performance Unix server is recommended. Read alignment and read counting require only one Bioconductor package,
<italic>Rsubread</italic>. However the
<monospace>fastq-dump</monospace> utility from the SRA Toolkit is also required to convert from SRA to FASTQ format. This can be downloaded from the NCBI website (
<monospace><ext-link ext-link-type="uri" xlink:href="http://www.ncbi.nlm.nih.gov/Traces/sra/?view=software">http://www.ncbi.nlm.nih.gov/Traces/sra/?view=software</ext-link></monospace>) and installed on any Unix system.</p>
      <p>The first task is to download the raw sequence files, which are stored in SRA format on the SRA repository. The SRA files need to be unpacked into FASTQ format using the
<monospace>fastq-dump</monospace> utility. The following R code makes a system call to
<monospace>fastq-dump</monospace> to download each SRA file and convert it to FASTQ format:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; for (sra in targets$SRA) system(paste("fastq-dump", sra))</styled-content>
      </preformat>
      <p>The fastq-dump utility automatically downloads the specified SRA data set from the internet. The above code will produce 12 FASTQ files, in the current working directory, with file names given by the following vector:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; all.fastq &lt;- paste0(targets$SRA, ".fastq")</styled-content>
      </preformat>
    </sec>
    <sec>
      <title>Accuracy of base-calling</title>
      <p>Sequencers typically store base-calling quality scores for each read in the FASTQ files.
<italic>Rsubread</italic>’s
<monospace>qualityScores</monospace> function can be used to extract these scores from any particular file:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; QS &lt;- qualityScores("SRR1552444.fastq")</styled-content>
      </preformat>
      <p>The boxplot function provides a compact way to view the quality scores by position across all reads:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">
&gt; boxplot(QS, ylab="Quality score", xlab="Base position",
+         main="SRR1552444.fastq", cex=0.25, col="orange")
</styled-content>
      </preformat>
      <p>(see
<xref ref-type="fig" rid="f11">Figure 11</xref>). The vertical axis shows the Phred quality score, equal to
<italic>−</italic>10 log
<sub>10</sub> (
<italic>p</italic>) where
<italic>p</italic> is the probability of an erroneous call. The maximum possible value is 40, and all values above 10 correspond to extremely small error probabilities. The horizontal axis shows position within a read. The file contains 100bp single-end reads, so the scale is from 1 to 100. The plot displays a compact boxplot at each base position. As is very commonly observed, the quality scores are best in the middle of the reads and decrease slightly towards the start and end of the reads. However the quality remains generally good even near the ends of the reads: the scores would need to be very much lower than this before they would cause problems for the alignment. Similar plots can be made for each of the FASTQ files.</p>
      <fig fig-type="figure" id="f11" orientation="portrait" position="float">
        <label>Figure 11. </label>
        <caption>
          <title>Boxplots of quality scores by base position for the first FASTQ file.</title>
        </caption>
        <graphic xlink:href="f1000research-5-9996-g0010"/>
      </fig>
    </sec>
    <sec>
      <title>Build a genome index</title>
      <p>Before the sequence reads can be aligned, we need to build an index for the GRCm38/mm10 (Dec 2011) build of the mouse genome. Most laboratories that use
<italic>Rsubread</italic> regularly will already have an index file prepared, as this is a once-off operation for each genome release. If you are using
<italic>Rsubread</italic> for mouse for the first time, then the latest mouse genome build can be downloaded from the NCBI location
<ext-link ext-link-type="ftp" xlink:href="ftp://ftp.ncbi.nlm.nih.gov/genomes/all/GCA_000001635.6_GRCm38.p4/GCA_000001635.6_GRCm38.p4_genomic.fna.gz">ftp://ftp.ncbi.nlm.nih.gov/genomes/all/GCA_000001635.6_GRCm38.p4/GCA_000001635.6_GRCm38.p4_genomic.fna.gz</ext-link>. (Note that this link is for patch 4 of mm10, which is valid at the time of writing in May 2016. The link will change as new patches are released periodically.) An index can then be built by:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; library(Rsubread)
&gt; buildindex(basename = "mm10",
+            reference = "GCA_000001635.6_GRCm38.p4_genomic.fna.gz")</styled-content>
      </preformat>
    </sec>
    <sec>
      <title>Aligning reads</title>
      <p>The sequence reads can now be aligned to the mouse genome using the
<monospace>align</monospace> function:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; all.bam &lt;- sub(".fastq", ".bam", all.fastq)
&gt; align(index="mm10", readfile1=all.fastq, input_format="FASTQ",
+       output_file=all.bam)</styled-content>
      </preformat>
      <p>This produces a set of BAM files containing the read alignments for each RNA library. The mapping proportions can be summarized by the
<monospace>propmapped</monospace> function:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; propmapped(all.bam)
          Samples NumTotal NumMapped PropMapped
1  SRR1552450.bam 30109290  26577308      0.883
2  SRR1552451.bam 28322351  24794251      0.875
3  SRR1552452.bam 31688348  27937620      0.882
4  SRR1552453.bam 29614284  26074034      0.880
5  SRR1552454.bam 27225012  24381742      0.896
6  SRR1552455.bam 25433157  22813815      0.897
7  SRR1552444.bam 27919481  23927833      0.857
8  SRR1552445.bam 29731031  25487822      0.857
9  SRR1552446.bam 29879070  25500318      0.853
10 SRR1552447.bam 29245388  25187577      0.861
11 SRR1552448.bam 31425424  27326500      0.870
12 SRR1552449.bam 31276061  27204156      0.870</styled-content>
      </preformat>
      <p>Ideally, the proportion of mapped reads should be above 80%. By default, only reads with unique mapping locations are reported by
<italic>Rsubread</italic> as being successfully mapped. Restricting to uniquely mapped reads is recommended, as it avoids spurious signal from non-uniquely mapped reads derived from, e.g., repeat regions.</p>
    </sec>
    <sec>
      <title>Quantifying read counts for each gene</title>
      <p>The read counts for each gene can be quantified using the
<monospace>featureCounts</monospace> function in
<italic>Rsubread</italic>. Conveniently, the
<italic>Rsubread</italic> package includes inbuilt NCBI RefSeq annotation of the mouse and human genomes.
<monospace>featureCounts</monospace> generates a matrix of read counts for each gene in each sample:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; fc &lt;- featureCounts(all.bam, annot.inbuilt="mm10")</styled-content>
      </preformat>
      <p>The output is a simple list, containing the matrix of counts (
<monospace>counts</monospace>), a data frame of gene characteristics (
<monospace>annotation</monospace>), a vector of file names (
<monospace>targets</monospace>) and summary mapping statistics (
<monospace>stat</monospace>):</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; names(fc)
[1] "counts"		"annotation"	"targets"  "stat"</styled-content>
      </preformat>
      <p>The row names of
<monospace>fc$counts</monospace> are the Entrez gene identifiers for each gene. The column names are the output file names from
<monospace>align</monospace>, which we simplify here for brevity:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; colnames(fc$counts) &lt;- rownames(targets)</styled-content>
      </preformat>
      <p>The first six rows of the counts matrix are shown below.</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; head(fc$counts)
          MCL1.DG MCL1.DH MCL1.DI MCL1.DJ MCL1.DK MCL1.DL MCL1.LA MCL1.LB MCL1.LC
497097        438     299      65     237     354     287       0       0       0
100503874       1       0       1       1       0       4       0       0       0
100038431       0       0       0       0       0       0       0       0       0
100038431       0       0       0       0       0       0       0       0       0
19888           1       1       0       0       0       0      10       3      10
20671         106     181      82     104      43      83      16      25      18
27395         309     232     339     290     291     270     558     468     488
          MCL1.LD MCL1.LE MCL1.LF
497097          0       0       0
100503874       0       0       0
100038431       0       0       0
19888           2       0       0
20671           8       3      10
27395         332     312     344</styled-content>
      </preformat>
      <p>Finally, a
<monospace>DGEList</monospace> object can be assembled by:</p>
      <preformat>
        <styled-content style="font-size:15px;color:#585858;">&gt; y &lt;- DGEList(fc$counts, group=group)
&gt; y$genes &lt;- fc$annotation[, "Length", drop=FALSE]</styled-content>
      </preformat>
    </sec>
  </sec>
  <sec>
    <title>Data and software availability</title>
    <p>Except for the targets file
<monospace>targets.txt</monospace>, all data analyzed in the workflow is read automatically from public websites as part of the code. All software used is publicly available as part of Bioconductor 3.3, except for the
<monospace>fastq-dump</monospace> utility, which can be downloaded from NCBI website as described in the text. The article includes the complete code necessary to reproduce the analyses shown.</p>
    <p>The LaTeX version of this article was generated automatically by running
<monospace>knitr::knit</monospace> on an Rnw file of R commands. It is planned to make the code and data available as an executable Bioconductor workflow at
<ext-link ext-link-type="uri" xlink:href="http://www.bioconductor.org/help/workflows">http://www.bioconductor.org/help/workflows</ext-link>. In the meantime, the files are available from
<ext-link ext-link-type="uri" xlink:href="http://bioinf.wehi.edu.au/edgeR/F1000Research2016/">http://bioinf.wehi.edu.au/edgeR/F1000Research2016/</ext-link>.</p>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>The authors thank Wei Shi and Yang Liao for advice with
<italic>Rsubread</italic> and Yifang Hu for creating the mouse version of the MSigDB. We also wish to acknowledge the early developers of the quasi-likelihood testing approach. Davis McCarthy authored the first versions of the quasi-likelihood functions in
<italic>edgeR</italic> in February 2011 and Steve Lund and Dan Nettleton worked independently on
<italic>QuasiSeq</italic> around the same time. We thank Steve Lund and Dan Nettleton for a valuable and enjoyable collaboration that lead to Lund
<italic>et al.</italic>
<sup><xref rid="ref-7" ref-type="bibr">7</xref></sup>.</p>
  </ack>
  <ref-list>
    <ref id="ref-1">
      <label>1</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huber</surname><given-names>W</given-names></name><name><surname>Carey</surname><given-names>VJ</given-names></name><name><surname>Gentleman</surname><given-names>R</given-names></name><etal/></person-group>:
<article-title>Orchestrating high-throughput genomic analysis with Bioconductor.</article-title><source><italic>Nat Methods.</italic></source><year>2015</year>;<volume>12</volume>(<issue>2</issue>):<fpage>115</fpage>–<lpage>121</lpage>.
<pub-id pub-id-type="doi">10.1038/nmeth.3252</pub-id><!--<pub-id pub-id-type="pmcid">4509590</pub-id>--><?supplied-pmid 25633503?><pub-id pub-id-type="pmid">25633503</pub-id></mixed-citation>
    </ref>
    <ref id="ref-2">
      <label>2</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fu</surname><given-names>NY</given-names></name><name><surname>Rios</surname><given-names>AC</given-names></name><name><surname>Pal</surname><given-names>B</given-names></name><etal/></person-group>:
<article-title>EGF-mediated induction of Mcl-1 at the switch to lactation is essential for alveolar cell survival.</article-title><source><italic>Nat Cell Biol.</italic></source><year>2015</year>;<volume>17</volume>(<issue>4</issue>):<fpage>365</fpage>–<lpage>375</lpage>.
<pub-id pub-id-type="doi">10.1038/ncb3117</pub-id><?supplied-pmid 25730472?><pub-id pub-id-type="pmid">25730472</pub-id></mixed-citation>
    </ref>
    <ref id="ref-3">
      <label>3</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liao</surname><given-names>Y</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name><name><surname>Shi</surname><given-names>W</given-names></name></person-group>:
<article-title>The Subread aligner: fast, accurate and scalable read mapping by seed-and-vote.</article-title><source><italic>Nucleic Acids Res.</italic></source><year>2013</year>;<volume>41</volume>(<issue>10</issue>):<fpage>e108</fpage>.
<pub-id pub-id-type="doi">10.1093/nar/gkt214</pub-id><!--<pub-id pub-id-type="pmcid">3664803</pub-id>--><?supplied-pmid 23558742?><pub-id pub-id-type="pmid">23558742</pub-id></mixed-citation>
    </ref>
    <ref id="ref-4">
      <label>4</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robinson</surname><given-names>MD</given-names></name><name><surname>McCarthy</surname><given-names>DJ</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group>:
<article-title>edgeR: a Bioconductor package for differential expression analysis of digital gene expression data.</article-title><source><italic>Bioinformatics.</italic></source><year>2010</year>;<volume>26</volume>(<issue>1</issue>):<fpage>139</fpage>–<lpage>140</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btp616</pub-id><!--<pub-id pub-id-type="pmcid">2796818</pub-id>--><?supplied-pmid 19910308?><pub-id pub-id-type="pmid">19910308</pub-id></mixed-citation>
    </ref>
    <ref id="ref-5">
      <label>5</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liao</surname><given-names>Y</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name><name><surname>Shi</surname><given-names>W</given-names></name></person-group>:
<article-title>featureCounts: an efficient general purpose program for assigning sequence reads to genomic features.</article-title><source><italic>Bioinformatics.</italic></source><year>2014</year>;<volume>30</volume>(<issue>7</issue>):<fpage>923</fpage>–<lpage>930</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btt656</pub-id><?supplied-pmid 24227677?><pub-id pub-id-type="pmid">24227677</pub-id></mixed-citation>
    </ref>
    <ref id="ref-6">
      <label>6</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McCarthy</surname><given-names>DJ</given-names></name><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group>:
<article-title>Differential expression analysis of multifactor RNA-Seq experiments with respect to biological variation.</article-title><source><italic>Nucleic Acids Res.</italic></source><year>2012</year>;<volume>40</volume>(<issue>10</issue>):<fpage>4288</fpage>–<lpage>4297</lpage>.
<pub-id pub-id-type="doi">10.1093/nar/gks042</pub-id><!--<pub-id pub-id-type="pmcid">3378882</pub-id>--><?supplied-pmid 22287627?><pub-id pub-id-type="pmid">22287627</pub-id></mixed-citation>
    </ref>
    <ref id="ref-7">
      <label>7</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lund</surname><given-names>SP</given-names></name><name><surname>Nettleton</surname><given-names>D</given-names></name><name><surname>McCarthy</surname><given-names>DJ</given-names></name><etal/></person-group>:
<article-title>Detecting differential expression in RNA-sequence data using quasi-likelihood with shrunken dispersion estimates.</article-title><source><italic>Stat Appl Genet Mol Biol.</italic></source><year>2012</year>;<volume>11</volume>(<issue>5</issue>): Article 8, pii: /j/sagmb.2012.11.issue-5/1544-6115.1826/1544-6115.1826.xml.
<pub-id pub-id-type="doi">10.1515/1544-6115.1826</pub-id><?supplied-pmid 23104842?><pub-id pub-id-type="pmid">23104842</pub-id></mixed-citation>
    </ref>
    <ref id="ref-8">
      <label>8</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robinson</surname><given-names>MD</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group>:
<article-title>Small-sample estimation of negative binomial dispersion, with applications to SAGE data.</article-title><source><italic>Biostatistics.</italic></source><year>2008</year>;<volume>9</volume>(<issue>2</issue>):<fpage>321</fpage>–<lpage>332</lpage>.
<pub-id pub-id-type="doi">10.1093/biostatistics/kxm030</pub-id><?supplied-pmid 17728317?><pub-id pub-id-type="pmid">17728317</pub-id></mixed-citation>
    </ref>
    <ref id="ref-9">
      <label>9</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robinson</surname><given-names>MD</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group>:
<article-title>Moderated statistical tests for assessing differences in tag abundance.</article-title><source><italic>Bioinformatics.</italic></source><year>2007</year>;<volume>23</volume>(<issue>21</issue>):<fpage>2881</fpage>–<lpage>2887</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btm453</pub-id><?supplied-pmid 17881408?><pub-id pub-id-type="pmid">17881408</pub-id></mixed-citation>
    </ref>
    <ref id="ref-10">
      <label>10</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Love</surname><given-names>MI</given-names></name><name><surname>Huber</surname><given-names>W</given-names></name><name><surname>Anders</surname><given-names>S</given-names></name></person-group>:
<article-title>Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2.</article-title><source><italic>Genome Biol.</italic></source><year>2014</year>;<volume>15</volume>(<issue>12</issue>):<fpage>550</fpage>.
<pub-id pub-id-type="doi">10.1186/s13059-014-0550-8</pub-id><!--<pub-id pub-id-type="pmcid">4302049</pub-id>--><?supplied-pmid 25516281?><pub-id pub-id-type="pmid">25516281</pub-id></mixed-citation>
    </ref>
    <ref id="ref-11">
      <label>11</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Burden</surname><given-names>CJ</given-names></name><name><surname>Qureshi</surname><given-names>SE</given-names></name><name><surname>Wilson</surname><given-names>SR</given-names></name></person-group>:
<article-title>Error estimates for the analysis of differential expression from RNA-seq count data.</article-title><source><italic> PeerJ.</italic></source><year>2014</year>;<volume>2</volume>:<fpage>e576</fpage>.
<pub-id pub-id-type="doi">10.7717/peerj.576</pub-id><!--<pub-id pub-id-type="pmcid">4179614</pub-id>--><?supplied-pmid 25337456?><pub-id pub-id-type="pmid">25337456</pub-id></mixed-citation>
    </ref>
    <ref id="ref-12">
      <label>12</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lun</surname><given-names>AT</given-names></name><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group>:
<article-title>It’s DE-licious: A Recipe for Differential Expression Analyses of RNA-seq Experiments Using Quasi-Likelihood Methods in edgeR.</article-title><source><italic>Methods Mol Biol.</italic></source><year>2016</year>;<volume>1418</volume>:<fpage>391</fpage>–<lpage>416</lpage>.
<pub-id pub-id-type="doi">10.1007/978-1-4939-3578-9_19</pub-id><?supplied-pmid 27008025?><pub-id pub-id-type="pmid">27008025</pub-id></mixed-citation>
    </ref>
    <ref id="ref-13">
      <label>13</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Law</surname><given-names>CW</given-names></name><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Shi</surname><given-names>W</given-names></name><etal/></person-group>:
<article-title>voom: Precision weights unlock linear model analysis tools for RNA-seq read counts.</article-title><source><italic>Genome Biol.</italic></source><year>2014</year>;<volume>15</volume>(<issue>2</issue>):<fpage>R29</fpage>.
<pub-id pub-id-type="doi">10.1186/gb-2014-15-2-r29</pub-id><!--<pub-id pub-id-type="pmcid">4053721</pub-id>--><?supplied-pmid 24485249?><pub-id pub-id-type="pmid">24485249</pub-id></mixed-citation>
    </ref>
    <ref id="ref-14">
      <label>14</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ritchie</surname><given-names>ME</given-names></name><name><surname>Phipson</surname><given-names>B</given-names></name><name><surname>Wu</surname><given-names>D</given-names></name><etal/></person-group>:
<article-title><italic>limma</italic> powers differential expression analyses for RNA-sequencing and microarray studies.</article-title><source><italic>Nucleic Acids Res.</italic></source><year>2015</year>;<volume>43</volume>(<issue>7</issue>):<fpage>e47</fpage>.
<pub-id pub-id-type="doi">10.1093/nar/gkv007</pub-id><!--<pub-id pub-id-type="pmcid">4402510</pub-id>--><?supplied-pmid 25605792?><pub-id pub-id-type="pmid">25605792</pub-id></mixed-citation>
    </ref>
    <ref id="ref-15">
      <label>15</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lun</surname><given-names>AT</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group>:
<article-title><italic>De novo</italic> detection of differentially bound regions for ChIP-seq data using peaks and windows: controlling error rates correctly.</article-title><source><italic>Nucleic Acids Res.</italic></source><year>2014</year>;<volume>42</volume>(<issue>11</issue>):<fpage>e95</fpage>.
<pub-id pub-id-type="doi">10.1093/nar/gku351</pub-id><!--<pub-id pub-id-type="pmcid">4066778</pub-id>--><?supplied-pmid 24852250?><pub-id pub-id-type="pmid">24852250</pub-id></mixed-citation>
    </ref>
    <ref id="ref-16">
      <label>16</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lun</surname><given-names>AT</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group>:
<article-title>diffHic: a Bioconductor package to detect differential genomic interactions in Hi-C data.</article-title><source><italic>BMC Bioinformatics.</italic></source><year>2015</year>;<volume>16</volume>:<fpage>258</fpage>.
<pub-id pub-id-type="doi">10.1186/s12859-015-0683-0</pub-id><!--<pub-id pub-id-type="pmcid">4539688</pub-id>--><?supplied-pmid 26283514?><pub-id pub-id-type="pmid">26283514</pub-id></mixed-citation>
    </ref>
    <ref id="ref-17">
      <label>17</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robinson</surname><given-names>MD</given-names></name><name><surname>Oshlack</surname><given-names>A</given-names></name></person-group>:
<article-title>A scaling normalization method for differential expression analysis of RNA-seq data.</article-title><source><italic>Genome Biol.</italic></source><year>2010</year>;<volume>11</volume>(<issue>3</issue>):<fpage>R25</fpage>.
<pub-id pub-id-type="doi">10.1186/gb-2010-11-3-r25</pub-id><!--<pub-id pub-id-type="pmcid">2864565</pub-id>--><?supplied-pmid 20196867?><pub-id pub-id-type="pmid">20196867</pub-id></mixed-citation>
    </ref>
    <ref id="ref-18">
      <label>18</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lun</surname><given-names>AT</given-names></name><name><surname>Bach</surname><given-names>K</given-names></name><name><surname>Marioni</surname><given-names>JC</given-names></name></person-group>:
<article-title>Pooling across cells to normalize single-cell RNA sequencing data with many zero counts.</article-title><source><italic>Genome Biol.</italic></source><year>2016</year>;<volume>17</volume>:<fpage>75</fpage>.
<pub-id pub-id-type="doi">10.1186/s13059-016-0947-7</pub-id><!--<pub-id pub-id-type="pmcid">4848819</pub-id>--><?supplied-pmid 27122128?><pub-id pub-id-type="pmid">27122128</pub-id></mixed-citation>
    </ref>
    <ref id="ref-19">
      <label>19</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wu</surname><given-names>D</given-names></name><name><surname>Hu</surname><given-names>Y</given-names></name><name><surname>Tong</surname><given-names>S</given-names></name><etal/></person-group>:
<article-title>The use of miRNA microarrays for the analysis of cancer samples with global miRNA decrease.</article-title><source><italic>RNA.</italic></source><year>2013</year>;<volume>19</volume>(<issue>7</issue>):<fpage>876</fpage>–<lpage>888</lpage>.
<pub-id pub-id-type="doi">10.1261/rna.035055.112</pub-id><!--<pub-id pub-id-type="pmcid">3683922</pub-id>--><?supplied-pmid 23709276?><pub-id pub-id-type="pmid">23709276</pub-id></mixed-citation>
    </ref>
    <ref id="ref-20">
      <label>20</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Risso</surname><given-names>D</given-names></name><name><surname>Ngai</surname><given-names>J</given-names></name><name><surname>Speed</surname><given-names>TP</given-names></name><etal/></person-group>:
<article-title>Normalization of RNA-seq data using factor analysis of control genes or samples.</article-title><source><italic>Nat Biotechnol.</italic></source><year>2014</year>;<volume>32</volume>(<issue>9</issue>):<fpage>896</fpage>–<lpage>902</lpage>.
<pub-id pub-id-type="doi">10.1038/nbt.2931</pub-id><!--<pub-id pub-id-type="pmcid">4404308</pub-id>--><?supplied-pmid 25150836?><pub-id pub-id-type="pmid">25150836</pub-id></mixed-citation>
    </ref>
    <ref id="ref-21">
      <label>21</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Phipson</surname><given-names>B</given-names></name><name><surname>Lee</surname><given-names>S</given-names></name><name><surname>Majewski</surname><given-names>IJ</given-names></name><etal/></person-group>:
<article-title>Robust hyperparameter estimation protects against hypervariable genes and improves power to detect differential expression.</article-title><source><italic>Ann Appl Stat.</italic></source><year>2016</year>;<volume>10</volume><ext-link ext-link-type="uri" xlink:href="https://arxiv.org/pdf/1602.08678.pdf">Reference Source</ext-link></mixed-citation>
    </ref>
    <ref id="ref-22">
      <label>22</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group>:
<article-title>Linear models and empirical Bayes methods for assessing differential expression in microarray experiments.</article-title><source><italic>Stat Appl Genet Mol Biol.</italic></source><year>2004</year>;<volume>3</volume>(<issue>1</issue>): Article 3.
<pub-id pub-id-type="doi">10.2202/1544-6115.1027</pub-id><?supplied-pmid 16646809?><pub-id pub-id-type="pmid">16646809</pub-id></mixed-citation>
    </ref>
    <ref id="ref-23">
      <label>23</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McCarthy</surname><given-names>DJ</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group>:
<article-title>Testing significance relative to a fold-change threshold is a TREAT.</article-title><source><italic>Bioinformatics.</italic></source><year>2009</year>;<volume>25</volume>(<issue>6</issue>):<fpage>765</fpage>–<lpage>771</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btp053</pub-id><!--<pub-id pub-id-type="pmcid">2654802</pub-id>--><?supplied-pmid 19176553?><pub-id pub-id-type="pmid">19176553</pub-id></mixed-citation>
    </ref>
    <ref id="ref-24">
      <label>24</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>McCullagh</surname><given-names>P</given-names></name><name><surname>Nelder</surname><given-names>JA</given-names></name></person-group>:
<article-title>Generalized Linear Models</article-title>.
Chapman &amp; Hall/CRC, Boca Raton, Florida, 2nd edition,<year>1989</year>
<ext-link ext-link-type="uri" xlink:href="https://books.google.co.uk/books?id=h9kFH2_FfBkC&amp;printsec=frontcover">Reference Source</ext-link>
</mixed-citation>
    </ref>
    <ref id="ref-25">
      <label>25</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wu</surname><given-names>D</given-names></name><name><surname>Lim</surname><given-names>E</given-names></name><name><surname>Vaillant</surname><given-names>F</given-names></name><etal/></person-group>:
<article-title>ROAST: rotation gene set tests for complex microarray experiments.</article-title><source><italic>Bioinformatics.</italic></source><year>2010</year>;<volume>26</volume>(<issue>17</issue>):<fpage>2176</fpage>–<lpage>2182</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btq401</pub-id><!--<pub-id pub-id-type="pmcid">2922896</pub-id>--><?supplied-pmid 20610611?><pub-id pub-id-type="pmid">20610611</pub-id></mixed-citation>
    </ref>
    <ref id="ref-26">
      <label>26</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Subramanian</surname><given-names>A</given-names></name><name><surname>Tamayo</surname><given-names>P</given-names></name><name><surname>Mootha</surname><given-names>VK</given-names></name><etal/></person-group>:
<article-title>Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles.</article-title><source><italic>Proc Natl Acad Sci U S A.</italic></source><year>2005</year>;<volume>102</volume>(<issue>43</issue>):<fpage>15545</fpage>–<lpage>15550</lpage>.
<pub-id pub-id-type="doi">10.1073/pnas.0506580102</pub-id><!--<pub-id pub-id-type="pmcid">1239896</pub-id>--><?supplied-pmid 16199517?><pub-id pub-id-type="pmid">16199517</pub-id></mixed-citation>
    </ref>
    <ref id="ref-27">
      <label>27</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lim</surname><given-names>E</given-names></name><name><surname>Wu</surname><given-names>D</given-names></name><name><surname>Pal</surname><given-names>B</given-names></name><etal/></person-group>:
<article-title>Transcriptome analyses of mouse and human mammary cell subpopulations reveal multiple conserved genes and pathways.</article-title><source><italic>Breast Cancer Res.</italic></source><year>2010</year>;<volume>12</volume>:<fpage>R21</fpage>.
<pub-id pub-id-type="doi">10.1186/bcr2560</pub-id><!--<pub-id pub-id-type="pmcid">2879567</pub-id>--><?supplied-pmid 20346151?><pub-id pub-id-type="pmid">20346151</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<sub-article id="report15361" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.9996.r15361</article-id>
    <title-group>
      <article-title>Referee response for version 2</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Burden</surname>
          <given-names>Conrad J.</given-names>
        </name>
        <xref ref-type="aff" rid="r15361a1">1</xref>
        <xref ref-type="aff" rid="r15361a2">2</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r15361a1"><label>1</label>Mathematical Sciences Institute, Australian National University, Canberra, ACT, Australia</aff>
      <aff id="r15361a2"><label>2</label>Research School of Biology, Australian National University, Canberra, ACT, Australia</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>8</day>
      <month>8</month>
      <year>2016</year>
    </pub-date>
    <related-article id="d35e5345" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.8987.2">Version 2</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
<sub-article id="report15360" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.9996.r15360</article-id>
    <title-group>
      <article-title>Referee response for version 2</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Schurch</surname>
          <given-names>Nicholas J.</given-names>
        </name>
        <xref ref-type="aff" rid="r15360a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r15360a1"><label>1</label>Division of Computational Biology, College of Life Sciences, University of Dundee, Dundee, UK</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>2</day>
      <month>8</month>
      <year>2016</year>
    </pub-date>
    <related-article id="d35e5392" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.8987.2">Version 2</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
<sub-article id="report15362" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.9996.r15362</article-id>
    <title-group>
      <article-title>Referee response for version 2</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Ryan</surname>
          <given-names>Devon P.</given-names>
        </name>
        <xref ref-type="aff" rid="r15362a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r15362a1"><label>1</label>Max Planck Institute of Immunobiology and Epigenetics, Freiburg, Germany</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>2</day>
      <month>8</month>
      <year>2016</year>
    </pub-date>
    <related-article id="d35e5439" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.8987.2">Version 2</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
<sub-article id="report14474" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.9667.r14474</article-id>
    <title-group>
      <article-title>Referee response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Lianoglou</surname>
          <given-names>Steve</given-names>
        </name>
        <xref ref-type="aff" rid="r14474a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r14474a1"><label>1</label>Department of Bioinformatics and Computational Biology, Genentech Inc., San Francisco, CA, USA</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>7</month>
      <year>2016</year>
    </pub-date>
    <related-article id="d35e5486" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.8987.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>
      <bold>General Comments</bold>
    </p>
    <p> I'd like to first thank the authors for having a long history of providing key contributions to the filed of bioinformatics in terms of methodological advances which are manifested in robust software (limma and edgeR), and further for being most generous with their time by providing extensive support for their software and its use by writing (epic) user guides and answering an innumerably many questions on the bioconductor support forum -- especially since the latter is likely not considered "important" (citable(!)) under most models of academic recognition. The community owes you a large debt of gratitude.</p>
    <p> Now, for this workflow: The authors have provided a complete tutorial on the analysis of RNA-seq data that addresses many of the considerations required while performing these tasks. I'm particularly happy to see that the authors draw people's attention to the use of their "treat" framework, the brief (but important) ANODEV section, as well as discussing different ways to perform gene set enrichment analysis.</p>
    <p> My strongest comment is that this is very well written and should prove very useful to the community at large -- and most useful to the "casual" analyst, one who isn't well versed in the various avenues of research that are now so conveniently wrapped up behind a single call to `glmTreat` or `camera`. In this vein, I feel the authors have done a commendable job of touching upon many of the more subtle parts of the data preparation steps in an RNA-seq analysis (ie. the importance of filtering, how normalization factors are used to adjust library size, explanation of an MDS plot, etc).</p>
    <p> Of course one can't comment on every corner case that might arise during an rna-seq analysis, but to benefit this audience most, I'd like to point out some points that I feel could benefit from further clarification. Other readers would likely wish the authors clarify another set of points. The set of points that are most important to discuss is going to be subjective and based on our own experience in analyzing datasets (and helping others do the same), but for me I feel at least these could use some more elaboration:
<list list-type="order"><list-item><p>After the `plotMD` code example, the authors mention that "the bulk of genes should be centered at a line of zero log-fold change ...", it might be worth mentioning a few options to consider when a vanilla call to `calcNormFactors` doesn't produce that result.</p></list-item><list-item><p>It is ultimately the user's responsibility to keep up with the primary publications in the field, but I think the authors can help with just a few clarifying comments.</p></list-item></list>
<list list-type="bullet"><list-item><p>In the Introduction, the authors cite [12] (A. Lun, et al. It's DE-licious ...) when they mention edgeR's QLF framework offers some additional statistical refinements when compared to QuasiSeq, but [12] doesn't seem to mention any direct comparisons to QuasiSeq at all. As far as I can tell, [12] only mentions that QuasiSeq also uses quasi-likelihood F-tests, and that these account for gene-specific variability from both biological and technical sources. Could the authors clarify what these refinements might be? (In retrospect, this comment seems a bit trivial to make. I intended to chase more comments to publications, but unfortunately don't have the time ... I doubt that there's any need to, just trying to help the casual analyst connect some dots here, is all)</p></list-item><list-item><p>From previous experience of putting camera's `inter.gene.cor` parameter to use, I can say it's both awesome and mysterious. Awesome because camera's rankings in this mode are often very useful, but mysterious because: what do the p-values now mean, really? How much should the analyst care? The original camera paper goes to some length to discuss the importance of type I error control and that camera's approach of estimating and accounting for inter-gene correlation is an improvement there. Given that the user can now override it, what can the analyst reasonably say about type I error control, now? Some guidance on choice of the value, or (perhaps) comment on why it's not so critical could be useful.</p></list-item></list>
</p>
    <p>
      <bold>Minor Comments</bold>
      <list list-type="bullet">
        <list-item>
          <p>The authors have done a good job of enabling easy reproducibility of this workflow. Keeping with that spirit, it might be useful to change the code that materializes the `targets` object to be executable without the use of an external file. Leveraging R's ability to read from a `textConnection` might be one day to do that without loosing readability of the workflow, since the targes file would also be printed to the document without having to output its value:</p>
          <p>         targets &lt;- read.delim(textConnection("</p>
          <p>                    GEO        SRA CellType    Status</p>
          <p>     MCL1.DG GSM1480297 SRR1552450        B    virgin</p>
          <p>     MCL1.DH GSM1480298 SRR1552451        B    virgin</p>
          <p>     MCL1.DI GSM1480299 SRR1552452        B  pregnant</p>
          <p>     MCL1.DJ GSM1480300 SRR1552453        B  pregnant</p>
          <p>     MCL1.DK GSM1480301 SRR1552454        B lactating</p>
          <p>     MCL1.DL GSM1480302 SRR1552455        B lactating</p>
          <p>     MCL1.LA GSM1480291 SRR1552444        L    virgin</p>
          <p>     MCL1.LB GSM1480292 SRR1552445        L    virgin</p>
          <p>     MCL1.LC GSM1480293 SRR1552446        L  pregnant</p>
          <p>     MCL1.LD GSM1480294 SRR1552447        L  pregnant</p>
          <p>     MCL1.LE GSM1480295 SRR1552448        L lactating</p>
          <p>     MCL1.LF GSM1480296 SRR1552449        L lactating</p>
          <p>     "), sep="")</p>
        </list-item>
        <list-item>
          <p>In the "Downloading the read counts" section, the authors say that the first column of the downloaded read counts is the total number of bases in exons or UTRs for the gene, but UTRs *are* exons (sorry, pet peeve of mine) -- perhaps "total number of of basepairs from coding and non-coding exons(?)"</p>
        </list-item>
        <list-item>
          <p>When construction the DGEList, why not show that you can now easily drop the `targets` data.frame into the DGEList's `$samples` slot like so:</p>
          <p>    </p>
          <p> y &lt;- DGEList(GenewiseCounts[,-1], group=group, samples=targets,</p>
          <p>                  genes=GenewiseCounts[,1,drop=FALSE])</p>
        </list-item>
      </list>
    </p>
    <p>
      <bold>Grammar / Spelling</bold>
    </p>
    <p>  
<list list-type="bullet"><list-item><p>In the "Filtering to remove low counts" section</p><p>     - 'Genes that have *with* very low counts across all the libraries ...'</p><p>     - As a rule of thumb, we require that gene have a count of ...'</p><p>         + fix this sentence in a few places to support the use of "gene" or "genes"</p></list-item><list-item><p>After `plotBCV`: "The dispersion trend tends [to] decrease smoothly with abundance and (to -&gt; is) asymptotic to a constant ..."</p></list-item><list-item><p>When the concept of dispersion estimation is introduced, the different types of dispersions are briefly discussed (each individual gene, common dispersion, trended dispersion of a gene). Then, in the QL approach, you mention that the "tagwise NB dispersions" are not used. Would be useful to use same naming convention (ie. which of the previous types of dispersions introduced is the tagwise dispersion referenced here?)</p></list-item><list-item><p>Remove third "the" here: "The QL functions moderte the genewise the QL dispersion estimates ..."</p></list-item><list-item><p>Under *complicated contrasts*: Suppose we are interested in testing whether the change in expression between lactating and pregnant mice is the same for basal cells [as] it is for luminal cells.</p></list-item></list>
</p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
  <sub-article id="comment2102" article-type="response">
    <front-stub>
      <contrib-group>
        <contrib contrib-type="author">
          <name>
            <surname>Smyth</surname>
            <given-names>Gordon</given-names>
          </name>
          <aff>Walter and Eliza Hall Institute of Medical Research, Australia</aff>
        </contrib>
      </contrib-group>
      <author-notes>
        <fn fn-type="COI-statement">
          <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
        </fn>
      </author-notes>
      <pub-date pub-type="epub">
        <day>22</day>
        <month>7</month>
        <year>2016</year>
      </pub-date>
    </front-stub>
    <body>
      <p>Thanks, Steve, for your positive comments. Here are some responses to your extra suggestions.</p>
      <p>
        <italic>
          <bold>After the `plotMD` code example, the authors mention that "the bulk of genes should be centered at a line of zero log-fold change ...", it might be worth mentioning a few options to consider when a vanilla call to `calcNormFactors` doesn't produce that result.</bold>
        </italic>
      </p>
      <p> A paragraph has been added at the end of the normalization section. The MD plots have been moved to the next section with some added discussion of the relationship to normalization factors.</p>
      <p>
        <italic>
          <bold>In the Introduction, the authors cite [12] when they mention edgeR's QLF framework offers some additional statistical refinements when compared to QuasiSeq ... Could the authors clarify what these refinements might be?</bold>
        </italic>
      </p>
      <p> Robust empirical Bayes (robust=TRUE) is one refinement. Another is more careful treatment of zero counts when modelling the residual deviances. See our response to reviewer 1 (Conrad Burden).</p>
      <p>
        <italic>
          <bold>From previous experience of putting camera's `inter.gene.cor` parameter to use, I can say it's both awesome and mysterious. ... Some guidance on choice of the value, or (perhaps) comment on why it's not so critical could be useful.</bold>
        </italic>
      </p>
      <p> See our response to reviewer 2 (Devon Ryan).</p>
      <p>
        <italic>
          <bold>The authors have done a good job of enabling easy reproducibility of this workflow. Keeping with that spirit, it might be useful to change the code that materializes the `targets` object to be executable without the use of an external file. Leveraging R's ability to read from a `textConnection` might be one day to do that without loosing readability of the workflow</bold>
        </italic>
      </p>
      <p> That's a interesting suggestion. Alternatively of course we could have simply created the CellType and Status vectors in R without reading a targets frame at all. The reason why we read from an external file is we feel that doing so has pedagogic value. We think it is generally good practice for experimenters to create the targets file outside of R, using a spreadsheet editor like Excel. This forces the experimenter to check the correspondence between sample IDs and experimental factors. We want the workflow to mimic how a real analysis will go.</p>
      <p>
        <italic>
          <bold>In the "Downloading the read counts" section, the authors say that the first column of the downloaded read counts is the total number of bases in exons or UTRs for the gene, but UTRs *are* exons</bold>
        </italic>
      </p>
      <p> We agree, but the text nevertheless seems simple and clear. In our experience, it helps to explicitly mention UTRs. We've changed it to "exons and UTRs".</p>
      <p>
        <italic>
          <bold>When constructing the DGEList, why not show that you can now easily drop the `targets` data.frame into the DGEList's `$samples` slot like so:</bold>
        </italic>
      </p>
      <p> Good suggestion. We don't do it just so that the output from y$samples on pages 4 and 5 doesn't exceed the window width.</p>
      <p>    </p>
      <p>
        <italic>
          <bold>Grammar / Spelling</bold>
        </italic>
      </p>
      <p> Fixed.</p>
      <p>
        <italic>
          <bold>When the concept of dispersion estimation is introduced, the different types of dispersions are briefly discussed (each individual gene, common dispersion, trended dispersion of a gene). Then, in the QL approach, you mention that the "tagwise NB dispersions" are not used. Would be useful to use same naming convention (ie. which of the previous types of dispersions introduced is the tagwise dispersion referenced here?)</bold>
        </italic>
      </p>
      <p> Good suggestion, done.</p>
    </body>
  </sub-article>
</sub-article>
<sub-article id="report14480" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.9667.r14480</article-id>
    <title-group>
      <article-title>Referee response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Khang</surname>
          <given-names>Tsung Fei</given-names>
        </name>
        <xref ref-type="aff" rid="r14480a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r14480a1"><label>1</label>Institute of Mathematical Sciences, Faculty of Science, University of Malaya, Kuala Lumpur, Malaysia</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>13</day>
      <month>7</month>
      <year>2016</year>
    </pub-date>
    <related-article id="d35e5772" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.8987.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>First of all, please accept my apologies for not being able to complete the review earlier. I would like to thank the editor for the opportunity to review this interesting paper. EdgeR is one of the more popular methods for performing RNA-Seq data analysis, and the authors’ efforts in writing this expository tutorial will surely be welcome by students and researchers who need to work with analysis of RNA-Seq data.</p>
    <p> I think entry-level readers with basic R skills will find the workflow described easy to follow; and having actually worked out an example data set, will have less difficulty in adapting it to the needs of their own data analysis. However, intermediate or experienced readers might find the presentation of some parts of the workflow overly simplistic (as pointed out by one of the reviewers N.J.Schurch) - but this is not a weakness of the paper, since it is too much to expect that all the nuances of a refined RNA-Seq data analysis can be covered in this tutorial paper. Nonetheless, I believe the discussion of these points will potentially add value to the paper – they do not necessarily imply the necessity of revising the work to include the points raised, because the appending of reviewers’ comments enables readers to assess how relevant are the points raised to their own work.</p>
    <p> To ease discussion of the paper, I will itemize my comments as follows.
<list list-type="order"><list-item><p>Despite declaring “From reads to genes to pathways” in their title, the authors choose not to develop the contents of their paper in this sequence. Rather, they start immediately with the count table, and then develop the material going from genes to pathways. The section on read mapping is presented at the end instead.</p><p> I understand the focus of their sequence of writing, which is to get the readers into the heart of the action quickly, using the tool that they are most familiar with, edgeR. However, read processing is an important upstream checkpoint, and the things that one chooses to do at this stage has more important consequences than choices of which contrasts to make, optimizing plots, etc. Personally, I feel that insufficient attention has been given to this section, which can benefit from more discussion. It troubles me that there is no mention of short read quality control, a standard (and important) requirement for data quality check, which I am sure the authors are aware of. This is typically visualized using the standard tool FastQC. Subsequently, depending on the diagnostics, one can use a tool like FastX or Trimmomatic
<sup><xref rid="rep-ref-14480-1" ref-type="bibr">1</xref></sup> to remove problematic segments, usually the 3' end. Then, there is a plethora of read mapping methods that can be used  (of which Rsubread is just one of them), and also methods of constructing the count table from the mapped reads. Optimal combinations of methods for performing both tasks were recently investigated by Fonseca
<italic> et al</italic>.
<sup><xref rid="rep-ref-14480-2" ref-type="bibr">2</xref></sup>, who suggested combinations such as OSA+HTSeq for producing the reliable count tables. While the authors do not really need to show how these can be done, I think they should devote a short paragraph to discuss these issues because of their fundamental nature.</p></list-item><list-item><p>The authors demonstrate the use of mean difference (MD / a.k.a MA) plots as a diagnostic plot for checking data distributional properties. These are useful for checking whether variances increase as counts get larger in samples (the “fanning patterns”), for example. Less clear is the appropriate course of action in the event observing such undesirable patterns. Do we try to carry on the analysis, using log-transformed data? Do we discard problematic samples? Admittedly these are delicate issues that require more space for discussion than is possible in the paper. Nevertheless, providing some guidelines or pointing out useful references for further exploration will surely help readers appreciate the use of these plots.</p></list-item><list-item><p>There is strangely no illustration of how to make a volcano plot in the tutorial, which is a common graphical plot for assessing the joint relationship between statistical and biological significance. From experience, I find such plots important for understanding how different DE methods pick DE gene candidates.</p><p> I was motivated to understand how
<italic>glmQLFTest </italic>and
<italic> glmTreat </italic>functions call DE genes compared to a simple method based on hyperbolic decision rules proposed by Xiao
<italic>et al.</italic>
<sup><xref rid="rep-ref-14480-3" ref-type="bibr">3</xref></sup> using the volcano plot. The method of Xiao constructs the decision rule as follows: Declare a fold change  (FC) cut-off below which one is not interested in a gene as a DE candidate. So if we desire FC &gt; 2 for up-regulated genes (and conversely FC &lt; 1/2 for down-regulated genes), then |log2(FC)| &gt; 1. Next, we set the level of statistical significance, above which a gene is considered to be an unlikely DE candidate. Suppose we use the adjusted p-value, and require p &lt; 0.01. This implies that –log10(p) &gt; 2. If we denote y = -log10(p) and x = log2(FC), then the product of these two inequalities gives |x|y &gt;  2, so that y &gt; 2/|x|. This translates to a hyperbolic decision rule, such that genes with x and y values lying in the rejection region are selected as DE candidates. This rule allows one to include genes with very large FC but higher p-value. If we care a lot about managing false positives, then we could add a hard requirement for –log10(p) = 2, meaning that we will only considering genes that demonstrate adjusted p-values below 0.01.</p><p> The result of my exploration is attached
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/Volcano_plot_-_analysis_of_GSE60450_data_set/3482741">here</ext-link>. Non-DE genes are in black. The genes picked using
<italic>glmQLFTest </italic>are in green; note the majority of them are also picked by the hyperbolic decision rule (blue). Candidates returned from
<italic>glmTreat</italic> are boxed in purple, and seems to form a subset of the candidates returned from the hyperbolic decision rule. However, they show a peculiar distribution pattern, in that some genes with large log2(FC) and –log10(p) do not get picked. It is unclear to me why such genes are not detected by the algorithm. Regardless, a volcano plot is an important instrument that readers can have at their disposal for understanding the behaviour of DE gene calling algorithms.</p></list-item><list-item><p>The heatmap (Fig.7) is an important graphical plot of any gene expression analysis project, but there are some subtleties to its proper generation. I think it is not easy to explain the clustering pattern of the samples in Fig. 7, where basal and luminal cell samples are grouped together. Fortunately, this is often just a problem of the choice of clustering algorithm used. The default method in
<italic>heatmap.2</italic> for clustering is complete linkage, which is often not the best method. From experience, changing it to the ward.D algorithm frequently produced biologically meaningful results, which is the case in the current analysis.</p><p> The figure
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/Heatmap_-_analysis_of_GSE60450_data_set/3482786">here</ext-link> shows a possible modification of the heatmap. Here, the basal and luminal samples nicely separate out into two clusters, following biological intuition. Columns of interest (e.g. lactating state in both basal and luminal cells) can be boxed to draw reader’s attention.</p><p> May I also recommend that the srtCol argument in the heatmap be introduced to users, since sooner or later one would have to deal with space issues with labels on a heatmap, and what better way to handle this than having them oblique instead of perpendicular to the plot? Additionally, I think the outcome of customizing the heatmap using the given margin, lhei and lwid arguments will produce variable results in different computers (I got a "figure margins too large" error message initially), and so a note to users may be useful.</p></list-item><list-item><p>In the output table produced using the
<italic>topTags </italic>function, there is a column named “FDR”. Should this be “Adjusted p-value”? In the Benjamini-Hochberg correction method that the authors’ used, FDR is a parameter determined by the user. Depending on one’s taste for false positive tolerance, one can tune it low or high (maybe useful to let users tune it?), so synonymizing “FDR” with “adjusted p-value” leads to conceptual confusion. By the way, how did the authors compute the adjusted p-value?</p></list-item><list-item><p>While testing out the codes, I noted that the output that I got differed slightly from those shown by the authors.  Additionally, like N.J.Schurch, I also encountered problems running the fry code example:</p><p><italic>&gt; fry(y, index=cyt.go.genes, design=design, contrast=B.VvsL)</italic></p><p><italic>Error in array(x, c(length(x), 1L), if (!is.null(names(x))) list(names(x),  : 'data' must be of a vector type, was 'NULL'</italic></p><p> Only much later in the end did I read, on page 21, that the authors made their analysis using R version 3.3.0 or higher, with Bioconductor version 3.3. Since my versions for both were 3.2, I suppose that the variation in output, as well as the error message seen, could be just a consequence of different versions. Would it be better if the versions used are announced right at the beginning of the paper? Additionally, it would also help if the packages needed for running the analysis are all installed at the beginning of the R script provided (e.g. readers who had not run
<italic>biocLite(“GO.db”)</italic> to install the package from Bioconductor would get an error running 
<italic>library(GO.db</italic>) – this is not mentioned in the text I think, and can trouble beginners)</p></list-item><list-item><p>Minor comments:</p><p> (i)Subject-verb agreement issue (page 6): “We require that gene(s) have a count ….”.(ii)ANOVDEV - analysis of deviance, a citation is useful. </p></list-item></list> Note: Codes for producing the volcano plot and heatmap are available
<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/Supplementary_R_code/3482807">here.</ext-link>
</p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
  <back>
    <ref-list>
      <title>References</title>
      <ref id="rep-ref-14480-1">
        <label>1</label>
        <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bolger</surname><given-names>AM</given-names></name><name><surname>Lohse</surname><given-names>M</given-names></name><name><surname>Usadel</surname><given-names>B</given-names></name></person-group>:
<article-title>Trimmomatic: a flexible trimmer for Illumina sequence data.</article-title><source><italic>Bioinformatics</italic></source>.<year>2014</year>;<volume>30</volume>(<issue>15</issue>) :
<elocation-id>10.1093/bioinformatics/btu170</elocation-id><fpage>2114</fpage>-<lpage>20</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btu170</pub-id><?supplied-pmid 24695404?><pub-id pub-id-type="pmid">24695404</pub-id></mixed-citation>
      </ref>
      <ref id="rep-ref-14480-2">
        <label>2</label>
        <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fonseca</surname><given-names>NA</given-names></name><name><surname>Marioni</surname><given-names>J</given-names></name><name><surname>Brazma</surname><given-names>A</given-names></name></person-group>:
<article-title>RNA-Seq gene profiling--a systematic empirical comparison.</article-title><source><italic>PLoS One</italic></source>.<year>2014</year>;<volume>9</volume>(<issue>9</issue>) :
<elocation-id>10.1371/journal.pone.0107026</elocation-id><fpage>e107026</fpage><pub-id pub-id-type="doi">10.1371/journal.pone.0107026</pub-id><?supplied-pmid 25268973?><pub-id pub-id-type="pmid">25268973</pub-id></mixed-citation>
      </ref>
      <ref id="rep-ref-14480-3">
        <label>3</label>
        <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xiao</surname><given-names>Y</given-names></name><name><surname>Hsiao</surname><given-names>TH</given-names></name><name><surname>Suresh</surname><given-names>U</given-names></name><name><surname>Chen</surname><given-names>HI</given-names></name><name><surname>Wu</surname><given-names>X</given-names></name><name><surname>Wolf</surname><given-names>SE</given-names></name><name><surname>Chen</surname><given-names>Y</given-names></name></person-group>:
<article-title>A novel significance score for gene selection and ranking.</article-title><source><italic>Bioinformatics</italic></source>.<year>2014</year>;<volume>30</volume>(<issue>6</issue>) :
<elocation-id>10.1093/bioinformatics/btr671</elocation-id><fpage>801</fpage>-<lpage>7</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btr671</pub-id><?supplied-pmid 22321699?><pub-id pub-id-type="pmid">22321699</pub-id></mixed-citation>
      </ref>
    </ref-list>
  </back>
  <sub-article id="comment2103" article-type="response">
    <front-stub>
      <contrib-group>
        <contrib contrib-type="author">
          <name>
            <surname>Smyth</surname>
            <given-names>Gordon</given-names>
          </name>
          <aff>Walter and Eliza Hall Institute of Medical Research, Australia</aff>
        </contrib>
      </contrib-group>
      <author-notes>
        <fn fn-type="COI-statement">
          <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
        </fn>
      </author-notes>
      <pub-date pub-type="epub">
        <day>22</day>
        <month>7</month>
        <year>2016</year>
      </pub-date>
    </front-stub>
    <body>
      <p>We thank the reviewer for his thoughtful comments, although we have different views on some of the specific issues raised.</p>
      <p> The reviewer is right that this is a tutorial aimed at entry-level readers. We went to some trouble to make the tutorial simple, but we do not think it is "simplistic". The article alludes to many data analysis issues in a concise style. It includes material that is new and interesting for an advanced reader, as the reviewer reports show.</p>
      <p> Our article is "live" in the sense that readers can regenerate the analysis and the article themselves automatically from a knitr file containing R code. In this revision, we have added a link to the code files. It isn't practical to include the read alignment in a live analysis because it is so much more computationally demanding than the rest of the analysis. Requiring readers to undertake the alignment step to obtain the read counts would drastically limit the audience who could go through the rest of the analysis.</p>
      <p> We have added a note to the article about plotting quality scores. However we think that trimming poor quality segments is an old-fashioned step that is generally unnecessary given improved sequencing protocols and high quality robust aligners like subread. Trimming is more likely to be harmful than helpful for a gene-level RNA-seq study. Indeed we think that encouraging entry-level users to make ad hoc edits of their sequence data is quite dangerous. It is far better to allow a quality-score-aware aligner like subread to make decisions on a per-read basis.</p>
      <p> We are not sure why the reviewer cites Fonseca et al (FMB), but we make the following points. FMB evaluated pipelines for quantifying absolute expression, which is not directly relevant in a differential expression study such as ours. FMB only compared pipelines available at the time. The OSA+HTSeq pipeline is not particularly popular, for example it has not been adopted by any of the FMB authors themselves for any published study of real data. By contrast, the Rsubread+featureCounts pipeline that we suggest is newer, faster and more widely used.</p>
      <p> We could cite references to claim superiority for the Rsubread and featureCounts tools, for example the SEQC study (Su et al, 2014), but a review of the literature would be out of place in our article. What is undoubtedly true is that Rsubread+featureCounts is more than good enough and easily the fastest and most convenient in an R context because of its native implementation as an R package.</p>
      <p> The reviewer may have misinterpreted the purpose of the MD plots. They are designed to display differential expression, either for individual samples or for a fitted model. They are not designed to check distributional properties. They do not check whether variances increase with count size. They are not used to suggest transformations of the data.</p>
      <p> Volcano plots were originally motivated by the shortcomings of ordinary t-tests, which can give very small p-values even for genes with tiny fold changes. However this problem has been overcome by empirical Bayes test statistics, and we do not generally recommend volcano plots in the context of an edgeR analysis. Volcano plots tend to encourage fold change cutoffs, which we also don't recommend. We much prefer the MD plot (Figure 5) because it shows clearly how larger fold changes are required to reliably call DE for lower expressed genes.</p>
      <p> The decision rule of Xiao et al (2014) doesn't give rigorous control of the FDR, and it has the tendency to prioritize genes with small counts that have large fold changes and large variances. We prefer not to prioritize lowly expressed genes. Again, this is made clear by the MD plot.</p>
      <p> Thank you for the suggestions and code for the heatmap. The pattern seen in our heatmap is because we chose to display genes that are DE between B.pregnant and B.lactating, hence it is natural that these two populations are separated at the far left and right of the plot. We agree that slanted labels are useful, as are some of the other options you demonstrate. The choice of clustering algorithm is controversial, especially so as the ward.D algorithm is not a correct representation of Ward's method, with some writers claiming that only ward.D2 should be used. Anyway, our article is not about heatmaps
<italic>per se</italic>. Our aim is simply to provide an example of how results can be transferred to a heatmap, so it is best to keep the heatmap call as simple as possible. Users are then free to add as many embellishments as they like.</p>
      <p> There is no conceptual confusion with FDRs. For any FDR tolerance that a user might have, the genes for which the FDR value from topTags() is less than this cutoff are exactly the same genes that would be judged statistically significant by Benjamini-Hochberg's 1995 algorithm.</p>
      <p> Obviously the results from the workflow will differ slightly if older versions of R and Bioconductor are used. The software versions were stated on page 18 as well as on page 21. The journal format is that software requirements are described at the end of the article. The requirements seem to us to be well sign-posted in sections called "Packages used" and "Data and software availability". In any case, we are a bit surprised that readers should need special prompting to install the current versions of R and Bioconductor.</p>
      <p> Package installation is a "once off" operation, so we prefer not to make it part of the workflow code that a user might run many times.</p>
      <p> A citation for ANODEV has been added.</p>
      <p>
        <bold>Reference</bold>
      </p>
      <p> Su, Z, et al (2014). A comprehensive assessment of RNA-seq accuracy, reproducibility and information content by the Sequencing Quality Control Consortium. Nature Biotechnology 32(9), 903-914.</p>
    </body>
  </sub-article>
</sub-article>
<sub-article id="report14478" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.9667.r14478</article-id>
    <title-group>
      <article-title>Referee response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Ryan</surname>
          <given-names>Devon P.</given-names>
        </name>
        <xref ref-type="aff" rid="r14478a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r14478a1"><label>1</label>Max Planck Institute of Immunobiology and Epigenetics, Freiburg, Germany</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>6</day>
      <month>7</month>
      <year>2016</year>
    </pub-date>
    <related-article id="d35e6220" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.8987.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>RNAseq is easily one of the most prevalent NGS experiment types and edgeR one of the most heavily used tools for analyzing the results of these experiments. Given that, I'm quite pleased to see this article from Chen and colleagues that provides a very convenient walk-through of how to perform a typical analysis, including pathway and GO enrichment.</p>
    <p> I have no real reservations regarding this article. Below I'd like to point to a few parts of the paper that could use caveats or further explanation.
<list list-type="order"><list-item><p>The example experiment has only two samples per group. That suffices in some circumstances, but at least in my experience the lay reader has the unfortunate habit of reading too much into the the number of samples used in papers like this and then trying to use that as justification for similar sample numbers for their much lower effect size experiments. A caveat or note of warning to those new to RNAseq would have been nice.</p></list-item><list-item><p>There's typically filtering done, such as the "rowSums(cpm(y) &gt; 0.5) &gt;= 2" in this paper. It would have been nice to include some recommendations regarding how to choose a filtering threshold.</p></list-item><list-item><p>The p-values produced by goana() and topKEGG() are presumably unadjusted for multiple testing. It would have been nice if there had been a note to not then use the typical 0.05 cut off.</p></list-item><list-item><p>While playing around with the code presented in the paper, I noticed that the choice of 0.01 for the "inter.gene.cor" parameter in camera() has a drastic affect on the resulting p-values. It would be incredibly useful to know when one should override the default value and how one should then derive an appropriate value. My concern is primarily that many will see these commands as "the one true method" for performing such an analysis and blindly apply the option in cases where it might not be appropriate.</p></list-item></list>
</p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
  <sub-article id="comment2101" article-type="response">
    <front-stub>
      <contrib-group>
        <contrib contrib-type="author">
          <name>
            <surname>Smyth</surname>
            <given-names>Gordon</given-names>
          </name>
          <aff>Walter and Eliza Hall Institute of Medical Research, Australia</aff>
        </contrib>
      </contrib-group>
      <author-notes>
        <fn fn-type="COI-statement">
          <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
        </fn>
      </author-notes>
      <pub-date pub-type="epub">
        <day>22</day>
        <month>7</month>
        <year>2016</year>
      </pub-date>
    </front-stub>
    <body>
      <p>Thank you for your thoughtful report.</p>
      <p> We have added a note about small sample numbers to the end of the section describing the experiment.</p>
      <p> To be honest, we thought that we had already explained how to choose the filtering threshold in some detail. Admittedly we explained in words how the 0.5 and the 2 values in the filter formula were derived, and why they are appropriate for this experiment, rather than giving a formula. Anyway, we have edited the filtering section and added a couple of sentences.</p>
      <p> We have added a note about the p-values from topGO() and topKEGG(). We generally ignore p-values above about 1e-5.</p>
      <p> You ask a good question about inter.gene.cor for camera(). We have recently made inter.gene.cor=0.01 the default setting for camera(). Previously the default was to estimate the correlation separately for each gene set. The old default gives rigorous control of the type I error rate but is conservative and doesn't always rank the most biological interpretable sets most highly. The ranking issues occurs because of the need to penalize highly co-regulated sets with positive inter-gene correlations. We and others (Tarca et al, 2013) have noticed that much simpler methods like limma's geneSetTest() tend to give a better ranking of the biologically significant sets although they do not control the error rate correctly. Our recent use of a preset value for inter.gene.cor in camera() is an attempt to strike a compromise between the original camera() and geneSetTest(). Note the latter is equivalent to camera() with inter.gene.cor=0. The compromise gains the advantages of geneSetTest() while keeping reasonable, although not perfect, error rate control. You are right that the camera p-values are sensitive to the value for inter.gene.cor. Nevertheless, after quite a bit of experimentation, we have chosen the value of 0.01 as a reasonable compromise between ranking and error rate control that gives good results across a range of datasets. So we are happy to offer it for general use and would prefer that most users kept to the default value. The p-values will often be somewhat optimistic, but probably not more so than other commonly used methods like the Fisher tests for GO and KEGG terms. It gives vastly better error control than gene sets methods that permute genes and ignore inter-gene correlations, especially for larger sets.</p>
      <p>
        <bold>Reference</bold>
      </p>
      <p> Tarca AL, Bhatti G, Romero R (2013) A comparison of gene set analysis methods in terms of sensitivity, prioritization and specificity. PLoS ONE 8(11): e79217. http://dx.doi.org/10.1371/journal.pone.0079217</p>
    </body>
  </sub-article>
</sub-article>
<sub-article id="report14475" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.9667.r14475</article-id>
    <title-group>
      <article-title>Referee response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Schurch</surname>
          <given-names>Nicholas J.</given-names>
        </name>
        <xref ref-type="aff" rid="r14475a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r14475a1"><label>1</label>Division of Computational Biology, College of Life Sciences, University of Dundee, Dundee, UK</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>1</day>
      <month>7</month>
      <year>2016</year>
    </pub-date>
    <related-article id="d35e6343" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.8987.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>This paper lays out a clear and relatively concise example of a linear workflow for analysing an RNA-seq based Differential Gene Expression experiment. The workflow focuses on doing all the analysis steps within R using the author's preferred tools (Rsubread &amp; edgeR) and extends usefully to common aspects of pathway analysis with GO terms, Kegg terms and Gene Set testing.</p>
    <p> While I'm sure this paper will be useful for a section of the community (particularly newcomers to this kind of analysis), I find the paper to be quite simplistic and lacking in depth and discussion. In particular, there is no discussion of the subtleties involved in performing this kind of analysis at the coalface of scientific research.</p>
    <p> Some particular points I would like to have seen discussed are:
<list list-type="order"><list-item><p>How many replicates should be used for this kind of analysis.</p><p> The example study uses a very poorly replicated dataset. In this case two replicates per condition *may* be sufficient, but not only is it not discussed but for most experiments this is highly misleading! For new RNA-seq experiments a significantly higher number of replicates should be used, both to guard against problem samples/libraries and to ensure sufficient statistical power to identify significant differential expression (in particular because it is rare to know how large the changes in the data will be before you do the experiment).</p></list-item><list-item><p>How might one identify problematic issues with datasets that aren't as cooperative as the example dataset.</p><p> For example, what would significant structure or curvature in the point cloud of the MD plot signify? If the samples don't cluster nicely on the MDS plot by condition, what might this mean (mislabelling, bad replicates, etc)?</p></list-item><list-item><p>How one might remedy or deal with the problems in such uncooperative datasets.</p><p> For example, what general approaches could be used for isolating the root cause of the observed problems? How might we adjust the analysis to ameliorate the problems and their downstream impact (dropping datasets, changing mapping parameters, filtering the data)?</p></list-item><list-item><p>How one might go about choosing sensible selections and thresholds for the data.</p><p> In my opinion the use of 'standard' and/or 'default' parameters, thresholds and selections (e.g. unique=TRUE, FDR&gt;0.05, log2(FC)&gt;1, cpm&gt;0.5, etc) is a significant and endemic problem in this field. Often these are used solely because they have been used widely before, rather than considering whether they are appropriate for the specific data being analysed. What caused the authors to choose the values they use for this data and what key plots or pieces of information are valuable for choosing these appropriately?</p></list-item><list-item><p>How the various selection steps, thresholds and even the version of the software used, might impact on the downstream results.</p><p> For example, if you change the FDR threshold from 0.05 to 0.01, how does this impact the downstream pathway analysis? Are some of these analyses insensitive to threshold values (e.g. gene set analysis) and does this make them better/more useful? If you change the cpm threshold to 1.0, or if you allow non-unique read mappings, how does this impact the number of identified SDE genes and the downstream pathway analyses?</p></list-item></list> I am not suggesting that the authors should have given an exhaustive account of the issues. Rather, I think the paper would benefit from briefly discussing some of the more subtle and complex issues surrounding these types of analyses and perhaps highlight some key problems, parameters and thresholds that should be thought about carefully. Without this the paper really presents a very linear, idealized, example of what, in practice, are complex analyses that may require considerably more thought and investigation.</p>
    <p> I also encountered some more specific issues:
<list list-type="order"><list-item><p>The link provided does not (currently) link to the actual bioconductor workflow.</p></list-item><list-item><p>I ran all the R commands and they all work (except 'fry' see point 4 below), however I didn't get exactly the same results when (and after) filtering out genes without a symbol.</p><p> The paper has:</p><p><italic>&gt; head(y$genes)</italic></p><p><italic>                   Length  Symbol</italic></p><p><italic>497097          3634     Xkr4</italic></p><p><italic>  100503874    3259     Gm19938</italic></p><p><italic>  100038431    1634     Gm10568</italic></p><p><italic>19888            9747     Rp1</italic></p><p><italic>20671            3130     Sox17</italic></p><p><italic>27395            4203     Mrpl15</italic></p><p><italic>&gt; y &lt;- y[!is.na(y$genes$Symbol), ]</italic></p><p><italic>&gt; dim(y)</italic></p><p><italic>[1] 26357    12</italic></p><p> I had:</p><p><italic>&gt; head(y$genes)</italic></p><p><italic>                 Length  Symbol</italic></p><p><italic>497097         3634     Xkr4</italic></p><p><italic>  100503874   3259     Gm19938</italic></p><p><italic>  100038431   1634     Gm10568</italic></p><p><italic>19888           9747     Rp1</italic></p><p><italic>20671           3130     Sox17</italic></p><p><italic>27395           4203     Mrpl15</italic></p><p><italic>&gt; y &lt;- y[!is.na(y$genes$Symbol), ]</italic></p><p><italic>&gt; dim(y)</italic></p><p><italic>[1] 26608    12</italic></p><p> The change is relatively small but it cascades causing differences in the genes that pass cpm filtering, differences in the normalization factors and differences in the DE results and the downstream analyses. I suspect this is the result of using a slightly older version of org.Mm.eg.db (3.2.3, vs 3.3.0) due to using an older version of R (3.2 vs 3.3). This goes nicely to point (5) above.</p></list-item><list-item><p>There is no real description of the reasoning behind scaling of the heatmap values to a mean of zero and std dev of one.</p></list-item><list-item><p>The 'fry' command failed for me, producing the error:</p><p><italic>&gt; fry(y, index=cyt.go.genes, design=design, contrast=B.VvsL)</italic></p><p><italic>Error in array(x, c(length(x), 1L), if (!is.null(names(x))) list(names(x),  :</italic></p><p><italic> 'data' must be of a vector type, was 'NULL'</italic></p></list-item></list>
</p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
  <sub-article id="comment2104" article-type="response">
    <front-stub>
      <contrib-group>
        <contrib contrib-type="author">
          <name>
            <surname>Smyth</surname>
            <given-names>Gordon</given-names>
          </name>
          <aff>Walter and Eliza Hall Institute of Medical Research, Australia</aff>
        </contrib>
      </contrib-group>
      <author-notes>
        <fn fn-type="COI-statement">
          <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
        </fn>
      </author-notes>
      <pub-date pub-type="epub">
        <day>22</day>
        <month>7</month>
        <year>2016</year>
      </pub-date>
    </front-stub>
    <body>
      <p>We thank the reviewer for approving our article.</p>
      <p> We also thank the reviewer for his comments about RNA-seq analysis in general, but we didn't find the suggestions for revisions to be helpful. One problem is that the reviewer did not follow the instructions given in the article regarding software requirements. In general, Bioconductor workflows and Bioconductor channel articles are intended to be run using the latest release of Bioconductor. This was explicitly explained in the article, which said "This workflow depends on various packages from version 3.3 of the Bioconductor project, running on R version 3.3.0 or higher." The article went on to give the version numbers of all packages used. Unfortunately the reviewer tested the workflow using an earlier version of Bioconductor, with the result that one of the function calls didn't work and there were slight changes in the annotation.</p>
      <p> We make no apology for providing a "linear" workflow demonstrating an easy, robust, fast and flexible workflow from RNA-seq reads through to pathway analysis. That was clearly the purpose of the article. We are pleased that the reviewer found our analysis to be "idealized" because it is in fact a typical example of our own biomedical research that we published recently in Nature Cell Biology. The article gives an insight, as far as is possible in a short journal article, of our own analysis process "at the coalface of scientific research".</p>
      <p> The reviewer wants us to take lots of sidepaths, discussing problems that did not in fact occur, but we think that readers will not want to be distracted by hypothetical dead-ends in this way. The instructions for writing these articles (available from
<ext-link ext-link-type="uri" xlink:href="https://support.bioconductor.org/p/80077">https://support.bioconductor.org/p/80077</ext-link>) advised authors to take a pragmatic task-orientated approach and not to get bogged down with extensive discussions of options. One has to start with an example of how an analysis should work in order to have a firm basis from which to deal with problematic studies that might arise in the future.</p>
      <p> The reviewer also wants us to discuss the consequences of myriad perturbations of thresholds and parameters in the analysis pipeline. On one hand, we are disappointed that the reviewer failed to acknowledge the many explanations that were given in the article. On the other, we think that the specific parameter settings questioned by the reviewer are not particularly crucial and are not the most important issues that we would like researchers to be thinking about when they conduct an analysis.</p>
      <p> Regarding sample sizes, the minimum appropriate sample size depends very much on the context. n=2 may be sufficient when comparing well sorted cell types from genetically identical mice whereas n=10 may be not nearly enough when comparing whole blood from diseased vs normal patients. For the study analyzed in our article, the cell types have distinct and highly reproducible expression profiles. The results were validated in the biological publication (Fu et al, 2015) in a number of ways. The repeatability of the results was also demonstrated in our current article by the strong correlation between the current results and earlier microarray results on similar cell populations (Figure 9). We disagree with the reviewer's position that sample size recommendations can be made independently of the biological context and the purpose of the scientific study.</p>
      <p> We now give responses to specific issues raised by the reviewer:</p>
      <p>
        <italic>
          <bold>1. How many replicates should be used for this kind of analysis.</bold>
        </italic>
      </p>
      <p> This is not an article about experimental design.</p>
      <p>
        <italic>
          <bold>2. How might one identify problematic issues with datasets that aren't as cooperative as the example dataset.</bold>
        </italic>
      </p>
      <p> The article already shows users how to create appropriate plots from which problems can be identified.</p>
      <p>
        <italic>
          <bold>3. How one might remedy or deal with the problems in such uncooperative datasets.</bold>
        </italic>
      </p>
      <p> Trying to give a solution to every possible problem that might arise is clearly beyond the scope of the current article. In many cases it might be that no special action needs to be taken as the pipeline we give is quite robust.</p>
      <p>
        <italic>
          <bold>4. How one might go about choosing sensible selections and thresholds for the data. What caused the authors to choose the values they use for this data and what key plots or pieces of information are valuable for choosing these appropriately?</bold>
        </italic>
      </p>
      <p> This has already been explained where relevant in the article.</p>
      <p>
        <italic>
          <bold>In my opinion the use of 'standard' and/or 'default' parameters, thresholds and selections (e.g. unique=TRUE, FDR&gt;0.05, log2(FC)&gt;1, cpm&gt;0.5, etc) is a significant and endemic problem in this field. Often these are used solely because they have been used widely before, rather than considering whether they are appropriate for the specific data being analysed.</bold>
        </italic>
      </p>
      <p> The reviewer is entitled to his point of view about the field in general, but all these issues are addressed from first principles in our article.</p>
      <p> The reason for setting unique=TRUE in the call to align() was explained at the top of page 23. We see no point in unique=FALSE for a gene-level expression analysis.</p>
      <p> We did not use a 'standard' cpm cutoff but rather explained how to work out a useful threshold for this specific data set. In fact the pipeline is robust to the filtering and tends to give similar results for a range of filtering methods and thresholds, as explained in the article.</p>
      <p> We provided an extended discussion of DE cutoffs on pages 12-13 (nearly two whole pages). We presented a sophisticated solution using glmTreat() that is better than using a FC cutoff or making the FDR cutoff more stringent.</p>
      <p>
        <italic>
          <bold>5. How the various selection steps, thresholds and even the version of the software used, might impact on the downstream results.</bold>
        </italic>
      </p>
      <p> Already explained where appropriate. For example, page 18 says "Gene set tests consider all the genes in the specified set and do not depend on any pre-emptive significance cutoff."</p>
      <p> In most cases, changes to the thresholds either have obvious effects (a lower FDR cutoff produces fewer DE genes) or have less impact than the reviewer seems to imply.</p>
      <p>
        <italic>
          <bold>1. The link provided does not (currently) link to the actual bioconductor workflow.</bold>
        </italic>
      </p>
      <p> We submitted our workflow to Bioconductor at about the same time as submitting to F1000Research but it has not yet appeared on the Bioconductor website. Unfortunately, none of the Bioconductor channel articles on F1000Research link to a corresponding code workflow.</p>
      <p> In the meantime, we have made our code and data available from
<ext-link ext-link-type="uri" xlink:href="http://bioinf.wehi.edu.au/edgeR/F1000Research2016">http://bioinf.wehi.edu.au/edgeR/F1000Research2016</ext-link> and have added this link to the revised article. Note that the entire LaTeX article is generated automatically by running knit() on a Rnw file.</p>
      <p>
        <italic>
          <bold>2. I ran all the R commands and they all work (except 'fry' see point 4 below), however I didn't get exactly the same results when (and after) filtering out genes without a symbol.</bold>
        </italic>
      </p>
      <p> You used out-of-date versions of R and Bioconductor.</p>
      <p>
        <italic>
          <bold>The change is relatively small but it cascades causing differences in the genes that pass cpm filtering, differences in the normalization factors and differences in the DE results and the downstream analyses.</bold>
        </italic>
      </p>
      <p> In fact the DE results are almost identical using either Bioconductor 3.2 or 3.3, demonstrating the robustness of the pipeline.</p>
      <p>
        <italic>
          <bold>3. There is no real description of the reasoning behind scaling of the heatmap values to a mean of zero and std dev of one.</bold>
        </italic>
      </p>
      <p> The rationale was explained (it makes Euclidean distance a function of correlation). We have added one more sentence to the revised article.</p>
      <p>
        <italic>
          <bold>4. The 'fry' command failed for me, producing the error:</bold>
        </italic>
      </p>
      <p> There was no DGEList method for fry in the Bioconductor 3.2.</p>
    </body>
  </sub-article>
</sub-article>
<sub-article id="report14473" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.9667.r14473</article-id>
    <title-group>
      <article-title>Referee response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Burden</surname>
          <given-names>Conrad J.</given-names>
        </name>
        <xref ref-type="aff" rid="r14473a1">1</xref>
        <xref ref-type="aff" rid="r14473a2">2</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r14473a1"><label>1</label>Mathematical Sciences Institute, Australian National University, Canberra, ACT, Australia</aff>
      <aff id="r14473a2"><label>2</label>Research School of Biology, Australian National University, Canberra, ACT, Australia</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>29</day>
      <month>6</month>
      <year>2016</year>
    </pub-date>
    <related-article id="d35e6818" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.8987.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>There are two main contenders for off-the-shelf software packages for detecting differential expression from RNA-Seq count data: edge R and DESeq2, both of which model over-dispersed count data with a negative binomial distribution. A complete work flow built around DESeq2 was published recently
<sup><xref rid="rep-ref-14473-1" ref-type="bibr">1</xref></sup>, and this is the analogous complete work flow, starting from raw sequence counts, for edgeR. The example given goes further in that it also includes an analysis right through to a molecular pathway analysis of the most highly differentially expressed genes.  </p>
    <p> The work flow is built around a number of edgeR functions which have been developed and improved over years. The most recent development is the inclusion of a method employed in an earlier package, called QuasiSeq, which combines a quasi-likelihood approach to estimating estimating over-dispersion with edgeR’s traditional approach of sharing information across genes. In my own review of packages designed for profiling differential expression from count data
<sup><xref rid="rep-ref-14473-2" ref-type="bibr">2</xref></sup> (cited as ref. 11 in this paper) I observed using synthetic data that QuasiSeq easily outperformed the then existing available packages in terms of accuracy of claimed p-values and false discovery rates. However, it did have the disadvantage of very poor performance in terms of speed. The functions glmQLFit() and glmQLFtest() in the current work flow perform the quasi-likelihood method, but have overcome the speed performance problem completely and run very rapidly. Incidentally I can confirm that I and my co-authors of
<sup><xref rid="rep-ref-14473-2" ref-type="bibr">2</xref></sup> have no particular connection with either the edgeR or DESeq groups, or the developers of QuasiSeq.  </p>
    <p> One problem I have with the example used in the workflow is that there are only two biological replicates in each condition. In ref.
<sup><xref rid="rep-ref-14473-2" ref-type="bibr">2</xref></sup> we observed using synthetic data that to get consistently accurate estimates of p-values and false discovery rates it is best to use at least 3 and preferably 4 biological replicates in each condition, even with QuasiSeq. See also the recent review by Schurch
<italic>et al.</italic>
<sup><xref rid="rep-ref-14473-3" ref-type="bibr">3</xref></sup> whose analysis recommends far more than two biological replicates in general with various software packages available at the time of their analysis. A similar independent analysis of the number of biological replicates recommended for the latest edgeR work flow would be welcome.  </p>
    <p> I have worked through the example given in the paper, starting with “Downloading the read counts” on page 4, working through to pathway analysis ending on page 20. I have not worked through the “Read alignment and quantification” section starting on page 22. In general I found the work flow easy to follow and informative.  I have made the following observations: 
<list list-type="order"><list-item><p>When I got to the line </p><p> y &lt;- DGEList(…, group=group, …)</p><p> on page 5, the parameter ‘group’ had not been set. I had to do a bit of detective work and, as a workaround, set it up using the following lines of code: </p><p>     </p><p> CellType &lt;- c(rep("B", 6), rep("L", 6))</p><p> Status &lt;- rep(c(rep("virgin", 2), rep("pregnant", 2), rep("lactating", 2)),2)</p><p> group &lt;- paste(CellType, Status, sep=".")</p><p> group &lt;- factor(group)</p><p> This should be fixed.</p></list-item><list-item><p>Suggestion: For ease of use, could calculating the TMM normalisation factors be built into the function DGEList()? If culling the low-count genes makes a noticeable difference, perhaps this could be done just as easily to the original data frame of counts before applying DGEList().</p></list-item><list-item><p>Regarding the diagnostic plot Figure 1, can it happen that the TMM normalisation doesn’t give an MD plot which is symmetric about zero? And if it does, is there a fix?</p></list-item><list-item><p>As a future enhancement, could a more user-friendly version of the differential expression analysis be made with estimateDisp(), glmQLFit() and glmQLFtest() all built into a single function? The point is that the job of the first two functions, i.e. calculating the trend dispersion and GLM coefficients, can’t be avoided anyway if you are a biologist wanting to do a differential expression analysis. For many users who are not familiar with the negative binomial model, the diagnostic plots of the BCV (Figure 3) and QL dispersion (Figure 4) are likely to be too arcane to be helpful. In fact the tagwise dispersions in Figure 3 are not actually used by the QL method.</p></list-item><list-item><p>A couple of trivial typos: </p><p> Page 5, 4th last line: “Genes that have with very low counts …”, remove “with”.</p><p> Caption to Figure 4: “trend show in Figure effig:plotBCV” should be “trend shown in Fig.3”</p><p> Page 16 last line: “B.pregant” should be B.pregnant”.</p></list-item></list>
</p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
  <back>
    <ref-list>
      <title>References</title>
      <ref id="rep-ref-14473-1">
        <label>1</label>
        <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Love</surname><given-names>MI</given-names></name><name><surname>Anders</surname><given-names>S</given-names></name><name><surname>Kim</surname><given-names>V</given-names></name><name><surname>Huber</surname><given-names>W</given-names></name></person-group>:
<article-title>RNA-Seq workflow: gene-level exploratory analysis and differential expression.</article-title><source><italic>F1000Res</italic></source>.<year>2015</year>;<volume>4</volume>:
<elocation-id>10.12688/f1000research.7035.1</elocation-id><fpage>1070</fpage><pub-id pub-id-type="doi">10.12688/f1000research.7035.1</pub-id><?supplied-pmid 26674615?><pub-id pub-id-type="pmid">26674615</pub-id></mixed-citation>
      </ref>
      <ref id="rep-ref-14473-2">
        <label>2</label>
        <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Burden</surname><given-names>CJ</given-names></name><name><surname>Qureshi</surname><given-names>SE</given-names></name><name><surname>Wilson</surname><given-names>SR</given-names></name></person-group>:
<article-title>Error estimates for the analysis of differential expression from RNA-seq count data.</article-title><source><italic>PeerJ</italic></source>.<year>2014</year>;<volume>2</volume>:
<elocation-id>10.7717/peerj.576</elocation-id><fpage>e576</fpage><pub-id pub-id-type="doi">10.7717/peerj.576</pub-id><?supplied-pmid 25337456?><pub-id pub-id-type="pmid">25337456</pub-id></mixed-citation>
      </ref>
      <ref id="rep-ref-14473-3">
        <label>3</label>
        <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schurch</surname><given-names>NJ</given-names></name><name><surname>Schofield</surname><given-names>P</given-names></name><name><surname>Gierliński</surname><given-names>M</given-names></name><name><surname>Cole</surname><given-names>C</given-names></name><name><surname>Sherstnev</surname><given-names>A</given-names></name><name><surname>Singh</surname><given-names>V</given-names></name><name><surname>Wrobel</surname><given-names>N</given-names></name><name><surname>Gharbi</surname><given-names>K</given-names></name><name><surname>Simpson</surname><given-names>GG</given-names></name><name><surname>Owen-Hughes</surname><given-names>T</given-names></name><name><surname>Blaxter</surname><given-names>M</given-names></name><name><surname>Barton</surname><given-names>GJ</given-names></name></person-group>:
<article-title>How many biological replicates are needed in an RNA-seq experiment and which differential expression tool should you use?</article-title>.
<source><italic>RNA</italic></source>.<year>2016</year>;<volume>22</volume>(<issue>6</issue>) :
<elocation-id>10.1261/rna.053959.115</elocation-id><fpage>839</fpage>-<lpage>51</lpage><pub-id pub-id-type="doi">10.1261/rna.053959.115</pub-id><?supplied-pmid 27022035?><pub-id pub-id-type="pmid">26527791</pub-id></mixed-citation>
      </ref>
    </ref-list>
  </back>
  <sub-article id="comment2100" article-type="response">
    <front-stub>
      <contrib-group>
        <contrib contrib-type="author">
          <name>
            <surname>Smyth</surname>
            <given-names>Gordon</given-names>
          </name>
          <aff>Walter and Eliza Hall Institute of Medical Research, Australia</aff>
        </contrib>
      </contrib-group>
      <author-notes>
        <fn fn-type="COI-statement">
          <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
        </fn>
      </author-notes>
      <pub-date pub-type="epub">
        <day>22</day>
        <month>7</month>
        <year>2016</year>
      </pub-date>
    </front-stub>
    <body>
      <p>Dear Conrad,</p>
      <p> Thank you for your thoughtful review and for your positive remarks about the performance of the quasi-likelihood pipeline.</p>
      <p> We understand that the code as given in the article would not run for you completely without the 'targets.txt' file that is read in the first code line. The whole LaTeX article and all the results are actually generated from a knitr Rnw file. The code and associated files have been submitted to Bioconductor as a workflow but are not yet available from the Bioconductor website. In the meantime, we have made the code and associated files available from our own website at
<ext-link ext-link-type="uri" xlink:href="http://bioinf.wehi.edu.au/edgeR/F1000Research2016">http://bioinf.wehi.edu.au/edgeR/F1000Research2016</ext-link>.</p>
      <p> We find TMM normalization works well for almost all regular gene expression studies. Different normalization methods are more appropriate for other technologies that yield a lot of zeros, for example single-cell RNA-seq, CRISPR, ChIP-seq and Hi-C. Discussion of those is beyond the scope of this article but we have added a couple of references. Note that the MD plot in Figure 1 does not need to be symmetric, as long as the majority of points cluster around the line, and the article now clarifies this point.</p>
      <p> Our preference is to provide a modular pipeline, encouraging analysts to examine the results at each step. For example, we can't decide whether filtering or TMM normalization is appropriate for a particular study at the time of forming the DGEList. We also like to encourage users to examine the BCV plot. We find this an informative diagnostic plot even as part of limma pipelines that do use the estimateDisp() results. On the other hand, if the number of samples was very large, one might choose to compute just the NB dispersion trend and not the tagwise values.</p>
      <p> Thanks for pointing out the typos. They will be fixed in the next revision.</p>
      <p> Regarding sample sizes, the minimum appropriate sample size depends very much on the context. For example, n=2 may be sufficient when comparing well sorted cell types from genetically identical mice whereas n=10 may not be not nearly enough when comparing whole blood for diseased vs normal patients. The repeatability of the results in our workflow is demonstrated by, among other things, the strong correlation between the current results and earlier microarray results on similar cell populations (Figure 9).</p>
      <p> For cutting edge biomedical experiments, RNA samples can be very difficult to obtain. While larger sample sizes are always preferable, our philosophy is to perform the best possible data analysis for any experiment that our colleagues believe is scientifically worthwhile. It is our aim that edgeR-QL and limma should give statistically correct results for any sample size, even down to n=2 vs n=1. On this topic, we note that the current edgeR-QL code is more robust than the original QuasiSeq method when the sample sizes are very small. Note that QuasiSeq was based on our best understanding of the mathematics at the time of Lund et al (2012), but some important refinements have been added to the edgeR version since. Here is a very small simulated example with n=2 vs n=1 and no true differential expression. Here QuasiSeq gives FDR values as small as 0 or 0.01, whereas the smallest FDR from glmQLFTest is 0.97:</p>
      <p> &gt; y &lt;- matrix(rpois(10000*3,lambda=10),10000,3)</p>
      <p> &gt; library(QuasiSeq)</p>
      <p> &gt; design0 &lt;- matrix(1,3,1)</p>
      <p> &gt; design1 &lt;- cbind(1,c(0,1,1))</p>
      <p> &gt; design.list&lt;-vector("list",2)</p>
      <p> &gt; design.list[[1]] &lt;- design1</p>
      <p> &gt; design.list[[2]] &lt;- design0</p>
      <p> &gt; fit &lt;- QL.fit(y, design.list)</p>
      <p> &gt; res &lt;- QL.results(fit)</p>
      <p> &gt; lapply(res$Q.values, min)</p>
      <p> $QL</p>
      <p> [1] 0</p>
      <p> $QLShrink</p>
      <p> [1] 0.0138122</p>
      <p> $QLSpline</p>
      <p> [1] 0.01351794</p>
      <p> &gt; library(edgeR)</p>
      <p> Loading required package: limma</p>
      <p> &gt; dge &lt;- DGEList(counts=y)</p>
      <p> &gt; dge &lt;- estimateDisp(dge, design1)</p>
      <p> &gt; fit &lt;- glmQLFit(dge, design1)</p>
      <p> &gt; ql &lt;- glmQLFTest(fit)</p>
      <p> &gt; topTags(ql)</p>
      <p> Coefficient:   </p>
      <p>          logFC   logCPM        F      PValue       FDR</p>
      <p> 7645 -1.911573 6.981129 42.64028 0.008218779 0.9733061</p>
      <p> 4209  3.366857 6.640090 41.30839 0.008583583 0.9733061</p>
      <p> 4669  2.451686 7.159465 35.31776 0.010624873 0.9733061</p>
      <p> 8608 -1.645226 6.942654 34.64701 0.010904508 0.9733061</p>
      <p> 8402  2.224008 6.981127 33.15403 0.011573724 0.9733061</p>
      <p> 2152  2.173823 6.942653 32.70039 0.011790966 0.9733061</p>
      <p> 6240  2.568286 6.777594 32.50399 0.011887171 0.9733061</p>
      <p> 7053 -1.743023 6.777595 32.50192 0.011888190 0.9733061</p>
      <p> 6984  2.780434 6.942653 32.01302 0.012133576 0.9733061</p>
      <p> 6057 -1.964729 6.488089 30.77110 0.012797066 0.9733061</p>
    </body>
  </sub-article>
</sub-article>
