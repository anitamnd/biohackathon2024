<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Biol</journal-id>
    <journal-title-group>
      <journal-title>Genome Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1474-7596</issn>
    <issn pub-type="epub">1474-760X</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6859644</article-id>
    <article-id pub-id-type="publisher-id">1854</article-id>
    <article-id pub-id-type="doi">10.1186/s13059-019-1854-5</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Assessment of computational methods for the analysis of single-cell ATAC-seq data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Chen</surname>
          <given-names>Huidong</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Lareau</surname>
          <given-names>Caleb</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Andreani</surname>
          <given-names>Tommaso</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Vinyard</surname>
          <given-names>Michael E.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Garcia</surname>
          <given-names>Sara P.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Clement</surname>
          <given-names>Kendell</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Andrade-Navarro</surname>
          <given-names>Miguel A.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Buenrostro</surname>
          <given-names>Jason D.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1109-3823</contrib-id>
        <name>
          <surname>Pinello</surname>
          <given-names>Luca</given-names>
        </name>
        <address>
          <email>lpinello@mgh.harvard.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0386 9924</institution-id><institution-id institution-id-type="GRID">grid.32224.35</institution-id><institution>Molecular Pathology Unit, </institution><institution>Massachusetts General Hospital Research Institute, </institution></institution-wrap>Charlestown, MA 02129 USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0386 9924</institution-id><institution-id institution-id-type="GRID">grid.32224.35</institution-id><institution>Center for Cancer Research, </institution><institution>Massachusetts General Hospital, </institution></institution-wrap>Charlestown, MA 02129 USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">000000041936754X</institution-id><institution-id institution-id-type="GRID">grid.38142.3c</institution-id><institution>Department of Pathology, </institution><institution>Harvard Medical School, </institution></institution-wrap>Boston, MA 02115 USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.66859.34</institution-id><institution>Broad Institute of Harvard and MIT, </institution></institution-wrap>Cambridge, MA 02142 USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ISNI">000000041936754X</institution-id><institution-id institution-id-type="GRID">grid.38142.3c</institution-id><institution>Department of Stem Cell and Regenerative Biology, </institution><institution>Harvard University, </institution></institution-wrap>Cambridge, MA 02138 USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 1941 7111</institution-id><institution-id institution-id-type="GRID">grid.5802.f</institution-id><institution>Faculty of Biology, Computational Biology and Data Mining Lab, </institution><institution>Johannes Gutenberg University of Mainz, </institution></institution-wrap>55128 Mainz, Germany </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="ISNI">000000041936754X</institution-id><institution-id institution-id-type="GRID">grid.38142.3c</institution-id><institution>Department of Chemistry and Chemical Biology, </institution><institution>Harvard University, </institution></institution-wrap>Cambridge, MA 02142 USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>11</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>18</day>
      <month>11</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2019</year>
    </pub-date>
    <volume>20</volume>
    <elocation-id>241</elocation-id>
    <history>
      <date date-type="received">
        <day>4</day>
        <month>6</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>3</day>
        <month>10</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s). 2019</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold>This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">Recent innovations in single-cell Assay for Transposase Accessible Chromatin using sequencing (scATAC-seq) enable profiling of the epigenetic landscape of thousands of individual cells. scATAC-seq data analysis presents unique methodological challenges. scATAC-seq experiments sample DNA, which, due to low copy numbers (diploid in humans), lead to inherent data sparsity (1–10% of peaks detected per cell) compared to transcriptomic (scRNA-seq) data (10–45% of expressed genes detected per cell). Such challenges in data generation emphasize the need for informative features to assess cell heterogeneity at the chromatin level.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">We present a benchmarking framework that is applied to 10 computational methods for scATAC-seq on 13 synthetic and real datasets from different assays, profiling cell types from diverse tissues and organisms. Methods for processing and featurizing scATAC-seq data were compared by their ability to discriminate cell types when combined with common unsupervised clustering approaches. We rank evaluated methods and discuss computational challenges associated with scATAC-seq analysis including inherently sparse data, determination of features, peak calling, the effects of sequencing coverage and noise, and clustering performance. Running times and memory requirements are also discussed.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3">This reference summary of scATAC-seq methods offers recommendations for best practices with consideration for both the non-expert user and the methods developer. Despite variation across methods and datasets, SnapATAC, <italic>Cusanovich2018</italic>, and cisTopic outperform other methods in separating cell populations of different coverages and noise levels in both synthetic and real datasets. Notably, SnapATAC is the only method able to analyze a large dataset (&gt; 80,000 cells).</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>scATAC-seq</kwd>
      <kwd>Feature matrix</kwd>
      <kwd>Benchmarking</kwd>
      <kwd>Regulatory genomics</kwd>
      <kwd>Clustering</kwd>
      <kwd>Visualization</kwd>
      <kwd>Featurization</kwd>
      <kwd>Dimensionality reduction</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Chan Zuckerberg Initiative DAF</institution>
        </funding-source>
        <award-id>2018- 182734</award-id>
        <principal-award-recipient>
          <name>
            <surname>Pinello</surname>
            <given-names>Luca</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000051</institution-id>
            <institution>National Human Genome Research Institute</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R00HG008399</award-id>
        <principal-award-recipient>
          <name>
            <surname>Pinello</surname>
            <given-names>Luca</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>National Human Genome Research Institute (US)</institution>
        </funding-source>
        <award-id>R35HG010717</award-id>
        <principal-award-recipient>
          <name>
            <surname>Pinello</surname>
            <given-names>Luca</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2019</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par4">Individual cell types within heterogenous tissues coordinate to perform complex biological functions, many of which are not fully understood. Recent technological advances in single-cell methodologies have resulted in an increased capacity to study cell-to-cell heterogeneity and the underlying molecular regulatory programs that drive such variation.</p>
    <p id="Par5">To date, most single-cell profiling efforts have been performed via quantification of RNA by sequencing (scRNA-seq). While this provides snapshots of inter- and intra-cellular variability in gene expression, investigation of the <italic>epigenomic</italic> landscape in single cells holds great promise for uncovering an important component of the regulatory logic of gene expression programs. Enabled by advances in array-based technologies, droplet microfluidics, and combinatorial indexing through split-pooling [<xref ref-type="bibr" rid="CR1">1</xref>] (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a), single-cell Assay for Transposase Accessible Chromatin using sequencing (scATAC-seq) has recently overcome previous limitations of technology and scale to generate chromatin accessibility data for thousands of single cells in a relatively easy and cost-effective manner.
<fig id="Fig1"><label>Fig. 1</label><caption><p>Schematic overview of single-cell ATAC-seq assays and analysis steps. <bold>a</bold> Single-cell ATAC libraries are created from single cells that have been exposed to the Tn5 transposase using one of the following three protocols: (1) Single cells are individually barcoded by a split-and-pool approach where unique barcodes added at each step can be used to identify reads originating from each cell, (2) microfluidic droplet-based technologies provided by 10X Genomics and BioRad are used to extract and label DNA from each cell, or (3) each single cell is deposited into a multi-well plate or array from ICELL8 or Fluidigm C1 for library preparation. <bold>b</bold> After sequencing, the raw reads obtained in .fastq format for each single cell are mapped to a reference genome, producing aligned reads in .bam format. Finally, peak calling and read counting return the genomic position and the read count files in. bed and .txt format, respectively. Data in these file formats is then used for downstream analysis. <bold>c</bold> ATAC-seq peaks in bulk samples can generally be recapitulated in aggregated single-cell samples, but not every single cell has a fragment at every peak. A feature matrix can be constructed from single cells (e.g., by counting the number of reads at each peak for every cell). <bold>d</bold> Following the construction of the feature matrix, common downstream analyses including visualization, clustering, trajectory inference, determination of differential accessibility, and the prediction of <italic>cis</italic>-regulatory networks can be performed using the methods benchmarked in this manuscript</p></caption><graphic xlink:href="13059_2019_1854_Fig1_HTML" id="MO1"/></fig></p>
    <p id="Par6">However, the analysis of scATAC-seq data presents methodological challenges distinct from those of single-cell transcriptomic (scRNA-seq) data. The primary difficulty arises from a difference in the number of RNA vs DNA molecules available for profiling in single cells. While for an expressed gene several RNA molecules are present in a single cell, scATAC-seq assays profile DNA, a molecule which is present in only few copies per cell (two in a diploid organism). The low copy number results in an inherent per-cell data sparsity, where only 1–10% of expected accessible peaks are detected in single cells from scATAC-seq data (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S1), compared to 10–45% of expressed genes detected in single cells from scRNA-seq data [<xref ref-type="bibr" rid="CR2">2</xref>, <xref ref-type="bibr" rid="CR3">3</xref>]. This emphasizes the need to recover informative features from sparse data to assess variability between cells in scATAC-seq analyses. Further, determination of which features best define cell state is currently unclear.</p>
    <p id="Par7">The difference in readout (gene expression vs chromatin accessibility) has also motivated a variety of approaches to selecting informative features in scATAC-seq methods. While most processing pipelines share common upstream processing steps (i.e., alignment, peak calling, and counting; Fig. <xref rid="Fig1" ref-type="fig">1</xref>b), existing computational approaches differ in the way they obtain a feature matrix for downstream analyses. For example, some methods select features based on the sequence content of accessible regions (e.g., <italic>k</italic>-mer frequencies [<xref ref-type="bibr" rid="CR4">4</xref>, <xref ref-type="bibr" rid="CR5">5</xref>] or transcription factor (TF) motifs [<xref ref-type="bibr" rid="CR5">5</xref>]), whereas other methods select features based on the genomic coordinates of the accessible regions (e.g., extended promoter regions to determine chromatin activity surrounding genes [<xref ref-type="bibr" rid="CR4">4</xref>, <xref ref-type="bibr" rid="CR6">6</xref>]). Finally, the potential feature set in scATAC-seq, which includes genome-wide regions of accessible chromatin (Fig. <xref rid="Fig1" ref-type="fig">1</xref>c), is typically 10–20× the size of the feature set in scRNA-seq experiments (which is defined and limited by the number of genes expressed). This larger feature set could be valuable in distinguishing a wider variety of cell populations and inferring the dynamics underlying cell organization into complex tissues [<xref ref-type="bibr" rid="CR7">7</xref>]. However, the novelty and assay-specific challenges associated with these large-scale scATAC-seq datasets and the lack of analysis guidelines have resulted in diverging computational strategies to aggregate data across such an immense feature space with no clear indication as to which strategy or strategies are most advantageous.</p>
    <p id="Par8">Here, we provide the first benchmark assessment of computational methods for the analysis of scATAC-seq data. We discuss the impact of feature matrix construction strategies (e.g., sequence content-based vs genomic coordinates) on common downstream analysis, with a focus on clustering and visualization. This comprehensive survey of current available methods provides user-specific recommendations for best practices that aim to maximize inference capability for current and future scATAC-seq workflows. Importantly, we provide more than 100 well-documented Jupyter Notebooks (<ext-link ext-link-type="uri" xlink:href="https://github.com/pinellolab/scATAC-benchmarking/">https://github.com/pinellolab/scATAC-benchmarking/</ext-link>) to easily reproduce our analyses. We anticipate that this will be a valuable resource for future scATAC-seq benchmark studies.</p>
  </sec>
  <sec id="Sec2">
    <title>Results</title>
    <sec id="Sec3">
      <title>Benchmark framework</title>
      <p id="Par9">For this benchmarking study, we created an unbiased framework to qualitatively and quantitatively survey the ability of available scATAC-seq methods to featurize chromatin accessibility data. Using this framework we evaluated several datasets of divergent size and profiling technologies. Using widely accepted quantitative metrics, we explored how differences in feature matrix construction influence outcomes in exploratory visualization and clustering, two common downstream analyses. The general overview of our framework is presented in Fig. <xref rid="Fig2" ref-type="fig">2</xref>.
<fig id="Fig2"><label>Fig. 2</label><caption><p>Benchmarking workflow. Starting from aligned read files in .bam format, feature matrices were constructed using each method. The feature matrix construction techniques used by each method were grouped into four broad categories: <italic>define regions</italic>, <italic>count features</italic>, <italic>transformation</italic>, and <italic>dimensionality reduction</italic>. A colored dot under a technique indicates that the method (signified by the respective color in the legend on the right) uses that technique. For each method, feature matrix files (defined as columns as cells and rows as features) are calculated and used to perform hierarchical, Louvain, and k-means clustering analysis. For datasets with a ground truth such as FACS-sorting labels or known tissues, clustering evaluation was performed according to the adjusted Rand index (ARI), adjusted mutual information (AMI), and homogeneity (H) scores. For datasets without ground truth, the clustering solutions were evaluated according to a Residual Average Gini Index (RAGI), a metric that compares cluster separation based on known marker genes against housekeeping genes. Lastly, a final score is assigned to each method</p></caption><graphic xlink:href="13059_2019_1854_Fig2_HTML" id="MO2"/></fig></p>
      <p id="Par10">For this study, we collected public data from three published studies (aligned files in BAM format) and generated ten simulated datasets with various coverages and noise levels (see the “<xref rid="Sec28" ref-type="sec">Methods</xref>” section). To calculate feature matrices for downstream analysis, for each method, we followed the guidelines provided in the documentation in the original study or as suggested by the respective authors. After feature matrix construction, we used three commonly used clustering approaches (K-means, Louvain, and hierarchical clustering) [<xref ref-type="bibr" rid="CR8">8</xref>] and UMAP [<xref ref-type="bibr" rid="CR9">9</xref>] projection to find putative subpopulations and visualize cell-to-cell similarities for each method. Next, the quality of the clustering solutions was evaluated by adjusted Rand index (ARI), adjusted mutual information (AMI), and homogeneity (H) when FACS-sorting labels or tissues were available (gold standard) or by a proposed Gini-index-based metric called Residual Average Gini Index (RAGI) when only known marker genes were available (silver standard). Finally, based on these metrics, the methods were ranked by the quality of their clustering solutions across datasets.</p>
    </sec>
    <sec id="Sec4">
      <title>Methods overview and featurization of chromatin accessibility data</title>
      <p id="Par11">Several computational methods have been developed to address the inherent sparsity and high dimensionality of single-cell ATAC-seq data, including BROCKMAN [<xref ref-type="bibr" rid="CR5">5</xref>], chromVAR [<xref ref-type="bibr" rid="CR4">4</xref>], Cicero [<xref ref-type="bibr" rid="CR10">10</xref>], cisTopic [<xref ref-type="bibr" rid="CR11">11</xref>], <italic>Cusanovich2018</italic> [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR12">12</xref>, <xref ref-type="bibr" rid="CR13">13</xref>], Gene Scoring [<xref ref-type="bibr" rid="CR14">14</xref>], scABC [<xref ref-type="bibr" rid="CR15">15</xref>], Scasat [<xref ref-type="bibr" rid="CR16">16</xref>], SCRAT [<xref ref-type="bibr" rid="CR6">6</xref>], and SnapATAC [<xref ref-type="bibr" rid="CR17">17</xref>]. Based on the proposed workflow of each method, we computed different feature matrices defined as a features-by-cells matrix (e.g., read counts for each cell (columns) in a given open chromatin peak <italic>feature</italic> (rows)) that could then be readily used for downstream analyses such as clustering. Starting from single-cell BAM files, the feature matrix construction can be roughly summarized into four different common modules: <italic>define regions</italic>, <italic>count features</italic>, <italic>transformation</italic>, <italic>and dimensionality reduction</italic> as illustrated in Fig. <xref rid="Fig2" ref-type="fig">2</xref>. Not every method uses all steps; therefore, we provide below, a short summary of the strategies adopted by each method and a <italic>per module</italic> discussion to highlight key similarities and differences (for a more detailed description of each strategy, see the “<xref rid="Sec28" ref-type="sec">Methods</xref>” section).</p>
      <p id="Par12">Briefly, BROCKMAN [<xref ref-type="bibr" rid="CR5">5</xref>] represents genomic sequences by gapped k-mers (short DNA sequences of length <italic>k</italic>) within transposon integration sites and infers the variation in k-mer occupancy using principal component analysis (PCA). chromVAR [<xref ref-type="bibr" rid="CR4">4</xref>] estimates the dispersion of chromatin accessibility within peaks sharing the same feature, e.g., motifs or k-mers. Cicero [<xref ref-type="bibr" rid="CR10">10</xref>] calculates a gene activity score based on accessibility at a promoter region and the regulatory potential of peaks nearby. cisTopic [<xref ref-type="bibr" rid="CR11">11</xref>] applies latent Dirichlet allocation (LDA) (a Bayesian topic modeling approach commonly used in natural language processing) to identify cell states from topic-cell distribution and explore <italic>cis</italic>-regulatory regions from region-topic distribution. Previous approaches that utilize latent semantic indexing (LSI) (termed here as <italic>Cusanovich2018</italic> [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR12">12</xref>, <xref ref-type="bibr" rid="CR13">13</xref>]) first partition the genome into windows, normalize reads within windows using the term frequency-inverse document frequency transformation (TF-IDF), reduce dimensionality using singular value decomposition (SVD), and perform a first-round of clustering (referred to as “in silico cell sorting”) to generate clades and call peaks within them. Finally, the clusters are refined with a second-round of clustering after TF-IDF and SVD based on read counts in peaks. The Gene Scoring method [<xref ref-type="bibr" rid="CR14">14</xref>] assigns each gene an accessibility score by summarizing peaks near its transcription start site (TSS) and weighting them by an exponential decay function based on their distances to the TSS. scABC [<xref ref-type="bibr" rid="CR15">15</xref>] first calculates a global weight for each cell by taking into account the number of distinct reads in the regions flanking peaks (to estimate the expected background). Based on these weights, it then uses weighted k-medoids to cluster cells based on the reads in peaks. Scasat [<xref ref-type="bibr" rid="CR16">16</xref>] binarizes peak accessibility and uses multidimensional scaling (MDS) based on the Jaccard distance to reduce dimensionality before clustering. SCRAT [<xref ref-type="bibr" rid="CR6">6</xref>] summarizes read counts on different regulatory features (e.g., transcription factor binding motifs, gene TSS regions). SnapATAC [<xref ref-type="bibr" rid="CR17">17</xref>] segments the genome into uniformly sized bins and adjusts for differences in library size between cells using a regression-based normalization method; finally, PCA is performed to select the most significant components for clustering analysis.</p>
      <sec id="Sec5">
        <title>Define regions</title>
        <p id="Par13">An essential aspect of feature matrix construction is the selection of a set of regions to describe the data (e.g., putative regulatory elements such as peaks and promoters). Most methods described above, including chromVAR, Cicero, cisTopic, Gene Scoring, scABC, and Scasat, define regions based on peak calling from either a reference bulk ATAC-seq profile or an aggregated single-cell ATAC-seq profile. <italic>Cusanovich2018</italic>, as briefly mentioned above, instead of aggregating single cell to call peaks, first creates pseudo-bulk clades by performing hierarchical clustering on the TF-IDF and SVD transformed matrix using the top frequently accessible windows. Then, peaks are called by aggregating cells within each pseudo-bulk clade. In addition to relying on peaks, some methods have proposed different strategies. BROCKMAN uses the union of regions around transposon integration sites. <italic>Cusanovich2018</italic> (before in silico sorting) and SnapATAC segment the genomes into fixed-size bins (windows) and count features within each bin.</p>
      </sec>
      <sec id="Sec6">
        <title>Count features</title>
        <p id="Par14">Once feature regions are defined, raw features within these regions are counted. Note that some methods (e.g., chromVAR) may support the counting of multiple features. For cisTopic, <italic>Cusanovich2018</italic>, scABC, and Scasat, reads overlapping peaks are counted. For <italic>Cusanovich2018</italic> (before the in silico sorting step) and SnapATAC, reads overlapping bins are counted. k-mers are counted under peaks for chromVAR while gapped k-mers are counted for BROCKMAN around transposase cut sites. Similarly, transcription factor motifs (e.g., from the JASPAR database [<xref ref-type="bibr" rid="CR18">18</xref>]) can be used as features by counting reads overlapping their binding sites in peaks (chromVAR) or genome-wide (SCRAT). If pre-defined genomic annotations such as coding genes are given, Gene Scoring, Cicero, and SCRAT use gene TSSs as anchor points to calculate gene enrichment scores based on reads nearby or just within peaks nearby.</p>
      </sec>
      <sec id="Sec7">
        <title>Transformation</title>
        <p id="Par15">After building the initial raw feature matrix using the counting step, different transformation methods can be performed. Binarization of read counts is used by five out of the ten evaluated methods: Cicero, cisTopic, <italic>Cusanovich2018</italic>, Scasat, and SnapATAC (Fig. <xref rid="Fig2" ref-type="fig">2</xref>). This step is based on the assumption that each site is present at most twice (for diploid genomes) and that the count matrix is inherently sparse. Binarization is advantageous in alleviating challenges arising from sequencing depth or PCR amplification artifacts. SnapATAC and Scasat convert the binary count matrix into a cell-pairwise Jaccard index similarity matrix. <italic>Cusanovich2018</italic> normalizes the binary count matrix using the TF-IDF transformation. Cicero weights feature sites by their co-accessibility, while Gene Scoring weights sites by a decaying function based on its distance to a gene TSS. Both chromVAR and SnapATAC perform a read coverage bias correction to account for the influence of sample depth. chromVAR creates “background” peaks consisting of an equal number of peaks matched for both average accessibility and GC content to calculate bias-corrected deviation while SnapATAC uses a regression-based method to mitigate the coverage difference between cells. scABC also implements a similar step by calculating a weight for each cell, but these weights are not used to transform the matrix; instead they are used later in the clustering procedure. Both BROCKMAN and chromVAR compute <italic>z</italic>-scores to measure the gain or loss of chromatin accessibility across cells. SCRAT adjusts for both library size and region length.</p>
      </sec>
      <sec id="Sec8">
        <title>Dimensionality reduction</title>
        <p id="Par16">In the final step before downstream analysis, several methods apply different dimensionality reduction techniques to project the cells into a space of fewer dimensions. This step can refine the feature space mitigating redundant features and potential artifacts and potentially reducing the computation time of downstream analysis (Fig. <xref rid="Fig2" ref-type="fig">2</xref>). PCA is the most commonly used method (used by BROCKMAN, SnapATAC, and <italic>Cusanovich2018</italic>). cisTopic uses latent Dirichlet allocation (LDA) to generate two distributions including topic-cell distribution and region-topic distribution. Choosing the top topics based on the topic-cell distribution reduces the dimensionality. Scasat uses multidimensional scaling (MDS). When reviewing the different methods to include in our benchmark, we noticed that not all methods perform a dimensionality reduction step, which could skew the relative performance across methods. Therefore, for chromVAR, Cicero (gene activity score), Gene Scoring, scABC, and SCRAT, we considered, in addition to the original feature matrix, also a new feature matrix after PCA transformation, since this is a simple and commonly used technique for dimensionality reduction.</p>
        <p id="Par17">To better evaluate the effects of different modules including <italic>define regions</italic>, <italic>count features</italic>, <italic>transformation</italic>, and <italic>dimensionality reduction</italic>, we also considered a simple control method, referred to as Control-Naïve, by combining the most common and simple steps for building a feature matrix, i.e., counting reads within peaks to obtain a peaks-by-cells raw count matrix and then performing PCA on it (the number of top principal components was determined based on the elbow plot for all the methods). Since the feature matrix of scABC is also a peaks-by-cells raw count matrix, this matrix after PCA will correspond to the one obtained by the Control-Naïve method (to avoid redundancies, in our assessment, we refer to this matrix as Control-Naïve).</p>
        <p id="Par18">We also noticed that some methods might slightly diverge from the proposed four modules common framework. For example, Cicero calculates gene activity scores by first performing two transformations (binarize and weight features) and then performing the counting step around the annotated TSS. We believe the proposed modularization of the feature matrix construction can still serve as a useful framework to represent the core components of the different methods and provides an intuitive and informative summary of the diverse scATAC-seq methodologies.</p>
        <p id="Par19">Once dimensionality reduction is completed, the transformed feature matrix can be used for unbiased clustering, visualization, or other downstream analyses. Here, we have used the final feature matrices generated by each scATAC-seq analysis method and evaluated their performance in uncovering different populations by unsupervised clustering.</p>
      </sec>
    </sec>
    <sec id="Sec9">
      <title>Clustering approaches and metrics used for performance evaluation</title>
      <p id="Par20">This study employed three diverse types of commonly used unsupervised clustering methods for single-cell analysis [<xref ref-type="bibr" rid="CR8">8</xref>]: K-means clustering, hierarchical clustering, and the Louvain community detection algorithm (see the “<xref rid="Sec28" ref-type="sec">Methods</xref>” section).</p>
      <p id="Par21">Clustering results were evaluated by three commonly used metrics: adjusted Rand index (ARI), adjusted mutual information (AMI), and homogeneity, when a gold standard solution was available (known labels for the simulation data and FACS-sorted cell populations or known tissues for the real datasets). We propose a Gini-index-based metric called Residual Average Gini Index (RAGI), which was used to evaluate the clustering results when no ground truth was available and only a few marker genes were known by which populations could be discriminated (see the “<xref rid="Sec28" ref-type="sec">Methods</xref>” section). For each metric, we defined the <italic>clustering score</italic> as the highest score among the three clustering methods, i.e., the score which corresponded to the clustering solution that maximized the metric.</p>
      <p id="Par22">This framework allowed for benchmarking the ability of each strategy to featurize chromatin accessibility data and its impact on important downstream analyses such as clustering and visualization. The following sections present the results of this evaluation for all the above-described synthetic and real scATAC-seq datasets.</p>
    </sec>
    <sec id="Sec10">
      <title>Clustering performance on simulated datasets</title>
      <p id="Par23">We simulated 10 scATAC-seq datasets using available bulk ATAC-seq datasets with clear annotations from the bone marrow and erythropoiesis [<xref ref-type="bibr" rid="CR7">7</xref>, <xref ref-type="bibr" rid="CR19">19</xref>, <xref ref-type="bibr" rid="CR20">20</xref>] using varying noise levels and read coverages. Briefly, to generate the peaks-by-cells matrices, we defined a noise parameter (between 0 and 1) as the proportion of reads occurring in a random peak from one of the sorted populations. The remaining proportion of reads was distributed as a function of the bulk sample (see the “<xref rid="Sec28" ref-type="sec">Methods</xref>” section). A feature matrix with a noise level of 0 preserved perfectly the underlying cell type specificity of the reads within peaks. Conversely, a feature matrix with a noise level of 1 contained no information to discriminate cell types based on the reads within peaks. In our study, we considered three noise levels: no noise (0), moderate noise (0.2), and high noise (0.4). To better and more fairly evaluate the contribution of the core steps of each method (i.e., <italic>count features</italic>, <italic>transformation</italic>, and <italic>dimensionality reduction</italic>) regardless of the pre-processing steps usually excluded from these methods (reads filtering, alignment, peak calling, etc.)<italic>,</italic> we compared the performance of each method using a set of pre-defined peak regions from bulk ATAC-seq datasets. We selected the top 80,000 peaks based on the number of cells in which peaks were observed (each peak that was present in at least one cell) for all methods and all synthetic datasets.</p>
      <p id="Par24">Using the bulk ATAC-seq bone marrow dataset, we simulated five additional datasets to explore the effect of coverage on clustering performance (5000 fragments, 2500 fragments, 1000 fragments, 500 fragments, 250 fragments respectively per cell).</p>
      <p id="Par25">Each method was used to analyze all synthetic datasets as suggested in the method documentation (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Note S1 and Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S2).</p>
      <sec id="Sec11">
        <title>Simulated bone marrow datasets</title>
        <p id="Par26">We generated chromatin accessibility profiles (2500 fragments per cell) based on six different FACS-sorted bulk cell populations: hematopoietic stem cells (HSCs), common myeloid progenitor cells (CMPs), erythroid cells (Ery), and other three lymphoid cell types: natural killer cells (NK), CD4, and CD8 T cells (see Fig. <xref rid="Fig3" ref-type="fig">3</xref>a). We used ARI, AMI, and homogeneity metrics to compare the clustering solutions with the known cell type labels (Fig. <xref rid="Fig3" ref-type="fig">3</xref>b, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S3, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S1). The top three methods based on these simulation settings were cisTopic, <italic>Cusanovich2018</italic>, and SnapATAC. They performed equally well with no noise and moderate noise (with clustering scores close to 1.0) (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S3, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S2). At a noise level of 0.4, the methods showed more separation in performance accordingly to the three metrics (Fig. <xref rid="Fig3" ref-type="fig">3</xref>b, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S3). SnapATAC, <italic>Cusanovich2018</italic>, and cisTopic clearly outperformed the Control-Naïve method with consistently higher clustering scores across all metrics. Scasat performed slightly better than the Control-Naïve method, and the remaining methods underperformed relative to the Control-Naïve method. For scABC (i.e., peaks-by-cells raw count matrix), hierarchical clustering performs much better than the other two clustering methods. chromVAR performance using k-mers as features was superior to the approach using motifs. Another k-mer-based method, BROCKMAN, demonstrated similar performance to the k-mer-based chromVAR method. Motif-based SCRAT performed better than motif-based chromVAR. Both Cicero gene activity scores and Gene Scoring (which summarize the chromatin accessibility around coding annotations without a dimensionality reduction step) generally performed poorly. PCA boosted the performance of scABC, Cicero, and Gene Scoring. This step improved clustering performance regardless of the clustering method (also we noted again that scABC after PCA is equivalent to the Control-Naïve method), especially for the Louvain approach. PCA also slightly boosted the performance of the k-mer-based chromVAR but did not markedly improve the results of the motif-based chromVAR or SCRAT analyses.
<fig id="Fig3"><label>Fig. 3</label><caption><p>Benchmarking results in simulated bone marrow datasets at a noise level of 0.4 and a coverage of 2500 fragments. <bold>a</bold> Cell types used to create the simulated dataset. <bold>b</bold> Dot plot of scores for each metric to quantitatively measure the clustering performance of each method, sorted by maximum ARI score. <bold>c</bold> The two top-scoring pairings of scATAC-seq analysis method and clustering technique. Cell cluster assignments from each method are shown using the colors in the legend on the left. <bold>d</bold> UMAP visualization of the feature matrix produced by each method for the simulated dataset. Individual cells are colored indicating the cell type labels shown in <bold>a</bold></p></caption><graphic xlink:href="13059_2019_1854_Fig3_HTML" id="MO3"/></fig></p>
        <p id="Par27">We next investigated qualitatively the obtained clustering solutions, using the respective feature matrices to project the cells onto a 2-D space using UMAP and colored them based on the obtained clustering solutions (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4) or based on the true population labels used to generate the data (Fig. <xref rid="Fig3" ref-type="fig">3</xref>d). The top two clustering solutions based on the ARI (SnapATAC with k-means and SnapATAC with Louvain) are shown for ease of comparison (Fig. <xref rid="Fig3" ref-type="fig">3</xref>c).</p>
        <p id="Par28"><italic>Cusanovich2018</italic> and SnapATAC are the only two methods that clearly separated all six populations. cisTopic slightly mixed CD4 and CD8 T cells. Scasat and the Control-Naïve method failed to separate CD4 and CD8 T cell populations. BROCKMAN slightly mixed NK with CD4 and CD8 T cells and could not further separate CD4 and CD8 T cells. It also failed to clearly separate HSC and CMP. Both k-mer-based and motif-based chromVAR as well as SCRAT could only separate the Ery population while failing to separate HSC and CMP as well as CD4, CD8 T cells, and NK. The chromVAR k-mer-based method mixed HSC and CMP to a lesser extent compared to the motif-based method. There was no clear separation of cells using scABC (the peaks-by-cells raw count matrix), Cicero, or Gene Scoring. We observed that PCA clearly improved the separation of cell populations for Cicero and Gene Scoring. It also slightly improved the separation of CD4, CD8 T cells, and NK populations by k-mer-based chromVAR. No clear improvement was observed for the motif-based chromVAR or SCRAT methods. We further observed that a lack of visual separation of cell types in the UMAP plots (scABC, Cicero, and Gene Scoring), corresponded with substantial variation between the performances of the three clustering methods, showing better performance in the k-means clustering (Fig. <xref rid="Fig3" ref-type="fig">3</xref>b, d).</p>
        <p id="Par29">All methods except for <italic>Cusanovich2018</italic> and SnapATAC demonstrated declining performance with increased noise level (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figures S3, S5a). <italic>Cusanovich2018</italic> and SnapATAC were more robust to noise, showing no noticeable changes at increasing noise levels, while cisTopic was slightly more sensitive to noise; its performance dropped markedly when the noise level was increased to 0.4.</p>
        <p id="Par30">Next, the effect of the coverage on clustering performance was investigated. We progressively decreased the number of fragments per cell from a high coverage of 5000 fragments, to a medium coverage of 2500 fragments and 1000 fragments, then to a low coverage of 500 fragments, and finally to 250 fragments. The performance of all methods declined as coverage was decreased (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S5b, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S6, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Tables S4-S8). <italic>Cusanovich2018</italic>, SnapATAC, Scasat, and Control-Naïve are relatively robust to low coverage and outperform other methods. cisTopic worked well with high coverage but, in contrast to the above-listed methods, was more sensitive to lower coverages (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S6e).</p>
      </sec>
      <sec id="Sec12">
        <title>Simulated erythropoiesis datasets</title>
        <p id="Par31">Following the simulation of discrete sorted cell populations, we simulated three scATAC-seq datasets aimed at mimicking the continuous developmental erythropoiesis process and encompassing the following 12 populations: hematopoietic stem cells (HSCs), common myeloid progenitors (CMPs), megakaryocyte-erythroid progenitors (MEPs), multipotent progenitors (MPPs), myeloid progenitors (MyP), colony-forming unit-erythroid (CFU-E), proerythroblasts (ProE1), proerythroblasts (ProE2), basophilic erythroblasts (BasoE), polychromatic erytrhoblasts (PolyE), orthochromatic erythroblasts (OrthoE), and OrthoE and reticulocytes (Orth/Ret). These datasets were generated as before with three noise levels (0, 0.2, and 0.4) and with 2500 fragments per cell.</p>
        <p id="Par32">To first quantitatively evaluate the clustering solutions, we used ARI, AMI, and the homogeneity metrics (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S7 and Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S9). Without noise, SnapATAC, cisTopic BROCKMAN, <italic>Cusanovich2018</italic>, and Scasat consistently outperform the Control-Naïve across the three metrics (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S7a). chromVAR, as before, performs better using k-mers as features than when using motifs. SCRAT and scABC work as well as k-mer-based chromVAR. Again, methods such as Cicero and Gene Scoring that only summarize chromatin accessibility around TSS perform poorly. For scABC, Cicero, and Gene Scoring, we also notice that there are significant discrepancies between the three clustering methods, but their performances become similar after PCA (scABC after PCA is equivalent to the Control-Naïve method). Again, we observe that PCA can significantly improve the clustering performance of Louvain for scABC, Cicero, and Gene Scoring but not for chromVAR and SCRAT.</p>
        <p id="Par33">As before, to qualitatively assess population separation, we inspected UMAP projections applied to the noise-free simulated dataset (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S7a). In accordance with the quantitative comparison, cisTopic, <italic>Cusanovich2018</italic>, SnapATAC, and BROCKMAN demonstrate better performance in separating cell types compared to the Control-Naïve method and are able to further separate BasoE and PolyE. Moreover, SnapATAC can clearly distinguish CFU-E, ProE1, and ProE2 while cisTopic, <italic>Cusanovich2018</italic>, and BROCKMAN are only able to separate ProE2 out of these three populations. Scasat performs similarly to the Control-Naïve method. chromVAR with k-mers as features and SCRAT are able to isolate six major groups including HSCs-MPPs, CMP, MEP, MyP, CFU-E-ProE1-ProE2, and BasoE-PolyE-OrthoE-Orth/Ret. chromVAR with k-mers performs well in preserving the order of CFU-E-ProE1-ProE2 and BasoE-PolyE-OrthoE-Orth/Ret. SCRAT can further separate BasoE-PolyE from OrthoE-Orth/Ret while mixing up CFU-E-ProE1-ProE2. As before, we noticed that chromVAR using k-mers as features obtained a better separation of cell types than when using motifs. scABC is able to preserve well the order of major groups in a continuous way but fails to separate CFU-E-ProE1-ProE2 and OrthoE-Orth/Ret. Cicero gene activity score and Gene Scoring mixed different cell types, but after a simple PCA step, they clearly separate cells into three major groups. scABC did not perform well and produced small noisy clusters with different cell types mixed together.</p>
        <p id="Par34">As expected, we observed that increasing the level of noise resulted in clustering performance decrease and a decline of visual separation of cell types for all the methods (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S5c, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S7, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S10-S11). SnapATAC, cisTopic, and <italic>Cusanovich2018</italic> performed reasonably well when increasing the noise level, with SnapATAC the most robust among the three.</p>
      </sec>
    </sec>
    <sec id="Sec13">
      <title>Clustering performance on real datasets</title>
      <p id="Par35">Following the benchmark of the synthetic datasets, we assessed the performance of the methods on real datasets. These datasets were generated using different technologies: the Fluidigm C1 array [<xref ref-type="bibr" rid="CR21">21</xref>], the 10X Genomics droplet-based scATAC platform, and a recently optimized split-pool protocol [<xref ref-type="bibr" rid="CR1">1</xref>]. Each real dataset used was fundamentally different in its cellular makeup as well as size and subpopulation organization. Notably, as “true positive” labels are not always available, in addition to the metrics used on the simulated datasets, here we introduced the RAGI, a simple metric based on the Gini index that can be adopted when marker genes for the expected populations are known (see the “<xref rid="Sec28" ref-type="sec">Methods</xref>” section). In our assessment of <italic>Cusanovich2018</italic>, to make a fair comparison, we use first the same set of peaks used for other methods instead of the peaks called from its pseudo-bulk-based procedure. However, since this strategy may be important for the final clustering performance, the pseudo-bulk-based peak calling strategy is tested and discussed in a subsequent section.</p>
      <sec id="Sec14">
        <title>Buenrostro2018 dataset</title>
        <p id="Par36">The first and smallest dataset we used in our benchmarking contains single-cell ATAC-seq data from the human hematopoietic system (hereafter <italic>Buenrostro2018</italic>, [<xref ref-type="bibr" rid="CR21">21</xref>]). This dataset consists of 2034 hematopoietic cells that were profiled and FACS-sorted from 10 cell populations including hematopoietic stem cells (HSCs), multipotent progenitors (MPPs), lymphoid-primed multipotent progenitors (LMPPs), common myeloid progenitors (CMPs), and granulocyte-macrophage progenitors (GMPs), GMP-like cells, megakaryocyte-erythroid progenitors (MEPs), common lymphoid progenitors (CLPs), monocytes (mono) and plasmacytoid dendritic cells (pDCs). Figure <xref rid="Fig4" ref-type="fig">4</xref>a illustrates the roadmap of hematopoietic differentiation. For this dataset, the FACS-sorting labels are used as the gold standard. The analysis details for each method are documented in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Note S2.
<fig id="Fig4"><label>Fig. 4</label><caption><p>Benchmarking results using the <italic>Buenrostro2018</italic> scATAC-seq dataset. <bold>a</bold> Developmental roadmap of cell types analyzed. <bold>b</bold> Dot plot of scores for each metric to quantitatively measure the clustering performance of each method, sorted by maximum ARI score. <bold>c</bold> The two top-scoring pairings of scATAC-seq analysis method and clustering technique. UMAP visualization of the feature matrix produced by each method for the <italic>Buenrostro2018</italic> dataset. Individual cells are colored indicating the cell type labels shown in <bold>a</bold></p></caption><graphic xlink:href="13059_2019_1854_Fig4_HTML" id="MO4"/></fig></p>
        <p id="Par37">We started by evaluating the clustering solutions based on the feature matrices generated by the different methods. We used the same metrics used for the synthetic datasets: ARI, AMI, and homogeneity (Fig. <xref rid="Fig4" ref-type="fig">4</xref>b, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S12). cisTopic, <italic>Cusanovich2018</italic>, chromVAR, SnapATAC, and Scasat outperform the other methods across all three metrics. We also observed that chromVAR with k-mers or TF motifs and with or without PCA performs consistently well. As before, k-mer-based features work better than motif-based features. This can be also observed when comparing BROCKMAN, another k-mer-based method, with SCRAT, which is a motif-based method. TSS-based methods including Cicero and Gene Scoring did not perform well. Cicero requires a pre-processing step to assess cell similarity; poor performance might be due to the internally incorrectly inferred coordinates (our assessment used the t-SNE procedure as suggested in their documentation). Implementing PCA consistently improves the performance of scABC (as mentioned before, scABC after PCA is equivalent to the Control-Naïve method) and Cicero but does not impact the performance of chromVAR, SCRAT, and Gene Scoring. We also observed that for this dataset, the Louvain algorithm works consistently well across different metrics and methods and performs better than hierarchical clustering and k-means in almost all the cases.</p>
        <p id="Par38">We also qualitatively assessed the separation of different cell types by visualizing cells in UMAP projections based on the FACS-sorted labels (Fig. <xref rid="Fig4" ref-type="fig">4</xref>d) and clustering solutions (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S8). Figure <xref rid="Fig4" ref-type="fig">4</xref>c shows the best two combinations based on ARI: cisTopic with Louvain and <italic>Cusanovich2018</italic> with Louvain (the complete ranking is presented in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S12).</p>
        <p id="Par39">As Fig. <xref rid="Fig4" ref-type="fig">4</xref>d shows, in accordance with the clustering analyses, cisTopic, <italic>Cusanovich2018</italic>, Scasat, SnapATAC, and chromVAR can generally separate cell types and reasonably capture the expected hematopoietic hierarchy. cisTopic and SnapATAC show a clear and compact separation among groups, with SnapATAC recovering finer structure within each cell type cluster. chromVAR with k-mers or motifs corresponds to a more continuous progression of the different cell types. Control-Naïve and BROCKMAN perform comparably in distinguishing cell types and preserving the continuous hematopoietic differentiation. Cicero gene activity scores, SCRAT, and scABC show ambiguous patterns of distinct cell populations while Gene Scoring fails to separate different cell types. For Cicero gene activity score, after performing PCA, the separation of different cells is noticeably improved. For SCRAT, performing PCA does not show clear improvement.</p>
      </sec>
      <sec id="Sec15">
        <title>10 X Peripheral blood mononuclear cells (10X PBMCs) dataset</title>
        <p id="Par40">Next, we investigated a recent dataset produced by 10X Genomics profiling peripheral blood mononuclear cells (PBMCs) from a single healthy donor. In this dataset, 5335 single nuclei were profiled (~ 42 k read pairs per cell); no cell annotations are provided. Based on recent studies [<xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR22">22</xref>], we expected ~ 8 populations: CD34+, natural killer and dendritic cells, monocytes, lymphocyte B and lymphocyte T cells, together with terminally differentiated CD4 and CD8 cells. Therefore, we used 8 as the number of expected populations for the clustering procedures. The analysis details for each method are documented in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Note S3.</p>
        <p id="Par41">Several marker genes have been proposed to label the different populations or to annotate clustering solutions for PMBCs [<xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR22">22</xref>]. To measure cluster relevance based on these marker genes, we can annotate the clusters (or alternatively any group of cells) according to the accessibility values at those marker genes. In addition, accessibility at marker genes should be more variable between clusters than accessibility at housekeeping genes (since they should be, by definition, more equally expressed across different populations). Based on these ideas, we proposed and calculated the Residual Average Gini Index (RAGI) score (see the “<xref rid="Sec28" ref-type="sec">Methods</xref>” section) contrasting marker and housekeeping genes (Fig. <xref rid="Fig5" ref-type="fig">5</xref>a, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S13). For reasonable clustering solutions, we expect that the accessibility of marker genes defines clear populations corresponding to one or few clusters, whereas the accessibility of the housekeeping genes is broadly distributed across all the clusters.
<fig id="Fig5"><label>Fig. 5</label><caption><p>Benchmarking results using scATAC-seq data for 5k peripheral blood mononuclear cells (PBMCs) from 10X Genomics. <bold>a</bold> Dot plot of RAGI scores for each method, sorted by the maximum RAGI score. A positive RAGI value indicates that a method is able to produce a clustering of PBMCs in which chromatin accessibility of each marker gene is high in only a few clusters relative to the number of clusters with high accessibility of housekeeping genes. <bold>b</bold> UMAP visualization of the feature matrix produced by the top two methods (top row: SnapATAC, bottom row: chromVAR using k-mers). Chromatin accessibility of S100A12 (left, monocyte marker gene), MS4A1 (center, B cell marker gene), and GPDH (right, housekeeping gene) are projected onto the visualization. <bold>c</bold> UMAP visualization of the feature matrix produced by each method for the 5k PBMCs dataset from 10X Genomics. Individual cells are colored indicating cluster assignments using Louvain clustering</p></caption><graphic xlink:href="13059_2019_1854_Fig5_HTML" id="MO5"/></fig></p>
        <p id="Par42">As expected, methods with the highest performance, such as SnapATAC and chromVAR, showed a higher average accessibility for just one cluster for the same marker gene, while lower performing methods such as SCRAT or Gene Scoring showed higher average accessibility in multiple clusters for the same marker gene, further motivating the use of the RAGI metric (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S9). Figure <xref rid="Fig5" ref-type="fig">5</xref>b shows for the top two performing methods based on RAGI (SnapATAC and chromVAR with k-mers) the gene accessibility patterns for 3 genes (S100A12—monocyte-specific, MS4A1—B cell-specific, and GAPDH—housekeeping.) The same three genes are also shown in UMAP plots of the other methods (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S10). Again, we observed that Louvain algorithm performed better than k-means and hierarchical clustering for almost all scATAC-seq methods. Importantly, negative RAGI score for a method (see for example the solutions obtained by the Gene Scoring in Fig. <xref rid="Fig5" ref-type="fig">5</xref>a, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S10) may suggest that its clustering solutions are defined by housekeeping genes rather than informative marker genes.</p>
        <p id="Par43">We also qualitatively evaluated the clustering solutions of the different methods using UMAP projections (Fig. <xref rid="Fig5" ref-type="fig">5</xref>c, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S11). We observed two major groups for all methods except for scABC. Among these methods, the UMAP projections based on feature matrices obtained by Control-Naïve, cisTopic, <italic>Cusanovich2018</italic>, Scasat SnapATAC, BROCKMAN, and chromVAR showed additional smaller groups and finer structures. For Cicero gene activity scores, performing PCA helps to improve the separation of more putative cell types. Instead, for SCRAT and Gene Scoring, the PCA step did not improve the separation.</p>
        <p id="Par44">Given that the ranking of methods in datasets with ground truth is similar to the ranking based on the RAGI metric, we believe this simple approach is a reasonable surrogate metric that can be useful for evaluating unannotated datasets, a common scenario in single-cell omics studies.</p>
      </sec>
      <sec id="Sec16">
        <title>sci-ATAC-seq mouse dataset</title>
        <p id="Par45">The last dataset analyzed in our benchmark consists of sci-ATAC-seq data from 13 adult mouse tissues (bone marrow, cerebellum, heart, kidney, large intestine, liver, lung, pre-frontal cortex, small intestine, spleen, testes, thymus, and whole brain), of which 4 were analyzed in duplicate for a total of 17 samples and 81,173 single cells [<xref ref-type="bibr" rid="CR1">1</xref>]. Each tissue can be interpreted as a coarse ground truth, used later to evaluate clustering solutions (Fig. <xref rid="Fig6" ref-type="fig">6</xref>a). The analysis details for each method are documented in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Note S4.
<fig id="Fig6"><label>Fig. 6</label><caption><p>Benchmarking results using the downsampled sci-ATAC-seq mouse dataset from 13 adult mouse tissues. <bold>a</bold> schematic of 13 adult mouse tissues. Replicated tissues are indicated by “x2”. <bold>b</bold> Dot plot of scores for each metric to quantitatively measure the clustering performance of each method, sorted by maximum ARI score. <bold>c</bold> The two top-scoring pairings of scATAC-seq analysis method and clustering technique. Cell cluster assignments from each method are shown using the colors in the legend on the left. <bold>d</bold> UMAP visualization of the feature matrix produced by each method for the downsampled sci-ATAC-seq mouse dataset. Individual cell colors indicate the cell type</p></caption><graphic xlink:href="13059_2019_1854_Fig6_HTML" id="MO6"/></fig></p>
        <p id="Par46">Despite using a machine with 1 TB of RAM memory, almost all the methods failed to even load this dataset, owing to its size. The only method capable of processing this dataset in a reasonable time was SnapATAC (~ 700 min). The other methods failed to run due to memory requirements. To understand the causes of this failure, we did an in-depth analysis of their scalability looking at their source code (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Note S5). Briefly, we found that the majority of the methods try to load the entire dataset in the central memory while SnapATAC uses a custom file format (.snap) based on HDF5 (<ext-link ext-link-type="uri" xlink:href="https://support.hdfgroup.org/HDF5/whatishdf5.html">https://support.hdfgroup.org/HDF5/whatishdf5.html</ext-link>), allowing out of core computation by efficiently and progressively loading in the central memory only the data chunks required at any given moment of the analysis.</p>
        <p id="Par47">On this dataset, SnapATAC was able to correctly cluster cells of the following tissues: kidney, lung, heart, cerebellum, whole brain, and thymus. However, for the other tissues, including the bone marrow and small intestine, cells are distributed in groups of mixed cell types (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S12), as reflected by the score of the three metrics used for the other datasets’ evaluation (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S14), i.e., ARI = (HC = 0.24, k-means = 0.34, Louvain = 0.39), AMI = (HC = 0.55, k-means = 0.55, Louvain = 0.62), and homogeneity = (HC = 0.52, k-means = 0.54, Louvain = 0.60).</p>
        <p id="Par48">To gain insight on the performance of the other methods on this dataset, we randomly selected 15% of cells from each sample to construct a smaller sci-ATAC-seq dataset consisting of 12,178 cells.</p>
        <p id="Par49">As Fig. <xref rid="Fig6" ref-type="fig">6</xref>b shows <italic>Cusanovich2018</italic>, k-mer-based chromVAR, cisTopic, SnapATAC, Scasat, and Control-Naïve perform comparably well and have noticeably better clustering scores than the other methods (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S15). Consistent with what we observed previously, peak- or bin-level methods generally work better. In this dataset, k-mer-based chromVAR and its combination with PCA transformation performs equally well as peak- or bin-level methods and better than the motif-based methods. Simply counting reads within peaks (scABC) and gene-level-featurization-based methods (Gene Scoring and Cicero) perform poorly overall. Adding a PCA step improves noticeably scABC (scABC after PCA is the same as Control-Naïve) and Gene Scoring. It also slightly improves Cicero but it does not affect chromVAR and SCRAT.</p>
        <p id="Par50">As before, all the clustering solutions of the different methods were visualized in UMAP plots (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S13). The top two combinations, i.e., <italic>Cusanovich2018</italic> and chromVAR k-mers with PCA, are visualized in Fig. <xref rid="Fig6" ref-type="fig">6</xref>c. To visually compare the separation of the different tissues across methods, we also inspected UMAP plots where cells are colored based on the tissue of origin. Similar to what we observed using the clustering analysis, cisTopic, <italic>Cusanovich2018</italic>, and SnapATAC are able to separate cells into the major tissues and also to capture finer discrete groups. The Control-Naïve method and Scasat are also able to distinguish the major tissues but show some mixing within each discrete cell population. k-mer-based chromVAR can separate out liver, kidney, and heart tissues and present the other tissues within a continuous bulk population while preserving the structure of the distinct tissues. We observed that after running PCA, k-mer-based chromVAR can recover an additional group of cells within the lung tissue and also detect finer structure within the cells from the brain. Compared with k-mer-based features, motif-based chromVAR and its combination with PCA transformation distinguished fewer tissue groups while mixing more cells from different tissues. BROCKMAN recovered a continuous structure with the different tissues but does not distinguish them clearly. Similarly, Gene Scoring put cells from different tissues into a big bulk population with limited separation. PCA improved its ability to separate out a few tissues, including the liver, heart, and kidney. SCRAT and Cicero gene activity scores mixed most of the cells from different tissues and performed poorly on this dataset with or without PCA.</p>
      </sec>
    </sec>
    <sec id="Sec17">
      <title>Clustering performance summary</title>
      <p id="Par51">To assess and compare the overall performance of scATAC-seq analysis methods, we ranked the methods based on each metric (ARI, AMI, homogeneity, RAGI) by taking the best clustering solution for the three real datasets (<italic>Buenrostro2018</italic> dataset, 10X PBMCs dataset, and the downsampled <italic>sci-ATAC-seq mouse</italic> dataset) and two synthetic datasets (simulated bone marrow dataset and simulated erythropoiesis dataset with the moderate noise level of 0.2 and a medium coverage of 2500 fragments per cell). Then, for each dataset except for the 10X PBMC dataset, we calculated the average rank across ARI, AMI, and homogeneity. For the 10X PBMC dataset, RAGI is calculated instead (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S14a). Lastly, we calculated the average rank across different datasets. According to the average ranking, SnapATAC, cisTopic, and <italic>Cusanovich2018</italic> are the top three methods to create feature matrices that can be used to cluster single cells into biologically relevant subpopulations (Fig. <xref rid="Fig7" ref-type="fig">7</xref>a). SnapATAC consistently performed well across all datasets. Both cisTopic and <italic>Cusanovich2018</italic> demonstrated satisfactory performance across all datasets except for the 10X PBMCs dataset.
<fig id="Fig7"><label>Fig. 7</label><caption><p>Aggregate benchmark results. <bold>a</bold> For each method, the rank based on the best-performing clustering method is measured for each metric (e.g., ARI, AMI, H, or RAGI). The average metric ranks for each dataset were used to calculate a performance score for each method. Each method was then assigned a cumulative average score based on its performance across all datasets. The asterisk indicates a downsampled dataset of the indicated original dataset. <bold>b</bold> For methods that specify an end-to-end clustering pipeline, average rank and cumulative average scores for each method were calculated as in <bold>a</bold>. <bold>c</bold> Plot of running time against performance for each method. Cumulative average scores, which were calculated in part <bold>a</bold> are shown on the <italic>x</italic>-axis, and the average running time across the three real datasets (<italic>Buenrostro2018</italic>, 10X PBMCs, and downsampled sci-ATAC-seq mouse) is shown on the <italic>y</italic>-axis</p></caption><graphic xlink:href="13059_2019_1854_Fig7_HTML" id="MO7"/></fig></p>
      <p id="Par52">Generally, methods that implement a dimensionality reduction step work better (SnapATAC, cisTopic, <italic>Cusanovich2018</italic>, Scasat, Control-Naïve, and BROCKMAN) than those without it (SCRAT, scABC, Cicero, and Gene Scoring). We also observed that chromVAR performs better in real datasets than in simulated datasets and that the k-mer-based version of chromVAR consistently outperforms motif-based chromVAR. For the methods that do not implement dimensionality reduction, the PCA step does not always improve the performance except for scABC and Cicero, in which the PCA transformation consistently boosts the results. Interestingly, we observed that regardless of the method, the PCA consistently improves the clustering solutions obtained by the Louvain algorithm.</p>
      <sec id="Sec18">
        <title>Keeping the first PC vs removing the first PC</title>
        <p id="Par53">We noticed that in some cases, the first principal component (PC) may only capture variation in sequencing depth instead of biologically meaningful variability. To make a thorough assessment of how the first PC affects the clustering results, we compared the effect of keeping vs removing the first PC on the three real datasets (for this comparison, we consider both the methods that implemented PCA and the combination of PCA and the methods that did not implement a dimensionality reduction step) (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S15). Across all three datasets, we observe that for Control-Naïve, BROCKMAN, SCRAT-PCA, and Gene Scoring-PCA, removing the first PC consistently helped in better separating the different populations in UMAP projections and improved clustering performance. In contrast, the performance of chromVAR-PCA with motifs as features consistently dropped after removing the first PC. <italic>Cusanovich2018</italic> and SnapATAC performed similarly before and after removing the first PC across all datasets. For Cicero-PCA, removing the first PC did not clearly affect its performance in <italic>Buenrostro2018</italic> and 10X PBMCs datasets but improved its performance in the downsampled sci-ATAC mouse dataset.</p>
        <p id="Par54">Generally, the methods that implement binarization (e.g., <italic>Cusanovich2018</italic>, SnapATAC) or that implement cell coverage bias correction (e.g., chromVAR, SnapATAC) tend to be less affected by the sample sequencing depths. Therefore, for these methods, we believe that the first PC does not capture the library size and removing it does not help to improve the clustering results. On the contrary, for methods that do not implement any specific step to correct for potential artifacts associated with sequencing depth, the first PC is more likely to capture biologically irrelevant factors and therefore may reduce biology-driven differences. However, this operation must be applied with caution, since removing the first component could also in some cases remove some biological variation (e.g., motif-based chromVAR).</p>
      </sec>
      <sec id="Sec19">
        <title>Clustering performance when running methods as end-to-end pipelines</title>
        <p id="Par55">When designing this study, we reasoned that a benchmark procedure could be approached from two very different perspectives. The first is the end user perspective, i.e., a user that runs a method as a black box following the provided documentation with the goal to obtain a reasonable clustering solution without worrying too much about the internal design choices and procedures. In these settings, it is not trivial to systematically compare the methods and understand which part related to the featurization may influence the final clustering performance, especially if also the clustering algorithms used are different. The second perspective that was used instead in the rest of this benchmarking effort is the developer perspective, i.e., we tried to understand what are the key steps of each method that can boost clustering performance of common clustering approaches. Regardless, we reasoned that it is important to provide some insights on the user perspective, since some readers will use the tested methods as end-to-end pipelines. Therefore, we also compared the clustering solutions produced by running the complete analysis pipelines as outlined in tutorials for the methods that explicitly implement a clustering step (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Note S6). We evaluated the clustering results using ARI, AMI, and homogeneity for the <italic>Buenrostro2018</italic> and sci-ATAC-seq mouse datasets and RAGI for the 10X PBMCs dataset (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Tables S16-S18). We observe the top three methods, i.e., <italic>Cusanovich2018</italic>, cisTopic, and SnapATAC, still outperform the other methods but with a slightly different ranking (<italic>Cusanovich2018</italic> is ranked first followed by cisTopic and SnapATAC, Fig. <xref rid="Fig7" ref-type="fig">7</xref>b, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S14b). Also, both scABC and Cicero performed better than Scasat in this analysis. Interestingly, we observed that SnapATAC, cisTopic, <italic>Cusanovich2018</italic>, and Scasat have even better clustering solutions in our benchmarking framework compared to using their own clustering approach. On the other hand, scABC and Cicero had better clustering results when running their own clustering procedure. scABC uses an unsupervised clustering method tailored to single-cell epigenomic data (including scATAC-seq). Although it uses the naïve peaks-by-cells raw count as its feature matrix, it calculates cells’ weights by considering their sequencing coverage and giving more weight to cells with higher number of reads. Also, it performs two steps of clustering by using weighted k-medoid algorithm based on Spearman rank correlation to find landmarks first and then assigns cells to the landmarks. These specific steps help improve its clustering performance. For the Cicero clustering workflow, we used the gene activity scores and, as proposed in their tutorial, functions from Monocle2, to (i) normalize the scores and (ii) reduce the dimensionality with t-SNE by using the top PCs before clustering cells. These extra steps helped in improving its clustering solutions. This suggests that appropriate normalization steps need to be properly performed to improve clustering analysis, in addition to simple transformations like binarizing counts and/or performing a PCA.</p>
        <p id="Par56">Taken together, based on these analyses, we recommend using SnapATAC, cisTopic, or <italic>Cusanovich2018</italic> to cluster cells in meaningful subpopulations. This step can be followed by methods such as Cicero, Gene Scores, or with TF motifs (e.g., chromVar) to annotate clusters and to determine cell types in an integrative approach.</p>
      </sec>
    </sec>
    <sec id="Sec20">
      <title>Important considerations in defining informative regions for scATAC-seq analyses</title>
      <p id="Par57">Feature sets of informative peaks for scATAC analyses may be computed from bulk samples available through large-scale consortia such as ENCODE [<xref ref-type="bibr" rid="CR23">23</xref>] and ROADMAP [<xref ref-type="bibr" rid="CR24">24</xref>] or more precise tissue-specific cell types as in the murine ImmGen Project [<xref ref-type="bibr" rid="CR25">25</xref>]. However, scATAC-seq analyses often require de novo inference of dataset-specific accessibility peaks in order to resolve cell types and regulatory activity.</p>
      <p id="Par58">To date, there are three major methods for generating peak sets for scATAC experiments. The first strategy (pseudo-bulk from all single cells, PB-All) for inferring peaks is to call peaks on a pseudo-bulk sample composed of all the reads from all cells in the library. The second (pseudo-bulk from FACS, PB-FACS) is to call peaks in a priori-defined cell types isolated by FACS sorting. A consensus peak set can be defined by combining summits of individual peaks using an iterative algorithm [<xref ref-type="bibr" rid="CR7">7</xref>, <xref ref-type="bibr" rid="CR21">21</xref>, <xref ref-type="bibr" rid="CR26">26</xref>]. Finally, a third strategy (pseudo-bulk from clades, PB-Clades) uses a pre-clustering of cells to define initial populations [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR12">12</xref>]. Subsequent peak calling is performed in each initial cluster. Aggregate peak sets can then be defined from synthesizing the summits of each cluster-specific peak set as described above.</p>
      <sec id="Sec21">
        <title>Bulk ATAC-seq peaks vs aggregated scATAC-seq peaks</title>
        <p id="Par59">To evaluate the effect of using peaks obtained from bulk ATAC-seq data vs peaks obtained from aggregated single-cell profiles, we reanalyzed the <italic>Buenrostro2018</italic> dataset in which both are available (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figures S16-S17). Here, we considered only the methods that use peaks as input (i.e., SnapATAC, SCRAT, and BROCKMAN are excluded). For the aggregated scATAC-seq peaks, we merged cells of the same cell type based on the FACS sorting labels and performed peak calling within each cell type. Then, peaks defined within each cell type were merged. For most methods, we did not observe clear differences in performance between the two input peak strategies. For cisTopic, <italic>Cusanovich2018</italic>, and Cicero, aggregated scATAC-seq peaks overall perform better across all three metrics (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S18a, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S19).</p>
        <p id="Par60">We also tested the strategy of defining pseudo-bulk samples from clades when no sorting labels are provided. <italic>Cusanovich2018</italic> is the only method that provides a workflow to identify initial clades and call peaks within each clade. It counts reads within the fixed-size windows and pre-clusters cells using hierarchical clustering to define initial clades from which peaks are called. We applied this strategy to all three real datasets (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S19). We observed that in all three datasets, <italic>Cusanovich2018</italic> performs well in identifying the isolated major groups and the identified clades match well the labels provided, including FACS-sorted labels, cell-ranger clustering solutions, and known tissue labels. Overall, the <italic>Cusanovich2018</italic> “pseudo bulk” strategy for defining de novo peaks is able to capture the heterogeneity within single-cell populations and can serve as a promising unsupervised way to define pseudo-bulk subpopulations and to perform peak calling.</p>
      </sec>
      <sec id="Sec22">
        <title>The effect of excluding regions using the ENCODE blacklist annotation</title>
        <p id="Par61">Blacklisted regions are those features annotated by ENCODE as belonging to a subset of genomic regions, which harbor the potential to produce artifacts in downstream analyses. In order to assess the potential contribution that blacklist regions could have on the overall variation and population separability, we calculated (1) the proportions of reads mapped to blacklisted regions and (2) the proportions of bins with at least one read overlapping a blacklisted region vs the proportion of bins containing reads that do not overlap blacklist regions. Such a ratio corresponds closely to the feature set used by several of the evaluated methods.</p>
        <p id="Par62">We observed that for 10X Genomics and sci-ATAC-seq the percentage of reads mappable to blacklisted regions is only ~ 1%, while for the Fluidigm C1 based assay used in Buenrostro2018 is much higher, ~ 50%. However, when considering bins, only ~ 0.01–0.02% of bins with at least one read correspond to blacklist regions for all three technologies (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S20). This fraction of bins containing one or more reads in a blacklisted region is likely negligible, and we hypothesize that the variation in the signal from reads in blacklisted regions is similarly negligible.</p>
        <p id="Par63">It is worth noting that cisTopic, Scasat, SCRAT, and SnapATAC employ a blacklist filtering step to remove features annotated by ENCODE as belonging to a subset of genomic regions, which harbor the potential to produce artifacts in downstream analysis steps [<xref ref-type="bibr" rid="CR27">27</xref>]. Our benchmarking pipeline makes use of the ENCODE ATAC-seq pre-processing pipeline to call peaks, therefore the peaks overlapping with regions on the blacklist annotation list are already removed before implementing scATAC-seq methods.</p>
        <p id="Par64">SCRAT and SnapATAC do not use peaks as features; therefore, they are the only methods potentially affected by blacklist-mapped artifacts. We tested whether we would observe any change in downstream clustering performance upon opting to perform a blacklist removal step. Through a qualitative and quantitative comparison of clustering performance across the datasets generated by the three different technologies (10X Genomics, sci-ATAC, and Fluidigm C 1), we determined that methods, which remove features according to blacklist annotations show no considerable advantage over those that permitted such features (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S21).</p>
      </sec>
      <sec id="Sec23">
        <title>Rare cell type-specific peak detection</title>
        <p id="Par65">As all cell identities may not be pre-defined in complex tissue types, we sought to examine PB-All and PB-Clades strategies to infer a chromatin accessibility feature set from the scATAC-seq libraries directly. To achieve this, we established a simulation setting where we mixed bulk ATAC-seq data from three sorted populations (B cells, CD4+ T cells, and monocytes from the 10X PBMCs dataset) that would be mixed in complex tissue (i.e., peripheral blood mononuclear cells) (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S18b). After peak calling on both the synthetic bulk and isolated reads from each cell type, we inferred the proportion of cell type-specific peaks from the minor cell population that were captured by the peak calling in the synthetic bulk mixture (see the “<xref rid="Sec28" ref-type="sec">Methods</xref>” section).</p>
        <p id="Par66">Overall, the results indicate that cell type-specific peaks may be vastly underestimated from performing peak calling on the mixture of single cells (PB-All) (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S18b). Specifically, only ~ 18% of cell type-specific peaks from very rare (1% prevalence) or ~ 40% from rare (5% prevalence) cell populations were detected when peaks were called when treating the heterogenous source as a synthetic bulk experiment. Consequently, as these peaks would be vastly underrepresented in a consensus peak set, virtually all computational algorithms will fail to identify rare populations. Moreover, as many common quality-control measures for scATAC involve filtering based on the proportion of reads in peaks, these cell populations may be underrepresented in quality-controlled datasets.</p>
        <p id="Par67">As observed in other studies [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR28">28</xref>], these results suggest calling peaks on PB-All may result in suboptimal performance. Alternatively, when isolated populations have been profiled (for example by FACS), peak sets can be defined by calling peaks using data from cells in each pre-defined population separately as discussed in the previous section since this enables the resolution of rare subpopulations (for example HSC in the hematopoietic system).</p>
      </sec>
      <sec id="Sec24">
        <title>Frequency-based peak selection vs intensity-based peak selection</title>
        <p id="Par68"><italic>Cusanovich2018</italic> selects peaks that are present in at least a specified percentage of cells before performing TF-IDF transformation, while scABC selects peaks with the most reads to cluster cells. To evaluate the effect of selecting peaks based on their representation in the cell population or based on their intensity (defined as the sum of reads in that peak in all samples), we focus on the two methods that implement the step of peak selection, <italic>Cusanovich2018</italic> and Control-Naïve (equivalent to scABC+PCA).</p>
        <p id="Par69">To assess the two peak selection strategies, we ran both <italic>Cusanovich2018</italic> and Control-Naïve on both simulated bone marrow dataset at noise level of 0.2 with a coverage of 2500 fragments and the <italic>Buenrostro2018</italic> dataset by varying the cutoffs for peak inclusion (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figures S22-S23). We calculated the intensity of peaks by counting the number of reads across all cells and calculated the frequency of peaks by counting the number of cells in which a peak is observed. For this analysis, we selected the top peaks based on intensity and frequency with the following cutoffs: top 100%, 80%, 60%, 40%, 20%, 10%, 8%, 6%, 4%, 2%, and 1%.</p>
        <p id="Par70">For both <italic>Cusanovich2018</italic> and Control-Naïve, the two peak selection strategies have similar clustering result scores when varying the cutoff (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figures S22a-b, S23a-b). We observed reasonable and stable clustering performance using more than 20% of the ranked peaks. As the number of peaks is reduced, the scores start to decline noticeably and decrease almost monotonically. Below 1%, both methods perform poorly. In addition, we observed that the Louvain method produces more stable results than hierarchical clustering and k-means across the considered settings.</p>
      </sec>
    </sec>
    <sec id="Sec25">
      <title>Running time of different methods</title>
      <p id="Par71">In our analysis, we also collected the running time of each method on both simulated and real datasets (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Note S6). For the simulated datasets, we only reported the execution time necessary to build a feature matrix starting from a peaks-by-cells count matrix. For real datasets, we considered the execution time to build a feature matrix from bam files. The running times are shown in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S24 (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S20). All the tests were run on a machine with an Intel Xeon E5-2600 v4 X CPU with 44 cores and 1 TB of RAM with the CentOS 7 operating system. When analyzing real datasets with methods that rely on peaks but do not provide an explicit function to construct a peaks-by-cells matrix (<italic>Cusanovich2018</italic>, Cicero, Gene Scoring, and Scasat), we ran the same script on a Linux cluster to obtain the peaks-by-cells matrix such that the execution time of this step is equivalent across these methods. It is worthwhile to mention that not all the methods of this benchmark support parallel computing. For the methods that support parallel computing, including SnapATAC, chromVAR, and cisTopic, the execution time was reported using 10 cores. For the rest of the methods, we run them using a single core. We selected this number reasoning that a typical lab may not have access to a machine with 44 cores and instead may use a mid-size computing node with 8–12 cores. Notably, SnapATAC was the only method capable of processing the full sci-ATAC-seq mouse dataset (~ 80,000 single cells).</p>
      <p id="Par72">As shown in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S24, BROCKMAN and SCRAT have the largest execution times in all the real datasets while the methods that use a custom script to obtain a peaks-by-cells matrix tend to have shorter execution times (e.g., Scasat, <italic>Cusanovich2018</italic>, Gene Scoring).</p>
      <p id="Par73">We also assessed the scalability of methods with respect to the increasing coverage (250, 500, 1000, 2500, and 5000 fragments per peaks). We observe that with the increase of read coverage, for cisTopic, there is an exponential increase of the running time whereas for other methods, the running time stays stable or increases linearly (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S24, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S21).</p>
      <p id="Par74">Finally, we compared execution time vs clustering performance (Fig. <xref rid="Fig7" ref-type="fig">7</xref>c). Interestingly, the most accurate methods (SnapATAC, cisTopic, and <italic>Cusanovich2018</italic>) have a reasonable running time while outperforming the other methods for clustering quality across all the datasets. Considering the computational time as an important factor that must be carefully evaluated before the implementation of any bioinformatics pipeline, we believe that <italic>Cusanovich2018</italic> is the best in balancing clustering performance with execution time.</p>
    </sec>
  </sec>
  <sec id="Sec26">
    <title>Discussion</title>
    <p id="Par75">scATAC technologies enable the epigenetic profiling of thousands of single cells, and many computational methods have been developed to analyze and interpret this data. However, the sparsity of scATAC-seq datasets provides unique challenges that must be addressed in order to perform essential analyses such as cluster identification, visualization, and trajectory inference [<xref ref-type="bibr" rid="CR29">29</xref>, <xref ref-type="bibr" rid="CR30">30</xref>]. Moreover, the rapid technological innovations that facilitate profiling accessible chromatin landscapes of 10<sup>4</sup> or 10<sup>5</sup> cells provide additional computational challenges to efficiently store and analyze data.</p>
    <p id="Par76">In this study, we compared ten computational methods developed to construct informative feature matrices for the downstream analysis of scATAC-seq data. We developed a uniform processing framework that ranks methods based on their ability to discriminate cell types when combined with three common unsupervised clustering approaches, followed by evaluation of three well-accepted clustering metrics. We evaluated these methods on 13 datasets, three of those obtained using different technologies (Fluidigm C1, 10X, and sci-ATAC) and five consisting of simulated data with varying noise levels. These datasets comprise cells from different tissues in both mouse and human.</p>
    <p id="Par77">In addition to identifying various methodologies that perform optimally on real and simulated data, our benchmarking examination of scATAC-seq methodologies reveals general principles that will inform the development of future algorithms. First, peak-level or bin-level feature counting generally performs better in distinguishing different cell types followed in turn by k-mer-level, TF motif-level, and gene-centric-level summarization. We interpret this finding as an indication of the complexity of gene regulatory circuits where precise enhancer elements may have distinct functions that cannot be sufficiently approximated by sequence context or proximity to gene bodies alone. Second, we note that the methods that implement a dimensionality reduction step generally perform better in the separation of cell types, since this step may help to remove the redundancy between a large number of raw features and to mitigate the effect of noise. Third, for the methods that do not implement a dimensionality reduction step, simply adding a PCA step could significantly improve the clustering results. In fact, PCA generally boosts Louvain clustering results. For methods that do not account for the differing sequencing coverage of cells, the first PC could be used to capture and correct for sample depth differences. In this case, removing the first PC may improve the performance of these methods. Fourth, we observe that the Louvain method overall performs more consistently and accurately than k-means and hierarchical clustering. In contrast, k-means and hierarchical clustering are more sensitive to outliers and may result in suboptimal clustering solutions since some of clusters may correspond to single or few outlier cells. Fifth, the robustness of different methods to noise and coverage varies among different datasets. Among the top three methods, cisTopic is the most penalized by low coverage. Sixth, it was also observed that inappropriate transformations, such as log2 transformation and normalization based on region size as implemented in SCRAT, may impact negatively clustering performance.</p>
    <p id="Par78">We observe that many methods fail to scale to larger datasets, which are now available due to improvements in split-pool technology and droplet microfluidics. As technologies improve and individual labs and international consortia lead efforts to generate ever larger single-cell datasets, scalability will be an unavoidable goal of method developments on a par with accuracy. As many of our evaluated methods were designed in the context of data generated from the Fluidigm C1 platform (which produces ~ 10<sup>2</sup> cells), such approaches were often incapable of analyzing large datasets. In particular, the sci-ATAC-seq mouse dataset served as a useful resource to test the scalability of the methods that were benchmarked (~ 80,000 cells). Notably, our evaluation demonstrates that only SnapATAC was able to scale to process and analyze this large dataset. Future methods must be capable of processing datasets of this size especially adopting efficient data structures that allow out of core computing. Our findings reinforce the need for methods that not only are accurate but highly scalable for scATAC-seq data processing.</p>
    <p id="Par79">Defining regions is an important step in constructing feature matrices. Selecting informative regions generally improves downstream analyses such as clustering to capture heterogeneity within cell populations. Peak calling is a popular and straightforward way to define regions of interest. We observe that clustering performance is not generally impacted by using peaks defined from bulk ATAC-seq data vs using peaks obtained from aggregating single-cell data based on FACS-sorting labels. However, performing peak calling by simply pooling reads from single cells may obfuscate peaks specific to rare cell populations leading to failures in uncovering them. In addition, the <italic>Cusanovich2018</italic> approach to identify pseudo-bulk clades is a promising unsupervised way to perform in silico sorting without relying on FACS-sorting labels. This strategy potentially serves as a suitable way to preserve peaks specific to rare cell types. Also choosing an appropriate number of peaks is important for improving the downstream analysis (for example based on intensity/frequency-based given that they perform similarly).</p>
    <p id="Par80">We are aware of the current limitations in our benchmarking effort. We have compared single-cell ATAC-seq methods based on their ability to separate discrete cell populations; however, this might not be ideal when dealing with a continuous cell lineage landscape. We observe that chromVAR generally works better in preserving a continuous space while SnapATAC tends to break a putative landscape into discrete populations. The choice of method is ultimately case-specific and may be driven by the downstream application. For example, the feature matrix obtained by chromVAR may be more suitable for trajectory inference [<xref ref-type="bibr" rid="CR29">29</xref>] while the one obtained from SnapATAC may be more appropriate to better identify discrete and well-separated cell populations by clustering. We acknowledge also that not all tested methods were specifically designed to produce clustering results. For example, chromVAR, Cicero, and Gene Scoring were designed to determine important marker genes and their regulatory logic or to infer enriched TF binding sites within accessible chromatin regions. However, because clustering is a critical part of single-cell analysis and researchers frequently use output from all methods to produce clustering results [<xref ref-type="bibr" rid="CR1">1</xref>], we felt that evaluating the clustering abilities using feature matrices produced by each method was a useful measure. An additional limitation of our study is that it is impossible to create a simulation framework that models an experimental outcome with perfect accuracy. Several assumptions were made to enable our simulation of the data; these assumptions are described in the “<xref rid="Sec28" ref-type="sec">Methods</xref>” section, where we detail explicitly how the simulated data was generated.</p>
    <p id="Par81">Interestingly, we learnt that some combinations of feature matrices with the simple clustering approaches included in our benchmarking framework perform even better than the original combination proposed by the respective authors. This highlights the value of this dual-characterization (<italic>user</italic> vs <italic>designer perspective</italic>) and provides a summary of both perspectives to the readers.</p>
    <p id="Par82">We believe it is important to stress the distinction between biological realities and computational performance, especially in the context of unsupervised clustering. A big and critical assumption (or hope) of our field is that an unsupervised clustering procedure will provide clustering solutions that recapitulate different populations corresponding to different cell types/states. Given that for several real datasets the ground truth is not known, a current compromise during the exploratory clustering analysis is to use known marker genes, sorted populations, or known tissues to validate the clustering solutions based on classic metrics. If we embrace this assumption, keeping in mind that additional validation is required to truly delineate the subpopulation structure of a population of cells, the two views, biological and computational, can be reconciled. Our benchmark procedure is aimed to provide some guidelines based on explorative analyses that are currently adopted in several published papers.</p>
    <p id="Par83">Looking forward, due to the wealth of data being produced by new scATAC technologies, we hypothesize that more powerful machine learning frameworks may be able to uncover complex <italic>cis</italic> and <italic>trans</italic> relationships that define cell-cell relatedness. Specifically, we anticipate autoencoder-like models that integrate genomic sequence context, gene body positions, and precise accessible chromatin information will yield information-rich features and that more advanced manifold learning methods will help to remove redundancy and better preserve heterogeneity within single-cell populations. Such achievements may enable us to overcome the inherent sparsity and high dimensionality that characterizes scATAC-seq data.</p>
  </sec>
  <sec id="Sec27">
    <title>Conclusions</title>
    <p id="Par84">Our benchmarking results highlight SnapATAC, cisTopic, and <italic>Cusanovich2018</italic> as the top performing scATAC-seq data analysis methods to perform clustering across all datasets and different metrics. Methods that preserve information at the peak level (cisTopic, <italic>Cusanovich2018</italic>, Scasat) or bin level (SnapATAC) generally outperform those that summarize accessible chromatin regions at the motif/k-mer level (chromVAR, BROCKMAN, SCRAT) or over the gene body (Cicero, Gene Scoring). In addition, methods that implement a dimensionality reduction step (BROCKMAN, cisTopic, <italic>Cusanovich2018</italic>, Scasat, SnapATAC) generally show advantages over the other methods without this important step. SnapATAC is the most scalable method; it was the only method capable of processing more than 80,000 cells. <italic>Cusanovich2018</italic> is the method that best balances analysis performance and running time.</p>
    <p id="Par85">Based on the presented analyses, we showed that a few methods outperformed others in terms of clustering performances and running time. However, we believe that a method based on the combination of modules used in the best methods may outperform them. In support of this idea, we found that simply altering the normalization step or clustering approach significantly improved the downstream clustering performance of some methods. With this in mind, we believe it may be possible to build a “maybe best” scATAC-seq computational method by adopting the most impactful modules from the best-performing methods evaluated. Such modules include (1) defining features as peaks/fixed-size bins, (2) count peaks/bins + binarization/TF-IDF/coverage bias correction, (3) dimensionality reduction, and (4) community detection-based clustering. However, in exploring the best combination of modules to build such a method, it is important to consider the balance between clustering performance, running time, and memory requirements. Such practical considerations are key to enabling the analysis of large datasets.</p>
    <p id="Par86">Taken together, our manuscript provides a framework for evaluating and benchmarking new and existing methodologies as well as provides important guidelines for the analysis of scATAC-seq data. Importantly, we provide more than 100 well-organized and documented Jupyter notebooks to illustrate and reproduce all the analyses performed in this benchmarking work. We believe our systematic analysis could guide the development of computational approaches aimed at solving the remaining challenges associated with analyzing scATAC-seq datasets.</p>
  </sec>
  <sec id="Sec28">
    <title>Methods</title>
    <p id="Par87">Our assessment of methods was based on public scATAC-seq datasets made available in public repositories by the respective authors (see the “Availability of data and materials” section). As such, we refer to the original publications for further details on the experimental design and data pre-processing/alignment. For peak calling, we used the ENCODE pipeline (<ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/atac-seq/">https://www.encodeproject.org/atac-seq/</ext-link>) except for the 10X PBMCs data for which peaks were already available through the Cell Ranger pipeline optimized for this technology. Whenever changes were required for running a given method, those are noted in the respective sections.</p>
    <sec id="Sec29">
      <title>Datasets</title>
      <sec id="Sec30">
        <title>Human hematopoiesis I (Buenrostro et al. [<xref ref-type="bibr" rid="CR21">21</xref>])</title>
        <p id="Par88">This dataset comprised of 10 FACS-sorted cell populations from CD34<sup>+</sup> human bone marrow, namely, hematopoietic stem cells (HSCs), multipotent progenitors (MPPs), lymphoid-primed multipotent progenitors (LMPPs), common myeloid progenitors (CMPs), granulocyte-macrophage progenitors (GMPs), megakaryocyte-erythrocyte progenitors (MEPs), common lymphoid progenitors (CLPs), plasmacytoid dendritic cells (pDCs), monocytes, and an uncharacterized CD34<sup>+</sup> CD38<sup>−</sup> CD45RA<sup>+</sup> CD123<sup>−</sup> cell population. A total of 2034 cells from six human donors were used for analysis. A peak file (including 491,437 peaks) obtained from bulk ATAC-seq dataset was provided.</p>
      </sec>
      <sec id="Sec31">
        <title>sci-ATAC-seq mouse tissues (Cusanovich et al. [<xref ref-type="bibr" rid="CR1">1</xref>])</title>
        <p id="Par89">This dataset comprises cells from 13 tissues of adult mouse, namely, the bone marrow, cerebellum, heart, kidney, large intestine, liver, lung, prefrontal cortex, small intestine, spleen, testes, thymus, and whole brain, with over 2000 cells per tissue. A total of 81,173 cells from 5 mice were used for analysis. A subset was obtained by randomly downsampling 15% cells from each tissue and was comprised of 12,178 cells.</p>
      </sec>
      <sec id="Sec32">
        <title>Human hematopoiesis II (10X PBMCs)</title>
        <p id="Par90">This dataset is composed of peripheral blood mononuclear cells (PBMCs) from one healthy donor. A total of 5335 cells were used for analysis.</p>
      </sec>
      <sec id="Sec33">
        <title>Simulated scATAC-seq datasets</title>
        <p id="Par91">In order to evaluate and benchmark various approaches, we generated synthetic (labeled) data from downsampling 18 FACS-sorted bulk populations that were previously described [<xref ref-type="bibr" rid="CR19">19</xref>]. For ease of interpretation, we considered only 6 isolated populations (HSC, CMP, NK, CD4, CD8, erythroblast). For the erythropoiesis simulation, eight additional populations (P1–P8) originally described in [<xref ref-type="bibr" rid="CR20">20</xref>] were also considered.</p>
        <p id="Par92">Our simulation framework starts with a peak x cell type counts matrix (from bulk ATAC-seq) and generates a single-cell counts matrix (<italic>C</italic>) for an arbitrary number of synthetic single cells. Explicitly, for a simulated single cell <italic>j</italic> and corresponding peak <italic>i</italic> from bulk cell type <italic>t</italic>, we seek to generate <italic>c</italic><sub><italic>i</italic>, <italic>j</italic></sub> where <italic>c</italic><sub><italic>i</italic>, <italic>j</italic></sub> ∈ {0, 1, 2}, noting that these values correspond to possible observations in a diploid genome. Next, we define the rate (<inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {r}_i^t $$\end{document}</tex-math><mml:math id="M2" display="inline"><mml:msubsup><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2019_1854_Article_IEq1.gif"/></alternatives></inline-formula>) at which the peak <italic>i</italic> is prevalent in the bulk ATAC-seq data for cell type <italic>t</italic>. This rate is determined by the ratio of reads observed in peak <italic>i</italic> over the sum of all reads. Assuming a total of <italic>k</italic> peaks for the matrix <italic>C</italic> and for user-defined parameters <italic>q</italic> (noise parameter; <italic>q</italic> ∈ [0, 1]) and <italic>n</italic> (number of simulated fragments), we define <italic>c</italic><sub><italic>i</italic>, <italic>j</italic></sub> as follows:</p>
        <p id="Par93"><disp-formula id="Equa"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {c}_{i,j}\sim rbinom\left(2,{p}_i^t\right) $$\end{document}</tex-math><mml:math id="M4" display="block"><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>~</mml:mo><mml:mtext mathvariant="italic">rbinom</mml:mtext><mml:mfenced close=")" open="(" separators=","><mml:mn>2</mml:mn><mml:msubsup><mml:mi>p</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mfenced></mml:math><graphic xlink:href="13059_2019_1854_Article_Equa.gif" position="anchor"/></alternatives></disp-formula>where</p>
        <p id="Par94">
          <disp-formula id="Equb">
            <alternatives>
              <tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {p}_i^t=\left({r}_i^t\ \right)\left(\frac{1}{2}\ n\right)\left(1-q\right)+\left(1/k\right)\left(\frac{1}{2}\ n\right)(q) $$\end{document}</tex-math>
              <mml:math id="M6" display="block">
                <mml:msubsup>
                  <mml:mi>p</mml:mi>
                  <mml:mi>i</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:msubsup>
                <mml:mo>=</mml:mo>
                <mml:mfenced close=")" open="(">
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>r</mml:mi>
                      <mml:mi>i</mml:mi>
                      <mml:mi>t</mml:mi>
                    </mml:msubsup>
                    <mml:mspace width="0.25em"/>
                  </mml:mrow>
                </mml:mfenced>
                <mml:mfenced close=")" open="(">
                  <mml:mrow>
                    <mml:mfrac>
                      <mml:mn>1</mml:mn>
                      <mml:mn>2</mml:mn>
                    </mml:mfrac>
                    <mml:mspace width="0.25em"/>
                    <mml:mi>n</mml:mi>
                  </mml:mrow>
                </mml:mfenced>
                <mml:mfenced close=")" open="(">
                  <mml:mrow>
                    <mml:mn>1</mml:mn>
                    <mml:mo>−</mml:mo>
                    <mml:mi>q</mml:mi>
                  </mml:mrow>
                </mml:mfenced>
                <mml:mo>+</mml:mo>
                <mml:mfenced close=")" open="(">
                  <mml:mrow>
                    <mml:mn>1</mml:mn>
                    <mml:mo>/</mml:mo>
                    <mml:mi>k</mml:mi>
                  </mml:mrow>
                </mml:mfenced>
                <mml:mfenced close=")" open="(">
                  <mml:mrow>
                    <mml:mfrac>
                      <mml:mn>1</mml:mn>
                      <mml:mn>2</mml:mn>
                    </mml:mfrac>
                    <mml:mspace width="0.25em"/>
                    <mml:mi>n</mml:mi>
                  </mml:mrow>
                </mml:mfenced>
                <mml:mfenced close=")" open="(">
                  <mml:mi>q</mml:mi>
                </mml:mfenced>
              </mml:math>
              <graphic xlink:href="13059_2019_1854_Article_Equb.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p id="Par95">Intuitively, the parameter <inline-formula id="IEq2"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {p}_i^t $$\end{document}</tex-math><mml:math id="M8" display="inline"><mml:msubsup><mml:mi>p</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2019_1854_Article_IEq2.gif"/></alternatives></inline-formula> defines the probability that a count will be observed in peak <italic>i</italic> for a single cell. Additionally, <inline-formula id="IEq3"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {p}_i^t $$\end{document}</tex-math><mml:math id="M10" display="inline"><mml:msubsup><mml:mi>p</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2019_1854_Article_IEq3.gif"/></alternatives></inline-formula> can be decomposed into the sum two terms. As <italic>q</italic> → 0, the first term dominates, and the probability of observing a count in peak <italic>i</italic> is simply the scaled probability of the ratio of reads for that peak from the bulk ATAC-seq data (<inline-formula id="IEq4"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {r}_i^t $$\end{document}</tex-math><mml:math id="M12" display="inline"><mml:msubsup><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2019_1854_Article_IEq4.gif"/></alternatives></inline-formula>). Thus, when <italic>q</italic> = 0, the simulated data has no noise. Conversely, as <italic>q</italic> → 1, the second term dominates, and <inline-formula id="IEq5"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {p}_i^t $$\end{document}</tex-math><mml:math id="M14" display="inline"><mml:msubsup><mml:mi>p</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2019_1854_Article_IEq5.gif"/></alternatives></inline-formula> reduces to a flat probability that is no longer parameterized by the peak <italic>i</italic> or cell type <italic>t</italic> and thus represents a random distribution of <italic>n</italic> fragments into <italic>k</italic> peaks.</p>
        <p id="Par96">The noise level we simulated attempts to mimic the non-specific cutting from Tn5. To give a sense of the range of this parameter on real data, we considered simply the number of reads falling outside peaks over the total number of reads (excluding blacklisted regions). This calculation assumes that reads in regions defined as peaks by a bulk or pseudo-bulk measurement will be dominated by specific cutting and that regions outside peaks will be dominated by non-specific cutting. Using this approach, we estimated the following noise levels: 0.38 for the Buenrostro2018 dataset, 0.22 for the 10X PBMC dataset, and 0.62 for the sci-ATAC-seq mouse dataset. We would like to point out that these rates may be slightly underestimated; a more careful estimation would require one to consider the fact that, at any given region of the genome, reads could be observed from specific and non-specific cutting.</p>
        <p id="Par97">For bone marrow-based simulations, we simulated 200 cells per labeled cell type while for erythropoiesis-based simulation we simulated 100 cells per labeled cell type. Eventually, we have 1200 cells for each simulated dataset. In the base simulations, we parametrized <italic>n</italic> = 2500 fragments in peaks in expectation for all cells. For additional simulations that compared different data coverages, we set <italic>n</italic> to various values (5000, 2500, 1000, 500, and 250 respectively) to benchmark this effect. To evaluate the effect of noise in our simulation, we set <italic>q</italic> to three values (0, 0.2, 0.4) to benchmark the robustness to noise. At values of <italic>q</italic> &gt; 0.4, no method could reliably separate all the subpopulations. Finally, since our simulation started at the reads in the peak level, for some methods, the core algorithm associated with the method was extracted in order to benchmark it in this setting. Additionally, full code to reproduce these simulated dataset matrices has been made available with our online code resources.</p>
      </sec>
    </sec>
    <sec id="Sec34">
      <title>Peak calling</title>
      <p id="Par98">For real datasets, peaks were called using the ENCODE ATAC-seq processing pipeline (<ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/atac-seq">https://www.encodeproject.org/atac-seq</ext-link>). Briefly, single cells were aggregated into cell populations according to cell type, obtained either by FACS sorting or by tissue of origin. Peaks were called for each cell population and merged into a single file with bedtools [<xref ref-type="bibr" rid="CR31">31</xref>].</p>
    </sec>
    <sec id="Sec35">
      <title>Building the feature matrix</title>
      <sec id="Sec36">
        <title>BROCKMAN</title>
        <p id="Par99">This method starts by defining regions of interest, which will be scanned for <italic>k</italic>-mer content, as 50 bp windows around each transposon integration site and merging overlapping regions. Then, a frequency matrix of <italic>k</italic>-mers-by-cells is built by counting all possible gapped <italic>k</italic>-mers (for <italic>k</italic> from 1 to 8) within the previously defined windows. This frequency matrix is scaled so that each <italic>k</italic>-mer has mean 0 and standard deviation 1. Principal component analysis (PCA) is applied to the scaled <italic>k</italic>-mers-by-cells frequency matrix, and significant principal components (PCs) as estimated with the jackstraw method are selected to build a final feature matrix for downstream analyses.</p>
      </sec>
      <sec id="Sec37">
        <title>chromVAR</title>
        <p id="Par100">This method starts by counting reads under chromatin-accessible peaks in order to build a count matrix of peaks-by-cells (X). Then, a set of chromatin features such as transcription factor (TF) motifs or <italic>k</italic>-mers are considered. Reads mapping to each peak that contains a given TF motif (or k-mer) are counted in order to build a count matrix of motifs-by-cells or k-mers-by-cells (M). Moreover, a raw accessibility deviation matrix of motifs (or k-mers)-by-cells (Y) is generated by calculating the difference between M and the expected number of fragments based on X. Then, background peak sets are created for each motif (or k-mer) to remove technical confounders. Background motifs (or k-mers)-by-cells raw accessibility deviations are then used to calculate a bias-corrected deviation matrix and to compute a deviation <italic>z</italic>-score used for downstream analyses.</p>
      </sec>
      <sec id="Sec38">
        <title>cisTopic</title>
        <p id="Par101">This method starts by building a peaks-by-cells binary matrix by checking if a peak region is accessible, i.e., at least one read falls within the peak region. Then, latent Dirichlet allocation (LDA) is performed on this binary matrix, and two probability distributions are generated, a topics-by-cells probability matrix and a regions-by-topics probability matrix. The former is the final feature matrix for downstream analyses.</p>
      </sec>
      <sec id="Sec39">
        <title>Cicero</title>
        <p id="Par102">This method defines promoter peaks as the union of annotated TSS minus 500 base pairs and macs2 defined peaks around the TSS. It takes as input the peaks-by-cells binary matrix. It also requires either pseudo temporal ordering or coordinates in a low-dimensional space (t-SNE) so that cells can be readily grouped. It then computes the co-accessibility scores between sites using Graphical Lasso. To get the gene activity scores, it selects sites that are proximal to gene TSS or distal sites linked to them and weight them by their co-accessibility. Then, all the sites are summed and weighted according to their co-accessibility to produce a genes-by-cells feature matrix that is used in this benchmarking analysis.</p>
      </sec>
      <sec id="Sec40">
        <title>Gene Scoring</title>
        <p id="Par103">This method first constructs a peaks-by-cells count matrix and defines regions of interest as the 50 kb upstream and downstream of gene TSSs. Then, it finds the overlap between ATAC-seq peaks and TSS regions and the peaks are weighted by a function of the distance to the linked genes. Finally, the peaks-by-cells count matrix is converted into genes-by-cells weighted count matrix by multiplying the weighted peaks by genes matrix. The genes-by-cells weighted count matrix is the final feature matrix for downstream analyses.</p>
      </sec>
      <sec id="Sec41">
        <title>
          <italic>Cusanovich2018</italic>
        </title>
        <p id="Par104">This method starts by binning the genome into fixed-size windows (by default, 5 kbp), and building a binary matrix from evaluating whether any reads map to each bin. Bins that overlap ENCODE-defined blacklist regions are filtered out, and the top 20,000 most commonly used bins are retained. Then, the bins-by-cells binary matrix is normalized and rescaled using the term frequency-inverse document frequency (TF-IDF) transformation. Next, singular value decomposition (SVD) is performed to generate a PCs-by-cells LSI score matrix, which is used to group cells by hierarchical clustering into different clades. Within each clade, peak calling is performed on the aggregated scATAC-seq profiles, and identified peaks are combined into a new peaks-by-cells binary matrix. Finally, the new peaks-by-cells matrix is transformed with TF-IDF and SVD as before to get a matrix of PCs-by-cells, which is the final feature matrix for downstream analyses.</p>
      </sec>
      <sec id="Sec42">
        <title>scABC</title>
        <p id="Par105">This method starts by building a peaks-by-cells count matrix of read coverage within peak regions. Then, the weights of cells are calculated by a nonlinear transformation of the read coverage within the peak background, defined as a 500-kb region around peaks. Since the weights will be used as part of weighted K-medoids clustering to define cell landmarks and further perform finer re-clustering instead of normalizing the peaks-by-cells matrix, the feature matrix in scABC is defined as the peaks-by-cells count matrix.</p>
      </sec>
      <sec id="Sec43">
        <title>Scasat</title>
        <p id="Par106">This method first constructs a peaks-by-cells binary accessibility matrix by checking if at least one read overlaps with the peak region. Then Jaccard distance is computed based on the binary matrix to get a cells-by-cells dissimilarity matrix. Multidimensional scaling (MDS) is further performed to reduce the dimension and to generate the final feature matrix for downstream analysis.</p>
      </sec>
      <sec id="Sec44">
        <title>SCRAT</title>
        <p id="Par107">This method starts by aggregating reads from each cell according to different features (such as TF motifs or region of interest of each gene), and then building a count matrix of features-by-cells. The features-by-cells count matrix is normalized by library and region size to get the final feature matrix for downstream analyses.</p>
      </sec>
      <sec id="Sec45">
        <title>SnapATAC</title>
        <p id="Par108">This method starts by binning the genome into fixed-size windows (by default 5 kb) and estimating read coverage for each bin to build a bins-by-cells binary count matrix. Bins that overlap ENCODE-defined blacklist regions are filtered out, as well as those with exceedingly high or low <italic>z</italic>-scored coverage. Then, the bins-by-cell matrix is transformed into a cells-by-cells Jaccard index similarity matrix, which is further transformed by normalization and regressing out coverage bias between cells. Finally, PCA is applied to the normalized similarity matrix, and the top PCs are used to build a PCs-by-cells matrix that is the final feature matrix for downstream analyses.</p>
      </sec>
    </sec>
    <sec id="Sec46">
      <title>Clustering</title>
      <p id="Par109">For this study, we used three commonly used clustering methods: k-means, hierarchical clustering (with default ward linkage) as implemented in the scikit-learn library [<xref ref-type="bibr" rid="CR32">32</xref>], and Louvain clustering (a community detection-based method) [<xref ref-type="bibr" rid="CR33">33</xref>, <xref ref-type="bibr" rid="CR34">34</xref>] as implemented in Scanpy [<xref ref-type="bibr" rid="CR35">35</xref>]. For both hierarchical clustering and k-means, we set the number of clusters to the number of unique FACS-sorted labels or known tissues. In the 10X PBMCs scATAC-seq dataset, which lacks the FACS-sorted labels, we instead set the number of clusters to 8 since this is the expected number of populations based on previous studies [<xref ref-type="bibr" rid="CR22">22</xref>]. For the Louvain algorithm, we set the size of local neighborhood to 15 for all the datasets. Since Louvain method requires “resolution” instead of the number of clusters and different number of clusters will affect the clustering evaluation, to make the comparison fair, we use the binary search algorithm on the “resolution” (ranging from 0.0 to 3.0) to find the same number of clusters as the other two clustering methods. If the precise number of clusters did not match the desired value, the “resolution” value inducing the closest number of clusters to the desired value was used.</p>
    </sec>
    <sec id="Sec47">
      <title>Metrics for evaluating clustering results</title>
      <p id="Par110">To evaluate clustering solutions for datasets with a known ground truth (i.e., for each cell, we have a label that indicated the cell type), we used three well-established metrics: adjusted Rand index (ARI), mutual information, and homogeneity. Briefly, for the ARI, first, the Rand index (RI) is defined as a similarity measure between two clusters considering all pairs of samples assigned in the same or different clusters in the predicted and true clustering. Then, the raw RI score is adjusted for chance in the ARI score as described in the following formula:</p>
      <p id="Par111">
        <disp-formula id="Equc">
          <alternatives>
            <tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \mathrm{ARI}=\frac{\mathrm{RI}-E\left(\mathrm{RI}\right)}{\max \left(\mathrm{RI}\right)-E\left(\mathrm{RI}\right)} $$\end{document}</tex-math>
            <mml:math id="M16" display="block">
              <mml:mi>ARI</mml:mi>
              <mml:mo>=</mml:mo>
              <mml:mfrac>
                <mml:mrow>
                  <mml:mi>RI</mml:mi>
                  <mml:mo>−</mml:mo>
                  <mml:mi>E</mml:mi>
                  <mml:mfenced close=")" open="(">
                    <mml:mi>RI</mml:mi>
                  </mml:mfenced>
                </mml:mrow>
                <mml:mrow>
                  <mml:mo>max</mml:mo>
                  <mml:mfenced close=")" open="(">
                    <mml:mi>RI</mml:mi>
                  </mml:mfenced>
                  <mml:mo>−</mml:mo>
                  <mml:mi>E</mml:mi>
                  <mml:mfenced close=")" open="(">
                    <mml:mi>RI</mml:mi>
                  </mml:mfenced>
                </mml:mrow>
              </mml:mfrac>
            </mml:math>
            <graphic xlink:href="13059_2019_1854_Article_Equc.gif" position="anchor"/>
          </alternatives>
        </disp-formula>
      </p>
      <p id="Par112">where RI is the pre-computed Rand index and <italic>E</italic> is the expected Rand index.</p>
      <p id="Par113">Mutual information is a measure of the mutual dependence between two variables. The mutual information value is computed according to the following formula, where <italic>|Ui|</italic> is the number of the samples in cluster <italic>Ui</italic> and <italic>|Vj|</italic> is the number of the samples in cluster <italic>Vj:</italic>
<disp-formula id="Equd"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \mathrm{MI}\left(U,V\right)=\sum \limits_{i=1}^{\mid U\mid}\sum \limits_{j=1}^{\mid V\mid}\frac{\mid {U}_I\cap {V}_j\mid }{N}\log \frac{N\mid {U}_i\cap {V}_j\mid }{\mid {U}_i\Big\Vert {V}_j\mid } $$\end{document}</tex-math><mml:math id="M18" display="block"><mml:mi>MI</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:mi>U</mml:mi><mml:mi>V</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>U</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:munderover><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>V</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mi>U</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∣</mml:mo></mml:mrow><mml:mi>N</mml:mi></mml:mfrac><mml:mo>log</mml:mo><mml:mfrac><mml:mrow><mml:mi>N</mml:mi><mml:mo>∣</mml:mo><mml:msub><mml:mi>U</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∣</mml:mo></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mi>U</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="true">‖</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∣</mml:mo></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="13059_2019_1854_Article_Equd.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par114">The homogeneity score is used to check if the algorithm used for the clustering can assign to each cluster only samples belonging to a single class. Its value <italic>h</italic> is bounded between 0 and 1, and a low value indicates low homogeneity and vice versa. The score is computed as follows:
<disp-formula id="Eque"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ h=1-\frac{H\left({Y}_{\mathrm{true}}|{Y}_{\mathrm{pred}}\right)}{H\left({Y}_{\mathrm{true}}\right)} $$\end{document}</tex-math><mml:math id="M20" display="block"><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>H</mml:mi><mml:mfenced close=")" open="(" separators="|"><mml:msub><mml:mi>Y</mml:mi><mml:mtext>true</mml:mtext></mml:msub><mml:msub><mml:mi>Y</mml:mi><mml:mtext>pred</mml:mtext></mml:msub></mml:mfenced></mml:mrow><mml:mrow><mml:mi>H</mml:mi><mml:mfenced close=")" open="("><mml:msub><mml:mi>Y</mml:mi><mml:mtext>true</mml:mtext></mml:msub></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="13059_2019_1854_Article_Eque.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par115">where <italic>H</italic> (<italic>Y</italic><sub>true</sub><italic>|Y</italic><sub>pred</sub>) is the probability to assign true samples to a set of predicted samples, while <italic>H</italic> (<italic>Y</italic><sub>true</sub>) are the labels of the samples.</p>
      <p id="Par116">To evaluate clustering solutions for the 10X PBMCs dataset, we proposed a simple score called the Residual Average Gini Index (RAGI) and compared the accessibility of housekeeping genes with previously characterized marker genes [<xref ref-type="bibr" rid="CR22">22</xref>]. We reasoned that a good clustering solution should contain clusters that are enriched for accessibility of different marker genes, and each marker gene should be highly accessible in only one or a few clusters. First, to quantify the accessibility of each gene in each cell, we used the Gene Scoring approach described above. Briefly, the accessibility at each TSS is the distance-weighted sum of reads within or near the region. Second, to quantify the enrichment of each gene in each cluster of cells, we computed the mean of the accessibility values in all cells for each cluster. Third, based on the vector of mean accessibility values (one per cluster), we computed the Gini index [<xref ref-type="bibr" rid="CR36">36</xref>] for each marker gene. The Gini index measures how imbalanced the accessibility of a gene is across clusters. This score is bound by [0,1] where 1 means total imbalance (i.e., a gene is accessible in one cluster only) and 0 means no enrichment. This score has been previously used on scRNA-seq to perform clustering [<xref ref-type="bibr" rid="CR37">37</xref>, <xref ref-type="bibr" rid="CR38">38</xref>]. As a control, we also calculated the Gini index for a set of annotated housekeeping genes reported in <ext-link ext-link-type="uri" xlink:href="https://m.tau.ac.il/~elieis/HKG/HK_genes.txt">https://m.tau.ac.il/~elieis/HKG/HK_genes.txt</ext-link>. Housekeeping genes should show minimal specificity for any given cluster since, by definition, they are highly expressed in all cells. Based on the set of Gini index values for marker and housekeeping genes, we calculated several metrics: (i) the mean Gini index for the two groups, (ii) the difference in means to assess the average residual specificity that a clustering solution has with respect to marker genes (this is our proposed RAGI metric), and (iii) the Kolmogorov-Smirnov statistic and its <italic>p</italic> value comparing the two groups of Gini indices for marker and housekeeping genes. We sorted the methods based on the descending order of the differences in means (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S13); a positive value indicates that the marker genes on average separate the clusters better than uninformative housekeeping genes.</p>
    </sec>
    <sec id="Sec48">
      <title>Rare cell type-specific peak analysis</title>
      <p id="Par117">FACS-sorted bulk ATAC-seq data was downloaded and processed from a previously described resource [<xref ref-type="bibr" rid="CR7">7</xref>]. For each simulation, we created a randomly sampled set of 200 million unique (PCR-deduplicated) reads, which roughly represents a complexity similar to recommendations from the 10X Chromium scATAC-seq solution. Cell type-specific peaks were defined using the full dataset for each of the three cell types. Peaks were called using macs2 callpeak with custom parameters as in the ENCODE pipeline, i.e., “<italic>--nomodel --shift - 100 --extsize 200</italic>” to account for Tn5 insertions rather than read abundance when inferring peaks. Overlaps between the isolated minor population and the synthetic mixtures were computed using GenomicRanges [<xref ref-type="bibr" rid="CR39">39</xref>] findOverlaps function, which is equivalent to bedtools [<xref ref-type="bibr" rid="CR31">31</xref>] overlap. For each minor population (B cell, CD4+ T cell, monocyte) and each prevalence (1, 5, 10, 20, 30%), each simulation was repeated 5 times for a total of 75 simulations. Reads from the other two (major) populations were sampled equivalently to make up the synthetic mixture for comparison.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec49">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="13059_2019_1854_MOESM1_ESM.7z">
            <caption>
              <p><bold>Additional file 1:</bold><bold>Figures S1–S24,</bold> Tables S1-S21, Supplementary Notes, and Supplementary figure legends</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="13059_2019_1854_MOESM2_ESM.7z">
            <caption>
              <p><bold>Additional file 2:</bold> Code to reproduce the analyses.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="13059_2019_1854_MOESM3_ESM.docx">
            <caption>
              <p><bold>Additional file 3:</bold> Review history.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>Caleb Lareau, Tommaso Andreani and Michael E. Vinyard contributed equally to this work.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p><bold>Supplementary information</bold> accompanies this paper at 10.1186/s13059-019-1854-5.</p>
  </sec>
  <ack>
    <sec id="FPar1">
      <title>Review history</title>
      <p id="Par118">The review history is available as Additional file <xref rid="MOESM3" ref-type="media">3</xref>.</p>
    </sec>
    <sec id="FPar2">
      <title>Additional information</title>
      <p id="Par119">Peer review information: Yixin Yao was the primary editor of this article and managed its editorial process and peer review in collaboration with the rest of the editorial team.</p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>HC and LP conceived this project and designed the framework with input from all the authors. HC and TA pre-processed the data. HC, CL, TA, MEV, SPG, and KC implemented scATAC-seq methods. HC and KC performed the clustering analysis. HC, TA, and LP performed the clustering validation. CL simulated the data. HC and CL analyzed the simulated data. LP and JDB provided guidance. All the authors wrote and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>This project has been made possible in part by grant number 2018-182734 to L.P. from the Chan Zuckerberg Initiative DAF, an advised fund of the Silicon Valley Community Foundation. L.P. is also partially supported by the National Human Genome Research Institute (NHGRI) Career Development Award (R00HG008399) and Genomic Innovator Award (R35HG010717).</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The source code and the supporting data for this study are available online on GitHub [<xref ref-type="bibr" rid="CR40">40</xref>]. All the results presented in this manuscript can be reproduced using the Jupyter notebooks available on GitHub and in the supplementary material (Additional file <xref rid="MOESM2" ref-type="media">2</xref>). For the analyzed real datasets, the <italic>Buentrostro2018</italic> dataset [<xref ref-type="bibr" rid="CR21">21</xref>] was downloaded from GEO accession GSE96772, the 10X PBMCs dataset was downloaded from <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/single-cell-atac/datasets/1.0.1/atac_v1_pbmc_5k">https://support.10xgenomics.com/single-cell-atac/datasets/1.0.1/atac_v1_pbmc_5k</ext-link>, and the sci-ATAC-seq mouse dataset [<xref ref-type="bibr" rid="CR1">1</xref>] was downloaded from <ext-link ext-link-type="uri" xlink:href="http://krishna.gs.washington.edu/content/members/ajh24/mouse_atlas_data_release/bams">http://krishna.gs.washington.edu/content/members/ajh24/mouse_atlas_data_release/bams</ext-link>. For the simulated bone marrow dataset, data for the FACS-sorted bulk ATAC-seq populations were downloaded from GEO accession GSE119453 [<xref ref-type="bibr" rid="CR19">19</xref>]. For the simulated erythropoiesis dataset, the additional populations were downloaded from GEO accession GSE115672 [<xref ref-type="bibr" rid="CR20">20</xref>].</p>
  </notes>
  <notes>
    <title>Ethics approval and consent to participate</title>
    <p id="Par120">Ethics approval was not needed for the study.</p>
  </notes>
  <notes notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par121">J.D.B. holds a patent for the invention of ATAC-seq. The other authors declare that they have no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cusanovich</surname>
            <given-names>DA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell atlas of in vivo mammalian chromatin accessibility</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <issue>5</issue>
        <fpage>1309</fpage>
        <lpage>1324</lpage>
        <?supplied-pmid 30078704?>
        <pub-id pub-id-type="pmid">30078704</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <mixed-citation publication-type="other">Mereu E, et al. Benchmarking single-cell RNA sequencing protocols for cell atlas projects. BioRxiv:630087v1. 2019.</mixed-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <mixed-citation publication-type="other">Ding J, et al. Systematic comparative analysis of single cell RNA-sequencing methods. BioRxiv:632216v2. 2019.</mixed-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schep</surname>
            <given-names>AN</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>chromVAR: inferring transcription-factor-associated accessibility from single-cell epigenomic data</article-title>
        <source>Nat Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <issue>10</issue>
        <fpage>975</fpage>
        <lpage>978</lpage>
        <?supplied-pmid 28825706?>
        <pub-id pub-id-type="pmid">28825706</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>de Boer</surname>
            <given-names>CG</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>BROCKMAN: deciphering variance in epigenomic regulators by k-mer factorization</article-title>
        <source>BMC Bioinformatics</source>
        <year>2018</year>
        <volume>19</volume>
        <issue>1</issue>
        <fpage>253</fpage>
        <?supplied-pmid 29970004?>
        <pub-id pub-id-type="pmid">29970004</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ji</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Ji</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Single-cell regulome data analysis by SCRAT</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <issue>18</issue>
        <fpage>2930</fpage>
        <lpage>2932</lpage>
        <?supplied-pmid 28505247?>
        <pub-id pub-id-type="pmid">28505247</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Corces</surname>
            <given-names>MR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Lineage-specific and single-cell chromatin accessibility charts human hematopoiesis and leukemia evolution</article-title>
        <source>Nat Genet</source>
        <year>2016</year>
        <volume>48</volume>
        <issue>10</issue>
        <fpage>1193</fpage>
        <lpage>1203</lpage>
        <?supplied-pmid 27526324?>
        <pub-id pub-id-type="pmid">27526324</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kiselev</surname>
            <given-names>Vladimir Yu</given-names>
          </name>
          <name>
            <surname>Andrews</surname>
            <given-names>Tallulah S.</given-names>
          </name>
          <name>
            <surname>Hemberg</surname>
            <given-names>Martin</given-names>
          </name>
        </person-group>
        <article-title>Challenges in unsupervised clustering of single-cell RNA-seq data</article-title>
        <source>Nature Reviews Genetics</source>
        <year>2019</year>
        <volume>20</volume>
        <issue>5</issue>
        <fpage>273</fpage>
        <lpage>282</lpage>
        <?supplied-pmid 30617341?>
        <pub-id pub-id-type="pmid">30617341</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McInnes</surname>
            <given-names>Leland</given-names>
          </name>
          <name>
            <surname>Healy</surname>
            <given-names>John</given-names>
          </name>
          <name>
            <surname>Saul</surname>
            <given-names>Nathaniel</given-names>
          </name>
          <name>
            <surname>Großberger</surname>
            <given-names>Lukas</given-names>
          </name>
        </person-group>
        <article-title>UMAP: Uniform Manifold Approximation and Projection</article-title>
        <source>Journal of Open Source Software</source>
        <year>2018</year>
        <volume>3</volume>
        <issue>29</issue>
        <fpage>861</fpage>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pliner</surname>
            <given-names>HA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cicero predicts cis-regulatory DNA interactions from single-cell chromatin accessibility data</article-title>
        <source>Mol Cell</source>
        <year>2018</year>
        <volume>71</volume>
        <issue>5</issue>
        <fpage>858</fpage>
        <lpage>871</lpage>
        <?supplied-pmid 30078726?>
        <pub-id pub-id-type="pmid">30078726</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bravo González-Blas</surname>
            <given-names>Carmen</given-names>
          </name>
          <name>
            <surname>Minnoye</surname>
            <given-names>Liesbeth</given-names>
          </name>
          <name>
            <surname>Papasokrati</surname>
            <given-names>Dafni</given-names>
          </name>
          <name>
            <surname>Aibar</surname>
            <given-names>Sara</given-names>
          </name>
          <name>
            <surname>Hulselmans</surname>
            <given-names>Gert</given-names>
          </name>
          <name>
            <surname>Christiaens</surname>
            <given-names>Valerie</given-names>
          </name>
          <name>
            <surname>Davie</surname>
            <given-names>Kristofer</given-names>
          </name>
          <name>
            <surname>Wouters</surname>
            <given-names>Jasper</given-names>
          </name>
          <name>
            <surname>Aerts</surname>
            <given-names>Stein</given-names>
          </name>
        </person-group>
        <article-title>cisTopic: cis-regulatory topic modeling on single-cell ATAC-seq data</article-title>
        <source>Nature Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <issue>5</issue>
        <fpage>397</fpage>
        <lpage>400</lpage>
        <?supplied-pmid 30962623?>
        <pub-id pub-id-type="pmid">30962623</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cusanovich</surname>
            <given-names>DA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The cis-regulatory dynamics of embryonic development at single-cell resolution</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>555</volume>
        <issue>7697</issue>
        <fpage>538</fpage>
        <lpage>542</lpage>
        <?supplied-pmid 29539636?>
        <pub-id pub-id-type="pmid">29539636</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cusanovich</surname>
            <given-names>DA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiplex single cell profiling of chromatin accessibility by combinatorial cellular indexing</article-title>
        <source>Science</source>
        <year>2015</year>
        <volume>348</volume>
        <issue>6237</issue>
        <fpage>910</fpage>
        <lpage>914</lpage>
        <?supplied-pmid 25953818?>
        <pub-id pub-id-type="pmid">25953818</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Lareau CA, et al. Droplet-based combinatorial indexing for massive-scale single-cell chromatin accessibility. Nat Biotechnol. 2019.</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zamanighomi</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Unsupervised clustering and epigenetic classification of single cells</article-title>
        <source>Nat Commun</source>
        <year>2018</year>
        <volume>9</volume>
        <issue>1</issue>
        <fpage>2410</fpage>
        <?supplied-pmid 29925875?>
        <pub-id pub-id-type="pmid">29925875</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baker</surname>
            <given-names>SM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Classifying cells with Scasat, a single-cell ATAC-seq analysis tool</article-title>
        <source>Nucleic Acids Res</source>
        <year>2019</year>
        <volume>47</volume>
        <issue>2</issue>
        <fpage>e10</fpage>
        <?supplied-pmid 30335168?>
        <pub-id pub-id-type="pmid">30335168</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <mixed-citation publication-type="other">Fang R, et al. Fast and accurate clustering of single cell epigenomes reveals cis-regulatory elements in rare cell types<italic>.</italic> BioRxiv:615179v2. 2019.</mixed-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mathelier</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>JASPAR 2016: a major expansion and update of the open-access database of transcription factor binding profiles</article-title>
        <source>Nucleic Acids Res</source>
        <year>2015</year>
        <volume>44</volume>
        <issue>D1</issue>
        <fpage>D110</fpage>
        <lpage>D115</lpage>
        <?supplied-pmid 26531826?>
        <pub-id pub-id-type="pmid">26531826</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ulirsch</surname>
            <given-names>Jacob C.</given-names>
          </name>
          <name>
            <surname>Lareau</surname>
            <given-names>Caleb A.</given-names>
          </name>
          <name>
            <surname>Bao</surname>
            <given-names>Erik L.</given-names>
          </name>
          <name>
            <surname>Ludwig</surname>
            <given-names>Leif S.</given-names>
          </name>
          <name>
            <surname>Guo</surname>
            <given-names>Michael H.</given-names>
          </name>
          <name>
            <surname>Benner</surname>
            <given-names>Christian</given-names>
          </name>
          <name>
            <surname>Satpathy</surname>
            <given-names>Ansuman T.</given-names>
          </name>
          <name>
            <surname>Kartha</surname>
            <given-names>Vinay K.</given-names>
          </name>
          <name>
            <surname>Salem</surname>
            <given-names>Rany M.</given-names>
          </name>
          <name>
            <surname>Hirschhorn</surname>
            <given-names>Joel N.</given-names>
          </name>
          <name>
            <surname>Finucane</surname>
            <given-names>Hilary K.</given-names>
          </name>
          <name>
            <surname>Aryee</surname>
            <given-names>Martin J.</given-names>
          </name>
          <name>
            <surname>Buenrostro</surname>
            <given-names>Jason D.</given-names>
          </name>
          <name>
            <surname>Sankaran</surname>
            <given-names>Vijay G.</given-names>
          </name>
        </person-group>
        <article-title>Interrogation of human hematopoiesis at single-cell and single-variant resolution</article-title>
        <source>Nature Genetics</source>
        <year>2019</year>
        <volume>51</volume>
        <issue>4</issue>
        <fpage>683</fpage>
        <lpage>693</lpage>
        <?supplied-pmid 30858613?>
        <pub-id pub-id-type="pmid">30858613</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Leif S. Ludwig, et al., Transcriptional states and chromatin accessibility underlying human erythropoiesis<italic>.</italic> Cell Reports. 2019;27(11):3228–40.e7.</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Buenrostro</surname>
            <given-names>JD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated single-cell analysis maps the continuous regulatory landscape of human hematopoietic differentiation</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>173</volume>
        <issue>6</issue>
        <fpage>1535</fpage>
        <lpage>1548</lpage>
        <?supplied-pmid 29706549?>
        <pub-id pub-id-type="pmid">29706549</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pliner</surname>
            <given-names>Hannah A.</given-names>
          </name>
          <name>
            <surname>Shendure</surname>
            <given-names>Jay</given-names>
          </name>
          <name>
            <surname>Trapnell</surname>
            <given-names>Cole</given-names>
          </name>
        </person-group>
        <article-title>Supervised classification enables rapid annotation of cell atlases</article-title>
        <source>Nature Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <issue>10</issue>
        <fpage>983</fpage>
        <lpage>986</lpage>
        <?supplied-pmid 31501545?>
        <pub-id pub-id-type="pmid">31501545</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Consortium</surname>
            <given-names>EP</given-names>
          </name>
        </person-group>
        <article-title>An integrated encyclopedia of DNA elements in the human genome</article-title>
        <source>Nature</source>
        <year>2012</year>
        <volume>489</volume>
        <issue>7414</issue>
        <fpage>57</fpage>
        <pub-id pub-id-type="pmid">22955616</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bernstein</surname>
            <given-names>BE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The NIH roadmap epigenomics mapping consortium</article-title>
        <source>Nat Biotechnol</source>
        <year>2010</year>
        <volume>28</volume>
        <issue>10</issue>
        <fpage>1045</fpage>
        <?supplied-pmid 20944595?>
        <pub-id pub-id-type="pmid">20944595</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yoshida</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The cis-regulatory atlas of the mouse immune system</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>176</volume>
        <issue>4</issue>
        <fpage>897</fpage>
        <lpage>912</lpage>
        <?supplied-pmid 30686579?>
        <pub-id pub-id-type="pmid">30686579</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stark</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Brown</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>DiffBind: differential binding analysis of ChIP-Seq peak data</article-title>
        <source>R Package Version</source>
        <year>2011</year>
        <volume>100</volume>
        <fpage>4</fpage>
        <lpage>3</lpage>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Amemiya</surname>
            <given-names>HM</given-names>
          </name>
          <name>
            <surname>Kundaje</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Boyle</surname>
            <given-names>AP</given-names>
          </name>
        </person-group>
        <article-title>The ENCODE blacklist: identification of problematic regions of the genome</article-title>
        <source>Sci Rep</source>
        <year>2019</year>
        <volume>9</volume>
        <issue>1</issue>
        <fpage>9354</fpage>
        <?supplied-pmid 31249361?>
        <pub-id pub-id-type="pmid">31249361</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satpathy</surname>
            <given-names>Ansuman T.</given-names>
          </name>
          <name>
            <surname>Granja</surname>
            <given-names>Jeffrey M.</given-names>
          </name>
          <name>
            <surname>Yost</surname>
            <given-names>Kathryn E.</given-names>
          </name>
          <name>
            <surname>Qi</surname>
            <given-names>Yanyan</given-names>
          </name>
          <name>
            <surname>Meschi</surname>
            <given-names>Francesca</given-names>
          </name>
          <name>
            <surname>McDermott</surname>
            <given-names>Geoffrey P.</given-names>
          </name>
          <name>
            <surname>Olsen</surname>
            <given-names>Brett N.</given-names>
          </name>
          <name>
            <surname>Mumbach</surname>
            <given-names>Maxwell R.</given-names>
          </name>
          <name>
            <surname>Pierce</surname>
            <given-names>Sarah E.</given-names>
          </name>
          <name>
            <surname>Corces</surname>
            <given-names>M. Ryan</given-names>
          </name>
          <name>
            <surname>Shah</surname>
            <given-names>Preyas</given-names>
          </name>
          <name>
            <surname>Bell</surname>
            <given-names>Jason C.</given-names>
          </name>
          <name>
            <surname>Jhutty</surname>
            <given-names>Darisha</given-names>
          </name>
          <name>
            <surname>Nemec</surname>
            <given-names>Corey M.</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Jean</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Li</given-names>
          </name>
          <name>
            <surname>Yin</surname>
            <given-names>Yifeng</given-names>
          </name>
          <name>
            <surname>Giresi</surname>
            <given-names>Paul G.</given-names>
          </name>
          <name>
            <surname>Chang</surname>
            <given-names>Anne Lynn S.</given-names>
          </name>
          <name>
            <surname>Zheng</surname>
            <given-names>Grace X. Y.</given-names>
          </name>
          <name>
            <surname>Greenleaf</surname>
            <given-names>William J.</given-names>
          </name>
          <name>
            <surname>Chang</surname>
            <given-names>Howard Y.</given-names>
          </name>
        </person-group>
        <article-title>Massively parallel single-cell chromatin landscapes of human immune cell development and intratumoral T cell exhaustion</article-title>
        <source>Nature Biotechnology</source>
        <year>2019</year>
        <volume>37</volume>
        <issue>8</issue>
        <fpage>925</fpage>
        <lpage>936</lpage>
        <?supplied-pmid 31375813?>
        <pub-id pub-id-type="pmid">31375813</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <mixed-citation publication-type="other">Chen, H., et al., Single-cell trajectories reconstruction, exploration and mapping of omics data with STREAM. Nat Commun. 2019;10(1):1903.</mixed-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qiu</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Reversed graph embedding resolves complex single-cell trajectories</article-title>
        <source>Nat Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <issue>10</issue>
        <fpage>979</fpage>
        <lpage>982</lpage>
        <?supplied-pmid 28825705?>
        <pub-id pub-id-type="pmid">28825705</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Quinlan</surname>
            <given-names>AR</given-names>
          </name>
          <name>
            <surname>Hall</surname>
            <given-names>IM</given-names>
          </name>
        </person-group>
        <article-title>BEDTools: a flexible suite of utilities for comparing genomic features</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <issue>6</issue>
        <fpage>841</fpage>
        <lpage>842</lpage>
        <?supplied-pmid 2832824?>
        <pub-id pub-id-type="pmid">20110278</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pedregosa</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Scikit-learn: machine learning in python</article-title>
        <source>J Mach Learn Res</source>
        <year>2011</year>
        <volume>12</volume>
        <issue>Oct</issue>
        <fpage>2825</fpage>
        <lpage>2830</lpage>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Blondel</surname>
            <given-names>VD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast unfolding of communities in large networks</article-title>
        <source>J Stat Mechanics</source>
        <year>2008</year>
        <volume>2008</volume>
        <issue>10</issue>
        <fpage>P10008</fpage>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Levine</surname>
            <given-names>JH</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Data-driven phenotypic dissection of AML reveals progenitor-like cells that correlate with prognosis</article-title>
        <source>Cell</source>
        <year>2015</year>
        <volume>162</volume>
        <issue>1</issue>
        <fpage>184</fpage>
        <lpage>197</lpage>
        <?supplied-pmid 26095251?>
        <pub-id pub-id-type="pmid">26095251</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol</source>
        <year>2018</year>
        <volume>19</volume>
        <issue>1</issue>
        <fpage>15</fpage>
        <?supplied-pmid 29409532?>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gini</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Concentration and dependency ratios</article-title>
        <source>Rivista di Politica Economica</source>
        <year>1997</year>
        <volume>87</volume>
        <fpage>769</fpage>
        <lpage>792</lpage>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>GiniClust: detecting rare cell types from single-cell gene expression data with Gini index</article-title>
        <source>Genome Biol</source>
        <year>2016</year>
        <volume>17</volume>
        <issue>1</issue>
        <fpage>144</fpage>
        <?supplied-pmid 27368803?>
        <pub-id pub-id-type="pmid">27368803</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tsoucas</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>GC</given-names>
          </name>
        </person-group>
        <article-title>GiniClust2: a cluster-aware, weighted ensemble clustering method for cell-type detection</article-title>
        <source>Genome Biol</source>
        <year>2018</year>
        <volume>19</volume>
        <issue>1</issue>
        <fpage>58</fpage>
        <?supplied-pmid 29747686?>
        <pub-id pub-id-type="pmid">29747686</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lawrence</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Software for computing and annotating genomic ranges</article-title>
        <source>PLoS Comput Biol</source>
        <year>2013</year>
        <volume>9</volume>
        <issue>8</issue>
        <fpage>e1003118</fpage>
        <?supplied-pmid 23950696?>
        <pub-id pub-id-type="pmid">23950696</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Chen, H., et al. Supporting data and source code for “Assessment of computational methods for the analysis of single-cell ATAC-seq data”. 2019; Available from: <ext-link ext-link-type="uri" xlink:href="https://github.com/pinellolab/scATAC-benchmarking/">https://github.com/pinellolab/scATAC-benchmarking/</ext-link>. Accessed 11 Nov 2019.</mixed-citation>
    </ref>
  </ref-list>
</back>
