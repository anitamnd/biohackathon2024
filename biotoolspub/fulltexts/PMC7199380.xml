<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Hereditas</journal-id>
    <journal-id journal-id-type="iso-abbrev">Hereditas</journal-id>
    <journal-title-group>
      <journal-title>Hereditas</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0018-0661</issn>
    <issn pub-type="epub">1601-5223</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7199380</article-id>
    <article-id pub-id-type="publisher-id">124</article-id>
    <article-id pub-id-type="doi">10.1186/s41065-020-00124-2</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ggroups: an R package for pedigree and genetic groups data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Nilforooshan</surname>
          <given-names>Mohammad Ali</given-names>
        </name>
        <address>
          <email>mohammad.nilforooshan@lic.co.nz</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Saavedra-Jiménez</surname>
          <given-names>Luis Antonio</given-names>
        </name>
        <address>
          <email>saavedra.jimenez.luis@gmail.com</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.466921.e</institution-id><institution-id institution-id-type="ISNI">0000 0001 0251 0731</institution-id><institution>Livestock Improvement Corporation, </institution></institution-wrap>Private Bag 3016, Hamilton, 3240 New Zealand </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.34684.3d</institution-id><institution-id institution-id-type="ISNI">0000 0004 0483 8492</institution-id><institution>Universidad Autónoma Chapingo, Departamento de Zootecnia, </institution></institution-wrap>México-Texcoco, Chapingo, C. P. 56230 Mexico </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>4</day>
      <month>5</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>4</day>
      <month>5</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2020</year>
    </pub-date>
    <volume>157</volume>
    <elocation-id>17</elocation-id>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>10</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>6</day>
        <month>3</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2020</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">R is a multi-platform statistical software and an object oriented programming language. The package archive network for R provides CRAN repository that features over 15,000 free open source packages, at the time of writing this article (<ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/packages">https://cran.r-project.org/web/packages</ext-link>, accessed in October 2019). The package ggroups is introduced in this article. The purpose of this package is providing functions for checking and processing the pedigree, calculation of the additive genetic relationship matrix and its inverse, which are used to study the population structure and predicting the genetic merit of animals. Calculation of the dominance relationship matrix and its inverse are also covered. A concept in animal breeding is genetic groups, which is about the inequality of the average genetic merits for groups of unknown parents. The package provides functions for the calculation of the matrix of genetic group contributions (<bold>Q</bold>). Calculating <bold>Q</bold> is computationally demanding, and depending on the size of the pedigree and the number of genetic groups, it might not be feasible using personal computers. Therefore, a computationally optimised function and its parallel processing alternative are provided in the package.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">Using sample data, outputs from different functions of the package were presented to illustrate a real experience of working with the package.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3">The presented R package is a free and open source tool mainly for quantitative geneticists and ecologists, who deal with pedigree data. It provides numerous functions for handling pedigree data, and calculating various pedigree-based matrices. Some of the functions are computationally optimised for large-scale data.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Pedigree</kwd>
      <kwd>Relationship matrix</kwd>
      <kwd>Inverse</kwd>
      <kwd>Genetic groups</kwd>
      <kwd>Dominance</kwd>
      <kwd>R</kwd>
    </kwd-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2020</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p>Pedigree information provides the principles of the traditional as well as modern animal breeding today. It provides key information about inheritance, rate of kinship between relatives, heritability and segregation of the phenotypic variance to genetic and non-genetic components, inbreeding, effective population size, population structure, and mating patterns. Pedigree information fitted into the pedigree relationship matrix (<bold>A</bold>) is used in the best linear unbiased prediction (BLUP) animal models [<xref ref-type="bibr" rid="CR1">1</xref>]. BLUP is a mixed model equation system involving fixed and random (including animal genetic) effects for the prediction of animals’ breeding values. With genomic information and genomic relationship matrices becoming available, <bold>A</bold> is still needed in recent genetic evaluation models, such as single-step genomic BLUP [<xref ref-type="bibr" rid="CR2">2</xref>, <xref ref-type="bibr" rid="CR3">3</xref>] and single-step marker effect model [<xref ref-type="bibr" rid="CR4">4</xref>]. The inverse of <bold>A</bold> is needed in BLUP, and matrix inversion is computationally challenging. Inverting a matrix has a cubic computational cost relative to the dimension of the matrix. Henderson [<xref ref-type="bibr" rid="CR5">5</xref>] and Quaas [<xref ref-type="bibr" rid="CR6">6</xref>] invented a method for indirect inversion of <bold>A</bold>, with a linear computational cost.</p>
    <p>Another concept in the genetic evaluation of animals is genetic groups (also called phantom parent groups). Genetic groups are for taking into account for the fact that unknown parents belong to different groups with different averages of genetic merit, depending on the birth year and the genetic background of the unknown parents. The recommended grouping strategy [<xref ref-type="bibr" rid="CR7">7</xref>] is based on the 4 pathways of selection (sire of sons, sire of daughters, dam of sons, and dam of daughters), and the birth year of the progeny of the unknown parent. Sufficient number of unknown parents are required in each group to make accurate inferences about the group effects. Therefore, subsequent years might be merged. For some species, grouping might involve the breed and regions within a country [<xref ref-type="bibr" rid="CR7">7</xref>]. With international genetic trade of genetic matrials, country of origin should be considered in forming genetic groups (e.g., in dairy cattle populations open to foreign genetic materials).</p>
    <p>The aim of this study is to introduce an R package (ggroups [<xref ref-type="bibr" rid="CR8">8</xref>]) for pedigree processing, obtaining pedigree-based parameters and matrices (including additive and dominance relationship matrices and their inverses), the contribution of genetic groups to the genetic merit of animals, and its correspondence matrix (<bold>Q</bold>).</p>
    <p>There are a few R packages that have functions similar to some of the functions in ggroups. However, these packages also provide different functionalities for different user needs. Therefore, the aim is not putting these R packages into comparison. Some packages are written in C or C++ to increase the speed. R package ggroups is written in R for better readability in a high-level language, which can be more helpful for educational purposes.</p>
  </sec>
  <sec id="Sec2">
    <title>Implementation and results</title>
    <p>In this section, the implementation of ggroups functions is explained with examples. This R package is available on CRAN (<ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org">https://cran.r-project.org</ext-link>) and can be installed in R, using the command install.packages(“ggroups”). The convention of package::function was used to address functions from other R packages. For presenting most of the functions, the example pedigree in Quaas [<xref ref-type="bibr" rid="CR9">9</xref>] was used:</p>
    <p>
      <graphic position="anchor" xlink:href="41065_2020_124_Figa_HTML" id="MO1"/>
    </p>
    <p>where, the columns correspond to animal, sire, and dam ID. Unknown parents a, b, c, d, and e were belonging to genetic groups, g1, g2, g2, g1, and g2, respectively. The results were presented to show a real experience of working with the package. Also, a pedigree of Mexican Braunvieh cattle (57,341 animals, 2,746 sires, 27,015 dams, 3,925 missing sires, and 3,258 missing dams) with 8 genetic groups was used for performance (runtime) testing. Where memory was a limitation (e.g., forming a 57,341 × 57,341 matrix), a subset of 3,000 animals (with 482 sires, 1,855 dams, 780 missing sires, and 704 missing dams) from this pedigree was used. Runtimes were measured on an octa-core Intel(R) Core(TM) i7-8650U with 16 Gb of RAM (Sys.i7-8650U.16).</p>
    <sec id="Sec3">
      <title>Pedigree renumbering</title>
      <p>The first step of working with a pedigree involves converting alpha-numeric identities to numeric identities and order the pedigree. Most genetic evaluations softwares require a numerical pedigree, where numeric IDs need to be ascending from parent to progeny. Therefore, it is important that the progeny ID is greater than the parent ID. The main reason is that, to build <bold>A</bold> or <bold>A</bold><sup>−1</sup>, animals should be ordered by parents preceding progeny. Function renum does renumbering and ordering the pedigree, so that progeny’s ID is greater than parent’s ID. Below, the example pedigree is used, with unknown parents replaced with the corresponding genetic groups:</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figb_HTML" id="MO2"/>
      </p>
      <p>The output is a list of 2 data frames. The first is the renumbered pedigree, and the second is the cross-reference with columns corresponding to the original and renumbered ID. To get each data.frame separately, use renum(ped)$newped and renum(ped)$xrf.</p>
      <p>Function orderPed from R package pedigree [<xref ref-type="bibr" rid="CR10">10</xref>] (pedigree::orderPed) and AGHmatrix::datatreat [<xref ref-type="bibr" rid="CR11">11</xref>] order the pedigree, but do not do renumbering. Applying pedigree::orderPed to the ped object above shows that ped does not need ordering.</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figc_HTML" id="MO3"/>
      </p>
      <p>Function AGHmatrix::datatreat returns three lists for chronologically ordered individuals, their corresponding sires, and corresponding dams.</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figd_HTML" id="MO4"/>
      </p>
      <p>Loop(s) in the pedigree (an individual being ascendant to itself) would fail renum. Loops would appear among duplicated IDs in the pedigree with different parent information. If IDs are assigned so that parent ID is less than progeny ID, a duplicated row for the animal causing loop in the pedigree would show the opposite.</p>
    </sec>
    <sec id="Sec4">
      <title>Pedigree check</title>
      <p>Function pedcheck performs basic checks on numeric pedigree. It is highly recommended to check the pedigree object with this function, before proceeding to other functions. The pedigree object is a data.frame with integer columns corresponding to the ID of animal, sire, and dam. Missing parents are set to 0. As an example, performing pedcheck on a faulty pedigree:</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Fige_HTML" id="MO5"/>
      </p>
    </sec>
    <sec id="Sec5">
      <title>All in and order the pedigree</title>
      <p>Function gghead looks for possible parents missing in the first column of the pedigree, inserts them to the head of the pedigree, and orders the pedigree. Considering a pedigree with all missing parents replaced with the corresponding genetic groups, this functions appends the genetic groups to the head of the pedigree as the only IDs with missing parents. For example,</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figf_HTML" id="MO6"/>
      </p>
      <p>In comparison with R package pedigree [<xref ref-type="bibr" rid="CR10">10</xref>], gghead function works similar to:</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figg_HTML" id="MO7"/>
      </p>
    </sec>
    <sec id="Sec6">
      <title>Pedigree pruning</title>
      <p>Pedigree pruning reduces memory usage and the time to reach convergence in the genetic evaluation. Usually, there are uninformative animals in the pedigree, which do not contribute or pass any information from descendants to ascendants. All those animals can be deleted from the pedigree for variance components estimation. In BLUP, some of those animals might be needed. Even though, they are uninformative, they might receive a predicted genetic merit from the information contributed by their informative relatives. Function prueped has two modes, strict and loose. The strict mode is recommended for variance components estimation, and the loose mode is recommended for BLUP. In the strict mode, animals without progeny and phenotype are deleted iteratively. Then, animals without known parents and progeny (if any) are deleted from the pedigree. In the loose mode, pedigree is upward extracted from phenotyped animals to their founders, and then pedigree is downward extracted from those founder animals. This less strict pruning leaves non-phenotyped animals with phenotyped relatives in the pedigree. Thus, they can receive a predicted genetic merit from BLUP. To test this function in both modes, consider animals 4, 5, and 6 are phenotyped, and animals 7 and 8 added to ped2:</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figh_HTML" id="MO8"/>
      </p>
      <p>Function pedigree::trimPed [<xref ref-type="bibr" rid="CR10">10</xref>] can be used to obtain the same output as function pruneped in the strict mode:</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figi_HTML" id="MO9"/>
      </p>
    </sec>
    <sec id="Sec7">
      <title>Additive relationship matrix</title>
      <p>Functions buildA and tabA create matrix <bold>A</bold> from the pedigree data.frame, in matrix and tabular-sparse formats, respectively. Function buildA is faster, but tabA is more memory-efficient (Table <xref rid="Tab1" ref-type="table">1</xref>). Usually, relationship matrices and their inverses are saved in a tabular-sparse format. It reduces the memory usage and the size of the output file, as only the non-zero upper/lower triangular elements are saved. Considering the renumbered pedigree without genetic groups:
<table-wrap id="Tab1"><label>Table 1</label><caption><p>Runtime <sup><italic>a</italic></sup> of different functions with two pedigree data</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">package::function</th><th align="left">Time <sup><italic>b</italic></sup></th><th align="left">Time <sup><italic>c</italic></sup></th></tr></thead><tbody><tr><td align="left">ggroups::tabA</td><td align="left">–</td><td align="left">13m:56s</td></tr><tr><td align="left">pedigree::makeA</td><td align="left">–</td><td align="left">37s</td></tr><tr><td align="left">ggroups::buildA</td><td align="left">–</td><td align="left">2s</td></tr><tr><td align="left">pedigreemm::getA</td><td align="left">–</td><td align="left">1s</td></tr><tr><td align="left">AGHmatrix::Amatrix</td><td align="left">–</td><td align="left">1s</td></tr><tr><td align="left">pedigree::calcInbreeding</td><td align="left">2s</td><td align="left">1s</td></tr><tr><td align="left">pedigreemm::inbreeding</td><td align="left">1s</td><td align="left">1s</td></tr><tr><td align="left">ggroups::tabAinv</td><td align="left">5m:28s</td><td align="left">1s</td></tr><tr><td align="left">pedigree::makeAinv</td><td align="left">2s</td><td align="left">1s</td></tr><tr><td align="left">pedigreemm::getAInv</td><td align="left">–</td><td align="left">1s</td></tr><tr><td align="left">ggroups::qmatL</td><td align="left">–</td><td align="left">2s</td></tr><tr><td align="left">ggroups::qmatL</td><td align="left">7m:27s</td><td align="left">4s</td></tr><tr><td align="left">ggroups::qmatXL</td><td align="left">3m:31s</td><td align="left">5s</td></tr><tr><td align="left">nadiv::ggcontrib</td><td align="left">–</td><td align="left">1s</td></tr><tr><td align="left">ggroups::tabD</td><td align="left">–</td><td align="left">39s</td></tr><tr><td align="left">ggroups::buildD</td><td align="left">–</td><td align="left">2m</td></tr><tr><td align="left">AGHmatrix::Amatrix<sup><italic>d</italic></sup></td><td align="left">–</td><td align="left">1m:24s</td></tr><tr><td align="left">ggroups::rg</td><td align="left">41s <sup><italic>e</italic></sup></td><td align="left">4s <sup><italic>e</italic></sup></td></tr><tr><td align="left">ggroups::inb</td><td align="left">35s <sup><italic>e</italic></sup></td><td align="left">3s <sup><italic>e</italic></sup></td></tr><tr><td align="left">ggroups::tabDinv</td><td align="left">–</td><td align="left">1m:29s</td></tr><tr><td align="left">ggroups::tab2mat</td><td align="left">–</td><td align="left">31s <sup><italic>f</italic></sup></td></tr><tr><td align="left">ggroups::mat2tab</td><td align="left">–</td><td align="left">4s <sup><italic>f</italic></sup></td></tr></tbody></table><table-wrap-foot><p><sup>a</sup>Measured on an octa-core Intel(R) Core(TM) i7-8650U with 16 Gb of RAM, and runtimes shorter than 1s are presented as 1s</p><p><sup>b</sup>A pedigree of 57,341 Mexican Braunvieh cattle (2,746 sires, 27,015 dams, and 8 genetic groups)</p><p><sup>c</sup>A subset of 3,000 animals (482 sires, and 1,855 dams) from <sup><italic>b</italic></sup></p><p><sup>d</sup>dominance=TRUE</p><p><sup>e</sup>100 reiterations on random samples</p><p><sup>f</sup>For the additive genetic relationship matrix</p></table-wrap-foot></table-wrap></p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figj_HTML" id="MO10"/>
      </p>
      <p>Functions pedigree::makeA [<xref ref-type="bibr" rid="CR10">10</xref>], pedigreemm::getA [<xref ref-type="bibr" rid="CR12">12</xref>] and AGHmatrix::Amatrix [<xref ref-type="bibr" rid="CR11">11</xref>] also create matrix <bold>A</bold>.</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figk_HTML" id="MO11"/>
      </p>
      <p>Please note that the first two columns in A.txt written by pedigree::makeA are the order of animals in the pedigree, not animal IDs. Table <xref rid="Tab1" ref-type="table">1</xref> provides runtime measures for buildA, tabA, pedigree::makeA, pedigreemm::getA, and AGHmatrix::Amatrix.</p>
    </sec>
    <sec id="Sec8">
      <title>Relationship coefficient</title>
      <p>Whereas, functions buildA and tabA give relationship coefficients between all pairs of individuals, using these functions is computationally expensive (memory for buildA and runtime for tabA) if only the relationship coefficient between a pair of individuals is required, especially in a large pedigree. Instead, function rg can be used. For example, to get the relationship coefficient between individuals 3 and 6 in ped4, rg(ped4, 3, 6) results in: [1] 0.25. The same result can be obtained using function pedigree::makeA, but with less convenience.</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figl_HTML" id="MO12"/>
      </p>
      <p>Calculating relationship coefficient between a pair of individuals using rg, information from their common parents are used only. Runtime of 100 reiterations of rg on random pairs of individuals is provided in Table <xref rid="Tab1" ref-type="table">1</xref>.</p>
    </sec>
    <sec id="Sec9">
      <title>Inbreeding coefficient</title>
      <p>If the inbreeding coefficient of an individual is of interest, using functions buildA and tabA is computationally expensive, especially in a large pedigree. Instead, function inb can be used. For example, to calculate the inbreeding coefficient of individual 6 in ped2, inb(ped2, 6) results in: [1] 0.25. Calculating inbreeding coefficient for an individual, information from parents’ common ancestors are used only. Runtime of 100 reiterations of inb on randomly chosen individuals is provided in Table <xref rid="Tab1" ref-type="table">1</xref>.</p>
      <p>Using package ggroups [<xref ref-type="bibr" rid="CR8">8</xref>], there are 3 ways of obtaining inbreeding coefficients for all animals in the pedigree:</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figm_HTML" id="MO13"/>
      </p>
      <p>Functions pedigree::calcInbreeding [<xref ref-type="bibr" rid="CR10">10</xref>] and pedigreemm::inbreeding [<xref ref-type="bibr" rid="CR12">12</xref>] use fast and efficient algorithms [<xref ref-type="bibr" rid="CR13">13</xref>] to compute inbreeding coefficients in large populations. Run time measures of pedigree::calcInbreeding and pedigreemm::inbreeding are provided in Table <xref rid="Tab1" ref-type="table">1</xref>.</p>
    </sec>
    <sec id="Sec10">
      <title>Inverse of the additive relationship matrix</title>
      <p>Function tabAinv builds <bold>A</bold><sup>−1</sup> in a tabular-sparse format. Compared to matrix data, handling tabular data takes a longer runtime. However, it is more memory-efficient for large pedigree. The pedigree object and inbreeding coefficients are required for tabAinv. None of the animals in ped4 were inbred. For example,</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Fign_HTML" id="MO14"/>
      </p>
      <p>Function tabAinv performs similar to functions pedigree::makeAinv [<xref ref-type="bibr" rid="CR10">10</xref>] and pedigreemm::getAInv [<xref ref-type="bibr" rid="CR12">12</xref>].</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figo_HTML" id="MO15"/>
      </p>
      <p>Please note that the first two columns in Ainv.txt written by pedigree::makeAinv are animal orders in the pedigree, not animal IDs. Table <xref rid="Tab1" ref-type="table">1</xref> provides runtime measures for tabAinv, pedigree::makeAinv, and pedigreemm::getAInv.</p>
    </sec>
    <sec id="Sec11">
      <title>Tabular to matrix and <italic>vice versa</italic></title>
      <p>Function tab2mat converts matrices from tabular-sparse format to matrix format. For example, <bold>A</bold><sup>−1</sup> created in the previous example is converted to matrix format:</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figp_HTML" id="MO16"/>
      </p>
      <p>Function mat2tab converts matrices from matrix format to tabular-sparse format. For example, mat2tab(tab2mat(tabA(ped4))) returns tabA(ped4). Runtime records for converting a pedigree relationship matrix to tabular-sparse format (mat2tab) and <italic>vice versa</italic> (tab2mat) are provided in Table <xref rid="Tab1" ref-type="table">1</xref>.</p>
      <p>R package reshape2 [<xref ref-type="bibr" rid="CR14">14</xref>] is a popular tool used for reshaping and transforming data. For example, it can be simply used for transforming a matrix to a tabular data.frame:</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figq_HTML" id="MO17"/>
      </p>
      <p>or to transform a tabular data.frame to a matrix:</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figr_HTML" id="MO18"/>
      </p>
      <p>Unlike reshape2::melt and reshape2::dcast functions used above, mat2tab and tab2mat functions are specifically designed for symmetric matrices and tabular-sparse data, which reduces the number of rows in the data.frame to be read/written and kept in the memory.</p>
    </sec>
    <sec id="Sec12">
      <title>Genetic group contributions matrix</title>
      <p>Function qmat creates matrix <bold>Q</bold>, which is the matrix of genetic group contributions to animals. According to Quaas [<xref ref-type="bibr" rid="CR9">9</xref>], <bold>Q</bold>=(<bold>I</bold>−<bold>P</bold>)<sup>−1</sup><bold>P</bold><sub><italic>b</italic></sub><bold>Q</bold><sub><italic>b</italic></sub>, where (<bold>I</bold>−<bold>P</bold>)<sup>−1</sup><bold>P</bold><sub><italic>b</italic></sub> is equal to the genetic relationship matrix between animals (rows) and unknown parents (columns), and <bold>Q</bold><sub><italic>b</italic></sub> is the incidence matrix of unknown parents (rows) and genetic groups (columns). Function qmatL is the computationally optimised version of qmat. It calculates each column of <bold>Q</bold> (each genetic group) separately, by calculating relationship coefficients between the genetic group of interest with animals that receive contribution from the genetic group (excluding missing parents, which receive full contribution).</p>
      <p>The input pedigree should contain genetic groups (not unknown parents) as the only IDs with unknown parents, similar to the output from ped2 = gghead(ped). For example,</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figs_HTML" id="MO19"/>
      </p>
      <p>Function nadiv::ggcontrib [<xref ref-type="bibr" rid="CR15">15</xref>] also returns matrix <bold>Q</bold> for pedigree and genetic groups. Using the Mexican Braunvieh pedigree on Sys.i7-8650U.16, both qmat and nadiv::ggcontrib aborted with "Error: cannot allocate vector of size 25.6 Gb" message. Function qmatL could even return <bold>Q</bold> on a machine with 4 Gb RAM (not all of it available). Functions qmat and nadiv::ggcontrib were tested on a server with 526 Gb of RAM. Function qmat returned <bold>Q</bold> after 17m:51s, and function nadiv::ggcontrib aborted with the following message:</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figt_HTML" id="MO20"/>
      </p>
      <p>With the pedigree subset of 3,000 animals, function nadiv::ggcontrib successfully returned matrix <bold>Q</bold> on Sys.i7-8650U.16. Runtimes of qmat, qmatL, and nadiv::ggcontrib are provided in Table <xref rid="Tab1" ref-type="table">1</xref>.</p>
    </sec>
    <sec id="Sec13">
      <title>Parallel computation of genetic group contributions matrix</title>
      <p>In order to further speed up the calculation of <bold>Q</bold>, the process can take advantage of multicore processors and parallel computing. Function qmatXL is the parallelised version of qmatL. It requires a pedigree object as described for ped2, and the number of user-defined computational nodes. If the number of user-defined nodes was greater than the number of genetic groups, the number of genetic groups is considered for the number of nodes. This function requires R packages doParallel [<xref ref-type="bibr" rid="CR16">16</xref>] and foreach [<xref ref-type="bibr" rid="CR17">17</xref>], otherwise, an on-screen message will notify the user to install doParallel. Package foreach is a dependency for package doParallel. Thus, installing doParallel with its dependencies (i.e., install.packages(~doParallel~, dependencies=TRUE)) would automatically install foreach. The command for testing qmatXL with ped2 and 2 nodes is: qmatXL(ped2, 2).</p>
      <p>Table <xref rid="Tab1" ref-type="table">1</xref> provides runtime records for qmatXL. The benefit from parallel processing is expected to increase with the greater number of genetic groups and computational nodes. For small pedigree, qmat and qmatL are fast enough that parallel processing from qmatXL shows no benefit (Table <xref rid="Tab1" ref-type="table">1</xref>). This might be due to a small parallel processing overhead.</p>
    </sec>
    <sec id="Sec14">
      <title>Summing genetic merits and genetic group contributions</title>
      <p>There are two main alternatives of introducing genetic groups in BLUP [<xref ref-type="bibr" rid="CR9">9</xref>]:
<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ {\left[\begin{array}{ccc} \mathbf X' \mathbf R^{-1} \mathbf X &amp;\mathbf X' \mathbf R^{-1} \mathbf Z &amp;\mathbf X' \mathbf R^{-1} \mathbf{ZQ} \\ \mathbf Z' \mathbf R^{-1} \mathbf X &amp;\mathbf Z' \mathbf R^{-1} \mathbf Z + \mathbf G^{-1} &amp;\mathbf Z' \mathbf R^{-1} \mathbf{ZQ} \\ \mathbf Q' \mathbf Z' \mathbf R^{-1} \mathbf X &amp;\mathbf Q' \mathbf Z' \mathbf R^{-1} \mathbf Z &amp;\mathbf Q' \mathbf Z' \mathbf R^{-1} \mathbf{ZQ} \end{array}\right] \left[\begin{array}{c} \hat{\mathbf b} \\ \hat{\mathbf u} \\ \hat{\mathbf g} \end{array}\right] = \left[\begin{array}{ccc} \mathbf X' \mathbf R^{-1} \mathbf y \\ \mathbf Z' \mathbf R^{-1} \mathbf y \\ \mathbf Q' \mathbf Z' \mathbf R^{-1} \mathbf y \end{array}\right],}  $$ \end{document}</tex-math><mml:math id="M2"><mml:mfenced close="]" open="["><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">X</mml:mi></mml:mtd><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">Z</mml:mi></mml:mtd><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">ZQ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">X</mml:mi></mml:mtd><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">ZQ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">X</mml:mi></mml:mtd><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">Z</mml:mi></mml:mtd><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">ZQ</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">b</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">u</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">g</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">y</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">y</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">y</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41065_2020_124_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>where <inline-formula id="IEq1"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\hat {\mathbf b}, \hat {\mathbf u}$\end{document}</tex-math><mml:math id="M4"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">b</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">u</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41065_2020_124_Article_IEq1.gif"/></alternatives></inline-formula> and <inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\hat {\mathbf g}$\end{document}</tex-math><mml:math id="M6"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">g</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41065_2020_124_Article_IEq2.gif"/></alternatives></inline-formula> are the vectors for the predictions of fixed, genetic merit, and genetic group effects, respectively, with the corresponding matrices <bold>X</bold>, <bold>Z</bold>, and <bold>ZQ</bold>. Matrix <bold>R</bold>, and vector <bold>y</bold> correspond to the residuals and phenotypes. Using Quaas and Pollak [<xref ref-type="bibr" rid="CR18">18</xref>] transformation, the equation system is transformed to:
<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ {\left[\begin{array}{ccc} \mathbf X' \mathbf R^{-1} \mathbf X &amp;\mathbf X' \mathbf R^{-1} \mathbf Z &amp;\mathbf 0 \\ \mathbf Z' \mathbf R^{-1} \mathbf X &amp;\mathbf Z' \mathbf R^{-1} \mathbf Z + \mathbf G^{-1} &amp;-\mathbf G^{-1} \mathbf Q \\ \mathbf 0 &amp;-\mathbf Q' \mathbf G^{-1} &amp;\mathbf Q' \mathbf G^{-1} \mathbf Q \end{array}\right] \left[\begin{array}{c} \hat{\mathbf b} \\ \mathbf Q \hat{\mathbf g} + \hat{\mathbf u} \\ \hat{\mathbf g} \end{array}\right] = \left[\begin{array}{ccc} \mathbf X' \mathbf R^{-1} \mathbf y \\ \mathbf Z' \mathbf R^{-1} \mathbf y \\ \mathbf 0 \end{array}\right].}  $$ \end{document}</tex-math><mml:math id="M8"><mml:mfenced close="]" open="["><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">X</mml:mi></mml:mtd><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">Z</mml:mi></mml:mtd><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">X</mml:mi></mml:mtd><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">Q</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd><mml:mtd><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">Q</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">b</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi mathvariant="bold">Q</mml:mi><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">g</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">u</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">g</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">y</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">y</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mi>.</mml:mi></mml:math><graphic xlink:href="41065_2020_124_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>If the genetic evaluation software applies Eq. (<xref rid="Equ1" ref-type="">1</xref>) (e.g., MTDFREML [<xref ref-type="bibr" rid="CR19">19</xref>]), function Qgpu can be used to obtain <inline-formula id="IEq3"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbf Q \hat {\mathbf g} + \hat {\mathbf u}$\end{document}</tex-math><mml:math id="M10"><mml:mi mathvariant="bold">Q</mml:mi><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">g</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">u</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41065_2020_124_Article_IEq3.gif"/></alternatives></inline-formula>. Function Qgpu requires 2 arguments, the <bold>Q</bold> matrix and a data.frame with 2 columns for IDs and solutions [<inline-formula id="IEq4"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\hat {\mathbf g}, \hat {\mathbf u}$\end{document}</tex-math><mml:math id="M12"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">g</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">u</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41065_2020_124_Article_IEq4.gif"/></alternatives></inline-formula>], respectively. The order of solutions must be the order of columns and then the order of rows in <bold>Q</bold>. For example,</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figu_HTML" id="MO21"/>
      </p>
    </sec>
    <sec id="Sec15">
      <title>Dominance relationship matrix</title>
      <p>Whereas, additive genetic effects are inherited directly through individuals, inheritance of dominance effects are through pairs of mating individuals [<xref ref-type="bibr" rid="CR20">20</xref>]. Hoeschele and VanRaden [<xref ref-type="bibr" rid="CR20">20</xref>] defined pedigree-based dominance relationships by partitioning dominance effects into sire × dam subclass effects and within subclass deviations from within subclass average of dominance effects.</p>
      <p>Functions buildD and tabD create matrix <bold>D</bold> from the pedigree data.frame, in matrix and tabular-sparse formats, respectively. Calculations are done for animals with both parents known. Other animals would only receive a diagonal value of 1. Below, functions buildD and tabD are shown in practice.</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figv_HTML" id="MO22"/>
      </p>
      <p>Function AGHmatrix::Amatrix [<xref ref-type="bibr" rid="CR11">11</xref>] has a functionality similar to buildD.</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figw_HTML" id="MO23"/>
      </p>
      <p>Runtime records of buildD, tabD, and AGHmatrix::Amatrix(dominance=TRUE) are provided in Table <xref rid="Tab1" ref-type="table">1</xref>.</p>
    </sec>
    <sec id="Sec16">
      <title>Inverse of the dominance relationship matrix</title>
      <p>Function tabDinv is used for obtaining <bold>D</bold><sup>−1</sup> in a tabular-sparse format from a pedigree object. For example,</p>
      <p>
        <graphic position="anchor" xlink:href="41065_2020_124_Figx_HTML" id="MO24"/>
      </p>
      <p>Runtime record of tabDinv is provided in Table <xref rid="Tab1" ref-type="table">1</xref>.</p>
    </sec>
    <sec id="Sec17">
      <title>Other functions</title>
      <p>There are other functions included in package ggroups, and possibly more functions will be added in the future. Some of the existing functions are offspring, pedup, and peddown. Function offspring reports the number of descendants from an individual, in each generation following that individual. Providing a list of animals such as the list of phenotyped or genotyped animals, the number of descendants from that list per generation is also provided. Function pedup extracts the pedigree for one or a group of individuals, by tracing their ancestors, for a defined or maximum possible number of generations. Similarly, function peddown extracts the pedigree for a group of individuals, by tracing their descendants down the pedigree.</p>
    </sec>
  </sec>
  <sec id="Sec18" sec-type="conclusion">
    <title>Conclusions</title>
    <p>The R package ggroups is a useful, free and open source tool for animal breeders, researchers, and students, who work with pedigree data and R. It provides functions for the most important tasks related to working with pedigree, including creating the additive genetic relationship matrix and its inverse, and the matrix of genetic group contributions. The advantage of this package over other packages that also calculate the matrix of genetic group contributions, is that it has computationally optimised functions for large pedigree, which also can take advantage of multicore processors. In addition, R package ggroups provides other helpful functions such as functions for pedigree checking, renumbering and extraction, forming the dominance relationship matrix and its inverse, and converting tabular-sparse data to matrix, and <italic>vice versa</italic>. The results showed that functions dealing with data in matrix format are faster than functions dealing with data in tabular-sparse format. However, where memory of most personal computers fail forming large matrices for large pedigree, dealing with tabular-sparse data reduces the memory demand.</p>
  </sec>
  <sec id="Sec19">
    <title>Availability and requirements</title>
    <p>
      <list list-type="bullet">
        <list-item>
          <p><bold>Project name:</bold> R package ggroups</p>
        </list-item>
        <list-item>
          <p>
            <bold>Project home page:</bold>
            <ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/package=ggroups">https://cran.r-project.org/package=ggroups</ext-link>
          </p>
        </list-item>
        <list-item>
          <p><bold>Operating system(s):</bold> Platform independent</p>
        </list-item>
        <list-item>
          <p><bold>Programming language:</bold> R</p>
        </list-item>
        <list-item>
          <p><bold>Other requirements:</bold>doParallel (≥1.0.14) and foreach (≥1.4.4) are required for function qmatXL.</p>
        </list-item>
        <list-item>
          <p><bold>License:</bold> GPL-3</p>
        </list-item>
      </list>
    </p>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>BLUP</term>
        <def>
          <p>Best linear unbiased prediction</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>MAN wrote the R package and the manuscript. LAS-J took part in writing the manuscript, testing the R package, and applying it to real data. Both MAN and LAS-J took part in revising the manuscript. The author(s) read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>No funding was received to conduct this project.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>
      <ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/package=ggroups">https://cran.r-project.org/package=ggroups</ext-link>
    </p>
  </notes>
  <notes>
    <title>Ethics approval and consent to participate</title>
    <p>Not applicable.</p>
  </notes>
  <notes>
    <title>Consent for publication</title>
    <p>Not applicable.</p>
  </notes>
  <notes notes-type="COI-statement">
    <title>Competing interests</title>
    <p>The authors declare that they have no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Henderson</surname>
            <given-names>CR</given-names>
          </name>
        </person-group>
        <article-title>Estimation of changes in herd environment [abstract]</article-title>
        <source>J Dairy Sci</source>
        <year>1949</year>
        <volume>32</volume>
        <fpage>706</fpage>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aguilar</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Misztal</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Johnson</surname>
            <given-names>DL</given-names>
          </name>
          <name>
            <surname>Legarra</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Tsuruta</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lawlor</surname>
            <given-names>TJ</given-names>
          </name>
        </person-group>
        <article-title>Hot topic: A unified approach to utilize phenotypic, full pedigree, and genomic information for genetic evaluation of holstein final score</article-title>
        <source>J Dairy Sci</source>
        <year>2010</year>
        <volume>93</volume>
        <issue>2</issue>
        <fpage>743</fpage>
        <lpage>52</lpage>
        <pub-id pub-id-type="doi">10.3168/jds.2009-2730</pub-id>
        <pub-id pub-id-type="pmid">20105546</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Christensen</surname>
            <given-names>OF</given-names>
          </name>
          <name>
            <surname>Lund</surname>
            <given-names>MS</given-names>
          </name>
        </person-group>
        <article-title>Genomic prediction when some animals are not genotyped</article-title>
        <source>Genet Sel Evol</source>
        <year>2010</year>
        <volume>42</volume>
        <issue>1</issue>
        <fpage>2</fpage>
        <pub-id pub-id-type="doi">10.1186/1297-9686-42-2</pub-id>
        <pub-id pub-id-type="pmid">20105297</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fernando</surname>
            <given-names>RL</given-names>
          </name>
          <name>
            <surname>Cheng</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Golden</surname>
            <given-names>BL</given-names>
          </name>
          <name>
            <surname>Garrick</surname>
            <given-names>DJ</given-names>
          </name>
        </person-group>
        <article-title>Computational strategies for alternative single-step bayesian regression models with large numbers of genotyped and non-genotyped animals</article-title>
        <source>Genet Sel Evol</source>
        <year>2016</year>
        <volume>48</volume>
        <issue>1</issue>
        <fpage>96</fpage>
        <pub-id pub-id-type="doi">10.1186/s12711-016-0273-2</pub-id>
        <pub-id pub-id-type="pmid">27931187</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Henderson</surname>
            <given-names>CR</given-names>
          </name>
        </person-group>
        <article-title>Rapid method for computing the inverse of a relationship matrix</article-title>
        <source>J Dairy Sci</source>
        <year>1975</year>
        <volume>58</volume>
        <issue>11</issue>
        <fpage>1727</fpage>
        <lpage>30</lpage>
        <pub-id pub-id-type="doi">10.3168/jds.S0022-0302(75)84776-X</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Quaas</surname>
            <given-names>RL</given-names>
          </name>
        </person-group>
        <article-title>Computing the diagonal elements and inverse of a large numerator relationship matrix</article-title>
        <source>Biometrics</source>
        <year>1976</year>
        <volume>32</volume>
        <issue>4</issue>
        <fpage>949</fpage>
        <lpage>53</lpage>
        <pub-id pub-id-type="doi">10.2307/2529279</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Schaeffer</surname>
            <given-names>LR</given-names>
          </name>
        </person-group>
        <article-title>Phantom parent groups</article-title>
        <source>The Animal Models</source>
        <year>2019</year>
        <publisher-loc>Ontario</publisher-loc>
        <publisher-name>Volumes</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8</label>
      <mixed-citation publication-type="other">Nilforooshan MA. ggroups: Pedigree and genetic groups. R package version 2.0.0. 2020. <ext-link ext-link-type="uri" xlink:href="https://CRAN.R-project.org/package=ggroups">https://CRAN.R-project.org/package=ggroups</ext-link>. Accessed 28 Oct 2019.</mixed-citation>
    </ref>
    <ref id="CR9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Quaas</surname>
            <given-names>RL</given-names>
          </name>
        </person-group>
        <article-title>Additive genetic model with groups and relationships</article-title>
        <source>J Dairy Sci</source>
        <year>1988</year>
        <volume>71</volume>
        <issue>5</issue>
        <fpage>1338</fpage>
        <lpage>45</lpage>
        <pub-id pub-id-type="doi">10.3168/jds.S0022-0302(88)79691-5</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10</label>
      <mixed-citation publication-type="other">Coster A. Package pedigree. 2013. <ext-link ext-link-type="uri" xlink:href="https://CRAN.R-project.org/package=pedigree">https://CRAN.R-project.org/package=pedigree</ext-link>. Accessed 28 Oct 2019.</mixed-citation>
    </ref>
    <ref id="CR11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Amadeu</surname>
            <given-names>RR</given-names>
          </name>
          <name>
            <surname>Cellon</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Olmstead</surname>
            <given-names>JW</given-names>
          </name>
          <name>
            <surname>Garcia</surname>
            <given-names>AA</given-names>
          </name>
          <name>
            <surname>Resende</surname>
            <given-names>MF</given-names>
          </name>
          <name>
            <surname>Muñoz</surname>
            <given-names>PR</given-names>
          </name>
        </person-group>
        <article-title>Aghmatrix: R package to construct relationship matrices for autotetraploid and diploid species: A blueberry example</article-title>
        <source>Plant Genome</source>
        <year>2016</year>
        <volume>9</volume>
        <issue>3</issue>
        <fpage>1</fpage>
        <lpage>10</lpage>
        <pub-id pub-id-type="doi">10.3835/plantgenome2016.01.0009</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vazquez</surname>
            <given-names>AI</given-names>
          </name>
          <name>
            <surname>Bates</surname>
            <given-names>DM</given-names>
          </name>
          <name>
            <surname>Rosa</surname>
            <given-names>GJ</given-names>
          </name>
          <name>
            <surname>D</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Weigel</surname>
            <given-names>KA</given-names>
          </name>
        </person-group>
        <article-title>Technical note: an r package for fitting generalized linear mixed models in animal breeding</article-title>
        <source>J Anim Sci</source>
        <year>2010</year>
        <volume>88</volume>
        <issue>2</issue>
        <fpage>497</fpage>
        <lpage>504</lpage>
        <pub-id pub-id-type="doi">10.2527/jas.2009-1952</pub-id>
        <pub-id pub-id-type="pmid">19820058</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sargolzaei</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Iwaisaki</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Comparison of four direct algorithms for computing inbreeding coefficients</article-title>
        <source>Anim Sci J</source>
        <year>2005</year>
        <volume>76</volume>
        <issue>5</issue>
        <fpage>401</fpage>
        <lpage>406</lpage>
        <pub-id pub-id-type="doi">10.1111/j.1740-0929.2005.00282.x</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wickham</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Reshaping data with the reshape package</article-title>
        <source>J Stat Soft</source>
        <year>2007</year>
        <volume>21</volume>
        <issue>12</issue>
        <fpage>1</fpage>
        <lpage>20</lpage>
        <pub-id pub-id-type="doi">10.18637/jss.v021.i12</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolak</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>Reid</surname>
            <given-names>JM</given-names>
          </name>
        </person-group>
        <article-title>Accounting for genetic differences among unknown parents in microevolutionary studies: how to include genetic groups in quantitative genetics animal models</article-title>
        <source>J Anim Ecol</source>
        <year>2017</year>
        <volume>86</volume>
        <issue>1</issue>
        <fpage>7</fpage>
        <lpage>20</lpage>
        <pub-id pub-id-type="doi">10.1111/1365-2656.12597</pub-id>
        <pub-id pub-id-type="pmid">27731502</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16</label>
      <mixed-citation publication-type="other">Microsoft Corporation, Weston S. doParallel: Foreach parallel adaptor for the ’parallel’ package. R package version 1.0.14. 2018. <ext-link ext-link-type="uri" xlink:href="https://CRAN.R-project.org/package=doParallel">https://CRAN.R-project.org/package=doParallel</ext-link>. Accessed 28 Oct 2019.</mixed-citation>
    </ref>
    <ref id="CR17">
      <label>17</label>
      <mixed-citation publication-type="other">Microsoft Corporation, Weston S. foreach: Provides foreach looping construct for R. R package version 1.4.4. 2018. <ext-link ext-link-type="uri" xlink:href="https://CRAN.R-project.org/package=foreach">https://CRAN.R-project.org/package=foreach</ext-link>. Accessed 28 Oct 2019.</mixed-citation>
    </ref>
    <ref id="CR18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Quaas</surname>
            <given-names>RL</given-names>
          </name>
          <name>
            <surname>Pollak</surname>
            <given-names>EJ</given-names>
          </name>
        </person-group>
        <article-title>Modified equations for sire models with groups</article-title>
        <source>J Dairy Sci</source>
        <year>1981</year>
        <volume>64</volume>
        <issue>9</issue>
        <fpage>1868</fpage>
        <lpage>72</lpage>
        <pub-id pub-id-type="doi">10.3168/jds.S0022-0302(81)82778-6</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Boldman</surname>
            <given-names>KGL</given-names>
          </name>
          <name>
            <surname>Kriese</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Van Vleck</surname>
            <given-names>LD</given-names>
          </name>
          <name>
            <surname>Van Tassell</surname>
            <given-names>CP</given-names>
          </name>
          <name>
            <surname>Kachman</surname>
            <given-names>SD</given-names>
          </name>
        </person-group>
        <source>A manual for use of MTDFREML, a set of programs to obtain estimates of variances and (co)variances</source>
        <year>1995</year>
        <publisher-loc>Nebraska</publisher-loc>
        <publisher-name>USDA, Clay Center</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hoeschele</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>VanRaden</surname>
            <given-names>PM</given-names>
          </name>
        </person-group>
        <article-title>Rapid inversion of dominance relationship matrices for noninbred populations by including sire by dam subclass effects</article-title>
        <source>J Dairy Sci</source>
        <year>1991</year>
        <volume>74</volume>
        <issue>2</issue>
        <fpage>557</fpage>
        <lpage>69</lpage>
        <pub-id pub-id-type="doi">10.3168/jds.S0022-0302(91)78203-9</pub-id>
        <pub-id pub-id-type="pmid">2045562</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
