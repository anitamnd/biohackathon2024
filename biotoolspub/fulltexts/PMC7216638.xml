<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7216638</article-id>
    <article-id pub-id-type="publisher-id">3534</article-id>
    <article-id pub-id-type="doi">10.1186/s12859-020-3534-6</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methodology Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SCeQTL: an R package for identifying eQTL from single-cell parallel sequencing data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Hu</surname>
          <given-names>Yue</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Xi</surname>
          <given-names>Xi</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Yang</surname>
          <given-names>Qian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9684-5643</contrib-id>
        <name>
          <surname>Zhang</surname>
          <given-names>Xuegong</given-names>
        </name>
        <address>
          <email>zhangxg@tsinghua.edu.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.12527.33</institution-id><institution-id institution-id-type="ISNI">0000 0001 0662 3178</institution-id><institution>MOE Key Laboratory of Bioinformatics and Bioinformatics Division, BNRIST, Department of Automation, </institution><institution>Tsinghua University, </institution></institution-wrap>Beijing, 100084 China </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.12527.33</institution-id><institution-id institution-id-type="ISNI">0000 0001 0662 3178</institution-id><institution>School of Life Sciences, Center for Synthetic and Systems Biology, </institution><institution>Tsinghua University, </institution></institution-wrap>Beijing, 100084 China </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>11</day>
      <month>5</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>11</day>
      <month>5</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2020</year>
    </pub-date>
    <volume>21</volume>
    <elocation-id>184</elocation-id>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>2</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>5</day>
        <month>5</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s). 2020</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">With the rapid development of single-cell genomics, technologies for parallel sequencing of the transcriptome and genome in each single cell is being explored in several labs and is becoming available. This brings us the opportunity to uncover association between genotypes and gene expression phenotypes at single-cell level by eQTL analysis on single-cell data. New method is needed for such tasks due to special characteristics of single-cell sequencing data.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">We developed an R package SCeQTL that uses zero-inflated negative binomial regression to do eQTL analysis on single-cell data. It can distinguish two type of gene-expression differences among different genotype groups. It can also be used for finding gene expression variations associated with other grouping factors like cell lineages or cell types.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3">The SCeQTL method is capable for eQTL analysis on single-cell data as well as detecting associations of gene expression with other grouping factors. The R package of the method is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/XuegongLab/SCeQTL/">https://github.com/XuegongLab/SCeQTL/</ext-link>.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Single-cell eQTL</kwd>
      <kwd>Zero-inflated negative binomial regression</kwd>
      <kwd>Multi-class differential expression analysis</kwd>
      <kwd>Single-cell gene regulation</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>NSFC</institution>
        </funding-source>
        <award-id>61721003</award-id>
        <principal-award-recipient>
          <name>
            <surname>Zhang</surname>
            <given-names>Xuegong</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>National Key R&amp;D Program of China</institution>
        </funding-source>
        <award-id>2018YFC0910401</award-id>
        <principal-award-recipient>
          <name>
            <surname>Zhang</surname>
            <given-names>Xuegong</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>CZI</institution>
        </funding-source>
        <award-id>HCA Seed Network Project</award-id>
        <principal-award-recipient>
          <name>
            <surname>Zhang</surname>
            <given-names>Xuegong</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2020</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par10">Expression quantitative trait locus or eQTL analysis is an important approach for studying the association between variations in the genotype and gene expression, which may help to reveal the underlying regulation relationship. Technologies that can sequence in parallel both the genomes and transcriptomes of single cells are being developed recently [<xref ref-type="bibr" rid="CR6">6</xref>, <xref ref-type="bibr" rid="CR8">8</xref>]. These technologies give us an opportunity to uncover the association between genetic variations and genes expression at single-cell level, which can help reveal detailed gene regulation mechanisms in processes like tumorigenesis and cell differentiation.</p>
    <p id="Par11">Methods for identifying eQTLs have been well studied for microarray data and bulk RNA-seq data. Typical methods of eQTL mapping include linear regression and ANOVA, where the expression level is taken as the dependent variable and the genotype at a single-nucleotide variation (SNV) site is the explaining factor [<xref ref-type="bibr" rid="CR7">7</xref>, <xref ref-type="bibr" rid="CR16">16</xref>]. Most of those methods are based on the assumption that expression levels or its logarithms follow normal distribution, Poisson distribution or negative binomial distribution [<xref ref-type="bibr" rid="CR17">17</xref>]. The Krux method used a non-parametric way to identify eQTL and claim their method is more robust [<xref ref-type="bibr" rid="CR15">15</xref>]. These existing methods including the non-parametric ones can lose their power when applied on single-cell RNA-seq data because of the special characteristics of single-cell sequencing data, especially the excess of zero values.</p>
    <p id="Par12">The phenomenon of excess of zero values is common in single-cell RNA-seq (scRNA-seq) data [<xref ref-type="bibr" rid="CR2">2</xref>, <xref ref-type="bibr" rid="CR9">9</xref>]. There are mainly two reasons. Because the amount of total RNAs in a single cell is extremely small, there is high probability that the RNA capture, reverse transcription and amplification steps may miss some transcripts, causing the expression of some expressed genes not observed in the sequencing data. This is usually called “drop-out” events. Another reason is that gene expression is a stochastic process at single-cell level [<xref ref-type="bibr" rid="CR11">11</xref>]. This results in variations of gene transcription status between cells besides variations in gene expression abundances. The possibility for a gene to have a real zero expression level or to be in the “off” status of transcription is much higher in single cells than in the pooled transcriptomes of many cells in bulk RNA-seq data [<xref ref-type="bibr" rid="CR5">5</xref>, <xref ref-type="bibr" rid="CR10">10</xref>]. There are two types of heterogeneity in gene expression: heterogeneity in the “on-off” status of a gene’s transcription, and heterogeneity in the abundance of expressed genes. Studying such heterogeneities is one of the major purposes of single-cell sequencing. Because of these special properties, when we analyze eQTLs on scRNA-seq data, we also face two possible types of differences in gene expression associated with variation in genotypes: differences in the transcription status of a gene and differences in expression levels of an expressed gene. We call them as “status difference” and “expression level difference”, respectively. We developed SCeQTL to analyze these two types of differences that may be associated with genotype variations. The method can also be applied to analyze associations of gene expression with other types of groupings such as cell lineages or cell types.</p>
  </sec>
  <sec id="Sec2">
    <title>Results</title>
    <sec id="Sec3">
      <title>Zero-inflated generalized linear model</title>
      <p id="Par13">We model scRNA-seq data as the outcome of two processes. One is that transcripts are captured in the sequencing and the corresponding gene gets non-negative expression values. The other is that transcripts are missed or the gene is not expressed in the cell, which will result in zero values in the data. The second process causes scRNA-seq data to have excess zero values. We find the negative binomial (NB) distribution can fit the non-zero parts of scRNA-seq data well in a way similar to bulk RNA-seq data (Fig. <xref rid="Fig3" ref-type="fig">3</xref> and Fig. <xref rid="Fig4" ref-type="fig">4</xref>a), but there can be a high probability of a gene being zeros in the single-cell data.</p>
      <p id="Par14">Therefore, we use a zero-inflated negative binomial (ZINB) regression to model the scRNA-seq data as we have done in [<xref ref-type="bibr" rid="CR10">10</xref>]. For gene expression <italic>g</italic> and genotype <italic>s</italic>, there is probability <italic>p</italic> that the transcription is off and we have the observation of a zero value in a cell, and probability 1 − <italic>p</italic> that the gene is expressed with values being described as following a negative binomial distribution. We call the probability <italic>p</italic> as zero ratio for simplicity. We write these as
<disp-formula id="Equa"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ g\sim \left\{\begin{array}{c}0\  with\ probability\ p\\ {} NB\left(\mu, \theta \right)\  with\ probability\ 1-p\end{array}\right., $$\end{document}</tex-math><mml:math id="M2" display="block"><mml:mi>g</mml:mi><mml:mo>~</mml:mo><mml:mfenced open="{"><mml:mtable><mml:mtr><mml:mtd><mml:maligngroup/><mml:mn>0</mml:mn><mml:mspace width="0.25em"/><mml:mtext mathvariant="italic">with probability</mml:mtext><mml:mspace width="0.25em"/><mml:mi>p</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:maligngroup/><mml:mi mathvariant="italic">NB</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:mi>μ</mml:mi><mml:mi>θ</mml:mi></mml:mfenced><mml:mspace width="0.25em"/><mml:mtext mathvariant="italic">with probability</mml:mtext><mml:mspace width="0.25em"/><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>p</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mfenced><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12859_2020_3534_Article_Equa.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par15">where <italic>μ</italic> and <italic>θ</italic> are the mean and shape parameter of the negative binomial distribution. We call a SNV to be an eQTL of a gene if the zero ratio <italic>p</italic> and/or the mean of negative binomial distribution <italic>μ</italic> is significantly correlated with the genotype of the SNV in a way that
<disp-formula id="Equb"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \ln \left(\frac{p}{1-p}\right)={\alpha}_1+{\beta}_1s $$\end{document}</tex-math><mml:math id="M4" display="block"><mml:mo>ln</mml:mo><mml:mfenced close=")" open="("><mml:mfrac><mml:mi>p</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:mfrac></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mi>s</mml:mi></mml:math><graphic xlink:href="12859_2020_3534_Article_Equb.gif" position="anchor"/></alternatives></disp-formula>and/or
<disp-formula id="Equc"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \ln \left(\mu \right)={\alpha}_2+{\beta}_2s, $$\end{document}</tex-math><mml:math id="M6" display="block"><mml:mo>ln</mml:mo><mml:mfenced close=")" open="("><mml:mi>μ</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mi>s</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12859_2020_3534_Article_Equc.gif" position="anchor"/></alternatives></disp-formula>where <italic>s</italic> is the genotype (or other distinguishing factor to group the cells), parameters <italic>α</italic><sub>1</sub>, <italic>α</italic><sub>2</sub>, <italic>β</italic><sub>1</sub>, <italic>β</italic><sub>2</sub> and the shape parameter <italic>θ</italic> are to be estimated from the data. Using maximum likelihood method to estimate the parameters, we get the log-likelihoods of the full model that includes the genotype as the explaining factor (<italic>β</italic><sub>1</sub> ≠ 0 or <italic>β</italic><sub>2</sub> ≠ 0) and of the reduced model that does not include the genotype (<italic>β</italic><sub>1</sub> = 0 <italic>or β</italic><sub>2</sub> = 0).</p>
      <p id="Par16">The generalized linear model contains two parts: distribution hypothesis and link function. In distribution hypothesis, the probability density function (pdf) of over-dispersed exponential families is
<disp-formula id="Equd"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ p\left(x|\eta \right)=h\left(x,\sigma \right){e}^{\frac{\eta^TT(x)-A\left(\eta \right)}{\sigma }} $$\end{document}</tex-math><mml:math id="M8" display="block"><mml:mi>p</mml:mi><mml:mfenced close=")" open="(" separators="|"><mml:mi>x</mml:mi><mml:mi>η</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:mi>h</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:mi>x</mml:mi><mml:mi>σ</mml:mi></mml:mfenced><mml:msup><mml:mi>e</mml:mi><mml:mfrac><mml:mrow><mml:msup><mml:mi>η</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>T</mml:mi><mml:mfenced close=")" open="("><mml:mi>x</mml:mi></mml:mfenced><mml:mo>−</mml:mo><mml:mi>A</mml:mi><mml:mfenced close=")" open="("><mml:mi>η</mml:mi></mml:mfenced></mml:mrow><mml:mi>σ</mml:mi></mml:mfrac></mml:msup></mml:math><graphic xlink:href="12859_2020_3534_Article_Equd.gif" position="anchor"/></alternatives></disp-formula>where <italic>η</italic> is a natural parameter, <italic>T</italic>(<italic>x</italic>) is a sufficient statistic, and <italic>A</italic>(<italic>η</italic>) is used to guarantee the integral of pdf to be 1. Link function describes how the expectation of corresponding variable is related to the linear combination of independent variables:
<disp-formula id="Eque"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \mathrm{E}\left(\mathrm{Y}\right)=\mu ={g}^{-1}\left( X\beta \right) $$\end{document}</tex-math><mml:math id="M10" display="block"><mml:mi mathvariant="normal">E</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="normal">Y</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mi>g</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:mi mathvariant="italic">Xβ</mml:mi></mml:mfenced></mml:math><graphic xlink:href="12859_2020_3534_Article_Eque.gif" position="anchor"/></alternatives></disp-formula>where <italic>g</italic> is the link function. For NB distribution, the link function is
<disp-formula id="Equf"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ X\beta =\ln \left(\mu \right). $$\end{document}</tex-math><mml:math id="M12" display="block"><mml:mi mathvariant="italic">Xβ</mml:mi><mml:mo>=</mml:mo><mml:mo>ln</mml:mo><mml:mfenced close=")" open="("><mml:mi>μ</mml:mi></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="12859_2020_3534_Article_Equf.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par17">According to the generalized linear model theory [<xref ref-type="bibr" rid="CR12">12</xref>], the deviance, which is − 2 times the log-likelihood ratio of the reduced model compared to the full model, follows an approximate chi-square distribution with <italic>k</italic> degree of freedom. The <italic>k</italic> is the difference between parameter numbers of the full model and the reduced model. We use the deviance as the test statistic to test for whether <italic>β</italic><sub>1</sub> = 0 or <italic>β</italic><sub>2</sub> = 0. By these two hypothesis tests, we can identify whether the gene expression have association with the genotype (or other factor used to group cells) and what kind of association it is. We call this method as SCeQTL and developed a software package in R to implement it (<ext-link ext-link-type="uri" xlink:href="https://github.com/XuegongLab/SCeQTL/">https://github.com/XuegongLab/SCeQTL/</ext-link>).</p>
    </sec>
    <sec id="Sec4">
      <title>Simulation experiments</title>
      <p id="Par18">Single-cell parallel sequencing technologies of both the genome and transcriptome are currently only available in very few labs, and the current genomic coverage of such technologies may not be sufficient for genotyping analysis yet. So it is still hard to find public datasets including both single-cell genomic sequencing data with sufficient depth and single-cell RNA-sequencing data of the same single cells. Therefore, we first did a series of simulation experiments to study the performance of SCeQTL. Both genotype and phenotype data were simulated simultaneously under different effect size. We applied SCeQTL and the widely used Matrix eQTL [<xref ref-type="bibr" rid="CR16">16</xref>] on the simulation data for comparison. Matrix eQTL is a highly-efficient method for eQTL analysis designed for bulk data.</p>
      <p id="Par19">We simulated genotype and gene expression data of 1500 cells of three SNVs and 20 genes in each simulation experiment. Considering the probable effect of different frequencies of three genotypes (denoted by <italic>s</italic> = 0, 1, 2), we generated three SNVs (denoted as SNV 1–3) with different genotype frequencies, and conducted four experiments (denoted as Experiment 1–4) for each SNV. These experiments aimed to mimic four scenarios: transcription status set at same or different level while expression values change with genotypes, and expression values set at same or different level while transcription status change with genotypes. Under each scenario, we experimented on changes across different effect sizes. Ten significant gene-SNV pairs were randomly generated for each SNV, and were taken as the ground truth in performance analysis. Gene expression metrics were generated by ZINB model of different parameters. We define three types of genes that are associated with genotypes in the simulation model: genes whose expression values differ among genotypes (Ges), genes’ transcription status differs among genotypes (Gts), and both transcription status and expression values differ among genotypes (Gs). Table <xref rid="Tab1" ref-type="table">1</xref> shows the overall design of the simulation data.
<table-wrap id="Tab1"><label>Table 1</label><caption><p>Simulation experiments description</p></caption><table frame="hsides" rules="groups"><thead><tr><th>SNVs</th><th colspan="2">Experiments</th><th>Unchanged parameters</th><th>Changed parameters</th><th>Number of experiments</th></tr></thead><tbody><tr><td rowspan="12">SNV 1 (freq. of s = 0/1/2: 0.25/0.5/ 0.25)</td><td rowspan="3">Experiment 1</td><td rowspan="3">Zero ratios set to the same (0.5). Differences in NB means among three genotypes increase.</td><td><italic>α</italic><sub>1</sub> = 0</td><td rowspan="6"><italic>β</italic><sub>2</sub> ranges from 0 to 0.6, with increasing step of 0.05 across experiments.</td><td char="." align="char" rowspan="3">13</td></tr><tr><td><italic>β</italic><sub>1</sub> = 0</td></tr><tr><td><italic>α</italic><sub>2</sub> = 6</td></tr><tr><td rowspan="3">Experiment 2</td><td rowspan="3">Zero ratios set at different levels (0.5, 0.57 and 0.65). Differences in NB means among three genotypes increase.</td><td><italic>α</italic><sub>1</sub> = 0</td><td char="." align="char" rowspan="3">13</td></tr><tr><td><italic>β</italic><sub>1</sub> = 0.3</td></tr><tr><td><italic>α</italic><sub>2</sub> = 6</td></tr><tr><td rowspan="3">Experiment 3</td><td rowspan="3">NB means set at the same level (403.43). Differences in zero ratios among three genotypes increase.</td><td><italic>α</italic><sub>2</sub> = 6</td><td rowspan="6"><italic>β</italic><sub>1</sub> ranges from 0 to 0.6, with increasing step of 0.05 across experiments.</td><td char="." align="char" rowspan="3">13</td></tr><tr><td><italic>β</italic><sub>2</sub> = 0</td></tr><tr><td><italic>α</italic><sub>1</sub> = 0</td></tr><tr><td rowspan="3">Experiment 4</td><td rowspan="3">NB means set at different levels (403.43, 601.85 and 897.85). Differences in zero ratios among three genotypes increase.</td><td><italic>α</italic><sub>2</sub> = 6</td><td char="." align="char" rowspan="3">13</td></tr><tr><td><italic>β</italic><sub>2</sub> = 0.4</td></tr><tr><td><italic>α</italic><sub>1</sub> = 0</td></tr><tr><td>SNV 2 (0.16/0.48/0.36)</td><td colspan="5">Same as in SNV 1</td></tr><tr><td>SNV 3 (0.09/0.42/0.49)</td><td colspan="5">Same as in SNV 1</td></tr></tbody></table></table-wrap></p>
      <p id="Par20">For each experiment, we get the ROC curves of both methods by calculating the false positive rate and true positive rate by comparing the detection result with the simulation model. We use Area Under Curve (AUC) of ROC curves to demonstrate performance of the two methods. Larger AUC value means higher accuracy. Figure <xref rid="Fig1" ref-type="fig">1</xref> summarizes the experiment results. It shows that different proportions of genotypes do not affect results. Further checking the results in four experiments of the same SNV, we can see that when only one aspect (zero ratio or NB mean) differs (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a, c), performance of the two methods largely overlaps: AUC value first rises, then holds with effect sizes increasing. A minor difference shown in Fig. <xref rid="Fig1" ref-type="fig">1</xref>a is that the power of SCeQTL rises earlier and more dramatically at smaller effect sizes. This indicates higher sensitivity of SCeQTL than Matrix eQTL for detecting Ges.
<fig id="Fig1"><label>Fig. 1</label><caption><p>AUC values of Experiment 1–4 for SNV 1–3. <bold>a</bold> AUC values of Experiment 1 for SNV 1–3. <bold>b</bold> AUC values of Experiment 2 for SNV 1–3. <bold>c</bold> AUC values of Experiment 3 for SNV 1–3. <bold>d</bold> AUC values of Experiment 4 for SNV 1–3</p></caption><graphic xlink:href="12859_2020_3534_Fig1_HTML" id="MO1"/></fig></p>
      <p id="Par21">In more complicated situations when both transcription status and expression values are different (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b, d), AUC value of SCeQTL keeps steady and high, while that of Matrix eQTL drops drastically at certain effect sizes. This suggests the superiority of SCeQTL in terms of power when detecting Gs. An explanation is that, in Fig. <xref rid="Fig1" ref-type="fig">1</xref>b, the increase of zero ratio gradually offset the divergence of NB mean in three genotypes with <italic>β</italic><sub>2</sub> increasing; and in Fig. <xref rid="Fig1" ref-type="fig">1</xref>d, the increase of NB mean gradually offset the divergence of zero ratio with <italic>β</italic><sub>1</sub> increasing. Both cases resulted in similar mean in three genotypes which Matrix eQTL cannot distinguish. But once the influence of zero ratio or NB mean became dominant, the power of Matrix eQTL would recover, as is shown in the right part of curves in Fig. <xref rid="Fig1" ref-type="fig">1</xref>b and the left part of curves in Fig. <xref rid="Fig1" ref-type="fig">1</xref>d.</p>
      <p id="Par22">Figure <xref rid="Fig2" ref-type="fig">2</xref> shows gene expression distributions of three example significant eQTLs which cannot be detected by Matrix eQTL. Figure <xref rid="Fig2" ref-type="fig">2</xref>a shows expression levels of a Ge referred to the point in Fig. <xref rid="Fig1" ref-type="fig">1</xref>a when <italic>β</italic><sub>2</sub> = 0.05. SCeQTL can detect the slight difference in NB mean, but Matrix eQTL cannot. Figure <xref rid="Fig2" ref-type="fig">2</xref>b and c display similar situations when detecting Gs. They correspond to the point in Fig. <xref rid="Fig1" ref-type="fig">1</xref>b when <italic>β</italic><sub>2</sub> = 0.15 and Fig. <xref rid="Fig1" ref-type="fig">1</xref>d when <italic>β</italic><sub>1</sub> = 0.5, respectively. Again, SCeQTL found the differences very significant, while Matrix eQTL found them insignificant. They could support our analyses above.
<fig id="Fig2"><label>Fig. 2</label><caption><p>Examples of Ges and Gs for SNV 2 where SCeQTL found significant, but Matrix eQTL did not. <bold>a</bold> Ge (gene14) in Experiment 1, corresponding to the point in Figure <xref rid="Fig1" ref-type="fig">1</xref>a when <italic>β</italic><sub>2</sub> = 0.05. Only expression levels are different. <bold>b</bold> G (gene5) in Experiment 2, corresponding to the point in Figure <xref rid="Fig1" ref-type="fig">1</xref>b when <italic>β</italic><sub>2</sub> = 0.15. Both transcription status and expression levels are different. <bold>(c)</bold> G (gene11) in Experiment 4, corresponding to the point in Figure <xref rid="Fig1" ref-type="fig">1</xref>d when <italic>β</italic><sub>1</sub> = 0.5. Both transcription status and expression levels are different</p></caption><graphic xlink:href="12859_2020_3534_Fig2_HTML" id="MO2"/></fig></p>
    </sec>
    <sec id="Sec5">
      <title>Real data experiments</title>
      <p id="Par23">Currently public datasets with both genotype and transcriptome sequenced in the same single cells are still rare, and those only few available datasets still have very limited coverage in SNVs. We therefore used a real RNA-seq dataset without cell-level genotype but with multiple groups of cell attributes to further study the performance of SCeQTL. The data we used is a scRNA-seq dataset of human preimplantation embryo cells of different embryo days [<xref ref-type="bibr" rid="CR14">14</xref>]. We split the cells into three groups according to the embryonic day (E5, E6 and E7) to mimic cells of three genotypes. We use this dataset to show that SCeQTL not only works for single-cell eQTL applications, but also can be applied to the more general scenarios of detecting gene expression variations that are associated with other types of grouping factors of cells.</p>
      <p id="Par24">We first checked whether the non-zero expression data were fitted well with our model using the ‘checkdist’ function in our package. We randomly picked some genes and drew Q-Q plot to compare gene expression distribution with several distributions. Figure <xref rid="Fig3" ref-type="fig">3</xref> and Figure <xref rid="Fig4" ref-type="fig">4</xref>a shows that negative binomial distribution is appropriate for modeling the non-zero part of the data, while the lines in Q-Q plot of other distributions are far away from the diagonal. The histogram in Figure <xref rid="Fig4" ref-type="fig">4</xref>b shows that the drop-out event is very common in single-cell RNA-seq data and needs to be considered.
<fig id="Fig3"><label>Fig. 3</label><caption><p>Q-Q plot of scRNA-seq data with (<bold>a</bold>) Negative Binomial distribution (<bold>b</bold>) Poisson distribution (<bold>c</bold>) Normal distribution (<bold>d</bold>) Log-normal distribution</p></caption><graphic xlink:href="12859_2020_3534_Fig3_HTML" id="MO3"/></fig><fig id="Fig4"><label>Fig. 4</label><caption><p><bold>a</bold> Probability density function of fitted distributions and the histogram of a sample; <bold>b</bold> Histogram of the proportion of zeros of all the genes</p></caption><graphic xlink:href="12859_2020_3534_Fig4_HTML" id="MO4"/></fig></p>
      <p id="Par25">We applied both SCeQTL and Matrix eQTL [<xref ref-type="bibr" rid="CR16">16</xref>] on these data for comparison. We first conducted experiments to study the distribution of <italic>p</italic>-values of the two methods under the null hypothesis of no eQTL. Figure <xref rid="Fig5" ref-type="fig">5</xref> show the <italic>p</italic>-value distributions under null hypothesis, which were obtained by randomly generating and permuting the “genotype” (the embryonic days in this experiment) and use two methods to calculate the <italic>p</italic>-values. The <italic>p</italic>-value distribution of SCeQTL is close to uniform distribution between 0 and 1, while the <italic>p</italic>-value distribution of Matrix eQTL has clear deviation from uniform.
<fig id="Fig5"><label>Fig. 5</label><caption><p><italic>P</italic>-value distribution under null hypothesis of (<bold>a</bold>) SCeQTL and (<bold>b</bold>) Matrix eQTL. <bold>c</bold> An example that non-zero part of gene expression have significant differences among genotype groups. <bold>d</bold> The non-zero part of an example of significant zero-ratio differences. Zero-ratio of three genotype groups are 0.76, 0.26 and 0.26, respectively. We can see from the figure that the non-zero expressions are not associated with the genotype, but the zero-ratios are. These findings will be not significant for Matrix eQTL after multiple test correction, but are very significant for SCeQTL</p></caption><graphic xlink:href="12859_2020_3534_Fig5_HTML" id="MO5"/></fig></p>
      <p id="Par26">On the eQTL results in the experiment of true embryonic day with gene expression, we found that results of the two methods largely overlapped, but there were noticeable cases on which SCeQTL worked better. Figure <xref rid="Fig5" ref-type="fig">5</xref>c shows an example that non-zero part had significant difference but Matrix eQTL didn’t find it. The <italic>p</italic>-values obtained by SCeQTL and Matrix eQTL are 9.37 × 10<sup>−9</sup> and 0.002, respectively. The test has been done for all the 23,981 genes in this dataset. This eQTL is very significant for SCeQTL but will not significant for Matrix eQTL after multiple-test correction. One reason is that the negative binomial distribution fit the single-cell data better than normal distribution. On the other hand, the zero values in scRNA-seq data caused the means of the three groups to be almost equal, so that Matrix eQTL could not detect the difference. Figure <xref rid="Fig5" ref-type="fig">5</xref>d gives an example that zero ratios have significant differences among the compared groups (0.76, 0.26 and 0.26) but non-zero parts shown by the boxplots are almost same. The <italic>p</italic>-values with SCeQTL and Matrix eQTL are 1.09 × 10<sup>−45</sup> and 0.004, respectively. Matrix eQTL can’t detect differences of this type either.</p>
      <p id="Par27">We also experimented on this dataset using cell lineage as the factor to distinguish three cell groups, and found SCeQTL could successfully find results that can be confirmed with biological knowledge on embryonic cell lineages. By dividing the samples by cell lineages EPI (epiblast), TE (trophectoderm) and PE (primitive endoderm), we applied SCeQTL to find genes that vary among different cell lineages. Among all 23,981 genes, SCeQTL found about 20 genes with <italic>p</italic>-value less than 10<sup>−40</sup>, 70 genes with <italic>p</italic>-value less than 10<sup>−30</sup> and 200 genes with <italic>p</italic>-value less than 10<sup>−20</sup>. In these genes that are significantly associated with cell lineages, we found some have been reported as lineage specific genes in the literature. For example, for EPI-specific genes PRDM14, GDF3, TDGF1, NODAL, SOX2 and NANOG, their <italic>p</italic>-values are 5.7 × 10<sup>−45</sup> 、 4.7 × 10<sup>−20</sup>, 6.5 × 10<sup>−16</sup>, 4.0 × 10<sup>−21</sup>, 5.1 × 10<sup>−37</sup> and 4.8 × 10<sup>−25</sup>; for TE-specific genes GATA2, GATA3 and DAB2, their <italic>p</italic>-values are 4.1 × 10<sup>−20</sup>, 6.7 × 10<sup>−26</sup> and 3.3 × 10<sup>−21</sup>; and for PE-specific genes HNF1B, PDGFRA and GATA4, their <italic>p</italic>-values are 5.7 × 10<sup>−32</sup>, 1.7 × 10<sup>−23</sup> and 2.0 × 10<sup>−35</sup>, respectively. All these lineage-specific genes ranked at top 200 in our result. It is worth noting that quite a lot of these genes have shown obvious transcription status differences in our SCeQTL analysis, which may imply that gene transcription in single cells are undergone on-off regulation in many scenarios. To double check the reliability of the SCeQTL discoveries, we manually checked some of the results and found most significant genes truly have differences among the compared groups. Figure <xref rid="Fig6" ref-type="fig">6</xref> shows three examples. <italic>P</italic>-values of SCeQTL in the examples are 4.1 × 10<sup>−50</sup>, 4.8 × 10<sup>−33</sup> and 1.5 × 10<sup>−23</sup> respectively. These experiments showed the potential for discovering associations in single cells that cannot be identified using existing eQTL methods. The biological implication of those associations can be important and deserve further investigations.
<fig id="Fig6"><label>Fig. 6</label><caption><p>Examples of lineage-associated genes identified by SCeQTL. <bold>a</bold> PSORS1C2: Zero-ratio of three lineages are 0.18, 0.85, and 0.57, respectively. <bold>b</bold> PTPRZ1: Zero-ratio of three genotype groups are 0.45, 0.93 and 0.73, respectively. <bold>c</bold> AMDHD1: Zero-ratio of three genotype groups are 0.60, 0.79, and 0.38, respectively</p></caption><graphic xlink:href="12859_2020_3534_Fig6_HTML" id="MO6"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec6">
    <title>Discussion</title>
    <p id="Par28">A limitation of the proposed SCeQTL method is that the computation cost is relatively high if applied for eQTL analysis at whole-genome scale. It can take a few minutes to analyze a few hundred gene-SNV pairs on a single computing node. This is mainly due to the iterative procedures in estimating the parameters. However, for most single-cell studies, the cells are from the same tissue sample or closely related samples. We can expect that the number of SNVs among the cells that need to be studied for eQTL analysis is not too large to make the computing cost of SCeQTL a severe issue in practical applications. This will also not be an issue when we use SCeQTL to analyze the association of gene expression with other factors as we did in the application examples.</p>
    <p id="Par29">The analysis of the associations of genotypic variations with gene expression as well as alternative splicing [<xref ref-type="bibr" rid="CR18">18</xref>] is a fundamental step for understanding the complex gene regulation system of human in health and disease. Cells are the basic units where the regulation happens. The broad existence of heterogeneities in gene expression both in quantity and in alternative splicing isoforms among cells is important in human physiology and pathology. This gives a strong motivation why functional genomics studies are moving quickly into single-cell levels. This is also true for the study of gene regulations. The current single-cell genomics technologies are still at their early stages and not widely available for large-scale studies of gene regulations within single cells, but technologies are developing and evolving rapid toward these goals. We hope the proposed SCeQTL method and software provides a ready and effective tool for this development.</p>
  </sec>
  <sec id="Sec7">
    <title>Conclusions</title>
    <p id="Par30">We proposed a new method for eQTL analysis on single-cell genomic and transcriptomic parallel sequencing data and developed a software package SCeQTL to implement the method. Experiments showed that the method can reveal associations that cannot be identified with existing eQTL methods developed for bulk data. It can also be applied on tasks of finding the association of gene expression with other grouping factors that distinguish cells into different types. It provides an effective tool for exploring gene regulation relationships at single-cell level.</p>
  </sec>
  <sec id="Sec8">
    <title>Methods</title>
    <sec id="Sec9">
      <title>Data preprocessing</title>
      <p id="Par31">Multiple steps of data pre-processing are necessary before using SCeQTL. Firstly, we remove the effect of the library size. We use the normalization method in DEseq [<xref ref-type="bibr" rid="CR1">1</xref>] for this normalization. The median of the ratios of observed counts is used to measure the sequencing depth.
<disp-formula id="Equg"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {s}_j= media{n}_i\frac{g_{ij}}{{\left({\prod}_{v=1}^m{g}_{iv}\right)}^{\frac{1}{m}}} $$\end{document}</tex-math><mml:math id="M14" display="block"><mml:msub><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mtext mathvariant="italic">media</mml:mtext><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mfrac><mml:msub><mml:mi>g</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mo>∏</mml:mo><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>m</mml:mi></mml:msubsup><mml:msub><mml:mi>g</mml:mi><mml:mi mathvariant="italic">iv</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:mfrac><mml:mn>1</mml:mn><mml:mi>m</mml:mi></mml:mfrac></mml:msup></mml:mfrac></mml:math><graphic xlink:href="12859_2020_3534_Article_Equg.gif" position="anchor"/></alternatives></disp-formula>where <italic>g</italic><sub><italic>ij</italic></sub> is the expression level of gene i in sample j. The denominator is obtained by calculating the geometric mean across non-zero samples. As discussed in [<xref ref-type="bibr" rid="CR1">1</xref>], this method is more robust than just taking the sum of all genes as sequencing depth since otherwise the highly expressed gene would dominant the result, which is often seen in single-cell gene expression data. All samples are normalized by the size factor, and we round down the resulted expression values to fit our read-counts model.</p>
      <p id="Par32">Next, single-cell RNA-seq data are noisy and we need to remove genes and variants which are not suitable for the analysis. Genes with read counts less than a certain threshold (by default, &lt;=1) are treated as not expressed and are therefore removed. We only consider genes whose variances are greater than a certain threshold (by default, &gt; = 5). For genomic variants, only variants with at least two genotypic groups in the dataset and each genotype has at least 5 samples (cells) are further considered.</p>
      <p id="Par33">When we enter the iteration of analyzing every gene-variant pairs, pairs that don’t have enough non-zero values (by default, &lt;=5) in one genotype are reported. The estimation of distribution parameters can be far away from true values in this situation. And we find that in real data, there are samples whose expression level is much higher than the others. If we include these samples into consideration, the mean of negative binomial distribution will be overestimated. So we treat these samples as outlier and use robust z score as defined below to remove them (by default, &gt; = 4), where MAD stands for the median absolute deviation:
<disp-formula id="Equh"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {z}_{robust}=\frac{g_{ij}- media{n}_j\left({g}_{ij}\right)}{MA{D}_j\left({g}_{ij}\right)} $$\end{document}</tex-math><mml:math id="M16" display="block"><mml:msub><mml:mi>z</mml:mi><mml:mtext mathvariant="italic">robust</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mtext mathvariant="italic">media</mml:mtext><mml:msub><mml:mi>n</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:msub><mml:mi>g</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub></mml:mfenced></mml:mrow><mml:mrow><mml:mi mathvariant="italic">MA</mml:mi><mml:msub><mml:mi>D</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:msub><mml:mi>g</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="12859_2020_3534_Article_Equh.gif" position="anchor"/></alternatives></disp-formula></p>
    </sec>
    <sec id="Sec10">
      <title>Parameter estimation</title>
      <p id="Par34">The package ‘pscl’ [<xref ref-type="bibr" rid="CR19">19</xref>] is used to estimate the parameter and calculate the log-likelihood. The package uses the EM algorithm or BFGS algorithm to iteratively update the parameter estimation.</p>
    </sec>
    <sec id="Sec11">
      <title>Covariates correction</title>
      <p id="Par35">It is common that some hidden covariates may exist in the sampled population, such as age, gender, or other clinical variables. It is important to remove the effect of them from the eQTL study, as otherwise a high percentage of results will be false discoveries. SCeQTL allows user to define a covariate vector x as possible confounding factors to be considered in the analysis. With covariate vector x ∈ R<sup>n</sup>, the models become
<disp-formula id="Equi"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \ln \left(\frac{\mathrm{p}}{1-\mathrm{p}}\right)={\upalpha}_1+{\upbeta}_1\mathrm{s}+{\sum}_{\mathrm{i}=1}^{\mathrm{n}}{\upgamma}_{1\mathrm{i}}{\mathrm{x}}_{\mathrm{i}}, $$\end{document}</tex-math><mml:math id="M18" display="block"><mml:mo>ln</mml:mo><mml:mfenced close=")" open="("><mml:mfrac><mml:mi mathvariant="normal">p</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi mathvariant="normal">p</mml:mi></mml:mrow></mml:mfrac></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="normal">α</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="normal">β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mi mathvariant="normal">s</mml:mi><mml:mo>+</mml:mo><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi mathvariant="normal">i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:msubsup><mml:msub><mml:mi mathvariant="normal">γ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mi mathvariant="normal">i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12859_2020_3534_Article_Equi.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equj"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \ln \left(\upmu \right)={\upalpha}_2+{\upbeta}_2\mathrm{s}+{\sum}_{\mathrm{i}=1}^{\mathrm{n}}{\upgamma}_{2\mathrm{i}}{\mathrm{x}}_{\mathrm{i}}, $$\end{document}</tex-math><mml:math id="M20" display="block"><mml:mo>ln</mml:mo><mml:mfenced close=")" open="("><mml:mi mathvariant="normal">μ</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="normal">α</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="normal">β</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mi mathvariant="normal">s</mml:mi><mml:mo>+</mml:mo><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi mathvariant="normal">i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:msubsup><mml:msub><mml:mi mathvariant="normal">γ</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi mathvariant="normal">i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12859_2020_3534_Article_Equj.gif" position="anchor"/></alternatives></disp-formula>where extra parameter vectors <bold><italic>γ</italic></bold><sub><bold>1</bold></sub> and <bold><italic>γ</italic></bold><sub><bold>2</bold></sub> to be estimated. The hypothesis test process is the same as non-covariates one. As a special consideration in single-cell studies, potential correlations among single cells from the same individual or from the same cell type can be modeled in this covariate vector to make sure that the associations detected with SCeQTL are not due to those factors.</p>
    </sec>
    <sec id="Sec12">
      <title>Multiple test correction</title>
      <p id="Par36">We provide two ways to control the false discovery, Benjamini-Hochberg (BH) method [<xref ref-type="bibr" rid="CR3">3</xref>] and the q-value method. The q-value method is implemented by R package ‘qvalue’ (<ext-link ext-link-type="uri" xlink:href="http://github.com/jdstorey/qvalue">http://github.com/jdstorey/qvalue</ext-link>). Since several publications come up with other methods for multiple test correction in eQTL mapping [<xref ref-type="bibr" rid="CR4">4</xref>, <xref ref-type="bibr" rid="CR13">13</xref>], users can also select whether to let SCeQTL to report <italic>p</italic>-value or false discovery rates and set the threshold according to other correction methods.</p>
    </sec>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>SCeQTL</term>
        <def>
          <p id="Par4">Single Cell expression Quantitative Trait Locus</p>
        </def>
      </def-item>
      <def-item>
        <term>scRNA-seq</term>
        <def>
          <p id="Par5">Single cell RNA sequencing</p>
        </def>
      </def-item>
      <def-item>
        <term>ANOVA</term>
        <def>
          <p id="Par6">ANalysis Of VAriance</p>
        </def>
      </def-item>
      <def-item>
        <term>MAD</term>
        <def>
          <p id="Par7">Median absolute deviation</p>
        </def>
      </def-item>
      <def-item>
        <term>EM</term>
        <def>
          <p id="Par8">Expectation-Maximization</p>
        </def>
      </def-item>
      <def-item>
        <term>BFGS</term>
        <def>
          <p id="Par9">Broyden–Fletcher–Goldfarb–Shanno</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>Yue Hu and Xi Xi contributed equally to this work and should be both regarded as the first author of this work.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank Hao Sun, Zhun Miao and Tianxing Ma for helping to test the package.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>YH developed the method, the R package and conducted the experiments on the real data. XX designed the simulations and conducted the simulation experiments with the help from QY. XZ initiated and supervised the project. YH, XX, QY and XZ wrote the manuscript. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>This work is partially supported by the National Key R&amp;D Program of China grant 2018YFC0910401, NSFC grant 61721003 by the CZI HCA Seed Network Project. The funding bodies have not played any role in the design of the study, the collection, analysis, interpretation of data, or the writing of the manuscript.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The R package of the method is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/XuegongLab/SCeQTL/">https://github.com/XuegongLab/SCeQTL/</ext-link>.</p>
  </notes>
  <notes id="FPar1">
    <title>Ethics approval and consent to participate</title>
    <p id="Par37">Not applicable.</p>
  </notes>
  <notes id="FPar2">
    <title>Consent for publication</title>
    <p id="Par38">Not applicable.</p>
  </notes>
  <notes id="FPar3" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par39">The authors declare that they have no competing interests. The last author XZ is a member of the editorial board (Associate Editor) of this journal.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Anders</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Huber</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Differential expression analysis for sequence count data</article-title>
        <source>Genome Biol</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>R106</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2010-11-10-r106</pub-id>
        <?supplied-pmid 20979621?>
        <pub-id pub-id-type="pmid">20979621</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bacher</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Kendziorski</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Design and computational analysis of single-cell RNA-sequencing experiments</article-title>
        <source>Genome Biol</source>
        <year>2016</year>
        <volume>17</volume>
        <fpage>63</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-016-0927-y</pub-id>
        <pub-id pub-id-type="pmid">27052890</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Benjamini</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Hochberg</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Controlling the false discovery rate: a practical and powerful approach to multiple testing</article-title>
        <source>J Royal Stat Soc</source>
        <year>1995</year>
        <volume>Series B. 57</volume>
        <issue>1</issue>
        <fpage>125</fpage>
        <lpage>133</lpage>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Degnan</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genomics and genome-wide association studies: an integrative approach to expression QTL mapping</article-title>
        <source>Genomics</source>
        <year>2008</year>
        <volume>92</volume>
        <fpage>129</fpage>
        <lpage>133</lpage>
        <pub-id pub-id-type="doi">10.1016/j.ygeno.2008.05.012</pub-id>
        <pub-id pub-id-type="pmid">18586451</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Delmans</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Hemberg</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Discrete distribution differential expression (D3E) – a tool for gene expression analysis of single-cell RNA-seq data</article-title>
        <source>BMC Bioinformatics</source>
        <year>2016</year>
        <volume>17</volume>
        <fpage>110</fpage>
        <pub-id pub-id-type="doi">10.1186/s12859-016-0944-6</pub-id>
        <pub-id pub-id-type="pmid">26927822</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dey</surname>
            <given-names>SS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated genome and transcriptome sequencing of the same cell</article-title>
        <source>Nat Biotechnol</source>
        <year>2015</year>
        <volume>33</volume>
        <issue>3</issue>
        <fpage>285</fpage>
        <lpage>289</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3129</pub-id>
        <pub-id pub-id-type="pmid">25599178</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gatti</surname>
            <given-names>DM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>FastMap: fast eQTL mapping in homozygous populations</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <issue>4</issue>
        <fpage>482</fpage>
        <lpage>489</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btn648</pub-id>
        <pub-id pub-id-type="pmid">19091771</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Macaulay</surname>
            <given-names>IC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>G&amp;T-seq: parallel sequencing of single-cell genomes and transcriptomes</article-title>
        <source>Nat Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <issue>6</issue>
        <fpage>519</fpage>
        <lpage>522</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3370</pub-id>
        <pub-id pub-id-type="pmid">25915121</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Miao</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>Differential expression analyses for single-cell RNA-Seq: old questions on new data</article-title>
        <source>Quantitative Biol</source>
        <year>2016</year>
        <volume>4</volume>
        <issue>4</issue>
        <fpage>243</fpage>
        <lpage>260</lpage>
        <pub-id pub-id-type="doi">10.1007/s40484-016-0089-7</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Miao</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>DEsingle for detecting three types of differential expression in single-cell RNA-seq data</article-title>
        <source>Bioinformatics</source>
        <year>2018</year>
        <volume>34</volume>
        <issue>18</issue>
        <fpage>3223</fpage>
        <lpage>3224</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty332</pub-id>
        <pub-id pub-id-type="pmid">29688277</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Munsky</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Using gene expression noise to understand gene regulation</article-title>
        <source>Science</source>
        <year>2012</year>
        <volume>336</volume>
        <issue>6078</issue>
        <fpage>183</fpage>
        <lpage>187</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1216379</pub-id>
        <pub-id pub-id-type="pmid">22499939</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Nelder</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Baker</surname>
            <given-names>RJ</given-names>
          </name>
        </person-group>
        <source>Generalized linear models</source>
        <year>1972</year>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Peterson</surname>
            <given-names>CB</given-names>
          </name>
          <name>
            <surname>Bogomolov</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Benjamini</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TreeQTL: hierarchical error control for eQTL findings</article-title>
        <source>Bioinformatics</source>
        <year>2016</year>
        <volume>32</volume>
        <issue>16</issue>
        <fpage>2556</fpage>
        <lpage>2558</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw198</pub-id>
        <pub-id pub-id-type="pmid">27153635</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Petropoulos</surname>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA-Seq reveals lineage and X chromosome dynamics in human Preimplantation embryos</article-title>
        <source>Cell</source>
        <year>2016</year>
        <volume>165</volume>
        <issue>4</issue>
        <fpage>1012</fpage>
        <lpage>1026</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2016.03.023</pub-id>
        <pub-id pub-id-type="pmid">27062923</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qi</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>kruX: matrix-based non-parametric eQTL discovery</article-title>
        <source>BMC Bioinformatics</source>
        <year>2014</year>
        <volume>15</volume>
        <issue>1</issue>
        <fpage>11</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-15-11</pub-id>
        <pub-id pub-id-type="pmid">24423115</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shabalin</surname>
            <given-names>AA</given-names>
          </name>
        </person-group>
        <article-title>Matrix eQTL: ultra fast eQTL analysis via large matrix operations</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <issue>10</issue>
        <fpage>1353</fpage>
        <lpage>1358</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bts163</pub-id>
        <pub-id pub-id-type="pmid">22492648</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>A statistical framework for eQTL mapping using RNA-seq data</article-title>
        <source>Biometrics</source>
        <year>2012</year>
        <volume>68</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>11</lpage>
        <pub-id pub-id-type="doi">10.1111/j.1541-0420.2011.01654.x</pub-id>
        <pub-id pub-id-type="pmid">21838806</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yang</surname>
            <given-names>Q</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ulfasQTL: an ultra-fast method of composite splicing QTL analysis</article-title>
        <source>BMC Genomics</source>
        <year>2017</year>
        <volume>18</volume>
        <issue>Suppl 1</issue>
        <fpage>963</fpage>
        <pub-id pub-id-type="doi">10.1186/s12864-016-3258-1</pub-id>
        <pub-id pub-id-type="pmid">28198669</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeileis</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Kleiber</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Jackman</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Regression models for count data in R</article-title>
        <source>J Statistical Software</source>
        <year>2008</year>
        <volume>27</volume>
        <issue>8</issue>
        <fpage>1</fpage>
        <lpage>25</lpage>
        <pub-id pub-id-type="doi">10.18637/jss.v027.i08</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
