<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9665866</article-id>
    <article-id pub-id-type="pmid">36179077</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btac655</article-id>
    <article-id pub-id-type="publisher-id">btac655</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genetics and Population Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Integrating phylogenetic and functional data in microbiome studies</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-5164-6707</contrib-id>
        <name>
          <surname>Douglas</surname>
          <given-names>Gavin M</given-names>
        </name>
        <aff><institution>Department of Microbiology and Immunology, McGill University</institution>, Montréal, QC H3A 2B4, <country country="CA">Canada</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hayes</surname>
          <given-names>Molly G</given-names>
        </name>
        <aff><institution>Department of Mathematics and Statistics, Dalhousie University</institution>, Halifax, NS B3H 4R2, <country country="CA">Canada</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Langille</surname>
          <given-names>Morgan G I</given-names>
        </name>
        <aff><institution>Department of Microbiology and Immunology, Dalhousie University</institution>, Halifax, NS B3H 4R2, <country country="CA">Canada</country></aff>
        <xref rid="btac655-cor1" ref-type="corresp"/>
        <!--morgan.langille@dal.ca-->
        <xref rid="btac655-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Borenstein</surname>
          <given-names>Elhanan</given-names>
        </name>
        <aff><institution>Blavatnik School of Computer Science, Tel Aviv University</institution>, Tel Aviv 6997801, <country country="IL">Israel</country></aff>
        <aff><institution>Department of Clinical Microbiology and Immunology, Sackler Faculty of Medicine, Tel Aviv University</institution>, Tel Aviv 6997801, <country country="IL">Israel</country></aff>
        <aff><institution>Santa Fe Institute</institution>, Santa Fe, NM 87501, <country country="US">USA</country></aff>
        <xref rid="btac655-cor1" ref-type="corresp"/>
        <!--elbo@tauex.tau.ac.il-->
        <xref rid="btac655-FM1" ref-type="author-notes"/>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Schwartz</surname>
          <given-names>Russell</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <fn id="btac655-FM1">
        <p>The authors wish it to be known that, in their opinion, Morgan G. I. Langille and Elhanan Borenstein should be regarded as Joint Last Authors.</p>
      </fn>
      <corresp id="btac655-cor1">To whom correspondence should be addressed. Email: <email>morgan.langille@dal.ca</email> or <email>elbo@tauex.tau.ac.il</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>15</day>
      <month>11</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2022-09-30">
      <day>30</day>
      <month>9</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>30</day>
      <month>9</month>
      <year>2022</year>
    </pub-date>
    <volume>38</volume>
    <issue>22</issue>
    <fpage>5055</fpage>
    <lpage>5063</lpage>
    <history>
      <date date-type="received">
        <day>07</day>
        <month>4</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>10</day>
        <month>9</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>15</day>
        <month>9</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>29</day>
        <month>9</month>
        <year>2022</year>
      </date>
      <date date-type="corrected-typeset">
        <day>19</day>
        <month>10</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btac655.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Microbiome functional data are frequently analyzed to identify associations between microbial functions (e.g. genes) and sample groups of interest. However, it is challenging to distinguish between different possible explanations for variation in community-wide functional profiles by considering functions alone. To help address this problem, we have developed <italic toggle="yes">POMS</italic>, a package that implements multiple phylogeny-aware frameworks to more robustly identify enriched functions.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>The key contribution is an extended balance-tree workflow that incorporates functional and taxonomic information to identify functions that are consistently enriched in sample groups across independent taxonomic lineages. Our package also includes a workflow for running phylogenetic regression. Based on simulated data we demonstrate that these approaches more accurately identify gene families that confer a selective advantage compared with commonly used tools. We also show that POMS in particular can identify enriched functions in real-world metagenomics datasets that are potential targets of strong selection on multiple members of the microbiome.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>These workflows are freely available in the <italic toggle="yes">POMS</italic> R package at <ext-link xlink:href="https://github.com/gavinmdouglas/POMS" ext-link-type="uri">https://github.com/gavinmdouglas/POMS</ext-link>.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>NCBI</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Microbiome sequencing has been applied to characterize myriad environments and is typically analyzed based on the relative abundance of microbial features. These features may include both taxa (the microbes present) and functions (the genes and pathways they encode). While both data types have been leveraged to make valuable observations, they are typically analyzed independently. Yet, linking these data types is required to make coherent interpretations of observed shifts in microbiome data (<xref rid="btac655-B9" ref-type="bibr">Douglas and Langille, 2021</xref>; <xref rid="btac655-B25" ref-type="bibr">Manor and Borenstein, 2017</xref>). For example, an enrichment of a particular microbial pathway in a group of samples (e.g. a disease or unique environment) could represent selection on multiple independent taxa which possess that pathway, which would be of significant biological interest. In contrast, such an enrichment could have also arisen due to the presence of that pathway in a specific microbial taxon that is more abundant for various other reasons in the group of interest, making this enrichment less biologically interesting.</p>
    <p>Two approaches have been developed that partially address the challenge of how to link taxonomic and functional data types. <italic toggle="yes">FishTaco</italic> (<xref rid="btac655-B25" ref-type="bibr">Manor and Borenstein, 2017</xref>) is a tool that pinpoints the taxonomic contributors to functional shifts identified by differential abundance tests. <italic toggle="yes">FishTaco</italic>, however, is a post-hoc tool that is applied after significant microbial functions have been identified, whereas ideally, functional and taxonomic data would be integrated while testing for differential functions to better identify strong enrichment candidates.</p>
    <p><italic toggle="yes">Phylogenize</italic> is an approach that explicitly integrates functional and taxonomic data during statistical testing (<xref rid="btac655-B3" ref-type="bibr">Bradley <italic toggle="yes">et al.</italic>, 2018</xref>; <xref rid="btac655-B4" ref-type="bibr">Bradley and Pollard, 2020</xref>). It identifies functional associations based on the prevalence or specificity of taxa that encode each gene family. This is performed using phylogenetic linear models, which account for the genetic similarity of co-occurring taxa that arises due to their shared evolutionary history. Using this framework, significant gene families and pathways that are contributed by a diverse set of taxa from within a given phylum are identified. Although this approach forms a key improvement over past analytical approaches, it has not been widely adopted. This is at least partially because <italic toggle="yes">phylogenize</italic> requires that users limit their analyses to genomes in the MIDAS database (<xref rid="btac655-B28" ref-type="bibr">Nayfach <italic toggle="yes">et al.</italic>, 2016</xref>).</p>
    <p>Some of the complexity of integrating taxonomic and functional analyses, as well as other challenges in microbiome data analysis, stem from the difficulties of applying standard statistical approaches to raw microbiome data due to their compositional nature. Fortunately, there is growing interest in improved compositional approaches for analyzing microbiome data. Specifically, analyzing ratios of microbiome feature relative abundances (rather than the abundances of features themselves) has recently been proposed as a solution to the compositionality problem (<xref rid="btac655-B13" ref-type="bibr">Gloor <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="btac655-B27" ref-type="bibr">Morton <italic toggle="yes">et al.</italic>, 2019</xref>). However, it is unclear which features should be used for stably computing these ratios. One proposed solution is to compare ratios of taxa (based on the isometric log-ratio transformation) on each side of every node in a phylogenetic tree that links the various taxa (<xref rid="btac655-B36" ref-type="bibr">Silverman <italic toggle="yes">et al.</italic>, 2017</xref>). This general approach is now commonly referred to as analyzing balance trees (<xref rid="btac655-B26" ref-type="bibr">Morton <italic toggle="yes">et al.</italic>, 2017</xref>). While this is a statistically valid framework for analyzing microbiome data, it is often unclear how to interpret differences in taxonomic ratios.</p>
    <p>Herein, we aim to address both the challenges involved in functional differential abundance analysis and the limited interpretability of balance tree-based approaches by testing for functional enrichment in a balance tree framework. Specifically, our approach, termed Phylogenetic Organization of Metagenomic Signals (POMS), focuses on identifying cases where multiple taxa that encode a given function are consistently associated with a sample group. Such cases provide more support to the hypothesis that the function itself confers a selective advantage to microbes in the relevant sample group, rather than that the function happens to be present in just a few taxa that are more abundant in that group. In addition to the POMS workflow, we have also re-implemented several functions present in <italic toggle="yes">phylogenize</italic>, which allows this phylogenetic regression framework to be applied to novel genomes. We find that each workflow pinpoints interesting functional associations in both simulated and real metagenomics data, and that they have complementary strengths and weaknesses. This is a valuable proof-of-concept that integrating functional enrichments into balance tree analyses improves their interpretability and provides novel insights. Importantly, however, since POMS cannot identify functions with limited taxonomic breadth as highly enriched, we see it primarily as a complementary tool to phylogenetic regression, and other more sensitive approaches.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <sec>
      <title>2.1 Isometric log-ratio</title>
      <p>Phylogenetic balances in POMS are calculated based on the isometric log-ratio of taxa in the two node subtrees (i.e. on one side of the node compared to the other; <xref rid="btac655-B26" ref-type="bibr">Morton <italic toggle="yes">et al.</italic>, 2017</xref>; <xref rid="btac655-B36" ref-type="bibr">Silverman <italic toggle="yes">et al.</italic>, 2017</xref>). This approach converts microbiome relative abundance data into ratios of geometric means. Specifically, the balance for a sample at node <italic toggle="yes">i</italic> is calculated based on the equation
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:msqrt><mml:mo> </mml:mo><mml:mtext mathvariant="italic">log</mml:mtext><mml:mo> </mml:mo><mml:mfrac><mml:mrow><mml:mi>g</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math></disp-formula>where <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> correspond to the numbers of taxa on the left- and right-hand sides of the node. Similarly, <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mi>g</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math></inline-formula> and <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mi>g</mml:mi><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula> correspond to the geometric means of the relative abundances of taxa on the left- and right-hand sides of the node. Note that the choice of which lineage is considered the left- versus right-hand side of a given node is arbitrary. The numbers of taxa on each side of a node are included in this calculation to scale the balance to give it unit length (i.e. to make the balances comparable despite varying numbers of taxa at each node).</p>
      <p>The geometric mean of the relative abundance of a set of taxa on the left-hand side is calculated based on the equation
<disp-formula id="E2"><mml:math id="M2" display="block" overflow="scroll"><mml:mi>g</mml:mi><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mrow><mml:munderover><mml:mo stretchy="false">∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mroot><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>…</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mroot><mml:mo>,</mml:mo></mml:math></disp-formula>and analogously for the right-hand side. If any taxa have a relative abundance of 0 then the geometric mean will also be 0. To avoid this issue, a pseudocount can be added prior to computing these values. For all POMS analyses in this manuscript, we added a pseudocount of 1 to taxonomic abundances prior to computing the isometric log-ratios.</p>
    </sec>
    <sec>
      <title>2.2 Multinomial test</title>
      <p>A multinomial exact test is used in POMS to identify consistently enriched functions (CEFs), which is described in Section 3. This test considers the counts of three classes of function-significant nodes (FSNs) per function: (i) FSNs that do not intersect with balance-significant nodes (BSNs), (ii) FSNs that intersect with BSNs where the functional enrichment is in taxa that are relatively more abundant in sample group one and (iii) FSNs that intersect with BSNs where the functional enrichment is in taxa that are relatively more abundant in sample group two. The null expectation for the proportion of FSNs in each category is based on a mass-action interaction between FSNs and BSNs. In other words, the null expectation corresponds to the case where FSNs and BSNs are assigned randomly. The expectation also assumes that FSNs that intersect with BSNs are split equally between BSNs that are higher in sample groups one and two, respectively. This test is implemented with the xmulti function of the <italic toggle="yes">XNomial</italic> R package (tested with version 1.0.4), using the default log-likelihood ratio statistic to compute the <italic toggle="yes">P</italic>-value</p>
    </sec>
    <sec>
      <title>2.3 Phylogenetic regression</title>
      <p>We performed phylogenetic regression using the phylolm function from the <italic toggle="yes">phylolm</italic> (<xref rid="btac655-B16" ref-type="bibr">Ho and Ané, 2014</xref>) R package, which regresses a vector against the copy number of each tested function, while taking the phylogenetic similarity of tips into account. The default Brownian motion model was used for all analyses. We implemented functions in the <italic toggle="yes">POMS</italic> package for running this process, as well as for computing the prevalence and specificity scores described as part of <italic toggle="yes">phylogenize</italic>. These latter functions were adapted from the <italic toggle="yes">phylogenize</italic> v0.94 codebase (<ext-link xlink:href="https://bitbucket.org/pbradz/phylogenize" ext-link-type="uri">https://bitbucket.org/pbradz/phylogenize</ext-link>), which is distributed under an MIT license.</p>
    </sec>
    <sec>
      <title>2.4 Pre-processing function copy-number tables</title>
      <p>The same filtering cutoffs were used to filter the function copy number tables ([which link metagenome-assembled genomes (MAGs) and other taxa to genome annotations]) prior to running all analyses. First, the tables were restricted to include only taxa present in at least one sample used for the relevant analysis. Then, any function found in fewer than five taxa, or &lt;0.1% of taxa, was removed.</p>
    </sec>
    <sec>
      <title>2.5 MAG-based simulations</title>
      <p>The MAG-based simulations were based on 704 control samples from a large human meta-analysis dataset (<xref rid="btac655-B1" ref-type="bibr">Almeida <italic toggle="yes">et al.</italic>, 2019</xref>). These samples all met the metadata criteria to be labeled as derived from healthy adults not on antibiotics. These samples were also from studies that included at least 40 samples in total. One sample was randomly dropped to create balanced groups. MAG abundance was taken as the previously computed mean read depth (i.e. mean number of mapped reads per site). MAGs with a breadth of coverage less than 25% in a sample were given a mean depth of 0 in that sample. We then excluded all MAGs that were not called as present in any sample, leaving 1595 MAGs remaining for the simulations.</p>
      <p>These simulations proceeded as described in Section 3. First, the samples were randomly split into two groups for each of the 1000 replicate datasets. Then, for each profile a focal gene family was randomly chosen, and within one group the abundance of all MAGs encoding this gene family was incremented by a pseudocount of 1 and these abundances were multiplied by a factor of 1.5. These simulated datasets are referred to as the ‘focal gene’ profiles. We also performed parallel simulations where the relative abundance of random taxa was randomly inflated by identical amounts in one group only. Importantly, the same number of taxa were perturbed as were affected in each matching focal gene simulation profile. The resulting simulated profiles are referred to as the ‘random taxa’ profiles. The ‘clade-based’ profiles represent an additional set of simulations that use the same selective pressures but applied only to taxa descendent from a given node in the phylogenetic tree. There is one clade-based dataset for each of the 693 nodes in the test tree with at least five underlying taxa (excluding the root node).</p>
      <p>We performed two types of phylogenetic regression on these simulated datasets. In the first, the model response was the specificity of taxa to the first sample group. In the second, the model response was a binary indicator of whether taxa significantly differed in relative abundance between the sample groups, based on Wilcoxon tests (uncorrected <italic toggle="yes">P</italic> &lt; 0.05). The alternative differential abundance approaches compared in this study were Wilcoxon tests following normalization by the median universal single-copy gene (USCG) abundance (using the same approach used by the tool MUSiCC; <xref rid="btac655-B24" ref-type="bibr">Manor and Borenstein, 2015</xref>), Wilcoxon tests based on relative abundances, ALDEx2 v1.16.0 (<xref rid="btac655-B11" ref-type="bibr">Fernandes <italic toggle="yes">et al.</italic>, 2014</xref>), DESeq2 v1.24.0 (<xref rid="btac655-B22" ref-type="bibr">Love <italic toggle="yes">et al.</italic>, 2014</xref>) and limma-voom v3.40.6 (<xref rid="btac655-B20" ref-type="bibr">Law <italic toggle="yes">et al.</italic>, 2014</xref>; <xref rid="btac655-B33" ref-type="bibr">Ritchie <italic toggle="yes">et al.</italic>, 2015</xref>). Significant gene families were identified based on a Benjamini–Hochberg cutoff of &lt;0.05 for all tested approaches, including POMS.</p>
    </sec>
    <sec>
      <title>2.6 Tara oceans dataset validation</title>
      <p>The assembled Tara Oceans metagenomics dataset was taken from a pre-existing project (<xref rid="btac655-B7" ref-type="bibr">Delmont <italic toggle="yes">et al.</italic>, 2018</xref>). Environmental and chemical profiles of the ocean samples along with the relative abundance and annotations of MAGs were taken from the published <xref rid="sup1" ref-type="supplementary-material">Supplementary Tables</xref> for this project.</p>
      <p>GToTree v1.4.16 (<xref rid="btac655-B21" ref-type="bibr">Lee and Ponty, 2019</xref>) was run to build a phylogenetic tree based on shared single-copy genes and to exclude MAGs with completeness below 60% and redundancy above 10%, which resulted in retaining 642 MAGs. MAGs were called as present within samples if the breadth of coverage was &gt;1%. This is a lenient setting, which was chosen based on the empirical distributions of MAG breadth of coverage across the samples.</p>
      <p>Higher-level functions (i.e. KEGG modules and pathways) were reconstructed based on KEGG mappings from KOs to these categories downloaded from the KEGG website (<xref rid="btac655-B18" ref-type="bibr">Kanehisa <italic toggle="yes">et al.</italic>, 2016</xref>) on April 12, 2021. Reconstruction was performed using the <italic toggle="yes">PICRUSt2</italic> script pathway_pipeline.py (<xref rid="btac655-B8" ref-type="bibr">Douglas <italic toggle="yes">et al.</italic> 2020</xref>), which leverages <italic toggle="yes">MinPath</italic> (<xref rid="btac655-B42" ref-type="bibr">Ye and Doak, 2009</xref>) and the algorithm implemented in <italic toggle="yes">HUMAnN2</italic> (<xref rid="btac655-B12" ref-type="bibr">Franzosa <italic toggle="yes">et al.</italic>, 2018</xref>) to reconstruct higher-level function abundances. These reconstructions were performed for each MAG independently.</p>
      <p>Because the environmental data, such as the salinity and nutrient concentrations, were continuous, significant BSNs were identified based on Spearman correlations between sample balances and these environmental factors (uncorrected <italic toggle="yes">P</italic> &lt; 0.05). These results were then discretized to indicate whether the factors were positively or negatively associated with the groups at each respective BSN. Phylogenetic regression was conducted based on a binary indicator of whether taxon abundances showed significant Spearman correlation (uncorrected <italic toggle="yes">P</italic> &lt; 0.05) with each environmental factor. Spearman correlations were also computed based on the function relative abundances themselves against the environmental factors. The cross-product of the taxonomic abundances per sample and the functional abundances per taxa was used to produce the community-wide functional abundances.</p>
      <p>Finally, Faith’s phylogenetic diversity was computed based on the subset of taxa encoding each significant hit output by POMS or phylogenetic regression. This was done using the <italic toggle="yes">Picante</italic> R package (v1.8.2; <xref rid="btac655-B19" ref-type="bibr">Kembel <italic toggle="yes">et al.</italic>, 2010</xref>).</p>
    </sec>
    <sec>
      <title>2.7 Case–control shotgun metagenomics dataset validations</title>
      <p>We focused certain validation analyses on three datasets that were part of a large meta-analysis of human shotgun metagenomics datasets (<xref rid="btac655-B1" ref-type="bibr">Almeida <italic toggle="yes">et al.</italic>, 2019</xref>). These datasets are defined based on dataset accession identifiers in the European Nucleotide Archive. We used the previously generated MAGs, sample MAG abundance profiles and MAG phylogenetic tree as inputs to POMS after performing the same pre-processing steps that were performed for the MAG-based simulations, but on a distinct subset of samples. Phylogenetic regression was conducted based on the specificity of each taxon for samples in the case group for each dataset. Faith’s phylogenetic diversity computation and reconstruction of KEGG pathways and modules was performed as for the Tara Oceans dataset.</p>
    </sec>
    <sec>
      <title>2.8 POMS dependencies</title>
      <p><italic toggle="yes">POMS</italic> is written in R (<xref rid="btac655-B31" ref-type="bibr">R Core Team, 2019</xref>) and is dependent on the following R packages (versions used in this manuscript are indicated, but these exact versions are not required): <italic toggle="yes">ape</italic> v5.3 (<xref rid="btac655-B30" ref-type="bibr">Paradis <italic toggle="yes">et al.</italic>, 2004</xref>), <italic toggle="yes">parallel</italic> v3.6.0, <italic toggle="yes">phangorn</italic> v2.5.5 (<xref rid="btac655-B35" ref-type="bibr">Schliep, 2011</xref>), <italic toggle="yes">phylolm</italic> v2.6.4, <italic toggle="yes">stringr</italic> v1.4.0 and <italic toggle="yes">XNomial</italic> v1.0.4. <italic toggle="yes">POMS</italic> v0.3.1 was used for all analyses. Testing and development of this approach was carried out using R v3.6.0 and RStudio v1.2.5033 on a server running Ubuntu v16.04.5.</p>
      <p>Several additional R packages are required to follow the current analysis workflow after running <italic toggle="yes">POMS</italic> (again the versions indicated were used for this article, but are not required versions): <italic toggle="yes">ggtree</italic> (<xref rid="btac655-B43" ref-type="bibr">Yu, 2020</xref>; <xref rid="btac655-B44" ref-type="bibr">Yu <italic toggle="yes">et al.</italic>, 2017</xref>) v1.16.1, <italic toggle="yes">ggplot2</italic> v3.3.0 (<xref rid="btac655-B38" ref-type="bibr">Wickham, 2016</xref>), <italic toggle="yes">plyr</italic> v1.8.4 (<xref rid="btac655-B40" ref-type="bibr">Wickham, 2011</xref>) and <italic toggle="yes">reshape2</italic> v1.4.3 (<xref rid="btac655-B39" ref-type="bibr">Wickham, 2007</xref>). All multi-panel plots displayed were created with the <italic toggle="yes">cowplot</italic> (v1.0.0) R package.</p>
    </sec>
    <sec>
      <title>2.9 Code availability</title>
      <p>The POMS source code is available at: <ext-link xlink:href="https://github.com/gavinmdouglas/POMS" ext-link-type="uri">https://github.com/gavinmdouglas/POMS</ext-link>. The code for all analyses presented in this manuscript is available at: <ext-link xlink:href="https://github.com/gavinmdouglas/POMS_manuscript/" ext-link-type="uri">https://github.com/gavinmdouglas/POMS_manuscript/</ext-link>.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 POMS overview</title>
      <p>POMS is a balance tree framework for analyzing microbial functions (<xref rid="btac655-F1" ref-type="fig">Fig. 1</xref>), including both gene families and higher-level functions. The key input tables correspond to taxonomic abundances across samples and per-taxon functional abundances. A phylogenetic tree containing all taxa present in the samples must also be provided. The per-taxon functional abundance table corresponds to genome annotations for MAGs, or other known taxa present in an environment. This format contrasts with the functional abundance tables that are largely unlinked from specific taxa, such as those that are produced through read-mapping against a database of broadly distributed gene families. The key POMS output is a table summarizing, for each annotated function, the results of the test for consistent enrichment.</p>
      <fig position="float" id="btac655-F1">
        <label>Fig. 1.</label>
        <caption>
          <p>Contrasting examples that illustrate the POMS methodology. (<bold>a</bold> and <bold>b</bold>) The two phylogenetic trees correspond to 60 microbial genomes found across two sample groups (Groups 1 and 2). The mean log<sub>10</sub> relative abundance of these genomes in each group is indicated by the heatmaps. The squares indicated on tested nodes indicate whether there is a difference in the isometric log-ratio of the subtree taxonomic relative abundances between the two sample groups. Red and blue squares are colored to indicate which subtree is at relatively higher levels in Group 1 samples (relative to the other subtree; see panel <bold>c</bold> for an example). Note that the taxonomy-based annotations are identical between the two panels. Panels a and b show the distribution of two different microbial functions across these genomes (small black dots at the tips of trees). The colored circles on the tested nodes indicate that the function of interest is enriched in one subtree compared with the other. POMS tests whether the intersection between colored squares and circles is higher than expected by chance. Functions that are consistently enriched in the sample group direction (i.e. where the circle and square colors match at nodes consistently, as in panel a, or alternatively where they consistently mismatch) are particularly of interest. Panel b is a contrasting example where the function is not consistently enriched in taxa relatively higher in the same sample group. Note that the minimum number of underlying tips on each side for a node to be retained for analysis was set to four for this example, but it would normally be higher (A color version of this figure appears in the online version of this article.)</p>
        </caption>
        <graphic xlink:href="btac655f1" position="float"/>
      </fig>
      <p>The workflow begins by first identifying all nodes in the tree with sufficient underlying tips (10 by default) on both the left- and right-hand sides. All nodes that do not fit these criteria are excluded from the analysis. The balances of taxa (per sample) at the remaining nodes, defined as the isometric log-ratios of the relative abundances of taxa on the left-hand side compared with those on the right-hand side, are then computed. Typically, a pseudocount is added to the taxonomic abundances to account for cases where taxa are absent. Standard statistical tests can then be used to determine whether these phylogenetic balances differ between sample groups. Put simply, a node with significantly different balances between sample groups indicates that the taxa on either the left- or right-hand side of that node are at significantly higher abundances relative to the taxa on the other side of the node in one sample group compared with the other. Significantly different balances between sample groups are identified based on Wilcoxon rank-sum tests (uncorrected <italic toggle="yes">P</italic> &lt; 0.05 by default). Alternatively, the user can specify which nodes are significantly different based on an external, user-defined test, which enables more customized analyses.</p>
      <p>We refer to each node with a significantly different balance as a BSN. After identifying each BSN, POMS further determines which side of the node is enriched within each sample group. In other words, POMS determines which taxa are at relatively higher levels (relative to taxa on the other side of the node) in each sample group. Notably, such taxa are not necessarily at higher relative abundances in one group or the other, but rather the relative ratios of the taxa on each side of the node are different between the sample groups.</p>
      <p>Next, POMS tests for enrichment of each annotated function across the nodes. More specifically, a Fisher’s exact test is computed based on the counts of tips that either do or do not encode the function on either side of the node (uncorrected <italic toggle="yes">P</italic> &lt; 0.05 by default). Importantly, these enrichment tests are computed at all nodes tested during the balance tree step: not just at BSNs. We refer to each significant node based on this approach as a FSN. Again, put simply, an FSN indicates that the tested function is enriched in taxa on either side of the node compared with the other.</p>
      <p>Finally, a multinomial exact test is applied to test whether FSNs coincide with BSNs, and consistently in the direction of the same sample group, more often than expected by chance. Specifically, for each tested function, the set of identified FSNs for that function (i.e. nodes at which this function is enriched in one side of the node compared to the other) can be partitioned into three classes. The first class corresponds to FSNs that do not intersect with BSNs (i.e. there is a significant enrichment of a function on one side of the node, but there is no significant difference in sample balances). The other two classes correspond to FSNs that intersect with BSNs: one class where the function is enriched in taxa that are relatively more abundant in the first sample group, and the other class where the function is enriched in taxa that are relatively more abundant in the second sample group. In our example in <xref rid="btac655-F1" ref-type="fig">Figure 1</xref> these two classes are represented by intersecting circles and squares of the same and different colors, respectively. For each function, the multinomial exact test is performed based on the number of FSNs in each class compared with the expected proportions given random intersections between FSNs and BSNs. We refer to significant functions based on this test as CEFs.</p>
      <p>Although this test is primarily intended to identify CEFs enriched in the direction of a single sample group, this framework can also identify CEFs that show mixed signal of enrichment toward both sample groups. In other words, a function could be significant because there is a depletion of FSNs that do not intersect with BSNs compared with the random expectation, and not that it is consistently enriched toward a particular sample group. Such cases could still be biologically interesting, but this highlights that post-hoc consideration of the number of FSNs of each class is needed to be able to interpret CEFs appropriately.</p>
    </sec>
    <sec>
      <title>3.2 Simulation-based validations</title>
      <p>To validate POMS, we first generated simulated datasets based on samples containing MAGs. The MAGs from shotgun metagenomics (MGS) control samples, with corresponding mean depths and phylogenetic tree, were obtained from a large human gut MGS meta-analysis. These MAGs had previously been annotated with KEGG orthologs (KOs). We subsampled 704 control samples into two equally sized groups 1000 times to create random test datasets.</p>
      <p>We then conducted several sets of simulations to evaluate POMS's performance. For all these simulations we compared POMS’s performance with our implementation of phylogenetic regression. This regression was based on either significant taxa between the groups as determined by Wilcoxon tests, or on the specificity score developed as part of <italic toggle="yes">phylogenize.</italic> Although this comparison provides insight into how POMS compares to an existing methodology that similarly integrates taxonomic and functional information, the more practical question is how these methods perform compared to standard differential abundance tools, as the latter are more commonly applied. Accordingly, we also ran several differential abundance tools, including ALDEx2, DESeq2, limma-voom and Wilcoxon tests (based on raw relative abundances or corrected by the abundance of USCGs). We applied these standard differential abundance approaches to KO abundance tables that lacked taxonomic links. The per-sample abundance of each KO in these tables was computed by summing the product of the taxon abundance and KO copy number for each taxon that encoded the KO, i.e. we computed the cross-product of the taxa abundance and KO copy number tables.</p>
      <p>To characterize the baseline behavior of each tool, we first investigated the proportion of significant KOs [based on Benjamini–Hochberg corrected <italic toggle="yes">P</italic>-values (BH) &lt; 0.05] identified by each tool across the 1000 random datasets. Some tools identified significant KOs only in a small number of datasets; POMS identified significant KOs in 12 datasets, while ALDEx2 and the relative abundance and USCG-corrected Wilcoxon test approaches identified 7, 17 and 19 datasets with significant KOs, respectively. In contrast, DESeq2, limma-voom and the significance-based and specificity-based phylogenetic regression approaches identified significant KOs in 543, 1000, 1000 and 1000 datasets, respectively. Although three tools called KOs as significant in all datasets, the proportion of significant KOs per-dataset was low. The mean proportion of significant KOs was 0.163 [standard deviation (SD) = 0.038] for limma-voom, 0.060 (SD = 0.029) for the significance-based phylogenetic regression, and 0.056 (SD = 0.027) for the specificity-based phylogenetic regression.</p>
      <p>We then introduced taxonomic variation between the two groups in each dataset using three different approaches. In the first approach, for each of the 1000 random datasets, we randomly selected a KO encoded by at least five MAGs. We then simulated selection acting upon the genomes encoding this gene, by adding a pseudocount of one to these genomes and then multiplying their abundance by 1.5 in one sample group only (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>). Each randomly selected gene is referred to as the focal gene per dataset and represents a gene that confers a selective advantage in one of the two sample groups to taxa that encode it. This set of simulated datasets is referred to as the focal gene profiles. In the second approach we conducted analogous simulations, but where random genomes (rather than genomes that encode a specific focal gene) were selected to increase in abundance in one group. For consistency, the number of random genomes that were perturbed in this approach in each profile was the same as the number of genomes encoding the focal gene in the corresponding focal gene profile. This set of simulated datasets is referred to as the random taxa profiles. Finally, we also simulated cases where all taxa in the same clade, rather than randomly selected taxa, were perturbed. This involved perturbing the abundance of taxa underlying each node (for all nodes with at least underlying five tips and excluding the root node) in the tree. This resulted in 693 datasets, corresponding to each such node in the tree. These datasets are referred to as the clade-based profiles. We included these simulations to explore to what degree POMS is robust to the blooming of individual clades, rather than of multiple independent clades that encode similar functions. After producing these simulated profiles, we applied POMS, the phylogenetic regression workflows and the differential abundance approaches to identify significant KOs.</p>
      <p>We evaluated the results based on the significance ranking of the focal gene relative to all other significant KOs identified by each method in a given replicate, such that the highest ranking (i.e. the rank of one) was assigned to the gene with the smallest <italic toggle="yes">P</italic>-value. Under our focal gene-based simulations, MAGs encoding the focal genes across the profiles were the only direct targets of selection, and accordingly the focal gene was expected to be highly ranked (i.e. close to one, indicating a smaller <italic toggle="yes">P</italic>-value compared to those of other genes).</p>
      <p>Comparing the approaches based on their distributions of focal gene rankings over the simulation replicates reveals drastic differences (<xref rid="btac655-F2" ref-type="fig">Fig. 2a</xref>). The clearest difference is that the focal genes identified by all three phylogenetic methods are ranked significantly higher than were the focal genes identified by the differential abundance tools. The phylogenetic regression approaches ranked the focal genes the highest, with a median rank of one, followed by POMS with a median rank of two, and DESeq2 with a median rank of 65.75. We observed the same overall results based on simulations with less extreme selection pressures, and with altered number of MAGs (<xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S2 and S3</xref>). In addition, we observed the same overall trend with simulated sparse abundance profiles based on reference genomes, which shows that this result is not driven by bias related to focusing on MAGs (Methods and Results; <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S4 and S5</xref>).</p>
      <fig position="float" id="btac655-F2">
        <label>Fig. 2.</label>
        <caption>
          <p>POMS performs best on simulated data based on focal gene rankings and the proportion of significant gene families. (<bold>a</bold>) Ranking of focal gene (i.e. the gene expected to be significant) in the output of all significant genes, based on <italic toggle="yes">P</italic>-values. No point is shown for cases where the focal gene was not significant. There was a total of 4710 gene families (KEGG orthologs) tested in each replicate. (<bold>b</bold>) Comparison of the numbers of MAGs that encode the focal gene in cases where the focal gene was ranked within the top 10 gene families in panel a versus cases where it was not. (<bold>c</bold>) Proportion of gene families identified as significantly different between the simulated sample groups by each approach. The ‘Focal gene’ panel represents the 1000 simulations where the MAGs that encode a specific gene family increased in abundance in one sample group. The ‘Random taxa’ panel corresponds to 1000 replicates where the abundance of randomly selected MAGs was perturbed in one sample group. Under these conditions no systematic differences in functional abundances would be expected on average. The ‘Clade-based’ panel represents the 693 instances where taxa underlying the same node were selected as the target of perturbation. In all panels, each gray point corresponds to one simulation replicate profile. Note that ‘lower is better’ is indicated on panel c to emphasize that identifying almost all functions as significant is not useful and that few genes are expected to be significant in the random taxa and clade-based tests</p>
        </caption>
        <graphic xlink:href="btac655f2" position="float"/>
      </fig>
      <p>We next investigated what factors were underlying the variation in focal gene ranking across the simulation replicate profiles. We suspected that the number of MAGs that encoded each focal gene would markedly impact detection ability. Indeed, we found that focal genes were ranked highly overall based on the phylogenetic methods, except for those encoded by very few MAGs (<xref rid="btac655-F2" ref-type="fig">Fig. 2b</xref>; <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S6</xref>). For instance, focal genes identified by POMS with relative rankings within the top 10 ranked KOs were encoded by a median of 228 MAGs, whereas those not included in the top 10 ranked KOs were encoded by a median of only 16.5 MAGs. This trend was reversed for the differential abundance tests. For instance, focal genes in the DESeq2 output ranked within the top 10 KOs were encoded by a median of 38 MAGs, whereas those not included in the top 10 KOs were encoded by a median of 89 MAGs.</p>
      <p>The approaches also varied in terms of how often they called the focal genes as significant. In particular, the focal gene was not called as significant by POMS in numerous cases: we found that the focal gene was significant in 78.8% of the POMS outputs, while it was called as significant in a mean of 95.1% of the outputs by all other tools. Most occurrences where the focal gene was not significant in the POMS output corresponded to cases where the gene was encoded by either extremely few or almost all MAGs (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S7</xref>). This result highlights the fundamental distinction between POMS and other approaches: POMS is more likely to identify significant genes that are consistently enriched in independent taxonomic lineages, which can be most clearly detected for widely encoded (but not ubiquitous) genes. In contrast, differential abundance—and to some extent phylogenetic regression—approaches call genes as significantly different even when these genes are linked to only a small number of taxa.</p>
      <p>Having shown that the focal gene is successfully detected and highly ranked by POMS, we next turned to compare the overall number of significantly different KOs identified by POMS versus standard differential abundance tests. This analysis demonstrated that the proportion of significantly different KOs in the random taxa simulated profiles was clearly lowest based on POMS (mean = 0.001; SD = 0.0.017) compared to all other approaches [e.g. the next lowest was phylogenetic regression (specificity): mean = 0.051; SD = 0.028; <xref rid="btac655-F2" ref-type="fig">Fig. 2c</xref>]. However, importantly, the random taxa and focal gene simulated profiles yielded substantially different results based on the phylogenetic methods, particularly for POMS, whereas the difference between the two profiles was less pronounced using the differential abundance approaches Specifically, there was a 12 026% increase in the mean proportion of significant KOs detected by POMS in the focal gene dataset compared to the random taxa dataset, while the corresponding increase based on DESeq2 (which had the highest such increase among the differential abundance tools) was 46.8%. In contrast, the mean proportion of significant KOs identified by POMS in the focal gene dataset was only 166% greater than the proportion identified in the clade-based analysis. These results suggest that POMS, and phylogenetic regression (<xref rid="btac655-F2" ref-type="fig">Fig. 2c</xref>), better control the false positive rate in cases where no consistent functional differences are expected, but can still identify substantial number of significant hits when there is a true signal. Interestingly, the outliers in clade-based POMS results (<xref rid="btac655-F2" ref-type="fig">Fig. 2c</xref>) indicate that this approach can erroneously call significant genes when only a single clade is shifted in abundance, at least in rare instances. This is clearly an unintended result and is important to appreciate (see Discussion). Nonetheless, a more striking concern is that the standard differential abundance tests frequently identified more than 50% of functions as significant even in cases where sample group differences were based on random taxonomic perturbations. These overall results were consistently observed regardless of parameter settings (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S8</xref>).</p>
      <p>Finally, we also used modified versions of these simulated datasets (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>) to assess the resource usage of the phylogenetic methods we implemented. We found that the POMS running time (on one core) increases linearly with the number of genomes (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S9</xref>). For instance, on one core the workflow took 69 s with 500 MAGs, and 130 s with 1000 MAGs. The phylogenetic regression workflows showed runtimes on the same order of magnitude, but ran slightly faster than POMS when the number of input MAGs was large. The regression workflows also consumed more than double the memory of POMS (max: 0.42 GB for POMS and 0.96 GB for the phylogenetic regression approaches).</p>
    </sec>
    <sec>
      <title>3.3 Application to real datasets</title>
      <p>We next applied all approaches discussed above to several real metagenomics datasets. Unlike in our simulated datasets, for these datasets we had no clear expectations regarding which functions would be identified as CEFs, and our evaluation is accordingly vulnerable to subjective biases in interpretation. Yet, as we argue below, many of the significant CEFs identified by POMS are reasonable given the presence of similar findings in the literature.</p>
      <p>We first focused on MAGs assembled as part of the Tara Oceans project. Since strong selection pressures may act upon microbes across environmental gradients in the ocean (<xref rid="btac655-B17" ref-type="bibr">Ibarbalz <italic toggle="yes">et al.</italic>, 2019</xref>; <xref rid="btac655-B34" ref-type="bibr">Salazar <italic toggle="yes">et al.</italic>, 2019</xref>), these metagenomics samples represent an appealing test case for POMS. Our analysis focused specifically on 93 samples with 642 MAGs annotated with KOs. Environmental factors associated with the water samples were also available, including temperature, salinity, oxygen levels, nitrate concentrations, phosphate concentrations and nitrogen dioxide concentrations. We applied POMS to this dataset to detect microbial functions associated with each of these factors independently. We considered KEGG pathways and modules in addition to KOs for this analysis. These higher-level functions were computed for each MAG independently based on the KO annotations (see Section 2). Because the environmental factor data is continuous rather than partitioned into discrete groups, we identified BSNs based on Spearman correlations between the balances at each node and the factor levels. The direction of each BSN was inferred from the sign of the correlation coefficient. We also binned CEFs in this analysis as either stringent, intermediate or lenient, based on BH cutoffs of 0.05, 0.15 and 0.25, respectively.</p>
      <p>Our analysis across all environmental factors identified in total one CEF below the intermediate cutoff and 19 CEFs below the lenient cutoff (<xref rid="btac655-T1" ref-type="table">Table 1</xref>). These CEFs were associated with either phosphate or mean salinity levels (for which there were 13 and 11 BSNs, respectively), and indeed some of the identified functions likely reflect selective actions of these two factors. For instance, a pathway linked to biofilm formation, ko05111, was found to be associated with higher phosphate levels, in agreement with previous findings of the non-trivial relationship between phosphorus levels and biofilm formation (<xref rid="btac655-B5" ref-type="bibr">Danhorn <italic toggle="yes">et al.</italic>, 2004</xref>; <xref rid="btac655-B10" ref-type="bibr">Fang <italic toggle="yes">et al.</italic>, 2009</xref>). Several significant CEFs linked to higher phosphate levels are also membrane and transport-related genes, which could be related to response to an environmental stress. Reasonable connections can also be made with the CEFs associated with mean salinity levels, such as the positive association with limonene and pinene degradation (ko00903). Limonene and pinene are monoterpenes that can be metabolized to modify cell membrane fluidity. This could reflect a potential adaptation that could facilitate an organism’s survival in the face of high salinity levels (<xref rid="btac655-B6" ref-type="bibr">De Carvalho and Fernandes, 2010</xref>).</p>
      <table-wrap position="float" id="btac655-T1">
        <label>Table 1.</label>
        <caption>
          <p>Tara oceans POMS results</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="left" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Env. factor</th>
              <th align="center" rowspan="1" colspan="1">Data type</th>
              <th align="center" rowspan="1" colspan="1">Func. id.</th>
              <th align="center" rowspan="1" colspan="1">Function description (simplified)</th>
              <th align="center" rowspan="1" colspan="1">Total<break/>FSNs</th>
              <th align="center" rowspan="1" colspan="1">FSNs ∩<break/>BSNs (high)<sup>a</sup></th>
              <th align="center" rowspan="1" colspan="1">FSNs ∩<break/>BSNs (low)<sup>b</sup></th>
              <th align="center" rowspan="1" colspan="1">FSNs not ∩<break/>BSNs<sup>c</sup></th>
              <th align="center" rowspan="1" colspan="1">Corr.<break/><italic toggle="yes">P</italic></th>
              <th align="center" rowspan="1" colspan="1">Sig.<break/>Reg.<sup>d</sup></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">Pathway</td>
              <td rowspan="1" colspan="1">ko05111</td>
              <td rowspan="1" colspan="1">Biofilm formation—<italic toggle="yes">V. cholerae</italic></td>
              <td rowspan="1" colspan="1">13</td>
              <td rowspan="1" colspan="1">8</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">5</td>
              <td rowspan="1" colspan="1">0.13</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Salinity</td>
              <td rowspan="1" colspan="1">Pathway</td>
              <td rowspan="1" colspan="1">ko00903</td>
              <td rowspan="1" colspan="1">Limonene and pinene degradation</td>
              <td rowspan="1" colspan="1">15</td>
              <td rowspan="1" colspan="1">8</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">0.16</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K00705</td>
              <td rowspan="1" colspan="1">4-Alpha glucanotransferase</td>
              <td rowspan="1" colspan="1">9</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">0.17</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K01361</td>
              <td rowspan="1" colspan="1">E3.4.21.96; lactocepin</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">0.17</td>
              <td rowspan="1" colspan="1">Yes</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K01745</td>
              <td rowspan="1" colspan="1">HAL; histidine ammonia-lyase</td>
              <td rowspan="1" colspan="1">12</td>
              <td rowspan="1" colspan="1">9</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.17</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K07137</td>
              <td rowspan="1" colspan="1">Uncharacterized protein</td>
              <td rowspan="1" colspan="1">12</td>
              <td rowspan="1" colspan="1">9</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">0.17</td>
              <td rowspan="1" colspan="1">Yes</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K15523</td>
              <td rowspan="1" colspan="1">Protein-ribulosamine3-kinase</td>
              <td rowspan="1" colspan="1">8</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">0.17</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K00151</td>
              <td rowspan="1" colspan="1">5-Carboxymethyl-2-hydroxymuconic-semialdehyde dehydrogenase</td>
              <td rowspan="1" colspan="1">12</td>
              <td rowspan="1" colspan="1">8</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">4</td>
              <td rowspan="1" colspan="1">0.20</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K01712</td>
              <td rowspan="1" colspan="1">UROC1; urocanate hydratase</td>
              <td rowspan="1" colspan="1">12</td>
              <td rowspan="1" colspan="1">8</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">4</td>
              <td rowspan="1" colspan="1">0.20</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K06872</td>
              <td rowspan="1" colspan="1">Uncharacterized protein</td>
              <td rowspan="1" colspan="1">12</td>
              <td rowspan="1" colspan="1">8</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">4</td>
              <td rowspan="1" colspan="1">0.20</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K06894</td>
              <td rowspan="1" colspan="1">Alpha-2-macroglobulin</td>
              <td rowspan="1" colspan="1">11</td>
              <td rowspan="1" colspan="1">8</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">0.20</td>
              <td rowspan="1" colspan="1">Yes</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K06940</td>
              <td rowspan="1" colspan="1">Uncharacterized protein</td>
              <td rowspan="1" colspan="1">12</td>
              <td rowspan="1" colspan="1">8</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">4</td>
              <td rowspan="1" colspan="1">0.20</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K07709</td>
              <td rowspan="1" colspan="1">Two-component system, sensor histidine kinase HydH</td>
              <td rowspan="1" colspan="1">5</td>
              <td rowspan="1" colspan="1">5</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">0.20</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K08988</td>
              <td rowspan="1" colspan="1">Putative membrane protein</td>
              <td rowspan="1" colspan="1">9</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">0.20</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K09933</td>
              <td rowspan="1" colspan="1">mtfA; MtfA peptidase</td>
              <td rowspan="1" colspan="1">9</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">0.20</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K02065</td>
              <td rowspan="1" colspan="1">Phospholipid/cholesterol/gamma-HCH transport system ATP-binding protein</td>
              <td rowspan="1" colspan="1">17</td>
              <td rowspan="1" colspan="1">9</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">8</td>
              <td rowspan="1" colspan="1">0.24</td>
              <td rowspan="1" colspan="1">Yes</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Phosphate</td>
              <td rowspan="1" colspan="1">KO</td>
              <td rowspan="1" colspan="1">K15176</td>
              <td rowspan="1" colspan="1">RNA polymerase-associated protein CTR9</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">5</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">0.24</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Salinity</td>
              <td rowspan="1" colspan="1">Module</td>
              <td rowspan="1" colspan="1">M00040</td>
              <td rowspan="1" colspan="1">Tyrosine biosynthesis</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">5</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">0.24</td>
              <td rowspan="1" colspan="1">Yes</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Salinity</td>
              <td rowspan="1" colspan="1">Module</td>
              <td rowspan="1" colspan="1">M00535</td>
              <td rowspan="1" colspan="1">Isoleucine biosynthesis</td>
              <td rowspan="1" colspan="1">10</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">4</td>
              <td rowspan="1" colspan="1">0.24</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Salinity</td>
              <td rowspan="1" colspan="1">Module</td>
              <td rowspan="1" colspan="1">M00879</td>
              <td rowspan="1" colspan="1">Arginine succinyltransferase pathway</td>
              <td rowspan="1" colspan="1">10</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">4</td>
              <td rowspan="1" colspan="1">0.24</td>
              <td rowspan="1" colspan="1">No</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn1">
            <label>a</label>
            <p>FSNs intersecting BSNs associated with higher levels of environmental factor.</p>
          </fn>
          <fn id="tblfn2">
            <label>b</label>
            <p>FSNs intersecting BSNs associated with lower levels of environmental factor.</p>
          </fn>
          <fn id="tblfn3">
            <label>c</label>
            <p>FSNs not intersecting BSNs.</p>
          </fn>
          <fn id="tblfn4">
            <label>d</label>
            <p>Significant based on phylogenetic regression.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>We next investigated how the results would differ if phylogenetic regression or Spearman correlations were used to test for associations (see Section 2). We found that using these approaches resulted in substantially more functions associated with each factor. For instance, there were 1008 and 1348 significant KOs (BH &lt; 0.25) associated with mean salinity and phosphate levels, respectively, based on phylogenetic regression. Using Spearman correlation there were 4169 and 4974 significant KOs for mean salinity and phosphate levels, respectively. Only 10/20 and 5/20 CEFs identified by POMS were also significant in the Spearman correlation and phylogenetic regression outputs (<xref rid="btac655-T1" ref-type="table">Table 1</xref>), respectively. We also assessed the phylogenetic distribution of taxa encoding significant functions, based on Faith’s phylogenetic diversity. Taxa sets encoding POMS CEFs had slightly higher values (mean = 50.0; SD = 27.2), compared to phylogenetic regression hits (mean = 46.9; SD = 44.1), but the difference was not significant (Wilcoxon test, W = 18,123, <italic toggle="yes">P</italic> = 0.069; <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S10a</xref>). In all cases, POMS-detected CEFs were not consistently amongst the most highly ranked hits by these other tools (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S11a</xref>).</p>
      <p>We then investigated how POMS performs on case–control metagenomics datasets. We focused on a dataset of MAGs compiled from human-associated microbiomes that were published as part of a large-scale meta-analysis. We used subsets of this dataset corresponding to three disease datasets: two obesity datasets and one colorectal cancer dataset.</p>
      <p>The first obesity dataset we analyzed included stool samples from 477 obese and 257 control individuals that collectively contained a total of 1401 MAGs. We applied POMS to this dataset and identified 34 BSNs that differed between obese and control individuals. The second obesity dataset analyzed included 251 obese and 159 control individuals harboring a collective total of 1161 MAGs in their stool microbiomes, with 31 resulting BSNs. POMS identified 79, 2 and 21 KOs, pathways and modules, respectively, which were consistently enriched in at least one dataset (<xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>). Of these hits, two KOs, no pathways and two modules were called as CEFs across both datasets.</p>
      <p>Importantly, many of these significant hits are reasonable given our knowledge of the link between the human microbiome and obesity. For example, one of the strongest CEFs detected by POMS was for the module cytochrome bd ubiquinol oxidase (M00153), which was associated with case samples. This function could reflect a broad shift in energy production through oxidative phosphorylation, or potential adaptation to oxidative stress, in obese individuals (<xref rid="btac655-B14" ref-type="bibr">Giuffrè <italic toggle="yes">et al.</italic>, 2014</xref>). Several other CEFs are also consistent with similar broad selection pressures due to dietary or metabolic differences. For instance, KOs involved in vitamin B1 and B2 biosynthesis (K00941 and K00794), as well as a module involved in vitamin K2 biosynthesis (M00116), were CEFs in case samples. The connection between these vitamins and obesity is controversial, but in certain cases they have been reported at lower levels in obese individuals (<xref rid="btac655-B15" ref-type="bibr">Gunanti <italic toggle="yes">et al.</italic>, 2014</xref>; <xref rid="btac655-B32" ref-type="bibr">Ravera <italic toggle="yes">et al.</italic>, 2021</xref>). Similarly, beta-lactam resistance (ko01501) was also significantly associated with case samples, which is particularly interesting as exposure to antibiotics has long been known to be associated with obesity (<xref rid="btac655-B41" ref-type="bibr">Wilkins and Reimer, 2021</xref>). Thus, one hypothesis consistent with these results is that these functions represent widespread adaptations to stresses and the resource landscape in the gut environment of obese individuals.</p>
      <p>Last, we applied POMS to the microbial profiles of stool samples from 75 colorectal cancer patients and 53 controls, which contained 1187 MAGs. In this case, there were only 14 BSNs and no significant CEFs. Nonetheless, the sole outlier in the results (the only feature with corrected <italic toggle="yes">P</italic> &lt; 0.6) was glyoxylate and dicarboxylate metabolism (enriched in control patients; corrected <italic toggle="yes">P</italic> = 0.294). This outlier is noteworthy, as it has previously been identified as the most significantly depleted function in colorectal cancer samples (relative to controls) based on metabolite profiles (<xref rid="btac655-B2" ref-type="bibr">Arima <italic toggle="yes">et al.</italic>, 2020</xref>).</p>
      <p>In contrast to the POMS results, phylogenetic regression (specificity-based) resulted in many more hits in the colorectal cancer dataset (2996) than in the obesity dataset (1202). In addition, no pathways, and only 14/79 KOs and 4/21 modules (<xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>) were called as significant by both approaches in the same dataset. In this case, taxa sets encoding POMS CEFs exhibited significantly higher values of Faith’s phylogenetic diversity (mean = 114.9; SD = 69.9; Wilcoxon test, W = 80,348; <italic toggle="yes">P</italic> = 4.0 × 10<sup>−7</sup>), compared to those encoding the phylogenetic regression hits (mean = 80.2; SD = 74.0; <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S10b</xref>). In addition, POMS CEFs were not amongst the highest ranked significant calls based on phylogenetic regression or the differential abundance approaches (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S11b–d</xref>). These results highlight that POMS identifies distinct sets of significant hits compared with both other phylogenetic methods and standard differential abundance tests.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>Herein we have presented and validated the POMS framework: a novel approach for identifying CEFs in microbiome data. Using simulations, we have demonstrated that POMS can accurately identify widely encoded microbial functions that confer a strong selective advantage. While we present several different analyses to validate and justify our approach, perhaps the most convincing evidence is that focal genes (i.e. genes that were simulated as conferring a selective advantage) were amongst the most significant functions identified by POMS, whereas this was often not the case for standard differential abundance approaches. On the other hand, the focal genes were frequently identified by phylogenetic regression as well, but it is much more difficult to interpret the output of this approach. In addition, although POMS produced sensible results on real shotgun metagenomics datasets that were assembled into MAGs, these CEFs were typically not top hits based on phylogenetic regression. This suggests that POMS and phylogenetic regression are complementary tools that potentially give insight into different types of functional associations.</p>
    <p>For instance, POMS can only identify functions that are widely encoded by taxa and that are variably present across different lineages; a gene restricted to an individual lineage, even if that lineage has many members, should not be identified as a CEF (although this can occur: see discussion of clade-based simulations below). This is because POMS requires a function to be enriched repeatedly (and in consistent directions) at independent BSNs to identify a function as significant. These functions necessarily will show a signal at deeper nodes in the tree, rather than on small clades or tips. This difference is reflected in the fact that taxa encoding significant POMS hits often had significantly higher Faith’s phylogenetic diversity compared to those encoding significant phylogenetic regressions hits. Consequently, POMS may miss many functions that would be identified by phylogenetic regression, and which may exhibit signal at sporadic tips in the tree. However, CEFs identified by POMS have a clear biological interpretation: each CEF represents the hypothesis that the function provides a fitness advantage in certain contexts to those taxa which encode it. This need not be the case for significant hits identified by phylogenetic regression: a small number of taxa may simply have bloomed or become depleted for a different reason.</p>
    <p>It should also be appreciated that significant CEFs identified by POMS are not guaranteed to be enriched only in a single direction. The POMS multinomial test evaluates whether the distribution of FSNs into the three categories departs from the random expectation. Significant functions could simply be enriched at BSNs of both types, i.e. a mixture of BSNs relatively higher in both sample groups. Such cases could still be biologically interesting but would be interpreted differently than CEFs primarily enriched toward a single sample group. Accordingly, the counts of FSNs of each category should be considered when interpreting any CEFs identified by POMS.</p>
    <p>There are also other limitations to the POMS approach. For instance, identifying CEFs requires that sufficient BSNs are present to identify significant enrichments. Even if an adaptive function is widely distributed phylogenetically, it will not be identifiable by POMS unless there are corresponding BSNs that could be driven by this function. In addition, POMS assumes that all nodes in the tree have independent balance distributions. This is partially invalid because particular taxonomic groups are more likely to vary across individuals and taxon co-occurrence can occur even at long evolutionary distances (<xref rid="btac655-B23" ref-type="bibr">Ma <italic toggle="yes">et al.</italic>, 2020</xref>). It is also a caveat for all balance tree approaches that there can be correlations in node balances simply due to the same tips underlying the nodes. We assessed the extent of this problem with our clade-based perturbation simulations, which indicated that on occasion POMS can produce erroneous results due to this issue. However, the proportion of significant KOs was still much lower than for the differential abundance tools. Future development that focused on building a similar framework based on phylofactorization (<xref rid="btac655-B37" ref-type="bibr">Washburne <italic toggle="yes">et al.</italic>, 2019</xref>) instead of balance trees could help address this issue.</p>
    <p>Despite these caveats, we have shown that compared with more common approaches, integrating functional information into a balance tree framework can better identify functions that could provide a selective advantage. POMS is just one example of how this general analysis scheme can be implemented, and future work could incorporate more sophisticated approaches for analyzing balances across phylogenetic trees (<xref rid="btac655-B36" ref-type="bibr">Silverman <italic toggle="yes">et al.</italic>, 2017</xref>; <xref rid="btac655-B37" ref-type="bibr">Washburne <italic toggle="yes">et al.</italic>, 2019</xref>). Nonetheless, the current POMS framework represents a more robust methodology compared to the common practice of applying differential abundance tests to community-wide functional abundances. More generally, given the wide range of results yielded by popular microbiome differential abundance approaches (<xref rid="btac655-B29" ref-type="bibr">Nearing <italic toggle="yes">et al.</italic>, 2022</xref>) and their poor performance in our simulation experiments, clearly phylogenetic methods should be preferred in this context.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btac655_Supplementary_Data</label>
      <media xlink:href="btac655_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors thank Cecilia Noecker for her helpful feedback.</p>
    <sec>
      <title>Funding</title>
      <p>G.M.D. was funded by a National Sciences and Engineering Research Council (NSERC) Canada Graduate Scholarship (Doctoral). G.M.D. was also support by an NSERC Michael Smith Foreign Study Supplement and a Mitacs Globalink Research Award to enable this collaboration with E.B. M.G.I.L. was supported by an NSERC Discovery Grant. E.B. is a Faculty Fellow of the Edmond J. Safra Center for Bioinformatics at Tel Aviv University and is partly funded by ISF Grant 2435/19.</p>
      <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <sec sec-type="data-availability">
    <title>Data Availability</title>
    <p>The Tara Oceans MAG dataset was acquired from FigShare (10.6084/m9.figshare.4902923.v1). The human case–control datasets are available on the NCBI short read archive under accessions ERP002061 (obesity #1), ERP003612 (obesity #2) and ERP012177 (colorectal cancer). Our analyses were based on the MAGs and related data files that were made available by a meta-analysis of these and other studies (<xref rid="btac655-B1" ref-type="bibr">Almeida <italic toggle="yes">et al.</italic>, 2019</xref>). The prepared in-files for running the simulations and actual data examples we describe, as well as the output tables of the phylogenetic methods applied to the actual datasets, are available on FigShare at 10.6084/m9.figshare.c.6162060.v2.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btac655-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Almeida</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>A new genomic blueprint of the human gut microbiota</article-title>. <source>Nature</source>, <volume>568</volume>, <fpage>499</fpage>–<lpage>504</lpage>.<pub-id pub-id-type="pmid">30745586</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Arima</surname><given-names>K.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Metabolic profiling of formalin-fixed paraffin-embedded tissues discriminates normal Colon from colorectal cancer</article-title>. <source>Mol. Cancer Res</source>., <volume>18</volume>, <fpage>883</fpage>–<lpage>890</lpage>.<pub-id pub-id-type="pmid">32165453</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bradley</surname><given-names>P.H.</given-names></string-name></person-group><etal>et al</etal> (<year>2018</year>) <article-title>Phylogeny-corrected identification of microbial gene families relevant to human gut colonization</article-title>. <source>PLoS Comput. Biol</source>., <volume>14</volume>, <fpage>e1006242</fpage>.<pub-id pub-id-type="pmid">30091981</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bradley</surname><given-names>P.H.</given-names></string-name>, <string-name><surname>Pollard</surname><given-names>K.S.</given-names></string-name></person-group> (<year>2020</year>) <article-title>Phylogenize: correcting for phylogeny reveals genes associated with microbial distributions</article-title>. <source>Bioinformatics</source>, <volume>36</volume>, <fpage>1289</fpage>–<lpage>1290</lpage>.<pub-id pub-id-type="pmid">31588499</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Danhorn</surname><given-names>T.</given-names></string-name></person-group><etal>et al</etal> (<year>2004</year>) <article-title>Phosphorus limitation enhances biofilm formation of the plant pathogen <italic toggle="yes">Agrobacterium tumefaciens</italic> through the PhoR-PhoB regulatory system</article-title>. <source>J. Bacteriol</source>., <volume>186</volume>, <fpage>4492</fpage>–<lpage>4501</lpage>.<pub-id pub-id-type="pmid">15231781</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>De Carvalho</surname><given-names>C.C.C.R.</given-names></string-name>, <string-name><surname>Fernandes</surname><given-names>P.</given-names></string-name></person-group> (<year>2010</year>) <article-title>Production of metabolites as bacterial responses to the marine environment</article-title>. <source>Mar. Drugs</source>, <volume>8</volume>, <fpage>705</fpage>–<lpage>727</lpage>.<pub-id pub-id-type="pmid">20411122</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Delmont</surname><given-names>T.O.</given-names></string-name></person-group><etal>et al</etal> (<year>2018</year>) <article-title>Nitrogen-fixing populations of planctomycetes and proteobacteria are abundant in surface ocean metagenomes</article-title>. <source>Nat. Microbiol</source>., <volume>3</volume>, <fpage>804</fpage>–<lpage>813</lpage>.<pub-id pub-id-type="pmid">29891866</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Douglas</surname><given-names>G.M.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>PICRUSt2 for prediction of metagenome functions</article-title>. <source>Nat. Biotechnol</source>., <volume>38</volume>, <fpage>685</fpage>–<lpage>688</lpage>.<pub-id pub-id-type="pmid">32483366</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Douglas</surname><given-names>G.M.</given-names></string-name>, <string-name><surname>Langille</surname><given-names>M.G.I.</given-names></string-name></person-group> (<year>2021</year>) <article-title>A primer and discussion on DNA-based microbiome data and related bioinformatics analyses</article-title>. <source>Peer Commun. J</source>., <volume>1</volume>, <fpage>e5</fpage>.</mixed-citation>
    </ref>
    <ref id="btac655-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Fang</surname><given-names>W.</given-names></string-name></person-group><etal>et al</etal> (<year>2009</year>) <article-title>Influence of phosphorus on biofilm formation in model drinking water distribution systems</article-title>. <source>J. Appl. Microbiol</source>., <volume>106</volume>, <fpage>1328</fpage>–<lpage>1335</lpage>.<pub-id pub-id-type="pmid">19187141</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Fernandes</surname><given-names>A.D.</given-names></string-name></person-group><etal>et al</etal> (<year>2014</year>) <article-title>Unifying the analysis of high-throughput sequencing datasets: characterizing RNA-seq, 16S rRNA gene sequencing and selective growth experiments by compositional data analysis</article-title>. <source>Microbiome</source>, <volume>2</volume>, <fpage>15</fpage>.<pub-id pub-id-type="pmid">24910773</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Franzosa</surname><given-names>E.A.</given-names></string-name></person-group><etal>et al</etal> (<year>2018</year>) <article-title>Species-level functional profiling of metagenomes and metatranscriptomes</article-title>. <source>Nat. Methods</source>., <volume>15</volume>, <fpage>962</fpage>–<lpage>968</lpage>.<pub-id pub-id-type="pmid">30377376</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gloor</surname><given-names>G. B.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) <article-title>It’s all relative: analyzing microbiome data as compositions</article-title>. <source>Ann. Epidemiol</source>., <volume>26</volume>, <fpage>322</fpage>–<lpage>329</lpage>.<pub-id pub-id-type="pmid">27143475</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Giuffrè</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2014</year>) <article-title>Cytochrome bd oxidase and bacterial tolerance to oxidative and nitrosative stress</article-title>. <source>Biochim. Biophys. Acta</source>, <volume>1837</volume>, <fpage>1178</fpage>–<lpage>1187</lpage>.<pub-id pub-id-type="pmid">24486503</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gunanti</surname><given-names>I. R.</given-names></string-name></person-group><etal>et al</etal> (<year>2014</year>) <article-title>Low serum vitamin B-12 and folate concentrations and low thiamin and riboflavin intakes are inversely associated with greater adiposity in Mexican American children</article-title>. <source>J. Nutr</source>., <volume>144</volume>, <fpage>2027</fpage>–<lpage>2033</lpage>.<pub-id pub-id-type="pmid">25411037</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ho</surname><given-names>L.S.T.</given-names></string-name>, <string-name><surname>Ané</surname><given-names>C.</given-names></string-name></person-group> (<year>2014</year>) <article-title>A linear-time algorithm for Gaussian and non-Gaussian trait evolution models</article-title>. <source>Syst. Biol</source>., <volume>63</volume>, <fpage>397</fpage>–<lpage>408</lpage>.<pub-id pub-id-type="pmid">24500037</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ibarbalz</surname><given-names>F.M.</given-names></string-name></person-group><etal>et al</etal>; <collab>Tara Oceans Coordinators</collab>. (<year>2019</year>) <article-title>Global trends in marine plankton diversity across kingdoms of life</article-title>. <source>Cell</source>, <volume>179</volume>, <fpage>1084</fpage>–<lpage>1097.e21</lpage>.<pub-id pub-id-type="pmid">31730851</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kanehisa</surname><given-names>M.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) <article-title>KEGG as a reference resource for gene and protein annotation</article-title>. <source>Nucleic Acids Res</source>., <volume>44</volume>, <fpage>D457</fpage>–<lpage>D462</lpage>.<pub-id pub-id-type="pmid">26476454</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kembel</surname><given-names>S.W.</given-names></string-name></person-group><etal>et al</etal> (<year>2010</year>) <article-title>Picante: R tools for integrating phylogenies and ecology</article-title>. <source>Bioinformatics</source>, <volume>26</volume>, <fpage>1463</fpage>–<lpage>1464</lpage>.<pub-id pub-id-type="pmid">20395285</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Law</surname><given-names>C. W.</given-names></string-name></person-group><etal>et al</etal> (<year>2014</year>) <article-title>Voom: precision weights unlock linear model analysis tools for RNA-seq read counts</article-title>. <source>Genome Biol</source>., <volume>15</volume>, <fpage>R29</fpage>.<pub-id pub-id-type="pmid">24485249</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>M.D.</given-names></string-name>, <string-name><surname>Ponty</surname><given-names>Y.</given-names></string-name></person-group> (<year>2019</year>) <article-title>GToTree: a user-friendly workflow for phylogenomics</article-title>. <source>Bioinformatics</source>, <volume>35</volume>, <fpage>4162</fpage>–<lpage>4164</lpage>.<pub-id pub-id-type="pmid">30865266</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Love</surname><given-names>M. I.</given-names></string-name></person-group><etal>et al</etal> (<year>2014</year>) <article-title>Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2</article-title>. <source>Genome Biol</source>., <volume>15</volume>, <fpage>550</fpage>.<pub-id pub-id-type="pmid">25516281</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ma</surname><given-names>B.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Earth microbial co-occurrence network reveals interconnection pattern across microbiomes</article-title>. <source>Microbiome</source>, <volume>8</volume>, <fpage>82</fpage>.<pub-id pub-id-type="pmid">32498714</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Manor</surname><given-names>O.</given-names></string-name>, <string-name><surname>Borenstein</surname><given-names>E.</given-names></string-name></person-group> (<year>2015</year>) <article-title>MUSiCC: a marker genes based framework for metagenomic normalization and accurate profiling of gene abundances in the microbiome</article-title>. <source>Genome Biol</source>., <volume>16</volume>, <fpage>53</fpage>.<pub-id pub-id-type="pmid">25885687</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Manor</surname><given-names>O.</given-names></string-name>, <string-name><surname>Borenstein</surname><given-names>E.</given-names></string-name></person-group> (<year>2017</year>) <article-title>Systematic characterization and analysis of the taxonomic drivers of functional shifts in the human microbiome</article-title>. <source>Cell Host Microbe</source>., <volume>21</volume>, <fpage>254</fpage>–<lpage>267</lpage>.<pub-id pub-id-type="pmid">28111203</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Morton</surname><given-names>J.T.</given-names></string-name></person-group><etal>et al</etal> (<year>2017</year>) <article-title>Balance trees reveal microbial niche differentiation</article-title>. <source>mSystems</source>, <volume>2</volume>, <fpage>e00162-16</fpage>.<pub-id pub-id-type="pmid">28144630</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Morton</surname><given-names>J.T.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Establishing microbial composition measurement standards with reference frames</article-title>. <source>Nat. Commun</source>., <volume>10</volume>, <fpage>2719</fpage>.<pub-id pub-id-type="pmid">31222023</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nayfach</surname><given-names>S.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) <article-title>An integrated metagenomics pipeline for strain profiling reveals novel patterns of bacterial transmission and biogeography</article-title>. <source>Genome Res</source>., <volume>26</volume>, <fpage>1612</fpage>–<lpage>1625</lpage>.<pub-id pub-id-type="pmid">27803195</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nearing</surname><given-names>J.T.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Microbiome differential abundance methods produce different results across 38 datasets</article-title>. <source>Nat. Commun</source>., <volume>13</volume>, <fpage>342</fpage>.<pub-id pub-id-type="pmid">35039521</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Paradis</surname><given-names>E.</given-names></string-name></person-group><etal>et al</etal> (<year>2004</year>) <article-title>APE: analyses of phylogenetics and evolution in R language</article-title>. <source>Bioinformatics</source>, <volume>20</volume>, <fpage>289</fpage>–<lpage>290</lpage>.<pub-id pub-id-type="pmid">14734327</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B31">
      <mixed-citation publication-type="other"><collab>R Core Team</collab>. (<year>2019</year>) <italic toggle="yes">R: A Language and Environment for Statistical Computing, Vienna, Austria</italic>.</mixed-citation>
    </ref>
    <ref id="btac655-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ravera</surname><given-names>M.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Overweight-obesity is associated with decreased vitamin K2 levels in hemodialysis patients</article-title>. <source>Clin. Chem. Lab. Med</source>., <volume>59</volume>, <fpage>581</fpage>–<lpage>589</lpage>.<pub-id pub-id-type="pmid">32383688</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ritchie</surname><given-names>M.E.</given-names></string-name></person-group><etal>et al</etal> (<year>2015</year>) <article-title>limma powers differential expression analyses for RNA-sequencing and microarray studies</article-title>. <source>Nucleic Acids Res</source>., <volume>43</volume>, <fpage>e47</fpage>.<pub-id pub-id-type="pmid">25605792</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Salazar</surname><given-names>G.</given-names></string-name></person-group><etal>et al</etal>; <collab>Tara Oceans Coordinators</collab>. (<year>2019</year>) <article-title>Gene expression changes and community turnover differentially shape the global ocean metatranscriptome</article-title>. <source>Cell</source>, <volume>179</volume>, <fpage>1068</fpage>–<lpage>1083.e21</lpage>.<pub-id pub-id-type="pmid">31730850</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schliep</surname><given-names>K.P.</given-names></string-name></person-group> (<year>2011</year>) <article-title>phangorn: phylogenetic analysis in R</article-title>. <source>Bioinformatics</source>, <volume>27</volume>, <fpage>592</fpage>–<lpage>593</lpage>.<pub-id pub-id-type="pmid">21169378</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Silverman</surname><given-names>J. D.</given-names></string-name></person-group><etal>et al</etal> (<year>2017</year>) <article-title>A phylogenetic transform enhances analysis of compositional microbiota data</article-title>. <source>eLife</source>, <volume>6</volume>, <fpage>e21887</fpage>.<pub-id pub-id-type="pmid">28198697</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Washburne</surname><given-names>A.D.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Phylofactorization: a graph partitioning algorithm to identify phylogenetic scales of ecological data</article-title>. <source>Ecol. Monogr</source>., <volume>89</volume>, <fpage>1</fpage>–<lpage>27</lpage>.</mixed-citation>
    </ref>
    <ref id="btac655-B38">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wickham</surname><given-names>H.</given-names></string-name></person-group> (<year>2007</year>) <article-title>Reshaping data with the {reshape} package</article-title>. <source>J. Stat. Softw</source>., <volume>21</volume>, <fpage>1</fpage>–<lpage>20</lpage>.</mixed-citation>
    </ref>
    <ref id="btac655-B39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wickham</surname><given-names>H.</given-names></string-name></person-group> (<year>2011</year>) <article-title>The split-apply-combine strategy for data analysis</article-title>. <source>J. Stat. Softw</source>., <volume>40</volume>, <fpage>1</fpage>–<lpage>29</lpage>.</mixed-citation>
    </ref>
    <ref id="btac655-B40">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Wickham</surname><given-names>H.</given-names></string-name></person-group> (<year>2016</year>) <source>ggplot2: elegant graphics for data analysis</source>. <publisher-name>Springer-Verlag</publisher-name>, <publisher-loc>New York</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="btac655-B41">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wilkins</surname><given-names>A.T.</given-names></string-name>, <string-name><surname>Reimer</surname><given-names>R.A.</given-names></string-name></person-group> (<year>2021</year>) <article-title>Obesity, early life gut microbiota, and antibiotics</article-title>. <source>Microorganisms</source>, <volume>9</volume>, <fpage>413</fpage>.<pub-id pub-id-type="pmid">33671180</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B42">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ye</surname><given-names>Y.</given-names></string-name>, <string-name><surname>Doak</surname><given-names>T.G.</given-names></string-name></person-group> (<year>2009</year>) <article-title>A parsimony approach to niological pathway reconstruction/inference for metagenomes</article-title>. <source>PLoS Comput. Biol</source>., <volume>5</volume>, <fpage>e1000465</fpage>.<pub-id pub-id-type="pmid">19680427</pub-id></mixed-citation>
    </ref>
    <ref id="btac655-B43">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yu</surname><given-names>G.</given-names></string-name></person-group> (<year>2020</year>) <article-title>Using ggtree to visualize data on tree-like structures</article-title>. <source>Curr. Protoc. Bioinf</source>., <volume>69</volume>, <fpage>e96</fpage>.</mixed-citation>
    </ref>
    <ref id="btac655-B44">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yu</surname><given-names>G.</given-names></string-name></person-group><etal>et al</etal> (<year>2017</year>) <article-title>GGTREE: an R package for visualization and annotation of phylogenetic trees with their covariates and other associated data</article-title>. <source>Methods Ecol. Evol</source>., <volume>8</volume>, <fpage>28</fpage>–<lpage>36</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
