<?DTDIdentifier.IdentifierValue -//ES//DTD journal article DTD version 5.6.0//EN//XML?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName art560.dtd?>
<?SourceDTD.Version 5.6.0?>
<?ConverterInfo.XSLTName elsevier2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<?origin publisher?>
<?FILEmeta_GPB692 xml ?>
<?FILEmain xml ?>
<?FILEmain pdf ?>
<?FILEgr1 jpg ?>
<?FILEgr2 jpg ?>
<?FILEgr3 jpg ?>
<?FILEgr4 jpg ?>
<?FILEgr5 jpg ?>
<?FILEgr6 jpg ?>
<?FILEgr7 jpg ?>
<?FILEmmc1 pdf ?>
<?FILEmmc2 pdf ?>
<?FILEmmc3 pdf ?>
<?FILEmmc4 pdf ?>
<?FILEmmc5 pdf ?>
<?FILEmmc6 pdf ?>
<?FILEmmc7 pdf ?>
<?FILEmmc8 pdf ?>
<?FILEmmc9 pdf ?>
<?FILEmmc10 pdf ?>
<?FILEmmc11 pdf ?>
<?FILEmmc12 pdf ?>
<?FILEmmc13 docx ?>
<?FILEmmc14 docx ?>
<?FILEmmc15 docx ?>
<?FILEmmc16 docx ?>
<?FILEmmc17 docx ?>
<?FILEsi1 svg ?>
<?FILEsi2 svg ?>
<?FILEsi3 svg ?>
<?FILEsi4 svg ?>
<?FILEsi5 svg ?>
<?FILEsi6 svg ?>
<?FILEsi7 svg ?>
<?FILEsi8 svg ?>
<?FILEsi9 svg ?>
<?FILEsi10 svg ?>
<?FILEsi11 svg ?>
<?FILEsi12 svg ?>
<?FILEsi13 svg ?>
<?FILEsi14 svg ?>
<?FILEsi15 svg ?>
<?FILEsi16 svg ?>
<?FILEsi17 svg ?>
<?FILEsi18 svg ?>
<?FILEsi19 svg ?>
<?FILEsi20 svg ?>
<?FILEsi21 svg ?>
<?FILEsi22 svg ?>
<?FILEsi23 svg ?>
<?FILEsi24 svg ?>
<?FILEsi25 svg ?>
<?FILEsi26 svg ?>
<?FILEsi27 svg ?>
<?FILEsi28 svg ?>
<?FILEsi29 svg ?>
<?FILEsi30 svg ?>
<?FILEsi31 svg ?>
<?FILEsi32 svg ?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genomics Proteomics Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genomics Proteomics Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Genomics, Proteomics &amp; Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1672-0229</issn>
    <issn pub-type="epub">2210-3244</issn>
    <publisher>
      <publisher-name>Elsevier</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10025771</article-id>
    <article-id pub-id-type="pii">S1672-0229(22)00167-X</article-id>
    <article-id pub-id-type="doi">10.1016/j.gpb.2022.11.012</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>TIST: Transcriptome and Histopathological Image Integrative Analysis for Spatial Transcriptomics</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" id="au005">
        <name>
          <surname>Shan</surname>
          <given-names>Yiran</given-names>
        </name>
        <xref rid="af005" ref-type="aff">1</xref>
        <xref rid="fn1" ref-type="fn">#</xref>
      </contrib>
      <contrib contrib-type="author" id="au010">
        <name>
          <surname>Zhang</surname>
          <given-names>Qian</given-names>
        </name>
        <xref rid="af005" ref-type="aff">1</xref>
        <xref rid="fn1" ref-type="fn">#</xref>
      </contrib>
      <contrib contrib-type="author" id="au015">
        <name>
          <surname>Guo</surname>
          <given-names>Wenbo</given-names>
        </name>
        <xref rid="af005" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author" id="au020">
        <name>
          <surname>Wu</surname>
          <given-names>Yanhong</given-names>
        </name>
        <xref rid="af005" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author" id="au025">
        <name>
          <surname>Miao</surname>
          <given-names>Yuxin</given-names>
        </name>
        <xref rid="af005" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author" id="au030">
        <name>
          <surname>Xin</surname>
          <given-names>Hongyi</given-names>
        </name>
        <xref rid="af010" ref-type="aff">2</xref>
        <xref rid="af015" ref-type="aff">3</xref>
      </contrib>
      <contrib contrib-type="author" id="au035">
        <name>
          <surname>Lian</surname>
          <given-names>Qiuyu</given-names>
        </name>
        <email>qiuyu.lian@sjtu.edu.cn</email>
        <xref rid="af010" ref-type="aff">2</xref>
        <xref rid="af015" ref-type="aff">3</xref>
        <xref rid="cor1" ref-type="corresp">⁎</xref>
      </contrib>
      <contrib contrib-type="author" id="au040">
        <name>
          <surname>Gu</surname>
          <given-names>Jin</given-names>
        </name>
        <email>jgu@tsinghua.edu.cn</email>
        <xref rid="af005" ref-type="aff">1</xref>
        <xref rid="cor1" ref-type="corresp">⁎</xref>
      </contrib>
      <aff id="af005"><label>1</label>MOE Key Laboratory of Bioinformatics, BNRIST Bioinformatics Division, Department of Automation, Tsinghua University, Beijing 100084, China</aff>
      <aff id="af010"><label>2</label>UM-SJTU Joint Institute, Shanghai Jiao Tong University, Shanghai 200240, China</aff>
      <aff id="af015"><label>3</label>Department of Automation, Shanghai Jiao Tong University, Shanghai 200240, China</aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor1"><label>⁎</label>Corresponding authors. <email>qiuyu.lian@sjtu.edu.cn</email><email>jgu@tsinghua.edu.cn</email></corresp>
      <fn id="fn1">
        <label>#</label>
        <p id="np010">Equal contribution.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="pmc-release">
      <day>19</day>
      <month>12</month>
      <year>2022</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on <pub-date
						pub-type="epub">.-->
    <pub-date pub-type="ppub">
      <month>10</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>19</day>
      <month>12</month>
      <year>2022</year>
    </pub-date>
    <volume>20</volume>
    <issue>5</issue>
    <fpage>974</fpage>
    <lpage>988</lpage>
    <history>
      <date date-type="received">
        <day>13</day>
        <month>4</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>10</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>24</day>
        <month>11</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2022 The Authors</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article under the CC BY license (http://creativecommons.org/licenses/by/4.0/).</license-p>
      </license>
    </permissions>
    <abstract id="ab005">
      <p>Sequencing-based <bold>spatial transcriptomics</bold> (ST) is an emerging technology to study <italic>in situ</italic> gene expression patterns at the whole-genome scale. Currently, ST data analysis is still complicated by high technical noises and low resolution. In addition to the transcriptomic data, matched histopathological images are usually generated for the same tissue sample along the ST experiment. The matched high-resolution histopathological images provide complementary cellular phenotypical information, providing an opportunity to mitigate the noises in ST data. We present a novel ST data analysis method called transcriptome and histopathological image integrative analysis for ST (TIST), which enables the identification of spatial clusters (SCs) and the enhancement of spatial gene expression patterns by integrative analysis of matched transcriptomic data and images. TIST devises a histopathological feature extraction method based on Markov random field (MRF) to learn the cellular features from histopathological images, and integrates them with the transcriptomic data and location information as a network, termed TIST-net. Based on TIST-net, SCs are identified by a random walk-based strategy, and gene expression patterns are enhanced by neighborhood smoothing. We benchmark TIST on both simulated datasets and 32 real samples against several state-of-the-art methods. Results show that TIST is robust to technical noises on multiple analysis tasks for sequencing-based ST data and can find interesting microstructures in different biological scenarios. TIST is available at <ext-link ext-link-type="uri" xlink:href="http://lifeome.net/software/tist/" id="ir888841">http://lifeome.net/software/tist/</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://ngdc.cncb.ac.cn/biocode/tools/BT007317" id="PC_linkQWtp0280qH">https://ngdc.cncb.ac.cn/biocode/tools/BT007317</ext-link>.</p>
    </abstract>
    <kwd-group id="kg005">
      <title>Keywords</title>
      <kwd>Spatial transcriptomics</kwd>
      <kwd>Multimodal information integration</kwd>
      <kwd>Network-based analysis</kwd>
      <kwd>Spatial cluster identification</kwd>
      <kwd>Gene expression enhancement</kwd>
    </kwd-group>
  </article-meta>
  <notes>
    <p id="ms005">Handled by Feng Gao</p>
  </notes>
</front>
<body>
  <sec id="s0005">
    <title>Introduction</title>
    <p id="p0005">Spatial information is crucial for understanding cellular functions in complex physiological and pathological processes. Recent advances in spatial transcriptomics (ST) technologies have made it feasible to achieve concurrent quantification and localization of messenger RNA (mRNA) molecules in tissues <xref rid="b0005" ref-type="bibr">[1]</xref>. Widely used ST technologies can generally be classified into two categories: fluorescence <italic>in situ</italic> hybridization-based ST (FISH-ST) <xref rid="b0010" ref-type="bibr">[2]</xref> and sequencing after <italic>in situ</italic> capture-based ST (SEQ-ST). The SEQ-ST techniques, such as the Visium Spatial Gene Expression, Slide-seq <xref rid="b0015" ref-type="bibr">[3]</xref>, Seq-Scope <xref rid="b0020" ref-type="bibr">[4]</xref>, and Stereo-seq <xref rid="b0025" ref-type="bibr">[5]</xref>, can achieve genome-scale transcriptomic profiling without known transcript information.</p>
    <p id="p0010">Despite the obvious advantages of supplementing mRNA sequencing with spatial information, current SEQ-ST techniques still suffer from several technical limitations, such as high dropout rate (DR) and severe molecular diffusion, <italic>i.e.</italic>, mRNA molecules from one spot diffuse to nearby spots during the permeabilization process. These technical noises heavily impact the downstream computational analyses. A few computational methods tried to integrate single-cell RNA sequencing (scRNA-seq) data to reduce the noises <xref rid="b0030" ref-type="bibr">[6]</xref>, <xref rid="b0035" ref-type="bibr">[7]</xref>. However, the scRNA-seq data are frequently unavailable for the matched sample, which limits the applicability of these methods.</p>
    <p id="p0015">Incorporation of multi-modality information into the transcriptomic analysis is promising to mitigate the technical limitations of SEQ-ST. Existing approaches could be divided into two categories. The first category integrates the spatial locations and gene expression profiles based on diverse models and shows improvement in multiple analytical tasks. For example, BayesSpace <xref rid="b0040" ref-type="bibr">[8]</xref> based on a Bayesian statistical method, STAGATE <xref rid="b0045" ref-type="bibr">[9]</xref> based on graph attention auto-encoder, and STEEL <xref rid="b0050" ref-type="bibr">[10]</xref> based on manifold learning jointly model expression profiles and the corresponding locations, improve the clustering performance of ST. SEDR <xref rid="b0055" ref-type="bibr">[11]</xref> uses deep auto-encoder to co-embed gene expression and spatial location for low-dimensional representation. SPARK <xref rid="b0060" ref-type="bibr">[12]</xref> adopts a generalized linear spatial model with a variety of spatial kernels to detect spatial expression patterns. The second category introduces the matched histopathological images generated by hematoxylin and eosin (H&amp;E) staining into the model in addition to gene expression and spatial location. As the images are taken before the ST experiment, they capture the raw cell features without the molecular diffusion effect. Besides, the images have higher resolution than ST data and provide additional information on cellular phenotypes. For example, stLearn <xref rid="b0065" ref-type="bibr">[13]</xref> leverages morphological similarities to normalize gene expression profiles before clustering and trajectory analysis. SpaGCN <xref rid="b0070" ref-type="bibr">[14]</xref> integrates the three data modalities through graph convolution to identify spatial domains of coherent expression and histopathology. Both show potential to alleviate the impact of technical limitations.</p>
    <p id="p0020">However, the integrative analysis of ST data with histopathological images remains a challenging computational task. Although the transcriptomic data and histopathological images shared linked connections <xref rid="b0075" ref-type="bibr">[15]</xref>, they have different data formats, dimensions, resolutions, and noise levels. A unified method is needed to integratedly analyze the two data modalities for identifying and annotating the spatial clusters (SCs; <italic>i.e.</italic>, targeted tissue regions with distinct gene expression patterns, histopathological features, and biological functions), as well as for enhancing the gene expression patterns by imputing and correcting the raw ST data caused by under-sampling and molecular diffusion.</p>
    <p id="p0025">In this study, we propose an analytical tool suite for ST data named transcriptome and histopathological image integrative analysis for ST (TIST), which includes an SC identification module and a gene enhancement module. Previous work has employed an undirected probabilistic graph model for ST data analytics <xref rid="b0040" ref-type="bibr">[8]</xref>; TIST expands this model by network-based data fusion, incorporating transcriptomic, histopathological, and adjacency information into a single spot-wise similarity network. From the fused similarity network, TIST identifies SCs through a customized random walk algorithm and enhances gene expression through a neighborhood smoothing algorithm. We benchmark TIST against several state-of-the-art ST analytical methods on both simulated datasets and real datasets. Results show that TIST can drastically reduce the impact of molecular diffusion and high mRNA DR, thus improving the performance of several downstream tasks, including SC identification, co-expression analyses, and spatially differentially expressed gene (SDEG) analyses.</p>
  </sec>
  <sec id="s0010">
    <title>Method</title>
    <sec id="s0015">
      <title>Overview of TIST</title>
      <p id="p0030">Current SEQ-ST techniques are generally powered by spatially barcoded probes to capture RNA transcripts <italic>in situ</italic> and label them with location information (<xref rid="f0005" ref-type="fig">Figure 1</xref>A). To overcome the two major noises, the high DR and the molecular diffusion that occurs during the permeabilization process, we propose a computational suite named TIST to improve the identification of SCs and the enhancement of gene expression by effectively integrating ST data with histopathological images (<xref rid="f0005" ref-type="fig">Figure 1</xref>B). By extracting features from each data modality, TIST separately builds three modality-specific networks: a histopathological similarity network generated from high-resolution H&amp;E images by Markov random field (MRF) (<xref rid="s0135" ref-type="sec">Figure S1</xref>A and B), a transcriptomic similarity network generated from the gene expression data by shared nearest neighbor (SNN) <xref rid="b0080" ref-type="bibr">[16]</xref>, and a spatial adjacency network based on the spot locations. Then, TIST fuses the three networks into a multi-modality similarity network, termed TIST-net, for SC identification and gene expression enhancement. Finally, different simulation experiments are conducted to test the stability of TIST against two major noises, the diffusion noises during the permeabilization process, and the dropouts caused by low capture rate. Also, TIST is tested on a total of 32 real tissue slides (Table S1).<fig id="f0005"><label>Figure 1</label><caption><p><bold>Workflow of SEQ-ST techniques and TIST</bold></p><p><bold>A</bold><bold>.</bold> The SEQ-ST workflow. The tissue section is first positioned on a glass slide printed with arrayed spatially barcoded RT primers. H&amp;E staining and brightfield imaging are then conducted to obtain the histopathological image of the tissue section. In the permeabilization step, mRNAs diffuse and hybridize with local RT primers. After the <italic>in situ</italic> RT, cDNAs are synthesized and tagged with spatial barcodes. Finally, these spatially barcoded cDNAs are extracted and pooled for <italic>ex situ</italic> library preparation and sequencing. <bold>B.</bold> The key steps of TIST. TIST takes three modal information as inputs, including histopathological images, transcriptomic data, and spot locations, to construct three networks individually, followed by fusing them into a single network named TIST-net. Based on the fused network, TIST can identify SCs and enhance gene expression patterns. ST, spatial transcriptomics; H&amp;E, hematoxylin and eosin; mRNA, messenger RNA; TIST, transcriptome and histopathological image integrative analysis for ST; SC, spatial cluster; SEQ-ST, <italic>in situ</italic> capture-based ST; RT, reverse transcription; MRF, Markov random field.</p></caption><graphic xlink:href="gr1"/></fig></p>
    </sec>
    <sec id="s0020">
      <title>Construction of the histopathological similarity network</title>
      <p id="p0035">To fully exploit the histopathological image, we build an effective image feature extraction method based on the MRF model and transform pixel-level data into spot-level representation. The H&amp;E image is converted to grayscale, which has been demonstrated to be able to maintain morphological properties <xref rid="b0085" ref-type="bibr">[17]</xref>. As shown in <xref rid="f0005" ref-type="fig">Figure 1</xref>B, MRF sets a hidden label for each pixel. The pixel labels are initialized by <italic>K</italic>-means and the total pixel cluster number <inline-formula><mml:math id="M1" altimg="si1.svg"><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula> is a parameter (default value is set to 50). Considering third-order neighborhood, MRF maximizes the whole likelihood via Expectation-Maximization (EM) algorithm, grouping all pixels across the image into different clusters. We use the pixel label distribution over the region that an individual spot covers as the representation of spot-level histopathological features.</p>
      <p id="p0040">Then, we construct the image-based spot-wise similarity network. Let <inline-formula><mml:math id="M2" altimg="si2.svg"><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M3" altimg="si3.svg"><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denote the pixel label distribution of two spots <italic>u</italic> and <italic>v</italic>. The symmetrical Kullback–Leibler (KL) divergence <italic>L<sub>u,v</sub></italic> between spots <italic>u</italic> and <italic>v</italic> is calculated as follows:<disp-formula id="e0005"><label>(1)</label><mml:math id="M4" altimg="si4.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">‖</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mo>+</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">‖</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula><disp-formula id="e0010"><label>(2)</label><mml:math id="M5" altimg="si5.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">‖</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi>log</mml:mi><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula><disp-formula id="e0015"><label>(3)</label><mml:math id="M6" altimg="si6.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">‖</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi>log</mml:mi><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
      <p id="p0045">Here, <inline-formula><mml:math id="M7" altimg="si7.svg"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M8" altimg="si8.svg"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denote the probability or proportion of pixels in spots <italic>u</italic> and <italic>v</italic> belonging to label <italic>i</italic>, respectively. The adjacency matrix of the histopathological similarity network, <italic>H</italic>, could be calculated as follows:<disp-formula id="e0020"><label>(4)</label><mml:math id="M9" altimg="si9.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>min</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mfenced open="{"><mml:mtable><mml:mtr><mml:mtd><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>when</mml:mi><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>1</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>when</mml:mi><mml:mspace width="0.25em"/><mml:mn>0</mml:mn><mml:mo>&lt;</mml:mo><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mfenced></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec id="s0025">
      <title>Construction of the transcriptomic similarity network</title>
      <p id="p0050">We next construct a spot-wise transcriptomic similarity network. We first select the top 2000 highly variable genes using the FindVariableGenes function from the Seurat package in R and perform principal component analysis (PCA). With the top 50 principal components (PCs), we construct a SNN <xref rid="b0080" ref-type="bibr">[16]</xref> graph using the FindNeighbors function from the Seurat package with the default settings. The edge weights of the SNN graph are used as the adjacency matrix of the transcriptomic similarity network <italic>T</italic>:<disp-formula id="e0025"><label>(5)</label><mml:math id="M10" altimg="si10.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>w</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec id="s0030">
      <title>Construction of TIST-net</title>
      <p id="p0055">Finally, we integrate the histopathological similarity network <italic>H</italic> and the transcriptomic similarity network <italic>T</italic> together with the spatial locations of spots into a multi-modality network, termed TIST-net. The physical spatial distance between spots <italic>u</italic> and <italic>v</italic>, denoted as <italic>A<sub>u,v</sub></italic>, is measured with Manhattan distance. The final adjacency matrix of TIST-net is defined as follows:<disp-formula id="e0030"><label>(6)</label><mml:math id="M11" altimg="si11.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mfenced><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>·</mml:mo><mml:mi>I</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mfenced></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>·</mml:mo><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.166667em"/></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula>where <italic>I</italic> is the indicator function. <italic>S<sub>u,v</sub></italic> is then normalized to 0–1 by:<disp-formula id="e0035"><label>(7)</label><mml:math id="M12" altimg="si12.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mi>min</mml:mi><mml:mrow><mml:mfenced><mml:mi>S</mml:mi></mml:mfenced></mml:mrow></mml:mrow><mml:mrow><mml:mi>max</mml:mi><mml:mrow><mml:mfenced><mml:mi>S</mml:mi></mml:mfenced></mml:mrow><mml:mo>-</mml:mo><mml:mi>min</mml:mi><mml:mrow><mml:mfenced><mml:mi>S</mml:mi></mml:mfenced></mml:mrow></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec id="s0035">
      <title>Gene expression enhancement</title>
      <p id="p0065">Using the neighboring information in TIST-net, we could enhance gene expression by calculating the weighted average of the expression of immediate neighbors for a single spot. For any spot <italic>u</italic>, we define:<disp-formula id="e0040"><label>(8)</label><mml:math id="M13" altimg="si13.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msubsup><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>∈</mml:mo><mml:mi>N</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mfenced><mml:mi>u</mml:mi></mml:mfenced></mml:mrow></mml:mrow></mml:munder><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup><mml:mo>·</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
      <p id="p0070">Here, <italic>E*</italic> is the enhanced gene expression, and <italic>E</italic> is the raw gene expression. <italic>Neighbor</italic>(<italic>u</italic>) represents the immediate neighbors of spot <italic>u</italic> in TIST-net.</p>
    </sec>
    <sec id="s0040">
      <title>Identification of SCs</title>
      <p id="p0075">TIST detects communities from TIST-net as SCs using Walktrap, a random walk-based algorithm <xref rid="b0090" ref-type="bibr">[18]</xref>. Let <italic>D</italic> denotes the diagonal matrix of the node degrees and <italic>S</italic> denotes the edge weight matrix of TIST-net, so the transition probability matrix is calculated as <italic>P</italic> = <italic>D</italic><bold><sup>−</sup></bold><sup>1</sup><italic>S</italic>. The distance between spots <italic>u</italic> and <italic>v</italic>, denoted as <italic>W<sub>u,v</sub></italic>, could be calculated as:<disp-formula id="e0045"><label>(9)</label><mml:math id="M14" altimg="si14.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mfenced open="|" close="|"><mml:mrow><mml:mfenced open="|" close="|"><mml:mrow><mml:msup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msubsup><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>·</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msubsup><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>·</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M15" altimg="si14.svg"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>·</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M16" altimg="si14.svg"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>·</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> are probability vectors of <italic>t</italic>-step random transition probability from spot <italic>u</italic> and spot <italic>v</italic> toward other spots, respectively, while <italic>t</italic> represents the step strength of random walk. <italic>W<sub>u,v</sub></italic> is demonstrated to well quantify the structural similarities using random walk <xref rid="b0090" ref-type="bibr">[18]</xref>. This distance, which captures the network community structure features, enables SC identification by hierarchical clustering.</p>
    </sec>
    <sec id="s0045">
      <title>Simulation of diffusion effect</title>
      <p id="p0080">To mimic the diffusion effect of the permeabilization process, we use <italic>D</italic>(<italic>u</italic>|<italic>u</italic><sub>0</sub>) to denote the diffusion effect produced by source spot <italic>u</italic><sub>0</sub>, which acts on any other target spot <italic>u</italic>, based on Fick’s first law of diffusion <xref rid="b0095" ref-type="bibr">[19]</xref>. We assume that each spot diffuses to other spots with lower concentrations and define:<disp-formula id="e0050"><label>(10)</label><mml:math id="M17" altimg="si15.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:munder><mml:mi>D</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mo>+</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:munder><mml:mi>D</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula><disp-formula id="e0055"><label>(11)</label><mml:math id="M18" altimg="si16.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>D</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mo>=</mml:mo><mml:mi>J</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mo>·</mml:mo><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mfenced><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mo>·</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M19" altimg="si16.svg"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> represents original gene counts in spot <italic>u</italic><sub>0</sub>; <inline-formula><mml:math id="M20" altimg="si16.svg"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> represents gene counts in spot <italic>u</italic><sub>0</sub> after diffusion; and <italic>D</italic>(<italic>u</italic>|<italic>u</italic><sub>0</sub>) is the gene counts diffused from spot <italic>u</italic><sub>0</sub> to spot <italic>u</italic>. Based on Fick’s first law, <italic>J</italic> represents diffusion flux, defined as:<disp-formula id="e0060"><label>(12)</label><mml:math id="M21" altimg="si17.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>J</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mo>=</mml:mo><mml:mi>φ</mml:mi><mml:mo>·</mml:mo><mml:mrow><mml:mfenced><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mo>|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>|</mml:mo><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mspace width="0.166667em"/><mml:mo>-</mml:mo><mml:mspace width="0.166667em"/><mml:mrow><mml:mo>|</mml:mo><mml:mo>|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>|</mml:mo><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula>where <italic>φ</italic> represents the diffusion rate, which is related to temperature, liquid viscosity, and molecular size. We adjust <italic>φ</italic> in the range {0.1, 0.2, 0.3, …, 0.9} to obtain different simulation results. <italic>k<sub>G</sub></italic><inline-formula><mml:math id="M22" altimg="si18.svg"><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">⊤</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> is the Gaussian kernel function on the distance matrix, which can be written in the following form:<disp-formula id="e0065"><label>(13)</label><mml:math id="M23" altimg="si18.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mfenced><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msqrt><mml:mrow><mml:msup><mml:mrow><mml:mfenced><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="normal">Σ</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi><mml:mrow><mml:mfenced><mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>u</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">⊤</mml:mi></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="normal">Σ</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>u</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula><disp-formula id="e0070"><label>(14)</label><mml:math id="M24" altimg="si19.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi mathvariant="normal">Σ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mfenced open="(" close=")"><mml:mrow><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mtd><mml:mtd><mml:mrow><mml:mi>ρ</mml:mi><mml:msub><mml:mi>σ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>ρ</mml:mi><mml:msub><mml:mi>σ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd><mml:mtd><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M25" altimg="si20.svg"><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M26" altimg="si21.svg"><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:math></inline-formula> denote the spatial coordinates of the source spot <italic>u</italic><sub>0</sub> and target spot <italic>u</italic>, and |∑| is the determinant of the covariance matrix. We set <italic>σ</italic><sub>1</sub> = <italic>σ</italic><sub>2</sub> = 4 and <italic>ρ</italic> = 1 by default.</p>
    </sec>
    <sec id="s0050">
      <title>Simulation of dropout</title>
      <p id="p0095">To simulate dropout events, we first randomly select elements in the gene expression matrix and set them to zero. The proportion of selected elements to all is defined as the DR, and we set this rate in the range {0.1, 0.2, 0.3, …, 0.9}. We then construct TIST-net. To fill in missing data, we use the average expression of adjacent non-zero vertices in TIST-net. Specifically, with the increase in the DR, the neighbor vertices of a missing vertex may also be lost. Therefore, we loop the fill operation above to ensure that all missed vertices are filled. Experiments show that the number of loops is positively related to the DR. We calculate KL divergence between two gene expression vectors before and after the dropout operation and define 1 − KL divergence as the dropout recovery score. A higher recovery score indicates better filling results.</p>
    </sec>
    <sec id="s0055">
      <title>SDEG detection and evaluation</title>
      <p id="p0100">We detect SDEGs for each SC by TIST. Based on the good SC identification results of TIST, we predominantly detect those genes with spatial expression patterns that are displayed in certain SCs by means of the FindAllMarkers function in Seurat. We select the top 100 genes with the largest log<sub>2</sub> fold change between the mean expression value in the target SC and others using the Wilcoxon rank-sum test to test differences. We utilize the significance level defined by SPARK to rank adjusted <italic>P</italic> values for SDEGs and select the top 100 genes for further analysis.</p>
      <p id="p0105">We reward genes with high total expression levels in adjacent spaces as more biologically meaningful and define <italic>G<sub>es</sub></italic> to quantify the spatial enrichment effect as:<disp-formula id="e0075"><label>(15)</label><mml:math id="M27" altimg="si22.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>X</mml:mi><mml:mo>·</mml:mo><mml:mi>N</mml:mi><mml:mo>·</mml:mo><mml:msup><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
      <p id="p0110">Here, <italic>X</italic> represents the expression matrix with rows as genes and columns as spots, and <italic>N</italic> is the spot adjacent matrix of the k nearest neighbors (KNN) (selected according to the spatial location of the spot and set as 1 by default). For a specific gene <italic>g</italic>, its enrichment score equals to <inline-formula><mml:math id="M28" altimg="si23.svg"><mml:mrow><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. This gene enrichment score is normalized to 0–1 as follows:<disp-formula id="e0080"><label>(16)</label><mml:math id="M29" altimg="si24.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msubsup><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mi>min</mml:mi><mml:mrow><mml:mfenced><mml:msub><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mfenced></mml:mrow></mml:mrow><mml:mrow><mml:mi>max</mml:mi><mml:mrow><mml:mfenced><mml:msub><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mfenced></mml:mrow><mml:mo>-</mml:mo><mml:mi>min</mml:mi><mml:mrow><mml:mfenced><mml:msub><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mfenced></mml:mrow></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec id="s0060">
      <title>Quantitative indicators for evaluating clustering effects</title>
      <p id="p0115">To evaluate the similarity between the identified SC labels and the ground truth data labels, we use two commonly used quantitative metrics: Adjusted Rand Index (ARI) and Normalized Mutual Information (NMI):<disp-formula id="e0085"><label>(17)</label><mml:math id="M30" altimg="si25.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi mathvariant="italic">ARI</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mfenced open="(" close=")"><mml:mrow><mml:mfrac><mml:msub><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow></mml:msub><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mfenced open="(" close=")"><mml:mrow><mml:mfrac><mml:msub><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mfenced open="(" close=")"><mml:mrow><mml:mfrac><mml:msub><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:mi>T</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mrow><mml:mfenced open="(" close=")"><mml:mrow><mml:mfrac><mml:mrow><mml:mi mathvariant="italic">SN</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mfenced open="(" close=")"><mml:mrow><mml:mfrac><mml:msub><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mfenced open="(" close=")"><mml:mrow><mml:mfrac><mml:msub><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:mi>T</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mfenced open="(" close=")"><mml:mrow><mml:mfrac><mml:msub><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mfenced open="(" close=")"><mml:mrow><mml:mfrac><mml:msub><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:mi>T</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mrow><mml:mfenced open="(" close=")"><mml:mrow><mml:mfrac><mml:mrow><mml:mi mathvariant="italic">SN</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula><disp-formula id="e0090"><label>(18)</label><mml:math id="M31" altimg="si26.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi mathvariant="italic">NMI</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi mathvariant="italic">SN</mml:mi></mml:mfrac><mml:mo>·</mml:mo><mml:mi>log</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="italic">SN</mml:mi><mml:mo>·</mml:mo><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>·</mml:mo><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi mathvariant="italic">SN</mml:mi></mml:mfrac><mml:mo>·</mml:mo><mml:mi>log</mml:mi><mml:mfrac><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi mathvariant="italic">SN</mml:mi></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi mathvariant="italic">SN</mml:mi></mml:mfrac><mml:mo>·</mml:mo><mml:mi>log</mml:mi><mml:mfrac><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi mathvariant="italic">SN</mml:mi></mml:mfrac><mml:mo>)</mml:mo></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
      <p id="p0120">Here, <inline-formula><mml:math id="M32" altimg="si27.svg"><mml:mrow><mml:mi mathvariant="italic">SN</mml:mi></mml:mrow></mml:math></inline-formula> represents the number of all spots in one slice. <inline-formula><mml:math id="M33" altimg="si28.svg"><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> represents the number of spots classified into the predicted cluster <italic>i</italic>, and <inline-formula><mml:math id="M34" altimg="si29.svg"><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:mi>T</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> represents the number of spots in the true cluster <italic>j</italic>. <inline-formula><mml:math id="M35" altimg="si30.svg"><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>_</mml:mi><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> represents the number of overlapping spots between the predicted cluster <italic>i</italic> and the true cluster <italic>j</italic>. Both ARI and NMI reach the highest value at 1 and lowest score at 0, as the higher values indicate the better identification performance.</p>
      <p id="p0125">To quantitatively assess the effects of different clustering methods, we design both supervised and unsupervised indices. Regarding supervised classification accuracy <italic>A<sub>s</sub></italic>, we define:<disp-formula id="e0095"><label>(19)</label><mml:math id="M36" altimg="si31.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">consistent</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">all</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>·</mml:mo><mml:mn>100</mml:mn><mml:mo>%</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
      <p id="p0130">Here, <italic>S<sub>consistent</sub></italic> is the number of spots that belong to SCs identified consistent with those in the ground truth, and <italic>S<sub>all</sub></italic> is the number of all spots in a dataset. For an annotated dataset, we first obtain labels of spots belonging to different SCs by different methods and then map those cluster labels to the ground truth by maximum matching and calculate the matching proportion.</p>
      <p id="p0135">The unsupervised modularity <italic>Q</italic> score is introduced to measure the clustering effects of networks constructed by different methods. The better clustering effects present more edges within the same clusters and fewer edges among different clusters. Here, we define:<disp-formula id="e0100"><label>(20)</label><mml:math id="M37" altimg="si32.svg"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mi>c</mml:mi></mml:msub><mml:mrow><mml:mfenced open="(" close=")"><mml:mrow><mml:mfrac><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi mathvariant="italic">inner</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi mathvariant="italic">all</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mfenced open="(" close=")"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi mathvariant="italic">inner</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi mathvariant="italic">outer</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi mathvariant="italic">all</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula>where <italic>N<sub>inner</sub></italic> and <italic>N<sub>outer</sub></italic> represent the numbers of edges whose vertices belong to the same clusters and different clusters, respectively. <italic>N<sub>all</sub></italic> is the number of all edges in the network. <italic>C</italic> represents all clusters in the network. The value of <italic>Q</italic> is positively related to a better clustering effect. The range of the <italic>Q</italic> value is [−0.5,1). A previous study <xref rid="b0100" ref-type="bibr">[20]</xref> has shown that a range [0.3,0.7] of <italic>Q</italic> represents the most satisfactory clustering effect.</p>
    </sec>
    <sec id="s0065">
      <title>Data source</title>
      <p id="p0140">We benchmarked TIST on 32 real tissue slides by the Visium platform, including 11 10x Genomics officially released samples (<ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/resources/datasets" id="PC_linkQkSy7Jmxml">https://www.10xgenomics.com/resources/datasets</ext-link>; Table S1) and 21 human primary liver cancer samples from our previous study <xref rid="b0105" ref-type="bibr">[21]</xref>. Among these samples, one mouse cerebral cortex sample and one hepatocellular carcinoma (HCC) sample were used for the in-depth performance assessment.</p>
    </sec>
    <sec id="s0070">
      <title>Data preprocessing</title>
      <p id="p0145">To extract the effective pixels of H&amp;E staining images, we first converted them into grayscale and then fitted a mixed Gaussian model to identify the foreground pixels covered by tissue. For spatial RNA-seq data, we normalized the gene expression using the R package Seurat (v4.0.3) by the default method LogNormalize. Then, the expression of each gene was scaled to a standard normal distribution.</p>
    </sec>
  </sec>
  <sec id="s0075">
    <title>Results</title>
    <sec id="s0080">
      <title>TIST enables unsupervised identification of biologically meaningful tissue domains</title>
      <p id="p0150">Different regions in complex tissues or organs display distinct transcriptomic and histopathological patterns. We applied TIST to two datasets with well-annotated regions and confirmed that TIST could effectively incorporate histopathological information, leading to biologically meaningful SCs.</p>
      <p id="p0155">We first analyzed the mouse cerebral cortex dataset shown in <xref rid="f0010" ref-type="fig">Figure 2</xref>A. We used manually annotated tissue domains guided by the reference atlas diagram from Allen Institute for Brain Science <xref rid="b0110" ref-type="bibr">[22]</xref> as the ground truth (<xref rid="f0010" ref-type="fig">Figure 2</xref>A, <xref rid="s0135" ref-type="sec">Figure S2</xref>A; Table S2). The structure of the cerebral cortex is highly complex, such that adjacent areas within the cortex might be entirely different in both cell composition and function. For example, the dentate gyrus and the hippocampus proper (Ammon’s horn) are the two main and interlocking parts of the hippocampus formation <xref rid="b0115" ref-type="bibr">[23]</xref>. The dentate gyrus, consisting of granule cells, contributes to the formation of new episodic memories and is one of the few structures where neurogenesis takes place in the adult brain <xref rid="b0120" ref-type="bibr">[24]</xref>. The hippocampus proper plays a vital role in learning and memory. The principal cell layers of the two parts are indicated with arrows in the manual annotation results (<xref rid="f0010" ref-type="fig">Figure 2</xref>A).<fig id="f0010"><label>Figure 2</label><caption><p><bold>SC identification results of TIST on mouse cerebral cortex dataset and HCC data</bold></p><p><bold>A</bold><bold>.</bold> Comparisons among TIST and state-of-the-art methods on the mouse cerebral cortex dataset. The left column shows the histopathological image and manual annotation of this dataset. For details on the methods, see Table S3. SC identification results, as well as quantitative indexes ARI and NMI are shown, highlighting the hippocampus proper and the dentate gyrus in the hippocampus formation with red arrows. <bold>B.</bold> SC identification results on an HCC dataset. The first column shows the histopathological image of the HCC section, composed of T region on the left, BM region in the middle, and A liver region on the right. TLS regions with specific histopathological characteristics are marked with red boxes. The second and third columns show the SC identification results of Louvain and TIST, respectively. The fourth column displays one SC that TIST automatically identifies, which highly matches the TLS regions. The last column visualizes the TLS score of each spot based on the 12-chemokine signature scoring method. <bold>C.</bold> Raw expression patterns (upper panel) of typical 12-chemokine signature genes, including <italic>CCL2</italic>, <italic>CCL3</italic>, <italic>CCL5</italic>, <italic>CCL18</italic>, <italic>CCL19</italic>, and <italic>CCL21</italic>, and their TIST-enhanced expression patterns (bottom panel). ARI, adjusted Rand index; NMI, normalized mutual information; T, tumor; BM, basement membrane; A, adjacent; TLS, tertiary lymphatic structure; HCC, hepatocellular carcinoma.</p></caption><graphic xlink:href="gr2"/></fig></p>
      <p id="p0160">Taking this manually annotated slide as a benchmarking sample, we compared TIST with several classical and recently published methods (Louvain <xref rid="b0030" ref-type="bibr">[6]</xref>, BayesSpace <xref rid="b0040" ref-type="bibr">[8]</xref>, STAGATE <xref rid="b0045" ref-type="bibr">[9]</xref>, STEEL <xref rid="b0050" ref-type="bibr">[10]</xref>, SEDR <xref rid="b0055" ref-type="bibr">[11]</xref>, stLearn <xref rid="b0065" ref-type="bibr">[13]</xref>, and SpaGCN <xref rid="b0070" ref-type="bibr">[14]</xref>; and the feature comparisons among these methods are listed in Table S3) in terms of visualization results and two quantitative indexes, ARI and NMI. Of note, considering the sensitivity of Louvain to the resolution parameter, we tested Louvain in different resolutions and selected the parameter resolution at 0.3 in the comparison (<xref rid="s0135" ref-type="sec">Figure S2</xref>B–D). Parameters in other methods were set as default. Overall, the SCs identified by TIST highly agreed with the ground truth and TIST performed the best clustering accuracy with ARI = 0.68 and NMI = 0.78 (<xref rid="f0010" ref-type="fig">Figure 2</xref>A). Compared to Louvain, the classical clustering method developed for scRNA-seq data, all the other methods showed better performances. Beyond the two indexes, TIST can also better use the image features to identify relatively tiny tissue structures. For example, TIST accurately identified the predominant cell layers of the hippocampus and the dentate gyrus, compared to which the other methods did not precisely recover these important structures.</p>
      <p id="p0165">To assess the effects of each individual network in TIST, we re-calculated ARI and NMI by removing one network each time (the transcriptomic similarity network, histopathological similarity network, and physical spatial adjacency network, respectively) (<xref rid="s0135" ref-type="sec">Figure S3</xref>). We found that the hippocampus and the dentate gyrus cannot be identified accurately with any of the other two networks. Quantitatively, the performances were dropped by ∼ 14% in ARI and ∼ 6% in NMI when any one network was removed. These results suggest that the three networks contain complementary information and TIST successfully integrates these features to improve the accuracy for identifying relatively small tissue structures.</p>
      <p id="p0170">We further demonstrated the superior performance of TIST with an HCC dataset (HCC-1L in Table S1) <xref rid="b0105" ref-type="bibr">[21]</xref>. The section covers the tumor border, enabling the dissection of immune infiltration. With histopathological knowledge, we separated the whole section into the tumor region on the left side, the basement membrane in the middle, and an adjacent liver region to the right of the section (<xref rid="f0010" ref-type="fig">Figure 2</xref>B). Notably, there are several tertiary lymphatic structure (TLS) regions in the adjacent liver region, marked with red boxes. TLS consists of ectopic aggregates of lymphoid cells in inflamed, infected, or tumoral tissues <xref rid="b0125" ref-type="bibr">[25]</xref> and is reported to be closely related to tumor progression and metastasis, serving as a potential predictive marker for immunotherapy and prognosis <xref rid="b0130" ref-type="bibr">[26]</xref>. Accurate identification of TLS regions from ST data is crucial for comprehensively depicting the tumor immune microenvironment. We annotated TLS regions with a 12-chemokine signature scoring method <xref rid="b0135" ref-type="bibr">[27]</xref> as a reference and compared the TLS identification performance of TIST with that of Louvain. As shown in <xref rid="f0010" ref-type="fig">Figure 2</xref>B, TIST manages to identify a cluster of spatial domains denoted in seafoam color, which are consistent with annotated high TLS score domains based on 12-chemokine signature genes. However, the partition given by Louvain has difficulty matching the TLS annotations.</p>
      <p id="p0175">Moreover, we enhanced gene expression patterns through neighborhood smoothing based on TIST-net to interrogate whether the enhanced gene expression could mitigate the technical noises and better recapture the details of the biological tissue. <xref rid="f0010" ref-type="fig">Figure 2</xref>C shows six genes <xref rid="b0135" ref-type="bibr">[27]</xref> with reported relationships to TLS and compares their raw expression (upper panel) and enhanced expression (bottom panel). Clearly, the enhanced expression patterns show much more obvious spatial patterns and match better with the TLS annotations in <xref rid="f0010" ref-type="fig">Figure 2</xref>B, confirming the capacity of TIST in integrating ST data with the histopathological image.</p>
    </sec>
    <sec id="s0085">
      <title>TIST resists the noise induced by mRNA molecular diffusion</title>
      <p id="p0180">The diffusion of mRNA molecules during the permeabilization process brings in inevitable noises challenging ST data analysis but has not received enough attention. In the permeabilization step, mRNA molecules can diffuse from their original locations into adjacent spots, leading to inaccurate spatial expression patterns. To showcase the severity of mRNA diffusion, we inspected the blank area in the section without tissue coverage, where no unique molecular identifiers (UMIs) should be present. We observed 1.67%–23.6% (average 8.30%) UMIs detected in blank areas in all datasets (Table S1) and visualized the UMI counts in the blank area of the mouse cerebral cortex dataset in <xref rid="f0015" ref-type="fig">Figure 3</xref>A.<fig id="f0015"><label>Figure 3</label><caption><p><bold>Resistance of TIST to diffusion noise</bold></p><p><bold>A.</bold> Example of mRNA diffusion in SEQ-ST data. The left heatmap displays the UMI counts detected on the slide area not covered by tissue, induced by mRNA diffusion from the tissue-covered area. The right histogram shows the distributions of UMI counts detected in the blank area and in the tissue-covered area on the slide. <bold>B.</bold> Schematic of the simulation model of diffusion noise, describing the diffusion effect that is produced by the source spot <italic>u</italic><sub>0</sub> and acts on any other target spot <italic>u</italic>. The peak height represents the concentrations of mRNA molecules of a certain gene at the matching spot. <bold>C.</bold> Simulated expression patterns of the marker gene <italic>Adarb1</italic> with different settings of diffusion rate (upper panel) and the corresponding TIST-enhanced expression patterns (lower panel). <bold>D.</bold> Simulated expression patterns of the marker genes <italic>Ramp3</italic>, <italic>Enpp2</italic>, <italic>Klk8</italic>, and <italic>Hpca</italic>, with a diffusion rate fixed at 0.3 (upper panel) and the corresponding TIST-enhanced expression patterns (lower panel). <bold>E.</bold> Performances of Louvain (upper panel) and TIST (lower panel) in identifying and segregating the hippocampus proper and the dentate gyrus at different simulated diffusion rates. <bold>F.</bold> SC identification accuracies of Louvain (blue line) and TIST (red line) on the whole dataset given different simulation diffusion rates. <italic>φ</italic>, diffusion rate; <italic>A<sub>s</sub></italic>, identification accuracy; UMI, unique molecular identifier.</p></caption><graphic xlink:href="gr3"/></fig></p>
      <p id="p0185">We developed a diffusion simulation method according to Fick’s first law of diffusion <xref rid="b0095" ref-type="bibr">[19]</xref> and benchmarked TIST on simulated datasets with ground truth. <xref rid="f0015" ref-type="fig">Figure 3</xref>B shows that the simulated mRNA diffusion effect from the source spot <italic>u</italic><sub>0</sub> to any other target spot <italic>u</italic>, denoted <italic>D</italic>(<italic>u</italic>|<italic>u</italic><sub>0</sub>), is negatively related to the distance between the two spots and positively related to the concentration gradient and diffusion rate <italic>φ</italic>. Here, the diffusion rate <italic>φ</italic> models the influence of potential diffusion-related factors, including temperature, liquid viscosity, and molecular size.</p>
      <p id="p0190">We showed resistance of TIST to diffusion noise with marker genes that are specifically expressed in certain tissue domains. <italic>Adarb1</italic>, reported to be associated with the nervous system <xref rid="b0140" ref-type="bibr">[28]</xref>, was found to be specifically expressed in the sensory-motor cortex-related zone of the thalamus (BS-IB-IORsm). We tested simulated <italic>φ</italic> ranging from 0.1 to 0.9 and exhibited the results in <xref rid="f0015" ref-type="fig">Figure 3</xref>C and <xref rid="s0135" ref-type="sec">Figure S4</xref>A. TIST-enhanced expression of <italic>Adarb1</italic> restored its spatial pattern even when the diffusion effect was tremendous (<xref rid="f0015" ref-type="fig">Figure 3</xref>C). We further investigated various genes marking different SCs with fixed diffusion rates (<xref rid="f0015" ref-type="fig">Figure 3</xref>D, <xref rid="s0135" ref-type="sec">Figure S4</xref>B). To further validate the fidelity of gene enhancement, we compared all these gene expression patterns with the well-annotated “reference” data from Allen Mouse Brain Atlas <xref rid="b0110" ref-type="bibr">[22]</xref>. The enhanced expression patterns by TIST are highly consistent with the <italic>in situ</italic> hybridization (ISH) as well as immunofluorescence (IF) results in the atlas (<xref rid="s0135" ref-type="sec">Figure S5</xref>). Comparing TIST-enhanced profiles with raw expression patterns not undergoing any simulation diffusion, we could conclude that TIST-enhanced ST data well reserve the spatial expression patterns and enable stable recapitulation of tissue structures even with severe diffusion noise.</p>
      <p id="p0195">We further benchmarked TIST for SC identification and classification with simulated datasets at different diffusion rates and compared TIST with Louvain <xref rid="b0030" ref-type="bibr">[6]</xref>, a classical clustering method developed for scRNA-seq. The performance of TIST compared with that of Louvain in identifying the hippocampus proper and the dentate gyrus is shown in <xref rid="f0015" ref-type="fig">Figure 3</xref>E and <xref rid="s0135" ref-type="sec">Figure S5</xref>B. To fully evaluate SC identification performance of resisting diffusion noise, we investigated whether TIST could identify SCs from simulated diffusion datasets that well resemble the manually annotated results shown in <xref rid="f0010" ref-type="fig">Figure 2</xref>A. As shown in <xref rid="f0015" ref-type="fig">Figure 3</xref>F, TIST indeed achieves superior SC identification and classification performance compared to Louvain with higher recognition accuracy <italic>A<sub>s</sub></italic> across all diffusion rate settings. An unsupervised modularity index was also adopted as the metric <xref rid="b0100" ref-type="bibr">[20]</xref> and agreed that TIST performs better than Louvain at SC identification with diffusion noise (<xref rid="s0135" ref-type="sec">Figure S5</xref>C).</p>
    </sec>
    <sec id="s0090">
      <title>TIST accommodates high DR</title>
      <p id="p0200">As with scRNA-seq, ST methods also suffer from a low mRNA capture rate, resulting in a large proportion of false zeros for expressed genes, which are called “dropout” events. Currently, SEQ-ST datasets can reach a median of 600 to 6000 genes detected per spot (Table S1). A high ratio of dropout would compromise the accuracy of downstream analyses. There is an urgent need to develop ST analysis methods to overcome high DR.</p>
      <p id="p0205">First, <italic>Hpca</italic>, a specific marker gene of the hippocampus proper <xref rid="b0145" ref-type="bibr">[29]</xref>, was selected to test whether TIST could enhance gene expression effectively from ST data with different dropouts. We randomly removed 10%–90% of non-zero data in the original expression matrix and used TIST-net to fill and restore the expression patterns. As the DR increased, the aggregation effect of <italic>Hpca</italic> expression gradually weakened (<xref rid="f0020" ref-type="fig">Figure 4</xref>A). Its spatial expression pattern became increasingly difficult to discern based on raw data. TIST-enhanced expression maintained distinct domain enrichment until the DR reached 0.8 (<xref rid="f0020" ref-type="fig">Figure 4</xref>A, <xref rid="s0135" ref-type="sec">Figure S5</xref>A). Fixing the simulated DR as 0.5, we further inspected various marker genes; and the results are shown in <xref rid="f0020" ref-type="fig">Figure 4</xref>B and <xref rid="s0135" ref-type="sec">Figure S6</xref>A. In addition, we designed a recovery score to quantitively measure how well TIST-enhanced expression profiles from simulated dropout datasets resemble expression patterns before simulating dropouts. We selected 49 genes (Table S4) reported to be related to brain activities <xref rid="b0110" ref-type="bibr">[22]</xref> for evaluation. As shown in <xref rid="f0020" ref-type="fig">Figure 4</xref>C, it would be difficult to recover gene expression with high fidelity if we dropped more than 40% of the expressed genes from the currently measured ST data.<fig id="f0020"><label>Figure 4</label><caption><p><bold>Resistance of TIST to dropout noise</bold></p><p><bold>A.</bold> Simulated expression patterns of the marker gene <italic>Hpca</italic> with DRs ranging from 0.1 to 0.8 (upper panel) and the corresponding TIST-enhanced expression patterns (lower panel). <bold>B.</bold> Simulated expression patterns of the marker genes <italic>Ramp3</italic>, <italic>Enpp2</italic>, <italic>Klk8</italic>, and <italic>Adrab1</italic> at a fixed DR of 0.5 (upper panel) and the corresponding TIST-enhanced expression patterns (lower panel). <bold>C.</bold> Boxplot of recovery scores that TIST achieves on 49 genes reported to be related to brain activities under different simulated DRs. The dotted line connects the median recovery scores in each condition. <bold>D.</bold> Performances of Louvain (upper panel) and TIST (lower panel) in identifying and segregating the hippocampus proper and the dentate gyrus at different simulated DRs. <bold>E.</bold> SC identification accuracies of Louvain (blue line) and TIST (red line) on the whole dataset given different simulated DRs. DR, dropout rate.</p></caption><graphic xlink:href="gr4"/></fig></p>
      <p id="p0210">Next, we evaluated the influence of dropout on SC identification. Using the example of the hippocampus proper and the dentate gyrus, we compared the performance of TIST against that of Louvain with simulated DRs ranging from 0.1 to 0.8. As shown in <xref rid="f0020" ref-type="fig">Figure 4</xref>D, Louvain always fails to distinguish the two regions, while TIST allows accurate identification and segregation of the two regions when the simulated DR is less than 0.6. We also quantitatively measured the SC identification performance on the whole mouse cerebral cortex dataset with both the supervised and unsupervised metrics (<xref rid="f0020" ref-type="fig">Figure 4</xref>E, <xref rid="s0135" ref-type="sec">Figure S6</xref>B), finding that the dropout resistance of TIST regarding SC identification significantly surpasses that of Louvain.</p>
    </sec>
    <sec id="s0095">
      <title>TIST refines the detection of spatial expression patterns</title>
      <p id="p0215">The detection of SDEGs is a powerful way to link spatial regions with biological functions. Previous work has shown that SPARK, built upon a generalized linear spatial model with a variety of spatial kernels, is a powerful tool for revealing spatial expression patterns <xref rid="b0060" ref-type="bibr">[12]</xref>. We thus compared TIST with SPARK in identifying SDEGs on the mouse cerebral cortex dataset.</p>
      <p id="p0220">We evaluated SDEG identification by comparing the top 100, top 500, and top 1000 SDEGs identified by TIST and SPARK. As shown in <xref rid="f0025" ref-type="fig">Figure 5</xref>A, only 6 genes were shared in the top 100 SDEGs, while the overlap increased as the total number increased, up to nearly 50% in the top 1000 SDEGs. We then used a spatial enrichment score to quantitatively evaluate the identified SDEGs. From the top 100 to top 1000, the SDEGs identified by TIST have significantly higher scores than SPARK (<xref rid="f0025" ref-type="fig">Figure 5</xref>B). To examine the identified genes with more detail, we visualized the expression patterns of the top 100 SDEGs by the two methods. Most SDEGs only identified by TIST showed strong spatial patterns (<xref rid="f0025" ref-type="fig">Figure 5</xref>C, <xref rid="s0135" ref-type="sec">Figure S7</xref>) as the 6 SDEGs identified by both methods (<xref rid="f0025" ref-type="fig">Figure 5</xref>D). However, many SDEGs only identified by SPARK seemed to be affected by data noises (<xref rid="f0025" ref-type="fig">Figure 5</xref>E, <xref rid="s0135" ref-type="sec">Figure S8</xref>). We further investigated the functional enrichments of the 94 exclusive SDEGs identified by TIST and SPARK, separately. Gene set analysis showed that the 94 SDEGs identified by TIST were significantly enriched in GO terms related to brain activities, but the 94 SDEGs of SPARK were enriched in non-related terms (<xref rid="s0135" ref-type="sec">Figure S9</xref>).<fig id="f0025"><label>Figure 5</label><caption><p><bold>Performance of TIST in facilitating SDEG detection</bold></p><p><bold>A.</bold> Venn diagram of the top 100, 500, and 1000 SDEGs identified by TIST and SPARK. <bold>B.</bold> Quantitative assessment of the top 100, 500, and 1000 SDEGs detected by TIST and SPARK. The yellow and blue dotted lines indicate average spatial enrichment scores of SPARK and TIST, respectively. <italic>P</italic> value is calculated by <italic>t</italic>-test. <bold>C.</bold> Spatial expression patterns of typical genes detected by TIST, but not by SPARK, in the top 100 SDEGs. <bold>D.</bold> Spatial expression patterns of typical genes commonly identified by both TIST and SPARK in the top 100 SDEGs. <bold>E.</bold> Spatial expression patterns of typical genes detected by SPARK, but not by TIST, in the top 100 SDEGs. Scattered spots with singularly high expression are marked with red boxes. SDEG, spatially differentially expressed gene.</p></caption><graphic xlink:href="gr5"/></fig></p>
      <p id="p0225">To further assess the reliability of gene enhancement, we additionally compared TIST with stLearn. Taking the mouse cerebral cortex sample as an example, we used the 49 marker genes related to brain activities for evaluation <xref rid="b0110" ref-type="bibr">[22]</xref> and simulated dropout events on this dataset setting DR from 0.1 to 0.7, followed by applying TIST and stLearn to it. Comparing the two, we observed that TIST reaches greater median recovery scores than stLearn when DR is less than or equal to 0.3, whereas the scores of stLearn generally have smaller variance among the 49 genes than TIST (<xref rid="s0135" ref-type="sec">Figure S10</xref>A). Setting DR as 0.5, we then divided these genes into two groups: genes on which stLearn achieves greater recovery scores than TIST (stLearn &gt; TIST) and the other genes on which TIST achieves better performance than stLearn (TIST &gt; stLearn). We found that TIST performed better on genes with higher expression levels, lower DRs, and stronger spatial enrichment patterns (<xref rid="s0135" ref-type="sec">Figure S10</xref>B). It suggests that TIST has higher precision and stLearn has higher sensitivity. As summary, TIST could resist technical noises and identify more biologically meaningful spatial expression patterns.</p>
    </sec>
    <sec id="s0100">
      <title>TIST benefits gene co-expression inference from ST data</title>
      <p id="p0230">It remains a great challenge to effectively incorporate spatial information from ST data and enable reliable detection of gene co-expression patterns in specific tissue regions. We show that TIST-identified SCs could facilitate the detection of region-specific gene co-expression patterns and shed light on complicated cell–cell communication in tissue.</p>
      <p id="p0235">The hippocampus formation in the mouse cerebral cortex dataset is split by TIST into three SCs, including principal cell layers in the hippocampus proper (SC_3), the dentate gyrus (SC_9), and the remaining part (SC_2). We first compared the gene co-expression strength within the three SCs. <xref rid="f0030" ref-type="fig">Figure 6</xref>A visualizes the Spearman correlation coefficients between any pair of genes in the top 2000 SDEGs found by TIST. Gene co-expression is significantly stronger in the dentate gyrus region (SC_9) than in the other two regions, suggesting that the dentate gyrus undergoes highly precise regulation of gene expression, which might account for its critical role in neurogenesis. We further investigated cell communication with CellChat <xref rid="b0150" ref-type="bibr">[30]</xref> to infer the strength of cell communication within and among the three SCs. <xref rid="f0030" ref-type="fig">Figure 6</xref>B shows significant ligand–receptor pairs within each SC, among which we marked cases supported by literature evidence with red underlines (Table S5). For instance, <italic>Wnt</italic> ligands binding to the combination of <italic>Fzd1/3</italic> and <italic>Lrp6</italic> co-receptors are reported to activate intracellular signaling and facilitate brain development as well as adult hippocampal neurogenesis <xref rid="b0155" ref-type="bibr">[31]</xref>, in line with the fact that the dentate gyrus region (SC_9), where neurogenesis takes place, enriches up to four related ligand–receptor pairs (marked with red box). <xref rid="f0030" ref-type="fig">Figure 6</xref>C visualizes significant ligand–receptor binding patterns among the three SCs. Specifically, the hippocampus proper (SC_3) communicates quite actively with the other two SCs, as the red color representing SC_3 takes up the highest proportion of ligand–receptor pairs in the outer ring. We further analyzed the communication between the three SCs and the other TIST SCs identified in the mouse cerebral cortex dataset. SC_3 maintained generally strong interactions with most SCs (<xref rid="f0030" ref-type="fig">Figure 6</xref>D). These observations echo the fact that the hippocampus properly contains hub neurons possessing widespread axonal arborizations <xref rid="b0160" ref-type="bibr">[32]</xref>.<fig id="f0030"><label>Figure 6</label><caption><p><bold>Spatial co-expression analysis based on TIST</bold></p><p><bold>A.</bold> Bar plot showing the co-expression strength represented by Spearman correlation coefficients within three SCs (SC_2, SC_3, and SC_9) composing the hippocampus formation. <bold>B.</bold> Bubble plot of ligand–receptor pairs enriched within each of the three SCs. The area of the bubble represents the <italic>P</italic> value, while the color shows the interaction strength. We underline the ligand–receptor pairs supported by literature evidence. <bold>C.</bold> Circos plot showing ligand–receptor pairs among SC_2, SC_3, and SC_9. Curved arrows indicate the ligand–receptor relationships. Genes detected to be specific in different SCs are listed outside the circle. <bold>D.</bold> Communication strength between the three SCs and the others. The thickness of the curve represents the communication strength between two SCs that the curve connects. Spot size represents the number of enriched ligand–receptor pairs.</p></caption><graphic xlink:href="gr6"/></fig></p>
    </sec>
    <sec id="s0105">
      <title>TIST adapts to diverse tissue types</title>
      <p id="p0240">In addition to the mouse cerebral cortex and the HCC samples, we tested TIST with 32 samples in total (Table S1), covering diverse tissue types and different pathological conditions, including 11 10x Genomics officially released samples (<xref rid="f0035" ref-type="fig">Figure 7</xref>, <xref rid="s0135" ref-type="sec">Figure S11</xref>) and 21 human primary liver cancer samples from our previous study <xref rid="b0105" ref-type="bibr">[21]</xref> (<xref rid="s0135" ref-type="sec">Figure S12</xref>). For the mouse brain sagittal anterior slide, TIST successfully detected the local structure olfactory area (OLF) in this tissue <xref rid="b0110" ref-type="bibr">[22]</xref>, and the enhanced gene expression patterns are consistent with the ISH data (<xref rid="f0035" ref-type="fig">Figure 7</xref>A and B). For another example of a human breast cancer slice, TIST found a small-size TLS next to a bigger one, IDC_3 region (circled by red dashed lines in <xref rid="f0035" ref-type="fig">Figure 7</xref>C), which was verified by a TLS score. Also, TIST refined the boundary between the Tumor_edge_3 and Tumor_edge_6 regions (circled by a yellow dashed line in <xref rid="f0035" ref-type="fig">Figure 7</xref>C). These results suggest that TIST is applicable to different tissue types.<fig id="f0035"><label>Figure 7</label><caption><p><bold>SC identification results of TIST on datasets with diverse sample types</bold></p><p><bold>A.</bold> SC identification results of TIST on a mouse brain sagittal anterior dataset from 10x Genomics. Histopathological image, manual annotation, and SC identification of TIST are shown from left to right. The tiny structure OLF is emphasized in the red box. <bold>B.</bold> Gene enhancement results of TIST of typical genes <italic>Doc2g</italic> and <italic>Gng4.</italic> Raw expression pattern, TIST-enhanced expression pattern, and reference ISH image are listed in order. <bold>C.</bold> SC identification results of TIST on a human breast cancer dataset from 10x Genomics. The upper panels show the histopathological image and manual annotation, respectively. Two TLS regions were circled by red dashed lines and a refined tumor region was circled by a yellow dashed line. The SCs identified by TIST are shown at the left bottom. The TLS scores are visualized at the right bottom. OLF, olfactory area; ISH, <italic>in situ</italic> hybridization.</p></caption><graphic xlink:href="gr7"/></fig></p>
    </sec>
  </sec>
  <sec id="s0110">
    <title>Discussion</title>
    <p id="p0245">We proposed TIST tailored toward SEQ-ST data by effectively integrating ST data and histopathological images via a network-based multimodal data fusion strategy. TIST unsupervisedly groups spots into SCs with coherent gene expression patterns, histopathological features, and biological functions, and enhances spatial expression signals from noisy ST data. The ablation experiments show that the three different data modalities provide complementary information, which has been successfully integrated by TIST. The features from histopathological images are helpful for identifying small structures by providing strong boundary penalties.</p>
    <p id="p0250">We reported that mRNA diffusion during the process of tissue permeabilization inevitably induces noise in ST data and blurs spatial expression patterns, which has not yet received enough attention. We demonstrated the severity of the diffusion noise and its interference in downstream ST analyses and showed that TIST could mitigate the technical noise by effectively integrating ST data and the matching histopathological images.</p>
    <p id="p0255">The rapid development of ST techniques has relieved some technical drawbacks, such as limited resolution, but many challenges remain to be solved <xref rid="b0165" ref-type="bibr">[33]</xref>. Ideally, we want to obtain the expression profiles of individual cells together with their locations. For SEQ-ST, each spot captures mRNAs from proximal cells in the tissue section covering the slide. It would be difficult to obtain the mapping relationship between spots and cells and accurately recover expression profiles at the single-cell level from spot-level ST data. As histopathological images are taken prior to ST sequencing, they are expected to capture the ground truth cell arrangement and help obtain ideal single-cell ST data. However, reliable SC annotation and standardized positional mapping between ST data and image are still in need among popular SEQ-ST techniques. By now only 10x Genomics could provide them at the same time, so we are also working to add an automatic alignment method to mapping ST data with histopathological images for other platforms such as Seq-Scope <xref rid="b0020" ref-type="bibr">[4]</xref> and Stereo-seq <xref rid="b0025" ref-type="bibr">[5]</xref>. Collectively, it may be possible to extend TIST to realize accurate single-cell ST analysis given that TIST provides an excellent multimodal feature extraction and data fusion method.</p>
  </sec>
  <sec id="s0115">
    <title>Code availability</title>
    <p id="p0260">The source code of TIST can be accessed at <ext-link ext-link-type="uri" xlink:href="https://ngdc.cncb.ac.cn/biocode/tools/BT007317" id="PC_link12l8ktpwvu">https://ngdc.cncb.ac.cn/biocode/tools/BT007317</ext-link> and <ext-link ext-link-type="uri" xlink:href="http://lifeome.net/software/tist/" id="PC_linkdmbBbqiIC9">http://lifeome.net/software/tist/</ext-link>.</p>
  </sec>
  <sec id="s0125">
    <title>CRediT author statement</title>
    <p id="p0270"><bold>Yiran Shan:</bold> Conceptualization, Methodology, Software, Validation, Formal analysis, Writing - original draft. <bold>Qian Zhang:</bold> Conceptualization, Investigation, Formal analysis, Writing - original draft. <bold>Wenbo Guo:</bold> Validation, Data curation. <bold>Yanhong Wu:</bold> Validation, Data curation. <bold>Yuxin Miao:</bold> Validation, Data curation. <bold>Hongyi Xin:</bold> Methodology, Supervision, Data curation. <bold>Qiuyu Lian:</bold> Conceptualization, Methodology, Supervision, Data curation, Writing - review &amp; editing. <bold>Jin Gu:</bold> Conceptualization, Methodology, Investigation, Supervision, Writing - original draft, Writing - review &amp; editing. All authors have read and approved the final manuscript.</p>
  </sec>
  <sec sec-type="COI-statement" id="s0120">
    <title>Competing interests</title>
    <p id="p0265">The authors have declared no competing interests.</p>
  </sec>
</body>
<back>
  <ref-list id="bi005">
    <title>References</title>
    <ref id="b0005">
      <label>1</label>
      <element-citation publication-type="journal" id="h0005">
        <person-group person-group-type="author">
          <name>
            <surname>Asp</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Bergenstråhle</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Lundeberg</surname>
            <given-names>J.</given-names>
          </name>
        </person-group>
        <article-title>Spatially resolved transcriptomes — next generation tools for tissue exploration</article-title>
        <source>Bioessays</source>
        <volume>42</volume>
        <year>2020</year>
        <fpage>e1900221</fpage>
        <pub-id pub-id-type="pmid">32363691</pub-id>
      </element-citation>
    </ref>
    <ref id="b0010">
      <label>2</label>
      <element-citation publication-type="journal" id="h0010">
        <person-group person-group-type="author">
          <name>
            <surname>Eng</surname>
            <given-names>C.H.L.</given-names>
          </name>
          <name>
            <surname>Lawson</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Dries</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Koulena</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Takei</surname>
            <given-names>Y.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transcriptome-scale super-resolved imaging in tissues by RNA seqFISH+</article-title>
        <source>Nature</source>
        <volume>568</volume>
        <year>2019</year>
        <fpage>235</fpage>
        <lpage>239</lpage>
        <pub-id pub-id-type="pmid">30911168</pub-id>
      </element-citation>
    </ref>
    <ref id="b0015">
      <label>3</label>
      <element-citation publication-type="journal" id="h0015">
        <person-group person-group-type="author">
          <name>
            <surname>Rodriques</surname>
            <given-names>S.G.</given-names>
          </name>
          <name>
            <surname>Stickels</surname>
            <given-names>R.R.</given-names>
          </name>
          <name>
            <surname>Goeva</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Martin</surname>
            <given-names>C.A.</given-names>
          </name>
          <name>
            <surname>Murray</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Vanderburg</surname>
            <given-names>C.R.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Slide-seq: a scalable technology for measuring genome-wide expression at high spatial resolution</article-title>
        <source>Science</source>
        <volume>363</volume>
        <year>2019</year>
        <fpage>1463</fpage>
        <lpage>1467</lpage>
        <pub-id pub-id-type="pmid">30923225</pub-id>
      </element-citation>
    </ref>
    <ref id="b0020">
      <label>4</label>
      <element-citation publication-type="journal" id="h0020">
        <person-group person-group-type="author">
          <name>
            <surname>Cho</surname>
            <given-names>C.S.</given-names>
          </name>
          <name>
            <surname>Xi</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Si</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Park</surname>
            <given-names>S.R.</given-names>
          </name>
          <name>
            <surname>Hsu</surname>
            <given-names>J.E.</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Microscopic examination of spatial transcriptome using Seq-Scope</article-title>
        <source>Cell</source>
        <volume>184</volume>
        <year>2021</year>
        <fpage>3559</fpage>
        <lpage>3572</lpage>
        <pub-id pub-id-type="pmid">34115981</pub-id>
      </element-citation>
    </ref>
    <ref id="b0025">
      <label>5</label>
      <element-citation publication-type="journal" id="h0025">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Liao</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Cheng</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Ma</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Lai</surname>
            <given-names>Y.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatiotemporal transcriptomic atlas of mouse organogenesis using DNA nanoball-patterned arrays</article-title>
        <source>Cell</source>
        <volume>185</volume>
        <year>2022</year>
        <fpage>1777</fpage>
        <lpage>1792</lpage>
        <pub-id pub-id-type="pmid">35512705</pub-id>
      </element-citation>
    </ref>
    <ref id="b0030">
      <label>6</label>
      <element-citation publication-type="journal" id="h0030">
        <person-group person-group-type="author">
          <name>
            <surname>Blondel</surname>
            <given-names>V.D.</given-names>
          </name>
          <name>
            <surname>Guillaume</surname>
            <given-names>J.L.</given-names>
          </name>
          <name>
            <surname>Lambiotte</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Lefebvre</surname>
            <given-names>E.</given-names>
          </name>
        </person-group>
        <article-title>Fast unfolding of communities in large networks</article-title>
        <source>J Stat Mech Theory Exp</source>
        <volume>2008</volume>
        <year>2008</year>
        <fpage>P10008</fpage>
      </element-citation>
    </ref>
    <ref id="b0035">
      <label>7</label>
      <element-citation publication-type="journal" id="h0035">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Hao</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Andersen-Nissen</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Mauck</surname>
            <given-names>W.M.</given-names>
            <suffix>3rd</suffix>
          </name>
          <name>
            <surname>Zheng</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Butler</surname>
            <given-names>A.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <volume>184</volume>
        <year>2021</year>
        <fpage>3573</fpage>
        <lpage>3587</lpage>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="b0040">
      <label>8</label>
      <element-citation publication-type="journal" id="h0040">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Stone</surname>
            <given-names>M.R.</given-names>
          </name>
          <name>
            <surname>Ren</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Guenthoer</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Smythe</surname>
            <given-names>K.S.</given-names>
          </name>
          <name>
            <surname>Pulliam</surname>
            <given-names>T.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>
        <source>Nat Biotechnol</source>
        <volume>39</volume>
        <year>2021</year>
        <fpage>1375</fpage>
        <lpage>1384</lpage>
        <pub-id pub-id-type="pmid">34083791</pub-id>
      </element-citation>
    </ref>
    <ref id="b0045">
      <label>9</label>
      <element-citation publication-type="journal" id="h0045">
        <person-group person-group-type="author">
          <name>
            <surname>Dong</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>Deciphering spatial domains from spatially resolved transcriptomics with an adaptive graph attention auto-encoder</article-title>
        <source>Nat Commun</source>
        <volume>13</volume>
        <year>2022</year>
        <fpage>1739</fpage>
        <pub-id pub-id-type="pmid">35365632</pub-id>
      </element-citation>
    </ref>
    <ref id="b0050">
      <label>10</label>
      <mixed-citation publication-type="other" id="h0050">Chen Y, Zhou S, Li M, Zhao F, Qi J. STEEL enables high-resolution delineation of spatiotemporal transcriptomic data. Research Square 2022. https://doi.org/10.21203/rs.3.rs-1240258/v1.</mixed-citation>
    </ref>
    <ref id="b0055">
      <label>11</label>
      <element-citation publication-type="journal" id="h0055">
        <person-group person-group-type="author">
          <name>
            <surname>Fu</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Chong</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Ang</surname>
            <given-names>KS</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>HK</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Unsupervised spatially embedded deep representation of spatial transcriptomics</article-title>
        <source>bioRxiv</source>
        <year>2021</year>
        <fpage>448542</fpage>
      </element-citation>
    </ref>
    <ref id="b0060">
      <label>12</label>
      <element-citation publication-type="journal" id="h0060">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>X.</given-names>
          </name>
        </person-group>
        <article-title>Statistical analysis of spatial expression patterns for spatially resolved transcriptomic studies</article-title>
        <source>Nat Methods</source>
        <volume>17</volume>
        <year>2020</year>
        <fpage>193</fpage>
        <lpage>200</lpage>
        <pub-id pub-id-type="pmid">31988518</pub-id>
      </element-citation>
    </ref>
    <ref id="b0065">
      <label>13</label>
      <element-citation publication-type="journal" id="h0065">
        <person-group person-group-type="author">
          <name>
            <surname>Pham</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Tan</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Grice</surname>
            <given-names>LF</given-names>
          </name>
          <name>
            <surname>Lam</surname>
            <given-names>PY</given-names>
          </name>
          <name>
            <surname>Raghubar</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>stLearn: integrating spatial location, tissue morphology and gene expression to find cell types, cell–cell interactions and spatial trajectories within undissociated tissues</article-title>
        <source>bioRxiv</source>
        <year>2020</year>
        <fpage>125658</fpage>
      </element-citation>
    </ref>
    <ref id="b0070">
      <label>14</label>
      <element-citation publication-type="journal" id="h0070">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X.J.</given-names>
          </name>
          <name>
            <surname>Coleman</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Schroeder</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Ma</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Irwin</surname>
            <given-names>D.J.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SpaGCN: integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>
        <source>Nat Methods</source>
        <volume>18</volume>
        <year>2021</year>
        <fpage>1342</fpage>
        <lpage>1351</lpage>
        <pub-id pub-id-type="pmid">34711970</pub-id>
      </element-citation>
    </ref>
    <ref id="b0075">
      <label>15</label>
      <element-citation publication-type="journal" id="h0075">
        <person-group person-group-type="author">
          <name>
            <surname>Cutiongco</surname>
            <given-names>M.F.A.</given-names>
          </name>
          <name>
            <surname>Jensen</surname>
            <given-names>B.S.</given-names>
          </name>
          <name>
            <surname>Reynolds</surname>
            <given-names>P.M.</given-names>
          </name>
          <name>
            <surname>Gadegaard</surname>
            <given-names>N.</given-names>
          </name>
        </person-group>
        <article-title>Predicting gene expression using morphological cell responses to nanotopography</article-title>
        <source>Nat Commun</source>
        <volume>11</volume>
        <year>2020</year>
        <fpage>1384</fpage>
        <pub-id pub-id-type="pmid">32170111</pub-id>
      </element-citation>
    </ref>
    <ref id="b0080">
      <label>16</label>
      <element-citation publication-type="journal" id="h0080">
        <person-group person-group-type="author">
          <name>
            <surname>Jarvis</surname>
            <given-names>R.A.</given-names>
          </name>
          <name>
            <surname>Patrick</surname>
            <given-names>E.A.</given-names>
          </name>
        </person-group>
        <article-title>Clustering using a similarity measure based on shared near neighbors</article-title>
        <source>IEEE Trans Comput</source>
        <volume>C-22</volume>
        <year>1973</year>
        <fpage>1025</fpage>
        <lpage>1034</lpage>
      </element-citation>
    </ref>
    <ref id="b0085">
      <label>17</label>
      <element-citation publication-type="journal" id="h0085">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>S.Z.</given-names>
          </name>
        </person-group>
        <article-title>Modeling image analysis problems using Markov random fields</article-title>
        <source>Handb Stat</source>
        <volume>21</volume>
        <year>2003</year>
        <fpage>473</fpage>
        <lpage>513</lpage>
      </element-citation>
    </ref>
    <ref id="b0090">
      <label>18</label>
      <element-citation publication-type="book" id="h0090">
        <person-group person-group-type="author">
          <name>
            <surname>Pons</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Latapy</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <part-title>Computing communities in large networks using random walks</part-title>
        <person-group person-group-type="editor">
          <name>
            <surname>Yolum</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Güngör</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Gürgen</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Özturan</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <source>Computer and Information Sciences - ISCIS 2005</source>
        <year>2005, p.284–93</year>
        <publisher-name>Springer</publisher-name>
        <publisher-loc>Berlin</publisher-loc>
      </element-citation>
    </ref>
    <ref id="b0095">
      <label>19</label>
      <element-citation publication-type="journal" id="h0095">
        <person-group person-group-type="author">
          <name>
            <surname>Venable</surname>
            <given-names>R.M.</given-names>
          </name>
          <name>
            <surname>Kramer</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Pastor</surname>
            <given-names>R.W.</given-names>
          </name>
        </person-group>
        <article-title>Molecular dynamics simulations of membrane permeability</article-title>
        <source>Chem Rev</source>
        <volume>119</volume>
        <year>2019</year>
        <fpage>5954</fpage>
        <lpage>5997</lpage>
        <pub-id pub-id-type="pmid">30747524</pub-id>
      </element-citation>
    </ref>
    <ref id="b0100">
      <label>20</label>
      <element-citation publication-type="journal" id="h0100">
        <person-group person-group-type="author">
          <name>
            <surname>Newman</surname>
            <given-names>M.E.J.</given-names>
          </name>
        </person-group>
        <article-title>Modularity and community structure in networks</article-title>
        <source>Proc Natl Acad Sci U S A</source>
        <volume>103</volume>
        <year>2006</year>
        <fpage>8577</fpage>
        <lpage>8582</lpage>
        <pub-id pub-id-type="pmid">16723398</pub-id>
      </element-citation>
    </ref>
    <ref id="b0105">
      <label>21</label>
      <element-citation publication-type="journal" id="h552201">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Guo</surname>
            <given-names>W.</given-names>
          </name>
          <name>
            <surname>Qiu</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Sui</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Lian</surname>
            <given-names>Q.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive analysis of spatial architecture in primary liver cancer</article-title>
        <source>Sci Adv</source>
        <volume>7</volume>
        <year>2021</year>
        <fpage>eabg3750</fpage>
        <pub-id pub-id-type="pmid">34919432</pub-id>
      </element-citation>
    </ref>
    <ref id="b0110">
      <label>22</label>
      <element-citation publication-type="journal" id="h0110">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Ding</surname>
            <given-names>S.L.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Royall</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Feng</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Lesnar</surname>
            <given-names>P.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The Allen Mouse Brain Common Coordinate Framework: a 3D reference atlas</article-title>
        <source>Cell</source>
        <volume>181</volume>
        <year>2020</year>
        <fpage>936</fpage>
        <lpage>953</lpage>
        <pub-id pub-id-type="pmid">32386544</pub-id>
      </element-citation>
    </ref>
    <ref id="b0115">
      <label>23</label>
      <element-citation publication-type="journal" id="h0115">
        <person-group person-group-type="author">
          <name>
            <surname>Zeidman</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Maguire</surname>
            <given-names>E.A.</given-names>
          </name>
        </person-group>
        <article-title>Anterior hippocampus: the anatomy of perception, imagination and episodic memory</article-title>
        <source>Nat Rev Neurosci</source>
        <volume>17</volume>
        <year>2016</year>
        <fpage>173</fpage>
        <lpage>182</lpage>
        <pub-id pub-id-type="pmid">26865022</pub-id>
      </element-citation>
    </ref>
    <ref id="b0120">
      <label>24</label>
      <element-citation publication-type="journal" id="h0120">
        <person-group person-group-type="author">
          <name>
            <surname>Strange</surname>
            <given-names>B.A.</given-names>
          </name>
          <name>
            <surname>Witter</surname>
            <given-names>M.P.</given-names>
          </name>
          <name>
            <surname>Lein</surname>
            <given-names>E.S.</given-names>
          </name>
          <name>
            <surname>Moser</surname>
            <given-names>E.I.</given-names>
          </name>
        </person-group>
        <article-title>Functional organization of the hippocampal longitudinal axis</article-title>
        <source>Nat Rev Neurosci</source>
        <volume>15</volume>
        <year>2014</year>
        <fpage>655</fpage>
        <lpage>669</lpage>
        <pub-id pub-id-type="pmid">25234264</pub-id>
      </element-citation>
    </ref>
    <ref id="b0125">
      <label>25</label>
      <element-citation publication-type="journal" id="h0125">
        <person-group person-group-type="author">
          <name>
            <surname>Helmink</surname>
            <given-names>B.A.</given-names>
          </name>
          <name>
            <surname>Reddy</surname>
            <given-names>S.M.</given-names>
          </name>
          <name>
            <surname>Gao</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Basar</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Thakur</surname>
            <given-names>R.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>B cells and tertiary lymphoid structures promote immunotherapy response</article-title>
        <source>Nature</source>
        <volume>577</volume>
        <year>2020</year>
        <fpage>549</fpage>
        <lpage>555</lpage>
        <pub-id pub-id-type="pmid">31942075</pub-id>
      </element-citation>
    </ref>
    <ref id="b0130">
      <label>26</label>
      <element-citation publication-type="journal" id="h0130">
        <person-group person-group-type="author">
          <name>
            <surname>Sautes-Fridman</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Petitprez</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Calderaro</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Fridman</surname>
            <given-names>W.H.</given-names>
          </name>
        </person-group>
        <article-title>Tertiary lymphoid structures in the era of cancer immunotherapy</article-title>
        <source>Nat Rev Cancer</source>
        <volume>19</volume>
        <year>2019</year>
        <fpage>307</fpage>
        <lpage>325</lpage>
        <pub-id pub-id-type="pmid">31092904</pub-id>
      </element-citation>
    </ref>
    <ref id="b0135">
      <label>27</label>
      <element-citation publication-type="journal" id="h0135">
        <person-group person-group-type="author">
          <name>
            <surname>Tokunaga</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Nakagawa</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Sakamoto</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Nakamura</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Naseem</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Izumi</surname>
            <given-names>D.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>12-chemokine signature, a predictor of tumor recurrence in colorectal cancer</article-title>
        <source>Int J Cancer</source>
        <volume>147</volume>
        <year>2020</year>
        <fpage>532</fpage>
        <lpage>541</lpage>
        <pub-id pub-id-type="pmid">32191346</pub-id>
      </element-citation>
    </ref>
    <ref id="b0140">
      <label>28</label>
      <element-citation publication-type="journal" id="h0140">
        <person-group person-group-type="author">
          <name>
            <surname>Galeano</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Rossetti</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Tomaselli</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Cifaldi</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Lezzerini</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Pezzullo</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ADAR2-editing activity inhibits glioblastoma growth through the modulation of the CDC14B/Skp2/p21/p27 axis</article-title>
        <source>Oncogene</source>
        <volume>32</volume>
        <year>2013</year>
        <fpage>998</fpage>
        <lpage>1009</lpage>
        <pub-id pub-id-type="pmid">22525274</pub-id>
      </element-citation>
    </ref>
    <ref id="b0145">
      <label>29</label>
      <element-citation publication-type="journal" id="h0145">
        <person-group person-group-type="author">
          <name>
            <surname>Zembrzycki</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Stocker</surname>
            <given-names>A.M.</given-names>
          </name>
          <name>
            <surname>Leingartner</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Sahara</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Chou</surname>
            <given-names>S.J.</given-names>
          </name>
          <name>
            <surname>Kalatsky</surname>
            <given-names>V.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genetic mechanisms control the linear scaling between related cortical primary and higher order sensory areas</article-title>
        <source>Elife</source>
        <volume>4</volume>
        <year>2015</year>
        <fpage>e11416</fpage>
        <pub-id pub-id-type="pmid">26705332</pub-id>
      </element-citation>
    </ref>
    <ref id="b0150">
      <label>30</label>
      <element-citation publication-type="journal" id="h0150">
        <person-group person-group-type="author">
          <name>
            <surname>Jin</surname>
            <given-names>S.Q.</given-names>
          </name>
          <name>
            <surname>Guerrero-Juarez</surname>
            <given-names>C.F.</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>L.H.</given-names>
          </name>
          <name>
            <surname>Chang</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Ramos</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Kuan</surname>
            <given-names>C.H.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Inference and analysis of cell–cell communication using Cell Chat</article-title>
        <source>Nat Commun</source>
        <volume>12</volume>
        <year>2021</year>
        <fpage>1088</fpage>
        <pub-id pub-id-type="pmid">33597522</pub-id>
      </element-citation>
    </ref>
    <ref id="b0155">
      <label>31</label>
      <element-citation publication-type="journal" id="h0155">
        <person-group person-group-type="author">
          <name>
            <surname>Arredondo</surname>
            <given-names>S.B.</given-names>
          </name>
          <name>
            <surname>Valenzuela-Bezanilla</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Mardones</surname>
            <given-names>M.D.</given-names>
          </name>
          <name>
            <surname>Varela-Nallar</surname>
            <given-names>L.</given-names>
          </name>
        </person-group>
        <article-title>Role of Wnt signaling in adult hippocampal neurogenesis in health and disease</article-title>
        <source>Front Cell Dev Biol</source>
        <volume>8</volume>
        <year>2020</year>
        <fpage>860</fpage>
        <pub-id pub-id-type="pmid">33042988</pub-id>
      </element-citation>
    </ref>
    <ref id="b0160">
      <label>32</label>
      <element-citation publication-type="journal" id="h0160">
        <person-group person-group-type="author">
          <name>
            <surname>Bonifazi</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Goldin</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Picardo</surname>
            <given-names>M.A.</given-names>
          </name>
          <name>
            <surname>Jorquera</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Cattani</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Bianconi</surname>
            <given-names>G.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>GABAergic hub neurons orchestrate synchrony in developing hippocampal networks</article-title>
        <source>Science</source>
        <volume>326</volume>
        <year>2009</year>
        <fpage>1419</fpage>
        <lpage>1424</lpage>
        <pub-id pub-id-type="pmid">19965761</pub-id>
      </element-citation>
    </ref>
    <ref id="b0165">
      <label>33</label>
      <element-citation publication-type="journal" id="h0165">
        <person-group person-group-type="author">
          <name>
            <surname>Rao</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Barkley</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Franca</surname>
            <given-names>G.S.</given-names>
          </name>
          <name>
            <surname>Yanai</surname>
            <given-names>I.</given-names>
          </name>
        </person-group>
        <article-title>Exploring tissue architecture using spatial transcriptomics</article-title>
        <source>Nature</source>
        <volume>596</volume>
        <year>2021</year>
        <fpage>211</fpage>
        <lpage>220</lpage>
        <pub-id pub-id-type="pmid">34381231</pub-id>
      </element-citation>
    </ref>
  </ref-list>
  <sec id="s0135" sec-type="supplementary-material">
    <title>Supplementary material</title>
    <p id="p0285">The following are the Supplementary data to this article:<supplementary-material content-type="local-data" id="m0085"><caption><title>Supplementary Figure S1</title><p><bold>Processing flow of TIST A.</bold> Typical TIST processing on histopathology image. For the original image, we first obtain the outer boundary outline and explore the whole image to obtain inner lines. Boundary and edge information is then obtained. We use MRF to label this image and implement TIST to further recognize SCs. <bold>B.</bold> TIST process on the histopathology image of human colorectal cancer (upper left), mouse kidney (upper right), mouse brain sagittal anterior (lower left), mouse brain sagittal posterior (lower right) datasets. MRF, Markov random field.</p></caption><media xlink:href="mmc1.pdf"/></supplementary-material></p>
    <p id="p0290">
      <supplementary-material content-type="local-data" id="m0080">
        <caption>
          <title>Supplementary Figure S2</title>
          <p><bold>Comparison of Louvain and TIST on the mouse cerebral cortex data A.</bold> Histopathological image from 10X Visium platform and detailed manual annotation for predominant structures of mouse cerebral cortex from Allen Mouse Brain Atlas. <bold>B.</bold> SC identification results of Louvain at the best performance resolution 0.3 displayed over the spatial locations (left) and UMAP-transformed 2D pane (right). <bold>C.</bold> SC identification results of TIST displayed over the spatial locations (left) and the UMAP-transformed 2D pane (right). <bold>D.</bold> SC identification of Louvain with resolution adjusted in the range 0.1 to 2.0. The number of SCs is shown in the figure, while the clustering effect quantified by ARI is also shown. UMAP, uniform manifold approximation and projection; 2D, 2 dimensional.</p>
        </caption>
        <media xlink:href="mmc2.pdf"/>
      </supplementary-material>
    </p>
    <p id="p0295">
      <supplementary-material content-type="local-data" id="m0075">
        <caption>
          <title>Supplementary Figure S3</title>
          <p><bold>Ablation experiment of TIST</bold> Each component of TIST-net (three networks of histopathological information, transcriptomic information, and physical information) is removed once time, and TIST is then utilized on the mouse cerebral cortex dataset. Identification accuracy metrics of ARI and NMI are listed.</p>
        </caption>
        <media xlink:href="mmc3.pdf"/>
      </supplementary-material>
    </p>
    <p id="p0300">
      <supplementary-material content-type="local-data" id="m0070">
        <caption>
          <title>Supplementary Figure S4</title>
          <p><bold>Supplementary results of diffusion simulation of TIST A.</bold> Test of TIST gene enhancement for <italic>Adarb1</italic> when diffusion rate <italic>φ</italic> is from 0.1 to 0.9 excluding exhibited in Figure 3C, respectively. <bold>B.</bold> Spatial expression patterns of the specific marker genes <italic>Ramp3, Enpp2, Klk8, Hpca, Cabp7,</italic> and <italic>Hap1</italic> when setting the diffusion rate <italic>φ</italic> as 0.5.</p>
        </caption>
        <media xlink:href="mmc4.pdf"/>
      </supplementary-material>
    </p>
    <p id="p0305">
      <supplementary-material content-type="local-data" id="m0065">
        <caption>
          <title>Supplementary Figure S5</title>
          <p><bold>Expression patterns of typical marker genes and comparison between TIST and Louvain in diffusion simulation A.</bold> Raw expression, TIST-enhanced expression pattern, ISH data, as well as IF data of the five marker genes <italic>Adrab1, Ramp3, Enpp2, Klk8,</italic> and <italic>Hpca</italic> are displayed. And typical patterns are emphasized in red boxes. <bold>B.</bold> SC identification test of Louvain (upper panel) and TIST (lower panel) for Ammon’s horn and dentate gyrus when diffusion rate <italic>φ</italic> is 0.2, 0.4, 0.6, 0.7, and 0.8. <bold>C.</bold> Comparison in the unsupervised modularity score Q to test clustering stability with diffusion rates between Louvain (blue line) and TIST (red line). Here, the X-axis shows the diffusion rate, and the Y-axis represents the classification accuracy. IF, immunofluorescence.</p>
        </caption>
        <media xlink:href="mmc5.pdf"/>
      </supplementary-material>
    </p>
    <p id="p0310">
      <supplementary-material content-type="local-data" id="m0060">
        <caption>
          <title>Supplementary Figure S6</title>
          <p><bold>Supplementary results of dropout simulation of TIST A.</bold> Recovery effects of TIST for four specific marker genes <italic>Ramp3, Enpp2, Klk8,</italic> and <italic>Adrab1</italic> as the DR increases from 0.1 to 0.8. <bold>B.</bold> Comparison of the unsupervised modularity score Q to test clustering stability with DRs between Louvain (blue line) and TIST (red line). Here, the X-axis shows the DR, and the Y-axis represents the modularity score Q.</p>
        </caption>
        <media xlink:href="mmc6.pdf"/>
      </supplementary-material>
    </p>
    <p id="p0315">
      <supplementary-material content-type="local-data" id="m0055">
        <caption>
          <title>Supplementary Figure S7</title>
          <p>
            <bold>Expression pattern</bold>
            <bold>s</bold>
            <bold>of top 100 SDEGs identified by TIST</bold>
          </p>
        </caption>
        <media xlink:href="mmc7.pdf"/>
      </supplementary-material>
    </p>
    <p id="p0320">
      <supplementary-material content-type="local-data" id="m0050">
        <caption>
          <title>Supplementary Figure S8</title>
          <p>
            <bold>Expression pattern</bold>
            <bold>s</bold>
            <bold>of top 100 SDEGs identified by SPARK</bold>
          </p>
        </caption>
        <media xlink:href="mmc8.pdf"/>
      </supplementary-material>
    </p>
    <p id="p0325">
      <supplementary-material content-type="local-data" id="m0045">
        <caption>
          <title>Supplementary Figure S9</title>
          <p><bold>GO analysis of SDEGs detected by TIST and SPARK</bold> Here, the X-axis represents the gene ratio, and the Y-axis represents GO terms in the categories BP (upper), CC (middle), MF (lower). The size of the bubble represents the number of enriched genes, and the colour represents the confidence level. GO, Gene Ontology; BP, biological process; CC, cellular component; MF, molecular function.</p>
        </caption>
        <media xlink:href="mmc9.pdf"/>
      </supplementary-material>
    </p>
    <p id="p0330">
      <supplementary-material content-type="local-data" id="m0040">
        <caption>
          <title>Supplementary Figure S10</title>
          <p><bold>Comparison between TIST and stLearn on reliability of SDEGs A.</bold> Gene recovery scores of TIST (left) and stLearn (right). The 49 marker genes related to brain activities are used. <bold>B.</bold> Comparison of DRs (left) and spatial expression pattern (right) between stLearn &gt; TIST genes (stLearn achieves greater recovery score than TIST) and TIST &gt; stLearn genes (TIST achieves greater recovery score than stLearn). <italic>P</italic> value is calculated by <italic>t</italic> test.</p>
        </caption>
        <media xlink:href="mmc10.pdf"/>
      </supplementary-material>
    </p>
    <p id="p0335">
      <supplementary-material content-type="local-data" id="m0035">
        <caption>
          <title>Supplementary Figure S11</title>
          <p><bold>Benchmarking results of TIST on 8 public available datasets</bold> SC identification results of TIST on public datasets from 10X. Each black box corresponds to one dataset. Figures on the left side within the boxes show the histopathological images. The right figures within the boxes show the automatic SC identification results of TIST</p>
        </caption>
        <media xlink:href="mmc11.pdf"/>
      </supplementary-material>
    </p>
    <p id="p0340">
      <supplementary-material content-type="local-data" id="m0030">
        <caption>
          <title>Supplementary Figure S12</title>
          <p><bold>Benchmarking results of TIST on 20 human liver datasets of 10X</bold> Each black box corresponds to a sample. The figures on the left side in the box show the results of the effective region and boundary outline of histopathological images. The right figures in the box show the SC identification results of TIST under the optimal parameter selection. The names of the samples are listed at the bottom of each box.</p>
        </caption>
        <media xlink:href="mmc12.pdf"/>
      </supplementary-material>
    </p>
    <p id="p0345">
      <supplementary-material content-type="local-data" id="m0025">
        <caption>
          <title>Supplementary Table S1</title>
          <p>
            <bold>Summary of all datasets utilized in this work</bold>
          </p>
        </caption>
        <media xlink:href="mmc13.docx"/>
      </supplementary-material>
    </p>
    <p id="p0350">
      <supplementary-material content-type="local-data" id="m0020">
        <caption>
          <title>Supplementary Table S2</title>
          <p>
            <bold>Region names in the mouse cerebral cortex from the reference atlas diagram from Allen Institute for Brain Science</bold>
          </p>
        </caption>
        <media xlink:href="mmc14.docx"/>
      </supplementary-material>
    </p>
    <p id="p0355">
      <supplementary-material content-type="local-data" id="m0015">
        <caption>
          <title>Supplementary Table S3</title>
          <p>
            <bold>Comparison among TIST and state-of-the-art SC identification methods</bold>
          </p>
        </caption>
        <media xlink:href="mmc15.docx"/>
      </supplementary-material>
    </p>
    <p id="p0360">
      <supplementary-material content-type="local-data" id="m0010">
        <caption>
          <title>Supplementary Table S4</title>
          <p>
            <bold>Recovery results of the 49 genes used for evaluation in Figure 4C</bold>
          </p>
        </caption>
        <media xlink:href="mmc16.docx"/>
      </supplementary-material>
    </p>
    <p id="p0365">
      <supplementary-material content-type="local-data" id="m0005">
        <caption>
          <title>Supplementary Table S5</title>
          <p>
            <bold>Previously published evidence of significant ligand-receptor pairs marked in Figure 6B</bold>
          </p>
        </caption>
        <media xlink:href="mmc17.docx"/>
      </supplementary-material>
    </p>
  </sec>
  <ack id="ak005">
    <title>Acknowledgments</title>
    <p id="p0275">This work was supported by the National Key R&amp;D Program of China (Grant Nos. 2020YFA0712403 and 2021YFF1200901), the National Natural Science Foundation of China (Grant Nos. 61922047, 81890993, 61721003, and 62133006), the Beijing National Research Centre for Information Science and Technology Young Innovation Fund, China (Grant No. BNR2020RC01009), and the Science and Technology Commission of Shanghai Municipality, China (Grant No. 20PJ1408300).</p>
  </ack>
  <fn-group>
    <fn id="d35e262">
      <p id="np005">Peer review under responsibility of Beijing Institute of Genomics, Chinese Academy of Sciences / China National Center for Bioinformation and Genetics Society of China.</p>
    </fn>
    <fn id="s0130" fn-type="supplementary-material">
      <p id="p0280">Supplementary data to this article can be found online at https://doi.org/10.1016/j.gpb.2022.11.012.</p>
    </fn>
  </fn-group>
</back>
