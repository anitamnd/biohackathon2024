<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7658988</article-id>
    <article-id pub-id-type="publisher-id">19542</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-020-19542-x</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Interactive analysis of single-cell epigenomic landscapes with ChromSCape</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-4375-7583</contrib-id>
        <name>
          <surname>Prompsy</surname>
          <given-names>Pacôme</given-names>
        </name>
        <address>
          <email>pacome.prompsy@curie.fr</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kirchmeier</surname>
          <given-names>Pia</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-8464-9306</contrib-id>
        <name>
          <surname>Marsolier</surname>
          <given-names>Justine</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-6352-101X</contrib-id>
        <name>
          <surname>Deloger</surname>
          <given-names>Marc</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1678-7410</contrib-id>
        <name>
          <surname>Servant</surname>
          <given-names>Nicolas</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1601-2359</contrib-id>
        <name>
          <surname>Vallot</surname>
          <given-names>Céline</given-names>
        </name>
        <address>
          <email>celine.vallot@curie.fr</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.462584.9</institution-id><institution-id institution-id-type="ISNI">0000 0004 0367 1475</institution-id><institution>CNRS UMR3244, Institut Curie, PSL Research University, </institution></institution-wrap>26 rue d’Ulm, 75005 Paris, France </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.418596.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 0639 6384</institution-id><institution>Translational Research Department, Institut Curie, PSL Research University, </institution></institution-wrap>26 rue d’Ulm, 75005 Paris, France </aff>
      <aff id="Aff3"><label>3</label>INSERM U900, Institut Curie, PSL Research University, Mines ParisTech, 26 rue d’Ulm, 75005 Paris, France </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>11</day>
      <month>11</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>11</day>
      <month>11</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2020</year>
    </pub-date>
    <volume>11</volume>
    <elocation-id>5702</elocation-id>
    <history>
      <date date-type="received">
        <day>14</day>
        <month>2</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>21</day>
        <month>10</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2020</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Chromatin modifications orchestrate the dynamic regulation of gene expression during development and in disease. Bulk approaches have characterized the wide repertoire of histone modifications across cell types, detailing their role in shaping cell identity. However, these population-based methods do not capture cell-to-cell heterogeneity of chromatin landscapes, limiting our appreciation of the role of chromatin in dynamic biological processes. Recent technological developments enable the mapping of histone marks at single-cell resolution, opening up perspectives to characterize the heterogeneity of chromatin marks in complex biological systems over time. Yet, existing tools used to analyze bulk histone modifications profiles are not fit for the low coverage and sparsity of single-cell epigenomic datasets. Here, we present ChromSCape, a user-friendly interactive Shiny/R application distributed as a Bioconductor package, that processes single-cell epigenomic data to assist the biological interpretation of chromatin landscapes within cell populations. ChromSCape analyses the distribution of repressive and active histone modifications as well as chromatin accessibility landscapes from single-cell datasets. Using ChromSCape, we deconvolve chromatin landscapes within the tumor micro-environment, identifying distinct H3K27me3 landscapes associated with cell identity and breast tumor subtype.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Bulk approaches fail to capture the cell-to-cell heterogeneity of chromatin landscapes, while single-cell approaches provide low coverage datasets. Here, the authors present ChromSCape, a user-friendly interactive application that processes single-cell epigenomic data to assist the biological interpretation of chromatin landscapes within cell populations, as demonstrated in the context of cancer.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Breast cancer</kwd>
      <kwd>Computational biology and bioinformatics</kwd>
      <kwd>Data mining</kwd>
      <kwd>Gene regulation</kwd>
      <kwd>Histone post-translational modifications</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>ATIP-Avenir, SiRIC</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2020</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Histone modifications are key regulators of gene expression, driving chromatin folding, and gene accessibility to transcription machineries. The recent development of single-cell methods to study epigenomes now enables the appreciation of the heterogeneity of chromatin modifications within a population. These experimental methods assess the distribution of histone marks at single-cell resolution by coupling next-generation sequencing to high-throughput microfluidics DNA barcoding (scChIP-seq)<sup><xref ref-type="bibr" rid="CR1">1</xref>,<xref ref-type="bibr" rid="CR2">2</xref></sup> or in situ reactions (scChIL-seq<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>, scChIC-seq<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, scCUT&amp;Tag<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>). In contrast to scATAC-seq approaches that identify open regions of the chromatin<sup><xref ref-type="bibr" rid="CR6">6</xref>–<xref ref-type="bibr" rid="CR8">8</xref></sup>, these methods can capture various chromatin states, enriched in repressive or active histone marks (H3K27me3 or H3K4me3 for example). Using these approaches, we can study the heterogeneity of epigenomes within complex biological samples, such as tumors<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>, and start appreciating the role of epigenomic diversity and the dynamics of chromatin in disease and development.</p>
    <p id="Par4">Existing tools used to analyze bulk ChIP-seq experiments are not fit for the low coverage and sparsity of these single-cell histone modifications datasets, which is due to the inherent low number of copy of DNA molecules per cell—maximum two for a diploid genome. Several computational methods for the analysis of scATAC-seq have been developed to deal with the specificities of single-cell DNA-based datasets. They were recently benchmarked<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, with SnapATAC<sup><xref ref-type="bibr" rid="CR10">10</xref></sup>, CisTopic<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>, and Cusanovich2018<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> being the top-three performing methods. These tools, initially dedicated to scATAC-seq and without graphic interface, require some scripting skills. Biologists with limited computational training can manipulate and analyze scRNA-seq and scATAC-seq datasets using applications such as “scOrange”<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> and ‘“SCRAT”<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>.</p>
    <p id="Par5">Here we present ChromSCape (Fig. <xref rid="Fig1" ref-type="fig">1</xref>), a user-friendly, step-by-step and customizable Shiny/R application to analyze all types of sparse single-cell epigenomic datasets, distributed as a Bioconductor package. The user can interactively identify subpopulations with common epigenomes within heterogeneous samples, find differentially enriched regions between subpopulations and interpret epigenomes by linking regions to associated genes and pathways. The pipeline starts from aligned sequences or count tables, and is designed for high-throughput single-cell datasets with samples containing as low as 100 cells with a minimum of 1000 reads per cell up to 25,000 cells on a standard laptop. ChromSCape accepts multiple samples to allow comparisons of cell populations between and within samples. It can determine cell identities from single-cell histone modification profiles, whatever the technology, as well as scATAC-seq datasets. We showcase the use of ChromSCape by deconvolving chromatin landscapes within the tumor micro-environment; we identify distinct H3K27me3 landscapes associated with cell identity and breast tumor subtype.<fig id="Fig1"><label>Fig. 1</label><caption><title>Representation of ChromSCape workflow.</title><p>Users upload single-cell epigenomic data formatted as count matrices, single-cell BAM or single-cell BED files to start the analysis. The application includes Quality Control (QC), Classification and Interpretation tools. The user can save plots and tables in png, pdf, or csv formats, and R analysis objects in RData format.</p></caption><graphic xlink:href="41467_2020_19542_Fig1_HTML" id="d30e352"/></fig></p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>ChromSCape identifies cell identities from scChIP-seq data</title>
      <p id="Par6">To test the efficiency of ChromSCape (Fig. <xref rid="Fig1" ref-type="fig">1</xref>) in identifying cell sub-populations based on their epigenome (H3K27me3), we generated an in-silico dataset with known ground truth, mixing 4 different human cell types: Jurkat B cells, Ramos T cells, MDA-MB-468 breast cancer cells and HBCx-22 tumor cells derived from a luminal breast tumor PDX model<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. Interestingly, Jurkat and Ramos cells were processed within the same microfluidics experiment, preventing the existence of any batch effect between them (see Grosselin et al.<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>). We compared ChromSCape to methods specifically designed for single-cell epigenomic datasets (scATAC-seq) for their ability to identify cell identities. Based on a recent scATAC-seq benchmark<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, we selected the top-performing methods, namely <italic>Cusanovich2018</italic><sup><xref ref-type="bibr" rid="CR12">12</xref></sup>, SnapATAC<sup><xref ref-type="bibr" rid="CR10">10</xref></sup>, and CisTopic<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>. We also benchmarked EpiScanpy<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>, a recent analysis pipeline for various single-cell epigenomic data (scATAC-seq, scDNA methylation, …) developed in Python. We applied hierarchical clustering on the reduced feature space obtained by each method and used an ARI metric to evaluate their ability to identify cell phenotypes. ChromSCape with default parameters manages to separate almost perfectly the 4 cell types, with an ARI of 0.998 (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>), as <italic>Cusanovich2018</italic> and CisTopic (both an ARI of 0.996, Fig. <xref rid="Fig2" ref-type="fig">2b</xref>), followed closely by EpiScanpy (ARI of 0.940, Fig. <xref rid="Fig2" ref-type="fig">2b</xref>). ChromSCape, EpiScanpy, and SnapATAC were all run on 50 kbp bins, but SnapATAC had noisier clusters and a slightly poorer ARI (0.822).<fig id="Fig2"><label>Fig. 2</label><caption><title>Benchmarking single-cell epigenomic tools with an in-silico mix of H3K27me3 scChIP-seq.</title><p>The mix is composed of human cells from an untreated PDX (HBCx-22), human T cells (Jurkat), and B cells (Ramos) taken from<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> and from a TNBC cell line (MDA-MB-468). (<bold>a</bold>) UMAP plots obtained with ChromSCape colored according to cluster and sample of origin. Adjusted Random Indexes (ARI) are indicated above the plot. (<bold>b</bold>) UMAP plots colored according to cluster and sample of origin with other single-cell epigenomic analysis methods: <italic>Cusanovich2018</italic>, SnapATAC, CisTopic, and EpiScanpy. Adjusted Random Indexes (ARI) are indicated above the plots. (<bold>c</bold>) Snapshots from scOrange and SCRAT applications. PCA and t-SNE representations from scOrange and SCRAT respectively, using default parameters or after manually optimizing parameters.</p></caption><graphic xlink:href="41467_2020_19542_Fig2_HTML" id="d30e434"/></fig></p>
      <p id="Par7">We also compared the agility of ChromSCape to manipulate and interpret scChIP-seq datasets to two applications with graphic interface, using the same reference dataset (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>), with either default settings or optimizing input and settings. scOrange is a stand-alone platform allowing researchers to create workflows to analyze single-cell datasets, offering a wide variety of analytical modules. While for scRNA-seq many workflows have been developed and are ready-to-use, in the case of epigenomic datasets, users need to have prior computational knowledge to organize a proper workflow. We managed to group cells according to sample of origin only with an optimized workflow (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, default vs optimized). SCRAT is a Shiny/R package presented as a user interface to analyze single-cell epigenomic data. The default option for SCRAT is to count reads within ‘ENCODE Clusters’ corresponding to co-regulatory open chromatin regions obtained from DNAse-seq datasets, not adapted for the analysis of repressive histone marks like H3K27me3. In order to use SCRAT for our reference scChIP-seq datasets, we had to pre-compute counts on pre-defined peaks called on the ‘pseudo-bulk’ (see Methods and ‘Optimized’ panel), limiting the usability of SCRAT. In addition, in contrast to ChromSCape, both applications do not propose functionalities to associate genomic regions to gene annotation, limiting the biological interpretation of the results obtained with differential analysis.</p>
      <p id="Par8">Like single-cell transcriptomics approaches, single-cell epigenomic technologies can be influenced by various batch effects, e.g., library preparation, batch of hydrogel beads or efficacy of immuno-precipitation or cleavage. To overcome this, we have implemented in ChromSCape a module for batch correction based on the fastMNN method<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. To test this functionality, we used three datasets: two from our previous study (HBCx-95 and HBCx95-CapaR, collected with batch 1 beads) and a new dataset, HBCx95—batch 2, which is a biological replicate of HBCx-95, i.e a PDX tumor from the same PDX model but a different mouse, processed with a new batch of beads. Using ChromSCape, we analyzed together the three H3K27me3 tumor samples. As shown in Supplementary Fig. <xref rid="MOESM1" ref-type="media">2a</xref> strong batch effect separates the two biological replicates before batch correction (left panel). After applying batch correction (right panel), cells from the two biological replicates of untreated HBCx-95 tumors successfully mix, but not with cells from the resistant tumor, suggesting that the module corrects for batch effect without overcorrecting biological differences.</p>
      <p id="Par9">We also evaluated the usability of ChromSCape for other types of single-cell histone modification data obtained by other technologies than scChIP-seq. We analyzed two public datasets of scCUT&amp;Tag and scChIC-seq targeting H3K27me3 and H3K4me3 marks respectively. ChromSCape facilitates the analysis of such public dataset as the user can directly upload the GEO single-cell BED files into the application. We recommend here for H3K27me3 mark—accumulating in broad peaks—to aggregate the signal into 50kbp bins, and for H3K4me3 mark—accumulating in sharp peaks—to count within 5kbp bins or around gene TSS (±2500bp). As shown in Supplementary Fig. <xref rid="MOESM1" ref-type="media">1a</xref>, for the scCUT&amp;Tag dataset the two K562 replicates showed no batch effect and were clustered together separately from H1 cells (ARI = 0.976). For the scChIC-seq dataset (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1b</xref>), 7 clusters are clearly observable on the UMAP representation, as was found by the authors in their study<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>.</p>
    </sec>
    <sec id="Sec4">
      <title>ChromSCape classifies cells from scATAC-seq data</title>
      <p id="Par10">In order to assess the capacity of ChromSCape to analyze all types of single-cell epigenomic data, we re-analyzed a scATAC-seq dataset (GSE99172) containing 8 cell lines and 4 patient-derived cells. This dataset was partly produced and analyzed in a study using chromVar, a dedicated scATAC-seq analytical tool<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>; we used the same color code as in the original study. This dataset contains various biological samples as well as technical replicates for two cell lines, K562 &amp; GM12878, for which there are 6 and 4 technical replicates respectively. Due to a relatively low number of cells per sample (<italic>n</italic> = 96 per sample), we set the read count threshold to 1000 for cells to be included in the analysis. We measured the ability of ChromSCape to classify cells according to the cell type of origin using assignment scores for each sample <italic>X</italic> and each cluster <italic>Y</italic> (<italic>number of cells from sample X assigned to cluster Y</italic>/<italic>total number of cells of sample X</italic>).</p>
      <p id="Par11">In the unsupervised analysis, we identified the optimal number of clusters to be <italic>k</italic> = 5 according to the relative change in area under the CDF curve (Fig. <xref rid="Fig3" ref-type="fig">3a</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a</xref>). Cells from different technical replicates of K562 and GM12878 all grouped together in clusters 5 and 2 with assignment scores of 99.7% and 98.3%, respectively (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>). Analyzing all samples together, ChromSCape could robustly identify—i.e., as stable separated clusters by consensus clustering—TF1, K562, and GM12878 cells, affecting on average 99.4% of cells to correct cluster. Cluster C1 grouped together AML, Mono, and LMPP samples with HL60 cell line, which is also originally derived from leukocytes of a patient with an AML cancer.<fig id="Fig3"><label>Fig. 3</label><caption><title>ChromSCape identifies immune cell populations from scATAC-seq datasets.</title><p>(<bold>a</bold>) t-SNE representations after correlation filtering (<italic>n</italic> = 1309 cells), points are colored according to sample of origin (left) or ChromSCape-determined clusters (<italic>k</italic> = 5) (right). The GM12878 and K562 samples contained respectively 4 and 6 replicates. (<bold>b</bold>) Assignment scores for each sample/cluster pair for the analysis with all samples. (<bold>c</bold>, <bold>d</bold>) As in (<bold>a</bold>) and (<bold>b</bold>) for the analysis with only AML, LSC, monocyte, LMPP &amp; HL60 cells (<italic>n</italic> = 347 cells).</p></caption><graphic xlink:href="41467_2020_19542_Fig3_HTML" id="d30e541"/></fig></p>
      <p id="Par12">In order to get more insight into cell identities within cluster C1, we re-analyzed cells from C1 with ChromSCape. In contrast to the first round of analysis, ChromSCape was able to distinguish cell identities within samples, and detect individual clusters of cells, with high assignment scores for the two normal samples (LMPP &amp; Monocytes) and HL-60 (average assignment score 98.3%, Fig. <xref rid="Fig3" ref-type="fig">3c, d</xref>). Additionally, AML blasts from patient SU070 show a larger proportion of monocytes than patient SU353 (Fig. <xref rid="Fig3" ref-type="fig">3d</xref>, <italic>p</italic>-value = 0.0025, Fisher’s exact test, respectively 85.0% and 25.7% of SU070 and SU353 blasts cells cluster with monocytes), as previously described for these cells in<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. ChromSCape identifies distinct populations within the normal immune cell environment based on their chromatin accessibility. Within AML patient samples, ChromSCape matches each cancer cell to the closest resembling cell in a healthy population.</p>
    </sec>
    <sec id="Sec5">
      <title>ChromSCape deconvolves epigenomes of the tumor micro-environment</title>
      <p id="Par13">To further showcase the use of ChromSCape, we interrogated the heterogeneity of chromatin states within the tumor micro-environment of two breast tumor subtypes: luminal and triple-negative (TNBC) breast tumors. The tumor micro-environment is a key player in tumor evolution processes, and can vary between tumor types and with the response to cancer therapy. Here our goal was to compare H3K27me3 landscapes of cells from the tumor micro-environment of luminal and TNBC subtypes, resistant or not to cancer treatment. The HBCx-22 and HBCx-22-TamR datasets correspond to mouse cells from a pair of luminal ER<sup>+</sup> breast PDXs<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>: HBCx-22, responsive to Tamoxifen and HBCx-22-TamR, resistant to Tamoxifen. The HBCx-95 and HBCx-95-CapaR correspond to triple-negative breast cancer (TNBC) tumor model of acquired resistance to chemotherapy<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. We analyzed together these four H3K27me3 mouse scChIP-seq datasets, two of which had not been analyzed in our previous study<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. Using ChromSCape, we propose a comprehensive view of cell populations based on their chromatin profiles, and show the identification of tumor-type and treatment-specific cell populations and respective chromatin features. All plots in Fig. <xref rid="Fig4" ref-type="fig">4</xref> were automatically generated by the application and are downloadable from the interface. In the quality filtering step, a threshold of 2000 reads per cell was set due to a relatively high initial number of cells (<italic>n</italic> = 5516 cells).<fig id="Fig4"><label>Fig. 4</label><caption><title>ChromSCape deconvolves epigenomic landscapes within the tumor micro-environment.</title><p>Cells belonging to samples HBCx-22, HBCx-22-TamR, HBCx-95, HBCx-95-CapaR PDX<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. PCA and t-SNE plots are colored according to the amount of uniquely mapped reads per cell (<bold>a</bold>) and to sample of origin (<bold>b</bold>). (<bold>c</bold>) t-SNE representations after correlation filtering (<italic>n</italic> = 903 cells), colored by cluster or sample of origin. (<bold>d</bold>) Hierarchical clustering and corresponding heatmap of cell-to-cell consensus clustering scores cells portioning the dataset into <italic>k</italic> = 4 clusters. Consensus score ranges from 0 (white: never clustered together) to 1 (dark blue: always clustered together). Cluster membership is color-coded above the heatmap. (<bold>e</bold>) Table of cluster memberships. <italic>P</italic>-value column results from Pearson’s Chi-squared goodness of fit test without correction, checking if the observed distribution of samples in each cluster differs from a random distribution. Source data are provided as a Source Data file. (<bold>f</bold>) t-SNE representation of scChIP-seq datasets, points are colored according to H3K27me3 enrichment signals in each cell for genes located within depleted regions in C1 to C4, respectively <italic>Eln</italic>, <italic>Bcar1</italic>, <italic>Nrros,</italic> and <italic>Rap1gap2</italic>. The adjusted <italic>p</italic>-values and log2FC of the associated regions are indicated above each plot. (<bold>g</bold>) Barplot of differentially enriched regions identified by Wilcoxon signed-rank test. Genomic regions were considered enriched (red) or depleted (green) in H3K27me3 if the adjusted <italic>p</italic>-values were lower than 0.01 and the absolute fold change greater than 1. (<bold>h</bold>) Barplot displaying the -log10 of adjusted <italic>p</italic>-values from pathway analysis for cells of cluster C2 compared to all other cells in depleted loci. Only the top 15 significant gene sets, ranked by adjusted <italic>p</italic>-values, are indicated.</p></caption><graphic xlink:href="41467_2020_19542_Fig4_HTML" id="d30e658"/></fig></p>
      <p id="Par14">After the dimensionality reduction step (Fig. <xref rid="Fig4" ref-type="fig">4a, b</xref>), we applied our consensus clustering approach on the filtered dataset with <italic>k</italic> = 2 to <italic>k</italic> = 10 clusters. We chose to partition the data into <italic>k</italic> = 4 clusters based on the knee method, as a plateau in the relative change in area under the CDF curve was observed between <italic>k</italic> = 4 and <italic>k</italic> = 5 clusters (Fig. <xref rid="Fig4" ref-type="fig">4c, d</xref> &amp; Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a, b</xref>). Consensus score matrix in Fig. <xref rid="Fig4" ref-type="fig">4d</xref> shows that most of the cells were stably assigned to four chromatin-based populations (mean consensus score for selected clusters of 0.91 which is significantly higher than mean consensus score for other clusters, 0.17, <italic>p</italic>-value = 2.2e-16, two-sided Student’s <italic>t</italic>-test). Assignment of cells to cluster C2 and C4 is significantly less stable than C1 and C3 (<italic>p</italic>-value &lt; 2.2e-16, Student’s two-sided <italic>t</italic>-test, mean consensus scores are respectively 0.84 and 0.90 for C1-C3 and 0.70 and 0.71 for C2-C4, see Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a</xref>), suggesting that cells from C2 and C4 might share H3K27me3 features, whereas cells from C1 and C3 have distinct H3K27me3 landscapes. Clusters C1, C2, and C4 contain cells from all four samples, with a significantly higher proportion of HBCx-22-TamR for C1 (<italic>p</italic>-value = 3e-05, Pearson’s Chi-squared test) (Fig. <xref rid="Fig4" ref-type="fig">4e</xref>). On the other hand, cluster C3 is almost exclusively composed of cells from model HBCx-95 (Fig. <xref rid="Fig4" ref-type="fig">4c, e</xref>), revealing a stromal cell population specific to the triple-negative breast cancer model (HBCx-95).</p>
      <p id="Par15">To further identify the specific features of each chromatin-based population, we proceeded to peak calling, differential analysis, and gene set enrichment analysis using default parameters (see Methods). As H3K27me3 is a repressive histone mark, we focused our analysis on loci depleted in H3K27me3, where transcription of genes can occur, in cells from each cluster versus all other cells. The differential analysis identified respectively 189, 210, 83, and 9 significantly depleted regions for clusters C1 to C4 (Fig. <xref rid="Fig4" ref-type="fig">4g</xref>, logFC &lt;1, adjusted <italic>p</italic>-value &lt; 0.01). We found loci devoid of H3K27me3 specific to cluster C2, enriched for genes involved in apical junction such as <italic>Bcar1</italic> (Fig. <xref rid="Fig4" ref-type="fig">4f</xref>) and <italic>Ptk2</italic>, which are characteristic of genes expressed in fibroblasts. We found a depletion of H3K27me3 specific to cluster C3 over the genes <italic>Nrros</italic> (Fig. <xref rid="Fig4" ref-type="fig">4f</xref>) and <italic>Il10ra</italic>, two genes characteristic of immune expression programs. The depletion of H3K27me3 over the transcription start site of <italic>Rap1gap2</italic>, a gene expressed in endothelial cells, was a key feature of cluster C4 (Fig. <xref rid="Fig4" ref-type="fig">4f</xref>). For cluster C1 and C2, we found a depletion of H3K27me3 over <italic>Eln</italic>, a gene expressed in fibroblasts.</p>
      <p id="Par16">Gene set enrichment analysis for genes located in regions depleted of H3K27me3 enrichment only revealed very few enriched gene lists, mostly for cluster C2 (<italic>q</italic>-value &lt; 0.1, Fig. <xref rid="Fig4" ref-type="fig">4h</xref>, multiple gene sets related to stem and cancer cells) and one list for C1 (“LPS_VS_CONTROL_MONOCYTE_UP”). Linking H3K27me3 enrichment to transcription is indeed indirect, we envisage such enrichment analysis more appropriate for H3K4me3 scChIP-seq in which enriched regions are directly associated with gene transcription.</p>
      <p id="Par17">Overall, these results are consistent with our previous analysis of HBCx-95 scRNA-seq datasets where subpopulations were differentially expressing markers of fibroblasts, endothelial, and macrophage cells<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. This analysis comprising the HBCx-22 dataset allowed us to identify the H3K27me3 signature of potential endothelial cells (cluster C4). These cells are present in each model, but might not have been previously detected in the previous scChIP-seq analysis due to low cell representation. In addition, the H3K27me3 signature of potential immune cells is restricted to cells from the TNBC model (cluster C3), suggesting that these immune cells are absent from the luminal tumor.</p>
    </sec>
  </sec>
  <sec id="Sec6" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par18">ChromSCape is a Shiny/R application designed for both biologists and bioinformaticians to analyze complex chromatin profiling datasets such as scChIP-seq datasets. The comprehensive application is quick to take over plus the direct visualization of cells clusters combined to configurable parameters and incremental saving of intermediary R objects eases bench-marking of parameters. We show that ChromSCape performs as well or better than state of the art single-cell epigenomic analytic tools to identify cell identities from an in-silico mix of H3K27me3 scChIP-seq datasets. It also manages to identify sub-populations within a complex scATAC-seq benchmarking dataset, showing its wide range of application for epigenomic analysis. In addition, using ChromSCape to study the epigenome of mouse stromal cells in breast tumors, we can identify the various epigenomes within the tumor micro-environment. Overall, we see ChromSCape as a useful tool to probe heterogeneity and dynamics of chromatin profiles in various biological settings, not only in cancer development but also in cell development and cellular differentiation.</p>
  </sec>
  <sec id="Sec7">
    <title>Methods</title>
    <sec id="Sec8">
      <title>Implementation</title>
      <p id="Par19">ChromSCape is a Bioconductor R package developed in Shiny/R. It uses various Shiny related packages (shinyjs, shinydashboard, shinyDirectoryInput) for the user interface. The application takes advantage of public R libraries for data vizualisation (RcolorBrewer, colorRamps, Rtsne, umap, colourpicker, kableExtra, knitr, viridis, ggplot2, gplots, png, grid, gridExtra, DT) as well as for data manipulation (Matrix, dplyr, tidyr, stringr, irlba, rlist, qualV, stringdistr). ChromSCape uses Bioconductor packages (i) for the manipulation of single-cell data with SingleCellExperiment, scater<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>, scran<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>, (ii) for the manipulation of genomic regions with IRanges and GenomicRanges<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, (iii) for the manipulation of genomic files with Rsamtools and BiocParallel, (iv) for the correction of batch effects with batchelor<sup><xref ref-type="bibr" rid="CR16">16</xref></sup> and (v) to determine the optimal number of clusters with ConsensusClusterPlus<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. In addition, ChromSCape makes use of custom R functions which serve for both manipulation and visualization of datasets. Brief command lines enable users without any bioinformatics skills to install all R dependencies and run the application in a web browser.</p>
    </sec>
    <sec id="Sec9">
      <title>Demonstration application</title>
      <p id="Par20">A demonstration of ChromSCape is freely available at <ext-link ext-link-type="uri" xlink:href="https://vallotlab.shinyapps.io/ChromSCape/">https://vallotlab.shinyapps.io/ChromSCape/</ext-link>.</p>
    </sec>
    <sec id="Sec10">
      <title>Input datasets, quality control, and pre-processing</title>
      <p id="Par21">Input files for ChromSCape are either one or multiple count matrices with genomic regions in rows and cells in columns or single-cell BAM or BED files. In this case, a directory containing single-cell BAM or BED files must be specified and ChromSCape creates the count matrix by aggregating the signal into successive genomic bins, peaks (BED file must be provided by user) or into regions around genes Transcription Start Sites (TSS). For H3K27me3 scChIP-seq datasets, with a distribution in broad peaks, we recommend using bins of 50kbp, while for H3K4me3 scChIP-seq or scATAC-seq datasets we recommend using smaller bins (e.g., 5 kb), knowns peaks or regions around TSS. The “condition” or “label” of each cell is then heuristically determined using file names and the number of conditions specified by the user. Guidelines and links toward datasets are given in the user guide (<ext-link ext-link-type="uri" xlink:href="https://vallotlab.github.io/ChromSCape/ChromSCape_guide.html">https://vallotlab.github.io/ChromSCape/ChromSCape_guide.html</ext-link>).</p>
      <p id="Par22">In order to efficiently remove outlier cells from the analysis, e.g., cells with excessively high or low coverage, the user sets a threshold on a minimum read count per cell and the upper percentile of cells to remove. The latter could correspond to doublets, e.g., two cells in one droplet, while lowly covered cells are not informative enough or may correspond to barcodes ligated to contaminant DNA or to library artifacts. Regions not supported by a minimum user-defined percentage of cells that have a coverage greater than 1000 reads are filtered out. Defaults parameters were chosen based on the analysis of multiple scChIP-seq datasets from our previous study<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>: a minimum coverage of 1600 unique reads per cell, filtering out the cells with the top 5% coverage and keeping regions detected in at least 1% of cells. Post quality control filtering, the matrices are normalized by total read count and region size. At this step, the user can provide a list of genomic regions, in BED format, to exclude from the subsequent analysis, in cases of known copy number variation regions between cells for example.</p>
      <p id="Par23">To reduce the dimensions of the normalized matrix for further analysis, principle component analysis (PCA) is applied to the matrix, with centering, and the 50 first PCs are kept for further analysis. The user can visualize scChIP-seq data after quality control in the PCs dimensional space. The t-distributed stochastic neighbor embedding (t-SNE) algorithm<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> and UMAP<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> is applied on the PCA to visualize the data in two dimensions. The PCA and t-SNE plots are a convenient way to check if cells form clusters in a way that was expected before any clustering method is applied. For instance, the user should verify whether the QC filtering steps and normalization procedures were efficient by checking the distribution of cells in PC1 and PC2 space. Cells should group independently of normalized coverage. In our hands, for our scChIP-seq H3K27me3 datasets, minimum coverage of 1,600 unique reads per cell was required to separate cells independently of coverage post normalization<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. A batch correction option using mutual nearest neighbors “FastMNN” function from “batchelor” package<sup><xref ref-type="bibr" rid="CR16">16</xref></sup> is implemented to remove any known batch effect in the reduced feature space.</p>
    </sec>
    <sec id="Sec11">
      <title>Hierarchical clustering, filtering, and consensus clustering</title>
      <p id="Par24">Using the first 50 first PCs of computed PCA as input, hierarchical clustering is performed, taking 1-Pearson’s correlation score as the distance metric. To improve the stability of our clustering approaches and to remove from the analysis isolated cells that do not belong to any subgroup, cells displaying a Pearson’s pairwise correlation score below a threshold <italic>t</italic> with at least <italic>p</italic>% of cells are filtered out (<italic>p</italic> is set at 1% by default). The correlation threshold <italic>t</italic> is calculated as a user-defined percentile of Pearson’s pairwise correlation scores for a randomized dataset (percentile is recommended to be set as the 99th percentile). Correlation heatmaps before and after correlation filtering and the number of remaining cells are displayed to inform users on the filtering process.</p>
      <p id="Par25">ChromSCape uses Bioconductor ConsensusClusterPlus package<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> to determine what is the appropriate <italic>k</italic>-partition of the filtered dataset into <italic>k</italic> clusters. To do so, it evaluates the stability of the clusters and computes item consensus score for each cell for each possible partition from <italic>k</italic> = 2 to 10. For each <italic>k</italic>, consensus partitions of the dataset are done on the basis of 1000 resampling iterations (80% of cells sampled at each iteration) of hierarchical clustering, with Pearson’s dissimilarity as the distance metric and Ward’s method for linkage analysis. The optimal number of clusters is then chosen by the user; one option is to maximize intra-cluster correlation scores based on the graphics displayed on the “Consensus Clustering” tab after processing. Clustering memberships can be visualized in two dimensions with the t-SNE or UMAP plot.</p>
    </sec>
    <sec id="Sec12">
      <title>Peak calling for genomic region annotation</title>
      <p id="Par26">This step of the analysis is optional, but recommended in order to refine the peak annotation prior to enrichment analysis. To be able to run this module, MACS2  is required<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>. The user needs to input BAM files for the samples (one separate BAM file per sample), with each read being labeled with the barcode ID. ChromSCape merges all files and splits them again according to the previously determined clusters of cells (one separate BAM file per cluster). Customizable significance threshold for peak detection and merging distance for peaks (defaults to <italic>p</italic>-value = 0.05 and peak merge distance to 5,000) allows to identify peaks in close proximity (&lt;1000 bp) to a gene transcription start site (TSS); these genes will be later used as input for the enrichment analysis. For the annotation, ChromSCape uses the reference human transcriptome Gencode_hg38_v26, limited to protein-coding, antisense, and lncRNA genes.</p>
    </sec>
    <sec id="Sec13">
      <title>Differential analysis and pathway enrichment analysis</title>
      <p id="Par27">To identify differentially enriched regions across single-cells for a given cluster, ChromSCape can perform (i) a non-parametric two-sided Wilcoxon rank-sum test comparing normalized counts from individual cells from one cluster versus all other cells, or cluster of choice, or (ii) a parametric test comparing raw counts from individual cells, using edgeR<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>, based on the assumption that the data follows a negative-binomial distribution. We test for the null hypothesis that the distribution of normalized counts from the two compared groups has the same median, with a confidence interval 0.95. The calculated <italic>p</italic>-values are then corrected by the Benjamini–Hoch<strike>e</strike>berg procedure<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. The user can set a log2 fold-change threshold and corrected <italic>p</italic>-value threshold for regions to be considered as significantly differentially enriched (default settings are a <italic>p</italic>-value and log2 fold-change thresholds respectively of 0.01 and 1). If users have specified batches, the differential analysis is done using the “pairwiseWilcox” function from the scran package<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>, setting the batch of origin as a “blocking level” for each cell.</p>
      <p id="Par28">For the top 100 most significant differential regions, single-cell H3K27me3 enrichment levels can be visualized overlaying H3K27me3 counts for each cell at selected genes onto a t-SNE plot. Using the refined annotation of peaks done in the previous step, the final step is to look for enriched gene sets of the MSigDB v5 database<sup><xref ref-type="bibr" rid="CR28">28</xref></sup> within differentially enriched regions (either enriched or depleted regions in the studied histone mark). We apply hypergeometric tests to identify gene sets from the MSigDB v5 database over-represented within differentially enriched regions, correcting for multiple testing with the Benjamini–Hochberg procedure. Users can then visualize the most significantly enriched or depleted gene sets corresponding to the epigenetic signatures of each cluster and download gene sets enrichment tables.</p>
    </sec>
    <sec id="Sec14">
      <title>Datasets</title>
      <p id="Par29"><underline>H3K27me3 scChIP-seq human</underline><underline>in-silico</underline><underline>mix of 4 cell types:</underline> The samples correspond to <italic>n</italic> = 326 human tumor cells from untreated PDX (HBCx-22), <italic>n</italic> = 201 human T cells (Jurkat) and <italic>n</italic> = 306 B cells (Ramos) taken from<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> and <italic>n</italic> = 454 cells from the MDA-MB-468 triple-negative breast cancer cell line (HBCx-22, Jurkat and Ramos data are from “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE117309">GSE117309</ext-link>”), MDA-MB-468 is available at “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE152502">GSE152502</ext-link>”).</p>
      <p id="Par30"><underline>H3K4me3 scChIC-seq human white blood cells dataset</underline><sup><xref ref-type="bibr" rid="CR4">4</xref></sup><underline>:</underline><italic>n</italic> = 285 white blood cells from a human male donor were downloaded as gzipped single-cell BED files from “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE105012">GSE105012</ext-link>”, inputted directly into ChromSCape and aggregated into 50kbp bins (default).</p>
      <p id="Par31"><underline>H3K27me3 scCUT&amp;Tag human H1 and K562 cells</underline><sup><xref ref-type="bibr" rid="CR5">5</xref></sup><underline>:</underline> A replicate of K562 cell line comprising of <italic>n</italic> = 908 cells from “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE124680">GSE124680</ext-link>”, another replicate of <italic>n</italic> = 479 K562 cells and <italic>n</italic> = 486 H1 cells from “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE124690">GSE124690</ext-link>” were downloaded as gzipped single-cell BED files, inputted directly into ChromSCape and aggregated around gene TSS (±2500 bp).</p>
      <p id="Par32"><underline>H3K27me3 scChIP-seq human datasets:</underline> The samples correspond to human cells from patient-derived xenograft (PDX) originating from two different human donors<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. For this study, we added a new scChIP-seq dataset, corresponding to a biological replicate of HBCx-95 (“<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE152502">GSE152502</ext-link>”), processed with a novel batch of hydrogel beads.</p>
      <p id="Par33"><underline>scATAC-seq datasets:</underline> The scATAC-seq dataset is composed of two cell types derived from two acute myeloid leukemia (AML) (patients SU070 and SU353 blastocytes (blast) and leukemic stem cells (LSC) from<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>) as well as multiple cell lines: GM12878 (4 replicates), TF1, BJ, H1, HL60, K562 (3 replicates) from<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>, K562 (3 replicates) from<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>; monocytes (Mono) and lymphoid primed multipotent progenitor (LMPP) from<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. The count matrix of reads in peaks was downloaded from GEO accession number “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE99172">GSE99172</ext-link>”, split into distinct matrices for each sample and formatted to be accepted as input by ChromSCape.</p>
      <p id="Par34">H3K27me3 scChIP-seq mouse datasets: The samples correspond to mouse cells from patient-derived xenograft (PDX) originating from two different human donors<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. Raw FASTQ reads were processed using the latest version of our scChIP-seq data engineering pipeline (see above) to produce 50 kbp binned count matrices given as input to ChromSCape (matrices available at <ext-link ext-link-type="uri" xlink:href="https://figshare.com/projects/Single-Cell_ChIP-seq_of_Mouse_Stromal_Cells_in_PDX_tumour_models_of_resistance/66419">https://figshare.com/projects/Single-Cell_ChIP-seq_of_Mouse_Stromal_Cells_in_PDX_tumour_models_of_resistance/66419</ext-link>).</p>
    </sec>
    <sec id="Sec15">
      <title>Cell line</title>
      <p id="Par35">MDA-MB-468 cells, bought at ATCC (HTB-132™), were cultured in DMEM 1640 (Gibco-BRL) and supplemented with 10% heat-inactivated fetal calf serum. Cell numbers, as judged by Trypan Blue exclusion test, were determined by counting cells using a Countess automated cell counter (Invitrogen). Cells were cultured at 37 °C in a humidified 5% CO<sub>2</sub> atmosphere. The cell line was mycoplasma negative. The MDA-MB-468 cells were trypsinized (Trypsin, Gibco-BRL). Prior to single-cell ChIP-seq, cells were then re-suspended in PBS/0.04% BSA (ThermoFisher Scientific, # AM2616).</p>
    </sec>
    <sec id="Sec16">
      <title>Patient-derived xenograft (PDX)</title>
      <p id="Par36">Female Swiss nude mice were purchased from Charles River Laboratories and were maintained under specific pathogen-free conditions. Their care and housing were in accordance with institutional guidelines and the rules of the French Ethics Committee (project authorization no. 02163.02). A PDX from a residual triple-negative breast cancer post neo-adjuvant chemotherapy (HBCx-95) was previously established at Institut Curie with informed consent from the patient<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. Prior to single-cell ChIP-seq, PDX was digested at 37 °C for 2 h with a cocktail of Collagenase I (Roche, # 11088793001) and Hyaluronidase (Sigma, # H3506). Cells were then individualized at 37 °C using a cocktail of 0.25% trypsin/Versen (ThermoFisher Scientific, #15040-033), Dispase II (Sigma, #D4693), and Dnase I (Roche, # 11284932001). Red Blood Cell lysis buffer (ThermoFisher Scientific, # 00-4333-57) was then added to degrade red blood cells. In order to increase the viability of the cell suspension, dead cells were removed using the Dead Cell Removal kit (Miltenyi Biotec). Cells were re-suspended in PBS/0.04% BSA (ThermoFisher Scientific, # AM2616).</p>
    </sec>
    <sec id="Sec17">
      <title>Single-cell ChIP-seq</title>
      <p id="Par37">The protocol for scChIP-seq was rigorously the same as in Grosselin et al.<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>, and can be resumed by the main following steps. Cells were first compartmentalized into droplets containing Mnase in a microfluidics chip, then fused with barcoded hydrogel beads. After fusion of cell-containing droplets and bead-containing droplets, Fast-link DNA ligase [Lucigen, # LK0750H] was used to ligate segmented DNA to barcodes. Droplets were pooled and used for chromatin immuno-precipitation with 2.5 µl of anti-H3K27me3 antibody ([Cell Signaling Technology, # 9733]). After treatment with RNAse A (ThermoFisher Scientific, #EN0531) and Proteinase K (ThermoFisher Scientific, # EO0491), barcoded-nucleosomes were then amplified by in-vitro transcription using the T7 MegaScript kit (ThermoFisher Scientific, # AM1334) and reverse-transcribed. After RNA digestion, DNA was amplified by PCR. The final product was size-selected by gel electrophoresis. Single-cell ChIP-seq libraries were finally sequenced on an Illumina NextSeq 500 MidOutput 150 cycles.</p>
    </sec>
    <sec id="Sec18">
      <title>Demultiplexing and alignment of H3K27me3 scChIP-seq datasets</title>
      <p id="Par38">Raw FASTQ reads were processed using the latest version of our scChIP-seq data engineering pipeline that allowed a more precise removal of PCR and RT duplicates (code available at <ext-link ext-link-type="uri" xlink:href="https://github.com/vallotlab/scChIPseq_DataEngineering">https://github.com/vallotlab/scChIPseq_DataEngineering</ext-link>) to produce 50 kbp binned count matrices given as input to ChromSCape (matrices available at <ext-link ext-link-type="uri" xlink:href="https://figshare.com/projects/Single-Cell_ChIP-seq_of_Mouse_Stromal_Cells_in_PDX_tumour_models_of_resistance/66419">https://figshare.com/projects/Single-Cell_ChIP-seq_of_Mouse_Stromal_Cells_in_PDX_tumour_models_of_resistance/66419</ext-link>). Rapidly, the first 56 bp of the Read2 were separated into three indexes and aligned using bowtie2 separately against the reference of three pools of 96 16-bp long indexes. Reads containing all three recognizable indexes (a full cell-barcode) were kept, the genomic part of Read2 and Read1 were aligned in paired-end mode using STAR v2.7.0. For each barcode, aligned reads were deduplicated by removing successively: (i) PCR duplicates, identified if #Read1 + #Read 2 mapped at the same position, (ii) RT duplicates, identified if #Read 1 mapped at the same position, and (iii) window duplicates: all the reads falling in the same 50 bp window were stacked into one as reads possibly originating from the same nucleosome. Reads were binned in non-overlapping 50 kb bins spanning the genome to generate a n x m coverage matrix with n barcodes and m genomic bins used in downstream analysis.</p>
    </sec>
    <sec id="Sec19">
      <title>Benchmark of tools for scChIP-seq data analysis</title>
      <p id="Par39">Three methods dedicated to the analysis of scATAC-seq with the best performance according to Chen et al., 2019<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, were tested on a mixture of H3K27me3 scChIP-seq datasets (see Datasets below), namely “SnapATAC”, “CisTopic”, and “Cusanovich2018”. The scripts were taken from the GitHub repository of the benchmark paper (<ext-link ext-link-type="uri" xlink:href="https://github.com/pinellolab/scATAC-benchmarking">https://github.com/pinellolab/scATAC-benchmarking</ext-link>). For “CisTopic” and “Cusanovich2018”, peaks were called using MACS2 with options “-nomodel -extsize 300 -keep-dup all -broad”. Peaks closer than 5000 bp were merged together using BEDTools. For “SnapATAC”, 50kbp bins were counted from BAM files using “SnapTools”. In addition, we also tested a recent method for single-cell epigenomic analysis, “EpiScanpy”, following the basic steps described in the tutorial for scATAC-seq (<ext-link ext-link-type="uri" xlink:href="https://github.com/colomemaria/epiScanpy/blob/master/docs/tutorials/Tutorial_Hackathon_Buenrostro_2.html">https://github.com/colomemaria/epiScanpy/blob/master/docs/tutorials/Tutorial_Hackathon_Buenrostro_2.html</ext-link>) with the same 50 kbp matrices used for ChromSCape. We extracted from each method the matrix of reduced feature space, and used hierarchical clustering with Pearson’s dissimilarity as the distance metric and Ward’s method for linkage. The adjusted Rand’s index (ARI), a widely used measure to quantify clustering accuracy, was calculated for each method using R package “mclust”<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>, taking samples of origin as “true” clusters.</p>
      <p id="Par40">In addition, two softwares with graphic interface, dedicated to the analysis of single-cell data, “scOrange”<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> and “SCRAT”<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>, were also tested on the same set of cells both with “default” parameters and manually “optimized” parameters. default’ for scOrange corresponds to using the template called “Loading data from 10× protocols”, a workflow meant for analyzing scRNA-seq of bone marrow cells, replacing the input by our matrices of selected cells in 50kbp bins. The “optimized” workflow is available at <ext-link ext-link-type="uri" xlink:href="http://www.github.com/vallotlab/ChromSCape_benchmarking">www.github.com/vallotlab/ChromSCape_benchmarking</ext-link> and can be opened with the “scOrange” software. For ‘SCRAT’, we found that the “optimized” counting method corresponded to counting signal within peaks called on the “pseudo-bulk” (see above).</p>
      <p id="Par41">In order to be able to compare the distinct methods, ChromSCape was first to run on the raw count matrices and a set of 1287 cells passing the quality control thresholds were selected to be used as input for all methods. As the number of cells in each sample was unbalanced (e.g., the raw MDA-MB-468 containing <italic>n</italic> = 3,382 cells while others have a maximum of <italic>n</italic> = 456 cells), 500 cells from MDA-MB-468 were randomly sub-sampled using ChromSCape “Perform Subsampling” option. We removed from the analysis the segments corresponding to known amplifications and homozygous loss of DNA of the Triple Negative Breast Cancer cell line MDA-MB-468, corresponding to a total of 77Mbp, previously found by analyzing the input of bulk ChIP-seq of the same cells (see Supplementary Note <xref rid="MOESM1" ref-type="media">2</xref>).</p>
    </sec>
    <sec id="Sec20">
      <title>Reporting Summary</title>
      <p id="Par42">Further information on research design is available in the <xref rid="MOESM3" ref-type="media">Nature Research Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec21">
      <supplementary-material content-type="local-data" id="MOESM1">
        <media xlink:href="41467_2020_19542_MOESM1_ESM.pdf">
          <caption>
            <p>Supplementary Information</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM2">
        <media xlink:href="41467_2020_19542_MOESM2_ESM.pdf">
          <caption>
            <p>Peer Review File</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM3">
        <media xlink:href="41467_2020_19542_MOESM3_ESM.pdf">
          <caption>
            <p>Reporting Summary</p>
          </caption>
        </media>
      </supplementary-material>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Peer review information</bold><italic>Nature Communications</italic> thanks Florian Halbritter and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. Peer reviewer reports are available.</p>
    </fn>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p><bold>Supplementary information</bold> is available for this paper at 10.1038/s41467-020-19542-x.</p>
  </sec>
  <ack>
    <p>This research project was supported by the ATIP Avenir program, by Plan Cancer and by the SiRIC-Curie program SiRIC Grants #INCa-DGOS- 4654 and #INCa-DGOS-Inserm_12554.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>P.P., P.K., and C.V. wrote code for ChromSCape and performed data analysis. J.M. performed scChIP-seq experiments on PDX and breast cancer cell lines. P.P., M.D., and N.S. processed raw scChIP-seq datasets into count matrices. P.P. and C.V. wrote the manuscript. C.V. conceptualized and supervised this work.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>In this study, we produced H3K27me3 scChIP-seq data for MDA-MB-468 sample and a new replicate of untreated HBCx-95. This sequencing data have been deposited in the National Center for Biotechnology Information Gene Expression Omnibus (GEO) and are accessible through the GEO Series accession number “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE152502">GSE152502</ext-link>”. Other datasets used (described in “Datasets” in the Methods) can be downloaded from NCBI GEO under the accession numbers “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE117309">GSE117309</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE152502">GSE152502</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE105012">GSE105012</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE124680">GSE124680</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE124690">GSE124690</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE152502">GSE152502</ext-link>”, “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE99172">GSE99172</ext-link>”. All other relevant data supporting the key findings of this study are available within the article and its <xref rid="MOESM1" ref-type="media">Supplementary Information</xref> files or from the corresponding authors upon reasonable request. A reporting summary for this Article is available as a <xref rid="MOESM1" ref-type="media">Supplementary Information</xref> file.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The package is available on Bioconductor v3.12, requiring R4.0. Source code, guidelines for installation, and use of the application are provided at <ext-link ext-link-type="uri" xlink:href="https://github.com/vallotlab/ChromSCape">https://github.com/vallotlab/ChromSCape</ext-link>. A docker container containing the application and it’s dependecies is available on DockerHub (pacomito/chromscape:v0.0.9001), instructions on how to launch it are available on the github page. Codes for the benchmark of “SnapATAC”, “CisTopic”, “Cusanovich2018”, and “EpiScanpy” are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/vallotlab/ChromSCape_benchmarking">https://github.com/vallotlab/ChromSCape_benchmarking</ext-link>.</p>
  </notes>
  <notes id="FPar1" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par43">The authors declare the following competing interests: licenses have been filed on some aspects of this work by Institut Curie and CNRS; contributors may receive payments related to exploitation of these licenses under their employer’s rewards to inventor scheme.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grosselin</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High-throughput single-cell ChIP-seq identifies heterogeneity of chromatin states in breast cancer</article-title>
        <source>Nat. Genet.</source>
        <year>2019</year>
        <volume>51</volume>
        <fpage>1060</fpage>
        <lpage>1066</lpage>
        <pub-id pub-id-type="pmid">31152164</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rotem</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell ChIP-seq reveals cell subpopulations defined by chromatin state</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>1165</fpage>
        <lpage>1172</lpage>
        <pub-id pub-id-type="pmid">26458175</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Harada</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A chromatin integration labelling method enables epigenomic profiling with lower input</article-title>
        <source>Nat. Cell Biol.</source>
        <year>2019</year>
        <volume>21</volume>
        <fpage>287</fpage>
        <lpage>296</lpage>
        <pub-id pub-id-type="pmid">30532068</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ku</surname>
            <given-names>WL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell chromatin immunocleavage sequencing (scChIC-seq) to profile histone modification</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>323</fpage>
        <lpage>325</lpage>
        <pub-id pub-id-type="pmid">30923384</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kaya-Okur</surname>
            <given-names>HS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CUT&amp;Tag for efficient epigenomic profiling of small samples and single cells</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>1930</fpage>
        <pub-id pub-id-type="pmid">31036827</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Miragaia</surname>
            <given-names>RJ</given-names>
          </name>
          <name>
            <surname>Natarajan</surname>
            <given-names>KN</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
        </person-group>
        <article-title>A rapid and robust method for single cell chromatin accessibility profiling</article-title>
        <source>Nat. Commun.</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>5345</fpage>
        <pub-id pub-id-type="pmid">30559361</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cusanovich</surname>
            <given-names>DA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiplex single cell profiling of chromatin accessibility by combinatorial cellular indexing</article-title>
        <source>Science</source>
        <year>2015</year>
        <volume>348</volume>
        <fpage>910</fpage>
        <lpage>914</lpage>
        <pub-id pub-id-type="pmid">25953818</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lareau</surname>
            <given-names>CA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Droplet-based combinatorial indexing for massive-scale single-cell chromatin accessibility</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>916</fpage>
        <lpage>924</lpage>
        <pub-id pub-id-type="pmid">31235917</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Assessment of computational methods for the analysis of single-cell ATAC-seq data</article-title>
        <source>Genome Biol.</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>241</fpage>
        <pub-id pub-id-type="pmid">31739806</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <mixed-citation publication-type="other">Fang, R. et al. Fast and accurate clustering of single cell epigenomes reveals cis-regulatory elements in rare cell types. Preprint available at <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/615179v3">https://www.biorxiv.org/content/10.1101/615179v3</ext-link> (2019).</mixed-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bravo González-Blas</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>cisTopic: cis-regulatory topic modeling on single-cell ATAC-seq data</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>397</fpage>
        <lpage>400</lpage>
        <pub-id pub-id-type="pmid">30962623</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cusanovich</surname>
            <given-names>DA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The cis-regulatory dynamics of embryonic development at single-cell resolution</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>555</volume>
        <fpage>538</fpage>
        <lpage>542</lpage>
        <pub-id pub-id-type="pmid">29539636</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stražar</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>scOrange-a tool for hands-on training of concepts from single-cell data analytics</article-title>
        <source>Bioinformatics</source>
        <year>2019</year>
        <volume>35</volume>
        <fpage>i4</fpage>
        <lpage>i12</lpage>
        <pub-id pub-id-type="pmid">31510695</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ji</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Ji</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Single-cell regulome data analysis by SCRAT</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <fpage>2930</fpage>
        <lpage>2932</lpage>
        <pub-id pub-id-type="pmid">28505247</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <mixed-citation publication-type="other">Danese, A., Richter, M. L., Fischer, D. S., Theis, F. J. &amp; Colomé-Tatché, M. EpiScanpy: integrated single-cell epigenomic analysis. Preprint available at <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/648097v1">https://www.biorxiv.org/content/10.1101/648097v1</ext-link> (2019).</mixed-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Haghverdi</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>Morgan</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Batch effects in single-cell RNA-sequencing data are corrected by matching mutual nearest neighbors</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>421</fpage>
        <lpage>427</lpage>
        <pub-id pub-id-type="pmid">29608177</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schep</surname>
            <given-names>AN</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Buenrostro</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Greenleaf</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>J. chromVAR: inferring transcription-factor-associated accessibility from single-cell epigenomic data</article-title>
        <source>Nat. Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>975</fpage>
        <lpage>978</lpage>
        <pub-id pub-id-type="pmid">28825706</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Corces</surname>
            <given-names>MR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Lineage-specific and single-cell chromatin accessibility charts human hematopoiesis and leukemia evolution</article-title>
        <source>Nat. Genet.</source>
        <year>2016</year>
        <volume>48</volume>
        <fpage>1193</fpage>
        <lpage>1203</lpage>
        <pub-id pub-id-type="pmid">27526324</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Campbell</surname>
            <given-names>KR</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>Wills</surname>
            <given-names>QF</given-names>
          </name>
        </person-group>
        <article-title>Scater: pre-processing, quality control, normalization and visualization of single-cell RNA-seq data in R</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <fpage>1179</fpage>
        <lpage>1186</lpage>
        <pub-id pub-id-type="pmid">28088763</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>A step-by-step workflow for low-level analysis of single-cell RNA-seq data with Bioconductor</article-title>
        <source>F1000Res</source>
        <year>2016</year>
        <volume>5</volume>
        <fpage>2122</fpage>
        <pub-id pub-id-type="pmid">27909575</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lawrence</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Software for computing and annotating genomic ranges</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2013</year>
        <volume>9</volume>
        <fpage>e1003118</fpage>
        <pub-id pub-id-type="pmid">23950696</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wilkerson</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Hayes</surname>
            <given-names>DN</given-names>
          </name>
        </person-group>
        <article-title>ConsensusClusterPlus: a class discovery tool with confidence assessments and item tracking</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>1572</fpage>
        <lpage>1573</lpage>
        <pub-id pub-id-type="pmid">20427518</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Maaten</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Hinton</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Visualizing data using t-SNE</article-title>
        <source>J. Mach. Learn. Res.</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>2579</fpage>
        <lpage>2605</lpage>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">McInnes, L., Healy, J. &amp; Melville, J. UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction. Preprint available at <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1802.03426">https://arxiv.org/abs/1802.03426</ext-link> (2018).</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Model-based analysis of ChIP-Seq (MACS)</article-title>
        <source>Genome Biol.</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>R137</fpage>
        <pub-id pub-id-type="pmid">18798982</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Robinson</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Smyth</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>K. edgeR: a bioconductor package for differential expression analysis of digital gene expression data</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>139</fpage>
        <lpage>140</lpage>
        <pub-id pub-id-type="pmid">19910308</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Benjamini</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Hochberg</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Controlling the false discovery rate: a practical and powerful approach to multiple testing</article-title>
        <source>J. R. Stat. Soc. Ser. B (Methodol.)</source>
        <year>1995</year>
        <volume>57</volume>
        <fpage>289</fpage>
        <lpage>300</lpage>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Subramanian</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2005</year>
        <volume>102</volume>
        <fpage>15545</fpage>
        <lpage>15550</lpage>
        <pub-id pub-id-type="pmid">16199517</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Buenrostro</surname>
            <given-names>JD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell chromatin accessibility reveals principles of regulatory variation</article-title>
        <source>Nature</source>
        <year>2015</year>
        <volume>523</volume>
        <fpage>486</fpage>
        <lpage>490</lpage>
        <pub-id pub-id-type="pmid">26083756</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Scrucca</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Fop</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Murphy</surname>
            <given-names>TB</given-names>
          </name>
          <name>
            <surname>Raftery</surname>
            <given-names>AE</given-names>
          </name>
        </person-group>
        <article-title>mclust 5: clustering, classification and density estimation using Gaussian finite mixture models</article-title>
        <source>R. J.</source>
        <year>2016</year>
        <volume>8</volume>
        <fpage>289</fpage>
        <lpage>317</lpage>
        <pub-id pub-id-type="pmid">27818791</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
