<?all-math-mml yes?>
<?use-mml?>
<?properties open_access?>
<?properties manuscript?>
<?origin ukpmcpa?>
<?ManuscriptPrefix new?>
<?iso-abbr Nat. Methods?>
<?submitter-system ukmss?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 0?>
<?submitter-authority publisher?>
<?submitter-login NPG?>
<?submitter-name Nature Publishing Group?>
<?domain wtpa?>
<?origin ukpmcpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6949127</article-id>
    <article-id pub-id-type="pmid">31740822</article-id>
    <article-id pub-id-type="doi">10.1038/s41592-019-0632-3</article-id>
    <article-id pub-id-type="manuscript">ems84577</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Revealing Dynamics of Gene Expression Variability in Cell State
Space</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Grün</surname>
          <given-names>Dominic</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="corresp" rid="CR1">*</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Max-Planck-Institute of Immunobiology and Epigenetics, D-79108
Freiburg, Germany</aff>
    <aff id="A2"><label>2</label>CIBBS -Centre for Integrative Biological Signaling Studies,
University of Freiburg, Germany</aff>
    <author-notes>
      <corresp id="CR1"><label>*</label>Correspondence:
<email>gruen@ie-freiburg.mpg.de</email></corresp>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>09</day>
      <month>10</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>11</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>1</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>18</day>
      <month>5</month>
      <year>2020</year>
    </pub-date>
    <volume>17</volume>
    <issue>1</issue>
    <fpage>45</fpage>
    <lpage>49</lpage>
    <!--elocation-id from pubmed: 10.1038/s41592-019-0632-3-->
    <permissions>
      <license xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:<ext-link ext-link-type="uri" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</ext-link></license-p>
      </license>
    </permissions>
    <abstract>
      <p id="P1">To decipher cell state transitions from single-cell transcriptomes it is
crucial to quantify weak expression of lineage determining factors, requiring
computational methods sensitive to variability of lowly expressed genes. We here
introduce VarID, a computational method that identifies locally homogenous
neighborhoods in cell state space, permitting the quantification of local gene
expression variability. VarID delineates neighborhoods with differential gene
expression variability and reveals pseudo-temporal dynamics of variability
during differentiation.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P2">With the advent of a growing number of single-cell sequencing technologies our
ability to decipher the cell type composition of complex tissues is rapidly improving.
Single-cell transcriptomes can reveal manifolds in cell state space representing
trajectories of cell state transitions<sup><xref rid="R1" ref-type="bibr">1</xref></sup>. It is of core interest to understand the molecular control of these
transitions, but the investigation of transcription factor and signaling networks
underpinning cell state transitions is frequently hindered by the low and highly
variable expression of these classes of genes. Since differences of lowly expressed
genes are difficult to detect due to technical and biological noise<sup><xref rid="R2" ref-type="bibr">2</xref></sup>, we here introduce a method for the
inference of local variability; increased local variability could indicate the onset of
expression in local neighborhoods, or the response to fluctuating signaling inputs from
the microenvironment. Available methods for the inference of noise parameters<sup><xref rid="R2" ref-type="bibr">2</xref>–<xref rid="R4" ref-type="bibr">4</xref></sup> were not designed for complex mixtures of cell types and do not
permit the local estimation of variability.</p>
  <p id="P3">A fundamental challenge is the definition of local neighborhoods in cell state
space, since admixtures of distinct cell types or states could inflate the variability
estimates. Since k-nearest neighbor (knn) networks have successfully been used for the
inference of cell types<sup><xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R6" ref-type="bibr">6</xref></sup> and differentiation
trajectories<sup><xref rid="R7" ref-type="bibr">7</xref></sup> we reasoned that
the k-nearest neighborhood would be a useful starting point. We devised a statistical
test to determine if the expression levels of all genes for each neighbor are in
accordance with the expected distribution of the “central” cell. We have
previously demonstrated that unique molecular identifier (UMI)-derived transcript counts
are well described by a negative binomial distrubtion<sup><xref rid="R2" ref-type="bibr">2</xref></sup>, which is uniquely determined by mean and variance. We thus
learn a local mean by averaging expression across the central cell and its knns with
weights determined by their similarity to the central cell (<xref ref-type="sec" rid="S1">Methods</xref>). An additional parameter <italic>α</italic> can be
varied to adjust the degree of locality. We next determine the variance associated with
the local mean estimate from a global background distribution. As we showed
previously<sup><xref rid="R8" ref-type="bibr">8</xref>,<xref rid="R9" ref-type="bibr">9</xref></sup>, the mean-variance relation in logarithmic space is well
described by a second order polynomial, robustly averaging across genes of similar mean
expression (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig.
1a</xref>). Hence, a local mean allows us to define local background distributions
for all genes, and links to any of the knns with expression levels not explained by this
distribution are discarded (<xref ref-type="fig" rid="F1">Fig. 1a</xref>). The resulting
pruned knn-network thus only connects locally homogenous neighborhoods.</p>
  <p id="P4">To identify distinct cell states and types we applied Louvain density clustering
to the pruned network. To demonstrate increased sensitivity of cell type detection when
using the pruned network, we analyzed murine hematopoietic progenitor single-cell
transcriptomes<sup><xref rid="R10" ref-type="bibr">10</xref></sup> (<xref ref-type="fig" rid="F1">Fig. 1b,c</xref>). We recovered all lineages described in
the original study, and resolved additional sub-populations such as
<italic>Mpl</italic><sup>high</sup> versus <italic>Pf4</italic><sup>high</sup>
megakaryocyte states, <italic>Ebf1</italic><sup>high</sup> pro-B cells and
<italic>Dntt</italic><sup>high</sup> progenitors, and eosinophils (<xref ref-type="fig" rid="F1">Fig. 1b,c</xref>). These sub-populations remain unresolved
when clustering is performed on the full network (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 1b-c</xref>) or when
Seurat<sup><xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R6" ref-type="bibr">6</xref></sup> analysis is performed (<xref ref-type="fig" rid="F1">Fig. 1d</xref> and <xref ref-type="supplementary-material" rid="SD2">Supplementary
Fig. 1d-f</xref>). As the clustering depends on the choice of the parameters
α and knn, we evaluated the resolution of rare populations within this dataset,
i.e. lymphoid progenitors, B cells, basophils, eosinophils, dendritic cells, and
megakaryocytes, based on the resolution of the expression domains of corresponding
marker genes (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig.
1g</xref>). This analysis supports α=10 and knn=10 as an optimal parameter
choice. We observed similar clustering performance when determining knns with a supplied
Pearson’s correlation-based distance matrix and when using the default method,
i.e. based on Euclidean distances in principle component analysis (PCA) space (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 1h</xref>, <xref ref-type="sec" rid="S1">Methods</xref>).</p>
  <p id="P5">We next predicted transition probabilities between the inferred clusters on the
pruned knn-network. Assuming a random starting cell within a given cluster, one can
readily compute the probability to transition into another cluster within a single step
on the network (<xref ref-type="sec" rid="S1">Methods</xref>). These probabilities were
in very good agreement with known differentiation pathways (<xref ref-type="fig" rid="F1">Fig. 1e</xref>): multipotent progenitors (cluster 16) were directly linked
to megakaryocytes, dendritic cells, basophils, monocytes, and the major branches of
erythrocytes and neutrophils, respectively.</p>
  <p id="P6">In order to explore differences in lowly expressed genes between cell states, we
derived estimates of gene expression variability in local neighborhoods on the pruned
knn-graph. To account for the convex variance-mean dependence in logarithmic space as a
consequence of biological and technical noise<sup><xref rid="R2" ref-type="bibr">2</xref>–<xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R11" ref-type="bibr">11</xref></sup> (<xref ref-type="fig" rid="F2">Fig. 2a</xref>), we
fitted a second order polynomial to the baseline level of the combined technical and
biological variability (<xref ref-type="sec" rid="S1">Methods</xref>). This allowed us
to regress out the systematic baseline mean-dependence and directly compare corrected
variability estimates between neighborhoods (<xref ref-type="fig" rid="F2">Fig.
2b</xref>). As an alternative approach, we followed a recently published method
based on a negative binomial generalized linear model with the total transcript count of
each cell as independent variable<sup><xref rid="R12" ref-type="bibr">12</xref></sup>.
After averaging regression parameters across genes of similar mean expression (<xref ref-type="sec" rid="S1">Methods</xref>, <xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 2</xref>), the variance of the Pearson residuals should
in theory be independent of the mean expression. In order to test the sensitivity and
specificity of VarID for the detection of genes with enhanced variability, we performed
a simulation experiment, which revealed that significantly variable fold changes
&gt;1.25 can be detected at a false positive rate ~5% and a true positive
rate &gt;50% depending on the average expression (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 3</xref>).</p>
  <p id="P7">To explore differences in gene expression variability across cell states, we
inferred local estimates of the corrected variability for the murine hematopoietic
progenitors using the first approach, i.e. corrected variance (<xref ref-type="fig" rid="F2">Fig. 2a,b</xref>), since a residual mean-variance dependence remained for
the second approach (<xref ref-type="supplementary-material" rid="SD2">Supplementary
Fig. 2a,b</xref>). We noticed that increased local variability is frequently
associated with the onset of lineage markers in multipotent progenitors (cluster 16),
e.g., the early erythrocyte lineage transcription factor <italic>Gata1</italic> or the
neutrophil marker <italic>Mpo</italic> (<xref ref-type="fig" rid="F2">Fig. 2c</xref>).
However, while the corrected variability remains high in case of <italic>Gata1</italic>
throughout erythrocyte differentiation, it becomes strongly suppressed for
<italic>Mpo</italic> with increasing expression during neutrophil differentiation
(<xref ref-type="fig" rid="F2">Fig. 2c</xref>), indicating gene-specific dynamics of
expression variability.</p>
  <p id="P8">We next extracted all genes with increased local variability within the
multipotent progenitor population (cluster 16) in comparison to the remaining
populations (one-sided Wilcoxon rank sum-test <italic>P</italic>&lt;0.001, Benjamini
Hochberg corrected, foldchange &gt;1.25). Differentially variable genes exhibited
only limited overlap with differentially expressed genes
(<italic>P</italic>&lt;0.001, Benjamini Hochberg corrected, see <xref ref-type="sec" rid="S1">Methods</xref>, foldchange &gt;1.25 between the populations, <xref ref-type="fig" rid="F2">Fig. 2d</xref>). Comparing corrected variability of the top
50 variable genes with their expression across cell clusters revealed groups of genes
with stochastic expression in cluster 16 and markedly increasing expression, e.g., on
the neutrophil branch, such as <italic>Mpo</italic>, <italic>Prtn3</italic>, or
<italic>Elane</italic>, and classes of genes which are also most highly expressed in
cluster 16, such as <italic>Flt3</italic>, <italic>Cd27</italic>, <italic>Cd34</italic>,
and <italic>Il12a</italic>. To investigate stochasticity of transcriptional regulators
relevant for lineage decisions, we selected all transcriptional regulators<sup><xref rid="R13" ref-type="bibr">13</xref></sup> from the list of significantly
variable genes in cluster 16 and predicted a regulatory network by running
GENIE3<sup><xref rid="R14" ref-type="bibr">14</xref></sup> (<xref ref-type="sec" rid="S1">Methods</xref>, <xref ref-type="fig" rid="F2">Fig. 2f</xref> and <xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 2c</xref>). This
network recovered modules associated with hematopoietic stem cells (HSCs) comprising
<italic>Runx2</italic><sup><xref rid="R15" ref-type="bibr">15</xref></sup> and
<italic>Hlf</italic><sup><xref rid="R16" ref-type="bibr">16</xref></sup>, the
megakaryocyte lineage (<italic>Pbx1</italic>, <italic>Fli1</italic>,
<italic>Mef2c</italic>)<sup><xref rid="R17" ref-type="bibr">17</xref></sup>, the
lymphoid lineage (<italic>Satb1</italic><sup><xref rid="R18" ref-type="bibr">18</xref></sup>, <italic>Etv6</italic><sup><xref rid="R19" ref-type="bibr">19</xref></sup>), and monocyte differentiation (<italic>Spi1</italic>,
<italic>Irf8</italic>)<sup><xref rid="R17" ref-type="bibr">17</xref></sup>,
indicating variable activity of lineage-associated transcription factors in multipotent
progenitors.</p>
  <p id="P9">To investigate dynamics of variability during differentiation, we focused on the
neutrophil branch and inferred a pseudo-temporal ordering of single-cell transcriptomes
with StemID2<sup><xref rid="R8" ref-type="bibr">8</xref></sup> (<xref ref-type="fig" rid="F3">Fig. 3a</xref>). We then ordered the pseudo-temporal profiles of gene
expression (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig.
4a</xref>) and of the corrected variability (<xref ref-type="fig" rid="F3">Fig.
3b</xref>) into co-expressed and co-variable modules, respectively, using
self-organizing maps as implemented in FateID<sup><xref rid="R8" ref-type="bibr">8</xref></sup>. We observed modules with distinct variability profiles, such as
genes with increased variability at naïve and mature states (e.g. module 1 and
8), or during intermediate stages (e.g. module 11). Modules with similar dynamics of
variability did not necessarily exhibit comparable gene expression dynamics (<xref ref-type="fig" rid="F3">Fig. 3c</xref> and <xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 4a</xref>). Of note, particular modules were enriched
in specific functions (<xref ref-type="sec" rid="S1">Methods</xref>, <xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 4b,c</xref>).</p>
  <p id="P10">To investigate the impact of a perturbation on gene expression variability, we
co-analyzed hematopoietic cells sequenced from bone marrow after 48h of EPO
stimulation<sup><xref rid="R10" ref-type="bibr">10</xref></sup> together with
the cells sequenced from the normal bone marrow. EPO stimulation leads to an expansion
of the erythroid lineage at the expense of the other lineages<sup><xref rid="R10" ref-type="bibr">10</xref></sup>. Our analysis confirmed that transcriptome changes
upon EPO-stimulation only affect the erythroid lineage (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 5a-c</xref>), and
revealed an enrichment of innate immunity pathways among genes with increased
variability in EPO-stimulated versus normal erythrocyte progenitors (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 5d</xref>)
(ReactomePA <italic>P</italic>&lt;0.002, <xref ref-type="sec" rid="S1">Methods</xref>). This finding suggests that progenitors of other lineages could
indeed be diverted towards the erythrocyte fate upon EPO-stimulation. Importantly, there
is only marginal overlap with differentially expressed genes, and those do not exhibit a
significant functional enrichment other than for rRNA processing (<xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 5e</xref>).</p>
  <p id="P11">Finally, application of VarID to murine intestinal epithelial cells<sup><xref rid="R20" ref-type="bibr">20</xref></sup> revealed stochastic activity of
secretory lineage transcription factors in Lgr5+ intestinal stem cells, suggesting the
existence of secretory fate-biased stem cells (<xref ref-type="supplementary-material" rid="SD1">Supplementary Results</xref> and <xref ref-type="supplementary-material" rid="SD2">Supplementary Fig. 6-8</xref>).</p>
  <p id="P12">In conclusion, by quantifying dynamics of gene expression variability, VarID
reveals stochastic activity of lineage regulators involved in cell state transition and
facilitates the investigation of the molecular control of fate decision by single-cell
RNA-sequencing.</p>
  <sec id="S1" specific-use="web only">
    <title>Online Methods</title>
    <sec id="S2">
      <title>The VarID Method</title>
      <sec id="S3">
        <title>Inference of a pruned k-nearest neighbor network</title>
        <p id="P13">The first step of VarID is the inference of a k-nearest neighbor
(knn) network. This network can be constructed based on different metrics.
As one alternative, a user-defined distance matrix can be provided, or
directly computed by VarID, e.g., by using the Euclidean metric,
Spearman’s or Pearson’s correlation. Since for datasets with
tens of thousands of cells, computation and storage of a distance matrix is
prohibitive due to massive memory requirements, VarID provides an
alternative approach. After an initial principal component analysis to
achieve dimensionality reduction, a fast knn search is performed based on
the Euclidean metric in PCA space. The number of principal components used
can be specified and is set to 100 by default to ensure that the major
variability is captured. We recommend keeping this default setting. Since
the memory requirement for distance matrices of n cells scales with O(n*n)
and the fast knn search (using the FNN R-package v1.1.3) scales with O(n),
the difference in memory requirement will be substantial for large
datasets.</p>
        <p id="P14">To eliminate the effect of cell-to-cell variability in total
transcript counts, or sequencing depth, on the dimensional reduction and the
downstream analysis, an optional regression with a negative binomial error
model by a generalized linear model is computed, with the total transcript
count of a cell as independent variable, following a recently proposed
method<sup><xref rid="R12" ref-type="bibr">12</xref></sup>. If
<italic>x<sub>ij</sub></italic> is the transcript count of gene
<italic>i</italic> (<italic>i</italic>=1, …, <italic>G</italic>)
in cell <italic>j</italic> (<italic>j</italic>=1, …,
<italic>N</italic>), we compute a negative binomial generalized linear
model<disp-formula id="FD1"><label>(1)</label><mml:math display="block" id="M1" overflow="scroll"><mml:mrow><mml:mtext>log</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>E</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mi>β</mml:mi><mml:mn>0</mml:mn><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>β</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msubsup><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mtext>log</mml:mtext></mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>n</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mspace width="0.8em"/><mml:msub><mml:mi>n</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>G</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.8em"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>G</mml:mi><mml:mspace width="0.8em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula> with a log link function. The negative
binomial distribution is over-dispersed and has been shown to be suitable
for modeling technical and biological noise in single-cell RNA-seq
data<sup><xref rid="R2" ref-type="bibr">2</xref></sup>. The
dispersion parameter <italic>θ</italic><sub>ij</sub> is estimated
during the regression in addition to the intercept
<italic>β</italic><sup>ij</sup><sub>0</sub> and the coefficient
<italic>β</italic><sup>ij</sup><sub>1</sub>.
<italic>θ</italic><sub>ij</sub> determines the deviation of mean
and variance <inline-formula><mml:math display="inline" id="M2" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn mathvariant="italic">2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>: <disp-formula id="FD2"><label>(2)</label><mml:math display="block" id="M3" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>Following a similar procedure as Hafemeister
and Satija<sup><xref rid="R12" ref-type="bibr">12</xref></sup>, information
is shared between genes by a locally weighted scatter plot smoothing
(loess),<disp-formula id="FD3"><label>(3)</label><mml:math display="block" id="M4" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>β</mml:mi><mml:mn>0</mml:mn><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msubsup><mml:mo>→</mml:mo><mml:msubsup><mml:mi>β</mml:mi><mml:mn>0</mml:mn><mml:mi>j</mml:mi></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.8em"/><mml:msubsup><mml:mi>β</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msubsup><mml:mo>→</mml:mo><mml:msubsup><mml:mi>β</mml:mi><mml:mn>1</mml:mn><mml:mi>j</mml:mi></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.8em"/><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>resulting in the dependence of the parameters
solely on the expression level <italic>m</italic>.</p>
        <p id="P15">The resulting knn network is subject to pruning in the next step.
For this purpose, a background model of the combined technical and
biological variability is defined, using raw transcript counts as input. The
variance <italic>v<sub>i</sub></italic> and the mean
<italic>m<sub>i</sub></italic> across the entire dataset are computed
for each gene <italic>i</italic>, and the variance-mean dependence across
all genes is fitted by a second order polynomial after log-transformation,
in order to obtain a function <italic>v<sub>a</sub></italic> capturing the
average dependence of the expression variability on the mean expression
<italic>m</italic>,<disp-formula id="FD4"><label>(4)</label><mml:math display="block" id="M5" overflow="scroll"><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∼</mml:mo><mml:msup><mml:mn>2</mml:mn><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mtext>log</mml:mtext></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mtext>log</mml:mtext></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msup></mml:mrow></mml:math></disp-formula> following a similar approach as previously
implemented in RaceID<sup><xref rid="R9" ref-type="bibr">9</xref></sup>, to
share information across genes with similar expression levels. The variance
derived from this function fit for a fixed mean uniquely defines a negative
binomial distribution, which serves as a background model.<disp-formula id="FD5"><label>(5)</label><mml:math display="block" id="M6" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mtext>NB</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>;</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p>
        <p id="P16">For every cell <italic>j</italic> a background model is inferred
based on the local mean <italic>μ</italic><sub>ij</sub> for each gene
<italic>i</italic>. To account for the impact of sampling noise and to
avoid skewing of the mean estimate by neighbors sampled from a distinct
distribution representing a different cell state, a local expression mean
for cell <italic>j</italic> is computed as a weighted mean across the cell
<italic>j</italic> and its k-nearest neighbors. The cell
<italic>j</italic> receives a user defined weight α and the
weights <italic>wl</italic> of its k-nearest neighbors are determined by
their relative similarities. This is achieved by representing the
size-normalized transcript count vector <italic>z<sub>j</sub></italic> of a
cell <italic>j</italic> as a weighted sum of the size-normalized transcript
count vectors <italic>z<sub>l</sub></italic> of its k-nearest neighbors
(<italic>l</italic> =
<italic>j1</italic>,…,<italic>jk</italic>).<disp-formula id="FD6"><label>(6)</label><mml:math display="block" id="M7" overflow="scroll"><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>≅</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mspace width="2.0em"/><mml:msub><mml:mi>z</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>G</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle><mml:mspace width="2.0em"/><mml:mn>0</mml:mn><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn><mml:mspace width="2.0em"/><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula><disp-formula id="FD7"><label>(7)</label><mml:math display="block" id="M8" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mi>α</mml:mi><mml:mi>W</mml:mi></mml:mfrac><mml:mo>⋅</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:mrow><mml:mi>W</mml:mi></mml:mfrac><mml:mo>⋅</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mspace width="2.0em"/><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:mi>α</mml:mi><mml:mo>+</mml:mo></mml:mrow></mml:mstyle><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p>
        <p id="P17">Here, <italic>x<sub>j</sub></italic> denotes the vector of
transcript counts <italic>x<sub>ij</sub></italic> for all genes
<italic>i</italic> in cell <italic>j</italic>. The inference of the
weights <italic>wl</italic> is an optimization problem, which is solved by
quadratic programming. α determines the weight of the central cell
<italic>j</italic> in comparison to its neighbor and thus controls the
degree of locality for the mean expression estimate.</p>
        <p id="P18">The local mean <italic>μ<sub>j</sub></italic> denotes the
vector of mean expression values <italic>μ<sub>ij</sub></italic> for
all genes <italic>i</italic> in cell <italic>j</italic> and uniquely defines
a local transcript count distribution based on the inferred variance-mean
relation (<xref ref-type="disp-formula" rid="FD5">eq. (5)</xref>). For each
of the knns, the probability of the observed transcript count is computed
for every gene from this local distribution. More precisely, for every gene
the hypothesis is tested that the observed expression is explained by the
respective distribution, and the p-value for rejecting this hypothesis is
computed as the probability of residing in one of the two tails of the
distribution, i.e. a two-sided test is performed. The total number of null
hypotheses thus corresponds to the number of tested genes. In order to
control for the family-wise error rate at a given p-value threshold, a
Bonferroni correction is performed, resulting in link probabilities
<italic>p<sup>i</sup><sub>jl</sub></italic> for gene
<italic>i</italic> between cell <italic>j</italic> and its k-nearest
neighbors (<italic>l</italic> =
<italic>j</italic><sub>1</sub>,…,<italic>j<sub>k</sub></italic>).
The minimum of these link probabilities, <italic>p<sub>jl</sub></italic>
=min<italic><sub>i</sub></italic>(<italic>p<sup>i</sup><sub>jl</sub></italic>)
is compared to a probability threshold (<italic>P<sub>tr</sub></italic> =
0.01 by default) and all neighbors with <italic>p<sub>jl</sub></italic>
&lt; <italic>P<sub>tr</sub></italic> are pruned. This minimum is also
assigned as link probability for further analysis.</p>
        <p id="P19">The resulting pruned knn network connects only cells sampled from
overlapping transcript count distributions across all genes. To accelerate
the computation, the pruning procedure can be performed on a subset of
selected genes, e.g. based on expression or enhanced variability. The latter
is implemented in VarID using the RaceID3 criterion for the selection of
highly variable genes, i.e. genes with expression variance exceeding the
background level (<xref ref-type="disp-formula" rid="FD5">eq.
(5)</xref>).</p>
      </sec>
      <sec id="S4">
        <title>Inferring cell type clusters and transition probabilities</title>
        <p id="P20">The pruned knn network can be used to derive cell types by Louvain
clustering. These clusters enable an improved separation of cell types and
states compared to Louvain clustering on the unpruned network. Transition
probabilities reflecting the inter-cluster connectivity can be derived based
on the probability <italic>p<sub>jl</sub></italic> of links connecting cells
in different clusters. The underlying idea is to model the probability of
transitioning into a different cluster within one step on the knn
network.</p>
        <p id="P21">First, a cell <italic>j</italic> is selected randomly, i.e. with
probability <italic>p<sup>c</sup></italic>=1/<italic>n<sub>c</sub></italic>
if <italic>n<sub>c</sub></italic> is the number of cells in cluster
<italic>c</italic>. Next, the link probabilities
<italic>p<sub>jl</sub></italic> are multiplied by the probability
<italic>p<sup>l</sup></italic>=1/<italic>n<sub>l</sub></italic> of
randomly selecting a link, if <italic>n<sub>l</sub></italic> is the number
of remaining links after pruning, giving the probability of transitioning
across a particular link in a cluster:<disp-formula id="FD8"><label>(8)</label><mml:math display="block" id="M9" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>l</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>⋅</mml:mo><mml:mspace width="0.4em"/><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p>
        <p id="P22">The transition probability between two clusters <italic>c</italic>1
and <italic>c</italic>2 is now be computed by summing up the probabilities
of all links connecting these clusters:<disp-formula id="FD9"><label>(9)</label><mml:math display="block" id="M10" overflow="scroll"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:msub><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>l</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></disp-formula></p>
      </sec>
      <sec id="S5">
        <title>Estimating local variability</title>
        <p id="P23">The main goal of VarID is the quantification of local properties
relying on the availability of local neighborhoods with homogenous cell
state composition. We focus on the quantification of local gene expression
variability. In the following sections, we describe two alternative
approaches for the elimination of the variance-mean dependence implemented
in VarID.</p>
        <p id="P24">
          <bold>Option 1: Direct regression of the variance-mean
dependence</bold>
        </p>
        <p id="P25">A major problem is the dependence of the transcript count variance
on the average transcript count. We observed that the baseline level of the
variance as a function of the mean exhibits a convex behavior after
log-transformation. This is mainly due to the presence of two sources of
technical noise, i.e. sampling noise and global cell-to-cell variability in
sequencing efficiency on top of biological variability<sup><xref rid="R2" ref-type="bibr">2</xref></sup>. To capture the baseline
level of the noise, we split the gene variances into 100 equally populated
bins after ordering by increasing mean expression. For each bin, we retain
only the data points with variances below the 5%-quantile of the variance
distribution within this bin. We then performed a least square regression of
a second order polynomial to the remaining data points across all bins (cf.
<xref ref-type="disp-formula" rid="FD4">eq. (4)</xref>) to obtain a
function <italic>v<sub>b</sub></italic> capturing the baseline variability
as a function of mean expression <italic>m</italic>.<disp-formula id="FD10"><label>(10)</label><mml:math display="block" id="M11" overflow="scroll"><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∼</mml:mo><mml:msup><mml:mn>2</mml:mn><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mtext>log</mml:mtext></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mtext>log</mml:mtext></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msup></mml:mrow></mml:math></disp-formula></p>
        <p id="P26">The local variability <italic>v<sup>l</sup><sub>ij</sub></italic> of
gene <italic>i</italic> in the neighborhood of cell <italic>j</italic>,
given by cell <italic>j</italic> and its nearest neighbors
(<italic>l</italic> =
<italic>j<sub>1</sub></italic>,…,<italic>j<sub>p</sub></italic>)
that remained after pruning, is now estimated as the variance of the
transcript counts <italic>x<sub>il</sub></italic> across the neighborhood of
cell <italic>j</italic>, divided by
<italic>v<sub>b</sub></italic>(<italic>m<sub>ij</sub></italic>),
where <italic>m<sub>ij</sub></italic> is the mean of the transcript counts
<italic>x<sub>il</sub></italic> of gene <italic>i</italic> across
the pruned neighborhood of cell <italic>j</italic>:<disp-formula id="FD11"><label>(11)</label><mml:math display="block" id="M12" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mi>l</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>j</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mo>⋅</mml:mo><mml:mi>v</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mspace width="2.0em"/><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>p</mml:mi></mml:mfrac><mml:mo>⋅</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>...</mml:mn><mml:mo>,</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>j</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p>
        <p id="P27">
          <bold>Option 2: Eliminating the variance-mean dependence regressing
out total transcript counts from the expression data</bold>
        </p>
        <p id="P28">As an alternative approach, the local variability
<italic>v<sup>lp</sup>ij</italic> of gene <italic>i</italic> in the
neighbourhood of cell <italic>j</italic> is computed as the variance of the
Pearson residuals computed from a negative binomial generalized linear model
with log link function (<xref ref-type="disp-formula" rid="FD1">eq.
(1)</xref>):<disp-formula id="FD12"><label>(12)</label><mml:math display="block" id="M13" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow><mml:mi>p</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mspace width="3.0em"/><mml:msubsup><mml:mi>m</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow><mml:mi>p</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>p</mml:mi></mml:mfrac><mml:mo>⋅</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:msub><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula><disp-formula id="FD13"><label>(13)</label><mml:math display="block" id="M14" overflow="scroll"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mspace width="3.0em"/><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mtext>log</mml:mtext></mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>n</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:mrow></mml:msup><mml:mspace width="3.0em"/><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>l</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mrow><mml:mi>θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:msqrt></mml:mrow></mml:math></disp-formula>with<disp-formula id="FD14"><label>(14)</label><mml:math display="block" id="M15" overflow="scroll"><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="3.0em"/><mml:msub><mml:mi>n</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>G</mml:mi></mml:msubsup><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p>
      </sec>
    </sec>
    <sec id="S6">
      <title>Pathway Enrichment Analysis</title>
      <p id="P29">Symbol gene IDs were first converted to Entrez gene IDs. Pathway
enrichment analysis was implemented using the ReactomePA<sup><xref rid="R22" ref-type="bibr">22</xref></sup> package (v1.22.0). Pathway
enrichment analysis was done on genes taken from the different modules in the
SOMs. All expressed genes remaining after expression filtering were taken as
universe.</p>
    </sec>
    <sec id="S7">
      <title>VarID parameters</title>
      <p id="P30">For the analysis of the murine hematopoietic progenitors<sup><xref rid="R10" ref-type="bibr">10</xref></sup>, we downloaded the dataset
GSE89754 from GEO and extracted the raw unique molecular identifier (UMI) counts
for the basal bone marrow data and for the EPO-treated condition. VarID is
integrated in the RaceID analysis pipeline and part of RaceID v0.1.4 available
on CRAN. We removed the following genes and correlating gene groups in the
filtering step (CGenes parameter): mitochondrial genes (<italic>mt</italic>*),
ribosomal genes (<italic>Rpl</italic>*, <italic>Rps</italic>*), and predicted
genes with Gm-identifiers (<italic>Gm</italic>*). Only cells with at least 1,000
transcripts were retained. We ran VarID with no_cores=5 and default parameters
otherwise. For the analysis of murine intestinal epithelial cells<sup><xref rid="R20" ref-type="bibr">20</xref></sup>, we downloaded dataset
GSE92332 from GEO and extract the atlas UMI counts. We noticed that libraries
from male and female mice were combined in this dataset. Libraries B1 and B2
upregulated <italic>Xist</italic> expression and clustered separately from the
remaining libraries in an initial analysis. To avoid a strong gender-related
batch effect, we discarded these libraries. We removed the following genes and
correlating gene groups in the filtering step (CGenes parameter): the
proliferation marker <italic>Mki67</italic>, ribosomal genes
(<italic>Rpl</italic>*, <italic>Rps</italic>*), and predicted genes with
Gm-identifiers (<italic>Gm</italic>*). Only cells with at least 1,000
transcripts were retained. We ran VarID with regNB=FALSE for the pruning step,
no_cores=5, and default parameters otherwise.</p>
    </sec>
    <sec id="S8">
      <title>Seurat analysis</title>
      <p id="P31">Seurat (v3.0.0) was run on the raw counts but retaining only genes and
cells that remained after the VarID filtering step in order to ensure
comparability. We chose default parameters and resolution=1. We tested
increasing the resolution parameter, but this led to more unstable clusters and
did not improve the detection of rare populations.</p>
    </sec>
    <sec id="S9">
      <title>Prediction of Gene Regulatory Network</title>
      <p id="P32">To infer gene regulatory networks GENIE3<sup><xref rid="R14" ref-type="bibr">14</xref></sup> was run using the R Bioconductor package
GENIE3<sup><xref rid="R23" ref-type="bibr">23</xref></sup> (v1.0.0) with
default parameters on the full dataset. For the hematopoietic progenitor
dataset, links with importance &gt;0.095 where retained. For the intestinal
dataset, links with importance &gt;0.08 were retained.</p>
    </sec>
    <sec id="S10">
      <title>Differential gene expression analysis</title>
      <p id="P33">Differential gene expression analysis was performed using the diffexpnb
function of the RaceID3 (v0.1.4) algorithm. Differentially expressed genes
between two subgroups of cells were identified similar to a previously published
method<xref rid="R24" ref-type="bibr">24</xref>. First, negative binomial
distributions reflecting the gene expression variability within each subgroup
were inferred based on the background model for the expected transcript count
variability computed by RaceID3. Based on these distributions, a p-value for the
observed difference in transcript counts between the two subgroups was
calculated and multiple testing corrected by the Benjamini-Hochberg method.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="SM">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>Supplementary results</label>
      <media xlink:href="EMS84577-supplement-Supplementary_results.pdf" mimetype="application" mime-subtype="pdf" orientation="portrait" xlink:type="simple" id="d36e2413" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>Supplementary figures</label>
      <media xlink:href="EMS84577-supplement-Supplementary_figures.pdf" mimetype="application" mime-subtype="pdf" orientation="portrait" xlink:type="simple" id="d36e2417" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD3">
      <label>Scripts</label>
      <media xlink:href="EMS84577-supplement-Scripts.zip" mimetype="application" mime-subtype="zip" orientation="portrait" xlink:type="simple" id="d36e2421" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S11">
    <title>Acknowledgments</title>
    <p>This study was supported by the Max Planck Society, the German Research Foundation
(DFG) (SPP1937 GR4980/1-1, GR4980/3-1, and GRK2344 MeInBio), by the DFG under
Germany’s Excellence Strategy (CIBSS – EXC-2189 – Project ID
390939984), by the ERC (818846 — ImmuNiche — ERC-2018-COG), and by the
Behrens-Weise-Foundation.</p>
  </ack>
  <fn-group>
    <fn id="FN1" fn-type="con">
      <p id="P34">
        <bold>Author Contributions</bold>
      </p>
      <p id="P35">D. G. conceived the method and performed the analysis</p>
    </fn>
    <fn fn-type="COI-statement" id="FN2">
      <p id="P36">
        <bold>Competing interests</bold>
      </p>
      <p id="P37">The author declares no competing interests.</p>
    </fn>
    <fn id="FN3">
      <p id="P38">
        <bold>Data availability</bold>
      </p>
      <p id="P39">Primary data used in this manuscript was downloaded from GEO with
accession code GSE89754 for the hematopoietic data<sup><xref rid="R10" ref-type="bibr">10</xref></sup>, and GSE92332 for the intestinal
data<sup><xref rid="R20" ref-type="bibr">20</xref></sup>.</p>
    </fn>
    <fn id="FN4">
      <p id="P40">
        <bold>Code availability</bold>
      </p>
      <p id="P41">VarID is integrated in the RaceID v0.1.4 package available from CRAN or
github (<ext-link ext-link-type="uri" xlink:href="https://github.com/dgrun/RaceID3_StemID2_package">https://github.com/dgrun/RaceID3_StemID2_package</ext-link>). Source code
for reproducing the results of this manuscript is available on github (<ext-link ext-link-type="uri" xlink:href="https://github.com/dgrun/VarID_analysis">https://github.com/dgrun/VarID_analysis</ext-link>).</p>
    </fn>
  </fn-group>
  <ref-list>
    <ref id="R1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grün</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Revealing routes of cellular differentiation by single-cell
RNA-seq</article-title>
        <source>Curr Opin Syst Biol</source>
        <year>2018</year>
        <volume>11</volume>
        <fpage>9</fpage>
        <lpage>17</lpage>
      </element-citation>
    </ref>
    <ref id="R2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grün</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Kester</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>van Oudenaarden</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Validation of noise models for single-cell
transcriptomics</article-title>
        <source>Nat Methods</source>
        <year>2014</year>
        <volume>11</volume>
        <fpage>637</fpage>
        <lpage>40</lpage>
        <pub-id pub-id-type="pmid">24747814</pub-id>
      </element-citation>
    </ref>
    <ref id="R3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vallejos</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
          <name>
            <surname>Richardson</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>BASiCS: Bayesian Analysis of Single-Cell Sequencing
Data</article-title>
        <source>PLoS Comput Biol</source>
        <year>2015</year>
        <volume>11</volume>
        <fpage>e1004333</fpage>
        <pub-id pub-id-type="pmid">26107944</pub-id>
      </element-citation>
    </ref>
    <ref id="R4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eling</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Richard</surname>
            <given-names>AC</given-names>
          </name>
          <name>
            <surname>Richardson</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
          <name>
            <surname>Vallejos</surname>
            <given-names>CA</given-names>
          </name>
        </person-group>
        <article-title>Correcting the Mean-Variance Dependency for Differential
Variability Testing Using Single-Cell RNA Sequencing Data</article-title>
        <source>Cell Syst</source>
        <year>2018</year>
        <volume>7</volume>
        <fpage>284</fpage>
        <lpage>294.e12</lpage>
        <pub-id pub-id-type="pmid">30172840</pub-id>
      </element-citation>
    </ref>
    <ref id="R5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Macosko</surname>
            <given-names>EZ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly Parallel Genome-wide Expression Profiling of Individual
Cells Using Nanoliter Droplets</article-title>
        <source>Cell</source>
        <year>2015</year>
        <volume>161</volume>
        <fpage>1202</fpage>
        <lpage>1214</lpage>
        <pub-id pub-id-type="pmid">26000488</pub-id>
      </element-citation>
    </ref>
    <ref id="R6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Farrell</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Gennert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schier</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Spatial reconstruction of single-cell gene expression
data</article-title>
        <source>Nat Biotechnol</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>495</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="pmid">25867923</pub-id>
      </element-citation>
    </ref>
    <ref id="R7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Setty</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Wishbone identifies bifurcating developmental trajectories from
single-cell data</article-title>
        <source>Nat Biotechnol</source>
        <year>2016</year>
        <volume>34</volume>
        <fpage>637</fpage>
        <lpage>645</lpage>
        <pub-id pub-id-type="pmid">27136076</pub-id>
      </element-citation>
    </ref>
    <ref id="R8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Herman</surname>
            <given-names>JS</given-names>
          </name>
          <name>
            <surname>Sagar</surname>
          </name>
          <name>
            <surname>Grün</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>FateID infers cell fate bias in multipotent progenitors from
single-cell RNA-seq data</article-title>
        <source>Nat Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>379</fpage>
        <lpage>386</lpage>
        <pub-id pub-id-type="pmid">29630061</pub-id>
      </element-citation>
    </ref>
    <ref id="R9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grün</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell messenger RNA sequencing reveals rare intestinal cell
types</article-title>
        <source>Nature</source>
        <year>2015</year>
        <volume>525</volume>
        <fpage>251</fpage>
        <lpage>5</lpage>
        <pub-id pub-id-type="pmid">26287467</pub-id>
      </element-citation>
    </ref>
    <ref id="R10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tusi</surname>
            <given-names>BK</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Population snapshots predict early haematopoietic and erythroid
hierarchies</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>555</volume>
        <fpage>54</fpage>
        <lpage>60</lpage>
        <pub-id pub-id-type="pmid">29466336</pub-id>
      </element-citation>
    </ref>
    <ref id="R11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Brennecke</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Accounting for technical noise in single-cell RNA-seq
experiments</article-title>
        <source>Nat Methods</source>
        <year>2013</year>
        <volume>10</volume>
        <fpage>1093</fpage>
        <lpage>5</lpage>
        <pub-id pub-id-type="pmid">24056876</pub-id>
      </element-citation>
    </ref>
    <ref id="R12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hafemeister</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Normalization and variance stabilization of single-cell RNA-seq
data using regularized negative binomial regression</article-title>
        <source>bioRxiv</source>
        <year>2019</year>
        <pub-id pub-id-type="doi">10.1101/576827</pub-id>
        <comment>576827</comment>
      </element-citation>
    </ref>
    <ref id="R13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>AnimalTFDB 3.0: a comprehensive resource for annotation and
prediction of animal transcription factors</article-title>
        <source>Nucleic Acids Res</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>D33</fpage>
        <lpage>D38</lpage>
        <pub-id pub-id-type="pmid">30204897</pub-id>
      </element-citation>
    </ref>
    <ref id="R14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huynh-Thu</surname>
            <given-names>VA</given-names>
          </name>
          <name>
            <surname>Irrthum</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wehenkel</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Geurts</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Inferring Regulatory Networks from Expression Data Using
Tree-Based Methods</article-title>
        <source>PLoS One</source>
        <year>2010</year>
        <volume>5</volume>
        <fpage>e12776</fpage>
        <pub-id pub-id-type="pmid">20927193</pub-id>
      </element-citation>
    </ref>
    <ref id="R15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liting</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Gerstein</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Socolovsky</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Castilla</surname>
            <given-names>LH</given-names>
          </name>
        </person-group>
        <article-title>Deletion Of Core Binding Factors Runx1 and Runx2 Leads To
Perturbed Hematopoiesis In Multiple Lineages</article-title>
        <source>Blood</source>
        <year>2013</year>
        <volume>122</volume>
      </element-citation>
    </ref>
    <ref id="R16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Komorowska</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Hepatic Leukemia Factor Maintains Quiescence of Hematopoietic
Stem Cells and Protects the Stem Cell Pool during
Regeneration</article-title>
        <source>Cell Rep</source>
        <year>2017</year>
        <volume>21</volume>
        <fpage>3514</fpage>
        <lpage>3523</lpage>
        <pub-id pub-id-type="pmid">29262330</pub-id>
      </element-citation>
    </ref>
    <ref id="R17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Paul</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transcriptional Heterogeneity and Lineage Commitment in Myeloid
Progenitors</article-title>
        <source>Cell</source>
        <year>2015</year>
        <volume>163</volume>
        <fpage>1663</fpage>
        <lpage>1677</lpage>
        <pub-id pub-id-type="pmid">26627738</pub-id>
      </element-citation>
    </ref>
    <ref id="R18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Doi</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SATB1 Expression Marks Lymphoid-Lineage-Biased Hematopoietic Stem
Cells in Mouse Bone Marrow</article-title>
        <source>Blood</source>
        <year>2015</year>
        <volume>126</volume>
      </element-citation>
    </ref>
    <ref id="R19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jones</surname>
            <given-names>CL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ETV6 Regulates Pax5 Expression in Early B Cell
Development</article-title>
        <source>Blood</source>
        <year>2016</year>
        <volume>128</volume>
      </element-citation>
    </ref>
    <ref id="R20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Haber</surname>
            <given-names>AL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell survey of the small intestinal
epithelium</article-title>
        <source>Nature</source>
        <year>2017</year>
        <volume>551</volume>
        <fpage>333</fpage>
        <lpage>339</lpage>
        <pub-id pub-id-type="pmid">29144463</pub-id>
      </element-citation>
    </ref>
    <ref id="R21">
      <label>21</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>McInnes</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Healy</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Melville</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <source>UMAP: Uniform Manifold Approximation and Projection for Dimension
Reduction</source>
        <year>2018</year>
        <comment>Preprint at arXiv <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1802.03426v2">https://arxiv.org/abs/1802.03426v2</ext-link></comment>
      </element-citation>
    </ref>
    <ref id="R22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yu</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>He</surname>
            <given-names>Q-Y</given-names>
          </name>
        </person-group>
        <article-title>ReactomePA: an R/Bioconductor package for reactome pathway
analysis and visualization</article-title>
        <source>Mol Biosyst</source>
        <year>2016</year>
        <volume>12</volume>
        <fpage>477</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="pmid">26661513</pub-id>
      </element-citation>
    </ref>
    <ref id="R23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aibar</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SCENIC: single-cell regulatory network inference and
clustering</article-title>
        <source>Nat Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>1083</fpage>
        <lpage>1086</lpage>
        <pub-id pub-id-type="pmid">28991892</pub-id>
      </element-citation>
    </ref>
    <ref id="R24">
      <label>24</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Anders</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Huber</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Differential expression analysis for sequence count
data</article-title>
        <source>Genome Biol</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>R106</fpage>
        <pub-id pub-id-type="pmid">20979621</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <title>Locally homogenous neighborhoods enable sensitive cell type
identification.</title>
      <p><bold>a</bold>, Strategy for inferring locally homogenous neighborhoods by
pruning knn-networks. Links are removed if the transcript levels in a
neighboring cell are not explained by a local background model. Thickness of
links represents the likelihood of belonging to the same cell state.
<bold>b</bold>, Uniform Manifold Approximation and Projection for Dimension
Reduction (UMAP) representation<sup><xref rid="R21" ref-type="bibr">21</xref></sup> of mouse hematopoietic progenitor single-cell RNA-seq
data<sup><xref rid="R10" ref-type="bibr">10</xref></sup> highlighting
clusters inferred by Louvain clustering on the pruned knn-network (k=10 and
α=10). Cell type labels are based on marker gene expression.
<bold>c</bold>, Dot plot showing the expression z-score of lineage-specific
marker genes across all clusters from (b). The dot size indicates the fraction
of cells expressing a gene. <bold>d</bold>, Dot plot showing expression of
lineage-specific marker genes across all clusters inferred by Seurat<sup><xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R6" ref-type="bibr">6</xref></sup>. See (c) for details. <bold>e</bold>, UMAP
representation with links connecting cluster medoids. The thickness and color of
a link indicates the transition probability between the connected clusters.
(b-d) Data from n=2 biologically independent experiments.</p>
    </caption>
    <graphic xlink:href="EMS84577-f001"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <title>Inferring local variability in hematopoietic progenitor cell state
space.</title>
      <p><bold>a</bold>, Scatterplot showing variance and mean of the transcript count of
all genes across all cells in the mouse hematopoietic dataset in logarithmic
space. The red line indicates a second order polynomial fit to the baseline
level of the variance comprising technical and biological variability.
<bold>b</bold>, Scatterplot showing corrected variance of transcript counts
as a function of the mean in logarithmic space after eliminating the
mean-dependence by subtracting the baseline fit. The red line indicates the
baseline level of the corrected variability. <bold>c</bold>, UMAP representation
highlighting normalized gene expression (upper panel) and corrected variability
(lower panel) for <italic>Gata1</italic> (left) and <italic>Mpo</italic>
(right). The black arrow indicates the erythrocyte (left) or neutrophil (right)
differentiation trajectory. <bold>d</bold>, Venn diagram showing the overlap of
genes with enhanced local variability (one-sided Wilcoxon rank sum-test
<italic>P</italic>&lt;0.001, Benjamini Hochberg corrected, foldchange
&gt;1.25) and differentially expressed genes
(<italic>P</italic>&lt;0.001, Benjamini Hochberg corrected, see <xref ref-type="sec" rid="S1">Methods</xref>, foldchange &gt;1.25 between the
populations) in cluster 16 versus the remaining cells. <bold>e</bold>, Heatmap
of normalized expression (left) and corrected variance (right) for the top 50
genes with enhanced variability from (d) ordered by decreasing
log<sub>2</sub>-foldchange of variability between cluster 16 and the remaining
cells. Clusters were manually grouped by lineage. Hierarchical clustering of
rows was performed based on gene expression. <bold>f</bold>, Gene regulatory
network predicted by GENIE3 run on all transcriptional regulators among the
genes with enhanced variability, using the full dataset as input. (a-e) Data
from n=2 biologically independent experiments.</p>
    </caption>
    <graphic xlink:href="EMS84577-f002"/>
  </fig>
  <fig id="F3" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <title>Exploring dynamics of gene expression variability during neutrophil
differentiation.</title>
      <p><bold>a</bold>, Separate RaceID3/StemID2<sup><xref rid="R8" ref-type="bibr">8</xref></sup> analysis all cells from the original clusters 16, 5, 3,
and 11. The link color indicates the link p-value and the vertex color
represents transcriptome entropy. The link p-value and transcriptome entropies
were derived by StemID2<sup><xref rid="R8" ref-type="bibr">8</xref></sup>.
<bold>b</bold>, Self-organizing map (SOM) of pseudo-temporal corrected
variability profiles inferred by FateID<sup><xref rid="R8" ref-type="bibr">8</xref></sup> using the variability matrix as input. The color
indicates the z-score of loess-smoothed profiles. Cells were ordered along the
trajectory connecting clusters 5, 4, 3, 7, 1, and 2 in (a) by StemID2. Original
clusters (cf. <xref ref-type="fig" rid="F1">Fig. 1b</xref>) are highlighted at
the bottom. Modules were obtained by grouping SOM nodes based on correlation of
averaged profiles (Pearson correlation &gt; 0.85). Only modules with
&gt;10 genes are shown in the map. Genes with &gt;2 transcripts in at
least one cell were included. <bold>c</bold>, Pseudo-temporal variability (left)
and corresponding gene expression (right) profiles averaged across all genes in
a module. Pseudo-temporal profiles were normalized to the same scale by dividing
transcript counts and corrected variabilities by the sum across all cells on the
trajectory. (a-c) Data from n=2 biologically independent experiments.</p>
    </caption>
    <graphic xlink:href="EMS84577-f003"/>
  </fig>
</floats-group>
