<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature Methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
    <publisher>
      <publisher-name>Nature Publishing Group US</publisher-name>
      <publisher-loc>New York</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10250198</article-id>
    <article-id pub-id-type="pmid">37188953</article-id>
    <article-id pub-id-type="publisher-id">1878</article-id>
    <article-id pub-id-type="doi">10.1038/s41592-023-01878-z</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>TomoTwin: generalized 3D localization of macromolecules in cryo-electron tomograms with structural data mining</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Rice</surname>
          <given-names>Gavin</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1"/>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1550-8275</contrib-id>
        <name>
          <surname>Wagner</surname>
          <given-names>Thorsten</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0191-6419</contrib-id>
        <name>
          <surname>Stabrin</surname>
          <given-names>Markus</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-4496-7489</contrib-id>
        <name>
          <surname>Sitsel</surname>
          <given-names>Oleg</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Prumbaum</surname>
          <given-names>Daniel</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1"/>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9373-3016</contrib-id>
        <name>
          <surname>Raunser</surname>
          <given-names>Stefan</given-names>
        </name>
        <address>
          <email>stefan.raunser@mpi-dortmund.mpg.de</email>
        </address>
        <xref ref-type="aff" rid="Aff1"/>
      </contrib>
      <aff id="Aff1"><institution-wrap><institution-id institution-id-type="GRID">grid.418441.c</institution-id><institution-id institution-id-type="ISNI">0000 0004 0491 3333</institution-id><institution>Department of Structural Biochemistry, </institution><institution>Max Planck Institute of Molecular Physiology, </institution></institution-wrap>Dortmund, Germany </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>15</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>15</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <year>2023</year>
    </pub-date>
    <volume>20</volume>
    <issue>6</issue>
    <fpage>871</fpage>
    <lpage>880</lpage>
    <history>
      <date date-type="received">
        <day>24</day>
        <month>6</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>12</day>
        <month>4</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Cryogenic-electron tomography enables the visualization of cellular environments in extreme detail, however, tools to analyze the full amount of information contained within these densely packed volumes are still needed. Detailed analysis of macromolecules through subtomogram averaging requires particles to first be localized within the tomogram volume, a task complicated by several factors including a low signal to noise ratio and crowding of the cellular space. Available methods for this task suffer either from being error prone or requiring manual annotation of training data. To assist in this crucial particle picking step, we present TomoTwin: an open source general picking model for cryogenic-electron tomograms based on deep metric learning. By embedding tomograms in an information-rich, high-dimensional space that separates macromolecules according to their three-dimensional structure, TomoTwin allows users to identify proteins in tomograms de novo without manually creating training data or retraining the network to locate new proteins.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">TomoTwin is a deep metric learning-based particle picking method for cryo-electron tomograms. TomoTwin obviates the need for annotating training data and retraining a picking model for each protein.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Image processing</kwd>
      <kwd>Software</kwd>
      <kwd>Cryoelectron tomography</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100004189</institution-id>
            <institution>Max-Planck-Gesellschaft (Max Planck Society)</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature America, Inc. 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Main</title>
    <p id="Par3">Cryogenic-electron tomography (cryo-ET) has emerged as a landmark technique for the visualization of macromolecules within their native cellular environment<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR7">7</xref></sup>. Advances in high-pressure freezing and focused ion beam milling at cryogenic temperatures now allow for the routine preparation of thin (less than 200 nm) lamellae from cells or even small organisms<sup><xref ref-type="bibr" rid="CR8">8</xref>–<xref ref-type="bibr" rid="CR10">10</xref></sup>. Cryo-ET offers a unique opportunity to capture cellular processes in three dimensions and in unprecedented detail, and subsequent analysis of specific macromolecules from tomograms through subtomogram averaging (STA) allows for in-depth structural determination of macromolecular complexes in situ<sup><xref ref-type="bibr" rid="CR11">11</xref>–<xref ref-type="bibr" rid="CR14">14</xref></sup>. Particularly when complemented by recent advances in structure prediction such as alphafold2, STA forms a powerful crossbridge between protein biochemistry and cellular proteomics<sup><xref ref-type="bibr" rid="CR15">15</xref>–<xref ref-type="bibr" rid="CR17">17</xref></sup>. To perform STA, however, particles of a macromolecule of interest must first be located within the tomograms, a task complicated by the three-dimensional (3D) nature of these data.</p>
    <p id="Par4">The accurate localization of macromolecules inside cryo-electron tomograms is a well-recognized barrier for studying cellular life at the mesoscopic level<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. This has led to the development of several deep learning-based tools often leveraging popular 3D-Unet convolutional neural network (CNN) architectures<sup><xref ref-type="bibr" rid="CR19">19</xref>–<xref ref-type="bibr" rid="CR21">21</xref></sup>. None of these approaches, however, have been able to demonstrate generalization, meaning that for each protein of interest, users must first manually annotate hundreds to thousands of particles in tomograms and train the neural network to identify that protein. Not only is this incompatible with the future directions of automated tomogram reconstruction and STA, but for most of the proteome, manually annotating sufficient training data from experimental tomograms to train the network is not possible. As a result, these deep learning tools cannot currently assist in answering many of the outstanding biological questions for which cryo-ET presents vast potential. Owing to this issue of usability, template matching<sup><xref ref-type="bibr" rid="CR22">22</xref>,<xref ref-type="bibr" rid="CR23">23</xref></sup> is still highly used in cryo-ET processing workflows, especially those that place an emphasis on throughput<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>, although this technique suffers notably by comparison in terms of picking accuracy, often limiting the overall effectiveness of STA.</p>
    <p id="Par5">To date, no methods have demonstrated the accuracy of deep learning-based picking with an unexceptionable level of usability for cryo-ET. One method to retain this accuracy while circumventing the requirement of manually annotating training data for each protein of interest is to train a model to learn a generalized representation of a 3D molecular shape that then can differentiate between macromolecules based on their structure. Such general models have seen a high uptake in two-dimensional (2D) particle picking for single particle cryo-electron microscopy (cryo-EM) analysis<sup><xref ref-type="bibr" rid="CR25">25</xref>–<xref ref-type="bibr" rid="CR28">28</xref></sup> although the translation of these methods to tomograms is still lacking due to the additional challenges posed by 3D tomography data.</p>
    <p id="Par6">Particularly well suited to this challenging case of generalization is deep metric learning in which data are encoded as a high-dimensional representation, called an embedding<sup><xref ref-type="bibr" rid="CR29">29</xref>,<xref ref-type="bibr" rid="CR30">30</xref></sup>. During training, the model is penalized for placing data from different classes near to one another and rewarded for placing data from the same class close together in the embedding space<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. Therefore, over the training process the model learns to cluster each class in a distinct region of the embedding space where similar classes are placed closer together and dissimilar ones further apart. In some cases, the embeddings of a dataset are sufficiently ordered to allow for de novo identification of classes in the embedding space<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. By understanding similarity relationships, deep metric learning models have demonstrated an acute generalizability, being able to place new classes of data in the embedding space according to their similarity to known classes without requiring retraining<sup><xref ref-type="bibr" rid="CR31">31</xref>–<xref ref-type="bibr" rid="CR33">33</xref></sup>.</p>
    <p id="Par7">Here we present TomoTwin, a generalized particle picking model and deep metric learning toolkit for structural data mining of cryo-electron tomograms. We supply two workflows for macromolecular localization with TomoTwin, a reference-based workflow in which a single molecule is picked for each protein of interest and used as a target, and a de novo clustering workflow where macromolecular structures of interest are identified on a 2D manifold. Trained on a diverse set of simulated tomograms, the picking model of TomoTwin can locate new proteins with high accuracy in not only simulated data, but in experimental tomograms as well. By removing the steps of annotating training data and retraining a picking model for each protein, TomoTwin combines the accuracy of deep learning-based particle picking with a high degree of usability and allows for the simultaneous picking of several proteins of interest in each tomogram.</p>
  </sec>
  <sec id="Sec2">
    <title>Overview of functions, build and philosophy behind TomoTwin</title>
    <p id="Par8">The machine learning backbone of TomoTwin is built on the principle of learning generalized representations of 3D shapes in tomograms (Extended Data Fig. <xref rid="Fig7" ref-type="fig">1b,c</xref>). Trained with deep metric learning, the 3D CNN is able to locate not only macromolecules from the training set, but generalize to new macromolecules as well, allowing TomoTwin to retain the high fidelity of deep learning-based picking while avoiding the burden of requiring retraining for each protein of interest. The general model embeds tomograms by sampling overlapping subvolumes and embedding them according to the similarity of their macromolecular contents (Extended Data Fig. <xref rid="Fig7" ref-type="fig">1d</xref>). Once a tomogram is embedded, particles of each macromolecule can be picked by identifying their associated region in the embedding space. This can be done either by identifying a single example of each protein of interest in a tomogram and using them to mark the region of the space where they are embedded (reference-based workflow), or by approximating the tomogram embeddings onto a 2D manifold where clusters for each macromolecule can be identified by eye (clustering workflow) (Fig. <xref rid="Fig1" ref-type="fig">1a,b</xref>). Once the embeddings containing a protein of interest are identified, they must be mapped back to the tomogram where overlapping picks of the same molecule can be consolidated into one centralized pick per molecule (Fig. <xref rid="Fig1" ref-type="fig">1c</xref>). Finally, TomoTwin allows users to interactively filter the picked particles for each macromolecule of interest based on the particle size and the distance between each particle and the target embedding for that macromolecule in the embedding space (Fig. <xref rid="Fig1" ref-type="fig">1d</xref> and Extended Data Fig. <xref rid="Fig7" ref-type="fig">1a</xref>).<fig id="Fig1"><label>Fig. 1</label><caption><title>TomoTwin identifies and localizes particles by a clustering or a reference-based workflow.</title><p><bold>a</bold>, The first step in using TomoTwin is to embed the tomogram with the pretrained model. Optionally, references can be selected and embedded as well to create target embeddings. <bold>b</bold>, For the clustering workflow the tomogram embeddings are projected on a 2D manifold and an interactive lasso tool is used to select clusters of interest to generate target embeddings. <bold>c</bold>, The distance matrix between each target embedding and the embeddings of the tomogram is calculated. <bold>d</bold>, All local maxima are located with TomoTwin Locate and are used to pick final coordinates for each protein of interest using TomoTwin Pick with confidence and size thresholding.</p></caption><graphic xlink:href="41592_2023_1878_Fig1_HTML" id="d32e388"/></fig></p>
  </sec>
  <sec id="Sec3">
    <title>Two workflows to locate macromolecules in tomograms</title>
    <p id="Par9">TomoTwin embeds tomograms in a high-dimensional space where subvolumes of each macromolecule are located in a distinct region of the space. To identify the location of a macromolecule in the embedding space, we provide the user with two workflows: a reference-based workflow and a clustering workflow. Each workflow picks particles with high accuracy, but the reference-based approach begins with identifying an example of the protein of interest in the tomogram and mapping this to the embedding space whereas the clustering workflow begins with identifying a region of the embedding space and mapping this to the tomogram. Which workflow is most suitable for any given application depends on how easily the protein(s) of interest can be identified in the tomogram versus the embeddings. If an example particle of a protein can be identified in a tomogram, the reference-based workflow offers a streamlined picking approach. Conversely, the clustering workflow offers advantages for exploring the macromolecular contents of a tomogram without requiring a priori knowledge. Both workflows share the common first step of using the embedding function of TomoTwin to generate a high-dimensional embedding of the entire volume of the tomogram (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>).</p>
    <p id="Par10">In the reference-based workflow, a single molecule of each protein of interest in a tomogram is embedded to generate a target embedding for that protein. In the clustering workflow, the tomogram embeddings are approximated onto a 2D manifold. This 2D manifold can then be directly used to outline one or more clusters of interest using an interactive tool. The mean embedding of the enclosed subvolumes of each cluster is then used as a target embedding in lieu of a reference (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>). The Map function of TomoTwin takes as input the tomogram embeddings and target embedding(s) and calculates the distance between the target(s) and each subvolume in the embeddings. These distances are mapped to the subvolume positions, constructing a map of proposed particle locations within the tomogram for each protein of interest (Fig. <xref rid="Fig1" ref-type="fig">1c</xref>). The Locate function uses this map to localize peaks of high similarity and generate candidate particle positions. Finally, the Pick function of TomoTwin in tandem with the graphical user interface uses these candidate positions along with adjustable size and similarity thresholds to pick particles in the tomogram producing a coordinate file for each protein of interest suitable for STA or other analysis (Fig. <xref rid="Fig1" ref-type="fig">1d</xref>).</p>
  </sec>
  <sec id="Sec4">
    <title>Training of the general picking model</title>
    <p id="Par11">TomoTwin is trained using deep metric learning on triplets of subvolumes from simulated tomograms. The triplets are constructed as sets of three subvolumes each containing a particle, two containing the same protein and one a different protein, called the anchor, positive, and negative respectively. A set of 120 structurally dissimilar proteins procured from the Protein Data Bank (PDB) ranging in size from 30 kDa to 2.7 mDa were used to simulate 84 tomograms containing a total of 120,000 particles (Extended Data Fig. <xref rid="Fig8" ref-type="fig">2</xref>). During training, batches of subvolumes are embedded by the 3D CNN that transforms each 37 × 37 × 37 subvolume to a 32-length feature vector located on a high-dimensional embedding manifold molded to the surface of a 32D hypersphere (Extended Data Fig. <xref rid="Fig7" ref-type="fig">1b</xref>). These feature vectors are then used for metric learning.</p>
    <p id="Par12">Through training, TomoTwin learns to place each macromolecule within a distinct region of the embedding space, where more structurally similar macromolecules are placed closer together and dissimilar ones further apart (Extended Data Fig. <xref rid="Fig7" ref-type="fig">1d</xref>). By training on a large, diverse set of 3D macromolecular shapes and sizes, TomoTwin learned a generalized representation of 3D macromolecular shapes that it leverages to place new macromolecules in the embedding space relative to their structural similarity to known proteins without requiring retraining.</p>
  </sec>
  <sec id="Sec5">
    <title>The picking model generalizes across protein shape and size</title>
    <p id="Par13">Because a priori information on the ground-truth locations of all molecules in a tomogram is not possible to obtain for experimental data, we first assessed the picking performance of the trained model on simulated tomograms containing proteins from the training set.</p>
    <p id="Par14">The median F1 picking score across all validation tomograms was 0.88 with a range from 0.76 to 0.98 (Extended Data Fig. <xref rid="Fig9" ref-type="fig">3a</xref>). Across all proteins in the training set ranging from 30 kDa to 2.7 mDa, the median validation F1 picking score is 0.92 (Extended Data Fig. <xref rid="Fig9" ref-type="fig">3b</xref>). In rare cases, outlier scores were observed where specific proteins could not be picked across a range of sizes (Extended Data Fig. <xref rid="Fig9" ref-type="fig">3c</xref>). Closer inspection of these outliers revealed that in the simulated tomograms, each of these proteins display a particularly weak signal when compared to proteins of similar size (Extended Data Fig. <xref rid="Fig9" ref-type="fig">3d</xref>). In these cases, the proteins display a shape that is not recovered well during tomogram reconstruction by weighted back projection. Despite this, picking on the validation tomograms demonstrated high accuracy for proteins across a wide array of shapes and sizes.</p>
  </sec>
  <sec id="Sec6">
    <title>TomoTwin generalizes to unseen proteins</title>
    <p id="Par15">To assess the generalization of the general picking model to particles that were not in the training dataset, we measured the picking performance on a simulated tomogram, called the generalization tomogram that contains proteins not included in the training set, with the reference-based workflow. When trained on a set of 120 dissimilar proteins (Extended Data Fig. <xref rid="Fig8" ref-type="fig">2</xref>), the resulting model was able to locate all seven proteins accurately with a median F1 score of 0.82 despite a lack of previous training on these proteins (Fig. <xref rid="Fig2" ref-type="fig">2d</xref>). To measure the effect of training set size on generalization accuracy we performed this analysis on picking models trained on 20, 50, 100 and 120 proteins where we observed a logarithmic increase in generalization accuracy with the number of proteins in the training set (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). This high accuracy in locating novel proteins indicates a high generalization capability of TomoTwin, a feat no other deep learning picking method for cryo-ET has reported so far.<fig id="Fig2"><label>Fig. 2</label><caption><title>The generalized model of TomoTwin locates novel proteins accurately.</title><p><bold>a</bold>, True-positive selected particles (white) and false negative (black) of the largest protein (PDB ID <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.2210/pdb2DF7/pdb">2DF7</ext-link>) (896 kDa) in the generalization tomogram. <bold>b</bold>, The smallest protein (PDB ID <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.2210/pdb1FZG/pdb">1FZG</ext-link>) (142 kDa) in the generalization tomogram. The F1 scores are 0.99 and 0.88 for largest and smallest protein, respectively. <bold>c</bold>, When increasing the number of proteins used during training, the mean F1 score for each protein (<italic>n</italic> = 7) in the generalization tomogram increased as well. The mean F1 scores are 0.49, 0.73 and 0.82 for a model trained on 20, 50 and 100 proteins, respectively. <bold>d</bold>, The model trained on the full training set of 120 proteins reached a mean F1 score of 0.82 but has the highest median F1 score of 0.85. Each box in <bold>c</bold> and <bold>d</bold> extends from the first (Q1) to the third quartile (Q3). The median is marked by a line inside the box. Whisker lines correspond to box edges ±1.5 times interquartile range. White scale bars, 100 nm; black scale bars, 5 nm.</p></caption><graphic xlink:href="41592_2023_1878_Fig2_HTML" id="d32e498"/></fig></p>
    <p id="Par16">To quantitatively measure the effect of increased particle density on picking quality, we simulated an additional generalization tomogram in which the number of particles per protein in the tomogram is increased by fivefold to replicate a highly crowded environment (Extended Data Fig. <xref rid="Fig10" ref-type="fig">4a</xref>). In this densely packed tomogram, we observe an overall mean F1 picking score of 0.82 indicating that while particle picking in dense environments containing many proteins poses an additional challenge, the picking performance of the TomoTwin general model remains unequivocal.</p>
  </sec>
  <sec id="Sec7">
    <title>TomoTwin picks proteins accurately in experimental tomograms</title>
    <p id="Par17">As TomoTwin is trained entirely on simulated data, it is paramount to investigate its ability to pick proteins of interest in experimental tomograms. To evaluate this, we tested the picking accuracy of TomoTwin on several experimental datasets.</p>
    <p id="Par18">First, cryo-ET was performed on a sample containing a mixture of three proteins, apoferritin<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>, the Type VI secretion effector RhsA from <italic>Pseudomonas protegens</italic><sup><xref ref-type="bibr" rid="CR35">35</xref></sup> and the Tc toxin A component TcdA1 from <italic>Photorhabdus luminescens</italic><sup><xref ref-type="bibr" rid="CR36">36</xref></sup> as well as liposomes (DOPC/POPC) (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>). This mixture was chosen to create a complex, crowded environment in vitro that may confound picking accuracy. Ten reconstructed tomograms were picked for apoferritin, RhsA and TcdA1 using the general model. In each case, the reference-based workflow was used in which a target embedding was created by picking a single example of each protein in one tomogram. The target embedding of each protein was then applied for picking across all tomograms in the dataset. Direct visualization of the similarity maps and picks reveals that TomoTwin identified each protein in the mixture with minimal confounding from the crowded environment, contaminants, degraded particles or nontarget proteins to achieve high-fidelity picking (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>). Additionally, the percentage of particles in good 2D classes was measured as a relative indicator of the precision (Fig. <xref rid="Fig3" ref-type="fig">3c</xref> and Extended Data Fig. <xref rid="Fig11" ref-type="fig">5c–e</xref>). This is further confirmed by manual calculation of recall and precision for TcdA1 (recall 0.81, precision 1.0) and apoferritin (recall 0.91, precision 1.0) by counting picked and missed particles (Extended Data Fig. <xref rid="Fig11" ref-type="fig">5a,b</xref>).<fig id="Fig3"><label>Fig. 3</label><caption><title>TomoTwin accurately localizes multiple proteins simultaneously in crowded tomograms.</title><p><bold>a</bold>, Representative slice of a tomogram containing a mixture of apoferritin, RhsA and TcdA1. Scale bar, 100 nm. <bold>b</bold>, Cosine similarity heatmap and representative picking for apoferritin (red), RhsA (green) and TcdA1 (blue), respectively. Total subvolumes picked were: apoferritin, 848; RhsA, 2196; and TcdA1, 122. Scale bar, 50 nm. <bold>c</bold>, Protein structures of apoferritin (PDB ID <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.2210/pdb1DAT/pdb">1DAT</ext-link>), RhsA (PDB ID <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.2210/pdb7Q97/pdb">7Q97</ext-link>) and TcdA1 (PDB ID <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.2210/pdb6L7E/pdb">6L7E</ext-link>) and the ratio of picked subvolumes contained in selected good and bad 2D classes. Scale bar, 100 nm. Supplementary Video <xref rid="MOESM3" ref-type="media">1</xref> is a video going through the tomogram in the <italic>z</italic> direction with the individual picks for TcdA1, apoferritin and RhsA highlighted.</p></caption><graphic xlink:href="41592_2023_1878_Fig3_HTML" id="d32e583"/></fig></p>
    <p id="Par19">This picking result affirms several aspects of the generalizability of TomoTwin for particle picking in tomograms. Foremost, that TomoTwin generalizes to new proteins without requiring retraining as none of these proteins were included in the training set. Of equal importance, the high-fidelity picking indicates that TomoTwin, trained on simulated tomograms, can also be applied to experimental tomograms.</p>
    <p id="Par20">One of the principal advantages of cryo-ET is the ability to directly visualize proteins in their native cellular environments. Owing to crowding of the cellular space and the poor contrast caused by thick specimens however, particle localization within a cellular environment presents a substantial challenge. To assess its ability to locate particles in cellular tomograms, we applied TomoTwin to a dataset of tomograms containing <italic>Mycoplasma pneumoniae</italic><sup><xref ref-type="bibr" rid="CR37">37</xref></sup> (<ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/empiar/EMPIAR-10499/">EMPIAR 10499</ext-link>) (Extended Data Fig. <xref rid="Fig12" ref-type="fig">6a</xref>). Using the TomoTwin general model, we picked 70S ribosomes in 65 tomograms with the reference-based workflow in which a single ribosome was identified in a tomogram and used to generate a target embedding that was then applied to pick the entire dataset (Extended Data Fig. <xref rid="Fig12" ref-type="fig">6b,c</xref>). To visualize the results, we extracted pseudo-subtomograms<sup><xref ref-type="bibr" rid="CR38">38</xref></sup> and performed 3D classification using a 70S ribosome cryo-EM structure (<ext-link ext-link-type="uri" xlink:href="https://www.emdataresource.org/EMD-11650">EMD-11650</ext-link>), lowpass filtered to 30 Å as a reference. As all 3D classes resemble ribosomes refined to roughly 15 Å, it clearly indicates that TomoTwin also picks highly accurately in cellular tomograms (Extended Data Fig. <xref rid="Fig12" ref-type="fig">6d</xref>).</p>
  </sec>
  <sec id="Sec8">
    <title>TomoTwin establishes new standards of accuracy and usability</title>
    <p id="Par21">To establish how TomoTwin compares with available methods for particle picking in cryo-ET, we directly measured the picking performance first against template matching and subsequently against nongeneralizing machine learning workflows.</p>
    <p id="Par22">Several software are available for template matching in cryo-ET including EMAN2 (ref. <sup><xref ref-type="bibr" rid="CR39">39</xref></sup>), Dynamo<sup><xref ref-type="bibr" rid="CR40">40</xref></sup> and PyTom<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>, from which we selected EMAN2 as a representative case. When applied to the validation dataset of 120 proteins ranging in size from 30 kDa to 2.7 mDa, TomoTwin demonstrated superior picking performance compared to EMAN2 as measured by the F1 accuracy score as well as a greater consistency in picking accuracy across the entire range of proteins (Extended Data Fig. <xref rid="Fig13" ref-type="fig">7a</xref>). Moreover, this advantage was carried over to picking performance on the generalization tomogram (Extended Data Fig. <xref rid="Fig13" ref-type="fig">7b</xref>).</p>
    <p id="Par23">Directly comparing TomoTwin against nongeneralizing machine learning picking workflows is more challenging as the main distinction comes at the level of usability rather than statistical picking accuracy. The advantage of nongeneralizing deep learning approaches, such as DeepFinder<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>, over template matching has been previously demonstrated in the ability to achieve a low-resolution reconstruction of the enzyme ribulose-1,5-biphosphase carboxylase-oxygenase (RuBisCO) with fewer particles than were needed when picking with template matching<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. To achieve this, however, first template matching was used to pick RuBisCO in tomograms, then manual curation of the picks to reach more than 175,000 annotated particles to train and validate a model for picking the enzyme in the remaining tomograms. While producing a high accuracy overall, a combination of template matching and manual picking was used to generate training data and the training step alone in this workflow required 35 hours. This sample is particularly suitable for assessing the performance of particle picking in a crowded cellular environment due to the unconventional phenomenon of RuBisCO packing into a densely packed protein matrix inside the pyrenoid. When applied to a tomogram from the same dataset (<ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/empiar/EMPIAR-10694/">EMPIAR 10694</ext-link>), TomoTwin was able to localize RuBisCO with a recall of 0.8 (Extended Data Fig. <xref rid="Fig14" ref-type="fig">8</xref>) based on a single reference. These picks proved sufficient for direct analysis by STA surpassing the previously reported resolution while maintaining a highly efficient workflow (Fig. <xref rid="Fig4" ref-type="fig">4</xref>). Comparing the map of RuBisCO from TomoTwin raw picked particles with the original (<ext-link ext-link-type="uri" xlink:href="http://www.ebi.ac.uk/pdbe/entry/emdb/EMD-3694">EMD-3694</ext-link>)<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> shows that the reconstruction from TomoTwin picked particles is of a comparable if not superior quality and thus TomoTwin picking did not limit the resolution that can be achieved by STA (Extended Data Fig. <xref rid="Fig15" ref-type="fig">9e</xref>). Furthermore, as a result of not requiring the user to manually annotate training data or retrain the network to pick these particles, TomoTwin was able to generate these accurate picking coordinates with a total working time of under 1 hour. When applied to the same tomogram, the clustering workflow achieved similar picking results (Extended Data Fig. <xref rid="Fig14" ref-type="fig">8</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>TomoTwin matches the quality of supervised deep learning approaches without any training required.</title><p><bold>a</bold>, Slice of a tomogram containing a <italic>C. reinhardtii</italic> pyrenoid. Scale bar, 200 nm. <bold>b</bold>, Picking and processing pipeline. Picking scale bar, 100 nm; 3D refinement scale bar, 4 nm.</p></caption><graphic xlink:href="41592_2023_1878_Fig4_HTML" id="d32e698"/></fig></p>
  </sec>
  <sec id="Sec9">
    <title>TomoTwin generalizes across a variety of experimental setups</title>
    <p id="Par24">In addition to generalizing to pick new proteins, a highly usable picking tool must also generalize across a variety of common experimental practices in cryo-ET.</p>
    <p id="Par25">While trained solely on simulated tomograms with a total dose of 150 e/Å<sup>2</sup>, collected from tilt series ranging from −60° to 60° in 2° increments, the aforementioned picking examples on experimental tomograms demonstrate several additional degrees of generalization including tilt range, tilt step, total dose and detector (Extended Data Fig. <xref rid="Fig13" ref-type="fig">7e</xref>).</p>
    <p id="Par26">To further analyze the effect of varying experimental parameters quantitatively, several congruent simulated generalization tomograms were created wherein the tilt range and total dose were varied to account for a range of possible cryo-ET experimental setups (Extended Data Fig. <xref rid="Fig13" ref-type="fig">7</xref>). To control for possible bias from the reference particle used for picking, five reference particles were used for each protein and the reference that returned the most consistent picking result across the parameters was reported.</p>
    <p id="Par27">Decreasing the tilt range increases the effects of the missing wedge artifact on the reconstructed tomogram resulting in a stronger deformation of each reconstructed particle<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>. This effect is particularly pronounced on long, thin particles such as carbon monoxide dehydrogenase (PDB <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.2210/pdb1OAO/pdb">1OAO</ext-link>) making accurate particle picking substantially more challenging. Overall, we observe a 5.4 and 10.3% decrease in mean F1 picking performance when the tilt range is restricted from −60°60° to −50°50° and −40°40°, respectively (Extended Data Fig. <xref rid="Fig13" ref-type="fig">7c</xref>).</p>
    <p id="Par28">Similarly, decreasing the total electron dose directly reduces the protein signal resulting in a tomogram with a reduced signal to noise ratio. We observe a 2.3 and 8.6% decrease in F1 picking performance when the total dose is restricted from 150 to 135 and 120 e/Å<sup>2</sup>, respectively (Extended Data Fig. <xref rid="Fig13" ref-type="fig">7d</xref>).</p>
    <p id="Par29">Overall, while a decrease in picking performance with the increase in corruption or lack of protein signal in tomograms is expected, TomoTwin leverages the high degree of adaptability rooted in its deep metric learning backbone to achieve accurate particle picking.</p>
  </sec>
  <sec id="Sec10">
    <title>Structural data mining on the embedding manifold</title>
    <p id="Par30">The embedding feature of TomoTwin maps tomograms as a series of embeddings organized according to their macromolecular contents. Such organized embeddings present ideal candidates for structural data mining. These embeddings can be directly visualized by approximation on a 2D manifold (Fig. <xref rid="Fig5" ref-type="fig">5a,c</xref>). Typically, these 2D plots contain a large elongated mass corresponding to a combination of background embeddings and the overall effect of dimensional reduction, as well as additional well-defined clusters. These clusters represent common structural moieties in the tomogram including prominently expressed proteins, but also in the case of experimental data, membranes, fiducials and embeddings containing off centered proteins. The clustering workflow of TomoTwin allows users to interactively identify clusters of interest and generate targets for particle picking without requiring any a priori knowledge of the tomogram contents. However, it does require that the abundance of a protein is high enough to form a cluster.<fig id="Fig5"><label>Fig. 5</label><caption><title>TomoTwin enables structural data mining on the embedding manifold.</title><p><bold>a</bold>, Highlighted clusters of all seven proteins on the generalization tomogram 2D manifold approximation. <bold>b</bold>, Respective particle locations from cluster 3 (left) and 5 (right) that correspond to the proteins with PDB ID <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.2210/pdb2DF7/pdb">2DF7</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.2210/pdb1FZG/pdb">1FZG</ext-link>, respectively. The true-positive picks are white and false negatives are black. In both cases there were no false-positive selections. <bold>c</bold>, 2D manifold approximation of the embedding space of a tomogram containing <italic>M. pneumoniae</italic> (EMPIAR 10499). The manual selected cluster is highlighted that corresponds to the 70S ribosome. <bold>d</bold>, Using the cluster center for picking identified all ribosomes previously selected by the reference-based picking (white) with a few reference-only selections (blue). <bold>e</bold>, F1 scores for the individual clusters in comparison with the F1 scores for reference-based picking. On average, the clustering performed slightly better (0.84 versus 0.82 mean F1 score). More detailed metrics can be found in Extended Data Fig. <xref rid="Fig13" ref-type="fig">7f,g</xref>. Scale bar, 100 nm.</p></caption><graphic xlink:href="41592_2023_1878_Fig5_HTML" id="d32e790"/></fig></p>
    <p id="Par31">To evaluate the accuracy of clustering-based picking quantitatively, we evaluated the F1 picking score when using clustering-based picking for each protein in the generalization tomogram (Fig. <xref rid="Fig5" ref-type="fig">5b,e</xref> and Extended Data Fig. <xref rid="Fig13" ref-type="fig">7f,g</xref>). The clustering-based picking identified each protein with high accuracy across a range of sizes, indicating that this workflow provides an alternative, but effective, method of particle picking. Also notable in the visualized embeddings is the fact that individual protein clusters are globally organized by size, indicating that the model accurately represents similarities in macromolecular shapes as distance in the embedding space (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>).</p>
    <p id="Par32">We additionally compared the clustering-based picking against the reference-based approach for the cellular tomograms containing <italic>M. pneumoniae</italic> (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>). Visualizing the embeddings of these tomograms, several clusters are visible. One of which, when picked, produces accurate particle locations for 70S ribosomes nearly identical to those produced by the reference-based approach further underlining the robustness of both workflows (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>).</p>
    <p id="Par33">Finally, one outstanding question for the study of macromolecules in situ by cryo-ET is how much of the proteome can be feasibly studied by STA. While undoubtably improvements in overall tomogram contrast by denoising<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>, missing wedge inpainting<sup><xref ref-type="bibr" rid="CR45">45</xref></sup> or other methods will have a large impact, the clustering workflow of TomoTwin for de novo protein localization represents one method of probing regions of the proteome hitherto uncharted by cryo-ET. To explore the reach of the clustering workflow in situ, we applied it to tomograms containing <italic>Yersinia entomophaga</italic> undergoing controlled cell lysis. After embedding the tomograms, performing the clustering workflow on one tomogram revealed several clusters, two of which corresponded to identifiable biomolecules in the tomograms (Fig. <xref rid="Fig6" ref-type="fig">6a,b</xref>). The picked coordinates for each cluster were extracted and used for STA using a spherical reference to assess which biomolecules they contained (Fig. <xref rid="Fig6" ref-type="fig">6c</xref>). Refinement of the first cluster (15.5 Å) readily revealed that the cluster contains the 70S bacterial ribosome (Fig. <xref rid="Fig6" ref-type="fig">6d</xref>). The second cluster contains a considerably smaller biomolecule. Refinement of these picks by STA with a spherical reference resulted in a low-resolution (18.6 Å) reconstruction of a protein previously undescribed by STA with the approximate shape of a bacterial RNA polymerase (Fig. <xref rid="Fig6" ref-type="fig">6d</xref>). RNA polymerase is known to be expressed in high abundance, although at this resolution direct identification of the protein from the refinement is not absolute. Notably, TomoTwin clustered particles of the same protein together regardless of whether they remained contained within the cell or adjacent to it as a result of lysis, demonstrating that the embedding of proteins remains consistent across various surrounding environments.<fig id="Fig6"><label>Fig. 6</label><caption><title>TomoTwin’s clustering workflow locates proteins in cellular tomograms de novo.</title><p><bold>a</bold>, Slice through a tomogram containing a <italic>Y. entomophaga</italic> cell. Coordinates picked from two separate clusters highlighted in green and purple. Scale bar, 100 nm. <bold>b</bold>, TomoTwin representation map for the tomogram shown in <bold>a</bold>. Clusters corresponding to picks are highlighted in the same color scheme as <bold>a</bold>. <bold>c</bold>, STA processing pipeline for identifying proteins picked with the clustering workflow. <bold>d</bold>, 3D refined maps from STA analysis fit with a bacterial ribosome (left) (PDB ID <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.2210/pdb7K00/pdb">7K00</ext-link>) and a bacterial RNA polymerase (right) (PDB ID <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.2210/pdb1HQM/pdb">1HQM</ext-link>). Scale bar, 10 nm.</p></caption><graphic xlink:href="41592_2023_1878_Fig6_HTML" id="d32e880"/></fig></p>
  </sec>
  <sec id="Sec11" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par34">Despite offering the potential to study proteins in their native, cellular environment, it remains that presently only a select few proteins have been successfully studied by cryo-ET with STA. In part, this is because with increased cellular context, the formation of macromolecular complexes, and poorer contrast caused by thicker specimens, comes the challenge of picking individual proteins for subsequent STA. To assist in this crucial particle picking step, we developed TomoTwin, a robust general picking model for cryo-electron tomograms based on deep metric learning. TomoTwin allows users to identify proteins in tomograms de novo without manually creating training data or retraining the network each time a new protein is to be located.</p>
    <p id="Par35">TomoTwin offers two complementary workflows for picking particles. The reference-based workflow for picking readily observable macromolecules in tomograms, and the clustering workflow that offers a unique opportunity to explore tomogram contents interactively without a priori knowledge. While currently limited in its picking utility by the overall contrast achievable during tomogram reconstruction, the clustering workflow used in conjunction with future advances in tomogram reconstruction presents a potential method of extending the proportion of the proteome that is accessible for STA.</p>
    <p id="Par36">The missing wedge of information in cryo-ETs contributes to the deformation of reconstructed particles particularly along the <italic>xz</italic> plane<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>. However, in some biological contexts the ability to accurately locate proteins of interest in this view becomes extremely relevant. As opposed to the typical view of a tomogram as a series of <italic>xy</italic> views, TomoTwin picks particles directly in 3D resulting in accurate picking not only in <italic>xy</italic>, but along the <italic>z</italic> axis as well. This allows users to confidently view their picks along their preferred axes of choosing and pick particles that may be difficult to spot when only viewed from the <italic>xy</italic> plane (Extended Data Fig. <xref rid="Fig10" ref-type="fig">4b–f</xref>).</p>
    <p id="Par37">Additionally, the need for increased data throughput necessitates the development of algorithms for automated processing in cryo-ET<sup><xref ref-type="bibr" rid="CR26">26</xref>,<xref ref-type="bibr" rid="CR46">46</xref>–<xref ref-type="bibr" rid="CR49">49</xref></sup>. TomoTwin can be readily integrated with high throughput tomogram reconstruction and STA workflows and, when combined with unsupervised clustering algorithms<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>, TomoTwin paves the way for unsupervised STA analysis on a whole-tomogram level (Extended Data Fig. <xref rid="Fig15" ref-type="fig">9</xref>).</p>
    <p id="Par38">While TomoTwin particle picking presents advantages over current workflows in terms of accuracy and usability, it is not without its limitations. Currently, the model is not designed to pick membrane proteins or filaments. Additionally, the appearance of protein clusters in the clustering workflow largely depends on the copy number of the protein in the tomogram. For example, in the <italic>Y. entomophaga</italic> cells, only seven Tc toxin molecules were observed in the tomogram making this protein indiscernible with the clustering workflow, although it is readily and accurately picked with the reference-based workflow. Further, because TomoTwin is trained with a pixel size of 10 Å, the current model is not designed to differentiate between multiple conformations of the same protein at the particle picking level. Finally, although the training data included proteins as small as 30 kDa, during generalization the expected lower limit of accurate picking is approximately 150 kDa on account of TomoTwin picking on downscaled tomograms (roughly 10 Å per pixel). While particles smaller than this size can potentially be located in experimental tomograms, evaluating the accuracy of such picks through STA is, so far, beyond the limitations of the field.</p>
    <p id="Par39">TomoTwin is a robust, open-source tool for particle localization in cryo-electron tomograms that applies the advantages of deep learning while retaining a high degree of usability priming it to assist in a wide range of cryo-ET experiments. The code used to develop and train TomoTwin as well as the general picking model are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/MPI-Dortmund/tomotwin-cryoet">https://github.com/MPI-Dortmund/tomotwin-cryoet</ext-link>.</p>
  </sec>
  <sec id="Sec12">
    <title>Methods</title>
    <sec id="Sec13">
      <title>Training data generation</title>
      <p id="Par40">TomoTwin was trained on 123 data classes composed of subvolumes of 120 different proteins, membranes, noise and fiducials from simulated tomograms. To ensure that TomoTwin is trained on the most diverse set of proteins possible, 108 proteins were selected from the PDB with sizes ranging from 30 kDa to 2.7 mDa and the cross-correlation between pairs of 10 Å lowpass filtered maps of each protein was calculated (Extended Data Fig. <xref rid="Fig8" ref-type="fig">2</xref>). Any protein with a high similarity (greater than 0.6) to another protein in the training set was marked for replacement. Additionally included were the data from the 2021 SHREC competition<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> including 12 proteins to yield a total of 120 proteins for training. A training/validation split was achieved with 800 subvolumes for each data class in the training set and 200 in the validation set, yielding a total training set size of 98,400 subvolumes and a validation set size of 24,600 subvolumes.</p>
    </sec>
    <sec id="Sec14">
      <title>Tomogram simulation</title>
      <p id="Par41">Tomogram simulation was done using TEM Simulator<sup><xref ref-type="bibr" rid="CR51">51</xref></sup> that calculates the scattering potential of individual proteins and places them in definable positions within the volume. The output of the simulation is a tilt series, which is then reconstructed using IMOD<sup><xref ref-type="bibr" rid="CR52">52</xref></sup>. A configuration file was generated with properties for the electron beam, optics of the microscope, the detector, the tilt geometry and the sample volume. The default detector was adjusted to reflect the MTF curve of a modern Gatan K3 Camera with a quantum efficiency of 0.9. The detector size was set to 1,024 × 1,024 with a pixel size of 5 µm. The magnification was set to 9,800, the spherical aberration and chromatic aberration were adjusted to 2.7 and 2 mm, respectively, to mimic popular modern TEMs. A condenser aperture size of 80 µm was chosen. For each tomogram the defocus value was randomly chosen between −2.5 and −5 µm. A tilting scheme of −60° to +60° with a step size of 2° was used. To simplify and streamline the simulation we wrote a set of open-source programs called ‘tem-simulator-scripts’ (<ext-link ext-link-type="uri" xlink:href="https://github.com/MPI-Dortmund/tem-simulator-scripts">https://github.com/MPI-Dortmund/tem-simulator-scripts</ext-link>). They contain scripts that require as input the PDB files to be simulated and the number of particles to simulate per PDB. The program then generates reconstructed tomograms as they were used for this study using the following pipeline:<list list-type="order"><list-item><p id="Par42">Generation of densely packed random particle positions within the volume where individual particles do not overlap</p></list-item><list-item><p id="Par43">Generation of an occupancy map: a volume where each voxel is labeled according the protein identity</p></list-item><list-item><p id="Par44">Generation of fiducial maps</p></list-item><list-item><p id="Par45">Generation of vesicle maps</p></list-item><list-item><p id="Par46">Generation of the configuration file for TEM-simulator</p></list-item><list-item><p id="Par47">Simulation of the tilt series using TEM-simulator</p></list-item><list-item><p id="Par48">Alignment and reconstruction using IMOD.</p></list-item></list></p>
      <p id="Par49">However, all steps can also be carried out individually to have full control over all parameters.</p>
      <p id="Par50">Using this procedure, we simulated 11 sets of proteins. The sets contain in total 108 different proteins with each set covering proteins of various sizes. For each set we simulated eight tomograms of size 512 × 512 × 200 voxels with a pixel size of 1.02 nm and varying protein density. For tomogram 1, 2 and 8, 150 particles per protein were generated, for tomograms 3 and 4, 125 particles per protein, for tomograms 5 and 6, 100 particles per protein and for tomogram 7, 75 particles per protein. Tomograms 1–7 were used for training and tomogram 8 for validation. The generated tomograms used in this study with all meta-data are publicly available<sup><xref ref-type="bibr" rid="CR53">53</xref></sup>. These simulated data were used to construct the training and validation sets<sup><xref ref-type="bibr" rid="CR54">54</xref></sup> to evaluate network training, particle localization and model generalizability.</p>
    </sec>
    <sec id="Sec15">
      <title>Convolutional network architecture</title>
      <p id="Par51">To encode volumetric cryo-ET data as embedding vectors in a high-dimensional space, TomoTwin uses a 3D CNN consisting of five convolutional blocks followed by a head network (Extended Data Fig. <xref rid="Fig7" ref-type="fig">1b</xref>). Each convolution block consists of two 3D convolutional layers with a kernel size of 3 × 3 × 3. Each convolutional layer is followed by a normalization layer and a leaky rectified linear activation function. In the first convolutional layer of each convolutional block, the number of output channels is twice the input channels and in the second convolutional layer the number of output channels matches the output from the previous layer. Maximum pooling is performed with a kernel size of 2 × 2 × 2 after the first convolutional block and adaptive max pooling to a size of 2 × 2 × 2 is performed after the final convolutional block. As a result, when provided with a 37 × 37 × 37 subvolume with one channel as a normalized, 37 × 37 × 37 × 1 array, the convolutional blocks transform the input to a 2 × 2 × 2 × 1,024 feature vector that is then fed to the head network. In the head network, the feature vector is first flattened channel-wise before being subject to a dropout layer and then passed through a series of fully-connected layers that transform the flattened vector to a 32D feature vector. Finally, this feature vector is L2-normalized to yield an output embedding vector for the subvolume.</p>
    </sec>
    <sec id="Sec16">
      <title>Triplet generation</title>
      <p id="Par52">TomoTwin is trained on triplets of subvolumes consisting of an anchor volume <italic>A</italic>, a positive volume <italic>P</italic> and a negative volume <italic>N</italic> (Extended Data Fig. <xref rid="Fig7" ref-type="fig">1c</xref>). Each subvolume is assigned to a data class corresponding to the macromolecule contained within and has a size of 37 × 37 × 37 voxels. Triplets are constructed where <italic>A</italic> and <italic>P</italic> are sampled from the same data class and <italic>N</italic> from a different data class. Given a distance function <italic>D</italic> and an embedding function <italic>f</italic>, the triplet loss is defined as:<disp-formula id="Equa"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L(A,P,N) = \max \left( {D\left( {f(A),f(P)} \right) - D\left( {f(A),f(N)} \right) + a,0} \right)$$\end{document}</tex-math><mml:math id="M2"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>P</mml:mi><mml:mo>,</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>max</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>D</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mi>D</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41592_2023_1878_Article_Equa.gif" position="anchor"/></alternatives></disp-formula>where the hyperparameter <italic>α</italic> is the margin value. As distance function <italic>D</italic>, we use cosine similarity that is defined as<disp-formula id="Equb"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D(Q,P) = \frac{{{\bf{Q}} \cdot {\bf{P}}}}{{\left\| {\bf{Q}} \right\| \times \left\| {\bf{P}} \right\|}}$$\end{document}</tex-math><mml:math id="M4"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>Q</mml:mi><mml:mo>,</mml:mo><mml:mi>P</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi><mml:mo>⋅</mml:mo><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mfenced close="∥" open="∥"><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi></mml:mrow></mml:mfenced><mml:mo>×</mml:mo><mml:mfenced close="∥" open="∥"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="41592_2023_1878_Article_Equb.gif" position="anchor"/></alternatives></disp-formula>where <bold>Q</bold> and <bold>P</bold> are arbitrary embedding vectors, • is the dot product and <inline-formula id="IEq1"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\| \cdot \right\|$$\end{document}</tex-math><mml:math id="M6"><mml:mfenced close="∥" open="∥"><mml:mrow><mml:mo>⋅</mml:mo></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41592_2023_1878_Article_IEq1.gif"/></alternatives></inline-formula> the length of the vector. During training, triplets are generated by online semihard triplet mining wherein a batch of subvolumes are embedded and triplets generated automatically with the negative subvolume embedding being selected from those only with a distance to the anchor greater than the positive subvolume embedding but not greater than a margin <italic>α</italic><sub>miner</sub>:<disp-formula id="Equc"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D\left( {{\bf{a}},{\bf{p}}} \right) &lt; D\left( {{\bf{a}},{\bf{n}}} \right) &lt; d\left( {{\bf{a}},{\bf{p}}} \right) + \alpha _{{\mathrm{miner}}}$$\end{document}</tex-math><mml:math id="M8"><mml:mrow><mml:mi>D</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="bold">a</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">p</mml:mi></mml:mrow></mml:mfenced><mml:mo>&lt;</mml:mo><mml:mi>D</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="bold">a</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">n</mml:mi></mml:mrow></mml:mfenced><mml:mo>&lt;</mml:mo><mml:mi>d</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="bold">a</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">p</mml:mi></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">miner</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><graphic xlink:href="41592_2023_1878_Article_Equc.gif" position="anchor"/></alternatives></disp-formula>where <bold>a</bold>, <bold>p</bold> and <bold>n</bold> are the embedding vectors of the anchor, positive and negative, respectively, and <italic>α</italic><sub>miner</sub> is the margin of the miner.</p>
    </sec>
    <sec id="Sec17">
      <title>Training of the general picking model</title>
      <p id="Par53">Training of the 3D CNN was performed for 600 epochs using an adaptive moment estimation (ADAM) optimizer<sup><xref ref-type="bibr" rid="CR55">55</xref></sup>. The model from the epoch with the best F1 score on the subvolumes in the validation set was further evaluated in the localization and generalization tasks and used as the general picking model.</p>
    </sec>
    <sec id="Sec18">
      <title>Data augmentation</title>
      <p id="Par54">To prevent overfitting during training and to improve generalization of the model, online data augmentations were applied to each normalized volume before its embedding was calculated including rotation, dropout, translation, and the addition of noise. For the rotation augmentation, subvolumes were rotated by a random angle in the <italic>xy</italic> plane but not <italic>xz</italic> or <italic>yz</italic> to prevent reorientation of the missing wedge. In the dropout augmentation, a random portion between 5 and 20% of the voxels were set to the subvolume mean value. In the translation augmentation, the subvolume was shifted by 1–2 pixels in each direction. The addition of noise augmentation added Gaussian noise with a randomly chosen standard deviation between 0 and 0.3 to the subvolume.</p>
    </sec>
    <sec id="Sec19">
      <title>Hyperparameter optimization</title>
      <p id="Par55">The training of modern CNNs involves the selection of many hyperparameters, some of these choices affect the architecture while others affect the learning process itself. While some heuristics exist to guide hyperparameter selection, finding a combination of settings that maximize the utility of a machine learning tool by hand quickly becomes intractable. Optuna<sup><xref ref-type="bibr" rid="CR56">56</xref></sup> was applied to explore the hyperparameter search space and identify an optimized set of parameters for training. Models were trained on a subset of the training data for 200 epochs and the F1 score calculated on the validation set after each epoch. Pruning was performed after 50 epochs for training runs with an F1 score lower than the global median. In total, searches were applied for the hyperparameters of learning rate, dropout rate, optimizer, batch size, weight decay, size of the first convolution kernel, number of output layer nodes, online triplet mining strategy (semihard<sup><xref ref-type="bibr" rid="CR57">57</xref></sup>, easyhard<sup><xref ref-type="bibr" rid="CR58">58</xref></sup>, none), normalization type (group norm<sup><xref ref-type="bibr" rid="CR59">59</xref></sup>, batch norm<sup><xref ref-type="bibr" rid="CR60">60</xref></sup>), loss function (TripletLoss<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>, SphereFace<sup><xref ref-type="bibr" rid="CR61">61</xref></sup>, ArcFace<sup><xref ref-type="bibr" rid="CR62">62</xref></sup>) and loss margin (Extended Data Fig. <xref rid="Fig16" ref-type="fig">10</xref>).</p>
      <p id="Par56">Most notably, the type of normalization applied during training was the largest overall affecter of performance with group normalization<sup><xref ref-type="bibr" rid="CR59">59</xref></sup> outperforming the more common batch normalization<sup><xref ref-type="bibr" rid="CR60">60</xref></sup> strategy (Extended Data Fig. <xref rid="Fig16" ref-type="fig">10b</xref>). Additionally noted was the increased performance of a standard triplet loss function over the theoretically superior SphereFace<sup><xref ref-type="bibr" rid="CR61">61</xref></sup> and ArcFace<sup><xref ref-type="bibr" rid="CR62">62</xref></sup> loss functions (Extended Data Fig. <xref rid="Fig16" ref-type="fig">10c</xref>). These findings underpin the necessity to explore a wide range of hyperparameters during training as heuristics alone are not enough to guide optimal hyperparameter selection for the training of modern CNNs.</p>
    </sec>
    <sec id="Sec20">
      <title>Particle picking workflow with the general model</title>
      <p id="Par57">For each dataset picked with the general model, first all tomograms were embedded. To achieve this, the tomograms were subdivided into a series of overlapping 37 × 37 × 37 subvolumes with a stride of 2 voxels. For the reference-based workflow, a random particle for each protein of interest was selected as reference and embedded to generate a target embedding. The tomogram and target embeddings were provided to TomoTwin Map that calculated the distance matrix between each target embedding and each subvolume embedding from the tomogram and returned this along with a similarity map for each target embedding. This matrix was then provided to TomoTwin Locate that identified areas of high confidence as target locations using a region-growing based maximum detection procedure followed by nonmaxima suppression. The returned candidate positions were then subject to confidence and size thresholding in the TomoTwin graphical user interface to produce final coordinates for each protein of interest.</p>
    </sec>
    <sec id="Sec21">
      <title>Evaluation of simulated data</title>
      <p id="Par58">The performance of particle localization was calculated from three metrics: recall, precision and, the harmonic mean of the two, the F1 score that are defined as:<disp-formula id="Equd"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathrm{precision}} = \frac{{{\mathrm{true}}\,{\mathrm{positive}}}}{{{\mathrm{true}}\,{\mathrm{positive}} + {\mathrm{false}}\,{\mathrm{positive}}}}$$\end{document}</tex-math><mml:math id="M10"><mml:mrow><mml:mi mathvariant="normal">precision</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">true</mml:mi><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">positive</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">true</mml:mi><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">positive</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">false</mml:mi><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">positive</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="41592_2023_1878_Article_Equd.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Eque"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathrm{recall}} = \frac{{{\mathrm{true}}\,{\mathrm{positive}}}}{{{\mathrm{true}}\,{\mathrm{positive}} + {\mathrm{false}}\,{\mathrm{negative}}}}$$\end{document}</tex-math><mml:math id="M12"><mml:mrow><mml:mi mathvariant="normal">recall</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">true</mml:mi><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">positive</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">true</mml:mi><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">positive</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">false</mml:mi><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">negative</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="41592_2023_1878_Article_Eque.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equf"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathrm{F}}1 = 2\frac{{{\mathrm{precision}} \times {\mathrm{recall}}}}{{{\mathrm{precision}} + {\mathrm{recall}}}}$$\end{document}</tex-math><mml:math id="M14"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">F</mml:mi></mml:mrow></mml:mrow><mml:mn>1</mml:mn><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mfrac><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow></mml:mrow><mml:mo>×</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">l</mml:mi></mml:mrow></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">l</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41592_2023_1878_Article_Equf.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par59">Selected particle locations counted as true positives if the intersection over union of the box of the selected particle location and the ground-truth box was greater than 0.6. The intersection over union is defined as the ratio of the intersecting volume of two bounding boxes and the volume of their union.</p>
      <p id="Par60">The particle localization accuracy of the trained model was assessed for each tomogram in the validation set (Extended Data Fig. <xref rid="Fig9" ref-type="fig">3a</xref>). To test model generalization, the localization task was performed on a tomogram containing seven proteins not included in the training set for which TomoTwin was therefore naïve (Fig. <xref rid="Fig2" ref-type="fig">2</xref>).</p>
    </sec>
    <sec id="Sec22">
      <title>Evaluation of experimental data</title>
      <p id="Par61">Ground-truth particle coordinates are not available for experimental data, which makes the calculation of performance metrics such as precision and recall complicated. One approach to estimate these is to manually count true positives, false positives and false negatives for either the complete tomogram or a reference region.</p>
      <p id="Par62">However, as this is not always possible due to the difficulty of manually picking some proteins, another approach to measure the picking precision without introducing reference bias is by extracting subvolumes at the picked coordinates of each protein, projecting the 3D subvolumes to 2D using SPHIRE<sup><xref ref-type="bibr" rid="CR63">63</xref></sup> and performing reference-free 2D classification<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>. 2D classification on few particles can lead to extraneous results because only the most common poses of a protein will have enough particles to be clustered effectively, possibly resulting in many true-positive particles classified incorrectly as false positives. Nevertheless, the percentage of particles in good 2D classes was measured as an indicator of the precision.</p>
    </sec>
    <sec id="Sec23">
      <title>Clustering</title>
      <p id="Par63">For clustering analysis, a random sample of 400,000 embeddings from the high-dimensional tomogram embeddings were fit to a uniform 2D manifold with uniform manifold approximation (UMAP) with GPU-acceleration provided by the RAPIDS package<sup><xref ref-type="bibr" rid="CR64">64</xref></sup>. The UMAP model was used as the basis to transform the entire tomogram embeddings and the results plotted (Fig. <xref rid="Fig5" ref-type="fig">5a,c</xref>). Clusters were identified by eye and selected by drawing a closed shape containing the desired points. The enclosed points were then traced back to their original high-dimensional embeddings and the average embedding of them was calculated. This average embedding was then used as a target embedding for classification, localization and picking in the same manner as for the reference-based workflow.</p>
    </sec>
    <sec id="Sec24">
      <title>Preparation of experimental samples</title>
      <p id="Par64">The components of the mixture were either thawed from long-term storage at −80 °C or freshly prepared. <italic>P. luminescens</italic> holotoxin was expressed, purified and the holotoxin formed as described previously<sup><xref ref-type="bibr" rid="CR65">65</xref></sup> and used at a stock concentration of 0.49 mg ml<sup>−1</sup>. RhsA from <italic>P. protegens</italic> was expressed and purified as described previously<sup><xref ref-type="bibr" rid="CR35">35</xref></sup> and used at 4 mg ml<sup>−1</sup> concentration. Liposomes were prepared by extrusion. 4 mg ml<sup>−1</sup> of each POPC (1-palmitoyl-2-oleoyl-glycero-3-phosphocholine, Avanti Polar Lipids) and DOPS (1,2-dioleoyl-sn-glycero-3-phospho-<sc>l</sc>-serine, Avanti Polar Lipids) were mixed in buffer (50 mM Tris, pH 8, 150 NaCl, 0.05% Tween20) and after brief sonication (1 min in water bath) and three cycles of freeze–thawing (−196 °C and 50 °C), the liposome solution was passed 11 times through a polycarbonate membrane with a 400 nm pore size in a mini extruder (Avanti Polar Lipids). Total lipid concentration was diluted with buffer to 0.16 mg ml<sup>−1</sup>. The freeze-dried content of one vial tobacco mosaic virus (DSMZ GmbH Braunschweig, Germany, PC-0107) was solved in 1 ml of buffer and diluted 500 times as working solution. The apoferritin plasmid was a kind gift from C. Savva (Midlands Regional Cryo-Electron Microscopy Facility). Expression and purification of apoferritin was optimized based on the protocol described earlier<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> and final concentration of frozen stock was 3 mg ml<sup>−1</sup>.</p>
      <p id="Par65">Different ratios of the mixture were prepared and then examined after vitrification using cryo-EM. For cryo-ET, a mixture ratio of 1:2:2:20:10 (tobacco mosaic virus:apoferritin:liposomes:Tc toxin:RhsA) was chosen.</p>
    </sec>
    <sec id="Sec25">
      <title>Grid preparation</title>
      <p id="Par66">Grids were prepared using a Vitrobot Mark IV (Thermo Fisher Scientific) at 4 °C and 100% humidity. Then 4 µl of the freshly prepared mixture were applied to glow-discharged (Quorum GloQube) R1.2/1.4 Cu 200 (Quantifoil) grids. After blotting (3.5 s at blot force −1, no drain time) the specimen was vitrified in liquid ethane.</p>
    </sec>
    <sec id="Sec26">
      <title>Cryo-ET</title>
      <p id="Par67">Grids of different mixing ratios were screened using a Talos Arctica electron microscope (Thermo Fisher Scientific) equipped with a X-FEG and Falcon 3 camera. Small datasets of 100–200 images were collected using the software EPU (Thermo Fisher Scientific). The best specimen was transferred to a Titan Krios G3 electron microscope equipped with X-FEG. Images were recorded on a K3 camera (Gatan) operated in counting mode at a nominal magnification of 63,000, resulting in a pixel size of 1.484 Å per pixel. A Bioquantum post-column energy (Gatan) was used for zero loss imaging with a slit width of 20 eV.</p>
      <p id="Par68">Tilt series were acquired using SerialEM<sup><xref ref-type="bibr" rid="CR66">66</xref></sup> with the Plugin PACEtomo<sup><xref ref-type="bibr" rid="CR67">67</xref></sup> and with a dose symmetric tilt scheme<sup><xref ref-type="bibr" rid="CR68">68</xref></sup> from −60° to 60° with a step size of 3°. Each movie was collected as an exposure of 0.2 s subdivided into ten frames. Frames were then exported to Warp v.1.0.9 (ref. <sup><xref ref-type="bibr" rid="CR26">26</xref></sup>) for motion correction, contrast transfer function estimation and generation of tilt series. Tilt series were aligned with patch tracking and tomograms reconstructed by weighted back projection in IMOD<sup><xref ref-type="bibr" rid="CR52">52</xref></sup> with a pixel size of 5.936. Tomograms were scaled by Fourier shrinking to 10 Å per pixel for embedding with TomoTwin.</p>
      <p id="Par69">Raw frames of <italic>M. pneumoniae</italic> cells were downloaded from EMPIAR (EMPIAR 10499). Motion correction and contrast transfer function estimation were performed in Warp v.1.0.9, which was then used to generate tilt series. These tilt series were aligned with patch tracking and tomograms reconstructed by weighted back projection in IMOD with a pixel size of 6.802 Å per pixel. Tomograms were then scaled by Fourier shrinking to 13.6 Å per pixel for embedding with TomoTwin.</p>
    </sec>
    <sec id="Sec27">
      <title>Evaluation of experimental data</title>
      <p id="Par70">For tomograms from samples prepared in-house, coordinates of particles identified with TomoTwin were scaled to a pixel size of 5.936 to match the originally reconstructed tomograms. The tomograms were imported and these coordinates were used to extract subtomograms in Relion v.3.0 (ref. <sup><xref ref-type="bibr" rid="CR46">46</xref></sup>). For reference-free analysis, 3D subtomograms were projected to 2D with SPHIRE<sup><xref ref-type="bibr" rid="CR63">63</xref></sup> and then used for 2D classification.</p>
      <p id="Par71">Tomograms containing <italic>M. pneumoniae</italic> were attained from EMPIAR (EMPIAR 10499), coordinates of particles identified with TomoTwin were scaled to a pixel size of 6.802 Å per pixel to match the originally reconstructed tomograms. The tomograms were imported and coordinates were imported and used to reconstruct pseudo-subtomograms in Relion 4.0 (ref. <sup><xref ref-type="bibr" rid="CR38">38</xref></sup>). A reference was created from a 70S ribosome (<ext-link ext-link-type="uri" xlink:href="http://www.ebi.ac.uk/pdbe/entry/emdb/EMD-11650">EMD-11650</ext-link>) by lowpass filtering to 30 Å and then scaling the pixel size to 6.802 Å per pixel. This reference was used for 3D classification with the pseudo-subtomograms in Relion v.4.0.</p>
      <p id="Par72">The tilt series and alignment files for the tomogram containing <italic>Chlamydomonas reinhardtii</italic> cells was attained from EMPIAR (EMPIAR 10694) and used to reconstruct the tomogram at a pixel size of 13.68 Å per pixel for picking and 6.84 Å per pixel for STA. Picking of RuBisCO was performed using the TomoTwin reference-based workflow and the resulting coordinates scaled to the pixel size to be used for extraction and, subsequently, STA in Relion v.3.0 (ref. <sup><xref ref-type="bibr" rid="CR46">46</xref></sup>). Extracted subtomograms were used for initial 3D refinement using a reference generated by lowpass filtering a known model of RuBisCO (PDB <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.2210/pdb1BXN/pdb">1BXN</ext-link>) to 60 Å. This map was used to fit the model of RuBisCO.</p>
      <p id="Par73">Reconstructed tomograms were binned to 9.288 Å per pixel and picked with the TomoTwin clustering workflow. Picked coordinates for each cluster were rescaled to 4.644 Å per pixel for extraction. Tomograms were imported and these coordinates used to extract subtomograms in Relion v.3.0 (ref. <sup><xref ref-type="bibr" rid="CR46">46</xref></sup>). An initial 3D refinement was performed with a spherical reference to eliminate the possibility of reference bias, and the resulting map used for 3D classification without alignment. Finally, 3D refinement was repeated using one of the 3D classes as reference to achieve a coherent 3D refined map that was then used to fit the PDB models of candidate proteins.</p>
    </sec>
    <sec id="Sec28">
      <title>Hardware</title>
      <p id="Par74">Two computational setups were used for calculations, a distributed computing system and a local workstation. The distributed computing system consisted of the Max Planck Gesellschaft Supercomputer ‘Raven’ using up to 30 Nvidia A100 graphical processing units (GPUs), where each GPU has 40 GB memory. Each process had 18 cores of Intel Xeon IceLake-SP 8360Y processors and 128 GB system memory available. The local workstation consisted of a local unit equipped with a Nvidia Titan V (12 GB memory) GPU and an Intel i9-7920X CPU with 64 GB system memory.</p>
      <p id="Par75">Hyperparameter optimization was done in parallel for 7 d once the distributed computing setup and embeddings were calculated on this, also using two GPUs. In all cases, a box size of 37 and stride of two were used for embedding.</p>
      <p id="Par76">The in-house workstation was used for miscellaneous tasks and for calculating timings using two GPUs.</p>
    </sec>
    <sec id="Sec29">
      <title>Timings</title>
      <p id="Par77">The calculation of the embeddings is the only function of TomoTwin requiring notable processing time. To measure this, we embedded our largest experimental tomogram (608 × 855 × 148 after Fourier shrinking) on a local workstation and a distributed computing system. Using two GPUs, tomogram embedding took 80 min for the local setup and 30 min for the distributed setup, corresponding to the total time to pick all proteins of interest per tomogram on each setup.</p>
    </sec>
    <sec id="Sec30">
      <title>Statistics and reproducibility</title>
      <p id="Par78">Embeddings produced by the general model are deterministic allowing users to reproduce picking results at will. The only package used that is not deterministic is the Nvidia RAPIDS UMAP that is used for visualization in the clustering workflow. However, as picking and thresholding calculations are always performed on the original embeddings, the overall picking results remain consistent.</p>
    </sec>
    <sec id="Sec31">
      <title>Reporting summary</title>
      <p id="Par79">Further information on research design is available in the <xref rid="MOESM1" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec id="Sec32" sec-type="materials|methods">
    <title>Online content</title>
    <p id="Par80">Any methods, additional references, Nature Portfolio reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests; and statements of data and code availability are available at 10.1038/s41592-023-01878-z.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <p>
      <supplementary-material content-type="local-data" id="MOESM1">
        <media xlink:href="41592_2023_1878_MOESM1_ESM.pdf">
          <caption>
            <p>Reporting Summary</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM2">
        <media xlink:href="41592_2023_1878_MOESM2_ESM.pdf">
          <caption>
            <p>Peer Review File</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM3">
        <media xlink:href="41592_2023_1878_MOESM3_ESM.mp4">
          <label>Supplementary Video 1</label>
          <caption>
            <p>Picking result of TomoTwin’s reference workflow for a representative crowded in vitro tomogram. The video goes through the tomogram in the <italic>z</italic> direction, highlighting the individual picks for TcdA1 (blue), apoferritin (red) and RhsA (green).</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM4">
        <media xlink:href="41592_2023_1878_MOESM4_ESM.mp4">
          <label>Supplementary Video 2</label>
          <caption>
            <p>Picking result of TomoTwin’s reference workflow for a tomogram with a pyrenoid in a <italic>C. reinhardtii</italic> cell. The video goes in the <italic>z</italic> direction through the tomogram with the individual picks for RuBisCO particles (red).</p>
          </caption>
        </media>
      </supplementary-material>
    </p>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec33">
        <title>Extended data</title>
        <p id="Par85">
          <fig id="Fig7">
            <label>Extended Data Fig. 1</label>
            <caption>
              <title>TomoTwin convolutional architecture and metric learning strategy for particle picking.</title>
              <p><bold>a</bold>, TomoTwin user interface in Napari for visualizing protein picks. Picks for 3 proteins are shown as spheres. Lefthand panel allows users to adjust visualization settings for the. Righthand panel to filter picks for each cluster according to similarity threshold, minimum and maximum size, and adjust the box size for viewing. <bold>b</bold>. Architecture of 3D convolutional network utilized by TomoTwin to embed tomogram subvolumes for deep metric learning. <bold>c</bold>. Overview of the deep metric learning training scheme wherein data triplets are constructed of anchor, positive, and negative subvolumes. The subvolumes are each convolved by the CNN and the embeddings are used to calculate the distance metrics in the triplet loss function. <bold>d</bold>. UMAP of protein subvolume embeddings colored according to protein PDB ID from TomoTwin 3D CNN in first training epoch and best model after 600 training epochs.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2023_1878_Fig7_ESM" id="d32e1896"/>
          </fig>
        </p>
        <p id="Par86">
          <fig id="Fig8">
            <label>Extended Data Fig. 2</label>
            <caption>
              <title>Characterization of the training dataset.</title>
              <p><bold>a</bold>, Pairwise cross-correlation matrix for all 120 proteins sorted by size. Cross-correlations were calculated by converting the individual PDBs to density maps with a pixel size of 1 nm, aligning them pairwise with EMAN2 and calculating the cross-correlation of the aligned pairs. To maximize the value for training, we selected proteins so that all pairs except 3 have a cross-correlation value below 0.6. The three pairs with higher correlation are from the SHREC dataset and were not simulated by us. Higher correlation values are more likely for smaller proteins. <bold>b</bold>, Histogram of the pairwise cross correlation values. The mean cross correlation value is 0.22 with a standard deviation of 0.13.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2023_1878_Fig8_ESM" id="d32e1915"/>
          </fig>
        </p>
        <p id="Par87">
          <fig id="Fig9">
            <label>Extended Data Fig. 3</label>
            <caption>
              <title>TomoTwin identifies proteins with high accuracy by using single particle subvolumes as reference.</title>
              <p><bold>a</bold>, F1 scores of TomoTwin on the validation tomograms. Each box extends from the 1st quartile (Q1) to the 3rd quartile (Q3). The median is marked by a line inside the box. Whisker lines correspond to box edges +/− 1.5 times interquartile range. The number of proteins n in each set is 10, except for SHREC (n = 12) and Set 2 and 4 (n = 8). The median F1 score of the individual sets is most often above 0.8 and not lower than 0.76. <bold>b</bold>, The overall distribution of F1 scores for the complete training set. The distribution has a median of 0.92, but also a tail of low F1 scores can be seen. <bold>c</bold>, Size distribution of particles that show good F1 scores (F1 &gt; = 0.7) and those with rather low F1 scores (F1 &lt; 0.7). <bold>d</bold>, Examples of proteins of similar size with low (yellow) and high (cyan) F1 score. On the left side the individual particles are depicted in a noisy and noise-free reconstruction, respectively. On the right side, the respective structures, PDB IDs, sizes, and F1 scores are shown. The proteins which were not identified properly by TomoTwin have a lower contrast than the other proteins. Scale bars 100 nm.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2023_1878_Fig9_ESM" id="d32e1940"/>
          </fig>
        </p>
        <p id="Par88">
          <fig id="Fig10">
            <label>Extended Data Fig. 4</label>
            <caption>
              <title>TomoTwin locates particles accurately in densely packed tomograms and with Z-centering.</title>
              <p><bold>a. Picking in</bold> simulated dense generalization tomogram for PDB IDs: 1AVO (red), 1E9R (yellow), 1FPY (green), 1FZG (light blue), 1JZ8 (dark blue), 1OAO (brown), and 2DF7 (magenta). <bold>b</bold>. XZ view of picking simulated generalization tomogram (color scheme: PDB ID: 1AVO (red); PDB ID: 1E9R (orange); PDB ID: 1FPY (green); PDB ID: 1FZG (teal); PDB ID: 1JZ8 (blue); PDB ID: 1OAO (purple); PDB ID: 2DF7 (magenta)). Scale bar 50 nm. <bold>c</bold>. XZ view of picking tomogram containing a pyrenoid inside a <italic>C. reinhardtii</italic> cell with RuBisCO picked. Scale bar 75 nm. <bold>d</bold>. XZ view of picking tomogram containing a <italic>M. pneuomoniae</italic> cell with ribosomes picked. Scale bar 50 nm. <bold>e</bold>. XZ view of picking tomogram containing a mixture of apoferritin (red), TcdA1 (magenta), and RhsA (teal). Scale bar 50 nm. <bold>f</bold>. XZ view of picking tomogram containing a <italic>Y. entomophaga</italic> cell with ribosomes (blue) and RNA polymerases (red) picked. Scale bar 75 nm.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2023_1878_Fig10_ESM" id="d32e2017"/>
          </fig>
        </p>
        <p id="Par89">
          <fig id="Fig11">
            <label>Extended Data Fig. 5</label>
            <caption>
              <title>Picking evaluation of in-vitro tomogram.</title>
              <p>The accuracy was evaluated on one full tomogram for TcdA1 and apoferritin by manual counting of picked and missed particles. For TcdA1 (<bold>a</bold>.) 9 particles were picked (blue) and two particles were missed (orange). For apoferritin (<bold>b</bold>.) 126 particles were picked (red) and 11 particles missed (orange). The results give an estimated recall of 0.81 and 0.91 for TcdA1 and apoferritin respectively. There were no false positives in either case (precision 1.0). A manual evaluation for RhsA was not feasible by eye. Example 2D classes from previous studies by single particle analysis of <bold>c</bold>. apoferritin<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>, <bold>d</bold>. RhsA<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>, and <bold>e</bold>. TcdA1<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>; 2D class averages of TomoTwin picked subvolumes after projection to 2D. Classes outlined in blue were judged to be positive classes by expert inspection, indicating that they contain particles of the appropriate protein. Scale bar: 5 nm.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2023_1878_Fig11_ESM" id="d32e2059"/>
          </fig>
        </p>
        <p id="Par90">
          <fig id="Fig12">
            <label>Extended Data Fig. 6</label>
            <caption>
              <title>TomoTwin locates proteins in a cellular environment.</title>
              <p><bold>a</bold>, Representative slice view of a tomogram containing <italic>Mycoplasma pneumoniae</italic>. b. Slice view highlighting positions of picked 70S ribosomes localized in 3D with TomoTwin. Scale bar 100 nm. <bold>c</bold>, 3D representation of ribosome positioning within the tomogram, a represented slice is superimposed with 3D classes of ribosomes arranged according to their corresponding coordinates and orientation. <bold>d</bold>, 3D classes from 18,246 particles. Scale bar 10 nm.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2023_1878_Fig12_ESM" id="d32e2084"/>
          </fig>
        </p>
        <p id="Par91">
          <fig id="Fig13">
            <label>Extended Data Fig. 7</label>
            <caption>
              <title>TomoTwin outperforms template matching and adapts to picking across a variety of experimental parameters.</title>
              <p><bold>a</bold>, F1 score benchmark for TomoTwin and template matching of n = 120 proteins on the respective validation tomograms. For TomoTwin the results of the reference mode with a single subvolume as reference are shown. TomoTwin similarity and size threshold were optimized for each protein. For template matching the EMAN2 implementation with a density as reference generated by the respective protein PDB was used. The median F1 score is represented by a white dot and the 25<sup>th</sup> and 75<sup>th</sup> percentile by the indicated range. Width of plots indicates the density of F1 scores across the dataset. <bold>b</bold>, Detailed comparison for the generalization tomogram. TomoTwin and template matching were applied analogously to (<bold>a</bold>). In contrast, the best results of either the reference mode or the clustering mode are shown for TomoTwin. <bold>c</bold>. F1 picking score for each protein in the simulated generalization tomogram reconstructed from tilt series with varying tilt ranges. <bold>d</bold>. F1 picking score for each protein in the simulated generalization tomogram with varying total electron doses. <bold>e</bold>. Tilt range, tilt step, total dose, and detector used for each dataset picked with TomoTwin. Detailed picking statistics including F1 score, recall, precision, true positives (TP), false positives (FP) and false negatives (FN) for the generalization tomogram picked by <bold>f</bold>. reference workflow and <bold>g</bold>. clustering workflow.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2023_1878_Fig13_ESM" id="d32e2128"/>
          </fig>
        </p>
        <p id="Par92">
          <fig id="Fig14">
            <label>Extended Data Fig. 8</label>
            <caption>
              <title>Additional evaluation statistics for the RuBisCO tomogram using the reference- and clustering-based workflows.</title>
              <p><bold>a</bold>, Color coded picks for a selected sub-region where purple picks were picked by both workflows, red by the reference workflow only and blue by the clustering workflow only. For both methods the threshold was set to get a visually optimal result. The threshold was 0.91 for both workflows. <bold>b</bold>, Missed particles by both workflows. <bold>c</bold>, Summary statistics for both workflows on the selected sub-region. Based on this we estimate that 80% of the particles were picked. <bold>d</bold>, The number of picked particles follows the particle density along the z-direction of the tomogram. Scale bars 50 nm. <bold>e</bold>. Comparison between <italic>in situ</italic> subtomogram averages of RuBisCO from EMDB-3694<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> at 16.5 Å (bottom) and the same tomogram picked with TomoTwin at 13.7 Å (top).</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2023_1878_Fig14_ESM" id="d32e2164"/>
          </fig>
        </p>
        <p id="Par93">
          <fig id="Fig15">
            <label>Extended Data Fig. 9</label>
            <caption>
              <title>Automated identification of clusters of interest using HDBSCAN.</title>
              <p>A subset of the approximated manifold of Fig. <xref rid="Fig5" ref-type="fig">5a</xref> was used to run density-based clustering which located 5 out of 7 proteins of interest in an unsupervised manner. R implementation of HDBSCAN was run with a min_samples of 50 and a minimum cluster size of 50.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2023_1878_Fig15_ESM" id="d32e2181"/>
          </fig>
        </p>
        <p id="Par94">
          <fig id="Fig16">
            <label>Extended Data Fig. 10</label>
            <caption>
              <title>Hyperparameter optimization of TomoTwin.</title>
              <p><bold>a</bold>, Hyperparameter importance estimated by Optuna<sup><xref ref-type="bibr" rid="CR56">56</xref></sup> after 180 trials with different configurations. <bold>b</bold>, F1 scores for trials using either the batch normalization (n = 8) or group normalization layers (n = 36) in convolutional neural network. Group normalization performed better than batch normalization in all cases. <bold>c</bold>, F1 score for trials using either Triplet-, SphereFace-, or ArcFace-Loss (n = 19, 13, or 10 respectively). The boxes in b and c extend from the 1st quartile (Q1) to the 3rd quartile (Q3). The median is marked by a line inside the box. Whisker lines correspond to box edges +/− 1.5 times interquartile range. Points represent the individual trials.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2023_1878_Fig16_ESM" id="d32e2207"/>
          </fig>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Gavin Rice, Thorsten Wagner.</p>
    </fn>
  </fn-group>
  <sec>
    <sec id="FPar1">
      <title>Extended data</title>
      <p id="Par81">is available for this paper at 10.1038/s41592-023-01878-z.</p>
    </sec>
    <sec id="FPar2" sec-type="supplementary-material">
      <title>Supplementary information</title>
      <p id="Par82">The online version contains supplementary material available at 10.1038/s41592-023-01878-z.</p>
    </sec>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank P. Günther for providing RhsA and liposomes, P. Njenga Ng‘Ang‘A for providing TcdA1, Z. Wang for collecting and reconstructing tomograms containing YenTc, K. Vogel-Bachmayr for purifying apoferritin, C. Savva for providing the apoferritin plasmid and A. Prajica for support in figure and logo creation. The work was supported by the Max Planck Society (to S.R.).</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>Conceptualization was done by T.W. and S.R. Software implementation was done by T.W., G.R. and M.S. Software testing was done by G.R., T.W. and M.S. Data acquisition and sample preparation were done by G.R., O.S. and D.P. Formal analysis was done by G.R. and T.W. Supervision was carried out by S.R. The original draft was written by G.R. and T.W. Review and editing of the paper was done by G.R., T.W. and S.R. Funding was acquired by S.R.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar3">
      <title>Peer review information</title>
      <p id="Par83"><italic>Nature Methods</italic> thanks Michael Cianfrocco and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. <xref rid="MOESM2" ref-type="media">Peer reviewer reports</xref> are available. Primary Handling Editor: Arunima Singh, in collaboration with the <italic>Nature Methods</italic> team.</p>
    </sec>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>Open access funding provided by Max Planck Society.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All simulated tomograms and subvolumes used to train and evaluate the performance of TomoTwin are available at 10.5281/zenodo.6637357 (tomograms) and 10.5281/zenodo.6637456 (subvolumes).</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The TEM-Simulator-Scripts package used for automated tilt-series simulation and reconstruction is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/MPI-Dortmund/tem-simulator-scripts">https://github.com/MPI-Dortmund/tem-simulator-scripts</ext-link>. TomoTwin is available under an open-source license at <ext-link ext-link-type="uri" xlink:href="https://github.com/MPI-Dortmund/tomotwin-cryoet">https://github.com/MPI-Dortmund/tomotwin-cryoet</ext-link>. A code demonstration for TomoTwin complete with system requirements, installation instructions, demonstration scripts, data and usage instructions is available at 10.5281/zenodo.7186070.</p>
  </notes>
  <notes id="FPar4" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par84">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wan</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Briggs</surname>
            <given-names>JAG</given-names>
          </name>
        </person-group>
        <article-title>Cryo-electron tomography and subtomogram averaging</article-title>
        <source>Methods Enzymol.</source>
        <year>2016</year>
        <volume>579</volume>
        <fpage>329</fpage>
        <lpage>367</lpage>
        <pub-id pub-id-type="doi">10.1016/bs.mie.2016.04.014</pub-id>
        <?supplied-pmid 27572733?>
        <pub-id pub-id-type="pmid">27572733</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lučić</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Rigort</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Baumeister</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Cryo-electron tomography: the challenge of doing structural biology in situ</article-title>
        <source>J. Cell Biol.</source>
        <year>2013</year>
        <volume>202</volume>
        <fpage>407</fpage>
        <lpage>419</lpage>
        <pub-id pub-id-type="doi">10.1083/jcb.201304193</pub-id>
        <?supplied-pmid 23918936?>
        <pub-id pub-id-type="pmid">23918936</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bharat</surname>
            <given-names>TAM</given-names>
          </name>
          <name>
            <surname>Scheres</surname>
            <given-names>SHW</given-names>
          </name>
        </person-group>
        <article-title>Resolving macromolecular structures from electron cryo-tomography data using subtomogram averaging in RELION</article-title>
        <source>Nat. Protoc.</source>
        <year>2016</year>
        <volume>11</volume>
        <fpage>2054</fpage>
        <lpage>2065</lpage>
        <pub-id pub-id-type="doi">10.1038/nprot.2016.124</pub-id>
        <?supplied-pmid 27685097?>
        <pub-id pub-id-type="pmid">27685097</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Koning</surname>
            <given-names>RI</given-names>
          </name>
          <name>
            <surname>Koster</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Sharp</surname>
            <given-names>TH</given-names>
          </name>
        </person-group>
        <article-title>Advances in cryo-electron tomography for biology and medicine</article-title>
        <source>Ann. Anat.</source>
        <year>2018</year>
        <volume>217</volume>
        <fpage>82</fpage>
        <lpage>96</lpage>
        <pub-id pub-id-type="doi">10.1016/j.aanat.2018.02.004</pub-id>
        <?supplied-pmid 29526767?>
        <pub-id pub-id-type="pmid">29526767</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Asano</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Engel</surname>
            <given-names>BD</given-names>
          </name>
          <name>
            <surname>Baumeister</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>In situ cryo-electron tomography: a post-reductionist approach to structural biology</article-title>
        <source>J. Mol. Biol.</source>
        <year>2016</year>
        <volume>428</volume>
        <fpage>332</fpage>
        <lpage>343</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jmb.2015.09.030</pub-id>
        <?supplied-pmid 26456135?>
        <pub-id pub-id-type="pmid">26456135</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Structures from intact myofibrils reveal mechanism of thin filament regulation through nebulin</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>375</volume>
        <fpage>eabn1934</fpage>
        <pub-id pub-id-type="doi">10.1126/science.abn1934</pub-id>
        <?supplied-pmid 35175800?>
        <pub-id pub-id-type="pmid">35175800</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The molecular basis for sarcomere organization in vertebrate skeletal muscle</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>2135</fpage>
        <lpage>2150.e13</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.02.047</pub-id>
        <?supplied-pmid 33765442?>
        <pub-id pub-id-type="pmid">33765442</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schaffer</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cryo-focused ion beam sample preparation for imaging vitreous cells by cryo-electron tomography</article-title>
        <source>Bio. Protoc.</source>
        <year>2015</year>
        <volume>5</volume>
        <fpage>e1575</fpage>
        <pub-id pub-id-type="doi">10.21769/BioProtoc.1575</pub-id>
        <?supplied-pmid 27294174?>
        <pub-id pub-id-type="pmid">27294174</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wagner</surname>
            <given-names>FR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Preparing samples from whole cells using focused-ion-beam milling for cryo-electron tomography</article-title>
        <source>Nat. Protoc.</source>
        <year>2020</year>
        <volume>15</volume>
        <fpage>2041</fpage>
        <lpage>2070</lpage>
        <pub-id pub-id-type="doi">10.1038/s41596-020-0320-x</pub-id>
        <?supplied-pmid 32405053?>
        <pub-id pub-id-type="pmid">32405053</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tacke</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A streamlined workflow for automated cryo focused ion beam milling</article-title>
        <source>J. Struct. Biol.</source>
        <year>2021</year>
        <volume>213</volume>
        <fpage>107743</fpage>
        <pub-id pub-id-type="doi">10.1016/j.jsb.2021.107743</pub-id>
        <?supplied-pmid 33971286?>
        <pub-id pub-id-type="pmid">33971286</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sutton</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Assembly intermediates of orthoreovirus captured in the cell</article-title>
        <source>Nat. Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>4445</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-020-18243-9</pub-id>
        <?supplied-pmid 32895380?>
        <pub-id pub-id-type="pmid">32895380</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schaffer</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A cryo-FIB lift-out technique enables molecular-resolution cryo-ET within native <italic>Caenorhabditis elegans</italic> tissue</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>757</fpage>
        <lpage>762</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0497-5</pub-id>
        <?supplied-pmid 31363205?>
        <pub-id pub-id-type="pmid">31363205</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Ma</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Sui</surname>
            <given-names>S-F</given-names>
          </name>
        </person-group>
        <article-title>In situ cryo-ET structure of phycobilisome–photosystem II supercomplex from red alga</article-title>
        <source>eLife</source>
        <year>2021</year>
        <volume>10</volume>
        <fpage>e69635</fpage>
        <pub-id pub-id-type="doi">10.7554/eLife.69635</pub-id>
        <?supplied-pmid 34515634?>
        <pub-id pub-id-type="pmid">34515634</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Burbaum</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular-scale visualization of sarcomere contraction within native cardiomyocytes</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>4086</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-24049-0</pub-id>
        <?supplied-pmid 34215727?>
        <pub-id pub-id-type="pmid">34215727</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mosalaganti</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>AI-based structure prediction empowers integrative structural analysis of human nuclear pores</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>376</volume>
        <fpage>eabm9506</fpage>
        <pub-id pub-id-type="doi">10.1126/science.abm9506</pub-id>
        <?supplied-pmid 35679397?>
        <pub-id pub-id-type="pmid">35679397</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schwartz</surname>
            <given-names>TU</given-names>
          </name>
        </person-group>
        <article-title>Solving the nuclear pore puzzle</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>376</volume>
        <fpage>1158</fpage>
        <lpage>1159</lpage>
        <pub-id pub-id-type="doi">10.1126/science.abq4792</pub-id>
        <?supplied-pmid 35679398?>
        <pub-id pub-id-type="pmid">35679398</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhu</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Structure of the cytoplasmic ring of the <italic>Xenopus laevis</italic> nuclear pore complex</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>376</volume>
        <fpage>eabl8280</fpage>
        <pub-id pub-id-type="doi">10.1126/science.abl8280</pub-id>
        <?supplied-pmid 35679404?>
        <pub-id pub-id-type="pmid">35679404</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <mixed-citation publication-type="other">Gubins, I. et al. SHREC 2021: classification in cryo-electron tomograms. In <italic>Proc. Eurographics Workshop on 3D Object Retrieval</italic> (eds Biasotti, S. et al.) 5–17 (The Eurographics Association, 2021).</mixed-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moebel</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deep learning improves macromolecule identification in 3D cellular cryo-electron tomograms</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1386</fpage>
        <lpage>1394</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01275-4</pub-id>
        <?supplied-pmid 34675434?>
        <pub-id pub-id-type="pmid">34675434</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Wu, S., Liu, G. &amp; Yang, G. Fast particle picking for cryo-electron tomography using one-stage detection. In <italic>Proc. 2022 IEEE 19th International Symposium on Biomedical Imaging (ISBI)</italic> (eds Adluru, G. et al.) 1–5 (IEEE, 2022).</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>VP-Detector: a 3D multi-scale dense convolutional neural network for macromolecule localization and classification in cryo-electron tomograms</article-title>
        <source>Comput. Methods Prog. Biomed.</source>
        <year>2022</year>
        <volume>221</volume>
        <fpage>106871</fpage>
        <pub-id pub-id-type="doi">10.1016/j.cmpb.2022.106871</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Frangakis</surname>
            <given-names>AS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of macromolecular complexes in cryoelectron tomograms of phantom cells</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2002</year>
        <volume>99</volume>
        <fpage>14153</fpage>
        <lpage>14158</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.172520299</pub-id>
        <?supplied-pmid 12391313?>
        <pub-id pub-id-type="pmid">12391313</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lucas</surname>
            <given-names>BA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Locating macromolecular assemblies in cells by 2D template matching with cisTEM</article-title>
        <source>eLife</source>
        <year>2021</year>
        <volume>10</volume>
        <fpage>e68946</fpage>
        <pub-id pub-id-type="doi">10.7554/eLife.68946</pub-id>
        <?supplied-pmid 34114559?>
        <pub-id pub-id-type="pmid">34114559</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">Balyschew, N. et al. Streamlined structure determination by cryo-electron tomography and subtomogram averaging using TomoBEAR. Preprint at <italic>bioRxiv</italic>10.1101/2023.01.10.523437 (2023).</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wagner</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SPHIRE-crYOLO is a fast and accurate fully automated particle picker for cryo-EM</article-title>
        <source>Commun. Biol.</source>
        <year>2019</year>
        <volume>2</volume>
        <fpage>218</fpage>
        <pub-id pub-id-type="doi">10.1038/s42003-019-0437-z</pub-id>
        <?supplied-pmid 31240256?>
        <pub-id pub-id-type="pmid">31240256</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tegunov</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Cramer</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Real-time cryo-electron microscopy data preprocessing with Warp</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1146</fpage>
        <lpage>1152</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0580-y</pub-id>
        <?supplied-pmid 31591575?>
        <pub-id pub-id-type="pmid">31591575</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bepler</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Positive-unlabeled convolutional neural networks for particle picking in cryo-electron micrographs</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1153</fpage>
        <lpage>1160</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0575-8</pub-id>
        <?supplied-pmid 31591578?>
        <pub-id pub-id-type="pmid">31591578</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wagner</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Raunser</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>The evolution of SPHIRE-crYOLO particle picking and its application in automated cryo-EM processing workflows</article-title>
        <source>Commun. Biol.</source>
        <year>2020</year>
        <volume>3</volume>
        <fpage>61</fpage>
        <pub-id pub-id-type="doi">10.1038/s42003-020-0790-y</pub-id>
        <?supplied-pmid 32047248?>
        <pub-id pub-id-type="pmid">32047248</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kaya</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Bilge</surname>
            <given-names>HS</given-names>
          </name>
        </person-group>
        <article-title>Deep metric learning: a survey</article-title>
        <source>Symmetry</source>
        <year>2019</year>
        <volume>11</volume>
        <fpage>1066</fpage>
        <pub-id pub-id-type="doi">10.3390/sym11091066</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <mixed-citation publication-type="other">Ghojogh, B., Ghodsi, A., Karray, F. &amp; Crowley, M. Spectral, probabilistic, and deep metric learning: tutorial and survey. Preprint at <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/2201.09267">https://arxiv.org/abs/2201.09267</ext-link> (2022).</mixed-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <mixed-citation publication-type="other">Schroff, F., Kalenichenko, D. &amp; Philbin, J. FaceNet: a unified embedding for face recognition and clustering. In <italic>Proc. 2015</italic><italic>IEEE Conference on Computer Vision and</italic><italic>Pattern Recognition (CVPR)</italic> 815–823 (IEEE, 2015).</mixed-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <mixed-citation publication-type="other">Liu, J., Deng, Y., Bai, T., Wei, Z. &amp; Huang, C. Targeting ultimate accuracy: face recognition via deep embedding. Preprint at <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1506.07310">https://arxiv.org/abs/1506.07310</ext-link> (2015).</mixed-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dai</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Fang</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Deep correlated holistic metric learning for sketch-based 3D shape retrieval</article-title>
        <source>IEEE Trans. Image Process.</source>
        <year>2018</year>
        <volume>27</volume>
        <fpage>3374</fpage>
        <lpage>3386</lpage>
        <pub-id pub-id-type="doi">10.1109/TIP.2018.2817042</pub-id>
        <?supplied-pmid 29671741?>
        <pub-id pub-id-type="pmid">29671741</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zou</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Expression, purification, and characterization of recombinant human H-chain ferritin</article-title>
        <source>Prep. Biochem. Biotechnol.</source>
        <year>2016</year>
        <volume>46</volume>
        <fpage>833</fpage>
        <lpage>837</lpage>
        <pub-id pub-id-type="doi">10.1080/10826068.2016.1141300</pub-id>
        <?supplied-pmid 26853188?>
        <pub-id pub-id-type="pmid">26853188</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Günther</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Structure of a bacterial Rhs effector exported by the type VI secretion system</article-title>
        <source>PLoS Pathog.</source>
        <year>2022</year>
        <volume>18</volume>
        <fpage>e1010182</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.ppat.1010182</pub-id>
        <?supplied-pmid 34986192?>
        <pub-id pub-id-type="pmid">34986192</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gatsogiannis</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Tc toxin activation requires unfolding and refolding of a β-propeller</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>563</volume>
        <fpage>209</fpage>
        <lpage>213</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-018-0556-6</pub-id>
        <?supplied-pmid 30232455?>
        <pub-id pub-id-type="pmid">30232455</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tegunov</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Xue</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Dienemann</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Cramer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Mahamid</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Multi-particle cryo-EM refinement with M visualizes ribosome-antibiotic complex at 3.5 Å in cells</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>186</fpage>
        <lpage>193</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-020-01054-7</pub-id>
        <?supplied-pmid 33542511?>
        <pub-id pub-id-type="pmid">33542511</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kimanius</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Dong</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Sharov</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Nakane</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Scheres</surname>
            <given-names>SHW</given-names>
          </name>
        </person-group>
        <article-title>New tools for automated cryo-EM single-particle analysis in RELION-4.0</article-title>
        <source>Biochem. J.</source>
        <year>2021</year>
        <volume>478</volume>
        <fpage>4169</fpage>
        <lpage>4185</lpage>
        <pub-id pub-id-type="doi">10.1042/BCJ20210708</pub-id>
        <?supplied-pmid 34783343?>
        <pub-id pub-id-type="pmid">34783343</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tang</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>EMAN2: an extensible image processing suite for electron microscopy</article-title>
        <source>J. Struct. Biol.</source>
        <year>2007</year>
        <volume>157</volume>
        <fpage>38</fpage>
        <lpage>46</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jsb.2006.05.009</pub-id>
        <?supplied-pmid 16859925?>
        <pub-id pub-id-type="pmid">16859925</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Castaño-Díez</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Kudryashev</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Arheit</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Stahlberg</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Dynamo: a flexible, user-friendly development tool for subtomogram averaging of cryo-EM data in high-performance computing environments</article-title>
        <source>J. Struct. Biol.</source>
        <year>2012</year>
        <volume>178</volume>
        <fpage>139</fpage>
        <lpage>151</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jsb.2011.12.017</pub-id>
        <?supplied-pmid 22245546?>
        <pub-id pub-id-type="pmid">22245546</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hrabe</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>PyTom: a python-based toolbox for localization of macromolecules in cryo-electron tomograms and subtomogram analysis</article-title>
        <source>J. Struct. Biol.</source>
        <year>2012</year>
        <volume>178</volume>
        <fpage>177</fpage>
        <lpage>188</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jsb.2011.12.003</pub-id>
        <?supplied-pmid 22193517?>
        <pub-id pub-id-type="pmid">22193517</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Freeman Rosenzweig</surname>
            <given-names>ES</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The eukaryotic CO<sub>2</sub>-concentrating organelle is liquid-like and exhibits dynamic reorganization</article-title>
        <source>Cell</source>
        <year>2017</year>
        <volume>171</volume>
        <fpage>148</fpage>
        <lpage>162.e19</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2017.08.008</pub-id>
        <?supplied-pmid 28938114?>
        <pub-id pub-id-type="pmid">28938114</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lučić</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Förster</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Baumeister</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Structural studies by electron tomography: from cells to molecules</article-title>
        <source>Annu. Rev. Biochem.</source>
        <year>2005</year>
        <volume>74</volume>
        <fpage>833</fpage>
        <lpage>865</lpage>
        <pub-id pub-id-type="doi">10.1146/annurev.biochem.73.011303.074112</pub-id>
        <?supplied-pmid 15952904?>
        <pub-id pub-id-type="pmid">15952904</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Buchholz</surname>
            <given-names>T-O</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Content-aware image restoration for electron microscopy</article-title>
        <source>Methods Cell Biol.</source>
        <year>2019</year>
        <volume>152</volume>
        <fpage>277</fpage>
        <lpage>289</lpage>
        <pub-id pub-id-type="doi">10.1016/bs.mcb.2019.05.001</pub-id>
        <?supplied-pmid 31326025?>
        <pub-id pub-id-type="pmid">31326025</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>Y-T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Isotropic reconstruction for electron tomography with deep learning</article-title>
        <source>Nat. Commun.</source>
        <year>2022</year>
        <volume>13</volume>
        <fpage>6482</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-022-33957-8</pub-id>
        <?supplied-pmid 36309499?>
        <pub-id pub-id-type="pmid">36309499</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zivanov</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>New tools for automated high-resolution cryo-EM structure determination in RELION-3</article-title>
        <source>eLife</source>
        <year>2018</year>
        <volume>7</volume>
        <fpage>e42166</fpage>
        <pub-id pub-id-type="doi">10.7554/eLife.42166</pub-id>
        <?supplied-pmid 30412051?>
        <pub-id pub-id-type="pmid">30412051</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stabrin</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TranSPHIRE: automated and feedback-optimized on-the-fly processing for cryo-EM</article-title>
        <source>Nat. Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>5716</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-020-19513-2</pub-id>
        <?supplied-pmid 33177513?>
        <pub-id pub-id-type="pmid">33177513</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schenk</surname>
            <given-names>AD</given-names>
          </name>
          <name>
            <surname>Cavadini</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Thomä</surname>
            <given-names>NH</given-names>
          </name>
          <name>
            <surname>Genoud</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Live analysis and reconstruction of single-particle cryo-electron microscopy data with CryoFLARE</article-title>
        <source>J. Chem. Inf. Model.</source>
        <year>2020</year>
        <volume>60</volume>
        <fpage>2561</fpage>
        <lpage>2569</lpage>
        <pub-id pub-id-type="doi">10.1021/acs.jcim.9b01102</pub-id>
        <?supplied-pmid 32233514?>
        <pub-id pub-id-type="pmid">32233514</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Maluenda</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Flexible workflows for on-the-fly electron-microscopy single-particle image processing using Scipion</article-title>
        <source>Acta Crystallogr D. Struct. Biol.</source>
        <year>2019</year>
        <volume>75</volume>
        <fpage>882</fpage>
        <lpage>894</lpage>
        <pub-id pub-id-type="doi">10.1107/S2059798319011860</pub-id>
        <?supplied-pmid 31588920?>
        <pub-id pub-id-type="pmid">31588920</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <mixed-citation publication-type="other">Campello, R. J. G. B., Moulavi, D. &amp; Sander, J. in <italic>Advances in Knowledge Discovery and Data</italic><italic>Mining</italic> Vol. 7819 (eds Pei, J. et al.) 160–172 (Springer, 2013).</mixed-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rullgård</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Öfverstedt</surname>
            <given-names>L-G</given-names>
          </name>
          <name>
            <surname>Masich</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Daneholt</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Öktem</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>Simulation of transmission electron microscope images of biological specimens: simulation of tem images of biological specimens</article-title>
        <source>J. Microsc.</source>
        <year>2011</year>
        <volume>243</volume>
        <fpage>234</fpage>
        <lpage>256</lpage>
        <pub-id pub-id-type="doi">10.1111/j.1365-2818.2011.03497.x</pub-id>
        <?supplied-pmid 21631500?>
        <pub-id pub-id-type="pmid">21631500</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kremer</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>Mastronarde</surname>
            <given-names>DN</given-names>
          </name>
          <name>
            <surname>McIntosh</surname>
            <given-names>JR</given-names>
          </name>
        </person-group>
        <article-title>Computer visualization of three-dimensional image data using IMOD</article-title>
        <source>J. Struct. Biol.</source>
        <year>1996</year>
        <volume>116</volume>
        <fpage>71</fpage>
        <lpage>76</lpage>
        <pub-id pub-id-type="doi">10.1006/jsbi.1996.0013</pub-id>
        <?supplied-pmid 8742726?>
        <pub-id pub-id-type="pmid">8742726</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <mixed-citation publication-type="other">Wagner, T., Rice, G., Stabrin, M. &amp; Raunser, S. Simulated tomograms used for TomoTwin. <italic>Zenodo</italic>10.5281/ZENODO.6637357 (2022).</mixed-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <mixed-citation publication-type="other">Wagner, T., Rice, G., Stabrin, M. &amp; Raunser, S. Training and validation data used to produce the pre-trained model for the TomoTwin paper. <italic>Zenodo</italic>10.5281/ZENODO.6637456 (2022).</mixed-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <mixed-citation publication-type="other">Kingma, D. P. &amp; Ba, J. ADAM: a method for stochastic optimization. Preprint at <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1412.6980">http://arxiv.org/abs/1412.6980</ext-link> (2017).</mixed-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <mixed-citation publication-type="other">Akiba, T., Sano, S., Yanase, T., Ohta, T. &amp; Koyama, M. Optuna: a next-generation hyperparameter optimization framework. In <italic>Proc. 25th ACM SIGKDD International Conference on Knowledge Discovery &amp; Data Mining</italic> (eds Teredesai, A. et al.) 2623–2631 (ACM, 2019).</mixed-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <mixed-citation publication-type="other">Musgrave, K., Belongie, S. &amp; Lim, S.-N. PyTorch metric learning. Preprint at <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/2008.09164">https://arxiv.org/abs/2008.09164</ext-link> (2020).</mixed-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <mixed-citation publication-type="other">Xuan, H., Stylianou, A. &amp; Pless R. Improved embeddings with easy positive triplet mining. In <italic>2020 IEEE Winter Conference on Applications of Computer Vision (WACV)</italic> 2463–2471 (IEEE, 2020).</mixed-citation>
    </ref>
    <ref id="CR59">
      <label>59.</label>
      <mixed-citation publication-type="other">Wu, Y. &amp; He, K. Group normalization. Preprint at <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1803.08494">https://arxiv.org/abs/1803.08494</ext-link> (2018).</mixed-citation>
    </ref>
    <ref id="CR60">
      <label>60.</label>
      <mixed-citation publication-type="other">Ioffe, S. &amp; Szegedy, C. Batch normalization: accelerating deep network training by reducing internal covariate shift. Preprint at <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1502.03167">https://arxiv.org/abs/1502.03167</ext-link> (2015).</mixed-citation>
    </ref>
    <ref id="CR61">
      <label>61.</label>
      <mixed-citation publication-type="other">Liu, W. et al. SphereFace: deep hypersphere embedding for face recognition. In <italic>2017 IEEE Conference on Computer Vision and Pattern Recognition (CVPR)</italic> 6738–6746 (IEEE, 2017).</mixed-citation>
    </ref>
    <ref id="CR62">
      <label>62.</label>
      <mixed-citation publication-type="other">Deng, J., Guo, J., Xue, N. &amp; Zafeiriou, S. ArcFace: additive angular margin loss for deep face recognition. In <italic>2019 IEEE/CVF Conference on Computer Vision and Pattern Recognition (CVPR)</italic> 4685–4694 (IEEE, 2019).</mixed-citation>
    </ref>
    <ref id="CR63">
      <label>63.</label>
      <mixed-citation publication-type="other">Moriya, T. et al. High-resolution single particle analysis from electron cryo-microscopy images using SPHIRE. <italic>J. Vis. Exp.</italic>10.3791/55448 (2017).</mixed-citation>
    </ref>
    <ref id="CR64">
      <label>64.</label>
      <mixed-citation publication-type="other">RAPIDS Development Team. <italic>RAPIDS: collection of libraries for end to end GPU data science</italic> (RAPIDS, 2018).</mixed-citation>
    </ref>
    <ref id="CR65">
      <label>65.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Roderer</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Hofnagel</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Benz</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Raunser</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Structure of a Tc holotoxin pore provides insights into the translocation mechanism</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2019</year>
        <volume>116</volume>
        <fpage>23083</fpage>
        <lpage>23090</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1909821116</pub-id>
        <?supplied-pmid 31666324?>
        <pub-id pub-id-type="pmid">31666324</pub-id>
      </element-citation>
    </ref>
    <ref id="CR66">
      <label>66.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mastronarde</surname>
            <given-names>DN</given-names>
          </name>
        </person-group>
        <article-title>Automated electron microscope tomography using robust prediction of specimen movements</article-title>
        <source>J. Struct. Biol.</source>
        <year>2005</year>
        <volume>152</volume>
        <fpage>36</fpage>
        <lpage>51</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jsb.2005.07.007</pub-id>
        <?supplied-pmid 16182563?>
        <pub-id pub-id-type="pmid">16182563</pub-id>
      </element-citation>
    </ref>
    <ref id="CR67">
      <label>67.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eisenstein</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Parallel cryo electron tomography on in situ lamellae</article-title>
        <source>Nat. Methods</source>
        <year>2023</year>
        <volume>20</volume>
        <fpage>131</fpage>
        <lpage>138</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-022-01690-1</pub-id>
        <?supplied-pmid 36456783?>
        <pub-id pub-id-type="pmid">36456783</pub-id>
      </element-citation>
    </ref>
    <ref id="CR68">
      <label>68.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hagen</surname>
            <given-names>WJH</given-names>
          </name>
          <name>
            <surname>Wan</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Briggs</surname>
            <given-names>JAG</given-names>
          </name>
        </person-group>
        <article-title>Implementation of a cryo-electron tomography tilt-scheme optimized for high resolution subtomogram averaging</article-title>
        <source>J. Struct. Biol.</source>
        <year>2017</year>
        <volume>197</volume>
        <fpage>191</fpage>
        <lpage>198</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jsb.2016.06.007</pub-id>
        <?supplied-pmid 27313000?>
        <pub-id pub-id-type="pmid">27313000</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
