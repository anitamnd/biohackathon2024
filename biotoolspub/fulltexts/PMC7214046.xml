<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7214046</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btaa091</article-id>
    <article-id pub-id-type="publisher-id">btaa091</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Systems Biology</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ShinySOM: graphical SOM-based analysis of single-cell cytometry data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0001-7356-4075</contrib-id>
        <name>
          <surname>Kratochvíl</surname>
          <given-names>Miroslav</given-names>
        </name>
        <xref ref-type="corresp" rid="btaa091-cor1"/>
        <xref ref-type="aff" rid="btaa091-aff1">b1</xref>
        <xref ref-type="aff" rid="btaa091-aff2">b2</xref>
        <!--<email>miroslav.kratochvil@uochb.cas.cz</email>-->
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0001-7740-0158</contrib-id>
        <name>
          <surname>Bednárek</surname>
          <given-names>David</given-names>
        </name>
        <xref ref-type="aff" rid="btaa091-aff2">b2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Sieger</surname>
          <given-names>Tomáš</given-names>
        </name>
        <xref ref-type="aff" rid="btaa091-aff3">b3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0002-7265-3268</contrib-id>
        <name>
          <surname>Fišer</surname>
          <given-names>Karel</given-names>
        </name>
        <xref ref-type="aff" rid="btaa091-aff4">b4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Vondrášek</surname>
          <given-names>Jiří</given-names>
        </name>
        <xref ref-type="aff" rid="btaa091-aff1">b1</xref>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Mathelier</surname>
          <given-names>Anthony</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <aff id="btaa091-aff1"><label>b1</label><institution>Institute of Organic Chemistry and Biochemistry AS CR</institution>, 166 10 Praha 6, Czech Republic</aff>
    <aff id="btaa091-aff2"><label>b2</label><institution>Department of Software Engineering</institution>, MFF, Charles University, 118 00 Prague, Czech Republic</aff>
    <aff id="btaa091-aff3"><label>b3</label><institution>Department of Cybernetics</institution>, Faculty of Electrical Engineering, Czech Technical University in Prague, 121 35 Prague 2, Czech Republic</aff>
    <aff id="btaa091-aff4"><label>b4</label><institution>Childhood Leukaemia Investigation Prague (CLIP)</institution>, 2nd Faculty of Medicine, Charles University and University Hospital Motol, 150 06 Praha 5, Czech Republic</aff>
    <author-notes>
      <corresp id="btaa091-cor1">To whom correspondence should be addressed. <email>miroslav.kratochvil@uochb.cas.cz</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>5</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2020-02-12">
      <day>12</day>
      <month>2</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>12</day>
      <month>2</month>
      <year>2020</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>36</volume>
    <issue>10</issue>
    <fpage>3288</fpage>
    <lpage>3289</lpage>
    <history>
      <date date-type="received">
        <day>29</day>
        <month>10</month>
        <year>2019</year>
      </date>
      <date date-type="rev-recd">
        <day>14</day>
        <month>1</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>04</day>
        <month>2</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2020. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2020</copyright-year>
      <license license-type="cc-by" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btaa091.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>ShinySOM offers a user-friendly interface for reproducible, high-throughput analysis of high-dimensional flow and mass cytometry data guided by self-organizing maps. The software implements a FlowSOM-style workflow, with improvements in performance, visualizations and data dissection possibilities. The outputs of the analysis include precise statistical information about the dissected samples, and R-compatible metadata useful for the batch processing of large sample volumes.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p>ShinySOM is free and open-source, available online at gitlab.com/exaexa/ShinySOM.</p>
      </sec>
      <sec id="s4">
        <title>Supplementary information</title>
        <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>ELIXIR CZ (MEYS)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>LM2015047</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Charles University Project Progress Q48</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Czech Health Research Council</institution>
            <institution-id institution-id-type="DOI">10.13039/501100009553</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>NV18-08-00385</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Institute of Organic Chemistry and Biochemistry</institution>
          </institution-wrap>
        </funding-source>
        <award-id>61388963</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="2"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Flow cytometry enables fast measurement of multiple parameters of individual cells in solution. In recent years, multiple algorithms have emerged for analyzing flow and mass cytometry data. Among them, FlowSOM (<xref rid="btaa091-B6" ref-type="bibr">van Gassen <italic>et al.</italic>, 2015</xref>) has been shown to be one of the best performers for automated unsupervised detection of cell populations (<xref rid="btaa091-B7" ref-type="bibr">Weber and Robinson, 2016</xref>). The combination of self-organizing maps (SOMs) and metaclustering leads to high-precision clustering in near real-time, even on large datasets.</p>
    <p>The performance of FlowSOM makes it a suitable basis for constructing interactive data analysis platforms. Here, we introduce ShinySOM, a web-based frontend for FlowSOM-style sample dissection and analysis. ShinySOM exposes the FlowSOM functionality in a graphical interface that is useful both for quick interactive and ad-hoc exploration of datasets, and for running the usual FlowSOM-style pipelines in a way convenient for users not familiar with programming interfaces. In addition, ShinySOM provides improved visualization methods and new implementations of unsupervised analysis algorithms, which lead to a substantial speed-up of the operations and further extend the ability to work with large datasets.</p>
  </sec>
  <sec>
    <title>2 Analysis workflow and methods</title>
    <p>The implemented analysis workflow (illustrated in <xref ref-type="fig" rid="btaa091-F1">Fig. 1</xref>) follows the general FlowSOM usage guidelines: the user creates a dataset by aggregating several prepared samples, possibly scaling and transforming the marker expressions to match the expectations about data. A SOM is then trained on the dataset to serve as a basis for further analysis.</p>
    <fig id="btaa091-F1" orientation="portrait" position="float">
      <label>Fig. 1.</label>
      <caption>
        <p>Schema of a typical ShinySOM-backed workflow. Samples are analyzed and dissected in the interactive environment (left box). Example visualizations of the data available at the individual steps are displayed above (a, SOM-based embedding; b, population identification based on marker expressions; c, cluster assignment; d, dissection). Large sample volumes can be subjected to the same analysis as conducted in the GUI by utilizing the exported analysis metadata in a non-interactive environment (right box)</p>
      </caption>
      <graphic xlink:href="btaa091f1"/>
    </fig>
    <p>The SOM is used for multiple purposes: an embedded single-cell view of the samples is computed from the SOM using the fast EmbedSOM algorithm (<xref rid="btaa091-B3" ref-type="bibr">Kratochvíl <italic>et al.</italic>, 2019</xref>). Clustering of the cells is conducted in an interactive dendrogram (<xref rid="btaa091-B5" ref-type="bibr">Sieger <italic>et al.</italic>, 2017</xref>) built from hierarchical metaclustering of the SOM content. Notably, ShinySOM supports the agglomerative clustering with Mahalanobis-average linkage (<xref rid="btaa091-B2" ref-type="bibr">Fišer <italic>et al.</italic>, 2012</xref>) that has been shown to be capable of defining cell populations with the same accuracy as expert cytometrists in a real life setting. After selecting the cell populations, the user may display and analyze the differences between samples and sample groups, and visualize the results of statistical testing of the differences in cell abundance. Finally, the annotated populations may be partitioned into smaller datasets, in order to be explored in more detail.</p>
    <p>Analysis and annotation results may be exported either as FCS files compatible with other flow-cytometry software, CSV files with population statistics and as RDS files with analysis metadata useful for other <monospace>R</monospace>-based workflows.</p>
    <p>The implementation of ShinySOM aims to improve the interactive workflow by exposing new algorithm and analysis methods and minimizing the delays caused by computation:</p>
    <list list-type="bullet">
      <list-item>
        <p>The computationally intensive parts of the software were re-implemented in efficient low-level code, reducing the required time approximately 3–10× when compared with the original implementations (see <xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S1</xref> for details).</p>
      </list-item>
      <list-item>
        <p>The Mahalanobis-average linkage computation (<xref rid="btaa091-B2" ref-type="bibr">Fišer <italic>et al.</italic>, 2012</xref>) was ported to the <monospace>R</monospace> package <monospace>mhca</monospace> (github.com/tsieger/mhca) and customized to work with FlowSOM-style clustering.</p>
      </list-item>
      <list-item>
        <p>An <monospace>idendro</monospace>-inspired (<xref rid="btaa091-B5" ref-type="bibr">Sieger <italic>et al.</italic>, 2017</xref>) Shiny-compatible tool <monospace>shinyDendro</monospace> (github.com/exaexa/shinyDendro) was implemented and integrated into ShinySOM, in order to simplify interactive cluster selection and annotation.</p>
      </list-item>
    </list>
    <p>The resulting workflow gives results comparable to FlowSOM, while enabling user-controlled cluster selection in the final stage of analysis (see <xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S2</xref>). This approach leverages both the strength of unbiased algorithmic data processing and the flexibility of the curated selection of clusters based on domain expertise. The obtained results compare well to manual analysis (see <xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S3</xref>).</p>
    <p>All used algorithm parameters and user-generated metadata can be exported along with the main analysis results. This information describes all expert decisions performed during the analysis and allows for reproducible use of the platform. Moreover, the ‘canned’ expert decisions may be used to automate the analysis, further allowing, e.g. the construction of R-based batch-processing pipelines.</p>
  </sec>
  <sec>
    <title>3 Conclusion</title>
    <p>ShinySOM provides a new software alternative for analyzing multidimensional flow and mass cytometry data. Importantly, it contains a suite of fast algorithms in a user-friendly environment capable of generating precise results more quickly than the manual gating-based analyses. Accessible use of unsupervised analysis algorithms helps to overcome the common dimensionality overhead and promotes analysis reproducibility.</p>
    <p>The interoperability with the <monospace>R</monospace>-based environment provides a link between the expert knowledge gathered using the graphical interfaces and the batch processing required for work with large volumes of samples. A complete cytometry workflow can be constructed with the help of other compatible packages in the <monospace>R</monospace> ecosystem (e.g. <monospace>Catalyst</monospace> and <monospace>flowAI</monospace>; <xref rid="btaa091-B1" ref-type="bibr">Chevrier <italic>et al.</italic>, 2018</xref>; <xref rid="btaa091-B4" ref-type="bibr">Monaco <italic>et al.</italic>, 2016</xref>) that implement data cleaning, compensation and advanced visualization.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>M.K. and J.V. were supported by ELIXIR CZ (MEYS) [LM2015047]. D.B. was supported by the Charles University Project Progress Q48. T.S. and K.F. were supported by Czech Health Research Council (AZV) [NV18-08-00385]. Funding for open access publication was provided by the Institute of Organic Chemistry and Biochemistry of the CAS [RVO: 61388963].</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>btaa091_Supplementary_Data</label>
      <media xlink:href="btaa091_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btaa091-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Chevrier</surname><given-names>S.</given-names></name></person-group><etal>et al</etal> (<year>2018</year>) 
<article-title>Compensation of signal spillover in suspension and imaging mass cytometry</article-title>. <source>Cell Syst</source>., <volume>6</volume>, <fpage>612</fpage>–<lpage>620.e5</lpage>.<pub-id pub-id-type="pmid">29605184</pub-id></mixed-citation>
    </ref>
    <ref id="btaa091-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Fišer</surname><given-names>K.</given-names></name></person-group><etal>et al</etal> (<year>2012</year>) 
<article-title>Detection and monitoring of normal and leukemic cell populations with hierarchical clustering of flow cytometry data</article-title>. <source>Cytometry A</source>, <volume>81</volume>, <fpage>25</fpage>–<lpage>34</lpage>.<pub-id pub-id-type="pmid">21990127</pub-id></mixed-citation>
    </ref>
    <ref id="btaa091-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Kratochvíl</surname><given-names>M.</given-names></name></person-group><etal>et al</etal> (<year>2019</year>) 
<article-title>Generalized EmbedSOM on quadtree-structured self-organizing maps</article-title>. <source>F1000Res</source>., <volume>8</volume>, <fpage>2120</fpage>.</mixed-citation>
    </ref>
    <ref id="btaa091-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Monaco</surname><given-names>G.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>flowAI: automatic and interactive anomaly discerning tools for flow cytometry data</article-title>. <source>Bioinformatics</source>, <volume>32</volume>, <fpage>2473</fpage>–<lpage>2480</lpage>.<pub-id pub-id-type="pmid">27153628</pub-id></mixed-citation>
    </ref>
    <ref id="btaa091-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Sieger</surname><given-names>T.</given-names></name></person-group><etal>et al</etal> (<year>2017</year>) 
<article-title>Interactive dendrograms: the R packages idendro and idendr0</article-title>. <source>J. Stat. Softw</source>., <volume>76</volume>, <fpage>1</fpage>–<lpage>22</lpage>.</mixed-citation>
    </ref>
    <ref id="btaa091-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>van Gassen</surname><given-names>S.</given-names></name></person-group><etal>et al</etal> (<year>2015</year>) 
<article-title>FlowSOM: using self-organizing maps for visualization and interpretation of cytometry data</article-title>. <source>Cytometry A</source>, <volume>87</volume>, <fpage>636</fpage>–<lpage>645</lpage>.<pub-id pub-id-type="pmid">25573116</pub-id></mixed-citation>
    </ref>
    <ref id="btaa091-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Weber</surname><given-names>L.M.</given-names></name>, <name name-style="western"><surname>Robinson</surname><given-names>M.D.</given-names></name></person-group> (<year>2016</year>) 
<article-title>Comparison of clustering methods for high-dimensional single-cell flow and mass cytometry data</article-title>. <source>Cytometry A</source>, <volume>89</volume>, <fpage>1084</fpage>–<lpage>1096</lpage>.<pub-id pub-id-type="pmid">27992111</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
