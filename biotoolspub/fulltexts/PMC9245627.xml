<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinform Adv</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinform Adv</journal-id>
    <journal-id journal-id-type="publisher-id">bioadv</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics Advances</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2635-0041</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9245627</article-id>
    <article-id pub-id-type="pmid">35785021</article-id>
    <article-id pub-id-type="doi">10.1093/bioadv/vbac045</article-id>
    <article-id pub-id-type="publisher-id">vbac045</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genetics and Population Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>P-smoother: efficient PBWT smoothing of large haplotype panels</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Yue</surname>
          <given-names>William</given-names>
        </name>
        <aff><institution>School of Biomedical Informatics, University of Texas Health Science Center at Houston</institution>, Houston, TX 77030, <country country="US">USA</country></aff>
        <xref rid="vbac045-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Naseri</surname>
          <given-names>Ardalan</given-names>
        </name>
        <aff><institution>School of Biomedical Informatics, University of Texas Health Science Center at Houston</institution>, Houston, TX 77030, <country country="US">USA</country></aff>
        <xref rid="vbac045-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wang</surname>
          <given-names>Victor</given-names>
        </name>
        <aff><institution>School of Biomedical Informatics, University of Texas Health Science Center at Houston</institution>, Houston, TX 77030, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Shakya</surname>
          <given-names>Pramesh</given-names>
        </name>
        <aff><institution>Department of Computer Science, University of Central Florida</institution>, Orlando, FL 32816, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-4051-5549</contrib-id>
        <name>
          <surname>Zhang</surname>
          <given-names>Shaojie</given-names>
        </name>
        <aff><institution>Department of Computer Science, University of Central Florida</institution>, Orlando, FL 32816, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-7754-1890</contrib-id>
        <name>
          <surname>Zhi</surname>
          <given-names>Degui</given-names>
        </name>
        <aff><institution>School of Biomedical Informatics, University of Texas Health Science Center at Houston</institution>, Houston, TX 77030, <country country="US">USA</country></aff>
        <xref rid="vbac045-cor1" ref-type="corresp"/>
        <!--degui.zhi@uth.tmc.edu-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Lengauer</surname>
          <given-names>Thomas</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="vbac045-cor1">To whom correspondence should be addressed. <email>degui.zhi@uth.tmc.edu</email></corresp>
      <fn id="vbac045-FM1">
        <p>William Yue and Ardalan Naseri wish it to be known that, in their opinion, the first two authors should be regarded as Joint Authors.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2022-06-20">
      <day>20</day>
      <month>6</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>20</day>
      <month>6</month>
      <year>2022</year>
    </pub-date>
    <volume>2</volume>
    <issue>1</issue>
    <elocation-id>vbac045</elocation-id>
    <history>
      <date date-type="received">
        <day>22</day>
        <month>3</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>03</day>
        <month>5</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>24</day>
        <month>5</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>15</day>
        <month>6</month>
        <year>2022</year>
      </date>
      <date date-type="corrected-typeset">
        <day>30</day>
        <month>6</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="vbac045.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>As large haplotype panels become increasingly available, efficient string matching algorithms such as positional Burrows-Wheeler transformation (PBWT) are promising for identifying shared haplotypes. However, recent mutations and genotyping errors create occasional mismatches, presenting challenges for exact haplotype matching. Previous solutions are based on probabilistic models or seed-and-extension algorithms that passively tolerate mismatches.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>Here, we propose a PBWT-based smoothing algorithm, P-smoother, to actively ‘correct’ these mismatches and thus ‘smooth’ the panel. P-smoother runs a bidirectional PBWT-based panel scanning that flips mismatching alleles based on the overall haplotype matching context, which we call the IBD (identical-by-descent) prior. In a simulated panel with 4000 haplotypes and a 0.2% error rate, we show it can reliably correct 85% of errors. As a result, PBWT algorithms running over the smoothed panel can identify more pairwise IBD segments than that over the unsmoothed panel. Most strikingly, a PBWT-cluster algorithm running over the smoothed panel, which we call PS-cluster, achieves state-of-the-art performance for identifying multiway IBD segments, a challenging problem in the computational community for years. We also showed that PS-cluster is adequately efficient for UK Biobank data. Therefore, P-smoother opens up new possibilities for efficient error-tolerating algorithms for biobank-scale haplotype panels.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>Source code is available at <ext-link xlink:href="http://github.com/ZhiGroup/P-smoother" ext-link-type="uri">github.com/ZhiGroup/P-smoother</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Institutes of Health</institution>
            <institution-id institution-id-type="DOI">10.13039/100000002</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>R01HG010086</award-id>
        <award-id>R56HG011509</award-id>
        <award-id>OT2OD002751</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="7"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>In the biobank era, large collections of whole-genome genotype data are becoming abundantly available. Modern phasing methods (<xref rid="vbac045-B3" ref-type="bibr">Delaneau <italic toggle="yes">et al.</italic>, 2019</xref>; <xref rid="vbac045-B10" ref-type="bibr">Loh <italic toggle="yes">et al.</italic>, 2016a</xref>, <xref rid="vbac045-B11" ref-type="bibr">b</xref>) can generate accurate large haplotype panels. On the surface, such panels are large matrices of binary values. However, these values are generated by evolutionary processes at the crude scale and by genealogical processes at the fine scale. It is important to model haplotype panels with these processes in mind.</p>
    <p>The traditional phylogenetic or population genetics modeling methods typically view haplotype panels as a collection of independent columns, each representing a polymorphic variant site. The Li-and-Stephens model (<xref rid="vbac045-B9" ref-type="bibr">Li and Stephens, 2003</xref>) is a hidden Markov model capturing the dependencies of adjacent sites. However, it is inefficient for modeling long haplotypes. The positional Burrows-Wheeler transformation (PBWT; <xref rid="vbac045-B4" ref-type="bibr">Durbin, 2014</xref>) views a haplotype panel as a collection of aligned sequences. By sorting these sequences at each site according to their reverse prefix, PBWT enables efficient exact matching of aligned substrings in haplotype panels. As a result, PBWT has served as an engine for efficient solutions for identical-by-descent (IBD) segment matching (<xref rid="vbac045-B5" ref-type="bibr">Freyman <italic toggle="yes">et al.</italic>, 2021</xref>; <xref rid="vbac045-B16" ref-type="bibr">Naseri <italic toggle="yes">et al.</italic>, 2019</xref>; <xref rid="vbac045-B23" ref-type="bibr">Zhou <italic toggle="yes">et al.</italic>, 2020</xref>), runs-of-homozygosity cluster calling (<xref rid="vbac045-B17" ref-type="bibr">Naseri <italic toggle="yes">et al.</italic>, 2020</xref>) and genotype imputation (<xref rid="vbac045-B2" ref-type="bibr">Browning <italic toggle="yes">et al.</italic>, 2018</xref>; <xref rid="vbac045-B20" ref-type="bibr">Rubinacci <italic toggle="yes">et al.</italic>, 2020</xref>) for very large haplotype panels.</p>
    <p>One major problem for PBWT in modeling real-world sequences is that real data typically contain mismatches disrupting long haplotype matches. The major source of genotyping errors is from genotype calling pipelines. Despite advanced genotype calling methods, genotyping errors still exist and the rate can vary between 0.1% and 0.5%. For example, 0.1% genotyping error is expected in sequencing data (<xref rid="vbac045-B21" ref-type="bibr">Wang <italic toggle="yes">et al.</italic>, 2021</xref>) while array data from Wellcome Trust Case Control Consortium (WTCCC) has an estimated error rate of 0.2% (<xref rid="vbac045-B13" ref-type="bibr">Marchini and Howie, 2010</xref>). In addition, phasing methods may introduce additional mismatches in haplotypes. Even without errors, rare and private mutations and somatic mosaicisms (<xref rid="vbac045-B12" ref-type="bibr">Loh <italic toggle="yes">et al.</italic>, 2018</xref>) exist naturally. Each of these factors has the potential of creating mismatches that make PBWT ‘bristle’, i.e. with fragmented long matches. Furthermore, it can be difficult to discern these sources of mismatches from each other.</p>
    <p>Existing PBWT-based IBD segment calling methods have formerly introduced methods for tolerating mismatches. RaPID (<xref rid="vbac045-B16" ref-type="bibr">Naseri <italic toggle="yes">et al.</italic>, 2019</xref>) introduced a probabilistic model over multiple random projections of a panel to tolerate mismatches. hap-IBD (<xref rid="vbac045-B23" ref-type="bibr">Zhou <italic toggle="yes">et al.</italic>, 2020</xref>) used a ‘seed-and-extension’ method that extends the matches seeded by short exact PBWT matches. These methods treat mismatches as random errors, thus can only passively ‘tolerate’ them.</p>
    <p>In this work, we propose an IBD prior model capturing the continuity of matching haplotypes. For a haplotype sequence value at a particular site, our model encodes the information of sequences IBD to this sequence at the surrounding sites. While not in an explicit probabilistic form, the IBD prior can be used as a reference against which the actual observed haplotype value can be checked. Based on the IBD prior, we introduce a PBWT-based smoothing process called PBWT-smoother, or P-smoother, that can actively correct mismatches in haplotype panels. P-smoother leverages the bidirectional PBWT (bi-PBWT; <xref rid="vbac045-B18" ref-type="bibr">Naseri <italic toggle="yes">et al.</italic>, 2021</xref>) data structure and scanning algorithm to efficiently make corrections.</p>
    <p>We evaluated the effectiveness of P-smoother for correcting errors and mutations to establish its effectiveness. We then applied standard PBWT algorithms to the smoothed haplotype panels and identified multiway IBD segments, or IBD clusters. Interestingly, to the best of our knowledge, there are no efficient methods for identifying IBD clusters in large haplotype panels.</p>
    <p>Overall, our contributions are the following. First, we developed the first IBD prior model for haplotype panels. Second, we developed a mismatch correction method that can alleviate the problem of mismatches in haplotype panels. Third, we developed a new IBD cluster calling method that is the first efficient method for large haplotype panels.</p>
  </sec>
  <sec>
    <title>2 Methods</title>
    <sec>
      <title>2.1 The IBD prior model</title>
      <p>The underlying idea of the IBD prior model is that at any <italic toggle="yes">x<sub>ik</sub></italic> position, indicating the <italic toggle="yes">i</italic>-th sequence at column <italic toggle="yes">k</italic> of a haplotype panel <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>M</mml:mi><mml:mo>×</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, the nucleotide sequence value <italic toggle="yes">x<sub>ik</sub></italic> is typically consistent with other sequences <italic toggle="yes">x<sub>j</sub></italic> that are IBD with this sequence <italic toggle="yes">x<sub>i</sub></italic>. Specifically, we define <italic toggle="yes">x<sub>ik’</sub></italic>s <italic toggle="yes">L</italic>-block to its left, <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, as the maximal set of haplotypes such that for all <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, <italic toggle="yes">x<sub>ja</sub></italic> = <italic toggle="yes">x<sub>ia</sub></italic> for <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mi>L</mml:mi><mml:mo>≤</mml:mo><mml:mi>a</mml:mi><mml:mo>&lt;</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula>. Similarly, its <italic toggle="yes">L</italic>-block to its right, <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, is defined as the maximal set of haplotypes such that for all <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, <italic toggle="yes">x<sub>ja</sub></italic> = <italic toggle="yes">x<sub>ia</sub></italic> for <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>&lt;</mml:mo><mml:mi>a</mml:mi><mml:mo>≤</mml:mo><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mi>L</mml:mi></mml:mrow></mml:math></inline-formula>. When not ambiguous, we refer to them as <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula>. <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> represent the set of sequences that are identical-by-state (IBS) to the left and to the right of site <italic toggle="yes">k</italic> for sequence <italic toggle="yes">x<sub>i</sub></italic>. Furthermore, both <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> likely contain sequences IBD to <italic toggle="yes">x<sub>i</sub></italic>. Therefore, by way of transitivity, most sequences should be shared between <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> because recombination events are expected to be rare at site <italic toggle="yes">k</italic>. Here, we define the set of haplotypes that are IBS to sequence <italic toggle="yes">x<sub>i</sub></italic> at position <italic toggle="yes">k</italic>, without consideration of position <italic toggle="yes">k</italic> itself, <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>B</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∩</mml:mo><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, as the <italic toggle="yes">bidirectional IBD set</italic> or the <italic toggle="yes">bidirectional block</italic> of <italic toggle="yes">x<sub>ik</sub></italic>. The rationale of having a bidirectional match is that it will filter out non-IBD one-sided <italic toggle="yes">L</italic>-blocks that are unlikely to continue on the other side, allow us to put column <italic toggle="yes">k</italic> into the center of focus and surround matching sequences with enough sites to help cushion against potential edge effects.</p>
      <p>Focusing on position <italic toggle="yes">k</italic> itself, the location <italic toggle="yes">x<sub>ik</sub></italic> has a <italic toggle="yes">reference set</italic> <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mi>B</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>}</mml:mo><mml:mo>\</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>. Without directly observing the value of <italic toggle="yes">x<sub>ik</sub></italic>, we can infer the value of <italic toggle="yes">x<sub>ik</sub></italic> using its reference set. We can therefore define an IBD prior function <italic toggle="yes">π</italic> summarizing the information in <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. For example, we can introduce three criteria:
</p>
      <list list-type="order">
        <list-item>
          <p>The local haplotype match (<inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula>) length <italic toggle="yes">L</italic> is large.</p>
        </list-item>
        <list-item>
          <p>The number of sequences in <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is large: <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo><mml:mo>≥</mml:mo><mml:mi>W</mml:mi></mml:mrow></mml:math></inline-formula>.</p>
        </list-item>
        <list-item>
          <p>A vast majority of the sequences in <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> agree: the allele frequency <italic toggle="yes">AF</italic>(<italic toggle="yes">b</italic>), where <italic toggle="yes">b</italic> is the minor allele, is below a certain threshold <italic toggle="yes">ρ</italic>.</p>
        </list-item>
      </list>
      <p>Formally, we can define the prior as a simple rule-based function with parameter <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mrow><mml:mo>θ</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mo>ρ</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>:
<disp-formula id="E1"><label>(1)</label><mml:math id="M1" display="block" overflow="scroll"><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mo>θ</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">x</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>b</mml:mi><mml:mo>|</mml:mo><mml:mi>L</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mo>ρ</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="true">{</mml:mo><mml:mrow><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo><mml:mo>≥</mml:mo><mml:mi>W</mml:mi><mml:mo> </mml:mo><mml:mtext>and</mml:mtext><mml:mo> </mml:mo><mml:mi>A</mml:mi><mml:mi>F</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>&lt;</mml:mo><mml:mo>ρ</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>otherwise</mml:mtext><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo>.</mml:mo></mml:math></disp-formula></p>
      <p>If the probability is 1 for both <italic toggle="yes">b </italic>=<italic toggle="yes"> </italic>0 and <italic toggle="yes">b </italic>=<italic toggle="yes"> </italic>1, i.e. the reference set <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is not large enough, then we keep the original allele value due to a lack of conclusive evidence. Certainly, more sophisticated priors could be designed that better capture the population genetics process and the sampling process. In this work, we will be primarily experimenting with this simple prior and leave more systematic investigation of other priors as future work.</p>
      <p>This model can be used for genotype imputation, genotyping error correction and smoothing. For genotype imputation, the premise is that not all sequences are observable at the position <italic toggle="yes">k</italic>, and the goal is to fill in the unobserved allele values. For genotyping error correction, even though all sequences are observed, we compare the observed <italic toggle="yes">x<sub>ik</sub></italic> to the estimated from <xref rid="E1" ref-type="disp-formula">Equation (1)</xref>. However, as it is often difficult to distinguish errors from rare and private mutations, pure correction of errors may not be a practical goal. However, for the sake of identifying IBD blocks that might otherwise be interrupted by mismatches, it is possible to conduct a smoothing procedure. The goal of smoothing is to maximize the agreement at site <italic toggle="yes">k</italic> between <italic toggle="yes">x<sub>i</sub></italic> and <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:mi>B</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, i.e. maximize the overlap between <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Thus, a natural choice is to force the correction of <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mtext>argmax</mml:mtext></mml:mrow></mml:mrow><mml:mi>b</mml:mi></mml:msub><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mo>θ</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">x</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>. Note that for smoothing to be conducted, the number of sequences does not need to be large, as we are more interested in the continuity of the blocks <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> than in making the corrected genotype calls. Also, the smoothing parameters <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:mo>θ</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mo>ρ</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> can be adjusted according to the objective of the downstream task. In this work, we will be mostly focusing on calling multiway IBD segments, which we attempted to optimize.</p>
      <p>As will be described below, the design of the IBD prior is based on the availability of efficient algorithms for computing it at each position within the panel.</p>
    </sec>
    <sec>
      <title>2.2 Efficient computation of the IBD smoothing through bi-PBWT</title>
      <sec>
        <title>2.2.1 Positional Burrows-Wheeler transformation</title>
        <p>The underlying idea of the PBWT is to sort haplotype sequences at each site by their reversed prefixes. This allows the efficient computation of match length (longest common prefix) between adjacent haplotypes in sorted order, which we then use to efficiently detect blocks of matching haplotypes. Furthermore, PBWT can be extended to be bidirectional in order to allow for the detection of blocks across a gap (a contiguous segment of sites).</p>
        <p>Given a haplotype panel <bold>x</bold>, PBWT calculates two additional arrays, the positional prefix and divergence arrays, which facilitate an efficient approach to finding long matches. The positional prefix array stores the haplotype indices in reversed prefix order at variant site <italic toggle="yes">k</italic>, while the divergence array at the variant site <italic toggle="yes">k</italic> stores the starting position of the match between each haplotype and its preceding haplotype in the reversed prefix order.</p>
        <p>By sorting the haplotype sequences in reversed prefix order at each site <italic toggle="yes">k</italic>, each haplotype will be placed adjacent to the haplotype with which it has the longest match. A block of matching haplotypes is defined as a width-maximal set of haplotypes matching over sites <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mi>L</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> (<xref rid="vbac045-B17" ref-type="bibr">Naseri <italic toggle="yes">et al.</italic>, 2020</xref>). Blocks of matching haplotypes will be bounded by a haplotype whose divergence value is greater than <italic toggle="yes">k—L</italic>, where <italic toggle="yes">L</italic> denotes the desired length of a match. Since matching haplotypes appear contiguously in the positional prefix order, the blocks of matching haplotypes can be efficiently computed. PBWT has already been used in other works to find matching blocks in large haplotype panels (<xref rid="vbac045-B1" ref-type="bibr">Alanko <italic toggle="yes">et al.</italic>, 2019</xref>; <xref rid="vbac045-B22" ref-type="bibr">Williams and Mumey, 2020</xref>).</p>
      </sec>
      <sec>
        <title>2.2.2 Bidirectional PBWT</title>
        <p>Bi-PBWT (<xref rid="vbac045-B18" ref-type="bibr">Naseri <italic toggle="yes">et al.</italic>, 2021</xref>) calculates the PBWT arrays for both the forward and reverse directions at each variant site <italic toggle="yes">k</italic>. Given a minimum cut-off length <italic toggle="yes">L</italic>, the matching blocks can be efficiently computed for both directions. We define the element-wise intersection of a forward block set <italic toggle="yes">S</italic> and a reverse block set <italic toggle="yes">T</italic> to be <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mrow><mml:mi>U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mi>s</mml:mi><mml:mo>∩</mml:mo><mml:mi>t</mml:mi><mml:mo>|</mml:mo><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mi>S</mml:mi><mml:mo>∧</mml:mo><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo><mml:mo>∖</mml:mo><mml:mo>{</mml:mo><mml:mo>∅</mml:mo><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>, which can be computed in linear time. Most importantly, <italic toggle="yes">S</italic> and <italic toggle="yes">T</italic> do not have to be from the same site <italic toggle="yes">k</italic>. This property allows for the introduction of a gap where <italic toggle="yes">S</italic> is taken from site <italic toggle="yes">k</italic> and <italic toggle="yes">T</italic> is taken from site <italic toggle="yes">k </italic>+<italic toggle="yes"> g</italic>, where <italic toggle="yes">g</italic> is the size of the gap. For memory efficiency, bi-PBWT can be implemented by first saving the reverse PBWT onto the disk prior to performing a forward scan to element-wise intersect the forward and reverse PBWTs (<xref rid="vbac045-B18" ref-type="bibr">Naseri <italic toggle="yes">et al.</italic>, 2021</xref>).</p>
        <p>The bi-PBWT forwarding scanning algorithm to element-wise intersect <italic toggle="yes">S</italic> and <italic toggle="yes">T</italic> at each site <italic toggle="yes">k</italic> is implemented with a radix sort. Each haplotype is assigned a forward block ID and a reverse block ID. When the haplotypes are sorted based on these IDs, haplotypes in the same forward and reverse block appear in the sorted haplotype list as a contiguous segment, which allows for the easy extraction of bidirectional blocks <inline-formula id="IE35"><mml:math id="IM35" display="inline" overflow="scroll"><mml:mrow><mml:mi>B</mml:mi><mml:mo>∈</mml:mo><mml:mi>U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      </sec>
      <sec>
        <title>2.2.3 P-smoother</title>
        <p>We hypothesize that mismatches fragmenting otherwise perfect matching blocks <italic toggle="yes">B</italic> are likely to still be surrounded by fragments of smaller matching blocks <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula>. The need to identify mismatches by neighboring matching blocks on both sides of a site naturally leads us to use the bi-PBWT algorithm. bi-PBWT allows us to efficiently find bidirectional blocks that match across a gap. For the bidirectional blocks that we find using bi-PBWT, we can mismatch-correct sites inside the gap as we know mismatches inside this gap are fragmenting what would be a larger matching block. To mismatch-correct a site within the gap in a bi-PBWT block, we compute the minor allele frequency (MAF) of the alleles in the block at that site and then change the minor alleles to the major allele if the MAF is below the threshold <italic toggle="yes">ρ</italic>. Smoothing a panel with P-smoother guarantees that mismatches (below threshold <italic toggle="yes">ρ</italic>) with adjacent matching blocks <inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> will be corrected. Note that mismatches located on the <italic toggle="yes">L</italic> sites at either end of the chromosome will not be corrected since these mismatches will lack either <inline-formula id="IE40"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> or <inline-formula id="IE41"><mml:math id="IM41" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula>. However, this edge case affects a negligible number of sites as the optimal value of <italic toggle="yes">L</italic> is around 20 sites (see Section 3.4 for more details on the tuning of <italic toggle="yes">L</italic>). <xref rid="vbac045-F1" ref-type="fig">Figure 1</xref> illustrates the idea of utilizing P-smoother to generate a new smoothed panel from an original panel potentially plagued by mismatches. <xref rid="vbac045-BOX1" ref-type="boxed-text">Algorithm 1</xref> outlines the pseudocode for mismatch-correcting inside the gap of a block <inline-formula id="IE42"><mml:math id="IM42" display="inline" overflow="scroll"><mml:mrow><mml:mi>B</mml:mi><mml:mo>∈</mml:mo><mml:mi>U</mml:mi></mml:mrow></mml:math></inline-formula> found by bi-PBWT that meets the length (<italic toggle="yes">L</italic>) and width (<italic toggle="yes">W</italic>) requirements (criteria 1 and 2).</p>
        <fig position="float" id="vbac045-F1">
          <label>Fig. 1.</label>
          <caption>
            <p>P-smoother correcting an allele in the original panel to create a smoothed panel. P-smoother utilizes the two matching blocks (<inline-formula id="IE43"><mml:math id="IM43" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE44"><mml:math id="IM44" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula>) from bi-PBWT. The gap size <italic toggle="yes">g</italic> and other P-smoother parameters are highlighted. A further description of these parameters can be found in Section. The values of the parameters in this figure are <inline-formula id="IE45"><mml:math id="IM45" display="inline" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mn>8</mml:mn><mml:mo> </mml:mo><mml:mtext>sites</mml:mtext><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:mn>4</mml:mn><mml:mo> </mml:mo><mml:mtext>haplotypes</mml:mtext><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn><mml:mo> </mml:mo><mml:mtext>sites</mml:mtext><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo>ρ</mml:mo><mml:mo>=</mml:mo><mml:mn>35</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula>. The MAF of the three gap sites from left to right are 50%, 0% and 25%. In order for a site in the gap to be corrected, the site must have a nonzero minimum allele frequency that is less than <italic toggle="yes">ρ</italic>. Since <inline-formula id="IE46"><mml:math id="IM46" display="inline" overflow="scroll"><mml:mrow><mml:mo>ρ</mml:mo><mml:mo>=</mml:mo><mml:mn>35</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> in this figure, only the third site in the gap meets the criteria to be corrected</p>
          </caption>
          <graphic xlink:href="vbac045f1" position="float"/>
        </fig>
        <boxed-text id="vbac045-BOX1" position="float">
          <caption>
            <p><bold>Algorithm 1</bold> Mismatch correct inside the gap of a block <inline-formula id="IE47"><mml:math id="IM47" display="inline" overflow="scroll"><mml:mrow><mml:mi>B</mml:mi><mml:mo>∈</mml:mo><mml:mi>U</mml:mi></mml:mrow></mml:math></inline-formula></p>
          </caption>
          <p>1: <bold>procedure</bold><sc>Smooth</sc>(Block <italic toggle="yes">B</italic>)</p>
          <p>2:  <inline-formula id="IE48"><mml:math id="IM48" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">zero</mml:mi><mml:mo>←</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="italic">one</mml:mi><mml:mo>←</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> ▹ <inline-formula id="IE49"><mml:math id="IM49" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">zero</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE50"><mml:math id="IM50" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">one</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> store the number of zeros and ones at site <italic toggle="yes">i</italic> in the gap</p>
          <p>3:  <bold>for</bold><inline-formula id="IE51"><mml:math id="IM51" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>←</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula><bold>to</bold> <italic toggle="yes">G</italic> <bold>do</bold></p>
          <p>4:   <bold>if</bold><inline-formula id="IE52"><mml:math id="IM52" display="inline" overflow="scroll"><mml:mrow><mml:mi>min</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">zero</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="italic">one</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>≤</mml:mo><mml:mo>|</mml:mo><mml:mi>B</mml:mi><mml:mo>|</mml:mo><mml:mo>·</mml:mo><mml:mo>ρ</mml:mo></mml:mrow></mml:math></inline-formula><bold>then</bold></p>
          <p>5:    <bold>if</bold><inline-formula id="IE53"><mml:math id="IM53" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">zero</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo>&gt;</mml:mo><mml:mi mathvariant="italic">one</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula><bold>then</bold></p>
          <p>6:     <inline-formula id="IE54"><mml:math id="IM54" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">correctAllele</mml:mi><mml:mo>←</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula></p>
          <p>7:    <bold>else</bold></p>
          <p>8:     <inline-formula id="IE55"><mml:math id="IM55" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">correctAllele</mml:mi><mml:mo>←</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula></p>
          <p>9:    <bold>end if</bold></p>
          <p>10    <bold>for all</bold><inline-formula id="IE56"><mml:math id="IM56" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:math></inline-formula><bold>do</bold></p>
          <p>11:     <inline-formula id="IE57"><mml:math id="IM57" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="italic">correctAllele</mml:mi></mml:mrow></mml:math></inline-formula></p>
          <p>12:    <bold>end for</bold></p>
          <p>13:   <bold>end if</bold></p>
          <p>14:  <bold>end for</bold></p>
          <p>15: <bold>end procedure</bold></p>
        </boxed-text>
      </sec>
      <sec>
        <title>2.2.4 P-smoother parameters</title>
        <p>P-smoother takes four parameters: <inline-formula id="IE58"><mml:math id="IM58" display="inline" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo>ρ</mml:mo></mml:mrow></mml:math></inline-formula> (the first three can be found in <xref rid="vbac045-F1" ref-type="fig">Fig. 1</xref>). The parameters <italic toggle="yes">L</italic> (in units of sites) and <italic toggle="yes">W</italic> (in units of haplotypes) specify the minimum length and width requirements for bidirectional blocks. <italic toggle="yes">g</italic> (in units of sites) specifies the gap size of bidirectional blocks. Finally, <italic toggle="yes">ρ</italic> (a percentage) specifies the minimum allele frequency threshold for mismatches to be corrected inside of a gap. A thorough analysis and tuning of these parameters can be found in Section 3.4.</p>
      </sec>
    </sec>
    <sec>
      <title>2.3 Time and space complexity</title>
      <p>As P-smoother implements bi-PBWT, its time complexity is also <italic toggle="yes">O</italic>(<italic toggle="yes">MN</italic>) where <italic toggle="yes">M</italic> is the number of haplotypes and <italic toggle="yes">N</italic> is the number of sites in the panel. At any point in time, the only memory required by P-smoother is the storage of the alleles in the gap, and because there can be at most <italic toggle="yes">gM</italic> alleles in the gap, the space complexity is <italic toggle="yes">O</italic>(<italic toggle="yes">gM</italic>). A linear time complexity and sublinear space complexity with respect to the input size (<italic toggle="yes">MN</italic>) allows P-smoother to be resource efficient and highly scalable to biobank data.</p>
    </sec>
    <sec>
      <title>2.4 Multiway IBD segment calling</title>
      <p>Multiway IBD segments (i.e. IBD segments shared by multiple individuals), or IBD clusters for short, are of interest to family studies and disease mapping. Assuming equal length, IBD clusters present a stronger statistical signal than pairwise IBDs for tracing distant relatives and pedigree (<xref rid="vbac045-B6" ref-type="bibr">Gusev <italic toggle="yes">et al.</italic>, 2011</xref>; <xref rid="vbac045-B15" ref-type="bibr">Moltke <italic toggle="yes">et al.</italic>, 2011</xref>; <xref rid="vbac045-B19" ref-type="bibr">Qian <italic toggle="yes">et al.</italic>, 2014</xref>). Moreover, IBD clusters can reveal long haplotypes that are signals for selection, or directly serve as inputs for association studies with phenotypes.</p>
      <p>However, there are not many existing methods for inferring IBD clusters. The few existing methods are limited in terms of speed and the types of IBD clusters they can detect. <xref rid="vbac045-B15" ref-type="bibr">Moltke <italic toggle="yes">et al.</italic> (2011)</xref> directly infer IBD clusters using a Markov Chain Monte Carlo method, but it is not efficient for large samples. DASH (<xref rid="vbac045-B6" ref-type="bibr">Gusev <italic toggle="yes">et al.</italic>, 2011</xref>), EMI (<xref rid="vbac045-B19" ref-type="bibr">Qian <italic toggle="yes">et al.</italic>, 2014</xref>) and IBD-groupon (<xref rid="vbac045-B7" ref-type="bibr">He, 2013</xref>) postprocess pairwise IBD results to identify dense clusters of pairwise IBD segments. However, their performance heavily relies on the quality and speed of the initial pairwise IBD segment detection. Recently, consensus PBWT (cPBWT; <xref rid="vbac045-B17" ref-type="bibr">Naseri <italic toggle="yes">et al.</italic>, 2020</xref>) has enabled directly calling PBWT blocks as IBD clusters, but it is unable to tolerate mismatches.</p>
      <p>We propose to conduct IBD cluster calling by utilizing P-smoother to produce a smoothed haplotype panel for cPBWT to extract clusters. Our proposed new P-smoother-cluster method, or PS-cluster method for short, can directly identify IBD clusters. Of note, there are two user-specified parameters for the cPBWT algorithm, namely the minimal cluster length <inline-formula id="IE59"><mml:math id="IM59" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, the minimal cluster width <inline-formula id="IE60"><mml:math id="IM60" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, in addition to the parameters for the P-smoother algorithm. <inline-formula id="IE61"><mml:math id="IM61" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <italic toggle="yes">L</italic> are not necessarily the same, and neither are <inline-formula id="IE62"><mml:math id="IM62" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <italic toggle="yes">W</italic>.</p>
      <p>While P-smoother and cPBWT are conceptually separate, they can be implemented simultaneously in the same pass. The reverse PBWT blocks are first computed in a reverse pass, then the forward pass is implemented with each site first being processed by P-smoother and then by cPBWT.</p>
    </sec>
    <sec>
      <title>2.5 Benchmarking using simulated data</title>
      <sec>
        <title>2.5.1 Simulation</title>
        <p>We simulated 1 million haplotypes of European ancestry using stdpopsim. The HapMap genetic map (GRCh37) was used to simulate haplotypes of chromosome 20. We used the population model OutOfAfrica_2T12 defined in stdpopsim and generated 500 000 Europeans. The sites with low allele frequencies (MAF &lt; 0.1) were filtered out using bcftools. The first 4000 haplotypes were extracted for benchmarking pairwise IBD segment detection and IBD cluster detection.</p>
      </sec>
      <sec>
        <title>2.5.2 Performance evaluation for IBD cluster detection</title>
        <p>As there is no existing method efficient enough to identify IBD clusters in large panels, we only benchmarked PS-cluster against plain cPBWT.</p>
        <p>Interestingly, there has been little work in defining ground truth and benchmarking methods for IBD cluster detection. For example, IBDgroupon was only benchmarked for clusters of 3–5 haplotypes among a sample of 100 haplotypes and was using random sequences rather than sequences resulting from population genetic processes. Therefore, we developed our own framework for evaluating IBD cluster detection methods for large panels.</p>
        <sec>
          <title>2.5.2.1 Extraction of ground truth IBD clusters</title>
          <p>We used the msprime package to generate a tree sequence, from which we extracted the IBD segments using the tskit package (<xref rid="vbac045-B8" ref-type="bibr">Kelleher <italic toggle="yes">et al.</italic>, 2016</xref>). We created an interim panel consistent with the ground truth IBD segments by implanting identical segments for haplotypes sharing a ground truth IBD segment. Specifically, we first initialized a panel <inline-formula id="IE63"><mml:math id="IM63" display="inline" overflow="scroll"><mml:mrow><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>M</mml:mi><mml:mo>×</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. As we iterated over every site <italic toggle="yes">k</italic> in a given IBD segment between haplotypes <italic toggle="yes">x<sub>i</sub></italic> and <italic toggle="yes">x<sub>j</sub></italic>, we updated the entries <italic toggle="yes">x<sub>ik</sub></italic> and <italic toggle="yes">x<sub>jk</sub></italic> in the interim panel. If both entries were –1, we randomly chose 0 or 1 to assign to both <italic toggle="yes">x<sub>ik</sub></italic> and <italic toggle="yes">x<sub>jk</sub></italic>. If either entry was 0 or 1, we assigned its value to the other entry. Finally, we ran cPBWT on the interim panel to extract the ground truth IBD clusters.</p>
        </sec>
        <sec>
          <title>2.5.2.2 Power and accuracy metrics</title>
          <p>We define the area of an IBD cluster to be the number of haplotypes in the cluster multiplied by the number of sites in the cluster. Similarly, the overlap between two IBD clusters is defined as the number of shared haplotypes multiplied by the number of shared sites.</p>
          <p>The power of a ground truth IBD cluster is defined as the maximum overlap between the ground truth IBD cluster and a reported IBD cluster, normalized by the area of the ground truth IBD cluster. The overall power is defined as the average power of the ground truth IBD clusters.</p>
          <p>The accuracy of a reported IBD cluster is defined as the maximum overlap between the reported IBD cluster and a ground truth IBD cluster, normalized by the area of the reported IBD cluster. The overall accuracy is defined as the average accuracy of the reported IBD clusters.</p>
        </sec>
      </sec>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>Here, we first showcase P-smoother’s ability to error correct before demonstrating P-smoother’s applicability to IBD segment and IBD cluster detection. Error correction and IBD/cluster detection experiments were all benchmarked on a simulated panel with 4000 haplotypes and 47 821 variant sites. P-smoother’s parameters were set to the default of <inline-formula id="IE64"><mml:math id="IM64" display="inline" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mn>20</mml:mn><mml:mo> </mml:mo><mml:mtext>sites</mml:mtext><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo> </mml:mo><mml:mtext>site</mml:mtext><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo>ρ</mml:mo><mml:mo>=</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula> for all experiments. In the case of error correction and IBD detection, the default <inline-formula id="IE65"><mml:math id="IM65" display="inline" overflow="scroll"><mml:mrow><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:mn>20</mml:mn><mml:mo> </mml:mo><mml:mtext>haplotypes</mml:mtext></mml:mrow></mml:math></inline-formula> was used. In the case of IBD cluster detection, <italic toggle="yes">W</italic> was set to the target cluster width <inline-formula id="IE66"><mml:math id="IM66" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (<inline-formula id="IE67"><mml:math id="IM67" display="inline" overflow="scroll"><mml:mrow><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>).</p>
    <sec>
      <title>3.1 Error correction</title>
      <p>As shown in <xref rid="vbac045-T1" ref-type="table">Table 1</xref>, P-smoother with default parameters of <inline-formula id="IE68"><mml:math id="IM68" display="inline" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mn>20</mml:mn><mml:mo> </mml:mo><mml:mtext>sites</mml:mtext><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:mn>20</mml:mn><mml:mo> </mml:mo><mml:mtext>haplotypes</mml:mtext><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo> </mml:mo><mml:mtext>site</mml:mtext><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo>ρ</mml:mo><mml:mo>=</mml:mo><mml:mn>0.05</mml:mn><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula> can correct 84–87% of errors. P-smoother also corrected about 41 000–42 000 alleles that were not genotyping errors, which corresponds to about 0.02% of all alleles. Although rare mutations and genotyping errors are often indistinguishable, we observed that 36 459 of the nonerror corrections are shared by all four error rates (0–0.2%), leading us to believe the vast majority of these nonerror corrections are of mutations. As such, the precision values in <xref rid="vbac045-T1" ref-type="table">Table 1</xref> serve as a lower bound and are likely a significant underestimate, since the primary goal of P-smoother is to smooth mismatches and not purely to correct errors. In an attempt to more accurately represent P-smoother’s smoothing ability, we treat the 36 459 shared nonerrors corrected as rare mutations and combine them with true errors into a single category known as mismatches. Under this benchmark, P-smoother achieves 87–93% recall and 93–98% precision over error rates of 0.05–0.2%, indicating that P-smoother would significantly reduce mismatch rates and thus facilitate downstream haplotype matching tasks.</p>
      <table-wrap position="float" id="vbac045-T1">
        <label>Table 1.</label>
        <caption>
          <p>Error correction results</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="center" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Error rate</th>
              <th rowspan="1" colspan="1">Errors</th>
              <th rowspan="1" colspan="1">Corrections</th>
              <th rowspan="1" colspan="1">Errors corrected</th>
              <th rowspan="1" colspan="1">Nonerrors corrected</th>
              <th rowspan="1" colspan="1">Recall</th>
              <th rowspan="1" colspan="1">Precision</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">0%</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">42,150</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">42,150</td>
              <td align="center" rowspan="1" colspan="1">NA</td>
              <td rowspan="1" colspan="1">0%</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">0.05%</td>
              <td rowspan="1" colspan="1">47,572</td>
              <td rowspan="1" colspan="1">83,304</td>
              <td rowspan="1" colspan="1">41,377</td>
              <td rowspan="1" colspan="1">41,927</td>
              <td rowspan="1" colspan="1">86.98%</td>
              <td rowspan="1" colspan="1">49.67%</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">0.10%</td>
              <td rowspan="1" colspan="1">96,260</td>
              <td rowspan="1" colspan="1">124,118</td>
              <td rowspan="1" colspan="1">82,621</td>
              <td rowspan="1" colspan="1">41,497</td>
              <td rowspan="1" colspan="1">85.83%</td>
              <td rowspan="1" colspan="1">66.57%</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">0.20%</td>
              <td rowspan="1" colspan="1">190,840</td>
              <td rowspan="1" colspan="1">201,543</td>
              <td rowspan="1" colspan="1">160,505</td>
              <td rowspan="1" colspan="1">41,038</td>
              <td rowspan="1" colspan="1">84.10%</td>
              <td rowspan="1" colspan="1">79.64%</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
    <sec>
      <title>3.2 P-smoother improves power of detecting pairwise IBD segments</title>
      <p><xref rid="vbac045-F2" ref-type="fig">Figure 2</xref> compares the IBD segment detection of PBWT versus P-smoother for the target lengths 3 and 5 cM. The power and accuracy trends for both target IBD segment lengths are similar. When subjected to increasing genotyping error, P-smoother is able to hold its detection power relatively stable while the detection power of PBWT drops significantly. With regards to detection accuracy, PBWT and P-smoother both show a steady increase in accuracy when subjected to increasing genotyping error. While PBWT does increase in accuracy at a slightly faster rate than P-smoother, PBWT’s higher accuracy is not significant when its power is approaching the single-digit percentages in most cases.</p>
      <fig position="float" id="vbac045-F2">
        <label>Fig. 2.</label>
        <caption>
          <p>Power and accuracy of pairwise IBD segment detection with and without smoothing. The detection power of PBWT without smoothing is significantly lower in panels with genotyping errors</p>
        </caption>
        <graphic xlink:href="vbac045f2" position="float"/>
      </fig>
      <p>Please note that while P-smoother offers an improvement to PBWT for IBD segment detection, we do not claim to be the state-of-the-art in IBD segment detection. P-smoother’s forte is still multiway IBD cluster detection, but we seek to demonstrate that a panel smoothed by P-smoother offers improvements to not one but multiple potential downstream analyses.</p>
    </sec>
    <sec>
      <title>3.3 P-smoother followed by PBWT-cluster deliver state-of-the-art multiway IBD cluster detection</title>
      <p><xref rid="vbac045-F3" ref-type="fig">Figure 3</xref> compares the multiway IBD cluster detection of PBWT versus P-smoother for two targets. The first multiway IBD cluster target is <inline-formula id="IE69"><mml:math id="IM69" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo> </mml:mo><mml:mtext>cM</mml:mtext><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mo> </mml:mo><mml:mtext>haplotypes</mml:mtext></mml:mrow></mml:math></inline-formula> and the second is <inline-formula id="IE70"><mml:math id="IM70" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo> </mml:mo><mml:mtext>cM</mml:mtext><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>5</mml:mn><mml:mo> </mml:mo><mml:mtext>haplotypes</mml:mtext></mml:mrow></mml:math></inline-formula>. When subjected to increasing genotyping error, the accuracy of both methods is able to remain constant. With regards to power, however, P-smoother is able to hold its power relatively stable when subjected to increasing genotyping error while PBWT’s power drops significantly.</p>
      <fig position="float" id="vbac045-F3">
        <label>Fig. 3.</label>
        <caption>
          <p>Power and accuracy of IBD clusters detection with and without smoothing. PBWT without smoothing has a low detection power in panels with genotyping errors. P-smoother has significantly higher power and near-identical accuracy for minimum lengths of 1 and 2 cM</p>
        </caption>
        <graphic xlink:href="vbac045f3" position="float"/>
      </fig>
      <p>The conclusively superior multiway IBD cluster detection ability of P-smoother compared to PBWT (the current state-of-the-art) establishes that P-smoother elevates state-of-the-art multiway IBD detection to an optimal level that will bring impactful improvements to downstream multiway IBD cluster analyses.</p>
    </sec>
    <sec>
      <title>3.4 Parameter tuning</title>
      <p>With the goal of optimizing P-smoother for IBD cluster detection, most of the tuning was performed on the IBD cluster detection task. Through parameter tuning, we found that the optimal default parameters for IBD cluster detection are <inline-formula id="IE71"><mml:math id="IM71" display="inline" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mn>20</mml:mn><mml:mo> </mml:mo><mml:mtext>sites</mml:mtext><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo> </mml:mo><mml:mtext>site</mml:mtext><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo>ρ</mml:mo><mml:mo>=</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula> (see GitHub for tuning details). For error correction, the default parameters remain the same except <inline-formula id="IE72"><mml:math id="IM72" display="inline" overflow="scroll"><mml:mrow><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:mn>20</mml:mn><mml:mo> </mml:mo><mml:mtext>haplotypes</mml:mtext></mml:mrow></mml:math></inline-formula>. For all tuning experiments, parameters that were not being tuned were left at the default values.</p>
      <p>As we increased the parameter <italic toggle="yes">L</italic>, we observed a trend of increasing accuracy and decreasing power. This is expected since longer <inline-formula id="IE73"><mml:math id="IM73" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE74"><mml:math id="IM74" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> blocks surrounding an allele indicate a higher probability of a mismatch. As we varied <italic toggle="yes">L</italic> from 10 to 30 sites, the accuracy only increased by 0.2% while the power only decreased by 0.4%.</p>
      <p>As we increased the parameter <italic toggle="yes">ρ</italic>, we observed a trend of decreasing accuracy and increasing power. This is anticipated since a greater <italic toggle="yes">ρ</italic> allows corrections to happen at a lower confidence level and allows more mismatches to be corrected per block. As we varied <italic toggle="yes">ρ</italic> from 1% to 10%, we saw a 0.9% decrease in accuracy and a 3% increase in power.</p>
      <p>As we increased the parameter <italic toggle="yes">g</italic>, we saw a trend of decreasing power and accuracy. This is expected since blocks <inline-formula id="IE75"><mml:math id="IM75" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>−</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE76"><mml:math id="IM76" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> that are further apart give a weaker signal as to the true values of alleles in the gap between. As we varied <italic toggle="yes">g</italic> from 1 to 5 sites, we saw a 1.1% decrease in accuracy and a 0.2% decrease in power.</p>
      <p>For IBD cluster detection, we found it clear to set <inline-formula id="IE77"><mml:math id="IM77" display="inline" overflow="scroll"><mml:mrow><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. For error detection, as we increased the parameter <italic toggle="yes">W</italic>, we saw a trend of decreasing recall and increasing precision. This is expected since a larger minimum block width provides a larger sample size of alleles, increasing the confidence in the IBD prior’s predicted alleles.</p>
      <p>A potential concern is that P-smoother’s parameters are hypersensitive to small changes. However, as shown in the above analysis, the parameters are all robust to slight adjustments.</p>
    </sec>
    <sec>
      <title>3.5 UK biobank results</title>
      <p>The benchmarks below showcase P-smoother’s and PS-cluster’s performance on real biobank-scale data, namely UK Biobank chromosome 20 consisting of 974 818 haplotypes and 17 197 variant sites. We ran the benchmarks on an 8-core 2.10 GHz Intel Xeon E5-2620 v4.</p>
      <p>To examine P-smoother’s potential to improve pairwise IBD segment detection, we ran P-smoother on UK Biobank chromosome 20 to compare the original and smoothed panels. P-smoother took 3.53 CPU hours and 256 MB memory. In each panel, we removed the first 50 haplotypes to query against the rest of the haplotypes for IBD segments spanning at least 5 cM. In the original panel, 10 033 matches were reported, whereas in the smoothed panel, 11 647 matches were reported, for a 16% increase. To legitimize the greater number of matches in the absence of a definitive IBD segment ground truth, we ran RaPID, a top IBD segment detection tool for biobank-scale data that leverages random projections along with PBWT (<xref rid="vbac045-B16" ref-type="bibr">Naseri <italic toggle="yes">et al.</italic>, 2019</xref>), on the original panel with a match length requirement of 5 cM. Haplotypes between which RaPID reported a match were considered ground truth IBD. For each panel, we computed the percentage of reported IBD segments that corresponded to a ground truth IBD segment. The original panel yielded 99.3%, and the smoothed panel yielded 97.6%, indicating that P-smoother retains high accuracy while offering more powerful IBD segment detection.</p>
      <p>To examine P-smoother’s potential to improve IBD cluster detection, we ran P-smoother on chromosome 20 from UK Biobank. PS-cluster took 3.74 CPU hours and 276 MB memory. PS-cluster identified 3 656 950 100-way clusters over 1 cM. Due to the lack of efficient benchmarking for IBD clusters, this metric simply gives a rough portrayal of PS-cluster’s power.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussions</title>
    <p>In this work, we presented the concept of an IBD prior as well as efficient algorithms for computing our IBD prior in large haplotype panels. We showed that our IBD prior is able to produce a smoothed hapotype panel in which mismatches between otherwise matching haplotypes are corrected. A direct effect of this smoothing procedure is that the length of haplotype matches is increased. We demonstrated through experiments with simulated and real data that P-smoother boosted the detection power of pairwise IBD segments and IBD clusters with little loss of accuracy.</p>
    <p>The theoretical contribution of this work is our new IBD prior, which helps identify the discontinuities in haplotype matches. Unlike the traditional probabilistic Li-and-Stephens model, which captures a large degree of uncertainty in combining short haplotypes, our model is inspired by the efficient PBWT data structure for long haplotype matching. Noticeably, our model adopts the ‘algorithm first’ philosophy rather than the ‘probability theory first’ philosophy, hence the simplicity of our IBD prior. Our model’s high scalability makes it future-proof as biobanks with millions of samples become commonly available.</p>
    <p>P-smoother is the first approach of error correction in haplotype panels. While error correction has been common practice in cleaning up noisy measurements in, for example, NGS data (<xref rid="vbac045-B14" ref-type="bibr">Mitchell <italic toggle="yes">et al.</italic>, 2020</xref>), P-smoother is applied to the already highly optimized haplotype panels. Therefore, a potential concern is that we might ‘over-correct’ the errors by also flipping some real mutations. However, Sections and show that P-smoother is useful for tasks not sensitive to rare mutations, such as IBD segment and IBD cluster detection. To make P-smoother useful for downstream tasks that rely on rare variants, one could postprocess the matches in the smoothed panel by cross-referencing with the original panel. However, as distinguishing between errors and mutations is often difficult, we leave it as future research. Given that we are not attempting to distinguish errors from recent mutations, the ‘Non-errors Corrected’ column in <xref rid="vbac045-T1" ref-type="table">Table 1</xref> misrepresents the false positives. In order to give a lower bound, the precision values in <xref rid="vbac045-T1" ref-type="table">Table 1</xref> were computed under the assumption that there are no mutations and that all of the nonerror corrections were miscorrections. This hypothetical assumption clearly leads the precision values to be considerable underestimates.</p>
    <p>Reassuringly, P-smoother has been shown to have robust parameters (<italic toggle="yes">L</italic>, <italic toggle="yes">W</italic>, <italic toggle="yes">g</italic>, <italic toggle="yes">ρ</italic>) and to be robust against error rates from 0% to 0.2%. Moreover, P-smoother’s scalability is reinforced by benchmarks on panels ranging from 4000 to 1 million haplotypes.</p>
    <p>Perhaps, the best practical results of P-smoother are in IBD cluster detection task. Before now, there did not exist a method for identifying IBD clusters that could scale to thousands of haplotypes. PS-cluster, powered by P-smoother, offers state-of-the-art IBD cluster results: ∼80% power and 80% accuracy for 2 cM-long clusters of over 5 haplotypes, or 90% power and 65% accuracy for 1 cM-long clusters of over 10 haplotypes. These results should suffice to enable IBD mapping in large cohorts. A rigorous comparison of available clustering methods regarding different evaluation metrics is beyond the scope of this paper, and we aim to address this issue in future works.</p>
    <p>As additional future works, P-smoother’s parameters can be optimized for scenarios with various error rates, sample sizes and demographic histories. Our IBD prior model could be applied to genotype imputation or be made more sophisticated to give more accurate predictions and differentiate between errors and mutations. Furthermore, cross-referencing the smoothed panel with the original panel could allow for further refinement of reported matches.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the National Institutes of Health grants R01HG010086, R56HG011509 and OT2OD002751. This research has been conducted using the UK Biobank Resource under Application Number 24247.</p>
    <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
  </sec>
</body>
<back>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>The data underlying this article are available in the article.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="vbac045-B1">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Alanko</surname><given-names>J.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <part-title>Finding All Maximal Perfect Haplotype Blocks in Linear Time</part-title>. In: <person-group person-group-type="editor"><string-name><surname>Huber</surname><given-names>K.T.</given-names></string-name>, <string-name><surname>Gusfield</surname><given-names>D.</given-names></string-name></person-group> (eds.) <source>19th International Workshop on Algorithms in Bioinformatics (WABI 2019), Volume 143 of Leibniz International Proceedings in Informatics (LIPIcs)</source>. <publisher-name>Schloss Dagstuhl–Leibniz-Zentrum fuer Informatik</publisher-name>, <publisher-loc>Dagstuhl, Germany</publisher-loc>, pp. <fpage>8:1</fpage>–<lpage>8:9</lpage>.</mixed-citation>
    </ref>
    <ref id="vbac045-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Browning</surname><given-names>B.L.</given-names></string-name></person-group><etal>et al</etal> (<year>2018</year>) <article-title>A one-penny imputed genome from next-generation reference panels</article-title>. <source>Am. J. Hum. Genet</source>., <volume>103</volume>, <fpage>338</fpage>–<lpage>348</lpage>.<pub-id pub-id-type="pmid">30100085</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Delaneau</surname><given-names>O.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Accurate, scalable and integrative haplotype estimation</article-title>. <source>Nat. Commun</source>., <volume>10</volume>, <fpage>1</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">30602773</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Durbin</surname><given-names>R.</given-names></string-name></person-group> (<year>2014</year>) <article-title>Efficient haplotype matching and storage using the positional burrows–wheeler transform (pbwt)</article-title>. <source>Bioinformatics</source>, <volume>30</volume>, <fpage>1266</fpage>–<lpage>1272</lpage>.<pub-id pub-id-type="pmid">24413527</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Freyman</surname><given-names>W.A.</given-names></string-name></person-group><etal>et al</etal>; <collab>23 and Me Research Team</collab>. (<year>2021</year>) <article-title>Fast and robust identity-by-descent inference with the templated positional burrows–wheeler transform</article-title>. <source>Mol. Biol. Evol</source>., <volume>38</volume>, <fpage>2131</fpage>–<lpage>2151</lpage>.<pub-id pub-id-type="pmid">33355662</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gusev</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2011</year>) <article-title>Dash: a method for identical-by-descent haplotype mapping uncovers association with recent variation</article-title>. <source>Am. J. Hum. Genet</source>., <volume>88</volume>, <fpage>706</fpage>–<lpage>717</lpage>.<pub-id pub-id-type="pmid">21620352</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>He</surname><given-names>D.</given-names></string-name></person-group> (<year>2013</year>) <article-title>Ibd-groupon: an efficient method for detecting group-wise identity-by-descent regions simultaneously in multiple individuals based on pairwise ibd relationships</article-title>. <source>Bioinformatics</source>, <volume>29</volume>, <fpage>i162</fpage>–<lpage>i170</lpage>.<pub-id pub-id-type="pmid">23812980</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kelleher</surname><given-names>J.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) <article-title>Efficient coalescent simulation and genealogical analysis for large sample sizes</article-title>. <source>PLoS Comput. Biol</source>., <volume>12</volume>, <fpage>e1004842</fpage>.<pub-id pub-id-type="pmid">27145223</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>N.</given-names></string-name>, <string-name><surname>Stephens</surname><given-names>M.</given-names></string-name></person-group> (<year>2003</year>) <article-title>Modeling linkage disequilibrium and identifying recombination hotspots using single-nucleotide polymorphism data</article-title>. <source>Genetics</source>, <volume>165</volume>, <fpage>2213</fpage>–<lpage>2233</lpage>.<pub-id pub-id-type="pmid">14704198</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Loh</surname><given-names>P.-R.</given-names></string-name></person-group><etal>et al</etal> (<year>2016a</year>) <article-title>Fast and accurate long-range phasing in a uk biobank cohort</article-title>. <source>Nat. Genet</source>., <volume>48</volume>, <fpage>811</fpage>–<lpage>816</lpage>.<pub-id pub-id-type="pmid">27270109</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Loh</surname><given-names>P.-R.</given-names></string-name></person-group><etal>et al</etal> (<year>2016b</year>) <article-title>Reference-based phasing using the haplotype reference consortium panel</article-title>. <source>Nat. Genet</source>., <volume>48</volume>, <fpage>1443</fpage>–<lpage>1448</lpage>.<pub-id pub-id-type="pmid">27694958</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Loh</surname><given-names>P.-R.</given-names></string-name></person-group><etal>et al</etal> (<year>2018</year>) <article-title>Insights into clonal haematopoiesis from 8,342 mosaic chromosomal alterations</article-title>. <source>Nature</source>, <volume>559</volume>, <fpage>350</fpage>–<lpage>355</lpage>.<pub-id pub-id-type="pmid">29995854</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Marchini</surname><given-names>J.</given-names></string-name>, <string-name><surname>Howie</surname><given-names>B.</given-names></string-name></person-group> (<year>2010</year>) <article-title>Genotype imputation for genome-wide association studies</article-title>. <source>Nat. Rev. Genet</source>., <volume>11</volume>, <fpage>499</fpage>–<lpage>511</lpage>.<pub-id pub-id-type="pmid">20517342</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mitchell</surname><given-names>K.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Benchmarking of computational error-correction methods for next-generation sequencing data</article-title>. <source>Genome Biol</source>., <volume>21</volume>, <fpage>1</fpage>–<lpage>13</lpage>.</mixed-citation>
    </ref>
    <ref id="vbac045-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moltke</surname><given-names>I.</given-names></string-name></person-group><etal>et al</etal> (<year>2011</year>) <article-title>A method for detecting ibd regions simultaneously in multiple individuals—with applications to disease genetics</article-title>. <source>Genome Res</source>., <volume>21</volume>, <fpage>1168</fpage>–<lpage>1180</lpage>.<pub-id pub-id-type="pmid">21493780</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Naseri</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Rapid: ultra-fast, powerful, and accurate detection of segments identical by descent (IBD) in biobank-scale cohorts</article-title>. <source>Genome Biol</source>., <volume>20</volume>, <fpage>1</fpage>–<lpage>15</lpage>.<pub-id pub-id-type="pmid">30606230</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B17">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Naseri</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) Discovery of runs-of-homozygosity diplotype clusters and their associations with diseases in uk biobank. <italic toggle="yes">medRxiv</italic>, <pub-id pub-id-type="doi">10.4230/LIPIcs.WABI.2021.19</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B18">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Naseri</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>). <part-title>Efficient haplotype block matching in bi-directional pbwt</part-title>. In: Carbone, A., and El-Kebir, M. (eds) <source>21st International Workshop on Algorithms in Bioinformatics (WABI 2021)</source>. <publisher-name>Leibniz International Proceedings in Informatics Schloss Dagstuhl – Leibniz-Zentrum für Informatik, Dagstuhl Publishing, Germany, pp. 1–19</publisher-name>.</mixed-citation>
    </ref>
    <ref id="vbac045-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Qian</surname><given-names>Y.</given-names></string-name></person-group><etal>et al</etal> (<year>2014</year>) <article-title>Efficient clustering of identity-by-descent between multiple individuals</article-title>. <source>Bioinformatics</source>, <volume>30</volume>, <fpage>915</fpage>–<lpage>922</lpage>.<pub-id pub-id-type="pmid">24363374</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rubinacci</surname><given-names>S.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Genotype imputation using the positional burrows wheeler transform</article-title>. <source>PLoS Genet</source>., <volume>16</volume>, <fpage>e1009049</fpage>.<pub-id pub-id-type="pmid">33196638</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>R.J.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Distinct error rates for reference and nonreference genotypes estimated by pedigree analysis</article-title>. <source>Genetics</source>, <volume>217</volume>, <fpage>1</fpage>–<lpage>10</lpage>.</mixed-citation>
    </ref>
    <ref id="vbac045-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Williams</surname><given-names>L.</given-names></string-name>, <string-name><surname>Mumey</surname><given-names>B.</given-names></string-name></person-group> (<year>2020</year>) <article-title>Maximal perfect haplotype blocks with wildcards</article-title>. <source>Iscience</source>, <volume>23</volume>, <fpage>101149</fpage>.<pub-id pub-id-type="pmid">32446220</pub-id></mixed-citation>
    </ref>
    <ref id="vbac045-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhou</surname><given-names>Y.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>A fast and simple method for detecting identity-by-descent segments in large-scale data</article-title>. <source>Am. J. Hum. Genet</source>., <volume>106</volume>, <fpage>426</fpage>–<lpage>437</lpage>.<pub-id pub-id-type="pmid">32169169</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
