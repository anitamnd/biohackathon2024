<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8570816</article-id>
    <article-id pub-id-type="pmid">34196671</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btab479</article-id>
    <article-id pub-id-type="publisher-id">btab479</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Systems Biology</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MHCVision: estimation of global and local false discovery rate for MHC class I peptide binding prediction</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-0953-7851</contrib-id>
        <name>
          <surname>Pearngam</surname>
          <given-names>Phorutai</given-names>
        </name>
        <aff><institution>Program in Bioinformatics and Computational Biology, Graduate School, Chulalongkorn University</institution>, Bangkok 10330, <country country="TH">Thailand</country></aff>
        <aff><institution>Institute of Systems, Molecular and Integrative Biology, University of Liverpool</institution>, Liverpool L69 7ZB, <country country="GB">UK</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-4117-3632</contrib-id>
        <name>
          <surname>Sriswasdi</surname>
          <given-names>Sira</given-names>
        </name>
        <aff><institution>Research Affairs, Faculty of Medicine, Chulalongkorn University</institution>, Bangkok 10330, <country country="TH">Thailand</country></aff>
        <aff><institution>Computational Molecular Biology Group, Faculty of Medicine, Chulalongkorn University</institution>, Bangkok 10330, <country country="TH">Thailand</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pisitkun</surname>
          <given-names>Trairak</given-names>
        </name>
        <aff><institution>Center of Excellence in Systems Biology, Faculty of Medicine, Chulalongkorn University</institution>, Bangkok 10330, <country country="TH">Thailand</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-6118-9327</contrib-id>
        <name>
          <surname>Jones</surname>
          <given-names>Andrew R</given-names>
        </name>
        <aff><institution>Institute of Systems, Molecular and Integrative Biology, University of Liverpool</institution>, Liverpool L69 7ZB, <country country="GB">UK</country></aff>
        <xref rid="btab479-cor1" ref-type="corresp"/>
        <!--andrew.jones@liverpool.ac.uk-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Martelli</surname>
          <given-names>Pier Luigi</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btab479-cor1">To whom correspondence should be addressed. <email>andrew.jones@liverpool.ac.uk</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>01</day>
      <month>11</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2021-07-01">
      <day>01</day>
      <month>7</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>01</day>
      <month>7</month>
      <year>2021</year>
    </pub-date>
    <volume>37</volume>
    <issue>21</issue>
    <fpage>3830</fpage>
    <lpage>3838</lpage>
    <history>
      <date date-type="received">
        <day>17</day>
        <month>12</month>
        <year>2020</year>
      </date>
      <date date-type="rev-recd">
        <day>11</day>
        <month>6</month>
        <year>2021</year>
      </date>
      <date date-type="editorial-decision">
        <day>14</day>
        <month>6</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>30</day>
        <month>6</month>
        <year>2021</year>
      </date>
      <date date-type="corrected-typeset">
        <day>15</day>
        <month>7</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2021. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btab479.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>MHC-peptide binding prediction has been widely used for understanding the immune response of individuals or populations, each carrying different MHC molecules as well as for the development of immunotherapeutics. The results from MHC-peptide binding prediction tools are mostly reported as a predicted binding affinity (IC<sub>50</sub>) and the percentile rank score, and global thresholds e.g. IC<sub>50</sub> value &lt; 500 nM or percentile rank &lt; 2% are generally recommended for distinguishing binding peptides from non-binding peptides. However, it is difficult to evaluate statistically the probability of an individual peptide binding prediction to be true or false solely considering predicted scores. Therefore, statistics describing the overall global false discovery rate (FDR) and local FDR, also called posterior error probability (PEP) are required to give statistical context to the natively produced scores.</p>
      </sec>
      <sec id="s2">
        <title>Result</title>
        <p>We have developed an algorithm and code implementation, called MHCVision, for estimation of FDR and PEP values for the predicted results of MHC-peptide binding prediction from the NetMHCpan tool. MHCVision performs parameter estimation using a modified expectation maximization framework for a two-component beta mixture model, representing the distribution of true and false scores of the predicted dataset. We can then estimate the PEP of an individual peptide’s predicted score, and conversely the probability that it is true. We demonstrate that the use of global FDR and PEP estimation can provide a better trade-off between sensitivity and precision over using currently recommended thresholds from tools.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p><ext-link xlink:href="https://github.com/PGB-LIV/MHCVision" ext-link-type="uri">https://github.com/PGB-LIV/MHCVision</ext-link>.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Science Achievement Scholarship of Thailand</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Thailand Research Fund</institution>
            <institution-id institution-id-type="DOI">10.13039/501100004396</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>MRG6280189</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>The host immune system can respond to the appearance of pathogenic fragments or mutated peptides derived from cancer cells by the process of antigen presentation. As part of the antigen processing pathway, short peptide fragments are generated from either cytosolic proteins or extracellular proteins that enter cells via the vesicular system. Digested peptides are subsequently presented by major histocompatibility (MHC) proteins, called human leucocyte antigens (HLA) for human. Peptides from cytosolic proteins can be presented by MHC class I molecules (HLA-A, -B and -C) and recognized by cytotoxic CD8+ T cells. Those peptides derived from the endocytic processing pathway are bound to MHC class II (HLA-DR, -DQ and -DP) and can activate CD4+ T cells (<xref rid="btab479-B21" ref-type="bibr">Unanue, 2006</xref>). A strong interaction between peptides and MHC molecules is a fundamental step to initiate the activation of T cells and subsequently initiate an adaptive immune system to eliminate or attack the source of foreign peptides (<xref rid="btab479-B23" ref-type="bibr">Wieczorek <italic toggle="yes">et al.</italic>, 2017</xref>). The diversity of MHC molecules is high due to extensive polymorphism at most loci. The latest update of IMGT/HLA database in August 2019 contains 24 093 alleles including 16 943 alleles of HLA-A, -B and -C and 6650 alleles of HLA class II (<xref rid="btab479-B15" ref-type="bibr">Robinson <italic toggle="yes">et al.</italic>, 2020</xref>). Many of the alleles are exceptionally rare, carried only by a few individuals, but 1122 alleles of HLA-A, -B, -C, -DRB, -DQA, -DQB, -DPA and -DPB loci are common and well-documented, 415 alleles of these alleles were identified as ‘common’ (having known frequencies) and 707 as ‘well-documented’ base on HLA genotyping observations and available HLA haplotype data (<xref rid="btab479-B8" ref-type="bibr">Mack <italic toggle="yes">et al.</italic>, 2013</xref>). Each HLA allele has a binding preference to specific peptides, driven mostly by the physicochemical properties of their primary sequence. Experimental work, called ‘immunopeptidomics’, for example using mass spectrometry (MS) to identify the set of MHC-bound peptides eluted from cells, has been carried out for many alleles, but can only ever identify a subset of the true total peptide binding potential for a given allele (<xref rid="btab479-B24" ref-type="bibr">Yewdell and Bennink, 1999</xref>). The accuracy of identification of binding peptides of a specific HLA allele using computational methods is therefore highly useful for understanding individual or population-specific immune response, and facilitating the development of clinical immunotherapy such as vaccines for infectious diseases or for cancer via neoepitope prediction (<xref rid="btab479-B26" ref-type="bibr">Zhang <italic toggle="yes">et al.</italic>, 2012</xref>).</p>
    <p>Computational methods for class I MHC-peptide binding prediction showed high accuracy and have been reported to have a better performance than their MHC II counterparts (<xref rid="btab479-B10" ref-type="bibr">Nielsen <italic toggle="yes">et al.</italic>, 2008</xref>; <xref rid="btab479-B22" ref-type="bibr">Wang <italic toggle="yes">et al.</italic>, 2008</xref>). Moreover, when compared with MHC I binding prediction, MHC II predictors have a high risk of falsely excluding strong binders (<xref rid="btab479-B27" ref-type="bibr">Zhao and Sher, 2018</xref>). The current benchmark of HLA class I binding prediction showed the best performance of 90% sensitivity and 98% specificity (<xref rid="btab479-B9" ref-type="bibr">Nielsen and Andreatta, 2016</xref>). In this study, we therefore focus on peptide binding prediction against HLA class I because there are more available experimental datasets, and accurately predicted results are crucial for the robustness of the developed model (<xref rid="btab479-T1" ref-type="table">Table 1</xref>). In general, the prediction software include a machine learning-based algorithm, trained with experimental data for peptides known to be bound or not bound by specific HLA alleles. Among recent publicly available tools, there are two tools, NetMHCpan and MHCflurry (<xref rid="btab479-B11" ref-type="bibr">O'Donnell <italic toggle="yes">et al.</italic>, 2018</xref>; <xref rid="btab479-B14" ref-type="bibr">Reynisson <italic toggle="yes">et al.</italic>, 2020</xref>), which perform consistently well in benchmarking studies (<xref rid="btab479-B12" ref-type="bibr">Paul <italic toggle="yes">et al.</italic>, 2020</xref>). NetMHCpan4.1 is the latest version of NetMHCpan family, it extends the training using neural networks that can learn connections between amino acid positions in the HLA protein sequence and target peptides, and thus can make predictions for HLA alleles in the absence of specific data for one given allele. Furthermore, this current version covers 2915 MHC molecules for HLA-A, -B and -C, but only 79 alleles are supported in MHCflurry. Our initial focus thus studied the prediction results by using NetMHCpan4.1, although we also comment on the extensibility of our approach to MHCflurry.</p>
    <table-wrap position="float" id="btab479-T1">
      <label>Table 1.</label>
      <caption>
        <p>MHC class I-peptide binding prediction tools</p>
      </caption>
      <table frame="hsides" rules="groups">
        <colgroup span="1">
          <col valign="top" align="left" span="1"/>
          <col valign="top" align="center" span="1"/>
          <col valign="top" align="center" span="1"/>
          <col valign="top" align="center" span="1"/>
        </colgroup>
        <thead>
          <tr>
            <th rowspan="1" colspan="1">Tools</th>
            <th rowspan="1" colspan="1">Reported IC<sub>50</sub> (nM)</th>
            <th rowspan="1" colspan="1">Reported % Rank</th>
            <th rowspan="1" colspan="1">Supported HLA I alleles</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td rowspan="1" colspan="1">NetMHC 4.0 (<xref rid="btab479-B2" ref-type="bibr">Andreatta and Nielsen, 2016</xref>)</td>
            <td rowspan="1" colspan="1">✓</td>
            <td rowspan="1" colspan="1">✓</td>
            <td rowspan="1" colspan="1">80</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">NetMHCpan 4.1 (<xref rid="btab479-B14" ref-type="bibr">Reynisson <italic toggle="yes">et al.</italic>, 2020</xref>)</td>
            <td rowspan="1" colspan="1">✓</td>
            <td rowspan="1" colspan="1">✓</td>
            <td rowspan="1" colspan="1">2915</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">NetMHCcons 1.1</td>
            <td rowspan="2" colspan="1">✓</td>
            <td rowspan="2" colspan="1">✓</td>
            <td rowspan="2" colspan="1">94–120</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">(<xref rid="btab479-B7" ref-type="bibr">Karosiene <italic toggle="yes">et al.</italic>, 2012</xref>)</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">MHCflurry 2.0 (<xref rid="btab479-B11" ref-type="bibr">O'Donnell <italic toggle="yes">et al.</italic>, 2018</xref>)</td>
            <td rowspan="1" colspan="1">✓</td>
            <td rowspan="1" colspan="1">✓</td>
            <td rowspan="1" colspan="1">79</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">MHCnuggets 2.3 (<xref rid="btab479-B19" ref-type="bibr">Shao <italic toggle="yes">et al.</italic>, 2020</xref>)</td>
            <td rowspan="1" colspan="1">✓</td>
            <td rowspan="1" colspan="1">✗</td>
            <td rowspan="1" colspan="1">148</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">MHCSeqNet</td>
            <td colspan="2" rowspan="1">Binding probability</td>
            <td rowspan="2" colspan="1">65</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">(<xref rid="btab479-B13" ref-type="bibr">Phloyphisut <italic toggle="yes">et al.</italic>, 2019</xref>)</td>
            <td colspan="2" rowspan="1">(0–1)</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">EDGE (<xref rid="btab479-B16" ref-type="bibr">Sarkizova <italic toggle="yes">et al.</italic>, 2020</xref>)</td>
            <td rowspan="1" colspan="1">✗</td>
            <td rowspan="1" colspan="1">✗</td>
            <td rowspan="1" colspan="1">53</td>
          </tr>
        </tbody>
      </table>
    </table-wrap>
    <p>The output from a prediction reports the predicted binding affinity (IC<sub>50</sub>) in nM unit. IC<sub>50</sub> &lt; 500 nM is the commonly recommended threshold for binding affinity to classify binding and non-binding peptides. From version 4.0 onward, NetMHCpan also produces a percentile rank (‘% Rank’) for each predicted IC<sub>50</sub>, the % rank scores were determined by comparing a given IC<sub>50</sub> value for one peptide to the score distribution of a large selection of random peptides. The percent rank &lt; 2% is a suggested threshold for distinguishing binding and non-binding peptides rather than IC<sub>50</sub> &lt; 500 nM because it reduces the bias of binding preference across different MHC molecules (<xref rid="btab479-B5" ref-type="bibr">Jurtz <italic toggle="yes">et al.</italic>, 2017</xref>). Given that most researchers are more interested in statistics that relate to the proportion of true detections at a given threshold, we believe that peptide binding predictions require the estimation of false discovery rate (FDR), which is one of the motivations for this work. Moreover, the posterior error probability (PEP), also known as local FDR, is critical for evaluating the probability that each individual data point is false (the converse of PEP is the true probability) (<xref rid="btab479-B6" ref-type="bibr">Käll <italic toggle="yes">et al.</italic>, 2008</xref>). To estimate FDR and PEP accurately, the distributions of the true and false data points must be known or reliably estimated. In this work, we have developed a new software package called MHCVision to estimate these distributions and calculate PEP and FDR from peptide binding prediction data. We have trained and optimized MHCVision using several datasets where we have engineered a mixture of <italic toggle="yes">a priori</italic> known ‘true’ and ‘false’ data, and then we demonstrate that this works in practice on a wider range of artificial mixtures (with a known answer) and produces highly plausible estimates on real datasets where the underlying ground truth is unknown.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p><xref rid="btab479-F1" ref-type="fig">Figure 1</xref> provides an overview of the process followed to develop MHCVision and briefly summarized here. First, we obtained data (predicted IC<sub>50</sub> scores) from multi-allelic cells and from mono-allelic cells, overlaid with scores from random peptides to evaluate the best fitting data distributions for true and false data (<xref rid="btab479-F1" ref-type="fig">Fig. 1A</xref>, Sections 2.1 and 2.2). These analyses demonstrated that two beta distributions, with some parameter constraints, well model true and false data. Then, the beta parameter estimator model was developed using the modified expectation maximization (EM) algorithm, as described in Section 2.3 (<xref rid="btab479-B18" ref-type="bibr">Schröder and Rahmann, 2017</xref>). The robustness of the model was evaluated by running the model on a variety of datasets where true and false data are known and comparing the similarity of simulated data generated from the model parameters against the real data (<xref rid="btab479-F1" ref-type="fig">Fig. 1B</xref>). The MHCVision model fits beta mixture distributions to a given dataset, to estimate beta parameters and relative sizes of true and false data, and thus enables the calculation of FDR and PEP for each peptide’s predicted binding affinity (<xref rid="btab479-F1" ref-type="fig">Fig. 1C</xref>, Section 2.4). The method for evaluating model fit on a wider range of testing data is covered in Section 2.5.</p>
    <fig position="float" id="btab479-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>The development of beta parameter estimation model and MHCVision workflow. (<bold>A</bold>) The beta parameter estimation model is developed by using the EM algorithm, and testing different data distributions for matching against a mixture of true binding and random peptides. (<bold>B</bold>) The output from the model development is ‘MHCVision’, which is a parameter estimation model for two component of beta distributions, where estimated beta parameters are constrained based on observations of plausible ranges for binding affinities. (<bold>C</bold>) The estimated beta parameters corresponding to true and false data are estimated by MHCVision, those parameters are constrained within plausible ranges using the modified EM algorithm. (<bold>D</bold>) The values of FDR and PEP are calculated from estimated parameters from the densities of fitted beta distribution</p>
      </caption>
      <graphic xlink:href="btab479f1" position="float"/>
    </fig>
    <sec>
      <title>2.1 MHC binding peptide collection</title>
      <p>Datasets of MHC-bound peptides derived from MS analysis were downloaded from the Immuno Epitope Database and Analysis Resource (IEDB, <ext-link xlink:href="https://www.iedb.org/" ext-link-type="uri">https://www.iedb.org/</ext-link>) (<xref rid="btab479-B15" ref-type="bibr">Robinson <italic toggle="yes">et al.</italic>, 2020</xref>). Human peptides identified from MS and bound to HLA-A, -B and -C were collected. Other eluted peptides from MHC class I ‘mono-allelic cells’, i.e. presented peptides from cells carrying a single HLA allele, were collected from several publications of immunopeptidomics studies (<xref rid="btab479-B1" ref-type="bibr">Abelin <italic toggle="yes">et al.</italic>, 2017</xref>; <xref rid="btab479-B16" ref-type="bibr">Sarkizova <italic toggle="yes">et al.</italic>, 2020</xref>; <xref rid="btab479-B17" ref-type="bibr">Schittenhelm <italic toggle="yes">et al.</italic>, 2014</xref>; <xref rid="btab479-B20" ref-type="bibr">Solleder <italic toggle="yes">et al.</italic>, 2020</xref>). Peptides for each HLA allele from those sources were combined, and redundant peptides were removed. Only peptides with lengths of 8, 9, 10 and 11 mer were retained. However, the majority of peptide length in the collected data was found as 9mer peptides for all HLA alleles. HLA alleles that had ≥1000 9mer peptides were collected for onward analysis, totalling 85 HLA alleles covering HLA-A, -B and -C (<xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>, sheet1). Additionally, the ‘multi-allelic datasets’, i.e. a set of peptides presented by cells carrying several alleles, were obtained from the dataset contains naturally presented HLA class I ligands derived from chronic myeloid leukemia (CML) patients (<xref rid="btab479-B4" ref-type="bibr">Bilich <italic toggle="yes">et al.</italic>, 2019</xref>).</p>
      <p>To create datasets for training and testing MHCVision, we required datasets with a known answer, containing biologically plausible mixtures of true and false binders. The true binders were sourced from the 85 mono-allelic datasets containing mass spectrometry (MS) datasets where peptides presented by genuine MHC alleles were presented. False data points were modelled by random peptides, created from the human proteome in the UniProt database (<ext-link xlink:href="http://www.uniprot.org" ext-link-type="uri">www.uniprot.org</ext-link>) by a sliding window approach to generate peptides of 8, 9, 10 and 11 amino acids (<xref rid="btab479-B3" ref-type="bibr">Apweiler <italic toggle="yes">et al.</italic>, 2004</xref>). To generate a biologically plausible mixture of scores of MS and random peptides, the dataset of MS peptides derived from mono-allelic samples was combined with random peptides (in a ratio of 1000:4000). It should be noted that since some random peptides may be true binders, we exclude random peptides with IC<sub>50</sub> &lt; 1000 nM (∼2.5% of all generated random peptides on average) from consideration (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>). The resulting peptide set was run through NetMHCpan4.1 stand-alone package via the command line, for each specific HLA allele. These mixture datasets were used for the learning phase of developing MHCVision, and then for testing that accurate values of FDR and PEP were estimated, along with a wider range of testing sets on which the model had not been previously trained (Section 2.4).</p>
    </sec>
    <sec>
      <title>2.2 Evaluation of fitted statistical distributions</title>
      <p>To find statistical models that can properly model the observed bimodal distributions, the data for 85 alleles (mixtures of peptides identified from MS data and random peptides) in a 1000:4000 ratio were inspected and tested for fit against Gaussian and beta distributions. Simulated datasets of 85 HLA alleles were generated by beta and normal functions with specific values of parameters using numpy packages in python, which are numpy.random.beta (<inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mo>α</mml:mo></mml:math></inline-formula>, <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mo>β</mml:mo></mml:math></inline-formula>, size) and numpy.random.normal (<inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mo>μ</mml:mo></mml:math></inline-formula>, <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mo>σ</mml:mo></mml:math></inline-formula>, size). The parameters for generating simulated data were calculated from each dataset. As the beta distribution lies the interval [0, 1], we accordingly scaled the binding affinity scores (log<sub>10</sub>(IC<sub>50</sub>)) for peptides in each dataset to the same interval by dividing the predicted scores by the maximum value. Then, the similarity between the real and simulated data was evaluated by the <italic toggle="yes">R</italic><sup>2</sup> value calculated from the linear regression analysis.</p>
    </sec>
    <sec>
      <title>2.3 The modified EM algorithm with the iterated method of moments for the mixture model</title>
      <p>The parameter estimation algorithm for a mixture of two distributions was built using a python script. The detailed description that follows is for the final implementation of the algorithm in MHCVision for a mixture of two beta distributions. The algorithm was proceeded iteratively as in the basis of the EM algorithm. The step of parameter estimation was computed by Pearson’s method of moment instead of the maximization of expected likelihood, thus, the maximization step (M-step) was replaced by a method of moments estimation step (MM-step) (<xref rid="btab479-B18" ref-type="bibr">Schröder and Rahmann, 2017</xref>). For each iteration, parameters including two mixture proportions <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math></inline-formula>, two means <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math></inline-formula> and two variance values <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mo>(</mml:mo><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>)</mml:mo></mml:math></inline-formula> were estimated for two components.</p>
      <sec>
        <label>2.3.1</label>
        <title>Initialization</title>
        <p>As the distribution of predicted scores was bimodal, thus, two was defined as number of components. The data was sorted by predicted IC<sub>50</sub> and divided in half, thus, the initial <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mo>π</mml:mo></mml:math></inline-formula> of each component was initially set as 0.5. The initial <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:math></inline-formula> were calculated from the data of each component <italic toggle="yes">j</italic>, and the initial values of <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> were then computed according to <xref rid="E1" ref-type="disp-formula">Equations 1</xref> and <xref rid="E2" ref-type="disp-formula">2</xref>.
<disp-formula id="E1"><label>(1)</label><mml:math id="M1" display="block" overflow="scroll"><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:msubsup><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:math></disp-formula>
 <disp-formula id="E2"><label>(2)</label><mml:math id="M2" display="block" overflow="scroll"><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="true">(</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:math></disp-formula></p>
      </sec>
      <sec>
        <label>2.3.2</label>
        <title>Expectation step (E-step)</title>
        <p>The expected responsibility weight (W<sub>i, j</sub>) of each component <italic toggle="yes">j</italic> and data point x<sub>i</sub> was estimated from the probability density function of the current estimates for beta distributions <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mo>(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula>, <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:msubsup><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo>)</mml:mo><mml:mo> </mml:mo></mml:math></inline-formula>and the mixture proportion<inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mo> </mml:mo><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> (<xref rid="E3" ref-type="disp-formula">Equation 3</xref>).
<disp-formula id="E3"><label>(3)</label><mml:math id="M3" display="block" overflow="scroll"><mml:msubsup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mfenced separators="|"><mml:mrow><mml:mi>f</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>;</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msubsup><mml:mrow><mml:mi mathvariant="normal"> </mml:mi><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mrow><mml:msubsup><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mi>f</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>;</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math></disp-formula>
 <disp-formula id="E4"><mml:math id="M4" display="block" overflow="scroll"><mml:mtext>where</mml:mtext><mml:mi mathvariant="normal"> </mml:mi><mml:mi>f</mml:mi><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>;</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mo>α</mml:mo><mml:mo>,</mml:mo><mml:mo>β</mml:mo><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mo>α</mml:mo><mml:mo>+</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mo>α</mml:mo></mml:mrow></mml:mfenced><mml:mi mathvariant="normal">Γ</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mo>β</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>·</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mo>α</mml:mo><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>·</mml:mo><mml:msup><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>β</mml:mo><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math></disp-formula></p>
      </sec>
      <sec>
        <label>2.3.3</label>
        <title>Method of moments estimation (MM-step)</title>
        <p>For each component <italic toggle="yes">j</italic>, the <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is updated based on the new values of <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:msubsup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> according to <xref rid="E5" ref-type="disp-formula">Equation 4</xref>. Then, the component’s mean and variance and the beta distribution parameters are updated using the method of moments (<xref rid="E6 E7 E8 E9" ref-type="disp-formula">Equations 5–8</xref>).
<disp-formula id="E5"><label>(4)</label><mml:math id="M5" display="block" overflow="scroll"><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:msubsup><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msubsup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mrow></mml:math></disp-formula>
 <disp-formula id="E6"><label>(5)</label><mml:math id="M6" display="block" overflow="scroll"><mml:msubsup><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:msubsup><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msubsup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mrow><mml:mo>·</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal"> </mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msubsup><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msubsup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mrow></mml:mrow></mml:mfrac></mml:math></disp-formula>
 <disp-formula id="E7"><label>(6)</label><mml:math id="M7" display="block" overflow="scroll"><mml:mtable><mml:mtr><mml:mtd><mml:msup><mml:mfenced separators="|"><mml:msubsup><mml:mo>σ</mml:mo><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mfenced><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd/></mml:mtr></mml:mtable><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi mathvariant="normal">i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msubsup><mml:mo>·</mml:mo><mml:msup><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msubsup><mml:mo>μ</mml:mo><mml:mi>j</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:mfrac></mml:math></disp-formula>
 <disp-formula id="E8"><label>(7)</label><mml:math id="M8" display="block" overflow="scroll"><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msubsup><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:msup><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math></disp-formula>
 <disp-formula id="E9"><label>(8)</label><mml:math id="M9" display="block" overflow="scroll"><mml:msubsup><mml:mo>β</mml:mo><mml:mi>j</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mo>α</mml:mo><mml:mi>j</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mfenced><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:msubsup><mml:mo>μ</mml:mo><mml:mi>j</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mfrac><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mfenced></mml:math></disp-formula></p>
        <p>In this step, we further constrained the estimated beta parameters for the beta 2 component by the ranges of values calculated from the datasets of various sizes (1000, 5000, 10000) of predicted binding affinity scores from random peptides with a length of 8, 9, 10 and 11 mer against 85 HLA alleles. The purpose of this restriction was to ensure that the beta 2 component of the mixture model is certain to capture the false data. Since ultimately the model for MHCVision fits to the distribution of data observed, we believe this step does not bias the estimation of the ‘false’ distribution but will lead to more accurate estimate of the shape of the genuinely false distribution when new data is tested. Moreover, to ensure the beta 1 component is not fitted to the wrong distribution when presented with <italic toggle="yes">all false data</italic>, the estimated parameters of the first component are restricted if the estimated <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>= 0 and size of the negative set <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mo>≠</mml:mo></mml:math></inline-formula> 0 (predicted IC<sub>50</sub> &gt; 10 000 nM) i.e. indicating that there is only one distribution found, and there are data points in the plausible range for false data. In this case, the ranges of <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mo>α</mml:mo></mml:math></inline-formula> and <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mo>β</mml:mo></mml:math></inline-formula> for the first beta component were initially calculated from data points with predicted IC<sub>50</sub>  <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mo>≤</mml:mo></mml:math></inline-formula> 10 000 nM using <xref rid="E1" ref-type="disp-formula">Equations 1</xref> and <xref rid="E2" ref-type="disp-formula">2</xref>, and the range of values are only allowed to deviate 25% from the initial estimates. In practice, these two constraints mean that when the algorithm detects evidence a very large imbalance, in either direction (i.e. all true or all false), the beta 1 or beta 2 is correctly fitted to the appropriate distribution.</p>
      </sec>
      <sec>
        <label>2.3.4</label>
        <title>Termination</title>
        <p>The estimations (E-step and MM-step) were repeated until the maximal relative changes in the estimated parameter values, <italic toggle="yes">k<sup>t</sup></italic>, between step <italic toggle="yes">t</italic> and <italic toggle="yes">t </italic>+<italic toggle="yes"> </italic>1 is less than 0.00001 (<xref rid="E10" ref-type="disp-formula">Equation 9</xref>).
<disp-formula id="E10"><label>(9)</label><mml:math id="M10" display="block" overflow="scroll"><mml:msup><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:mfenced open="|" close="|" separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>-</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mfenced open="|" close="|" separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mfenced open="|" close="|" separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mfrac><mml:mrow><mml:mfenced open="|" close="|" separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>-</mml:mo><mml:msubsup><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi><mml:mo>⁡</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>|</mml:mo><mml:mo>,</mml:mo><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo>|</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mfrac><mml:mrow><mml:mfenced open="|" close="|" separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>-</mml:mo><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi><mml:mo>⁡</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>|</mml:mo><mml:mo>,</mml:mo><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo>|</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:math></disp-formula></p>
      </sec>
    </sec>
    <sec>
      <title>2.4 Calculation of FDR and PEP for predicted scores</title>
      <p>The estimated beta parameters were utilized to calculate values of FDR and PEP of an individual predicted score in the dataset using <xref rid="E12" ref-type="disp-formula">Equations 10</xref> and <xref rid="E13" ref-type="disp-formula">11</xref>, respectively. The number of false and true positive were estimated by the cumulative distribution function of the beta distribution while density at true and false were estimated by the probability density function of the beta distribution.
<disp-formula id="E11"><mml:math id="M11" display="block" overflow="scroll"><mml:mi mathvariant="italic">Given</mml:mi><mml:mi mathvariant="normal"> </mml:mi><mml:mi mathvariant="italic">data</mml:mi><mml:mi mathvariant="normal"> </mml:mi><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></disp-formula>
 <disp-formula id="E12"><label>(10)</label><mml:math id="M12" display="block" overflow="scroll"><mml:mi>F</mml:mi><mml:mi>D</mml:mi><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfenced open="" close="" separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mi mathvariant="normal"> </mml:mi></mml:mrow></mml:mfenced></mml:math></disp-formula>
 <disp-formula id="E13"><label>(11)</label><mml:math id="M13" display="block" overflow="scroll"><mml:mi>P</mml:mi><mml:mi>E</mml:mi><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math></disp-formula></p>
    </sec>
    <sec>
      <title>2.5 Evaluation of fitted mixture model estimates</title>
      <p>We evaluated the performance of the modified EM algorithm for the beta mixture model using the original ‘training’ data (for 85 alleles, mixtures of MS data and random peptides) in a 1000:4000 ratio, as well as additional sets (1000:8000 ratios), all true (1000 MS peptides) and all false (4000 MS peptides). For these datasets, we next generated simulated data, based on the beta distribution parameters learnt from the model fitting via the modified EM process described above. The purpose of the simulated data was only to test for the quality of the fit between simulated and real data. Two components including estimated true and false data were generated with estimated parameters given from the EM model for each HLA allele. The best estimated beta parameters for two components produced by the modified EM method above were used to generate the simulated distributions. The simulated true data was generated by a set of estimated true parameters (<inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo> </mml:mo><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>), and the simulated false data was created by a set of estimated false parameters (<inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>,<inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>), then, simulated true and false were concatenated.
<disp-formula id="E14"><mml:math id="M14" display="block" overflow="scroll"><mml:mi mathvariant="normal">Simulated</mml:mi><mml:mi mathvariant="normal"> </mml:mi><mml:mi mathvariant="normal">true</mml:mi><mml:mi mathvariant="normal"> </mml:mi><mml:mi mathvariant="normal">data</mml:mi><mml:mi mathvariant="normal"> </mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi mathvariant="normal">numpy</mml:mi><mml:mo>.</mml:mo><mml:mi mathvariant="normal">random</mml:mi><mml:mo>.</mml:mo><mml:mi mathvariant="normal">beta</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal">*</mml:mi><mml:mi mathvariant="italic">size</mml:mi><mml:mo>)</mml:mo><mml:mo>)</mml:mo></mml:math></disp-formula></p>
      <p>
        <disp-formula id="E15">
          <mml:math id="M15" display="block" overflow="scroll">
            <mml:mi mathvariant="normal">Simulated</mml:mi>
            <mml:mi mathvariant="normal"> </mml:mi>
            <mml:mi mathvariant="normal">false</mml:mi>
            <mml:mi mathvariant="normal"> </mml:mi>
            <mml:mi mathvariant="normal">data</mml:mi>
            <mml:mi mathvariant="normal"> </mml:mi>
            <mml:mo>=</mml:mo>
            <mml:mi mathvariant="normal"> </mml:mi>
            <mml:mi mathvariant="normal">numpy</mml:mi>
            <mml:mo>.</mml:mo>
            <mml:mi mathvariant="normal">random</mml:mi>
            <mml:mo>.</mml:mo>
            <mml:mi mathvariant="normal">beta</mml:mi>
            <mml:mo>(</mml:mo>
            <mml:msub>
              <mml:mrow>
                <mml:mo>α</mml:mo>
              </mml:mrow>
              <mml:mrow>
                <mml:mi mathvariant="italic">false</mml:mi>
              </mml:mrow>
            </mml:msub>
            <mml:mo>,</mml:mo>
            <mml:msub>
              <mml:mrow>
                <mml:mo>β</mml:mo>
              </mml:mrow>
              <mml:mrow>
                <mml:mi mathvariant="italic">false</mml:mi>
              </mml:mrow>
            </mml:msub>
            <mml:mo>,</mml:mo>
            <mml:mo>(</mml:mo>
            <mml:msub>
              <mml:mrow>
                <mml:mo>π</mml:mo>
              </mml:mrow>
              <mml:mrow>
                <mml:mi mathvariant="italic">false</mml:mi>
              </mml:mrow>
            </mml:msub>
            <mml:mi mathvariant="normal">*</mml:mi>
            <mml:mi mathvariant="italic">size</mml:mi>
            <mml:mo>)</mml:mo>
            <mml:mo>)</mml:mo>
          </mml:math>
        </disp-formula>
      </p>
      <p>The similarity between real and simulated data generated by estimated parameters was measured by the linear regression analysis yielding <italic toggle="yes">R</italic><sup>2</sup> statistics. Moreover, Kolmogorov–Smirnov (KS) test was used to detect the difference between the real and simulated datasets, the significant threshold was set at <italic toggle="yes">P</italic>-value &lt; 0.05.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 The data distribution of binding and non-binding peptide scores and model fitting</title>
      <p>The data distribution of the predicted binding affinity scores (log<sub>10</sub> (IC<sub>50</sub>)) from mono-allelic cells and multi-allelic cells was explored. A dataset of MS peptides from multi-allelic cells expressing six alleles of HLA class I including A*03:01, A*68:01, B*07:02, B*44:02, C*07:01 and C*07:02 was analyzed. To compare with data from mono-allelic cells, MS peptides from the mono-allelic datasets for the six alleles were selected. The MS peptides from multi- and mono- allelic cells were mixed with the same set of random peptides, and MHC-peptide binding affinity for their specific HLA alleles were predicted using NetMHCpan4.1. The histogram plots were created from the predicted scores to display the data distribution of MS peptides from mono-allelic cells, multi-allelic cells and random peptides (<xref rid="btab479-F2" ref-type="fig">Fig. 2</xref>). The distribution shape of the scores for MS peptides from mono-allelic cells was almost exclusively a single right skewed peak with lower log<sub>10</sub> IC<sub>50</sub> values (&lt;3 or 3.5) for A and B loci, with a more left skewed peak for C alleles around log<sub>10</sub> IC<sub>50</sub> of 2–4. In all cases, the overlay of random peptides demonstrated a peak with log<sub>10</sub> IC<sub>50</sub> &gt; 4. Since peptides identified by MS data from mono-allelic cells are highly likely to be genuine binding peptides for a specific HLA allele, we interpreted that the peak on the left with low IC<sub>50</sub> values (low IC<sub>50</sub> is high binding affinity) is the distribution of binding peptides (true data), whilst the right peak (high IC<sub>50</sub> is low binding affinity) is the distribution of the non-binding peptides (false data). The distribution shape of MS peptide binding predicted for A*03:01, A*68:01 and B*07:01 from multi-allelic cells displayed a bimodal distribution, one located on the left and the other on the right side. This is expected, since only some of the presented peptides in multi-allelic cell lines are presented by one allele. However, the left peak of B*44:02, C*07:01 and C*07:02 can hardly be observed, most predicted scores located on the side of low binding affinity. This may be an experimental artefact or a true biological result, in that the set of peptides presented are dominated by only three alleles. The distribution shape of the low binding affinity peptides from multi-allelic cells well matches the distribution shape of random peptides, indicating that random peptides also well model the set of non-binding peptides.</p>
      <fig position="float" id="btab479-F2">
        <label>Fig. 2.</label>
        <caption>
          <p>The distribution of predicted binding affinity of the MS peptides from mono-allelic cells (top) and multi-allelic cells (bottom) and those MS datasets mixed with random peptides, as histograms for six representative HLA alleles</p>
        </caption>
        <graphic xlink:href="btab479f2" position="float"/>
      </fig>
      <p>The distribution of predicted scores from MS peptides from mono-allelic cells mixed with random peptides for a more complete set of 85 HLA alleles is shown in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S2</xref>. In almost all cases, the MS peptide distribution is clearly separated from the random peptide distribution. While the distribution shape of random peptides appears highly similar shown as a right skewed distribution, some of the MS peptide distributions vary across different groups of alleles. Most A and B locus alleles have a slight left skewed or symmetrical distribution. The C locus alleles tend to have a symmetrical or right skewed distribution (i.e. only a few high binding affinity peptides). The shape of the data distribution is important since we wish to model distribution shapes to calculate local and global statistics from data distributions.</p>
    </sec>
    <sec>
      <title>3.2 Statistical model fitting data distribution</title>
      <p>To find statistical models that can properly model the observed bimodal distributions shown in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S2</xref>, the evaluation of mixture models including a mixture of Gaussian-Gaussian (GG), a mixture of Gaussian-beta (GB), a mixture of beta-Gaussian (BG) and a mixture of beta-beta (BB) was performed as described in Section 2.2. The scatter plots of <italic toggle="yes">R</italic><sup>2</sup> values from 85 HLA alleles were plotted across possible mixture components of the statistical models, where the first component is the <italic toggle="yes">R</italic><sup>2</sup> of MS peptides and their simulated data, and the second component is random peptides and their simulated data. The result showed that the <italic toggle="yes">R</italic><sup>2</sup> values from GB and BB were very close to 1 for most HLA alleles (<xref rid="btab479-F3" ref-type="fig">Fig. 3A</xref>). This result suggests that the true data distribution (left peak) can reasonably well be modelled by both Gaussian and beta distributions while the beta model gives the best fit for false data distribution (right peak). However, the average <italic toggle="yes">R</italic><sup>2</sup> from datasets of 85 HLA-alleles from the beta model fitting true data distribution (0.95) was significantly higher than the Gaussian model (0.93) (<italic toggle="yes">P</italic>-value = 1.77E-0.7, using paired <italic toggle="yes">t</italic>-test) (<xref rid="btab479-F3" ref-type="fig">Fig. 3B</xref>). Hence, these results indicated that the beta mixture is the most suitable model to fit the predicted scores of data containing a mixture of binding and non-binding peptides, and the two-component beta model was thus used as the basis for MHCvision.</p>
      <fig position="float" id="btab479-F3">
        <label>Fig. 3.</label>
        <caption>
          <p>Similarity measurement of model fitting data distribution. (<bold>A</bold>) The scatter plots of <italic toggle="yes">R</italic><sup>2</sup> values from MS datasets (<italic toggle="yes">x</italic>-axis) and random (<italic toggle="yes">y</italic>-axis) datasets of 85 HLA alleles that were fitted by beta or Gaussian model; a mixture of Gaussian-Gaussian (GG), a mixture of Gaussian-beta (GB), a mixture of beta-Gaussian (BG), a mixture of beta-beta (BB). (<bold>B</bold>) The average <italic toggle="yes">R</italic><sup>2</sup> of Gaussian and beta model fitting MS and random datasets from 85 HLA alleles. Each bar represented the mean of <italic toggle="yes">R</italic><sup>2</sup> from 85 HLA alleles. (*<italic toggle="yes">P</italic>-value &lt; 0.05, **<italic toggle="yes">P</italic>-value &lt; 0.01); Gaussian fitting MS data (G_MS), beta fitting MS data (B_MS), Gaussian fitting random data (G_random), beta fitting random data (B_random)</p>
        </caption>
        <graphic xlink:href="btab479f3" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.3 Estimation of beta parameters</title>
      <p>The results in the <xref rid="btab479-F3" ref-type="fig">Figure 3</xref> indicated that the distribution of predicted MHC binding affinity from a mixture of true and false peptides is captured well by a two-component beta mixture model with the first component (beta 1) representing low IC<sub>50</sub> values (<italic toggle="yes">true data</italic>) and the second component (beta 2) for high IC<sub>50</sub> values (<italic toggle="yes">false data</italic>). To estimate the size of true and false data from the predicted result, the parameters of beta mixture distribution including two mixture proportions <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math></inline-formula>, <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> were estimated from the predicted dataset using the EM algorithm with a method of moments estimation for the beta mixtures. Since the second component of the data distribution is a set of scores of non-binding peptides, the distribution shape of any predicted scores of non-binding peptides with the same HLA allele should be similar. Therefore, the values of <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> from different datasets of each HLA allele were explored to test for variation of beta model parameter ranges dependent on dataset size and peptide length. The calculated values of <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mo>α</mml:mo></mml:math></inline-formula> and <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mo>β</mml:mo></mml:math></inline-formula> from random datasets have a small variation across different data sizes for most HLA alleles (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S3</xref>), from which we infer that the calculated values of <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mo>α</mml:mo></mml:math></inline-formula> and <inline-formula id="IE35"><mml:math id="IM35" display="inline" overflow="scroll"><mml:mo>β</mml:mo></mml:math></inline-formula> can apply to any false dataset for the same specific HLA allele. The ranges of calculated values of <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> were used to constrain the estimated <inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">false</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> in the MM-step, while the estimated <inline-formula id="IE40"><mml:math id="IM40" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE41"><mml:math id="IM41" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">true</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> values are constrained only for the case of an input data consists almost all false data (see Methods).</p>
      <p>The datasets of predicted scores from 1000 MS and 4000 random peptides with 9mer in length for 85 HLA alleles were used to test the accuracy of the parameter estimation model. The correctness of estimation results was evaluated by similarity measurement between the real dataset (predicted IC<sub>50</sub> scores) and the simulated dataset generated by the estimated parameters. The <italic toggle="yes">R</italic><sup>2</sup> between the real and simulated dataset for all 85 alleles are greater than 0.99 (<xref rid="btab479-F4" ref-type="fig">Fig. 4A</xref>). However, the <italic toggle="yes">R</italic><sup>2</sup> can only describe a similarity of distribution shape but not scaling between two datasets. To ensure that simulated data can represent a given observed data, we also considered other values in the linear equation including the slope and intercept, and they are also close to 1 and 0, respectively (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S4A</xref> and <xref rid="sup1" ref-type="supplementary-material">B</xref>). Furthermore, the difference between two distributions of real and simulated data for 85 HLA alleles was tested by KS test. The <italic toggle="yes">P</italic>-values from KS test are higher than 0.05 for almost all alleles indicating that distributions of real and simulated data are not significantly different, although there are few alleles that have <italic toggle="yes">P</italic>-value less than 0.05, which are A*01:01, C*04:01 and C*07:01 (<xref rid="btab479-F4" ref-type="fig">Fig. 4A</xref>). Data from these three alleles does not follow an expected distribution. We hypothesized that the MS data for these three alleles contains a large number of false positives, perhaps due to inadequate FDR control in the source experiment. This stage of the process is to demonstrate the overall performance of MHCVision, which, importantly, refits the beta distributions to the shape of true and false positives in a new dataset. As such, we believe these anomalies are the result of problems with the MS data we are using for evaluation, rather than with the model itself.</p>
      <fig position="float" id="btab479-F4">
        <label>Fig. 4.</label>
        <caption>
          <p>The analysis of the parameter estimation model for beta mixture testing with the predicted datasets of 9mer peptides of 85 HLA alleles. (<bold>A</bold>) The <italic toggle="yes">R</italic><sup>2</sup> and <italic toggle="yes">P</italic>-value from KS test between the real and simulated data. (<bold>B</bold>) The overlaying of density plots between the real and simulated datasets of 10 representative alleles, the overlaying distributions of 85 HLA alleles are in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Data</xref>  <xref rid="sup1" ref-type="supplementary-material">S2</xref></p>
        </caption>
        <graphic xlink:href="btab479f4" position="float"/>
      </fig>
      <p>The overlaying of a density plot for each HLA allele between the real and simulated dataset is shown in <xref rid="btab479-F4" ref-type="fig">Figure 4B</xref>. In most HLA alleles, the distribution of real and simulated data for both the left and right peaks showed a good alignment (81 of 85 alleles have <italic toggle="yes">R</italic><sup>2</sup> ≥ 0.995). The ideally fitted distributions, whose <italic toggle="yes">R</italic><sup>2</sup> &gt; 0.999, were found in the dataset that have clear separation of MS and random peptides and a symmetrical distribution of MS data such as A*02:02, A*33:03, B*27: 02 and B35:07. Some datasets that have a flatter shape of MS peptide distribution or left skew (e.g. A*01:01, C*03:03 and B*42:01) showed imperfect matching of some bins, but the general location of the real and simulated data are the same position. However, there are four datasets that have right skew distribution of MS data such as C*04:01, and C*07:01, displayed less good alignment between real MS data and their simulated data (those alleles have <italic toggle="yes">R</italic><sup>2</sup> &lt; 0.995). Nevertheless, the distribution of false data is well captured by their simulated data indicating that the ratio of false positive to true positive in that area of the MS data should still be correct. The overlaying density plot of all 85 HLA alleles are in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Data</xref>  <xref rid="sup1" ref-type="supplementary-material">S2</xref>. The parameter estimation analysis was also performed with datasets with a larger imbalance ratio containing 1000 MS peptides and 8000 random peptides, and the result showed that the similarity between real and simulated datasets for 85 HLA alleles are close to 1 (<italic toggle="yes">R</italic><sup>2</sup> &gt; 0.995, <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S4C</xref>). The <italic toggle="yes">R</italic><sup>2</sup> from datasets with 4000 random is very similar to that from data with 8000 random indicating that MHCVision is robust for datasets with a larger imbalance between true and false data points, as may well be encountered in biological samples.</p>
      <p>Since the common lengths of MHC I peptides are 8–11 mer, hence, the mixture of MS and random datasets with different peptide lengths were generated for more thoroughly testing the performance of the parameter estimation model. There are 16 HLA alleles, with MS peptides available for all lengths (8, 9, 10 and 11 mer), which were used to test the estimation performance of the model, 800 MS peptides (200 per length) and 3200 random peptides (800 per length). It was found that the <italic toggle="yes">R</italic><sup>2</sup> values of the real dataset and simulated dataset for 16 HLA alleles are highly close to 1 (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S5A</xref>). The value of <italic toggle="yes">R</italic><sup>2</sup> suggested that the parameter estimation model functions well for the dataset with multi-lengths of peptides, which are shown by a good alignment of density plots between the simulated dataset created by the estimate parameters and the real dataset (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S5B</xref>). Furthermore, the robustness of the estimator model was evaluated with highly imbalanced distributions (i.e. almost all true, or almost all false), where selected MS datasets and random datasets were used to test with the model separately (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S6</xref>) and the predicted IC<sub>50</sub> of peptides derived from MHC I multi-allelic cells (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S7</xref>). The result of similarity measure from those datasets revealed a high similarity between the real and simulated data indicating that the model can work well with datasets that are not in our sets of data used to learn and train MHCVision and provide sensible estimated parameters for data distributions with a large imbalance between true and false data. Altogether, the results of the <italic toggle="yes">R</italic><sup>2</sup> values, KS test and the overlaying of data distributions indicate that the framework of EM algorithm with a method of moments for a beta mixture model can provide sensible estimated parameters for true and false data. The estimated true and false data of the predicted results can be further used to calculate the values of FDR and PEP for an individual predicted score.</p>
    </sec>
    <sec>
      <title>3.4 The estimation of FDR and PEP for the predicted scores</title>
      <p>The values of FDR and PEP of an individual predicted score were calculated from the estimated beta parameters and sizes for true and false data, following model fitting by MHCVision. From NetMHCpan’s documentation, the 2% rank is recommended to use as a hard threshold for binding peptide selection. Here, this analysis performed the estimation of statistical confidence measure of FDR and PEP for peptide binding prediction from the test datasets of a mixture of MS and random peptides. A scatter plot demonstrating FDR and PEP values at the 2% rank for 85 HLA alleles is shown in <xref rid="btab479-F5" ref-type="fig">Figure 5A</xref>. The accumulated (global) FDR value at the 2% rank score of all HLA-A and most B and C loci is less than 0.1. However, ∼20% of the representative datasets (17 of 85 alleles) showed global FDR at the 2% rank are higher than 0.1 i.e. more than 10% of peptides passing the threshold are predicted to be false positives, most are found in HLA-C and a few HLA-B. To assess the confidence of each peptide’s predicted score, the PEP was computed for each peptide in the predicted dataset. The analysis demonstrated that 48 of 85 datasets, especially B and C loci, have PEP at the 2% rank over 0.5, which means the probability of each peptide being a false positive is higher than 50% even though they have &lt; 2% rank score (<xref rid="btab479-F5" ref-type="fig">Fig. 5A</xref>). At the 2% rank threshold, the FDR of HLA-C (0.13) is the highest on average followed by HLA-B (0.07), and the average of HLA-A (0.03) is the lowest. While the PEP at the 2% rank of HLA-B and HLA-C on average are greater than 0.5 (0.64 and 0.63, respectively) whilst the average PEP of HLA-A is 0.38 (<xref rid="btab479-F5" ref-type="fig">Fig. 5B</xref>).</p>
      <fig position="float" id="btab479-F5">
        <label>Fig. 5.</label>
        <caption>
          <p>Estimation of FDR and PEP for predicted scores of 85 HLA alleles. (<bold>A</bold>) The scatter plot represents the values of accumulated global FDR and PEP at the 2% rank for each allele. (<bold>B</bold>) The distribution of FDR and PEP values at the 2% rank for HLA-A, -B and -C derived scores. (<bold>C</bold>) The overlaying of PEP values on the data distribution of predicted scores of 10 representative alleles, the dashed black line was marked at the score with 2% rank. Plots of 85 HLA alleles are in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Data</xref> S3</p>
        </caption>
        <graphic xlink:href="btab479f5" position="float"/>
      </fig>
      <p>The overlaying of PEP values on the data distribution of predicted IC<sub>50</sub> scores in <xref rid="btab479-F5" ref-type="fig">Figure 5C</xref> showed that the log<sub>10</sub> (IC<sub>50</sub>) &lt; 2 or &gt; 4 have a high certainty for being true or false binding peptides, their PEP values close to 0 and 1. For the scores in the range of 2 to 4 have less certainty to determine whether they should be true or false binding peptides, especially for less well separated datasets for some alleles. Several datasets have PEP values close to 1 for peptides with the % rank ∼ 2% e.g. A*30:02, B*15:10, B*27:02, B*35:07, C*05:01 and C*14:02, in contrast, some data have very low PEP values, even if those scores have the % rank ≥ 2% e.g. A*02:01, A*02:11, B*15:03 and B*15:17 (the overlaying of PEP scores and log<sub>10</sub>(IC<sub>50</sub>) scores of 85 HLA alleles are in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Data</xref> S3). These results suggest that PEP values provide considerable added value over the use of the % rank for estimation of confidence in individual data points. Beyond the MS: random datasets generated for 85 alleles data, the FDRs and PEPs from data containing almost all true or all false data (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S6D</xref>) and multi-allelic data (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S7D</xref>) were calculated by MHCVision. The results demonstrate that the values of FDR and PEP correspond well with expected true and false data, giving confidence that the model will perform well when presented with genuine datasets.</p>
    </sec>
    <sec>
      <title>3.5 Extensibility for MHCflurry prediction</title>
      <p>While MHCVision has been primarily tested with NetMHCpan, past benchmarking results suggest that MHCflurry gives similar strong performance for peptide binding prediction; we thus extended our approach for predicted results coming from MHCflurry2.0. MHCflurry also reports predicted IC<sub>50</sub> and % rank; however, the tool’s documentation does not suggest the cut off threshold of the % rank. Therefore, we assumed the 2% rank as a possible threshold for distinguishing binders and non-binders, as for NetMHCpan. There are 79 HLA alleles supported by MHCflurry, and there are 55 alleles of 9mer MS-random peptides in our study, which are available for those supported alleles. To estimate parameters from data distribution from MHCflurry prediction, we applied the parameter ranges that are calculated from MHCflurry predicted scores of random peptides in various data sizes (1000, 5000 and 10000) instead of parameters ranges calculated from NetMHCpan predicted scores. The <italic toggle="yes">R</italic><sup>2</sup> between the real (predicted scores) and simulated data are in range of 0.995 to 0.999 for 52 of 55 alleles (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S8A</xref>), and the overlying between the real and simulated data as shown in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S9</xref>. Thus, those results indicate that the approach of EM algorithm with a method of moments also works well for predicted data coming from MHCflurry. The analysis of FDR and PEP estimation showed that if using a 2% rank threshold, over 10% global FDR occurs for 18 alleles and PEP higher than 50% for 27 of 55 alleles—indicating that as for NetMHCpan, 2% rank is not an ideal threshold for controlling FDR for many alleles. (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S8B</xref> and <xref rid="sup1" ref-type="supplementary-material">C</xref>).</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>MHC-peptide binding affinity prediction is widely used in the immunology research and development e.g. designing immunogenic peptides for vaccine development. NetMHCpan described the predicted % rank (versus a set of random peptide scores) for each predicted IC<sub>50</sub> score. However, using only the % rank might not be sufficient to quantitatively evaluate whether a predicted binding score for a peptide is a true or false positive. As we demonstrate here, local statistics i.e. the probability that a given predicted score of each peptide is a true or false positive is needed to increase confidence in binding peptide selection. In this study, we firstly studied the distribution of predicted IC<sub>50</sub> scores coming from NetMHCpan4.1. The distribution of predicted scores of MS peptides from multi-allelic cells to a specific HLA displayed a bimodal distribution, containing two separated peaks, which the left and right peaks represent binding and non-binding peptides, respectively. Gaussian distributions are expected to fit well to symmetrical distributions with theoretically infinites tails. Beta distributions can fit to skewed distributions, and distributions with theoretical maxima. Given that we observe some skew to data distributions, and the distribution has a theoretical maximum at 4.7 log<sub>10</sub> (IC<sub>50</sub>) scale (log<sub>10</sub>(50 000)), where 50 000 is the maximum value provided by NetMHCpan, and beta distributions well model absolute limits, it is not therefore surprising that beta distribution give superior fits for MHC I predicted scores than Gaussian distributions. Moreover, the usage of beta model fitting MHC I predicted scores is agreed by the study of Zeng’s group that they used beta distribution to model the data distribution of MHC-peptide binding affinity for MHC class I (<xref rid="btab479-B25" ref-type="bibr">Zeng and Gifford, 2019</xref>). To assess the practicality of the parameter estimation model, linear regression was used to model the correlation between the real and the simulated data that is generated by the best estimate parameters. The values of <italic toggle="yes">R</italic><sup>2</sup>, slope and intercept were generally close to 1, 1 and 0, respectively, indicating a good similarity of the input and simulated dataset and confirming that our parameter estimation model can provide sensible parameters from an input data modelled by a beta mixture distribution. The study of parameter estimation using the EM algorithm with a method of moments for beta mixtures model has been previously reported for the application in the field of molecular biology (<xref rid="btab479-B18" ref-type="bibr">Schröder and Rahmann, 2017</xref>). For our work, we modified the parameter estimation model in the MM-step to restrict the estimated values of false data, thus, the application of this model is feasible for MHC supported in NetMHCpan4.1, which cover for 2915 alleles for HLA-A, -B and -C (<xref rid="btab479-B14" ref-type="bibr">Reynisson <italic toggle="yes">et al.</italic>, 2020</xref>).</p>
    <p>The estimated parameters for true and false data allow the calculation of FDR and PEP for a given peptide’s predicted score in the dataset. The global FDR can describe the error rate that accumulates in the selected binding peptides from the prediction across the whole dataset, while PEP values can describe a local false probability of an individual peptide in the dataset. We demonstrated that some datasets might get over 10% FDR when using the 2% rank as a threshold, which might be too high risk to control false positives. In practice, the FDR observed is dependent upon the allele selected, as well as the actual (unknown) count of true positives in the data, relative to false positives. Moreover, there is variability in PEP values close to the 2% rank threshold—in some datasets the predicted scores at ≤ 2% rank can have PEP values very close to 1, but in other datasets the predicted scores ≥ 2% rank have a PEP less than 0.1. Furthermore, the analysis of predicted results for 55 alleles coming from MHCflurry discovered similar trends as for NetMHCpan. This finding indicates that using only the % rank for thresholding might wrongly accept false binding peptides or miss some true binding peptides in different cases, which cannot normally be differentiated straightforwardly. In our work, we applied the model of the EM algorithm with a method of moments for beta mixture distribution to the predicted scores from NetMHCpan4.1, alternatively users can opt to run with MHCflurry, but the supported alleles are limited to 79. The output will return the statistical values including FDR and true probability (1-PEP) for every predicted peptide in a dataset for a specific HLA allele. For different downstream uses of peptide binding data, rather using solely the fix threshold as the % rank to classify or prioritize binding peptides, we would recommend users of MHCVision should apply the estimation to their data from NetMHCpan or MHCflurry and decide on the most appropriate threshold, depending on their downstream use of the data. For some applications, controlling for global FDR to a low value, say 5% or 10% might be appropriate where having as many true positives as possible, with an acceptably low number of false positives is desired. Other users of the data might wish to eliminate all peptides that are unlikely to be true, and thus using PEP &lt; 1% would ensure only highly confident peptides are taken forward. When a global threshold such as FDR &lt; 10% is applied, most of the peptides at the bottom of the ranked list have very high PEP values, and thus themselves are unlikely to be true binders.</p>
    <p>In summary, our study can successfully perform the estimation of statistical values including FDR and PEP for the predicted result of MHC-peptide binding prediction. The current version is suitable for the predicted result from NetMHCpan4.1 and MHCflurry. We expect that the model will work well for other MHC class I predictors that produce a bimodal distribution, with minor adaptations and testing. We have not yet assessed the extent to which the model will work for MHC class II prediction algorithms, and this is an area for future development of the tool.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btab479_Supplementary_Data</label>
      <media xlink:href="btab479_supplementary_data.zip">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title> </title>
    <sec>
      <title>Funding</title>
      <p>This work was supported by the Science Achievement Scholarship of Thailand (SAST). T.P. was supported by Chulalongkorn Academic Advancement into Its 2nd Century (CUAASC) Project. S.S. is supported by Thailand Research Fund MRG6280189. </p>
      <p><italic toggle="yes">Conflict of Interest</italic>: none declared. </p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btab479-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Abelin</surname><given-names>J.G.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>Mass spectrometry profiling of HLA-associated peptidomes in mono-allelic cells enables more accurate epitope prediction</article-title>. <source>Immunity</source>, <volume>46</volume>, <fpage>315</fpage>–<lpage>326</lpage>.<pub-id pub-id-type="pmid">28228285</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Andreatta</surname><given-names>M.</given-names></string-name>, <string-name><surname>Nielsen</surname><given-names>M.</given-names></string-name></person-group> (<year>2016</year>) <article-title>Gapped sequence alignment using artificial neural networks: application to the MHC class I system</article-title>. <source>Bioinformatics</source>, <volume>32</volume>, <fpage>511</fpage>–<lpage>517</lpage>.<pub-id pub-id-type="pmid">26515819</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Apweiler</surname><given-names>R.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2004</year>) <article-title>UniProt: the universal protein knowledgebase</article-title>. <source>Nucleic Acids Res</source>., <volume>32</volume>, <fpage>D115</fpage>–<lpage>D119</lpage>.<pub-id pub-id-type="pmid">14681372</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bilich</surname><given-names>T.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) <article-title>The HLA ligandome landscape of chronic myeloid leukemia delineates novel T-cell epitopes for immunotherapy</article-title>. <source>Blood</source>, <volume>133</volume>, <fpage>550</fpage>–<lpage>565</lpage>.<pub-id pub-id-type="pmid">30530751</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jurtz</surname><given-names>V.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>NetMHCpan-4.0: improved peptide–MHC class I interaction predictions integrating eluted ligand and peptide binding affinity data</article-title>. <source>J. Immunol</source>., <volume>199</volume>, <fpage>3360</fpage>–<lpage>3368</lpage>.<pub-id pub-id-type="pmid">28978689</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Käll</surname><given-names>L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2008</year>) <article-title>Posterior error probabilities and false discovery rates: two sides of the same coin</article-title>. <source>J. Proteome Res</source>., <volume>7</volume>, <fpage>40</fpage>–<lpage>44</lpage>.<pub-id pub-id-type="pmid">18052118</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Karosiene</surname><given-names>E.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>NetMHCcons: a consensus method for the major histocompatibility complex class I predictions</article-title>. <source>Immunogenetics</source>, <volume>64</volume>, <fpage>177</fpage>–<lpage>186</lpage>.<pub-id pub-id-type="pmid">22009319</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mack</surname><given-names>S.J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) <article-title>Common and well-documented HLA alleles: 2012 update to the CWD catalogue</article-title>. <source>Tissue Antigens</source>, <volume>81</volume>, <fpage>194</fpage>–<lpage>203</lpage>.<pub-id pub-id-type="pmid">23510415</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nielsen</surname><given-names>M.</given-names></string-name>, <string-name><surname>Andreatta</surname><given-names>M.</given-names></string-name></person-group> (<year>2016</year>) <article-title>NetMHCpan-3.0; improved prediction of binding to MHC class I molecules integrating information from multiple receptor and peptide length datasets</article-title>. <source>Genome Med</source>., <volume>8</volume>, <fpage>1</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">26750923</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nielsen</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2008</year>) <article-title>Quantitative predictions of peptide binding to any HLA-DR molecule of known sequence: netMHCIIpan</article-title>. <source>PLoS Comput. Biol</source>., <volume>4</volume>, <fpage>e1000107</fpage>.<pub-id pub-id-type="pmid">18604266</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>O'Donnell</surname><given-names>T.J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>MHCflurry: open-source class I MHC binding affinity prediction</article-title>. <source>Cell Syst</source>., <volume>7</volume>, <fpage>129</fpage>–<lpage>132.e124</lpage>.<pub-id pub-id-type="pmid">29960884</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Paul</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>Benchmarking predictions of MHC class I restricted T cell epitopes in a comprehensively studied model system</article-title>. <source>PLoS Comp. Biol</source>., <volume>16</volume>, <fpage>e1007757</fpage>.</mixed-citation>
    </ref>
    <ref id="btab479-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Phloyphisut</surname><given-names>P.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) <article-title>MHCSeqNet: a deep neural network model for universal MHC binding prediction</article-title>. <source>BMC Bioinformatics</source>, <volume>20</volume>, <fpage>270</fpage>.<pub-id pub-id-type="pmid">31138107</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Reynisson</surname><given-names>B.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>NetMHCpan-4.1 and NetMHCIIpan-4.0: improved predictions of MHC antigen presentation by concurrent motif deconvolution and integration of MS MHC eluted ligand data</article-title>. <source>Nucleic Acids Res</source>., <volume>48</volume>, <fpage>W449</fpage>–<lpage>W454</lpage>.<pub-id pub-id-type="pmid">32406916</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Robinson</surname><given-names>J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>IPD-IMGT/HLA database</article-title>. <source>Nucleic Acids Res</source>., <volume>48</volume>, <fpage>D948</fpage>–<lpage>D955</lpage>.<pub-id pub-id-type="pmid">31667505</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sarkizova</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>A large peptidome dataset improves HLA class I epitope prediction across most of the human population</article-title>. <source>Nat. Biotechnol</source>., <volume>38</volume>, <fpage>199</fpage>–<lpage>209</lpage>.<pub-id pub-id-type="pmid">31844290</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schittenhelm</surname><given-names>R.B.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) <article-title>A comprehensive analysis of constitutive naturally processed and presented HLA-C 04: 01 (Cw4)–specific peptides</article-title>. <source>Tissue Antigens</source>, <volume>83</volume>, <fpage>174</fpage>–<lpage>179</lpage>.<pub-id pub-id-type="pmid">24397554</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schröder</surname><given-names>C.</given-names></string-name>, <string-name><surname>Rahmann</surname><given-names>S.</given-names></string-name></person-group> (<year>2017</year>) <article-title>A hybrid parameter estimation algorithm for beta mixtures and applications to methylation state classification</article-title>. <source>Algorithms Mol. Biol</source>., <volume>12</volume>, <fpage>21</fpage>.<pub-id pub-id-type="pmid">28828033</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Shao</surname><given-names>X.M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>High-throughput prediction of MHC class i and ii neoantigens with MHCnuggets</article-title>. <source>Cancer Immunol. Res</source>., <volume>8</volume>, <fpage>396</fpage>–<lpage>408</lpage>.<pub-id pub-id-type="pmid">31871119</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Solleder</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>Mass spectrometry based immunopeptidomics leads to robust predictions of phosphorylated HLA class I ligands</article-title>. <source>Mol. Cell. Proteomics</source>, <volume>19</volume>, <fpage>390</fpage>–<lpage>404</lpage>.<pub-id pub-id-type="pmid">31848261</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Unanue</surname><given-names>E.R.</given-names></string-name></person-group> (<year>2006</year>) <article-title>From antigen processing to peptide-MHC binding</article-title>. <source>Nat. Immunol</source>., <volume>7</volume>, <fpage>1277</fpage>–<lpage>1279</lpage>.<pub-id pub-id-type="pmid">17110945</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>P.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2008</year>) <article-title>A systematic assessment of MHC class II peptide binding predictions and evaluation of a consensus approach</article-title>. <source>PLoS Comput. Biol</source>., <volume>4</volume>, <fpage>e1000048</fpage>.<pub-id pub-id-type="pmid">18389056</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wieczorek</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>Major histocompatibility complex (MHC) class I and MHC class II proteins: conformational plasticity in antigen presentation</article-title>. <source>Front. Immunol</source>., <volume>8</volume>, <fpage>292</fpage>.<pub-id pub-id-type="pmid">28367149</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yewdell</surname><given-names>J.W.</given-names></string-name>, <string-name><surname>Bennink</surname><given-names>J.R.</given-names></string-name></person-group> (<year>1999</year>) <article-title>Immunodominance in major histocompatibility complex class I–restricted T lymphocyte responses</article-title>. <source>Annu. Rev. Immunol</source>., <volume>17</volume>, <fpage>51</fpage>–<lpage>88</lpage>.<pub-id pub-id-type="pmid">10358753</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zeng</surname><given-names>H.</given-names></string-name>, <string-name><surname>Gifford</surname><given-names>D.K.</given-names></string-name></person-group> (<year>2019</year>) <article-title>Quantification of uncertainty in peptide-MHC binding prediction improves high-affinity peptide Selection for therapeutic design</article-title>. <source>Cell Syst</source>., <volume>9</volume>, <fpage>159</fpage>–<lpage>166.e153</lpage>.<pub-id pub-id-type="pmid">31176619</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname><given-names>L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>Toward more accurate pan-specific MHC-peptide binding prediction: a review of current methods and tools</article-title>. <source>Brief. Bioinform</source>., <volume>13</volume>, <fpage>350</fpage>–<lpage>364</lpage>.<pub-id pub-id-type="pmid">21949215</pub-id></mixed-citation>
    </ref>
    <ref id="btab479-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhao</surname><given-names>W.</given-names></string-name>, <string-name><surname>Sher</surname><given-names>X.</given-names></string-name></person-group> (<year>2018</year>) <article-title>Systematically benchmarking peptide-MHC binding predictors: from synthetic to naturally processed epitopes</article-title>. <source>PLoS Comp. Biol</source>., <volume>14</volume>, <fpage>e1006457</fpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
