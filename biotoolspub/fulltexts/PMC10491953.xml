<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10491953</article-id>
    <article-id pub-id-type="pmid">37651445</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btad536</article-id>
    <article-id pub-id-type="publisher-id">btad536</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Phylogenetics</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>DecentTree: scalable Neighbour-Joining for the genomic era</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-9319-450X</contrib-id>
        <name>
          <surname>Wang</surname>
          <given-names>Weiwen</given-names>
        </name>
        <aff><institution>China National GeneBank, BGI Research</institution>, Shenzhen 518083, <country country="CN">China</country></aff>
        <xref rid="btad536-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Barbetti</surname>
          <given-names>James</given-names>
        </name>
        <aff><institution>School of Computing, College of Engineering and Computer Science, Australian National University</institution>, Canberra, ACT 2601, <country country="AU">Australia</country></aff>
        <xref rid="btad536-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wong</surname>
          <given-names>Thomas</given-names>
        </name>
        <aff><institution>Ecology and Evolution, Research School of Biology, College of Science, Australian National University</institution>, Canberra, ACT 2601, <country country="AU">Australia</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-6334-5186</contrib-id>
        <name>
          <surname>Thornlow</surname>
          <given-names>Bryan</given-names>
        </name>
        <aff><institution>Genomics Institute, University of California Santa Cruz</institution>, Santa Cruz, CA 95064, <country country="US">United States</country></aff>
        <aff><institution>Biomolecular Engineering, University of California Santa Cruz</institution>, Santa Cruz, CA 95064, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Corbett-Detig</surname>
          <given-names>Russ</given-names>
        </name>
        <aff><institution>Genomics Institute, University of California Santa Cruz</institution>, Santa Cruz, CA 95064, <country country="US">United States</country></aff>
        <aff><institution>Biomolecular Engineering, University of California Santa Cruz</institution>, Santa Cruz, CA 95064, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-5600-2900</contrib-id>
        <name>
          <surname>Turakhia</surname>
          <given-names>Yatish</given-names>
        </name>
        <aff><institution>Electrical and Computer Engineering, University of California San Diego</institution>, La Jolla, CA 92093, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-1140-2596</contrib-id>
        <name>
          <surname>Lanfear</surname>
          <given-names>Robert</given-names>
        </name>
        <aff><institution>Ecology and Evolution, Research School of Biology, College of Science, Australian National University</institution>, Canberra, ACT 2601, <country country="AU">Australia</country></aff>
        <xref rid="btad536-cor1" ref-type="corresp"/>
        <!--rob.lanfear@anu.edu.au-->
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-5535-6560</contrib-id>
        <name>
          <surname>Minh</surname>
          <given-names>Bui Quang</given-names>
        </name>
        <aff><institution>School of Computing, College of Engineering and Computer Science, Australian National University</institution>, Canberra, ACT 2601, <country country="AU">Australia</country></aff>
        <xref rid="btad536-cor1" ref-type="corresp"/>
        <!--m.bui@anu.edu.au-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Schwartz</surname>
          <given-names>Russell</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btad536-cor1">Corresponding authors. School of Computing, College of Engineering and Computer Science, Australian National University, Canberra, ACT 2601, Australia. E-mail: <email>m.bui@anu.edu.au</email> (B.Q.M.); Ecology and Evolution, Research School of Biology, College of Science, Australian National University, Canberra, ACT 2601, Australia. E-mail: <email>rob.lanfear@anu.edu.au</email> (R.L.)</corresp>
      <fn id="btad536-FM1">
        <p>Weiwen Wang and James Barbetti contributed equally to this work.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-08-31">
      <day>31</day>
      <month>8</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>31</day>
      <month>8</month>
      <year>2023</year>
    </pub-date>
    <volume>39</volume>
    <issue>9</issue>
    <elocation-id>btad536</elocation-id>
    <history>
      <date date-type="received">
        <day>21</day>
        <month>3</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>23</day>
        <month>8</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>24</day>
        <month>8</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>30</day>
        <month>8</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>08</day>
        <month>9</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btad536.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Neighbour-Joining is one of the most widely used distance-based phylogenetic inference methods. However, current implementations do not scale well for datasets with more than 10 000 sequences. Given the increasing pace of generating new sequence data, particularly in outbreaks of emerging diseases, and the already enormous existing databases of sequence data for which Neighbour-Joining is a useful approach, new implementations of existing methods are warranted.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>Here, we present DecentTree, which provides highly optimized and parallel implementations of Neighbour-Joining and several of its variants. DecentTree is designed as a stand-alone application and a header-only library easily integrated with other phylogenetic software (e.g. it is integral in the popular IQ-TREE software). We show that DecentTree shows similar or improved performance over existing software (BIONJ, Quicktree, FastME, and RapidNJ), especially for handling very large alignments. For example, DecentTree is up to 6-fold faster than the fastest existing Neighbour-Joining software (e.g. RapidNJ) when generating a tree of 64 000 SARS-CoV-2 genomes.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>DecentTree is open source and freely available at <ext-link xlink:href="https://github.com/iqtree/decenttree" ext-link-type="uri">https://github.com/iqtree/decenttree</ext-link>. All code and data used in this analysis are available on Github (<ext-link xlink:href="https://github.com/asdcid/Comparison-of-neighbour-joining-software" ext-link-type="uri">https://github.com/asdcid/Comparison-of-neighbour-joining-software</ext-link>).</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Guangdong Provincial Genomics Data Center</institution>
          </institution-wrap>
        </funding-source>
        <award-id>2021B1212100001</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Chan-Zuckerberg</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Australian Research Council</institution>
            <institution-id institution-id-type="DOI">10.13039/501100000923</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>DP200103151</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="4"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Neighbour-Joining (NJ) (<xref rid="btad536-B11" ref-type="bibr">Saitou and Nei 1987</xref>) is perhaps the most widely used distance-based algorithm for inferring phylogenies. Its success results from its simplicity and computational efficiency: NJ takes a fraction of the time required by other popular approaches (e.g. Maximum Likelihood and Bayesian methods) and is known to perform well in terms of speed and accuracy for large alignments with low sequence divergence (<xref rid="btad536-B14" ref-type="bibr">Yang and Rannala 2012</xref>). Although other approaches such as Maximum Likelihood and Bayesian approaches perform better than NJ in many situations, the properties of NJ make it an attractive method for a range of applications, including generating starting trees for more computationally expensive approaches, generating rapid trees from large alignments such as SARS-CoV-2 (<xref rid="btad536-B6" ref-type="bibr">McBroome <italic toggle="yes">et al.</italic> 2021</xref>), ribosomal RNA (<xref rid="btad536-B9" ref-type="bibr">Quast <italic toggle="yes">et al.</italic> 2013</xref>), and DNA barcodes (<xref rid="btad536-B10" ref-type="bibr">Ratnasingham and Hebert 2007</xref>), and NJ is also widely used to provide guide trees for alignment algorithms (<xref rid="btad536-B13" ref-type="bibr">Thompson <italic toggle="yes">et al.</italic> 1994</xref>, <xref rid="btad536-B1" ref-type="bibr">Edgar 2004</xref>). Despite its utility, even the fastest existing implementation of NJ, RapidNJ (<xref rid="btad536-B12" ref-type="bibr">Simonsen <italic toggle="yes">et al.</italic> 2008</xref>), does not scale well for alignments containing more than 10 000 sequences, and there are no scalable implementations of NJ algorithms that are written as libraries that can be easily incorporated into other software. DecentTree seeks to address these limitations.</p>
  </sec>
  <sec>
    <title>2 Implementation</title>
    <p>DecentTree is an optimized and parallel C++ implementation of NJ and BIONJ (<xref rid="btad536-B2" ref-type="bibr">Gascuel 1997</xref>). DecentTree uses the Vector Class Library (VCL; <ext-link xlink:href="https://github.com/vectorclass" ext-link-type="uri">https://github.com/vectorclass</ext-link>) and the multithreading OpenMP to parallelize the computations. Moreover, we reimplemented the RapidNJ algorithm to optimize memory access patterns and reduce CPU cache miss. The VCL version of NJ and BIONJ implementation in DecentTree is denoted with ‘-V’ suffix (NJ-V and BIONJ-V), whereas the RapidNJ reimplementation is denoted with ‘-R’ suffix (NJ-R and BIONJ-R). Like other standard implementations of NJ/BIONJ, DecentTree has a worst-case time complexity of O(<italic toggle="yes">n</italic><sup>3</sup>), where <italic toggle="yes">n</italic> is the number of taxa. But we expect DecentTree to be faster in most cases due to the highly optimized code.</p>
    <p>DecentTree is designed as both a stand-alone program and a header-only library that can be easily integrated into other phylogenetic software packages. DecentTree uses C++ template classes that allow for flexible configuration of the runtimes such as choosing between single or double precision arithmetic. As input, DecentTree accepts either a distance matrix in Phylip format or a multiple sequence alignment in common formats such as Phylip or Fasta. When users provide a sequence alignment, DecentTree computes the Jukes-Cantor pairwise distance matrix (<xref rid="btad536-B4" ref-type="bibr">Jukes and Cantor 1969</xref>) from the alignment. As output, DecentTree reconstructs a distance-based tree in Newick format. We checked the correctness of our implementations on simulated data with 100 taxa and alignment lengths ranging from 1000 to 100 000 sites (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>) and assessed the code quality of DecentTree using SoftWipe (<xref rid="btad536-B15" ref-type="bibr">Zapletal <italic toggle="yes">et al.</italic> 2021</xref>). The overall score of DecentTree was 5.7, slightly higher than the average score of 5.6 for software evaluated by <xref rid="btad536-B15" ref-type="bibr">Zapletal <italic toggle="yes">et al.</italic> (2021)</xref>.</p>
  </sec>
  <sec>
    <title>3 Benchmarking</title>
    <p>We compared the performance of the four implementations of the NJ and BIONJ algorithms in DecentTree (NJ-R, NJ-V, BIONJ-R, BIONJ-V) to implementations of the same algorithms in four other software implementations which take distance matrices as input [the BIONJ algorithm implemented in the original BIONJ software, the NJ and BIONJ algorithms implemented in FastME v2.1.6.2 (<xref rid="btad536-B5" ref-type="bibr">Lefort <italic toggle="yes">et al.</italic> 2015</xref>), and the NJ algorithms implemented in Quicktree v2.5 (<xref rid="btad536-B3" ref-type="bibr">Howe <italic toggle="yes">et al.</italic> 2002</xref>) and RapidNJ v2.3.2] and one other implementation which takes a sequence alignment as input [FastTree (<xref rid="btad536-B7" ref-type="bibr">Price <italic toggle="yes">et al.</italic> 2009</xref>, <xref rid="btad536-B8" ref-type="bibr">Price <italic toggle="yes">et al.</italic> 2010</xref>)]. To do this, we analysed the simulated data we used to check DecentTree (see above), and three challenging empirical datasets: a SARS-CoV-2 alignment (COVID19 datasets) (<ext-link xlink:href="https://github.com/bpt26/parsimony" ext-link-type="uri">https://github.com/bpt26/parsimony</ext-link>, accessed on 11 May 2021) (<xref rid="btad536-B6" ref-type="bibr">McBroome <italic toggle="yes">et al.</italic> 2021</xref>) and two high-quality ribosomal RNA v138.1 datasets from the SILVA database (<xref rid="btad536-B9" ref-type="bibr">Quast <italic toggle="yes">et al.</italic> 2013</xref>), the small subunit (SSU_NR99) and the large subunit (LSU_NR99) datasets. To examine performance across a range of dataset sizes, we randomly subsampled seven subsets of 1000, 2000, 4000, 8000, 16 000, 32 000, and 64 000 sequences from each dataset using Seqtk version 1.3-r116-dirty (<ext-link xlink:href="https://github.com/lh3/seqtk" ext-link-type="uri">https://github.com/lh3/seqtk</ext-link>). For the comparisons which use a distance matrix as input we first computed the distance matrix for each subset using DecentTree and then ran all software using these distance matrices as input (command see <xref rid="sup1" ref-type="supplementary-material">Supplementary Information</xref>). For the programmes that support multiple-threading (DecentTree, FastME, RapidNJ, and FastTree), we benchmarked them with 1 thread and 32 threads. We set the maximum wall-clock time to 12 h and the maximum memory limit to 500 Gb.</p>
    <p>These settings resulted in 378 analyses for using distance matrices as input: 21 data subsets × 9 implementations (4 for DecentTree, 2 for FastME, and 1 for BIONJ/Quicktree/RapidNJ) × 2 thread counts; and 210 analyses using multiple alignments as input: for 21 data subsets × 5 implementations (4 for DecentTree and 1 for FastTree) × 2 thread counts. We recorded the wall-clock time and peak memory usage of each analysis on a server with 256 CPUs of 2.5 GHz and 1 Tb RAM. To compare the resulting trees, we computed their log-likelihoods using IQ-TREE (<xref rid="btad536-B666837364" ref-type="bibr">Nguyen <italic toggle="yes">et al</italic>., 2015</xref>) under the GTR+G model.</p>
  </sec>
  <sec>
    <title>4 Results</title>
    <p>Analyses of simulated data show that all algorithms in DecentTree, BIONJ, FastME, and RapidNJ performed well, but Quicktree and FastTree (using the NJ anlaysis only) performed poorly in terms of the Robinson–Foulds (RF) distance of the estimated trees to the true trees (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S9</xref>).</p>
    <p>Analyses of empirical data show that for analyses which started with distance matrices, DecentTree was the only implementation that completed every analysis within 12 h (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S2</xref>) and was the fastest implementation on the larger subsets of each of the three datasets. On the smaller subsets of each dataset (≤8000 sequences), RapidNJ tended to be the fastest implementation, although the absolute differences in execution time versus the fastest DecentTree algorithm were small (0.5–36 s when RapidNJ was faster, while for the COVID19 dataset with 8000 sequences and 32 threads available DecentTree was 26 s faster) (<xref rid="btad536-F1" ref-type="fig">Fig. 1</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S3–S5</xref>). DecentTree tended to be the fastest implementation on the larger subsets of each dataset, particularly when using multiple threads, although this does come at the cost of using ∼1.5× to ∼3× more memory than RapidNJ (<xref rid="btad536-F1" ref-type="fig">Fig. 1</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S6 and S7</xref>). On the largest subsets we analysed (64 000 sequences), DecentTree was 2.9 and 5.1 h (1.8 and 5.6 fold) faster than RapidNJ for the COVID19 dataset with 1 and 32 threads, respectively (<xref rid="btad536-F1" ref-type="fig">Fig. 1</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>). For the LSU_NR99 dataset, DecentTree was 2.2 and 3.5 h (1.9 and 4.2 fold) faster than RapidNJ with 1 and 32 threads, respectively; and DecentTree was the only software able to complete the analysis of the 64 000 sequence SSU_NR99 dataset in under 12 h (RapidNJ quit without producing any output for this dataset, and we were unable to determine why). The performance of the four DecentTree algorithms (NJ-R, NJ-V, BIONJ-R, BIONJ-V) differed modestly, but NJ-R tended to be the fastest, particularly on the larger subsets, while NJ-V tended to be the most memory efficient. Likelihood analysis shows that the different implementations produce trees that can differ somewhat in their fit to the data. For example, the different implementations produce trees that differ by 30–2681 units of log-likelihood on COVID19 datasets. NJ algorithms tended to produce trees with higher likelihoods than BIONJ algorithms for COVID19 and LSU_NR99, but worse trees for SSU_NR99 (<xref rid="btad536-F1" ref-type="fig">Fig. 1</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S3–S7</xref>). RF distances (<xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S8–S14</xref>) show that the tree topologies inferred by DecentTree and other implementations are sometimes different from each other, e.g. by 3.43%–23.51% on 8000 sequences datasets. These large differences are driven by the very large proportion of very short branches in these trees (e.g. more than 70% of branches in the 64 000 sequence COVID tree represent &lt;1 substitution. <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S15</xref>). Because the alignments lack information to resolve these branches, most are resolved effectively at random, leading to large normalized RF distances.</p>
    <fig position="float" id="btad536-F1">
      <label>Figure 1.</label>
      <caption>
        <p>The comparison of different implementations on the 8000 (A) and 64 000 (B) sequence subsets of COVID19, LSU_NR99, and SSU_NR99 datasets. BIONJ and Quicktree do not support multithreading.</p>
      </caption>
      <graphic xlink:href="btad536f1" position="float"/>
    </fig>
    <p>We compared DecentTree to FastTree when inferring a tree from an alignment (the results above pertain to trees inferred from distance matrices). The results (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S16</xref>) showed that when using one thread, DecentTree is generally slower than FastTree, e.g. by 1.4–1.9 times on 64 000 sequences, but this is reversed with 32 threads (e.g. DecentTree is 2.7–14.1 times faster than FastTree on 64 000 sequences). DecentTree always consumed more RAM than FastTree. For instance, DecentTree NJ-V and FastTree required ∼50 GB and ∼17 GB RAM on 64 000 sequences, respectively. This memory footprint means that DecentTree may not be applicable for datasets with millions of sequences. Likelihood analysis shows that Decenttree NJ-V produces trees with a higher likelihood on COVID19 datasets.</p>
    <p>To test the influence of the types of topological move used by different software on the inferred trees, we built additional trees on the 4000 sequence subsets (COVID19, LSU_NR99, and SSU_NR99) using FastME (SPRs), FastTree (NNIs), and DecentTree (default setting), and compared the log-likelihoods of the resulting trees using a GTR+G model in IQ-TREE (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S17</xref>). The result shows that FastME (SPRs) has the best log-likelihood on COVID19 and SSU_NR99 subsets, whereas FastTree (NNIs) has the best log-likelihood on the LSU_R99 subset. Log-likelihood differences between the trees inferred by DecentTree are at most 380 to 51 240 units, while these numbers are from 0 to 65 738 for FastTree.</p>
  </sec>
  <sec>
    <title>5 Conclusions</title>
    <p>DecentTree allows users to quickly estimate very large NJ trees with a range of algorithms. In addition, because DecentTree is implemented as both stand-alone software and a header-only library, it is easy to incorporate it into other software. This will help to ensure that future improvements in NJ algorithms can be seamlessly integrated into other software and pipelines.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btad536_Supplementary_Data</label>
      <media xlink:href="btad536_supplementary_data.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the Guangdong Provincial Genomics Data Center [2021B1212100001]; the Chan-Zuckerberg Initiative grant for open-source software for science [to B.Q.M. and R.L.]; and the Australian Research Council Discovery Grant [DP200103151 to R.L. and B.Q.M].</p>
  </sec>
  <sec>
    <title>Data availablity</title>
    <p>DecentTree is open source and freely available at <ext-link xlink:href="https://github.com/iqtree/decenttree" ext-link-type="uri">https://github.com/iqtree/decenttree</ext-link>. All code and data used in this analysis are available on Github (<ext-link xlink:href="https://github.com/asdcid/Comparison-of-neighbour-joining-software" ext-link-type="uri">https://github.com/asdcid/Comparison-of-neighbour-joining-software</ext-link>).</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btad536-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Edgar</surname><given-names>RC.</given-names></string-name></person-group>  <article-title>MUSCLE: multiple sequence alignment with high accuracy and high throughput</article-title>. <source>Nucleic Acids Res</source>  <year>2004</year>;<volume>32</volume>:<fpage>1792</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">15034147</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group>  <article-title>BIONJ: an improved version of the NJ algorithm based on a simple model of sequence data</article-title>. <source>Mol Biol Evol</source>  <year>1997</year>;<volume>14</volume>:<fpage>685</fpage>–<lpage>95</lpage>.<pub-id pub-id-type="pmid">9254330</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Howe</surname><given-names>K</given-names></string-name>, <string-name><surname>Bateman</surname><given-names>A</given-names></string-name>, <string-name><surname>Durbin</surname><given-names>R.</given-names></string-name></person-group>  <article-title>QuickTree: building huge Neighbour-Joining trees of protein sequences</article-title>. <source>Bioinformatics</source>  <year>2002</year>;<volume>18</volume>:<fpage>1546</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">12424131</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B4">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Jukes</surname><given-names>T</given-names></string-name>, <string-name><surname>Cantor</surname><given-names>C.</given-names></string-name></person-group>  <part-title>Evolution of protein molecules</part-title>. In: <person-group person-group-type="editor"><string-name><surname>Munro</surname><given-names>HN</given-names></string-name></person-group> (ed.), <source>Mammalian Protein Metabolism</source>. <publisher-loc>New York</publisher-loc>: <publisher-name>Academic Press</publisher-name>, <year>1969</year>, <fpage>21</fpage>–<lpage>132</lpage>.</mixed-citation>
    </ref>
    <ref id="btad536-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lefort</surname><given-names>V</given-names></string-name>, <string-name><surname>Desper</surname><given-names>R</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group>  <article-title>FastME 2.0: a comprehensive, accurate, and fast distance-based phylogeny inference program</article-title>. <source>Mol Biol Evol</source>  <year>2015</year>;<volume>32</volume>:<fpage>2798</fpage>–<lpage>800</lpage>.<pub-id pub-id-type="pmid">26130081</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>McBroome</surname><given-names>J</given-names></string-name>, <string-name><surname>Thornlow</surname><given-names>B</given-names></string-name>, <string-name><surname>Hinrichs</surname><given-names>AS</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>A daily-updated database and tools for comprehensive SARS-CoV-2 mutation-annotated trees</article-title>. <source>Mol Biol Evol</source>  <year>2021</year>;<volume>38</volume>:<fpage>5819</fpage>–<lpage>24</lpage>.<pub-id pub-id-type="pmid">34469548</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B666837364">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nguyen</surname><given-names>L-T</given-names>, </string-name>, <string-name><surname>Schmidt</surname><given-names>HA</given-names>, </string-name>, <string-name><surname>Von Haeseler</surname><given-names>A</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>IQ-TREE: A fast and effective stochastic algorithm for estimating maximum-likelihood phylogenies</article-title>. <source>Mol Biol Evol</source>  <year>2015</year>;<volume>32</volume>:<fpage>268</fpage>–<lpage>74</lpage>.<pub-id pub-id-type="pmid">25371430</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Price</surname><given-names>MN</given-names></string-name>, <string-name><surname>Dehal</surname><given-names>PS</given-names></string-name>, <string-name><surname>Arkin</surname><given-names>AP.</given-names></string-name></person-group>  <article-title>FastTree: computing large minimum evolution trees with profiles instead of a distance matrix</article-title>. <source>Mol Biol Evol</source>  <year>2009</year>;<volume>26</volume>:<fpage>1641</fpage>–<lpage>50</lpage>.<pub-id pub-id-type="pmid">19377059</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Price</surname><given-names>MN</given-names></string-name>, <string-name><surname>Dehal</surname><given-names>PS</given-names></string-name>, <string-name><surname>Arkin</surname><given-names>AP.</given-names></string-name></person-group>  <article-title>FastTree 2—approximately maximum-likelihood trees for large alignments</article-title>. <source>PLoS One</source>  <year>2010</year>;<volume>5</volume>:<fpage>e9490</fpage>.<pub-id pub-id-type="pmid">20224823</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Quast</surname><given-names>C</given-names></string-name>, <string-name><surname>Pruesse</surname><given-names>E</given-names></string-name>, <string-name><surname>Yilmaz</surname><given-names>P</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>The SILVA ribosomal RNA gene database project: improved data processing and web-based tools</article-title>. <source>Nucleic Acids Res</source>  <year>2013</year>;<volume>41</volume>:<fpage>D590</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">23193283</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ratnasingham</surname><given-names>S</given-names></string-name>, <string-name><surname>Hebert</surname><given-names>PD.</given-names></string-name></person-group>  <article-title>Sci RepMol ecol NotesThe barcode of life data system</article-title>. <source>Mol Ecol Notes</source>  <year>2007</year>;<volume>7</volume>:<fpage>355</fpage>–<lpage>64</lpage>.<pub-id pub-id-type="pmid">18784790</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Saitou</surname><given-names>N</given-names></string-name>, <string-name><surname>Nei</surname><given-names>M.</given-names></string-name></person-group>  <article-title>The neighbor-joining method: a new method for reconstructing phylogenetic trees</article-title>. <source>Mol Biol Evol</source>  <year>1987</year>;<volume>4</volume>:<fpage>406</fpage>–<lpage>25</lpage>.<pub-id pub-id-type="pmid">3447015</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B12">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Simonsen</surname><given-names>M</given-names></string-name>, <string-name><surname>Mailund</surname><given-names>T</given-names></string-name>, <string-name><surname>Pedersen</surname><given-names>CN.</given-names></string-name></person-group> Rapid neighbour-joining. In: Crandall KA and Lagergren J (eds) <italic toggle="yes">Algorithms in Bioinformatics</italic>. Berlin, Heidelberg: Springer Berlin Heidelberg; 2008. pp. <fpage>113</fpage>–<lpage>122</lpage>.</mixed-citation>
    </ref>
    <ref id="btad536-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Thompson</surname><given-names>JD</given-names></string-name>, <string-name><surname>Higgins</surname><given-names>DG</given-names></string-name>, <string-name><surname>Gibson</surname><given-names>TJ.</given-names></string-name></person-group>  <article-title>CLUSTAL W: improving the sensitivity of progressive multiple sequence alignment through sequence weighting, position-specific gap penalties and weight matrix choice</article-title>. <source>Nucleic Acids Res</source>  <year>1994</year>;<volume>22</volume>:<fpage>4673</fpage>–<lpage>80</lpage>.<pub-id pub-id-type="pmid">7984417</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yang</surname><given-names>Z</given-names></string-name>, <string-name><surname>Rannala</surname><given-names>B.</given-names></string-name></person-group>  <article-title>Molecular phylogenetics: principles and practice</article-title>. <source>Nat Rev Genet</source>  <year>2012</year>;<volume>13</volume>:<fpage>303</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">22456349</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zapletal</surname><given-names>A</given-names></string-name>, <string-name><surname>Höhler</surname><given-names>D</given-names></string-name>, <string-name><surname>Sinz</surname><given-names>C</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>The SoftWipe tool and benchmark for assessing coding standards adherence of scientific software</article-title>. <source>Sci Rep</source>  <year>2021</year>;<volume>11</volume>:<fpage>10015</fpage>.<pub-id pub-id-type="pmid">33976324</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10491953</article-id>
    <article-id pub-id-type="pmid">37651445</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btad536</article-id>
    <article-id pub-id-type="publisher-id">btad536</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Phylogenetics</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>DecentTree: scalable Neighbour-Joining for the genomic era</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-9319-450X</contrib-id>
        <name>
          <surname>Wang</surname>
          <given-names>Weiwen</given-names>
        </name>
        <aff><institution>China National GeneBank, BGI Research</institution>, Shenzhen 518083, <country country="CN">China</country></aff>
        <xref rid="btad536-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Barbetti</surname>
          <given-names>James</given-names>
        </name>
        <aff><institution>School of Computing, College of Engineering and Computer Science, Australian National University</institution>, Canberra, ACT 2601, <country country="AU">Australia</country></aff>
        <xref rid="btad536-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wong</surname>
          <given-names>Thomas</given-names>
        </name>
        <aff><institution>Ecology and Evolution, Research School of Biology, College of Science, Australian National University</institution>, Canberra, ACT 2601, <country country="AU">Australia</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-6334-5186</contrib-id>
        <name>
          <surname>Thornlow</surname>
          <given-names>Bryan</given-names>
        </name>
        <aff><institution>Genomics Institute, University of California Santa Cruz</institution>, Santa Cruz, CA 95064, <country country="US">United States</country></aff>
        <aff><institution>Biomolecular Engineering, University of California Santa Cruz</institution>, Santa Cruz, CA 95064, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Corbett-Detig</surname>
          <given-names>Russ</given-names>
        </name>
        <aff><institution>Genomics Institute, University of California Santa Cruz</institution>, Santa Cruz, CA 95064, <country country="US">United States</country></aff>
        <aff><institution>Biomolecular Engineering, University of California Santa Cruz</institution>, Santa Cruz, CA 95064, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-5600-2900</contrib-id>
        <name>
          <surname>Turakhia</surname>
          <given-names>Yatish</given-names>
        </name>
        <aff><institution>Electrical and Computer Engineering, University of California San Diego</institution>, La Jolla, CA 92093, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-1140-2596</contrib-id>
        <name>
          <surname>Lanfear</surname>
          <given-names>Robert</given-names>
        </name>
        <aff><institution>Ecology and Evolution, Research School of Biology, College of Science, Australian National University</institution>, Canberra, ACT 2601, <country country="AU">Australia</country></aff>
        <xref rid="btad536-cor1" ref-type="corresp"/>
        <!--rob.lanfear@anu.edu.au-->
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-5535-6560</contrib-id>
        <name>
          <surname>Minh</surname>
          <given-names>Bui Quang</given-names>
        </name>
        <aff><institution>School of Computing, College of Engineering and Computer Science, Australian National University</institution>, Canberra, ACT 2601, <country country="AU">Australia</country></aff>
        <xref rid="btad536-cor1" ref-type="corresp"/>
        <!--m.bui@anu.edu.au-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Schwartz</surname>
          <given-names>Russell</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btad536-cor1">Corresponding authors. School of Computing, College of Engineering and Computer Science, Australian National University, Canberra, ACT 2601, Australia. E-mail: <email>m.bui@anu.edu.au</email> (B.Q.M.); Ecology and Evolution, Research School of Biology, College of Science, Australian National University, Canberra, ACT 2601, Australia. E-mail: <email>rob.lanfear@anu.edu.au</email> (R.L.)</corresp>
      <fn id="btad536-FM1">
        <p>Weiwen Wang and James Barbetti contributed equally to this work.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-08-31">
      <day>31</day>
      <month>8</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>31</day>
      <month>8</month>
      <year>2023</year>
    </pub-date>
    <volume>39</volume>
    <issue>9</issue>
    <elocation-id>btad536</elocation-id>
    <history>
      <date date-type="received">
        <day>21</day>
        <month>3</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>23</day>
        <month>8</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>24</day>
        <month>8</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>30</day>
        <month>8</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>08</day>
        <month>9</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btad536.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Neighbour-Joining is one of the most widely used distance-based phylogenetic inference methods. However, current implementations do not scale well for datasets with more than 10 000 sequences. Given the increasing pace of generating new sequence data, particularly in outbreaks of emerging diseases, and the already enormous existing databases of sequence data for which Neighbour-Joining is a useful approach, new implementations of existing methods are warranted.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>Here, we present DecentTree, which provides highly optimized and parallel implementations of Neighbour-Joining and several of its variants. DecentTree is designed as a stand-alone application and a header-only library easily integrated with other phylogenetic software (e.g. it is integral in the popular IQ-TREE software). We show that DecentTree shows similar or improved performance over existing software (BIONJ, Quicktree, FastME, and RapidNJ), especially for handling very large alignments. For example, DecentTree is up to 6-fold faster than the fastest existing Neighbour-Joining software (e.g. RapidNJ) when generating a tree of 64 000 SARS-CoV-2 genomes.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>DecentTree is open source and freely available at <ext-link xlink:href="https://github.com/iqtree/decenttree" ext-link-type="uri">https://github.com/iqtree/decenttree</ext-link>. All code and data used in this analysis are available on Github (<ext-link xlink:href="https://github.com/asdcid/Comparison-of-neighbour-joining-software" ext-link-type="uri">https://github.com/asdcid/Comparison-of-neighbour-joining-software</ext-link>).</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Guangdong Provincial Genomics Data Center</institution>
          </institution-wrap>
        </funding-source>
        <award-id>2021B1212100001</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Chan-Zuckerberg</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Australian Research Council</institution>
            <institution-id institution-id-type="DOI">10.13039/501100000923</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>DP200103151</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="4"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Neighbour-Joining (NJ) (<xref rid="btad536-B11" ref-type="bibr">Saitou and Nei 1987</xref>) is perhaps the most widely used distance-based algorithm for inferring phylogenies. Its success results from its simplicity and computational efficiency: NJ takes a fraction of the time required by other popular approaches (e.g. Maximum Likelihood and Bayesian methods) and is known to perform well in terms of speed and accuracy for large alignments with low sequence divergence (<xref rid="btad536-B14" ref-type="bibr">Yang and Rannala 2012</xref>). Although other approaches such as Maximum Likelihood and Bayesian approaches perform better than NJ in many situations, the properties of NJ make it an attractive method for a range of applications, including generating starting trees for more computationally expensive approaches, generating rapid trees from large alignments such as SARS-CoV-2 (<xref rid="btad536-B6" ref-type="bibr">McBroome <italic toggle="yes">et al.</italic> 2021</xref>), ribosomal RNA (<xref rid="btad536-B9" ref-type="bibr">Quast <italic toggle="yes">et al.</italic> 2013</xref>), and DNA barcodes (<xref rid="btad536-B10" ref-type="bibr">Ratnasingham and Hebert 2007</xref>), and NJ is also widely used to provide guide trees for alignment algorithms (<xref rid="btad536-B13" ref-type="bibr">Thompson <italic toggle="yes">et al.</italic> 1994</xref>, <xref rid="btad536-B1" ref-type="bibr">Edgar 2004</xref>). Despite its utility, even the fastest existing implementation of NJ, RapidNJ (<xref rid="btad536-B12" ref-type="bibr">Simonsen <italic toggle="yes">et al.</italic> 2008</xref>), does not scale well for alignments containing more than 10 000 sequences, and there are no scalable implementations of NJ algorithms that are written as libraries that can be easily incorporated into other software. DecentTree seeks to address these limitations.</p>
  </sec>
  <sec>
    <title>2 Implementation</title>
    <p>DecentTree is an optimized and parallel C++ implementation of NJ and BIONJ (<xref rid="btad536-B2" ref-type="bibr">Gascuel 1997</xref>). DecentTree uses the Vector Class Library (VCL; <ext-link xlink:href="https://github.com/vectorclass" ext-link-type="uri">https://github.com/vectorclass</ext-link>) and the multithreading OpenMP to parallelize the computations. Moreover, we reimplemented the RapidNJ algorithm to optimize memory access patterns and reduce CPU cache miss. The VCL version of NJ and BIONJ implementation in DecentTree is denoted with ‘-V’ suffix (NJ-V and BIONJ-V), whereas the RapidNJ reimplementation is denoted with ‘-R’ suffix (NJ-R and BIONJ-R). Like other standard implementations of NJ/BIONJ, DecentTree has a worst-case time complexity of O(<italic toggle="yes">n</italic><sup>3</sup>), where <italic toggle="yes">n</italic> is the number of taxa. But we expect DecentTree to be faster in most cases due to the highly optimized code.</p>
    <p>DecentTree is designed as both a stand-alone program and a header-only library that can be easily integrated into other phylogenetic software packages. DecentTree uses C++ template classes that allow for flexible configuration of the runtimes such as choosing between single or double precision arithmetic. As input, DecentTree accepts either a distance matrix in Phylip format or a multiple sequence alignment in common formats such as Phylip or Fasta. When users provide a sequence alignment, DecentTree computes the Jukes-Cantor pairwise distance matrix (<xref rid="btad536-B4" ref-type="bibr">Jukes and Cantor 1969</xref>) from the alignment. As output, DecentTree reconstructs a distance-based tree in Newick format. We checked the correctness of our implementations on simulated data with 100 taxa and alignment lengths ranging from 1000 to 100 000 sites (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>) and assessed the code quality of DecentTree using SoftWipe (<xref rid="btad536-B15" ref-type="bibr">Zapletal <italic toggle="yes">et al.</italic> 2021</xref>). The overall score of DecentTree was 5.7, slightly higher than the average score of 5.6 for software evaluated by <xref rid="btad536-B15" ref-type="bibr">Zapletal <italic toggle="yes">et al.</italic> (2021)</xref>.</p>
  </sec>
  <sec>
    <title>3 Benchmarking</title>
    <p>We compared the performance of the four implementations of the NJ and BIONJ algorithms in DecentTree (NJ-R, NJ-V, BIONJ-R, BIONJ-V) to implementations of the same algorithms in four other software implementations which take distance matrices as input [the BIONJ algorithm implemented in the original BIONJ software, the NJ and BIONJ algorithms implemented in FastME v2.1.6.2 (<xref rid="btad536-B5" ref-type="bibr">Lefort <italic toggle="yes">et al.</italic> 2015</xref>), and the NJ algorithms implemented in Quicktree v2.5 (<xref rid="btad536-B3" ref-type="bibr">Howe <italic toggle="yes">et al.</italic> 2002</xref>) and RapidNJ v2.3.2] and one other implementation which takes a sequence alignment as input [FastTree (<xref rid="btad536-B7" ref-type="bibr">Price <italic toggle="yes">et al.</italic> 2009</xref>, <xref rid="btad536-B8" ref-type="bibr">Price <italic toggle="yes">et al.</italic> 2010</xref>)]. To do this, we analysed the simulated data we used to check DecentTree (see above), and three challenging empirical datasets: a SARS-CoV-2 alignment (COVID19 datasets) (<ext-link xlink:href="https://github.com/bpt26/parsimony" ext-link-type="uri">https://github.com/bpt26/parsimony</ext-link>, accessed on 11 May 2021) (<xref rid="btad536-B6" ref-type="bibr">McBroome <italic toggle="yes">et al.</italic> 2021</xref>) and two high-quality ribosomal RNA v138.1 datasets from the SILVA database (<xref rid="btad536-B9" ref-type="bibr">Quast <italic toggle="yes">et al.</italic> 2013</xref>), the small subunit (SSU_NR99) and the large subunit (LSU_NR99) datasets. To examine performance across a range of dataset sizes, we randomly subsampled seven subsets of 1000, 2000, 4000, 8000, 16 000, 32 000, and 64 000 sequences from each dataset using Seqtk version 1.3-r116-dirty (<ext-link xlink:href="https://github.com/lh3/seqtk" ext-link-type="uri">https://github.com/lh3/seqtk</ext-link>). For the comparisons which use a distance matrix as input we first computed the distance matrix for each subset using DecentTree and then ran all software using these distance matrices as input (command see <xref rid="sup1" ref-type="supplementary-material">Supplementary Information</xref>). For the programmes that support multiple-threading (DecentTree, FastME, RapidNJ, and FastTree), we benchmarked them with 1 thread and 32 threads. We set the maximum wall-clock time to 12 h and the maximum memory limit to 500 Gb.</p>
    <p>These settings resulted in 378 analyses for using distance matrices as input: 21 data subsets × 9 implementations (4 for DecentTree, 2 for FastME, and 1 for BIONJ/Quicktree/RapidNJ) × 2 thread counts; and 210 analyses using multiple alignments as input: for 21 data subsets × 5 implementations (4 for DecentTree and 1 for FastTree) × 2 thread counts. We recorded the wall-clock time and peak memory usage of each analysis on a server with 256 CPUs of 2.5 GHz and 1 Tb RAM. To compare the resulting trees, we computed their log-likelihoods using IQ-TREE (<xref rid="btad536-B666837364" ref-type="bibr">Nguyen <italic toggle="yes">et al</italic>., 2015</xref>) under the GTR+G model.</p>
  </sec>
  <sec>
    <title>4 Results</title>
    <p>Analyses of simulated data show that all algorithms in DecentTree, BIONJ, FastME, and RapidNJ performed well, but Quicktree and FastTree (using the NJ anlaysis only) performed poorly in terms of the Robinson–Foulds (RF) distance of the estimated trees to the true trees (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S9</xref>).</p>
    <p>Analyses of empirical data show that for analyses which started with distance matrices, DecentTree was the only implementation that completed every analysis within 12 h (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S2</xref>) and was the fastest implementation on the larger subsets of each of the three datasets. On the smaller subsets of each dataset (≤8000 sequences), RapidNJ tended to be the fastest implementation, although the absolute differences in execution time versus the fastest DecentTree algorithm were small (0.5–36 s when RapidNJ was faster, while for the COVID19 dataset with 8000 sequences and 32 threads available DecentTree was 26 s faster) (<xref rid="btad536-F1" ref-type="fig">Fig. 1</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S3–S5</xref>). DecentTree tended to be the fastest implementation on the larger subsets of each dataset, particularly when using multiple threads, although this does come at the cost of using ∼1.5× to ∼3× more memory than RapidNJ (<xref rid="btad536-F1" ref-type="fig">Fig. 1</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S6 and S7</xref>). On the largest subsets we analysed (64 000 sequences), DecentTree was 2.9 and 5.1 h (1.8 and 5.6 fold) faster than RapidNJ for the COVID19 dataset with 1 and 32 threads, respectively (<xref rid="btad536-F1" ref-type="fig">Fig. 1</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>). For the LSU_NR99 dataset, DecentTree was 2.2 and 3.5 h (1.9 and 4.2 fold) faster than RapidNJ with 1 and 32 threads, respectively; and DecentTree was the only software able to complete the analysis of the 64 000 sequence SSU_NR99 dataset in under 12 h (RapidNJ quit without producing any output for this dataset, and we were unable to determine why). The performance of the four DecentTree algorithms (NJ-R, NJ-V, BIONJ-R, BIONJ-V) differed modestly, but NJ-R tended to be the fastest, particularly on the larger subsets, while NJ-V tended to be the most memory efficient. Likelihood analysis shows that the different implementations produce trees that can differ somewhat in their fit to the data. For example, the different implementations produce trees that differ by 30–2681 units of log-likelihood on COVID19 datasets. NJ algorithms tended to produce trees with higher likelihoods than BIONJ algorithms for COVID19 and LSU_NR99, but worse trees for SSU_NR99 (<xref rid="btad536-F1" ref-type="fig">Fig. 1</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S3–S7</xref>). RF distances (<xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S8–S14</xref>) show that the tree topologies inferred by DecentTree and other implementations are sometimes different from each other, e.g. by 3.43%–23.51% on 8000 sequences datasets. These large differences are driven by the very large proportion of very short branches in these trees (e.g. more than 70% of branches in the 64 000 sequence COVID tree represent &lt;1 substitution. <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S15</xref>). Because the alignments lack information to resolve these branches, most are resolved effectively at random, leading to large normalized RF distances.</p>
    <fig position="float" id="btad536-F1">
      <label>Figure 1.</label>
      <caption>
        <p>The comparison of different implementations on the 8000 (A) and 64 000 (B) sequence subsets of COVID19, LSU_NR99, and SSU_NR99 datasets. BIONJ and Quicktree do not support multithreading.</p>
      </caption>
      <graphic xlink:href="btad536f1" position="float"/>
    </fig>
    <p>We compared DecentTree to FastTree when inferring a tree from an alignment (the results above pertain to trees inferred from distance matrices). The results (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S16</xref>) showed that when using one thread, DecentTree is generally slower than FastTree, e.g. by 1.4–1.9 times on 64 000 sequences, but this is reversed with 32 threads (e.g. DecentTree is 2.7–14.1 times faster than FastTree on 64 000 sequences). DecentTree always consumed more RAM than FastTree. For instance, DecentTree NJ-V and FastTree required ∼50 GB and ∼17 GB RAM on 64 000 sequences, respectively. This memory footprint means that DecentTree may not be applicable for datasets with millions of sequences. Likelihood analysis shows that Decenttree NJ-V produces trees with a higher likelihood on COVID19 datasets.</p>
    <p>To test the influence of the types of topological move used by different software on the inferred trees, we built additional trees on the 4000 sequence subsets (COVID19, LSU_NR99, and SSU_NR99) using FastME (SPRs), FastTree (NNIs), and DecentTree (default setting), and compared the log-likelihoods of the resulting trees using a GTR+G model in IQ-TREE (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S17</xref>). The result shows that FastME (SPRs) has the best log-likelihood on COVID19 and SSU_NR99 subsets, whereas FastTree (NNIs) has the best log-likelihood on the LSU_R99 subset. Log-likelihood differences between the trees inferred by DecentTree are at most 380 to 51 240 units, while these numbers are from 0 to 65 738 for FastTree.</p>
  </sec>
  <sec>
    <title>5 Conclusions</title>
    <p>DecentTree allows users to quickly estimate very large NJ trees with a range of algorithms. In addition, because DecentTree is implemented as both stand-alone software and a header-only library, it is easy to incorporate it into other software. This will help to ensure that future improvements in NJ algorithms can be seamlessly integrated into other software and pipelines.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btad536_Supplementary_Data</label>
      <media xlink:href="btad536_supplementary_data.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the Guangdong Provincial Genomics Data Center [2021B1212100001]; the Chan-Zuckerberg Initiative grant for open-source software for science [to B.Q.M. and R.L.]; and the Australian Research Council Discovery Grant [DP200103151 to R.L. and B.Q.M].</p>
  </sec>
  <sec>
    <title>Data availablity</title>
    <p>DecentTree is open source and freely available at <ext-link xlink:href="https://github.com/iqtree/decenttree" ext-link-type="uri">https://github.com/iqtree/decenttree</ext-link>. All code and data used in this analysis are available on Github (<ext-link xlink:href="https://github.com/asdcid/Comparison-of-neighbour-joining-software" ext-link-type="uri">https://github.com/asdcid/Comparison-of-neighbour-joining-software</ext-link>).</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btad536-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Edgar</surname><given-names>RC.</given-names></string-name></person-group>  <article-title>MUSCLE: multiple sequence alignment with high accuracy and high throughput</article-title>. <source>Nucleic Acids Res</source>  <year>2004</year>;<volume>32</volume>:<fpage>1792</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">15034147</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group>  <article-title>BIONJ: an improved version of the NJ algorithm based on a simple model of sequence data</article-title>. <source>Mol Biol Evol</source>  <year>1997</year>;<volume>14</volume>:<fpage>685</fpage>–<lpage>95</lpage>.<pub-id pub-id-type="pmid">9254330</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Howe</surname><given-names>K</given-names></string-name>, <string-name><surname>Bateman</surname><given-names>A</given-names></string-name>, <string-name><surname>Durbin</surname><given-names>R.</given-names></string-name></person-group>  <article-title>QuickTree: building huge Neighbour-Joining trees of protein sequences</article-title>. <source>Bioinformatics</source>  <year>2002</year>;<volume>18</volume>:<fpage>1546</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">12424131</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B4">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Jukes</surname><given-names>T</given-names></string-name>, <string-name><surname>Cantor</surname><given-names>C.</given-names></string-name></person-group>  <part-title>Evolution of protein molecules</part-title>. In: <person-group person-group-type="editor"><string-name><surname>Munro</surname><given-names>HN</given-names></string-name></person-group> (ed.), <source>Mammalian Protein Metabolism</source>. <publisher-loc>New York</publisher-loc>: <publisher-name>Academic Press</publisher-name>, <year>1969</year>, <fpage>21</fpage>–<lpage>132</lpage>.</mixed-citation>
    </ref>
    <ref id="btad536-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lefort</surname><given-names>V</given-names></string-name>, <string-name><surname>Desper</surname><given-names>R</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group>  <article-title>FastME 2.0: a comprehensive, accurate, and fast distance-based phylogeny inference program</article-title>. <source>Mol Biol Evol</source>  <year>2015</year>;<volume>32</volume>:<fpage>2798</fpage>–<lpage>800</lpage>.<pub-id pub-id-type="pmid">26130081</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>McBroome</surname><given-names>J</given-names></string-name>, <string-name><surname>Thornlow</surname><given-names>B</given-names></string-name>, <string-name><surname>Hinrichs</surname><given-names>AS</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>A daily-updated database and tools for comprehensive SARS-CoV-2 mutation-annotated trees</article-title>. <source>Mol Biol Evol</source>  <year>2021</year>;<volume>38</volume>:<fpage>5819</fpage>–<lpage>24</lpage>.<pub-id pub-id-type="pmid">34469548</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B666837364">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nguyen</surname><given-names>L-T</given-names>, </string-name>, <string-name><surname>Schmidt</surname><given-names>HA</given-names>, </string-name>, <string-name><surname>Von Haeseler</surname><given-names>A</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>IQ-TREE: A fast and effective stochastic algorithm for estimating maximum-likelihood phylogenies</article-title>. <source>Mol Biol Evol</source>  <year>2015</year>;<volume>32</volume>:<fpage>268</fpage>–<lpage>74</lpage>.<pub-id pub-id-type="pmid">25371430</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Price</surname><given-names>MN</given-names></string-name>, <string-name><surname>Dehal</surname><given-names>PS</given-names></string-name>, <string-name><surname>Arkin</surname><given-names>AP.</given-names></string-name></person-group>  <article-title>FastTree: computing large minimum evolution trees with profiles instead of a distance matrix</article-title>. <source>Mol Biol Evol</source>  <year>2009</year>;<volume>26</volume>:<fpage>1641</fpage>–<lpage>50</lpage>.<pub-id pub-id-type="pmid">19377059</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Price</surname><given-names>MN</given-names></string-name>, <string-name><surname>Dehal</surname><given-names>PS</given-names></string-name>, <string-name><surname>Arkin</surname><given-names>AP.</given-names></string-name></person-group>  <article-title>FastTree 2—approximately maximum-likelihood trees for large alignments</article-title>. <source>PLoS One</source>  <year>2010</year>;<volume>5</volume>:<fpage>e9490</fpage>.<pub-id pub-id-type="pmid">20224823</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Quast</surname><given-names>C</given-names></string-name>, <string-name><surname>Pruesse</surname><given-names>E</given-names></string-name>, <string-name><surname>Yilmaz</surname><given-names>P</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>The SILVA ribosomal RNA gene database project: improved data processing and web-based tools</article-title>. <source>Nucleic Acids Res</source>  <year>2013</year>;<volume>41</volume>:<fpage>D590</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">23193283</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ratnasingham</surname><given-names>S</given-names></string-name>, <string-name><surname>Hebert</surname><given-names>PD.</given-names></string-name></person-group>  <article-title>Sci RepMol ecol NotesThe barcode of life data system</article-title>. <source>Mol Ecol Notes</source>  <year>2007</year>;<volume>7</volume>:<fpage>355</fpage>–<lpage>64</lpage>.<pub-id pub-id-type="pmid">18784790</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Saitou</surname><given-names>N</given-names></string-name>, <string-name><surname>Nei</surname><given-names>M.</given-names></string-name></person-group>  <article-title>The neighbor-joining method: a new method for reconstructing phylogenetic trees</article-title>. <source>Mol Biol Evol</source>  <year>1987</year>;<volume>4</volume>:<fpage>406</fpage>–<lpage>25</lpage>.<pub-id pub-id-type="pmid">3447015</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B12">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Simonsen</surname><given-names>M</given-names></string-name>, <string-name><surname>Mailund</surname><given-names>T</given-names></string-name>, <string-name><surname>Pedersen</surname><given-names>CN.</given-names></string-name></person-group> Rapid neighbour-joining. In: Crandall KA and Lagergren J (eds) <italic toggle="yes">Algorithms in Bioinformatics</italic>. Berlin, Heidelberg: Springer Berlin Heidelberg; 2008. pp. <fpage>113</fpage>–<lpage>122</lpage>.</mixed-citation>
    </ref>
    <ref id="btad536-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Thompson</surname><given-names>JD</given-names></string-name>, <string-name><surname>Higgins</surname><given-names>DG</given-names></string-name>, <string-name><surname>Gibson</surname><given-names>TJ.</given-names></string-name></person-group>  <article-title>CLUSTAL W: improving the sensitivity of progressive multiple sequence alignment through sequence weighting, position-specific gap penalties and weight matrix choice</article-title>. <source>Nucleic Acids Res</source>  <year>1994</year>;<volume>22</volume>:<fpage>4673</fpage>–<lpage>80</lpage>.<pub-id pub-id-type="pmid">7984417</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yang</surname><given-names>Z</given-names></string-name>, <string-name><surname>Rannala</surname><given-names>B.</given-names></string-name></person-group>  <article-title>Molecular phylogenetics: principles and practice</article-title>. <source>Nat Rev Genet</source>  <year>2012</year>;<volume>13</volume>:<fpage>303</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">22456349</pub-id></mixed-citation>
    </ref>
    <ref id="btad536-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zapletal</surname><given-names>A</given-names></string-name>, <string-name><surname>Höhler</surname><given-names>D</given-names></string-name>, <string-name><surname>Sinz</surname><given-names>C</given-names></string-name></person-group>  <etal>et al</etal>  <article-title>The SoftWipe tool and benchmark for assessing coding standards adherence of scientific software</article-title>. <source>Sci Rep</source>  <year>2021</year>;<volume>11</volume>:<fpage>10015</fpage>.<pub-id pub-id-type="pmid">33976324</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
