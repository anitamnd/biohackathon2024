<?DTDIdentifier.IdentifierValue -//ES//DTD journal article DTD version 5.6.0//EN//XML?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName art560.dtd?>
<?SourceDTD.Version 5.6.0?>
<?ConverterInfo.XSLTName elsevier2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<?origin publisher?>
<?FILEmeta_XPRO100911 xml ?>
<?FILEmain xml ?>
<?FILEmain pdf ?>
<?FILEgr1 jpg ?>
<?FILEgr2 jpg ?>
<?FILEgr3 jpg ?>
<?FILEfx1 jpg ?>
<?FILEfx2 jpg ?>
<?FILEfx3 jpg ?>
<?FILEmeta_XPRO100911 xml ?>
<?FILEmain xml ?>
<?FILEmain pdf ?>
<?FILEgr1 jpg ?>
<?FILEgr2 jpg ?>
<?FILEgr3 jpg ?>
<?FILEfx1 jpg ?>
<?FILEfx2 jpg ?>
<?FILEfx3 jpg ?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">STAR Protoc</journal-id>
    <journal-id journal-id-type="iso-abbrev">STAR Protoc</journal-id>
    <journal-title-group>
      <journal-title>STAR Protocols</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2666-1667</issn>
    <publisher>
      <publisher-name>Elsevier</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9680118</article-id>
    <article-id pub-id-type="pii">S2666-1667(21)00617-1</article-id>
    <article-id pub-id-type="doi">10.1016/j.xpro.2021.100911</article-id>
    <article-id pub-id-type="publisher-id">100911</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Protocol</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>VirMutSig: Discovery and assignment of viral mutational signatures
from sequencing data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" id="au1">
        <name>
          <surname>Maspero</surname>
          <given-names>Davide</given-names>
        </name>
        <email>d.maspero@campus.unimib.it</email>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff2" ref-type="aff">2</xref>
        <xref rid="fn2" ref-type="fn">6</xref>
        <xref rid="cor1" ref-type="corresp">∗</xref>
      </contrib>
      <contrib contrib-type="author" id="au2">
        <name>
          <surname>Angaroni</surname>
          <given-names>Fabrizio</given-names>
        </name>
        <xref rid="aff2" ref-type="aff">2</xref>
      </contrib>
      <contrib contrib-type="author" id="au3">
        <name>
          <surname>Porro</surname>
          <given-names>Danilo</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author" id="au4">
        <name>
          <surname>Piazza</surname>
          <given-names>Rocco</given-names>
        </name>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn1" ref-type="fn">5</xref>
      </contrib>
      <contrib contrib-type="author" id="au5">
        <name>
          <surname>Graudenzi</surname>
          <given-names>Alex</given-names>
        </name>
        <email>alex.graudenzi@ibfm.cnr.it</email>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="fn1" ref-type="fn">5</xref>
        <xref rid="cor2" ref-type="corresp">∗∗</xref>
      </contrib>
      <contrib contrib-type="author" id="au6">
        <name>
          <surname>Ramazzotti</surname>
          <given-names>Daniele</given-names>
        </name>
        <email>daniele.ramazzotti@unimib.it</email>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn1" ref-type="fn">5</xref>
        <xref rid="fn3" ref-type="fn">7</xref>
        <xref rid="cor3" ref-type="corresp">∗∗∗</xref>
      </contrib>
      <aff id="aff1"><label>1</label>Inst. of Molecular Bioimaging and Physiology, Consiglio Nazionale delle
Ricerche (IBFM-CNR), Segrate, Milan, Italy</aff>
      <aff id="aff2"><label>2</label>Department of Informatics, Systems and Communication, Univ. of
Milan-Bicocca, Milan, Italy</aff>
      <aff id="aff3"><label>3</label>Bicocca Bioinformatics, Biostatistics and Bioimaging Centre – B4, Milan,
Italy</aff>
      <aff id="aff4"><label>4</label>Department of Medicine and Surgery, Univ. of Milan-Bicocca, Monza,
Italy</aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor1"><label>∗</label>Corresponding author <email>d.maspero@campus.unimib.it</email></corresp>
      <corresp id="cor2"><label>∗∗</label>Corresponding author <email>alex.graudenzi@ibfm.cnr.it</email></corresp>
      <corresp id="cor3"><label>∗∗∗</label>Corresponding author <email>daniele.ramazzotti@unimib.it</email></corresp>
      <fn id="fn1">
        <label>5</label>
        <p id="ntpara0010">Senior author</p>
      </fn>
      <fn id="fn2">
        <label>6</label>
        <p id="ntpara0015">Technical contact</p>
      </fn>
      <fn id="fn3">
        <label>7</label>
        <p id="ntpara0020">Lead contact</p>
      </fn>
    </author-notes>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>10</month>
      <year>2021</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on <pub-date
						pub-type="epub">.-->
    <pub-date pub-type="collection">
      <day>17</day>
      <month>12</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>10</month>
      <year>2021</year>
    </pub-date>
    <volume>2</volume>
    <issue>4</issue>
    <elocation-id>100911</elocation-id>
    <permissions>
      <copyright-statement>© 2021 The Author(s)</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbyncndlicense">https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref>
        <license-p>This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/).</license-p>
      </license>
    </permissions>
    <abstract id="abs0010">
      <title>Summary</title>
      <p>We describe the procedures to perform the
following: (1) the <italic>de novo</italic> discovery of mutational
signatures from raw sequencing data of viral samples and (2) the association of
existing viral mutational signatures to the samples of a given dataset. The goal
is to identify and characterize the nucleotide substitution patterns related to
the mutational processes that underlie the origination of variants in viral
genomes. The VirMutSig protocol is available at this link: <ext-link ext-link-type="uri" xlink:href="https://github.com/BIMIB-DISCo/VirMutSig" id="intref0010">https://github.com/BIMIB-DISCo/VirMutSig</ext-link>.</p>
      <p>For complete information on the theoretical aspects
of this protocol, please refer to <xref rid="bib11" ref-type="bibr">Graudenzi et al. (2021)</xref>.</p>
    </abstract>
    <abstract abstract-type="graphical" id="abs0015">
      <title>Graphical abstract</title>
      <fig id="undfig1" position="anchor">
        <graphic xlink:href="fx1"/>
      </fig>
    </abstract>
    <abstract abstract-type="author-highlights" id="abs0020">
      <title>Highlights</title>
      <p>
        <list list-type="simple" id="ulist0010">
          <list-item id="u0010">
            <label>•</label>
            <p id="p0010">Distinct mutational processes underlie the
origination of viral variants</p>
          </list-item>
          <list-item id="u0015">
            <label>•</label>
            <p id="p0015">VirMutSig implements variant calling from raw
sequencing data of viral genomes</p>
          </list-item>
          <list-item id="u0020">
            <label>•</label>
            <p id="p0020">The tool performs de novo discovery of mutational
signatures (substitution patterns)</p>
          </list-item>
          <list-item id="u0025">
            <label>•</label>
            <p id="p0025">Robust assignment of signature activity to samples
is performed via bootstrap</p>
          </list-item>
        </list>
      </p>
    </abstract>
    <abstract abstract-type="teaser" id="abs0025">
      <p>We describe the procedures to perform the
following: (1) the <italic>de novo</italic> discovery of mutational
signatures from raw sequencing data of viral samples and (2) the association of
existing viral mutational signatures to the samples of a given data set. The
goal is to identify and characterize the nucleotide substitution patterns
related to the mutational processes that underlie the origination of variants in
viral genomes. The VirMutSig protocol is available at this link: <ext-link ext-link-type="uri" xlink:href="https://github.com/BIMIB-DISCo/VirMutSig" id="intref0015">https://github.com/BIMIB-DISCo/VirMutSig</ext-link>.</p>
    </abstract>
    <kwd-group id="kwrds0010">
      <title>Subject areas</title>
      <kwd>Bioinformatics</kwd>
      <kwd>Sequence analysis</kwd>
      <kwd>Genomics</kwd>
      <kwd>Sequencing</kwd>
      <kwd>RNAseq</kwd>
      <kwd>Systems biology</kwd>
    </kwd-group>
  </article-meta>
</front>
<body>
  <sec id="sec1">
    <title>Before you begin</title>
    <sec id="sec1.1">
      <title>Problem description</title>
      <p id="p0040">The VirMutSig protocol aims at identifying mutational
signatures from raw sequencing data of viral samples, as originally proposed
in the context of cancer evolution in (<xref rid="bib1" ref-type="bibr">Alexandrov et al., 2013</xref>) and in the
analysis of SARS-CoV-2 in (<xref rid="bib11" ref-type="bibr">Graudenzi et al., 2021</xref>). Mutational signatures represent
the decomposition of the categorical distribution of nucleotide
substitutions that are observed in the samples of a given dataset, and which
might be due to distinct mutational processes. Such processes could be
endogenous (e.g., APOBEC deaminase activity causes mainly C to T
substitutions) or exogenous (e.g., tobacco smoke causes mainly C to A
substitutions).</p>
      <p id="p0045">We formulated the problem of <italic>de novo</italic>
signature discovery and assignment as a Non-negative Matrix Factorization
(NMF) problem (<xref rid="bib16" ref-type="bibr">Lal et al.,
2021</xref>; <xref rid="bib11" ref-type="bibr">Graudenzi et al., 2021</xref>).</p>
      <p id="p0050">In brief, the counts of nucleotide substitutions observed in
all viral samples of a given dataset, after preprocessing and variant
calling, result in an input data matrix <bold>D</bold>, composed by
<italic>n</italic> samples (rows) X <italic>m</italic>
nucleotide substitution categories (e.g., the C to T category will include
the count of all variants with such substitution in any given sample)
(columns).</p>
      <p id="p0055">Formally, <bold>D</bold> is factorized in the
following matrices:</p>
      <p id="p0060">Signature matrix (<bold>B</bold>): this matrix
specifies the composition of every detected signature in terms of the
selected substitution categories.</p>
      <p id="p0070">Exposure matrix (<bold>A</bold>): it represents the
coefficients of the linear combination of signatures present in a sample.
This matrix evaluates the activity of the various signatures in each sample
of the dataset.</p>
      <p id="p0080">As we are dealing with noisy data, we propose a stochastic
optimization performed via a Monte Carlo Markov Chain (MCMC) to find the
best <bold>A</bold> and <bold>B</bold> matrices such that
<bold>A</bold>x<bold>B</bold> ∼ <bold>D</bold> (see
the <xref rid="abs0015" ref-type="abstract">graphical
abstract</xref>). The method computes <bold>A</bold> and
<bold>B</bold> for a number of signatures in a user-defined range
(e.g., from 2 to 10) and allows one to select the optimal number by
assessing different metrics (see below).</p>
      <p id="p0085">Specifically, we release two R scripts named respectively:
denovo.R and assignment.R.<list list-type="simple" id="olist0020"><list-item id="o0020"><label>1.</label><p id="p0090">denovo.R allows one to perform the inference of
both <bold>A</bold> and <bold>B.</bold> In
particular:<list list-type="simple" id="olist0025"><list-item id="o0025"><label>a.</label><p id="p0095"><bold>B</bold> is randomly
initialized.</p></list-item><list-item id="o0030"><label>b.</label><p id="p0100"><bold>A</bold> is inferred
given <bold>B</bold> via non-negative least
squares (NNLS).</p></list-item><list-item id="o0035"><label>c.</label><p id="p0105"><bold>B</bold> is then
inferred given <bold>A</bold> via
NNLS.</p><p id="p0110">Tasks “b” and “c” are repeated until
convergence. The whole procedure is repeated from
task “a” for a sufficient number of times (e.g., at
least 100), by testing the rank of
<bold>B</bold> (i.e., the number of
signatures) within a user specified range.</p><p id="p0115">The output of this procedure
is:</p></list-item></list></p></list-item></list></p>
      <p id="p0120"><bold>B</bold>, obtained as the consensus from all the
proposed matrices; plots regarding different metrics, so to estimate the
optimal number of signatures present in the dataset (see below).<list list-type="simple" id="olist0030"><list-item id="o0050"><label>2.</label><p id="p0130">The assignment.R script employs as input a
<bold>B</bold> matrix that could be provided by the
user or obtained with the script denovo.R. Then, it infers
<bold>A</bold> similarly as done in the task “b” of
the denovo.R script (see above).</p></list-item></list></p>
      <p id="p0135">Finally, a <italic>bootstrap</italic> procedure is
performed to assess the statistical significance of the signature
activities. To do this, we consider each sample as a categorical
distribution over the given contexts, and we extract, with resampling, from
such distributions the same number of mutations as observed in the sample.
Then, given the bootstrapped dataset, we fit again
<bold>A</bold>.</p>
      <p id="p0140">We repeat this process multiple times (e.g., 100) to obtain
a distribution for each entry of <bold>A</bold>. So, a p-value of the
significance of the activity of each signature in a given sample can be
returned.</p>
    </sec>
    <sec id="sec1.2">
      <title>Overall structure of the VirMutSig
protocol</title>
      <p id="p0145">The protocol is subdivided into 4 distinct parts:</p>
      <p id="p0150">Part 1) INSTALLATION</p>
      <p id="p0155">Part 2) DATA PREPROCESSING PIPELINE (via Nextflow)</p>
      <p id="p0160">Part 3) DE NOVO DISCOVERY OF MUTATIONAL SIGNATURES
(denovo.R)</p>
      <p id="p0165">Part 4) ASSIGNMENT OF EXISTING MUTATIONAL SIGNATURES
(assignment.R)</p>
      <p id="p0170">The protocol is publicly available at this link:
<ext-link ext-link-type="uri" xlink:href="https://github.com/BIMIB-DISCo/VirMutSig" id="intref0030">https://github.com/BIMIB-DISCo/VirMutSig</ext-link>.</p>
    </sec>
  </sec>
  <sec id="sec10">
    <title>Key resources table</title>
    <p id="p1830">
      <table-wrap position="float" id="undtbl2">
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th>Reagent or RESOURCE</th>
              <th>Source</th>
              <th>Identifier</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="3">
                <bold>Deposited data</bold>
              </td>
            </tr>
            <tr>
              <td colspan="3">
                <hr/>
              </td>
            </tr>
            <tr>
              <td>Public database analyzed [example]: RNA-seq</td>
              <td>NCBI</td>
              <td>[<italic>example</italic>] PRJNA610428
(<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/bioproject/?term=PRJNA610428" id="intref0140">https://www.ncbi.nlm.nih.gov/bioproject/?term=PRJNA610428</ext-link>)</td>
            </tr>
            <tr>
              <td>Public database analyzed [example]: Amplicon</td>
              <td>NCBI</td>
              <td>[<italic>example</italic>] PRJNA645906
(<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/bioproject/?term=PRJNA645906" id="intref0145">https://www.ncbi.nlm.nih.gov/bioproject/?term=PRJNA645906</ext-link>)</td>
            </tr>
            <tr>
              <td colspan="3">
                <hr/>
              </td>
            </tr>
            <tr>
              <td colspan="3">
                <bold>Software and algorithms</bold>
              </td>
            </tr>
            <tr>
              <td colspan="3">
                <hr/>
              </td>
            </tr>
            <tr>
              <td>VirMutSig</td>
              <td>
                <xref rid="bib11" ref-type="bibr">Graudenzi et al. (2021)</xref>
              </td>
              <td>
                <ext-link ext-link-type="uri" xlink:href="https://github.com/BIMIB-DISCo/VirMutSig" id="intref0150">https://github.com/BIMIB-DISCo/VirMutSig</ext-link>
              </td>
            </tr>
            <tr>
              <td>Unix/MacOS operating system</td>
              <td>Canonical Ltd.<break/>Apple Inc.</td>
              <td>Ubuntu 20.04 Focal macOS 10.15 Catalina</td>
            </tr>
            <tr>
              <td>Docker</td>
              <td>Merkel, (2014).</td>
              <td><ext-link ext-link-type="uri" xlink:href="https://www.docker.com/get-started" id="intref0155">https://www.docker.com/get-started</ext-link>
(v. 20)</td>
            </tr>
            <tr>
              <td>Docker Image</td>
              <td>Docker Hub</td>
              <td>dcblab/virmutsig_img:latest (<ext-link ext-link-type="uri" xlink:href="https://hub.docker.com/r/dcblab/virmutsig_img" id="intref0160">https://hub.docker.com/r/dcblab/virmutsig_img</ext-link>)</td>
            </tr>
            <tr>
              <td>Nextflow</td>
              <td>
                <xref rid="bib22" ref-type="bibr">Di
Tommaso et al. (2017)</xref>
              </td>
              <td><ext-link ext-link-type="uri" xlink:href="https://www.nextflow.io/" id="intref0165">https://www.nextflow.io/</ext-link> (v.
21)</td>
            </tr>
            <tr>
              <td>R</td>
              <td>The R Foundation</td>
              <td><ext-link ext-link-type="uri" xlink:href="https://www.r-project.org" id="intref0170">https://www.r-project.org</ext-link> (v.
4)</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </p>
  </sec>
  <sec id="sec2">
    <title>Materials and equipment</title>
    <sec id="sec2.1">
      <title>Computational
requirements</title>
      <p id="p0175">To execute the VirMutSig protocol, the user requires a
computer with the following software specifications:</p>
      <sec id="sec2.1.1">
        <title>Software</title>
        <p id="p0180">
          <list list-type="simple" id="ulist0015">
            <list-item id="u0030">
              <label>•</label>
              <p id="p0185">Unix/OS operating system (for details on the
usage of the protocol on Windows OS, please refer to the
<xref rid="sec7.9" ref-type="sec">troubleshooting problem 5</xref>).</p>
            </list-item>
            <list-item id="u0035">
              <label>•</label>
              <p id="p0190">Nextflow (version = 21) (<ext-link ext-link-type="uri" xlink:href="https://www.nextflow.io/" id="intref0035">https://www.nextflow.io/</ext-link>)</p>
            </list-item>
            <list-item id="u0040">
              <label>•</label>
              <p id="p0195">Docker (version = 20) (<ext-link ext-link-type="uri" xlink:href="https://www.docker.com/get-started" id="intref0040">https://www.docker.com/get-started</ext-link>)</p>
            </list-item>
            <list-item id="u0045">
              <label>•</label>
              <p id="p0200">R (version = 4) with the installed packages
listed below (<ext-link ext-link-type="uri" xlink:href="https://www.r-project.org" id="intref0045">https://www.r-project.org</ext-link><underline>)</underline></p>
            </list-item>
            <list-item id="u0050">
              <label>•</label>
              <p id="p0205">The Docker image of VirMutSig (<ext-link ext-link-type="uri" xlink:href="https://hub.docker.com/r/dcblab/virmutsig_img" id="intref0050">https://hub.docker.com/r/dcblab/virmutsig_img</ext-link>)</p>
            </list-item>
            <list-item id="u0055">
              <label>•</label>
              <p id="p0210">A working internet connection
(<italic>for installation
only</italic>).</p>
            </list-item>
          </list>
        </p>
        <p id="p0215">All the other required tools and libraries will already
be installed in the provided Docker image.<table-wrap position="float" id="undtbl1"><table frame="hsides" rules="groups"><thead><tr><th colspan="3">Software and R packages<hr/></th></tr><tr><th>Part</th><th>Package</th><th>Version</th></tr></thead><tbody><tr><td rowspan="3">1–2)
INSTALLATION and DATA PREPROCESSING
PIPELINE</td><td>Nextflow (<xref rid="bib22" ref-type="bibr">Di Tommaso et al.,
2017</xref>)</td><td>version = 21</td></tr><tr><td>Docker (<xref rid="bib17" ref-type="bibr">Merkel
2014</xref>)<break/>Docker image:
dcblab/virmutsig_img</td><td>version = 20.10.8<break/>version =
latest</td></tr><tr><td>R</td><td>version = 4.0.1</td></tr><tr><td rowspan="9">3) DE NOVO
DISCOVERY OF MUTATIONAL SIGNATURES
(denovo.R)</td><td>BiocManager (<xref rid="bib18" ref-type="bibr">Morgan
2021</xref>)<break/>Biobase (<xref rid="bib12" ref-type="bibr">Huber et al.,
2015</xref>)</td><td>version = 1.30.16<break/>version =
2.46</td></tr><tr><td>data.table (<xref rid="bib7" ref-type="bibr">Dowle and Srinivasan,
2021</xref>)</td><td>version = 1.14.0</td></tr><tr><td>ggplot2 (<xref rid="bib24" ref-type="bibr">Wickham
2016</xref>)</td><td>version = 3.3.5</td></tr><tr><td>gridExtra (<xref rid="bib3" ref-type="bibr">Auguie
2017</xref>)</td><td>version = 2.3</td></tr><tr><td>NMF (<xref rid="bib10" ref-type="bibr">Gaujoux and Seoighe,
2020</xref>)</td><td>version = 0.23.0</td></tr><tr><td>nnls (<xref rid="bib19" ref-type="bibr">Mullen and van Stokkum,
2012</xref>)</td><td>version = 1.4</td></tr><tr><td>Optparse (<xref rid="bib23" ref-type="bibr">Davis, 2020</xref>)</td><td>version = 1.6.6</td></tr><tr><td>Stringi (<xref rid="bib9" ref-type="bibr">Gagolewski
2021</xref>)</td><td>version = 1.7.4</td></tr><tr><td>Yaml (<xref rid="bib21" ref-type="bibr">Stephens,
2020</xref>)</td><td>version = 2.2.1</td></tr><tr><td rowspan="4">4) ASSIGNMENT OF
EXISTING MUTATIONAL SIGNATURES
(assignment.R)</td><td colspan="2">All the above denovo packages</td></tr><tr><td>Glmnet (<xref rid="bib14" ref-type="bibr">Friedman et al.,
2010</xref>)</td><td>version = 4.1–2</td></tr><tr><td>Lsa (<xref rid="bib8" ref-type="bibr">Wild, 2020</xref>)</td><td>version = 0.73.2</td></tr><tr><td>Matrix (<xref rid="bib6" ref-type="bibr">Bates and Maechler,
2021</xref>)</td><td>version = 1.3.4</td></tr></tbody></table></table-wrap></p>
      </sec>
      <sec id="sec2.1.2">
        <title>Hardware</title>
        <p id="p0220">
          <list list-type="simple" id="ulist0020">
            <list-item id="u0060">
              <label>•</label>
              <p id="p0225">Parts 1–2</p>
            </list-item>
          </list>
        </p>
        <p id="p0230">The resources required for processing a single sample
are limited, but we suggest running Part 2 in parallel, if possible.
Memory: 8Gb required, processors: 1 required, 8 recommended.<list list-type="simple" id="ulist0025"><list-item id="u0065"><label>•</label><p id="p0235">Parts 3–4</p></list-item></list></p>
        <p id="p0240">Memory: 4GB required, processors: 1 required, 4
recommended.</p>
      </sec>
    </sec>
    <sec id="sec2.2">
      <title>Input data</title>
      <p id="p0245">The VirMutSig protocol requires as input either:
(<italic>i</italic>) RNA-seq, or (<italic>ii</italic>)
Amplicon Illumina raw data, generated from sequencing experiments of viral
samples (obtained, e.g., from primary isolates), and typically available as
FASTQ files.</p>
      <p id="p0250">Generally, one will have a FASTQ file for each sample of the
dataset.</p>
      <p id="p0255">Notice that the protocol works with both
(<italic>i</italic>) single- and (<italic>ii</italic>)
paired-end sequencing library preparation layout.</p>
      <sec id="sec2.2.1">
        <title>FASTQ files</title>
        <p id="p0260">FASTQ files can be collected in different
ways.</p>
        <p id="p0265">If one is interested in the analysis of public datasets,
e.g., those available on NCBI SRA database (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/sra" id="intref0055">https://www.ncbi.nlm.nih.gov/sra</ext-link>), one can create a
file with a list of SRR accession number (one per line) to use as input
data.</p>
        <p id="p0270">The VirMutSig will automatically download the proper
FASTQ files; see <xref rid="sec3.2" ref-type="sec">Part
2</xref>.</p>
        <p id="p0275">Instead, if one has produced her/his own FASTQ files, or
if they are available in other databases, one must aggregate them in one
directory and specify its path as input; see <xref rid="sec3.2" ref-type="sec">Part 2</xref>.</p>
      </sec>
      <sec id="sec2.2.2">
        <title>Reference genome file</title>
        <p id="p0280">A reference genome is required to perform variant
calling. In (<xref rid="bib20" ref-type="bibr">Ramazzotti
et al., 2021</xref>) we proposed the SARS-CoV-2-ANC as
reference genome. Such genome is already available in the VirMutSig
GitHub repository and is used as default.</p>
        <p id="p0285">However, any viral genome can be used as reference. To
do so, the chosen genome must be provided as a FASTA file; see
<xref rid="sec3.2" ref-type="sec">Part
2</xref>.</p>
      </sec>
    </sec>
  </sec>
  <sec id="sec3">
    <title>Step-by-step method details</title>
    <sec id="sec3.1">
      <title>Part 1. Installation</title>
      <p id="p0290">
        <disp-quote>
          <p>
            <inline-graphic xlink:href="fx2.gif"/>
            <bold>Timing:
15 min</bold>
          </p>
        </disp-quote>
        <list list-type="simple" id="olist0035">
          <list-item id="o0055">
            <label>1.</label>
            <p id="p0295">Downloading VirMutSig</p>
            <p id="p0300">The installation of VirMutSig is done by
downloading the GitHub repository in a local directory, which
includes the VirMutSig scripts and the example files.</p>
            <p id="p0305">After the installation, a new folder named
VirMutSig will be generated.</p>
            <p id="p0310">Please install VirMutSig by moving to your local
directory and using GitHub with the following command in the terminal:<boxed-text id="dtbox1"><p id="p0315">&gt;git clone
https://github.com/BIMIB-DISCo/VirMutSig.git</p></boxed-text></p>
            <p id="p0320">VirMutSig includes 4 directories with the
following names:<list list-type="simple" id="olist0040"><list-item id="o0060"><label>a.</label><p id="p0325">“preprocessing”</p><p id="p0330">This directory contains all the
files and directories required to perform Part 2,
such as:<list list-type="simple" id="olist0045"><list-item id="o0065"><label>i.</label><p id="p0335">SRR_to_SNVlist.nf: the
Nextflow pipeline file</p></list-item><list-item id="o0070"><label>ii.</label><p id="p0340">nextflow.config: the config
file with the preprocessing settings and
parameters</p></list-item><list-item id="o0075"><label>iii.</label><p id="p0345">reference: a directory with
the SARS-CoV-2-ANC reference file</p></list-item><list-item id="o0080"><label>iv.</label><p id="p0350">bin: a directory with an R
script used to create the SNVs list for Parts
3–4.</p></list-item></list></p></list-item><list-item id="o0085"><label>b.</label><p id="p0355">“denovo”</p><p id="p0360">This directory contains the
corresponding R script to perform the <italic>de
novo</italic> discovery of mutational
signatures (Part 3). The files included are:
<list list-type="simple" id="olist0050"><list-item id="o0090"><label>i.</label><p id="p0365">denovo.R</p><p id="p0370">This script performs the
discovery of viral mutational signatures from the
list of selected SNVs taken as input, by employing
a NMF approach described in the above section or
in (<xref rid="bib16" ref-type="bibr">Lal et al., 2021</xref>). The user must
also specify the number of contexts, i.e., the
flanking bases to the genome positions. They may
either be 6 or 96, please refer to (<xref rid="bib16" ref-type="bibr">Lal et al.,
2021</xref>) for further
details.</p></list-item><list-item id="o0095"><label>ii.</label><p id="p0375">denovo_config.yaml</p><p id="p0380">This file contains the
parameters explained above. It could be modified
using any text editor.</p></list-item><list-item id="o0100"><label>iii.</label><p id="p0385">denovo_utils.R</p><p id="p0390">This R file contains some
functions used by the main denovo.R
scripts.<disp-quote><p><bold><italic>Note:</italic></bold>
please do not modify this file.</p></disp-quote></p></list-item></list></p></list-item><list-item id="o0105"><label>c.</label><p id="p0395">“assignment”</p><p id="p0400">This directory contains the
corresponding R script to perform the
<italic>assignment</italic> of the activity
of mutational signatures to each sample (Part 4).
The files included are: <list list-type="simple" id="olist0055"><list-item id="o0110"><label>i.</label><p id="p0405">assignment.R</p><p id="p0410">This script takes as input the
signatures.txt file generated by the denovo.R
script or provided by the user, and the list of
SNVs to perform the assignment of the signatures
to each sample. Bootstrap can be employed to
assess the statistical confidence of the signature
assignments.</p></list-item><list-item id="o0115"><label>ii.</label><p id="p0415">assignment_config.yaml</p><p id="p0420">This file contains the
parameters explained above. It could be modified
using any text editor.</p></list-item><list-item id="o0120"><label>iii.</label><p id="p0425">assignment_utils.R</p><p id="p0430">This R file contains some
functions used by the main assignment.R
scripts.<disp-quote><p><bold><italic>Note:</italic></bold>
please do not modify this file.</p></disp-quote></p></list-item></list></p></list-item><list-item id="o0125"><label>d.</label><p id="p0435">“example”</p><p id="p0440">This directory includes an example
of the VirMutSig analysis performed on 150 FASTQ
files obtained from samples of SARS-CoV-2 via RNA
sequencing experiments.</p></list-item></list></p>
          </list-item>
        </list>
        <list list-type="simple" id="olist0060">
          <list-item id="o0130">
            <label>2.</label>
            <p id="p0445">Download docker image</p>
          </list-item>
        </list>
      </p>
      <p id="p0450">The preprocessing pipeline executes all the steps using a
Docker image in which all the requested software is already installed to
avoid compatibility issues.</p>
      <p id="p0455">Docker can be obtained following the instruction at this
link: (<ext-link ext-link-type="uri" xlink:href="https://www.docker.com/get-started" id="intref0060">https://www.docker.com/get-started</ext-link>).</p>
      <p id="p0460">Once the installation is completed, please get the protocol
image called ‘dcblab/virmutsig_img’ by digiting the following command in a terminal:<boxed-text id="dtbox2"><p id="p0465">&gt;docker pull
dcblab/virmutsig_img:latest</p></boxed-text><list list-type="simple" id="olist0065"><list-item id="o0135"><label>3.</label><p id="p0470">Verify docker image installation</p></list-item></list></p>
      <p id="p0475">To test if the image is correctly installed in your system,
please execute the following code:<boxed-text id="dtbox3"><p id="p0480">&gt;docker image
ls</p></boxed-text></p>
      <p id="p0485">which should display the following lines:<boxed-text id="dtbox4"><p id="p0490">REPOSITORY  TAG IMAGE ID CREATED SIZE</p><p id="p0495">dcblab/virmutsig_img latest 223f27c12b45 4 hours ago 1.56GB</p></boxed-text><disp-quote><p><bold><italic>Note:</italic></bold> in this case,
it is possible to proceed to the next steps.</p></disp-quote></p>
    </sec>
    <sec id="sec3.2">
      <title>Part 2. Data preprocessing
pipeline</title>
      <p id="p0500">
        <disp-quote>
          <p>
            <inline-graphic xlink:href="fx2.gif"/>
            <bold>Timing: 10 min download + 70 min
pipeline execution for each sample (can be
parallelized)</bold>
          </p>
        </disp-quote>
      </p>
      <p id="p0505">The data preprocessing pipeline included in the VirMutSig
protocol is provided as a Nextflow pipeline file, named “SRR_to_SNVlist.nf”
and included in the “preprocessing” folder of the GitHub repository:
<ext-link ext-link-type="uri" xlink:href="https://github.com/BIMIB-DISCo/VirMutSig" id="intref0065">https://github.com/BIMIB-DISCo/VirMutSig</ext-link>.</p>
      <p id="p0510">The folder also includes a file named: “nextflow.config”,
which must be opportunely modified according to the specific experimental
settings (see below for the parameter description).</p>
      <p id="p0515">The preprocessing pipeline includes the following processes
(detailed in the following): data acquisition, trimming, alignment, remove
duplicated reads (optional), get depth information, variant calling, and
variant filtering.</p>
      <p id="p0555">As output, the preprocessing pipeline returns a file named:
“SNV_list.txt” in which:</p>
      <p id="p0560">rows correspond to all the single nucleotide variants (SNVs)
detected in all the samples of the dataset</p>
      <p id="p0565">columns correspond to: sample ID, variant ID, genome
position, reference allele, alternative allele, reference three nucleotides
(flanking bases), supporting reads, coverage, variant frequency (VF), and
p-value (returned by the variant caller).</p>
      <p id="p0620">To run the preprocessing processes of the protocol, simply
move to the “preprocessing” folder and execute the following command from
the terminal:<boxed-text id="dtbox5"><p id="p0625">&gt;nextflow run
SRR_to_SNVlist.nf</p></boxed-text></p>
      <p id="p0630">In the following, we describe the preprocessing processes
and the related settings in detail.<list list-type="simple" id="olist0070"><list-item id="o0140"><label>4.</label><p id="p0635">Data acquisition</p><p id="p0640">From now on, we will consider 'preprocessing' as
a working directory from the one specified during the
installation:
‘user_local_directory/VirMutSig/preprocessing'</p><p id="p0645">Input data can be either
(<italic>i</italic>) downloaded from public
repositories, or (<italic>ii</italic>) provided from local
folders, if available.<list list-type="simple" id="olist0075"><list-item id="o0145"><label>a.</label><p id="p0650">Input data acquisition from public
repositories</p><p id="p0655">Input data can be downloaded from
public repositories such as, e.g., the NCBI Sequence
Read Archive (SRA) (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/sra" id="intref0070">https://www.ncbi.nlm.nih.gov/sra</ext-link>).
In this case, one can use the SRA Run Selector web
interface (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/Traces/study/" id="intref0075">https://www.ncbi.nlm.nih.gov/Traces/study/</ext-link>)
to search for a dataset and download the “Accession
List” by using the related button. The obtained list
of SRR IDs (one per line) can be passed as input to
download the files via SRA-toolkit, by editing the
following parameter of the “nextflow.config”:<boxed-text id="dtbox6"><p id="p0660">params.FASTQ_input =
'../example/SRAlist_paired.txt'</p></boxed-text></p><p id="p0665">Also in this case, the library
preparation layout (single-end or paired-end) must
be specified by editing the following parameter in
“nextflow.config” file:<boxed-text id="dtbox7"><p id="p0670">params.library_preparation =
‘paired’ // or ‘single’</p></boxed-text></p><p id="p0675">By default, the downloaded FASTQ
files will be stored in the following path:
'/intermediate/FASTQ' (relative to SRR_to_SNVlist.nf
file). It possible to change the directory by
editing the following parameter in in
“nextflow.config” file:<boxed-text id="dtbox8"><p id="p0680">params.FASTQdir =
'intermediate/FASTQ'</p></boxed-text></p></list-item><list-item id="o0150"><label>b.</label><p id="p0700">Input data from local
folders</p></list-item></list></p></list-item></list></p>
      <p id="p0705">In this case, the user must indicate the directory where the
FASTQ files are located, editing the following parameter of the “nextflow.config”:<boxed-text id="dtbox12"><p id="p0710">params.FASTQ_input =
'/Path/To/Directory/'</p></boxed-text></p>
      <p id="p0715">The library preparation layout (single-end or paired-end)
must be specified by editing the following parameter in “nextflow.config” file:<boxed-text id="dtbox13"><p id="p0720">params.library_preparation = ‘paired’
//or ‘single’</p></boxed-text></p>
      <p id="p0725">Notice that with the “paired” configuration two FASTQ files
are expected for each sample, formatted as (sampleID_1.fastq.gz and
sampleID_2.fastq.gz).</p>
      <p id="p0730">Conversely, with the “single” configuration one
sampleID.fastq.gz file is expected for each sample.<list list-type="simple" id="olist0080"><list-item id="o0155"><label>5.</label><p id="p0735">Trimming</p></list-item></list></p>
      <p id="p0740">This step aims at removing from the sequence the nucleotides
with low sequencing quality. To perform this step, the Nextflow pipeline
exploits the tool Trimmomatic (<ext-link ext-link-type="uri" xlink:href="http://www.usadellab.org/cms/?page=trimmomatic" id="intref0080">http://www.usadellab.org/cms/?page=trimmomatic</ext-link>).</p>
      <p id="p0745">To tune the additional parameters used by Trimmomatic please
edit the following parameter in “nextflow.config” file:<boxed-text id="dtbox14"><p id="p0750"> params.trimmomatic_setting = 'LEADING:20
TRAILING:20</p><p id="p0755">SLIDINGWINDOW:4:20
MINLEN:40'</p></boxed-text></p>
      <p id="p0760">In brief, LEADING and TRAILING parameters cut the bases that
display a quality below a certain threshold, respectively at the start and
the end of a read (20).</p>
      <p id="p0765">The SLIDINGWINDOW parameter sets the size of a sliding
window (4 in our example) and deletes all the bases from the leftmost
position of the window to the end of the read, when the average quality
detected in the window drops below a given threshold (e.g., 20).</p>
      <p id="p0770">Finally, the MINLEN parameter specifies the minimum length
of a read to be kept (40 bases in our example). Please, refer to the
Trimmomatic documentation for more details.<list list-type="simple" id="olist0085"><list-item id="o0160"><label>6.</label><p id="p0775">Alignment</p><p id="p0780">Reads need to be aligned to a reference genome,
which can be selected by the user, e.g.,<list list-type="simple" id="olist0090"><list-item id="o0165"><label>a.</label><p id="p0785">SARS-CoV-2-ANC (<xref rid="bib20" ref-type="bibr">Ramazzotti et al.,
2021</xref>),</p></list-item><list-item id="o0170"><label>b.</label><p id="p0790">EPI_ISL_405839 / GeneBank ID:
MN975262.1 (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/nuccore/MN975262.1" id="intref0085">https://www.ncbi.nlm.nih.gov/nuccore/MN975262.1</ext-link>)
(<xref rid="bib4" ref-type="bibr">Bastola et al., 2020</xref>),</p></list-item><list-item id="o0175"><label>c.</label><p id="p0795">EPI_ISL_402125 / NCBI ID:
NC_045512.2 (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/nuccore/1798174254" id="intref0090">https://www.ncbi.nlm.nih.gov/nuccore/1798174254</ext-link>)
(<xref rid="bib2" ref-type="bibr">Andersen et al., 2020</xref>).</p></list-item></list></p></list-item></list></p>
      <p id="p0800">In the subfolder “preprocessing/reference” of the GitHub
repository, we provide the SARS-CoV-2-ANC genome in FASTA format.</p>
      <p id="p0805">The user can specify the reference genome file by editing
following parameter in “nextflow.config” file:<boxed-text id="dtbox15"><p id="p0810">params.fasta =
'reference/SARS-CoV-2-ANC.fasta'</p></boxed-text></p>
      <p id="p0815">The alignment is performed with BWA-MEM (<ext-link ext-link-type="uri" xlink:href="https://github.com/lh3/bwa" id="intref0095">https://github.com/lh3/bwa</ext-link>), which generates a SAM file
including the aligned reads. All the associated files used by the BWA
aligner will be automatically generated and placed in the same reference
genome folder.</p>
      <p id="p0820">Each SAM file will be sorted and compressed into a BAM file
with Samtools (<ext-link ext-link-type="uri" xlink:href="http://www.htslib.org/" id="intref0100">http://www.htslib.org/</ext-link>).</p>
      <p id="p0825">By default, the BAM files will be stored in the following
path: '/intermediate/BAM' (relative to SRR_to_SNVlist.nf file). It is
possible to change the directory by editing the following parameter in in
“nextflow.config” file:<boxed-text id="dtbox16"><p id="p0830">params.BAMdir =
'intermediate/BAM'</p></boxed-text><list list-type="simple" id="olist0095"><list-item id="o0180"><label>7.</label><p id="p0835">Remove duplicated reads (optional)</p></list-item></list></p>
      <p id="p0840">Often, after obtaining an aligned BAM file, is useful to
mark and remove duplicated reads to reduce the impact of the amplification
bias, especially with RNA-seq experiments. Otherwise, when dealing with
Amplicon data, several duplicated reads are expected and should not be
removed. For this reason, we made this step optional.</p>
      <p id="p0845">To include or skip this step in the preprocessing pipeline,
please set accordingly the following parameter in “nextflow.config” file:<boxed-text id="dtbox17"><p id="p0850">params.remove_duplicates =
“true” // or “false”</p></boxed-text><disp-quote><p><bold><italic>Note:</italic></bold> the tool used
to perform this task is Picard (<ext-link ext-link-type="uri" xlink:href="https://broadinstitute.github.io/picard/" id="intref0105">https://broadinstitute.github.io/picard/</ext-link>).</p></disp-quote><list list-type="simple" id="olist0100"><list-item id="o0185"><label>8.</label><p id="p0855">Get depth information</p></list-item></list></p>
      <p id="p0860">The aim of this step is to obtain the depth information for
each sample in every genome position (i.e., number of reads mapped on each
position of the viral genome).</p>
      <p id="p0865">To perform this task, we used Samtools.</p>
      <p id="p0870">By default, the coverage files will be stored in the
following path: '/intermediate/COVERAGE’ (relative to SRR_to_SNVlist.nf
file). It is possible to change the directory by editing the following
parameter in in “nextflow.config” file:<boxed-text id="dtbox18"><p id="p0875">params.COVERAGEdir =
'intermediate/COVERAGE'</p></boxed-text><list list-type="simple" id="olist0105"><list-item id="o0190"><label>9.</label><p id="p0880">Variant calling</p></list-item></list></p>
      <p id="p0885">Variants can be called comparing the aligned reads with the
reference genome. To do so, we used Samtools (<ext-link ext-link-type="uri" xlink:href="http://www.htslib.org/" id="intref0110">http://www.htslib.org/</ext-link>) and VarScan (<ext-link ext-link-type="uri" xlink:href="http://varscan.sourceforge.net/" id="intref0115">http://varscan.sourceforge.net/</ext-link>). More in detail, we
used the mpileup command included in Samtools which converts the BAM file
into the pileup format required by VarScan.</p>
      <p id="p0890">Then we used the VarScan pileup2snp for variant calling to
produce a VCF file for each BAM file. The VarScan setting can be adjusted by
editing the following parameter included in “nextflow.config” file.<boxed-text id="dtbox19"><p id="p0895">params.varscan =
'--min-var-freq 0.01 --p-value
1'</p></boxed-text><disp-quote><p><bold><italic>Note:</italic></bold> For more
information, please refer to the VarScan
documentation.</p></disp-quote></p>
      <p id="p0900">By default, the VCF files will be stored in the following
path: '/intermediate/VCF’ (relative to SRR_to_SNVlist.nf file). It is
possible to change the directory by editing the following parameter in in
“nextflow.config” file:<boxed-text id="dtbox20"><p id="p0905">params.VCFdir =
'intermediate/VCF'</p></boxed-text><disp-quote><p><bold><italic>Note:</italic></bold> We suggest
performing the alignment step according to the manufacturer’s
recommendations for all sequencing technologies.</p></disp-quote><disp-quote><p><inline-graphic xlink:href="fx3.gif"/><bold>CRITICAL:</bold> All the above steps
can be performed also by applying different pipelines for variant
calling, such as the one proposed in [<ext-link ext-link-type="uri" xlink:href="https://github.com/andersen-lab/ivar" id="intref0120">https://github.com/andersen-lab/ivar</ext-link>], which was
specifically designed for handling viral amplicon data obtained via
the <italic>artic protocol</italic>.</p></disp-quote><list list-type="simple" id="olist0110"><list-item id="o0195"><label>10.</label><p id="p0910">Variant filtering<list list-type="simple" id="olist0115"><list-item id="o0200"><label>a.</label><p id="p0915">In order to reduce the impact of
noise in the data (due, e.g., to sequencing issues),
we adopted multiple quality control (QC) filters to
select only the reliable SNVs. The last step of the
preprocessing pipeline applies different filtering
criteria on the detected SNVs. The following
parameters determine the filtering threshold, and
they can be set by changing the corresponding
numeric value included into a string assigned to
VirMutSig_QCfilter parameter present in the
“nextflow.config” file.<boxed-text id="dtbox21"><p id="p0920">params.SNV_filters = 'PV_THR:0.01
VAR_FREQ_THR:0.05 MIN_COV:20
ALT_READ_THR:3'</p></boxed-text><list list-type="simple" id="olist0120"><list-item id="o0205"><label>i.</label><p id="p0930">p-value on variant calling
significance (PV_THR). The filter removes all the
variants called with a significance p-value larger
than a given threshold (default = 0.01).</p></list-item><list-item id="o0210"><label>ii.</label><p id="p0935">Frequency threshold
(VAR_FREQ_THR)<italic>.</italic> The filter
keeps only variants observed in the data with a
variant frequency that exceed the specified
threshold (default = 0.05).</p></list-item><list-item id="o0215"><label>iii.</label><p id="p0940">Minimum coverage (MIN_COV).
The filter keeps only variants with the specified
minimum coverage (default = 20).</p></list-item><list-item id="o0220"><label>iv.</label><p id="p0945">Minimum alternative read count
(ALT_READ_THR)<italic>.</italic> The filter
keeps only variants with a minimum number of reads
showing the alternative allele equal to the given
threshold. (default = 3)<disp-quote><p><bold><italic>Note:</italic></bold>
Indels are not considered in the
analysis.</p></disp-quote></p></list-item></list></p></list-item><list-item id="o0225"><label>b.</label><p id="p0960">By default, the SNV_list.txt file
will be stored in the 'example’ directory. It is
possible to change the directory by editing the
following parameter in in “nextflow.config” file:<boxed-text id="dtbox23"><p id="p0965">params.SNVlistdir =
'../example</p></boxed-text></p><p id="p0970">This step uses a R script included
in the “preprocessing/bin” directory of the GitHub
repository named <ext-link ext-link-type="uri" xlink:href="https://github.com/BIMIB-DISCo/VirMutSig/blob/main/preprocessing/bin/makeVirMutSigInput.R" id="intref0125">makeSNVlist.R</ext-link>. It
takes as input different arguments with the
following fixed order: <list list-type="simple" id="olist0125"><list-item id="o0230"><label>i.</label><p id="p0975">A string with the path of the
directory containing the VCF files generated by
the variant caller.</p></list-item><list-item id="o0235"><label>ii.</label><p id="p0980">A string with the path of the
directory containing the depth files generated by
step 8. Such files must end with
'.depth.txt'.</p></list-item><list-item id="o0240"><label>iii.</label><p id="p0985">Reference file in fasta
format. (e.g.,
SARS-CoV-2-ANC.fasta)<disp-quote><p><bold><italic>Note:</italic></bold>
If another pipeline has been used to perform
variant calling, the R script can be used to
aggregate the vcf files into a SNV list. Instead,
if VirMutSig preprocessing steps have been used,
the script is automatically executed via
Nextflow.</p></disp-quote></p></list-item></list></p></list-item></list></p></list-item></list><disp-quote><p><inline-graphic xlink:href="fx3.gif"/><bold>CRITICAL:</bold> Parameters must be
set according to the specific features of the datasets (see, e.g.,
the guidelines proposed on the website: <ext-link ext-link-type="uri" xlink:href="https://virological.org/" id="intref0130">https://virological.org/</ext-link>).</p></disp-quote><list list-type="simple" id="olist0130"><list-item id="o0245"><label>11.</label><p id="p0995">Further information</p></list-item></list></p>
      <p id="p1000">The Trimming and Alignment step require greater
computational resources than the other processes. For this reason, it is
possible to specify the maximum number of cores to be used, by changing the
cpus value in the following setting of the “nextflow.config” file:<boxed-text id="dtbox25"><p id="p1005">process
{</p><p id="p1010"> withName:
'Trimming_single' {cpus =
4}</p><p id="p1015"> withName:
'Trimming_paired' {cpus =
4}</p><p id="p1020"> withName:
'Alignment_and_sorting_single' {cpus =
8}</p><p id="p1025"> withName:
'Alignment_and_sorting_paired' {cpus =
8}</p><p id="p1030"> }</p></boxed-text></p>
      <p id="p1035">An increase of the cpus number assigned to the processes
reduces the computational time required to trim and align the reads, but it
also reduces the number of samples that can be analyzed in parallel. For
these reasons, one should select a proper value based on the available
computational resources and number of samples.</p>
      <p id="p1040">All parameters (“params.”) can be specified by overriding
when the pipeline is launched. To do so, please specify the corresponding
parameter name (the string following “params.”) and specify the opportune
argument of the Nextflow command.</p>
      <p id="p1045">In the example, the SRR list file path and the output
directory path of the SNVs list file will be specified without editing the
“nextflow.config” file.<boxed-text id="dtbox26"><p id="p1050">&gt;nextflow run
SRR_to_SNVlist.nf \</p><p id="p1055">--FASTQ_input
‘SRRfile/custom/path’ \</p><p id="p1060">--SNVlistdir
‘SNVlist/output/path’</p></boxed-text></p>
      <p id="p1065">For a summary of the settings and processes executed with
the example configuration please see <xref rid="fig1" ref-type="fig">Figure 1</xref>.<fig id="fig1"><label>Figure 1</label><caption><p>Summary of the settings and processes executed with
the example configuration</p><p>We analyzed 150 samples with a paired-end library
layout, downloaded from the SRA database. The related processes are
automatically executed via Nextflow.</p></caption><graphic xlink:href="gr1"/></fig></p>
    </sec>
    <sec id="sec3.3">
      <title>Part 3. <italic>De novo</italic>
discovery of mutational signatures (denovo.R)</title>
      <p id="p1070">
        <disp-quote>
          <p>
            <inline-graphic xlink:href="fx2.gif"/>
            <bold>Timing: ∼20 min (approximate time
required to perform the step on a dataset with ∼100 samples and
∼10,000 mutations, with a significant variability related to the
signature rank range)</bold>
          </p>
        </disp-quote>
        <list list-type="simple" id="olist0135">
          <list-item id="o0250">
            <label>12.</label>
            <p id="p1075">Input files and setup</p>
            <p id="p1080">The denovo.R script requires two input files to
be executed.<list list-type="simple" id="olist0140"><list-item id="o0255"><label>a.</label><p id="p1085">List of selected SNVs
[SNV_list.txt]</p><p id="p1090">This file is generated following the
preprocessing step. It is a semicolon-separated file
with a SNV for each line. It includes (at least) the
following column headers: <list list-type="simple" id="olist0145"><list-item id="o0260"><label>i.</label><p id="p1095">SampleId: The ID of the
sample.</p></list-item><list-item id="o0265"><label>ii.</label><p id="p1100">Position: The genome
position.</p></list-item><list-item id="o0270"><label>iii.</label><p id="p1105">Reference: the reference
allele (A, T, C, G).</p></list-item><list-item id="o0275"><label>iv.</label><p id="p1110">Alternative: the alternative
allele (A, T, C, G).</p></list-item><list-item id="o0280"><label>v.</label><p id="p1115">VariantCount: the number of
the reads including the alternative
allele.</p></list-item><list-item id="o0285"><label>vi.</label><p id="p1120">TotalCount: the total number
of reads covering the genome position.</p><p id="p1125">For the 96-contexts analysis
(see below) the following column is also
required:</p></list-item><list-item id="o0290"><label>vii.</label><p id="p1130">ReferenceTrinucleotide: the
triplet with the reference bases before and after
the variant position (e.g., ATC where T is the
reference).</p><p id="p1135">Please see the file
SNV_list.txt contained in the “/example” directory
for an example of input formatting (see
<xref rid="tbl1" ref-type="table">Table
1</xref>).<table-wrap position="float" id="tbl1"><label>Table 1</label><caption><p>First 5 lines of the SNV_list.txt file imported in
Rstudio</p></caption><table frame="hsides" rules="groups"><thead><tr><th>SampleID</th><th>VariantID</th><th>Position</th><th>Reference</th><th>Alternative</th><th>Reference Trinucleotide</th><th>VariantCount</th><th>TotalCount</th><th>Variant frequency</th><th>Pvalue</th></tr></thead><tbody><tr><td>SRR12661198</td><td>9996_C_T</td><td>9996</td><td>C</td><td>T</td><td>TCA</td><td>494</td><td>5720</td><td>0.0864</td><td>2.85E-144</td></tr><tr><td>SRR12661096</td><td>9965_C_T</td><td>9965</td><td>C</td><td>T</td><td>TCT</td><td>68</td><td>1263</td><td>0.0538</td><td>4.82E-20</td></tr><tr><td>SRR12833654</td><td>9960_G_T</td><td>9960</td><td>G</td><td>T</td><td>TGT</td><td>49</td><td>641</td><td>0.0764</td><td>6.85E-16</td></tr><tr><td>SRR12661080</td><td>995_C_T</td><td>995</td><td>C</td><td>T</td><td>ACG</td><td>165</td><td>2618</td><td>0.063</td><td>5.54E-48</td></tr><tr><td>SRR12661132</td><td>9945_G_T</td><td>9945</td><td>G</td><td>T</td><td>AGA</td><td>41</td><td>389</td><td>0.1054</td><td>1.50E-13</td></tr></tbody></table></table-wrap></p></list-item></list></p></list-item><list-item id="o0295"><label>b.</label><p id="p1140">Configuration file
[denovo_config.yaml]</p><p id="p1145">The parameters to run denovo.R are
set in a text file called as default
‘denovo_config.yaml’. The file must contain a
parameter in each line formatted as:<boxed-text id="dtbox27"><p id="p1150">PARAMETER NAMES:
value</p></boxed-text></p><p id="p1155">The parameters that can be modified
are the following:</p><p id="p1160">[variant selection]<list list-type="simple" id="olist0150"><list-item id="o0300"><label>i.</label><p id="p1165">CLONAL_SNV_THR: Double [0,1].
default = 0.9.</p><p id="p1170">This parameter defines the
variant frequency threshold that determines
whether a given variant is clonal.</p></list-item><list-item id="o0305"><label>ii.</label><p id="p1175">MINOR_SNV_SEL: String
{‘always’, ‘all’}. default = ‘always’.</p><p id="p1180">To reduce the bias induced by
mutations transmitted and inherited in the
population during the epidemic spread, for the
signature analysis we select and employ only the
SNVs that are never observed with a frequency
higher than <italic>CLONAL_SNV_THR</italic>
in any sample. The selected SNVs are defined as
‘<italic>always minor’</italic>. This
parameter together with the parameter
CLONAL_SNV_THR are critical as they determine the
variants that are selected for the signatures
analysis; the default parameters that we suggest
here (i.e., CLONAL_SNV_THR = 0.90 and
MINOR_SNV_SEL ="always") are very conservative and
they should be determined based on the aim of the
study. For further details, please refer to
(<xref rid="bib20" ref-type="bibr">Ramazzotti et al.,
2021</xref>).</p></list-item><list-item id="o0310"><label>iii.</label><p id="p1185">MAX_SNV_SAMPLE: Integer [1,
Inf]. default = 100.</p><p id="p1190">In order to reduce the impact
of highly mutated samples, likely due to
degradation of their biological isolation, we
suggest removing the samples exhibiting more than
a user selected number of variants.</p></list-item><list-item id="o0315"><label>iv.</label><p id="p1195">MIN_SNV_SAMPLE: Integer [1,
Inf]. default = 6.</p><p id="p1200">To assess the existence of
statistically significant mutational signatures,
we remove all the samples with number of detected
SNVs lower than this value.</p><p id="p1205">[analysis
parameters]</p></list-item><list-item id="o0320"><label>v.</label><p id="p1210">NUM_CONTEXTS: Integer {6, 96}.
default = 6.</p><p id="p1215">This parameter specifies the
number of different nucleotide substitution types
(based on the flanking bases) that are
considered.</p><p id="p1220">6 indicates that no flanking
bases are considered. In this case, the possible
substitution types are: C&gt;A (or G&gt;T), C&gt;G
(or G&gt;C), C&gt;T (or G&gt;A), T&gt;A (or
A&gt;T), T&gt;C (or A&gt;G), T&gt;G (or
A&gt;C).</p><p id="p1225">96 indicates that the two
flanking bases are considered. In this case, the
possible substitution types include, e.g.,:
A<bold>C</bold>A&gt;A<bold>A</bold>A
(or
A<bold>G</bold>A&gt;A<bold>T</bold>A),
A<bold>C</bold>G&gt;A<bold>A</bold>G
(or
A<bold>G</bold>G&gt;A<bold>T</bold>G),
A<bold>T</bold>A&gt;A<bold>C</bold>A
(or
A<bold>A</bold>A&gt;A<bold>G</bold>A),
etc. For further details, please refer to
(<xref rid="bib16" ref-type="bibr">Lal
et al., 2021</xref>).</p></list-item><list-item id="o0325"><label>vi.</label><p id="p1230">MIN_NUM_SIG: Integer [1,
<italic>NUM_CONTEXTS</italic>]. default =
1.</p><p id="p1235">This parameter sets the lower
bound of the range for the number of distinct
signatures to be searched.</p></list-item><list-item id="o0330"><label>vii.</label><p id="p1240">MAX_NUM_SIG: Integer
[<italic>MIN_NUM_SIG</italic>,
<italic>NUM_CONTEXTS</italic>]. default =
6</p><p id="p1245">This parameter sets the upper
bound of the range for the number of distinct
signatures to be searched.</p></list-item><list-item id="o0335"><label>viii.</label><p id="p1250">NMF_ITER: Integer [1, inf].
default = 100.</p><p id="p1255">This parameter sets the number
of Negative Matrix Factorization iterations
performed during the inference of
<bold>A</bold> and <bold>B</bold>
matrices</p></list-item><list-item id="o0340"><label>ix.</label><p id="p1260">SEED: Integer [0, Inf].
default = 0 (with 0 the seed will be randomly
set).</p><p id="p1265">This parameter initializes the
random number generator. It is used to obtain
reproducible results by keeping the same
SEED.</p></list-item><list-item id="o0345"><label>x.</label><p id="p1270">N_CORE: Integer [0, Inf].
default = 0 (with 0 the number of cores available
will automatically be detected).</p><p id="p1275">This parameter indicates the
maximum number of computational units (cpus)
available for the inference.</p></list-item></list></p></list-item></list></p>
          </list-item>
        </list>
        <disp-quote>
          <p><inline-graphic xlink:href="fx3.gif"/><bold>CRITICAL:</bold> MAX_NUM_SIG and
MIN_SNV_SAMPLE must be set accordingly with the NUM_CONTEXTS
parameter. To obtain robust results, we suggest setting the former
equal to half the number of contexts (i.e., 3 or 48) and the latter
larger than the number of contexts.</p>
        </disp-quote>
        <list list-type="simple" id="olist0155">
          <list-item id="o0350">
            <label>13.</label>
            <p id="p1285">Run denovo.R<list list-type="simple" id="olist0160"><list-item id="o0355"><label>a.</label><p id="p1290">denovo.R can be run with the
following command:<boxed-text id="dtbox29"><p id="p1295">&gt;Rscript
denovo.R \</p><p id="p1300">--SNV_list
path/to/SNV_list.txt \</p><p id="p1305">--config_file
path/to/denovo_config.txt
\</p><p id="p1310">--output_dir
path/to/output/dir</p></boxed-text></p><p id="p1315">The script will generate in the
output directory (specified by the user) the
following three subdirectories:<list list-type="simple" id="olist0165"><list-item id="o0360"><label>i.</label><p id="p1320"><italic>“</italic>Signatures<italic>”</italic>:</p><p id="p1325">This directory will contain a
file for each number of searched signatures named
‘x_signatures.txt’. Each file will be formatted as
a table with the context as header and a row for
each signature.</p></list-item><list-item id="o0365"><label>ii.</label><p id="p1330"><italic>“</italic>Graphical<italic>”</italic>:</p><p id="p1335">This directory will contain
the graphical representation of each signature set
found in the data.</p></list-item><list-item id="o0370"><label>iii.</label><p id="p1340"><italic>“</italic>Rank<italic>”</italic>:</p><p id="p1345">This directory will contain a
set of files to determine the optimal number of
signatures.</p></list-item></list></p></list-item><list-item id="o0375"><label>b.</label><p id="p1370">Unfortunately, no automated
procedures are available to find the correct number
of signatures, so we here provide a set of metrics
to determine it. The denovo.R script provides four
metrics as output and the relative plots:<list list-type="simple" id="olist0170"><list-item id="o0380"><label>i.</label><p id="p1375">explained variance
(<xref rid="bib13" ref-type="bibr">Hutchins et al., 2008</xref>)</p></list-item><list-item id="o0385"><label>ii.</label><p id="p1380">cophenetic coefficient
(<xref rid="bib5" ref-type="bibr">Brunet et al., 2004</xref>),</p></list-item><list-item id="o0390"><label>iii.</label><p id="p1385">dispersion coefficient
(<xref rid="bib15" ref-type="bibr">Kim
and Park, 2007</xref>),</p></list-item><list-item id="o0395"><label>iv.</label><p id="p1390">silhouette consensus
coefficient.</p></list-item></list></p></list-item></list></p>
          </list-item>
        </list>
      </p>
      <p id="p1395">The four metrics are shown in <xref rid="fig2" ref-type="fig">Figure 2</xref>
and <xref rid="tbl2" ref-type="table">Table
2</xref>.<fig id="fig2"><label>Figure 2</label><caption><p>Metrics to evaluate the best number of
signatures</p><p>(A) shows the explained variance at different ranks;
in this case we observed a bend at 3.</p><p>(B–D) show stability-based coefficients which report
the consistency of NMF solutions across multiple iterations.</p></caption><graphic xlink:href="gr2"/></fig><table-wrap position="float" id="tbl2"><label>Table 2</label><caption><p>Metric coefficients for each different signature
rank searched via denovo.R script</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Rank</th><th>Cophenetic coefficient</th><th>Dispersion coefficient</th><th>Silhouette consensus</th><th>Explained variance</th></tr></thead><tbody><tr><td>1</td><td><italic>NA</italic></td><td>1</td><td><italic>NA</italic></td><td>0.85</td></tr><tr><td>2</td><td>1</td><td>0.96</td><td>0.82</td><td>0.92</td></tr><tr><td>3</td><td>0.93</td><td>0.78</td><td>0.63</td><td>0.97</td></tr><tr><td>4</td><td>1</td><td>0.99</td><td>0.66</td><td>0.99</td></tr><tr><td>5</td><td>0.91</td><td>0.85</td><td>0.16</td><td>0.99</td></tr><tr><td>6</td><td>0.94</td><td>0.92</td><td><italic>NA</italic></td><td>1</td></tr></tbody></table></table-wrap></p>
      <p id="p1400">The first one measures how good is the fit of each given
number of signatures, considering the observed mutational profiles. This
metric is useful to estimate when the number of signatures is too high
(i.e., overfitting). To this end, we suggest choosing the optimal number of
signatures based on the <italic>bend rule</italic> that selects the
number of signatures corresponding to the elbow in the explained variant
plot (see the example in <xref rid="fig2" ref-type="fig">Figure 2</xref>A).</p>
      <p id="p1405">Often there is uncertainty to select a unique
<italic>elbow point</italic> on the plot, so the latter three
metrics can be used as additional evaluation of the optimal rank. Roughly,
they provide a measure of stability of the NMF solutions over multiple runs
(<italic>NMF_ITER</italic> parameter). These coefficients range
from 0 to 1 and higher values indicate higher consistency among NMF
solutions.</p>
      <p id="p1410">Considering all the above, our suggestion is to select one
or few elbow points and among them select the one corresponding to higher
cophenetic, dispersion, or silhouette coefficient. If still there is
ambiguity it is reasonable to take the lower one.</p>
      <p id="p1415">Considering the example, and the metrics shown in
<xref rid="fig2" ref-type="fig">Figure 2</xref>, we
conservatively selected 3 as the optimal number of signatures, as at this
rank we have a first bend in the explained variance and high values of the
other metrics. <disp-quote><p><bold><italic>Note:</italic></bold> Please get from
the ‘Signatures’ directory the corresponding file that should be
then used in the following assignment step.</p></disp-quote><disp-quote><p><bold><italic>Note:</italic></bold> Each signature
file contains a different number of signatures (identified with
SIG_NUM) found in the data. In the ‘graphical’ directory, denovo.R
generates pdf files with the same name as the corresponding
signatures set. Those files contain a plot of the categorical
distributions.</p></disp-quote></p>
    </sec>
    <sec id="sec3.4">
      <title>Part 4. Assignment of existing mutational
signatures (assignment.R)</title>
      <p id="p1420">
        <disp-quote>
          <p>
            <inline-graphic xlink:href="fx2.gif"/>
            <bold>Timing: 15 min (approximate time
required to perform the step on a dataset with ∼100 samples and
∼10</bold>
            <bold>,</bold>
            <bold>000 mutations, with
significant variability related to bootstrap
iterations)</bold>
          </p>
        </disp-quote>
        <list list-type="simple" id="olist0175">
          <list-item id="o0400">
            <label>14.</label>
            <p id="p1425">Input files and setup</p>
            <p id="p1430">The assignment.R script requires three input
files to be executed.<list list-type="simple" id="olist0180"><list-item id="o0405"><label>a.</label><p id="p1435">List of selected SNVs
[SNV_list.txt]</p><p id="p1440">This file is the same used in Part
3, please see above.</p></list-item><list-item id="o0410"><label>b.</label><p id="p1445">Signatures file
[x_signatures.txt]</p><p id="p1450">This file contains for each
signature the frequency of substitutions. Their
values are grouped by context and normalized up to
1. The file must be formatted as a table with the
context as header and a row for each
signature.</p><p id="p1455">The header must be formatted as:
G&gt;T:C&gt;A;G&gt;C:C&gt;G;G&gt;A:C&gt;T;A&gt;T:T&gt;A;A&gt;G:T&gt;C;A&gt;C:T&gt;G.</p><p id="p1460">Notice that, for instance, variants
from G to T and C to A are aggregated together in
the cases of 6-context. For further details,
especially for the 96-contexts representation,
please refer to (<xref rid="bib1" ref-type="bibr">Alexandrov et al.,
2013</xref>).</p><p id="p1465">This file can be generated via Part
3 or can be directly passed by the user.</p></list-item><list-item id="o0415"><label>c.</label><p id="p1470">Configuration file
[assignment_config.yaml]</p><p id="p1475">The parameters to run assignment.R
are set in a text file called as default
‘assignment_config.txt’. The file must contain a
parameter in each line formatted as PARAMETER_NAMES:
value</p><p id="p1480">The parameters that can be modified
are the following:</p><p id="p1485">[variant selection]<list list-type="simple" id="olist0185"><list-item id="o0420"><label>i.</label><p id="p1490">CLONAL_SNV_THR: Double [0,1].
default = 0.9. This parameter defines whether a
given SNV is considered as clonal (default =
0.9).</p></list-item><list-item id="o0425"><label>ii.</label><p id="p1495">MINOR_SNV_SEL: String
{‘always’, ‘all’}. default = ‘always’. To reduce
the bias induced by the mutation transmitted and
inherited among the population during the epidemic
spread we select for the signature analysis only
SNVs never observed with a frequency higher than
CLONAL_SNV_THR in any sample. The remaining SNVs
are defined as ‘always minor’. For further
details, please refer to (<xref rid="bib11" ref-type="bibr">Graudenzi et al.,
2021</xref>).</p></list-item><list-item id="o0430"><label>iii.</label><p id="p1500">MAX_SNV_SAMPLE: Integer [1,
Inf]. default = 100. In order to reduce the impact
of highly mutated samples likely due to
degradation of their biological isolation. We
suggest removing the samples exhibiting more than
a user selected number of variants.</p></list-item><list-item id="o0435"><label>iv.</label><p id="p1505">MIN_SNV_SAMPLE: Integer [1,
Inf]. default = 6. In order to assess the
existence of statistically significant mutational
signatures we have to remove all the samples with
less than a given number of detected
SNVs.</p><p id="p1510">[analysis
parameters]</p></list-item><list-item id="o0440"><label>v.</label><p id="p1515">BOOTSTRAP: String {‘yes’,
‘no’}. default = ‘yes’.</p></list-item><list-item id="o0445"><label>vi.</label><p id="p1520">GOODNESS_FIT_THR: Double
[0.5,1]. default = 0.95. This threshold indicates
the minimum level of goodness of fit until when
keep adding signatures (among the signatures.txt
file) to the fit, in a given sample. The goodness
of fit is measured with the cosine similarity
between observed and predicted counts in each
sample.</p></list-item><list-item id="o0455"><label>vii.</label><p id="p1530">MIN_SIG_FREQ: Double [0,1].
default = 0.05. Each signature is considered to be
present in a given sample if its activity (alpha
value) is greater than the value of this
parameter.</p></list-item><list-item id="o0460"><label>viii.</label><p id="p1540">P_VALUE: threshold to be used
when assessing significance of the exposure of
samples to signatures. To this extent,
Mann–Whitney U test is performed whose results are
evaluated with the given P_VALUE threshold.
default = 0.05</p></list-item><list-item id="o0465"><label>ix.</label><p id="p1545">NUM_ITER: Integer [1, Inf].
default = 100</p></list-item><list-item id="o0470"><label>x.</label><p id="p1550">SEED: Integer [0, Inf].
default = 0 (with 0 the seed will be set
randomly)</p></list-item><list-item id="o0475"><label>xi.</label><p id="p1555">N_CORE: Integer [0, Inf].
default = 0 (with 0 the number of core available
will automatically detected)</p></list-item></list></p></list-item></list></p>
          </list-item>
        </list>
        <disp-quote>
          <p><inline-graphic xlink:href="fx3.gif"/><bold>CRITICAL:</bold> We suggest setting
the parameters in accordance with the number of contexts. Similar to
Part 3 MIN_SNV_SAMPLE should be larger than the number of contexts
to provide reasonable results.</p>
        </disp-quote>
        <list list-type="simple" id="olist0190">
          <list-item id="o0480">
            <label>15.</label>
            <p id="p1560">Run assignment.R</p>
          </list-item>
        </list>
      </p>
      <p id="p1565">assignment.R can be run by the following command:<boxed-text id="dtbox31"><p id="p1570">&gt;Rscript assignment.R
\</p><p id="p1575">--SNV_list
path_to_SNV_list.txt \</p><p id="p1580">--signature
path_to_signature_x.txt \</p><p id="p1585">--config_file
path_to_assignment_config.txt
\</p><p id="p1590">--output_file
path_to_output_file</p></boxed-text></p>
      <p id="p1595">The script will generate a table in a text file specified by
the user (default: assignment_result.txt). This table will have a row for
each selected sample and one column for each signature, called
<italic>“</italic>Sn_exposure<italic>”</italic>. This column
reports the alpha values of each signature found in each sample (i.e., a
numeric value measuring the level of activity of the signature in that
sample).</p>
      <p id="p1600">If the bootstrap procedure is performed, another column for
each signature is added into file. This column, called ‘Sn_pvalue’, shows
the p-value of significance of observing each signature in a given sample
obtained with the harmonic mean of the one-sided (greater) Mann–Whitney
U-test.</p>
    </sec>
  </sec>
  <sec id="sec4">
    <title>Expected outcomes</title>
    <sec id="sec4.1">
      <title>denovo.R</title>
      <p id="p1605">This step provides as output:</p>
      <p id="p1610">The signature matrix (<bold>B</bold>) for each
considered number of signatures and the corresponding graphical
visualization (see <xref rid="fig3" ref-type="fig">Figure 3</xref>). These files
are stored into the “signatures” directory.<fig id="fig3"><label>Figure 3</label><caption><p>Output of the denovo.R script</p><p>(A) The table reports the frequency of the
nucleotide substitutions for each context.</p><p>(B) The same values are represented with bar-plots.
The figure is saved as 3_signatures.pdf file located in
“VirMutSig/example/denovo_results/signature/figures/”.</p></caption><graphic xlink:href="gr3"/></fig></p>
      <p id="p1615">The metrics to estimate the optimal number of signatures in
a text file
(<italic>“</italic>metric_coefficients.txt<italic>”)</italic>
and the corresponding plots (see <xref rid="fig2" ref-type="fig">Figure 2</xref> and <xref rid="tbl2" ref-type="table">Table 2</xref>). These files are stored into the “rank”
directory.</p>
      <p id="p1620">Among them the user should select the optimal solution
(<italic>“</italic>signatures/files/x_signatures.txt<italic>”</italic>)
and use it as input for the following step.</p>
    </sec>
    <sec id="sec4.2">
      <title>assignment.R</title>
      <p id="p1625">This step returns a matrix of the activity of each signature
assigned to each sample, saved as a text file (“assignment_result.txt”). See
<xref rid="tbl3" ref-type="table">Table
3</xref>.<table-wrap position="float" id="tbl3"><label>Table 3</label><caption><p>First 5 entries of the assignment_results.txt file
obtained after assignment.R execution</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Sample</th><th>S1_exposure</th><th>S2_exposure</th><th>S3_exposure</th><th>S1_pvalue</th><th>S2_pvalue</th><th>S3_pvalue</th></tr></thead><tbody><tr><td>SRR12351622</td><td>4.63</td><td>0.13</td><td>1.92</td><td>1.98e-18</td><td>1</td><td>1.98e-18</td></tr><tr><td>SRR12351634</td><td>1.14</td><td>0.44</td><td>4.48</td><td>1.98e-18</td><td>1.98e-18</td><td>1.98e-18</td></tr><tr><td>SRR12351645</td><td>0.81</td><td>1.84</td><td>3.68</td><td>1.98e-18</td><td>1.98e-18</td><td>1.98e-18</td></tr><tr><td>SRR12351651</td><td>2.32</td><td>0.47</td><td>1.05</td><td>1.98e-18</td><td>1.98e-18</td><td>1.98e-18</td></tr><tr><td>SRR12351655</td><td>4.65</td><td>0.26</td><td>2.06</td><td>1.98e-18</td><td>1</td><td>1.98e-18</td></tr></tbody></table><table-wrap-foot><fn><p>For each sample, an exposure value is assigned for
each signature. The corresponding harmonic mean p-value of the one-sided
Mann–Whitney U-test is computed with a bootstrap procedure.</p></fn></table-wrap-foot></table-wrap></p>
    </sec>
  </sec>
  <sec id="sec5">
    <title>Quantification and statistical
analysis</title>
    <p id="p1630">The produced signature-assignment matrix
(“assignment_result.txt”) can be used as input in downstream analyses.</p>
    <p id="p1635">For example, as shown in (<xref rid="bib11" ref-type="bibr">Graudenzi et al., 2021</xref>), the following tasks
can be performed:<list list-type="simple" id="olist0195"><list-item id="o0485"><label>1.</label><p id="p1640">Stratification of samples into signature-based
clusters</p></list-item></list></p>
    <p id="p1645">Samples can be stratified by applying k-means (or any other
clustering methods) on the signature-assignment matrix. Standard heuristics
should be employed to determine the optimal number of clusters.<list list-type="simple" id="olist0200"><list-item id="o0490"><label>2.</label><p id="p1650">Corrected-for-signatures dN/dS analysis</p></list-item></list></p>
    <p id="p1655">dN/dS analysis is a standard population genetics method to
assess the selection pressure acting on the virus. After the identification of
viral mutational signatures, it is possible to investigate whether the SNVs
generated by the corresponding mutational process are positively or negatively
selected in the population. To this end, the dN/dS analysis must be corrected
for the expected mutation frequency specific for each signature profiles, as
proposed in (<xref rid="bib11" ref-type="bibr">Graudenzi et al.,
2021</xref>).</p>
  </sec>
  <sec id="sec6">
    <title>Limitations</title>
    <sec id="sec6.1">
      <title>Reference genome</title>
      <p id="p1660">Any reference genome can be used with VirMutSig. Using
different reference genomes may slightly change the results. For SARS-CoV-2
analysis we highlight the presence of two other reference genomes besides
SARS-CoV-2-ANC used in this protocol (see “<xref rid="sec6.1" ref-type="sec">reference genome</xref>” in “<xref rid="sec2" ref-type="sec">materials and equipment</xref>”
section):</p>
      <p id="p1665">EPI_ISL_405839 (<xref rid="bib4" ref-type="bibr">Bastola et al., 2020</xref>)</p>
      <p id="p1670">EPI_ISL_402125 (<xref rid="bib2" ref-type="bibr">Andersen et al., 2020</xref>)</p>
      <p id="p1675">Notice that the number of mismatches between those two
reference genomes and the one SARS-CoV-2-ANC is only 5
nucleotides.</p>
    </sec>
    <sec id="sec6.2">
      <title>Dataset quality</title>
      <p id="p1680">In these kinds of analyses using good quality data is
mandatory because the level of random mutations (sequencing artifacts or
samples biological degradation) could affect the significance of the
signature identified and assigned.</p>
      <p id="p1685">However, we suggested parameter settings that can mitigate
this issue. Depending on the specific quality of the data, the stringency of
such parameters could be increased.</p>
    </sec>
  </sec>
  <sec id="sec7">
    <title>Troubleshooting</title>
    <sec id="sec7.1">
      <title>Problem 1</title>
      <p id="p1690">It may be difficult to choose the optimal rank (i.e., the
number of mutational signatures) on the basis of the available metrics (see
step 13).</p>
    </sec>
    <sec id="sec7.2">
      <title>Potential solution</title>
      <p id="p1695">The estimation of the optimal number of signatures is a
critical task. We have already discussed in the text how one should consider
the results of different metrics to estimate the optimal rank. However, such
metrics may sometimes lead to ambiguous (or conflicting) indications, making
it difficult to select the optimal rank. In this case, one may try to
improve the stability of the results by increasing the number of NMF
iterations, since a higher number of iterations is expected to deliver more
reliable and stable results<bold>.</bold> To this end, please increase
the value of the NMF_ITER parameter in the ‘denovo_config.yalm’
file.</p>
      <p id="p1700">As an alternative option, we suggest increasing the number
of samples in the datasets, if possible.</p>
    </sec>
    <sec id="sec7.3">
      <title>Problem 2</title>
      <p id="p1705">The input file for both the <italic>de novo</italic>
and the <italic>assignment</italic> analyses is a matrix with samples
(rows) x mutations (columns) that is automatically generated from the
provided list of SNVs. If the mutations kept after the quality filter are
too few, the resulting matrix might be too sparse to obtain robust results
(see <xref rid="sec3.3" ref-type="sec">parts 3</xref>
and <xref rid="sec3.4" ref-type="sec">4</xref>).</p>
    </sec>
    <sec id="sec7.4">
      <title>Potential solution</title>
      <p id="p1710">The de novo extraction of mutational signatures is harder
with very sparse matrices. If the input data are too sparse, one may
increase the number of mutations by loosening the quality check filters or
lowering the threshold to filter out fixed variants. In both cases, more
mutations will be employed in the analysis.</p>
      <p id="p1715">However, one should be cautious when relaxing quality
control filters and should aim at preserving a good tradeoff between the
number of variants and the quality of the data, because including lower
quality mutations may reduce the robustness of the results and the
reliability of the inference.</p>
    </sec>
    <sec id="sec7.5">
      <title>Problem 3</title>
      <p id="p1720">An issue similar to the one presented in Problem 2 may arise
when the number of samples that satisfies the quality criteria (e.g.,
minimum number of mutations) is too low (see <xref rid="sec3.3" ref-type="sec">parts 3</xref> and <xref rid="sec3.4" ref-type="sec">4</xref>).</p>
    </sec>
    <sec id="sec7.6">
      <title>Potential solution</title>
      <p id="p1725">Increasing the number of samples is extremely beneficial for
the de novo inference of mutational signatures. We provide a set of quality
checks parameters to set the minimum and maximum number of mutations used to
filter out samples (i.e., MIN_SNV_SAMPLE, MAX_SNV_SAMPLE). One may set these
parameters to increase the sample size of the datasets, but as stated in the
previous point, one should keep in mind that including lower quality samples
may also reduce the quality of the inference.</p>
    </sec>
    <sec id="sec7.7">
      <title>Problem 4</title>
      <p id="p1730">After performing the bootstrap (see <xref rid="sec3.4" ref-type="sec">part 4</xref>) no significant
signatures were assigned to the samples.</p>
    </sec>
    <sec id="sec7.8">
      <title>Potential solution</title>
      <p id="p1735">In the bootstrap procedure, the algorithm detects the
signatures that are significantly exceeding a given exposure for each
sample. The method repeats the fit until a given ‘GOODNESS_FIT_THR’
threshold is reached (to reduce overfitting) and identifies the signatures
significantly exceeding ‘MIN_SIG_FREQ’ percentage of mutations for each
sample. Reducing these two parameters will result in a larger number of
significant signatures assigned to each sample. A correct tuning of such
parameters depends on the quality of the data and on the minimum number of
mutations which are considered to be significant to assess if a signature is
active.</p>
    </sec>
    <sec id="sec7.9">
      <title>Problem 5</title>
      <p id="p1740">The user may face issues with software compatibility during
the setup of VirMutSig or one needs to execute it on a computer with a
Windows operating system (see <xref rid="sec3.1" ref-type="sec">parts 1</xref>, <xref rid="sec3.2" ref-type="sec">2</xref>, <xref rid="sec3.3" ref-type="sec">3</xref>, and <xref rid="sec3.4" ref-type="sec">4</xref>). .</p>
    </sec>
    <sec id="sec7.10">
      <title>Potential solution</title>
      <p id="p1745">We provide a Docker image (see <xref rid="sec3.1" ref-type="sec">part 1</xref>) including all the VirMutSig
scripts and data already preinstalled and tested. It is also possible to
execute all the VirMutSig steps within the Docker image even on a computer
with Windows OS.</p>
      <p id="p1750">To do this, please start by selecting a directory (e.g.,
“C:\user\data”) on the local machine and copy all the files requested for
the user analysis (e.g., SRA_list or fastq files, reference genome of
choice, etc.). This directory will be the only local directory available
within the Docker image.</p>
      <p id="p1755">After obtaining the dcblab/virmutsig_img, the user will need
to access it by executing the following command in a terminal or in the
command prompt window.<boxed-text id="dtbox32"><p id="p1760">&gt;docker run -it --mount
\</p><p id="p1765">type=bind,source="C:\\user\\data”,target=/VirMutSig/UserData/
\</p><p id="p1770">dcblab/virmutsig_img</p></boxed-text></p>
      <p id="p1775">Please, change "C:\user\data” with the absolute path of the
selected directory.</p>
      <p id="p1780">The terminal will changce, and the username will be replaced
by something similar to:<boxed-text id="dtbox33"><p id="p1785">root@d55f578b7306:/#</p></boxed-text></p>
      <p id="p1790">Now, it is possible to execute all the protocol steps within
the new terminal, following the same instructions described above.</p>
      <p id="p1795">The user files are located in the /VirMutSig/UserData
directory. To get the VirMutSig result files please copy them into this
location, and they will also be available in “C:\user\data\” local
directory.</p>
      <p id="p1800">All the files in VirMutSig_img are writable. For example,
the config files (i.e., “nextflow.config”, “denovo_config.yalm”, and
“assignment_config.yalm”) can be modified using the “nano” editor with the
following command:<boxed-text id="dtbox34"><p id="p1805">root@d55f578b7306:/# nano
/VirMutSig/denovo/denovo_config.yaml</p></boxed-text></p>
      <p id="p1810">Once completed the analyses, please digit exit to close the
VirMutSig image. Notice that, only the files modified or created within the
/VirMutSig/UserData directory will be permanently available
(in C:\user\data), while all other edits will be discarded.</p>
    </sec>
  </sec>
  <sec id="sec8">
    <title>Resource availability</title>
    <sec id="sec8.1">
      <title>Lead contact</title>
      <p id="p1815">Further information and requests for resources and reagents
should be directed to and will be fulfilled by the lead contact, Daniele
Ramazzotti (<ext-link ext-link-type="uri" xlink:href="mailto:daniele.ramazzotti@unimib.it" id="intref0135">daniele.ramazzotti@unimib.it</ext-link>).</p>
    </sec>
    <sec id="sec8.2">
      <title>Materials availability</title>
      <p id="p1820">This study did not generate new unique reagents.</p>
    </sec>
  </sec>
</body>
<back>
  <ref-list id="cebib0010">
    <title>References</title>
    <ref id="bib1">
      <element-citation publication-type="journal" id="sref1">
        <person-group person-group-type="author">
          <name>
            <surname>Alexandrov</surname>
            <given-names>L.B.</given-names>
          </name>
          <name>
            <surname>Nik-Zainal</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Wedge</surname>
            <given-names>D.C.</given-names>
          </name>
          <name>
            <surname>Aparicio</surname>
            <given-names>S.A.</given-names>
          </name>
          <name>
            <surname>Behjati</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Biankin</surname>
            <given-names>A.V.,.</given-names>
          </name>
          <name>
            <surname>Stratton</surname>
            <given-names>M.R.</given-names>
          </name>
        </person-group>
        <article-title>Signatures of mutational processes in human
cancer</article-title>
        <source>Nature</source>
        <volume>500</volume>
        <year>2013</year>
        <fpage>415</fpage>
        <lpage>421</lpage>
        <pub-id pub-id-type="pmid">23945592</pub-id>
      </element-citation>
    </ref>
    <ref id="bib2">
      <element-citation publication-type="journal" id="sref2">
        <person-group person-group-type="author">
          <name>
            <surname>Andersen</surname>
            <given-names>K.G.</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Lipkin</surname>
            <given-names>W.I.</given-names>
          </name>
          <name>
            <surname>Holmes</surname>
            <given-names>E.C.</given-names>
          </name>
          <name>
            <surname>Garry</surname>
            <given-names>R.F.</given-names>
          </name>
        </person-group>
        <article-title>The proximal origin of SARS-CoV-2</article-title>
        <source>Nat. Med.</source>
        <volume>26</volume>
        <year>2020</year>
        <fpage>450</fpage>
        <lpage>452</lpage>
        <pub-id pub-id-type="pmid">32284615</pub-id>
      </element-citation>
    </ref>
    <ref id="bib3">
      <element-citation publication-type="book" id="sref3">
        <person-group person-group-type="author">
          <name>
            <surname>Auguie</surname>
            <given-names>B.</given-names>
          </name>
        </person-group>
        <part-title>gridExtra: Miscellaneous Functions for ”Grid” Graph-
Ics. R Package Version 2.3</part-title>
        <year>2017</year>
        <ext-link ext-link-type="uri" xlink:href="https://CRAN.R-project.org/package=%20gridExtra" id="intref0175">https://CRAN.R-project.org/package=
gridExtra</ext-link>
      </element-citation>
    </ref>
    <ref id="bib4">
      <element-citation publication-type="journal" id="sref4">
        <person-group person-group-type="author">
          <name>
            <surname>Bastola</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Sah</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Rodriguez-Morales</surname>
            <given-names>A.J.</given-names>
          </name>
          <name>
            <surname>Lal</surname>
            <given-names>B.K.</given-names>
          </name>
          <name>
            <surname>Jha</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Ojha</surname>
            <given-names>H.C.,.</given-names>
          </name>
          <name>
            <surname>Pandey</surname>
            <given-names>B.D.</given-names>
          </name>
        </person-group>
        <article-title>The first 2019 novel coronavirus case in
Nepal</article-title>
        <source>Lancet Infect. Dis.</source>
        <volume>20</volume>
        <year>2020</year>
        <fpage>279</fpage>
        <lpage>280</lpage>
        <pub-id pub-id-type="pmid">32057299</pub-id>
      </element-citation>
    </ref>
    <ref id="bib6">
      <element-citation publication-type="book" id="sref6">
        <person-group person-group-type="author">
          <name>
            <surname>Bates</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Maechler</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <part-title>Matrix: Sparse and Dense Matrix Classes and Methods. R
Package Version 1.3-4</part-title>
        <year>2021</year>
        <ext-link ext-link-type="uri" xlink:href="https://CRAN.R-project.org/package=Matrix" id="intref0180">https://CRAN.R-project.org/package=Matrix</ext-link>
      </element-citation>
    </ref>
    <ref id="bib5">
      <element-citation publication-type="journal" id="sref5">
        <person-group person-group-type="author">
          <name>
            <surname>Brunet</surname>
            <given-names>J.P.</given-names>
          </name>
          <name>
            <surname>Tamayo</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Golub</surname>
            <given-names>T.R.</given-names>
          </name>
          <name>
            <surname>Mesirov</surname>
            <given-names>J.P.</given-names>
          </name>
        </person-group>
        <article-title>Metagenes and molecular pattern discovery using matrix
factorization</article-title>
        <source>PNAS</source>
        <volume>101.12</volume>
        <year>2004</year>
        <fpage>4164</fpage>
        <lpage>4169</lpage>
        <pub-id pub-id-type="pmid">15016911</pub-id>
      </element-citation>
    </ref>
    <ref id="bib7">
      <element-citation publication-type="book" id="sref7">
        <person-group person-group-type="author">
          <name>
            <surname>Dowle</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Srinivasan</surname>
            <given-names>A.</given-names>
          </name>
        </person-group>
        <part-title>data.table: Extension of ‘data.Frame‘. R Package
Version 1.14.0</part-title>
        <year>2021</year>
        <ext-link ext-link-type="uri" xlink:href="https://CRAN.R-project.org/package=%20data.table" id="intref0185">https://CRAN.R-project.org/package=
data.table</ext-link>
      </element-citation>
    </ref>
    <ref id="bib14">
      <element-citation publication-type="journal" id="sref14">
        <person-group person-group-type="author">
          <name>
            <surname>Friedman</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Hastie</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Tibshirani</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>Regularization paths for Generalized linear models via
coordinate descent</article-title>
        <source>J. Stat. Softw.</source>
        <volume>33</volume>
        <year>2010</year>
        <fpage>1</fpage>
        <lpage>22</lpage>
        <pub-id pub-id-type="pmid">20808728</pub-id>
      </element-citation>
    </ref>
    <ref id="bib9">
      <element-citation publication-type="book" id="sref9">
        <person-group person-group-type="author">
          <name>
            <surname>Gagolewski</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <part-title>Stringi: Fast and Portable Character String Processing
in R. R Package Version 1.7.4</part-title>
        <year>2021</year>
        <ext-link ext-link-type="uri" xlink:href="https://stringi.gagolewski.com/" id="intref0195">https://stringi.gagolewski.com/</ext-link>
      </element-citation>
    </ref>
    <ref id="bib10">
      <element-citation publication-type="book" id="sref10">
        <person-group person-group-type="author">
          <name>
            <surname>Gaujoux</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Seoighe</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <part-title>The Package NMF: Manual Pages. R Package Version
0.23.0. CRAN</part-title>
        <year>2020</year>
        <ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/package=NMF" id="intref0200">https://cran.r-project.org/package=NMF</ext-link>
      </element-citation>
    </ref>
    <ref id="bib11">
      <element-citation publication-type="journal" id="sref11">
        <person-group person-group-type="author">
          <name>
            <surname>Graudenzi</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Maspero</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Angaroni</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Piazza</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Ramazzotti</surname>
            <given-names>D.</given-names>
          </name>
        </person-group>
        <article-title>Mutational signatures and heterogeneous host response
revealed via large-scale characterization of SARS-CoV-2 genomic
diversity</article-title>
        <source>iScience</source>
        <volume>24</volume>
        <year>2021</year>
        <fpage>102116</fpage>
        <pub-id pub-id-type="pmid">33532709</pub-id>
      </element-citation>
    </ref>
    <ref id="bib12">
      <element-citation publication-type="journal" id="sref12">
        <person-group person-group-type="author">
          <name>
            <surname>Huber</surname>
            <given-names>W.</given-names>
          </name>
          <name>
            <surname>Carey</surname>
            <given-names>V.J.</given-names>
          </name>
          <name>
            <surname>Gentleman</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Anders</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Carlson</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Carvalho</surname>
            <given-names>B.S.,.</given-names>
          </name>
          <name>
            <surname>Morgan</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>Orchestrating high-throughput genomic analysis with
Bioconductor</article-title>
        <source>Nat. Methods</source>
        <volume>12</volume>
        <year>2015</year>
        <fpage>115</fpage>
        <lpage>121</lpage>
        <pub-id pub-id-type="pmid">25633503</pub-id>
      </element-citation>
    </ref>
    <ref id="bib13">
      <element-citation publication-type="journal" id="sref13">
        <person-group person-group-type="author">
          <name>
            <surname>Hutchins</surname>
            <given-names>L.N.</given-names>
          </name>
          <name>
            <surname>Murphy</surname>
            <given-names>S.M.,</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Graber</surname>
            <given-names>J.H.</given-names>
          </name>
        </person-group>
        <article-title>Position-dependent motif characterization using
non-negative matrix factorization</article-title>
        <source>Bioinformatics</source>
        <volume>24</volume>
        <year>2008</year>
        <fpage>2684</fpage>
        <lpage>2690</lpage>
        <pub-id pub-id-type="pmid">18852176</pub-id>
      </element-citation>
    </ref>
    <ref id="bib15">
      <element-citation publication-type="journal" id="sref15">
        <person-group person-group-type="author">
          <name>
            <surname>Kim</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Park</surname>
            <given-names>H.</given-names>
          </name>
        </person-group>
        <article-title>Sparse non-negative matrix factorizations via
alternating non-negativity-constrained least squares for
microarray data analysis</article-title>
        <source>Bioinformatics</source>
        <volume>23</volume>
        <year>2007</year>
        <fpage>1495</fpage>
        <lpage>1502</lpage>
        <pub-id pub-id-type="pmid">17483501</pub-id>
      </element-citation>
    </ref>
    <ref id="bib16">
      <element-citation publication-type="journal" id="sref16">
        <person-group person-group-type="author">
          <name>
            <surname>Lal</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Tibshirani</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Sidow</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Ramazzotti</surname>
            <given-names>D.</given-names>
          </name>
        </person-group>
        <article-title>De novo mutational signature discovery in tumor
genomes using SparseSignatures</article-title>
        <source>PLoS Comput. Biol.</source>
        <volume>17</volume>
        <year>2021</year>
        <fpage>e1009119</fpage>
        <pub-id pub-id-type="pmid">34181655</pub-id>
      </element-citation>
    </ref>
    <ref id="bib17">
      <element-citation publication-type="journal" id="sref17">
        <person-group person-group-type="author">
          <name>
            <surname>Merkel</surname>
            <given-names>D.</given-names>
          </name>
        </person-group>
        <article-title>Docker: lightweight Linux containers for consistent
development and deployment</article-title>
        <source>Linux J.</source>
        <volume>2014</volume>
        <year>2014</year>
        <fpage>2</fpage>
      </element-citation>
    </ref>
    <ref id="bib18">
      <element-citation publication-type="book" id="sref18">
        <person-group person-group-type="author">
          <name>
            <surname>Morgan</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <part-title>BiocManager: Access the Bioconductor Project Package
Repository. R Package Version 1.30.16</part-title>
        <year>2021</year>
        <ext-link ext-link-type="uri" xlink:href="https://CRAN.R-project.org/%20package=BiocManager" id="intref0205">https://CRAN.R-project.org/
package=BiocManager</ext-link>
      </element-citation>
    </ref>
    <ref id="bib19">
      <element-citation publication-type="book" id="sref19">
        <person-group person-group-type="author">
          <name>
            <surname>Mullen</surname>
            <given-names>K.M.</given-names>
          </name>
          <name>
            <surname>van Stokkum</surname>
            <given-names>I.H.M.</given-names>
          </name>
        </person-group>
        <part-title>Nnls: The Lawson- Hanson Algorithm for Non-negative
Least Squares (NNLS). R Package Version 1.4</part-title>
        <year>2012</year>
        <ext-link ext-link-type="uri" xlink:href="https://CRAN.R-project.org/package=nnls" id="intref0210">https://CRAN.R-project.org/package=nnls</ext-link>
      </element-citation>
    </ref>
    <ref id="bib20">
      <element-citation publication-type="journal" id="sref20">
        <person-group person-group-type="author">
          <name>
            <surname>Ramazzotti</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Angaroni</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Maspero</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Gambacorti-Passerini</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Antoniotti</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Graudenzi</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Piazza</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>VERSO: a comprehensive framework for the inference of
robust phylogenies and the quantification of intra-host genomic
diversity of viral samples</article-title>
        <source>Patterns</source>
        <volume>2</volume>
        <year>2021</year>
        <fpage>100212</fpage>
        <pub-id pub-id-type="pmid">33728416</pub-id>
      </element-citation>
    </ref>
    <ref id="bib21">
      <element-citation publication-type="book" id="sref21">
        <person-group person-group-type="author">
          <name>
            <surname>Stephens</surname>
            <given-names>J.</given-names>
          </name>
        </person-group>
        <part-title>Yaml: Methods to Convert R Data to YAML and Back. R
Package Version 2.2.1</part-title>
        <year>2020</year>
        <ext-link ext-link-type="uri" xlink:href="https://CRAN.R-project.org/package=yaml" id="intref0215">https://CRAN.R-project.org/package=yaml</ext-link>
      </element-citation>
    </ref>
    <ref id="bib23">
      <element-citation publication-type="book" id="sref23">
        <person-group person-group-type="author">
          <name>
            <surname>Davis</surname>
            <given-names>T.L.</given-names>
          </name>
        </person-group>
        <part-title>Optparse: Command Line Option Parser. R Package
Version 1.6.6</part-title>
        <year>2020</year>
        <publisher-name>https://CRAN.R-project.org/package=optparse</publisher-name>
      </element-citation>
    </ref>
    <ref id="bib22">
      <element-citation publication-type="journal" id="sref22">
        <person-group person-group-type="author">
          <name>
            <surname>Di Tommaso</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Chatzou</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Floden</surname>
            <given-names>E.W.</given-names>
          </name>
          <name>
            <surname>Barja</surname>
            <given-names>P.P.</given-names>
          </name>
          <name>
            <surname>Palumbo</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Notredame</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <article-title>Nextflow enables reproducible computational
workflows</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>35</volume>
        <year>2017</year>
        <fpage>316</fpage>
        <lpage>319</lpage>
        <pub-id pub-id-type="pmid">28398311</pub-id>
      </element-citation>
    </ref>
    <ref id="bib24">
      <element-citation publication-type="book" id="sref24">
        <person-group person-group-type="author">
          <name>
            <surname>Wickham</surname>
            <given-names>H.</given-names>
          </name>
        </person-group>
        <part-title>ggplot2: Elegant Graphics for Data
Analysis</part-title>
        <year>2016</year>
        <publisher-name>Springer-Verlag</publisher-name>
        <ext-link ext-link-type="uri" xlink:href="https://ggplot2.tidyverse.org" id="intref0225">https://ggplot2.tidyverse.org</ext-link>
      </element-citation>
    </ref>
    <ref id="bib8">
      <element-citation publication-type="book" id="sref8">
        <person-group person-group-type="author">
          <name>
            <surname>Wild</surname>
            <given-names>Fridolin</given-names>
          </name>
        </person-group>
        <part-title>Lsa: Latent Semantic Analysis. R Package Version
0.73.2</part-title>
        <year>2020</year>
        <ext-link ext-link-type="uri" xlink:href="https://CRAN.R-project.org/package=lsa" id="intref0190">https://CRAN.R-project.org/package=lsa</ext-link>
      </element-citation>
    </ref>
  </ref-list>
  <sec sec-type="data-availability" id="da0010">
    <title>Data and code availability</title>
    <p id="p0030">This study did not generate any unique data sets. The FASTQ files
used in this protocol are public available at NCBI BioProject database
(<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/bioproject/" id="intref0020">https://www.ncbi.nlm.nih.gov/bioproject/</ext-link>) using
the following access numbers NCBI: PRJNA610428, PRJNA645906</p>
    <p id="p0035">The VirMutSig protocol and the example files are available at:
<ext-link ext-link-type="uri" xlink:href="https://github.com/BIMIB-DISCo/VirMutSig" id="intref0025">https://github.com/BIMIB-DISCo/VirMutSig</ext-link>.</p>
  </sec>
  <ack id="ack0010">
    <title>Acknowledgments</title>
    <p id="p1835">This work was partially supported by the Elixir Italian Chapter and
the SysBioNet project, a <funding-source id="gs1"><institution-wrap><institution-id institution-id-type="doi">10.13039/501100003407</institution-id><institution>Ministero dell’Istruzione,
dell’Università e della Ricerca</institution></institution-wrap></funding-source> initiative for the Italian
Roadmap of European Strategy Forum on Research Infrastructures, and by the
<funding-source id="gs2"><institution-wrap><institution-id institution-id-type="doi">10.13039/501100005010</institution-id><institution>Associazione Italiana per la Ricerca sul Cancro</institution></institution-wrap></funding-source> (AIRC)-IG
grant 22082. D.R. and F.A. were
partially supported by a <funding-source id="gs3"><institution-wrap><institution-id institution-id-type="doi">10.13039/501100002954</institution-id><institution>Bicocca 2020 Starting
Grant</institution></institution-wrap></funding-source>. D.R. was supported by a Premio Giovani Talenti
dell'<funding-source id="gs4"><institution-wrap><institution-id institution-id-type="doi">10.13039/100012352</institution-id><institution>Università degli Studi di Milano-Bicocca</institution></institution-wrap></funding-source>. We thank Marco
Antoniotti, Giulio Caravagna, Chiara Damiani, Lucrezia Patruno, and Francesco
Craighero for helpful discussions.</p>
    <sec id="sec11">
      <title>Author contributions</title>
      <p id="p1840">Writing – original draft and writing – review &amp; editing,
D.M., D.R., and A.G.; software, D.M., D.R., and F.A.; validation, D.M., D.R.,
F.A., and A.G.; funding acquisition, A.G., D.R., D.P., R.P.; supervision, A.G.
and D.R. All authors read, revised, and approved the manuscript.</p>
    </sec>
    <sec sec-type="COI-statement" id="sec12">
      <title>Declaration of interests</title>
      <p id="p1845">The authors declare no competing interests.</p>
    </sec>
  </ack>
</back>
