<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Biol</journal-id>
    <journal-title-group>
      <journal-title>Genome Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1474-7596</issn>
    <issn pub-type="epub">1474-760X</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5946416</article-id>
    <article-id pub-id-type="publisher-id">1431</article-id>
    <article-id pub-id-type="doi">10.1186/s13059-018-1431-3</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>GiniClust2: a cluster-aware, weighted ensemble clustering method for cell-type detection</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Tsoucas</surname>
          <given-names>Daphne</given-names>
        </name>
        <address>
          <email>dtsoucas@g.harvard.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Yuan</surname>
          <given-names>Guo-Cheng</given-names>
        </name>
        <address>
          <email>gcyuan@jimmy.harvard.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2106 9910</institution-id><institution-id institution-id-type="GRID">grid.65499.37</institution-id><institution>Department of Biostatistics and Computational Biology, </institution><institution>Dana-Farber Cancer Institute, </institution></institution-wrap>Boston, MA 02115 USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">000000041936754X</institution-id><institution-id institution-id-type="GRID">grid.38142.3c</institution-id><institution>Department of Biostatistics, </institution><institution>Harvard T.H. Chan School of Public Health, </institution></institution-wrap>Boston, MA 02115 USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>10</day>
      <month>5</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>10</day>
      <month>5</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2018</year>
    </pub-date>
    <volume>19</volume>
    <elocation-id>58</elocation-id>
    <history>
      <date date-type="received">
        <day>19</day>
        <month>12</month>
        <year>2017</year>
      </date>
      <date date-type="accepted">
        <day>5</day>
        <month>4</month>
        <year>2018</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s). 2018</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold>This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Single-cell analysis is a powerful tool for dissecting the cellular composition within a tissue or organ. However, it remains difficult to detect rare and common cell types at the same time. Here, we present a new computational method, GiniClust2, to overcome this challenge. GiniClust2 combines the strengths of two complementary approaches, using the Gini index and Fano factor, respectively, through a cluster-aware, weighted ensemble clustering technique. GiniClust2 successfully identifies both common and rare cell types in diverse datasets, outperforming existing methods. GiniClust2 is scalable to large datasets.</p>
      <sec>
        <title>Electronic supplementary material</title>
        <p>The online version of this article (10.1186/s13059-018-1431-3) contains supplementary material, which is available to authorized users.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Clustering</kwd>
      <kwd>Consensus clustering</kwd>
      <kwd>Ensemble clustering</kwd>
      <kwd>Single-cell</kwd>
      <kwd>scRNA-seq</kwd>
      <kwd>Gini index</kwd>
      <kwd>Rare cell type</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id>
            <institution>National Institutes of Health</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01HL119099</award-id>
        <award-id>T32GM074897</award-id>
        <principal-award-recipient>
          <name>
            <surname>Tsoucas</surname>
            <given-names>Daphne</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>Guo-Cheng</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2018</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par19">Genome-wide transcriptomic profiling has served as a paradigm for the systematic characterization of molecular signatures associated with biological functions and disease-related alterations, but traditionally this could only be done using bulk samples that often contain significant cellular heterogeneity. The recent development of single-cell technologies has enabled biologists to dissect cellular heterogeneity within a cell population. Such efforts have led to an increased understanding of cell-type composition, lineage relationships, and mechanisms underlying cell-fate transitions. As the throughput of single-cell technology increases dramatically, it has become feasible not only to characterize major cell types, but also to detect cells that are present at low frequencies, including those that are known to play an important role in development and disease, such as stem and progenitor cells, cancer-initiating cells, and drug-resistant cells [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR2">2</xref>].</p>
    <p id="Par20">On the other hand, it remains a computational challenge to fully dissect the cellular heterogeneity within a large cell population. Despite the intensive effort in method development [<xref ref-type="bibr" rid="CR3">3</xref>–<xref ref-type="bibr" rid="CR8">8</xref>], significant limitations remain. Most methods are effective only for detecting common cell populations, but are not sensitive enough to detect rare cells. A number of methods have been developed to specifically detect rare cells [<xref ref-type="bibr" rid="CR9">9</xref>–<xref ref-type="bibr" rid="CR12">12</xref>], but the features used in these methods are distinct from those distinguishing major populations. Existing methods cannot satisfactorily detect both large and rare cell populations. A naïve approach combining features that are either associated with common or rare cell populations fails to characterize either type correctly, as a mixed feature space will dilute both common and rare cell type-specific biological signals, an unsatisfactory compromise.</p>
    <p id="Par21">To overcome this challenge, we have developed a new method, GiniClust2, to integrate information from complementary clustering methods using a novel ensemble approach. Instead of averaging results from individual clustering methods, as is traditionally done, GiniClust2 selectively weighs the outcomes of each model to maximize the methods’ respective strengths. We show that this cluster-aware weighted ensemble approach can accurately identify both common and rare cell types and is scalable to large datasets.</p>
  </sec>
  <sec id="Sec2">
    <title>Results</title>
    <sec id="Sec3">
      <title>Overview of the GiniClust2 method</title>
      <p id="Par22">An overview of the GiniClust2 pipeline is shown in Fig. <xref rid="Fig1" ref-type="fig">1</xref>. We begin by independently running both a rare cell type-detection method and a common cell type-detection method on the same data set (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>). In a previous study [<xref ref-type="bibr" rid="CR11">11</xref>], we showed that different strategies are optimal for identifying genes associated with rare cell types compared to common ones. Whereas the Fano factor is a valuable metric for capturing differentially expressed genes specific to common cell types, the Gini index is much more effective for identifying genes that are associated with rare cells [<xref ref-type="bibr" rid="CR11">11</xref>]. Therefore, we were motivated to develop a new method that combines the strengths of these two approaches. To facilitate a concrete discussion, here we choose GiniClust as the Gini index-based method and k-means as the Fano factor-based method. However, the same approach can be used to combine any other clustering methods with similar properties. We call this new method GiniClust2.<fig id="Fig1"><label>Fig. 1</label><caption><p>An overview of the GiniClust2 pipeline. <bold>a</bold> The Gini index and Fano factor are used (<italic>left</italic>), respectively, to select genes for GiniClust and Fano-based clustering (<italic>middle left</italic>). A cluster-aware, weighted ensemble method is applied to each of these, where cell-specific cluster-aware weights <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {w}_i^F $$\end{document}</tex-math><mml:math id="M2" display="inline"><mml:msubsup><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>F</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq1.gif"/></alternatives></inline-formula> and <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {w}_i^G $$\end{document}</tex-math><mml:math id="M4" display="inline"><mml:msubsup><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>G</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq2.gif"/></alternatives></inline-formula> are represented by the shading of the cells (<italic>middle right</italic>), to reach a consensus clustering (<italic>right</italic>). <bold>b</bold> A schematic of the weighted consensus association calculation, with association matrices in <italic>black</italic> and <italic>white</italic>, weighting schemes in <italic>red</italic> and <italic>blue</italic>, and final GiniClust2 clusters highlighted in <italic>white</italic>. <bold>c</bold> Cell-specific GiniClust and Fano-based weights are defined as a function of cell-type proportion, where parameters <italic>μ</italic>, <italic>s</italic>, and <italic>f</italic> define the shapes of the weighting curves</p></caption><graphic xlink:href="13059_2018_1431_Fig1_HTML" id="MO1"/></fig></p>
      <p id="Par23">Our goal is to consolidate these two differing clustering results into one consensus grouping. The output from each initial clustering method can be represented as a binary-valued connectivity matrix, M<sub>ij</sub>, where a value of 1 indicates cells i and j belong to the same cluster (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>). Given each method’s distinct feature space, we find that GiniClust and Fano factor-based k-means tend to emphasize the accurate clustering of rare and common cell types, respectively, at the expense of their complements. To optimally combine these methods, a consensus matrix is calculated as a cluster-aware, weighted sum of the connectivity matrices, using a variant of the weighted consensus clustering algorithm developed by Li and Ding [<xref ref-type="bibr" rid="CR13">13</xref>] (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>). Since GiniClust is more accurate for detecting rare clusters, its outcome is more highly weighted for rare cluster assignments, while Fano factor-based k-means is more accurate for detecting common clusters and therefore its outcome is more highly weighted for common cluster assignments. Accordingly, weights are assigned to each cell as a function of the size of the cluster to which the cell belongs (Fig. <xref rid="Fig1" ref-type="fig">1c</xref>). For simplicity, the weighting functions are modeled as logistic functions which can be specified by three tunable parameters: <italic>μ</italic> is the cluster size at which GiniClust and Fano factor-based clustering methods have the same detection precision, <italic>s</italic> represents how quickly GiniClust loses its ability to detect rare cell types, and <italic>f</italic> represents the importance of the Fano cluster membership in determining the larger context of the membership of each cell. The values of parameters <italic>μ</italic> and <italic>s</italic> are specified as a function of the smallest cluster size detectable by GiniClust and the parameter <italic>f</italic> is set to a constant (“<xref rid="Sec9" ref-type="sec">Methods</xref>”, Additional file <xref rid="MOESM1" ref-type="media">1</xref>). The resulting cell-specific weights are transformed into cell pair-specific weights <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {w}_{ij}^G $$\end{document}</tex-math><mml:math id="M6" display="inline"><mml:msubsup><mml:mi>w</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>G</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq3.gif"/></alternatives></inline-formula> and <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {w}_{ij}^F $$\end{document}</tex-math><mml:math id="M8" display="inline"><mml:msubsup><mml:mi>w</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>F</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq4.gif"/></alternatives></inline-formula> (“<xref rid="Sec9" ref-type="sec">Methods</xref>”), and multiplied by their respective connectivity matrices to form the resulting consensus matrix (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>). An additional round of clustering is then applied to the consensus matrix to identify both common and rare cell clusters. The mathematical details are described in the “<xref rid="Sec9" ref-type="sec">Methods</xref>” section.</p>
    </sec>
    <sec id="Sec4">
      <title>Accurate detection of both common and rare cell types in a simulated dataset</title>
      <p id="Par24">We started by evaluating the performance of GiniClust2 using a simulated scRNA-seq dataset, which contains two common clusters (of 2000 and 1000 cells, respectively) and four rare clusters (of ten, six, four, and three cells, respectively) (“<xref rid="Sec9" ref-type="sec">Methods</xref>”<bold>,</bold> Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). We first applied GiniClust and Fano factor-based k-means independently to cluster the cells. As expected, GiniClust correctly identifies all four rare cell clusters, but merges the two common clusters into a single large cluster (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref><bold>,</bold> Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S1). In contrast, Fano factor-based k-means (with k = 2) accurately separates the two common clusters, while lumping together all four rare cell clusters into the largest group (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Additional file 1, Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S1). Increasing k past k = 3 results in dividing each common cluster into smaller clusters, without resolving all rare clusters, indicating an intrinsic limitation of selecting gene features using the Fano factor (Additional file 2: Figure S2a). We find this limitation to be independent of the clustering method used, as applying alternative clustering methods to the Fano factor-based feature space, such as hierarchical clustering and community detection on a kNN graph, also results in the inability to resolve rare clusters (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>, Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S1). Furthermore, simply combining the Gini and Fano feature space fails to provide a more satisfactory solution (Additional file <xref rid="MOESM1" ref-type="media">1</xref>, Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S3). These analyses signify the importance of feature selection in a context-specific manner.<fig id="Fig2"><label>Fig. 2</label><caption><p>The application of GiniClust2 and comparable methods to simulated data. <bold>a</bold> A heatmap representation of the simulated data with six distinct clusters, showing the genes permuted to define each cluster. A zoomed-in view of the rare clusters is shown in the smaller heatmap. <bold>b</bold> A comparison between the true clusters (<italic>x-axis</italic>) and clustering results from GiniClust2 and comparable methods (<italic>y-axis</italic>). Each cluster is represented by a distinct <italic>color bar</italic>. Multiple bars are shown if a true cluster is split into multiple clusters by a clustering method. <bold>c</bold> A three-dimensional visualization of the GiniClust2 clustering results using a composite tSNE plot, combining two Fano-based tSNE dimensions and one Gini-based tSNE dimension. The inset shows a zoomed-in view of the corresponding region</p></caption><graphic xlink:href="13059_2018_1431_Fig2_HTML" id="MO2"/></fig></p>
      <p id="Par25">We next used the GiniClust2 weighted ensemble step to combine the results from GiniClust and Fano factor-based k-means. Of note, all six cell clusters are perfectly recapitulated by GiniClust2 (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>, Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S1), suggesting that GiniClust2 is indeed effective for detecting both common and rare cell clusters. To aid visualization, we created a composite tSNE plot, projecting the cells into a three-dimensional space based on a combination of a two-dimensional Fano-based tSNE map and a one-dimensional Gini-based tSNE map (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). A three-dimensional space is required because, although the Fano-based dimensions are able to clearly separate the two common clusters, the rare clusters are overlapping and cannot be fully discerned. The third (Gini) dimension results in complete separation of the rare clusters. Unlike a traditional tSNE plot, this composite view does not correspond to a single projection of a high-dimensional dataset into a three-dimensional space but integrates two orthogonal views obtained from different high-dimensional features. Although the distance does not have a simple interpretation, it provides a convenient way to visualize data from complementary views.</p>
      <p id="Par26">Since the number of common clusters is unknown in advance, we also tested the robustness of GiniClust2 with respect to other choices of k. We found that setting k = 3 provides the same final clustering, while further increase results in poorer performance by splitting of the larger clusters (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S2b). By default, the value of k was chosen using the gap statistic, which coincided with the number of common clusters (k = 2) [<xref ref-type="bibr" rid="CR14">14</xref>]. However, this metric may not be optimal in various cases when the underlying distribution is more complex [<xref ref-type="bibr" rid="CR15">15</xref>]; therefore, additional exploration is often needed to select the optimal value for k. Since the clustering outcome is sensitive to the choice of k (Additional file <xref rid="MOESM1" ref-type="media">1</xref>), we recommend using the gap statistic as a starting point for choosing k, and then evaluating this choice of k by checking the resulting clusters for adequate separation in the Fano factor-based tSNE plot and expression of distinct and biologically relevant genes.</p>
      <p id="Par27">For comparison, we evaluated the performance of two unweighted ensemble clustering methods. First, we used the cluster-based similarity partitioning algorithm (CSPA) [<xref ref-type="bibr" rid="CR16">16</xref>] to combine the GiniClust and Fano factor-based k-means (k = 2) clustering results. The consensus clustering splits the common clusters into six subgroups, whereas cells in the four rare clusters are assigned to one of two clusters shared with the largest common cell group (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>, Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S1). Without guidance, the consensus clustering treats all clustering results equally and attempts to resolve any inconsistency via suboptimal compromise. The second method we considered, known as SC3 [<xref ref-type="bibr" rid="CR4">4</xref>], is specifically designed for single-cell analysis. This method performs an unweighted ensemble of k-means clusterings for various parameter choices without specifically targeting rare cell detection. Regardless of the specific parameter choices, k-means cannot resolve the rarest clusters, and the final ensemble clustering splits the largest group into three and differentiates only one of the four rare clusters (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>, Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S1). These analyses suggest that our cluster-aware, weighted ensemble approach is important for optimally combining the strengths of different methods.</p>
      <p id="Par28">We also compared the performance of GiniClust2 with other rare cell type-detection methods. In particular, we compared with RaceID2 [<xref ref-type="bibr" rid="CR10">10</xref>], which is an improved version of RaceID [<xref ref-type="bibr" rid="CR9">9</xref>] developed by the same group. For fair comparison, we considered k = 2, the exact number of common cell clusters, and k = 12, the parameter value recommended by authors Grün et al. as determined by a within-cluster dispersion saturation metric [<xref ref-type="bibr" rid="CR10">10</xref>]. In both cases, RaceID2 over-estimated the number of clusters, and split both common and rare cell clusters into smaller subclusters (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>, Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S1). This tendency of over-clustering is consistent with our previous observations [<xref ref-type="bibr" rid="CR11">11</xref>].</p>
    </sec>
    <sec id="Sec5">
      <title>Robust identification of rare cell types over a wide range of proportions</title>
      <p id="Par29">In order to evaluate the performance of GiniClust2 on analyzing real scRNA-seq datasets, we focused on one of the largest public scRNA-seq datasets generated by 10X Genomics [<xref ref-type="bibr" rid="CR17">17</xref>]. The dataset consists of transcriptomic profiles of about 68,000 peripheral blood mononuclear cells (PBMCs) [<xref ref-type="bibr" rid="CR17">17</xref>], which were classified into 11 subpopulations based on transcriptomic similarity with purified cell types (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>). It was noted that the transcriptomic profiles of several subpopulations are nearly indistinguishable [<xref ref-type="bibr" rid="CR17">17</xref>].<fig id="Fig3"><label>Fig. 3</label><caption><p>Analysis of the 68 k PBMC dataset [<xref ref-type="bibr" rid="CR17">17</xref>]. <bold>a</bold> A visualization of reference labels for the full data set (<italic>left</italic>), along with the three cell subtypes selected for detailed analysis (<italic>right</italic>). <bold>b</bold> Comparison of the performance of different clustering methods, quantified by a Matthews correlation coefficient (MCC) [<xref ref-type="bibr" rid="CR18">18</xref>] for each of the three cell subtypes</p></caption><graphic xlink:href="13059_2018_1431_Fig3_HTML" id="MO3"/></fig></p>
      <p id="Par30">To reduce the effects of stochastic variation and technical artifacts, we started by considering only a subset of cell types whose transcriptomic profiles are distinct from one another. In particular, we focused on three large subpopulations: CD56+ natural killer (NK) cells, CD14+ monocytes, and CD19+ B cells. To ensure our analysis is not affected by within-cell type heterogeneity, additional known gene markers were used to further remove heterogeneity within each subpopulation (see “<xref rid="Sec9" ref-type="sec">Methods</xref>” for cell type definition details). In the end, three populations were selected, corresponding to NK, macrophage, and B cells, respectively (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>). To systematically compare the ability of different methods in detecting both common and rare cell types, we created a total of 140 random subsamples that mix different cell types at various proportions (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Table S1), with the rare cell type (macrophage) proportions ranging from 0.2% to 11.6% (see “<xref rid="Sec9" ref-type="sec">Methods</xref>” for details).</p>
      <p id="Par31">We applied GiniClust2 and comparable methods to the down-sampled datasets generated above. Each method was evaluated based on its ability to detect each cell type using the Matthews correlation coefficient (MCC) [<xref ref-type="bibr" rid="CR18">18</xref>] (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>). The MCC is a metric that quantifies the overall agreement between two binary classifications, taking into account both true and false positives and negatives. The MCC value ranges from − 1 to 1, where 1 means a perfect agreement between a clustering and the reference, 0 means the clustering is as good as a random guess, and − 1 means a total disagreement between a clustering and the reference. In addition, we also evaluated the performance of each method using several additional metrics (Additional file <xref rid="MOESM1" ref-type="media">1</xref>). While each metric typically generates a different value, the relative performance across different clustering methods is highly conserved (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S4).</p>
      <p id="Par32">RaceID2 is the best method for detecting the rare macrophage cell type at a frequency of 1.6% or lower, and GiniClust2 is the next best method. As expected, the performance of GiniClust degrades as the “rare” cell type becomes more abundant, whereas Fano factor-based k-means becomes more powerful in such cases. Combining these two methods enables GiniClust2 to perform among the top over a wide range of rare cell proportions. The remaining methods cannot detect rare cell clusters well. For the common groups, Fano factor-based k-means tends to perform better, but only if the parameter is chosen correctly. For example, Fano factor-based k-means with k = 4 systematically splits the largest NK cell group and leads to a relatively low MCC value. Other clustering methods that use Fano factor-based feature selection (such as hierarchical clustering and community detection) also adequately pick up common clusters. This strong performance is preserved by the GiniClust2 method. In comparison, RaceID2 does not perform as well here, since some of the cells in the common groups are falsely identified as rare cells. Taken together, these comparative results suggest that GiniClust2 reaches a good balance for detecting both common and rare clusters. The same conclusion can be arrived at using alternative evaluation metrics (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S4).</p>
    </sec>
    <sec id="Sec6">
      <title>Detection of rare cell types in differentiating mouse embryonic stem cells</title>
      <p id="Par33">To test if GiniClust2 is useful for detecting previously unknown, biologically relevant cell types, we analyzed a published dataset associated with leukemia inhibitory factor (LIF) withdrawal-induced mouse embryonic stem cell (mESC) differentiation [<xref ref-type="bibr" rid="CR19">19</xref>]. Previously, we applied GiniClust to analyze a subset containing undifferentiated mESCs, and identified a rare group of Zscan4-enriched cells [<xref ref-type="bibr" rid="CR11">11</xref>]. As expected, these rare cells were rediscovered using GiniClust2.</p>
      <p id="Par34">In this study, we focused on the cells assayed on day 4 post-LIF withdrawal, and tested if GiniClust2 might uncover greater cellular heterogeneity than previously recognized. GiniClust2 identified two rare clusters consisting of five and four cells, respectively, corresponding to 1.80% and 1.44% of the entire cell population. The first group contains 25 differentially expressed genes when compared to the rest of the cell population (MAST likelihood ratio test <italic>p</italic> value &lt; 1e-5, fold change &gt; 2), including known primitive endoderm (PrEn) markers such as <italic>Col4a1</italic>, <italic>Col4a2</italic>, <italic>Lama1</italic>, <italic>Lama2</italic>, and <italic>Ctsl</italic>. These genes are also associated with high Gini index values. Overall there is a highly significant overlap between differentially expressed and high Gini genes (Fisher exact test <italic>p</italic> value &lt; 1e-18). The second group contains ten differentially expressed genes (MAST likelihood ratio test <italic>p</italic> value &lt; 1e-5, fold change &gt; 2), including maternally imprinted genes <italic>Rhox6</italic>, <italic>Rhox9</italic>, and <italic>Sct</italic>, all of which are also high Gini genes. Once again there is a significant overlap between differentially expressed and high Gini genes (Fisher exact test <italic>p</italic> value &lt; 1e-12). Although these clusters were detected in the original publication [<xref ref-type="bibr" rid="CR19">19</xref>], this was achieved based on a priori knowledge of relevant markers. Here, the strength of GiniClust2 is that it can identify these clusters without previous knowledge.</p>
      <p id="Par35">In addition, GiniClust2 identified two common clusters. The first group specifically expresses a number of genes related to cell growth and embryonic development, including <italic>Pim2</italic>, <italic>Tdgf1</italic>, and <italic>Tcf15</italic> (MAST likelihood ratio test <italic>p</italic> value &lt; 1e-5, fold change &gt; 2), indicating it corresponds to undifferentiated stem cells. The second group is strongly associated with a number of genes related to epiblast cells, including <italic>Krt8</italic>, <italic>Krt18</italic>, <italic>S100a6</italic>, <italic>Tagln</italic>, <italic>Actg1</italic>, <italic>Anxa2</italic>, and <italic>Flnc</italic> (MAST likelihood ratio test <italic>p</italic> value &lt; 1e-5, fold change &gt; 2), suggesting this group corresponds to an epiblast-like state. Of note, 114 of the 128 genes (Fisher exact test <italic>p</italic> value &lt; 1e-88) specifically expressed in this group were selected as high Fano factor genes, confirming the utility of the Fano factor in detecting common cell types. Both populations were discovered in the original publication [<xref ref-type="bibr" rid="CR19">19</xref>]. The dissimilarity between these cell types is evident in the heatmap (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>) and composite tSNE plot (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S5).<fig id="Fig4"><label>Fig. 4</label><caption><p>Analysis of the inDrop dataset for day 4 post-LIF mESC differentiation [<xref ref-type="bibr" rid="CR19">19</xref>]. <bold>a</bold> A heatmap of top differentially expressed genes for each GiniClust2 cluster. The <italic>color bar</italic> above the heatmap indicates the cluster assignments. <bold>b</bold> A comparison of GiniClust2 and RaceID2 clustering results, for common (<italic>above</italic>) and rare (<italic>below</italic>) cell types. The same color-coding scheme is used in all panels</p></caption><graphic xlink:href="13059_2018_1431_Fig4_HTML" id="MO4"/></fig></p>
      <p id="Par36">For comparison, we applied RaceID2 to analyze the same dataset. Unlike GiniClust2, RaceID2 broke each cluster into multiple subclusters, and failed to identify the rare cell clusters (Fig. <xref rid="Fig4" ref-type="fig">4b</xref>). With k = 2, RaceID2 found a total of 11 clusters. Clusters 1, 2, 4, and 9 display an epiblast-like signature, clusters 7 and 10 overexpress genes relating to maternal imprinting, and clusters 8 and 11 correspond to PrEn cells. From these results it appears that RaceID2 has difficulty in differentiating rare, biologically meaningful cell types from outliers.</p>
    </sec>
    <sec id="Sec7">
      <title>Scalability to large data sets</title>
      <p id="Par37">With the rapid development of single-cell technologies, it has become feasible to profile thousands or even millions of transcriptomes at single-cell resolution. Thus, it is desirable to develop scalable computational methods for single-cell data analysis. As a benchmark, we applied GiniClust2 to analyze the entire 68 k PBMC data set [<xref ref-type="bibr" rid="CR17">17</xref>] described above to uncover hidden cell types. The complete analysis took 2.3 h on one core of a 2 GHz Intel Xeon CPU and utilized 237 GB of memory (not optimized for speed or memory usage). For comparison, RaceID2 analysis could not be completed for this large dataset. One possible explanation is this method may be limited to handling data sets with less than 65,536 data points due to an intrinsic vector size restriction in R. Our implementation of GiniClust2 circumvents this restriction by splitting up larger vectors into several smaller ones, with no changes to the functionality of the code. In principle, the same strategy can be implemented in RaceID2 to overcome this limitation. Comparisons of computational run-times between RaceID2 and GiniClust2 on smaller data sets show that the runtime of GiniClust2 scales better with the number of cells in the data set (Additional file <xref rid="MOESM1" ref-type="media">1</xref>, Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Figure S6). For example, for a data set of 80 cells GiniClust2 and RaceID2 take the same amount of time, whereas for the simulated data set of 3023 cells GiniClust2 takes just under 10 min while RaceID2 takes 1 h and 13 mins. Despite the advantages of GiniClust2, it should be noted that GiniClust2 still requires a considerable amount of memory to run on very large data sets, presenting a limitation to the application of this method to even larger data sets.</p>
      <p id="Par38">Our analysis identified nine common clusters and two rare clusters (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). In general, the results of GiniClust2 and Fano factor-based k-means are similar; both agree well with the reference cell types (Fig. <xref rid="Fig5" ref-type="fig">5b</xref><bold>)</bold>. To quantify this agreement, we use normalized mutual information (NMI), which is an entropy-based method normalized by cluster size that can be applied to multi-class classification problems [<xref ref-type="bibr" rid="CR20">20</xref>]. A value of 1 indicates perfect agreement, whereas a value of 0 means the performance is as good as a random guess. Here, values are 0.540 for GiniClust2 and 0.553 for Fano factor-based k-means. Most of the discrepancy between the clustering results and reference labels are associated with T-cell subtypes. As noted by the original authors [<xref ref-type="bibr" rid="CR17">17</xref>], these subtypes are difficult to separate because they share similar gene expression patterns and biological functions. The common clusters detected by GiniClust2 and Fano factor-based k-means express marker genes known to be specific to the cell types represented in the reference [<xref ref-type="bibr" rid="CR21">21</xref>] (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><p>Results from the full 68 k PBMC data analysis. <bold>a</bold> A composite tSNE plot of the GiniClust2 results; rare cell types are circled. <bold>b</bold> A confusion map showing similarities between GiniClust2 clusters and reference labels. Values represent the proportion of cells per reference label that are in each cluster. <bold>c</bold> A bubble plot showing expression of cluster-specific genes. Size represents the percentage of cells within each cluster with non-zero expression of each gene, while color represents the average normalized UMI counts for each cluster and gene</p></caption><graphic xlink:href="13059_2018_1431_Fig5_HTML" id="MO5"/></fig></p>
      <p id="Par39">With respect to rare cell types, our first group contains a homogeneous and visually distinct subset of 171 of 262 total CD34+ cells (cluster 2, Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). This cluster was partially detectable using Fano factor-based k-means, although it was partially mixed with major clusters. The second rare cell cluster is previously unrecognized (cluster 3, Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). This cluster contains 118 cells (0.17%) within a large set of 5433 immune cells with similar gene expression patterns. Among these 118 cells, 101 cells are classified as monocytes, whereas 16 are classified as dendritic cells, and one is classified as a CD34+ cell. Differential expression analysis (MAST likelihood ratio test <italic>p</italic> value &lt; 1e-5, fold change &gt; 2) identified 187 genes that are specifically expressed in this cell cluster, including a number of genes associated with tolerogenic properties, such as <italic>Ftl</italic>, <italic>Fth1</italic>, and <italic>Cst3</italic> [<xref ref-type="bibr" rid="CR22">22</xref>], suggesting these cells may be associated with elevated immune response and metabolism. Additional validation would be necessary to determine whether this cluster is functionally distinct. Taken together, these results strongly indicate the utility of GiniClust2 in analyzing large single-cell datasets.</p>
    </sec>
  </sec>
  <sec id="Sec8">
    <title>Discussion and conclusions</title>
    <p id="Par40">According to the “no free lunch” theorem [<xref ref-type="bibr" rid="CR23">23</xref>], an algorithm that performs well on a certain class of optimization problems is typically associated with degraded performance for other problems. Therefore, it is expected that clustering algorithms optimized for detecting common cell clusters are unable to detect rare cell clusters, and vice versa. While ensemble clustering is a promising strategy to combine the strengths of multiple methods [<xref ref-type="bibr" rid="CR4">4</xref>, <xref ref-type="bibr" rid="CR5">5</xref>, <xref ref-type="bibr" rid="CR16">16</xref>], our analysis shows that the traditional, unweighted approach does not perform well.</p>
    <p id="Par41">To optimally combine the strengths of different clustering methods, we have developed GiniClust2, which is a cluster-aware, weighted ensemble clustering method. GiniClust2 effectively combines the strengths of Gini index- and Fano factor-based clustering methods for detecting rare and common cell clusters, respectively, by assigning higher weights to the more reliable clusters for each method. By analyzing a number of simulated and real scRNA-seq datasets, we find that GiniClust2 consistently performs better than other methods in maintaining the overall balance of detecting both rare and common cell types. This weighted approach is generally applicable to a wide range of problems.</p>
    <p id="Par42">GiniClust2 is currently the only rare cell-specific detection method equipped to handle such large data sets, as demonstrated by our analysis of the 68 k PBMC dataset from 10X Genomics. This property is important for detecting hidden cell types in large datasets, and may be particularly useful for annotating the Human Cell Atlas [<xref ref-type="bibr" rid="CR24">24</xref>].</p>
  </sec>
  <sec id="Sec9">
    <title>Methods</title>
    <sec id="Sec10">
      <title>Data preprocessing</title>
      <p id="Par43">The processed mouse ESC scRNA-seq data are represented as UMI filtered-mapped counts. Removing genes expressed in fewer than three cells, and cells expressing fewer than 2000 genes, we were left with a total of 8055 genes and 278 cells.</p>
      <p id="Par44">The processed 68 k PBMC dataset, represented as UMI counts, was filtered and normalized using the code provided by 10X Genomics (<ext-link ext-link-type="uri" xlink:href="https://github.com/10XGenomics/single-cell-3prime-paper">https://github.com/10XGenomics/single-cell-3prime-paper</ext-link>). The resulting data consist of a total of 20,387 genes and 68,579 cells. Cell-type labels were assigned based on the maximum correlation between the gene expression profile of each single cell to 11 purified cell populations, using the code provided by 10X Genomics.</p>
    </sec>
    <sec id="Sec11">
      <title>GiniClust2 method details</title>
      <p id="Par45">The GiniClust2 pipeline contains the following steps.</p>
      <sec id="Sec12">
        <title>Step 1: Clustering cells using Gini index-based features</title>
        <p id="Par46">The Gini index for each gene is calculated and normalized as described before [<xref ref-type="bibr" rid="CR11">11</xref>]. Briefly, the raw Gini index is calculated as twice the area between the diagonal and the Lorenz curve, taking a range of values between 0 and 1. Raw Gini index values are normalized by removing the trend with maximum expression levels using a two-step LOESS regression procedure as described in [<xref ref-type="bibr" rid="CR11">11</xref>]. Genes whose normalized Gini index is significantly above zero (<italic>p</italic> value &lt; 0.0001 under the normal distribution assumption) are labeled high Gini genes and selected for further analysis.</p>
        <p id="Par47">A high Gini gene-based distance is calculated between each pair of cells using the Jaccard distance metric. This is used as input into DBSCAN [<xref ref-type="bibr" rid="CR25">25</xref>], which is implemented using the dbscan function in the fpc R package, with method = “dist”. Parameter choices for eps and MinPts are discussed in Additional file <xref rid="MOESM1" ref-type="media">1</xref>.</p>
      </sec>
      <sec id="Sec13">
        <title>Step 2: Clustering cells using Fano factor-based features</title>
        <p id="Par48">The Fano factor is defined as the variance over mean expression value for each gene. The top 1000 genes are chosen for further analysis. Principal component analysis (PCA) is applied to the gene expression matrix for dimensionality reduction, using the svd function in R. The first 50 principal components are reserved for clustering analysis. Cell clusters are identified by k-means clustering, using the kmeans function in R with default parameters. Optimal choice of k is discussed in Additional file <xref rid="MOESM1" ref-type="media">1</xref>. To improve robustness, 20 independent runs of k-means clustering with different random initializations are applied to each dataset, and the optimal clustering result is selected.</p>
      </sec>
      <sec id="Sec14">
        <title>Step 3. Combining the results from steps 1 and 2 via a cluster-aware, weighted ensemble approach</title>
        <p id="Par49">We adapted the weighted consensus clustering algorithm developed by Li and Ding [<xref ref-type="bibr" rid="CR13">13</xref>] by further considering cluster-specific weighting. For GiniClust, higher weights are assigned to the rare cell clusters and lower weights to common clusters, whereas the opposite scheme is used to weight the outcome from Fano factor-based k-means clustering. This allows us to combine the strengths of each clustering method. The mathematical details are described as follows, and visualized in Fig. <xref rid="Fig1" ref-type="fig">1b</xref>.</p>
        <p id="Par50">Let <italic>P</italic><sup><italic>G</italic></sup> be the partitioning provided by GiniClust, and <italic>P</italic><sup><italic>F</italic></sup> the partitioning provided by Fano factor-based clustering. Each partition consists of a set of clusters: <inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {C}^G={C}_1^G,{C}_2^G,\dots, {C}_{k_G}^G $$\end{document}</tex-math><mml:math id="M10" display="inline"><mml:msup><mml:mi>C</mml:mi><mml:mi>G</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mn>1</mml:mn><mml:mi>G</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mn>2</mml:mn><mml:mi>G</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:msub><mml:mi>k</mml:mi><mml:mi>G</mml:mi></mml:msub><mml:mi>G</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq5.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {C}^F={C}_1^F,{C}_2^F,\dots, {C}_{k_F}^F. $$\end{document}</tex-math><mml:math id="M12" display="inline"><mml:msup><mml:mi>C</mml:mi><mml:mi>F</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mn>1</mml:mn><mml:mi>F</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mn>2</mml:mn><mml:mi>F</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:msub><mml:mi>k</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mi>F</mml:mi></mml:msubsup><mml:mo>.</mml:mo></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq6.gif"/></alternatives></inline-formula> Define the connectivity matrices as:<disp-formula id="Equa"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{ij}\left({P}^G\right)=\left\{{\displaystyle \begin{array}{c}1,\left(i,j\right)\in {C}_k\left({P}^G\right)\\ {}0, otherwise\end{array}}\operatorname{},\mathrm{and}\kern0.28em {M}_{ij}\left({P}^F\right)=\right\{{\displaystyle \begin{array}{c}1,\left(i,j\right)\in {C}_k\left({P}^F\right)\\ {}0, otherwise.\end{array}}\operatorname{} $$\end{document}</tex-math><mml:math id="M14" display="block"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mi>G</mml:mi></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mi>G</mml:mi></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true"/></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mtext>and</mml:mtext></mml:mrow><mml:mspace width="thickmathspace"/><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mi>F</mml:mi></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mi>F</mml:mi></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true"/></mml:mrow></mml:math><graphic xlink:href="13059_2018_1431_Article_Equa.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par51">If two cells are clustered together in the same group, their connectivity is 1, while if they are clustered separately, their connectivity is 0. Define the weighted consensus association as:<disp-formula id="Equb"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \overline{M_{ij}}={w}_{ij}^G{M}_{ij}\left({P}^G\right)+{w}_{ij}^F{M}_{ij}\left({P}^F\right) $$\end{document}</tex-math><mml:math id="M16" display="block"><mml:mover accent="false"><mml:msub><mml:mi>M</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mo>¯</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:msub><mml:mi>M</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:msup><mml:mi>P</mml:mi><mml:mi>G</mml:mi></mml:msup></mml:mfenced><mml:mo>+</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>F</mml:mi></mml:msubsup><mml:msub><mml:mi>M</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:msup><mml:mi>P</mml:mi><mml:mi>F</mml:mi></mml:msup></mml:mfenced></mml:math><graphic xlink:href="13059_2018_1431_Article_Equb.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq7"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {w}_{ij}^G+{w}_{ij}^F=1,{w}_{ij}^G,{w}_{ij}^F\ge 0\forall i,j\in \left[1,n\right] $$\end{document}</tex-math><mml:math id="M18" display="inline"><mml:msubsup><mml:mi>w</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>F</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>F</mml:mi></mml:msubsup><mml:mo>≥</mml:mo><mml:mn>0</mml:mn><mml:mo>∀</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mfenced close="]" open="[" separators=","><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfenced></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq7.gif"/></alternatives></inline-formula>, <italic>n</italic> represents the number of cells. Weights <inline-formula id="IEq8"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {w}_{ij}^G $$\end{document}</tex-math><mml:math id="M20" display="inline"><mml:msubsup><mml:mi>w</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>G</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq8.gif"/></alternatives></inline-formula> and <inline-formula id="IEq9"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {w}_{ij}^F $$\end{document}</tex-math><mml:math id="M22" display="inline"><mml:msubsup><mml:mi>w</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>F</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq9.gif"/></alternatives></inline-formula> are specific to each pair of cells, and are determined based on <inline-formula id="IEq10"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\overset{\sim }{w}}_i^G $$\end{document}</tex-math><mml:math id="M24" display="inline"><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mi>G</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq10.gif"/></alternatives></inline-formula> and <inline-formula id="IEq11"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\overset{\sim }{w}}_i^F $$\end{document}</tex-math><mml:math id="M26" display="inline"><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mi>F</mml:mi></mml:msubsup><mml:mspace width="0.25em"/></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq11.gif"/></alternatives></inline-formula>, weights that are specific to each cell.</p>
        <p id="Par52">For simplicity, we set the cell-specific weights for the Fano factor-based clusters as a constant: <inline-formula id="IEq12"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\overset{\sim }{w}}_i^F={f}^{\prime } $$\end{document}</tex-math><mml:math id="M28" display="inline"><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mi>F</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msup><mml:mi>f</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq12.gif"/></alternatives></inline-formula>. The cell-specific GiniClust (<inline-formula id="IEq13"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\overset{\sim }{w}}_i^G\Big) $$\end{document}</tex-math><mml:math id="M30"><mml:msubsup><mml:mrow><mml:mover><mml:mi>w</mml:mi><mml:mn>~</mml:mn></mml:mover></mml:mrow><mml:mi>i</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq13.gif"/></alternatives></inline-formula> weights are determined as a function of the size of the cluster containing the particular cell. Our choices for these weights derive from the observation that as the proportion of the rare cell type increases, the utility of GiniClust begins to decline. For simplicity, we model the cell-specific GiniClust weights using a logistic curve, specified by the following function:<disp-formula id="Equc"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\overset{\sim }{w}}_i^G\left({x}_i\right)=1-\frac{1}{1+{e}^{-\frac{x_i-{\mu}^{\prime }}{s^{\prime }}}} $$\end{document}</tex-math><mml:math id="M32" display="block"><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:mfenced close=")" open="("><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msup><mml:mi>μ</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:msup><mml:mi>s</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mfrac></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="13059_2018_1431_Article_Equc.gif" position="anchor"/></alternatives></disp-formula>where <italic>x</italic><sub><italic>i</italic></sub> is the proportion of the GiniClust cluster to which cell i belongs, <italic>μ'</italic> is the rare cell type proportion at which GiniClust and Fano factor-based clustering methods have approximately the same ability to detect rare cell types, and <italic>s'</italic> represents how quickly GiniClust loses its ability to detect rare cell types above <italic>μ'</italic>. The parameters <italic>s'</italic>, <italic>μ'</italic>, and <italic>f'</italic> can be viewed as intermediate variables that are closely associated with the parameters <italic>s</italic>, <italic>μ</italic>, and <italic>f</italic>, schematically shown in Fig. <xref rid="Fig1" ref-type="fig">1c</xref><bold>.</bold> Specifically, <inline-formula id="IEq14"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ f=\frac{f^{\prime }}{1+{f}^{\prime }} $$\end{document}</tex-math><mml:math id="M34" display="inline"><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:msup><mml:mi>f</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mi>f</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq14.gif"/></alternatives></inline-formula>, <italic>s</italic> = <italic>s'</italic>, and <italic>μ</italic> is obtained relative to the other parameters through the following relationship: <inline-formula id="IEq15"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {f}^{\prime }=1-\frac{1}{1+{e}^{-\frac{\mu -{\mu}^{\prime }}{s^{\prime }}}} $$\end{document}</tex-math><mml:math id="M36" display="inline"><mml:msup><mml:mi>f</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>μ</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mi>μ</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:msup><mml:mi>s</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mfrac></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="13059_2018_1431_Article_IEq15.gif"/></alternatives></inline-formula>. The selection of the parameter values for <italic>s'</italic>, <italic>μ'</italic>, and <italic>f'</italic>, as well as a sensitivity analysis, are described in Additional file <xref rid="MOESM1" ref-type="media">1</xref>.</p>
        <p id="Par53">To set the cell pair-specific weights, we first define<disp-formula id="Equd"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\tilde{w}}_{ij}^G=\max \left({\tilde{w}}_i^G,{\tilde{w}}_j^G\ \right)\;\mathrm{and}\;{\tilde{w}}_{ij}^F={\tilde{w}}_i^F $$\end{document}</tex-math><mml:math id="M38" display="block"><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">˜</mml:mo></mml:mover><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mo>max</mml:mo><mml:mfenced close=")" open="(" separators=","><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">˜</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">˜</mml:mo></mml:mover><mml:mi>j</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:mspace width="0.25em"/></mml:mrow></mml:mfenced><mml:mspace width="0.12em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.12em"/><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">˜</mml:mo></mml:mover><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>F</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">˜</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mi>F</mml:mi></mml:msubsup></mml:math><graphic xlink:href="13059_2018_1431_Article_Equd.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par54">Then, weights are normalized to 1:<disp-formula id="Eque"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {w}_{ij}^G=\frac{{\tilde{w}}_{ij}^G}{{\tilde{w}}_{ij}^G+{\tilde{w}}_{ij}^F}\;\mathrm{and}\;{w}_{ij}^F=\frac{{\tilde{w}}_{ij}^F}{{\tilde{w}}_{ij}^G+{\tilde{w}}_{ij}^F} $$\end{document}</tex-math><mml:math id="M40" display="block"><mml:msubsup><mml:mi>w</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">˜</mml:mo></mml:mover><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">˜</mml:mo></mml:mover><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">˜</mml:mo></mml:mover><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>F</mml:mi></mml:msubsup></mml:mrow></mml:mfrac><mml:mspace width="0.12em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.12em"/><mml:msubsup><mml:mi>w</mml:mi><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>F</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">˜</mml:mo></mml:mover><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>F</mml:mi></mml:msubsup><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">˜</mml:mo></mml:mover><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo stretchy="true">˜</mml:mo></mml:mover><mml:mi mathvariant="italic">ij</mml:mi><mml:mi>F</mml:mi></mml:msubsup></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="13059_2018_1431_Article_Eque.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par55">Each cell–cell pair will thus be assigned a weighted consensus association between 0 and 1, which is a weighted average of both GiniClust and Fano factor-based clustering associations, where the weights are functions of the size of the cell clusters.</p>
        <p id="Par56">At this point, the weighted consensus association matrix provides a probabilistic clustering for each cell, where each entry represents the probability that cell i and cell j reside in the same cluster. To transform this into a final deterministic clustering assignment, we optimize the following:<disp-formula id="Equf"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\mathit{\min}}_U{\left|\left|\overline{M}-U\right|\right|}^2, $$\end{document}</tex-math><mml:math id="M42" display="block"><mml:msub><mml:mo mathvariant="italic">min</mml:mo><mml:mi>U</mml:mi></mml:msub><mml:msup><mml:mfenced close="|" open="|"><mml:mfenced close="|" open="|"><mml:mrow><mml:mover accent="false"><mml:mi>M</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mo>−</mml:mo><mml:mi>U</mml:mi></mml:mrow></mml:mfenced></mml:mfenced><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:math><graphic xlink:href="13059_2018_1431_Article_Equf.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par57">where <italic>U</italic> is any possible connectivity matrix. In Li and Ding [<xref ref-type="bibr" rid="CR13">13</xref>], this optimization problem is solved via symmetric non-negative matrix factorization (NMF) to yield a soft clustering. To obtain a hard clustering we add an orthogonality constraint, leading to k-means clustering [<xref ref-type="bibr" rid="CR26">26</xref>], implemented once again using the kmeans R function.</p>
      </sec>
    </sec>
    <sec id="Sec15">
      <title>tSNE visualization</title>
      <p id="Par58">Dimension reduction by tSNE [<xref ref-type="bibr" rid="CR27">27</xref>] is performed using the Rtsne R package. The tSNE algorithm is first run using the Gini-based distance to obtain a one-dimensional projection of each cell. For large data sets, tSNE is run on the first 50 principal components of the Gini-based distance to prevent tSNE from becoming prohibitively slow. Then, the tSNE algorithm is run using the first 50 principal components of our Fano-based Euclidean distance to obtain a separate two-dimensional projection. The three resulting dimensions (one for Gini-based distance and two for Fano-based distance) are plotted to visualize cluster separation.</p>
    </sec>
    <sec id="Sec16">
      <title>Differential expression analysis on resulting clusters</title>
      <p id="Par59">Differentially expressed genes for each cluster are determined by comparing their gene expression levels to all other clusters. This is performed using the zlm.SingleCellAssay function in the R MAST package [<xref ref-type="bibr" rid="CR28">28</xref>], with method = “glm”. <italic>P</italic> values for differentially expressed genes are calculated using the lrTest function, with a hurdle model.</p>
    </sec>
    <sec id="Sec17">
      <title>SC3 analysis</title>
      <p id="Par60">SC3 [<xref ref-type="bibr" rid="CR4">4</xref>] was accessed through the SC3 Bioconductor R package. SC3 was applied to the simulated data set post-filtering using default parameters, with k = 6 to match the true number of clusters. The author-recommended choice of k using the Tracy-Widom test yielded a k of 55, and was deemed inappropriate for this analysis.</p>
    </sec>
    <sec id="Sec18">
      <title>CSPA analysis</title>
      <p id="Par61">Matlab code for the CSPA [<xref ref-type="bibr" rid="CR16">16</xref>] was accessed through <ext-link ext-link-type="uri" xlink:href="http://strehl.com/soft.html">http://strehl.com/soft.html</ext-link>, under “ClusterPack_V2.0.” CSPA was applied to the Gini and Fano-based clustering results for the simulated data set, using the clusterensemble function, specifying the CSPA option. Results are shown for k = 5, the default parameter, and k = 6, the true number of clusters.</p>
    </sec>
    <sec id="Sec19">
      <title>RaceID2 analysis</title>
      <p id="Par62">RaceID2 [<xref ref-type="bibr" rid="CR10">10</xref>] R scripts were accessed through <ext-link ext-link-type="uri" xlink:href="https://github.com/dgrun/RaceID">https://github.com/dgrun/StemID</ext-link>. RaceID2 was applied to already-filtered data sets as above to make results directly comparable to GiniClust2, with default parameters. Results are shown for k set to the default parameter as determined by a within-cluster dispersion saturation metric [<xref ref-type="bibr" rid="CR10">10</xref>], and k set to match the corresponding GiniClust2 k parameter specification.</p>
    </sec>
    <sec id="Sec20">
      <title>Hierarchical clustering analysis</title>
      <p id="Par63">Hierarchical clustering was performed on a Fano-based Euclidean distance using the hclust function in R. For the simulated data analysis, results are shown for choices k = 6, to match the true number of clusters, and k = 2, the parameter value as determined by the gap statistic through the clusGap function in R. For the subsampled PBMC analysis, results are shown for k = 3, to match the true number of clusters.</p>
    </sec>
    <sec id="Sec21">
      <title>Community detection analysis</title>
      <p id="Par64">Community detection was performed on a k-nearest neighbor (kNN) graph, using a high Fano feature space, for simulated and subsampled data sets. Function nn2 in the RANN R package was used to compute a kNN distance with default parameters. The igraph R package was used to perform community detection, using the cluster_edge_betweenness function with default parameters.</p>
    </sec>
    <sec id="Sec22">
      <title>Simulation details</title>
      <p id="Par65">We created synthetic data following the same approach as Jiang et al. [<xref ref-type="bibr" rid="CR11">11</xref>], specifying one large 2000 cell cluster, one large 1000 cell cluster, and four rare clusters of 10, 6, 4, and 3 cells, respectively. Gene expression levels are modeled using a negative binomial distribution, and distribution parameters are estimated using an intestinal scRNA-seq data set using a background noise model as in Grün et al. [<xref ref-type="bibr" rid="CR9">9</xref>]. To create clusters with distinct gene expression patterns, we permute 100 lowly (mean &lt; 10 counts) and 100 highly (mean &gt; 10 counts) expressed gene labels for each cluster (see Jiang et al. [<xref ref-type="bibr" rid="CR11">11</xref>] for more details). This results in a 23,538 gene by 3023 cell data set. After filtering (as above) we are left with 3708 genes and 3023 cells.</p>
    </sec>
    <sec id="Sec23">
      <title>10X Genomics data subsampling</title>
      <p id="Par66">The full 68 k 10X Genomics PBMC dataset is down-sampled for model evaluation. We consider only three cell types here. CD19+ B cells are defined by their correlation to reference transcriptomes as in Zheng et al. [<xref ref-type="bibr" rid="CR17">17</xref>]. CD14+ monocytes and CD56+ NK cells are defined in the same way, but here we recognize that these broadly defined cell types actually consist of two subtypes each. We therefore use additional known markers to refine each cell type definition. With regard to CD14+ monocytes, we use macrophage markers <italic>Cd68</italic> and <italic>Cd37</italic> [<xref ref-type="bibr" rid="CR21">21</xref>] to separate macrophages and monocytes, and we define macrophage cells as those with positive expression of both markers. These cells are selected for subsampling. The CD56+ NK cells are composed of NK and NKT cells, so we use T-cell markers <italic>Cd3d</italic>, <italic>Cd3e</italic>, and <italic>Cd3g</italic> [<xref ref-type="bibr" rid="CR21">21</xref>] to separate the groups, and define the NK cells as those with zero expression of these three markers. There is some additional heterogeneity in this NK group, so we choose to include only those NK cells that were most highly correlated (top 50%) to the reference transcriptomes. Given these cell type definitions, we created seven sets of 20 subsampled data sets each for a total of 140 data sets in the following manner: five cells were randomly sampled from the macrophage cell population to form a “rare” cell group for all 120 datasets. Then, for each set of 20 data sets, cells were randomly sampled from the NK and B cells in specified numbers to form “common” cell clusters, the details of which are listed in Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Table S1.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Additional files</title>
    <sec id="Sec24">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="13059_2018_1431_MOESM1_ESM.docx">
            <label>Additional file 1:</label>
            <caption>
              <p>Supplementary information. (DOCX 38 kb)</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="13059_2018_1431_MOESM2_ESM.pdf">
            <label>Additional file 2:</label>
            <caption>
              <p>Supplementary Figures S1–S10, Supplementary Table S1. (PDF 1509 kb)</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>ARI</term>
        <def>
          <p id="Par2">Adjusted rand index</p>
        </def>
      </def-item>
      <def-item>
        <term>CSPA</term>
        <def>
          <p id="Par3">Cluster-based similarity partitioning algorithm</p>
        </def>
      </def-item>
      <def-item>
        <term>DBSCAN</term>
        <def>
          <p id="Par4">Density-based spatial clustering of applications with noise</p>
        </def>
      </def-item>
      <def-item>
        <term>kNN</term>
        <def>
          <p id="Par5">k-Nearest neighbor</p>
        </def>
      </def-item>
      <def-item>
        <term>LIF</term>
        <def>
          <p id="Par6">Leukemia inhibitory factor</p>
        </def>
      </def-item>
      <def-item>
        <term>MAST</term>
        <def>
          <p id="Par7">Model-based analysis of single-cell transcriptomics</p>
        </def>
      </def-item>
      <def-item>
        <term>MCC</term>
        <def>
          <p id="Par8">Matthews correlation coefficient</p>
        </def>
      </def-item>
      <def-item>
        <term>mESC</term>
        <def>
          <p id="Par9">Mouse embryonic stem cell</p>
        </def>
      </def-item>
      <def-item>
        <term>NK</term>
        <def>
          <p id="Par10">Natural killer</p>
        </def>
      </def-item>
      <def-item>
        <term>NMF</term>
        <def>
          <p id="Par11">Non-negative matrix factorization</p>
        </def>
      </def-item>
      <def-item>
        <term>NMI</term>
        <def>
          <p id="Par12">Normalized mutual information</p>
        </def>
      </def-item>
      <def-item>
        <term>PBMC</term>
        <def>
          <p id="Par13">Peripheral blood mononuclear cell</p>
        </def>
      </def-item>
      <def-item>
        <term>PCA</term>
        <def>
          <p id="Par14">Principal component analysis</p>
        </def>
      </def-item>
      <def-item>
        <term>PrEn</term>
        <def>
          <p id="Par15">Primitive endoderm</p>
        </def>
      </def-item>
      <def-item>
        <term>RaceID</term>
        <def>
          <p id="Par16">Rare cell type identification</p>
        </def>
      </def-item>
      <def-item>
        <term>scRNA-seq</term>
        <def>
          <p id="Par17">Single-cell RNA-sequencing</p>
        </def>
      </def-item>
      <def-item>
        <term>tSNE</term>
        <def>
          <p id="Par18">t-Distributed stochastic neighbor embedding</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Electronic supplementary material</bold>
      </p>
      <p>The online version of this article (10.1186/s13059-018-1431-3) contains supplementary material, which is available to authorized users.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank Dr. Lan Jiang and members of the Yuan Lab for helpful discussions, as well as Drs. John Quackenbush and Martin Aryee for their support and advice.</p>
    <sec id="FPar1">
      <title>Funding</title>
      <p id="Par67">This work was supported by a Claudia Barr Award, a Bridge Award, and NIH grant R01HL119099 to GCY. DT’s research was in part supported by an NIH training grant, T32GM074897.</p>
    </sec>
    <sec id="FPar2">
      <title>Availability of data and materials</title>
      <p id="Par68">GiniClust2 is implemented in R and the source code has been deposited at <ext-link ext-link-type="uri" xlink:href="https://github.com/dtsoucas/GiniClust2">https://github.com/dtsoucas/GiniClust2</ext-link>. This open-source software is released under the MIT license, and accessible under the DOI: 10.5281/zenodo.1211359 [<xref ref-type="bibr" rid="CR29">29</xref>].</p>
      <p id="Par69">The intestinal scRNA-seq data used in the creation of the simulated data set is available through the Gene Expression Omnibus (GEO) under the accession number GSE62270 [<xref ref-type="bibr" rid="CR30">30</xref>]. The mouse ESC scRNA-seq data are available through GEO under the accession number GSE65525 [<xref ref-type="bibr" rid="CR31">31</xref>]. The 10X PBMC data are available through NCBI Sequence Read Archive (SRA) under the accession number SRP073767 [<xref ref-type="bibr" rid="CR32">32</xref>].</p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>DT and GCY conceived of and designed the computational method. DT implemented the method. DT and GCY wrote the manuscript. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="COI-statement">
    <sec id="FPar3">
      <title>Ethics approval and consent to participate</title>
      <p id="Par73">Not applicable.</p>
    </sec>
    <sec id="FPar4">
      <title>Competing interests</title>
      <p id="Par70">The authors declare that they have no competing interests.</p>
    </sec>
    <sec id="FPar5">
      <title>Publisher’s Note</title>
      <p id="Par71">Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </sec>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tsoucas</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>GC</given-names>
          </name>
        </person-group>
        <article-title>Recent progress in single-cell cancer genomics</article-title>
        <source>Curr Opin Genet Dev</source>
        <year>2017</year>
        <volume>42</volume>
        <fpage>22</fpage>
        <lpage>32</lpage>
        <pub-id pub-id-type="doi">10.1016/j.gde.2017.01.002</pub-id>
        <?supplied-pmid 28126650?>
        <pub-id pub-id-type="pmid">28126650</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stegle</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Computational and analytical challenges in single-cell transcriptomics</article-title>
        <source>Nat Rev Genet</source>
        <year>2015</year>
        <volume>16</volume>
        <fpage>133</fpage>
        <lpage>145</lpage>
        <pub-id pub-id-type="doi">10.1038/nrg3833</pub-id>
        <?supplied-pmid 25628217?>
        <pub-id pub-id-type="pmid">25628217</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Farrell</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Gennert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schier</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Spatial reconstruction of single-cell gene expression data</article-title>
        <source>Nat Biotechnol</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>495</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3192</pub-id>
        <?supplied-pmid 25867923?>
        <pub-id pub-id-type="pmid">25867923</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kiselev</surname>
            <given-names>VY</given-names>
          </name>
          <name>
            <surname>Kirschner</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Schaub</surname>
            <given-names>MT</given-names>
          </name>
          <name>
            <surname>Andrews</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Yiu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Chandra</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Natarajan</surname>
            <given-names>KN</given-names>
          </name>
          <name>
            <surname>Reik</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Barahona</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Green</surname>
            <given-names>AR</given-names>
          </name>
          <name>
            <surname>Hemberg</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>SC3: consensus clustering of single-cell RNA-seq data</article-title>
        <source>Nat Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>483</fpage>
        <lpage>486</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4236</pub-id>
        <?supplied-pmid 28346451?>
        <pub-id pub-id-type="pmid">28346451</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Giecold</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Marco</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Garcia</surname>
            <given-names>SP</given-names>
          </name>
          <name>
            <surname>Trippa</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>GC</given-names>
          </name>
        </person-group>
        <article-title>Robust lineage reconstruction from high-dimensional single-cell data</article-title>
        <source>Nucleic Acids Res</source>
        <year>2016</year>
        <volume>44</volume>
        <fpage>e122</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkw452</pub-id>
        <?supplied-pmid 27207878?>
        <pub-id pub-id-type="pmid">27207878</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shekhar</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Lapan</surname>
            <given-names>SW</given-names>
          </name>
          <name>
            <surname>Whitney</surname>
            <given-names>IE</given-names>
          </name>
          <name>
            <surname>Tran</surname>
            <given-names>NM</given-names>
          </name>
          <name>
            <surname>Macosko</surname>
            <given-names>EZ</given-names>
          </name>
          <name>
            <surname>Kowalczyk</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Adiconis</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Levin</surname>
            <given-names>JZ</given-names>
          </name>
          <name>
            <surname>Nemesh</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Goldman</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive classification of retinal bipolar neurons by single-cell transcriptomics</article-title>
        <source>Cell</source>
        <year>2016</year>
        <volume>166</volume>
        <fpage>1308</fpage>
        <lpage>1323.e1330</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2016.07.054</pub-id>
        <?supplied-pmid 27565351?>
        <pub-id pub-id-type="pmid">27565351</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeisel</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Muñoz-Manchado</surname>
            <given-names>AB</given-names>
          </name>
          <name>
            <surname>Codeluppi</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lönnerberg</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Juréus</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Marques</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Munguba</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>He</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Betsholtz</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Brain structure. Cell types in the mouse cortex and hippocampus revealed by single-cell RNA-seq</article-title>
        <source>Science</source>
        <year>2015</year>
        <volume>347</volume>
        <fpage>1138</fpage>
        <lpage>1142</lpage>
        <pub-id pub-id-type="doi">10.1126/science.aaa1934</pub-id>
        <?supplied-pmid 25700174?>
        <pub-id pub-id-type="pmid">25700174</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tasic</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Menon</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Nguyen</surname>
            <given-names>TN</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>TK</given-names>
          </name>
          <name>
            <surname>Jarsky</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Yao</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Levi</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Gray</surname>
            <given-names>LT</given-names>
          </name>
          <name>
            <surname>Sorensen</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Dolbeare</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Adult mouse cortical cell taxonomy revealed by single cell transcriptomics</article-title>
        <source>Nat Neurosci</source>
        <year>2016</year>
        <volume>19</volume>
        <fpage>335</fpage>
        <lpage>346</lpage>
        <pub-id pub-id-type="doi">10.1038/nn.4216</pub-id>
        <?supplied-pmid 26727548?>
        <pub-id pub-id-type="pmid">26727548</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grün</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Lyubimova</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Kester</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Wiebrands</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Basak</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Sasaki</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Clevers</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>van Oudenaarden</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Single-cell messenger RNA sequencing reveals rare intestinal cell types</article-title>
        <source>Nature</source>
        <year>2015</year>
        <volume>525</volume>
        <fpage>251</fpage>
        <lpage>255</lpage>
        <pub-id pub-id-type="doi">10.1038/nature14966</pub-id>
        <?supplied-pmid 26287467?>
        <pub-id pub-id-type="pmid">26287467</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grün</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Muraro</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Boisset</surname>
            <given-names>JC</given-names>
          </name>
          <name>
            <surname>Wiebrands</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Lyubimova</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Dharmadhikari</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>van den Born</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>van Es</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Jansen</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Clevers</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>De novo prediction of stem cell identity using single-cell transcriptome data</article-title>
        <source>Cell Stem Cell</source>
        <year>2016</year>
        <volume>19</volume>
        <fpage>266</fpage>
        <lpage>277</lpage>
        <pub-id pub-id-type="doi">10.1016/j.stem.2016.05.010</pub-id>
        <?supplied-pmid 27345837?>
        <pub-id pub-id-type="pmid">27345837</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Pinello</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>GC</given-names>
          </name>
        </person-group>
        <article-title>GiniClust: detecting rare cell types from single-cell gene expression data with Gini index</article-title>
        <source>Genome Biol</source>
        <year>2016</year>
        <volume>17</volume>
        <fpage>144</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-016-1010-4</pub-id>
        <?supplied-pmid 27368803?>
        <pub-id pub-id-type="pmid">27368803</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shaffer</surname>
            <given-names>SM</given-names>
          </name>
          <name>
            <surname>Dunagin</surname>
            <given-names>MC</given-names>
          </name>
          <name>
            <surname>Torborg</surname>
            <given-names>SR</given-names>
          </name>
          <name>
            <surname>Torre</surname>
            <given-names>EA</given-names>
          </name>
          <name>
            <surname>Emert</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Krepler</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Beqiri</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Sproesser</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Brafford</surname>
            <given-names>PA</given-names>
          </name>
          <name>
            <surname>Xiao</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Rare cell variability and drug-induced reprogramming as a mode of cancer drug resistance</article-title>
        <source>Nature</source>
        <year>2017</year>
        <volume>546</volume>
        <fpage>431</fpage>
        <lpage>435</lpage>
        <pub-id pub-id-type="doi">10.1038/nature22794</pub-id>
        <?supplied-pmid 28607484?>
        <pub-id pub-id-type="pmid">28607484</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <mixed-citation publication-type="other">Li T, Ding C. Weighted consensus clustering. In: SIAM International Conference on Data Mining. Philadelphia: Society for Industrial and Applied Mathematics; 2008.</mixed-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tibshirani</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Walther</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Hastie</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>Estimating the number of clusters in a data set via the gap statistic</article-title>
        <source>J R Stat Soc Series B Stat Methodol</source>
        <year>2001</year>
        <volume>63</volume>
        <fpage>411</fpage>
        <lpage>423</lpage>
        <pub-id pub-id-type="doi">10.1111/1467-9868.00293</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <mixed-citation publication-type="other">Kodinariya T, Makwana P. Review on determining number of cluster in k-means clustering. Int J. 2013;1(6):90–5.</mixed-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Strehl</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Ghosh</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Cluster ensembles--a knowledge reuse framework for combining multiple partitions</article-title>
        <source>J Mach Learn Res</source>
        <year>2002</year>
        <volume>3</volume>
        <fpage>583</fpage>
        <lpage>617</lpage>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>GX</given-names>
          </name>
          <name>
            <surname>Terry</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Belgrader</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Ryvkin</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Bent</surname>
            <given-names>ZW</given-names>
          </name>
          <name>
            <surname>Wilson</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Ziraldo</surname>
            <given-names>SB</given-names>
          </name>
          <name>
            <surname>Wheeler</surname>
            <given-names>TD</given-names>
          </name>
          <name>
            <surname>McDermott</surname>
            <given-names>GP</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>
        <source>Nat Commun</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>14049</fpage>
        <pub-id pub-id-type="doi">10.1038/ncomms14049</pub-id>
        <?supplied-pmid 28091601?>
        <pub-id pub-id-type="pmid">28091601</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Matthews</surname>
            <given-names>BW</given-names>
          </name>
        </person-group>
        <article-title>Comparison of the predicted and observed secondary structure of T4 phage lysozyme</article-title>
        <source>Biochim Biophys Acta</source>
        <year>1975</year>
        <volume>405</volume>
        <fpage>442</fpage>
        <lpage>451</lpage>
        <pub-id pub-id-type="doi">10.1016/0005-2795(75)90109-9</pub-id>
        <?supplied-pmid 1180967?>
        <pub-id pub-id-type="pmid">1180967</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Klein</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Mazutis</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Akartuna</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Tallapragada</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Veres</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Peshkin</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Weitz</surname>
            <given-names>DA</given-names>
          </name>
          <name>
            <surname>Kirschner</surname>
            <given-names>MW</given-names>
          </name>
        </person-group>
        <article-title>Droplet barcoding for single-cell transcriptomics applied to embryonic stem cells</article-title>
        <source>Cell</source>
        <year>2015</year>
        <volume>161</volume>
        <fpage>1187</fpage>
        <lpage>1201</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2015.04.044</pub-id>
        <?supplied-pmid 26000487?>
        <pub-id pub-id-type="pmid">26000487</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Danon L, Diaz-Guilera A, Duch J, Arenas A. Comparing community structure identification. J Stat Mech Theory Exp:P09008.</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Newman</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>CL</given-names>
          </name>
          <name>
            <surname>Green</surname>
            <given-names>MR</given-names>
          </name>
          <name>
            <surname>Gentles</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Feng</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Hoang</surname>
            <given-names>CD</given-names>
          </name>
          <name>
            <surname>Diehn</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Alizadeh</surname>
            <given-names>AA</given-names>
          </name>
        </person-group>
        <article-title>Robust enumeration of cell subsets from tissue expression profiles</article-title>
        <source>Nat Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <fpage>453</fpage>
        <lpage>457</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3337</pub-id>
        <?supplied-pmid 25822800?>
        <pub-id pub-id-type="pmid">25822800</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schinnerling</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>García-González</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Aguillón</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Gene expression profiling of human monocyte-derived dendritic cells - searching for molecular regulators of tolerogenicity</article-title>
        <source>Front Immunol</source>
        <year>2015</year>
        <volume>6</volume>
        <fpage>528</fpage>
        <pub-id pub-id-type="doi">10.3389/fimmu.2015.00528</pub-id>
        <?supplied-pmid 26539195?>
        <pub-id pub-id-type="pmid">26539195</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolpert</surname>
            <given-names>DH</given-names>
          </name>
          <name>
            <surname>Macready</surname>
            <given-names>WG</given-names>
          </name>
        </person-group>
        <article-title>No free lunch theorems for optimization</article-title>
        <source>IEEE Trans Evol Comput</source>
        <year>1997</year>
        <volume>1</volume>
        <fpage>67</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="doi">10.1109/4235.585893</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">The Human Cell Atlas. <ext-link ext-link-type="uri" xlink:href="https://www.humancellatlas.org">https://www.humancellatlas.org</ext-link>. Accessed 12 Dec 2017.</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <mixed-citation publication-type="other">Ester M, Kriegel H-P, Sander J, Xu X. A density-based algorithm for discovering clusters in large spatial databases with noise. In: 2nd International Conference on Knowledge Discovery and Data Mining; Portland, OR. Menlo Park: AAAI; 1996. p. 226–31.</mixed-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <mixed-citation publication-type="other">Ding C, He X, Simon H. On the equivalence of nonnegative matrix factorization and spectral clustering. In: SIAM International Conference on Data Mining. Philadelphia: Society for Industrial and Applied Mathematics; 2005. p. 606–10.</mixed-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Maaten</surname>
            <given-names>LVD</given-names>
          </name>
          <name>
            <surname>Hinton</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Visualizing data using t-SNE</article-title>
        <source>J Mach Learn Res</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>2579</fpage>
        <lpage>2605</lpage>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Finak</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>McDavid</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Yajima</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Deng</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Gersuk</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Shalek</surname>
            <given-names>AK</given-names>
          </name>
          <name>
            <surname>Slichter</surname>
            <given-names>CK</given-names>
          </name>
          <name>
            <surname>Miller</surname>
            <given-names>HW</given-names>
          </name>
          <name>
            <surname>McElrath</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Prlic</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MAST: a flexible statistical framework for assessing transcriptional changes and characterizing heterogeneity in single-cell RNA sequencing data</article-title>
        <source>Genome Biol</source>
        <year>2015</year>
        <volume>16</volume>
        <fpage>278</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-015-0844-5</pub-id>
        <?supplied-pmid 26653891?>
        <pub-id pub-id-type="pmid">26653891</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <mixed-citation publication-type="other">Tsoucas D, Yuan G. GiniClust2. Zenodo. 2018. 10.5281/zenodo.1211359.</mixed-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <mixed-citation publication-type="other">Grün D, Lyubimova A, Kester L, Wiebrands K, Basak O, Sasaki N, Clevers H, van Oudenaarden A. Single-cell mRNA sequencing reveals rare intestinal cell types. NCBI GEO database. 2015. <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE62270">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE62270</ext-link>. Accessed 2 Apr 2018.</mixed-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <mixed-citation publication-type="other">Klein A, Mazutis L, Akartuna I, Tallapragada N, Veres A, Li V, Peshkin L, Weitz D, Kirschner M. Droplet barcoding for single-cell transcriptomics applied to embryonic stem cells. NCBI GEO database. 2015. <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE65525">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE65525</ext-link>. Accessed 2 Apr 2018.</mixed-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <mixed-citation publication-type="other">Zheng G, Terry J, Belgrader P, Ryvkin P, Bent Z, Wilson R, Ziraldo S, Wheeler T, McDermott G, Zhu J, et al. Massively parallel digital transcriptional profiling of single cells. NCBI Sequence Read Archive. 2017. <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/sra/?term=SRP073767">https://www.ncbi.nlm.nih.gov/sra/?term=SRP073767</ext-link>. Accessed 2 Apr 2018.</mixed-citation>
    </ref>
  </ref-list>
</back>
