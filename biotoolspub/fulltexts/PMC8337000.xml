<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8337000</article-id>
    <article-id pub-id-type="pmid">33135074</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btaa924</article-id>
    <article-id pub-id-type="publisher-id">btaa924</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Scool: a new data storage format for single-cell Hi-C data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-9985-955X</contrib-id>
        <name>
          <surname>Wolff</surname>
          <given-names>Joachim</given-names>
        </name>
        <xref rid="btaa924-cor1" ref-type="corresp"/>
        <aff><institution>Bioinformatics Group, Department of Computer Science, University of Freiburg</institution>, Freiburg 79110, <country country="DE">Germany</country></aff>
        <!--wolffj@informatik.uni-freiburg.de-->
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-5814-0864</contrib-id>
        <name>
          <surname>Abdennur</surname>
          <given-names>Nezar</given-names>
        </name>
        <aff><institution>Institute for Medical Engineering and Science, Massachusetts Institute of Technology</institution>, Cambridge, MA 02139, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Backofen</surname>
          <given-names>Rolf</given-names>
        </name>
        <aff><institution>Bioinformatics Group, Department of Computer Science, University of Freiburg</institution>, Freiburg 79110, <country country="DE">Germany</country></aff>
        <aff><institution>Signalling Research Centres BIOSS and CIBSS, University of Freiburg</institution>, Freiburg 79104, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Grüning</surname>
          <given-names>Björn</given-names>
        </name>
        <aff><institution>Bioinformatics Group, Department of Computer Science, University of Freiburg</institution>, Freiburg 79110, <country country="DE">Germany</country></aff>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Robinson</surname>
          <given-names>Peter</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btaa924-cor1">To whom correspondence should be addressed. <email>wolffj@informatik.uni-freiburg.de</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>15</day>
      <month>7</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2020-11-02">
      <day>02</day>
      <month>11</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>02</day>
      <month>11</month>
      <year>2020</year>
    </pub-date>
    <volume>37</volume>
    <issue>14</issue>
    <fpage>2053</fpage>
    <lpage>2054</lpage>
    <history>
      <date date-type="received">
        <day>22</day>
        <month>7</month>
        <year>2020</year>
      </date>
      <date date-type="rev-recd">
        <day>07</day>
        <month>10</month>
        <year>2020</year>
      </date>
      <date date-type="editorial-decision">
        <day>14</day>
        <month>10</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>20</day>
        <month>10</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2020. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2020</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btaa924.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Single-cell Hi-C research currently lacks an efficient, easy to use and shareable data storage format. Recent studies have used a variety of sub-optimal solutions: publishing raw data only, text-based interaction matrices, or reusing established Hi-C storage formats for single interaction matrices. These approaches are storage and pre-processing intensive, require long labour time and are often error-prone.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>The single-cell cooler file format (<italic toggle="yes">scool</italic>) provides an efficient, user-friendly and storage-saving approach for single-cell Hi-C data. It is a flavour of the established cooler format and guarantees stable API support.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>The single-cell cooler format is part of the cooler file format as of API version 0.8.9. It is available via pip, conda and github: <ext-link xlink:href="https://github.com/mirnylab/cooler" ext-link-type="uri">https://github.com/mirnylab/cooler</ext-link>.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>German Science Foundation</institution>
          </institution-wrap>
        </funding-source>
        <award-id>CRC992</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>German Federal Ministry of Education and Research</institution>
          </institution-wrap>
        </funding-source>
        <award-id>031 A538A</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>NBI</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>RBC</institution>
            <institution-id institution-id-type="DOI">10.13039/100012395</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>031 L0101C</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>NBI</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>German Research Foundation</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Germany’s Excellence Strategy</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>CIBSS-EXC-2189-Project</institution>
          </institution-wrap>
        </funding-source>
        <award-id>390939984</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="2"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>The storage, processing and analysis of single-cell Hi-C data face several challenges. First, the pre-processing overhead for single-cell Hi-C is both storage-intensive and time-consuming. For example, reproducing the results of the <xref rid="btaa924-B5" ref-type="bibr">Nagano <italic toggle="yes">et al.</italic> (2017)</xref> single-cell Hi-C study requires downloading, demultiplexing and mapping more than 1.1 TB of compressed raw FASTQ data and creating thousands of interaction matrices. Second, manually handling so many files is unwieldy and prone to error. For example, some studies (<xref rid="btaa924-B4" ref-type="bibr">Nagano <italic toggle="yes">et al.</italic>, 2013</xref>; <xref rid="btaa924-B6" ref-type="bibr">Ramani <italic toggle="yes">et al.</italic>, 2017</xref>; <xref rid="btaa924-B7" ref-type="bibr">Steven <italic toggle="yes">et al.</italic>, 2017</xref>) have published their pre-processed data as text-based files. Depending on the resolution, these files potentially store millions to billions of features in an uncompressed text file without fast random or partial access. By contrast, studies like <xref rid="btaa924-B2" ref-type="bibr">Gassler <italic toggle="yes">et al.</italic> (2017)</xref> published pre-processed <italic toggle="yes">cool</italic> files (<xref rid="btaa924-B1" ref-type="bibr">Abdennur and Mirny, 2019</xref>) for each cell and at multiple resolutions. However, due to redundancy in data storage and the complexitiy of handling a proliferation of files, this one-matrix-per-file approach has limited scalability and makes reproducible analysis challenging.</p>
    <p>Here, we present the single-cell cooler format, a ‘flavour’ of the cooler file format (<xref rid="btaa924-B1" ref-type="bibr">Abdennur and Mirny, 2019</xref>), that stores multiple single-cell sparse Hi-C interaction matrices at a common resolution in a single HDF5 (<xref rid="btaa924-B3" ref-type="bibr">Koziol and Robinson, 2018</xref>) file, allowing portable, space-efficient and fast access to single-cell interaction data. It uses the recommended extension.<italic toggle="yes">scool</italic>.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>We adopt the basic structure of the cooler format to create a collection of single-cell interaction matrices having common dimensions (see <xref rid="btaa924-F1" ref-type="fig">Fig. 1 A and B</xref>). Internally, all single-cell interaction matrices are stored under a group/cells and each matrix is identified by a unique cell ID and has the structure of a standard cooler <italic toggle="yes">data collection</italic> (<xref rid="btaa924-F1" ref-type="fig">Fig. 1A</xref>), allowing it to be read independently and transparently with the regular cooler API (see Listing 2). However, to eliminate redundancy, data structures that are shared between all cells are implemented as HDF5 hard-links pointing to the data that is shared between the cells, which is stored in the root group (<xref rid="btaa924-F1" ref-type="fig">Fig. 1B</xref>). These include the index-associated genomic coordinates of the Hi-C contacts:/bins/chrom,/bins/start,/bins/end, and the general information about the stored chromosomes:/chroms. These shared data structures provide significant space reduction when consolidating contact maps from a multitude of cells into a single file as opposed to use a large collection of separate cooler files. As a matrix format, a scool file stores binned contact data conforming to a specific genomic segmentation. While binning naturally leads to a loss of information and comparing datasets can be difficult when bin sizes are not compatible, single-cell cooler files can be binned at any resolution and even lossless contact maps can be produced using 1-bp resolution, if desired.</p>
    <fig position="float" id="btaa924-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>(<bold>A</bold>) The structure of the cooler file format from <xref rid="btaa924-B1" ref-type="bibr">Abdennur and Mirny (2019)</xref>. (<bold>B</bold>) The structure of the single-cell cooler file format as a flavour of the cooler format. Hard linked groups and arrays are denoted with the curved arrow icon</p>
      </caption>
      <graphic xlink:href="btaa924f1" position="float"/>
    </fig>
    <sec>
      <title>2.1 Metadata</title>
      <p>The single-cell cooler format stores specific metadata HDF5 attributes at the root level of the file: the format string HDF5::SCOOL, the format-version, whether the bin-type is fixed or variable, the bin-size, the genome assembly, the number of stored cells ncells and the optional field metadata for quality information or other user metadata.</p>
    </sec>
    <sec>
      <title>2.2 Creation</title>
      <p>To create a single-cell cooler file, the API can be used by calling the function <italic toggle="yes">cooler.create_scool</italic> and providing a file name, a dictionary of <italic toggle="yes">bins</italic> with the unique cell name as key (or a global common bin table, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>) and a dictionary mapping unique cell names to pixel information (Listing 1).</p>
      <p>
        <boxed-text id="btaa924-BOX1" position="float">
          <p>import cooler</p>
          <p>bins_dict = {’cell1’: bins1, ’cell2’: bins2}</p>
          <p>pixel_dict = {’cell1’: pixels1, ’cell2’: pixels2}</p>
          <p>cooler.create_scool(cool_uri=file_name, bins=bins_dict,</p>
          <p> cell_name_pixels_dict=pixel_dict)</p>
          <p><bold>Listing 1</bold> Python API example to create a scool file</p>
        </boxed-text>
      </p>
    </sec>
    <sec>
      <title>2.3 Access</title>
      <p>The interaction matrices in a single-cell cooler file can be listed with <italic toggle="yes">cooler.fileops.list_coolers</italic>. The interaction matrix of one cell can be retrieved using the resource syntax:</p>
      <p>
        <boxed-text id="btaa924-BOX2" position="float">
          <p>if cooler.fileops.is_scool_file(file_path):</p>
          <p> matrices_list = cooler.fileops.list_scool_cells(</p>
          <p>  file_path)</p>
          <p> for cell in matrices_list:</p>
          <p>  clr = cooler. Cooler(file_path + ‘::’ + cell)</p>
          <p><bold>Listing 2</bold> Python API example to read cells of a scool file</p>
        </boxed-text>
      </p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>The single-cell Hi-C data provided by <xref rid="btaa924-B5" ref-type="bibr">Nagano <italic toggle="yes">et al.</italic> (2017)</xref> as raw FASTQ files has a compressed size of more than 1 TB. After demultiplexing, mapping and matrix creation several terabytes are consumed. At 10 kb resolution, 3882 individual cool files have a size of 3 GB, which is reduced to 1.9 GB using scool. At 1 MB, the cool files require 350 MB and the scool 267 MB. <xref rid="btaa924-B2" ref-type="bibr">Gassler <italic toggle="yes">et al.</italic> (2017)</xref> provide 144 individual cool files at different resolutions. The storage reduction provided by scool is 2300–116 MB at 1 kb; 348–65 MB at 10 kb; 120–28 MB at 40 kb; and 63–26 MB at 100 kb. Compression ratios (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S2</xref>) depend on the density and the resolution of the data. Generally, there is a greater overhead of storing a full bin table for each cell the fewer reads relative to the number of possible interactions and the higher the resolution. For example, the density for the 10 kb single-cell Hi-C data from <xref rid="btaa924-B2" ref-type="bibr">Gassler <italic toggle="yes">et al.</italic> (2017)</xref> is up to 0.0004, while for <xref rid="btaa924-B5" ref-type="bibr">Nagano <italic toggle="yes">et al.</italic> (2017)</xref>, it is up to 0.0012. Accordingly, the scool/cool compression ratio for <xref rid="btaa924-B2" ref-type="bibr">Gassler <italic toggle="yes">et al.</italic> (2017)</xref> (0.193) is better than that for <xref rid="btaa924-B5" ref-type="bibr">Nagano <italic toggle="yes">et al.</italic> (2017)</xref> (0.633). See the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref> for more read coverages, densities and compression rates with respect to text and cooler files.</p>
  </sec>
  <sec>
    <title>4 Conclusion</title>
    <p>The single-cell cooler format makes it possible to store thousands of state-of-the-art single-cell Hi-C matrices in a single file with minimal redundancy. By storing all matrices in a space-efficient way, the reproducibility of single-cell Hi-C analyses is better achievable and the data are more accessible to a broader range of researchers. A portable container format prevents the complexity of managing thousands of files or needing to download and process large amounts of raw data from scratch. The embedding into the cooler API guarantees a fast and reliable access to the individual single-cell matrices and facilitates the use of parallel computing to improve analysis performance. The scool format is ideal for single-cell Hi-C data analysis software and is supported by scHiCExplorer (<xref rid="btaa924-B8" ref-type="bibr">Wolff <italic toggle="yes">et al.</italic>, 2020</xref>).</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>We acknowledge funding from the German Science Foundation [CRC992 ‘Medical Epigenetics’ to R.B. and B.G.]; and German Federal Ministry of Education and Research [031 A538A de. NBI-RBC awarded to R.B. and 031 L0101C de. NBI-epi awarded to B.G.]. R.B. was supported by the German Research Foundation (DFG) under Germany’s Excellence Strategy [CIBSS-EXC-2189-Project ID 390939984].</p>
    <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btaa924_Supplementary_Data</label>
      <media xlink:href="btaa924_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btaa924-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Abdennur</surname><given-names>N.</given-names></string-name>, <string-name><surname>Mirny</surname><given-names>L.A.</given-names></string-name></person-group> (<year>2019</year>) 
<article-title>Cooler: scalable storage for Hi-C data and other genomically labeled arrays</article-title>. <source>Bioinformatics</source>, <volume>36</volume>, <fpage>311</fpage>–<lpage>316</lpage>.</mixed-citation>
    </ref>
    <ref id="btaa924-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gassler</surname><given-names>J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) 
<article-title>A mechanism of cohesin-dependent loop extrusion organizes zygotic genome architecture</article-title>. <source>EMBO J</source>., <volume>36</volume>, <fpage>3600</fpage>–<lpage>3618</lpage>.<pub-id pub-id-type="pmid">29217590</pub-id></mixed-citation>
    </ref>
    <ref id="btaa924-B3">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Koziol</surname><given-names>Q.</given-names></string-name>, <string-name><surname>Robinson</surname><given-names>D.</given-names></string-name></person-group> (<year>2018</year>) <italic toggle="yes">HDF5</italic>. [Computer Software] <pub-id pub-id-type="doi">10.11578/dc.20180330.1</pub-id>.  (22 October 2020, date last accessed).</mixed-citation>
    </ref>
    <ref id="btaa924-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nagano</surname><given-names>T.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) 
<article-title>Single-cell Hi-C reveals cell-to-cell variability in chromosome structure</article-title>. <source>Nature</source>, <volume>502</volume>, <fpage>59</fpage>–<lpage>64</lpage>.<pub-id pub-id-type="pmid">24067610</pub-id></mixed-citation>
    </ref>
    <ref id="btaa924-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nagano</surname><given-names>T.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) 
<article-title>Cell-cycle dynamics of chromosomal organization at single-cell resolution</article-title>. <source>Nature</source>, <volume>547</volume>, <fpage>61</fpage>–<lpage>67</lpage>.<pub-id pub-id-type="pmid">28682332</pub-id></mixed-citation>
    </ref>
    <ref id="btaa924-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ramani</surname><given-names>V.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) 
<article-title>Massively multiplex single-cell Hi-C</article-title>. <source>Nat. Methods</source>, <volume>14</volume>, <fpage>263</fpage>–<lpage>266</lpage>.<pub-id pub-id-type="pmid">28135255</pub-id></mixed-citation>
    </ref>
    <ref id="btaa924-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Steven</surname><given-names>T.J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) 
<article-title>3D structures of individual mammalian genomes studied by single-cell Hi-C</article-title>. <source>Nature</source>, <volume>544</volume>, <fpage>59</fpage>–<lpage>64</lpage>.<pub-id pub-id-type="pmid">28289288</pub-id></mixed-citation>
    </ref>
    <ref id="btaa924-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wolff</surname><given-names>J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) 
<article-title>Galaxy HiCExplorer 3: a web server for reproducible Hi-C, capture Hi-C and single-cell Hi-C data analysis, quality control and visualization</article-title>. <source>Nucleic Acids Res</source>., <volume>48</volume>, <fpage>W177</fpage>–<lpage>W184</lpage>.<pub-id pub-id-type="pmid">32301980</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
