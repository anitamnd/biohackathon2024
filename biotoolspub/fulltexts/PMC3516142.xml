<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3516142</article-id>
    <article-id pub-id-type="pmid">23060610</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/bts565</article-id>
    <article-id pub-id-type="publisher-id">bts565</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Note</subject>
        <subj-group>
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>CD-HIT: accelerated for clustering the next-generation sequencing data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Fu</surname>
          <given-names>Limin</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Niu</surname>
          <given-names>Beifang</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Zhu</surname>
          <given-names>Zhengwei</given-names>
        </name>
        <xref ref-type="author-notes" rid="bts565-FN1">
          <sup>†</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wu</surname>
          <given-names>Sitao</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Weizhong</given-names>
        </name>
        <xref ref-type="corresp" rid="bts565-COR2">*</xref>
      </contrib>
    </contrib-group>
    <aff>Center for Research in Biological Systems, University of California San Diego, La Jolla, CA 92093, USA</aff>
    <author-notes>
      <corresp id="bts565-COR2">*To whom correspondence should be addressed.</corresp>
      <fn id="bts565-FN1">
        <p><sup>†</sup>Present address: Department of Genetics, University of Pennsylvania, Philadelphia, Pennsylvania.</p>
      </fn>
      <fn>
        <p>Associate Editor: Inanc Birol</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>1</day>
      <month>12</month>
      <year>2012</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>11</day>
      <month>10</month>
      <year>2012</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>11</day>
      <month>10</month>
      <year>2012</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>28</volume>
    <issue>23</issue>
    <fpage>3150</fpage>
    <lpage>3152</lpage>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>6</month>
        <year>2012</year>
      </date>
      <date date-type="rev-recd">
        <day>31</day>
        <month>8</month>
        <year>2012</year>
      </date>
      <date date-type="accepted">
        <day>12</day>
        <month>9</month>
        <year>2012</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author 2012. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2012</copyright-year>
      <license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/3.0">
        <license-p><!--CREATIVE COMMONS-->This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/3.0/">http://creativecommons.org/licenses/by/3.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Summary:</bold> CD-HIT is a widely used program for clustering biological sequences to reduce sequence redundancy and improve the performance of other sequence analyses. In response to the rapid increase in the amount of sequencing data produced by the next-generation sequencing technologies, we have developed a new CD-HIT program accelerated with a novel parallelization strategy and some other techniques to allow efficient clustering of such datasets. Our tests demonstrated very good speedup derived from the parallelization for up to ∼24 cores and a quasi-linear speedup for up to ∼8 cores. The enhanced CD-HIT is capable of handling very large datasets in much shorter time than previous versions.</p>
      <p><bold>Availability:</bold><ext-link ext-link-type="uri" xlink:href="http://cd-hit.org">http://cd-hit.org</ext-link>.</p>
      <p>
        <bold>Contact:</bold>
        <email>liwz@sdsc.edu</email>
      </p>
      <p><bold>Supplementary information:</bold><ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts565/DC1">Supplementary data</ext-link> are available at <italic>Bioinformatics</italic> online.</p>
    </abstract>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec id="SEC1">
    <title>1 INTRODUCTION</title>
    <p>Sequence analysis has played a crucial role in computational biology. With the advancement of the next-generation sequencing technologies, the amount of available sequencing data is growing exponentially. Removing redundancy from such data by clustering could be crucial for reducing storage space, computational time and noise interference in some analysis methods, etc.</p>
    <p>CD-HIT was originally developed to cluster protein sequences to create reference databases with reduced redundancy (<xref ref-type="bibr" rid="bts565-B3">Li <italic>et al.</italic>, 2001</xref>) and was then extended to support clustering nucleotide sequences (<xref ref-type="bibr" rid="bts565-B2">Li and Godzik, 2006</xref>). Since its release, CD-HIT has become very widely used for a large variety of applications ranging from non-redundant dataset creation (<xref ref-type="bibr" rid="bts565-B9">Suzek <italic>et al.</italic>, 2007</xref>), protein family classifications (<xref ref-type="bibr" rid="bts565-B11">Yooseph <italic>et al.</italic>, 2008</xref>), artifact identification (<xref ref-type="bibr" rid="bts565-B5">Niu <italic>et al.</italic>, 2010</xref>), metagenomics annotation (<xref ref-type="bibr" rid="bts565-B8">Sun <italic>et al.</italic>, 2011</xref>), RNA analysis (<xref ref-type="bibr" rid="bts565-B4">Loong and Mishra, 2007</xref>), to various prediction studies (<xref ref-type="bibr" rid="bts565-B7">Rubinstein and Fiser, 2008</xref>).</p>
    <p>With sequencing data rapidly growing in public data repositories as well as in individual laboratories, there has been strong demand for an enhanced CD-HIT with greater efficiency. In response to such demand, we have developed this enhanced and parallelized version of CD-HIT, to exploit the fact that multi-core machines have become very common in ordinary laboratories.</p>
    <p>A computer cluster-based parallelization procedure for CD-HIT has been proposed in <xref ref-type="bibr" rid="bts565-B9">Suzek <italic>et al.</italic> (2007)</xref>, though not fully parallelized, this procedure provides good speedup using computer cluster. Since computer clusters are not as easily available as multi-core machines, here we propose an alternative parallelization technique, which assumes shared memory model and works well on multi-core machines.</p>
  </sec>
  <sec id="SEC2">
    <title>2 METHODS</title>
    <p>Basically, CD-HIT is a greedy incremental algorithm that starts with the longest input sequence as the first cluster representative, and then process the remaining sequences from long to short to classify each sequence as a redundant or representative sequence based on its similarities to the existing representatives. The similarities are estimated by common word counting using word indexing and counting tables to filter out unnecessary sequence alignments, which are used to compute exact similarities. In the following sections, we will describe the techniques that are used to accelerate CD-HIT.</p>
    <sec id="SEC2.1">
      <title>2.1 Simplification</title>
      <p>In order to support full parallelization, the core steps of CD-HIT have been simplified into two key procedures: a checking procedure and a clustering procedure. Using these two procedures, the algorithm requires at most two word tables without the need to swap them to disk, which was necessary in the original CD-HIT due to the use of multiple tables for large datasets.</p>
      <p>Given a word table, the checking procedure checks each of the remaining sequences against the table and determines whether it is a redundant sequence. The clustering procedure will make a final determination of the status of a sequence, and if it is classified as a representative sequence, it is used to update the word table. A more detailed description with illustration is available in <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts565/DC1">Supplementary Material Section 1.2</ext-link> and <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts565/DC1">Figure S1</ext-link>.</p>
    </sec>
    <sec id="SEC2.2">
      <title>2.2 Parallelization</title>
      <p>Given <italic>T</italic> threads or cores, the basic idea of our novel parallelization technique is to use two word tables and use <italic>T</italic>−1 threads to run multiple checking procedures using one word table (a immutable checking table), and the remaining thread to run a single clustering procedure using the other table (a mutable clustering table) in parallel. Due to the sequential characteristics of CD-HIT, it will require properly grouping the input sequences and switch the word tables to guarantee the correctness of the parallelization.</p>
      <p>This is achieved by dividing each round of computation into two stages. The first stage is to run <italic>T</italic> checking procedures on the sequence group defined for this round of computation using the word table (checking table) from the previous round. Then, the second stage will use an additional and empty word table (clustering table) to run a clustering procedure in one thread on the current sequence group, and at the same time the remaining <italic>T</italic>−1 threads will run multiple checking procedures on the remaining sequences.</p>
      <p>Since the clustering procedure may finish before or after the checking procedures, proper scheduling is used to guarantee all threads are active most of the time. At the end of each round, the clustering table will become the checking table of the next round, and the checking table of this round will be emptied to become the clustering table of the next round. More information including detailed description, illustration and pseudo codes, etc. are available in the <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts565/DC1">Supplementary Material (Sections 1.3–1.5)</ext-link>.</p>
    </sec>
    <sec id="SEC2.3">
      <title>2.3 Other enhancements</title>
      <p>Besides the parallelization, the new CD-HIT includes other enhancements such as faster file reading, better filtering threshold estimation, more efficient word counting and better alignment band estimation, etc. The new filtering threshold estimation is slightly more precise and can filter out more unnecessary alignments. Now word counting is handled more efficiently for input datasets with high redundancy, by maintaining a smaller counting array for hit representatives instead of a full counting array for every representatives. The improved alignment band estimation can find a narrower band for banded alignment.</p>
    </sec>
    <sec id="SEC2.4">
      <title>2.4 Implementation</title>
      <p>This enhanced CD-HIT is implemented in the C++ programming language and uses OpenMP (<ext-link ext-link-type="uri" xlink:href="http://www.openmp.org">http://www.openmp.org</ext-link>) for parallelization. The parallel for construct of OpenMP is used for running the checking and clustering procedures in multiple threads with dynamic scheduling. Different computation data buffers are allocated for different threads. The checking word table is immutable and shared by multiple threads.</p>
    </sec>
  </sec>
  <sec id="SEC3">
    <title>3 RESULTS</title>
    <p>To see how much performance improvement has been achieved, we tested the new CD-HIT (V4.6) and the old CD-HIT (V3.1.2) on a set of datasets including two protein sequence datasets: SWISS-PROT (∼0.4 M sequences), NR (∼12 M sequences) and two DNA sequence datasets: HumanGut (MH0002, ∼23 M reads; <xref ref-type="bibr" rid="bts565-B6">Qin <italic>et al.</italic>, 2010</xref>) and TwinStudy (SRP000319, ∼8 M reads; <xref ref-type="bibr" rid="bts565-B10">Turnbaugh <italic>et al.</italic>, 2009</xref>). Both the SWISS-PROT and the NR datasets were downloaded from NCBI (<ext-link ext-link-type="ftp" xlink:href="ftp://ftp.ncbi.nih.gov/blast/db/FASTA/">ftp://ftp.ncbi.nih.gov/blast/db/FASTA/</ext-link>) on October 20, 2010. We also compared CD-HIT with a similar program UCLUST (V5.1.221) from <xref ref-type="bibr" rid="bts565-B1">Edgar (2010)</xref>. These tests were done on a Debian Linux server with four 12-core AMD Opteron 6172 processors. Equivalent parameters were used for different programs whenever possible. Details and additional tests are available in <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts565/DC1">Supplementary Material 2</ext-link>.</p>
    <p><xref ref-type="table" rid="bts565-T1">Table 1</xref> compares the efficiency of the enhanced CD-HIT to the previous version of CD-HIT and the latest UCLUST. The results demonstrate that the new CD-HIT without using multi-core is significantly more efficient than the old one and is comparable to or more efficient than UCLUST as well. When multi-cores are used, the new CD-HIT is much more efficient than either of them. To test the effectiveness of the parallelization in the new CD-HIT, the full datasets were clustered using different number of cores. The time speedups are shown in <xref ref-type="fig" rid="bts565-F1">Figure 1</xref>, which indicates the parallelization has good speedup for up to ∼24 cores with a quasi-linear speedup for up to ∼8 cores. Besides speed improvements, the new CD-HIT also has better clustering quality than the old CD-HIT and UCLUST (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts565/DC1">Supplementary Material and Table S2</ext-link>).
<fig id="bts565-F1" position="float"><label>Fig. 1.</label><caption><p>Evaluation of CD-HIT parallelization: computational time speedup with respect to the number of used CPU cores</p></caption><graphic xlink:href="bts565f1"/></fig>
<table-wrap id="bts565-T1" position="float"><label>Table 1.</label><caption><p>Comparison to the previous CD-HIT and UCLUST</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Dataset</th><th rowspan="1" colspan="1">CD-HIT3 (min)</th><th rowspan="1" colspan="1">CD-HIT4 (min)</th><th rowspan="1" colspan="1">CD-HIT4 (8 cores) (min)</th><th rowspan="1" colspan="1">UCLUST5 (min)</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">Swissprot</td><td rowspan="1" colspan="1">80</td><td rowspan="1" colspan="1">58</td><td rowspan="1" colspan="1">12</td><td rowspan="1" colspan="1">15</td></tr><tr><td rowspan="1" colspan="1">NR</td><td rowspan="1" colspan="1">44</td><td rowspan="1" colspan="1">22</td><td rowspan="1" colspan="1">6</td><td rowspan="1" colspan="1">46</td></tr><tr><td rowspan="1" colspan="1">Twinstudy</td><td rowspan="1" colspan="1">47</td><td rowspan="1" colspan="1">19</td><td rowspan="1" colspan="1">4</td><td rowspan="1" colspan="1">56</td></tr><tr><td rowspan="1" colspan="1">HumanGut</td><td rowspan="1" colspan="1">494</td><td rowspan="1" colspan="1">42</td><td rowspan="1" colspan="1">8</td><td rowspan="1" colspan="1">214</td></tr></tbody></table><table-wrap-foot><fn id="bts565-TF1"><p>UCLUST5 free version cannot run on the full NR, TwinStudy and HumanGut datasets, so subsets with ∼1 M sequences of NR, 1 M reads of TwinStudy and 4 M reads of HumanGut are used in this comparison.</p></fn></table-wrap-foot></table-wrap></p>
  </sec>
  <sec id="SEC4">
    <title>4 CONCLUSIONS</title>
    <p>In this application note, we presented an enhanced CD-HIT that has been accelerated by a novel parallelization technique and a few other improvements. We tested and demonstrated that this new CD-HIT can achieve significant speedup over the previous CD-HIT using a single core, and its acceleration by multi-core computer can scale up well to a reasonable number of cores. Clustering on large datasets that normally runs for days can now finish in hours on multicore machines. We believe this enhanced CD-HIT will find more applications in handling the next-generation sequencing data.</p>
    <p><italic>Funding</italic>: This study was supported by <funding-source>National Institute of Health</funding-source> award <award-id>R01RR025030</award-id> from the <funding-source>National Center for Research Resources and award</funding-source>
<award-id>R01HG005978</award-id> from the <funding-source>National Human Genome Research Institute</funding-source>.</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>Supplementary Data</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="supp_28_23_3150__index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="msword" xlink:href="supp_bts565_bts565.doc"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list>
    <title>References</title>
    <ref id="bts565-B1">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Edgar</surname>
            <given-names>RC</given-names>
          </name>
        </person-group>
        <article-title>Search and clustering orders of magnitude faster than BLAST</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>2460</fpage>
        <lpage>2461</lpage>
        <pub-id pub-id-type="pmid">20709691</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B2">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Godzik</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Cd-hit: a fast program for clustering and comparing large sets of protein or nucleotide sequences</article-title>
        <source>Bioinformatics</source>
        <year>2006</year>
        <volume>22</volume>
        <fpage>1658</fpage>
        <lpage>1659</lpage>
        <pub-id pub-id-type="pmid">16731699</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B3">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Clustering of highly homologous sequences to reduce the size of large protein databases</article-title>
        <source>Bioinformatics</source>
        <year>2001</year>
        <volume>17</volume>
        <fpage>282</fpage>
        <lpage>283</lpage>
        <pub-id pub-id-type="pmid">11294794</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B4">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Loong</surname>
            <given-names>SNK</given-names>
          </name>
          <name>
            <surname>Mishra</surname>
            <given-names>SK</given-names>
          </name>
        </person-group>
        <article-title>Unique folding of precursor microRNAs: quantitative evidence and implications for de novo identification</article-title>
        <source>RNA</source>
        <year>2007</year>
        <volume>13</volume>
        <fpage>170</fpage>
        <lpage>187</lpage>
        <pub-id pub-id-type="pmid">17194722</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B5">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Niu</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Artificial and natural duplicates in pyrosequencing reads of metagenomic data</article-title>
        <source>BMC Bioinformatics</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>187</fpage>
        <pub-id pub-id-type="pmid">20388221</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B6">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qin</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A human gut microbial gene catalogue established by metagenomic sequencing</article-title>
        <source>Nature</source>
        <year>2010</year>
        <volume>464</volume>
        <fpage>59</fpage>
        <lpage>65</lpage>
        <pub-id pub-id-type="pmid">20203603</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B7">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rubinstein</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Fiser</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Predicting disulfide bond connectivity in proteins by correlated mutations analysis</article-title>
        <source>Bioinformatics</source>
        <year>2008</year>
        <volume>24</volume>
        <fpage>498</fpage>
        <lpage>504</lpage>
        <pub-id pub-id-type="pmid">18203772</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B8">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Community cyberinfrastructure for Advanced Microbial Ecology Research and Analysis: the CAMERA resource</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2011</year>
        <volume>39</volume>
        <fpage>D546</fpage>
        <lpage>D551</lpage>
        <pub-id pub-id-type="pmid">21045053</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B9">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suzek</surname>
            <given-names>BE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>UniRef: comprehensive and non-redundant UniProt reference clusters</article-title>
        <source>Bioinformatics</source>
        <year>2007</year>
        <volume>23</volume>
        <fpage>1282</fpage>
        <lpage>1288</lpage>
        <pub-id pub-id-type="pmid">17379688</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B10">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Turnbaugh</surname>
            <given-names>PJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A core gut microbiome in obese and lean twins</article-title>
        <source>Nature</source>
        <year>2009</year>
        <volume>457</volume>
        <fpage>480</fpage>
        <lpage>484</lpage>
        <pub-id pub-id-type="pmid">19043404</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B11">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yooseph</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene identification and protein classification in microbial metagenomic sequence data via incremental clustering</article-title>
        <source>BMC Bioinformatics</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>182</fpage>
        <pub-id pub-id-type="pmid">18402669</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3516142</article-id>
    <article-id pub-id-type="pmid">23060610</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/bts565</article-id>
    <article-id pub-id-type="publisher-id">bts565</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Note</subject>
        <subj-group>
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>CD-HIT: accelerated for clustering the next-generation sequencing data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Fu</surname>
          <given-names>Limin</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Niu</surname>
          <given-names>Beifang</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Zhu</surname>
          <given-names>Zhengwei</given-names>
        </name>
        <xref ref-type="author-notes" rid="bts565-FN1">
          <sup>†</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wu</surname>
          <given-names>Sitao</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Weizhong</given-names>
        </name>
        <xref ref-type="corresp" rid="bts565-COR2">*</xref>
      </contrib>
    </contrib-group>
    <aff>Center for Research in Biological Systems, University of California San Diego, La Jolla, CA 92093, USA</aff>
    <author-notes>
      <corresp id="bts565-COR2">*To whom correspondence should be addressed.</corresp>
      <fn id="bts565-FN1">
        <p><sup>†</sup>Present address: Department of Genetics, University of Pennsylvania, Philadelphia, Pennsylvania.</p>
      </fn>
      <fn>
        <p>Associate Editor: Inanc Birol</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>1</day>
      <month>12</month>
      <year>2012</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>11</day>
      <month>10</month>
      <year>2012</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>11</day>
      <month>10</month>
      <year>2012</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>28</volume>
    <issue>23</issue>
    <fpage>3150</fpage>
    <lpage>3152</lpage>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>6</month>
        <year>2012</year>
      </date>
      <date date-type="rev-recd">
        <day>31</day>
        <month>8</month>
        <year>2012</year>
      </date>
      <date date-type="accepted">
        <day>12</day>
        <month>9</month>
        <year>2012</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author 2012. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2012</copyright-year>
      <license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/3.0">
        <license-p><!--CREATIVE COMMONS-->This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/3.0/">http://creativecommons.org/licenses/by/3.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Summary:</bold> CD-HIT is a widely used program for clustering biological sequences to reduce sequence redundancy and improve the performance of other sequence analyses. In response to the rapid increase in the amount of sequencing data produced by the next-generation sequencing technologies, we have developed a new CD-HIT program accelerated with a novel parallelization strategy and some other techniques to allow efficient clustering of such datasets. Our tests demonstrated very good speedup derived from the parallelization for up to ∼24 cores and a quasi-linear speedup for up to ∼8 cores. The enhanced CD-HIT is capable of handling very large datasets in much shorter time than previous versions.</p>
      <p><bold>Availability:</bold><ext-link ext-link-type="uri" xlink:href="http://cd-hit.org">http://cd-hit.org</ext-link>.</p>
      <p>
        <bold>Contact:</bold>
        <email>liwz@sdsc.edu</email>
      </p>
      <p><bold>Supplementary information:</bold><ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts565/DC1">Supplementary data</ext-link> are available at <italic>Bioinformatics</italic> online.</p>
    </abstract>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec id="SEC1">
    <title>1 INTRODUCTION</title>
    <p>Sequence analysis has played a crucial role in computational biology. With the advancement of the next-generation sequencing technologies, the amount of available sequencing data is growing exponentially. Removing redundancy from such data by clustering could be crucial for reducing storage space, computational time and noise interference in some analysis methods, etc.</p>
    <p>CD-HIT was originally developed to cluster protein sequences to create reference databases with reduced redundancy (<xref ref-type="bibr" rid="bts565-B3">Li <italic>et al.</italic>, 2001</xref>) and was then extended to support clustering nucleotide sequences (<xref ref-type="bibr" rid="bts565-B2">Li and Godzik, 2006</xref>). Since its release, CD-HIT has become very widely used for a large variety of applications ranging from non-redundant dataset creation (<xref ref-type="bibr" rid="bts565-B9">Suzek <italic>et al.</italic>, 2007</xref>), protein family classifications (<xref ref-type="bibr" rid="bts565-B11">Yooseph <italic>et al.</italic>, 2008</xref>), artifact identification (<xref ref-type="bibr" rid="bts565-B5">Niu <italic>et al.</italic>, 2010</xref>), metagenomics annotation (<xref ref-type="bibr" rid="bts565-B8">Sun <italic>et al.</italic>, 2011</xref>), RNA analysis (<xref ref-type="bibr" rid="bts565-B4">Loong and Mishra, 2007</xref>), to various prediction studies (<xref ref-type="bibr" rid="bts565-B7">Rubinstein and Fiser, 2008</xref>).</p>
    <p>With sequencing data rapidly growing in public data repositories as well as in individual laboratories, there has been strong demand for an enhanced CD-HIT with greater efficiency. In response to such demand, we have developed this enhanced and parallelized version of CD-HIT, to exploit the fact that multi-core machines have become very common in ordinary laboratories.</p>
    <p>A computer cluster-based parallelization procedure for CD-HIT has been proposed in <xref ref-type="bibr" rid="bts565-B9">Suzek <italic>et al.</italic> (2007)</xref>, though not fully parallelized, this procedure provides good speedup using computer cluster. Since computer clusters are not as easily available as multi-core machines, here we propose an alternative parallelization technique, which assumes shared memory model and works well on multi-core machines.</p>
  </sec>
  <sec id="SEC2">
    <title>2 METHODS</title>
    <p>Basically, CD-HIT is a greedy incremental algorithm that starts with the longest input sequence as the first cluster representative, and then process the remaining sequences from long to short to classify each sequence as a redundant or representative sequence based on its similarities to the existing representatives. The similarities are estimated by common word counting using word indexing and counting tables to filter out unnecessary sequence alignments, which are used to compute exact similarities. In the following sections, we will describe the techniques that are used to accelerate CD-HIT.</p>
    <sec id="SEC2.1">
      <title>2.1 Simplification</title>
      <p>In order to support full parallelization, the core steps of CD-HIT have been simplified into two key procedures: a checking procedure and a clustering procedure. Using these two procedures, the algorithm requires at most two word tables without the need to swap them to disk, which was necessary in the original CD-HIT due to the use of multiple tables for large datasets.</p>
      <p>Given a word table, the checking procedure checks each of the remaining sequences against the table and determines whether it is a redundant sequence. The clustering procedure will make a final determination of the status of a sequence, and if it is classified as a representative sequence, it is used to update the word table. A more detailed description with illustration is available in <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts565/DC1">Supplementary Material Section 1.2</ext-link> and <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts565/DC1">Figure S1</ext-link>.</p>
    </sec>
    <sec id="SEC2.2">
      <title>2.2 Parallelization</title>
      <p>Given <italic>T</italic> threads or cores, the basic idea of our novel parallelization technique is to use two word tables and use <italic>T</italic>−1 threads to run multiple checking procedures using one word table (a immutable checking table), and the remaining thread to run a single clustering procedure using the other table (a mutable clustering table) in parallel. Due to the sequential characteristics of CD-HIT, it will require properly grouping the input sequences and switch the word tables to guarantee the correctness of the parallelization.</p>
      <p>This is achieved by dividing each round of computation into two stages. The first stage is to run <italic>T</italic> checking procedures on the sequence group defined for this round of computation using the word table (checking table) from the previous round. Then, the second stage will use an additional and empty word table (clustering table) to run a clustering procedure in one thread on the current sequence group, and at the same time the remaining <italic>T</italic>−1 threads will run multiple checking procedures on the remaining sequences.</p>
      <p>Since the clustering procedure may finish before or after the checking procedures, proper scheduling is used to guarantee all threads are active most of the time. At the end of each round, the clustering table will become the checking table of the next round, and the checking table of this round will be emptied to become the clustering table of the next round. More information including detailed description, illustration and pseudo codes, etc. are available in the <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts565/DC1">Supplementary Material (Sections 1.3–1.5)</ext-link>.</p>
    </sec>
    <sec id="SEC2.3">
      <title>2.3 Other enhancements</title>
      <p>Besides the parallelization, the new CD-HIT includes other enhancements such as faster file reading, better filtering threshold estimation, more efficient word counting and better alignment band estimation, etc. The new filtering threshold estimation is slightly more precise and can filter out more unnecessary alignments. Now word counting is handled more efficiently for input datasets with high redundancy, by maintaining a smaller counting array for hit representatives instead of a full counting array for every representatives. The improved alignment band estimation can find a narrower band for banded alignment.</p>
    </sec>
    <sec id="SEC2.4">
      <title>2.4 Implementation</title>
      <p>This enhanced CD-HIT is implemented in the C++ programming language and uses OpenMP (<ext-link ext-link-type="uri" xlink:href="http://www.openmp.org">http://www.openmp.org</ext-link>) for parallelization. The parallel for construct of OpenMP is used for running the checking and clustering procedures in multiple threads with dynamic scheduling. Different computation data buffers are allocated for different threads. The checking word table is immutable and shared by multiple threads.</p>
    </sec>
  </sec>
  <sec id="SEC3">
    <title>3 RESULTS</title>
    <p>To see how much performance improvement has been achieved, we tested the new CD-HIT (V4.6) and the old CD-HIT (V3.1.2) on a set of datasets including two protein sequence datasets: SWISS-PROT (∼0.4 M sequences), NR (∼12 M sequences) and two DNA sequence datasets: HumanGut (MH0002, ∼23 M reads; <xref ref-type="bibr" rid="bts565-B6">Qin <italic>et al.</italic>, 2010</xref>) and TwinStudy (SRP000319, ∼8 M reads; <xref ref-type="bibr" rid="bts565-B10">Turnbaugh <italic>et al.</italic>, 2009</xref>). Both the SWISS-PROT and the NR datasets were downloaded from NCBI (<ext-link ext-link-type="ftp" xlink:href="ftp://ftp.ncbi.nih.gov/blast/db/FASTA/">ftp://ftp.ncbi.nih.gov/blast/db/FASTA/</ext-link>) on October 20, 2010. We also compared CD-HIT with a similar program UCLUST (V5.1.221) from <xref ref-type="bibr" rid="bts565-B1">Edgar (2010)</xref>. These tests were done on a Debian Linux server with four 12-core AMD Opteron 6172 processors. Equivalent parameters were used for different programs whenever possible. Details and additional tests are available in <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts565/DC1">Supplementary Material 2</ext-link>.</p>
    <p><xref ref-type="table" rid="bts565-T1">Table 1</xref> compares the efficiency of the enhanced CD-HIT to the previous version of CD-HIT and the latest UCLUST. The results demonstrate that the new CD-HIT without using multi-core is significantly more efficient than the old one and is comparable to or more efficient than UCLUST as well. When multi-cores are used, the new CD-HIT is much more efficient than either of them. To test the effectiveness of the parallelization in the new CD-HIT, the full datasets were clustered using different number of cores. The time speedups are shown in <xref ref-type="fig" rid="bts565-F1">Figure 1</xref>, which indicates the parallelization has good speedup for up to ∼24 cores with a quasi-linear speedup for up to ∼8 cores. Besides speed improvements, the new CD-HIT also has better clustering quality than the old CD-HIT and UCLUST (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts565/DC1">Supplementary Material and Table S2</ext-link>).
<fig id="bts565-F1" position="float"><label>Fig. 1.</label><caption><p>Evaluation of CD-HIT parallelization: computational time speedup with respect to the number of used CPU cores</p></caption><graphic xlink:href="bts565f1"/></fig>
<table-wrap id="bts565-T1" position="float"><label>Table 1.</label><caption><p>Comparison to the previous CD-HIT and UCLUST</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Dataset</th><th rowspan="1" colspan="1">CD-HIT3 (min)</th><th rowspan="1" colspan="1">CD-HIT4 (min)</th><th rowspan="1" colspan="1">CD-HIT4 (8 cores) (min)</th><th rowspan="1" colspan="1">UCLUST5 (min)</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">Swissprot</td><td rowspan="1" colspan="1">80</td><td rowspan="1" colspan="1">58</td><td rowspan="1" colspan="1">12</td><td rowspan="1" colspan="1">15</td></tr><tr><td rowspan="1" colspan="1">NR</td><td rowspan="1" colspan="1">44</td><td rowspan="1" colspan="1">22</td><td rowspan="1" colspan="1">6</td><td rowspan="1" colspan="1">46</td></tr><tr><td rowspan="1" colspan="1">Twinstudy</td><td rowspan="1" colspan="1">47</td><td rowspan="1" colspan="1">19</td><td rowspan="1" colspan="1">4</td><td rowspan="1" colspan="1">56</td></tr><tr><td rowspan="1" colspan="1">HumanGut</td><td rowspan="1" colspan="1">494</td><td rowspan="1" colspan="1">42</td><td rowspan="1" colspan="1">8</td><td rowspan="1" colspan="1">214</td></tr></tbody></table><table-wrap-foot><fn id="bts565-TF1"><p>UCLUST5 free version cannot run on the full NR, TwinStudy and HumanGut datasets, so subsets with ∼1 M sequences of NR, 1 M reads of TwinStudy and 4 M reads of HumanGut are used in this comparison.</p></fn></table-wrap-foot></table-wrap></p>
  </sec>
  <sec id="SEC4">
    <title>4 CONCLUSIONS</title>
    <p>In this application note, we presented an enhanced CD-HIT that has been accelerated by a novel parallelization technique and a few other improvements. We tested and demonstrated that this new CD-HIT can achieve significant speedup over the previous CD-HIT using a single core, and its acceleration by multi-core computer can scale up well to a reasonable number of cores. Clustering on large datasets that normally runs for days can now finish in hours on multicore machines. We believe this enhanced CD-HIT will find more applications in handling the next-generation sequencing data.</p>
    <p><italic>Funding</italic>: This study was supported by <funding-source>National Institute of Health</funding-source> award <award-id>R01RR025030</award-id> from the <funding-source>National Center for Research Resources and award</funding-source>
<award-id>R01HG005978</award-id> from the <funding-source>National Human Genome Research Institute</funding-source>.</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>Supplementary Data</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="supp_28_23_3150__index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="msword" xlink:href="supp_bts565_bts565.doc"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list>
    <title>References</title>
    <ref id="bts565-B1">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Edgar</surname>
            <given-names>RC</given-names>
          </name>
        </person-group>
        <article-title>Search and clustering orders of magnitude faster than BLAST</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>2460</fpage>
        <lpage>2461</lpage>
        <pub-id pub-id-type="pmid">20709691</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B2">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Godzik</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Cd-hit: a fast program for clustering and comparing large sets of protein or nucleotide sequences</article-title>
        <source>Bioinformatics</source>
        <year>2006</year>
        <volume>22</volume>
        <fpage>1658</fpage>
        <lpage>1659</lpage>
        <pub-id pub-id-type="pmid">16731699</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B3">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Clustering of highly homologous sequences to reduce the size of large protein databases</article-title>
        <source>Bioinformatics</source>
        <year>2001</year>
        <volume>17</volume>
        <fpage>282</fpage>
        <lpage>283</lpage>
        <pub-id pub-id-type="pmid">11294794</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B4">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Loong</surname>
            <given-names>SNK</given-names>
          </name>
          <name>
            <surname>Mishra</surname>
            <given-names>SK</given-names>
          </name>
        </person-group>
        <article-title>Unique folding of precursor microRNAs: quantitative evidence and implications for de novo identification</article-title>
        <source>RNA</source>
        <year>2007</year>
        <volume>13</volume>
        <fpage>170</fpage>
        <lpage>187</lpage>
        <pub-id pub-id-type="pmid">17194722</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B5">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Niu</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Artificial and natural duplicates in pyrosequencing reads of metagenomic data</article-title>
        <source>BMC Bioinformatics</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>187</fpage>
        <pub-id pub-id-type="pmid">20388221</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B6">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qin</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A human gut microbial gene catalogue established by metagenomic sequencing</article-title>
        <source>Nature</source>
        <year>2010</year>
        <volume>464</volume>
        <fpage>59</fpage>
        <lpage>65</lpage>
        <pub-id pub-id-type="pmid">20203603</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B7">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rubinstein</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Fiser</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Predicting disulfide bond connectivity in proteins by correlated mutations analysis</article-title>
        <source>Bioinformatics</source>
        <year>2008</year>
        <volume>24</volume>
        <fpage>498</fpage>
        <lpage>504</lpage>
        <pub-id pub-id-type="pmid">18203772</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B8">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Community cyberinfrastructure for Advanced Microbial Ecology Research and Analysis: the CAMERA resource</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2011</year>
        <volume>39</volume>
        <fpage>D546</fpage>
        <lpage>D551</lpage>
        <pub-id pub-id-type="pmid">21045053</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B9">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suzek</surname>
            <given-names>BE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>UniRef: comprehensive and non-redundant UniProt reference clusters</article-title>
        <source>Bioinformatics</source>
        <year>2007</year>
        <volume>23</volume>
        <fpage>1282</fpage>
        <lpage>1288</lpage>
        <pub-id pub-id-type="pmid">17379688</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B10">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Turnbaugh</surname>
            <given-names>PJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A core gut microbiome in obese and lean twins</article-title>
        <source>Nature</source>
        <year>2009</year>
        <volume>457</volume>
        <fpage>480</fpage>
        <lpage>484</lpage>
        <pub-id pub-id-type="pmid">19043404</pub-id>
      </element-citation>
    </ref>
    <ref id="bts565-B11">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yooseph</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene identification and protein classification in microbial metagenomic sequence data via incremental clustering</article-title>
        <source>BMC Bioinformatics</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>182</fpage>
        <pub-id pub-id-type="pmid">18402669</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
