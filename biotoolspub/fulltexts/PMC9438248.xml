<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Biol</journal-id>
    <journal-title-group>
      <journal-title>Genome Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1474-7596</issn>
    <issn pub-type="epub">1474-760X</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9438248</article-id>
    <article-id pub-id-type="publisher-id">2738</article-id>
    <article-id pub-id-type="doi">10.1186/s13059-022-02738-3</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MIRTH: Metabolite Imputation via Rank-Transformation and Harmonization</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Freeman</surname>
          <given-names>Benjamin A.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Jaro</surname>
          <given-names>Sophie</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Park</surname>
          <given-names>Tricia</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Keene</surname>
          <given-names>Sam</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Tansey</surname>
          <given-names>Wesley</given-names>
        </name>
        <address>
          <email>tanseyw@mskcc.org</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-6511-5947</contrib-id>
        <name>
          <surname>Reznik</surname>
          <given-names>Ed</given-names>
        </name>
        <address>
          <email>reznike@mskcc.org</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Computational Oncology, Department of Epidemiology and Biostatistics, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.254672.0</institution-id><institution-id institution-id-type="ISNI">0000 0001 2170 2034</institution-id><institution>Electrical Engineering Department, </institution><institution>The Cooper Union, </institution></institution-wrap>New York, USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>1</day>
      <month>9</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>1</day>
      <month>9</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2022</year>
    </pub-date>
    <volume>23</volume>
    <elocation-id>184</elocation-id>
    <history>
      <date date-type="received">
        <day>14</day>
        <month>4</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>23</day>
        <month>7</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Out of the thousands of metabolites in a given specimen, most metabolomics experiments measure only hundreds, with poor overlap across experimental platforms. Here, we describe Metabolite Imputation via Rank-Transformation and Harmonization (MIRTH), a method to impute unmeasured metabolite abundances by jointly modeling metabolite covariation across datasets which have heterogeneous coverage of metabolite features. MIRTH successfully recovers masked metabolite abundances both within single datasets and across multiple, independently-profiled datasets. MIRTH demonstrates that latent information about otherwise unmeasured metabolites is embedded within existing metabolomics data, and can be used to generate novel hypotheses and simplify existing metabolomic workflows.</p>
      <sec>
        <title>Supplementary Information</title>
        <p>The online version contains supplementary material available at 10.1186/s13059-022-02738-3.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Metabolomics</kwd>
      <kwd>Missing data</kwd>
      <kwd>Imputation</kwd>
      <kwd>Unmeasured metabolites</kwd>
      <kwd>Matrix factorization</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100011541</institution-id>
            <institution>Division of Cancer Epidemiology and Genetics, National Cancer Institute</institution>
          </institution-wrap>
        </funding-source>
        <award-id>P30 CA008748</award-id>
        <principal-award-recipient>
          <name>
            <surname>Freeman</surname>
            <given-names>Benjamin A.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2022</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par2">Large-scale quantification of metabolite pool sizes (“metabolomics”) is a powerful approach for the mechanistic investigation of metabolic pathway activity and the identification of metabolic biomarkers of disease and therapeutic response [<xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR5">5</xref>]. By observing how metabolite levels are altered in various physiological conditions, metabolomics can reveal the role of metabolites in homeostasis, in disease, or in response to perturbations [<xref ref-type="bibr" rid="CR6">6</xref>].</p>
    <p id="Par3">The bulk of large-scale metabolomics data in biology research is now generated using mass spectrometry [<xref ref-type="bibr" rid="CR7">7</xref>]. This technology ultimately reports the number of measured ions associated with a unique metabolite in a given biological specimen. To accurately identify metabolites, targeted metabolomics studies must be calibrated for maximum sensitivity for specific classes of metabolites with similar chemical properties [<xref ref-type="bibr" rid="CR8">8</xref>]. Consequently, each metabolomics platform can only measure a subset of the entire assortment of metabolites in a specimen. Metabolomics assays operated in different laboratories often measure sets of metabolites with little overlap. For example, in a pan-cancer series of eleven metabolomics datasets [<xref ref-type="bibr" rid="CR9">9</xref>], only 23 out of 935 metabolites were measured across all samples. This lack of overlap restricts cross-dataset comparisons and impedes the discovery of general principles of metabolite regulation across datasets. The goal of this work is to enable cross-dataset comparisons by developing a method to impute missing metabolites between datasets.</p>
    <p id="Par4">Imputing missing values is specifically challenging in metabolomic data analysis because metabolite levels are reported in arbitrary units, which we refer to as relative abundance. A relative abundance level only contains information about the concentration of a metabolite in a sample relative to all other measurements of that metabolite in that dataset. These levels are not comparable between different metabolites in the same dataset, nor are they comparable to the measurements of the same metabolite in different datasets. The lack of a shared measurement scale between metabolites and datasets prevents the application of existing imputation methods that assume a common basis (e.g., probabilistic PCA [<xref ref-type="bibr" rid="CR10">10</xref>]). Others have developed methods for the imputation of single metabolomics datasets, including some based on k-nearest neighbor imputation [<xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR12">12</xref>], quantile regression imputation of left-censored data and random forest imputation [<xref ref-type="bibr" rid="CR13">13</xref>], kernel-weighted least squares imputation [<xref ref-type="bibr" rid="CR14">14</xref>], and multivariate imputation by chained equations [<xref ref-type="bibr" rid="CR12">12</xref>]. These methods impute left-censored values—missing values arising when a metabolite level falls below a detection threshold in a subset of samples—within a single dataset [<xref ref-type="bibr" rid="CR13">13</xref>].</p>
    <p id="Par5">In contrast to the above-mentioned work, we consider here a related but larger and more challenging class of problems related to imputing entirely-unmeasured metabolite features across datasets. We present Metabolite Imputation via Rank-Transformation and Harmonization (MIRTH), a relative abundance matrix factorization model that learns relationships between metabolite levels in one or more metabolomics datasets. MIRTH’s key insight is that transforming relative abundance levels to normalized ranks maps every measurement to a comparable scale between metabolites and across batches. Critically, rank transformation enables MIRTH to discover patterns of covariation between metabolite pools that are shared across datasets without making assumptions about the relative concentrations of the same metabolite across datasets. MIRTH factorizes rank-transformed metabolomics data into two low-dimensional embedding matrices (Fig. <xref rid="Fig1" ref-type="fig">1</xref>). These embeddings describe the latent structure between samples and metabolite features. By compressing the information contained in the space of all metabolite features measured across all datasets into low-dimensional embeddings, MIRTH discovers correlative relationships among metabolites across datasets. These correlations enable the imputation of unmeasured features in each dataset. Matrix factorization has been applied to imputing metabolomics data [<xref ref-type="bibr" rid="CR15">15</xref>], but MIRTH differs from this previous work in two key respects. First, MIRTH makes use of cross-validation rather than any potentially-biased priors to tune the number of embedding dimensions. Second, MIRTH addresses the imputation of entirely missing metabolites across datasets, enabled by rank-transformation, while previous work imputes only left-censored values in one dataset. Matrix factorization techniques have also previously been applied to a variety of other data modalities  [<xref ref-type="bibr" rid="CR16">16</xref>], including gene expression data [<xref ref-type="bibr" rid="CR17">17</xref>–<xref ref-type="bibr" rid="CR19">19</xref>], protein sequences [<xref ref-type="bibr" rid="CR19">19</xref>], and genomic data [<xref ref-type="bibr" rid="CR20">20</xref>] for clustering analysis and class discovery.</p>
    <p id="Par6">We evaluate the performance of MIRTH in a pan-cancer series of nine metabolomics datasets. MIRTH achieves high accuracy in in silico experiments predicting ranks. In each of our nine batches of experimental data, a proportion of simulated-missing metabolites entirely masked from a batch are imputed well by MIRTH. In kidney cancer data with paired tumor and normal tissues, MIRTH correctly predicts unmeasured tumor-enriched and tumor-depleted metabolites in one dataset by transferring information from a second dataset where those metabolites were measured. MIRTH also accurately imputes metabolites across ionization modes, enabling the imputation of unmeasured metabolites across chemically distinct classes. By increasing the available information about the metabolome, MIRTH increases the hypothesis-generating potential of existing datasets while revealing new information embedded in existing metabolomics data.</p>
  </sec>
  <sec id="Sec2">
    <title>Results</title>
    <p id="Par7">We completed a series of benchmark studies to assess the performance of MIRTH in different imputation tasks. We evaluated the performance of MIRTH on a collection of nine previously-published mass-spectrometry metabolomics datasets, consisting of original raw ion counts before any preprocessing, e.g., normalization and imputation [<xref ref-type="bibr" rid="CR9">9</xref>]. Metabolite names were harmonized by maximizing consistency across multiple metabolite identifiers, as previously described [<xref ref-type="bibr" rid="CR9">9</xref>]. Details on the number of samples and features in each dataset are reported in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S1.</p>
    <p id="Par8">For each benchmark, we measured the concordance between the true and imputed ranks of metabolite samples in held-out data. Across experiments, we found MIRTH performed well in high sample-to-metabolite scenarios. In contrast, MIRTH performed poorly when there were insufficient samples to train on and when samples were highly censored. Furthermore, we found that a subset of metabolites were reproducibly well-imputed across different datasets and imputation tasks, ascribing a quantitative metric of confidence to MIRTH’s predictions.</p>
    <sec id="Sec3">
      <title>MIRTH recovers missing metabolites within metabolomics datasets</title>
      <p id="Par9">We first verified that MIRTH accurately imputed missing measurements within a single dataset. This represented the most straightforward imputation task because there were no batch effects associated with merging of data from two or more distinct datasets. We performed an in silico experiment, simulating a scenario where a set of metabolites was not measured in a subset of samples in the dataset. First, we randomly select 50% of the samples to serve as hold-out samples. Next, we randomly selected 10% of all the metabolites to serve as hold-out metabolites (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a). We masked the hold-out metabolites in the hold-out samples to simulate that they were not measured in half the dataset. This effectively split the dataset into two pseudo-datasets, where a smaller set of features was measured in the hold-out pseudo-dataset.</p>
      <p id="Par10">For each of the 9 benchmarking datasets (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S1), we split the data as described above and applied MIRTH to impute the held-out values (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a and “<xref rid="Sec11" ref-type="sec">Methods</xref>”). Since the held-out values in the dataset were actually known, the performance of MIRTH was assessable by comparing the actual and predicted ranks in the simulated-missing features. We repeated this experiment 200 times for each of the 9 datasets, randomly selecting a set of metabolites in a random set of samples to mask in each iteration. The optimal number of embedding dimensions, chosen through cross-validation separately for each dataset, ranged between 3 and 37 (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S1a). We also evaluated the performance of MIRTH and its sensitivity to dataset size and feature missingness using simulated metabolomics data. The method and results of testing single-set performance on simulated data are available in the Supplementary Information section.</p>
      <p id="Par11">When 10% of features were simulated missing in each trial, MIRTH successfully predicted the abundance of approximately 89% of metabolites (significant positive correlation with the true ranks in at least 90% of trials, <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho &gt;0, q&lt;0.05$$\end{document}</tex-math><mml:math id="M2"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>q</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq1.gif"/></alternatives></inline-formula>, BH-corrected, Fig. <xref rid="Fig2" ref-type="fig">2</xref>b). This proportion ranged from 11% in BrCa2 (likely due to its small number of samples) to 100% in COAD (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S2). Variation in MIRTH performance across datasets was partly explained by dataset size: median imputation performance was better for the five datasets with the most samples, compared to the other four (Fig. <xref rid="Fig2" ref-type="fig">2</xref>c). Using the same metric of predictive success, the proportion of well-predicted metabolites in each dataset likewise increased as the sample size of the dataset increased (Fig. <xref rid="Fig2" ref-type="fig">2</xref>d). This suggested that poor predictions may be the result of an insufficient quantity of data from which MIRTH could learn. Similarly, when the proportion of features simulated as missing was increased, imputation performance worsened (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S1b). This result was expected since higher proportions of masked metabolites leave less data from which MIRTH can learn. We also investigated factors associated with each metabolite feature which might influence imputation accuracy. We observed that metabolite features with larger coefficients of variation (in the raw, non-rank-transformed data) tended to have lower imputation accuracy (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S1c). Similarly, predictions of features with a greater number of censored measurements (i.e., those where more measurements were below the detection threshold) scored lower. This likely arose from a poor correlation between censored values’ tied-for-last ranks at the input and their uniformly-mapped ranks at the output (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S1d).</p>
      <p id="Par12">A total of 306 metabolites were reproducibly well-predicted by MIRTH across multiple datasets, meaning that they were measured in at least 4 datasets and well-predicted in at least three-quarters of the datasets in which they were measured (Fig. <xref rid="Fig2" ref-type="fig">2</xref>e). Among these well-predicted metabolites were 84 amino acids, 22 carbohydrates, 16 cofactors and vitamins, 5 energy carriers, 120 lipids, 28 nucleotides, 21 peptides, 8 xenobiotics, and 2 uncharacterized metabolites. Well-predicted metabolites were enriched in specific metabolite classes, including dipeptides, proteinogenic amino acids and various lipid subsets (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S3). For example, palmitate and methionine, which were measured in 8 and 9 datasets respectively, were both well-predicted in 8 experiments (Fig. <xref rid="Fig2" ref-type="fig">2</xref>f). While these benchmarking experiments were conducted in a setting where the ground truth was known, the observation that certain metabolites were reproducibly well-imputed in different settings suggests that imputation of their abundance by MIRTH in settings where the true abundance is unknown should be associated with additional confidence relative to all other metabolites. Furthermore, the ability of MIRTH to recover ranks of subsets of samples of metabolites in a single dataset motivated the use of MIRTH to impute entirely missing metabolites in a single dataset by learning from a matrix of aggregate datasets.</p>
    </sec>
    <sec id="Sec4">
      <title>MIRTH recovers missing metabolites by transferring knowledge across datasets</title>
      <p id="Par13">To determine if imputation of entirely unmeasured features could produce biologically sound predictions of missing metabolites, we applied MIRTH to two independent kidney cancer datasets, RC12 and RC3, each consisting of both tumor and adjacent normal tissue samples. We reasoned that metabolites distinguishing tumor and normal tissues should be highly concordant across both datasets. To test this assumption, we calculated the differential abundance of all metabolites (tumor vs. normal) in RC12 and RC3 (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S2). Of the 169 metabolites measured in both RC12 and RC3 that showed statistically significant differences between tumor and normal in both datasets, we observed that 159 (94<inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\%$$\end{document}</tex-math><mml:math id="M4"><mml:mo>%</mml:mo></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq2.gif"/></alternatives></inline-formula>) showed identical changes, including canonical metabolites such as glutathione (GSSG and GSH), lactate, NAD+, and fructose (<inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$q&lt;0.05$$\end{document}</tex-math><mml:math id="M6"><mml:mrow><mml:mi>q</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq3.gif"/></alternatives></inline-formula>, Wilcoxon test, Fig. <xref rid="Fig3" ref-type="fig">3</xref>a). This demonstrated that the metabolite differences between tumor and normal samples in these datasets were comparable. Next, we repeated the analysis above considering metabolites measured in RC12, but entirely <italic>unmeasured</italic> in RC3, which we called <italic>test</italic> metabolites. After joint imputation of RC12 and RC3 with MIRTH, we compared the differential abundance of test metabolites in RC12 (where they were measured) and RC3 (where their true abundance is unmeasured, but where they have been imputed by MIRTH, Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S2). Doing so, we again observed a strong correlation between differential abundance (tumor vs. normal) in test metabolites in RC12 and RC3. Out of 252 test metabolites, there were 235 (93%) significant and consistently differentially abundant metabolites, including glucose-1-phosphate (G1P), fructose-6-phosphate (F6P), fructose-1-phosphate (F1P), and gamma-aminobutyric acid (GABA). Only 17 metabolites inconsistently distinguished tumor and normal samples (<inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$q&lt;0.05$$\end{document}</tex-math><mml:math id="M8"><mml:mrow><mml:mi>q</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq4.gif"/></alternatives></inline-formula>, Wilcoxon test, Fig. <xref rid="Fig3" ref-type="fig">3</xref>b). This analysis confirms that MIRTH preserves relationships between sample types and biologically important metabolites when imputing data across datasets, and suggests that MIRTH can be successfully applied to impute the ranks of entirely unmeasured metabolites in metabolomic data.</p>
      <p id="Par14">To further assess the ability of MIRTH to accurately impute missing features across datasets, we designated one of the nine datasets under analysis as the <italic>target</italic>, from which we completely masked a set of features to simulate as unmeasured. MIRTH was then applied to impute these unmeasured features, using data from the remaining eight datasets (and therefore testing the performance of MIRTH in the presence of a dataset-specific batch effect). We conducted nine such experiments, where each dataset was the <italic>target</italic> for one experiment (Fig. <xref rid="Fig3" ref-type="fig">3</xref>c). We repeated each experiment for 200 trials for each target dataset, randomly selecting 10% of features to simulate as missing each time. The optimal number of embedding dimensions ranged between 26 and 48, but equivalent-to-optimal performance could be achieved with approximately 30 dimensions (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S3a). Performance was evaluated similarly to the within-dataset imputation, comparing imputed and true ranks of the features simulated as missing.</p>
      <p id="Par15">Across the nine datasets under analysis, between 38% and 85% of the simulated-missing metabolites entirely masked from a target dataset were well-predicted with the MIRTH approach (<inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho &gt;0, q&lt;0.05$$\end{document}</tex-math><mml:math id="M10"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>q</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq5.gif"/></alternatives></inline-formula> in &gt;90% of trials, Fig. <xref rid="Fig3" ref-type="fig">3</xref>d, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S4). Similar to the within-dataset imputation, performance degraded as a larger proportion of features was simulated as missing (Additional file 2: Fig. S3b). Properties of the raw data, such as the variance of the feature in the target dataset or the number of samples in other datasets where the feature was measured, partially explained why some features were better predicted than others (Additional file 2: Figs. S3c,d). Similar to the within-set imputation, MIRTH reliably predicted the ranks of certain metabolites regardless of the target dataset (Fig. <xref rid="Fig3" ref-type="fig">3</xref>e). There were 218 reproducibly well-predicted metabolites, consisting of 56 amino acids, 13 carbohydrates, 10 cofactors and vitamins, 94 lipids, 15 nucleotides, 18 peptides, 10 xenobiotics, and 2 uncharacterized metabolites (Fig. <xref rid="Fig3" ref-type="fig">3</xref>e, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S5). Similar to the within-dataset imputation, reproducibly well-predicted metabolites were enriched for lipid subsets and amino acids (Fig. <xref rid="Fig3" ref-type="fig">3</xref>e). Tyrosine and palmitate, for instance, were reproducibly well-predicted with a median <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M12"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq6.gif"/></alternatives></inline-formula> of 0.892 and 0.845 respectively (Fig. <xref rid="Fig3" ref-type="fig">3</xref>f). These results outline a set of metabolites that are likely to be reliably imputed in a new target dataset if one were to be added to our existing aggregate set.</p>
      <p id="Par16">We also evaluated MIRTH’s across-set imputation performance on simulated metabolomics data and on data from the Cancer Cell Line Encyclopedia (CCLE) [<xref ref-type="bibr" rid="CR21">21</xref>], the full results of which can be found in the Supplementary Information section. To summarize, applying MIRTH to the CCLE dataset resulted in comparable or better imputation of missing metabolites than with our 9 benchmarking datasets. For within- and across-dataset treatments, 100% and, typically, 94.2% of metabolites were well-predicted.</p>
    </sec>
    <sec id="Sec5">
      <title>MIRTH embeddings separate tissue of origin and metabolite class</title>
      <p id="Par17">MIRTH involves a matrix factorization that associates both metabolite features and samples with a small number of embedding dimensions. In other contexts, analysis of features and samples in embedding space can be used to interpret the similarity between samples or the covariation of different features. We therefore applied MIRTH jointly to all data available, factorizing the complete aggregate set (<inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X}$$\end{document}</tex-math><mml:math id="M14"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq7.gif"/></alternatives></inline-formula>) of all nine datasets. The optimal number of dimensions for the factorization of the aggregate data matrix into embedding matrices <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{W}$$\end{document}</tex-math><mml:math id="M16"><mml:mrow><mml:mi mathvariant="bold-italic">W</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq8.gif"/></alternatives></inline-formula> and <inline-formula id="IEq9"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{H}$$\end{document}</tex-math><mml:math id="M18"><mml:mrow><mml:mi mathvariant="bold-italic">H</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq9.gif"/></alternatives></inline-formula> was 30 (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S4a). Weights were mostly small and right-skewed (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S4b). We used UMAP to visualize the sample and feature embedding spaces [<xref ref-type="bibr" rid="CR22">22</xref>].</p>
      <p id="Par18">In sample embedding space, some clustering occurred by tissue of origin, with samples from the three kidney cancer datasets, RC12, RC18, and RC3, overlapping (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a). COAD samples also separated from other tissues of origin. Interestingly, PrCa samples separated into three distinct clusters, raising the possibility of a latent batch effect, i.e., that the PrCa dataset consists of three sub-datasets that are not preprocessed individually by MIRTH. Definition between other tissue types, <italic>i.e.</italic> between BrCa1 &amp; BrCa2, PaCa, and HCC, was less discernible. Tumor and normal samples from the same dataset also separated in embedding space along UMAP axis 2 (Fig. <xref rid="Fig4" ref-type="fig">4</xref>b).</p>
      <p id="Par19">Dimensionality reduction of the feature embedding matrix also revealed separation between certain metabolite classes, in particular of peptides and lipids from the rest of the measured features (Fig. <xref rid="Fig4" ref-type="fig">4</xref>c). The outlying peptide features predominantly represented dipeptides (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S4c). To determine whether individual embedding vectors were associated with functionally-related groups of metabolites, we performed a Fisher’s exact test for enrichment of a given metabolic pathway in each embedding vector after setting a cutoff value above which a feature was considered to be appreciably weighted (here, <inline-formula id="IEq10"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$weight=0.2$$\end{document}</tex-math><mml:math id="M20"><mml:mrow><mml:mi>w</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0.2</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq10.gif"/></alternatives></inline-formula>). This analysis was limited by statistical power, due to the relatively small number of metabolites in each annotated pathway. Nevertheless, the analysis identified enrichment of certain metabolite classes across multiple embedding dimensions, including dipeptides, sphingomyleins, diacylglycerols, and lysolipids (Fig. <xref rid="Fig4" ref-type="fig">4</xref>d).</p>
    </sec>
    <sec id="Sec6">
      <title>MIRTH imputes metabolites across MS ionization modes</title>
      <p id="Par20">Mass spectrometry-based metabolomics can be conducted in positive or negative ionization modes, which allows for quantification of metabolites that are more amenable to acquiring a positive or negative charge  [<xref ref-type="bibr" rid="CR23">23</xref>–<xref ref-type="bibr" rid="CR25">25</xref>]. We devised an experiment to assess the viability of predicting positive-mode measurements from negative-mode ones (or vice-versa), using a dataset where samples were profiled in both modes [<xref ref-type="bibr" rid="CR24">24</xref>].</p>
      <p id="Par21">This dataset consisted of 448 features across 638 samples. Of the 241 quantified metabolites, 191 were measured in both positive and negative modes (accounting for 398 features due to redundancies). Of the remaining metabolites, 24 were measured only in positive mode and 16 were measured only in negative mode. We devised a test scenario for MIRTH whereby positive- or negative-mode measurements were completely masked from half the samples. This simulated a scenario where half of the samples were measured in both modes and the remaining samples were measured in just one mode (Fig. <xref rid="Fig5" ref-type="fig">5</xref>a). Imputation performance was assessed on metabolites only measured in one mode across 200 trials with a different set of samples chosen for masking each time. All non-overlapping metabolites were well-predicted (<inline-formula id="IEq11"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho &gt;0, q&lt;0.05$$\end{document}</tex-math><mml:math id="M22"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>q</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq11.gif"/></alternatives></inline-formula> in <inline-formula id="IEq12"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$&gt; 90\%$$\end{document}</tex-math><mml:math id="M24"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>90</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq12.gif"/></alternatives></inline-formula> of trials). Overall, negative-mode features were predicted with a higher <inline-formula id="IEq13"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M26"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq13.gif"/></alternatives></inline-formula> than positive-mode features (Fig. <xref rid="Fig5" ref-type="fig">5</xref>b), perhaps due to the greater reproducibility of the positive-mode measurements on which negative-mode predictions were based [<xref ref-type="bibr" rid="CR24">24</xref>]. Predictions for glyceraldehyde-3-phosphate, cadaverine, and putrescine - features measured only in positive mode - were notably accurate, with median <inline-formula id="IEq14"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M28"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq14.gif"/></alternatives></inline-formula> values of 0.765, 0.788, and 0.777, respectively (Fig. <xref rid="Fig5" ref-type="fig">5</xref>c, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S6). Likewise, aconitate, carbamoyl phosphate, and riboflavin were among the best-predicted negative-mode features, with median <inline-formula id="IEq15"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M30"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq15.gif"/></alternatives></inline-formula> values of 0.901, 0.888, and 0.887, respectively (Fig. <xref rid="Fig5" ref-type="fig">5</xref>c, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S6). Once again, these results indicate that MIRTH can impute the ranks of metabolites that were entirely unmeasured by leveraging latent information in metabolomics data—in this case, in one ionization mode.</p>
    </sec>
  </sec>
  <sec id="Sec7">
    <title>Discussion</title>
    <p id="Par22">MIRTH is a novel method to impute the ranks of otherwise unmeasured metabolites in semi-quantitative mass spectrometry metabolomics data by applying a matrix factorization approach tolerant to missing data. MIRTH successfully imputed (<inline-formula id="IEq16"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho &gt;0, p &lt; 0.05$$\end{document}</tex-math><mml:math id="M32"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq16.gif"/></alternatives></inline-formula> in &gt;90% of trials) between 38% and 85% of the missing metabolites in each dataset we tested. Although not all metabolites were well-predicted in all datasets, the existence of a subset of metabolite features that were reproducibly well-imputed across datasets reveals the promise of MIRTH for filling-in missing metabolites in new datasets.</p>
    <p id="Par23">That MIRTH imputes some metabolites poorly may partially be accounted for by the high variance of those features across a dataset’s samples. Nevertheless, MIRTH reliably imputes metabolites whose significant variation depends on the biological context, i.e., biologically-relevant metabolites between tumor and normal samples. This demonstration adds confidence to MIRTH predictions for metabolites whose level depends on biological context, provided that there are enough training samples across a diversity of contexts. Furthermore, the number of datasets the metabolite appeared in and the extent to which the metabolite was left-censored in each dataset affected the imputation performance on certain metabolites. These circumstances both create situations in which there is little information on which the model can train for that feature. Furthermore, there may well be technical factors that explain variation in performance across datasets. COAD samples, which yielded the best performance in within-dataset imputation, were profiled in an independent mass-spectrometry lab on a platform measuring comparatively few lipids. The PrCa dataset, which yielded the worst across-dataset performance, consisted of three subgroups of data with apparently strong batch effects and may need to be pre-processed individually. In the future, some of the latent structure in these datasets could be included in more sophisticated models based on MIRTH. For example, BrCa1 &amp; BrCa2 samples had variable estrogen receptor (ER) positivity, a metabolically-relevant stratification that MIRTH does not account for.</p>
    <sec id="Sec8">
      <title>MIRTH finds latent information in existing metabolomics data</title>
      <p id="Par24">The ability of MIRTH to impute completely unmeasured metabolite features may reduce the cost and complexity of metabolomic profiling. As we have demonstrated, MIRTH can recover rank-normalized metabolite abundances which are of biological or clinical interest without requiring additional tissue or additional profiling. This enhances the potential for discovery by enriching publicly-available metabolomics data with additional metabolite features. A key consideration here will be sample size: our success in inferring positive-/negative-mode metabolites (Fig. <xref rid="Fig5" ref-type="fig">5</xref>) was in part related to the large number of samples available for training in this dataset.</p>
      <p id="Par25">More generally, the success of MIRTH implies that information on a restricted set of metabolites is sufficient for the imputation of a much larger set of metabolites. We envision the development of an assay which, instead of comprehensively profiling thousands of metabolites in a single sample, simply seeks to measure a small but highly informative subset of metabolites. With accurate measurements of a small panel of predictive metabolites combined with other datasets which measure a wider profile of metabolites, MIRTH or related methods in the future may be able to offer a much wider view of the metabolome at a greatly reduced cost. To that end, we have identified a small set of metabolites from which MIRTH can impute the ranks of many other metabolites, though further experimental work is required to determine the best metabolites for such an assay (Supplementary Information, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S7, Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S9).</p>
    </sec>
    <sec id="Sec9">
      <title>MIRTH embeddings encode biological information</title>
      <p id="Par26">The decomposition of metabolomics data into a product of two low-dimensional matrices empirically captures some aspects of underlying biology. For example, the separation of tumor and normal samples in embedding space suggests that the MIRTH can learn general differences in the metabolome between these types of samples across cancer types. Similarly, since each embedding vector is a parts-based representation of the underlying data, the feature embedding vectors can be considered to represent different “components“ of the metabolome, which are then linearly combined according to the sample embeddings to recover the metabolite ranks of a given sample. Furthermore, MIRTH embeddings appear to discern chemical classification of metabolites without incorporating any additional information; for example, the separation of lipids and dipeptides in embedding space hints at high covariance between members of these metabolite classes. Future work could incorporate prior information into the matrix factorization, such as additional information on metabolite classes and structural similarities or on tissue and samples types.</p>
      <p id="Par27">The analysis of the embeddings also provokes questions about the general nature of correlations between metabolite pool sizes. While the existence and characteristics of such correlations are abundantly described in the literature [<xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR28">28</xref>], neither the mechanistic basis from which they arise nor their generality across biological contexts (e.g., different tissues, or different cancer types) is understood. The general principles which explain how metabolite pools co-vary have been difficult to discern because metabolite pools are subject to complex regulation, both by the metabolic enzymes that produce and consume them, as well as by more distal changes in metabolic flux or cellular physiology. The analysis of the MIRTH embeddings suggests that a relatively small set of linear combinations of metabolite pool sizes is sufficient to describe a large fraction of all the variation in the bulk metabolome. Understanding whether these embeddings are a reflection of a more fundamental, global relationship between metabolite pools is a worthy question for future investigation.</p>
    </sec>
  </sec>
  <sec id="Sec10">
    <title>Conclusions</title>
    <p id="Par28">The experiments described in this paper suggest that embedded within every metabolomics dataset is latent information about otherwise unmeasured metabolite features. Future work fully harnessing this latent information will likely require overcoming at least two challenges. The first relates to the inherently semiquantitative nature of metabolomics data, in which pool sizes are reported in ion counts that can only be compared across samples within the same feature. MIRTH overcomes this challenge by rank-transforming each metabolite feature within each batch. The cost of this solution is the loss of information on the magnitude of fluctuations in pool sizes. Future work which instead preserves relative magnitudes while remaining amenable to modeling across batches of data will prove powerful. MIRTH’s treatment of left-censored values could also be modified to draw on more sophisticated approaches that have been developed for within-dataset imputation. The second challenge relates to the very likely possibility that some correlations between metabolites will be specific to a particular tissue, disease, or other biological context. For example, certain metabolites may accumulate to a large extent in the context of mutations to genes coding for metabolic enzymes [<xref ref-type="bibr" rid="CR29">29</xref>]. Further generalizations of NMF, including those which leverage additional information about the tissue source or disease of interest, prior information on the relationship of metabolites to one another in the metabolic network, or a secondary dataset (e.g., genomics, gene expression) may improve the predictive performance of MIRTH.</p>
  </sec>
  <sec id="Sec11">
    <title>Methods</title>
    <p id="Par29">MIRTH imputes missing metabolites across <italic>K</italic> metabolomics datasets. Each of <inline-formula id="IEq17"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i = 1 \ldots K$$\end{document}</tex-math><mml:math id="M34"><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>…</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq17.gif"/></alternatives></inline-formula> datasets <inline-formula id="IEq18"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{D}_i$$\end{document}</tex-math><mml:math id="M36"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">D</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq18.gif"/></alternatives></inline-formula> contains the relative abundance levels of a subset <inline-formula id="IEq19"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_i$$\end{document}</tex-math><mml:math id="M38"><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq19.gif"/></alternatives></inline-formula> of the total metabolites <italic>P</italic> measured in <inline-formula id="IEq20"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n_i$$\end{document}</tex-math><mml:math id="M40"><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq20.gif"/></alternatives></inline-formula> samples. The relative abundance levels are not comparable across metabolites or datasets. MIRTH overcomes this limitation by transforming relative abundance levels to a common scale (normalized ranks) within each batch. MIRTH then applies a nonnegative matrix factorization algorithm to the transformed matrix. By learning latent factors for each metabolite and sample, MIRTH is able to impute missing metabolites both within the same dataset and across datasets.</p>
    <p id="Par30">We have implemented MIRTH in Python v.<inline-formula id="IEq21"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\ge$$\end{document}</tex-math><mml:math id="M42"><mml:mo>≥</mml:mo></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq21.gif"/></alternatives></inline-formula>3.7. A script for MIRTH imputation, as well as a scaled-down demonstration of imputation performance, is available in our Github repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/reznik-lab/MIRTH">https://github.com/reznik-lab/MIRTH</ext-link>. Experiments are run on Memorial Sloan Kettering Cancer Center’s High-Performance Computing Juno cluster. Figures are generated in R.</p>
    <p id="Par31">We assume that we are given <italic>K</italic> datasets, each representing one <italic>batch</italic> of data, i.e., a collection of samples from one metabolomics experiment. Each dataset records measurements of different sets of metabolites with different proportions of metabolite classes represented (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S5a). Every entry in the dataset contains a raw ion count for a specific metabolite detected in a sample. Ion counts below a threshold are not detected by the mass spectrometer. These counts are left-censored; the only information about them is that they are smaller than the smallest reported ion count in that dataset.</p>
    <p id="Par32">In the MIRTH method, the datasets individually undergo normalization and rank-transformation accounting for left-censoring as described below (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a). Then, the preprocessed single datasets are aggregated into a multiple-dataset matrix, which is then factorized and imputed (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b).</p>
    <sec id="Sec12">
      <title>Handling missing values in raw datasets</title>
      <p id="Par33">A targeted metabolomics dataset features two forms of missing data. The first class of missing data corresponds to metabolites which exist in a biological specimen at physiologically-relevant concentrations, but which have not been measured. We refer to these data as “missing metabolites,” emphasizing that their abundance is missing in all samples in a given dataset. The goal of MIRTH is to impute these missing data.</p>
      <p id="Par34">The second corresponds to metabolite measurements that are missing in some samples, but are measured in other samples in the same dataset. These missing values often represent instances where a metabolite’s abundance falls below the lowest quantified abundance of that metabolite across all samples. We refer to such instances as “left-censored” measurements. The extent of left-censoring varies by feature and by dataset (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S5b). MIRTH has specific procedures which handle left-censored data, as described below.</p>
    </sec>
    <sec id="Sec13">
      <title>Normalization</title>
      <p id="Par35">A variety of normalization techniques are used to control for variation in sample loading in metabolomics data [<xref ref-type="bibr" rid="CR30">30</xref>]. We compared MIRTH’s imputation performance with total ion count (TIC) normalization, probabilistic quotient normalization (PQN) and without normalization enabled. MIRTH performs comparably with both normalization methods (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S5c). For all analyses described in the text, each dataset was preprocessed with TIC normalization. In TIC normalization, the ion count for every metabolite entry in sample <italic>i</italic> is normalized by<disp-formula id="Equ9"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \varvec{D}_{\varvec{i}}^{\varvec{N}} = \frac{\varvec{D}_{i}}{f_{\varvec{D}_{\varvec{i}}}} \end{aligned}$$\end{document}</tex-math><mml:math id="M44" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">D</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">N</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">D</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>f</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">D</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:mrow></mml:msub></mml:msub></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq22"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{D_i^N}$$\end{document}</tex-math><mml:math id="M46"><mml:mrow><mml:msubsup><mml:mi mathvariant="bold-italic">D</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi><mml:mi mathvariant="bold-italic">N</mml:mi></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq22.gif"/></alternatives></inline-formula> is the TIC-normalized sample vector, <inline-formula id="IEq23"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{D_i}$$\end{document}</tex-math><mml:math id="M48"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">D</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq23.gif"/></alternatives></inline-formula> is the unnormalized sample vector, and <inline-formula id="IEq24"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f_{\varvec{D_i}}$$\end{document}</tex-math><mml:math id="M50"><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">D</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq24.gif"/></alternatives></inline-formula> is the TIC normalizer for sample <italic>i</italic>. The TIC normalizer is computed by summing the ion counts of all <italic>j</italic> metabolites in the sample,<disp-formula id="Equ10"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} f_{\varvec{D_i}} = \sum\limits_{j = 1}^{m} d_{i,j} + 0.5 \times \min (\varvec{D_i}) \times N_{{censored}_{\varvec{D_i}}} \end{aligned}$$\end{document}</tex-math><mml:math id="M52" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">D</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>m</mml:mi></mml:munderover><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>0.5</mml:mn><mml:mo>×</mml:mo><mml:mo movablelimits="true">min</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">D</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="italic">censored</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">D</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq25"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\min (\varvec{D_i})$$\end{document}</tex-math><mml:math id="M54"><mml:mrow><mml:mo movablelimits="true">min</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">D</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq25.gif"/></alternatives></inline-formula> is the minimum value in dataset <inline-formula id="IEq26"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{D_i}$$\end{document}</tex-math><mml:math id="M56"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">D</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq26.gif"/></alternatives></inline-formula> and <inline-formula id="IEq27"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N_{censored}$$\end{document}</tex-math><mml:math id="M58"><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi mathvariant="italic">censored</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq27.gif"/></alternatives></inline-formula> in the number of left-censored entries in the sample. Thus, left-censored values are included in the sum as one-half the the minimum value in the dataset.</p>
    </sec>
    <sec id="Sec14">
      <title>Rank-transformation</title>
      <p id="Par36">Since metabolomics only semi-quantitatively measures metabolite pool sizes, only one form of comparison (between two samples’ measurements of the same metabolite in the same dataset) is admissible. In contrast, comparisons of the abundance of two metabolites in the same sample or comparisons of the same metabolite across two samples from two different datasets are inadmissible. This is a fundamental limitation of mass spectrometry data, as a relative abundance measurement depends not only on a metabolite’s true concentration in the sample, but also on chemical and physical properties unique to the metabolite in question.</p>
      <p id="Par37">We rank the metabolite abundances of all the samples within each dataset. The samples with the highest ion count for a metabolite in the given dataset are ranked highest. The samples with the lowest ion count are ranked lowest. Left-censored values are tied for last rank. This distributes the sample abundances in each metabolite in the same way, allowing for the comparison of correlations between metabolite abundances in the same dataset. Rank-transformation also ensures that metabolite measurements can be compared across batches. Batch effects are typically assumed to take the form of shape and scale effects [<xref ref-type="bibr" rid="CR31">31</xref>]. That is, given true values <inline-formula id="IEq28"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Y^*$$\end{document}</tex-math><mml:math id="M60"><mml:msup><mml:mi>Y</mml:mi><mml:mo>∗</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq28.gif"/></alternatives></inline-formula>, the observed values <italic>Y</italic> are a latent linear function of the truth,<disp-formula id="Equ11"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} Y = f(\alpha Y^{*} + \beta ) \end{aligned}$$\end{document}</tex-math><mml:math id="M62" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>Y</mml:mi><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:msup><mml:mi>Y</mml:mi><mml:mrow><mml:mrow/><mml:mo>∗</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>β</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq29"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f(\cdot )$$\end{document}</tex-math><mml:math id="M64"><mml:mrow><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>·</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq29.gif"/></alternatives></inline-formula> is either assumed to take some parametric form like a normal distribution or is treated nonparametrically and assumed only to be monotone without other specification. In either setting, the rank is invariant to batch effects: the monotonicity of <inline-formula id="IEq30"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f(\cdot )$$\end{document}</tex-math><mml:math id="M66"><mml:mrow><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>·</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq30.gif"/></alternatives></inline-formula>, whether it is normal or nonparametric, enforces that the ranks are preserved in expectation.</p>
      <p id="Par38">Since the ranks are invariant to the local batch effects, we only need to be concerned, statistically, with between-batch ranks. But here again, batch effects are by definition localized to a batch. Thus by converting measurements to within-batch ranks, the ranks should be comparable across batches, under typical batch effect assumptions.</p>
      <p id="Par39">The rank of the <italic>i</italic>th uncensored sample in a feature, <inline-formula id="IEq31"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_{i,j}$$\end{document}</tex-math><mml:math id="M68"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq31.gif"/></alternatives></inline-formula>, is found by:<disp-formula id="Equ12"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} rank(d_{i,j}) = \frac{ 1 + \sum\limits_{i'=1}^{N_{total}} \mathbb {1}[d_{i,j} &gt; d_{i',j}] }{1+N_{total}} \end{aligned}$$\end{document}</tex-math><mml:math id="M70" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi mathvariant="italic">total</mml:mi></mml:mrow></mml:msub></mml:munderover><mml:mn mathvariant="double-struck">1</mml:mn><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi mathvariant="italic">total</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq32"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N_{total}$$\end{document}</tex-math><mml:math id="M72"><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi mathvariant="italic">total</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq32.gif"/></alternatives></inline-formula> is the total number of samples in the feature. The rank for the left-censored entries in a feature is set to<disp-formula id="Equ13"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \frac{0.5 \times (1 + N_{censored})}{1 + N_{total}} \end{aligned}$$\end{document}</tex-math><mml:math id="M74" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mfrac><mml:mrow><mml:mn>0.5</mml:mn><mml:mo>×</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi mathvariant="italic">censored</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi mathvariant="italic">total</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq33"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N_{censored}$$\end{document}</tex-math><mml:math id="M76"><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi mathvariant="italic">censored</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq33.gif"/></alternatives></inline-formula> is the total number of censored samples in the feature. This rank is halfway between the minimum rank of uncensored samples and zero. This maps the features with only uncensored metabolites uniformly from 0 to 1. Following rank-transformation, features in each dataset have the same marginal distribution conditioned on having the same sample size. Rank-transformation results in higher performance compared to simply scaling each feature from 0 to 1 in each dataset when imputing features across datasets (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S5d).</p>
    </sec>
    <sec id="Sec15">
      <title>Nonnegative matrix factorization (NMF)</title>
      <p id="Par40">Nonnegative matrix factorization (NMF) is commonly used to obtain a low-rank approximation of nonnegative, high-dimensional data matrices [<xref ref-type="bibr" rid="CR32">32</xref>]. NMF decomposes a matrix <inline-formula id="IEq34"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X} \in \mathbb {R}^{m \times n}, \varvec{X} &gt; 0$$\end{document}</tex-math><mml:math id="M78"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq34.gif"/></alternatives></inline-formula> into <inline-formula id="IEq35"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{W} \in \mathbb {R}^{m \times k}$$\end{document}</tex-math><mml:math id="M80"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">W</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mo>×</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq35.gif"/></alternatives></inline-formula> and <inline-formula id="IEq36"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{H} \in \mathbb {R}^{k \times n}$$\end{document}</tex-math><mml:math id="M82"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">H</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq36.gif"/></alternatives></inline-formula> such that <inline-formula id="IEq37"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X} \approx \varvec{WH}, \varvec{W,H}&gt;0$$\end{document}</tex-math><mml:math id="M84"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow><mml:mo>≈</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">WH</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">W</mml:mi><mml:mo mathvariant="bold">,</mml:mo><mml:mi mathvariant="bold-italic">H</mml:mi></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq37.gif"/></alternatives></inline-formula>. When the rows of <inline-formula id="IEq38"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X}$$\end{document}</tex-math><mml:math id="M86"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq38.gif"/></alternatives></inline-formula> contain samples, then the columns of factor <inline-formula id="IEq39"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{W}$$\end{document}</tex-math><mml:math id="M88"><mml:mrow><mml:mi mathvariant="bold-italic">W</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq39.gif"/></alternatives></inline-formula> describe the relative contributions of each embedding vector to a sample [<xref ref-type="bibr" rid="CR16">16</xref>] and can reveal clustering among samples [<xref ref-type="bibr" rid="CR18">18</xref>]. Similarly when the columns of <inline-formula id="IEq40"><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X}$$\end{document}</tex-math><mml:math id="M90"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq40.gif"/></alternatives></inline-formula> contain features (metabolites, in this case), the rows of factor matrix <inline-formula id="IEq41"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{H}$$\end{document}</tex-math><mml:math id="M92"><mml:mrow><mml:mi mathvariant="bold-italic">H</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq41.gif"/></alternatives></inline-formula> describes the relative contributions of the features to an embedding vector [<xref ref-type="bibr" rid="CR16">16</xref>, <xref ref-type="bibr" rid="CR18">18</xref>].</p>
      <p id="Par41">To prepare the data for NMF, datasets preprocessed with normalization and rank-transformation are aggregated into a single aggregate data matrix <inline-formula id="IEq42"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X} \in \mathbb {R}^{m \times n}$$\end{document}</tex-math><mml:math id="M94"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq42.gif"/></alternatives></inline-formula>, with rows corresponding to individual samples and columns corresponding to the complete set of metabolite measured across the batches. The sparseness of <inline-formula id="IEq43"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X}$$\end{document}</tex-math><mml:math id="M96"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq43.gif"/></alternatives></inline-formula> depends on the sparseness and feature overlap of the datasets that comprise it. For example, the matrix <inline-formula id="IEq44"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X}$$\end{document}</tex-math><mml:math id="M98"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq44.gif"/></alternatives></inline-formula> consisting of the nine metabolomics data datasets under consideration has 1727 samples, 1904 metabolite features, and 79.4% missing entries, including both missing metabolites and left-censored entries (Fig. <xref rid="Fig1" ref-type="fig">1</xref>c). In MIRTH, we formulate metabolite imputation of the unmeasured metabolites as a nonnegative matrix factorization problem which handles missing values,<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \min _{\varvec{W,H}} \sum\limits_{i=1}^{m} \sum\limits_{j=1}^{n} (x_{ij} - w_{i}^{\top } h_{j})^2 \nonumber \\ \text {subject to }\mathbf {W, H} \ge 0 \end{aligned}$$\end{document}</tex-math><mml:math id="M100" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:munder><mml:mo movablelimits="true">min</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">W</mml:mi><mml:mo mathvariant="bold">,</mml:mo><mml:mi mathvariant="bold-italic">H</mml:mi></mml:mrow></mml:munder><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>m</mml:mi></mml:munderover><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mi>⊤</mml:mi></mml:msubsup><mml:msub><mml:mi>h</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow/><mml:mtext>subject to</mml:mtext><mml:mspace width="0.333333em"/><mml:mrow><mml:mi mathvariant="bold">W</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where the original data matrix is factored into the product of two low-dimensional matrices <inline-formula id="IEq45"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$W \in \mathbb {R}^{m \times k}$$\end{document}</tex-math><mml:math id="M102"><mml:mrow><mml:mi>W</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mo>×</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq45.gif"/></alternatives></inline-formula> and <inline-formula id="IEq46"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$H\in \mathbb {R}^{k \times n}$$\end{document}</tex-math><mml:math id="M104"><mml:mrow><mml:mi>H</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq46.gif"/></alternatives></inline-formula>; missing <inline-formula id="IEq47"><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$x_{ij}$$\end{document}</tex-math><mml:math id="M106"><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq47.gif"/></alternatives></inline-formula> are omitted in the loss function. The structure of NMF naturally allows the imputation of missing values. Because <inline-formula id="IEq48"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{W}$$\end{document}</tex-math><mml:math id="M108"><mml:mrow><mml:mi mathvariant="bold-italic">W</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq48.gif"/></alternatives></inline-formula> and <inline-formula id="IEq49"><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{H}$$\end{document}</tex-math><mml:math id="M110"><mml:mrow><mml:mi mathvariant="bold-italic">H</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq49.gif"/></alternatives></inline-formula> have fewer entries than <inline-formula id="IEq50"><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X}$$\end{document}</tex-math><mml:math id="M112"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq50.gif"/></alternatives></inline-formula>, not all the entries of <inline-formula id="IEq51"><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X}$$\end{document}</tex-math><mml:math id="M114"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq51.gif"/></alternatives></inline-formula> are required to perform the decomposition. Provided the loss function is an entry-wise sum of losses, such as the least squares error used here, the matrix can be factorized by dropping the terms corresponding to the missing entries from the loss function [<xref ref-type="bibr" rid="CR33">33</xref>]. This minimization problem is solved with SciPy’s optimize.minimize [<xref ref-type="bibr" rid="CR34">34</xref>] and the autograd-minimize wrapper [<xref ref-type="bibr" rid="CR35">35</xref>] with the L-BFGS-B algorithm [<xref ref-type="bibr" rid="CR36">36</xref>]. Equivalently, a version of scikit-learn NMF that handles missing values can be used for faster runtimes [<xref ref-type="bibr" rid="CR37">37</xref>]. Solving the optimization problem above produces two matrices <inline-formula id="IEq52"><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{W}$$\end{document}</tex-math><mml:math id="M116"><mml:mrow><mml:mi mathvariant="bold-italic">W</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq52.gif"/></alternatives></inline-formula> and <inline-formula id="IEq53"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{H}$$\end{document}</tex-math><mml:math id="M118"><mml:mrow><mml:mi mathvariant="bold-italic">H</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq53.gif"/></alternatives></inline-formula> (Additional file <xref rid="MOESM3" ref-type="media">3</xref>), each with no missing entries, whose product <inline-formula id="IEq54"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{\hat{X}} = \varvec{WH}$$\end{document}</tex-math><mml:math id="M120"><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">X</mml:mi><mml:mo mathvariant="bold" stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">WH</mml:mi></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq54.gif"/></alternatives></inline-formula> also contains no missing entries. Following reconstruction, <inline-formula id="IEq55"><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{\hat{X}}$$\end{document}</tex-math><mml:math id="M122"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">X</mml:mi><mml:mo mathvariant="bold" stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq55.gif"/></alternatives></inline-formula> is rank-transformed again to ensure feature measurements remain mapped uniformly between 0 and 1. These entries are the predicted metabolite ranks imputed by MIRTH.</p>
    </sec>
    <sec id="Sec16">
      <title>Cross-validation</title>
      <p id="Par42">In order to determine the optimal number of embedding dimensions <italic>k</italic>, we perform <italic>v</italic>-fold cross-validation; typically, <inline-formula id="IEq56"><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$v=10$$\end{document}</tex-math><mml:math id="M124"><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq56.gif"/></alternatives></inline-formula>. We evaluate performance over a range of <italic>k</italic> in [1,80] or [1,60] in the single-dataset or across-dataset imputation cases, respectively.</p>
      <p id="Par43">For each <italic>k</italic>, we first identify the metabolite features that are available to use to score in dataset-wise cross validation, <italic>i.e.</italic> the metabolites in each dataset that are also measured in at least one other dataset. These available features are then equally partitioned into <italic>v</italic> folds (i.e., sets of metabolite features in each dataset on which we will test model performance with different sets of cross-validation parameters). Within each dataset, metabolites are randomly assigned to folds in order to reduce the amount of overlap between folds in different datasets (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S6a). Once the folds are defined, MIRTH loops through them, treating one at a time as unmeasured (masking all the fold’s features in the datasets where they appear), and factorize the resulting matrix. We then take the product <inline-formula id="IEq57"><alternatives><tex-math id="M125">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{WH}$$\end{document}</tex-math><mml:math id="M126"><mml:mrow><mml:mi mathvariant="bold-italic">WH</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq57.gif"/></alternatives></inline-formula> to recover <inline-formula id="IEq58"><alternatives><tex-math id="M127">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{\varvec{X}}$$\end{document}</tex-math><mml:math id="M128"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq58.gif"/></alternatives></inline-formula>, the imputed matrix with no missing data. Next, we compute the mean absolute error (MAE) between the true ranks of the metabolites in the fold (the metabolites we simulated as unmeasured) and the imputed ranks of those metabolites; the MAE is treated as the performance score for that fold. The scores for each fold are averaged, which yields a score for the particular value of <italic>k</italic>. This process is repeated for all <italic>k</italic>, and the value which results in the lowest MAE is chosen as the optimal number of embedding dimensions for the factorization (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S6b).</p>
    </sec>
    <sec id="Sec17">
      <title>Evaluating MIRTH’s performance</title>
      <p id="Par44">To evaluate MIRTH’s predictions of metabolite ranks, we mask a subset of metabolite measurements to simulate them as missing. After imputing the masked data with MIRTH, we compare the imputed metabolite ranks to the true ranks of the features that were simulated as missing. The chosen performance metric is Spearman’s rank correlation coefficient (<inline-formula id="IEq59"><alternatives><tex-math id="M129">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M130"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq59.gif"/></alternatives></inline-formula>), computed between actual and predicted metabolite ranks. Correlation coefficients are computed separately for each metabolite that was simulated as missing. The resulting <inline-formula id="IEq60"><alternatives><tex-math id="M131">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M132"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq60.gif"/></alternatives></inline-formula> values are then summarized, either across all the metabolites simulated as missing in one experiment (to assess the overall prediction quality of a single imputation) or for the same metabolite across several repeated experiments (to assess metabolite-specific prediction quality). The <inline-formula id="IEq61"><alternatives><tex-math id="M133">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M134"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq61.gif"/></alternatives></inline-formula> values are Fisher z-transformed before summarization; the summarized z-scores are then inverse-z-transformed to yield summarized <inline-formula id="IEq62"><alternatives><tex-math id="M135">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M136"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq62.gif"/></alternatives></inline-formula> values. P-values are adjusted for multiple testing with Benjamini-Hochberg (BH) correction [<xref ref-type="bibr" rid="CR38">38</xref>]. Details on how metabolite ranks are simulated as missing are included in their respective Results sections. Metabolites which are predicted with significant positive correlations with true ranks in more 90% of trials are deemed <italic>well-predicted</italic>. Metabolites are deemed <italic>reproducibly</italic> well-predicted if they are measured in at least four datasets and are well-predicted in at least three-quarters of the datasets in which they are measured.<fig id="Fig1"><label>Fig. 1</label><caption><p>Workflow for MIRTH Imputation of Metabolomics Data. <bold>a</bold> Individual datasets are normalized and rank-tranformed, accounting for left-censoring. <bold>b</bold> Preprocessed datasets (<inline-formula id="IEq63"><alternatives><tex-math id="M137">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{D_i}$$\end{document}</tex-math><mml:math id="M138"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">D</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq63.gif"/></alternatives></inline-formula>) are combined into a sparse aggregate data matrix (<inline-formula id="IEq64"><alternatives><tex-math id="M139">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X}$$\end{document}</tex-math><mml:math id="M140"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq64.gif"/></alternatives></inline-formula>), which is then factorized into embedding matrices <inline-formula id="IEq65"><alternatives><tex-math id="M141">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{W}$$\end{document}</tex-math><mml:math id="M142"><mml:mrow><mml:mi mathvariant="bold-italic">W</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq65.gif"/></alternatives></inline-formula> and <inline-formula id="IEq66"><alternatives><tex-math id="M143">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{H}$$\end{document}</tex-math><mml:math id="M144"><mml:mrow><mml:mi mathvariant="bold-italic">H</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq66.gif"/></alternatives></inline-formula>. The product <inline-formula id="IEq67"><alternatives><tex-math id="M145">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{WH}$$\end{document}</tex-math><mml:math id="M146"><mml:mrow><mml:mi mathvariant="bold-italic">WH</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq67.gif"/></alternatives></inline-formula> yields an imputed data matrix (<inline-formula id="IEq68"><alternatives><tex-math id="M147">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{\hat{X}}$$\end{document}</tex-math><mml:math id="M148"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">X</mml:mi><mml:mo mathvariant="bold" stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq68.gif"/></alternatives></inline-formula>). <bold>c</bold> Aggregate data from 9 pan-cancer metabolomics datasets with tumor and normal samples reveals poor across-dataset metabolite feature overlap and high degree of missingness</p></caption><graphic xlink:href="13059_2022_2738_Fig1_HTML" id="MO7"/></fig></p>
      <p id="Par45">
        <fig id="Fig2">
          <label>Fig. 2</label>
          <caption>
            <p>MIRTH achieves high accuracy imputing within datasets. <bold>a</bold> Samples for a subset of features were masked in half of all samples in a dataset before imputation to create data on which to assess imputation performance. <bold>b</bold> Imputation performance by dataset is reported by median <inline-formula id="IEq69"><alternatives><tex-math id="M149">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M150"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq69.gif"/></alternatives></inline-formula> values across all simulated-missing features in each MIRTH iteration. <bold>c</bold> Imputation performance by metabolite, reported as the median <inline-formula id="IEq70"><alternatives><tex-math id="M151">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M152"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq70.gif"/></alternatives></inline-formula> value for each metabolite across all trials, is plotted for each batch. Metabolites are ordered by decreasing imputation performance. <bold>d</bold> As dataset size (number of samples) increases along the <italic>x</italic>-axis, the proportion of well-predicted metabolites in a dataset increases as well. This illustrates the relationship between the number of training samples and overall imputation performance. <bold>e</bold> Imputation performance for each metabolite summarized across datasets (median <inline-formula id="IEq71"><alternatives><tex-math id="M153">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M154"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq71.gif"/></alternatives></inline-formula> values across datasets are plotted). A subset of consistently well-imputed metabolites are labeled. Reproducibly well-predicted metabolites are indicated in blue. <bold>f</bold> The predicted ranks versus the true ranks of example metabolites, methionine and palmitate (16:0), when imputed in each single dataset. Each point represents one sample in which the metabolite was measured</p>
          </caption>
          <graphic xlink:href="13059_2022_2738_Fig2_HTML" id="MO8"/>
        </fig>
      </p>
      <p id="Par46">
        <fig id="Fig3">
          <label>Fig. 3</label>
          <caption>
            <p>MIRTH achieves high accuracy in cross-dataset imputation and preserves biological characteristics in the data. <bold>a</bold> The same metabolites distinguish tumor and normal samples in RC12 and RC3. <bold>b</bold> Tumor-distinguishing metabolite patterns are recovered by MIRTH imputation of RC3 and RC12. <bold>c</bold> Schematic of experiment to assess the imputation of features that were entirely unmeasured in a dataset. <bold>d</bold> Typical by-metabolite <inline-formula id="IEq72"><alternatives><tex-math id="M155">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M156"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq72.gif"/></alternatives></inline-formula> values when those metabolite features are entirely masked from a target dataset. Metabolites are ordered by decreasing imputation performance. <bold>e</bold> By-metabolite performance summarized across target datasets, showing that many of the same metabolites are well-predicted in many target datasets. <bold>f</bold> Relationship between actual and predicted within-dataset metabolite ranks for two reproducibly well-predicted metabolites. Each point represents one sample in which the metabolite was measured</p>
          </caption>
          <graphic xlink:href="13059_2022_2738_Fig3_HTML" id="MO9"/>
        </fig>
      </p>
      <p id="Par47">
        <fig id="Fig4">
          <label>Fig. 4</label>
          <caption>
            <p>Embedding matrices reveal separation of features and samples and enrichment in certain metabolic pathways. <bold>a</bold> UMAP plots of sample embedding matrix <bold>W</bold> reveal some separation between batches and cancer types, as well as <bold>b</bold> separation between tumor and normal samples. <bold>c</bold> Feature embeddings separate peptides and lipids from other metabolites. <bold>d</bold> Certain pathways are enriched in certain embedding dimensions, though analysis is limited by statistical power</p>
          </caption>
          <graphic xlink:href="13059_2022_2738_Fig4_HTML" id="MO10"/>
        </fig>
      </p>
      <p id="Par48">
        <fig id="Fig5">
          <label>Fig. 5</label>
          <caption>
            <p>MIRTH accurately imputes across features measured in different mass spectrometer ionization modes. <bold>a</bold> Simulating a subset of samples as only measured in a single ionization mode, then imputing to assess performance. <bold>b</bold> Summarized imputation performance by ionization mode. Only metabolites measured in a single ionization mode are shown. <bold>c</bold> Examples of metabolites that are well-predicted across ionization modes. Each point represents one sample where the metabolite was measured</p>
          </caption>
          <graphic xlink:href="13059_2022_2738_Fig5_HTML" id="MO11"/>
        </fig>
      </p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Information</title>
    <sec id="Sec18">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="13059_2022_2738_MOESM1_ESM.zip">
            <caption>
              <p>Additional file 1: Supplementary Tables S1-7. Compiled supplementary tables S1-7 with titles enclosed.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="13059_2022_2738_MOESM2_ESM.pdf">
            <caption>
              <p>Additional file 2: Supplementary Figures S1-9. Compiled supplementary figures S1-9 with captions enclosed.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="13059_2022_2738_MOESM3_ESM.xlsx">
            <caption>
              <p>Additional file 3: Example MIRTH embedding matrices. Sample and feature embedding matrices (<bold>W</bold>, <bold>H</bold>) generated by applying MIRTH to 9-dataset aggregate with 30 embedding dimensions.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="13059_2022_2738_MOESM4_ESM.docx">
            <caption>
              <p>Additional file 4: Review history.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App2">
      <sec id="Sec19">
        <title>Appendix</title>
        <sec id="Sec20">
          <title>MIRTH experiments with simulated data</title>
          <sec id="Sec21">
            <title>Generating Simulated data</title>
            <p id="Par54">Generating simulated data can accelerate the development of machine learning methods when acquiring real training data is costly [<xref ref-type="bibr" rid="CR41">41</xref>]. The nine benchmark datasets in this study have variable size and sparsity. Evaluating MIRTH’s performance on realistic, synthetic datasets can help parse the effect of size and sparseness on performance under controlled conditions. As such, we simulated metabolomics datasets for benchmarking.</p>
            <p id="Par55">Our analysis confirmed that MIRTH’s multidimensional embedding space clusters related samples and metabolite features (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a–c). Consequently, a simulated dataset <inline-formula id="IEq73"><alternatives><tex-math id="M157">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{\varvec{s_1,..., s_N}\}$$\end{document}</tex-math><mml:math id="M158"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">s</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub><mml:mo mathvariant="bold">,</mml:mo><mml:mo mathvariant="bold">.</mml:mo><mml:mo mathvariant="bold">.</mml:mo><mml:mo mathvariant="bold">.</mml:mo><mml:mo mathvariant="bold">,</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">s</mml:mi><mml:mi mathvariant="bold-italic">N</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq73.gif"/></alternatives></inline-formula> would consist of <italic>n</italic> observations of a random <italic>m</italic>-dimensional Euclidean variable, such that the data belongs to <italic>J</italic> clusters.</p>
            <p id="Par56">We use a generative model to simulate metabolomics datasets, <inline-formula id="IEq74"><alternatives><tex-math id="M159">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{S} \in \mathbb {R}^{m \times n}$$\end{document}</tex-math><mml:math id="M160"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">S</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq74.gif"/></alternatives></inline-formula> where <italic>m</italic> is the number of samples and <italic>n</italic> is the number of metabolites. The dataset is generated as the product of simulated embeddings matrices, <inline-formula id="IEq75"><alternatives><tex-math id="M161">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{W_{sim}} \in \mathbb {R}^{m \times k}$$\end{document}</tex-math><mml:math id="M162"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">W</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">sim</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mo>×</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq75.gif"/></alternatives></inline-formula> and <inline-formula id="IEq76"><alternatives><tex-math id="M163">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{H_{sim}} \in \mathbb {R}^{k \times n}$$\end{document}</tex-math><mml:math id="M164"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">H</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">sim</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq76.gif"/></alternatives></inline-formula> where <italic>k</italic> is the number of embedding dimensions. To generate the embeddings matrices, a <italic>k</italic>-dimensional multivariate distribution of <italic>J</italic> cluster centroids is generated. This distribution is sampled to set the center of each embedding vector. The dataset is simulated as follows,</p>
            <p id="Par57">To generate <inline-formula id="IEq77"><alternatives><tex-math id="M165">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{W_{sim}}$$\end{document}</tex-math><mml:math id="M166"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">W</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">sim</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq77.gif"/></alternatives></inline-formula>:<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M167">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} c_{j_{clusters},k_{dims}}^{w}&amp;{\mathop {\thicksim }\limits ^{i.i.d.}} Gamma(k = 100, \theta = 1) \nonumber \\ d_n&amp;{\mathop {\thicksim }\limits ^{i.i.d.}} Cat(\varvec{\alpha })\\ w_{n,k_{dims}}&amp;\thicksim Gamma(k = 100, \theta = 1) + c_{d_{n,}k_{dims}}^{w} \nonumber \end{aligned}$$\end{document}</tex-math><mml:math id="M168" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi mathvariant="italic">clusters</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi mathvariant="italic">dims</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi>w</mml:mi></mml:msubsup></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mover><mml:mo>∼</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>.</mml:mo><mml:mi>i</mml:mi><mml:mo>.</mml:mo><mml:mi>d</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:mover><mml:mi>G</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>100</mml:mn><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow/><mml:msub><mml:mi>d</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mover><mml:mo>∼</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>.</mml:mo><mml:mi>i</mml:mi><mml:mo>.</mml:mo><mml:mi>d</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:mover><mml:mi>C</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow/><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi mathvariant="italic">dims</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>∼</mml:mo><mml:mi>G</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>100</mml:mn><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi mathvariant="italic">dims</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi>w</mml:mi></mml:msubsup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula>To generate <inline-formula id="IEq78"><alternatives><tex-math id="M169">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{H_{sim}}$$\end{document}</tex-math><mml:math id="M170"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">H</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">sim</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq78.gif"/></alternatives></inline-formula>:<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M171">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} c_{k_{dims},j_{clusters}}^{h}&amp;{\mathop {\thicksim }\limits ^{i.i.d.}} Gamma(k = 100, \theta = .1) \nonumber \\ d_m&amp;{\mathop {\thicksim }\limits ^{i.i.d.}} Cat(\varvec{\alpha }) \\ h_{k_{dims},m}&amp;\thicksim Gamma(k = .1, \theta = 1000) + c_{k_{dims},d_{m}}^{h}\nonumber \end{aligned}$$\end{document}</tex-math><mml:math id="M172" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi mathvariant="italic">dims</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi mathvariant="italic">clusters</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi>h</mml:mi></mml:msubsup></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mover><mml:mo>∼</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>.</mml:mo><mml:mi>i</mml:mi><mml:mo>.</mml:mo><mml:mi>d</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:mover><mml:mi>G</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>100</mml:mn><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mo>.</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow/><mml:msub><mml:mi>d</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mover><mml:mo>∼</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>.</mml:mo><mml:mi>i</mml:mi><mml:mo>.</mml:mo><mml:mi>d</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:mover><mml:mi>C</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow/><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi mathvariant="italic">dims</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>∼</mml:mo><mml:mi>G</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mo>.</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mn>1000</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi mathvariant="italic">dims</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mi>h</mml:mi></mml:msubsup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula>To generate <inline-formula id="IEq79"><alternatives><tex-math id="M173">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{S}$$\end{document}</tex-math><mml:math id="M174"><mml:mrow><mml:mi mathvariant="bold-italic">S</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq79.gif"/></alternatives></inline-formula>:<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M175">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \varvec{S} = \varvec{W_{sim}} \times \varvec{H_{sim}} \end{aligned}$$\end{document}</tex-math><mml:math id="M176" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">S</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">W</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">sim</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>×</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">H</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">sim</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq80"><alternatives><tex-math id="M177">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha _j =1, j= 1\ldots j_{clusters}$$\end{document}</tex-math><mml:math id="M178"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>…</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi mathvariant="italic">clusters</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq80.gif"/></alternatives></inline-formula>.</p>
            <p id="Par58">The matrix product of these two embedding matrices constructs a simulated dataset. A set of feature names to sample from is defined. The columns of the dataset are randomly assigned a subset of these feature names. The rows of the dataset are given labels according to dataset and sample number. Once labeled, the dataset can then be combined into an aggregate data matrix (<inline-formula id="IEq81"><alternatives><tex-math id="M179">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X}$$\end{document}</tex-math><mml:math id="M180"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq81.gif"/></alternatives></inline-formula>) or used in a single-set imputation. We generated data with <inline-formula id="IEq82"><alternatives><tex-math id="M181">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j_{clusters}=5$$\end{document}</tex-math><mml:math id="M182"><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi mathvariant="italic">clusters</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq82.gif"/></alternatives></inline-formula> and <inline-formula id="IEq83"><alternatives><tex-math id="M183">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k =10$$\end{document}</tex-math><mml:math id="M184"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq83.gif"/></alternatives></inline-formula>. The shape, <italic>k</italic>, and scale (<inline-formula id="IEq84"><alternatives><tex-math id="M185">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta$$\end{document}</tex-math><mml:math id="M186"><mml:mi>θ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq84.gif"/></alternatives></inline-formula>) of the sampled distributions for both the centroids and embedding matrix weights were chosen to create data similar to the 9 real datasets used for benchmarking.</p>
          </sec>
          <sec id="Sec22">
            <title>Experiment 1: Size</title>
            <p id="Par59">In this experiment, nine simulated datasets of identical size to the real datasets were generated. To isolate the effect of dataset size on within-dataset imputation performance, First, we applied MIRTH to one dataset at a time, masking 10% of the features in half the samples (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a). These masked entries in each dataset were imputed. Performance was better for larger datasets (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S7a), indicating that larger sample size improves within-set imputation performance. In general, the simulated data was imputed with much higher median <inline-formula id="IEq85"><alternatives><tex-math id="M187">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M188"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq85.gif"/></alternatives></inline-formula> than real data.</p>
            <p id="Par60">To isolate the effect of dataset size on <italic>cross-set</italic> imputation performance, we applied MIRTH to the aggregate dataset (9 merged simulated datasets), holding out entire features in one target dataset at a time (Fig. <xref rid="Fig3" ref-type="fig">3</xref>c). The cross-dataset imputation performance on the simulated data was roughly constant while the performance on the real data varied depending on the target dataset (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S7c). This simulation indicated that factors other than size contribute to performance of the across-set MIRTH imputation.</p>
          </sec>
          <sec id="Sec23">
            <title>Experiment 2: Missingness</title>
            <p id="Par61">To test the effect of randomly-missing data on MIRTH’s imputation performance, identically-sized datasets were generated. Entries were randomly masked, with the proportion of masked entries ranging from 0 to 90% with a 10% step size. We evaluated single-set MIRTH imputation as usual (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a). As the number of missing entries increases, the median performance (<inline-formula id="IEq86"><alternatives><tex-math id="M189">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M190"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq86.gif"/></alternatives></inline-formula>) approached 0 (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S7b). The low performance stabilized around 50% missing entries.</p>
            <p id="Par62">We also constructed three datasets of identical size whose entries were randomly masked at different proportions (10%, 50%, 90%). We evaluated MIRTH’s across-set imputation performance as usual (Fig. <xref rid="Fig2" ref-type="fig">2</xref>c). As the number of randomly-missing entries increased, the median performance (<inline-formula id="IEq87"><alternatives><tex-math id="M191">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho$$\end{document}</tex-math><mml:math id="M192"><mml:mi>ρ</mml:mi></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq87.gif"/></alternatives></inline-formula>) decreased, approaching 0 (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S7d).</p>
          </sec>
          <sec id="Sec24">
            <title>Experiment 3: Censoring</title>
            <p id="Par63">To simulate left-censoring, the ten lowest-valued entries in each feature in a dataset are masked. The imputed ranks of the simulated-censored measurements are compared to the true ranks of the same samples. Alternatively, the imputed ranks of the unmasked ten-lowest values can be compared to their true ranks.</p>
            <p id="Par64">We evaluated censoring imputation on real data (RC12). There are already many censored measurements in the dataset. Imputed ranks are consistently lower when their corresponding measurements are simulated as censored than when they are actually included in the training data (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S7e). Since some features have only one or a few measurements, a cluster of true ranks appears near 0.5.</p>
            <p id="Par65">This evaluation scheme was also run on a simulated dataset with 30% of entries randomly missing. Similarly, imputed ranks are lower when the data point is simulated censored than when the data point is actually included in the training data (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S7f). These findings confirm that MIRTH preserves the low ranks of censored data, which ultimately correspond to low metabolite abundance.</p>
          </sec>
        </sec>
        <sec id="Sec25">
          <title>Using MIRTH to identify a set of core predictive features</title>
          <p id="Par66">Given the success of MIRTH for within- and across-dataset imputation, we aim to identify a small set of metabolites that could inform the predictions of a larger set of metabolite ranks. With further development, precise measurements of this small set of metabolites could constitute an assay that reduces the cost of profiling large parts of the metabolome.</p>
          <p id="Par67">One approach is to find the set of features that maximizes the mutual information of the core features and batch features. In other words, we want to find the set of training features which reduces the uncertainty about all the features in the dataset. The mutual information, <inline-formula id="IEq88"><alternatives><tex-math id="M193">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{I}$$\end{document}</tex-math><mml:math id="M194"><mml:mrow><mml:mi mathvariant="bold-italic">I</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq88.gif"/></alternatives></inline-formula>, between sets <italic>X</italic> and <italic>Y</italic> is defined as<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M195">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \varvec{I(X,Y)} := \varvec{H(X) - H(X|Y)} \end{aligned}$$\end{document}</tex-math><mml:math id="M196" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">I</mml:mi><mml:mo mathvariant="bold" stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">X</mml:mi><mml:mo mathvariant="bold">,</mml:mo><mml:mi mathvariant="bold-italic">Y</mml:mi><mml:mo mathvariant="bold" stretchy="false">)</mml:mo></mml:mrow><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">H</mml:mi><mml:mo mathvariant="bold" stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">X</mml:mi><mml:mo mathvariant="bold" stretchy="false">)</mml:mo><mml:mo mathvariant="bold">-</mml:mo><mml:mi mathvariant="bold-italic">H</mml:mi><mml:mo mathvariant="bold" stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">X</mml:mi><mml:mo mathvariant="bold" stretchy="false">|</mml:mo><mml:mi mathvariant="bold-italic">Y</mml:mi><mml:mo mathvariant="bold" stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq89"><alternatives><tex-math id="M197">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{H}$$\end{document}</tex-math><mml:math id="M198"><mml:mrow><mml:mi mathvariant="bold-italic">H</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq89.gif"/></alternatives></inline-formula> is the entropy of the set [<xref ref-type="bibr" rid="CR42">42</xref>].</p>
          <p id="Par68">Let <inline-formula id="IEq90"><alternatives><tex-math id="M199">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{C}$$\end{document}</tex-math><mml:math id="M200"><mml:mrow><mml:mi mathvariant="bold-italic">C</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq90.gif"/></alternatives></inline-formula> be the set of core features selected for a dataset, and let <inline-formula id="IEq91"><alternatives><tex-math id="M201">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{F}$$\end{document}</tex-math><mml:math id="M202"><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq91.gif"/></alternatives></inline-formula> be the set of all features measured in that dataset. To find the best set of core features, we want to find<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M203">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \displaystyle {\max _{\varvec{C}} \varvec{I(C,F)} } \end{aligned}$$\end{document}</tex-math><mml:math id="M204" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:munder><mml:mo movablelimits="true">max</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">C</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mi mathvariant="bold-italic">I</mml:mi><mml:mo mathvariant="bold" stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">C</mml:mi><mml:mo mathvariant="bold">,</mml:mo><mml:mi mathvariant="bold-italic">F</mml:mi><mml:mo mathvariant="bold" stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula>Choosing a set of features that are maximally informative through mutual information is hard to estimate statistically [<xref ref-type="bibr" rid="CR43">43</xref>]. However, we can approximate the concept by instead minimizing the predictive error between the true data and the data predicted by MIRTH trained under the core features. We want to find the set that minimizes the mean absolute error (MAE),<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M205">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \displaystyle {\min _{\varvec{C}} MAE(\hat{\varvec{X}}_{test},\varvec{X}_{test})} = \displaystyle {\min _{\varvec{C}} \frac{1}{n}{\sum _{i=1}^{n} |\hat{x}_{i} - x_{i}|}} \end{aligned}$$\end{document}</tex-math><mml:math id="M206" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:munder><mml:mo movablelimits="true">min</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">C</mml:mi></mml:mrow></mml:munder><mml:mi>M</mml:mi><mml:mi>A</mml:mi><mml:mi>E</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mrow><mml:mi mathvariant="italic">test</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">test</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo movablelimits="true">min</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">C</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula>with <inline-formula id="IEq92"><alternatives><tex-math id="M207">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{\varvec{X}}_{test}$$\end{document}</tex-math><mml:math id="M208"><mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mrow><mml:mi mathvariant="italic">test</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq92.gif"/></alternatives></inline-formula> the predicted ranks of the testing data trained on the set of core features <inline-formula id="IEq93"><alternatives><tex-math id="M209">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{C}$$\end{document}</tex-math><mml:math id="M210"><mml:mrow><mml:mi mathvariant="bold-italic">C</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq93.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq94"><alternatives><tex-math id="M211">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{X}_{test}$$\end{document}</tex-math><mml:math id="M212"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">test</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq94.gif"/></alternatives></inline-formula> the true ranks of the testing data.</p>
          <p id="Par69">As we augment the set of core features, we choose <inline-formula id="IEq95"><alternatives><tex-math id="M213">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f_{i}$$\end{document}</tex-math><mml:math id="M214"><mml:msub><mml:mi>f</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq95.gif"/></alternatives></inline-formula> such that<disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M215">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \displaystyle {\min _{\varvec{{f_i}}} MAE(\hat{\varvec{X}}_{test},\varvec{X}_{test})} \end{aligned}$$\end{document}</tex-math><mml:math id="M216" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:munder><mml:mo movablelimits="true">min</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">f</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mi>M</mml:mi><mml:mi>A</mml:mi><mml:mi>E</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mrow><mml:mi mathvariant="italic">test</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">test</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2022_2738_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq96"><alternatives><tex-math id="M217">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{\varvec{X}}_{test}$$\end{document}</tex-math><mml:math id="M218"><mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mrow><mml:mi mathvariant="italic">test</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq96.gif"/></alternatives></inline-formula> is imputed by the model trained on <inline-formula id="IEq97"><alternatives><tex-math id="M219">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{C} \cup f_{i}$$\end{document}</tex-math><mml:math id="M220"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">C</mml:mi></mml:mrow><mml:mo>∪</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq97.gif"/></alternatives></inline-formula>.</p>
          <p id="Par70">To approximate the solution to this minimization problem, we use a greedy forward step-wise selection algorithm (Algorithm 1). In doing so, we assume that the problem is submodular, <italic>i.e.</italic> that the marginal gain in performance from adding an extra element <italic>c</italic> to the set of core features <inline-formula id="IEq98"><alternatives><tex-math id="M221">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{C}$$\end{document}</tex-math><mml:math id="M222"><mml:mrow><mml:mi mathvariant="bold-italic">C</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq98.gif"/></alternatives></inline-formula> is greater than the marginal gain in performance when <italic>c</italic> is added to any superset of <inline-formula id="IEq99"><alternatives><tex-math id="M223">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{C}$$\end{document}</tex-math><mml:math id="M224"><mml:mrow><mml:mi mathvariant="bold-italic">C</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13059_2022_2738_Article_IEq99.gif"/></alternatives></inline-formula> [<xref ref-type="bibr" rid="CR44">44</xref>]. Submodularity is a reasonable assumption since choosing the set of core features through mutual information is submodular [<xref ref-type="bibr" rid="CR45">45</xref>].</p>
          <p id="Par71">Before selecting core features, we calculate the by-dataset baseline MAE values of MIRTH imputation with no training features in the target dataset (due to non-uniformity cause by left-censoring, the MAE values of rank-transformed are not necessarily 0.25). Selection of a core feature begins with a list of candidate features, consisting of all features in the aggregate dataset except for the current core features (when selecting the first core feature, this set is empty). Each candidate feature, along with any previous core features, are used as training data for each target dataset. All other features are held out from the target dataset. MIRTH is applied to the remaining data (including all other non-target datasets), and MAE is computed. If a candidate feature is not present in a target dataset, the previous baseline MAE is substituted. Once all candidate features have been assessed in all datasets, the average MAE across for each candidate is computed across datasets. The candidate feature yielding the lowest average MAE is selected as the next core feature; the by-batch MAE values become the new baseline MAE values. This process is repeated for the desired number of candidate features.</p>
          <graphic position="anchor" xlink:href="13059_2022_2738_Figa_HTML" id="MO19"/>
          <p id="Par72">We identified 50 core metabolite features using Algorithm 1. As expected, the average MAE decreased as the size of the set of core features increased (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S9). The selection algorithm is biased to first pick features that are measured in many datasets, before quickly becoming biased toward features measured in only one dataset (Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Fig. S9). The first of the 50 metabolites, phosphoethanolamine, is involved in phospholipid metabolism. The core features span various metabolite classes: they consist of 12 lipids, 7 xenobiotics (5 of which are drugs), 6 peptides, 4 amino acids, 3 cofactors and vitamins, 1 carbohydrate, 1 nucleotide, and 16 uncharacterized metabolites (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S7).</p>
          <p id="Par73">Algorithm 1’s tendency toward choosing metabolites that are measured in few datasets somewhat hinders the utility of the list of 50 metabolites it has nominated. It may also suggest the existence of cancer-type-specific core metabolite features. Nonetheless, the selected set serves as a template for future investigation. Further refinement of Algorithm 1, as well as in-vitro experiments to determine the reliability of measuring these metabolites, could help curate or expand the set of core metabolite features.</p>
        </sec>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>Benjamin A Freeman and Sophie Jaro are co-first authors.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>We would like to thank Lydia Finley, Costas Lyssiotis, and the members of the Tansey and Reznik laboratories for critical feedback.</p>
    <sec id="FPar2">
      <title>Peer review information</title>
      <p id="Par49">Wenjing She was the primary editor of this article and managed its editorial process and peer review in collaboration with the rest of the editorial team.</p>
    </sec>
    <sec id="FPar3">
      <title>Review history</title>
      <p id="Par50">The review history is available as Additional file <xref rid="MOESM4" ref-type="media">4</xref>.</p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>BAF and SMJ contributed equally. WT and ER contributed equally. All correspondence to WT and ER. The author(s) read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>This work was supported by the Geoffrey Beene Cancer Research Center Grant Award, Department of Defense Kidney Cancer Research Program (no. W81XWH-18-1-0318), Cycle For Survival Equinox Innovation Award, Kidney Cancer Association Young Investigator Award, Brown Performance Group Innovation in Cancer Informatics Fund, and NIH/NCI Cancer Center Support Grant (P30 CA008748). WT is supported by a grant from the Tow Center for Developmental Oncology.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>All benchmarking datasets used in this study have been previously published [<xref ref-type="bibr" rid="CR9">9</xref>, <xref ref-type="bibr" rid="CR21">21</xref>, <xref ref-type="bibr" rid="CR24">24</xref>]. MIRTH and a scaled-down demonstration of performance benchmarking are available on GitHub [<xref ref-type="bibr" rid="CR39">39</xref>]: <ext-link ext-link-type="uri" xlink:href="https://github.com/reznik-lab/MIRTH">https://github.com/reznik-lab/MIRTH</ext-link>. Please see the licensing information in the repository for terms of use. The current MIRTH release is also deposited at a Zenodo repository [<xref ref-type="bibr" rid="CR40">40</xref>]: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.6803240">10.5281/zenodo.6803240</ext-link>.</p>
  </notes>
  <notes>
    <title>Declarations</title>
    <notes id="FPar4">
      <title>Ethics approval and consent to participate</title>
      <p id="Par51">Not applicable.</p>
    </notes>
    <notes id="FPar5" notes-type="COI-statement">
      <title>Competing interests</title>
      <p id="Par52">The authors declare no competing interests.</p>
    </notes>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spratlin</surname>
            <given-names>JL</given-names>
          </name>
          <name>
            <surname>Serkova</surname>
            <given-names>NJ</given-names>
          </name>
          <name>
            <surname>Eckhardt</surname>
            <given-names>SG</given-names>
          </name>
        </person-group>
        <article-title>Clinical applications of metabolomics in oncology: a review</article-title>
        <source>Clin Cancer Res.</source>
        <year>2009</year>
        <volume>15</volume>
        <issue>2</issue>
        <fpage>431</fpage>
        <lpage>40</lpage>
        <?supplied-pmid 19147747?>
        <pub-id pub-id-type="pmid">19147747</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Johnson</surname>
            <given-names>CH</given-names>
          </name>
          <name>
            <surname>Ivanisevic</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Siuzdak</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Metabolomics: beyond biomarkers and towards mechanisms</article-title>
        <source>Nat Rev Mol Cell Biol.</source>
        <year>2016</year>
        <volume>17</volume>
        <issue>7</issue>
        <fpage>451</fpage>
        <lpage>9</lpage>
        <?supplied-pmid 26979502?>
        <pub-id pub-id-type="pmid">26979502</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Anglada-Girotto</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Handschin</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Ortmayr</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Campos</surname>
            <given-names>AI</given-names>
          </name>
          <name>
            <surname>Gillet</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Manfredi</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Combining CRISPRi and metabolomics for functional annotation of compound libraries</article-title>
        <source>Nat Chem Biol.</source>
        <year>2022</year>
        <volume>18</volume>
        <fpage>482</fpage>
        <lpage>491</lpage>
        <?supplied-pmid 35194207?>
        <pub-id pub-id-type="pmid">35194207</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Faubert</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Tasdogan</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Morrison</surname>
            <given-names>SJ</given-names>
          </name>
          <name>
            <surname>Mathews</surname>
            <given-names>TP</given-names>
          </name>
          <name>
            <surname>DeBerardinis</surname>
            <given-names>RJ</given-names>
          </name>
        </person-group>
        <article-title>Stable isotope tracing to assess tumor metabolism in vivo</article-title>
        <source>Nat Protoc.</source>
        <year>2021</year>
        <volume>16</volume>
        <issue>11</issue>
        <fpage>5123</fpage>
        <lpage>45</lpage>
        <?supplied-pmid 34535790?>
        <pub-id pub-id-type="pmid">34535790</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>PH</given-names>
          </name>
          <name>
            <surname>Cai</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Huffman</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Faubert</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metabolic Diversity in Human Non-Small Cell Lung Cancer Cells</article-title>
        <source>Mol Cell.</source>
        <year>2019</year>
        <volume>76</volume>
        <issue>5</issue>
        <fpage>838</fpage>
        <lpage>51</lpage>
        <?supplied-pmid 31564558?>
        <pub-id pub-id-type="pmid">31564558</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Rabinowitz</surname>
            <given-names>JD</given-names>
          </name>
        </person-group>
        <article-title>Metabolomics and Isotope Tracing</article-title>
        <source>Cell.</source>
        <year>2018</year>
        <volume>173</volume>
        <issue>4</issue>
        <fpage>822</fpage>
        <lpage>37</lpage>
        <?supplied-pmid 29727671?>
        <pub-id pub-id-type="pmid">29727671</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schmidt</surname>
            <given-names>DR</given-names>
          </name>
          <name>
            <surname>Patel</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Kirsch</surname>
            <given-names>DG</given-names>
          </name>
          <name>
            <surname>Lewis</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Vander Heiden</surname>
            <given-names>MG</given-names>
          </name>
          <name>
            <surname>Locasale</surname>
            <given-names>JW</given-names>
          </name>
        </person-group>
        <article-title>Metabolomics in cancer research and emerging applications in clinical oncology</article-title>
        <source>CA Cancer J Clin.</source>
        <year>2021</year>
        <volume>71</volume>
        <issue>4</issue>
        <fpage>333</fpage>
        <lpage>58</lpage>
        <?supplied-pmid 33982817?>
        <pub-id pub-id-type="pmid">33982817</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <mixed-citation publication-type="other">Braga CP, Adamec J. Metabolome analysis. In: Encyclopedia of Bioinformatics and Computational Biology: ABC of Bioinformatics; 2018. p. 463–75. ISBN: 9780128114148.</mixed-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Reznik</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Luna</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Aksoy</surname>
            <given-names>BA</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>EM</given-names>
          </name>
          <name>
            <surname>La</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Ostrovnaya</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A Landscape of Metabolic Variation across Tumor Types</article-title>
        <source>Cell Syst.</source>
        <year>2018</year>
        <volume>6</volume>
        <issue>3</issue>
        <fpage>301</fpage>
        <lpage>313.e3</lpage>
        <?supplied-pmid 29396322?>
        <pub-id pub-id-type="pmid">29396322</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nyamundanda</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Brennan</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Gormley</surname>
            <given-names>IC</given-names>
          </name>
        </person-group>
        <article-title>Probabilistic principal component analysis for metabolomic data</article-title>
        <source>BMC Bioinforma.</source>
        <year>2010</year>
        <volume>11</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>11</lpage>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Do</surname>
            <given-names>KT</given-names>
          </name>
          <name>
            <surname>Wahl</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Raffler</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Molnos</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Laimighofer</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Adamski</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Characterization of missing values in untargeted MS-based metabolomics data and evaluation of missing data handling strategies</article-title>
        <source>Metabolomics.</source>
        <year>2018</year>
        <volume>14</volume>
        <issue>10</issue>
        <fpage>1</fpage>
        <lpage>18</lpage>
        <pub-id pub-id-type="pmid">29249916</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Faquih</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>van Smeden</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>le Cessie</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kastenmüller</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Krumsiek</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A workflow for missing values imputation of untargeted metabolomics data</article-title>
        <source>Metabolites.</source>
        <year>2020</year>
        <volume>10</volume>
        <issue>12</issue>
        <fpage>486</fpage>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wei</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Su</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Jia</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Missing value imputation approach for mass spectrometry-based metabolomics data</article-title>
        <source>Sci Rep.</source>
        <year>2018</year>
        <volume>8</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>10</lpage>
        <pub-id pub-id-type="pmid">29311619</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kumar</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Hoque</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Sugimoto</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Kernel weighted least square approach for imputing missing values of metabolomics data</article-title>
        <source>Sci Rep.</source>
        <year>2021</year>
        <volume>11</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="pmid">33414495</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <mixed-citation publication-type="other">Xu J, Wang Y, Xu X, Cheng KK, Raftery D, Dong J. NMF-Based Approach for Missing Values Imputation of Mass Spectrometry Metabolomics Data. Molecules. 2021;26(19):5787.</mixed-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stein-O’Brien</surname>
            <given-names>GL</given-names>
          </name>
          <name>
            <surname>Arora</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Culhane</surname>
            <given-names>AC</given-names>
          </name>
          <name>
            <surname>Favorov</surname>
            <given-names>AV</given-names>
          </name>
          <name>
            <surname>Garmire</surname>
            <given-names>LX</given-names>
          </name>
          <name>
            <surname>Greene</surname>
            <given-names>CS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Enter the matrix: factorization uncovers knowledge from omics</article-title>
        <source>Trends Genet.</source>
        <year>2018</year>
        <volume>34</volume>
        <issue>10</issue>
        <fpage>790</fpage>
        <lpage>805</lpage>
        <?supplied-pmid 30143323?>
        <pub-id pub-id-type="pmid">30143323</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Devarajan</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Nonnegative matrix factorization: an analytical and interpretive tool in computational biology</article-title>
        <source>PLoS Comput Biol.</source>
        <year>2008</year>
        <volume>4</volume>
        <issue>7</issue>
        <fpage>e1000029</fpage>
        <?supplied-pmid 18654623?>
        <pub-id pub-id-type="pmid">18654623</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Brunet</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Tamayo</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Golub</surname>
            <given-names>TR</given-names>
          </name>
          <name>
            <surname>Mesirov</surname>
            <given-names>JP</given-names>
          </name>
        </person-group>
        <article-title>Metagenes and molecular pattern discovery using matrix factorization</article-title>
        <source>Proc Natl Acad Sci.</source>
        <year>2004</year>
        <volume>101</volume>
        <issue>12</issue>
        <fpage>4164</fpage>
        <lpage>9</lpage>
        <?supplied-pmid 15016911?>
        <pub-id pub-id-type="pmid">15016911</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pascual-Montano</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Carmona-Saez</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Chagoyen</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Tirado</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Carazo</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Pascual-Marqui</surname>
            <given-names>RD</given-names>
          </name>
        </person-group>
        <article-title>bioNMF: a versatile tool for non-negative matrix factorization in biology</article-title>
        <source>BMC Bioinformatics.</source>
        <year>2006</year>
        <volume>7</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="pmid">16393334</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nik-Zainal</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Davies</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Staaf</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Ramakrishna</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Glodzik</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Zou</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Landscape of somatic mutations in 560 breast cancer whole-genome sequences</article-title>
        <source>Nature.</source>
        <year>2016</year>
        <volume>534</volume>
        <issue>7605</issue>
        <fpage>47</fpage>
        <lpage>54</lpage>
        <?supplied-pmid 27135926?>
        <pub-id pub-id-type="pmid">27135926</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Ning</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Ghandi</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Kryukov</surname>
            <given-names>GV</given-names>
          </name>
          <name>
            <surname>Gopal</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Deik</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The landscape of cancer cell line metabolism</article-title>
        <source>Nat Med.</source>
        <year>2019</year>
        <volume>25</volume>
        <issue>5</issue>
        <fpage>850</fpage>
        <lpage>60</lpage>
        <?supplied-pmid 31068703?>
        <pub-id pub-id-type="pmid">31068703</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dorrity</surname>
            <given-names>MW</given-names>
          </name>
          <name>
            <surname>Saunders</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Queitsch</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Fields</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Dimensionality reduction by UMAP to visualize physical and genetic interactions</article-title>
        <source>Nat Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="pmid">31911652</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Boyer</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>HJ</given-names>
          </name>
          <name>
            <surname>Steele</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Sajjakulnukit</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Andren</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiomic characterization of pancreatic cancer-associated macrophage polarization reveals deregulated metabolic programs driven by the GM-CSF-PI3K pathway</article-title>
        <source>Elife.</source>
        <year>2022</year>
        <volume>11</volume>
        <fpage>e73796</fpage>
        <?supplied-pmid 35156921?>
        <pub-id pub-id-type="pmid">35156921</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>HJ</given-names>
          </name>
          <name>
            <surname>Kremer</surname>
            <given-names>DM</given-names>
          </name>
          <name>
            <surname>Sajjakulnukit</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Lyssiotis</surname>
            <given-names>CA</given-names>
          </name>
        </person-group>
        <article-title>A large-scale analysis of targeted metabolomics data from heterogeneous biological samples provides insights into metabolite dynamics</article-title>
        <source>Metabolomics.</source>
        <year>2019</year>
        <volume>15</volume>
        <issue>7</issue>
        <fpage>1</fpage>
        <lpage>13</lpage>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Calderón-Santiago</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Fernández-Peralbo</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Priego-Capote</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Luque de Castro</surname>
            <given-names>MD</given-names>
          </name>
        </person-group>
        <article-title>MSCombine: a tool for merging untargeted metabolomic data from high-resolution mass spectrometry in the positive and negative ionization modes</article-title>
        <source>Metabolomics</source>
        <year>2016</year>
        <volume>12</volume>
        <issue>3</issue>
        <fpage>1</fpage>
        <lpage>12</lpage>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Camacho</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>De La Fuente</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Mendes</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>The origin of correlations in metabolomics data</article-title>
        <source>Metabolomics.</source>
        <year>2005</year>
        <volume>1</volume>
        <issue>1</issue>
        <fpage>53</fpage>
        <lpage>63</lpage>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fell</surname>
            <given-names>DA</given-names>
          </name>
        </person-group>
        <article-title>Metabolic control analysis: a survey of its theoretical and experimental development</article-title>
        <source>Biochem J.</source>
        <year>1992</year>
        <volume>286</volume>
        <issue>Pt 2</issue>
        <fpage>313</fpage>
        <?supplied-pmid 1530563?>
        <pub-id pub-id-type="pmid">1530563</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Levine</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Hwa</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>Stochastic fluctuations in metabolic pathways</article-title>
        <source>Proc Natl Acad Sci.</source>
        <year>2007</year>
        <volume>104</volume>
        <issue>22</issue>
        <fpage>9224</fpage>
        <lpage>9</lpage>
        <?supplied-pmid 17517669?>
        <pub-id pub-id-type="pmid">17517669</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <mixed-citation publication-type="other">Yoo A, Tang C, Zucker M, Fitzgerald K, DiNatale RG, Rappold PM, et al. Genomic and Metabolic Hallmarks of SDH- and FH-deficient Renal Cell Carcinomas. Eur Urol Focus. 2022. Available from: <ext-link ext-link-type="uri" xlink:href="https://www.sciencedirect.com/science/article/pii/S2405456921003126">https://www.sciencedirect.com/science/article/pii/S2405456921003126</ext-link>.</mixed-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wulff</surname>
            <given-names>JE</given-names>
          </name>
          <name>
            <surname>Mitchell</surname>
            <given-names>MW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A comparison of various normalization methods for LC/MS metabolomics data</article-title>
        <source>Adv Biosci Biotechnol.</source>
        <year>2018</year>
        <volume>9</volume>
        <issue>08</issue>
        <fpage>339</fpage>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McKennan</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Ober</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Nicolae</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Estimation and Inference in Metabolomics with Non-random Missing Data and Latent Factors</article-title>
        <source>Ann Appl Stat.</source>
        <year>2020</year>
        <volume>14</volume>
        <issue>2</issue>
        <fpage>789</fpage>
        <lpage>808</lpage>
        <?supplied-pmid 34221212?>
        <pub-id pub-id-type="pmid">34221212</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Leuschner</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Schmidt</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Fernsel</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Lachmund</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Boskamp</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Maass</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Supervised non-negative matrix factorization methods for MALDI imaging applications</article-title>
        <source>Bioinformatics.</source>
        <year>2019</year>
        <volume>35</volume>
        <issue>11</issue>
        <fpage>1940</fpage>
        <lpage>7</lpage>
        <?supplied-pmid 30395171?>
        <pub-id pub-id-type="pmid">30395171</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Boutros</surname>
            <given-names>PC</given-names>
          </name>
        </person-group>
        <article-title>Optimization and expansion of non-negative matrix factorization</article-title>
        <source>BMC Bioinformatics.</source>
        <year>2020</year>
        <volume>21</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>10</lpage>
        <pub-id pub-id-type="pmid">31898485</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <mixed-citation publication-type="other">Virtanen P, Gommers R, Oliphant TE, Haberland M, Reddy T, Cournapeau D, et al. SciPy 1.0: Fundamental Algorithms for Scientific Computing in Python. Nat Methods. 2020;17:261–72.</mixed-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <mixed-citation publication-type="other">Rigal B. autograd-minimize: a wrapper around scipy minimize which uses the autograd capacities of tensorflow to compute the gradient and hessian. GitHub; 2022. <ext-link ext-link-type="uri" xlink:href="https://github.com/brunorigal/autograd-minimize">https://github.com/brunorigal/autograd-minimize</ext-link>.</mixed-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>DC</given-names>
          </name>
          <name>
            <surname>Nocedal</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>On the limited memory BFGS method for large scale optimization</article-title>
        <source>Math Program.</source>
        <year>1989</year>
        <volume>45</volume>
        <fpage>503</fpage>
        <lpage>28</lpage>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <mixed-citation publication-type="other">Christenson M. Non-negative matrix factorization (NMF) with support for missing values (NaN). GitHub; 2021. <ext-link ext-link-type="uri" xlink:href="https://github.com/gucky92/nmf-contrib">https://github.com/gucky92/nmf-contrib</ext-link>.</mixed-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Benjamini Y, Hochberg Y. Controlling the False Discovery Rate: A Practical and Powerful Approach to Multiple Testing. J R Stat Soc Ser B Methodol. 1995;57(1):289–300. Available from: <ext-link ext-link-type="uri" xlink:href="https://www.jstor.org/stable/2346101">https://www.jstor.org/stable/2346101</ext-link>.</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <mixed-citation publication-type="other">Freeman BA, Jaro S, Park T, Keene S, Tansey W, Reznik E. MIRTH: Metabolite Imputation via Rank Transformation and Harmonization. GitHub; 2022. <ext-link ext-link-type="uri" xlink:href="https://github.com/reznik-lab/MIRTH">https://github.com/reznik-lab/MIRTH</ext-link>.</mixed-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Freeman BA, Jaro S, Park T, Keene S, Tansey W, Reznik E. MIRTH: Metabolite Imputation via Rank Transformation and Harmonization. Zenodo; 2022. <pub-id pub-id-type="doi">10.5281/zenodo.6803241</pub-id>.</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Ruiz N, Schulter S, Chandraker M. Learning to simulate. arXiv preprint <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1810.02513">arXiv:1810.02513</ext-link>. 2018.</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <mixed-citation publication-type="other">MacKay DJ, Mac Kay DJ, et al. Information theory, inference and learning algorithms. Cambridge: Cambridge University press; 2003.</mixed-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <mixed-citation publication-type="other">Hastie T, Tibshirani R, Friedman JH, Friedman JH. The elements of statistical learning: data mining, inference, and prediction. vol. 2. New York: Springer; 2009.</mixed-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <mixed-citation publication-type="other">Singh A. Information Processing and Learning: Lecture 3. Pittsburgh: Carnegie Mellon University; 2015.</mixed-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <mixed-citation publication-type="other">Bilmes J. Submodularity In Machine Learning and Artificial Intelligence. arXiv preprint <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/2202.00132">arXiv:2202.00132</ext-link>. 2022.</mixed-citation>
    </ref>
  </ref-list>
</back>
