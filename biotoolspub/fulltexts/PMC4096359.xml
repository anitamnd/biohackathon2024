<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genetics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genetics</journal-id>
    <journal-id journal-id-type="hwp">genetics</journal-id>
    <journal-id journal-id-type="pmc">genetics</journal-id>
    <journal-id journal-id-type="publisher-id">genetics</journal-id>
    <journal-title-group>
      <journal-title>Genetics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0016-6731</issn>
    <issn pub-type="epub">1943-2631</issn>
    <publisher>
      <publisher-name>Genetics Society of America</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4096359</article-id>
    <article-id pub-id-type="pmid">24788602</article-id>
    <article-id pub-id-type="publisher-id">164285</article-id>
    <article-id pub-id-type="doi">10.1534/genetics.114.164285</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Investigations</subject>
        <subj-group>
          <subject>Note</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Improving the Power of GWAS and Avoiding Confounding from Population Stratification with PC-Select</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Tucker</surname>
          <given-names>George</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Price</surname>
          <given-names>Alkes L.</given-names>
        </name>
        <xref ref-type="aff" rid="aff2">
          <sup>†</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Berger</surname>
          <given-names>Bonnie</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">*</xref>
        <xref ref-type="corresp" rid="cor1">
          <sup>1</sup>
        </xref>
      </contrib>
      <aff id="aff1">*Department of Mathematics and Computer Science and Artificial Intelligence Laboratory, Massachusetts Institute of Technology, Cambridge, Massachusetts 02139</aff>
      <aff id="aff2">†Department of Epidemiology and Department of Biostatistics, Harvard School of Public Health, Boston, Massachusetts 02115</aff>
    </contrib-group>
    <author-notes>
      <fn>
        <p>Available freely online through the author-supported open access option.</p>
      </fn>
      <fn id="afn1">
        <p>Supporting information is available online at <ext-link ext-link-type="uri" xlink:href="http://www.genetics.org/lookup/suppl/doi:10.1534/genetics.114.164285/-/DC1">http://www.genetics.org/lookup/suppl/doi:10.1534/genetics.114.164285/-/DC1</ext-link>.</p>
      </fn>
      <corresp id="cor1"><label>1</label>Corresponding author: Department of Mathematics 2-373, Massachusetts Institute of Technology, 77 Massachusetts Ave., Cambridge, MA 02139. E-mail: <email>bab@mit.edu</email></corresp>
    </author-notes>
    <!--Fake ppub date generated by PMC from publisher pub-date/@pub-type='epub-ppub' -->
    <pub-date pub-type="ppub">
      <month>7</month>
      <year>2014</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>29</day>
      <month>4</month>
      <year>2014</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>29</day>
      <month>4</month>
      <year>2014</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>197</volume>
    <issue>3</issue>
    <fpage>1045</fpage>
    <lpage>1049</lpage>
    <history>
      <date date-type="received">
        <day>18</day>
        <month>3</month>
        <year>2014</year>
      </date>
      <date date-type="accepted">
        <day>22</day>
        <month>4</month>
        <year>2014</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright © 2014 by the Genetics Society of America</copyright-statement>
      <copyright-year>2014</copyright-year>
      <license license-type="open-access">
        <license-p>Available freely online through the author-supported open access option.</license-p>
      </license>
    </permissions>
    <self-uri xlink:title="pdf" xlink:type="simple" xlink:href="1045.pdf"/>
    <abstract>
      <p>Using a reduced subset of SNPs in a linear mixed model can improve power for genome-wide association studies, yet this can result in insufficient correction for population stratification. We propose a hybrid approach using principal components that does not inflate statistics in the presence of population stratification and improves power over standard linear mixed models.</p>
    </abstract>
    <kwd-group>
      <kwd>mixed models</kwd>
      <kwd>population stratification</kwd>
      <kwd>GWAS</kwd>
    </kwd-group>
    <counts>
      <page-count count="5"/>
    </counts>
    <custom-meta-group>
      <custom-meta>
        <meta-name> DJS Export </meta-name>
        <meta-value>v1</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <p><?release-delay 0|0?>IN recent years, there has been extensive research on linear mixed models (LMM) to calculate genome-wide association study (GWAS) statistics (<xref rid="bib4" ref-type="bibr">Kang <italic>et al.</italic> 2008</xref>, <xref rid="bib5" ref-type="bibr">2010</xref>; <xref rid="bib13" ref-type="bibr">Segura <italic>et al.</italic> 2012</xref>; <xref rid="bib15" ref-type="bibr">Svishcheva <italic>et al.</italic> 2012</xref>; <xref rid="bib20" ref-type="bibr">Zhou and Stephens 2012</xref>; <xref rid="bib17" ref-type="bibr">Yang <italic>et al.</italic> 2014</xref>). While linear mixed models implicitly assume that all SNPs have an effect on the phenotype (an infinitesimal genetic architecture), it is widely believed that disease phenotypes do not follow an infinitesimal model and that modeling a genetic architecture where most SNPs have negligible effect and some have modest effect (a noninfinitesimal genetic architecture) would increase power. As a step in that direction, <xref rid="bib7" ref-type="bibr">Listgarten <italic>et al.</italic> (2012</xref>; <xref rid="bib6" ref-type="bibr">Lippert <italic>et al.</italic> 2013</xref>) recently developed the state-of-the-art FaST-LMM Select method, which constructs a genetic relationship matrix (GRM) from a subset of top associated SNPs that are more likely to be causal. However, as a recent <italic>Perspective</italic> article (<xref rid="bib17" ref-type="bibr">Yang <italic>et al.</italic> 2014</xref>) shows, limiting the GRM to a subset of SNPs can result in insufficient correction for population stratification, leading to significantly inflated statistics and false positive associations (<xref ref-type="table" rid="t1">Table 1</xref>, <xref ref-type="table" rid="t2">Table 2</xref>, <ext-link ext-link-type="uri" xlink:href="http://www.genetics.org/lookup/suppl/doi:10.1534/genetics.114.164285/-/DC1/genetics.114.164285-1.pdf">Supporting Information</ext-link>, <ext-link ext-link-type="uri" xlink:href="http://www.genetics.org/lookup/suppl/doi:10.1534/genetics.114.164285/-/DC1/genetics.114.164285-4.pdf">Figure S2</ext-link>, <ext-link ext-link-type="uri" xlink:href="http://www.genetics.org/lookup/suppl/doi:10.1534/genetics.114.164285/-/DC1/genetics.114.164285-2.pdf">Figure S3</ext-link>, <ext-link ext-link-type="uri" xlink:href="http://www.genetics.org/lookup/suppl/doi:10.1534/genetics.114.164285/-/DC1/genetics.114.164285-6.pdf">Figure S4</ext-link>, and <ext-link ext-link-type="uri" xlink:href="http://www.genetics.org/lookup/suppl/doi:10.1534/genetics.114.164285/-/DC1/genetics.114.164285-7.pdf">File S1</ext-link>).</p>
  <table-wrap id="t1" position="float">
    <label>Table 1</label>
    <caption>
      <title>Extent of null statistic inflation as measured by <italic>λ<sub>GC</sub></italic> [median Wald statistic on test null SNPs divided by the theoretical median under the null distribution (<xref rid="bib1" ref-type="bibr">Devlin and Roeder 1999</xref>)]</title>
    </caption>
    <table frame="above" rules="groups">
      <col width="25.02%" span="1"/>
      <col width="23.15%" span="1"/>
      <col width="22.57%" span="1"/>
      <col width="14.63%" span="1"/>
      <col width="14.63%" span="1"/>
      <thead>
        <tr>
          <th valign="top" align="left" scope="col" rowspan="1" colspan="1">Mean <italic>λ<sub>GC</sub></italic> (SE)</th>
          <th valign="top" align="center" scope="col" rowspan="1" colspan="1">Pop. strat., <italic>P</italic> = 0.05</th>
          <th valign="top" align="center" scope="col" rowspan="1" colspan="1">Pop. strat., <italic>P</italic> = 0.005</th>
          <th valign="top" align="center" scope="col" rowspan="1" colspan="1"><italic>P</italic> = 0.05</th>
          <th valign="top" align="center" scope="col" rowspan="1" colspan="1"><italic>P</italic> = 0.005</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td valign="top" align="left" scope="row" rowspan="1" colspan="1">Linear regression</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">3.8 (0.4)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">4.5 (0.5)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
        </tr>
        <tr>
          <td valign="top" align="left" scope="row" rowspan="1" colspan="1">Linear regression with PCs</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.02 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.03 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.02 (0.01)</td>
        </tr>
        <tr>
          <td valign="top" align="left" scope="row" rowspan="1" colspan="1">LMM</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.02 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
        </tr>
        <tr>
          <td valign="top" align="left" scope="row" rowspan="1" colspan="1">FaST-LMM Select</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.04 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.26 (0.03)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">0.99 (0.01)</td>
        </tr>
        <tr>
          <td valign="top" align="left" scope="row" rowspan="1" colspan="1">PC-Select</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">0.99 (0.01)</td>
        </tr>
      </tbody>
    </table>
    <table-wrap-foot>
      <fn>
        <p>We tabulate <italic>λ<sub>GC</sub></italic> for linear regression, linear regression with PCs, standard LMM, FaST-LMM Select, and PC-Select on simulated genotypes and phenotypes with and without population stratification as the fraction of causal SNPs (<italic>P</italic> = 0.05, 0.005) varies. Values shown are mean <italic>λ<sub>GC</sub></italic> over 100 simulations with standard errors (SE) in parentheses. FaST-LMM Select inflates statistics in the presence of population stratification when few SNPs are causal (<italic>P</italic> = 0.005), which may result in false positives. Pop. strat., population stratification.</p>
      </fn>
    </table-wrap-foot>
  </table-wrap>
  <table-wrap id="t2" position="float">
    <label>Table 2</label>
    <caption>
      <title>Extent of null statistic inflation measured by <italic>λ<sub>GC</sub></italic></title>
    </caption>
    <table frame="above" rules="groups">
      <col width="24.72%" span="1"/>
      <col width="22.45%" span="1"/>
      <col width="23.71%" span="1"/>
      <col width="14.56%" span="1"/>
      <col width="14.56%" span="1"/>
      <thead>
        <tr>
          <th valign="top" align="left" scope="col" rowspan="1" colspan="1">Mean <italic>λ<sub>GC</sub></italic> (SE)</th>
          <th valign="top" align="center" scope="col" rowspan="1" colspan="1">Pop. strat., <italic>P</italic> = 0.05</th>
          <th valign="top" align="center" scope="col" rowspan="1" colspan="1">Pop. strat., <italic>P</italic> = 0.005</th>
          <th valign="top" align="center" scope="col" rowspan="1" colspan="1"><italic>P</italic> = 0.05</th>
          <th valign="top" align="center" scope="col" rowspan="1" colspan="1"><italic>P</italic> = 0.005</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td valign="top" align="left" scope="row" rowspan="1" colspan="1">Linear regression</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.58 (0.02)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.55 (0.02)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.03 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.04 (0.01)</td>
        </tr>
        <tr>
          <td valign="top" align="left" scope="row" rowspan="1" colspan="1">Linear regression with PCs</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.00 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.02 (0.01)</td>
        </tr>
        <tr>
          <td valign="top" align="left" scope="row" rowspan="1" colspan="1">LMM</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.02 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.00 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.02 (0.01)</td>
        </tr>
        <tr>
          <td valign="top" align="left" scope="row" rowspan="1" colspan="1">FaST-LMM Select</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.02 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.06 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.00 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.02 (0.01)</td>
        </tr>
        <tr>
          <td valign="top" align="left" scope="row" rowspan="1" colspan="1">PC-Select</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.00 (0.01)</td>
          <td valign="top" align="char" char="." rowspan="1" colspan="1">1.01 (0.01)</td>
        </tr>
      </tbody>
    </table>
    <table-wrap-foot>
      <fn>
        <p>We tabulate <italic>λ<sub>GC</sub></italic> for linear regression, linear regression with PCs, standard LMM, FaST-LMM Select, and PC-Select on real genotypes and simulated phenotypes with and without population stratification as the fraction of causal SNPs (<italic>P</italic> = 0.05, 0.005) varies. Values shown are mean <italic>λ<sub>GC</sub></italic> over 200 simulations with standard errors (SE) in parentheses. FaST-LMM Select inflates statistics in the presence of population stratification when few SNPs are causal (<italic>P</italic> = 0.005), which may result in false positives.</p>
      </fn>
    </table-wrap-foot>
  </table-wrap>
  <p>As a solution to this problem, we propose PC-Select, a novel hybrid approach that includes the principal components (PCs) of the genotype matrix as fixed effects in FaST-LMM Select. PC-Select leverages the advantages of the FaST-LMM Select framework while correcting for population stratification. The two main steps of FaST-LMM Select are ranking SNPs by linear regression <italic>P</italic>-values to form the GRM with the top-ranked SNPs and then calculating association statistics in a mixed-model framework, using this GRM. We used the top five PCs as fixed effects in both of these steps (see <italic>Materials and Methods</italic>). [We follow the recommendations in the literature (<xref rid="bib9" ref-type="bibr">Price <italic>et al.</italic> 2006</xref>) and use a fixed number of PCs. We have found that five PCs are generally sufficient to correct for stratification in simulated and real data sets. Alternatively, the number of PCs may be selected through cross-validation or Tracy–Widom statistics (<xref rid="bib8" ref-type="bibr">Patterson <italic>et al.</italic> 2006</xref>).] As a result, PC-Select yields noninflated test statistics in the presence of population stratification and maintains high power to detect causal SNPs.</p>
  <p>Specifically, to examine inflation and power, we followed the simulation procedure in <xref rid="bib17" ref-type="bibr">Yang <italic>et al.</italic> (2014)</xref> and generated data sets each containing 10,000 SNPs for 1000 individuals. To avoid a loss in power for LMM that can occur when candidate SNPs are included in the GRM (<xref rid="bib7" ref-type="bibr">Listgarten <italic>et al.</italic> 2012</xref>; <xref rid="bib17" ref-type="bibr">Yang <italic>et al.</italic> 2014</xref>), we separately simulated a set of candidate SNPs to compute test statistics. We sampled individuals from two populations with <italic>F</italic><sub>st</sub> = 0.05, ancestral minor allele frequencies uniform in [0.1, 0.5], and mean phenotypic difference 0.25 SD. To simulate causal SNPs in the GRM, we selected a fraction <italic>P</italic> = 0.05 or 0.005 of the SNPs at random and sampled Gaussian effect sizes (variance equal to 0.5 divided by the number of casual SNPs in the GRM) for these SNPs. We generated 500 candidate test null SNPs that were not causal, and to measure inflation we calculated <italic>λ<sub>GC</sub></italic>, the median Wald statistic on these SNPs divided by the theoretical median under the null distribution (<xref rid="bib1" ref-type="bibr">Devlin and Roeder 1999</xref>). To investigate power, we generated 50 causal candidate SNPs with normally distributed effect sizes (variance equal to 0.5 divided by the number of causal candidate SNPs) and measured mean Wald statistic on these SNPs. We split the variability from causal SNPs evenly between the GRM and the causal candidate SNPs. We repeated all simulations 100 times and report the mean and standard error.</p>
  <p>We found that when few SNPs were causal (<italic>P</italic> = 0.005), FaST-LMM Select inflated null statistics in the presence of population stratification (<italic>λ<sub>GC</sub></italic> = 1.26 ± 0.03), whereas PC-Select was properly calibrated (<italic>λ<sub>GC</sub></italic> = 1.01 ± 0.01) (<xref ref-type="table" rid="t1">Table 1</xref>). Moreover, FaST-LMM Select lost power in the presence of population stratification (measured by the mean Wald statistic on causal SNPs: 14.3 ± 0.2 with stratification <italic>vs.</italic> 16.4 ± 0.1 without), whereas PC-Select’s power in simulations with and without population stratification was not significantly different (16.3 ± 0.1 <italic>vs.</italic> 16.3 ± 0.1) (<xref ref-type="fig" rid="fig1__A__B">Figure 1</xref>). Thus, even though PC-Select corrected for stratification, this advantage did not come at the expense of power. This gain is likely because the PCs reduce noise in selecting subsets of SNPs for the GRM in the presence of population stratification. In addition, PC-Select chose fewer SNPs than FaST-LMM Select to include in the GRM (over 100 simulations, mean SNPs chosen: ∼20 <italic>vs.</italic> ∼240, <ext-link ext-link-type="uri" xlink:href="http://www.genetics.org/lookup/suppl/doi:10.1534/genetics.114.164285/-/DC1/genetics.114.164285-5.pdf">Figure S1</ext-link>), yielding potential computational savings. When many SNPs were causal (<italic>P</italic> = 0.05), both methods used nearly all SNPs in the GRM (over 100 simulations, mean SNPs chosen: ∼9400 and ∼8800 of 10,000, respectively), achieving similar performance to standard LMM.</p>
  <fig id="fig1__A__B" fig-type="figure" position="float">
    <label>Figure 1</label>
    <caption>
      <p>(A and B) Comparison of power for linear regression, linear regression with PCs, standard LMM, FaST-LMM Select, and PC-Select on simulated genotypes and phenotypes (A) and real genotypes and simulated phenotypes (B) with and without population stratification as the fraction of casual SNPs (<italic>P</italic> = 0.05, 0.005) varies. To measure power, we plot the mean Wald statistic on test causal SNPs. In all cases, PC-Select has the highest power of the methods that do not inflate statistics.</p>
    </caption>
    <graphic xlink:href="1045fig1"/>
  </fig>
  <p>We also investigated a recent extension of FaST-LMM Select, the <italic>genard</italic> method (<xref rid="bib2" ref-type="bibr">Hoffman 2013</xref>) that fits a data-adaptive low-rank GRM; however, we found that it did not have increased power over LMM in our simulations (<ext-link ext-link-type="uri" xlink:href="http://www.genetics.org/lookup/suppl/doi:10.1534/genetics.114.164285/-/DC1/genetics.114.164285-8.pdf">Figure S5</ext-link>), which is consistent with previous simulations in a similar context (<xref rid="bib2" ref-type="bibr">Hoffman 2013</xref>).</p>
  <p>Next, we evaluated inflation and power on real genotypes with simulated phenotypes in a similar manner. We analyzed 5000 individuals randomly subsampled from a multiple-sclerosis (MS) study genotyped on Illumina arrays (<xref rid="bib12" ref-type="bibr">Sawcer <italic>et al.</italic> 2011</xref>) made available via Wellcome Trust Case Control Consortium 2 (WTCCC2) (see <italic>Materials and Methods</italic>). As before, we separated GRM SNPs and candidate SNPs to avoid proximal contamination and provide a fair comparison of methods. We randomly sampled 50,000 SNPs for the GRM from chromosomes 3 to 22, 250 causal SNPs from chromosome 1, and 500 null SNPs from chromosome 2. To simulate environmental variance aligned with population structure, we added 0.25 times the first PC (after the PC had been normalized to variance 1) to each individual’s phenotype. Otherwise, we generated phenotypes as before and report simulations over 200 randomly generated phenotypes.</p>
  <p>We again found that when few SNPs were causal (<italic>P</italic> = 0.005), FaST-LMM Select inflated null statistics in the presence of population stratification (<italic>λ<sub>GC</sub></italic> = 1.06 ± 0.01), whereas PC-Select was properly calibrated (<italic>λ<sub>GC</sub></italic> = 1.01 ± 0.01) (<xref ref-type="table" rid="t2">Table 2</xref>). Moreover, FaST-LMM Select lost power in the presence of population stratification (measured by the mean Wald statistic on causal SNPs: 14.64 ± 0.05 with stratification <italic>vs.</italic> 16.02 ± 0.05 without); in contrast, PC-Select’s power in simulations with and without population stratification was not significantly different (16.02 ± 0.05 <italic>vs.</italic> 16.08 ± 0.05) (<xref ref-type="fig" rid="fig1__A__B">Figure 1</xref>). In all of our simulations, PC-Select produced noninflated statistics and high power.</p>
  <p>Finally, we analyzed data from 10,204 MS cases and 5429 controls genotyped on Illumina arrays (<xref rid="bib12" ref-type="bibr">Sawcer <italic>et al.</italic> 2011</xref>) made available via WTCCC2 (see <italic>Materials and Methods</italic>). The cases and controls were not matched for ancestry and thus exhibited substantial population stratification. Evaluated over all SNPs, PC-Select had <italic>λ<sub>GC</sub></italic> = 1.24 and FaST-LMM Select had <italic>λ<sub>GC</sub></italic> = 1.20. Due to polygenicity, we expect <italic>λ<sub>GC</sub></italic> on all markers to be &gt;1. On the same data, <xref rid="bib17" ref-type="bibr">Yang <italic>et al.</italic> (2014)</xref> report <italic>λ<sub>GC</sub></italic> = 1.23 and 1.20 for linear regression with PCs and LMM, respectively, which they show is consistent with polygenicity. To evaluate power, we considered Wald statistics at 75 known associated SNPs (see <italic>Materials and Methods</italic> and <ext-link ext-link-type="uri" xlink:href="http://www.genetics.org/lookup/suppl/doi:10.1534/genetics.114.164285/-/DC1/genetics.114.164285-3.xls">Table S1</ext-link> for Wald statistics). PC-Select consistently gave larger Wald statistics than FaST-LMM Select (63 of 75 markers; <italic>P</italic> = 2 × 10<sup>−9</sup>, mean Wald statistic 12.07 <italic>vs.</italic> 11.30). Based on cross-validation, both PC-Select and FaST-LMM Select chose to use all markers. This may indicate that the disease is not caused by a small number of loci with large effects or that our sample size is too small to capture this effect. Although PC-Select and FaST-LMM Select chose to use all SNPs and thus neither method inflated statistics, we emphasize that without <italic>a priori</italic> knowledge about the genetic architecture, PC-Select automatically tunes the number of SNPs to include in the GRM to optimize power and simultaneously protects against population stratification at no cost to power.</p>
  <p><xref rid="bib3" ref-type="bibr">Janss <italic>et al.</italic> (2012)</xref> caution against using PCs as fixed effects in combination with a random effect derived from the GRM when estimating heritability. This may result in an ill-posed model because the PCs enter both as fixed effects and implicitly through the random effect. We avoid this issue when estimating variance components by using the PCs as fixed effects in a restricted maximum-likelihood (REML) approach, which projects the genotype matrix into a subspace orthogonal to the PCs, effectively removing them from the random effect. We also note that population structure and PCs have previously been used successfully as fixed effects (or separate random effects) in mixed-model settings to address confounding from population structure and from unusually differentiated markers (<xref rid="bib18" ref-type="bibr">Yu <italic>et al.</italic> 2006</xref>; <xref rid="bib19" ref-type="bibr">Zhao <italic>et al.</italic> 2007</xref>; <xref rid="bib10" ref-type="bibr">Price <italic>et al.</italic> 2010</xref>, <xref rid="bib11" ref-type="bibr">2013</xref>; <xref rid="bib14" ref-type="bibr">Sul and Eskin 2013</xref>).</p>
  <p>Using PCs in a linear model does not correct for family relatedness and cryptic relatedness (<xref rid="bib10" ref-type="bibr">Price <italic>et al.</italic> 2010</xref>). As suggested by <xref rid="bib17" ref-type="bibr">Yang <italic>et al.</italic> (2014)</xref>, due to the large length of segments shared identical-by-descent, using a subset of SNPs may correct for cryptic relatedness. <xref rid="bib7" ref-type="bibr">Listgarten <italic>et al.</italic> (2012)</xref> show that using a subset of SNPs in the GRM does not inflate statistics on the WTCCC data, where inflation is likely primarily due to cryptic relatedness. We expect that PC-Select will not be inflated by cryptic relatedness for the same reasons. In most human data sets with unrelated individuals, family relatedness is not an issue; however, for data sets with strong family relatedness, we suspect there may be cases where both PC-Select and FaST-LMM Select inflate statistics.</p>
  <p>PC-Select has the same asymptotic runtime as FaST-LMM Select, quadratic in the number of individuals and linear in the number of markers. In practice, the runtime for the additional step of computing the PCs for the genotype matrix is minimal because both methods require several spectral decompositions of matrices of nearly the same size for the cross-validation step. It should be noted that while the asymptotic runtime of PC-Select and FaST-LMM Select is the same as that of previously published exact LMM methods (<xref rid="bib21" ref-type="bibr">Lippert <italic>et al.</italic> 2011</xref>; <xref rid="bib20" ref-type="bibr">Zhou and Stephens 2012</xref>), the actual runtime of both methods is ostensibly longer by a factor of 10 due to the cross-validation step. The cross-validation step is parallelizable, so in practice this is not a significant limitation.</p>
  <p>Including PCs as fixed effects allows PC-Select to infer ancestry from all SNPs simultaneously, while at the same time maintaining the benefits of using a statistically chosen subset of the SNPs to estimate the GRM (<xref rid="bib7" ref-type="bibr">Listgarten <italic>et al.</italic> 2012</xref>; <xref rid="bib6" ref-type="bibr">Lippert <italic>et al.</italic> 2013</xref>). As we have shown, using a combination of PCs and a subset of SNPs in the GRM gives the best of both worlds.</p>
  <sec sec-type="materials|methods" id="s1">
    <title>Materials and Methods</title>
    <sec id="s2">
      <title>MS data set</title>
      <p>We analyzed data from 10,204 MS cases and 5429 controls [the National Blood Service (NBS) and the 1958 Birth Cohort (1958BC)] genotyped on Illumina arrays made available to researchers via WTCCC2 (<ext-link ext-link-type="uri" xlink:href="http://wtccc.org.uk/ccc2/">http://wtccc.org.uk/ccc2/</ext-link>). We follow the quality-control standards in <xref rid="bib17" ref-type="bibr">Yang <italic>et al.</italic> (2014)</xref>. Although <xref rid="bib12" ref-type="bibr">Sawcer <italic>et al.</italic> (2011)</xref> analyzed United Kingdom (UK) and non-UK samples separately followed by meta-analysis in most of their analyses, the data made available to researchers include both UK and non-UK cases but only UK controls. We retained all samples to maximize sample size. We considered markers that were present in each of MS, NBS, and 1958BC data sets and removed markers with &gt;0.5% missing data, <italic>P</italic> &lt; 0.01 for allele-frequency difference between NBS and 1958BC, <italic>P</italic> &lt; 0.05 for deviation from Hardy–Weinberg equilibrium, <italic>P</italic> &lt; 0.05 for differential missingness between cases and controls, or minor allele frequency &lt;0.1% in any data set, leaving 360,557 markers. The 75 known associated markers were defined by including, for each MS-associated marker listed in the National Human Genome Research Institute (NHGRI) GWAS catalog (<ext-link ext-link-type="uri" xlink:href="http://genome.gov/gwastudies/">http://genome.gov/gwastudies/</ext-link>), a single best tag at <italic>r</italic><sup>2</sup> &gt; 0.4 from the set of 360,557 markers if available.</p>
    </sec>
    <sec id="s3">
      <title>Statistical methods</title>
      <p>PC-Select follows a similar framework to that of FaST-LMM Select (<xref rid="bib21" ref-type="bibr">Lippert <italic>et al.</italic> 2011</xref>, <xref rid="bib6" ref-type="bibr">2013</xref>; <xref rid="bib7" ref-type="bibr">Listgarten <italic>et al.</italic> 2012</xref>). For completeness, we list the steps and equations we used.</p>
      <p>First, we describe a method for computing association statistics, and then in subsequent sections we describe the steps of PC-Select.</p>
      <sec id="s4">
        <title>Association statistics:</title>
        <p>The phenotype <italic>y</italic>, covariates <italic>X</italic>, and genotypes <italic>W</italic> are mean centered. Additionally, each genotype is divided by <inline-formula><mml:math id="me1"><mml:mrow><mml:msqrt><mml:mrow><mml:mn>2</mml:mn><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msqrt><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> where <inline-formula><mml:math id="me2"><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> is the estimated minor allele frequency. Then the phenotype is modeled as<disp-formula id="eq"><mml:math id="me3"><mml:mrow><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:mi>X</mml:mi><mml:mi>α</mml:mi><mml:mo>+</mml:mo><mml:mi>u</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="italic">ε</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="me4"><mml:mrow><mml:mi>u</mml:mi><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>K</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi mathvariant="italic">ε</mml:mi><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula>
<italic>α</italic> is a vector of weights for the covariates, and <italic>K</italic> is the GRM. This model naturally leads to an association statistic based on the Wald statistic.</p>
        <p>To calculate the association statistic for SNP <italic>w</italic>, we add <italic>w</italic> as a fixed-effect covariate to the previous model and test whether its coefficient is significantly different from 0. Specifically, consider the model<disp-formula id="eq___1"><mml:math id="me5"><mml:mrow><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:mi>w</mml:mi><mml:mi>β</mml:mi><mml:mo>+</mml:mo><mml:mi>X</mml:mi><mml:mi>α</mml:mi><mml:mo>+</mml:mo><mml:mi>u</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="italic">ε</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <italic>β</italic> is the coefficient for the test SNP. We estimate <inline-formula><mml:math id="me6"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me7"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> by REML. The fixed-effect coefficients (<italic>β</italic>, <italic>α</italic>) are estimated by maximum likelihood.</p>
        <p>It is straightforward to construct the Wald statistic to test whether <italic>β</italic> ≠ 0. Let <inline-formula><mml:math id="me8"><mml:mrow><mml:mi>V</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>K</mml:mi><mml:mo>+</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>I</mml:mi></mml:mrow></mml:math></inline-formula> and <italic>Q</italic> = [<italic>w</italic>; <italic>X</italic>]. Then <inline-formula><mml:math id="me9"><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> is equal to the first entry of (<italic>Q<sup>T</sup>V</italic><sup>−1</sup><italic>Q</italic>)<sup>−1</sup><italic>Q<sup>T</sup>V</italic><sup>−1</sup><italic>y</italic> and <inline-formula><mml:math id="me10"><mml:mrow><mml:mi>var</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is equal to the first entry of (<italic>Q<sup>T</sup>V</italic><sup>−1</sup><italic>Q</italic>)<sup>−1</sup>. The test statistic is<disp-formula id="eq___2"><mml:math id="me11"><mml:mrow><mml:mfrac><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mi>var</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>which is asymptotically <italic>χ</italic><sup>2</sup> distributed with 1 d.f.</p>
      </sec>
      <sec id="s5">
        <title>PC-Select:</title>
        <p>Now we describe the PC-Select method:</p>
        <list list-type="simple" id="L1">
          <list-item>
            <p>Step 1: <italic>Extracting PCs:</italic> We extract the top five PCs from a GRM formed using all of the genotype data, <italic>WW<sup>T</sup></italic>, to use as fixed-effect covariates. We use <italic>X</italic> to denote the matrix of user-specified covariates and the top five PCs.</p>
          </list-item>
          <list-item>
            <p>Step 2: <italic>Ranking SNPs by linear regression:</italic> Second, we rank the SNPs by a linear regression test statistic. Linear regression test statistics are calculated by fixing <inline-formula><mml:math id="me12"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> to 0 and using the procedure described above to calculate Wald statistics.</p>
          </list-item>
          <list-item>
            <p>Step 3: <italic>Determining the GRM:</italic> As in FaST-LMM Select, PC-Select uses a subset of the SNPs that are likely to be causal. In this step, we determine <italic>k</italic>, the number of top SNPs (as ranked in Step 2) to include in the GRM. We use 10-fold cross-validation on predictive log-likelihood to choose the number of top SNPs. We choose <italic>k</italic> from a list of user-defined possibilities (<italic>e.g.</italic>, <italic>k</italic> ∈ {100, 1000, 3000, 10,000, 30,000, …}). First, we randomly divide individuals into 10 equal groups or folds. For each fold <italic>i</italic>, we form a test set from the individuals in fold <italic>i</italic> and use the rest of the individuals as a training set. For each choice of <italic>k</italic>, we consider a subset of the genotype matrix consisting only of the top <italic>k</italic> SNPs (the ranking of the SNPs is recomputed per fold, using the training data). For notational simplicity, we also refer to the reduced genotype matrix by <italic>W</italic>, and it will be clear from context if this refers to the full genotype matrix or a subset. Let <italic>W<sub>i</sub></italic> denote the genotypes from fold <italic>i</italic> and <italic>W</italic><sub>−</sub><italic><sub>i</sub></italic> represent the genotypes from the rest of the folds (similarly for <italic>y</italic> and <italic>X</italic>). We wish to evaluate the predictive log-likelihood of <italic>y<sub>i</sub></italic> given the training information (<italic>y</italic><sub>−</sub><italic><sub>i</sub></italic>, <italic>X</italic><sub>−</sub><italic><sub>i</sub></italic>, <italic>X<sub>i</sub></italic>) to assess the predictive power of using only the top <italic>k</italic> SNPs in the GRM.</p>
            <p>Specifically, to evaluate the predictive log-likelihood, we start by forming a GRM from the training set <inline-formula><mml:math id="me13"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula> Then we estimate <inline-formula><mml:math id="me14"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me15"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> from the training set by REML. We estimate <italic>α</italic> by ML with these variance parameters fixed. Then under the model<disp-formula id="eq___3"><mml:math id="me16"><mml:mrow><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:mi>X</mml:mi><mml:mi>α</mml:mi><mml:mo>+</mml:mo><mml:mi>u</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="italic">ε</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="me17"><mml:mrow><mml:mi>u</mml:mi><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>W</mml:mi><mml:msup><mml:mi>W</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me18"><mml:mrow><mml:mi mathvariant="italic">ε</mml:mi><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> the predictive distribution of the phenotypes given the training parameters, <inline-formula><mml:math id="me19"><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> is normally distributed with mean<disp-formula id="eq___4"><mml:math id="me20"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:msub><mml:mi>W</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi>α</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mi>α</mml:mi></mml:mrow></mml:math></disp-formula>and covariance<disp-formula id="eq___5"><mml:math id="me21"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msubsup><mml:mi>W</mml:mi><mml:mi>i</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>I</mml:mi><mml:mo>−</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:msub><mml:mi>W</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mi>W</mml:mi><mml:mi>i</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>g</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>This can be evaluated efficiently, using the spectral decompositions computed in the REML step (<xref rid="bib21" ref-type="bibr">Lippert <italic>et al.</italic> 2011</xref>; <xref rid="bib7" ref-type="bibr">Listgarten <italic>et al.</italic> 2012</xref>). We average the predictive log-likelihood over each of the 10 folds and choose the <italic>k</italic> that gives the highest average log-likelihood.</p>
          </list-item>
        </list>
        <list list-type="simple" id="L2">
          <list-item>
            <label>Step 4:</label>
            <p><italic>Calculating association statistics:</italic> Finally, with the number of top SNPs to use in the GRM fixed, we calculate association statistics for each SNP. Let <italic>W</italic> be the genotype matrix using the top <italic>k</italic> SNPs chosen in the previous step. To avoid proximal contamination (<xref rid="bib7" ref-type="bibr">Listgarten <italic>et al.</italic> 2012</xref>), we use a leave-one-chromosome-out procedure (<xref rid="bib17" ref-type="bibr">Yang <italic>et al.</italic> 2014</xref>). For each test SNP <italic>w</italic> (which is not necessarily in <italic>W</italic>), we exclude the chromosome including that SNP from the GRM and calculate the Wald statistic for <italic>w</italic> with this GRM. We do this efficiently by precomputing and storing the GRM, excluding each chromosome in turn.</p>
          </list-item>
        </list>
      </sec>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>Supporting Information</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="supp_197_3_1045__index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="71ae6c0ff132cb5d61c2c6bb4ba05969_genetics.114.164285-1.pdf"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="b84a8b5cd33c20ca80812b9ef8955acf_genetics.114.164285-7.pdf"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="791b0b9523c37bfd5bd8c7db5b1e09f1_genetics.114.164285-5.pdf"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="e8ba5724d1c06bc37e3e6ff988682631_genetics.114.164285-4.pdf"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="f063eeff50ffa97c21704504378d4e38_genetics.114.164285-2.pdf"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="4d0767e43a5c9e7acf85eb76818e0f46_genetics.114.164285-6.pdf"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="511207816078023340813b2c5bc297c0_genetics.114.164285-8.pdf"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="vnd.ms-excel" xlink:href="5962950798ee91afd33489b48c873bfe_genetics.114.164285-3.xls"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>We thank Po-Ru Loh, Sean Simmons, and Jian Peng for helpful discussions. This study makes use of data generated by the Wellcome Trust Case Control Consortium. This research was funded by National Institutes of Health grants R01 GM108348 and R01 HG006399.</p>
  </ack>
  <fn-group>
    <fn id="fn1">
      <p>
        <italic>Communicating editor: I. Hoeschele</italic>
      </p>
    </fn>
  </fn-group>
  <ref-list>
    <title>Literature Cited</title>
    <ref id="bib1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Devlin</surname><given-names>B.</given-names></name><name><surname>Roeder</surname><given-names>K.</given-names></name></person-group>, <year>1999</year> <article-title>Genomic control for association studies.</article-title><source>Biometrics</source><volume>55</volume>(<issue>4</issue>): <fpage>997</fpage>–<lpage>1004</lpage>.<pub-id pub-id-type="pmid">11315092</pub-id></mixed-citation>
    </ref>
    <ref id="bib2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hoffman</surname><given-names>G. E.</given-names></name></person-group>, <year>2013</year> <article-title>Correcting for population structure and kinship using the linear mixed model: theory and extensions.</article-title><source>PLoS ONE</source><volume>8</volume>(<issue>10</issue>): <fpage>e75707</fpage>.<pub-id pub-id-type="pmid">24204578</pub-id></mixed-citation>
    </ref>
    <ref id="bib3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Janss</surname><given-names>L.</given-names></name><name><surname>de los Campos</surname><given-names>G.</given-names></name><name><surname>Sheehan</surname><given-names>N.</given-names></name><name><surname>Sorensen</surname><given-names>D.</given-names></name></person-group>, <year>2012</year> <article-title>Inferences from genomic models in stratified populations.</article-title><source>Genetics</source><volume>192</volume>: <fpage>693</fpage>–<lpage>704</lpage>.<pub-id pub-id-type="pmid">22813891</pub-id></mixed-citation>
    </ref>
    <ref id="bib4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kang</surname><given-names>H. M.</given-names></name><name><surname>Zaitlen</surname><given-names>N. A.</given-names></name><name><surname>Wade</surname><given-names>C. M.</given-names></name><name><surname>Kirby</surname><given-names>A.</given-names></name><name><surname>Heckerman</surname><given-names>D.</given-names></name><etal/></person-group>, <year>2008</year> <article-title>Efficient control of population structure in model organism association mapping.</article-title><source>Genetics</source><volume>178</volume>: <fpage>1709</fpage>–<lpage>1723</lpage>.<pub-id pub-id-type="pmid">18385116</pub-id></mixed-citation>
    </ref>
    <ref id="bib5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kang</surname><given-names>H. M.</given-names></name><name><surname>Sul</surname><given-names>J. H.</given-names></name><name><surname>Zaitlen</surname><given-names>N. A.</given-names></name><name><surname>Kong</surname><given-names>S.-y.</given-names></name><name><surname>Freimer</surname><given-names>N. B.</given-names></name><etal/></person-group>, <year>2010</year> <article-title>Variance component model to account for sample structure in genome-wide association studies.</article-title><source>Nat. Genet.</source><volume>42</volume>(<issue>4</issue>): <fpage>348</fpage>–<lpage>354</lpage>.<pub-id pub-id-type="pmid">20208533</pub-id></mixed-citation>
    </ref>
    <ref id="bib21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lippert</surname><given-names>C.</given-names></name><name><surname>Listgarten</surname><given-names>J.</given-names></name><name><surname>Liu</surname><given-names>Y.</given-names></name><name><surname>Kadie</surname><given-names>C. M.</given-names></name><name><surname>Davidson</surname><given-names>R. I.</given-names></name><etal/></person-group>, <year>2011</year> <article-title>FaST linear mixed models for genome-wide association studies.</article-title><source>Nat. Methods</source><volume>8</volume>(<issue>10</issue>): <fpage>833</fpage>–<lpage>835</lpage>.<pub-id pub-id-type="pmid">21892150</pub-id></mixed-citation>
    </ref>
    <ref id="bib6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lippert</surname><given-names>C.</given-names></name><name><surname>Quon</surname><given-names>G.</given-names></name><name><surname>Kang</surname><given-names>E. Y.</given-names></name><name><surname>Kadie</surname><given-names>C. M.</given-names></name><name><surname>Listgarte</surname><given-names>J.</given-names></name><etal/></person-group>, <year>2013</year> The benefits of selecting phenotype-specific variants for applications of mixed models in genomics. <source>Sci. Rep.</source> 3: 1815.</mixed-citation>
    </ref>
    <ref id="bib7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Listgarten</surname><given-names>J.</given-names></name><name><surname>Lippert</surname><given-names>C.</given-names></name><name><surname>Kadie</surname><given-names>C. M.</given-names></name><name><surname>Davidson</surname><given-names>R. I.</given-names></name><name><surname>Eskin</surname><given-names>E.</given-names></name><etal/></person-group>, <year>2012</year> <article-title>Improved linear mixed models for genome-wide association studies.</article-title><source>Nat. Methods</source><volume>9</volume>(<issue>6</issue>): <fpage>525</fpage>–<lpage>526</lpage>.<pub-id pub-id-type="pmid">22669648</pub-id></mixed-citation>
    </ref>
    <ref id="bib8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Patterson</surname><given-names>N.</given-names></name><name><surname>Price</surname><given-names>A. L.</given-names></name><name><surname>Reich</surname><given-names>D.</given-names></name></person-group>, <year>2006</year> <article-title>Population structure and eigenanalysis.</article-title><source>PLoS Genet.</source><volume>2</volume>(<issue>12</issue>): <fpage>e190</fpage>.<pub-id pub-id-type="pmid">17194218</pub-id></mixed-citation>
    </ref>
    <ref id="bib9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Price</surname><given-names>A. L.</given-names></name><name><surname>Patterson</surname><given-names>N. J.</given-names></name><name><surname>Plenge</surname><given-names>R. M.</given-names></name><name><surname>Weinblatt</surname><given-names>M. E.</given-names></name><name><surname>Shadick</surname><given-names>N. A.</given-names></name><etal/></person-group>, <year>2006</year> <article-title>Principal components analysis corrects for stratification in genome-wide association studies.</article-title><source>Nat. Genet.</source><volume>38</volume>(<issue>8</issue>): <fpage>904</fpage>–<lpage>909</lpage>.<pub-id pub-id-type="pmid">16862161</pub-id></mixed-citation>
    </ref>
    <ref id="bib10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Price</surname><given-names>A. L.</given-names></name><name><surname>Zaitlen</surname><given-names>N. A.</given-names></name><name><surname>Reich</surname><given-names>D.</given-names></name><name><surname>Patterson</surname><given-names>N.</given-names></name></person-group>, <year>2010</year> <article-title>New approaches to population stratification in genome-wide association studies.</article-title><source>Nat. Rev. Genet.</source><volume>11</volume>(<issue>7</issue>): <fpage>459</fpage>–<lpage>463</lpage>.<pub-id pub-id-type="pmid">20548291</pub-id></mixed-citation>
    </ref>
    <ref id="bib11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Price</surname><given-names>A. L.</given-names></name><name><surname>Zaitlen</surname><given-names>N. A.</given-names></name><name><surname>Reich</surname><given-names>D.</given-names></name><name><surname>Patterson</surname><given-names>N.</given-names></name></person-group>, <year>2013</year> <article-title>Response to Sul and Eskin.</article-title><source>Nat. Rev. Genet.</source><volume>14</volume>(<issue>4</issue>): <fpage>300</fpage>.<pub-id pub-id-type="pmid">23438870</pub-id></mixed-citation>
    </ref>
    <ref id="bib12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sawcer</surname><given-names>S.</given-names></name><name><surname>Hellenthal</surname><given-names>G.</given-names></name><name><surname>Pirinen</surname><given-names>M.</given-names></name><name><surname>Spencer</surname><given-names>C.</given-names></name><name><surname>Patsopoulos</surname><given-names>N.</given-names></name><etal/></person-group>, <year>2011</year> <article-title>Genetic risk and a primary role for cell-mediated immune mechanisms in multiple sclerosis.</article-title><source>Nature</source><volume>476</volume>(<issue>7359</issue>): <fpage>214</fpage>–<lpage>219</lpage>.<pub-id pub-id-type="pmid">21833088</pub-id></mixed-citation>
    </ref>
    <ref id="bib13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Segura</surname><given-names>V.</given-names></name><name><surname>Vilhjálmsson</surname><given-names>B. J.</given-names></name><name><surname>Platt</surname><given-names>A.</given-names></name><name><surname>Korte</surname><given-names>A.</given-names></name><name><surname>Seren</surname><given-names>Ü.</given-names></name><etal/></person-group>, <year>2012</year> <article-title>An efficient multi-locus mixed-model approach for genome-wide association studies in structured populations.</article-title><source>Nat. Genet.</source><volume>44</volume>(<issue>7</issue>): <fpage>825</fpage>–<lpage>830</lpage>.<pub-id pub-id-type="pmid">22706313</pub-id></mixed-citation>
    </ref>
    <ref id="bib14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sul</surname><given-names>J. H.</given-names></name><name><surname>Eskin</surname><given-names>E.</given-names></name></person-group>, <year>2013</year> <article-title>Mixed models can correct for population structure for genomic regions under selection.</article-title><source>Nat. Rev. Genet.</source><volume>14</volume>(<issue>4</issue>): <fpage>300</fpage>.<pub-id pub-id-type="pmid">23438871</pub-id></mixed-citation>
    </ref>
    <ref id="bib15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Svishcheva</surname><given-names>G. R.</given-names></name><name><surname>Axenovich</surname><given-names>T. I.</given-names></name><name><surname>Belonogova</surname><given-names>N. M.</given-names></name><name><surname>van Duijn</surname><given-names>C. M.</given-names></name><name><surname>Aulchenko</surname><given-names>Y. S.</given-names></name></person-group>, <year>2012</year> <article-title>Rapid variance components-based method for whole-genome association analysis.</article-title><source>Nat. Genet.</source> 44: 1166–1170.</mixed-citation>
    </ref>
    <ref id="bib17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yang</surname><given-names>J.</given-names></name><name><surname>Zaitlen</surname><given-names>N. A.</given-names></name><name><surname>Goddard</surname><given-names>M. E.</given-names></name><name><surname>Visscher</surname><given-names>P. M.</given-names></name><name><surname>Price</surname><given-names>A. L.</given-names></name></person-group>, <year>2014</year> <article-title>Advantages and pitfalls in the application of mixed-model association methods.</article-title><source>Nat. Genet.</source><volume>46</volume>(<issue>2</issue>): <fpage>100</fpage>–<lpage>106</lpage>.<pub-id pub-id-type="pmid">24473328</pub-id></mixed-citation>
    </ref>
    <ref id="bib18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yu</surname><given-names>J.</given-names></name><name><surname>Pressoir</surname><given-names>G.</given-names></name><name><surname>Briggs</surname><given-names>W. H.</given-names></name><name><surname>Bi</surname><given-names>I. V.</given-names></name><name><surname>Yamasaki</surname><given-names>M.</given-names></name><etal/></person-group>, <year>2006</year> <article-title>A unified mixed-model method for association mapping that accounts for multiple levels of relatedness.</article-title><source>Nat. Genet.</source><volume>38</volume>(<issue>2</issue>): <fpage>203</fpage>–<lpage>208</lpage>.<pub-id pub-id-type="pmid">16380716</pub-id></mixed-citation>
    </ref>
    <ref id="bib19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhao</surname><given-names>K.</given-names></name><name><surname>Aranzana</surname><given-names>M. J.</given-names></name><name><surname>Kim</surname><given-names>S.</given-names></name><name><surname>Lister</surname><given-names>C.</given-names></name><name><surname>Shindo</surname><given-names>C.</given-names></name><etal/></person-group>, <year>2007</year> <article-title>An Arabidopsis example of association mapping in structured samples.</article-title><source>PLoS Genet.</source><volume>3</volume>(<issue>1</issue>): <fpage>e4</fpage>.<pub-id pub-id-type="pmid">17238287</pub-id></mixed-citation>
    </ref>
    <ref id="bib20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname><given-names>X.</given-names></name><name><surname>Stephens</surname><given-names>M.</given-names></name></person-group>, <year>2012</year> <article-title>Genome-wide efficient mixed-model analysis for association studies.</article-title><source>Nat. Genet.</source><volume>44</volume>(<issue>7</issue>): <fpage>821</fpage>–<lpage>824</lpage>.<pub-id pub-id-type="pmid">22706312</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
