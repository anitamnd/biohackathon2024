<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Biol</journal-id>
    <journal-title-group>
      <journal-title>Genome Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1474-7596</issn>
    <issn pub-type="epub">1474-760X</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8311964</article-id>
    <article-id pub-id-type="publisher-id">2419</article-id>
    <article-id pub-id-type="doi">10.1186/s13059-021-02419-7</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>STRONG: metagenomics strain resolution on assembly graphs</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1884-8440</contrib-id>
        <name>
          <surname>Quince</surname>
          <given-names>Christopher</given-names>
        </name>
        <address>
          <email>christopher.quince@earlham.ac.uk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Nurk</surname>
          <given-names>Sergey</given-names>
        </name>
        <address>
          <email>sergey.nurk@nih.gov</email>
        </address>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Raguideau</surname>
          <given-names>Sebastien</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>James</surname>
          <given-names>Robert</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Soyer</surname>
          <given-names>Orkun S.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Summers</surname>
          <given-names>J. Kimberly</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Limasset</surname>
          <given-names>Antoine</given-names>
        </name>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Eren</surname>
          <given-names>A. Murat</given-names>
        </name>
        <xref ref-type="aff" rid="Aff7">7</xref>
        <xref ref-type="aff" rid="Aff8">8</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Chikhi</surname>
          <given-names>Rayan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff9">9</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Darling</surname>
          <given-names>Aaron E.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff10">10</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.421605.4</institution-id><institution-id institution-id-type="ISNI">0000 0004 0447 4123</institution-id><institution>Organisms and Ecosystems, Earlham Institute, </institution></institution-wrap>Norwich, NR4 7UZ UK </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.40368.39</institution-id><institution-id institution-id-type="ISNI">0000 0000 9347 0159</institution-id><institution>Gut Microbes and Health, Quadram Institute, </institution></institution-wrap>Norwich, NR4 7UQ UK </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.7372.1</institution-id><institution-id institution-id-type="ISNI">0000 0000 8809 1613</institution-id><institution>Warwick Medical School, University of Warwick, </institution></institution-wrap>Coventry, CV4 7AL UK </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.280128.1</institution-id><institution-id institution-id-type="ISNI">0000 0001 2233 9230</institution-id><institution>Genome Informatics Section, Computational and Statistical Genomics Branch, National Human Genome Research Institute, National Institutes of Health, </institution></institution-wrap>Bethesda, 20892 MD USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="GRID">grid.7372.1</institution-id><institution-id institution-id-type="ISNI">0000 0000 8809 1613</institution-id><institution>School of Life Sciences, University of Warwick, </institution></institution-wrap>Coventry, CV4 7AL UK </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="GRID">grid.503422.2</institution-id><institution-id institution-id-type="ISNI">0000 0001 2242 6780</institution-id><institution>Univ. Lille, CNRS, Inria, UMR 9189 - CRIStAL, </institution></institution-wrap>Lille, France </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="GRID">grid.170205.1</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 7822</institution-id><institution>Department of Medicine, </institution><institution>University of Chicago, </institution></institution-wrap>Chicago, Illinois USA </aff>
      <aff id="Aff8"><label>8</label><institution-wrap><institution-id institution-id-type="GRID">grid.144532.5</institution-id><institution-id institution-id-type="ISNI">000000012169920X</institution-id><institution>Josephine Bay Paul Center, Marine Biological Laboratory, </institution></institution-wrap>Woods Hole, Massachusetts USA </aff>
      <aff id="Aff9"><label>9</label><institution-wrap><institution-id institution-id-type="GRID">grid.428999.7</institution-id><institution-id institution-id-type="ISNI">0000 0001 2353 6535</institution-id><institution>Department of Computational Biology, </institution><institution>Institut Pasteur, C3BI USR 3756 IP CNRS, </institution></institution-wrap>Paris, France </aff>
      <aff id="Aff10"><label>10</label><institution-wrap><institution-id institution-id-type="GRID">grid.117476.2</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 7611</institution-id><institution>The iThree institute, University of Technology Sydney, </institution></institution-wrap>15 Broadway, Ultimo, 2007 NSW Australia </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>26</day>
      <month>7</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>26</day>
      <month>7</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2021</year>
    </pub-date>
    <volume>22</volume>
    <elocation-id>214</elocation-id>
    <history>
      <date date-type="received">
        <day>22</day>
        <month>8</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>29</day>
        <month>6</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2021</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">We introduce STrain Resolution ON assembly Graphs (STRONG), which identifies strains de novo, from multiple metagenome samples. STRONG performs coassembly, and binning into metagenome assembled genomes (MAGs), and stores the coassembly graph prior to variant simplification. This enables the subgraphs and their unitig per-sample coverages, for individual single-copy core genes (SCGs) in each MAG, to be extracted. A Bayesian algorithm, BayesPaths, determines the number of strains present, their haplotypes or sequences on the SCGs, and abundances. STRONG is validated using synthetic communities and for a real anaerobic digestor time series generates haplotypes that match those observed from long Nanopore reads.</p>
      <sec>
        <title>Supplementary Information</title>
        <p>The online version contains supplementary material available at (10.1186/s13059-021-02419-7).</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Microbiome</kwd>
      <kwd>Metagenome</kwd>
      <kwd>Strains</kwd>
      <kwd>Bayesian</kwd>
      <kwd>Microbial community</kwd>
      <kwd>Assembly graph</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000265</institution-id>
            <institution>Medical Research Council</institution>
          </institution-wrap>
        </funding-source>
        <award-id>MR/S037195/1</award-id>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000265</institution-id>
            <institution>Medical Research Council</institution>
          </institution-wrap>
        </funding-source>
        <award-id>MR/M50161X/1</award-id>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000265</institution-id>
            <institution>Medical Research Council</institution>
          </institution-wrap>
        </funding-source>
        <award-id>MR/L015080/1</award-id>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000268</institution-id>
            <institution>Biotechnology and Biological Sciences Research Council</institution>
          </institution-wrap>
        </funding-source>
        <award-id>BB/R015171/1</award-id>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000268</institution-id>
            <institution>Biotechnology and Biological Sciences Research Council</institution>
          </institution-wrap>
        </funding-source>
        <award-id>BB/N023285/1</award-id>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000268</institution-id>
            <institution>Biotechnology and Biological Sciences Research Council</institution>
          </institution-wrap>
        </funding-source>
        <award-id>BB/L502029/1</award-id>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2021</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p>There is a growing realisation that to fully understand microbial communities it is necessary to resolve them to the level of individual strains [<xref ref-type="bibr" rid="CR42">42</xref>]. The strain is for many species the fundamental unit of microbiological diversity. This is because two strains of the same species can have very different functional roles. The classic example is <italic>E. coli</italic>, where one strain can be a dangerous pathogen and another a harmless commensal [<xref ref-type="bibr" rid="CR28">28</xref>]. The best definition of a strain, and the only one that avoids ambiguity, is a set of clonal descendants of a single cell [<xref ref-type="bibr" rid="CR14">14</xref>, <xref ref-type="bibr" rid="CR46">46</xref>], but strain genomes by this definition can only reliably be determined by sequencing cultured isolates or single cells [<xref ref-type="bibr" rid="CR37">37</xref>]. The former is not representative of the community and the latter is still too expensive and low-throughput for many applications as well as producing only fragmentary genomes. For these reasons, there is a practical need for efficient methods that can profile microbial communities at high genomic resolution.</p>
    <p>In contrast to 16S rRNA gene sequencing, shotgun metagenomics has the potential to resolve microbial communities to the strain level. This is because it generates reads from throughout the genomes of all the community members. It also has the additional advantages of reduced levels of bias and the capability to reconstruct genomes. There are many methods for reference-based strain resolution from metagenome data [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR42">42</xref>, <xref ref-type="bibr" rid="CR49">49</xref>], but they are, and will continue to be, limited by the challenge of comprehensively isolating and sequencing the genomes of diverse microbial strains. Comprehensive reference genome databases may be possible for a few slowly evolving species or particularly well studied pathogens but for the entirety of a complex community it is unlikely to ever be tractable. For example, in a recent de novo large-scale binning study of the relatively well-studied human gut microbiome, it was found that 77% of the species recovered did not have a reference genome in public databases [<xref ref-type="bibr" rid="CR38">38</xref>]. This suggests that even less of the strain-level diversity in those samples would be represented in a genome database. These observations motivate the need for de novo methods of metagenomic strain resolution.</p>
    <p>In the metagenomics context, we adopt the definition of a ‘metagenome strain’ as a clonal subpopulation with sufficiently low levels of recombination with other strains, that it can be distinguished genetically from them. This does not require that recombination between strains does not occur, rather that either because of physical separation or selection, it has not been sufficiently strong relative to the rate of mutation [<xref ref-type="bibr" rid="CR47">47</xref>], to generate a continuum of diversity throughout the genome. This means members of a ‘metagenome strain’ may differ substantially from each other particularly in rapidly evolving accessory regions and the subpopulation as a whole may descend from multiple cells but with a core genome that has descended from a single cell in the recent past. This is equivalent to the definition of ‘lineage’ in [<xref ref-type="bibr" rid="CR35">35</xref>]. For ease, in the discussion below we will refer to strain in the metagenome context when properly we mean this looser definition of a strain as a genetically distinct subpopulation.</p>
    <p>De novo assembly of genomes from short read metagenome sequences remains very challenging. Assemblies become fragmented for two reasons: firstly, low coverage genomes will fragment through chance occurrences where sequence coverage drops out, following Lander and Waterman statistics [<xref ref-type="bibr" rid="CR18">18</xref>], secondly, if either intra or inter-genomic repeats are present then the assembly graphs used to represent possible sequence overlaps become very complex, and it is unclear which paths correspond to true genomes. Both of these issues are particularly problematic for metagenomes, where there can be a wide range of species abundances, and in a complex community a significant fraction of the species may be at low coverage. The first challenge can be addressed by sequencing more deeply. More difficult to address is the problem of repeats. Just as they do in isolate genome sequencing, intra-genomic repeats such as the 16S rRNA operon will lead to uncertainty in metagenomic assemblies, but if multiple closely related strains from the same species are present then they will possess potentially large regions of shared sequence. If the strain genomes are of comparable divergence to the reciprocal of the read length then very complex graphs will result, for typical short read sequencing (75-150bp) this would be strains at around 98–99.5% sequence identity. The result is that it is not possible to find long paths in the graph that can be unambiguously assembled into long contiguous sequence or contigs. For this reason metagenome assemblies for strain-diverse communities can comprise millions of contigs when made from short read data, with the added drawback that in the metagenomics context we do not even know which contig derives from which species. For species that contain multiple very similar strains (&gt;99.9%), then we expect better assemblies but the variants are then too far apart to be linked or phased by Illumina reads. In that case we may resolve the large-scale genome structure but not the sequences of the individual strains, which we will refer to as their haplotypes.</p>
    <p>Metagenomic contig binning methods attempt to mitigate the problem introduced by standard metagenome sample processing approaches, wherein the origin of each sequence read is unknown. Contig binning works because contigs deriving from the same or similar genomes will share features that can be learnt without prior knowledge. These features can be sequence composition, but it is also possible to use per-sample coverage depths of contigs as a more powerful feature, if multiple samples are available from the same (or very similar) communities [<xref ref-type="bibr" rid="CR2">2</xref>]. There are now numerous algorithms capable of using both coverage across samples and composition to automatically cluster contigs and determine from single-copy core gene (SCG) frequencies where the resulting bins are good quality metagenome assembled genomes (MAGs) [<xref ref-type="bibr" rid="CR3">3</xref>, <xref ref-type="bibr" rid="CR24">24</xref>]. These tools enable genome bins to be extracted de novo from metagenomes, and are becoming crucial for studying unculturable organisms, contributing to many exciting discoveries, such as the description of the Candidate Phyla Radiation [<xref ref-type="bibr" rid="CR9">9</xref>] or an improved understanding of the diversity of nitrogen fixers in the open ocean [<xref ref-type="bibr" rid="CR13">13</xref>].</p>
    <p>The resolution of genome binning though, is limited by the resolution of the assembler, with a typical maximum kmer length of around 100, the best case is that we can resolve to about 1% sequence divergence, so that bins correspond to something between a species and a strain. In the presence of strain diversity, those contigs that are shared across strains will become a consensus of the strains present, in the ideal situation their sequence would be that of the most abundant strain, but even this is not guaranteed. Contigs that are part of the accessory genome and present in a subset of strains may be successfully binned with the core genome, but they may not if they are too short or divergent in coverage. Consequently, if multiple strains are present in the assembly the MAGs that result from binning will be an imperfect composite of multiple strains.</p>
    <p>Strains in a metagenome can exhibit variation in shared genes, such as insertions/deletions and single-nucleotide variants or SNVs, as well as in their accessory gene complements. Methods for finding haplotypes on shared genes mostly fall into one of two types, either they operate on single samples independently [<xref ref-type="bibr" rid="CR31">31</xref>], or they assume that only a single strain is present in each sample and then examine the sharing of those haplotypes across samples [<xref ref-type="bibr" rid="CR36">36</xref>, <xref ref-type="bibr" rid="CR45">45</xref>]. The former will be limited by the challenge of resolving haplotypes purely from overlaps at least for short reads, the latter will break down if significant strain diversity exists within a sample. Recently, we introduced DESMAN [<xref ref-type="bibr" rid="CR39">39</xref>] to resolve subpopulations in MAGs using variant frequencies on contigs when multiple samples from a community are available. This is similar to contig binning using coverage but it can be viewed as a relaxed form of clustering closer to non-negative matrix factorisation, because each variant can appear in more than one subpopulation haplotype. Similar strategies had been proposed prior to DESMAN but using variant frequencies on reference genomes e.g. Lineages [<xref ref-type="bibr" rid="CR35">35</xref>] and Constrains [<xref ref-type="bibr" rid="CR32">32</xref>]. DESMAN and other earlier methods are all ‘linear mapping-based methods’ where metagenomic reads are mapped onto a linear sequence, either a reference or consensus contig and the variant positions identified. This has multiple drawbacks: firstly, the type of variant that can be represented is limited to changes at a single base; secondly, mapping onto a linear sequence can be challenging when there is variation present yielding unreliable results [<xref ref-type="bibr" rid="CR21">21</xref>]; thirdly, it treats every variant as independent ignoring the co-occurrence of variants in reads, which is a powerful extra source of information when strain divergence is greater than the inverse of read length, when we would expect most reads to contain more than one variant. The last issue can be addressed by keeping track of which variants appear in which reads but that requires extra bookkeeping [<xref ref-type="bibr" rid="CR20">20</xref>].</p>
    <p>To address these limitations, we introduce a new method, STRONG (Strain Resolution ON Graphs), for analysing metagenome series when multiple samples are available either from the same microbial community e.g. longitudinal time-series or cross-sectional studies where the communities are similar enough to share a significant fraction of strains. STRONG can determine the number of ‘metagenome strains’ in a MAG formed from binning of a coassembly of all the samples, together with their sequences across multiple single-copy core genes, which we refer to as <italic>strain haplotypes</italic>, and the coverages of each strain in each sample. STRONG avoids the limitations of the variant-based approaches by resolving haplotypes directly on assembly graphs using a novel variational Bayesian algorithm, BayesPaths.</p>
    <p>This graph-based approach allows more complex variant structure and incorporates read information. The usefulness of graphs for understanding microbial strains has been noted before, and efficient algorithms developed for querying complex graphs and extracting more complete representatives of MAGs in the presence of strain diversity [<xref ref-type="bibr" rid="CR10">10</xref>]. STRONG, however, is the first time that graphs have been used in an automated workflow to actually decompose that strain diversity into haplotypes across multiple genes using multiple samples. We compare STRONG to both the current state of the art, DESMAN, and a recent single-sample method mixtureS [<xref ref-type="bibr" rid="CR31">31</xref>] on synthetic microbial communities and a real metagenome time series from an anaerobic digester. In the former case we validate using the known genome sequences, and for the latter we compare abundant MAGs with haplotypes derived independently from Oxford Nanopore MinION long reads.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>STRONG pipeline</title>
      <p>The detailed pipeline is described in the Methods but the key steps are summarised in Fig. <xref rid="Fig1" ref-type="fig">1</xref> and reiterated here. We start from multiple samples of the same community and jointly coassemble them with metaSPAdes, we save a high resolution graph (HRG) early in the assembly process that preserves all the variant information in the coassembly. The metaSPAdes assembly process then proceeds as normal and the resulting contigs are binned either with CONCOCT, used for all the results generated here, or alternatively Metabat2 [<xref ref-type="bibr" rid="CR25">25</xref>]. We annotate the single-copy core genes in the contigs, allowing us to identify a subset of bins as MAGs. A novel algorithm was then developed to map these SCG ORFs onto the HRG and extract the complete assembly subgraphs corresponding to the genes of interest (“<xref rid="Sec10" ref-type="sec">Methods</xref> - <xref rid="Sec18" ref-type="sec">Relevant subgraph extraction</xref>” section). We obtained per sample unitig coverages on these subgraphs by threading reads directly onto them. These subgraphs were simplified with a noise filtering algorithm that used the MAG coverage depths, calculated as the length weighted average of the contigs assigned to that MAG. The simplified subgraphs contain all the information required for the BayesPaths algorithm (“<xref rid="Sec10" ref-type="sec">Methods</xref> - <xref rid="Sec20" ref-type="sec">BayesPaths</xref>” section), that simultaneously solves for the number of strains present, their coverage in each sample, and their sequences on the SCGs. SCGs from the same MAG are linked through the binning process and jointly solved in the strain resolution procedure to generate linked strain resolved sequences for each SCG. We will refer below to the SCG sequences for a given strain as its haplotype. The pipeline also applies DESMAN [<xref ref-type="bibr" rid="CR39">39</xref>], to the same MAGs for comparative purposes, and will perform benchmarking if known genomes are available. It is important to note that some SCGs will be filtered during the BayesPaths procedure, see “<xref rid="Sec10" ref-type="sec">Methods</xref>” section, so that sequence inference is only performed on a subset in the final output.
<fig id="Fig1"><label>Fig. 1</label><caption><p>STRONG pipeline. This figure illustrates the principal steps in the STRONG pipeline (see “<xref rid="Sec10" ref-type="sec">Methods</xref> - <xref rid="Sec3" ref-type="sec">STRONG pipeline</xref>” section). Step 1) Co-assembly with metaSPAdes and storage of a high-resolution graph (HRG). Step 2) Contig binning with CONCOCT or Metabat2 and annotation of single-copy core genes (SCGs). Step 3) Mapping of SCGs onto the HRG and extraction of individual SCG assembly graphs together with per-sample unitig coverages. Step 4) Joint solution of SCG assembly graphs from each MAG with BayesPaths to determine strain number, haplotypes and per-sample coverages</p></caption><graphic xlink:href="13059_2021_2419_Fig1_HTML" id="MO1"/></fig></p>
      <p>The primary output of the STRONG pipeline comprises a collections of MAGs complete with strain number estimates, strain coverages across samples, and strain haplotype sequences on the filtered subset of SCGs. It does not perform assignment of accessory genes to strains. It will additionally perform taxonomic assignment of MAGs using GTDB [<xref ref-type="bibr" rid="CR11">11</xref>] and generate phylogenetic trees for strains within MAGs and if evaluation genomes are available generate metrics of strain quality.</p>
    </sec>
    <sec id="Sec4">
      <title>Synthetic data sets</title>
      <p>In order to provide an example metagenome data set with a known strain configuration for each species, we created a synthetic community comprised of 100 strains, with known genomes deriving from 45 species, with 20 species represented by a single strain, 10 with two strains, 5 with three, 5 with four and 5 species with five strains. We then generated four data sets from this community with the same total number of reads (150 million 2X150 bp) but increasing sample numbers (3, 5, 10 and 15 samples). This configuration, where most species have a single strain, might be an appropriate approximation to the human gut microbiome [<xref ref-type="bibr" rid="CR45">45</xref>]. We denote these data sets Synth_S03, Synth_S05, Synth_S10 and Synth_S15. For each sample number, random species abundances were generated from a log-normal distribution, with strain proportions from a Dirichlet with unit variance. Full details of the synthetic sequence generation are given in the Methods.</p>
      <p>The STRONG pipeline was applied to each of these data sets in turn generating MAGs for which strains were then resolved. In Fig. <xref rid="Fig2" ref-type="fig">2</xref> we illustrate the STRONG output for a single gene, COG0532 ‘Translation initiation factor IF-2’ [<xref ref-type="bibr" rid="CR44">44</xref>], from one MAG, Bin_55 of the ten sample synthetic data set, giving the resulting decomposition of the assembly subgraph into three strains. Noting that the strains were resolved in this MAG over 22 single-copy core genes simultaneously, and that for this 3.4 kbp gene the haplotypes were found without errors.
<fig id="Fig2"><label>Fig. 2</label><caption><p>BayesPaths algorithm. This illustrates the BayesPaths algorithm for a single COG0532 from one MAG, Bin_55 of the ten sample synthetic data set. The algorithm predicted 3 strains. We show the input to the algorithm: <bold>A</bold> the unitig coverages across samples plus <bold>B</bold> the unitig graph without strain assignments. The outputs of the algorithm are shown in <bold>C</bold> the assignments of haplotypes to each unitig, <bold>D</bold> the strain intensities across samples, effectively coverage divided by read length (see “<xref rid="Sec10" ref-type="sec">Methods</xref> - <xref rid="Sec20" ref-type="sec">BayesPaths</xref>” section), and <bold>E</bold> unitig graphs for each haplotype with their most likely paths. This algorithm is explained in detail in the “<xref rid="Sec10" ref-type="sec">Methods</xref> - <xref rid="Sec20" ref-type="sec">BayesPaths</xref>” section</p></caption><graphic xlink:href="13059_2021_2419_Fig2_HTML" id="MO2"/></fig></p>
      <p>To provide a comparison to STRONG we ran two other algorithms, the single sample algorithm mixtureS [<xref ref-type="bibr" rid="CR31">31</xref>], and our existing SNV based multi-sample algorithm DESMAN [<xref ref-type="bibr" rid="CR39">39</xref>]. STRONG and DESMAN utilising variant graphs and read-mapping respectively are completely independent algorithms. We ran mixtureS with default parameters combining the individual sample data sets so that the overall strain coverages were the same across algorithms. In Fig. <xref rid="Fig3" ref-type="fig">3</xref> we compare the algorithms in terms of their ability to correctly reconstruct the number of strains in a MAG. By far the most reliable predictions were generated by STRONG, although there was a tendency to be conservative and slightly underestimate strain number. DESMAN did less well although it still outperformed mixtureS, which exhibited no significant association between true and predicted strain number.
<fig id="Fig3"><label>Fig. 3</label><caption><p>Actual versus predicted strain number for the synthetic community data sets. For each MAG we compare the actual number of strains against the predicted number. The number in each tile gives the total no. of MAGs observed with those values. The colour of a tile the divergence between true and predicted strain numbers. Results are shown for all four data sets Synth_S03, Synth_S05, Synth_S10 and Synth_S15 with increasing sample number and three algorithms, DESMAN, STRONG, and mixtureS. The results of Pearson’s correlations are given in the title texts</p></caption><graphic xlink:href="13059_2021_2419_Fig3_HTML" id="MO3"/></fig></p>
      <p>For each of the four synthetic data sets we considered only MAGs which were assigned to species (see “<xref rid="Sec10" ref-type="sec">Methods</xref>” section) with at least two strains - 20, 21, 25 and 23 MAGs, from the Synth_S03, Synth_S05, Synth_S10 and Synth_S15 data sets respectively. For each MAG we mapped the predicted haplotypes for the optimal strain decomposition for the STRONG pipeline, DESMAN algorithm and mixtureS onto the known reference strains. We then assigned each haplotype prediction to its best matching reference. The best such match was denoted ‘Found’. If more than one predicted haplotype was matched to the same reference, all but the best matching ‘Found’ strain were denoted as ‘Repeated’. If a reference had no haplotype prediction that matched to it better than the other references, it was denoted as ‘Not found’. For the aggregate across these MAGs we show the total number of such strains for each of the four data sets in Fig. <xref rid="Fig4" ref-type="fig">4</xref>.
<fig id="Fig4"><label>Fig. 4</label><caption><p>No. of strains resolved by STRONG, DESMAN and mixtureS algorithms in the synthetic community data sets. For MAGs with two or more strains we mapped haplotypes to the references and assigned each predicted haplotype to its best matching reference. The best such match was denoted ‘Found’. If multiple haplotypes matched to the same reference all but the best matching were denoted as ‘Repeated’. If a reference had no predicted haplotypes matched to it, it was denoted as ‘Not found’. The bars give the total numbers in each category summed over MAGs for the three methods (DESMAN, STRONG and mixtureS) and the panels results for the four different data sets with increasing number of samples (Synth_S03, Synth_S05, Synth_S10 and Synth_S15)</p></caption><graphic xlink:href="13059_2021_2419_Fig4_HTML" id="MO4"/></fig></p>
      <p>STRONG consistently performs better than DESMAN and mixtureS in terms of number of strains in the ‘Found’ category, in total across all four samples it resolved 216 strains vs. 208 for DESMAN i.e. a 3.8% increase and 40% more than mixtureS which resolved just 154. It also had fewer ‘Repeated’ strains, 6 vs. 30 for DESMAN: a reduction of 80% and as compared to 64 for mixtureS. The strains ‘Found’ were also reconstructed more accurately, the per base error rate for the BayesPaths reconstructions averaged across all MAGs and all data sets was just 0.052%, three times lower than that for DESMAN, 0.176%, and nearly ten times more accurate than mixtureS at 48.7%. This improvement was observed for all four data sets (see Table <xref rid="Tab1" ref-type="table">1</xref> and Fig. <xref rid="Fig5" ref-type="fig">5</xref>).
<fig id="Fig5"><label>Fig. 5</label><caption><p>Error rates for ‘Found’ strains against coverage depth for STRONG, DESMAN and mixtureS algorithms in the synthetic community data sets. For the ‘Found’ strains we computed per base error rate to the matched reference, this is shown on the y-axis, against strain total coverage depth summed across samples on the x-axis, both axes are log transformed. The results are separated across methods (DESMAN, STRONG and mixtureS) and sample number in the synthetic community</p></caption><graphic xlink:href="13059_2021_2419_Fig5_HTML" id="MO5"/></fig><table-wrap id="Tab1"><label>Table 1</label><caption><p>Comparison of STRONG, DESMAN and mixtureS for strain reconstruction in the synthetic community data sets</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">Method</th><th align="left">Data set</th><th align="left">MAGs</th><th align="left">#SCGs</th><th align="left">#fSCGs</th><th align="left">Found</th><th align="left">Not F.</th><th align="left">Rep.</th><th align="left">Err</th><th align="left"><italic>R</italic><sup>2</sup></th><th align="left"><italic>f</italic><sup><italic>G</italic></sup></th></tr></thead><tbody><tr><td align="left">STRONG</td><td align="justify">Synth_S03</td><td align="justify">20</td><td align="justify">33.18</td><td align="justify">19.71</td><td align="justify">45</td><td align="justify">20</td><td align="justify">3</td><td align="justify">0.069</td><td align="left">0.81(0.99)</td><td align="left">26/38 = 0.68</td></tr><tr><td align="left">DESMAN</td><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify">42</td><td align="justify">23</td><td align="justify">2</td><td align="justify">0.125</td><td align="left">0.81(1.00)</td><td align="left">26/38 = 0.68</td></tr><tr><td align="left">mixtureS</td><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify">35</td><td align="justify">30</td><td align="justify">8</td><td align="justify">0.706</td><td align="left">—</td><td align="left">8/38 = 0.21</td></tr><tr><td align="left">STRONG</td><td align="justify">Synth_S05</td><td align="justify">21</td><td align="justify">32.13</td><td align="justify">22.71</td><td align="justify">53</td><td align="justify">13</td><td align="justify">2</td><td align="justify">0.062</td><td align="left">0.87(0.99)</td><td align="left">29/38 = 0.76</td></tr><tr><td align="left">DESMAN</td><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify">50</td><td align="justify">16</td><td align="justify">9</td><td align="justify">0.222</td><td align="left">0.83(0.96)</td><td align="left">20/38 = 0.53</td></tr><tr><td align="left">mixtureS</td><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify">38</td><td align="justify">28</td><td align="justify">9</td><td align="justify">0.590</td><td align="left">—</td><td align="left">7/38 = 0.18</td></tr><tr><td align="left">STRONG</td><td align="justify">Synth_S10</td><td align="justify">25</td><td align="justify">32.05</td><td align="justify">22.72</td><td align="justify">58</td><td align="justify">19</td><td align="justify">0</td><td align="justify">0.036</td><td align="left">0.84(0.99)</td><td align="left">30/43 = 0.70</td></tr><tr><td align="left">DESMAN</td><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify">58</td><td align="justify">21</td><td align="justify">10</td><td align="justify">0.206</td><td align="left">0.79(0.92)</td><td align="left">25/44 = 0.57</td></tr><tr><td align="left">mixtureS</td><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify">43</td><td align="justify">36</td><td align="justify">7</td><td align="justify">0.279</td><td align="left">—</td><td align="left">9/44 = 0.20</td></tr><tr><td align="left">STRONG</td><td align="justify">Synth_S15</td><td align="justify">23</td><td align="justify">32.17</td><td align="justify">24.19</td><td align="justify">60</td><td align="justify">12</td><td align="justify">1</td><td align="justify">0.046</td><td align="left">0.87(0.97)</td><td align="left">34/42 = 0.81</td></tr><tr><td align="left">DESMAN</td><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify">58</td><td align="justify">14</td><td align="justify">9</td><td align="justify">0.144</td><td align="left">0.81(0.92)</td><td align="left">25/42 = 0.60</td></tr><tr><td align="left">mixtureS</td><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify"/><td align="justify">38</td><td align="justify">34</td><td align="justify">16</td><td align="justify">0.321</td><td align="left">—</td><td align="left">9/33 = 0.21</td></tr></tbody></table><table-wrap-foot><p>Data set: Results are shown for the four different sample numbers. MAGs: The number of MAGs reconstructed with more than two reference strains. #SCGs: The average number of SCGs found in each MAG. #fSCGs The average number of SCGs after filtering in STRONG. Found: Number of strains matched to a reference strain. Not F.: Number of reference strains that had no predicted strain with a closest match to it. Rep.: Number of strains matching to a reference that already has a better match. Err: The average error rate of the ‘Found’ strains in percentage base pairs. <italic>R</italic><sup>2</sup>: Correlation between predicted and actual strain relative proportions given as adjusted <italic>R</italic><sup>2</sup>, the figure in parentheses is when restricted to MAGs where the number of strains was correctly predicted. <italic>f</italic><sup><italic>G</italic></sup>: the fraction of MAGs where the number of strains was correctly inferred</p></table-wrap-foot></table-wrap></p>
      <p>STRONG was also better at predicting the strain relative abundances. Regressing true abundance against predicted abundance gave an adjusted <italic>R</italic><sup>2</sup> of 0.85 averaged across sample numbers for STRONG vs. 0.81 for DESMAN. When this was restricted to MAGs where the number of strains was correctly predicted, then both algorithms did better but STRONG still out performed DESMAN, with a mean <italic>R</italic><sup>2</sup> of 0.98 compared to 0.95. STRONG filtered roughly 1/3 of the SCGs as outliers although the exact number varied across the four data sets (see Table <xref rid="Tab1" ref-type="table">1</xref>). Outlier SCGs were identified by coverage error rates that exceeded those expected based on analysis of the median absolute deviations, a procedure designed to identify contaminant SCGs introduced by incorrect contig binning (see “<xref rid="Sec10" ref-type="sec">Methods</xref>” section). The method mixtureS does not predict abundances across multiple samples so was not compared here.</p>
      <p>The STRONG pipeline outperforms DESMAN, but it still misses strains that are present. In total across all MAGs and data sets, 64/280 i.e. 22.8%, of strains were missed by STRONG. Some of these, 7 out of 64, were below the minimum coverage of detected strains (5.68), but most were not, suggesting that either they were not sufficiently divergent in terms of nucleotides or coverage profiles to be detected. Examination of phylogenetic trees for the haplotypes and reference genomes constructed using the SCGs revealed that in many cases ‘Not found’ strains had identical SCG haplotypes to those that were resolved.</p>
      <p>The BayesPaths algorithm used to resolve strains in STRONG uses variational inference (see “<xref rid="Sec10" ref-type="sec">Methods</xref> - <xref rid="Sec20" ref-type="sec">BayesPaths</xref>” section), an approximate Bayesian strategy [<xref ref-type="bibr" rid="CR7">7</xref>]. This has the advantage of providing estimates of uncertainty in the inference of both the strain haplotypes and their abundances. The algorithm predicts the marginal probabilities that a given strain passes through a particular unitig. To provide a single sequence for the evaluation above and applications below we output the most likely path and hence sequence for each strain. However, we also calculate an estimate of path uncertainty by sampling many possible paths (default 100) consistent with the marginal distributions and calculate the average number of nodes that deviate from the most likely path, we refer to this as the divergence. For the ‘Found’ strains this correlates strongly with actual error rate to the reference strain (Pearson’s correlation <italic>r</italic>=0.54,<italic>p</italic>&lt;2.2<italic>e</italic>−16 - see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S1). Thus the divergence is a useful prediction of uncertainty in the haplotype sequence inference, enabling us to estimate error rates in real data sets in the absence of known reference sequences. Roughly speaking, the expected per base error rate is 0.01 times the divergence, so that a strain divergence of 0.1 predicts a 0.1% error rate. In real data sets, the uncertainty estimates in the abundances are also useful, placing bounds on the abundance of individual strains in each sample.</p>
      <p>In Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S3, we give approximate run times for each component of the STRONG pipeline on the synthetic community data sets, using 64 threads on a standard bioinformatics server. The BayesPaths step is the most time consuming part of the analysis (up to 36 hours), but it is still comparable to the initial coassembly. The only part of the pipeline with substantial memory requirements is the initial coassembly with metaSPAdes, the other steps are CPU limited.</p>
    </sec>
    <sec id="Sec5">
      <title>Limits of strain diversity resolvable by STRONG</title>
      <p>The synthetic data sets considered above had at most five strains present for each species. To determine the upper limit on the number of strains resolvable by STRONG we also simulated a community with higher strain numbers. This comprised just twelve species but with strain numbers that increased from five to a maximum of ten, with two species with each strain number, i.e. 90 genomes in total. We generated four data sets using this strain configuration, using the same strategy of increasing sample numbers (3, 5, 10 and 15 samples) as outlined above, but with a higher total read number (250 million 2X150 bp reads) to ensure that most strains had a coverage above the detection limit. We denote these data sets Synth_M10_S03, Synth_M10_S05, Synth_M10_S10 and Synth_M10_S15.</p>
      <p>We ran the complete STRONG pipeline on these four high strain diversity sets. We do not present results from running the other two algorithms since they were significantly less effective than STRONG on the lower diversity data sets, and we would not expect that to change at high strain number. The pipeline generated 11 MAGs out of the 12 species possible, for each of the data sets except for when five samples were used (Synth_M10_S05) when 9 MAGs were obtained. In Fig. <xref rid="Fig6" ref-type="fig">6</xref>A, we compare actual vs. predicted strain number for these MAGs across data sets. Overall, we did observe correlations between the two, so that MAGs with more strains generally had more strains predicted, but not the highly significant relationships we found in the less diverse synthetic communities. The correlations also did not noticeably improve with increased sample number. In contrast, the accuracy of the resolved strains did. From Fig. <xref rid="Fig6" ref-type="fig">6</xref>B we see that the proportion of predicted strains that match uniquely to reference strains increased for higher sample numbers and for one MAG in the 15 sample data set we predicted nine strains with each uniquely mapping to a true reference. The mean error rate of the ‘Found’ strains decreased with sample number too, from a mean error rate of 0.31% for the three sample data set Synth_M10_S03, to 0.27%, 0.18% and 0.12% for five, ten and fifteen samples respectively. As for the simpler synthetic communities, error rates decreased with increasing strain coverage for all sample numbers (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S2).
<fig id="Fig6"><label>Fig. 6</label><caption><p>Strain numbers resolved by STRONG in the high strain diversity synthetic community data sets. <bold>A</bold> For each MAG we compare the actual number of strains against the predicted number. The number in each tile gives the total no. of MAGs observed with those values. The colour of a tile the divergence between true and predicted strain numbers. Results are shown for all four high strain diversity data sets: Synth_M10_S03, Synth_M10_S05, Synth_M10_S10 and Synth_M10_S15 for the STRONG algorithm only. The results of Pearson’s correlations between actual and predicted strain number were for Synth_M10_S03 (r = 0.62, p = 0.04), Synth_M10_S05 (r = 0.57, p = 0.11), Synth_M10_S10 (r = 0.59, p = 0.05), and Synth_M10_S15 (r = 0.52, p = 0.10). <bold>B</bold> The same data are shown but now for each tile we give the mean fraction of predicted strains that were ‘Found’ i.e. mapped uniquely onto a reference strain</p></caption><graphic xlink:href="13059_2021_2419_Fig6_HTML" id="MO6"/></fig></p>
    </sec>
    <sec id="Sec6">
      <title>Impact of variability in strain proportions across samples on reconstruction accuracy</title>
      <p>The BayesPaths algorithm depends on differences in strain profiles across samples in order to link unitigs into haplotypes. In some real communities, strain proportions may actually be surprisingly stable, as discussed below. The synthetic communities analysed above generated strain relative abundances in each sample from a Dirichlet distribution with unit variance which is equivalent to a uniform distribution, this implies a high degree of variability between samples. To relax this assumption and provide benchmarks in the case where strains may have more stable proportions we generated an additional set of benchmark examples. We used a Dirichlet distribution to first generate a mean strain profile for each MAG and then generated the individual sample profiles from this, again using a Dirichlet but with a precision, i.e. inverse variance parameter <italic>θ</italic>, that can be varied across data sets. The result is a hierarchical Dirichlet distribution for strain proportions, that enables us to control the expected variability and model potentially more stable strain proportions (see “<xref rid="Sec10" ref-type="sec">Methods</xref>” section).</p>
      <p>We generated three ten sample data sets all comprising the same ten species, each with five strains, but with increasing precisions for the sample level Dirichlet corresponding to reduced difference in profiles between samples. The first had <italic>θ</italic>=1, which corresponds to strain proportions that differ greatly from one sample to another, the second <italic>θ</italic>=10, and the third <italic>θ</italic>=100, we denoted these Synth_T1_S10, Synth_T10_S10, and Synth_T100_S10 respectively. The results of running STRONG on these three data sets are summarised in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S4. We confirmed the expected reduction in strain variability with increasing <italic>θ</italic>, by computing the average coefficient of variation in strain proportions in each data set, which is simply the standard deviation in strain relative abundance divided by the mean. This decreased from 1.45 in Synth_T1_S10, to 0.65 in Synth_T10_S10, and 0.23 in Synth_T100_S10. This reduction in variability was not accompanied by a clear reduction in the number of strains found, or number of MAGs for which the correct number of strains was predicted (that is five), but there was a decrease in the accuracy with which the strain haplotypes were reconstructed. The error rate increased from pratically zero in Synth_T1_S10, to 0.086% at the intermediate <italic>θ</italic> value Synth_T10_S10, to 0.38% for the most stable strain configuration, Synth_T100_S10.</p>
    </sec>
    <sec id="Sec7">
      <title>Anaerobic digester time series</title>
      <p>We next applied the STRONG pipeline to a real metagenomics time series, comprising ten samples taken at approximately 5 weekly intervals, from an industrial anaerobic digestion reactor (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S5 and Methods for details). This provides an evaluation community of intermediate complexity to test the pipeline’s capability to resolve strains and reconstruct intraspecies dynamics. Each sample was sequenced on the NovaSeq platform with 2x150 bp reads at a mean depth of 11.63 Gbp. One sample was also run on a Nanopore MinION flow cell producing 43.78 Gbp of reads with a read N50 of 6,727 bp and a maximum length of 108 kbp.</p>
      <p>CONCOCT binning produced 905 bins, of which 309 had 75% of SCGs present in single-copy, which we designate MAGs. In total 11 of these MAGs exhibited overlapping SCG graphs and were merged into 6 composite MAGs (see “<xref rid="Sec10" ref-type="sec">Methods</xref> - <xref rid="Sec3" ref-type="sec">STRONG pipeline</xref>” section), so that 304 MAGs were actually used in the strain decomposition. We calculated coverage depth per sample for each bin and then normalised by sample size to obtain a community profile at each time point. Overall the reactor exhibited a clear shift in community structure over time, despite consistent operating conditions, with sample time explaining 48% of the variation in community structure (<italic>p</italic>=0.001 - Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S3). Of the MAGs, 110 had an abundance that changed significantly over time (Bonferonni adjusted p-value &lt;0.05 from Pearson’s correlation of log transformed normalised abundance) and these were evenly split between those that increased (55) or decreased in abundance (55).</p>
      <p>We used the STRONG algorithm to resolve strains in the 304 MAGs. This is a complex data set and running the complete pipeline took over 16 days, of which roughly 60% of the time was spent on the BayesPaths strain resolution (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S3). The number of strains found varied between 1 and 7, with a mean of 1.7, shown as a function of coverage depth in Fig. <xref rid="Fig7" ref-type="fig">7</xref>. In total 121 (39.8%) of these MAGs had more than one strain, and there was a significant positive association between MAG coverage depth and number of strains (<italic>r</italic>=0.36,<italic>p</italic>=1.004<italic>e</italic>−10), which is expected, as low coverage MAGs will be under-sampled. This correlation disappears though when we restrict to all MAGs with a coverage greater than thirty (<italic>r</italic>=0.19,<italic>p</italic>=0.1023). On average 20.9 SCGs were used after filtering for strain haplotype predictions.
<fig id="Fig7"><label>Fig. 7</label><caption><p>Number of strains resolved by STRONG against MAG coverage depth for the AD time series. Pearson’s correlation between coverage depth and number of strains (<italic>r</italic>=0.36,<italic>p</italic>=1.004<italic>e</italic>−10). The curve indicates a LOESS smoothing</p></caption><graphic xlink:href="13059_2021_2419_Fig7_HTML" id="MO7"/></fig></p>
      <p>For the 108 MAGs that had at least two strains with relative frequencies determined in five or more samples we used permutation ANOVA to determine whether strain proportions depended on sampling time. In total 13 of the MAGs had an adjusted p-value &lt;0.05 i.e. 12.0%. For these same MAGs 37 had a total coverage that changed significantly over time with an adjusted p-value &lt;0.05 i.e. 34.2%. Therefore the intra-species dynamics are more stable than inter-species, with strain proportions remaining fixed as the MAG coverages vary, this was true for 33 of the 37 MAGs that changed significantly in coverage.</p>
      <p>In Fig. <xref rid="Fig8" ref-type="fig">8</xref>, we use the Anvi’o program [<xref ref-type="bibr" rid="CR16">16</xref>, <xref ref-type="bibr" rid="CR17">17</xref>] to summarise information on phylogeny, taxonomy, normalised coverages in the ten samples, and whether the MAGs changed significantly in total abundance, together with the number of strains resolved by STRONG and if those strain relative proportions changed significantly with time. This was restricted to just those 114 MAGs with an aggregate coverage greater than twenty to simplify the diagram.
<fig id="Fig8"><label>Fig. 8</label><caption><p>MAG summary for anaerobic digester time series. For the 114 MAGs with aggregate coverage &gt;20 we give their phylogeny constructed using concatenated marker genes together with their normalised coverages in the ten samples. We also indicate which MAGs significantly increased (SigUp) or decreased (SigDown) in total abundance (adjusted <italic>p</italic>&lt;0.05), their GTDB phylum assignment, no. of strains resolved by STRONG and whether the strain abundances changed significantly over time (adjusted <italic>p</italic>&lt;0.05) using permutation ANOVA (SigStrainChange)</p></caption><graphic xlink:href="13059_2021_2419_Fig8_HTML" id="MO8"/></fig></p>
      <p>The Nanopore sequencing provides us with a means to directly test the validity of the STRONG haplotype reconstructions, at least for the most abundant MAGs. The most abundant MAG, Bin_72, had an aggregate short read coverage depth of 2364.25, across all the samples. This MAG was assigned to the phylum Cloacimonadota using the GTDB taxonomy [<xref ref-type="bibr" rid="CR11">11</xref>]. Interestingly, this is an example of a MAG which changes significantly in abundance, decreasing over time, (adjusted <italic>p</italic>=4.9<italic>e</italic>−05) but where the proportions of the three strains predicted varied less dramatically (<italic>R</italic><sup>2</sup> = 0.35 adjusted <italic>p</italic>=0.089 - Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4). We will focus on the longest SCG for which strains were resolved, COG0532, where the three strains are present in only two variants, haplotypes 0 and 2 being identical on this core gene. In Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S5 we give the short read variant graph for this gene, which in this case is mostly simple bubbles, together with the assigned haplotypes. In fact, across the 18 SCGs used to decompose strains, haplotypes 0 and 1 were most similar with 99.7% nucleotide identity. These two strains had 99.4% and 99.1% identity with haplotype 2 respectively. That this pattern was not observed on COG0532 may suggest some recombination in the evolution of these organisms.</p>
      <p>In Fig. <xref rid="Fig9" ref-type="fig">9</xref> we show for COG0532 both the Nanopore reads that map to this gene and the three haplotypes inferred by BayesPaths, as an Non-metric Multi-dimensional Scaling (NMDS) plot using fractional Hamming distances on the short read variant positions. These are defined as the Hamming distance between two reads but only on the intersecting variant positions and ignoring gaps. We then normalise by the number of such non-gap intersecting positions to give a distance between 0 and 1. The Nanopore reads are consistent with the inference of two variants on this gene, as there are two clear clusters observed, and the two modes of those clusters are close to those haplotypes. The variation around the modes is caused by the high error rate of the Nanopore reads.
<fig id="Fig9"><label>Fig. 9</label><caption><p>Comparison of Nanopore reads to STRONG prediction for COG0532 from Bin_72. Non-metric multidimensional scaling of Nanopore reads that mapped to COG0532 from Bin_72 of the anaerobic digester time series (red) together with the three haplotypes reconstructed from short reads by STRONG (black 0, 1 and 2). Haplotypes 0 and 2 were identical for COG0532. Distances were calculated as fractional Hamming distances (see text) on short read variant positions (see “<xref rid="Sec10" ref-type="sec">Methods</xref> - <xref rid="Sec27" ref-type="sec">Nanopore sequence analysis</xref>” section). Blue dashed lines indicate read density contours</p></caption><graphic xlink:href="13059_2021_2419_Fig9_HTML" id="MO9"/></fig></p>
      <p>In order to provide a quantitative comparison of the Nanopore reads and the STRONG predictions, we applied the EM algorithm defined in the Methods (Nanopore Sequence Analysis) on the 1,603 Nanopore reads mapping to this COG (cluster of orthologous groups). Examining the negative log-likelihood as a function of number of strains, it flattens at two strains (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S6) and the two strains inferred exactly match (100% identity over 2,313 bps) haplotypes 0/2 and 1 respectively. Furthermore, STRONG in this sample predicted frequencies of 28.0% for haplotype 1. This closely matched the Nanopore haplotype frequencies for this strain of 27.6%. We also ran the Nanopore EM algorithm for all 18 filtered COGs in this bin separately. For the 11 COGs where more than one strain was predicted from the Nanopore reads, we compared the STRONG and Nanopore predictions. For haplotypes 0, 1 and 2 exact matches were found for 6, 7 and 4 SCGs respectively with average nucleotide identities across all genes of 99.89%, 99.89% and 99.82%.</p>
      <p>For lower coverage MAGs we generally obtain a reasonable correspondence between the STRONG haplotypes and Nanopore predictions. In most cases the number of strains is comparable between the two, although the accuracy of matches reduces with decreased Nanopore read counts, as we might expect. As an example, in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S7 we compare Nanopore reads with the five STRONG haplotypes from COG0072 of Bin_846, a Firmicutes MAG in the AD time series. The short read variant graph for this gene is shown in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S8. The most abundant Nanopore mode clearly matches STRONG haplotype 4, the most abundant strain in this sample, and there is also some support for haplotypes 0 and 2. There is less evidence for strains 1 and 3, but these are low abundance in this sample (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S9). This is confirmed from the EM algorithm applied to the Nanopore reads matching this gene, where we would predict four Nanopore haplotypes (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S10). Comparing these 4 Nanopore strains to the STRONG predictions (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S11) we find that three closely match: Nanopore haplotype 0 matched best to STRONG strain 4 with 98.8% nucleotide identity, Nanopore haplotype 1 to STRONG 4 with 99.9% identity and Nanopore haplotype 2 to STRONG strain 0 with 99.7% identity. There is also a correspondence in relative abundance, with the most abundant Nanopore haplotype 1 recruiting 82% of the reads vs 74% relative frequency for the corresponding strain haplotype from STRONG.</p>
    </sec>
  </sec>
  <sec id="Sec8" sec-type="discussion">
    <title>Discussion</title>
    <p>We have demonstrated that on the synthetic data sets with relatively low strain number, less than or equal to five strains per species, the STRONG pipeline and the BayesPaths algorithm are able to accurately infer strain sequences on the SCGs and abundances across samples. Performance does improve with increasing sample number in terms of the number of strains resolved, but reassuringly even when only a small number of samples are available we are still able to accurately predict (with 0.068% per base error rate) strains, and when ten or more samples are available we obtain error rates below 0.05% i.e. 1 error in every 2000 bps from short read data. This is better performance than the read-based DESMAN algorithm illustrating the advantage of a graph-based approach. DESMAN in turn outperformed mixtureS [<xref ref-type="bibr" rid="CR31">31</xref>], which is also read-based but uses only a single sample, confirming the advantage of deconvolving across multiple data sets when these are available. Strains are resolved more accurately as they increase in coverage (see Fig. <xref rid="Fig5" ref-type="fig">5</xref>), and in fact, when coverages exceed twenty fold we can resolve strains very reliably, with just 0.011% error rate averaged across strains in the ten sample low diversity synthetic data set. This is sufficiently accurate for high-resolution phylogenetics.</p>
    <p>There is a decrease in strain reconstruction accuracy when high levels of strain diversity are present, in the data sets where every MAG had at least five strains, then the per base error rate increased to 0.18% for ten samples. However, even in this situation correct strain numbers were inferred in some instances, and at the higher sample number we did on a number of occasions correctly determine up to eight or nine strains which probably represents the upper limit for our approach. There was also a substantial decrease in haplotype reconstruction accuracy when strain proportions became more stable across samples, although those proportions were themselves accurately predicted. The latter is important in the context of our observation of stable configurations such as these in the AD time series. However, given these caveats regarding highly diverse or stable MAGs, we believe that this pipeline will be useful whenever high quality de novo strains are required from metagenome short read time series.</p>
    <p>We do not present results comparing our approach to the strategy of simply reconstructing strains as the most abundant haplotypes in individual samples, as used in StrainPhlAn [<xref ref-type="bibr" rid="CR45">45</xref>] or inStrain [<xref ref-type="bibr" rid="CR36">36</xref>]. The implicit assumption in those methods is that one strain dominates each sample, therefore the strain mixtures that we are testing are outside their scope. Such a strategy will also inevitably fail to resolve any strains that are not the most abundant at least somewhere, and furthermore will not estimate strain proportions. They may be appropriate for some microbes in low strain diversity communities such as the human gut but will not have the range of applicability of our approach.</p>
    <p>This is to our knowledge the first algorithm capable of constructing strains from metagenomes using assembly graphs from multi-sample coassemblies. Graph-based haplotype resolution has been applied to viruses [<xref ref-type="bibr" rid="CR4">4</xref>] and for eukaryotic transcripts [<xref ref-type="bibr" rid="CR5">5</xref>, <xref ref-type="bibr" rid="CR6">6</xref>], but ours is the first algorithm to resolve strains across multiple gene subgraphs connected through a contig binning procedure. The BayesPaths algorithm is also a substantial algorithmic advance enabling coverage across multiple samples to be incorporated into a rigorous Bayesian procedure that gives uncertainties in both the paths (i.e. the sequences) and the strain abundances.</p>
    <p>In addition, to the new strain resolution algorithm, BayesPaths, STRONG incorporates a number of useful tools for large-scale variant graph processing, in particular, the tools for extraction of subgraphs that correspond to individual coding genes and the spades-gsimplifier tool for error correction on those graphs. These can be applied to any graph in the GFA format, and could therefore find applicability outside of the context of our pipeline. This also means that in the future we could add alternative choices for the coaseembly step, for instance replacing metaSPAdes with MEGAHIT [<xref ref-type="bibr" rid="CR29">29</xref>].</p>
    <p>The STRONG pipeline resolves strains in a MAG collection generated either by CONCOCT or Metabat2. It will therefore be most effective if a comprehensive set of MAGs can be generated from the coassembly for a particular community. The strain resolution by BayesPaths does, however, include an additional SCG filtering step so even the low quality MAGs should be usable. Currently, we are restricted to core genes that are single-copy and shared across all strains in a MAG. We can in theory use any such genes, specified by a pipeline configuration file, so if a particular MAG is of interest the pipeline could be run with a larger set of COGs that are SCGs for that MAG. There would be a cost in terms of increased running time, which will increase with more genes and unitigs in a roughly linear fashion.</p>
    <p>The limitation to prokaryotes is perhaps more fundamental, the default choice of 36 COGs in STRONG is designed for bacteria and archaea. The pipeline cannot be simply extended to eukaryotes by specifying a set of COGs that are appropriate for eukaryotes, because even if a set of core COGs for eukaryotes could be specified, the ORF calling via prodigal currently implemented, and the SCG subgraph extraction assumes prokaryotic genes. There is no technical reason preventing an adaptation of the pipeline to eukaryotes but it would require substantial further work and validation.</p>
    <p>STRONG itself operates on prokaryotic MAG collections, but the strain resolution, BayesPaths, could be applied to any set of SCGs from the same species, these could, if MAG generation fails for a species of interest, be obtained by mapping SCG containing contigs to a reference genome, and subgraphs extracted and processed as in the default STRONG pipeline. This would require some reengineering but it is quite feasible. In fact, even individual genes could be used for strain resolution without any binning at all, to provide a lower resolution but more comprehensive picture of strain diversity in a community. These are both functionalities we plan to add to STRONG in the near future. BayesPaths could also be used in other application areas, for example for finding viral haplotypes.</p>
    <p>The analysis of a time series from an anaerobic digestor illustrates the practicality of our pipeline on a realistically sized data set. We should note though that to resolve strains on these 304 MAGs took nearly 10 days using 64 threads on a standard bioinformatics server (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S3). The AD analysis also demonstrates the importance of strain dynamics in a real microbial community with nearly 40% of MAGs exhibiting strain variation, but this variation was relatively stable compared to the MAG dynamics themselves. If strains are functionally redundant to one another we would expect significant neutral fluctuations over time. Therefore this could be evidence for intra-species niche partitioning.</p>
    <p>In general, we found a good correspondence between haplotypes inferred from Nanopore reads and the STRONG predictions in the AD data set. For the most abundant MAG, Bin_72, they matched very closely. In addition, the relative abundances of strains were consistent across the two sequencing technologies, despite the use of different DNA extraction protocols, and the different biases inherent in library preparation and sequencing platforms. These technical elements in the data generation process are known to introduce bias at the species level [<xref ref-type="bibr" rid="CR12">12</xref>], but our findings suggest that intraspecies abundance may generally be robust against such biases, which makes sense in that all the strains of a species will have similar physical properties and genomic traits.</p>
    <p>STRONG is an effective strategy to de novo resolve subpopulations at high phylogenetic resolution within MAGs, but as discussed in the Introduction, it is important to add the caveat that the haplotype sequences obtained are not equivalent to those from sequencing cultured isolates, where we can identify the resulting genome with a single organism present in the original community. The metagenome strains, in the best case, will correspond to different modal sequences of the target species, about which substantial unresolved variation may exist. They will correspond to peaks in the probability distribution of all possible sequence configurations, and as such will provide important insights into the naturally occurring variation, but there remains the question of how to identify and quantify the unresolved variation surrounding those peaks. In the worst case, when STRONG is applied to rapidly recombining microbes, such as those found in the oceans [<xref ref-type="bibr" rid="CR37">37</xref>], the resulting sequences may not even be real in the sense of characterising any true individual.</p>
    <p>This is likely to be more of an issue when STRONG is applied to spatial or cross-sectional data sets, rather than time series, for the latter we expect to sample the same or very similar clonal populations multiple times, but for the former local adaptation may lead to variation in accessory genes even between populations that share a recent common ancestor. An additional unaddressed question is how to determine when this has occurred, for now we would simply urge caution when using STRONG in cross-sectional studies of rapidly evolving microbes, and suggest that the term ‘metagenome strain’ or ‘metagenome haplotype’ be used when referring to the output sequences. The same caveat does of course apply to any current purely bioinformatics strategy for de novo resolution of genomes from metagenomes. Even if a single sample is used for binning and there are no subpopulations, the resulting MAG is still a composite and not a strain in the traditional microbiological sense [<xref ref-type="bibr" rid="CR46">46</xref>].</p>
    <p>An obvious extension of our algorithm would be to resolve the accessory genome into strain genomes. This could be done on a per gene basis by relaxing the requirement that every strain passes through every gene, but an approach that incorporates the path structure in the full metagenomic assembly would be more powerful. Use of the full assembly may be possible in an efficient manner by factorising the variational approximation on a per gene basis and allowing the solutions for one gene to depend on the expectations across their neighbours. Or it may be that more computationally tractable versions of the algorithm can be developed that will scale to larger graphs. In any case the issues discussed above of our inferred ‘strains’ containing unresolved variation will become more pertinent when we extend our algorithm to the full genome, and it will be necessary to consider not just the most likely genome associated with a subpopulation but also its variants.</p>
    <p>In the future we also plan to directly incorporate long read information into the strain resolution rather than just using it for validation. It was encouraging therefore to see the correspondence in strain frequencies between the two approaches. We are confident that in the near future, through the combination of long reads with methods similar to those we have introduced in STRONG, that complete metagenome de novo strain resolution, i.e. obtaining the complete genomes of all significant clonal subpopulations within a species, will become a realistic possibility.</p>
  </sec>
  <sec id="Sec9" sec-type="conclusion">
    <title>Conclusion</title>
    <p>We have introduced a complete bioinformatics pipeline, STrain Resolution ON assembly Graphs (STRONG), that is capable of extracting single-copy core gene variant graphs from short read metagenome coassemblies for individual metagenome assembled genomes (MAGs). We demonstrated how these graphs and associated per-sample unitig coverages can be used in a novel Bayesian algorithm, BayesPaths, to find MAG strain number, haplotypes and abundances. This approach achieves superior accuracy to variant based methods on synthetic communities and predictions on real data that match those from long Nanopore long reads.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Synthetic data set generation</title>
      <p>The in silico synthetic communities were generated by first downloading a list of complete bacterial genomes from the NCBI and selecting species with multiple strains present. Genomes were restricted to those that were full genome projects, possessed at least 35 of 36 single-copy core genes (SCGs) identified in [<xref ref-type="bibr" rid="CR3">3</xref>], and with relatively few contigs (&lt;5) in the assemblies. Communities were created by specifying species from this list and the number of strains desired. The strains selected were then chosen at random from the candidates for each species, with the extra restrictions that all strains in a species were at least 0.05% and no more than 5% nucleotide divergent on the SCGs from any other strain in the species. This corresponds to a minimum divergence of approximately 15 nucleotides over the roughly 30 kbp region formed by summing the SCGs. The genomes used are given in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Tables S1 and S2 and as a csv text file in Additional file <xref rid="MOESM2" ref-type="media">2</xref>.</p>
      <p>Each species indexed <italic>i</italic> was then given an abundance, <italic>y</italic><sub><italic>i</italic>,<italic>s</italic></sub>, in each sample, <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$s = 1,\dots,S$\end{document}</tex-math><mml:math id="M2"><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>S</mml:mi></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq1.gif"/></alternatives></inline-formula>, which was drawn from a lognormal distribution with a species dependent mean and standard deviation, themselves drawn from a normal and gamma distribution respectively: 
<disp-formula id="Equa"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\log (y_{i,s}) \sim N(\mu_{i}, \sigma_{i}) $$ \end{document}</tex-math><mml:math id="M4"><mml:mrow><mml:mo>log</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="13059_2021_2419_Article_Equa.gif" position="anchor"/></alternatives></disp-formula> where: 
<disp-formula id="Equb"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\mu_{i} \sim N(\mu_{p}, \sigma_{p}) $$ \end{document}</tex-math><mml:math id="M6"><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="13059_2021_2419_Article_Equb.gif" position="anchor"/></alternatives></disp-formula> and: 
<disp-formula id="Equc"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\sigma_{i} \sim \text{Gamma}(k_{p}, \theta_{p}). $$ \end{document}</tex-math><mml:math id="M8"><mml:mrow><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mtext>Gamma</mml:mtext><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mi>.</mml:mi></mml:mrow></mml:math><graphic xlink:href="13059_2021_2419_Article_Equc.gif" position="anchor"/></alternatives></disp-formula> For all the synthetic communities we used <italic>μ</italic><sub><italic>p</italic></sub>=1,<italic>σ</italic><sub><italic>p</italic></sub>=0.125,<italic>k</italic><sub><italic>p</italic></sub>=1 and <italic>θ</italic><sub><italic>p</italic></sub>=1. The species abundances were then normalised to one (<inline-formula id="IEq2"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$y^{\prime }_{i,s} = y_{i,s}/ \sum _{i} y_{i,s}$\end{document}</tex-math><mml:math id="M10"><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq2.gif"/></alternatives></inline-formula>). For each strain within a species its proportion in each sample was then drawn from a Dirichlet: 
<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \rho_{g,s} \sim \text{Dirichlet}(\alpha)  $$ \end{document}</tex-math><mml:math id="M12"><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mtext>Dirichlet</mml:mtext><mml:mo>(</mml:mo><mml:mi>α</mml:mi><mml:mo>)</mml:mo></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>with <italic>α</italic>=1 and <italic>g</italic>=1,…,<italic>G</italic> indexing <italic>G</italic> strains per species. This was the procedure used for all the data sets except Synth_T1_S10, Synth_T10_S10, and Synth_T100_S10 where we used a hierarchical Dirichlet first generating for each MAG an expected strain profile for all samples: 
<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \mu_{i,g} \sim \text{Dirichlet}(\alpha)  $$ \end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mtext>Dirichlet</mml:mtext><mml:mo>(</mml:mo><mml:mi>α</mml:mi><mml:mo>)</mml:mo></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>with <italic>α</italic>=1 but then in each sample the strain proportions were generated as: 
<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \rho_{i,s,g} \sim \text{Dirichlet}(\mu_{i}\theta),  $$ \end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mtext>Dirichlet</mml:mtext><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi>θ</mml:mi><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>so that the mean strain proportions were <italic>μ</italic><sub><italic>i</italic></sub> with an adjustable precision <italic>θ</italic>.</p>
      <p>This allowed us to specify a copy number for each genome <italic>g</italic> in species <italic>i</italic> in each sample as <inline-formula id="IEq3"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$y^{\prime }_{i,s}\rho _{g,s}$\end{document}</tex-math><mml:math id="M18"><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq3.gif"/></alternatives></inline-formula>. We then generated 150 million paired-end 2x150 bp reads in total across all samples with Illumina HiSeq error distributions using the ART read simulator [<xref ref-type="bibr" rid="CR23">23</xref>]. The code for the synthetic community generation is available from <ext-link ext-link-type="uri" xlink:href="https://github.com/chrisquince/STRONG_Sim">https://github.com/chrisquince/STRONG_Sim</ext-link>.</p>
    </sec>
    <sec id="Sec12">
      <title>Synthetic data set evaluation</title>
      <p>We can determine which contig derived from which reference genome by considering the simulated reads that map onto it. We know which reference each of these came from, enabling us to assign a contig to a genome as that which a majority of its reads derive from. We can then assign each MAG generated by STRONG to a reference species as the one which the majority of its contig’s derive from weighted by the contig length.</p>
    </sec>
    <sec id="Sec13">
      <title>Anaerobic digester sampling and sequencing</title>
      <sec id="Sec14">
        <title>AD sample collection</title>
        <p>We obtained ten samples from a farm anaerobic digestion bioreactor across a period of approximately one year. The sampling times, metadata and accession numbers are given in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S5. The reactor was fed on a mixture of slurry, whey and crop residues, and operated between 35−40<sup>∘</sup>C, with mechanical stirring. Biomass samples were taken directly from the AD reactor by the facility operators and shipped in ice-cooled containers to the University of Warwick. Upon receipt, they were stored at 4<sup>∘</sup>C and then sampled into several 1-5mL aliquots within a few days. DNA was usually extracted from these aliquots immediately but some were first stored in a −80<sup>∘</sup>C freezer until subsequent thawing and extraction.</p>
      </sec>
      <sec id="Sec15">
        <title>AD short read sequencing</title>
        <p>DNA extraction was performed using the Qiagen Powersoil extraction kit following the manufacturer’s protocol. DNA samples were sequenced by Novogene using the NovaSeq platform with 2x150 bp reads at a mean depth of 11.63 Gbp.</p>
      </sec>
      <sec id="Sec16">
        <title>AD long read sequencing</title>
        <p>Anaerobic digester samples were stored in 1.8 mL Cryovials at −80<sup>∘</sup>C. Samples were defrosted at 4<sup>∘</sup>C overnight prior to DNA extraction. DNA was extracted from a starting mass of 250 mg of anaerobic digester sludge using the MP Biomedical<sup>TM</sup> FastDNA<sup>TM</sup> SPIN Kit for Soil (cat no: 116560200) and a modified manufacturers protocol. Defrosted samples were homogenised by pipetting and then transferred to a MP bio<sup>TM</sup> lysing matrix E tube (cat no: 116914050-CF). Samples were resuspended in 938 <italic>μ</italic><italic>L</italic> of Sodium phosphate buffer (cat no: 116560205).</p>
        <p>Preliminary cell lysis was undertaken using lysozyme at a final concentration of 200 <italic>n</italic><italic>g</italic>/<italic>μ</italic><italic>L</italic> and 20 <italic>μ</italic><italic>L</italic> of Molzyme Bug Lysis <sup><italic>T</italic><italic>M</italic></sup> solution. Samples were mixed by inversion and incubated at 37<sup>∘</sup>C for 30 min on a shaking incubator (&lt;100 rpm). Lysozyme was inactivated by adding 122 <italic>μ</italic><italic>L</italic> of MP bio MT buffer and mixing by inversion. Samples were then mechanically lysed in a VelociRuptor V2 bead beating machine (cat no: SLS1401) at 5 <italic>m</italic>/<italic>s</italic> for 20 seconds then placed on ice for five minutes.</p>
        <p>Samples were centrifuged at 14000 g for five minutes to pellet the particulate matter and the supernatant was transferred to a new 1.5 mL microfuge tube. Proteins were precipitated from the crude lysate by adding 250 <italic>μ</italic><italic>L</italic> of PPS<sup>TM</sup> (cat no: 116560203) and then mixing by inversion. Precipitated proteins were pelleted for five minutes at 14000 g and the supernatant was transferred to 1000 <italic>μ</italic><italic>L</italic> of pre mixed DNA binding matrix solution (cat no: 116540408). Samples were mixed by inversion for two minutes.</p>
        <p>DNA binding matrix beads were recovered using the MP bio<sup>TM</sup> spin filter (cat no: 116560210) and manufacturer based spin protocol. The binding matrix was washed of impurities by complete resuspension in 500 <italic>μ</italic><italic>L</italic> of SEWS-M solution (cat no: 116540405) and centrifuged at 14000 g for five minutes. The DNA binding matrix was then washed for a second time by resuspension in 500 <italic>μ</italic><italic>L</italic> of 80% EtOH followed by centrifugation at 14000 g for five minutes. Flow though was discarded and centrifuged at 14000 g for two minutes to remove residual EtOH. The binding matrix was left to air dry for 2 minutes then DNA was eluted using 100 <italic>μ</italic><italic>L</italic> of DES elution buffer at 56<sup>∘</sup>C. Elute was collected by centrifugation at 14000 g for 5 minutes and stored at 4<sup>∘</sup>C prior to library preparation. Eluted DNA concentration was estimated using a Qubit 4<sup>TM</sup> fluorometer with the dsDNA Broad Range sensitivity assay kit (cat no: Q32853). 260:280 and 260:230 purity ratios were quantified using a Nanodrop<sup>TM</sup> 2000.</p>
        <p>A 1x SPRI clean up procedure was undertaken prior to library construction to further reduce contaminant carry over. Input DNA was standardised to 1.2 <italic>μ</italic><italic>g</italic> in 48 <italic>μ</italic><italic>L</italic> of <italic>H</italic><sub>2</sub><italic>O</italic> using a qubit 4<sup>TM</sup> fluorometer and dsDNA 1x High Sensitivity assay kit (cat no: Q33231). Library preparation was undertaken using the Oxford Nanopore<sup>Ⓒ</sup> Ligation Sequencing Kit (SQK-LSK109) with minor modifications to the manufacturer protocol. The FFPE/End repair incubation step was extended to 30 min at 20<sup>∘</sup>C and 30 min at 65<sup>∘</sup>C, while DNA was eluted from SPRI beads at 37<sup>∘</sup>C for 30 min with gentle agitation. The SQK-LSK109 long fragment buffer was used to ensure removal of non-ligated adaptor units and reduce short fragment carryover into the final sequencing library. The final library DNA concentration was standardised to 250 ng in 12 <italic>μ</italic><italic>L</italic> of EB using a qubit 4<sup>TM</sup> fluorometer and dsDNA 1 x High Sensitivity assay kit.</p>
        <p>Sequencing was undertaken for 72 hours on an Oxford Nanopore<sup>Ⓒ</sup> R 9.4.1 (FLO-MIN106) flow cell with 1489 active pores. DNA was left to tether for 1 hour prior to commencing sequencing. The flow cell and sequencing reaction was controlled by a MinION<sup>TM</sup> MKII device and the GUI MinKNOW V. 19.12.5. ATP refuelling was undertaken every 18 hours with 75 <italic>μ</italic><italic>L</italic> of flush buffer (FB). Post Hoc basecalling was undertaken using Guppy V. 3.5.1 and the high accuracy configuration (HAC) mode.</p>
      </sec>
    </sec>
    <sec id="Sec17">
      <title>STRONG pipeline</title>
      <p>STRONG processes co-assembly graph regions for multiple metagenomic datasets in order to simultaneously infer the composition of closely related strains for a particular MAG and their core gene sequences. Here, we provide an overview of STRONG. We start from a series of <italic>S</italic> related metagenomic samples, e.g. samples of the same (or highly similar) microbial community taken at different time points or from different locations.</p>
      <p>The Snakemake based pipeline begins with the recovery of metagenome-assembled genomes (MAGs) [<xref ref-type="bibr" rid="CR26">26</xref>]. We perform co-assembly of all available data with the metaSPAdes assembler [<xref ref-type="bibr" rid="CR33">33</xref>], and then bin the contigs obtained by composition and coverage profiles across all available samples with CONCOCT [<xref ref-type="bibr" rid="CR3">3</xref>] or alternatively Metabat2 [<xref ref-type="bibr" rid="CR25">25</xref>]. Each bin is then analyzed for completeness and contamination based on single-copy core genes, and poor quality bins are discarded. The default criterion is that a MAG requires greater than or equal to 75% of the SCGs in a single copy. While we currently focus on this combination of software tools, in principle we could use any other software or pipeline for MAG recovery, e.g. we could use MEGAHIT as the primary assembler [<xref ref-type="bibr" rid="CR29">29</xref>]. For each MAG we then extract the full or partial sequences of the core genes that we further refer to as single-copy core gene (SCG) sequences.</p>
      <p>The final coassembly graph produced by metaSPAdes cannot be used for strain resolution because, as with other modern assembly pipelines, variants between closely related strains will be removed during the graph simplification process. Instead, we output the initial graph for the final K-mer length used in the (potentially) iterative assembly following processing by a custom executable — spades-gsimplifier based on the SPAdes codebase — to remove likely erroneous edges using a ‘mild’ coverage threshold and a tip clipping procedure. We refer to the resulting graph as a high-resolution assembly graph or HRAG.</p>
      <p>The graph edges are then annotated with their corresponding sequence coverage profiles across all available samples. As is typical in de Bruijn graph analysis, the coverage values are given in terms of the k-mer rather than nucleotide coverage. Profile computation is performed by a second tool for aligning reads onto the HRAG: unitig-coverage. The potential advantage of this approach in comparison to estimation based on k-mer multiplicity, is that it can correctly handle the results of any bubble removal procedure that we might want to add to the preliminary simplification phase in future.</p>
      <p>For each detected SCG sequence (across all MAGs) we next try to identify the subgraph of the HRAG encoding the complete sequences of all variants of the gene across all strains represented by the MAG. The procedure is described in more detail in the next section. During testing we faced two types of problems here: (1) related strains might end up in different MAGs and (2) some subgraphs might consist of fragments corresponding to several different species. We take several steps to mitigate those problems. Firstly, we compare SCG graphs between all bins, not just MAGs. If an SCG graph shares unitigs between bins, then it is flagged as overlapping. If multiple SCG graphs between MAGs (&gt;10) overlap then we merge those MAGs, combining all graphs and processing them for strains together. Following merging any MAG SCG graphs with overlaps remaining are filtered out and not used in the strain resolution.</p>
      <p>After MAG merging and COG subgraph filtering we process the remaining MAGs one by one. Before the core ‘decomposition’ procedure is launched on the set of SCG subgraphs corresponding to a particular MAG, they are subjected to a second round of simplification, parameterised by the mean coverage of the MAG, to filter nodes that are likely to be noise again by the spades-gsimplifier program. This module is described in more detail below. The resulting set of simplified SCGs of the HRAG for a MAG are then passed to the core graph decomposition procedure, which uses the graph structure constraints, along with coverage profiles associated with unitig nodes, to simultaneously predict: the number of strains making up the population represented by the MAG; their coverage depths across the samples; paths corresponding to each strain within every subgraph (each path encodes a sequence of the particular SCG instance).</p>
      <p>A fraction of the SCGs in a MAG may properly derive from other organisms due to the possibility of incorrect binning <italic>i.e contamination</italic>. In fact, the default 75% single-copy criterion allows up to 25% contamination. In addition, the subgraph extraction is not always perfect. We therefore add an extra level of filtering to the BayesPaths algorithm, iteratively running the program for all SCGs, but then filtering those with mean error rates, defined by Eq. <xref rid="Equ19" ref-type="">19</xref>, that exceed a default of 2.5 times the median deviation from the median gene error. Filtering on the median deviation is in general a robust strategy for identifying outliers. As a result of this filtering the pipeline only infers strain sequences on a subset of the input SCGs. We have found, however, that the number of SCGs for which strain haplotypes are inferred is sufficient for phylogenetics.</p>
    </sec>
    <sec id="Sec18">
      <title>Relevant subgraph extraction</title>
      <p>Provided with the predicted (partial) gene sequence, <inline-formula id="IEq4"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\bar T$\end{document}</tex-math><mml:math id="M20"><mml:mover accent="true"><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq4.gif"/></alternatives></inline-formula>, and the upper bound on the length of the coding sequence, <italic>L</italic>, defined as <inline-formula id="IEq5"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$3 \alpha \langle \bar U_{n} \rangle $\end{document}</tex-math><mml:math id="M22"><mml:mn>3</mml:mn><mml:mi>α</mml:mi><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>Ū</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq5.gif"/></alternatives></inline-formula> where <inline-formula id="IEq6"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\langle \bar U_{n} \rangle $\end{document}</tex-math><mml:math id="M24"><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>Ū</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq6.gif"/></alternatives></inline-formula> is the average length in amino acids of that SCG in the COG database, and <italic>α</italic>=1.5 by default. The procedure for relevant HRAG subgraph extraction involves the following steps. First, the sequence <inline-formula id="IEq7"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\bar T$\end{document}</tex-math><mml:math id="M26"><mml:mover accent="true"><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq7.gif"/></alternatives></inline-formula> is split into two halves, <inline-formula id="IEq8"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \bar {T'}$\end{document}</tex-math><mml:math id="M28"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq8.gif"/></alternatives></inline-formula> and <inline-formula id="IEq9"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\bar {T''}$\end{document}</tex-math><mml:math id="M30"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq9.gif"/></alternatives></inline-formula>, keeping the correct frame (both <inline-formula id="IEq10"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\bar {T'}$\end{document}</tex-math><mml:math id="M32"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq10.gif"/></alternatives></inline-formula> and <inline-formula id="IEq11"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\bar {T''}$\end{document}</tex-math><mml:math id="M34"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq11.gif"/></alternatives></inline-formula> are forced to divide by 3). <inline-formula id="IEq12"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \bar {T'}$\end{document}</tex-math><mml:math id="M36"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq12.gif"/></alternatives></inline-formula> and <inline-formula id="IEq13"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\bar {T''}$\end{document}</tex-math><mml:math id="M38"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq13.gif"/></alternatives></inline-formula> are then processed independently. Without loss of generality we describe the processing of <inline-formula id="IEq14"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \bar {T'}$\end{document}</tex-math><mml:math id="M40"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq14.gif"/></alternatives></inline-formula>: 
<list list-type="order"><list-item><p>Identify the path <inline-formula id="IEq15"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {P}$\end{document}</tex-math><mml:math id="M42"><mml:mi mathvariant="script">P</mml:mi></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq15.gif"/></alternatives></inline-formula> corresponding to <inline-formula id="IEq16"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \bar {T'}$\end{document}</tex-math><mml:math id="M44"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq16.gif"/></alternatives></inline-formula> in the HRAG. We denote its length as <inline-formula id="IEq17"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$L_{\mathcal {P}}$\end{document}</tex-math><mml:math id="M46"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="script">P</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq17.gif"/></alternatives></inline-formula>.</p></list-item><list-item><p>Launch a graph search of the stop codons to the right (left) of the rightmost (leftmost) position of <inline-formula id="IEq18"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \bar {T'}$\end{document}</tex-math><mml:math id="M48"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq18.gif"/></alternatives></inline-formula> (<inline-formula id="IEq19"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \bar {T''}$\end{document}</tex-math><mml:math id="M50"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq19.gif"/></alternatives></inline-formula>). The stop codon search is frame aware and is performed by a depth-first search (DFS) on the graph in which each vertex corresponds to a pair of the HRAG position and the partial sequence of the last traversed codon. Due to the properties of the procedure and the fact that it deals with DBGs, the actual implementation encodes frame state as an integer [0,2] rather than the string of last partially traversed codon. Vertices of this ‘state graph’ are naturally connected following the HRAG constraints. The search is cut off whenever a vertex with a frame state encoding a stop codon sequence is identified. Several stop codons can be identified within the same HRAG edge sequence in ‘different frames’, moreover the procedure correctly identifies all stop codons even if the graph contains cycles (although such subgraphs may be ignored in later stages of the pipeline). This codon search procedure was originally implemented for <ext-link ext-link-type="uri" xlink:href="https://github.com/ablab/orf-search">https://github.com/ablab/orf-search</ext-link>and used in [<xref ref-type="bibr" rid="CR15">15</xref>].</p></list-item><list-item><p>The ‘backward’ search of the stop codons ‘to the left’ is actually implemented as a ‘forward’ search of the complementary sequences from the complementary position in the graph. Note that, as in classic ORF analysis, while the identified positions of the stop codons ‘to the right’ correspond to putative ends of the coding sequences for some of the variants of the analyzed gene, positions of the stop codons ‘to the left’ only provide the likely boundary for where the coding sequence can start. In particular, left stop codons are likely to fall within the coding sequence of the neighbouring gene (in a different frame). Actual start codons are thus likely to lie somewhere on the path (with sequence length divisible by 3) between one of the ‘left’ stop codons and one of the ‘right’ stop codons. For reasons of simplicity, further analysis of edges on the paths between left (right) stop codons ignores the constraint of divisibility by 3.</p></list-item><list-item><p>After the sets of ‘left’ and ‘right’ stop codon positions are identified along with the shortest distances between them and the <inline-formula id="IEq20"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \bar {T'}$\end{document}</tex-math><mml:math id="M52"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq20.gif"/></alternatives></inline-formula> path, we attempt to gather the relevant subgraph given by the union of edges lying on some path of a constrained length (see further) between some pair of left and right stop codons. First, for each pair (<italic>s</italic>,<italic>t</italic>) of the left and right stop codon positions we compute the maximal length of the paths that we want to consider <italic>L</italic><sub><italic>s</italic>,<italic>t</italic></sub> as <inline-formula id="IEq21"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$L_{\mathcal {P}} + \textrm {minimal distance from s to start of} \mathcal {P} + \textrm {minimal distance from end of} \mathcal {P} \textrm { to t}$\end{document}</tex-math><mml:math id="M54"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="script">P</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mtext>minimal distance from s to start of</mml:mtext><mml:mi mathvariant="script">P</mml:mi><mml:mo>+</mml:mo><mml:mtext>minimal distance from end of</mml:mtext><mml:mi mathvariant="script">P</mml:mi><mml:mtext>to t</mml:mtext></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq21.gif"/></alternatives></inline-formula>. The edge <italic>e</italic>=(<italic>v</italic>,<italic>w</italic>) is considered relevant if there exists a pair of left (right) stop codon positions (<italic>s</italic><sup>′</sup>,<italic>t</italic><sup>′</sup>) such that the edge <italic>e</italic> lies on the path of length not exceeding <italic>L</italic><sub><italic>s</italic>,<italic>t</italic></sub> between <italic>s</italic><sup>′</sup> and <italic>t</italic><sup>′</sup>, which is equivalent to checking that min_dist(<italic>s</italic><sup>′</sup>,<italic>v</italic>)+length(<italic>e</italic>)+min_dist(<italic>w</italic>,<italic>t</italic><sup>′</sup>)&lt;<italic>L</italic><sub><italic>s</italic>,<italic>t</italic></sub>. To allow for efficient checks of the shortest distances we precompute them by launching the Dijkstra algorithm from all left (right) stop codon positions in the forward (backward) direction. In practice, the Dijkstra runs are initiated from the ends/starts of corresponding edges and the distances are later corrected.</p></list-item><list-item><p>We then exclude from the set of relevant edges the edges that are too far from any putative (right) stop codon to be a part of any COG instance. In particular, we exclude any edge <italic>e</italic>=(<italic>v</italic>,<italic>w</italic>), such that the minimal distance from vertex <italic>w</italic> to any of the right stop codon positions exceeds <italic>L</italic>.</p></list-item><list-item><p>After the sets of the graph edges potentially encoding the gene sequence are gathered for <inline-formula id="IEq22"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \bar {T'}$\end{document}</tex-math><mml:math id="M56"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq22.gif"/></alternatives></inline-formula> and <inline-formula id="IEq23"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\bar {T''}$\end{document}</tex-math><mml:math id="M58"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq23.gif"/></alternatives></inline-formula> the union of the two sets, <inline-formula id="IEq24"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {ER}$\end{document}</tex-math><mml:math id="M60"><mml:mi mathvariant="script">E</mml:mi><mml:mi mathvariant="script">R</mml:mi></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq24.gif"/></alternatives></inline-formula>, is then taken and augmented by the edges, connecting the ‘inner’ <inline-formula id="IEq25"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {ER}$\end{document}</tex-math><mml:math id="M62"><mml:mi mathvariant="script">E</mml:mi><mml:mi mathvariant="script">R</mml:mi></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq25.gif"/></alternatives></inline-formula> vertices (vertices which have at least one outgoing and at least one incoming edge in the <inline-formula id="IEq26"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {ER}$\end{document}</tex-math><mml:math id="M64"><mml:mi mathvariant="script">E</mml:mi><mml:mi mathvariant="script">R</mml:mi></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq26.gif"/></alternatives></inline-formula>) to the rest of the graph.</p></list-item></list></p>
      <p>Initial splitting of <inline-formula id="IEq27"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \bar {T}$\end{document}</tex-math><mml:math id="M66"><mml:mover accent="true"><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq27.gif"/></alternatives></inline-formula> into <inline-formula id="IEq28"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \bar {T'}$\end{document}</tex-math><mml:math id="M68"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq28.gif"/></alternatives></inline-formula> and <inline-formula id="IEq29"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\bar {T''}$\end{document}</tex-math><mml:math id="M70"><mml:mover accent="true"><mml:mrow><mml:msup><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq29.gif"/></alternatives></inline-formula> is required to detect relevant stop codons which are not reachable from the last position of <inline-formula id="IEq30"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \bar {T}$\end{document}</tex-math><mml:math id="M72"><mml:mover accent="true"><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq30.gif"/></alternatives></inline-formula> in HRAG (or from which the first position of <inline-formula id="IEq31"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \bar {T}$\end{document}</tex-math><mml:math id="M74"><mml:mover accent="true"><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq31.gif"/></alternatives></inline-formula> in HRAG can not be reached). In addition to the resulting component in gfa format, we also store the positions of the putative stop codons, and ids of edges connecting the component to the rest of the graph (further referred to as ‘sinks’ and ‘sources’).</p>
    </sec>
    <sec id="Sec19">
      <title>Subgraph simplification</title>
      <p>While processing SCG subgraphs from a particular MAG we use the available information on the coverage of the MAG in the dataset. In particular, we set up the simplification module to remove tips (a node with either no successors or predecessors) below a certain length (twice the read length) and edges with coverage below a limit that is the larger of 2.0 or one per cent of the MAG coverage for regular edges or 2.5 and two per cent of the MAG coverage for short edges.</p>
      <p>While simplifying a SCG subgraph, edges connecting it to the rest of the assembly graph should be handled with care (in particular, they should be excluded from the set of potential tips). This is because in the BayesPaths algorithm they form potential sources and sinks of the possible haplotype paths. Moreover, during the simplification the graph changes, and such edges might become part of longer edges. Since we are interested in which dead-ends of the component do, and do not lead to the rest of the graph, the output contains the up-to-date set of connections of the simplified component to the rest of the graph.</p>
      <p>We now briefly describe additional, disabled by default procedures, based on ‘relative coverage’ criteria. Amongst other procedures for erroneous edge removal SPAdes implements a procedure considering the ratio of the edge coverage to the coverage of edges adjacent to it. We define an edge <italic>e</italic> as ‘predominated’ by vertex <italic>v</italic> incident to it if there is edge <italic>e</italic><sub>1</sub> outgoing from <italic>v</italic> and edge <italic>e</italic><sub>2</sub> incoming to <italic>v</italic> whose coverages exceed the coverage of <italic>e</italic> at least by a factor of <italic>α</italic>. Short edges (shorter than <italic>k</italic>+<italic>ε</italic>) predominated by both vertices incident to them are then removed from the graph. Erroneous graph elements in high genomic coverage graph regions often form subgraphs of three or more erroneous edges. SPAdes implements a procedure for search (and subsequent removal) of subgraphs limited by a set of predominated edges. Starting from a particular edge (<italic>v</italic>,<italic>w</italic>) predominated by vertex <italic>v</italic>, the graph is traversed from vertex <italic>w</italic> breadth-first without taking into account the edge directions. If the vertex considered at the moment predominates the edge by which it was entered, the edges incident to it are not added to the traversal. The standard limitation of erroneous edge lengths naturally transforms into a condition of maximum length of the path between the vertices of the traversed subgraph. A limit on the maximum total length of its edges is additionally introduced.</p>
    </sec>
    <sec id="Sec20">
      <title>BayesPaths</title>
      <sec id="Sec21">
        <title>The model</title>
        <p>We define an assembly graph <inline-formula id="IEq32"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {G} = (\mathcal {V}, \mathcal {E})$\end{document}</tex-math><mml:math id="M76"><mml:mi mathvariant="script">G</mml:mi><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mi mathvariant="script">V</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">E</mml:mi><mml:mo>)</mml:mo></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq32.gif"/></alternatives></inline-formula> as a collection of unitig sequence vertices <inline-formula id="IEq33"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {V} = 1,\ldots,V$\end{document}</tex-math><mml:math id="M78"><mml:mi mathvariant="script">V</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>V</mml:mi></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq33.gif"/></alternatives></inline-formula> and directed edges <inline-formula id="IEq34"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \mathcal {E} \subseteq \mathcal {V} \times \mathcal {V}$\end{document}</tex-math><mml:math id="M80"><mml:mi mathvariant="script">E</mml:mi><mml:mo>⊆</mml:mo><mml:mi mathvariant="script">V</mml:mi><mml:mo>×</mml:mo><mml:mi mathvariant="script">V</mml:mi></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq34.gif"/></alternatives></inline-formula>. Each edge defines an overlap and comprises a pair of vertices and directions <inline-formula id="IEq35"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \left (u^{d} \rightarrow v^{d}\right) \in \mathcal {E} $\end{document}</tex-math><mml:math id="M82"><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msup><mml:mo>→</mml:mo><mml:msup><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>∈</mml:mo><mml:mi mathvariant="script">E</mml:mi></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq35.gif"/></alternatives></inline-formula> where <italic>d</italic>∈{+,−} and indicates whether the overlap occurs between the sequence (+) or its reverse complement (−). We define: 
<list list-type="bullet"><list-item><p>Counts <italic>x</italic><sub><italic>v</italic>,<italic>s</italic></sub> for each unitig <italic>v</italic>=1,…,<italic>V</italic> in sample <italic>s</italic>=1,…,<italic>S</italic></p></list-item><list-item><p>Paths for strain <italic>g</italic>=1,…,<italic>G</italic> defined by <inline-formula id="IEq36"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\eta ^{g}_{u,v} \in {0,1}$\end{document}</tex-math><mml:math id="M84"><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq36.gif"/></alternatives></inline-formula> indicating whether strain <italic>g</italic> passes through that edge in the graph</p></list-item><list-item><p>Flow of strain <italic>g</italic> through unitig <italic>v</italic>, <inline-formula id="IEq37"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\phi ^{g+}_{v} = \sum _{u \in A(v)} \eta ^{g}_{u,v}$\end{document}</tex-math><mml:math id="M86"><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>∈</mml:mo><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:munder><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq37.gif"/></alternatives></inline-formula> and <inline-formula id="IEq38"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\phi ^{g-}_{v} = \sum _{u \in D(v)} \eta ^{g}_{v,u}$\end{document}</tex-math><mml:math id="M88"><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>∈</mml:mo><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:munder><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq38.gif"/></alternatives></inline-formula> where <italic>A</italic>(<italic>v</italic>) is the set of ancestors of <italic>v</italic> and <italic>D</italic>(<italic>v</italic>) descendants in the assembly graph</p></list-item><list-item><p>The following is true <inline-formula id="IEq39"><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\phi ^{g+}_{v} = \phi ^{g-}_{v} = \phi ^{g}_{v}$\end{document}</tex-math><mml:math id="M90"><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq39.gif"/></alternatives></inline-formula></p></list-item><list-item><p>Strain intensities <italic>γ</italic><sub><italic>g</italic>,<italic>s</italic></sub> as the rate per position that a read is generated from <italic>g</italic> in sample <italic>s</italic></p></list-item><list-item><p>Unitig lengths <italic>L</italic><sub><italic>v</italic></sub></p></list-item><list-item><p>Unitig bias <italic>θ</italic><sub><italic>v</italic></sub> is the fractional increase in reads generated from <italic>v</italic> given factors such as GC content influencing coverage</p></list-item><list-item><p>Source node <italic>s</italic> and sink node <italic>t</italic> such that <inline-formula id="IEq40"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\phi ^{g+}_{s} = \phi ^{g-}_{s} = \phi ^{g+}_{t} = \phi ^{g-}_{t} = 1$\end{document}</tex-math><mml:math id="M92"><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq40.gif"/></alternatives></inline-formula></p></list-item></list></p>
        <p>Then assume normally distributed counts for each node in each sample giving a joint density for observations and latent variables: 
<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} P(\mathbf{X},\boldsymbol{\Gamma},\mathbf{H},\boldsymbol{\Theta}) = \prod_{v=1}^{V} \prod_{s=1}^{S} \mathcal{N}\left(x_{v,s}\left|L_{v} \theta_{v} {\sum_{h=1}^{G} \phi^{h}_{v} \gamma_{h,s}},\tau^{-1}\right.\right) \prod_{h=1}^{G} \prod_{s=1}^{S} P(\gamma_{h,s} | \lambda_{h}) \\.\prod_{h=1}^{G} \prod_{v=1}^{V} \left[ \phi^{h+}_{v} = \phi^{h-}_{v} \right] \left[ \phi^{h-}_{s} = 1\right] \left[\phi^{h+}_{t} = 1\right] P(\tau) \\.\prod_{h=1}^{G} P(\lambda_{h} | \alpha_{0}, \beta_{0}) \prod_{v=1}^{V} P(\theta_{v} | \mu_{0}, \tau_{0})  \end{array} $$ \end{document}</tex-math><mml:math id="M94"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">X</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">Γ</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">H</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">Θ</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∏</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∏</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:munderover><mml:mi mathvariant="script">N</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mfenced open="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∏</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∏</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:munderover><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="align-1"><mml:mi>.</mml:mi><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∏</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∏</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:munderover><mml:mfenced close="]" open="["><mml:mrow><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>+</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>−</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mrow><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mrow><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>+</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="align-1"><mml:mi>.</mml:mi><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∏</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∏</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:munderover><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>where [] indicates the Iverson bracket evaluating to 1 if the condition is true and zero otherwise. We assume an exponential prior for the <italic>γ</italic><sub><italic>g</italic>,<italic>s</italic></sub> with a rate parameter that is strain dependent, such that: 
<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P(\gamma_{g,s}| \lambda_{g}) = \lambda_{g} \exp(-\gamma_{g,s} \lambda_{g})  $$ \end{document}</tex-math><mml:math id="M96"><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>exp</mml:mo><mml:mo>(</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>We then place gamma hyper-priors on the <italic>λ</italic><sub><italic>g</italic></sub>: 
<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P(\lambda_{g}| \alpha_{0}, \beta_{0}) = \frac{\beta_{0}^{\alpha_{0}}}{\Gamma (\alpha_{0})} \lambda_{g}^{\alpha_{0} - 1} \exp(- \beta_{0} \lambda_{g})  $$ \end{document}</tex-math><mml:math id="M98"><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:mi>Γ</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mfrac><mml:msubsup><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>exp</mml:mo><mml:mo>(</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>This acts as a form of automatic relevance determination (ARD) forcing strains with low intensity across all samples to zero in every sample [<xref ref-type="bibr" rid="CR8">8</xref>].</p>
        <p>We use a standard Gamma prior for the precision: 
<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P(\tau | \alpha_{\tau}, \beta_{\tau}) = \frac{\beta_{\tau}^{\alpha_{\tau}}}{\Gamma(\alpha_{\tau})} \tau^{\alpha_{\tau} - 1} \exp(-\beta_{\tau} \tau)  $$ \end{document}</tex-math><mml:math id="M100"><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:mi>Γ</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>exp</mml:mo><mml:mo>(</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msub><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>For the biases <italic>θ</italic><sub><italic>v</italic></sub> we use a truncated normal prior: 
<disp-formula id="Equd"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} P(\theta_{v} | \mu_{0}, \tau_{0}) &amp; = &amp; \frac{\sqrt{\frac{\tau_{0}}{2 \pi}} \exp\left(- \frac{\tau_{0}}{2} (\theta_{v} - \mu_{0})^{2}\right) }{1 - \Psi\left(-\mu_{0} \sqrt \tau_{0} \right)} \;\;\; \theta_{v} &gt;= 0 \\ &amp; = &amp; 0 \;\;\; \theta_{v} &lt; 0 \\ \end{array} $$ \end{document}</tex-math><mml:math id="M102"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mtd><mml:mtd class="align-2"><mml:mo>=</mml:mo><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mfrac><mml:mrow><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:msqrt><mml:mo>exp</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>Ψ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:msqrt><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msqrt></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mspace width="2.77626pt"/><mml:mspace width="2.77626pt"/><mml:mspace width="2.77626pt"/><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="align-1"/><mml:mtd class="align-2"><mml:mo>=</mml:mo><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mn>0</mml:mn><mml:mspace width="2.77626pt"/><mml:mspace width="2.77626pt"/><mml:mspace width="2.77626pt"/><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="align-1"/><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2419_Article_Equd.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>where <italic>Ψ</italic> is the standard normal cumulative distribution. The mean of this is set to one, <italic>μ</italic><sub>0</sub>=1, so that our prior is that the coverage on any given node is unbiased, with a fairly high precision <italic>τ</italic><sub>0</sub>=100, to reflect an assumption that the observed coverage should reflect the summation of the strains. Finally, we assume a uniform prior over the possible discrete values of the <inline-formula id="IEq41"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\eta ^{g}_{v,u}$\end{document}</tex-math><mml:math id="M104"><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq41.gif"/></alternatives></inline-formula>. If the assembly graph is a directed acyclic graph (DAG) then <inline-formula id="IEq42"><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\eta ^{g}_{v,u} \in {0,1}$\end{document}</tex-math><mml:math id="M106"><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq42.gif"/></alternatives></inline-formula>. We have found that for most genes and typical kmer lengths this is true, but we do not need to assume it.</p>
      </sec>
      <sec id="Sec22">
        <title>Variational Approximation</title>
        <p>We use variational inference to obtain an approximate solution to the posterior distribution of this model [<xref ref-type="bibr" rid="CR7">7</xref>]. Variational inference is an alternative strategy to Markov chain Monte Carlo (MCMC) sampling. Rather than attempting to sample from the posterior distribution, variational inference assumes a tractable approximating distribution for the posterior, and then finds the parameters for that distribution that minimise the Kullback-Leibler divergence between the approximation and the true posterior distribution. Further, in mean-field variational inference the approximation can be factorised into a product over a number of components that each approximate the posterior of a parameter in the true distribution. In practice the Kullback-Leibler divergence is not computable because it depends on the evidence, i.e. the joint distribution marginalised over all latent variables. Instead, inference is carried out by maximising the evidence lower bound (ELBO), which is equal to the negative of the Kullback-Leibler divergence plus a constant, that constant being the evidence. In our case, because all the distributions are conjugate we can employ CAVI, coordinate ascent variational inference, to iteratively maximise the ELBO.</p>
        <p>Our starting point is to assume the following factorisation for the variational approximation: 
<disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ q(\mathbf{X},\boldsymbol{\Gamma},\mathbf{H}) = \prod_{h=1}^{G} q_{h}\left(\left\{ \eta^{h}_{v,u} \right\}_{u,v \in \mathcal{A}}\right) \prod_{h=1}^{G} \prod_{s=1}^{S} q_{h}(\gamma_{h,s}) \prod_{h=1}^{G} q_{h}(\lambda_{h}) \prod_{v=1}^{V} q_{v}(\theta_{v}) q(\tau)  $$ \end{document}</tex-math><mml:math id="M108"><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">X</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">Γ</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">H</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mfenced close="}" open="{"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:munderover><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:munderover><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:munderover><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:munderover><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>where <inline-formula id="IEq43"><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {A}$\end{document}</tex-math><mml:math id="M110"><mml:mi mathvariant="script">A</mml:mi></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq43.gif"/></alternatives></inline-formula> is the set of edges in the assembly graph and <inline-formula id="IEq44"><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {V} = 1,\ldots,V$\end{document}</tex-math><mml:math id="M112"><mml:mi mathvariant="script">V</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>V</mml:mi></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq44.gif"/></alternatives></inline-formula> the set of unitig sequence vertices. Note that we have assumed a fully factorised approximation except for the <inline-formula id="IEq45"><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\eta ^{h}_{v,u}$\end{document}</tex-math><mml:math id="M114"><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq45.gif"/></alternatives></inline-formula>, the paths for each strain through the graph. There we assume that the path for each strain forms a separate factor allowing strong correlations between the different elements of the path. This is therefore a form of structured variational inference [<xref ref-type="bibr" rid="CR22">22</xref>].</p>
        <p>To obtain the CAVI updates we use the standard procedure of finding the log of the optimal distributions <italic>q</italic> for each set of factorised variables as the expectation of the log joint distribution Eq. <xref rid="Equ4" ref-type="">4</xref> over all the other variables, except the one being optimised. Using an informal notation we will denote these expectations as <inline-formula id="IEq46"><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\langle \ln P \rangle _{-q_{j}}$\end{document}</tex-math><mml:math id="M116"><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:mo>ln</mml:mo><mml:mi>P</mml:mi><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq46.gif"/></alternatives></inline-formula> where <italic>q</italic><sub><italic>j</italic></sub> is the variable being optimised.</p>
        <p>Then the mean field update for each set of <inline-formula id="IEq47"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \{\eta ^{g}_{v,u}\}_{u,v \in A}$\end{document}</tex-math><mml:math id="M118"><mml:msub><mml:mrow><mml:mo>{</mml:mo><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>∈</mml:mo><mml:mi>A</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq47.gif"/></alternatives></inline-formula> is derived as: 
<disp-formula id="Eque"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \ln q_{g}^{*}\left(\left\{ \eta^{g}_{v,u} \right\}_{u,v \in A}\right) &amp; = \left\langle \ln P \right\rangle_{-\eta^{g}_{v,u} u,v \in \mathcal{A}} \\ &amp; = \ln \left(\prod_{v=1}^{V} \delta_{\phi^{g+}_{v}, \phi^{g-}_{v}} \delta_{\phi^{g-}_{s},1} \delta_{\phi^{g+}_{t},1} \right) \\ &amp; - \left\langle \sum_{v=1}^{V} \sum_{s=1}^{S} \frac{\tau}{2} \left(x_{v,s} - \theta_{v} L_{v}\left[\sum_{h=1}^{G} \phi^{h}_{v} \gamma_{h,s}\right] \right)^{2} \right\rangle_{-\eta^{g}_{v,u} u,v \in \mathcal{A}} \\ &amp; + \text{Terms\ independent\ of} \eta^{g} \end{array} $$ \end{document}</tex-math><mml:math id="M120"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:mo>ln</mml:mo><mml:munderover><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:munderover><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mfenced close="}" open="{"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>∈</mml:mo><mml:mi>A</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mtd><mml:mtd class="align-2"><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mfenced close="〉" open="〈"><mml:mrow><mml:mo>ln</mml:mo><mml:mi>P</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:msub><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="align-1"/><mml:mtd class="align-2"><mml:mo>=</mml:mo><mml:mo>ln</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∏</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:munderover><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo></mml:mrow></mml:munderover><mml:mo>,</mml:mo><mml:munderover><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>−</mml:mo></mml:mrow></mml:munderover></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:munderover><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>−</mml:mo></mml:mrow></mml:munderover><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:munderover><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo></mml:mrow></mml:munderover><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="align-1"/><mml:mtd class="align-2"><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mfenced close="〉" open="〈"><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:msub><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="align-1"/><mml:mtd class="align-2"><mml:mo>+</mml:mo><mml:mtext>Terms independent of</mml:mtext><mml:msup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msup><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2419_Article_Eque.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Consider the second term only: 
<disp-formula id="Equf"><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$- \frac{\langle \tau \rangle}{2} \left(- \sum_{v=1}^{V} \sum_{s=1}^{S} 2 x_{v,s} L_{v} \langle \theta_{v} \rangle \langle \gamma_{g,s} \rangle \phi^{g}_{v} + L_{v}^{2} \left\langle {\theta_{v}}^{2} \right\rangle\left. \left\langle \left(\sum_{h=1}^{G} \phi^{h}_{v} \gamma_{h,s}\right) \left(\sum_{i=1}^{G} \phi^{i}_{v} \gamma_{i,s}\right) \right\rangle\right) \right) $$ \end{document}</tex-math><mml:math id="M122"><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mo>〈</mml:mo><mml:mi>τ</mml:mi><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="("><mml:mrow><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:munderover><mml:mn>2</mml:mn><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mfenced close=")"><mml:mrow><mml:mfenced close="〉" open="〈"><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="13059_2021_2419_Article_Equf.gif" position="anchor"/></alternatives></disp-formula> This becomes: 
<disp-formula id="Equg"><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{aligned} - \frac{\langle \tau \rangle}{2} \Bigg(\sum_{v=1}^{V} \sum_{s=1}^{S} \Big[ -2 x_{v,s} \langle \theta_{v} \rangle L_{v} \langle \gamma_{g,s} \rangle \phi^{g}_{v} + 2 L_{v}^ 2 \left\langle {\theta_{v}}^{2} \right\rangle \sum_{h \neq g }^{G} \left\langle \phi^{h}_{v} \right\rangle \langle \gamma_{h,s} \rangle \langle \gamma_{g,s} \rangle \phi^{g}_{v} \\ + L_{v}^{2} \left\langle {\theta_{v}}^{2} \right\rangle \left\langle \gamma_{g,s}^{2} \right\rangle \left(\phi^{g}_{v}\right)^{2} \Big] \Bigg) \end{aligned} $$ \end{document}</tex-math><mml:math id="M124"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mo>〈</mml:mo><mml:mi>τ</mml:mi><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mstyle mathsize="2.45em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:munderover><mml:mstyle mathsize="1.61em"><mml:mfenced open="["><mml:mrow/></mml:mfenced></mml:mstyle><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:msubsup><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>≠</mml:mo><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mstyle mathsize="1.61em"><mml:mfenced open="]"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mstyle mathsize="2.45em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="13059_2021_2419_Article_Equg.gif" position="anchor"/></alternatives></disp-formula> Which can be reorganised to: 
<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M125">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \ln q_{g}^{*}\left(\left\{ \eta^{g}_{v,u} \right\}_{u,v \in A}\right) = \ln \left(\prod_{v=1}^{V} \delta_{\phi^{g+}_{v}, \phi^{g-}_{v}} \delta_{\phi^{g-}_{s},1} \delta_{\phi^{g+}_{t},1} \right) + \sum_{v=1}^{V} c_{1,v} \phi^{g}_{v} + \sum_{v=1}^{V} c_{2,v} \left(\phi^{g}_{v}\right)^{2}   $$ \end{document}</tex-math><mml:math id="M126"><mml:mo>ln</mml:mo><mml:munderover><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:munderover><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mfenced close="}" open="{"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>∈</mml:mo><mml:mi>A</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mo>ln</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:munderover><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:munderover><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo></mml:mrow></mml:munderover><mml:mo>,</mml:mo><mml:munderover><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>−</mml:mo></mml:mrow></mml:munderover></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:munderover><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>−</mml:mo></mml:mrow></mml:munderover><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:munderover><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo></mml:mrow></mml:munderover><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:munderover><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:munderover><mml:mo>+</mml:mo><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:munderover><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:munderover></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Where: 
<disp-formula id="Equh"><alternatives><tex-math id="M127">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{@{}rcl@{}} c_{1,v} &amp; = &amp; - \frac{\langle \tau \rangle}{2} \sum_{s=1}^{S} \left [ -2 x_{v,s} \langle \theta_{v} \rangle L_{v} \langle \gamma_{g,s} \rangle + 2 L_{v}^ 2 \left\langle {\theta_{v}}^{2} \right\rangle \sum_{h \neq g }^{G} \left\langle \phi^{h}_{v} \right\rangle \langle \gamma_{h,s} \rangle \langle \gamma_{g,s} \rangle \right ] \\ c_{2,v} &amp; = &amp; - \frac{\langle \tau \rangle}{2} L_{v}^{2} \left\langle {\theta_{v}}^{2} \right\rangle \left\langle \gamma_{g,s}^{2} \right\rangle \end{array} $$ \end{document}</tex-math><mml:math id="M128"><mml:mtable class="eqnarray" columnalign="left center right"><mml:mtr><mml:mtd class="eqnarray-1"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd class="eqnarray-2"><mml:mo>=</mml:mo></mml:mtd><mml:mtd class="eqnarray-3"><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mo>〈</mml:mo><mml:mi>τ</mml:mi><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:munderover><mml:mfenced close="]" open="["><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:msubsup><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>≠</mml:mo><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo></mml:mrow></mml:mfenced></mml:mtd><mml:mtd><mml:mtext/></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="eqnarray-1"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd class="eqnarray-2"><mml:mo>=</mml:mo></mml:mtd><mml:mtd class="eqnarray-3"><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mo>〈</mml:mo><mml:mi>τ</mml:mi><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msubsup><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mtd><mml:mtd><mml:mtext/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2419_Article_Equh.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>It is apparent from Eq. <xref rid="Equ9" ref-type="">9</xref> that the <inline-formula id="IEq48"><alternatives><tex-math id="M129">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$q_{g}^{*}\left (\left \{ \eta ^{g}_{v,u} \right \}_{u,v \in A}\right)$\end{document}</tex-math><mml:math id="M130"><mml:msubsup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mfenced close="}" open="{"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>∈</mml:mo><mml:mi>A</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq48.gif"/></alternatives></inline-formula> takes the form of a multivariate discrete distribution with |<italic>u</italic>,<italic>v</italic>∈<italic>A</italic>| dimensions. The first term in Eq. <xref rid="Equ9" ref-type="">9</xref> enforces the flow constraints, and does not separate across nodes, the next two terms are effectively coefficients on the total flow through a unitig and its square. The updates for the other variables below, depend on the expected values of the total flow through each of the unitig nodes for the strain <italic>g</italic>, <inline-formula id="IEq49"><alternatives><tex-math id="M131">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\left \langle \phi ^{g}_{v} \right \rangle $\end{document}</tex-math><mml:math id="M132"><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq49.gif"/></alternatives></inline-formula>, which themselves depend on the <inline-formula id="IEq50"><alternatives><tex-math id="M133">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\eta ^{g}_{v,u}$\end{document}</tex-math><mml:math id="M134"><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq50.gif"/></alternatives></inline-formula>. These expected values can be efficiently obtained for all <italic>v</italic> by representing Eq. <xref rid="Equ9" ref-type="">9</xref> as a factor graph comprising nodes consisting of factors corresponding to both the constraints and the flow probabilities through each node with variables <inline-formula id="IEq51"><alternatives><tex-math id="M135">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\eta ^{g}_{v,u}$\end{document}</tex-math><mml:math id="M136"><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq51.gif"/></alternatives></inline-formula>. We can then find the marginal probabilities for both the <inline-formula id="IEq52"><alternatives><tex-math id="M137">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\eta ^{g}_{v,u}$\end{document}</tex-math><mml:math id="M138"><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq52.gif"/></alternatives></inline-formula> and the <inline-formula id="IEq53"><alternatives><tex-math id="M139">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\phi ^{g}_{v}$\end{document}</tex-math><mml:math id="M140"><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq53.gif"/></alternatives></inline-formula> using the Junction Tree algorithm [<xref ref-type="bibr" rid="CR48">48</xref>], from these we can calculate the required expectations.</p>
        <p>Next we consider the mean field update for the <italic>γ</italic><sub><italic>g</italic>,<italic>s</italic></sub>: 
<disp-formula id="Equi"><alternatives><tex-math id="M141">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \ln q^{*}(\gamma_{g,s}) &amp; = \left\langle \ln P \right\rangle_{-\gamma_{g,s}} \\ &amp; = - \left\langle \sum_{v=1}^{V} \frac{\tau}{2}\left(x_{v,s} - \theta_{v} L_{v}\left[\sum_{h=1}^{G} \phi^{h}_{v} \gamma_{h,s}\right] \right)^{2} \right\rangle_{-\gamma_{g,s}} - \langle\lambda_{g}\rangle \gamma_{g,s} \end{array} $$ \end{document}</tex-math><mml:math id="M142"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:mo>ln</mml:mo><mml:msup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msup><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mtd><mml:mtd class="align-2"><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mfenced close="〉" open="〈"><mml:mrow><mml:mo>ln</mml:mo><mml:mi>P</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="align-1"/><mml:mtd class="align-2"><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mfenced close="〉" open="〈"><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2419_Article_Equi.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>
          <disp-formula id="Equj">
            <alternatives>
              <tex-math id="M143">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \ln q^{*}(\gamma_{g,s}) &amp; = \\ &amp; - \frac{\langle \tau \rangle }{2} \Bigg (\sum_{v=1}^{V} -2 x_{v,s} \langle \theta_{v} \rangle L_{v} \left\langle \phi^{g}_{v} \right\rangle \gamma_{g,s} + 2 \left\langle \theta_{v}^{2} \right\rangle L_{v}^{2} \gamma_{g,s} \left\langle \phi_{v}^{g} \right\rangle \sum_{h \neq g} \langle \gamma_{h,s} \rangle \left\langle \phi^{h}_{v} \right\rangle \\ &amp; + \left\langle \theta_{v}^{2} \right\rangle L_{v}^{2} \gamma_{g,s}^{2} \left\langle \left[\phi^{g}_{v}\right]^{2} \right\rangle \Bigg) \\ &amp; - \langle\lambda_{g}\rangle \gamma_{g,s} \end{array} $$ \end{document}</tex-math>
              <mml:math id="M144">
                <mml:mtable class="align" columnalign="left">
                  <mml:mtr>
                    <mml:mtd class="align-1">
                      <mml:mo>ln</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mi>q</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>∗</mml:mo>
                        </mml:mrow>
                      </mml:msup>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>γ</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>g</mml:mi>
                          <mml:mo>,</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mtd>
                    <mml:mtd class="align-2">
                      <mml:mo>=</mml:mo>
                      <mml:mspace width="2em"/>
                    </mml:mtd>
                    <mml:mtd>
                      <mml:mspace width="2em"/>
                    </mml:mtd>
                  </mml:mtr>
                  <mml:mtr>
                    <mml:mtd class="align-1"/>
                    <mml:mtd class="align-2">
                      <mml:mo>−</mml:mo>
                      <mml:mfrac>
                        <mml:mrow>
                          <mml:mo>〈</mml:mo>
                          <mml:mi>τ</mml:mi>
                          <mml:mo>〉</mml:mo>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mn>2</mml:mn>
                        </mml:mrow>
                      </mml:mfrac>
                      <mml:mstyle mathsize="2.45em">
                        <mml:mfenced open="(">
                          <mml:mrow/>
                        </mml:mfenced>
                      </mml:mstyle>
                      <mml:munderover accent="false" accentunder="false">
                        <mml:mrow>
                          <mml:mo mathsize="big">∑</mml:mo>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>v</mml:mi>
                          <mml:mo>=</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>V</mml:mi>
                        </mml:mrow>
                      </mml:munderover>
                      <mml:mo>−</mml:mo>
                      <mml:mn>2</mml:mn>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>x</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>v</mml:mi>
                          <mml:mo>,</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>〈</mml:mo>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>θ</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>v</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>〉</mml:mo>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>L</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>v</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mfenced close="〉" open="〈">
                        <mml:mrow>
                          <mml:msubsup>
                            <mml:mrow>
                              <mml:mi>ϕ</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mi>v</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mi>g</mml:mi>
                            </mml:mrow>
                          </mml:msubsup>
                        </mml:mrow>
                      </mml:mfenced>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>γ</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>g</mml:mi>
                          <mml:mo>,</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>+</mml:mo>
                      <mml:mn>2</mml:mn>
                      <mml:mfenced close="〉" open="〈">
                        <mml:mrow>
                          <mml:msubsup>
                            <mml:mrow>
                              <mml:mi>θ</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mi>v</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mn>2</mml:mn>
                            </mml:mrow>
                          </mml:msubsup>
                        </mml:mrow>
                      </mml:mfenced>
                      <mml:msubsup>
                        <mml:mrow>
                          <mml:mi>L</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>v</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mn>2</mml:mn>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>γ</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>g</mml:mi>
                          <mml:mo>,</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mfenced close="〉" open="〈">
                        <mml:mrow>
                          <mml:msubsup>
                            <mml:mrow>
                              <mml:mi>ϕ</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mi>v</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mi>g</mml:mi>
                            </mml:mrow>
                          </mml:msubsup>
                        </mml:mrow>
                      </mml:mfenced>
                      <mml:munder>
                        <mml:mrow>
                          <mml:mo mathsize="big">∑</mml:mo>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>h</mml:mi>
                          <mml:mo>≠</mml:mo>
                          <mml:mi>g</mml:mi>
                        </mml:mrow>
                      </mml:munder>
                      <mml:mo>〈</mml:mo>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>γ</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>h</mml:mi>
                          <mml:mo>,</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>〉</mml:mo>
                      <mml:mfenced close="〉" open="〈">
                        <mml:mrow>
                          <mml:msubsup>
                            <mml:mrow>
                              <mml:mi>ϕ</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mi>v</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mi>h</mml:mi>
                            </mml:mrow>
                          </mml:msubsup>
                        </mml:mrow>
                      </mml:mfenced>
                      <mml:mspace width="2em"/>
                    </mml:mtd>
                    <mml:mtd>
                      <mml:mspace width="2em"/>
                    </mml:mtd>
                  </mml:mtr>
                  <mml:mtr>
                    <mml:mtd class="align-1"/>
                    <mml:mtd class="align-2">
                      <mml:mo>+</mml:mo>
                      <mml:mfenced close="〉" open="〈">
                        <mml:mrow>
                          <mml:msubsup>
                            <mml:mrow>
                              <mml:mi>θ</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mi>v</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mn>2</mml:mn>
                            </mml:mrow>
                          </mml:msubsup>
                        </mml:mrow>
                      </mml:mfenced>
                      <mml:msubsup>
                        <mml:mrow>
                          <mml:mi>L</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>v</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mn>2</mml:mn>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:msubsup>
                        <mml:mrow>
                          <mml:mi>γ</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>g</mml:mi>
                          <mml:mo>,</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mn>2</mml:mn>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mfenced close="〉" open="〈">
                        <mml:mrow>
                          <mml:msup>
                            <mml:mrow>
                              <mml:mfenced close="]" open="[">
                                <mml:mrow>
                                  <mml:msubsup>
                                    <mml:mrow>
                                      <mml:mi>ϕ</mml:mi>
                                    </mml:mrow>
                                    <mml:mrow>
                                      <mml:mi>v</mml:mi>
                                    </mml:mrow>
                                    <mml:mrow>
                                      <mml:mi>g</mml:mi>
                                    </mml:mrow>
                                  </mml:msubsup>
                                </mml:mrow>
                              </mml:mfenced>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mn>2</mml:mn>
                            </mml:mrow>
                          </mml:msup>
                        </mml:mrow>
                      </mml:mfenced>
                      <mml:mstyle mathsize="2.45em">
                        <mml:mfenced open=")">
                          <mml:mrow/>
                        </mml:mfenced>
                      </mml:mstyle>
                      <mml:mspace width="2em"/>
                    </mml:mtd>
                    <mml:mtd>
                      <mml:mspace width="2em"/>
                    </mml:mtd>
                  </mml:mtr>
                  <mml:mtr>
                    <mml:mtd class="align-1"/>
                    <mml:mtd class="align-2">
                      <mml:mo>−</mml:mo>
                      <mml:mo>〈</mml:mo>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>λ</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>g</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>〉</mml:mo>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>γ</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>g</mml:mi>
                          <mml:mo>,</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mspace width="2em"/>
                    </mml:mtd>
                    <mml:mtd>
                      <mml:mspace width="2em"/>
                    </mml:mtd>
                  </mml:mtr>
                </mml:mtable>
              </mml:math>
              <graphic xlink:href="13059_2021_2419_Article_Equj.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p>with the restriction <italic>γ</italic><sub><italic>g</italic>,<italic>s</italic></sub>&gt;0 this gives a normal distribution but truncated to (0, inf) for <italic>γ</italic><sub><italic>g</italic>,<italic>s</italic></sub>, with mean and precision: 
<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M145">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \mu_{g,s} &amp; = \frac{\sum_{v} x_{v,s} \theta_{v} L_{v} \left\langle \phi_{v}^{g} \right\rangle - \left\langle \phi_{v}^{g} \right\rangle \sum_{h \neq g} \langle \gamma_{h,s} \rangle \left\langle \phi^{h}_{v}\right\rangle \left\langle \theta_{v}^{2} \right\rangle L_{v}^{2}}{\sum_{v} L_{v}^{2} \left\langle \left[\phi^{g}_{v}\right]^{2} \right\rangle} - \frac{\langle\lambda_{g}\rangle}{\tau_{g,s} } \end{array} $$ \end{document}</tex-math><mml:math id="M146"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd class="align-2"><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>≠</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:munder><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:msubsup><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:munder><mml:msubsup><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msup><mml:mrow><mml:mfenced close="]" open="["><mml:mrow><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>
          <disp-formula id="Equ11">
            <label>11</label>
            <alternatives>
              <tex-math id="M147">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \tau_{g,s} &amp; = \langle \tau \rangle \sum_{v} L_{v}^{2} \left\langle \left[\phi^{g}_{v}\right]^{2} \right\rangle  \end{array} $$ \end{document}</tex-math>
              <mml:math id="M148">
                <mml:mtable class="align" columnalign="left">
                  <mml:mtr>
                    <mml:mtd class="align-1">
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>τ</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>g</mml:mi>
                          <mml:mo>,</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                    </mml:mtd>
                    <mml:mtd class="align-2">
                      <mml:mo>=</mml:mo>
                      <mml:mo>〈</mml:mo>
                      <mml:mi>τ</mml:mi>
                      <mml:mo>〉</mml:mo>
                      <mml:munder>
                        <mml:mrow>
                          <mml:mo mathsize="big">∑</mml:mo>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>v</mml:mi>
                        </mml:mrow>
                      </mml:munder>
                      <mml:msubsup>
                        <mml:mrow>
                          <mml:mi>L</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>v</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mn>2</mml:mn>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mfenced close="〉" open="〈">
                        <mml:mrow>
                          <mml:msup>
                            <mml:mrow>
                              <mml:mfenced close="]" open="[">
                                <mml:mrow>
                                  <mml:msubsup>
                                    <mml:mrow>
                                      <mml:mi>ϕ</mml:mi>
                                    </mml:mrow>
                                    <mml:mrow>
                                      <mml:mi>v</mml:mi>
                                    </mml:mrow>
                                    <mml:mrow>
                                      <mml:mi>g</mml:mi>
                                    </mml:mrow>
                                  </mml:msubsup>
                                </mml:mrow>
                              </mml:mfenced>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mn>2</mml:mn>
                            </mml:mrow>
                          </mml:msup>
                        </mml:mrow>
                      </mml:mfenced>
                      <mml:mspace width="2em"/>
                    </mml:mtd>
                  </mml:mtr>
                </mml:mtable>
              </mml:math>
              <graphic xlink:href="13059_2021_2419_Article_Equ11.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p>Derivations for the other updates follow similarly giving a Gamma posterior for the <italic>τ</italic> with parameter updates: 
<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M149">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \alpha_{\tau} &amp; = \alpha_{0} + \Omega/2 \end{array} $$ \end{document}</tex-math><mml:math id="M150"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd class="align-2"><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>Ω</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>
          <disp-formula id="Equ13">
            <label>13</label>
            <alternatives>
              <tex-math id="M151">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \beta_{\tau} &amp; = \beta_{0} + \sum_{v,s} \left\langle (x_{v,s} - \lambda_{v,s})^{2}\right\rangle \end{array} $$ \end{document}</tex-math>
              <mml:math id="M152">
                <mml:mtable class="align" columnalign="left">
                  <mml:mtr>
                    <mml:mtd class="align-1">
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>β</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>τ</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                    </mml:mtd>
                    <mml:mtd class="align-2">
                      <mml:mo>=</mml:mo>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>β</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>+</mml:mo>
                      <mml:munder>
                        <mml:mrow>
                          <mml:mo mathsize="big">∑</mml:mo>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>v</mml:mi>
                          <mml:mo>,</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                      </mml:munder>
                      <mml:mfenced close="〉" open="〈">
                        <mml:mrow>
                          <mml:msup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>x</mml:mi>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mi>v</mml:mi>
                                  <mml:mo>,</mml:mo>
                                  <mml:mi>s</mml:mi>
                                </mml:mrow>
                              </mml:msub>
                              <mml:mo>−</mml:mo>
                              <mml:msub>
                                <mml:mrow>
                                  <mml:mi>λ</mml:mi>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mi>v</mml:mi>
                                  <mml:mo>,</mml:mo>
                                  <mml:mi>s</mml:mi>
                                </mml:mrow>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mn>2</mml:mn>
                            </mml:mrow>
                          </mml:msup>
                        </mml:mrow>
                      </mml:mfenced>
                      <mml:mspace width="2em"/>
                    </mml:mtd>
                  </mml:mtr>
                </mml:mtable>
              </mml:math>
              <graphic xlink:href="13059_2021_2419_Article_Equ13.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p>where <italic>Ω</italic>=<italic>V</italic><italic>S</italic> and we have used <italic>λ</italic><sub><italic>v</italic>,<italic>s</italic></sub> as a short hand for the predicted count number: 
<disp-formula id="Equk"><alternatives><tex-math id="M153">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\lambda_{v,s} = \theta_{v} \sum_{g} \gamma_{g,s} \phi_{v}^{g}. $$ \end{document}</tex-math><mml:math id="M154"><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup><mml:mi>.</mml:mi></mml:mrow></mml:math><graphic xlink:href="13059_2021_2419_Article_Equk.gif" position="anchor"/></alternatives></disp-formula> Then the <italic>τ</italic> have the following expectations and log expectations: 
<disp-formula id="Equ14"><label>14</label><alternatives><tex-math id="M155">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \langle \tau_{v,s}\rangle &amp; = \alpha_{\tau}/\beta_{\tau} \end{array} $$ \end{document}</tex-math><mml:math id="M156"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo></mml:mtd><mml:mtd class="align-2"><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msub><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>
          <disp-formula id="Equ15">
            <label>15</label>
            <alternatives>
              <tex-math id="M157">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \langle \log \tau_{v,s}\rangle &amp; = \psi\left(\alpha_{\tau} + 1/2\right) - \log\left(\beta_{\tau}\right)  \end{array} $$ \end{document}</tex-math>
              <mml:math id="M158">
                <mml:mtable class="align" columnalign="left">
                  <mml:mtr>
                    <mml:mtd class="align-1">
                      <mml:mo>〈</mml:mo>
                      <mml:mo>log</mml:mo>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>τ</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>v</mml:mi>
                          <mml:mo>,</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>〉</mml:mo>
                    </mml:mtd>
                    <mml:mtd class="align-2">
                      <mml:mo>=</mml:mo>
                      <mml:mi>ψ</mml:mi>
                      <mml:mfenced close=")" open="(">
                        <mml:mrow>
                          <mml:msub>
                            <mml:mrow>
                              <mml:mi>α</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mi>τ</mml:mi>
                            </mml:mrow>
                          </mml:msub>
                          <mml:mo>+</mml:mo>
                          <mml:mn>1</mml:mn>
                          <mml:mo>/</mml:mo>
                          <mml:mn>2</mml:mn>
                        </mml:mrow>
                      </mml:mfenced>
                      <mml:mo>−</mml:mo>
                      <mml:mo>log</mml:mo>
                      <mml:mfenced close=")" open="(">
                        <mml:mrow>
                          <mml:msub>
                            <mml:mrow>
                              <mml:mi>β</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mi>τ</mml:mi>
                            </mml:mrow>
                          </mml:msub>
                        </mml:mrow>
                      </mml:mfenced>
                      <mml:mspace width="2em"/>
                    </mml:mtd>
                  </mml:mtr>
                </mml:mtable>
              </mml:math>
              <graphic xlink:href="13059_2021_2419_Article_Equ15.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p>where <italic>ψ</italic> is the digamma function. The biases <italic>θ</italic><sub><italic>v</italic></sub> have a truncated normal distribution and their updates can be derived similar to the above.</p>
      </sec>
      <sec id="Sec23">
        <title>Evidence lower bound (ELBO)</title>
        <p>Iterating the CAVI updates defined above will generate a variational approximation that is optimal in the sense of maximising the evidence lower bound (ELBO) so called because it bounds the log evidence, <italic>l</italic><italic>o</italic><italic>g</italic>(<italic>p</italic>(<italic>x</italic>))≥<italic>E</italic><italic>L</italic><italic>B</italic><italic>O</italic>(<italic>q</italic>(<italic>z</italic>)). It is useful to calculate the ELBO whist performing CAVI updates to verify convergence and the ELBO itself is sometimes used as a Bayesian measure of model fit, although as a bound that may be controversial [<xref ref-type="bibr" rid="CR7">7</xref>]. The ELBO can be calculated from the relationship: 
<disp-formula id="Equ16"><label>16</label><alternatives><tex-math id="M159">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ ELBO(q) = \mathbb{E} \left[ \log p(x|z) \right] + \mathbb{E} \left[ \log p(z) \right] - \mathbb{E} \left[ \log q(z)\right]  $$ \end{document}</tex-math><mml:math id="M160"><mml:mtext mathvariant="italic">ELBO</mml:mtext><mml:mo>(</mml:mo><mml:mi>q</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mo>log</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>|</mml:mo><mml:mi>z</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mo>log</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>z</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mo>log</mml:mo><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:mi>z</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ16.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>The first term is simply the expected log-likelihood of the data given the latent variables. In our case it is: 
<disp-formula id="Equ17"><label>17</label><alternatives><tex-math id="M161">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \mathbb{E} \left[ \log p(x|z) \right] = \frac{1}{2}\Omega \left (\langle \log \tau \rangle - \log (2 \pi)\right) - \frac{1}{2} \langle \tau \rangle \left\langle \left(x_{v,s} - L_{v} \theta_{v} \sum_{h=1}^{G} \phi^{h}_{v} \gamma_{h,s}\right)^{2}\right\rangle  $$ \end{document}</tex-math><mml:math id="M162"><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mo>log</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>|</mml:mo><mml:mi>z</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mi>Ω</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mo>〈</mml:mo><mml:mo>log</mml:mo><mml:mi>τ</mml:mi><mml:mo>〉</mml:mo><mml:mo>−</mml:mo><mml:mo>log</mml:mo><mml:mo>(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mo>〈</mml:mo><mml:mi>τ</mml:mi><mml:mo>〉</mml:mo><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:msubsup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ17.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>where <italic>Ω</italic>=<italic>V</italic><italic>S</italic> and the expectations are over the optimised distributions <italic>q</italic>.</p>
        <p>The second term is the expectation under <italic>q</italic>(<italic>z</italic>) of the log prior distributions. In our case with standard distributions it is easy to calculate for instance for each of the <italic>γ</italic><sub><italic>g</italic>,<italic>s</italic></sub>: 
<disp-formula id="Equl"><alternatives><tex-math id="M163">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $${} \mathbb{E} \left[ \log p(\gamma_{g,s}) \right ] = \frac{1}{2} \log\left(\frac{\tau_{g,s}}{2\pi}\right) - \frac{\tau_{g,s}}{2}\left(\left\langle \gamma_{g,s}^{2} \right\rangle + \mu_{g,s}^{2} - 2 \mu_{g,s} \langle \gamma_{g,s} \rangle \right) - \log \left[\frac{1}{2} \text{erf} \left(\mu_{g,s}\sqrt {\frac{\tau_{g,s}}{2}}\right) \right]. $$ \end{document}</tex-math><mml:math id="M164"><mml:mrow><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mo>log</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mo>log</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="("><mml:mrow><mml:mfenced close="〉" open="〈"><mml:mrow><mml:munderover><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:munderover></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:munderover><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:munderover><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〈</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mo>log</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mtext>erf</mml:mtext><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msqrt></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mi>.</mml:mi></mml:mrow></mml:math><graphic xlink:href="13059_2021_2419_Article_Equl.gif" position="anchor"/></alternatives></disp-formula> With the <italic>μ</italic><sub><italic>g</italic>,<italic>s</italic></sub> and <italic>τ</italic><sub><italic>g</italic>,<italic>s</italic></sub> given by their current values derived from Eq. <xref rid="Equ11" ref-type="">11</xref> and the moments of <italic>γ</italic><sub><italic>g</italic>,<italic>s</italic></sub> calculated from a truncated normal distribution with those current parameters. The third terms are simply the negative entropy of the variational approximations and for the standard distributions used here are easily calculated.</p>
      </sec>
      <sec id="Sec24">
        <title>Implementation details</title>
        <p>One update of the algorithm consists of updating each variable or sets of variables in turn given the current optimal solutions of the other distributions. In practice we update: 
<list list-type="bullet"><list-item><p>Compute the marginal flows <inline-formula id="IEq54"><alternatives><tex-math id="M165">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\left \{ \eta ^{g}_{v,u} \right \}_{u,v \in A}$\end{document}</tex-math><mml:math id="M166"><mml:msub><mml:mrow><mml:mfenced close="}" open="{"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>∈</mml:mo><mml:mi>A</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq54.gif"/></alternatives></inline-formula> for each strain <italic>g</italic>=1,…,<italic>G</italic> in turn using Eq. <xref rid="Equ9" ref-type="">9</xref> and the Junction Tree algorithm. This can be performed for each single copy-core gene independently</p></list-item><list-item><p>Update the truncated normal strain abundances <italic>q</italic>(<italic>γ</italic><sub><italic>g</italic>,<italic>s</italic></sub>) for each strain in each sample, <italic>s</italic>=1,…,<italic>S</italic> using Eq. <xref rid="Equ11" ref-type="">11</xref></p></list-item><list-item><p>Update the <italic>q</italic>(<italic>τ</italic>)</p></list-item><list-item><p>Update the ARD parameter distributions <italic>q</italic>(<italic>λ</italic><sub><italic>g</italic></sub>) if used</p></list-item><list-item><p>Update the nodes biases <italic>q</italic>(<italic>θ</italic><sub><italic>v</italic></sub>)</p></list-item><list-item><p>Check for redundant or low abundance strains and remove (see below)</p></list-item></list></p>
        <p>After a maximum fixed number of iterations or if the ELBO converges we stop iterating. Variational inference can be sensitive to initial conditions as it can only find local maxima of the ELBO, we therefore use a previously published variational Bayesian version of non-negative matrix factorisation [<xref ref-type="bibr" rid="CR8">8</xref>], to find an initial approximate solution.</p>
      </sec>
      <sec id="Sec25">
        <title>Empirical modelling of node variances</title>
        <p>For low-coverage MAGs a precision that is identical for all nodes performs satisfactorily, but since the true distribution of read counts is Poisson this overestimates the precision for nodes with high counts <italic>x</italic><sub><italic>v</italic>,<italic>s</italic></sub>. To address we developed an empirical procedure where we first calculate 〈log<italic>τ</italic><sub><italic>v</italic>,<italic>s</italic></sub>〉 for each node using Eq. <xref rid="Equ15" ref-type="">15</xref> as: 
<disp-formula id="Equ18"><label>18</label><alternatives><tex-math id="M167">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \langle \log \tau_{v,s}\rangle = \psi\left(\alpha_{0} + 1/2\right) - \log\left(\beta_{0} X_{v,s} +\frac{1}{2} \left\langle (x_{v,s} - \lambda_{v,s})^{2} \right\rangle \right)  $$ \end{document}</tex-math><mml:math id="M168"><mml:mo>〈</mml:mo><mml:mo>log</mml:mo><mml:msub><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:mo>=</mml:mo><mml:mi>ψ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mo>log</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ18.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>a quantity which exhibits high variability, so we then smooth this over log(<italic>x</italic><sub><italic>v</italic>,<italic>s</italic></sub>) using generalised additive models as implemented in pyGAM [<xref ref-type="bibr" rid="CR43">43</xref>] to give 〈log<italic>τ</italic><sub><italic>v</italic>,<italic>s</italic></sub>〉<sup>∗</sup>. The term <italic>β</italic><sub>0</sub><italic>X</italic><sub><italic>v</italic>,<italic>s</italic></sub> gives a prior which is effectively Poisson. We then obtain 〈<italic>τ</italic><sub><italic>v</italic>,<italic>s</italic></sub>〉 as exp(〈log<italic>τ</italic><sub><italic>v</italic>,<italic>s</italic></sub>〉<sup>∗</sup>). This procedure has no theoretical justification but gives good results in practice. This approach of modelling a non-Gaussian distribution as a Gaussian with empirical variances is similar to that used in voom for RNASeq [<xref ref-type="bibr" rid="CR27">27</xref>].</p>
      </sec>
      <sec id="Sec26">
        <title>Cross-validation to determine optimum number of strains</title>
        <p>The ARD procedure usually converges on the correct number of strains except for high-coverage MAGs where overfitting may occur and too many strains can be predicted. We therefore additionally implemented a cross-validation procedure, splitting the entire data matrix <italic>x</italic><sub><italic>v</italic>,<italic>s</italic></sub> into test and train folds (default ten folds) and training the model on the train fold and then testing on the held out data. The correct number of strains was then taken to be the one that maximised the log predictive posterior with an empirical variance reflecting the Poisson nature of the data. The exact test statistic being: 
<disp-formula id="Equ19"><label>19</label><alternatives><tex-math id="M169">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \sum_{v,s \in E} \frac{1}{2}\log\left(\tau'_{v,s}\right) - \frac{1}{2}\sum_{v,s \in E} \tau'_{v,s} \left\langle {(x_{v,s} -\lambda_{v,s})}^{2}\right\rangle   $$ \end{document}</tex-math><mml:math id="M170"><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mo>log</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:munderover><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:munderover></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:munder><mml:munderover><mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:munderover><mml:mfenced close="〉" open="〈"><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ19.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>where <italic>τ</italic><italic>v</italic>,<italic>s</italic>′=1/(0.5+<italic>x</italic><sub><italic>v</italic>,<italic>s</italic></sub>) and <italic>E</italic> indicates data points in the test set to down-weight high read count nodes reflecting approximately Poisson noise.</p>
      </sec>
    </sec>
    <sec id="Sec27">
      <title>Nanopore sequence analysis</title>
      <sec id="Sec28">
        <title>Sequence preprocessing</title>
        <p>To enable a qualitative comparison between haplotypes obtained from the Nanopore reads and the BayesPaths predictions we developed the following pipeline applied at the level of individual single-copy core genes (SCGs) from MAGs: 
<list list-type="order"><list-item><p>We mapped all reads using minimap2 [<xref ref-type="bibr" rid="CR30">30</xref>] against the SCG contig consensus ORF sequence and selected those reads with alignments that spanned at least one third of the gene with a nucleotide identity &gt;80%.</p></list-item><list-item><p>We then extracted the aligned portion of each read, reverse complementing if necessary, so that all reads ran in the same direction as the SCG ORF.</p></list-item><list-item><p>We then obtained the variant positions on the consensus from the output of the DESMAN pipeline [<xref ref-type="bibr" rid="CR39">39</xref>]. These are variant positions prior to haplotype calling representing the total unlinked variation observed in the short reads.</p></list-item><list-item><p>For each Nanopore fragment we aligned against the SCG ORF using a Needleman-Wunsch global alignment and generated a condensed read comprising bases only from the short read variant positions.</p></list-item></list></p>
        <p>This provided us with a reduced representation of each Nanopore read effectively filtering variation that was not observed in the short reads. These reduced representations were then used to calculate distances, defined as Hamming distances on the variant positions normalised by number of positions observed, both between the reads and between the reads and the predicted COG sequences from BayesPaths. From these we generated NMDS plots indicating sequence diversity, and they provided an input to the hybrid Nanopore strain resolution algorithm below.</p>
      </sec>
      <sec id="Sec29">
        <title>EM algorithm for hybrid Nanopore strain resolution</title>
        <p>We also developed a simple EM algorithm for direct prediction of paths and their abundances on the short read assembly graph that are consistent with a set of observed long reads. We began by mapping the set of <italic>n</italic>=1,…,<italic>N</italic> Nanopore sequences denoted <inline-formula id="IEq55"><alternatives><tex-math id="M171">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$ \{ \mathcal {S}_{n} \}$\end{document}</tex-math><mml:math id="M172"><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">S</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq55.gif"/></alternatives></inline-formula> onto the corresponding simplified SCG graph generated by STRONG using GraphAligner [<xref ref-type="bibr" rid="CR40">40</xref>]. This provided us with <italic>N</italic> optimal alignment paths as walks in our SCG graph. We denote this graph <inline-formula id="IEq56"><alternatives><tex-math id="M173">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {G}$\end{document}</tex-math><mml:math id="M174"><mml:mi mathvariant="script">G</mml:mi></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq56.gif"/></alternatives></inline-formula> comprising unitig vertices <italic>v</italic> and edges <italic>e</italic>∈{<italic>u</italic>,<italic>v</italic>} defining overlaps.</p>
        <p>We assume, as is almost always the case that the graphs contain no unitigs in both forward and reverse configurations, and that there are no cycles, so that each SCG is a directed acyclic graph (DAG) with one copy of each unitig, and we only need to track the direction that each overlap enters and leaves each unitig. Then best alignment walks comprise a sequence of edges, <inline-formula id="IEq57"><alternatives><tex-math id="M175">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$e^{n}_{1},\dots, e^{n}_{W_{n}}$\end{document}</tex-math><mml:math id="M176"><mml:msubsup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq57.gif"/></alternatives></inline-formula> where <italic>W</italic><sub><italic>n</italic></sub> is the number of edges in the walk of read <italic>n</italic>, that traverse the graph.</p>
        <p>Given these observed Nanopore reads we aim to reconstruct <italic>G</italic> haplotypes comprising paths from a dummy source node <italic>s</italic>, which has outgoing edges to all the true source nodes in the graph, through the graph to a dummy sink <italic>t</italic>, which connects all the true sinks. We further assume that each haplotype has relative frequency <italic>π</italic><sub><italic>g</italic></sub>. Each such haplotype path <inline-formula id="IEq58"><alternatives><tex-math id="M177">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {P}_{g} = \left \{s,e^{g}_{1},\ldots, e^{g}_{W_{g}}, t \right \}$\end{document}</tex-math><mml:math id="M178"><mml:msub><mml:mrow><mml:mi mathvariant="script">P</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfenced close="}" open="{"><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq58.gif"/></alternatives></inline-formula> will translate into a nucleotide sequence <inline-formula id="IEq59"><alternatives><tex-math id="M179">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {T}_{g}$\end{document}</tex-math><mml:math id="M180"><mml:msub><mml:mrow><mml:mi mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq59.gif"/></alternatives></inline-formula>. We assume that these haplotypes generate Nanopore reads with a fixed error rate <italic>ε</italic> which gives a likelihood: 
<disp-formula id="Equ20"><label>20</label><alternatives><tex-math id="M181">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P(\{ \mathcal{S}_{1},\ldots, \mathcal{S}_{N} \} | \pi, \{ \mathcal{T}_{1},\ldots, \mathcal{T}_{G} \}) = \prod_{n=1}^{N} \left(\sum_{g=1}^{G} \pi_{g} \epsilon^{m_{n,g}} (1 - \epsilon)^{M_{n,g}} \right).  $$ \end{document}</tex-math><mml:math id="M182"><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">S</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">S</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo><mml:mo>|</mml:mo><mml:mi>π</mml:mi><mml:mo>,</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mfenced close=")" open="("><mml:mrow><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ε</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ20.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>where <italic>m</italic><sub><italic>n</italic>,<italic>g</italic></sub> is the number of basepair mismatches between <inline-formula id="IEq60"><alternatives><tex-math id="M183">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {S}_{n}$\end{document}</tex-math><mml:math id="M184"><mml:msub><mml:mrow><mml:mi mathvariant="script">S</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq60.gif"/></alternatives></inline-formula> and <inline-formula id="IEq61"><alternatives><tex-math id="M185">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathcal {T}_{g}$\end{document}</tex-math><mml:math id="M186"><mml:msub><mml:mrow><mml:mi mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq61.gif"/></alternatives></inline-formula> counting insertions, deletions and substitutions equally and <italic>M</italic><sub><italic>n</italic>,<italic>g</italic></sub> the number of matches.</p>
        <p>To maximise this likelihood we used an Expectation-Maximisation algorithm. Iterating the following steps until convergence: 
<list list-type="order"><list-item><p>E-step: Calculate the responsibility of each haplotype for each sequence as: 
<disp-formula id="Equ21"><label>21</label><alternatives><tex-math id="M187">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ z_{n,g} = \frac{ \pi_{g} \epsilon^{m_{n,g}} (1 - \epsilon)^{M_{n,g}}}{\sum_{h} \pi_{h} \epsilon^{m_{n,h}} (1 - \epsilon)^{M_{n,h}}}  $$ \end{document}</tex-math><mml:math id="M188"><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ε</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ε</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ21.gif" position="anchor"/></alternatives></disp-formula></p><p>Alignments of reads against haplotypes were performed using vsearch [<xref ref-type="bibr" rid="CR41">41</xref>].</p></list-item><list-item><p>M-step: We update each haplotype by finding the most likely path on the short read graph given the current expectations. These are calculated by assigning a weight <inline-formula id="IEq62"><alternatives><tex-math id="M189">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$w^{g}_{e}$\end{document}</tex-math><mml:math id="M190"><mml:msubsup><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2419_Article_IEq62.gif"/></alternatives></inline-formula> to each edge <italic>e</italic> in the graph as: 
<disp-formula id="Equ22"><label>22</label><alternatives><tex-math id="M191">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ w^{g}_{e} = \sum_{n \in e} z_{n,g} L_{e}  $$ \end{document}</tex-math><mml:math id="M192"><mml:msubsup><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>∈</mml:mo><mml:mi>e</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow></mml:msub></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ22.gif" position="anchor"/></alternatives></disp-formula></p><p>where <italic>n</italic>∈<italic>e</italic> are the set of reads whose optimal alignment contains that edge and <italic>L</italic><sub><italic>e</italic></sub> is the unique length of the unitig the edge connects to, i.e. ignoring the overlap length. We then find for haplotype <italic>g</italic> the maximal weight path through this DAG using a topological sort. The error rates are updated as: 
<disp-formula id="Equ23"><label>23</label><alternatives><tex-math id="M193">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \epsilon = \frac{\sum_{n} \sum_{g} z_{n,g} m_{n,g}}{ \sum_{n} \sum_{g} z_{n,g} L_{n,g}}  $$ \end{document}</tex-math><mml:math id="M194"><mml:mi>ε</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munder><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munder><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="13059_2021_2419_Article_Equ23.gif" position="anchor"/></alternatives></disp-formula></p><p>where <italic>L</italic><sub><italic>n</italic>,<italic>g</italic></sub> are the alignment lengths.</p></list-item></list></p>
        <p>As is often the case with EM algorithms convergence depends strongly on initial conditions. Therefore we initialise using a partitioning around medoids clustering using the distances calculated in “<xref rid="Sec10" ref-type="sec">Methods</xref> - <xref rid="Sec27" ref-type="sec">Nanopore sequence analysis</xref>” section. We can estimate the number of haplotypes from the negative log-likelihood as a function of haplotype number.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Information</title>
    <sec id="Sec30">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="13059_2021_2419_MOESM1_ESM.pdf">
            <caption>
              <p><bold>Additional file 1</bold> Supplementary tables and figures.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
      <p>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="13059_2021_2419_MOESM2_ESM.csv">
            <caption>
              <p><bold>Additional file 2</bold> Genomes used in the synthetic communities (Additional file 1: Tables S1 and S2).</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
      <p>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="13059_2021_2419_MOESM3_ESM.docx">
            <caption>
              <p><bold>Additional file 3</bold> Review history.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <ack>
    <p>We thank Tatiana Dvorkina (PhD student in SPbSU) for developing the graph-based codon finding algorithm and fruitful discussions. We also acknowledge constructive criticisms from two anonymous reviewers.</p>
    <sec id="d32e9150">
      <title>Peer review information</title>
      <p>Andrew Cosgrove was the primary editor of this article and managed its editorial process and peer review in collaboration with the rest of the editorial team.</p>
    </sec>
    <sec id="d32e9155">
      <title>Review history</title>
      <p>The review history is available as Additional file <xref rid="MOESM3" ref-type="media">3</xref>.</p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>CQ devised and coded the BayesPaths algorithm, assisted with the creation of the STRONG pipeline, analysed results and wrote the MS. SN devised and coded the graph algorithms, assisted with the creation of the STRONG pipeline, and edited the MS. SR coded the STRONG pipeline. RJ generated and processed the AD Nanopore sequence data. OSS helped devise the AD sequencing study. JKS assisted with the STRONG pipeline and edited the MS. AL contributed to the creation of the algorithms and edited the MS. AME contributed to the creation of the algorithms and assisted with figures. RC tested the STRONG pipeline, contributed to the creation of the algorithms and edited the MS. AED helped plan the STRONG pipeline, assisted the creation of the algorithms and edited the MS. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>This work for made possible through the MRC Methodology Grant ‘Strain resolved metagenomics for medical microbiology’ MR/S037195/1. CQ is also funded through MRC fellowship (MR/M50161X/1) as part of the CLoud Infrastructure for Microbial Genomics (CLIMB) consortium (MR/L015080/1). SR is funded through BBSRC ‘EBI Metagenomics - enabling the reconstruction of microbial populations’ (BB/R015171/1). OSS acknowledges funding through the BBSRC (BB/N023285/1 and BB/L502029/1). This research was supported in part by the Intramural Research Program of the National Human Genome Research Institute, National Institutes of Health (SN).</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The anaerobic digester time series have been uploaded to the ENA as part of the study PRJEB45779 [<xref ref-type="bibr" rid="CR19">19</xref>]. STRONG is freely available from <ext-link ext-link-type="uri" xlink:href="https://github.com/chrisquince/STRONG">https://github.com/chrisquince/STRONG</ext-link> under the MIT License. The BayesPaths algorithm at <ext-link ext-link-type="uri" xlink:href="https://github.com/chrisquince/BayesPaths">https://github.com/chrisquince/BayesPaths</ext-link> and code for synthetic community generation at <ext-link ext-link-type="uri" xlink:href="https://github.com/chrisquince/STRONG_Sim">https://github.com/chrisquince/STRONG_Sim</ext-link>. The code in the archived version [<xref ref-type="bibr" rid="CR34">34</xref>] was used to generate the benchmarking results in this paper.</p>
  </notes>
  <notes>
    <title>Declarations</title>
    <notes id="FPar1">
      <title>Ethics approval and consent to participate</title>
      <p>Not applicable.</p>
    </notes>
    <notes id="FPar2">
      <title>Consent for publication</title>
      <p>Not applicable.</p>
    </notes>
    <notes id="FPar3" notes-type="COI-statement">
      <title>Competing interests</title>
      <p>Aaron Darling is a cofounder of Longas Technologies Pty Ltd, a company that is developing synthetic long read sequencing technologies.</p>
    </notes>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ahn</surname>
            <given-names>T-H</given-names>
          </name>
          <name>
            <surname>Chai</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Pan</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Sigma: strain-level inference of genomes from metagenomic analysis for biosurveillance</article-title>
        <source>Bioinformatics</source>
        <year>2014</year>
        <volume>31</volume>
        <issue>2</issue>
        <fpage>170</fpage>
        <lpage>7</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btu641</pub-id>
        <?supplied-pmid 25266224?>
        <pub-id pub-id-type="pmid">25266224</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Albertsen</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Hugenholtz</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Skarshewski</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Nielsen</surname>
            <given-names>KL</given-names>
          </name>
          <name>
            <surname>Tyson</surname>
            <given-names>GW</given-names>
          </name>
          <name>
            <surname>Nielsen</surname>
            <given-names>PH</given-names>
          </name>
        </person-group>
        <article-title>Genome sequences of rare, uncultured bacteria obtained by differential coverage binning of multiple metagenomes</article-title>
        <source>Nat Biotechnol</source>
        <year>2013</year>
        <volume>31</volume>
        <fpage>533</fpage>
        <pub-id pub-id-type="doi">10.1038/nbt.2579</pub-id>
        <?supplied-pmid 23707974?>
        <pub-id pub-id-type="pmid">23707974</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Alneberg</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Bjarnason</surname>
            <given-names>BS</given-names>
          </name>
          <name>
            <surname>de Bruijn</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Schirmer</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Quick</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Ijaz</surname>
            <given-names>UZ</given-names>
          </name>
          <name>
            <surname>Lahti</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Loman</surname>
            <given-names>NJ</given-names>
          </name>
          <name>
            <surname>Andersson</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Quince</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Binning metagenomic contigs by coverage and composition</article-title>
        <source>Nat Methods</source>
        <year>2014</year>
        <volume>11</volume>
        <issue>11</issue>
        <fpage>1144</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3103</pub-id>
        <?supplied-pmid 25218180?>
        <pub-id pub-id-type="pmid">25218180</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baaijens</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Van der</surname>
            <given-names>Roest</given-names>
          </name>
          <name>
            <surname>Köster</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Stougie</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Schönhuth</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Full-length de novo viral quasispecies assembly through variation graph construction</article-title>
        <source>Bioinformatics</source>
        <year>2019</year>
        <volume>35</volume>
        <issue>24</issue>
        <fpage>5086</fpage>
        <lpage>94</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btz443</pub-id>
        <?supplied-pmid 31147688?>
        <pub-id pub-id-type="pmid">31147688</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bernard</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Jacob</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Mairal</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Vert</surname>
            <given-names>J-P</given-names>
          </name>
        </person-group>
        <article-title>Efficient RNA isoform identification and quantification from RNA-Seq data with network flows</article-title>
        <source>Bioinformatics</source>
        <year>2014</year>
        <volume>30</volume>
        <issue>17</issue>
        <fpage>2447</fpage>
        <lpage>55</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btu317</pub-id>
        <?supplied-pmid 24813214?>
        <pub-id pub-id-type="pmid">24813214</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bernard</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Jacob</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Mairal</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Viara</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Vert</surname>
            <given-names>J-P</given-names>
          </name>
        </person-group>
        <article-title>A convex formulation for joint RNA isoform detection and quantification from multiple RNA-seq samples</article-title>
        <source>BMC Bioinformatics</source>
        <year>2015</year>
        <volume>16</volume>
        <issue>1</issue>
        <fpage>262</fpage>
        <pub-id pub-id-type="doi">10.1186/s12859-015-0695-9</pub-id>
        <?supplied-pmid 26286719?>
        <pub-id pub-id-type="pmid">26286719</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Blei</surname>
            <given-names>DM</given-names>
          </name>
          <name>
            <surname>Kucukelbir</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>McAuliffe</surname>
            <given-names>JD</given-names>
          </name>
        </person-group>
        <article-title>Variational inference: a review for statisticians</article-title>
        <source>J Am Stat Assoc</source>
        <year>2017</year>
        <volume>112</volume>
        <issue>518</issue>
        <fpage>859</fpage>
        <lpage>77</lpage>
        <pub-id pub-id-type="doi">10.1080/01621459.2017.1285773</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Brouwer</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Frellsen</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Lió</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <person-group person-group-type="editor">
          <name>
            <surname>Ceci</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Hollmén</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Todorovski</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Vens</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Džeroski</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Comparative study of inference methods for bayesian nonnegative matrix factorisation</article-title>
        <source>Machine learning and knowledge discovery in databases</source>
        <year>2017</year>
        <publisher-loc>Cham</publisher-loc>
        <publisher-name>Springer International Publishing</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Brown</surname>
            <given-names>CT</given-names>
          </name>
          <name>
            <surname>Hug</surname>
            <given-names>LA</given-names>
          </name>
          <name>
            <surname>Thomas</surname>
            <given-names>BC</given-names>
          </name>
          <name>
            <surname>Sharon</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Castelle</surname>
            <given-names>CJ</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wilkins</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Wrighton</surname>
            <given-names>KC</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>KH</given-names>
          </name>
          <name>
            <surname>Banfield</surname>
            <given-names>JF</given-names>
          </name>
        </person-group>
        <article-title>Unusual biology across a group comprising more than 15% of domain bacteria</article-title>
        <source>Nature</source>
        <year>2015</year>
        <volume>523</volume>
        <fpage>208</fpage>
        <pub-id pub-id-type="doi">10.1038/nature14486</pub-id>
        <?supplied-pmid 26083755?>
        <pub-id pub-id-type="pmid">26083755</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Brown</surname>
            <given-names>CT</given-names>
          </name>
          <name>
            <surname>Moritz</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>O’Brien</surname>
            <given-names>MP</given-names>
          </name>
          <name>
            <surname>Reidl</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Reiter</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Sullivan</surname>
            <given-names>BD</given-names>
          </name>
        </person-group>
        <article-title>Exploring neighborhoods in large metagenome assembly graphs using spacegraphcats reveals hidden sequence diversity</article-title>
        <source>Genome Biol</source>
        <year>2020</year>
        <volume>21</volume>
        <issue>1</issue>
        <fpage>164</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-02066-4</pub-id>
        <?supplied-pmid 32631445?>
        <pub-id pub-id-type="pmid">32631445</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chaumeil</surname>
            <given-names>P-A</given-names>
          </name>
          <name>
            <surname>Mussig</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Hugenholtz</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Parks</surname>
            <given-names>DH</given-names>
          </name>
        </person-group>
        <article-title>GTDB-Tk: a toolkit to classify genomes with the Genome Taxonomy Database</article-title>
        <source>Bioinformatics</source>
        <year>2019</year>
        <volume>36</volume>
        <issue>6</issue>
        <fpage>1925</fpage>
        <lpage>7</lpage>
        <?supplied-pmid 7703759?>
        <pub-id pub-id-type="pmid">7703759</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Costea</surname>
            <given-names>PI</given-names>
          </name>
          <name>
            <surname>Zeller</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Sunagawa</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Pelletier</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Alberti</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Levenez</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Tramontano</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Driessen</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Hercog</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Jung</surname>
            <given-names>F-E</given-names>
          </name>
          <name>
            <surname>Kultima</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>Hayward</surname>
            <given-names>MR</given-names>
          </name>
          <name>
            <surname>Coelho</surname>
            <given-names>LP</given-names>
          </name>
          <name>
            <surname>Allen-Vercoe</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Bertrand</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Blaut</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Brown</surname>
            <given-names>JRM</given-names>
          </name>
          <name>
            <surname>Carton</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Cools-Portier</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Daigneault</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Derrien</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Druesne</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>de Vos</surname>
            <given-names>WM</given-names>
          </name>
          <name>
            <surname>Finlay</surname>
            <given-names>BB</given-names>
          </name>
          <name>
            <surname>Flint</surname>
            <given-names>HJ</given-names>
          </name>
          <name>
            <surname>Guarner</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Hattori</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Heilig</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Luna</surname>
            <given-names>RA</given-names>
          </name>
          <name>
            <surname>van Hylckama Vlieg</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Junick</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Klymiuk</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Langella</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Le Chatelier</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Mai</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Manichanh</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Martin</surname>
            <given-names>JC</given-names>
          </name>
          <name>
            <surname>Mery</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Morita</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>O’Toole</surname>
            <given-names>PW</given-names>
          </name>
          <name>
            <surname>Orvain</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Patil</surname>
            <given-names>KR</given-names>
          </name>
          <name>
            <surname>Penders</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Persson</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Pons</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Popova</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Salonen</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Saulnier</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Scott</surname>
            <given-names>KP</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Slezak</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Veiga</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Versalovic</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zhao</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Zoetendal</surname>
            <given-names>EG</given-names>
          </name>
          <name>
            <surname>Ehrlich</surname>
            <given-names>SD</given-names>
          </name>
          <name>
            <surname>Dore</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Bork</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Towards standards for human fecal sample processing in metagenomic studies</article-title>
        <source>Nat Biotechnol</source>
        <year>2017</year>
        <volume>35</volume>
        <issue>11</issue>
        <fpage>1069</fpage>
        <lpage>76</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3960</pub-id>
        <?supplied-pmid 28967887?>
        <pub-id pub-id-type="pmid">28967887</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Delmont</surname>
            <given-names>TO</given-names>
          </name>
          <name>
            <surname>Quince</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Shaiber</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Esen</surname>
            <given-names>ÖC</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>STM</given-names>
          </name>
          <name>
            <surname>Rappé</surname>
            <given-names>MS</given-names>
          </name>
          <name>
            <surname>McLellan</surname>
            <given-names>SL</given-names>
          </name>
          <name>
            <surname>Lücker</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Eren</surname>
            <given-names>AM</given-names>
          </name>
        </person-group>
        <article-title>Nitrogen-fixing populations of Planctomycetes and Proteobacteria are abundant in surface ocean metagenomes</article-title>
        <source>Nat Microbiol</source>
        <year>2018</year>
        <volume>3</volume>
        <issue>7</issue>
        <fpage>804</fpage>
        <lpage>13</lpage>
        <pub-id pub-id-type="doi">10.1038/s41564-018-0176-9</pub-id>
        <?supplied-pmid 29891866?>
        <pub-id pub-id-type="pmid">29891866</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dijkshoorn</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Ursing</surname>
            <given-names>BMÃ</given-names>
          </name>
          <name>
            <surname>Ursing</surname>
            <given-names>JB</given-names>
          </name>
        </person-group>
        <article-title>Strain, clone and species: comments on three basic concepts of bacteriology</article-title>
        <source>J Med Microbiol</source>
        <year>2000</year>
        <volume>49</volume>
        <fpage>397</fpage>
        <lpage>401</lpage>
        <pub-id pub-id-type="doi">10.1099/0022-1317-49-5-397</pub-id>
        <?supplied-pmid 10798550?>
        <pub-id pub-id-type="pmid">10798550</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dvorkina</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Bankevich</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Sorokin</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ORFograph: search for novel insecticidal protein genes in genomic and metagenomic assembly graphs</article-title>
        <source>Microbiome</source>
        <year>2021</year>
        <volume>9</volume>
        <fpage>149</fpage>
        <pub-id pub-id-type="doi">10.1186/s40168-021-01092-z</pub-id>
        <?supplied-pmid 34183047?>
        <pub-id pub-id-type="pmid">34183047</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eren</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Esen</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Quince</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Vineis</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Morrison</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Sogin</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Delmont</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>Anvi’o: an advanced analysis and visualization platform for ‘omics data</article-title>
        <source>Peer J</source>
        <year>2015</year>
        <volume>3</volume>
        <fpage>e1319</fpage>
        <pub-id pub-id-type="doi">10.7717/peerj.1319</pub-id>
        <?supplied-pmid 26500826?>
        <pub-id pub-id-type="pmid">26500826</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eren</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Kiefl</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Shaiber</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Veseli</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Miller</surname>
            <given-names>SE</given-names>
          </name>
          <name>
            <surname>Schechter</surname>
            <given-names>MS</given-names>
          </name>
          <name>
            <surname>Fink</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Pan</surname>
            <given-names>JN</given-names>
          </name>
          <name>
            <surname>Yousef</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Fogarty</surname>
            <given-names>EC</given-names>
          </name>
          <name>
            <surname>Trigodet</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Community-led, integrated, reproducible multi-omics with anvi’o</article-title>
        <source>Nat Microbiol</source>
        <year>2021</year>
        <volume>6</volume>
        <issue>1</issue>
        <fpage>3</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="doi">10.1038/s41564-020-00834-3</pub-id>
        <?supplied-pmid 33349678?>
        <pub-id pub-id-type="pmid">33349678</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lander</surname>
            <given-names>ES</given-names>
          </name>
          <name>
            <surname>Waterman</surname>
            <given-names>MS</given-names>
          </name>
        </person-group>
        <article-title>Genomic mapping by fingerprinting random clones: a mathematical analysis</article-title>
        <source>Genomics</source>
        <year>1988</year>
        <volume>2</volume>
        <fpage>231</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="doi">10.1016/0888-7543(88)90007-9</pub-id>
        <?supplied-pmid 3294162?>
        <pub-id pub-id-type="pmid">3294162</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19</label>
      <mixed-citation publication-type="other">Farrell F, James R, Raguideau S, Quince C, Soyer OS. Metagenome sequence from AD reactors used in the STRONG publication. Eur Nucleotide Arch. 2021:PRJEB45779. <ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/ena/browser/view/PRJEB45779">https://www.ebi.ac.uk/ena/browser/view/PRJEB45779</ext-link>.</mixed-citation>
    </ref>
    <ref id="CR20">
      <label>20</label>
      <mixed-citation publication-type="other">Garrison E, Marth G. arXiv e-prints, arXiv:1207.3907. 2012.</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Garrison</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Sirén</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Novak</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Hickey</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Eizenga</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Dawson</surname>
            <given-names>ET</given-names>
          </name>
          <name>
            <surname>Jones</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Garg</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Markello</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>MF</given-names>
          </name>
          <name>
            <surname>Paten</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Durbin</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Variation graph toolkit improves read mapping by representing genetic variation in the reference</article-title>
        <source>Nat Biotechnol</source>
        <year>2018</year>
        <volume>36</volume>
        <issue>9</issue>
        <fpage>875</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4227</pub-id>
        <?supplied-pmid 30125266?>
        <pub-id pub-id-type="pmid">30125266</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Hoffman</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Blei</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <person-group person-group-type="editor">
          <name>
            <surname>Lebanon</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Vishwanathan</surname>
            <given-names>SVN</given-names>
          </name>
        </person-group>
        <article-title>Stochastic structured variational inference</article-title>
        <source>Proceedings of the Eighteenth International Conference on Artificial Intelligence and Statistics, vol. 38 of Proceedings of Machine Learning Research</source>
        <year>2015</year>
        <publisher-loc>San Diego</publisher-loc>
        <publisher-name>PMLR</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huang</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Myers</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>Marth</surname>
            <given-names>GT</given-names>
          </name>
        </person-group>
        <article-title>ART: a next-generation sequencing read simulator</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>28</volume>
        <issue>4</issue>
        <fpage>593</fpage>
        <lpage>4</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr708</pub-id>
        <?supplied-pmid 22199392?>
        <pub-id pub-id-type="pmid">22199392</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kang</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Froula</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Egan</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Metabat, an efficient tool for accurately reconstructing single genomes from complex microbial communities</article-title>
        <source>Peer J</source>
        <year>2015</year>
        <volume>3</volume>
        <fpage>e1165</fpage>
        <pub-id pub-id-type="doi">10.7717/peerj.1165</pub-id>
        <?supplied-pmid 26336640?>
        <pub-id pub-id-type="pmid">26336640</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kang</surname>
            <given-names>DD</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Kirton</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Thomas</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Egan</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>An</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>MetaBAT 2: an adaptive binning algorithm for robust and efficient genome reconstruction from metagenome assemblies</article-title>
        <source>Peer J</source>
        <year>2019</year>
        <volume>7</volume>
        <fpage>e7359</fpage>
        <pub-id pub-id-type="doi">10.7717/peerj.7359</pub-id>
        <?supplied-pmid 31388474?>
        <pub-id pub-id-type="pmid">31388474</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Köster</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Rahmann</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Snakemake—a scalable bioinformatics workflow engine</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <issue>19</issue>
        <fpage>2520</fpage>
        <lpage>2</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bts480</pub-id>
        <?supplied-pmid 22908215?>
        <pub-id pub-id-type="pmid">22908215</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Law</surname>
            <given-names>CW</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Smyth</surname>
            <given-names>GK</given-names>
          </name>
        </person-group>
        <article-title>voom: precision weights unlock linear model analysis tools for rna-seq read counts</article-title>
        <source>Genome Biol</source>
        <year>2014</year>
        <volume>15</volume>
        <fpage>R29</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2014-15-2-r29</pub-id>
        <?supplied-pmid 24485249?>
        <pub-id pub-id-type="pmid">24485249</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Leimbach</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hacker</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Dobrindt</surname>
            <given-names>U</given-names>
          </name>
        </person-group>
        <source><italic>E. coli</italic> as an all-rounder: the thin line between commensalism and pathogenicity</source>
        <year>2013</year>
        <publisher-loc>Berlin</publisher-loc>
        <publisher-name>Springer Berlin Heidelberg</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>C-M</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Sadakane</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Lam</surname>
            <given-names>T-W</given-names>
          </name>
        </person-group>
        <article-title>MEGAHIT: an ultra-fast single-node solution for large and complex metagenomics assembly via succinct de Bruijn graph</article-title>
        <source>Bioinformatics</source>
        <year>2015</year>
        <volume>31</volume>
        <issue>10</issue>
        <fpage>1674</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btv033</pub-id>
        <?supplied-pmid 25609793?>
        <pub-id pub-id-type="pmid">25609793</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Minimap2: pairwise alignment for nucleotide sequences</article-title>
        <source>Bioinformatics</source>
        <year>2018</year>
        <volume>34</volume>
        <issue>18</issue>
        <fpage>3094</fpage>
        <lpage>100</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty191</pub-id>
        <?supplied-pmid 29750242?>
        <pub-id pub-id-type="pmid">29750242</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>mixtureS: a novel tool for bacterial strain genome reconstruction from reads</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>37</volume>
        <issue>4</issue>
        <fpage>575</fpage>
        <lpage>7</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btaa728</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luo</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Knight</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Siljander</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Knip</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Xavier</surname>
            <given-names>RJ</given-names>
          </name>
          <name>
            <surname>Gevers</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Constrains identifies microbial strains in metagenomic datasets.</article-title>
        <source>Nat Biotechnol</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>1045</fpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3319</pub-id>
        <?supplied-pmid 26344404?>
        <pub-id pub-id-type="pmid">26344404</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nurk</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Meleshko</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Korobeynikov</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Pevzner</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>metaspades: a new versatile metagenomic assembler</article-title>
        <source>Genome Res</source>
        <year>2017</year>
        <volume>27</volume>
        <fpage>824</fpage>
        <lpage>34</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.213959.116</pub-id>
        <?supplied-pmid 28298430?>
        <pub-id pub-id-type="pmid">28298430</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34</label>
      <mixed-citation publication-type="other">Nurk S, Raguideau S, Summers K, Quince C. STRONG - Strain Resolution ON Graphs. GitHub. 2021.</mixed-citation>
    </ref>
    <ref id="CR35">
      <label>35</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>O’Brien</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Didelot</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Iqbal</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Amenga-Etego</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Ahiska</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Falush</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>A bayesian approach to inferring the phylogenetic structure of communities from metagenomic data</article-title>
        <source>Genetics</source>
        <year>2014</year>
        <volume>197</volume>
        <issue>3</issue>
        <fpage>925</fpage>
        <lpage>37</lpage>
        <pub-id pub-id-type="doi">10.1534/genetics.114.161299</pub-id>
        <?supplied-pmid 24793089?>
        <pub-id pub-id-type="pmid">24793089</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Olm</surname>
            <given-names>MR</given-names>
          </name>
          <name>
            <surname>Crits-Christoph</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Bouma-Gregson</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Firek</surname>
            <given-names>BA</given-names>
          </name>
          <name>
            <surname>Morowitz</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Banfield</surname>
            <given-names>JF</given-names>
          </name>
        </person-group>
        <article-title>inStrain profiles population microdiversity from metagenomic data and sensitively detects shared microbial strains</article-title>
        <source>Nat Biotechnol</source>
        <year>2021</year>
        <volume>39</volume>
        <issue>6</issue>
        <fpage>727</fpage>
        <lpage>36</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-00797-0</pub-id>
        <?supplied-pmid 33462508?>
        <pub-id pub-id-type="pmid">33462508</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pachiadaki</surname>
            <given-names>MG</given-names>
          </name>
          <name>
            <surname>Brown</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Brown</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Bezuidt</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Berube</surname>
            <given-names>PM</given-names>
          </name>
          <name>
            <surname>Biller</surname>
            <given-names>SJ</given-names>
          </name>
          <name>
            <surname>Poulton</surname>
            <given-names>NJ</given-names>
          </name>
          <name>
            <surname>Burkart</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>La Clair</surname>
            <given-names>JJ</given-names>
          </name>
          <name>
            <surname>Chisholm</surname>
            <given-names>SW</given-names>
          </name>
          <name>
            <surname>Stepanauskas</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Charting the complexity of the marine microbiome through single-cell genomics</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>179</volume>
        <issue>7</issue>
        <fpage>1623</fpage>
        <lpage>1635.e11</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.11.017</pub-id>
        <?supplied-pmid 31835036?>
        <pub-id pub-id-type="pmid">31835036</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pasolli</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Asnicar</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Manara</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Zolfo</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Karcher</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Armanini</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Beghini</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Manghi</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Tett</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Ghensi</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Collado</surname>
            <given-names>MC</given-names>
          </name>
          <name>
            <surname>Rice</surname>
            <given-names>BL</given-names>
          </name>
          <name>
            <surname>DuLong</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Morgan</surname>
            <given-names>XC</given-names>
          </name>
          <name>
            <surname>Golden</surname>
            <given-names>CD</given-names>
          </name>
          <name>
            <surname>Quince</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Huttenhower</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Segata</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Extensive unexplored human microbiome diversity revealed by over 150,000 genomes from metagenomes spanning age, geography, and lifestyle</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>176</volume>
        <issue>3</issue>
        <fpage>649</fpage>
        <lpage>662.e20</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.01.001</pub-id>
        <?supplied-pmid 30661755?>
        <pub-id pub-id-type="pmid">30661755</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Quince</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Delmont</surname>
            <given-names>TO</given-names>
          </name>
          <name>
            <surname>Raguideau</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Alneberg</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Darling</surname>
            <given-names>AE</given-names>
          </name>
          <name>
            <surname>Collins</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Eren</surname>
            <given-names>AM</given-names>
          </name>
        </person-group>
        <article-title>Desman: a new tool for de novo extraction of strains from metagenomes</article-title>
        <source>Genome Biol</source>
        <year>2017</year>
        <volume>18</volume>
        <issue>1</issue>
        <fpage>181</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1309-9</pub-id>
        <?supplied-pmid 28934976?>
        <pub-id pub-id-type="pmid">28934976</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rautiainen</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Mäkinen</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Marschall</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>Bit-parallel sequence-to-graph alignment</article-title>
        <source>Bioinformatics</source>
        <year>2019</year>
        <volume>35</volume>
        <issue>19</issue>
        <fpage>3599</fpage>
        <lpage>607</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btz162</pub-id>
        <?supplied-pmid 30851095?>
        <pub-id pub-id-type="pmid">30851095</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rognes</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Flouri</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Nichols</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Quince</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Mahé</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Vsearch: a versatile open source tool for metagenomics</article-title>
        <source>Peer J</source>
        <year>2016</year>
        <volume>4</volume>
        <fpage>e2584</fpage>
        <pub-id pub-id-type="doi">10.7717/peerj.2584</pub-id>
        <?supplied-pmid 27781170?>
        <pub-id pub-id-type="pmid">27781170</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42</label>
      <mixed-citation publication-type="other">Segata N. On the road to strain-resolved comparative metagenomics. mSystems. 2018;3(2).</mixed-citation>
    </ref>
    <ref id="CR43">
      <label>43</label>
      <mixed-citation publication-type="other">Servén D, Brummitt C. pygam: generalized additive models in python. Zenodo. 2018.</mixed-citation>
    </ref>
    <ref id="CR44">
      <label>44</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tatusov</surname>
            <given-names>RL</given-names>
          </name>
          <name>
            <surname>Galperin</surname>
            <given-names>MY</given-names>
          </name>
          <name>
            <surname>Natale</surname>
            <given-names>DA</given-names>
          </name>
          <name>
            <surname>Koonin</surname>
            <given-names>EV</given-names>
          </name>
        </person-group>
        <article-title>The COG database : a tool for genome-scale analysis of protein functions and evolution</article-title>
        <source>Nucl Acid Res</source>
        <year>2000</year>
        <volume>28</volume>
        <issue>1</issue>
        <fpage>33</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/28.1.33</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Truong</surname>
            <given-names>DT</given-names>
          </name>
          <name>
            <surname>Tett</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Pasolli</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Huttenhower</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Segata</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Microbial strain-level population structure and genetic diversity from metagenomes</article-title>
        <source>Genome Res</source>
        <year>2017</year>
        <volume>27</volume>
        <issue>4</issue>
        <fpage>626</fpage>
        <lpage>38</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.216242.116</pub-id>
        <?supplied-pmid 28167665?>
        <pub-id pub-id-type="pmid">28167665</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Van Rossum</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Ferretti</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Maistrenko</surname>
            <given-names>OM</given-names>
          </name>
          <name>
            <surname>Bork</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Diversity within species: interpreting strains in microbiomes</article-title>
        <source>Nat Rev Microbiol</source>
        <year>2020</year>
        <volume>18</volume>
        <issue>9</issue>
        <fpage>491</fpage>
        <lpage>506</lpage>
        <pub-id pub-id-type="doi">10.1038/s41579-020-0368-1</pub-id>
        <?supplied-pmid 32499497?>
        <pub-id pub-id-type="pmid">32499497</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vos</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Didelot</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>A comparison of homologous recombination rates in bacteria and archaea</article-title>
        <source>ISME J</source>
        <year>2009</year>
        <volume>3</volume>
        <issue>2</issue>
        <fpage>199</fpage>
        <lpage>208</lpage>
        <pub-id pub-id-type="doi">10.1038/ismej.2008.93</pub-id>
        <?supplied-pmid 18830278?>
        <pub-id pub-id-type="pmid">18830278</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wainwright</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
        </person-group>
        <article-title>Graphical models, exponential families, and variational inference</article-title>
        <source>Found Trends Mach Learn</source>
        <year>2008</year>
        <volume>1</volume>
        <issue>1-2</issue>
        <fpage>1</fpage>
        <lpage>305</lpage>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Zhou</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Luhmann</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Alikhan</surname>
            <given-names>N-F</given-names>
          </name>
          <name>
            <surname>Quince</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Achtman</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <person-group person-group-type="editor">
          <name>
            <surname>Raphael</surname>
            <given-names>BJ</given-names>
          </name>
        </person-group>
        <article-title>Accurate reconstruction of microbial strains from metagenomic sequencing using representative reference genomes</article-title>
        <source>Research in Computational Molecular Biology</source>
        <year>2018</year>
        <publisher-loc>Cham</publisher-loc>
        <publisher-name>Springer International Publishing</publisher-name>
      </element-citation>
    </ref>
  </ref-list>
</back>
